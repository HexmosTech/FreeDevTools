<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cAdvisor Monitoring - Container Metrics Collection</title>
    <meta name="description" content="Learn how to configure Prometheus to scrape container metrics from cAdvisor using EC2 service discovery. Optimize your AWS monitoring setup.">
    <meta name="keywords" content="cAdvisor, Prometheus, container monitoring, AWS, EC2, service discovery, metrics collection, prometheus configuration, container metrics, scrape configs, relabel_configs">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://your-website.com/monitoring/cadvisor.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-website.com/monitoring/cadvisor.html">
    <meta property="og:title" content="cAdvisor Monitoring - Container Metrics Collection">
    <meta property="og:description" content="Learn how to configure Prometheus to scrape container metrics from cAdvisor using EC2 service discovery. Optimize your AWS monitoring setup.">
    <meta property="og:image" content="https://your-website.com/path/to/og-image.jpg"> <!-- Replace with actual image URL -->

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://your-website.com/monitoring/cadvisor.html">
    <meta name="twitter:title" content="cAdvisor Monitoring - Container Metrics Collection">
    <meta name="twitter:description" content="Learn how to configure Prometheus to scrape container metrics from cAdvisor using EC2 service discovery. Optimize your AWS monitoring setup.">
    <meta name="twitter:image" content="https://your-website.com/path/to/twitter-image.jpg"> <!-- Replace with actual image URL -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>cAdvisor Monitoring Configuration</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <p>This document outlines the configuration for collecting container metrics using cAdvisor with Prometheus, specifically focusing on AWS EC2 integration.</p>

                <h2>Prometheus Configuration for cAdvisor</h2>
                <p>To effectively monitor your containers, Prometheus needs to be configured to scrape metrics exposed by cAdvisor. This section details the necessary <code>scrape_configs</code>, particularly when leveraging AWS EC2's service discovery capabilities.</p>

                <h3>Key Labels for Container Metrics</h3>
                <p>When collecting container metrics, it's crucial to tag your instances appropriately. The following labels are commonly used and can be configured in Prometheus:</p>
                <ul>
                    <li><code>instance</code>: Typically maps to the EC2 instance name.</li>
                    <li><code>environment</code>: Identifies the deployment environment (e.g., production, staging).</li>
                    <li><code>cluster_name</code>: Specifies the Kubernetes or ECS cluster the container belongs to.</li>
                </ul>

                <h3>AWS EC2 Service Discovery Configuration</h3>
                <p>For AWS environments, Prometheus can dynamically discover targets using EC2 service discovery. This is particularly useful for managing ephemeral instances and ensuring Prometheus always scrapes the latest running cAdvisor instances.</p>
                <p>Below is an example of a Prometheus <code>scrape_configs</code> block configured for AWS:</p>
                <pre class="codehilite"><code>scrape_configs:
  - job_name: container-metrics
    scrape_interval: 15s
    ec2_sd_configs:
    - region: eu-west-1
      role_arn: 'arn:aws:iam::000000000000:role/prometheus-ec2-role'
      port: 9100
      filters:
        - name: tag:PrometheusContainerScrape
          values:
            - Enabled
    relabel_configs:
    - source_labels: [__meta_ec2_private_ip]
      replacement: '${1}:8080'
      target_label: __address__
    - source_labels: [__meta_ec2_tag_Name]
      target_label: instance
    - source_labels: [__meta_ec2_tag_ECSClusterName]
      target_label: cluster_name
    - source_labels: [__meta_ec2_tag_Environment]
      target_label: environment
</code></pre>

                <h3>Explanation of Configuration Parameters</h3>
                <ul>
                    <li><code>job_name: container-metrics</code>: Assigns a name to this scraping job.</li>
                    <li><code>scrape_interval: 15s</code>: Sets how frequently Prometheus should scrape metrics.</li>
                    <li><code>ec2_sd_configs</code>: Configures EC2 service discovery.
                        <ul>
                            <li><code>region</code>: The AWS region to scan for instances.</li>
                            <li><code>role_arn</code>: The IAM role ARN that Prometheus assumes to access EC2 information.</li>
                            <li><code>port</code>: The port cAdvisor is listening on (commonly 9100 for node_exporter, but cAdvisor might be on a different port, adjust as needed).</li>
                            <li><code>filters</code>: Allows filtering EC2 instances based on tags. Here, it selects instances tagged with <code>PrometheusContainerScrape=Enabled</code>.</li>
                        </ul>
                    </li>
                    <li><code>relabel_configs</code>: Rules to modify labels before ingestion.
                        <ul>
                            <li>The first rule sets the <code>__address__</code> label to the private IP and the cAdvisor port (8080 in this example).</li>
                            <li>Subsequent rules map EC2 tags (<code>Name</code>, <code>ECSClusterName</code>, <code>Environment</code>) to Prometheus labels (<code>instance</code>, <code>cluster_name</code>, <code>environment</code>).</li>
                        </ul>
                    </li>
                </ul>

                <h3>Further Resources</h3>
                <ul>
                    <li><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config" target="_blank" rel="noopener noreferrer">Prometheus Scrape Config Documentation</a></li>
                    <li><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#ec2_sd_config" target="_blank" rel="noopener noreferrer">Prometheus EC2 Service Discovery</a></li>
                    <li><a href="https://github.com/google/cadvisor" target="_blank" rel="noopener noreferrer">cAdvisor GitHub Repository</a></li>
                </ul>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>