<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bash Memory Exporter - Monitor Linux Process Memory with Prometheus</title>
    <meta name="description" content="Export Linux process memory usage to Prometheus Pushgateway using a Bash script. Monitor memory stats for processes and visualize with Grafana.">
    <meta name="keywords" content="bash memory exporter, prometheus, grafana, pushgateway, linux process monitoring, memory usage, system metrics, shell script, exporter">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://yourdomain.com/pushgateway/bash_memory_exporter.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/pushgateway/bash_memory_exporter.html">
    <meta property="og:title" content="Bash Memory Exporter - Monitor Linux Process Memory with Prometheus">
    <meta property="og:description" content="Export Linux process memory usage to Prometheus Pushgateway using a Bash script. Monitor memory stats for processes and visualize with Grafana.">
    <meta property="og:image" content="https://yourdomain.com/path/to/your/og-image.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://yourdomain.com/pushgateway/bash_memory_exporter.html">
    <meta name="twitter:title" content="Bash Memory Exporter - Monitor Linux Process Memory with Prometheus">
    <meta name="twitter:description" content="Export Linux process memory usage to Prometheus Pushgateway using a Bash script. Monitor memory stats for processes and visualize with Grafana.">
    <meta name="twitter:image" content="https://yourdomain.com/path/to/your/twitter-image.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Bash Memory Exporter</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <h2>Bash Memory Exporter for Prometheus</h2>
                <p>This Bash script acts as a simple exporter to gather memory usage statistics from the <code>top</code> command on a Linux system and push them to a Prometheus Pushgateway. This allows for real-time monitoring of process memory consumption, which can then be visualized using tools like Grafana.</p>
                
                <h3>How it Works</h3>
                <p>The script executes <code>ps aux</code> to get a list of all running processes and their associated memory usage. It then parses this output to extract the process name, PID, and memory percentage. These metrics are formatted into Prometheus exposition format and sent via a POST request to the specified Pushgateway URL. The script includes placeholders for job name, hostname, exporter type, authentication credentials, and the Pushgateway address, which should be configured according to your environment.</p>

                <h3>Key Components and Configuration</h3>
                <ul>
                    <li><strong><code>job_name</code></strong>: Defines the Prometheus job name for these metrics.</li>
                    <li><strong><code>my_hostname</code></strong>: Specifies the instance name, typically the hostname of the machine running the script.</li>
                    <li><strong><code>exporter_type</code></strong>: Categorizes the exporter, useful for filtering in Prometheus.</li>
                    <li><strong><code>auth_string</code></strong>: Authentication credentials for the Pushgateway (username:password).</li>
                    <li><strong><code>pushgateway_url</code></strong>: The URL of your Prometheus Pushgateway instance.</li>
                </ul>

                <h3>Prometheus and Grafana Integration</h3>
                <p>By sending metrics to the Pushgateway, Prometheus can scrape these metrics at regular intervals. Grafana can then be configured to query Prometheus and display the memory usage data, providing valuable insights into system performance and resource allocation. This setup is particularly useful for monitoring ephemeral workloads or applications that might not have a long-lived process for direct Prometheus scraping.</p>

                <h3>External Resources</h3>
                <ul>
                    <li><a href="https://prometheus.io/docs/instrumenting/pushing/" target="_blank" rel="noopener noreferrer">Prometheus Pushgateway Documentation</a></li>
                    <li><a href="https://grafana.com/docs/grafana/latest/datasources/prometheus/" target="_blank" rel="noopener noreferrer">Grafana Prometheus Data Source</a></li>
                    <li><a href="https://devconnected.com/monitoring-linux-processes-using-prometheus-and-grafana/" target="_blank" rel="noopener noreferrer">Monitoring Linux Processes with Prometheus and Grafana</a></li>
                </ul>

                <pre><code class="language-bash">#!/bin/bash

# This exporter gets stats from top and sends it to pushgateway
# Prometheus will scrape the pushgateway service and consumes to prometheus
# Grafana will visualize the data

# resource:
# https://devconnected.com/monitoring-linux-processes-using-prometheus-and-grafana/

job_name="top"
my_hostname="my-ec2-instance"
exporter_type="bash"
auth_string="x:x"
pushgateway_url="pushgateway.mydomain.com"

z=$(ps aux)
while read -r z
do
   var=$(echo "$var")$(echo "exporter_memory_usage{process=\""$(echo "$z" | awk '{print $11}')"\", pid=\""$(echo "$z" | awk '{print $2}')"\"} "$4z"\\n")
done &lt;&lt;&lt; "$z"
curl -X POST -u "$auth_string" -H  "Content-Type: text/plain" --data "$var" https://$pushgateway_url/metrics/job/$job_name/instance/$my_hostname/exporter_type/$exporter_type
</code></pre>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>