<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stop Server Script - CodeDeploy Utility</title>
    <meta name="description" content="Learn how to stop a server process using a bash script for CodeDeploy. This utility helps manage application deployments efficiently.">
    <meta name="keywords" content="codedeploy, stop server, bash script, application deployment, systemctl, server management, devops, automation">
    <link rel="canonical" href="https://example.com/codedeploy/appspec_versioned_stop_server.html">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://example.com/codedeploy/appspec_versioned_stop_server.html">
    <meta property="og:title" content="Stop Server Script - CodeDeploy Utility">
    <meta property="og:description" content="Learn how to stop a server process using a bash script for CodeDeploy. This utility helps manage application deployments efficiently.">
    <meta property="og:image" content="https://example.com/path/to/your/og-image.jpg">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://example.com/codedeploy/appspec_versioned_stop_server.html">
    <meta name="twitter:title" content="Stop Server Script - CodeDeploy Utility">
    <meta name="twitter:description" content="Learn how to stop a server process using a bash script for CodeDeploy. This utility helps manage application deployments efficiently.">
    <meta name="twitter:image" content="https://example.com/path/to/your/twitter-image.jpg">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CodeDeploy AppSpec Versioned Stop Server Script</h1>
        </div>
        <div class="content">
            <p>This section provides a bash script designed to be used within an AWS CodeDeploy AppSpec file. Its primary purpose is to gracefully stop a running server process, ensuring a clean shutdown before subsequent deployment steps are executed. This script is particularly useful for versioned deployments where you need to ensure the old version is fully stopped before the new one starts.</p>

            <h2>Bash Script for Stopping Server Processes</h2>
            <p>The following script checks for the existence of a systemd service named <code>python-app.service</code>. If found, it initiates a stop command using <code>systemctl</code>. A brief delay is included to allow the service to stop gracefully. The script then enters a loop, polling the service status until it is no longer active, confirming the server has been stopped.</p>

            <h3>Script Details and Usage</h3>
            <p>This script is typically placed in the <code>AfterInstall</code> or <code>BeforeInstall</code> hooks of your CodeDeploy AppSpec file. It leverages standard Linux commands and <code>systemctl</code> for service management.</p>
            <pre><code class="language-bash">#!/usr/bin/env bash
DATESTAMP="$(date +%FT%H:%m)"

if [ -f "/etc/systemd/system/python-app.service" ]
then
  sudo systemctl stop python-app
  sleep 5
  while [ "$(sudo systemctl is-active python-app)" == "active" ] 
  do
    sleep 5
  done
  echo "[${DATESTAMP}] application stopped"
fi
</code></pre>

            <h2>CodeDeploy AppSpec Integration</h2>
            <p>Integrating this script into your CodeDeploy workflow ensures that your application instances are properly managed during deployments. By stopping the server before proceeding, you minimize the risk of conflicts or downtime.</p>

            <h3>Best Practices for Deployment Scripts</h3>
            <p>Always test your deployment scripts thoroughly in a staging environment before deploying to production. Ensure that error handling is robust and that logs are informative for debugging purposes. For more information on CodeDeploy AppSpec files, refer to the <a href="https://docs.aws.amazon.com/codedeploy/latest/userguide/appspec-file.html" target="_blank">AWS CodeDeploy documentation</a>.</p>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>