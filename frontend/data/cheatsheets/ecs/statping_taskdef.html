<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statping Task Definition - ECS Deployment Configuration</title>
    <meta name="description" content="Configure your Statping service on AWS ECS with this task definition. Includes essential settings for container, environment variables, secrets, and volumes.">
    <meta name="keywords" content="Statping, ECS, AWS, Docker, Task Definition, Container Configuration, Environment Variables, Secrets Management, EFS, Deployment">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://example.com/ecs/statping_taskdef.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://example.com/ecs/statping_taskdef.html">
    <meta property="og:title" content="Statping Task Definition - ECS Deployment Configuration">
    <meta property="og:description" content="Configure your Statping service on AWS ECS with this task definition. Includes essential settings for container, environment variables, secrets, and volumes.">
    <meta property="og:image" content="https://example.com/path/to/your/og-image.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://example.com/ecs/statping_taskdef.html">
    <meta name="twitter:title" content="Statping Task Definition - ECS Deployment Configuration">
    <meta name="twitter:description" content="Configure your Statping service on AWS ECS with this task definition. Includes essential settings for container, environment variables, secrets, and volumes.">
    <meta name="twitter:image" content="https://example.com/path/to/your/twitter-image.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Statping Task Definition</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <p>This document provides a detailed AWS Elastic Container Service (ECS) task definition for deploying Statping. It outlines the necessary configurations for running Statping as a containerized application, ensuring proper resource allocation, environment setup, and secure handling of sensitive information.</p>

                <h2>Statping ECS Task Definition Overview</h2>
                <p>The following JSON structure defines the Statping task for AWS ECS. This configuration includes essential parameters such as the container image, IAM roles, memory reservation, port mappings, environment variables, and secrets management. It also specifies volume mounts for persistent data storage using Amazon EFS.</p>

                <h2>Container Configuration Details</h2>
                <p>The <code>containerDefinitions</code> section details the Statping container. It specifies the Docker image (<code>statping/statping:latest</code>), memory reservation, and port mappings. Crucially, it defines environment variables like <code>DB_CONN</code>, <code>SAMPLE_DATA</code>, <code>IS_DOCKER</code>, <code>STATPING_DIR</code>, <code>PORT</code>, and <code>SASS</code>, which are vital for Statping's operation within the containerized environment.</p>

                <h2>Secrets Management with AWS SSM</h2>
                <p>Sensitive information, such as database credentials (hostname, username, password, and database name), is managed securely using AWS Systems Manager (SSM) Parameter Store. The <code>secrets</code> array within the container definition maps these sensitive parameters to environment variables accessible by the Statping application, ensuring that credentials are not hardcoded in the task definition.</p>

                <h2>Persistent Storage with EFS Volumes</h2>
                <p>To ensure data persistence for Statping, a volume named <code>statping-data</code> is configured using <code>efsVolumeConfiguration</code>. This allows Statping to store its data in a persistent manner on an Amazon Elastic File System (EFS), with the data being mounted to the <code>/app</code> directory within the container. This is critical for maintaining application state and configuration across container restarts.</p>
            </div>
            <pre><code class="language-json">{
  "family": "statping",
  "executionRoleArn":"arn:aws:iam::000000000000:role/ecs-exec-role",
  "taskRoleArn":"arn:aws:iam::000000000000:role/ecs-task-role",
  "containerDefinitions": [
    {
      "name": "statping",
      "image": "statping/statping:latest",
      "memoryReservation": 256,
      "portMappings":[
        {
          "protocol":"tcp",
          "containerPort":8080,
          "hostPort":0
        }
      ],
      "environment": [
        {
          "name": "DB_CONN",
          "value": "mysql"
        },
        {
          "name": "SAMPLE_DATA",
          "value": "false"
        },
        {
          "name": "IS_DOCKER",
          "value": "true"
        },
        {
          "name": "STATPING_DIR",
          "value": "/app"
        },
        {
          "name": "PORT",
          "value": "8080"
        },
        {
          "name": "SASS",
          "value": "/usr/local/bin/sassc"
        }
      ],
      "secrets": [
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:000000000000:parameter/statping/prod/DATABASE_HOSTNAME",
          "name": "DB_HOST"
        },
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:000000000000:parameter/statping/prod/DATABASE_USERNAME",
          "name": "DB_USER"
        },
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:000000000000:parameter/statping/prod/DATABASE_NAME",
          "name": "DB_DATABASE"
        },
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:000000000000:parameter/statping/prod/DATABASE_PASSWORD",
          "name": "DB_PASS"
        }
      ],
      "essential": true,
      "privileged": true,
      "mountPoints": [
        {
          "containerPath": "/app",
          "sourceVolume": "statping-data",
          "readOnly": false
        }
      ]
    }
  ],
  "volumes": [
    {
      "name": "statping-data",
      "efsVolumeConfiguration": {
         "fileSystemId": "fs-00000000",
         "rootDirectory": "/statping/data"
      }
    }
  ]
}</code></pre>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>