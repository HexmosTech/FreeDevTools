<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alertmanager Configuration - Route Prometheus Alerts to Opsgenie & Slack</title>
    <meta name="description" content="Configure Prometheus alert routing with Alertmanager. Route alerts based on severity and environment to Slack and Opsgenie. Free, fast, and easy to use.">
    <meta name="keywords" content="Alertmanager, Prometheus, Alert routing, Opsgenie, Slack, monitoring, configuration, YAML, alert management, notification">
    <meta name="author" content="Your Name or Organization">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://example.com/alertmanager">

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="Alertmanager Configuration - Route Prometheus Alerts to Opsgenie & Slack">
    <meta property="og:description" content="Configure Prometheus alert routing with Alertmanager. Route alerts based on severity and environment to Slack and Opsgenie. Free, fast, and easy to use.">
    <meta property="og:image" content="https://example.com/alertmanager-banner.png">
    <meta property="og:url" content="https://example.com/alertmanager">
    <meta property="og:type" content="website">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Alertmanager Configuration - Route Prometheus Alerts to Opsgenie & Slack">
    <meta property="twitter:description" content="Configure Prometheus alert routing with Alertmanager. Route alerts based on severity and environment to Slack and Opsgenie. Free, fast, and easy to use.">
    <meta property="twitter:image" content="https://example.com/alertmanager-banner.png">

    <!-- Additional SEO Meta Tags -->
    <meta name="revisit-after" content="7 days">
    <meta name="language" content="en-US">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h2 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .external-link {
            color: #007bff;
            text-decoration: none;
        }

        .external-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>Alertmanager Configuration</h2>
        </div>
        <div class="content">
            <p>This example demonstrates how to configure Alertmanager to route alerts based on severity labels and environment. Alerts with severity "critical" and not in staging or development environments are sent to both Slack and Opsgenie. Other alerts are routed accordingly.</p>

            <h3>Alertmanager YAML Configuration Example</h3>
            <p>Below is a sample Alertmanager configuration in YAML format. This configuration defines how alerts are grouped, routed, and handled by different receivers such as Slack and Opsgenie.</p>

            <pre><code class="language-yaml"># example showing how to route alerts based on severity labels
# if severity label is critical and environment is not -staging or -dev
# it routes to slack and opsgenie

global:
  resolve_timeout: 5m
  slack_api_url: 'https://hooks.slack.com/services/x/x/x'
  
route:
  group_by: ['alertname', 'cluster', 'job', 'env']
  repeat_interval: 24h
  group_interval: 5m
  # capture everything to default
  receiver: 'default'
  routes:
    # match and group severity=critical to the critical receiver
    # this will be sent to slack and opsgenie
    - match:
        severity: critical
      receiver: critical
      routes:
      # match then environment=*-staging to warning
      - match_re:
          environment: .*(-staging).*
        receiver: warning
      # match then environment=*-dev to default
      - match_re:
          environment: .*(-dev).*
        receiver: default

receivers:
  - name: 'default'
    slack_configs:
      - send_resolved: true
        title_link: 'http://alertmanager.homedns.xyz/prometheus/alerts'
        title: '{{ if eq .Status "firing" }}:confused:{{ else }}:sunglasses:{{ end }} [{{ .Status | toUpper }}] {{ .CommonAnnotations.summary }}'
        text: "{{ range .Alerts }}*Description*: {{ .Annotations.description }}\n*Priority*: `{{ .Labels.severity | toUpper }}`\n{{ end }}"

  - name: 'warning'
    slack_configs:
      - send_resolved: true
        title_link: 'http://alertmanager.localdns.xyz/prometheus/alerts'
        title: '{{ if eq .Status "firing" }}:flushed:{{ else }}:sunglasses:{{ end }} [{{ .Status | toUpper }}] {{ .CommonAnnotations.summary }}'
        text: "{{ range .Alerts }}*Description*: {{ .Annotations.description }}\n*Priority*: `{{ .Labels.severity | toUpper }}`\n{{ end }}"

  - name: 'critical'
    slack_configs:
      - send_resolved: true
        title_link: 'http://alertmanager.localdns.xyz/prometheus/alerts'
        title: '{{ if eq .Status "firing" }}:scream:{{ else }}:sunglasses:{{ end }} [{{ .Status | toUpper }}] {{ .CommonAnnotations.summary }}'
        text: "{{ range .Alerts }}*Description*: {{ .Annotations.description }}\n*Priority*: `{{ .Labels.severity | toUpper }}`\n{{ end }}"
    opsgenie_configs:
      - send_resolved: true
        http_config: {}
        api_key: xx
        api_url: https://api.eu.opsgenie.com/
        message: '[{{ .Status | toUpper }}] {{ .CommonAnnotations.summary }}'
        description: "{{ .CommonAnnotations.description }}\nMore Info:\n- Impact: {{ .CommonAnnotations.impact }}\n- Action: {{ .CommonAnnotations.action }}\n- Dashboard: {{ .CommonAnnotations.dashboard }}\n- Runbook: {{ .CommonAnnotations.runbook }}"
        source: '{{ template "opsgenie.default.source" . }}'
        responders:
        - name: DevOps
          type: team
        priority: '{{ if .CommonAnnotations.priority }}{{ .CommonAnnotations.priority }}{{ else }}P3{{ end }}'
        tags: 'monitoring, exporters, prometheus'
        note: 'test-note'

  - name: 'default-opsgenie'
    opsgenie_configs:
      - send_resolved: true
        http_config: {}
        api_key: xx
        api_url: https://api.eu.opsgenie.com/
        message: '{{ template "opsgenie.default.message" . }}'
        description: '{{ template "opsgenie.default.description" . }}'
        source: '{{ template "opsgenie.default.source" . }}'
        responders:
        - name: DevOps
          type: team
        priority: '{{ if .CommonAnnotations.priority }}{{ .CommonAnnotations.priority }}{{ else }}P3{{ end }}'
        tags: 'test-tag, devops'
        note: 'test-note'
</code></pre>
            <p>This configuration uses YAML to define routing rules and receiver settings for Slack and Opsgenie. Ensure you replace placeholder values like API keys and URLs with your actual credentials.</p>

            <h3>Understanding Alert Routing</h3>
            <p>Alert routing in Alertmanager is determined by the <code>route</code> section. The <code>routes</code> subsection contains a list of route definitions. Each route defines a set of matching criteria (<code>match</code> or <code>match_re</code>) and a <code>receiver</code>. When an alert matches the criteria, it is sent to the specified receiver.</p>

            <h3>Configuring Receivers</h3>
            <p>Receivers define how alerts are handled. In this example, we have receivers for <code>default</code>, <code>warning</code>, and <code>critical</code> severities. Each receiver is configured to send alerts to Slack and/or Opsgenie. The <code>slack_configs</code> and <code>opsgenie_configs</code> sections contain the necessary configuration details for each service.</p>

            <h3>Further Resources</h3>
            <ul>
                <li><a href="https://prometheus.io/docs/alerting/latest/alertmanager/" class="external-link" target="_blank" rel="noopener noreferrer">Prometheus Alertmanager Documentation</a></li>
                <li><a href="https://www.opsgenie.com/docs/" class="external-link" target="_blank" rel="noopener noreferrer">Opsgenie Documentation</a></li>
                <li><a href="https://api.slack.com/messaging/webhooks" class="external-link" target="_blank" rel="noopener noreferrer">Slack Webhooks Documentation</a></li>
            </ul>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>
