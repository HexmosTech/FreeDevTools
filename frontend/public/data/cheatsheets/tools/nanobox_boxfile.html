<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nanobox Boxfile Configuration Guide - Nanobox DevTools</title>
    <meta name="description" content="Understand and configure Nanobox Boxfiles with detailed explanations of run.config, deploy.config, web, worker, and data sections. Learn about build triggers, deploy hooks, and component settings.">
    <meta name="keywords" content="nanobox boxfile, boxfile configuration, run.config, deploy.config, nanobox web, nanobox worker, nanobox data, devops, application deployment, containerization">
    <link rel="canonical" href="https://www.example.com/tools/nanobox_boxfile.html">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.example.com/tools/nanobox_boxfile.html">
    <meta property="og:title" content="Nanobox Boxfile Configuration Guide - Nanobox DevTools">
    <meta property="og:description" content="Understand and configure Nanobox Boxfiles with detailed explanations of run.config, deploy.config, web, worker, and data sections. Learn about build triggers, deploy hooks, and component settings.">
    <meta property="og:image" content="https://www.example.com/images/og-image.jpg">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://www.example.com/tools/nanobox_boxfile.html">
    <meta name="twitter:title" content="Nanobox Boxfile Configuration Guide - Nanobox DevTools">
    <meta name="twitter:description" content="Understand and configure Nanobox Boxfiles with detailed explanations of run.config, deploy.config, web, worker, and data sections. Learn about build triggers, deploy hooks, and component settings.">
    <meta name="twitter:image" content="https://www.example.com/images/twitter-image.jpg">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Nanobox Boxfile Configuration</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <h2>Understanding Boxfile Sections</h2>
                <p>
                    A Boxfile is the core configuration file for Nanobox applications, defining how your application is built, deployed, and run. It is structured into several key sections, often referred to as "nodes." These nodes allow for granular control over different aspects of your application's lifecycle. The primary sections include <code>run.config</code>, <code>deploy.config</code>, <code>web</code>, <code>worker</code>, and <code>data</code>. Each section serves a specific purpose in managing your application's environment and behavior.
                </p>

                <h2>Run Configuration (run.config)</h2>
                <p>
                    The <code>run.config</code> section is crucial for defining the build, environment, and general configuration for your application's web and worker components. This is where you specify the build engine, runtime environment, directories to be cached, extra packages to install, build triggers, and custom build steps. It ensures that your application is set up correctly before it starts running.
                </p>
                <pre><code class="language-yaml"># *****************************************************************************
# SECTIONS OF THE BOXFILE
# *****************************************************************************


# Boxfiles consist of a handful of sections or "nodes": run.config, deploy.config, web, worker, data.
# These are covered in detail in the next few docs, but here are some quick descriptions:

# run.config - Defines the build, environment, and configuration for web and worker components.
# deploy.config - Defines deploy hooks and possible code transformations.
# web - Defines settings unique to each web component.
# worker - Defines settings unique to each worker component.
# data - Defines settings unique to a specific data component.


# *****************************************************************************
# RUN.CONFIG
# https://docs.nanobox.io/boxfile/run-config/
# *****************************************************************************


run.config:
  # Engine
  engine: engine-name

  # Configuration used by the engine
  engine.config:
    runtime: ruby-2.3

  # Contents of these dirs to be cached inside of Nanobox
  cache_dirs:
    - vendor
    - packages

  # Extra Packages (in addition to what the engine installs)
  extra_packages:
    - nodejs
    - newrelic

  # Dev Packages
  dev_packages:
    - psutils

  # Build Triggers - Changes to these files automatically
  # trigger a new build the next time a build is required.
  build_triggers:
    - Gemfile
    - Gemfile.lock
    - package.json

  # Additions to $PATH
  extra_path_dirs:
    - vendor/bin

  # Custom commands to prepare the environment
  extra_steps:
    - npm install

  # Enable filesystem watcher
  fs_watch: true
</code></pre>

                <h2>Deploy Configuration (deploy.config)</h2>
                <p>
                    The <code>deploy.config</code> section handles the deployment process, including custom commands to prepare the production environment, code transformations, and deployment hooks. You can define commands that run before activation (<code>before_live</code>, <code>before_live_all</code>) and after activation (<code>after_live</code>, <code>after_live_all</code>) for specific components. This section is vital for ensuring a smooth and controlled deployment.
                </p>
                <pre><code class="language-yaml"># *****************************************************************************
# DEPLOY.CONFIG
# https://docs.nanobox.io/boxfile/deploy-config/
# *****************************************************************************


deploy.config:
  # Custom commands to prepare the production environment
  extra_steps:
    - mv config-prod.yml config.yml

  # Run after your code has been deployed to your live app,
  # but before everything is locked down with read-only permissions and distributed into new containers/servers.
  transform:
    - 'sed -i /HOST/$DATA_DB_HOST/g config/database.xml'
    - 'if [ "$ENV" = "prod" ]; then mv config-prod.yml config.yml; fi'

  # Run command on any one instance of web.main component before activation
  before_live:
    web.main:
      - 'bundle exec rake clear-cache'

  # Run command on all instances of web.main component before activation
  before_live_all:
    web.main:
      - 'bundle exec rake register-nodes'

  # Run command on any one instance of web.main component after activation
  after_live:
    worker.mail:
      - 'bundle exec rake prime-cache'

  # Run command on all instances of web.main component after activation
  after_live_all:
    worker.mail:
      - 'bundle exec rake prime-local-cache'
  
  # Set a timeout for your deploy hooks
  hook_timeout: 300
</code></pre>

                <h2>Web Component Configuration</h2>
                <p>
                    The <code>web</code> section defines settings specific to your web components. This includes the start and stop commands, current working directory, routing rules, port mappings, network storage configurations, writable directories, custom log watching, and cron jobs. You can also specify if a component should only be provisioned locally.
                </p>
                <pre><code class="language-yaml"># *****************************************************************************
# WEB
# https://docs.nanobox.io/boxfile/web/
# *****************************************************************************


web.site:
  # Start Command
  start: start-command

  # Stop Config
  stop: stop-command
  stop_force: false
  stop_timeout: 60  

  # Current Working Directory
  cwd: directory

  # Routing
  routes:
    - 'sub:/path/'
    - '/admin/'

  # Port Mapping
  ports:
    - tcp:21:3420
    - udp:53:3000

  # Network Storage
  network_dirs:
    data.files:
      - path/to/directoryA
      - path/to/directoryB
    data.unfs:
      - path/to/directoryC

  # Writable Dirs
  writable_dirs:
    - path/to/dirA
    - path/to/dirB

  # Custom Logs
  log_watch:
    app[error]: /app/path/to/error.log

  # Cron
  cron:
    - id: flush_cache
      schedule: '0 0 * * *'
      command: rm -rf app/cache/*
    - id: echo_msg
      schedule: '*/3 */2 1-3 2,6,7 2'
      command: echo i\'m a little teapot

  # Only provision component locally
  local_only: true
</code></pre>

                <h2>Worker Component Configuration</h2>
                <p>
                    Similar to web components, the <code>worker</code> section allows you to configure settings unique to your worker processes. This includes start and stop commands, working directory, network storage, writable directories, custom log watching, and cron jobs. This enables you to manage background tasks and processing units effectively.
                </p>
                <pre><code class="language-yaml"># *****************************************************************************
# WORKER
# https://docs.nanobox.io/boxfile/worker/
# *****************************************************************************


worker.jobs:
  # Start Command
  start: ruby worker.rb

  # Stop Config
  stop: stop-command
  stop_force: false
  stop_timeout: 30

  # Current Working Directory
  cwd: directory

  # Network Storage
  network_dirs:
    data.storage1:
      - path/to/directoryA
      - path/to/directoryB
    data.storage2:
      - path/to/directoryC

  # Writable Dirs
  writable_dirs:
    - path/to/dirA
    - path/to/dirB

  # Custom Logs
  log_watch:
    job[error]: /app/path/to/error.log

  # Cron
  cron:
    - id: flush_cache
      schedule: '0 0 * * *'
      command: rm -rf app/cache/*
    - id: echo_msg
      schedule: '*/3 */2 1-3 2,6,7 2'
      command: echo i\'m a little teapot

  # Only provision component locally
  local_only: true
</code></pre>

                <h2>Data Component Configuration</h2>
                <p>
                    The <code>data</code> section is used to define settings for your data components, such as databases. You can specify the Docker image to use, configuration options exposed by that image, and cron jobs for data management tasks like backups. It also allows for the installation of extra packages and custom commands to prepare the environment for data services.
                </p>
                <pre><code class="language-yaml"># *****************************************************************************
# DATA
# https://docs.nanobox.io/boxfile/data/
# *****************************************************************************


data.db:
  # Image
  image: nanobox/mysql:5.6

  # Config Options Exposed by the Image
  config:
    plugins:
      - federated
      - audit_log
    event_scheduler: 'Off'

  # Cron
  cron:
    - id: backup
      schedule: '0 0 * * *'
      command: 'bash /path/to/scripts/backup.sh'
    - id: echo_msg
      schedule: '*/3 */2 1-3 2,6,7 2'
      command: 'echo i\'m a little teapot'

  # Extra Packages (in addition to what the image installs)
  extra_packages:
    - perl
    - curl

  # Additions to $PATH
  extra_path_dirs:
    - /custom/bin

  # Custom commands to prepare the environment
  extra_steps:
    - wget -o /path/to/scripts/cron.sh http://example.com/cron.sh

  # Only provision component locally
  local_only: true
</code></pre>
                <p>
                    For more in-depth information on each section and its parameters, refer to the official Nanobox documentation. Understanding these configurations is key to effectively managing your applications with Nanobox.
                </p>
                <p>
                    Explore the official Nanobox documentation for comprehensive details on each configuration option:
                    <ul>
                        <li><a href="https://docs.nanobox.io/boxfile/run-config/" target="_blank" rel="noopener noreferrer">Run Configuration Docs</a></li>
                        <li><a href="https://docs.nanobox.io/boxfile/deploy-config/" target="_blank" rel="noopener noreferrer">Deploy Configuration Docs</a></li>
                        <li><a href="https://docs.nanobox.io/boxfile/web/" target="_blank" rel="noopener noreferrer">Web Component Docs</a></li>
                        <li><a href="https://docs.nanobox.io/boxfile/worker/" target="_blank" rel="noopener noreferrer">Worker Component Docs</a></li>
                        <li><a href="https://docs.nanobox.io/boxfile/data/" target="_blank" rel="noopener noreferrer">Data Component Docs</a></li>
                    </ul>
                </p>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>