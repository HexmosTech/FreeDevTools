---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { loadMcpData } from '@/lib/mcp-data-processor.tsx';

export async function getStaticPaths() {
  // Load data from input.json
  const { categories } = await loadMcpData();
  
  // Generate static paths for all categories
  const paths = categories.map((category) => ({
    params: { category: category.id },
    props: { category }
  }));

  return paths;
}

const { category } = Astro.props;
const { servers, categories: allCategories } = await loadMcpData();

// Filter servers for this category
const categoryServers = servers.filter(server => 
  server.categories.includes(category.id)
);

// Get category info
const categoryInfo = allCategories.find(cat => cat.id === category.id);

// Helper function to get category emoji
const getCategoryEmoji = (icon: string): string => {
  const iconMap: Record<string, string> = {
    'pickaxe': '⛏️',
    'code': '💻',
    'brain': '🧠',
    'cloud-upload': '☁️',
    'shield': '🛡️',
    'bitcoin': '₿',
    'browser': '🌐',
    'cloud': '☁️',
    'message-circle': '💬',
    'palette': '🎨',
    'database': '🗄️',
    'terminal': '💻',
    'users': '👥',
    'star': '⭐',
    'tool': '🔧'
  };
  return iconMap[icon] || '🔧';
};

// SEO Data
const title = `${categoryInfo?.name || category.id} MCP Repositories - Browse ${categoryServers.length} Model Context Protocol Repositories | Free DevTools by Hexmos`;
const description = `Discover ${categoryServers.length} MCP repositories in the ${categoryInfo?.name || category.id} category. Find the perfect Model Context Protocol repository for your AI agent project.`;
const keywords = [
  'mcp repositories',
  'model context protocol',
  categoryInfo?.name || category.id,
  'ai agent tools',
  'mcp directory',
  'open source mcp'
];

// Breadcrumb data
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'MCP Directory', href: '/freedevtools/mcp/' },
  { label: categoryInfo?.name || category.id }
];
---

<BaseLayout 
  name={`${categoryInfo?.name || category.id} MCP Repositories`}
  title={title}
  path={`/freedevtools/mcp/servers/categories/${category.id}`}
  description={description}
  canonical={`https://hexmos.com/freedevtools/mcp/servers/categories/${category.id}`}
  themeColor="#3b82f6"
  keywords={keywords}
  ogImage="https://hexmos.com/freedevtools/tool-banners/mcp-directory-banner.png"
  twitterImage="https://hexmos.com/freedevtools/tool-banners/mcp-directory-banner.png"
  datePublished="2025-01-30"
  softwareVersion="1.0.0"
  features={[
    `Browse ${categoryServers.length} MCP repositories in ${categoryInfo?.name || category.id}`,
    'Filter by license and quality scores',
    'Search and sort functionality',
    'Detailed repository information'
  ]}
>
  <div class="max-w-6xl mx-auto px-2 md:px-6">
    <!-- Header -->
    <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl p-6 mb-6">
      <div class="text-center space-y-4">
        <div class="flex items-center justify-center space-x-3">
          <div class="text-4xl">{getCategoryEmoji(categoryInfo?.icon || 'tool')}</div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">
              {categoryInfo?.name || category.id} MCP Repositories
            </h1>
            <p class="text-gray-600 dark:text-gray-400">
              {categoryInfo?.description || `MCP repositories in the ${category.id} category`}
            </p>
          </div>
        </div>
        <div class="text-sm text-gray-500 dark:text-gray-500">
          {categoryServers.length} repositories in this category
        </div>
      </div>
    </div>

    <!-- Breadcrumb -->
    <nav class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400 mb-6">
      {breadcrumbItems.map((item, index) => (
        <>
          {index > 0 && <span>›</span>}
          {item.href ? (
            <a href={item.href} class="hover:text-blue-600 dark:hover:text-blue-400">
              {item.label}
            </a>
          ) : (
            <span class="text-gray-900 dark:text-gray-100">{item.label}</span>
          )}
        </>
      ))}
    </nav>

    <!-- Repositories List -->
    <div class="space-y-4">
      {categoryServers.length === 0 ? (
        <div class="text-center py-12">
          <div class="text-6xl mb-4">🔍</div>
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">
            No repositories found
          </h3>
          <p class="text-gray-600 dark:text-gray-400">
            There are no MCP repositories in the {categoryInfo?.name || category.id} category yet.
          </p>
        </div>
      ) : (
        categoryServers.map((server) => (
          <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg p-6 hover:shadow-md transition-shadow">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="flex items-center space-x-3 mb-2">
                  <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
                    {server.name}
                  </h3>
                  <span class="px-2 py-1 text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full">
                    {server.license}
                  </span>
                </div>
                <p class="text-gray-600 dark:text-gray-400 mb-3">
                  {server.description}
                </p>
                <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                  <span>⭐ {server.stats.githubStars}</span>
                  <span>📦 {server.stats.weeklyDownloads} weekly downloads</span>
                  <span>🛠️ {server.stats.tools} tools</span>
                  <span>🕒 {server.stats.lastUpdated}</span>
                </div>
              </div>
              <div class="flex flex-col space-y-2 ml-4">
                <a 
                  href={server.githubUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="px-4 py-2 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 rounded-lg hover:bg-gray-800 dark:hover:bg-gray-200 transition-colors text-sm font-medium"
                >
                  View on GitHub
                </a>
                <a 
                  href={server.url}
                  class="px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-sm font-medium"
                >
                  View Details
                </a>
              </div>
            </div>
          </div>
        ))
      )}
    </div>
  </div>
</BaseLayout>
