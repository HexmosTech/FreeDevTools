---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import Mcp from './_Mcp';

// Load MCP metadata
const metadataEntries = await getCollection('mcpMetadata');
const metadata = metadataEntries[0]?.data;

if (!metadata) {
  throw new Error('MCP metadata not found');
}

// Load all category data
const categoryEntries = await getCollection('mcpCategoryData');

// Process categories for the UI
const categories = Object.entries(metadata.categories).map(([id, categoryData]) => ({
  id,
  name: categoryData.categoryDisplay,
  description: '', // Will be filled from category data
  icon: `/freedevtools/svg_icons/automation/mcp-server-stroke-rounded.svg`,
  serverCount: categoryData.totalRepositories,
  url: `/freedevtools/mcp/${id}/`
}));

// Add descriptions from category data
categoryEntries.forEach(entry => {
  const category = categories.find(c => c.id === entry.data.category);
  if (category) {
    category.description = entry.data.description || '';
  }
});

// Calculate totals
const totalServers = metadata.totalRepositories;
const totalCategories = metadata.totalCategories;
const totalTools = Object.values(metadata.categories).reduce((sum, cat) => sum + cat.npmPackages, 0);
const totalClients = 0; // This would need to be calculated from actual data

// SEO data
const title = `MCP Directory - ${totalServers.toLocaleString()}+ Model Context Protocol Repositories`;
const description = `Browse ${totalServers.toLocaleString()}+ MCP repositories across ${totalCategories} categories. Find Model Context Protocol servers, tools, and clients. Free, no registration required.`;
const keywords = [
  'MCP',
  'Model Context Protocol',
  'MCP servers',
  'MCP tools',
  'MCP clients',
  'AI tools',
  'developer tools',
  'open source',
  'repositories',
  'directory'
];

// Breadcrumb data
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'MCP Directory' }
];
---

<BaseLayout 
  name="MCP Directory"
  title={title}
  path="/freedevtools/mcp/"
  description={description}
  canonical="https://hexmos.com/freedevtools/mcp/"
  themeColor="#3b82f6"
  keywords={keywords}
  ogImage="https://hexmos.com/freedevtools/tool-banners/mcp-directory-banner.png"
  twitterImage="https://hexmos.com/freedevtools/tool-banners/mcp-directory-banner.png"
  datePublished="2025-01-30"
  softwareVersion="1.0.0"
  features={[
    `Browse ${totalServers.toLocaleString()}+ MCP repositories`,
    `Explore ${totalCategories} categories`,
    'Filter by category and license',
    'Search and sort functionality'
  ]}
>
    <Mcp 
      serversCount={totalServers}
      toolsCount={totalTools}
      clientsCount={totalClients}
      categoriesCount={totalCategories}
      categories={categories}
      breadcrumbItems={breadcrumbItems}
      client:load 
    />
</BaseLayout>
