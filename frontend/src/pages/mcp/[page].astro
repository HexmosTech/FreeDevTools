---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { generateMcpDirectoryPaginatedPaths } from '@/lib/mcp-utils';
import { getCollection } from 'astro:content';
import Mcp from './_Mcp';

// Generate static paths for MCP directory with pagination
export async function getStaticPaths({ paginate }) {
  return await generateMcpDirectoryPaginatedPaths({ paginate });
}

// Get page from props
const { page } = Astro.props;

// Load MCP metadata
const metadataEntries = await getCollection('mcpMetadata');
const metadata = metadataEntries[0]?.data;

if (!metadata) {
  throw new Error('MCP metadata not found');
}

// Calculate totals
const totalServers = metadata.totalRepositories;
const totalCategories = metadata.totalCategories;
const totalTools = Object.values(metadata.categories).reduce((sum, cat) => sum + cat.npmPackages, 0);
const totalClients = 0; // This would need to be calculated from actual data

// SEO data
const title = `MCP Directory - Page ${page.currentPage} of ${page.lastPage} - ${page.total} Model Context Protocol Categories`;
const description = `Browse ${page.total} MCP categories. Page ${page.currentPage} of ${page.lastPage}. Find Model Context Protocol servers, tools, and clients. Free, no registration required.`;
const keywords = [
  'MCP',
  'Model Context Protocol',
  'MCP servers',
  'MCP tools',
  'MCP clients',
  'AI tools',
  'developer tools',
  'open source',
  'repositories',
  'directory',
  'pagination'
];

// Breadcrumb data
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'MCP Directory' }
];
---

<BaseLayout 
  name="MCP Directory"
  title={title}
  path="/freedevtools/mcp/"
  description={description}
  canonical={`https://hexmos.com/freedevtools/mcp/${page.currentPage === 1 ? '' : page.currentPage + '/'}`}
  themeColor="#3b82f6"
  keywords={keywords}
  ogImage="https://hexmos.com/freedevtools/tool-banners/mcp-directory-banner.png"
  twitterImage="https://hexmos.com/freedevtools/tool-banners/mcp-directory-banner.png"
  datePublished="2025-01-30"
  softwareVersion="1.0.0"
  features={[
    `Browse ${page.total} MCP categories`,
    `Page ${page.currentPage} of ${page.lastPage}`,
    'Filter by category and license',
    'Search and sort functionality'
  ]}
>
  <Mcp 
    serversCount={totalServers}
    toolsCount={totalTools}
    clientsCount={totalClients}
    categoriesCount={page.total}
    categories={page.data}
    breadcrumbItems={breadcrumbItems}
    currentPage={page.currentPage}
    lastPage={page.lastPage}
    totalPages={page.lastPage}
    pageUrl={page.url}
    client:load 
  />
</BaseLayout>
