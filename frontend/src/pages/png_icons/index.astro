---
import {
  getClusters,
  getIconsByCluster,
  getTotalIcons,
} from 'db/png_icons/png-icons-utils';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PngIcons from './_PngIcons.astro';

// Load SVG icons data from SQLite
const clusters = getClusters();

// Get all categories with their data
const allCategories = clusters.map((cluster) => {
  // Get icons for this cluster to count them
  const icons = getIconsByCluster(cluster.source_folder || cluster.name);

  return {
    id: cluster.source_folder || cluster.name,
    name: cluster.name,
    description: cluster.description,
    icon: `/freedevtools/png_icons/${cluster.name}/`,
    iconCount: icons.length,
    url: `/freedevtools/png_icons/${cluster.name}/`,
    keywords: cluster.keywords,
    features: cluster.features,
    fileNames: icons.map((icon) => icon.name), // Include fileNames for icon previews
  };
});

// Calculate total SVG icons across all categories
const totalPngIcons = getTotalIcons();

// Pagination logic for page 1
const itemsPerPage = 30;
const currentPage = 1;
const totalPages = Math.ceil(allCategories.length / itemsPerPage);
const startIndex = (currentPage - 1) * itemsPerPage;
const endIndex = startIndex + itemsPerPage;
const categories = allCategories.slice(startIndex, endIndex);
const totalCategories = allCategories.length;

// Breadcrumb data
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'PNG Icons' },
];

// SEO data
const seoTitle =
  currentPage === 1
    ? 'Free PNG Icons - Download & Edit Vector Graphics | Online Free DevTools by Hexmos'
    : `Free PNG Icons - Page ${currentPage} | Online Free DevTools by Hexmos`;

const seoDescription =
  currentPage === 1
    ? `Download 50k+ free PNG icons instantly. Edit colors, add backgrounds, and customize vector graphics for your projects. No registration required.`
    : `Browse page ${currentPage} of our free PNG icons collection. Download thousands of vector graphics instantly. No registration required.`;

const canonical =
  currentPage === 1
    ? 'https://hexmos.com/freedevtools/png_icons/'
    : `https://hexmos.com/freedevtools/png_icons/${currentPage}/`;

// Enhanced keywords for main page
const mainKeywords = [
  'png icons',
  'vector graphics',
  'free icons',
  'download icons',
  'edit icons',
  'icon library',
  'vector graphics library',
  'png download',
  'free vector icons',
  'customizable icons',
];
---

<BaseLayout
  name="PNG Icons"
  path={currentPage === 1
    ? '/freedevtools/png_icons/'
    : `/freedevtools/png_icons/${currentPage}/`}
  title={seoTitle}
  description={seoDescription}
  canonical={canonical}
  showHeader={true}
  totalItems={totalCategories}
  itemsPerPage={itemsPerPage}
  currentPage={currentPage}
  category="PNG Icons"
  partOf="Free DevTools"
  partOfUrl="https://hexmos.com/freedevtools/"
  keywords={mainKeywords}
  features={[
    'Download',
    'Edit colors',
    'Add backgrounds',
    'Customize',
    'No registration',
  ]}
>
  <PngIcons
    categories={categories}
    currentPage={currentPage}
    totalPages={totalPages}
    totalCategories={totalCategories}
    totalPngIcons={totalPngIcons}
    breadcrumbItems={breadcrumbItems}
  />
</BaseLayout>
