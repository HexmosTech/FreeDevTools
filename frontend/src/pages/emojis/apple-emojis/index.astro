---
import {
  fetchImageFromDB,
  getAppleCategoriesWithPreviewEmojis,
  getEmojiCategories,
  type EmojiData,
} from 'db/emojis/emojis-utils';
import AdBanner from '../../../components/banner/AdBanner';
import BaseLayout from '../../../layouts/BaseLayout.astro';

// Get categories with preview emojis in a single optimized query
const categoriesWithPreview = await getAppleCategoriesWithPreviewEmojis(5);
const categories = await getEmojiCategories();

// Transform to match expected format
const emojisByCategory: Record<string, EmojiData[]> = {};
const categoryCounts: Record<string, number> = {};
for (const catWithPreview of categoriesWithPreview) {
  emojisByCategory[catWithPreview.category] = catWithPreview.previewEmojis.map(
    (e) =>
      ({
        code: e.code,
        slug: e.slug,
        title: e.title,
      }) as EmojiData
  );
  categoryCounts[catWithPreview.category] = catWithPreview.count;
}

// Sort categories alphabetically (already sorted from query, but ensure)
const sortedCategories = categoriesWithPreview
  .map((c) => c.category)
  .filter((cat) => cat !== 'Other')
  .sort();

// Pagination logic for page 1
const itemsPerPage = 30;
const currentPage = 1;
const totalPages = Math.ceil(sortedCategories.length / itemsPerPage);
const startIndex = (currentPage - 1) * itemsPerPage;
const endIndex = startIndex + itemsPerPage;
const paginatedCategories = sortedCategories.slice(startIndex, endIndex);
const totalCategories = sortedCategories.length;

// Breadcrumb items
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'Emojis', href: '/freedevtools/emojis/' },
  { label: 'Apple Emojis' },
];

// SEO data
const seoTitle =
  currentPage === 1
    ? 'Apple Emojis Reference - Browse & Copy Apple Emojis | Online Free DevTools by Hexmos'
    : `Apple Emojis Reference - Page ${currentPage} | Online Free DevTools by Hexmos`;

const seoDescription =
  currentPage === 1
    ? "Browse Apple's version of emojis by category. Copy instantly, explore meanings, and discover platform-specific emoji designs."
    : `Browse page ${currentPage} of Apple's emoji reference. Copy instantly, explore meanings, and discover iOS-style emoji artwork.`;

const canonical =
  currentPage === 1
    ? 'https://hexmos.com/freedevtools/emojis/apple-emojis/'
    : `https://hexmos.com/freedevtools/emojis/apple-emojis/${currentPage}/`;

const mainKeywords = [
  'apple emojis',
  'ios emojis',
  'apple emoji list',
  'apple emoji reference',
  'emoji categories',
  'copy emojis',
  'emoji meanings',
  'emoji shortcodes',
  'emoji library',
  'emoji copy',
];

// Category icons
const categoryIconMap: Record<string, string> = {
  'Smileys & Emotion': (await fetchImageFromDB(
    'slightly-smiling-face',
    'slightly-smiling-face_iOS_18.4.png'
  )) || '',
  'People & Body': (await fetchImageFromDB(
    'bust-in-silhouette',
    'bust-in-silhouette_1f464_iOS_18.4.png'
  )) || '',
  'Animals & Nature': (await fetchImageFromDB(
    'dog-face',
    'dog-face_1f436_iOS_18.4.png'
  )) || '',
  'Food & Drink': (await fetchImageFromDB(
    'red-apple',
    'red-apple_1f34e_iOS_18.4.png'
  )) || '',
  'Travel & Places': (await fetchImageFromDB('airplane', 'airplane_iOS_18.4.png')) || '',
  Activities: (await fetchImageFromDB('soccer-ball', 'soccer-ball_26bd_iOS_18.4.png')) || '',
  Objects: (await fetchImageFromDB('mobile-phone', 'mobile-phone_iOS_18.4.png')) || '',
  Symbols: (await fetchImageFromDB(
    'check-mark-button',
    'check-mark-button_2705_iOS_18.4.png'
  )) || '',
  Flags: (await fetchImageFromDB('chequered-flag', 'chequered-flag_iOS_18.4.png')) || '',
  Other: (await fetchImageFromDB('question-mark', 'question-mark_2753_iOS_18.4.png')) || '',
};
---

<BaseLayout
  name="Apple Emojis"
  path={currentPage === 1
    ? '/freedevtools/emojis/apple-emojis/'
    : `/freedevtools/emojis/apple-emojis/${currentPage}/`}
  title={seoTitle}
  description={seoDescription}
  canonical={canonical}
  themeColor="#1e40af"
  showHeader={true}
  totalItems={totalCategories}
  itemsPerPage={itemsPerPage}
  currentPage={currentPage}
  category="Emojis"
  partOf="Free DevTools"
  partOfUrl="https://hexmos.com/freedevtools/"
  keywords={mainKeywords}
  features={[
    'Apple-style designs',
    'Browse by category',
    'Copy instantly',
    'Compare with Unicode',
    'Free access',
  ]}
  emojiCategory="Apple Emojis"
>
  <div class="max-w-6xl mx-auto px-2 md:px-6">
    <div class="mb-16 mt-[74px]">
      <AdBanner />
    </div>

    <div class="mb-8">
      <!-- Breadcrumbs -->
      <nav class="text-sm text-slate-600 dark:text-slate-400 mb-4">
        {
          breadcrumbItems.map((item, idx) => (
            <>
              {idx > 0 && <span class="mx-2">/</span>}
              {item.href ? (
                <a
                  href={item.href}
                  class="hover:text-blue-600 dark:hover:text-blue-400"
                >
                  {item.label}
                </a>
              ) : (
                <span>{item.label}</span>
              )}
            </>
          ))
        }
      </nav>

      <h1 class="text-3xl font-bold text-slate-900 dark:text-slate-100 mb-4">
        Apple Emojis üçé
      </h1>

      <p class="text-lg text-slate-600 dark:text-slate-400 mb-6">
        Apple's emojis are known for their vibrant, playful designs and the
        frequent updates that come with each iOS release. Instead of relying on
        standard Unicode glyphs, Apple creates custom artwork for every emoji,
        which makes their style instantly recognizable to iPhone, iPad, and Mac
        users. Discover Apple's full emoji collection here, complete with
        previews and instant copy options for every category. Whether you're
        exploring the newest emojis from the latest iOS update or comparing how
        platforms differ, this page makes it easy to dive into Apple's creative
        emoji style.
      </p>
    </div>

    <!-- Emoji Categories Grid -->
    <div
      id="emoji-categories"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
    >
      {
        paginatedCategories.map((category) => (
          <div class="category-card bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-4 transition-all duration-300 ease-in-out shadow-sm hover:-translate-y-1 hover:shadow-xl">
            <div class="flex items-center mb-4">
              <div class="w-10 h-10 flex items-center justify-center mr-3">
                <img
                  src={
                    categoryIconMap[category] ||
                    '/freedevtools/emoji_data/question-mark/apple-emojis/question-mark_2753_iOS_18.4.png'
                  }
                  alt={category + ' icon'}
                  class="h-10 w-10"
                />
              </div>
              <a
                href={`/freedevtools/emojis/apple-emojis/${category.toLowerCase().replace(/[^a-z0-9]+/g, '-')}/`}
                class="text-xl font-semibold text-black dark:text-neon-light capitalize hover:text-green-600 dark:hover:text-green-400 transition-colors"
              >
                {category}
              </a>
            </div>
            <p class="text-sm text-slate-800 dark:text-slate-400 mb-4 m-0">
              {(
                categoryCounts[category] || emojisByCategory[category].length
              ).toLocaleString()}{' '}
              emojis available
            </p>

            <div class="space-y-2">
              {emojisByCategory[category].slice(0, 5).map((emoji: any) => {
                const emojiName = emoji.title || emoji.slug;
                const truncatedName =
                  emojiName.length > 27
                    ? emojiName.substring(0, 27) + '...'
                    : emojiName;
                return (
                  <a
                    href={`/freedevtools/emojis/apple-emojis/${emoji.slug}/`}
                    class="block text-sm text-blue-600 dark:text-blue-400 hover:text-black dark:hover:text-white hover:font-bold"
                  >
                    {emoji.code || emoji.emoji} {truncatedName}
                  </a>
                );
              })}
              {(categoryCounts[category] || emojisByCategory[category].length) >
                5 && (
                <p class="text-xs text-slate-500 dark:text-slate-500">
                  +
                  {(
                    (categoryCounts[category] ||
                      emojisByCategory[category].length) - 5
                  ).toLocaleString()}{' '}
                  more items
                </p>
              )}
            </div>

            <div class="mt-4 pt-4 border-t border-slate-200 dark:border-slate-800">
              <a
                href={`/freedevtools/emojis/apple-emojis/${category.toLowerCase().replace(/[^a-z0-9]+/g, '-')}/`}
                class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"
              >
                View all {category} emojis ‚Üí
              </a>
            </div>
          </div>
        ))
      }
    </div>

    <!-- Navigation -->
    <div
      class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700"
    >
      <div class="flex flex-wrap gap-4">
        <a
          href="/freedevtools/emojis/"
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 transition-colors"
        >
          ‚Üê Back to Emojis
        </a>
        <a
          href="/freedevtools/emojis/discord-emojis/"
          class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-800 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
        >
          üéÆ Discord Emojis
        </a>
      </div>
    </div>
  </div>
</BaseLayout>
