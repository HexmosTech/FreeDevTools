---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import AdBanner from '../../../components/banner/AdBanner';
import { getAllEmojis, getEmojiCategories, fetchImageFromDB } from '../../../lib/emojis';

// Load all emojis
const emojis = await getAllEmojis();

// Metadata-based categories
const categories = getEmojiCategories();
const emojisByCategory: Record<string, EmojiData[]> = {};

// Group emojis by category
for (const cat of categories) {
  emojisByCategory[cat] = emojis.filter((e) => (e.category || 'Other') === cat);
}

// Sort categories alphabetically and exclude "Other"
const sortedCategories = Object.keys(emojisByCategory)
  .filter((cat) => cat !== 'Other')
  .sort();

// Sort emojis within each category by title (fallback to slug)
for (const category of sortedCategories) {
  emojisByCategory[category].sort((a, b) => {
    const titleA = a.title || a.slug || '';
    const titleB = b.title || b.slug || '';
    return titleA.localeCompare(titleB);
  });
}

// Pagination logic for page 1
const itemsPerPage = 30;
const currentPage = 1;
const totalPages = Math.ceil(sortedCategories.length / itemsPerPage);
const startIndex = (currentPage - 1) * itemsPerPage;
const endIndex = startIndex + itemsPerPage;
const paginatedCategories = sortedCategories.slice(startIndex, endIndex);
const totalCategories = sortedCategories.length;

// Breadcrumb items
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'Emojis', href: '/freedevtools/emojis/' },
  { label: 'Discord Emojis' }
];

// SEO data
const seoTitle = currentPage === 1
  ? "Discord Emojis Reference - Browse & Copy Discord Emojis | Online Free DevTools by Hexmos"
  : `Discord Emojis Reference - Page ${currentPage} | Online Free DevTools by Hexmos`;

const seoDescription = currentPage === 1
  ? "Browse Discord-styled emojis by category. Copy instantly, view Discord-style artwork, and compare them with other platform vendors."
  : `Browse page ${currentPage} of the Discord emoji reference with instant copy and full category browsing.`;

const canonical = currentPage === 1
  ? "https://hexmos.com/freedevtools/emojis/discord-emojis/"
  : `https://hexmos.com/freedevtools/emojis/discord-emojis/${currentPage}/`;

const mainKeywords = [
  'discord emojis',
  'discord emoji list',
  'discord emoji reference',
  'emoji categories',
  'copy emojis',
  'emoji meanings',
  'emoji shortcodes',
  'emoji library',
  'emoji copy'
];

// Category icons ‚Äî using Discord vendor images
export const categoryIconMap: Record<string, string> = {
  "Smileys & Emotion": fetchImageFromDB("slightly-smiling-face", "slightly-smiling-face_Discord.png")!,
  "People & Body": fetchImageFromDB("bust-in-silhouette", "bust-in-silhouette_Discord.png")!,
  "Animals & Nature": fetchImageFromDB("dog-face", "dog-face_Discord.png")!,
  "Food & Drink": fetchImageFromDB("red-apple", "red-apple_Discord.png")!,
  "Travel & Places": fetchImageFromDB("airplane", "airplane_Discord.png")!,
  "Activities": fetchImageFromDB("soccer-ball", "soccer-ball_Discord.png")!,
  "Objects": fetchImageFromDB("mobile-phone", "mobile-phone_Discord.png")!,
  "Symbols": fetchImageFromDB("check-mark-button", "check-mark-button_Discord.png")!,
  "Flags": fetchImageFromDB("chequered-flag", "chequered-flag_Discord.png")!,
  "Other": fetchImageFromDB("question-mark", "question-mark_Discord.png")!,
};
---

<BaseLayout 
  name="Discord Emojis"
  path={currentPage === 1 ? "/freedevtools/emojis/discord-emojis/" : `/freedevtools/emojis/discord-emojis/${currentPage}/`}
  title={seoTitle}
  description={seoDescription}
  canonical={canonical}
  themeColor="#5865F2"
  showHeader={true}
  totalItems={totalCategories}
  itemsPerPage={itemsPerPage}
  currentPage={currentPage}
  category="Emojis"
  partOf="Free DevTools"
  partOfUrl="https://hexmos.com/freedevtools/"
  keywords={mainKeywords}
  features={["Discord-style designs", "Browse by category", "Copy instantly", "Compare with Unicode", "Free access"]}
  emojiCategory="Discord Emojis"
>
  <div class="max-w-6xl mx-auto px-2 md:px-6">
    <div class="mb-16 mt-[74px]">
      <AdBanner />
    </div>

    <div class="mb-8">
      <!-- Breadcrumbs -->
      <nav class="text-sm text-slate-600 dark:text-slate-400 mb-4">
        {breadcrumbItems.map((item, idx) => (
          <>
            {idx > 0 && <span class="mx-2">/</span>}
            {item.href ? (
              <a href={item.href} class="hover:text-blue-600 dark:hover:text-blue-400">{item.label}</a>
            ) : (
              <span>{item.label}</span>
            )}
          </>
        ))}
      </nav>

      <h1 class="text-3xl font-bold text-slate-900 dark:text-slate-100 mb-4">
        Discord Emojis üéÆ
      </h1>

      <p class="text-lg text-slate-600 dark:text-slate-400 mb-6">
        Discord's emoji style is clean, bold, and optimized for chat usage. 
        These emojis often appear sharper and more expressive, making them perfect for fast-paced conversations.
        Explore the full Discord emoji collection here ‚Äî sorted neatly by category with instant copy functionality.
      </p>
    </div>

    <!-- Emoji Categories Grid -->
    <div id="emoji-categories" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {paginatedCategories.map((category) => (
        <div class="category-card bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-4 transition-all duration-300 ease-in-out shadow-sm hover:-translate-y-1 hover:shadow-xl">
          <div class="flex items-center mb-4">
            <div class="w-10 h-10 flex items-center justify-center mr-3">
              <img 
                src={categoryIconMap[category] || "/freedevtools/emoji_data/question-mark/discord-emojis/question-mark_Discord.png"} 
                alt={category + " icon"} 
                class="h-10 w-10" 
              />
            </div>
            <a 
              href={`/freedevtools/emojis/discord-emojis/${category.toLowerCase().replace(/[^a-z0-9]+/g, '-')}/`}
              class="text-xl font-semibold text-black dark:text-neon-light capitalize hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors"
            >
              {category}
            </a>
          </div>
          <p class="text-sm text-slate-800 dark:text-slate-400 mb-2">
            {emojisByCategory[category].length} emojis available
          </p>
        </div>
      ))}
    </div>

    <!-- Navigation -->
    <div class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700">
      <div class="flex flex-wrap gap-4">
        <a 
          href="/freedevtools/emojis/" 
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 transition-colors"
        >
          ‚Üê Back to Emojis
        </a>
      </div>
    </div>
  </div>
</BaseLayout>
