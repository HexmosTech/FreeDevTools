---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Pagination from '../../components/PaginationComponent.astro';
import CreditsButton from '../../components/buttons/CreditsButton';
import ToolContainer from '../../components/tool/ToolContainer';
import ToolHead from '../../components/tool/ToolHead';
import AdBanner from '../../components/banner/AdBanner.astro';
import EachEmojiPage from './EachEmojiPage.astro';
import { getEmojiCategories, getEmojiBySlug, getEmojiImages, getCategoriesWithPreviewEmojis, getEmojisByCategoryPaginated } from 'db/emojis/emojis-utils';
import { apple_vendor_excluded_emojis, discord_vendor_excluded_emojis } from '@/lib/emojis-consts';

export const prerender = false;

const { category: categorySlug } = Astro.params;

// Early return if no category param
if (!categorySlug) {
  return new Response(null, { status: 404 });
}

// Get all categories to validate
const allCategories = await getEmojiCategories();
const categorySlugs = allCategories.map(cat => cat.toLowerCase().replace(/[^a-z0-9]+/g, '-'));

let emojiData: any = null;
let categoryData: any = null;
let paginationData: any = null;

// Check if category is numeric (pagination route)
// Handle pagination directly here to avoid route collision
if (/^\d+$/.test(categorySlug)) {
  // This is actually a pagination route - handle it directly
  const currentPage = parseInt(categorySlug, 10);
  const categories = await getEmojiCategories();
  const itemsPerPage = 30;
  
  // Use optimized query to get paginated categories with preview emojis
  const categoriesWithPreview = await getCategoriesWithPreviewEmojis(5);
  const sortedCategories = categoriesWithPreview
    .map((c) => c.category)
    .filter((cat) => cat !== 'Other')
    .sort();
  
  const totalPages = Math.ceil(sortedCategories.length / itemsPerPage);
  const startIndex = (currentPage - 1) * itemsPerPage;
  const endIndex = startIndex + itemsPerPage;
  const paginatedCategories = sortedCategories.slice(startIndex, endIndex);
  
  // Build emojisByCategory from paginated categories
  const emojisByCategory: Record<string, any[]> = {};
  const categoryCounts: Record<string, number> = {};
  for (const catWithPreview of categoriesWithPreview) {
    if (paginatedCategories.includes(catWithPreview.category)) {
      emojisByCategory[catWithPreview.category] = catWithPreview.previewEmojis.map(
        (e) => ({
          code: e.code,
          slug: e.slug,
          title: e.title,
        })
      );
      categoryCounts[catWithPreview.category] = catWithPreview.count;
    }
  }
  
  const categoryIconMap: Record<string, string> = {
    'Smileys & Emotion': 'üòÄ',
    'People & Body': 'üë§',
    'Animals & Nature': 'üê∂',
    'Food & Drink': 'üçé',
    'Travel & Places': '‚úàÔ∏è',
    Activities: '‚öΩ',
    Objects: 'üì±',
    Symbols: '‚ù§Ô∏è',
    Flags: 'üèÅ',
    Other: '‚ùì',
  };
  
  const breadcrumbItems = [
    { label: 'Free DevTools', href: '/freedevtools/' },
    { label: 'Emojis', href: '/freedevtools/emojis/' },
  ];
  
  paginationData = {
    currentPage,
    totalPages,
    sortedCategories,
    paginatedCategories,
    emojisByCategory,
    categoryCounts,
    categoryIconMap,
    breadcrumbItems,
  };
}

// Check if this is actually an emoji slug (not a category)
// Since [category].astro matches first, we need to handle emoji slugs here
// This is a workaround for route priority not working as expected
// Only check if not already handled as pagination
if (!paginationData) {
  const emoji = await getEmojiBySlug(categorySlug);
  if (emoji && !categorySlugs.includes(categorySlug)) {
  // This is an emoji slug, not a category - handle it here
  const images = await getEmojiImages(categorySlug);
  
  const cleanDescription = (text?: string) => {
    if (!text) return '';
    return text
      .replace(/<[^>]*>/g, '')
      .replace(/&nbsp;/g, ' ')
      .replace(/&amp;/g, '&')
      .replace(/&lt;/g, '<')
      .replace(/&gt;/g, '>')
      .replace(/&quot;/g, '"')
      .replace(/&#39;/g, "'")
      .replace(/[?]{2,}/g, '')
      .trim();
  };

  const categoryName = (emoji.category || 'Other') as string;
  const categorySlugForBreadcrumb = categoryName.toLowerCase().replace(/[^a-z0-9]+/g, '-');
  const cleanedDescription = cleanDescription(emoji.description);
  const seoDescription = cleanedDescription || 
    `Learn about the ${emoji.title || emoji.slug} emoji ${emoji.code || ''}. Find meanings, shortcodes, and usage information.`;

  const breadcrumbItems = [
    { label: 'Free DevTools', href: '/freedevtools/' },
    { label: 'Emojis', href: '/freedevtools/emojis/' },
    { label: categoryName, href: `/freedevtools/emojis/${categorySlugForBreadcrumb}/` },
    { label: emoji.title || emoji.slug },
  ];

  emojiData = {
    emoji,
    images,
    categoryName,
    categorySlugForBreadcrumb,
    breadcrumbItems,
    seoDescription,
  };
  } else {
    // Validate category exists
    if (!categorySlugs.includes(categorySlug)) {
      return new Response(null, { status: 404 });
    }

    // Find the actual category name from the slug
    const categoryName = allCategories.find(
      cat => cat.toLowerCase().replace(/[^a-z0-9]+/g, '-') === categorySlug
    ) || categorySlug.replace(/-/g, ' ').replace(/\b\w/g, (l: string) => l.toUpperCase());

    // SEO metadata and descriptions for categories
    const categorySeo: Record<string, { title: string; description: string; keywords: string[] } > = {
    'Activities': {
      title: 'Activities Emojis - Sports, Events, and Hobbies | Online Free DevTools by Hexmos',
      description: 'Explore activities emojis covering sports, games, celebrations, and hobbies. Copy emoji, view meanings, and find shortcodes instantly.',
      keywords: ['activities emojis', 'sports emojis', 'games emojis', 'celebration emojis', 'hobby emojis', 'copy emoji', 'emoji meanings']
    },
    'Animals & Nature': {
      title: 'Animals & Nature Emojis - Wildlife, Plants, and Weather | Online Free DevTools by Hexmos',
      description: 'Discover animals and nature emojis including wildlife, pets, plants, and weather symbols. Copy emoji, view meanings, and find shortcodes instantly.',
      keywords: ['animals emojis', 'nature emojis', 'wildlife emojis', 'plant emojis', 'weather emojis', 'copy emoji', 'emoji meanings']
    },
    'Food & Drink': {
      title: 'Food & Drink Emojis - Meals, Beverages, and Snacks | Online Free DevTools by Hexmos',
      description: 'Browse food and drink emojis including meals, beverages, fruits, vegetables, and snacks. Copy emoji, view meanings, and find shortcodes instantly.',
      keywords: ['food emojis', 'drink emojis', 'meal emojis', 'beverage emojis', 'fruit emojis', 'copy emoji', 'emoji meanings']
    },
    'Objects': {
      title: 'Objects Emojis - Technology, Tools, and Items | Online Free DevTools by Hexmos',
      description: 'Explore object emojis including technology, tools, clothing, and everyday items. Copy emoji, view meanings, and find shortcodes instantly.',
      keywords: ['object emojis', 'technology emojis', 'tool emojis', 'clothing emojis', 'item emojis', 'copy emoji', 'emoji meanings']
    },
    'People & Body': {
      title: 'People & Body Emojis - Faces, Gestures, and Body Parts | Online Free DevTools by Hexmos',
      description: 'Discover people and body emojis including faces, gestures, body parts, and family members. Copy emoji, view meanings, and find shortcodes instantly.',
      keywords: ['people emojis', 'body emojis', 'face emojis', 'gesture emojis', 'family emojis', 'copy emoji', 'emoji meanings']
    },
    'Smileys & Emotion': {
      title: 'Smileys & Emotion Emojis - Faces, Feelings, and Expressions | Online Free DevTools by Hexmos',
      description: 'Browse smileys and emotion emojis including faces, feelings, and expressions. Copy emoji, view meanings, and find shortcodes instantly.',
      keywords: ['smiley emojis', 'emotion emojis', 'face emojis', 'feeling emojis', 'expression emojis', 'copy emoji', 'emoji meanings']
    },
    'Symbols': {
      title: 'Symbols Emojis - Signs, Shapes, and Icons | Online Free DevTools by Hexmos',
      description: 'Explore symbol emojis including signs, shapes, icons, and special characters. Copy emoji, view meanings, and find shortcodes instantly.',
      keywords: ['symbol emojis', 'sign emojis', 'shape emojis', 'icon emojis', 'character emojis', 'copy emoji', 'emoji meanings']
    },
    'Travel & Places': {
      title: 'Travel & Places Emojis - Destinations, Transportation, and Locations | Online Free DevTools by Hexmos',
      description: 'Discover travel and places emojis including destinations, transportation, and location symbols. Copy emoji, view meanings, and find shortcodes instantly.',
      keywords: ['travel emojis', 'places emojis', 'destination emojis', 'transportation emojis', 'location emojis', 'copy emoji', 'emoji meanings']
    },
    'Flags': {
      title: 'Flags Emojis - Country and Regional Flags | Online Free DevTools by Hexmos',
      description: 'Browse flag emojis including country flags, regional flags, and special flags. Copy emoji, view meanings, and find shortcodes instantly.',
      keywords: ['flag emojis', 'country emojis', 'regional emojis', 'national emojis', 'copy emoji', 'emoji meanings']
    }
    };

    const seoData = categorySeo[categoryName] || {
      title: `${categoryName} Emojis | Online Free DevTools by Hexmos`,
      description: `Explore ${categoryName.toLowerCase()} emojis. Copy emoji, view meanings, and find shortcodes instantly.`,
      keywords: [`${categoryName.toLowerCase()} emojis`, 'copy emoji', 'emoji meanings', 'emoji shortcodes']
    };

    // Get emojis for this category (paginated for page 1)
    const itemsPerPage = 36;
    const currentPage = 1;
    const { emojis: paginatedEmojis, total: totalEmojis } = await getEmojisByCategoryPaginated(categoryName, currentPage, itemsPerPage);
    const totalPages = Math.ceil(totalEmojis / itemsPerPage);

    // Breadcrumb items
    const breadcrumbItems = [
      { label: 'Free DevTools', href: '/freedevtools/' },
      { label: 'Emojis', href: '/freedevtools/emojis/' },
      { label: categoryName, href: `/freedevtools/emojis/${categorySlug}/` }
    ];

    categoryData = {
      categoryName,
      categorySlug,
      seoData,
      totalEmojis,
      itemsPerPage,
      currentPage,
      totalPages,
      paginatedEmojis,
      breadcrumbItems,
    };
  }
}
---

{paginationData ? (
  <BaseLayout
    name="Emojis"
    path="/emojis/"
    title="Emoji Reference - Browse & Copy Emojis | Online Free DevTools by Hexmos"
    description="Explore the emoji reference by category. Find meanings, names, and shortcodes. Browse thousands of emojis and copy instantly. Free, fast, no signup."
    canonical="https://hexmos.com/freedevtools/emojis/"
    keywords={[
      'emoji reference',
      'emoji categories',
      'copy emojis',
      'emoji meanings',
      'emoji shortcodes',
    ]}
    showHeader={true}
    totalItems={paginationData.sortedCategories.length}
    features={[
      'Browse by category',
      'Copy instantly',
      'Find meanings',
      'No signup required',
      'Free access',
    ]}
    emojiCategory="Reference"
  >
    <ToolContainer>
      <div class="mb-16 mt-[74px]">
        <AdBanner />
      </div>
      <ToolHead
        name="Emojis"
        description="Comprehensive emoji reference with categories, meanings, and copy functionality. Browse categories like Smileys & Emotion, People & Body, Animals & Nature, Food & Drink, Travel & Places, Activities, Objects, Symbols, and Flags."
        breadcrumbItems={paginationData.breadcrumbItems}
      />

      <div id="pagination-info" class="text-center mb-8">
        <div class="grid grid-cols-2 gap-6 mt-8">
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-600">
              {paginationData.sortedCategories.length}
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Categories</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-green-600">
              {paginationData.emojis.length.toLocaleString()}
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Emojis</div>
          </div>
        </div>
      </div>

      <div
        id="emoji-categories"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 md:gap-4 lg:gap-8"
      >
        {
          paginationData.paginatedCategories.map((category) => (
            <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-900 rounded-xl p-4 md:p-4 lg:p-8 transition-all duration-300 ease-in-out shadow-sm hover:-translate-y-1 hover:shadow-xl hover:border-border">
              <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 dark:from-blue-600 dark:to-blue-700 rounded-lg flex items-center justify-center mr-3 border border-slate-200 dark:border-slate-700 shadow-sm">
                  <span class="text-white font-bold text-lg select-none">
                    {paginationData.categoryIconMap[category] || '‚ùì'}
                  </span>
                </div>
                <a
                  href={`/freedevtools/emojis/${category.toLowerCase().replace(/[^a-z0-9]+/g, '-')}/`}
                  class="text-xl font-semibold text-black dark:text-neon-light capitalize hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
                >
                  {category.replace('-', ' ')}
                </a>
              </div>

              <p class="text-sm text-slate-800 dark:text-slate-400 mb-4 m-0">
                {(paginationData.categoryCounts?.[category] || paginationData.emojisByCategory[category].length).toLocaleString()} emojis available
              </p>

              <div class="space-y-2">
                {paginationData.emojisByCategory[category].slice(0, 5).map((emoji) => {
                  const emojiName =
                    emoji.title || emoji.slug;
                  const truncatedName =
                    emojiName.length > 27
                      ? emojiName.substring(0, 27) + '...'
                      : emojiName;
                  return (
                    <a
                      href={`/freedevtools/emojis/${emoji.slug}/`}
                      class="block text-sm text-blue-600 dark:text-blue-400 hover:text-black dark:hover:text-white hover:font-bold"
                    >
                      {emoji.code || emoji.emoji} {truncatedName}
                    </a>
                  );
                })}
                {(paginationData.categoryCounts?.[category] || paginationData.emojisByCategory[category].length) > 5 && (
                  <p class="text-xs text-slate-500 dark:text-slate-500">
                    +{((paginationData.categoryCounts?.[category] || paginationData.emojisByCategory[category].length) - 5).toLocaleString()} more items
                  </p>
                )}
              </div>

              <div class="mt-4 pt-4 border-t border-slate-200 dark:border-slate-900">
                <a
                  href={`/freedevtools/emojis/${category.toLowerCase().replace(/[^a-z0-9]+/g, '-')}/`}
                  class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"
                >
                  View all {category} emojis ‚Üí
                </a>
              </div>
            </div>
          ))
        }
      </div>

      <Pagination
        currentPage={paginationData.currentPage}
        totalPages={paginationData.totalPages}
        baseUrl="/freedevtools/emojis/"
      />

      <div
        class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700"
      >
        <div class="flex flex-wrap gap-4">
          <a
            href="/freedevtools/"
            class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"
          >
            ‚Üê Back to Free DevTools
          </a>
          <CreditsButton href="/freedevtools/emojis/credits/" />
        </div>
      </div>
    </ToolContainer>
  </BaseLayout>
) : emojiData ? (
  <BaseLayout
    name="Emojis"
    path="/emojis/"
    title={`${emojiData.emoji.code || ''} ${emojiData.emoji.title || emojiData.emoji.slug} - Emoji Reference | Online Free DevTools by Hexmos`}
    description={emojiData.seoDescription}
    canonical={`https://hexmos.com/freedevtools/emojis/${emojiData.emoji.slug}/`}
    showHeader={true}
    keywords={emojiData.emoji.keywords || []}
  >
    <ToolContainer>
      <div class="mb-16 mt-[74px]">
        <AdBanner />
      </div>
      <ToolHead
        name={`${emojiData.emoji.code || ''} ${emojiData.emoji.title || emojiData.emoji.slug}`}
        description={emojiData.seoDescription}
        breadcrumbItems={emojiData.breadcrumbItems}
      />

      <EachEmojiPage emoji={emojiData.emoji} images={emojiData.images} />

      <div class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700">
        <div class="flex flex-wrap gap-4">
          <a
            href="/freedevtools/emojis/"
            class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"
          >
            ‚Üê Back to Emojis
          </a>
          {emojiData.emoji.category ? (
            <a
              href={`/freedevtools/emojis/${emojiData.emoji.category.toLowerCase().replace(/[^a-z0-9]+/g, '-')}/`}
              class="inline-flex items-center px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-400 bg-slate-50 dark:bg-slate-800 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
            >
              View{' '}
              {emojiData.emoji.category
                .replace(/-/g, ' ')
                .replace(/\b\w/g, (l) => l.toUpperCase())}{' '}
              Category
            </a>
          ) : null}
          {emojiData.emoji.apple_vendor_description &&
            !apple_vendor_excluded_emojis.includes(emojiData.emoji.slug) ? (
            <a
              href={`/freedevtools/emojis/apple-emojis/${emojiData.emoji.slug}/`}
              class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-800 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
            >
              üçé <span>View Apple Version</span>
            </a>
          ) : null}
          {emojiData.emoji.discord_vendor_description &&
            !discord_vendor_excluded_emojis.includes(emojiData.emoji.slug) ? (
            <a
              href={`/freedevtools/emojis/discord-emojis/${emojiData.emoji.slug}/`}
              class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-800 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
            >
              üéÆ <span>View Discord Version</span> 
            </a>
          ) : null}
          <CreditsButton href="/freedevtools/emojis/credits/" />
        </div>
      </div>
    </ToolContainer>
  </BaseLayout>
) : categoryData ? (
  <BaseLayout 
    name={categoryData.categoryName}
    path={`/emojis/${categoryData.categorySlug}/`}
    title={categoryData.seoData.title}
    description={categoryData.seoData.description}
    canonical={`https://hexmos.com/freedevtools/emojis/${categoryData.categorySlug}/`}
    keywords={categoryData.seoData.keywords}
    showHeader={true}
    totalItems={categoryData.totalEmojis}
    features={["Copy instantly", "View meanings", "Find shortcodes", "No signup required", "Free access"]}
    emojiCategory={categoryData.categoryName}
  >
    <ToolContainer>
      <div class="mb-16 mt-[74px]">
        <AdBanner />
      </div>
      <ToolHead
        name={`${categoryData.categoryName} Emojis`}
        description={categoryData.seoData.description}
        breadcrumbItems={categoryData.breadcrumbItems}
      />

      <!-- Overview Stats -->
      <div id="pagination-info" class="text-center mb-8">
        <div class="grid grid-cols-2 gap-6 mt-8">
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-600">{categoryData.totalEmojis.toLocaleString()}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Emojis</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-green-600">{categoryData.totalPages}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Pages</div>
          </div>
        </div>
      </div>
      
      <!-- Pagination Info -->
      <div class="bg-slate-50 dark:bg-slate-800 rounded-lg p-4 mb-6 mt-8">
        <div class="text-sm text-slate-600 dark:text-slate-400 text-center">
          Showing {categoryData.paginatedEmojis.length} of {categoryData.totalEmojis} emojis (Page {categoryData.currentPage} of {categoryData.totalPages})
        </div>
      </div>

      <!-- Emojis Grid -->
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4 mb-8">
        {categoryData.paginatedEmojis.map((emoji) => {
          const emojiChar = emoji.code || '';
          const emojiTitle = emoji.title || emoji.slug;

          // Count visible components (graphemes) + joining characters (ZWJ)
          const graphemeCount = [...emojiChar].length;
          const zwjCount = (emojiChar.match(/\u200d/g) || []).length;

          // Complexity heuristic
          const complexity = graphemeCount + zwjCount * 2;

          // Adjust font size dynamically
          let emojiSizeClass = 'text-5xl';
          if (complexity > 10) emojiSizeClass = 'text-xl'; // very complex (family, kiss variants)
          else if (complexity > 6) emojiSizeClass = 'text-3xl'; // multi-skin or gendered sequences
          else if (complexity > 3) emojiSizeClass = 'text-4xl'; // moderately complex (2‚Äì3 parts)

          return (
            <a
              href={`/freedevtools/emojis/${emoji.slug}/`}
              class="emoji-card bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg p-4 text-center hover:shadow-lg transition-all duration-200 cursor-pointer block"
              data-emoji={emojiChar}
              data-title={emojiTitle}
            >
              <div
                class={`${emojiSizeClass} mb-2 leading-tight select-none`}
                style={{
                  lineHeight: '1.1',
                  display: 'inline-block',
                  transform: 'translateY(2px)', // visually center
                }}
              >
                {emojiChar}
              </div>
              <div
                class="text-xs text-slate-600 dark:text-slate-400 truncate"
                title={emojiTitle}
              >
                {emojiTitle}
              </div>
            </a>
          );
        })}
      </div>
      <!-- Pagination -->
      <Pagination 
        currentPage={categoryData.currentPage}
        totalPages={categoryData.totalPages}
        baseUrl={`/freedevtools/emojis/${categoryData.categorySlug}/`}
      />
      
      <!-- Credits Section -->
      <div class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700">
        <div class="flex flex-wrap gap-4">
          <a 
            href="/freedevtools/emojis/" 
            class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"
          >
            ‚Üê  Back to Emojis
          </a>
          <CreditsButton href="/freedevtools/emojis/credits/" />
        </div>
      </div>
    </ToolContainer>
  </BaseLayout>
) : null}

<script>
  // Scroll to pagination info only if hash is present in URL
  if (window.location.hash === '#pagination-info') {
    const paginationInfo = document.getElementById('pagination-info');
    if (paginationInfo) {
      paginationInfo.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }

  // Copy emoji functionality
  document.addEventListener('DOMContentLoaded', function() {
    const emojiCards = document.querySelectorAll('.emoji-card');
    
    emojiCards.forEach((card: any) => {
      card.addEventListener('click', function(this: any, event: any) {
        // Check if Ctrl/Cmd key is held for copy functionality
        if (event.ctrlKey || event.metaKey) {
          event.preventDefault(); // Prevent navigation
          
          const emoji = this.dataset.emoji;          
          // Copy to clipboard
          navigator.clipboard.writeText(emoji).then(() => {
            // Show feedback
            const originalText = this.querySelector('.text-xs').textContent;
            this.querySelector('.text-xs').textContent = 'Copied!';
            this.style.backgroundColor = '#10b981';
            this.style.color = 'white';
            
            setTimeout(() => {
              this.querySelector('.text-xs').textContent = originalText;
              this.style.backgroundColor = '';
              this.style.color = '';
            }, 1000);
          }).catch((err: any) => {
            console.error('Failed to copy emoji:', err);
          });
        }
        // If no modifier key, allow normal link navigation
      });
    });
  });
</script>
