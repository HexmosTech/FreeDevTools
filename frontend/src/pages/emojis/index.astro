---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getAllEmojis, getEmojiCategories } from '../../lib/emojis';
import EmojiPage from './_EmojiPage.astro';

const emojis = await getAllEmojis();

// Metadata-based categories
const categories = getEmojiCategories();
const emojisByCategory: Record<string, any[]> = {};
for (const cat of categories) {
  emojisByCategory[cat] = emojis.filter((e) => (e.fluentui_metadata?.group || e.emoji_net_data?.category || (e as any).given_category || 'Other') === cat);
}

// Sort categories and emojis within categories
const sortedCategories = Object.keys(emojisByCategory).sort();
for (const category of sortedCategories) {
  emojisByCategory[category].sort((a, b) => {
    const titleA = a.title || a.fluentui_metadata?.cldr || a.slug || '';
    const titleB = b.title || b.fluentui_metadata?.cldr || b.slug || '';
    return titleA.localeCompare(titleB);
  });
}

// Pagination logic for page 1
const itemsPerPage = 30;
const currentPage = 1;
const totalPages = Math.ceil(sortedCategories.length / itemsPerPage);
const startIndex = (currentPage - 1) * itemsPerPage;
const endIndex = startIndex + itemsPerPage;
const paginatedCategories = sortedCategories.slice(startIndex, endIndex);
const totalCategories = sortedCategories.length;

// Category icons mapping
const categoryIconMap: Record<string, string> = {
  "Smileys & Emotion": "üòÄ",
  "People & Body": "üë§",
  "Animals & Nature": "üê∂",
  "Food & Drink": "üçé",
  "Travel & Places": "‚úàÔ∏è",
  "Activities": "‚öΩ",
  "Objects": "üì±",
  "Symbols": "‚ù§Ô∏è",
  "Flags": "üèÅ",
  "Other": "‚ùì"
};

// Breadcrumb items
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'Emojis' }
];

// SEO data
const seoTitle = currentPage === 1 
  ? "Emoji Reference - Browse & Copy Emojis | Online Free DevTools by Hexmos"
  : `Emoji Reference - Page ${currentPage} | Online Free DevTools by Hexmos`;

const seoDescription = currentPage === 1
  ? "Explore the emoji reference by category. Find meanings, names, and shortcodes. Browse thousands of emojis and copy instantly. Free, fast, no signup."
  : `Browse page ${currentPage} of our emoji reference. Find meanings, names, and shortcodes. Copy emojis instantly.`;

const canonical = currentPage === 1
  ? "https://hexmos.com/freedevtools/emojis/"
  : `https://hexmos.com/freedevtools/emojis/${currentPage}/`;

// Enhanced keywords for main page
const mainKeywords = [
  'emoji reference',
  'emoji categories',
  'copy emojis',
  'emoji meanings',
  'emoji shortcodes',
  'emoji library',
  'free emojis',
  'emoji search',
  'emoji copy',
  'unicode emojis'
];
---

<BaseLayout 
  name="Emojis"
  path={currentPage === 1 ? "/freedevtools/emojis/" : `/freedevtools/emojis/${currentPage}/`}
  title={seoTitle}
  description={seoDescription}
  canonical={canonical}
  
  
  showHeader={true}
  totalItems={totalCategories}
  itemsPerPage={itemsPerPage}
  currentPage={currentPage}
  category="Emojis"
  partOf="Free DevTools"
  partOfUrl="https://hexmos.com/freedevtools/"
  keywords={mainKeywords}
  features={["Browse by category", "Copy instantly", "Find meanings", "No signup required", "Free access"]}
  emojiCategory="Reference"
>
  <EmojiPage 
    categories={paginatedCategories}
    emojisByCategory={emojisByCategory}
    categoryIconMap={categoryIconMap}
    currentPage={currentPage}
    totalPages={totalPages}
    totalCategories={totalCategories}
    totalEmojis={emojis.length}
    breadcrumbItems={breadcrumbItems}
  />
</BaseLayout>