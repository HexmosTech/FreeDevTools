---
import {
  getCategoriesWithPreviewEmojis,
  getEmojiCategories,
  getTotalEmojis,
  type EmojiData,
} from 'db/emojis/emojis-utils';
import BaseLayout from '../../layouts/BaseLayout.astro';
import EmojiPage from './_EmojiPage.astro';

// Get categories with preview emojis in a single optimized query
const categoriesWithPreview = getCategoriesWithPreviewEmojis(5);
const categories = getEmojiCategories();

// Transform to match expected format
const emojisByCategory: Record<string, EmojiData[]> = {};
const categoryCounts: Record<string, number> = {};
for (const catWithPreview of categoriesWithPreview) {
  emojisByCategory[catWithPreview.category] = catWithPreview.previewEmojis.map(
    (e) =>
      ({
        code: e.code,
        slug: e.slug,
        title: e.title,
      }) as EmojiData
  );
  categoryCounts[catWithPreview.category] = catWithPreview.count;
}

// Sort categories alphabetically (already sorted from query, but ensure)
const sortedCategories = categoriesWithPreview
  .map((c) => c.category)
  .filter((cat) => cat !== 'Other')
  .sort();

// Pagination logic for page 1
const itemsPerPage = 30;
const currentPage = 1;
const totalPages = Math.ceil(sortedCategories.length / itemsPerPage);
const startIndex = (currentPage - 1) * itemsPerPage;
const endIndex = startIndex + itemsPerPage;
const paginatedCategories = sortedCategories.slice(startIndex, endIndex);
const totalCategories = sortedCategories.length;

// Breadcrumb items
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'Emojis' },
];

// SEO data
const seoTitle =
  currentPage === 1
    ? 'Emoji Reference - Browse & Copy Emojis | Online Free DevTools by Hexmos'
    : `Emoji Reference - Page ${currentPage} | Online Free DevTools by Hexmos`;

const seoDescription =
  currentPage === 1
    ? 'Explore the emoji reference by category. Find meanings, names, and shortcodes. Browse thousands of emojis and copy instantly. Free, fast, no signup.'
    : `Browse page ${currentPage} of our emoji reference. Find meanings, names, and shortcodes. Copy emojis instantly.`;

const canonical =
  currentPage === 1
    ? 'https://hexmos.com/freedevtools/emojis/'
    : `https://hexmos.com/freedevtools/emojis/${currentPage}/`;

// Enhanced keywords for main page
const mainKeywords = [
  'emoji reference',
  'emoji categories',
  'copy emojis',
  'emoji meanings',
  'emoji shortcodes',
  'emoji library',
  'free emojis',
  'emoji search',
  'emoji copy',
  'unicode emojis',
];
---

<BaseLayout
  name="Emojis"
  path={currentPage === 1
    ? '/freedevtools/emojis/'
    : `/freedevtools/emojis/${currentPage}/`}
  title={seoTitle}
  description={seoDescription}
  canonical={canonical}
  showHeader={true}
  totalItems={totalCategories}
  itemsPerPage={itemsPerPage}
  currentPage={currentPage}
  category="Emojis"
  partOf="Free DevTools"
  partOfUrl="https://hexmos.com/freedevtools/"
  keywords={mainKeywords}
  features={[
    'Browse by category',
    'Copy instantly',
    'Find meanings',
    'No signup required',
    'Free access',
  ]}
  emojiCategory="Reference"
>
  <EmojiPage
    categories={paginatedCategories}
    emojisByCategory={emojisByCategory}
    categoryCounts={categoryCounts}
    currentPage={currentPage}
    totalPages={totalPages}
    totalCategories={totalCategories}
    totalEmojis={getTotalEmojis()}
    breadcrumbItems={breadcrumbItems}
  />
</BaseLayout>
