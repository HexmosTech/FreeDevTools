---
import {
  getIconByCategoryAndName,
} from 'db/svg_icons/svg-icons-utils';
import AdBanner from '../../../components/banner/AdBanner.astro';
import Banner from '../../../components/banner/BannerIndex.astro';
import CopyPngButton from '../../../components/buttons/CopyPngButton.tsx';
import CopySvgButton from '../../../components/buttons/CopySvgButton.tsx';
import CreditsButton from '../../../components/buttons/CreditsButton';
import DownloadPngButton from '../../../components/buttons/DownloadPngButton.tsx';
import DownloadSvgButton from '../../../components/buttons/DownloadSvgButton.tsx';
import SeeAlsoIndex from '../../../components/seealso/SeeAlsoIndex.astro';
import ToolContainer from '../../../components/tool/ToolContainer';
import ToolHead from '../../../components/tool/ToolHead';
import BaseLayout from '../../../layouts/BaseLayout.astro';

export const prerender = false;

const { category, icon } = Astro.params;

// Function to get random SEO content based on icon name
function getSvgIconSeoContent(iconName: string, categoryName: string) {
  // Simple hash function to deterministically select variant based on icon name
  function hashString(str: string): number {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = (hash << 5) - hash + char;
      hash = hash & hash; // Convert to 32-bit integer
    }
    return Math.abs(hash);
  }

  const hash = hashString(`${iconName}-${categoryName}`);
  const titleIndex = hash % 30;
  const descIndex = (hash >> 8) % 30; // Use different part of hash for description

  const titleVariants = [
    `Free ${iconName} SVG Icon Download | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – Free Vector Download | Online Free DevTools by Hexmos`,
    `Download ${iconName} SVG Icon for Free | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon | Free Scalable Vector Download | Online Free DevTools by Hexmos`,
    `Free ${iconName} SVG Icon - Download & Edit | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – High-Quality Free Download | Online Free DevTools by Hexmos`,
    `Get ${iconName} SVG Icon Free | Online Free DevTools by Hexmos`,
    `Free ${iconName} SVG Download – Scalable Vector | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – Instant Free Download | Online Free DevTools by Hexmos`,
    `Download Scalable ${iconName} SVG Icon | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – Free Editable Vector | Online Free DevTools by Hexmos`,
    `Free Editable ${iconName} SVG Icon Download | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – No Signup Free Download | Online Free DevTools by Hexmos`,
    `High-Quality ${iconName} SVG Icon – Free to Download | Online Free DevTools by Hexmos`,
    `Free ${iconName} SVG Icon – Quick Download | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – Download Free Vector Graphic | Online Free DevTools by Hexmos`,
    `Free ${iconName} SVG Icon – Scalable File Download | Online Free DevTools by Hexmos`,
    `Download ${iconName} SVG Icon – Free Vector Image | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – Vector Free Download | Online Free DevTools by Hexmos`,
    `Free ${iconName} SVG Graphic – Instant Download | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – Clean, Scalable, Free | Online Free DevTools by Hexmos`,
    `Download ${iconName} Scalable SVG Icon for Free | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – Free High-Quality Vector Download | Online Free DevTools by Hexmos`,
    `Free ${iconName} SVG Icon – No Login Required | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – Download Free Vector Asset | Online Free DevTools by Hexmos`,
    `Free ${iconName} SVG Icon – Professional Quality Download | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – Premium Free Download | Online Free DevTools by Hexmos`,
    `Download ${iconName} SVG Icon – Free Scalable Vector | Online Free DevTools by Hexmos`,
    `${iconName} SVG Icon – Free Download No Watermark | Online Free DevTools by Hexmos`,
    `Free ${iconName} SVG Icon – Unlimited Downloads | Online Free DevTools by Hexmos`,
  ];

  const descVariants = [
    `Download ${iconName} SVG icon for free. High-quality vector icon in ${categoryName} category. No registration required. Unlimited Downloads.`,
    `Get ${iconName} SVG icon instantly. Scalable vector graphic in ${categoryName} category. Free download, fully editable, no signup needed.`,
    `Free ${iconName} SVG icon download. Professional vector asset from ${categoryName} collection. Edit colors and sizes, unlimited use.`,
    `Download ${iconName} SVG icon - scalable vector graphic in ${categoryName} category. High-quality, editable, free instant download.`,
    `${iconName} SVG icon free download. Vector-based graphic in ${categoryName} category. Customizable, scalable, no registration required.`,
    `Free ${iconName} SVG download. High-quality scalable vector from the ${categoryName} category. No login or registration required.`,
    `Download the ${iconName} SVG icon for free. Clean, editable vector graphic in the ${categoryName} collection.`,
    `Instantly download ${iconName} SVG icon. Sharp, scalable vector asset in the ${categoryName} category. Always free.`,
    `High-quality ${iconName} SVG icon available for free download. Fully editable, ${categoryName} category.`,
    `Free to download ${iconName} SVG icon. Scalable vector image from our ${categoryName} icon library.`,
    `${iconName} SVG icon – free, editable, and easy to download. Part of the ${categoryName} category collection.`,
    `Download this ${iconName} SVG icon for free. Scalable vector image from the ${categoryName} set.`,
    `Free download: ${iconName} SVG icon. High-quality vector asset in ${categoryName} category with crisp edges.`,
    `Get a scalable ${iconName} SVG icon for free. Vector format, ${categoryName} library asset.`,
    `${iconName} SVG icon – free, high-quality vector graphic from the ${categoryName} category. No signup required.`,
    `Free ${iconName} SVG icon with infinite scalability. Part of our ${categoryName} category collection. Immediate download.`,
    `Download ${iconName} SVG icon instantly. Scalable vector asset in the ${categoryName} category with no registration needed.`,
    `High-resolution ${iconName} SVG icon available free. Editable ${categoryName} category vector for unlimited use.`,
    `Free ${iconName} SVG icon – high-quality vector image. From the ${categoryName} collection, available for instant download.`,
    `${iconName} SVG icon download. Clean, scalable vector graphic in ${categoryName}. No signup or login required.`,
    `Download free ${iconName} SVG icon. Sharp, editable vector asset from our ${categoryName} category.`,
    `Free ${iconName} SVG icon ready for download. Premium-quality vector graphic from the ${categoryName} collection.`,
    `Instant download: ${iconName} SVG icon. High-quality scalable vector from the ${categoryName} library.`,
    `${iconName} SVG icon – free, scalable, and editable. Download instantly from the ${categoryName} category.`,
    `Free ${iconName} SVG icon download. High-quality vector asset with infinite scalability from ${categoryName}.`,
    `Download high-quality ${iconName} SVG icon. Free vector graphic in the ${categoryName} icon set, no registration needed.`,
    `Get ${iconName} SVG icon free. Professional scalable vector image from ${categoryName} category. No watermark.`,
    `Free ${iconName} SVG icon – crisp, scalable vector asset. Download from ${categoryName} collection instantly.`,
    `${iconName} SVG icon available for free. Editable vector graphic in ${categoryName} category.`,
    `Download ${iconName} SVG icon free. Scalable vector image from the ${categoryName} icon library.`,
  ];

  return {
    title: titleVariants[titleIndex],
    description: descVariants[descIndex],
  };
}

// Get icon data from SQLite database
const iconRecord = getIconByCategoryAndName(category || '', icon || '');

if (!iconRecord) {
  return Astro.redirect('/freedevtools/svg_icons/');
}

// Prepare icon data for the component
const iconName = iconRecord.name.replace('.svg', '');
const iconData = {
  name: iconName,
  description: iconRecord.description || `Free ${iconName} icon`,
  category: category || '',
  tags: iconRecord.tags || [],
  author: 'Free DevTools by Hexmos',
  license: 'MIT',
  usecases: iconRecord.usecases || '',
  synonyms: iconRecord.synonyms || [],
  industry: iconRecord.industry || '',
  emotional_cues: iconRecord.emotional_cues || '',
  // SVG content will be fetched client-side if needed, empty for now since we use file paths
  svgContent: '',
  originalSvgContent: '',
};

// Breadcrumb data
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'SVG Icons', href: '/freedevtools/svg_icons/' },
  { label: category, href: `/freedevtools/svg_icons/${category}/` },
  { label: iconData.name },
];

// Generate SEO-friendly title and description (randomized)
const seoContent = getSvgIconSeoContent(iconData.name, iconData.category);
const title = iconRecord?.title || seoContent.title;
const description = iconRecord.description || seoContent.description;

// Generate better alt text for the icon
const altText =
  iconRecord.img_alt ||
  `${iconData.name} ${iconData.category} icon - Free SVG download`;

const canonical = `https://hexmos.com/freedevtools/svg_icons/${category}/${icon}/`;

// Static SVG dimensions for structured data
const svgDimensions = {
  width: 128,
  height: 128,
  viewBox: '0 0 128 128',
  aspectRatio: 1,
};

// Generate thumbnail URL (points to the actual SVG image in public folder)
// For brand-oauth icon, use PNG thumbnail for better Google search preview
const thumbnailUrl =
  icon === 'brand-oauth' && category === 'factory'
    ? `https://hexmos.com/freedevtools/emoji_data/abacus/abacus_3d.png`
    : `https://hexmos.com/freedevtools/svg_icons/${category}/${icon}.svg`;

// Set encoding format based on the same condition
const encodingFormat =
  icon === 'brand-oauth' && category === 'factory'
    ? 'image/png'
    : 'image/svg+xml';
---

<BaseLayout
  name={iconData.name}
  path={`/freedevtools/svg_icons/${category}/${icon}/`}
  title={title}
  description={description}
  canonical={canonical}
  imgWidth={svgDimensions.width}
  imgHeight={svgDimensions.height}
  thumbnailUrl={thumbnailUrl}
  ogImage={thumbnailUrl}
  twitterImage={thumbnailUrl}
  showHeader={true}
  encodingFormat={encodingFormat}
  partOf={`${iconData.category} Icons`}
  partOfUrl={`https://hexmos.com/freedevtools/svg_icons/${category}/`}
  keywords={iconData.tags}
  features={iconData.tags}
  category={iconData.category}
  iconName={iconData.name}
  iconCategory={iconData.category}
  iconTags={iconData.tags}
  author={iconData.author}
  license={iconData.license}
>
  <ToolContainer>
    <div id={`svg_icon-ad-banner-2-${category}`} class="mb-16 mt-[74px]">
      <AdBanner />
    </div>
    <ToolHead
      name={`${iconData.name} Vector SVG Icon`}
      description={description}
      breadcrumbItems={breadcrumbItems}
    />

    {/* Main Section: Icon + Buttons (left) + Metadata (right) */}
    <div
      id={`svg_icon-main-section-2-${category}`}
      class="grid grid-cols-1 lg:grid-cols-2 gap-10 mt-6"
    >
      {/* Left Block: Icon + Buttons */}
      <div
        id={`svg_icon-left-block-2-${category}`}
        class="flex flex-col items-start space-y-4"
      >
        {/* Icon Canvas (Wider + Taller) */}
        <div
          id={`svg_icon-canvas-2-${category}`}
          class="flex items-center justify-center bg-gray-100 rounded-xl p-4 shadow-md w-full max-w-md h-[400px]"
        >
          <picture>
            <source
              type="image/svg+xml"
              srcset={`/freedevtools/svg_icons/${category}/${icon}.svg`}
            />
            <img
              id={`svg_icon-image-2-${category}`}
              src={`/freedevtools/svg_icons/${category}/${icon}.svg`}
              alt={altText}
              width="280"
              height="280"
              style={{
                maxWidth: '100%',
                objectFit: 'contain',
                display: 'block',
              }}
              loading="eager"
              decoding="async"
              title={`${iconData.name} ${iconData.category} icon`}
              fetchpriority="high"
            />
          </picture>
        </div>

        {/* Copy & Download Buttons */}
        <div
          id={`svg_icon-buttons-2-${category}`}
          class="grid grid-cols-2 gap-2 w-full max-w-md"
        >
          <CopyPngButton iconData={iconData} client:load />
          <CopySvgButton iconData={iconData} client:load />
          <CopyPngButton iconData={iconData} client:load />
          <DownloadSvgButton iconData={iconData} client:load />
          <DownloadPngButton iconData={iconData} client:load />
        </div>
      </div>

      {/* Right Block: Metadata */}
      <div
        id={`svg_icon-metadata-2-${category}`}
        class="flex flex-col justify-start space-y-6"
      >
        <p id={`svg_icon-description-2-${category}`} class="leading-relaxed">
          {iconData.description}
        </p>

        {/* Sections */}
        {
          [
            { title: 'Practical Applications', content: iconData.usecases },
            {
              title: 'Alternative Terms',
              content: iconData.synonyms.length ? (
                <div class="flex flex-wrap gap-2">
                  {iconData.synonyms.map((synonym) => (
                    <span class="inline-block bg-gray-200 dark:bg-slate-700 text-sm text-slate-800 dark:text-slate-200 px-2 py-1 rounded-full select-none">
                      {synonym}
                    </span>
                  ))}
                </div>
              ) : (
                'No synonyms available.'
              ),
            },
            { title: 'Business Domains', content: iconData.industry },
            {
              title: 'Psychological Impact',
              content: iconData.emotional_cues,
            },
          ].map((section) => (
            <div id={`svg_icon-metadata-section-2-${category}`}>
              <h2 class="text-lg font-semibold mb-2 text-black dark:text-slate-300">
                {section.title}
              </h2>
              <p
                id={`svg_icon-metadata-section-content-2-${category}`}
                class="leading-relaxed"
              >
                {section.content}
              </p>
            </div>
          ))
        }

        {/* Tags */}
        <div>
          <h2
            id={`svg_icon-metadata-tags-title-2-${category}`}
            class="text-xl font-semibold mb-3 text-black dark:text-slate-300"
          >
            Tags
          </h2>
          {
            iconData.tags.length > 0 ? (
              <div
                id={`svg_icon-metadata-tags-list-2-${category}`}
                class="flex flex-wrap gap-2"
              >
                {iconData.tags.map((tag) => (
                  <p class="inline-block bg-blue-100 text-blue-800 rounded-full px-3 py-1 select-none cursor-default dark:bg-blue-800 dark:text-blue-100">
                    {tag}
                  </p>
                ))}
              </div>
            ) : (
              <p
                id={`svg_icon-metadata-tags-none-2-${category}`}
                class="leading-relaxed"
              >
                No tags available.
              </p>
            )
          }
        </div>
      </div>
    </div>

    <!-- See Also (above footer, like emoji pages) -->
    <SeeAlsoIndex />

    <div class="mb-6">
      <Banner type="text" />
    </div>

    {/* Footer / Navigation */}
    <div
      id={`svg_icon-footer-2-${category}`}
      class="mt-12 pt-6 border-t border-slate-200 dark:border-slate-700 flex flex-wrap gap-4"
    >
      <a
        href="/freedevtools/svg_icons/"
        class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"
      >
        ← Back to SVG Icons
      </a>
      <CreditsButton href="/freedevtools/svg_icons/credits/" />
    </div>
  </ToolContainer>

  <style>
    /* Simple SVG styling */
    .icon-display-container svg {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
    }
  </style>
</BaseLayout>
