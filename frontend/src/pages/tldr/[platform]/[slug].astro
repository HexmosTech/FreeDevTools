---
import AdBanner from '../../../components/banner/AdBanner.astro';
import Banner from '../../../components/banner/BannerIndex.astro';
import CreditsButton from '../../../components/buttons/CreditsButton';
import SeeAlsoIndex from '../../../components/seealso/SeeAlsoIndex.astro';
import ToolContainer from '../../../components/tool/ToolContainer';
import ToolHead from '../../../components/tool/ToolHead';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getTldrContent } from '../../../../db/tldrs/tldr-utils';
import TldrPlatform from '../_TldrPlatform.astro';

export const prerender = false;

const { platform, slug } = Astro.params;

if (!platform || !slug) {
  return new Response(null, { status: 404 });
}

const startRender = Date.now();
const result = await getTldrContent(platform, slug);
const duration = Date.now() - startRender;

if ((Astro.locals as any).timings) {
  (Astro.locals as any).timings['worker fetch'] = duration;
}

if (!result) {
  return Astro.redirect('/404');
}

const { type, data } = result;
---

{type === 'list' ? (
  <BaseLayout
    name={`${platform} Commands`}
    path={`/freedevtools/tldr/${platform}/${data.currentPage}/`}
    title={data.seoTitle}
    description={data.seoDescription}
    canonical={data.canonical}
    showHeader={true}
    totalItems={data.totalCommands}
    itemsPerPage={30}
    currentPage={data.currentPage}
    category={`${platform} Commands`}
    partOf="TLDR"
    partOfUrl="https://hexmos.com/freedevtools/tldr/"
    keywords={data.paginatedPlatformKeywords}
    features={[
      'Quick Reference',
      'Platform Specific',
      'Practical Examples',
      'No Registration',
    ]}
  >
    <TldrPlatform
      commands={data.currentPageCommands}
      currentPage={data.currentPage}
      totalPages={data.totalPages}
      totalCommands={data.totalCommands}
      platform={platform}
      breadcrumbItems={data.breadcrumbItems}
    />
  </BaseLayout>
) : type === 'command' ? (
  <BaseLayout
    name={data.title}
    path={`/tldr/${platform}/${slug}/`}
    title={`${data.title} - ${platform} Commands - TLDR | Online Free DevTools by Hexmos`}
    description={data.description}
    canonical={`https://hexmos.com/freedevtools/tldr/${platform}/${slug}/`}
    showHeader={true}
    keywords={data.page.keywords || ['free devtools', 'tldr', platform, slug]}
  >
    <style>
      :global(.prose h1) {
        display: none !important;
      }
      :global(.prose code::before),
      :global(.prose code::after) {
        content: none !important;
      }
      :global(.prose p code::before),
      :global(.prose p code::after),
      :global(.prose li code::before),
      :global(.prose li code::after) {
        content: none !important;
      }
    </style>
    <ToolContainer>
      <div class="mb-16 mt-[74px]">
        <AdBanner />
      </div>
      <ToolHead
        name={data.title}
        description={data.description}
        breadcrumbItems={data.breadcrumbItems}
      />

      <div class="bg-slate-50 dark:bg-slate-800/50 rounded-lg p-6 mt-6">
        <div
          class="prose prose-slate dark:prose-invert max-w-none prose-headings:text-slate-900 dark:prose-headings:text-slate-100 prose-p:text-slate-700 dark:prose-p:text-slate-300 prose-code:text-blue-600 dark:prose-code:text-blue-400 prose-code:bg-slate-100 dark:prose-code:bg-slate-700 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-pre:bg-slate-100 dark:prose-pre:bg-slate-800 prose-pre:border prose-pre:border-slate-200 dark:prose-pre:border-slate-600 prose-blockquote:border-l-blue-500 prose-blockquote:bg-slate-100 dark:prose-blockquote:bg-slate-700 prose-blockquote:px-4 prose-blockquote:py-2 prose-blockquote:rounded prose-ul:space-y-1 prose-li:text-slate-700 dark:prose-li:text-slate-300"
          set:html={data.page.html_content}
        />
      </div>
      
      <div
        class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700"
      >
        <SeeAlsoIndex />
        <div class="mb-8">
          <Banner type="text" />
        </div>
        <div class="flex flex-wrap gap-4">
          <a
            href={`/freedevtools/tldr/${platform}/`}
            class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"
          >
            ‚Üê Back to {platform} commands
          </a>
          <a
            href="/freedevtools/tldr/"
            class="inline-flex items-center px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-400 bg-slate-50 dark:bg-slate-800 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
          >
            tldr
          </a>
          <CreditsButton href="/freedevtools/tldr/credits/" />
        </div>
      </div>
    </ToolContainer>
  </BaseLayout>
) : null}