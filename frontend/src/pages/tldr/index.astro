---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getAllTldrPlatforms } from '../../lib/tldr-utils';
import { formatNumber } from '../../lib/utils';
import Tldr from './_Tldr.astro';

// Get all platforms with their data
const allPlatforms = await getAllTldrPlatforms();

// Calculate total commands across all platforms
const totalCommands = allPlatforms.reduce((total: number, platform: any) => total + platform.count, 0);

// Pagination logic for page 1
const itemsPerPage = 20;
const currentPage = 1;
const totalPages = Math.ceil(allPlatforms.length / itemsPerPage);
const startIndex = (currentPage - 1) * itemsPerPage;
const endIndex = startIndex + itemsPerPage;
const platforms = allPlatforms.slice(startIndex, endIndex);
const totalPlatforms = allPlatforms.length;

// Breadcrumb data
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'TLDR' }
];

// SEO data
const seoTitle = currentPage === 1 
  ? "TLDR - Command Line Documentation | Online Free DevTools by Hexmos"
  : `TLDR - Page ${currentPage} | Online Free DevTools by Hexmos`;

const seoDescription = currentPage === 1
  ? `Comprehensive documentation for ${formatNumber(totalCommands)}+ command-line tools across different platforms. Learn commands quickly with practical examples.`
  : `Browse page ${currentPage} of our TLDR command documentation. Learn command-line tools across different platforms.`;

const canonical = currentPage === 1
  ? "https://hexmos.com/freedevtools/tldr/"
  : `https://hexmos.com/freedevtools/tldr/${currentPage}/`;

// Enhanced keywords for main page
const mainKeywords = [
  "tldr",
  "command line",
  "cli documentation", 
  "terminal commands",
  "bash commands",
  "linux commands",
  "unix commands",
  "command reference",
  "cli documentation",
  "terminal reference"
];

---

<BaseLayout 
  name="TLDR"
  path={currentPage === 1 ? "/freedevtools/tldr/" : `/freedevtools/tldr/${currentPage}/`}
  title={seoTitle}
  description={seoDescription}
  canonical={canonical}
  themeColor="#1e40af"
  showSidebar={false}
  showHeader={true}
  totalItems={totalPlatforms}
  itemsPerPage={itemsPerPage}
  currentPage={currentPage}
  category="TLDR"
  partOf="Free DevTools"
  partOfUrl="https://hexmos.com/freedevtools/"
  keywords={mainKeywords}
  features={["Quick Reference", "Platform Specific", "Practical Examples", "No Registration"]}
>
  <Tldr 
    platforms={platforms}
    currentPage={currentPage}
    totalPages={totalPages}
    totalPlatforms={totalPlatforms}
    totalCommands={totalCommands}
    breadcrumbItems={breadcrumbItems}
  />
</BaseLayout>