---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getAllManpages, getSubcategoriesByMainCategory, getMainCategoryDisplayName } from '../../../lib/manpages';
import AdBanner from '../../../components/banner/AdBanner';

export async function getStaticPaths() {
  const allManpages = await getAllManpages();
  return Object.keys(allManpages).map(mainCategory => ({
    params: { mainCategory }
  }));
}

const { mainCategory } = Astro.params;
const subcategories = await getSubcategoriesByMainCategory(mainCategory!);

if (!subcategories || Object.keys(subcategories).length === 0) {
  return Astro.redirect('/404');
}

const categoryDisplayName = getMainCategoryDisplayName(mainCategory!);
const totalPages = Object.values(subcategories).reduce((total, pages) => total + pages.length, 0);
---

<BaseLayout 
  name={`${categoryDisplayName} Manual Pages`}
  path={`/m/${mainCategory}/`}
  title={`${categoryDisplayName} Manual Pages | Online Free DevTools by Hexmos`}
  description={`Browse ${totalPages} manual pages in ${categoryDisplayName}. Complete Unix and Linux documentation.`}
  canonical={`https://hexmos.com/freedevtools/m/${mainCategory}/`}
  themeColor="#059669"
  showSidebar={false}
  showHeader={true}
  totalItems={Object.keys(subcategories).length}
>
  <div class="max-w-6xl mx-auto px-2 md:px-6">
    <div class="mb-16 mt-[74px]">
      <AdBanner />
    </div>
    
    <nav class="text-sm text-slate-600 dark:text-slate-400 mb-6">
      <a href="/freedevtools/" class="hover:text-green-600 dark:hover:text-green-400">Free DevTools</a>
      <span class="mx-2">/</span>
      <a href="/freedevtools/m/" class="hover:text-green-600 dark:hover:text-green-400">Manual Pages</a>
      <span class="mx-2">/</span>
      <span>{categoryDisplayName}</span>
    </nav>

    <div class="mb-8">
      <h1 class="text-3xl font-bold text-slate-900 dark:text-slate-100 mb-4">
        {categoryDisplayName}
      </h1>
      <p class="text-lg text-slate-600 dark:text-slate-400">
        {Object.keys(subcategories).length} subcategories with {totalPages.toLocaleString()} manual pages
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
      {Object.entries(subcategories).sort(([a], [b]) => a.localeCompare(b)).map(([subcategory, pages]) => (
        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg p-6 hover:border-green-300 dark:hover:border-green-600 transition-colors">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-slate-100">
              <a 
                href={`/freedevtools/m/${mainCategory}/${subcategory}/`}
                class="hover:text-green-600 dark:hover:text-green-400 transition-colors"
              >
                {subcategory.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}
              </a>
            </h2>
            <span class="text-sm text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded">
              {pages.length}
            </span>
          </div>
          
          <div class="space-y-1 mb-4">
            {pages.slice(0, 8).map((page) => (
              <a 
                href={`/freedevtools/m/${mainCategory}/${subcategory}/${page.name}/`}
                class="block text-xs text-green-600 dark:text-green-400 hover:text-black dark:hover:text-white font-mono"
              >
                {page.name}
              </a>
            ))}
            {pages.length > 8 && (
              <p class="text-xs text-slate-500 dark:text-slate-400">
                +{pages.length - 8} more pages
              </p>
            )}
          </div>
          
          <a 
            href={`/freedevtools/m/${mainCategory}/${subcategory}/`}
            class="inline-flex items-center text-sm font-medium text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300"
          >
            View all pages →
          </a>
        </div>
      ))}
    </div>

    <div class="mt-8 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700">
      <div class="flex flex-wrap gap-4">
        <a 
          href="/freedevtools/m/"
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors"
        >
          ← Back to all manual pages
        </a>
      </div>
    </div>
  </div>
</BaseLayout>