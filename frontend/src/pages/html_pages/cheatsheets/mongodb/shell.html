<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readme</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Readme</h1>
        </div>
        <div class="content">
            <div class="markdown-content"><h1>MongoDB Cheatsheet</h1>
<p>A cheatsheet of MongoDB using the mongo shell</p>
<h2>Table of Contents</h2>
<ul>
<li><a href="#definitions">Definitions</a></li>
<li><a href="#view-databases">View Databases</a></li>
<li><a href="#collections">Collections</a></li>
<li><a href="#write-to-mongodb">Write to MongoDB</a></li>
<li><a href="#read-from-mongodb">Read from MongoDB</a></li>
<li><a href="#external-resources">External Resources</a></li>
<li><a href="#backups">Backups</a></li>
<li><a href="#restores">Restores</a></li>
</ul>
<h2>External Resources:</h2>
<ul>
<li><a href="https://gist.github.com/rbekker87/5b4cd9ef36b6ae092a6260ab9e621a43">MongoDB Cheatsheet</a></li>
<li><a href="https://gist.github.com/aponxi/4380516">@aponxi</a></li>
</ul>
<h2>Definitions</h2>
<ul>
<li>A field in mongodb : {<code>"key": "value"</code>}</li>
<li>A field consist of a key and value</li>
<li>A operator like <code>gte</code> or <code>lt</code> can be used</li>
</ul>
<h2>Create a MongoDB Instance</h2>
<p>Create a instance with docker and connect to the shell</p>
<pre class="codehilite"><code>docker run --rm -itd --name mongodb -e MONGO_INITDB_ROOT_USERNAME=root -e MONGO_INITDB_ROOT_PASSWORD=password -p 27017:27017 mongo:4.4
docker exec -it mongodb mongo -u &quot;root&quot; -p &quot;password&quot; --authenticationDatabase &quot;admin&quot;
&gt; 
</code></pre>

<h2>View Databases</h2>
<p>View existing databases:</p>
<pre class="codehilite"><code>&gt; show dbs
admin   0.000GB
config  0.000GB
local   0.000GB
</code></pre>

<p>Create or switch to a database:</p>
<pre class="codehilite"><code>&gt; use mydb
switched to db mydb
</code></pre>

<p>View current database:</p>
<pre class="codehilite"><code>&gt; db
mydb
</code></pre>

<h2>Collections</h2>
<p>Create a collection:</p>
<pre class="codehilite"><code>&gt; db.createCollection(&quot;mycol1&quot;)
{ &quot;ok&quot; : 1 }
&gt; db.createCollection(&quot;mycol2&quot;)
{ &quot;ok&quot; : 1 }
</code></pre>

<p>View collections:</p>
<pre class="codehilite"><code>&gt; show collections
mycol1
mycol2
</code></pre>

<h2>Write to MongoDB</h2>
<p>Insert data into a collection:</p>
<pre class="codehilite"><code>&gt; db.mycol1.insert({&quot;name&quot;: &quot;ruan&quot;, &quot;age&quot;: 32, &quot;hobbies&quot;: [&quot;golf&quot;, &quot;programming&quot;, &quot;music&quot;]})
WriteResult({ &quot;nInserted&quot; : 1 })
&gt; db.mycol1.insert({&quot;name&quot;: &quot;michelle&quot;, &quot;age&quot;: 28, &quot;hobbies&quot;: [&quot;art&quot;, &quot;music&quot;, &quot;reading&quot;]})
WriteResult({ &quot;nInserted&quot; : 1 })
</code></pre>

<h2>Read from MongoDB</h2>
<p>Read all the data from a collection, similar to:</p>
<ul>
<li><code>select * from mycol1</code> :</li>
</ul>
<pre class="codehilite"><code>&gt; db.mycol1.find()
{ &quot;_id&quot; : ObjectId(&quot;5cc60c8ebdbf7f5dd3f7cdc3&quot;), &quot;name&quot; : &quot;ruan&quot;, &quot;age&quot; : 32, &quot;hobbies&quot; : [ &quot;golf&quot;, &quot;programming&quot;, &quot;music&quot; ] }
{ &quot;_id&quot; : ObjectId(&quot;5cc60cacbdbf7f5dd3f7cdc4&quot;), &quot;name&quot; : &quot;michelle&quot;, &quot;age&quot; : 28, &quot;hobbies&quot; : [ &quot;art&quot;, &quot;music&quot;, &quot;reading&quot; ] }
</code></pre>

<p>Using pretty printing:</p>
<pre class="codehilite"><code>&gt; db.mycol1.find().pretty()
{
    &quot;_id&quot; : ObjectId(&quot;5cc60c8ebdbf7f5dd3f7cdc3&quot;),
    &quot;name&quot; : &quot;ruan&quot;,
    &quot;age&quot; : 32,
    &quot;hobbies&quot; : [
        &quot;golf&quot;,
        &quot;programming&quot;,
        &quot;music&quot;
    ]
}
{
    &quot;_id&quot; : ObjectId(&quot;5cc60cacbdbf7f5dd3f7cdc4&quot;),
    &quot;name&quot; : &quot;michelle&quot;,
    &quot;age&quot; : 28,
    &quot;hobbies&quot; : [
        &quot;art&quot;,
        &quot;music&quot;,
        &quot;reading&quot;
    ]
}
</code></pre>

<p>Select only the name and age key, similar to:</p>
<ul>
<li><code>select name, age from mycol1</code> :</li>
</ul>
<pre class="codehilite"><code>&gt; db.mycol1.find({}, {&quot;name&quot;: 1, &quot;age&quot;: 1, &quot;_id&quot;: 0})
{ &quot;name&quot; : &quot;ruan&quot;, &quot;age&quot; : 32 }
{ &quot;name&quot; : &quot;michelle&quot;, &quot;age&quot; : 28 }
</code></pre>

<p>Select only the data where the age is equal to something, similar to:
- <code>select name, age from mycol1 where age = 32</code> :</p>
<pre class="codehilite"><code>&gt; db.mycol1.find({&quot;age&quot;: 32}, {&quot;name&quot;: 1, &quot;age&quot;: 1, &quot;_id&quot;: 0})
{ &quot;name&quot; : &quot;ruan&quot;, &quot;age&quot; : 32 }
````

Return the name from a given document id, similar to:
- `select name from mycol1 where id = xx` :
</code></pre>

<blockquote>
<p>db.mycol1.findOne({_id: ObjectId("5cc60c8ebdbf7f5dd3f7cdc3")}).name
ruan</p>
</blockquote>
<pre class="codehilite"><code>Find documents older than a specific age:
</code></pre>

<blockquote>
<p>db.mycol1.find({"age": {"$gt": 30}})
{ "_id" : ObjectId("5cc60c8ebdbf7f5dd3f7cdc3"), "name" : "ruan", "age" : 32, "hobbies" : [ "golf", "programming", "music" ] }</p>
</blockquote>
<pre class="codehilite"><code>## Backups

Mongodump with uri syntax:
</code></pre>

<p>mongodump --uri="mongodb://uberuser:passherd@localhost:27107/redbase?ssl=false&amp;authSource=admin"</p>
<pre class="codehilite"><code>Mongodump with standard flags:
</code></pre>

<p>mongodump --user=uberuser --db=redbase --password=passherd --authenticationDatabase=admin</p>
<pre class="codehilite"><code>Specify the output directory:
</code></pre>

<p>mongodump --user=uberuser --db=redbase --password=passherd --authenticationDatabase=admin --out=dumbbase</p>
<pre class="codehilite"><code>Only one specific collection:
</code></pre>

<p>mongodump --user=ubersuser --db=redbase --password=passherd --authenticationDatabase=admin --out=dumbbase --collection=action_figures</p>
<pre class="codehilite"><code>The structure will look like this:

```bash
.
 |_dumbbase
   |_redbase
     |_action_figures.metadata.json
     |_action_figures.bson
</code></pre>

<p>Dump all databases into a archive:</p>
<pre class="codehilite"><code>mongodump --db=redbase --username=uberuser --password=passherd --authenticationDatabase=admin --archive=redbase.archive
</code></pre>

<h2>Restores</h2>
<p>With mongorestore we can point it to the path of the dump, and it wont overrite documents with the same id's:</p>
<pre class="codehilite"><code>mongorestore dump/
</code></pre>

<p>To only restore a specific collection:</p>
<pre class="codehilite"><code>mongorestore --db=newdb --collection=comic_books dump/mydb/product.bson
</code></pre>

<p>Bu a better approach is to use <code>-nsInclude</code>:</p>
<pre class="codehilite"><code>mongorestore --db=redbase --nsInclude=&quot;db1.*&quot; dump/
</code></pre>

<h2>External Resources</h2>
<ul>
<li><a href="https://gist.github.com/rbekker87/5b4cd9ef36b6ae092a6260ab9e621a43">MongoDB Cheatsheet #1</a></li>
<li><a href="https://gist.github.com/aponxi/4380516">@aponxi</a></li>
<li><a href="https://gist.github.com/michaeltreat/d3bdc989b54cff969df86484e091fd0c">@michaeltreat</a></li>
</ul></div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>