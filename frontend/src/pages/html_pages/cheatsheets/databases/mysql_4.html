<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readme</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Readme</h1>
        </div>
        <div class="content">
            <div class="markdown-content"><h1>MySQL Cheatsheet</h1>
<ul>
<li><a href="#changing-tables">Changing Tables</a></li>
<li><a href="#check-and-repair-tables">Check and Repair Tables</a></li>
<li><a href="#rename-users">Rename Users</a></li>
<li><a href="#create-tables">Create Tables</a></li>
<li><a href="#delete">Delete</a></li>
<li><a href="#get-size-in-mb">Get Size in MB</a></li>
<li><a href="#view-logged-in-users">View Logged in Users</a></li>
<li><a href="#indexes">Indexes</a></li>
<li><a href="#insert-data">Insert Data</a></li>
<li><a href="#performance-schema-metrics">Performance Schema Metrics</a></li>
<li><a href="#permissions">Permissions</a></li>
<li><a href="#repair-table">Repair Table</a></li>
</ul>
<h2>Permissions</h2>
<p>Create Database:</p>
<pre class="codehilite"><code>mysql&gt; CREATE DATABASE my_db;
</code></pre>

<p>Create User:</p>
<pre class="codehilite"><code>mysql&gt; CREATE USER 'user1'@'%' IDENTIFIED BY 'securepass';
</code></pre>

<p>Grant User all Permissions to Database:</p>
<pre class="codehilite"><code>mysql&gt; GRANT ALL PRIVILEGES ON my_db.* TO 'user1'@'%';
</code></pre>

<p>Grant User all Permissions to all databases with grant option:</p>
<pre class="codehilite"><code>mysql&gt; GRANT ALL PRIVILEGES ON *.* TO 'user1'@'%' WITH GRANT OPTION;
</code></pre>

<p>Grant User all Permissions to Database in AWS RDS:</p>
<pre class="codehilite"><code>mysql&gt; GRANT SELECT, UPDATE, DELETE, INSERT, CREATE, DROP, INDEX, ALTER, LOCK TABLES, EXECUTE, CREATE TEMPORARY TABLES, EXECUTE, TRIGGER, CREATE VIEW, SHOW VIEW, EVENT ON my_db.* TO user1@'%';
</code></pre>

<p>Update password:</p>
<pre class="codehilite"><code>mysql&gt; UPDATE mysql.user SET authentication_string = PASSWORD('foobar') WHERE User = 'demo' and Host = '%';
# or
mysql&gt; SET PASSWORD FOR 'demo'@'%' = PASSWORD('foobar');
# or
mysql&gt; ALTER USER 'demo'@'%' IDENTIFIED BY 'foobar';
# or
mysql&gt; ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';
</code></pre>

<p>Flush:</p>
<pre class="codehilite"><code>mysql&gt; FLUSH PRIVILEGES;
</code></pre>

<h2>Rename Users</h2>
<pre class="codehilite"><code class="language-sql">RENAME USER 'john12' TO 'john.permanent';
</code></pre>

<h2>Create Tables</h2>
<p>Create a table:</p>
<pre class="codehilite"><code>mysql&gt; CREATE TABLE domains (
  id INT(10) NOT NULL AUTO_INCREMENT,
  domain varchar(50) NOT NULL, 
  owner  varchar(50),
  year_registered int(4)
);
</code></pre>

<p>Create a table with primary key:</p>
<pre class="codehilite"><code>mysql&gt; CREATE TABLE domains (
  id INT(10) NOT NULL AUTO_INCREMENT,
  domain varchar(50) NOT NULL, 
  owner  varchar(50),
  year_registered int(4),
  PRIMARY KEY (id) 
);
</code></pre>

<p>Create a table as a select query:</p>
<pre class="codehilite"><code>mysql&gt; CREATE TABLE purchases_fnb_2016 
       AS 
         SELECT * FROM customers where date &gt;= '2016-01-01 00:00:00' 
         AND date  &lt;= '2016-10-29 00:00:00' 
         AND bank = 'fnb'
;
</code></pre>

<p>Create a table with a boolean data type:</p>
<pre class="codehilite"><code>CREATE TABLE myusers(name VARCHAR(50), matriculated BOOLEAN);
</code></pre>

<p>Insert with boolean data:</p>
<pre class="codehilite"><code>INSERT INTO myusers VALUES('tom', False);
</code></pre>

<p>Read data:</p>
<pre class="codehilite"><code>mysql&gt; select name, matriculated from myusers limit 1;
+------+--------------+
| name | matriculated |
+------+--------------+
| tom  |            0 |
+------+--------------+
</code></pre>

<p>Use IF statement and replace value:</p>
<pre class="codehilite"><code>mysql&gt; select name, IF(matriculated, 'yes', 'no') matriculated from myusers limit 1;
+------+--------------+
| name | matriculated |
+------+--------------+
| tom  | no           |
+------+--------------+
</code></pre>

<p>To query for people not matriculated:</p>
<pre class="codehilite"><code>mysql&gt; select name, IF(matriculated, 'yes', 'no') matriculated from myusers where matriculated = false limit 1;
+------+--------------+
| name | matriculated |
+------+--------------+
| tom  | no           |
+------+--------------+

# you can use it without the if
</code></pre>

<p>To view unique values:</p>
<pre class="codehilite"><code>mysql&gt; select distinct country from people;
+---------+
| country |
+---------+
| MOZ     |
| NGA     |
| KEN     |
| ZWE     |
| IND     |
| GHA     |
+---------+
</code></pre>

<p>To create a boolean column with default value of false:</p>
<pre class="codehilite"><code class="language-sql">CREATE TABLE users ( 
  active boolean not null default 0
);
</code></pre>

<p>To create a timestamp column:</p>
<pre class="codehilite"><code class="language-sql">CREATE TABLE users ( 
  time_created TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
</code></pre>

<p>Then create a entry with <code>now()</code></p>
<h2>Changing Tables</h2>
<p>Changing the column length:</p>
<pre class="codehilite"><code>mysql&gt; ALTER TABLE contacts_business CHANGE COLUMN contact_number contact_number varchar(40);
</code></pre>

<h2>Check and Repair Tables</h2>
<p>Check all tables in mailscanner db:</p>
<pre class="codehilite"><code>$ mysqlcheck -c mailscanner -u root -p
</code></pre>

<p>Check all tables all dbs:</p>
<pre class="codehilite"><code>$ mysqlcheck -c  -u root -p --all-databases
</code></pre>

<p>Check one table:</p>
<pre class="codehilite"><code>$ check table maillog;
</code></pre>

<p>analyzes employee table that is located in thegeekstuff database:</p>
<pre class="codehilite"><code>$ mysqlcheck -a thegeekstuff employee -u root -p
</code></pre>

<p>optimizes employee table that is located in thegeekstuff database.</p>
<pre class="codehilite"><code>$ mysqlcheck -o thegeekstuff employee -u root -p
</code></pre>

<p>repairs employee table that is located in thegeekstuff database.</p>
<pre class="codehilite"><code>$ mysqlcheck -r thegeekstuff employee -u root -p
</code></pre>

<p>checks, optimizes and repairs all the corrupted table in thegeekstuff database.</p>
<pre class="codehilite"><code>$ mysqlcheck -u root -p --auto-repair -c -o thegeekstuff
</code></pre>

<p>optimize and repair all the tables across all your databases using the following command.</p>
<pre class="codehilite"><code>$ mysqlcheck -u root -p --auto-repair -c -o --all-databases
</code></pre>

<h2>Delete</h2>
<p>Delete data older than x:</p>
<pre class="codehilite"><code>mysql&gt; delete from maillog where timestamp &lt; &quot;2012-09-07&quot;;
mysql&gt; optimize table maillog;
</code></pre>

<h2>Get Size in MB</h2>
<pre class="codehilite"><code>SELECT table_schema &quot;Data Base Name&quot;, 
sum( data_length + index_length ) / 1024 / 
1024 &quot;Data Base Size in MB&quot;, 
sum( data_free )/ 1024 / 1024 &quot;Free Space in MB&quot; 
FROM information_schema.TABLES 
GROUP BY table_schema ;
</code></pre>

<h2>View Logged in Users</h2>
<pre class="codehilite"><code class="language-sql">SELECT SUBSTRING_INDEX(host, ':', 1) AS host_short, 
  GROUP_CONCAT(DISTINCT user) AS users, 
  COUNT(*) AS threads 
  FROM information_schema.processlist 
  GROUP BY host_short 
  ORDER BY COUNT(*), host_short;
</code></pre>

<p>Or:</p>
<pre class="codehilite"><code class="language-sql">SELECT `USER`, COUNT(*) FROM information_schema.processlist GROUP BY `USER`;
````

## Indexes

Add a index to an existing table:
</code></pre>

<p>mysql&gt; DESCRIBE salaries;
+-----------+---------+------+-----+---------+-------+
| Field     | Type    | Null | Key | Default | Extra |
+-----------+---------+------+-----+---------+-------+
| emp_no    | int(11) | NO   | PRI | NULL    |       |
| salary    | int(11) | NO   |     | NULL    |       |
| from_date | date    | NO   | PRI | NULL    |       |
| to_date   | date    | NO   |     | NULL    |       |
+-----------+---------+------+-----+---------+-------+
4 rows in set (0.00 sec)</p>
<p>ALTER TABLE salaries ADD INDEX ( salary );</p>
<pre class="codehilite"><code>## Insert Data

Insert data into our domain table
</code></pre>

<p>mysql&gt; INSERT INTO domains (domain,owner,year_registered) VALUES("example.com", "John", 2019);</p>
<pre class="codehilite"><code>## Update Data

To update a students age and language where the student_id is something specific:
</code></pre>

<p>mysql&gt; UPDATE students SET age = 30, language = 'english' WHERE student_id = 'fz9203493043';</p>
<pre class="codehilite"><code>## Information Schema

Show me idle connections:
</code></pre>

<p>mysql&gt; select id, user, host, db, command, time from information_schema.processlist where command = "sleep";
+-----------+-------+---------------------+--------+---------+------+
| id        | user  | host                | db     | command | time |
+-----------+-------+---------------------+--------+---------+------+
| 659558686 | james | 172.31.27.126:37154 | mydb12 | Sleep   |  332 |</p>
<pre class="codehilite"><code>Show me connected sessions:
</code></pre>

<p>mysql&gt; select count(<em>) from information_schema.processlist;
+----------+
| count(</em>) |
+----------+
|       60 |
+----------+</p>
<p>or</p>
<p>mysql&gt; show status where variable_name = 'threads_connected';
+-------------------+-------+
| Variable_name     | Value |
+-------------------+-------+
| Threads_connected | 61    |
+-------------------+-------+</p>
<pre class="codehilite"><code>Show connection related variables:
</code></pre>

<p>mysql&gt; SHOW VARIABLES LIKE '%connections%';
+-----------------------+-------+
| Variable_name         | Value |
+-----------------------+-------+
| extra_max_connections | 1     |
| max_connections       | 1296  |
| max_user_connections  | 0     |
+-----------------------+-------+
3 rows in set (0.16 sec)</p>
<pre class="codehilite"><code>or&quot;
</code></pre>

<p>mysql&gt; show status like '%onn%';
+-----------------------------------------------+-----------+
| Variable_name                                 | Value     |
+-----------------------------------------------+-----------+
| Aborted_connects                              | 35        |
| Connection_errors_accept                      | 0         |
| Connection_errors_internal                    | 0         |
| Connection_errors_max_connections             | 0         |
| Connection_errors_peer_address                | 0         |
| Connection_errors_select                      | 0         |
| Connection_errors_tcpwrap                     | 0         |
| Connections                                   | 66059     |
| Max_used_connections                          | 502       |
| Performance_schema_session_connect_attrs_lost | 0         |
| Slave_connections                             | 0         |
| Slaves_connected                              | 1         |
| Ssl_client_connects                           | 0         |
| Ssl_connect_renegotiates                      | 0         |
| Ssl_finished_connects                         | 0         |
| Threads_connected                             | 46        |
| wsrep_connected                               | OFF       |
+-----------------------------------------------+-----------+
17 rows in set (0.16 sec)</p>
<pre class="codehilite"><code>Show me cache information:
</code></pre>

<p>mysql&gt; SHOW VARIABLES LIKE 'have_query_cache';
mysql&gt; SHOW STATUS LIKE 'Qcache%';</p>
<pre class="codehilite"><code>Show me how long a connection can idle:
</code></pre>

<h1>https://aws.amazon.com/blogs/database/best-practices-for-configuring-parameters-for-amazon-rds-for-mysql-part-3-parameters-related-to-security-operational-manageability-and-connectivity-timeout/</h1>
<p>mysql&gt; SHOW VARIABLES LIKE 'wait_timeout';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| wait_timeout  | 28800 |
+---------------+-------+</p>
<pre class="codehilite"><code>Binlog format:
</code></pre>

<p>mysql&gt; show variables like 'binlog_format';</p>
<pre class="codehilite"><code>## Performance Schema Metrics:

Execution time of all the different statement types executed by each user:
</code></pre>

<p>mysql&gt; select * from sys.user_summary_by_statement_type;
+------------+----------------+-------+---------------+-------------+--------------+-----------+---------------+---------------+------------+
| user       | statement      | total | total_latency | max_latency | lock_latency | rows_sent | rows_examined | rows_affected | full_scans |
+------------+----------------+-------+---------------+-------------+--------------+-----------+---------------+---------------+------------+
| background | select         |     1 | 212.00 us     | 212.00 us   | 0 ps         |         1 |             0 |             0 |          0 |
| root       | insert         |   175 | 46.26 s       | 823.43 ms   | 6.33 s       |         0 |             0 |       3919027 |          0 |
| root       | select         |    50 | 12.21 s       | 10.00 s     | 10.41 ms     |       223 |       7498268 |             0 |         17 |</p>
<pre class="codehilite"><code>Slowest statements (those in the 95th percentile by runtime):
</code></pre>

<p>mysql&gt; select * from sys.statements_with_runtimes_in_95th_percentile\G
<strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em>* 1. row </strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong>****
            query: SELECT <code>sleep</code> (?)
               db: sys
        full_scan:
       exec_count: 1
        err_count: 0
       warn_count: 0
    total_latency: 10.00 s
      max_latency: 10.00 s
      avg_latency: 10.00 s
        rows_sent: 1
    rows_sent_avg: 1
    rows_examined: 0
rows_examined_avg: 0
       first_seen: 2019-07-04 11:21:23.155084
        last_seen: 2019-07-04 11:21:23.155084
           digest: x</p>
<pre class="codehilite"><code>Number of queries that generated errors or warnings:
</code></pre>

<p>mysql&gt; SELECT SUM(errors) FROM sys.statements_with_errors_or_warnings;
+-------------+
| SUM(errors) |
+-------------+
|           4 |
+-------------+</p>
<pre class="codehilite"><code>## Repair Table
</code></pre>

<p>mysql&gt; repair table x;
mysql&gt; optimize table x;</p>
<pre class="codehilite"><code>## Scripting

Basic script to create the database and tables and using a for loop to insert data into mysql:
</code></pre>

<h1>!/usr/bin/env bash</h1>
<p>user="root"
password="rootpassword"
database="my_db"</p>
<p>mysql -h 127.0.0.1 -u"$user" -p"$password" "$database" &lt;&lt;EOF
CREATE DATABASE IF NOT EXISTS foo;
CREATE TABLE IF NOT EXISTS foo.hashes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  number INT(10) NOT NULL,
  hash VARCHAR(50) NOT NULL
);
EOF</p>
<p>for x in {1..10}
  do
    mysql -h 127.0.0.1 -u"$user" -p"$password" "$database" &lt;&lt;EOF
      INSERT IGNORE INTO foo.hashes (id, number, hash) VALUES ('', $x, "$(openssl rand -hex 8)");
    EOF
  done</p>
<p>mysql -h 127.0.0.1 -u"$user" -p"$password" "$database" &lt;&lt;EOF
  SELECT * FROM foo.hashes;
EOF
```</p>
<h2>External Resources:</h2>
<ul>
<li>https://www.mysqltutorial.org/mysql-inner-join.aspx/</li>
<li>https://www.mysqltutorial.org/mysql-index/mysql-create-index/</li>
</ul></div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>