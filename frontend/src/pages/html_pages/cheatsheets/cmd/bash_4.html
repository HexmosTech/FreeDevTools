<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readme</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Readme</h1>
        </div>
        <div class="content">
            <div class="markdown-content"><h1>BASH</h1>
<p>My Bash Cheatsheet Index:</p>
<ul>
<li><a href="#one-liners">One Liners</a></li>
<li><a href="#block-bad-ips">Block Bad IPs</a></li>
<li><a href="#if-statements">If Statements</a></li>
<li><a href="#check-if-args-are-passed">Check if args are passed</a></li>
<li><a href="#check-if-required-variables-exist">Check if required variables exist</a></li>
<li><a href="#check-if-environment-variables-exists">Check if environment variables exists</a></li>
<li><a href="#while-loops">While Loops</a></li>
<li><a href="#run-process-for-5-seconds">Run for 5 Seconds</a></li>
<li><a href="#redirecting-outputs">Redirecting Outputs</a></li>
<li><a href="#stdout-stderr">Stdout, Stderr</a></li>
</ul>
<h2>Commands</h2>
<h3>tr command</h3>
<p>Remove whitespace:</p>
<pre class="codehilite"><code>$ echo 'foo - bar' | tr -d '[:space:]'
foo-bar
</code></pre>

<p>Convert to uppercase:</p>
<pre class="codehilite"><code>$ echo 'HeLLo' | tr '[:lower:]' '[:upper:]'
HELLO
</code></pre>

<h2>One Liners</h2>
<h3>Block Bad IPs</h3>
<p>Use iptables to block all bad ip addresses:</p>
<pre class="codehilite"><code>$ cat /var/log/maillog | grep 'lost connection after AUTH from unknown' | tail -n 5
May 10 11:19:49 srv4 postfix/smtpd[1486]: lost connection after AUTH from unknown[185.36.81.145]
May 10 11:21:41 srv4 postfix/smtpd[1762]: lost connection after AUTH from unknown[185.36.81.164]
May 10 11:21:56 srv4 postfix/smtpd[1762]: lost connection after AUTH from unknown[175.139.231.129]
May 10 11:23:51 srv4 postfix/smtpd[1838]: lost connection after AUTH from unknown[185.211.245.170]
May 10 11:24:02 srv4 postfix/smtpd[1838]: lost connection after AUTH from unknown[185.211.245.170]
</code></pre>

<p>Get the data to show only IPs:</p>
<pre class="codehilite"><code>cat /var/log/maillog | grep 'lost connection after AUTH from unknown' | cut -d'[' -f3 | cut -d ']' -f1 | tail -n5
185.36.81.164
175.139.231.129
185.211.245.170
185.211.245.170
185.36.81.173
</code></pre>

<p>Get the uniqe IP addresses:</p>
<pre class="codehilite"><code>$ cat /var/log/maillog | grep 'lost connection after AUTH from unknown' | cut -d'[' -f3 | cut -d ']' -f1 | sort | uniq
103.194.70.16
112.196.77.202
113.172.210.19
113.173.182.119
139.59.224.234
</code></pre>

<p>Redirect the output to iptables:</p>
<pre class="codehilite"><code>$ for ip in $(cat /var/log/maillog | grep 'lost connection after AUTH from unknown' | cut -d'[' -f3 | cut -d ']' -f1 | sort | uniq); do iptables -I INPUT -s ${ip} -p tcp --dport 25 -j DROP; done
</code></pre>

<h2>If Statements</h2>
<h3>Check if args are passed</h3>
<pre class="codehilite"><code>if [[ $# -eq 0 ]] ; then
    echo 'need to pass args'
    exit 0
fi
</code></pre>

<h2>Check if required variables exist</h2>
<pre class="codehilite"><code>if [ $1 == &quot;one&quot; ] || [ $1 == &quot;two&quot; ]
then
  echo &quot;argument 1 has the value one or two&quot;
  exit 0
else
  echo &quot;I require argument 1 to be one or two&quot;
  exit 1
fi
</code></pre>

<p>or:</p>
<pre class="codehilite"><code>NAME=${1}
if [ -z ${NAME} ]
  then
    echo NAME is undefined
    exit 1
  else
    echo &quot;Hi ${NAME}&quot;
fi
</code></pre>

<h2>Check if environment variables exists</h2>
<pre class="codehilite"><code>if [ -z ${OWNER} ] || [ -z ${NAME} ]
then
  echo &quot;does not meet requirements of both environment variables&quot;
  exit 1
else
  echo &quot;required environment variables exists&quot;
fi
</code></pre>

<h2>While Loops</h2>
<h3>Run process for 5 Seconds</h3>
<pre class="codehilite"><code>set -ex
count=0
echo &quot;boot&quot;
ping localhost &amp;
while [ $count -le 5 ]
  do
    sleep 1
    count=$((count + 1))
    echo $count
  done
ps aux | grep ping
echo &quot;tear down&quot;
kill $!
sleep 2
</code></pre>

<h3>Run until state changes within ttl</h3>
<pre class="codehilite"><code>UPDATE_COMPLETE=false
UPDATE_STATUS=running
COUNT=0
while [ ${UPDATE_COMPLETE} == false ]
    do
        if [ $count -gt 10 ]
            then
                echo &quot;timed out&quot;
                exit 1
        fi

        if [ ${UPDATE_STATUS} == running ] 
            then
                echo &quot;still running&quot;
                sleep 1
                COUNT=$((COUNT+1))
                if [ $count == 7 ]
                    then
                        UPDATE_COMPLETE=true
                fi
        elif [ ${UPDATE_STATUS} == successful ]
            then
                UPDATE_COMPLETE=successful
        else
            echo &quot;unexpected update response&quot;
            exit 1
        fi
    done
echo &quot;complete&quot;
</code></pre>

<h2>for Loops</h2>
<h3>Upload all docker image</h3>
<pre class="codehilite"><code class="language-bash">for i in $(ls | grep .tar): do
  docker load -i $i;
done
</code></pre>

<h2>Functions</h2>
<pre class="codehilite"><code>message(){
    NAME=${1}
    echo &quot;Hi ${NAME}&quot;
}
</code></pre>

<p>or pass all args:</p>
<pre class="codehilite"><code>message(){
    echo &quot;Hi $@&quot;
}
</code></pre>

<h2>Redirecting Outputs</h2>
<h3>Stdout, Stderr</h3>
<p>Redirect stderr to /dev/null:</p>
<pre class="codehilite"><code>grep -irl faker . 2&gt;/dev/null
</code></pre>

<p>Redirect stdout to one file and stderr to another file:</p>
<pre class="codehilite"><code>grep -irl faker . &gt; out 2&gt;error
</code></pre>

<p>Redirect stderr to stdout (&amp;1), and then redirect stdout to a file:</p>
<pre class="codehilite"><code>grep -irl faker . &gt;out 2&gt;&amp;1
</code></pre>

<p>Redirect both to a file:</p>
<pre class="codehilite"><code>grep -irl faker . &amp;&gt; file.log
</code></pre>

<h2>Manipulating Text</h2>
<h3>Remove first 3 characters</h3>
<pre class="codehilite"><code>$ STRING=&quot;abcdefghij&quot;
$ echo ${STRING:3}
defghij
</code></pre>

<h3>Only show last 3 characters</h3>
<p>With tail to only show the last 3 characters:</p>
<pre class="codehilite"><code>$ STRING=&quot;abcdefghij&quot;
$ echo ${STRING} | tail -c 4
hij
</code></pre></div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>