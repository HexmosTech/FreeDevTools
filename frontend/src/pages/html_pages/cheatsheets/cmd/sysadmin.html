<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readme</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Readme</h1>
        </div>
        <div class="content">
            <div class="markdown-content"><h2>Command Line</h2>
<h3>mkdir</h3>
<p>To create sub directories even if the parent directories dont exist:</p>
<pre class="codehilite"><code>$ mkdir -p /tmp/foo/bar/this/dir
</code></pre>

<p>To create multiple directories with one command, to achieve:</p>
<pre class="codehilite"><code>/disk1/ebooks/category-tech
/disk1/ebooks/category-motivation
/disk2/ebooks/category-tech
/disk2/ebooks/category-motivation
/disk3/ebooks/category-tech
/disk3/ebooks/category-motivation
</code></pre>

<p>You can do:</p>
<pre class="codehilite"><code>mkdir -p /disk{1..5}/ebooks/category-{tech,motivation}
</code></pre>

<h2>Disk</h2>
<p>To check disk space:</p>
<pre class="codehilite"><code class="language-bash">$ df -h
</code></pre>

<p>To see the size of consumption per directory:</p>
<pre class="codehilite"><code class="language-bash">$ du -sh /path/to/dirs/*
</code></pre>

<p>To view disk and sata input mappings: (0 is port 1)</p>
<pre class="codehilite"><code class="language-bash">$ lsblk -o NAME,MODEL,SERIAL,WWN,HCTL
NAME   MODEL              SERIAL   WWN                HCTL
sda    ST4000D0000-000000 XXXXXXXX 0x5000c50000000000 0:0:0:0
sdb    ST4000D0000-000000 XXXXXXXX 0x5000c50000000000 1:0:0:0
└─sdb1                             0x5000c50000000000
sdc    ST4000D0000-000000 XXXXXXXX 0x5000c50000000000 2:0:0:0
└─sdc1                             0x5000c50000000000
</code></pre>

<h3>Unable to unmount</h3>
<p>This scenario is when a disk cannot be unmounted, usually this is because the disk is still in use with another application:</p>
<pre class="codehilite"><code class="language-bash">umount /data
umount: /data: target is busy.
</code></pre>

<p>Use the lsof (list open files) command to find out which processes are using the <code>/data</code> directory. Run <code>sudo lsof /data</code>. This will list all processes accessing files in /data.</p>
<pre class="codehilite"><code class="language-bash">sudo lsof /data
COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF     NODE NAME
sudo    21204 root  cwd    DIR  259,3     4096 27525121 /data/tmp
bash    28594 root  cwd    DIR  259,3     4096 27525121 /data/tmp
</code></pre>

<p>In this scenario there was a shell session that was changed to that directory, we can either kill the pid (<code>kill 28594</code>) or jump to that session and exit the directory.</p>
<h2>Memory</h2>
<ul>
<li>
<p><strong>Free</strong> memory is the amount of memory which is currently not used for anything. This number should be small, because memory which is not used is simply wasted.</p>
</li>
<li>
<p><strong>Available</strong> memory is the amount of memory which is available for allocation to a new process or to existing processes.</p>
</li>
</ul>
<h3>Memory Stats</h3>
<p>Difference between vsz and rss:</p>
<pre class="codehilite"><code>The Virtual Set Size is a memory size assigned to a process ( program ) during the initial execution. The Virtual Set Size memory is simply a number of how much memory a process has available for its execution. 

As oppose to VSZ ( Virtual Set Size ), RSS is a memory currently used by a process. This is a actual number in kilobytes of how much RAM the current process is using. 
</code></pre>

<p>Using ps to sort by memory usage:</p>
<pre class="codehilite"><code>$ ps aux --sort -rss
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root      2124  0.1 11.4 422028 232864 ?       Ssl  Mar19   0:35 /bin/thanos
</code></pre>

<p>Using <code>/proc/meminfo</code>:</p>
<pre class="codehilite"><code>$ cat /proc/meminfo
MemTotal:       16424260 kB
MemFree:          173988 kB
MemAvailable:   13493104 kB
Buffers:          253116 kB
Cached:         12950152 kB
</code></pre>

<p>Using vmstat:</p>
<pre class="codehilite"><code>$ vmstat -s
16424260 K total memory
 2598624 K used memory
 3701676 K active memory
11821540 K inactive memory
  328008 K free memory
  253208 K buffer memory
  13244420 K swap cache
</code></pre>

<p>Using top:</p>
<pre class="codehilite"><code>$ top -n 1 -b
top - 07:50:06 up 13 days, 22:22,  1 user,  load average: 0.06, 0.07, 0.02
Tasks: 124 total,   1 running,  73 sleeping,   0 stopped,   0 zombie
%Cpu(s):  2.0 us,  0.4 sy,  0.0 ni, 97.3 id,  0.0 wa,  0.0 hi,  0.2 si,  0.0 st
KiB Mem : 16424260 total,   249368 free,  2597924 used, 13576968 buff/cache
KiB Swap:        0 total,        0 free,        0 used. 13490404 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
15482 user      20   0 7949520 2.150g  24408 S  37.5 13.7  40:35.70 java
</code></pre>

<p>More info on above:</p>
<pre class="codehilite"><code>%MEM is directly related to RES, it’s the percentage use of total physical memory by the process.
VIRT is the total memory that this process has access to shared memory, mapped pages, swapped out pages, etc.
RES is the total physical memory used shared or private that the process has access to.
SHR is the total physical shared memory that the process has access to.
</code></pre>

<p>Get memory stats:</p>
<pre class="codehilite"><code>$ wget https://raw.githubusercontent.com/pixelb/ps_mem/master/ps_mem.py
$ sudo python ps_mem.py
</code></pre>

<h2>Permissions</h2>
<h3>Permissions for Directories and Files</h3>
<pre class="codehilite"><code>$ sudo chmod 755 /disk
$ sudo chown -R ubuntu:ubuntu /disk
$ sudo find /disk/2/htpc -type f -print -exec chmod 644 {} \;
$ sudo find /disk/2/htpc -type d -print -exec chmod 755 {} \;
</code></pre>

<h3>External Resources</h3>
<ul>
<li>https://www.tummy.com/articles/isolating-heavy-load/</li>
<li>https://bobcares.com/blog/high-cpu-utilization/</li>
<li>https://coderwall.com/p/utc42q/understanding-iostat</li>
<li>https://www.techrepublic.com/article/how-to-use-the-linux-iostat-command-to-check-on-your-storage-subsystem/</li>
</ul></div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>