<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bash CPU Exporter - Monitor Linux Processes with Prometheus</title>
    <meta name="description" content="Monitor Linux processes and CPU usage with the Bash CPU Exporter. Send stats to Pushgateway for Prometheus and visualize with Grafana.">
    <meta name="keywords" content="bash cpu exporter, linux process monitoring, prometheus, grafana, pushgateway, system metrics, shell script, exporter, monitoring tool">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://yourdomain.com/pushgateway/bash_cpu_exporter.html">
    <meta property="og:title" content="Bash CPU Exporter - Monitor Linux Processes with Prometheus">
    <meta property="og:description" content="Monitor Linux processes and CPU usage with the Bash CPU Exporter. Send stats to Pushgateway for Prometheus and visualize with Grafana.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/pushgateway/bash_cpu_exporter.html">
    <meta property="og:image" content="https://yourdomain.com/path/to/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Bash CPU Exporter - Monitor Linux Processes with Prometheus">
    <meta name="twitter:description" content="Monitor Linux processes and CPU usage with the Bash CPU Exporter. Send stats to Pushgateway for Prometheus and visualize with Grafana.">
    <meta name="twitter:image" content="https://yourdomain.com/path/to/twitter-image.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Bash CPU Exporter</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <h2>Bash CPU Exporter Overview</h2>
                <p>This Bash script acts as a custom exporter to gather system statistics, specifically CPU usage for running processes, and send them to a Prometheus Pushgateway. By leveraging standard Linux commands like <code>ps</code> and utilities like <code>awk</code>, it extracts process information and formats it into a Prometheus-readable text format. This data can then be scraped by Prometheus and visualized in Grafana, providing real-time insights into system performance and resource consumption.</p>

                <h2>How the Bash CPU Exporter Works</h2>
                <p>The exporter script initializes by defining key variables such as the Prometheus job name, hostname, exporter type, authentication credentials for the Pushgateway, and the Pushgateway URL itself. It then executes <code>ps aux</code> to get a comprehensive list of running processes. The output is piped into a <code>while read</code> loop, where each line is processed. For every process, it extracts the process name and PID, and then formats the CPU usage percentage into a Prometheus metric line. Finally, it uses <code>curl</code> to POST these metrics to the specified Pushgateway endpoint, making them available for Prometheus to collect.</p>

                <h2>Key Components and Configuration</h2>
                <p>The script is designed for simplicity and direct integration. Key configuration parameters include:</p>
                <ul>
                    <li><code>job_name</code>: Identifies the Prometheus job.</li>
                    <li><code>my_hostname</code>: The instance name for the metrics.</li>
                    <li><code>exporter_type</code>: A label to categorize the exporter (e.g., "bash").</li>
                    <li><code>auth_string</code>: Basic authentication credentials for the Pushgateway (username:password).</li>
                    <li><code>pushgateway_url</code>: The address of your Prometheus Pushgateway instance.</li>
                </ul>
                <p>The core logic relies on parsing the output of <code>ps aux</code>. The <code>awk</code> command is used to extract specific fields, and the output is constructed to match the Prometheus exposition format, including labels for process name and PID.</p>

                <h2>Integrating with Prometheus and Grafana</h2>
                <p>To effectively use this Bash CPU Exporter, you need a running Prometheus instance configured to scrape metrics from your Pushgateway. Ensure your Prometheus configuration includes a scrape job targeting the Pushgateway. Once Prometheus collects the data, you can set up dashboards in Grafana to visualize the CPU usage of individual processes, track trends, and set up alerts for abnormal resource consumption. This setup provides a lightweight yet powerful solution for monitoring your Linux systems.</p>

                <h2>Example Usage and Script</h2>
                <p>Below is the Bash script that performs the CPU monitoring and Pushgateway submission:</p>
                <pre><code class="language-bash">#!/bin/bash

# This exporter gets stats from top and sends it to pushgateway
# Prometheus will scrape the pushgateway service and consumes to prometheus
# Grafana will visualize the data

# resource:
# https://devconnected.com/monitoring-linux-processes-using-prometheus-and-grafana/

job_name="top"
my_hostname="my-ec2-instance"
exporter_type="bash"
auth_string="x:x"
pushgateway_url="pushgateway.mydomain.com"

z=$(ps aux)
while read -r z
do
   var=$var$(awk '{print "exporter_cpu_usage{process=\""$11"\", pid=\""$2"\"}", $3z}');
done &lt;&lt;&lt; "$z"
curl -X POST -u "$auth_string" -H  "Content-Type: text/plain" --data "$var
" https://$pushgateway_url/metrics/job/$job_name/instance/$my_hostname/exporter_type/$exporter_type
</code></pre>

                <h2>Further Resources</h2>
                <ul>
                    <li><a href="https://prometheus.io/docs/instrumenting/pushing/" target="_blank" rel="noopener noreferrer">Prometheus Pushgateway Documentation</a></li>
                    <li><a href="https://man7.org/linux/man-pages/man1/ps.1.html" target="_blank" rel="noopener noreferrer">Linux ps command man page</a></li>
                    <li><a href="https://grafana.com/docs/" target="_blank" rel="noopener noreferrer">Grafana Documentation</a></li>
                </ul>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>