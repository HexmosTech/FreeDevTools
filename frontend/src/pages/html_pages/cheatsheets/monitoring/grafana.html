<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grafana Cheatsheet - Monitoring & Visualization Guide</title>
    <meta name="description" content="Comprehensive Grafana cheatsheet covering dashboards, tutorials, and datasources like CloudWatch, Elasticsearch, MySQL, Prometheus, and Loki. Optimize your monitoring setup.">
    <meta name="keywords" content="grafana, cheatsheet, monitoring, visualization, dashboards, cloudwatch, elasticsearch, mysql, prometheus, loki, data source, queries, variables">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://yourdomain.com/monitoring/grafana.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/monitoring/grafana.html">
    <meta property="og:title" content="Grafana Cheatsheet - Monitoring & Visualization Guide">
    <meta property="og:description" content="Comprehensive Grafana cheatsheet covering dashboards, tutorials, and datasources like CloudWatch, Elasticsearch, MySQL, Prometheus, and Loki. Optimize your monitoring setup.">
    <meta property="og:image" content="https://yourdomain.com/path/to/your/grafana-og-image.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://yourdomain.com/monitoring/grafana.html">
    <meta name="twitter:title" content="Grafana Cheatsheet - Monitoring & Visualization Guide">
    <meta name="twitter:description" content="Comprehensive Grafana cheatsheet covering dashboards, tutorials, and datasources like CloudWatch, Elasticsearch, MySQL, Prometheus, and Loki. Optimize your monitoring setup.">
    <meta name="twitter:image" content="https://yourdomain.com/path/to/your/grafana-twitter-image.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Grafana Cheatsheet</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <h1>Grafana Cheatsheet - Monitoring & Visualization Guide</h1>
                <p>This cheatsheet provides quick reference for using Grafana for monitoring and data visualization. It covers essential aspects from dashboards and tutorials to specific datasource configurations and query examples.</p>
                
                <h2>Grafana Overview and Navigation</h2>
                <ul>
                    <li><a href="#dashboards">Dashboards</a></li>
                    <li><a href="#tutorials">Tutorials</a></li>
                </ul>

                <h2>Datasource Configurations</h2>
                <h3>CloudWatch Datasource</h3>
                <ul>
                    <li><a href="#datasource-cloudwatch">CloudWatch Datasource Setup</a></li>
                    <li><a href="#variables-for-cloudWatch">CloudWatch Variables</a></li>
                    <li><a href="#cloudwatch-queries">CloudWatch Queries</a></li>
                </ul>

                <h3>Elasticsearch Datasource</h3>
                <ul>
                    <li><a href="#datasource-elasticsearch">Elasticsearch Datasource Setup</a></li>
                    <li><a href="#variables-for-elasticsearch">Elasticsearch Variables</a></li>
                </ul>

                <h3>MySQL Datasource</h3>
                <ul>
                    <li><a href="#datasource-mysql">MySQL Datasource Setup</a></li>
                    <li><a href="#variables-for-mysql">MySQL Variables</a></li>
                    <li><a href="#mysql-queries">MySQL Queries</a></li>
                </ul>

                <h3>Prometheus Datasource</h3>
                <ul>
                    <li><a href="#prometheus-datasource">Prometheus Datasource Setup</a></li>
                    <li><a href="#prometheus-variables">Prometheus Variables</a></li>
                    <li><a href="#prometheus-queries">Prometheus Queries</a></li>
                    <li><a href="#tables-for-prometheus">Prometheus Tables</a></li>
                </ul>

                <h3>Loki Datasource</h3>
                <ul>
                    <li><a href="#loki-datasource">Loki Datasource Setup</a></li>
                    <li><a href="#loki-variables">Loki Variables</a></li>
                    <li><a href="#loki-queries">Loki Queries</a></li>
                </ul>

                <h2>Dashboards</h2>
                <p>Discover pre-built dashboards to accelerate your monitoring setup.</p>
                <ul>
                    <li><a href="https://grafana.com/grafana/dashboards/12019">Loki Dashboard Example</a></li>
                    <li><a href="https://grafana.com/grafana/dashboards/4701">JVM Micrometer Dashboard</a></li>
                </ul>

                <h2>Tutorials and Resources</h2>
                <p>Explore helpful tutorials and documentation to deepen your Grafana knowledge.</p>
                <ul>
                    <li><a href="https://sbcode.net/grafana/">sbcode Grafana Tutorials</a></li>
                    <li><a href="https://grafana.com/docs/">Official Grafana Documentation</a></li>
                </ul>

                <h2>Datasource: CloudWatch</h2>
                <p>Configure and query AWS CloudWatch metrics within Grafana.</p>
                <h3>Variables for CloudWatch</h3>
                <p>Utilize CloudWatch variables to dynamically filter and select data in your dashboards.</p>
                <p>Documentation: </p>
                <ul>
                    <li><a href="https://grafana.com/docs/grafana/latest/features/datasources/cloudwatch/">Grafana CloudWatch Datasource Docs</a></li>
                    <li><a href="https://grafana.com/docs/grafana/latest/datasources/aws-cloudwatch/#query-variable">Grafana CloudWatch Query Variables</a></li>
                </ul>
                <p>Overview:</p>
                <p>The <code>Name</code> field allows you to use it as a variable, example:</p>
                <pre><code class="language-bash">Name: region
Type: Query
Label: Region
Query: regions()
</code></pre>

                <p>This will display "Region" in Grafana, and you can use a variable <code>$region</code> to select the value from the <code>Region</code> selector.</p>
                <p>AWS Regions:</p>
                <pre><code class="language-bash">Query: regions()
</code></pre>

                <p>AutoScaling Group:</p>
                <pre><code class="language-bash">Query: dimension_values($region,AWS/EC2,CPUUtilization,AutoScalingGroupName)
</code></pre>

                <p>EC2 Instance Tag Names:</p>
                <pre><code class="language-bash">Name: instancename
Query: ec2_instance_attribute($region, Tags.Name, {})
</code></pre>

                <p>EC2 Instance ID from Tag Name:</p>
                <pre><code class="language-bash">Name: instanceid
Query: ec2_instance_attribute($region, InstanceId, {"tag:Name": ["$instancename"]})
</code></pre>

                <p>EC2 InstanceId from Tag Name (filtered):</p>
                <pre><code class="language-bash">Query: ec2_instance_attribute(eu-west-1, Tags.Name, {"tag:Name":["prod-*"]}) 
</code></pre>

                <p>EC2 InstanceId from Tag Name (filtered):</p>
                <pre><code class="language-bash">Query: ec2_instance_attribute(eu-west-1, InstanceId, {"tag:ASG":["my-app-asg"]}) 
</code></pre>

                <p>EBS VolumeId from InstanceId:</p>
                <pre><code class="language-bash">Query: ebs_volume_ids($region, $instanceid)
</code></pre>

                <p>ECS Cluster Name:</p>
                <pre><code class="language-bash">Query: dimension_values($region,AWS/ECS,CPUUtilization,ClusterName)
</code></pre>

                <p>ECS Service Name:</p>
                <pre><code class="language-bash">Query: dimension_values($region,AWS/ECS,CPUUtilization,ServiceName)
</code></pre>

                <p>RDS Cluster Name:</p>
                <pre><code class="language-bash">Query: dimension_values($region,AWS/RDS,CPUUtilization,DBClusterIdentifier)
</code></pre>

                <p>RDS Instance Name:</p>
                <pre><code class="language-bash">Query: dimension_values($region,AWS/RDS,CPUUtilization,DBInstanceIdentifier)
</code></pre>

                <p>CloudWatch Logs, LogGroup Names:</p>
                <pre><code class="language-bash">Query: dimension_values($region,AWS/Logs, IncomingBytes,LogGroupName)
</code></pre>

                <h3>CloudWatch Queries</h3>
                <p>Leverage CloudWatch Logs Query Syntax for advanced log analysis.</p>
                <p>Using CloudWatch Logs <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_QuerySyntax.html">Query Syntax</a>:</p>
                <pre><code class="language-sql">fields @timestamp, @message, @log, @logStream
| sort @timestamp desc
| limit 30
</code></pre>

                <h2>Datasource: Elasticsearch</h2>
                <p>Integrate Elasticsearch for log analysis and time-series data visualization.</p>
                <ul>
                    <li><a href="https://grafana.com/blog/2016/03/09/how-to-effectively-use-the-elasticsearch-data-source-in-grafana-and-solutions-to-common-pitfalls/">Effective Elasticsearch Usage in Grafana</a></li>
                </ul>
                <h3>Variables for Elasticsearch</h3>
                <p>Create dynamic variables for Elasticsearch queries.</p>
                <p>Domain Name:</p>
                <pre><code class="language-json">{"find": "terms", "field": "domain_name.keyword"}
</code></pre>

                <p>Domain Name (Filtered Results):</p>
                <pre><code class="language-json">{"find": "terms", "field": "domain_name.keyword", "query": "domain_name: *.mydomain.com"}
</code></pre>

                <p>2 Variables, ALB and Domain Name (domain name results filtered based on the alb that you select / should be in correct order):</p>
                <pre><code class="language-json">alb_name:
{"find": "terms", "field": "alb_name.keyword"}

domain_name:
{"find": "terms", "field": "domain_name.keyword", "query": "domain_name: *.mydomain.com AND alb_name:$alb_name.keyword"}
</code></pre>

                <h2>Datasource: MySQL</h2>
                <p>Connect Grafana to MySQL databases for data visualization.</p>
                <h3>Variables for MySQL</h3>
                <p>Define variables for dynamic MySQL queries.</p>
                <p>Name: <code>status</code>
                Label: <code>Status</code>
                Type: <code>Query</code>
                Datasource: <code>MySQL</code>
                Query: <code>SELECT status FROM mytable</code></p>
                <p>To use a regex to filter out any NULLs:</p>
                <pre><code class="language-regex"># this will only return results with letters/numbers
/([a-zA-Z0-9\.]+)/  
</code></pre>

                <h3>Queries for MySQL</h3>
                <p>Examples of Grafana queries for MySQL panels.</p>
                <p>Gauge:</p>
                <pre><code class="language-sql">SELECT 
country,
SUM(cnt) AS total,
NOW() AS time
FROM mytable
WHERE status = ${status}
GROUP BY country
</code></pre>

                <p>Bar Gauge:</p>
                <pre><code class="language-sql">SELECT NOW() AS time, count(*) as cnt, CONCAT(name,', ',surname,', ',country) AS entity FROM mytable 
WHERE status = "PENDING"
AND name REGEXP '${name:pipe}' 
AND surname REGEXP '${surname:pipe}'
AND country REGEXP '${country:pipe}'
GROUP BY CONCAT(name,', ',surname,', ',country)
</code></pre>

                <p>Table Panel:</p>
                <pre><code class="language-sql">SELECT name, surname, country, status, pending_time from mytable
WHERE status = "PENDING"
AND name REGEXP '${name:pipe}' 
AND surname REGEXP '${surname:pipe}'
AND country REGEXP '${country:pipe}'
</code></pre>

                <h2>Prometheus: Datasource</h2>
                <p>Integrate Prometheus for time-series monitoring data.</p>
                <h3>Variables for Prometheus</h3>
                <p>Create dynamic variables for Prometheus queries.</p>
                <p><strong>Basics</strong></p>
                <p>Example: Define a <code>jobs</code> variable based on the <code>up</code> metric.</p>
                <pre><code class="language-promql">up{cluster_name="cluster-a",instance="1.1.1.1:443",job="container-metrics"}
up{cluster_name="cluster-b=",instance="1.1.1.1:443",job="node-metrics"}
</code></pre>

                <p>Add a variable with the following configuration:</p>
                <pre><code class="language-yaml">Name: jobs
Label: Jobs
Query: label_values(up, job)
Datasource: Prometheus
</code></pre>

                <p>This will produce <code>container-metrics</code> and <code>node-metrics</code>. In your dashboard query, you can select them using:</p>
                <pre><code class="language-promql">up{job=~"$job"}
</code></pre>

                <p><strong>Filtered Variables</strong></p>
                <p>Example: Display jobs only from <code>cluster-b</code> and name the variable <code>cluster_b_jobs</code>.</p>
                <pre><code class="language-promql">label: cluster_b_jobs
label_values(up{cluster_name="cluster-b"}, job)
</code></pre>

                <p>You can use this variable to filter further, e.g., <code>label_values(metric{jobs=~"$cluster_b_jobs"}, some_label)</code>. This is useful for getting environments and then filtering on resources.</p>
                <p><strong>Regex Filtering</strong></p>
                <p>Example: Filter job results to display only those matching a pattern.</p>
                <p>Current job results:</p>
                <pre><code class="language-text">qa/nginx
qa/app
qa/app-syslog
qa/app-deploy
prod/app
prod/app-syslog
prod/app-deploy
</code></pre>

                <p>To display {env}/app, use the following query and regex:</p>
                <p>Query: </p>
                <pre><code class="language-promql">label_values(labels, job)
</code></pre>

                <p>Regex: </p>
                <pre><code class="language-regex">/^(.*app)/
</code></pre>

                <p>This results in:</p>
                <pre><code class="language-text">qa/app
prod/app
</code></pre>

                <p>To get everything after the <code>/</code>:</p>
                <pre><code class="language-regex">/.*(.*app.*).*/
</code></pre>

                <p>Which will result in:</p>
                <pre><code class="language-text">app
app-syslog 
app-deploy
</code></pre>

                <p>For an example where you want to return everything up until the numbers:</p>
                <pre><code class="language-text">ecs-prod-app-10-container-12345
ecs-dev-app-12-container-12345
</code></pre>

                <p>You can use:</p>
                <pre><code class="language-regex">/^(.*?)-[0-9]/
</code></pre>

                <p>Which will result in:</p>
                <pre><code class="language-text">ecs-prod-app
ecs-dev-app
</code></pre>

                <p>For Kubernetes namespaces:</p>
                <p>Name: <code>container</code>
                Label: <code>container</code>
                Query: <code>kube_pod_container_info{namespace="$namespace"}</code>
                Regex: <code>/.*container="([^"]*).*/</code>
                Datasource: <code>Prometheus</code></p>
                <p>For Kubernetes containers:</p>
                <p>Name: <code>namespace</code>
                Label: <code>namespace</code>
                Query: <code>query_result(kube_namespace_labels)</code>
                Regex: <code>/.*namespace="([^"]*).*/</code>
                Datasource: <code>Prometheus</code></p>
                <h3>Queries for Prometheus</h3>
                <p>Explore common Prometheus query patterns for Grafana panels.</p>
                <h3>Tables for Prometheus</h3>
                <p>Utilize data links in Grafana to create interactive tables and link to external resources.</p>
                <p>Using datalinks in Grafana, to parse values in your url you can use <code>$__cell_0</code> and if you need to do some formatting you can use <code>${__cell_3:raw}</code>, like below:</p>
                <pre><code class="language-html">https://gitlab.com/${__cell_3:raw}/-/pipelines/$__cell_7
</code></pre>

                <p>Resources:</p>
                <ul>
                    <li><a href="https://grafana.com/docs/grafana/next/panels/configure-data-links/">Grafana Data Links Documentation</a></li>
                    <li><a href="https://grafana.com/docs/grafana/latest/variables/advanced-variable-format-options/">Grafana Advanced Variable Formatting</a></li>
                </ul>

                <h2>Loki Datasource</h2>
                <p>Integrate Loki for log aggregation and querying.</p>
                <h3>Variables for Loki</h3>
                <p>Create dynamic variables for Loki queries.</p>
                <p><strong>Basics: Jobs</strong></p>
                <p>Example: Define a <code>jobs</code> variable for Loki logs.</p>
                <pre><code class="language-promql">label_values({job=~".+"}, job)
</code></pre>

                <p>Add a variable with the following configuration:</p>
                <pre><code class="language-yaml">Name: job
Label: Jobs
Query: label_values({job=~".+"}, job)
Datasource: Loki
</code></pre>

                <p>This will produce values like <code>systemd-logs</code> and <code>server-logs</code>. In your dashboard query, you can select them using:</p>
                <pre><code class="language-promql">{job=~"$job"}
</code></pre>

                <p><strong>Basics: Name</strong></p>
                <p>Example: Define a <code>name</code> variable for Loki logs.</p>
                <pre><code class="language-promql">label_values({job="server-logs"}, name)
</code></pre>

                <p>Add a variable with the following configuration:</p>
                <pre><code class="language-yaml">Name: name
Label: Name
Query: label_values({job="server-logs"}, name)
Datasource: Loki
</code></pre>

                <p>This will produce values like <code>web-server-01</code> and <code>web-server-02</code>. In your dashboard query, you can select them using:</p>
                <pre><code class="language-promql">{name=~"$name"}
</code></pre>

                <h3>Loki Queries</h3>
                <p>Explore common Loki query patterns for log analysis.</p>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>