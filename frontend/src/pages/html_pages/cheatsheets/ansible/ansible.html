<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible Cheatsheet - Automate Configuration Management</title>
    <meta name="description" content="Ansible Cheatsheet: Automate configuration management, application deployment, and task automation with these Ansible examples. Includes modules, ad hoc commands, and playbooks.">
    <meta name="keywords" content="ansible, cheatsheet, automation, configuration management, playbook, modules, ad hoc commands, infrastructure as code">
    <meta name="author" content="FreeDevTools">
    <link rel="canonical" href="https://freedevtools.com/ansible/ansible.html">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://freedevtools.com/ansible/ansible.html">
    <meta property="og:title" content="Ansible Cheatsheet - Automate Configuration Management">
    <meta property="og:description" content="Ansible Cheatsheet: Automate configuration management, application deployment, and task automation with these Ansible examples. Includes modules, ad hoc commands, and playbooks.">
    <meta property="og:image" content="https://freedevtools.com/ansible/images/ansible-banner.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://freedevtools.com/ansible/ansible.html">
    <meta property="twitter:title" content="Ansible Cheatsheet - Automate Configuration Management">
    <meta property="twitter:description" content="Ansible Cheatsheet: Automate configuration management, application deployment, and task automation with these Ansible examples. Includes modules, ad hoc commands, and playbooks.">
    <meta property="twitter:image" content="https://freedevtools.com/ansible/images/ansible-banner.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ansible Cheatsheets</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
<h2>Ansible Modules</h2>
<p>Ping:</p>
<pre class="codehilite"><code>$ ansible all -m ping
</code></pre>

<h3>Gather Facts</h3>
<p>Gather Facts:</p>
<pre class="codehilite"><code>$ ansible all -m gather_facts
</code></pre>

<p>Gather Facts for only one host:</p>
<pre class="codehilite"><code>$ ansible all -m gather_facts --limit 10.0.0.2
</code></pre>

<h3>List Hosts</h3>
<p>List Hosts:</p>
<pre class="codehilite"><code>$ ansible all --list-hosts
</code></pre>

<h2>Ansible Ad Hoc Commands</h2>
<h3>Update Index Repositories</h3>
<p>Update index repositories with apt</p>
<pre class="codehilite"><code>$ ansible all -m apt -a update_cache=true --become --ask-become-pass
</code></pre>

<h3>Install Packages</h3>
<p>Install packages with apt:</p>
<pre class="codehilite"><code>$ ansible all -m apt -a name=vim --become --ask-become-pass
</code></pre>

<p>Install the latest package with apt:</p>
<pre class="codehilite"><code>$ ansible all -m apt -a &quot;name=vim state=latest&quot; --become --ask-become-pass
</code></pre>

<h3>Upgrade Dist</h3>
<p>Upgrade dist with apt:</p>
<pre class="codehilite"><code>$ ansible all -m apt -a upgrade=dist --become --ask-become-pass
</code></pre>

<h2>Ansible Playbooks</h2>
<ul>
<li><code>install_nginx.yml</code></li>
</ul>
<pre class="codehilite"><code class="language-yaml">---
- hosts: all
  become: true
  tasks:
    - name: install nginx
      apt:
        name: nginx
        state: latest
        update_cache: yes
      when: ansible_distribution in [&quot;Debian&quot;, &quot;Ubuntu&quot;]

    - name: install nginx
      dnf:
        name: nginx
        state: latest
        update_cache: yes
      when: ansible_distribution == &quot;CentOS&quot;
</code></pre>

<p>Execute playbook:</p>
<pre class="codehilite"><code>$ ansible-playbook --ask-become-pass install_nginx.yml
</code></pre>

<h2>Refactoring Ansible Playbooks</h2>
<p>Our <code>inventory</code>:</p>
<pre class="codehilite"><code>10.0.0.2 apache_package=apache2 php_package=libapache2-mod-php
10.0.0.3 apache_package=httpd php_package=php
</code></pre>

<p>Our <code>playbook.yml</code>:</p>
<pre class="codehilite"><code class="language-yaml">---
- hosts: all
  become: true
  tasks:
    - name: install apache
      package:
        name: 
          - &quot;{{ apache_package }}&quot;
          - &quot;{{ php_package }}&quot;
        state: latest
        update_cache: yes
</code></pre>

<h2>Target Specific Nodes in Ansible</h2>
<p>Our <code>inventory</code>:</p>
<pre class="codehilite"><code>[web_servers]
10.0.0.2
10.0.0.3

[db_servers]
10.0.0.4

[file_servers]
10.0.0.5
</code></pre>

<p>Our <code>playbook.yml</code></p>
<pre class="codehilite"><code class="language-yaml">---
# pretasks mandates to run before any other tasks are running
# but ansible runs playbooks from top to bottom
- hosts: all
  become: true
  pre_tasks:
    - name: Install updates for CentOS 
      dnf:
        update_only: yes
        update_cache: yes
      when: ansible_distribution == &quot;CentOS&quot;

    - name: Install updates for Debian/Ubuntu 
      apt:
        upgrade: dist
        update_cache: yes
      when: ansible_distribution in [&quot;Debian&quot;, &quot;Ubuntu&quot;]

# package is used when the name of the package is the same 
# across operating systems
- hosts: web_servers
  become: true
  tasks:
    - name: Install Nginx
      package:
        name:
          - nginx
          - apache2-utils
        state: latest

- hosts: db_servers
  become: true
  tasks:
    - name: Install MariaDB for CentOS 
      dnf:
        name: mariadb-server
        state: latest
      when: ansible_distribution == &quot;CentOS&quot;

    - name: Install MariaDB for Debian/Ubuntu 
      apt:
        name: mariadb
        state: latest
      when: ansible_distribution in [&quot;Debian&quot;, &quot;Ubuntu&quot;]

- hosts: file_servers
  become: true
  tasks:
    - name: Install Samba 
      package:
        name: samba
        state: latest
</code></pre>

<p>Then run it with:</p>

<pre class="codehilite"><code>$ ansible-playbook --ask-become-pass playbook.yml
</code></pre>

<h2>Metadata with Ansible Tags</h2>
<p>Use tags to only target specific targets.</p>
<pre class="codehilite"><code class="language-yaml">---
- hosts: all
  become: true
  pre_tasks:

    - name: Install updates for CentOS 
      tags: always
      dnf:
        update_only: yes
        update_cache: yes
      when: ansible_distribution == &quot;CentOS&quot;

    - name: Install updates for Debian/Ubuntu
      tags: always
      apt:
        upgrade: dist
        update_cache: yes
      when: ansible_distribution in [&quot;Debian&quot;, &quot;Ubuntu&quot;]

- hosts: web_servers
  become: true
  tasks:

    - name: Install Nginx and utilities for CentOS 
      tags: nginx,centos
      dnf:
        name:
          - nginx
          - httpd-tools
      when: ansible_distribution == &quot;CentOS&quot;  

    - name: Install Nginx and utilities for Ubuntu
      tags: nginx,ubuntu
      apt:
        name:
          - nginx
          - apache2-utils
        state: latest
      when: ansible_distribution in [&quot;Debian&quot;, &quot;Ubuntu&quot;]

- hosts: db_servers
  become: true
  tasks:

    - name: Install MariaDB for CentOS 
      tags: centos,db,mariadb
      dnf:
        name: mariadb-server
        state: latest
      when: ansible_distribution == &quot;CentOS&quot;

    - name: Install MariaDB for Debian/Ubuntu
      tags: ubuntu,db,mariadb
      apt:
        name: mariadb
        state: latest
      when: ansible_distribution in [&quot;Debian&quot;, &quot;Ubuntu&quot;]

- hosts: file_servers
  become: true
  tasks:

    - name: Install Samba 
      tags: samba
      package:
        name: samba
        state: latest
</code></pre>

<p>To run the playbook against all targets specified in the playbooks:</p>
<pre class="codehilite"><code class="language-bash">$ ansible-playbook --ask-become-pass playbook.yml
</code></pre>

<p>To list all the tags in the playbook:</p>
<pre class="codehilite"><code class="language-bash">$ ansible-playbook --list-tags playbook.yml

playbook: playbook.yml

  play #1 (all): all  TAGS: []
      TASK TAGS: [always]

  play #2 (web_servers): all  TAGS: []
      TASK TAGS: [nginx, ubuntu, centos]

  play #3 (db_servers): all  TAGS: []
      TASK TAGS: [centos, db, mariadb, ubuntu]

  play #4 (file_servers): all  TAGS: []
      TASK TAGS: [samba]
</code></pre>

<p>To only target the tasks with the ubuntu tag, (note: the updates task will still run due to the <code>always</code> tag):</p>
<pre class="codehilite"><code class="language-bash">$ ansible-playbook --tags ubuntu --ask-become-pass playbook.yml
</code></pre>

<p>For targeting multiple tags:</p>
<pre class="codehilite"><code class="language-bash">$ ansible-playbook --tags &quot;db,ubuntu&quot; --ask-become-pass playbook.yml
</code></pre>

<h2>Ansible Files</h2>
<p>Ansible playbook that uses files to copy to the targets.</p>
<p>Our <code>files/default.html</code>:</p>
<pre class="codehilite"><code class="language-html">&lt;html&gt;
  &lt;body&gt;ok&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Our <code>playbook.yml</code>:</p>
<pre class="codehilite"><code class="language-yaml">---
- hosts: all
  become: true
  pre_tasks:

    - name: Install updates for CentOS 
      tags: always
      dnf:
        update_only: yes
        update_cache: yes
      when: ansible_distribution == &quot;CentOS&quot;

    - name: Install updates for Debian/Ubuntu
      tags: always
      apt:
        upgrade: dist
        update_cache: yes
      when: ansible_distribution in [&quot;Debian&quot;, &quot;Ubuntu&quot;]

- hosts: web_servers
  become: true
  tasks:

    - name: Install Nginx and utilities for CentOS 
      tags: nginx,centos
      dnf:
        name:
          - nginx
          - httpd-tools
      when: ansible_distribution == &quot;CentOS&quot;  

    - name: Install Nginx and utilities for Ubuntu
      tags: nginx,ubuntu
      apt:
        name:
          - nginx
          - apache2-utils
        state: latest
      when: ansible_distribution in [&quot;Debian&quot;, &quot;Ubuntu&quot;]

    - name: Copy default html file for website
      tags: nginx
      copy:
        src: default.html
        dest: /var/www/html/index.html
        owner: root
        group: root
        mode: 0644
</code></pre>

<p>Execute the playbook to deploy the website file:</p>
<pre class="codehilite"><code class="language-bash">$ ansible-playbook --ask-become-pass playbook.yml
</code></pre>

<p>We can use another example to unzip a package:</p>
<pre class="codehilite"><code>---
- hosts: all
  become: true
  pre_tasks:

    - name: Install updates for CentOS 
      tags: always
      dnf:
        update_only: yes
        update_cache: yes
      when: ansible_distribution == &quot;CentOS&quot;

    - name: Install updates for Debian/Ubuntu
      tags: always
      apt:
        upgrade: dist
        update_cache: yes
      when: ansible_distribution in [&quot;Debian&quot;, &quot;Ubuntu&quot;]

- hosts: workstations
  become: true
  tasks:

  - name: Ensure unzip is installed
    package:
      name: unzip

  - name: Ensure terraform is installed
    unarchive:
      src: https://releases.hashicorp.com/terraform/1.1.7/terraform_1.1.7_linux_amd64.zip
      dest: /usr/local/bin
      remote_src: yes
      mode: 0755
      owner: root
      group: root
</code></pre>

<p>And then add the workstations group:</p>
<pre class="codehilite"><code>[web_servers]
10.0.0.2
10.0.0.3

[db_servers]
10.0.0.4

[file_servers]
10.0.0.5

[workstations]
localhost
</code></pre>

<p>Then run the playbook:</p>
<pre class="codehilite"><code class="language-bash">$ ansible-playbook --ask-become-pass playbook.yml
</code></pre>

<h2>Ansible Resources</h2>
<ul>
<li><a href="https://medium.com/@rossbulat/ansible-automating-app-build-and-deployment-from-a-github-repository-7d613985f686" rel="noopener noreferrer nofollow">Automating App Build and Deployment from a Github Repository</a></li>
<li><a href="https://www.youtube.com/watch?v=3RiVKs8GHYQ&amp;list=PLT98CRl2KxKEUHie1m24-wkyHpEsa4Y70&amp;index=1" rel="noopener noreferrer nofollow">Ansible Youtube Series @LearnLinuxTV</a></li>
</ul>
</div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>
