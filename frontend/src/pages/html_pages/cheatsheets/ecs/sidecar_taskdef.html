<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECS Sidecar Task Definition - AWS Container Configuration</title>
    <meta name="description" content="Configure an ECS task definition with a sidecar container for AWS applications. Learn how to define proxy and application containers with environment variables and secrets.">
    <meta name="keywords" content="AWS ECS, task definition, sidecar container, proxy container, application container, container configuration, Docker, AWS IAM, SSM Parameter Store">
    <link rel="canonical" href="https://your-website.com/ecs/sidecar_taskdef.html">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="ECS Sidecar Task Definition - AWS Container Configuration">
    <meta property="og:description" content="Configure an ECS task definition with a sidecar container for AWS applications. Learn how to define proxy and application containers with environment variables and secrets.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-website.com/ecs/sidecar_taskdef.html">
    <meta property="og:image" content="https://your-website.com/images/ecs-sidecar-taskdef-og.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ECS Sidecar Task Definition - AWS Container Configuration">
    <meta name="twitter:description" content="Configure an ECS task definition with a sidecar container for AWS applications. Learn how to define proxy and application containers with environment variables and secrets.">
    <meta name="twitter:image" content="https://your-website.com/images/ecs-sidecar-taskdef-twitter.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AWS ECS Sidecar Task Definition Example</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <p>This page provides an example of an AWS Elastic Container Service (ECS) task definition configured with a sidecar container pattern. This pattern is commonly used to run auxiliary containers alongside your main application container, such as proxies, log collectors, or monitoring agents.</p>

                <h2>Understanding the Sidecar Pattern in ECS</h2>
                <p>The sidecar pattern involves deploying two or more containers within the same ECS task. These containers share the same network namespace and can communicate with each other using <code>localhost</code>. In this example, we define a <code>proxy</code> container that acts as a sidecar to the main <code>app</code> container.</p>

                <h2>ECS Task Definition Structure</h2>
                <p>The task definition below outlines the configuration for an ECS task. It includes essential parameters like the task role, execution role, and compatibility requirements. The core of the definition lies in the <code>containerDefinitions</code> array, where each container's image, resources, environment variables, and secrets are specified.</p>

                <h3>Proxy Container Configuration</h3>
                <p>The <code>proxy</code> container is configured to serve traffic on port 80 and forward requests to the application container at <code>http://app:5000</code>. It also demonstrates how to inject secrets, such as <code>APP_SECRET</code>, from AWS Systems Manager (SSM) Parameter Store.</p>

                <h3>Application Container Configuration</h3>
                <p>The <code>app</code> container is the primary application. It is configured with its own memory reservation and also retrieves database credentials (<code>DB_DATABASE</code>, <code>DB_HOST</code>, <code>DB_PASSWORD</code>, <code>DB_USERNAME</code>) from SSM Parameter Store, showcasing secure secret management.</p>

                <p>This setup is ideal for scenarios where you need to add cross-cutting concerns like request routing, authentication, or centralized logging without modifying the core application code.</p>

                <p>For more information on ECS task definitions, refer to the <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html" target="_blank">AWS ECS Developer Guide</a>.</p>
            </div>
            <pre><code class="language-json">{
  "family": "app-with-sidecar-container",
  "taskRoleArn": "arn:aws:iam::000000000000:role/aws-dev-ecs-task-role",
  "executionRoleArn": "arn:aws:iam::000000000000:role/aws-dev-ecs-exec-role",
  "requiresCompatibilities": [
    "EC2"
  ],
  "containerDefinitions": [
    {
      "name": "proxy",
      "image": "proxy-image:latest",
      "portMappings": [
        {
          "hostPort": 0,
          "protocol": "tcp",
          "containerPort": 80
        }
      ],
      "environment": [
        {
          "name": "APP_URL",
          "value": "http://app:5000"
        }
      ],
      "secrets": [
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:000000000000:parameter/app-with-sidecar-container/dev/APP_SECRET",
          "name": "APP_SECRET"
        }
      ],
      "memoryReservation": 256,
      "stopTimeout": 30,
      "startTimeout": 30,
      "essential": true,
      "links": [
        "app"
      ]
    },
    {
      "name": "app",
      "image": "app-image:latest",
      "memoryReservation": 128,
      "essential": true,
      "secrets": [
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:000000000000:parameter/app-with-sidecar-container/dev/DB_DATABASE",
          "name": "DB_DATABASE"
        },
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:000000000000:parameter/app-with-sidecar-container/dev/DB_HOST",
          "name": "DB_HOST"
        },
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:000000000000:parameter/app-with-sidecar-container/dev/DB_PASSWORD",
          "name": "DB_PASSWORD"
        },
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:000000000000:parameter/app-with-sidecar-container/dev/DB_USERNAME",
          "name": "DB_USERNAME"
        }
      ]
    }
  ]
}</code></pre>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>