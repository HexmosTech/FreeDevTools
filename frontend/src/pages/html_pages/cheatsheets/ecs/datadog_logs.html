<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datadog Logs Configuration for ECS</title>
    <meta name="description" content="Configure Datadog logs for your ECS Fargate services with this comprehensive JSON example. Learn how to set up log drivers, environment variables, and secrets for effective log collection.">
    <meta name="keywords" content="Datadog logs, ECS, Fargate, AWS, log configuration, JSON, fluent-bit, awslogs, container logs, monitoring, observability">
    <link rel="canonical" href="https://your-website.com/ecs/datadog_logs.html">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Datadog Logs Configuration for ECS">
    <meta property="og:description" content="Configure Datadog logs for your ECS Fargate services with this comprehensive JSON example. Learn how to set up log drivers, environment variables, and secrets for effective log collection.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://your-website.com/ecs/datadog_logs.html">
    <meta property="og:image" content="https://your-website.com/images/datadog-ecs-logs.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Datadog Logs Configuration for ECS">
    <meta name="twitter:description" content="Configure Datadog logs for your ECS Fargate services with this comprehensive JSON example. Learn how to set up log drivers, environment variables, and secrets for effective log collection.">
    <meta name="twitter:image" content="https://your-website.com/images/datadog-ecs-logs.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.8em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Datadog Logs Configuration for ECS</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <p>This document provides a sample AWS ECS task definition for configuring Datadog logs. It demonstrates how to integrate Datadog's logging capabilities with your containerized applications running on AWS Elastic Container Service (ECS), particularly with Fargate.</p>

                <h2>Understanding Datadog Log Configuration in ECS</h2>
                <p>Effective log management is crucial for monitoring and debugging applications. This configuration leverages AWS FireLens, a container log router for Amazon ECS and AWS Fargate, to send logs to Datadog. FireLens uses Fluent Bit or Fluentd as the log router, allowing for flexible log processing and routing.</p>

                <h2>Key Components of the Configuration</h2>
                <p>The provided JSON defines an ECS task. Here are the essential parts related to Datadog logging:</p>

                <h3>Container Definitions</h3>
                <p>The task definition includes multiple container definitions:</p>
                <ul>
                    <li><strong>Application Container (e.g., <code>eng-my-service-api</code>):</strong> This is your primary application. It's configured to send logs to the log router.</li>
                    <li><strong>Datadog Agent Container (<code>datadog</code>):</strong> This container runs the Datadog Agent, responsible for collecting and forwarding logs and metrics to Datadog.</li>
                    <li><strong>Log Router Container (<code>log_router</code>):</strong> This container, typically using <code>aws-for-fluent-bit</code>, acts as the intermediary, collecting logs from other containers and routing them to the specified destination (Datadog in this case).</li>
                </ul>

                <h3>Log Drivers and Options</h3>
                <p>The configuration specifies different log drivers:</p>
                <ul>
                    <li><strong><code>awsfirelens</code>:</strong> Used for the application container to route logs through FireLens.</li>
                    <li><strong><code>awslogs</code>:</strong> Used for the Datadog Agent container to send its own logs to AWS CloudWatch Logs for debugging.</li>
                </ul>
                <p>Specific options within the <code>logConfiguration</code> block define how logs are handled, including the Datadog endpoint, service name, source, and tags.</p>

                <h3>Environment Variables and Secrets</h3>
                <p>Environment variables are used to configure the Datadog Agent and application, such as enabling Datadog features (<code>DD_ENABLED</code>, <code>DD_LOGS_ENABLED</code>), setting the Datadog site (<code>DD_SITE</code>), and specifying tags (<code>DD_TAGS</code>). Secrets, such as the Datadog API and App keys, are securely managed using AWS Systems Manager Parameter Store.</p>

                <h2>Example Task Definition JSON</h2>
                <pre><code class="language-json">{
  "family": "my-service",
  "executionRoleArn": "arn:aws:iam::xxxxxxxxxxxx:role/ecs-my-service-execution-role",
  "taskRoleArn": "arn:aws:iam::xxxxxxxxxxxx:role/ecs-my-service-task-role",
  "cpu": "512",
  "memory": "1024",
  "containerDefinitions": [
    {
      "name": "eng-my-service-api",
      "image": "xxxxxxxxxxxx.dkr.ecr.eu-west-1.amazonaws.com/my-service-api:latest",
      "essential": true,
      "cpu": 0,
      "memoryReservation": 128,
      "portMappings": [
        {
          "hostPort": 8080,
          "protocol": "tcp",
          "containerPort": 8080
        }
      ],
      "environment": [
        {
          "name": "AWS_REGION",
          "value": "eu-west-1"
        },
        {
          "name": "DD_ENABLED",
          "value": "true"
        },
        {
          "name": "DD_HOST",
          "value": "https://api.datadoghq.eu"
        },
        {
          "name": "DD_TAGS",
          "value": "env:dev"
        }
      ],
      "secrets": [
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:xxxxxxxxxxxx:parameter/my-service-api/dev/DD_API_KEY",
          "name": "DD_API_KEY"
        },
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:xxxxxxxxxxxx:parameter/my-service-api/dev/DD_APP_KEY",
          "name": "DD_APP_KEY"
        }
      ],
      "logConfiguration": {
        "logDriver": "awsfirelens",
        "secretOptions": [
          {
            "valueFrom": "arn:aws:ssm:eu-west-1:xxxxxxxxxxxx:parameter/my-service-api/dev/DD_API_KEY",
            "name": "apikey"
          }
        ],
        "options": {
          "Name": "datadog",
          "Host": "http-intake.logs.datadoghq.eu",
          "provider": "ecs",
          "dd_message_key": "log",
          "dd_service": "my-service-api",
          "dd_source": "fargate",
          "dd_tags": "project:my-service-api"
        }
      }
    },
    {
      "name": "datadog",
      "image": "datadog/agent:7",
      "essential": true,
      "cpu": 10,
      "environment": [
        {
          "name": "DD_APM_ENABLED",
          "value": "true"
        },
        {
          "name": "DD_DOGSTATSD_NON_LOCAL_TRAFFIC",
          "value": "true"
        },
        {
          "name": "DD_LOGS_CONFIG_CONTAINER_COLLECT_ALL",
          "value": "true"
        },
        {
          "name": "DD_LOGS_ENABLED",
          "value": "true"
        },
        {
          "name": "DD_SITE",
          "value": "datadoghq.eu"
        },
        {
          "name": "ECS_FARGATE",
          "value": "true"
        }
      ],
      "secrets": [
        {
          "valueFrom": "arn:aws:ssm:eu-west-1:xxxxxxxxxxxx:parameter/my-service-api/dev/DD_API_KEY",
          "name": "DD_API_KEY"
        }
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/datadog",
          "awslogs-create-group": "true",
          "awslogs-region": "eu-west-1",
          "awslogs-stream-prefix": "my-service-api"
        }
      }
    },
    {
      "name": "log_router",
      "essential": true,
      "cpu": 0,
      "image": "906394416424.dkr.ecr.eu-west-1.amazonaws.com/aws-for-fluent-bit:latest",
      "firelensConfiguration": {
        "type": "fluentbit"
      }
    }
  ],
  "requiresCompatibilities": [
    "FARGATE"
  ],
  "networkMode": "awsvpc"
}</code></pre>

                <h2>Further Resources</h2>
                <ul>
                    <li><a href="https://docs.datadoghq.com/agent/docker/?tab=docker" target="_blank" rel="noopener noreferrer">Datadog Agent Docker Documentation</a></li>
                    <li><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/FireLens.html" target="_blank" rel="noopener noreferrer">AWS FireLens Documentation</a></li>
                    <li><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html" target="_blank" rel="noopener noreferrer">ECS Task Definition Parameters</a></li>
                </ul>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>