<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Log Retention Updater - Automate CloudWatch Log Retention</title>
    <meta name="description" content="Easily update and automate CloudWatch log retention policies with this Python script. Manage AWS log lifecycles efficiently.">
    <meta name="keywords" content="AWS, CloudWatch, logs, retention, Python, script, automation, cloud, log management, update retention policy">
    <meta name="author" content="Hexmos">
    <link rel="canonical" href="https://example.com/aws-python/update_log_retention.html">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://example.com/aws-python/update_log_retention.html">
    <meta property="og:title" content="AWS Log Retention Updater - Automate CloudWatch Log Retention">
    <meta property="og:description" content="Easily update and automate CloudWatch log retention policies with this Python script. Manage AWS log lifecycles efficiently.">
    <meta property="og:image" content="https://example.com/aws-python/images/update_log_retention_banner.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://example.com/aws-python/update_log_retention.html">
    <meta property="twitter:title" content="AWS Log Retention Updater - Automate CloudWatch Log Retention">
    <meta property="twitter:description" content="Easily update and automate CloudWatch log retention policies with this Python script. Manage AWS log lifecycles efficiently.">
    <meta property="twitter:image" content="https://example.com/aws-python/images/update_log_retention_banner.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .external-link {
            color: #007bff;
            text-decoration: none;
        }
        .external-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AWS Log Retention Updater</h1>
        </div>
        <div class="content">
            <p>This Python script automates the process of updating log retention policies in AWS CloudWatch. It iterates through your log groups and sets a specified retention period for those without an existing policy.</p>

            <h2>Python Script to Update Log Retention</h2>
            <pre><code class="language-python">#!/usr/bin/env python3

import boto3
import time 

aws_profile = 'default'
aws_region = 'eu-west-1'
retention_in_days_number = 5

cwlogs = boto3.Session(profile_name=aws_profile, region_name=aws_region).client('logs')

def list_log_groups(limit_number):
    response = cwlogs.describe_log_groups(limit=limit_number)
    return response['logGroups']

def update_retention(log_group_name, retention_in_days):
    response = cwlogs.put_retention_policy(
        logGroupName=log_group_name, 
        retentionInDays=retention_in_days
    )
    return response

paginator = cwlogs.get_paginator('describe_log_groups')

updated_log_groups = 0

for response in paginator.paginate():
    for log_group in response['logGroups']:
        if 'retentionInDays' not in log_group.keys():
            print("X {loggroup} has no retention policy set, and setting to 5 days".format(loggroup=log_group['logGroupName']))
            update_response = update_retention(log_group['logGroupName'], retention_in_days_number)
            print("RequestID: {rid}, StatusCode: {sc}".format(rid=update_response['ResponseMetadata']['RequestId'], sc=update_response['ResponseMetadata']['HTTPStatusCode']))
            updated_log_groups += 1
            time.sleep(1)
    
print("Updated {count} log groups to the retention on {num} days".format(count=updated_log_groups, num=retention_in_days_number))
            
</code></pre>

            <h2>How to Use the AWS Log Retention Script</h2>
            <p>To use this script, you'll need to have the AWS CLI configured with the necessary credentials and the boto3 library installed.  Modify the <code>aws_profile</code> and <code>aws_region</code> variables to match your AWS environment.  The <code>retention_in_days_number</code> variable sets the default retention period in days.</p>

            <h3>Prerequisites</h3>
            <ul>
                <li>AWS CLI configured with appropriate credentials</li>
                <li>boto3 Python library installed (<code>pip install boto3</code>)</li>
            </ul>

            <h3>Running the Script</h3>
            <ol>
                <li>Save the script to a file, e.g., <code>update_retention.py</code>.</li>
                <li>Run the script from your terminal: <code>python update_retention.py</code></li>
            </ol>

            <h2>Understanding CloudWatch Log Retention</h2>
            <p>CloudWatch Logs retention policies determine how long your log data is stored. Setting appropriate retention periods helps manage costs and ensures compliance with data retention requirements.  For more information, refer to the <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html" class="external-link" target="_blank" rel="noopener noreferrer">AWS CloudWatch Logs documentation</a>.</p>

            <p>This script uses the <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/logs.html" class="external-link" target="_blank" rel="noopener noreferrer">boto3 library</a> to interact with the CloudWatch Logs API.  It specifically uses the <code>describe_log_groups</code> and <code>put_retention_policy</code> methods.</p>

            <h2>Additional Resources</h2>
            <ul>
                <li><a href="https://aws.amazon.com/cloudwatch/" class="external-link" target="_blank" rel="noopener noreferrer">Amazon CloudWatch Official Page</a></li>
                <li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli_configure_files.html" class="external-link" target="_blank" rel="noopener noreferrer">Configuring the AWS CLI</a></li>
            </ul>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>
