<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS CodeBuild Buildspec with SSM - Secure Parameter Management</title>
    <meta name="description" content="Securely manage parameters in your AWS CodeBuild buildspec using SSM. Learn how to access Docker Hub credentials and ECR for automated deployments.">
    <meta name="keywords" content="AWS CodeBuild, SSM, buildspec, parameter store, Docker Hub, ECR, CI/CD, DevOps, automation">
    <meta name="author" content="Hexmos">
    <link rel="canonical" href="https://example.com/aws-codebuild/buildspec-with-ssm.html">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://example.com/aws-codebuild/buildspec-with-ssm.html">
    <meta property="og:title" content="AWS CodeBuild Buildspec with SSM - Secure Parameter Management">
    <meta property="og:description" content="Securely manage parameters in your AWS CodeBuild buildspec using SSM. Learn how to access Docker Hub credentials and ECR for automated deployments.">
    <meta property="og:image" content="https://example.com/aws-codebuild/images/buildspec-ssm-banner.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://example.com/aws-codebuild/buildspec-with-ssm.html">
    <meta property="twitter:title" content="AWS CodeBuild Buildspec with SSM - Secure Parameter Management">
    <meta property="twitter:description" content="Securely manage parameters in your AWS CodeBuild buildspec using SSM. Learn how to access Docker Hub credentials and ECR for automated deployments.">
    <meta property="twitter:image" content="https://example.com/aws-codebuild/images/buildspec-ssm-banner.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h2 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h2, .markdown-content h3, .markdown-content h4 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>Buildspec With Ssm</h2>
        </div>
        <div class="content">
            <p>This buildspec demonstrates how to securely manage sensitive information, such as Docker Hub credentials, using AWS Systems Manager Parameter Store (SSM) within an AWS CodeBuild environment. This approach enhances security by avoiding hardcoding credentials directly into your build scripts.</p>

            <h3>Buildspec Configuration</h3>
            <p>The following YAML configuration outlines the build process, including environment setup, authentication with Docker Hub and ECR, building and tagging Docker images, and pushing them to the respective repositories.</p>

            <pre><code class="language-yaml">version: 0.2

env:
  environment:
    aws_region: "eu-west-1"
    container_name: "test"
    repository_url: "xxxxxxxxxxxx"
  parameter-store:
    dockerhub_username: "/devops/dev/DOCKERHUB_USERNAME"
    dockerhub_password: "/devops/dev/DOCKERHUB_PASSWORD"

phases:
  pre_build:
    commands:
      - echo logging into Dockerhub as upstream not yet using gallery.ecr.aws
      - docker login -u $dockerhub_username -p $dockerhub_password
      - echo logging into ECR
      - $(aws ecr get-login --region $aws_region --no-include-email)
      - REPOSITORY_URI=${repository_url}
      - IMAGE_TAG=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)
  build:
    commands:
      - echo build started on $(date)
      - docker build -t $REPOSITORY_URI:latest .
      - docker tag $REPOSITORY_URI:latest $REPOSITORY_URI:$IMAGE_TAG
  post_build:
    commands:
      - echo build completed on $(date)
      - echo pushing the docker images
      - docker push $REPOSITORY_URI:latest
      - docker push $REPOSITORY_URI:$IMAGE_TAG
      - echo writing image definitions file for deployment
      - printf '[{"name":"$container_name","imageUri":"%s"}]' $REPOSITORY_URI:$IMAGE_TAG &gt; imagedefinitions.json
    
artifacts:
  files: imagedefinitions.json
</code></pre>

            <h3>Key Components Explained</h3>
            <h4>Environment Variables</h4>
            <p>The <code>env</code> section defines environment variables, including the AWS region, container name, and repository URL. Critically, it also specifies the parameters to retrieve from SSM Parameter Store.</p>

            <h4>SSM Parameter Store Integration</h4>
            <p>The <code>parameter-store</code> section maps environment variables to SSM parameters. This allows CodeBuild to securely retrieve sensitive information at runtime.</p>

            <h4>Build Phases</h4>
            <p>The <code>phases</code> section outlines the build process:</p>
            <ul>
                <li><code>pre_build</code>: Logs into Docker Hub and ECR using credentials retrieved from SSM.</li>
                <li><code>build</code>: Builds and tags the Docker image.</li>
                <li><code>post_build</code>: Pushes the Docker images to Docker Hub and ECR, and creates an <code>imagedefinitions.json</code> file for deployment.</li>
            </ul>

            <h4>Artifacts</h4>
            <p>The <code>artifacts</code> section specifies the files to be included in the build output, in this case, the <code>imagedefinitions.json</code> file.</p>

            <h3>External Resources</h3>
            <ul>
                <li><a href="https://docs.aws.amazon.com/codebuild/latest/userguide/build-spec-ref.html" target="_blank">AWS CodeBuild Buildspec Reference</a></li>
                <li><a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" target="_blank">AWS Systems Manager Parameter Store</a></li>
                <li><a href="https://docs.docker.com/engine/reference/commandline/login/" target="_blank">Docker Login Documentation</a></li>
            </ul>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>
