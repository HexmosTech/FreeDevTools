<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Views</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Views</h1>
        </div>
        <div class="content">
            <div class="markdown-content"><h3>Views</h3>
<p>There are many options for creating views for your API, it really depends on your API's requirements or personal preference.</p>
<p>We'll write a <code>post_list</code> view with <code>GET</code> and <code>POST</code> methods for reading and creating new <a href="#base-example-model">Post</a> instances.</p>
<h4>Using Function-based views:</h4>
<pre class="codehilite"><code class="language-python">from rest_framework.decorators import api_view
from rest_framework.response import Response
from rest_framework.parsers import JSONParser
from rest_framework import status
from posts.models import Post
from posts.serializers import PostSerializer

@api_view(['GET', 'POST'])
def post_list(request, format=None):

    if request.method == 'GET':
        posts = Post.objects.all()
        serializer = PostSerializer(posts, many=True)
        return Response(serializer.data)

    elif request.method == 'POST':
        data = JSONParser().parse(request)
        serializer = PostSerializer(data=data)

        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
</code></pre>

<h4>Using Class-based views:</h4>
<pre class="codehilite"><code class="language-python">from rest_framework.response import Response
from rest_framework import status
from rest_framework.views import APIView
from posts.models import Post
from posts.serializers import PostSerializer


class PostList(APIView):
    def get(self, request, format=None):
        snippets = Post.objects.all()
        serializer = PostSerializer(snippets, many=True)
        return Response(serializer.data)

    def post(self, request, format=None):
        serializer = PostSerializer(data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)

        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
</code></pre>

<h4>Using Generic Class-based views:</h4>
<pre class="codehilite"><code class="language-python">from rest_framework import generics
from posts.models import Post
from posts.serializers import PostSerializer


class PostList(generics.ListCreateAPIView):
    queryset = Post.objects.all()
    serializer_class = PostSerializer
</code></pre>

<h4>Using Mixins:</h4>
<pre class="codehilite"><code class="language-python">from rest_framework import generics, mixins
from posts.models import Post
from posts.serializers import PostSerializer


class PostList(generics.GenericAPIView,
               mixins.ListModelMixin,
               mixins.CreateModelMixin
               ):
    queryset = Post.objects.all()
    serializer_class = PostSerializer

    def get(self, request, *args, **kwargs):
        return self.list(request, *args, **kwargs)

    def post(self, request, *args, **kwargs):
        return self.create(request, *args, **kwargs)
</code></pre>

<h4>Using ViewSets:</h4>
<p>With <code>ModelViewSet</code> (in this case), you don't have to create separate views for getting list of objects and detail of one object. ViewSet will handle it for you in a consistent way for both methods.</p>
<pre class="codehilite"><code class="language-python">from rest_framework import viewsets
from posts.models import Post
from posts.serializers import PostSerializer


class PostViewSet(viewsets.ModelViewSet):
    &quot;&quot;&quot;
    A viewset for viewing and editing post instances.
    &quot;&quot;&quot;
    queryset = Post.objects.all()
    serializer_class = PostSerializer
</code></pre>

<p>So basically, this would not only generate the <code>list</code> view, but also the <code>detail</code> view for every <a href="#base-example-model">Post</a> instance.</p>
<h5>Routers</h5>
<p>Routers in ViewSets allow the URL configuration for your API to be automatically generated using naming standards.</p>
<pre class="codehilite"><code class="language-python">from rest_framework.routers import DefaultRouter
from posts.views import PostViewSet

router = DefaultRouter()
router.register(r'users', UserViewSet)
urlpatterns = router.urls
</code></pre>

<h5>Custom Actions in ViewSets</h5>
<p>DRF provides helpers to add custom actions for <em>ad-hoc</em> behaviours with the <code>@action</code> decorator. The router will configure its url accordingly.
For example, we can add a <code>comments</code> action in the our <code>PostViewSet</code> to retrieve all the comments of a specific post as follows:</p>
<p>```python
from rest_framework import viewsets
from rest_framework.decorators import action
from posts.models import Post
from posts.serializers import PostSerializer, CommentSerializer</p>
<p>class PostViewSet(viewsets.ModelViewSet):
    ...</p>
<pre class="codehilite"><code>@action(methods=['get'], detail=True)
def comments(self, request, pk=None):
    try:
        post = Post.objects.get(id=pk)
    except Post.DoesNotExist:
        return Response({&quot;error&quot;: &quot;Post not found.&quot;},
                        status=status.HTTP_400_BAD_REQUEST)
    comments = post.comments.all()
    return Response(CommentSerializer(comments, many=True))
</code></pre>

<p>```</p>
<p>Upon registering the view as <code>router.register(r'posts', PostViewSet)</code>, this action will then be available at the url <code>posts/{pk}/comments/</code>.</p>
<p><a href="#drf-cheat-sheet">Back to Top â†‘</a></p>
<p><br/></p></div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>