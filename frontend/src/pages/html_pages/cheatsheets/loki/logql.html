<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogQL Examples & Queries - Loki Log Query Language</title>
    <meta name="description" content="Explore comprehensive LogQL examples for Loki, covering filtering, regex, JSON parsing, and metric queries. Learn to effectively query and analyze your logs.">
    <meta name="keywords" content="LogQL, Loki, Grafana, log queries, log filtering, regex, JSON parsing, metric queries, log analysis, observability, DevOps">
    <link rel="canonical" href="https://your-domain.com/loki/logql.html">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="LogQL Examples & Queries - Loki Log Query Language">
    <meta property="og:description" content="Explore comprehensive LogQL examples for Loki, covering filtering, regex, JSON parsing, and metric queries. Learn to effectively query and analyze your logs.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-domain.com/loki/logql.html">
    <meta property="og:image" content="https://your-domain.com/images/loki-logql-og.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="LogQL Examples & Queries - Loki Log Query Language">
    <meta name="twitter:description" content="Explore comprehensive LogQL examples for Loki, covering filtering, regex, JSON parsing, and metric queries. Learn to effectively query and analyze your logs.">
    <meta name="twitter:image" content="https://your-domain.com/images/loki-logql-twitter.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>LogQL Examples and Queries</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <h1>LogQL: Mastering Log Queries in Loki</h1>
                <p>LogQL is the query language for Loki, Grafana's log aggregation system. It allows you to efficiently search, filter, and analyze your logs. This page provides a comprehensive collection of LogQL examples to help you master log querying.</p>

                <h2>LogQL Query Examples</h2>
                <p>Explore various LogQL query patterns for different use cases:</p>

                <h3>Basic Log Filtering</h3>
                <p>View all logs for a specific job:</p>
                <pre><code class="language-logql">{job="dev/logs"}</code></pre>

                <p>View log lines for a specific filename within a job:</p>
                <pre><code class="language-logql">{job="dev/logs", filename="/var/log/app.log"}</code></pre>

                <h3>Content-Based Filtering</h3>
                <p>Search for logs with an exact match for a string:</p>
                <pre><code class="language-logql">{job="dev/logs"} |= "This is a test"</code></pre>

                <p>Perform a case-insensitive search:</p>
                <pre><code class="language-logql">{job="dev/logs"} |= "(?i)this is a test"</code></pre>

                <p>Exclude logs with a specific string:</p>
                <pre><code class="language-logql">{job="dev/logs"} |= "This is a test" != "testerId=123"</code></pre>

                <p>Include logs matching a pattern and exclude others:</p>
                <pre><code class="language-logql">{job="dev/logs"} |= "This is a test" != "testerId=123" |~ "accountId=000"</code></pre>

                <p>Combine multiple inclusion and exclusion filters:</p>
                <pre><code class="language-logql">{job="dev/logs"} |= "This is a test" |= "accountId=000" !~ "deviceId=(001|209)"</code></pre>

                <h3>Metric Queries</h3>
                <p>Calculate log events per container name:</p>
                <pre><code class="language-logql">sum by(container_name) (rate({job="prod/dockerlogs"}[1m]))</code></pre>

                <h3>LogQL Parser Examples</h3>
                <p>Examples using the <code>logql-parser</code> image:</p>
                <pre><code class="language-logql">{job="adsb"} | json | gs > 500</code></pre>

                <p>Calculating throughput with logfmt parsing:</p>
                <pre><code class="language-logql">sum by (query) (avg_over_time({job="dev/app"} |= "caller=metrics.go" | logfmt | duration > 100ms | unwrap throughput_mb[1m]))</code></pre>

                <p>Filtering and formatting logs with logfmt:</p>
                <pre><code class="language-logql">{job="dev/app"} |= "caller=metrics.go" | logfmt | throughput_mb < 100 and duration >= 200ms | line_format "{{.duration}}{{.query}}"</code></pre>

                <p>Accessing specific fields with logfmt:</p>
                <pre><code class="language-logql">{compose_service="loki", job="dockerlogs"} | logfmt | read >= 0</code></pre>

                <p>Extracting a specific field with logfmt:</p>
                <pre><code class="language-logql">{compose_service="loki",job="dockerlogs"} | logfmt | read >= 0 | line_format "{{.level}}"</code></pre>

                <p>Complex filtering with JSON parsing and line formatting:</p>
                <pre><code class="language-logql">{container_name=~"ecs-.*-nginx-.*"}
| json
| status=~"(200|4..)" and request_length>250 and request_method!="POST" and xff=~"(54.*|34.*)"
| line_format "ReqMethod: {{.request_method}}, Status: {{.status}}, UserAgent: {{.http_user_agent}} Args: {{.args}} , ResponseTime: {{.responsetime}}"</code></pre>

                <h2>Regex in LogQL</h2>
                <p>Leverage regular expressions for advanced log parsing and extraction.</p>

                <h3>Basic Regex Extraction</h3>
                <p>Example log line:</p>
                <pre><code class="language-logql">1.2.3.4 - - [23/Nov/2020:17:31:00 +0200] "POST /foo/bar?token=x.x HTTP/1.1" 201 83 "http://localhost/" "Mozilla/5.0 (Linux; Android 10; Nokia 6.1 Build/x.x.x; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/x.0.x.110 Mobile Safari/537.36" "1.2.3.4"</code></pre>

                <p>Regex to extract fields like IP, date, verb, path, etc.:</p>
                <pre><code class="language-logql">{job="prod/logs"} |~ "foo" | regexp "(?P&lt;ip&gt;\\d+.\\d+.\\d+.\\d+) (.*) (.*) (?P&lt;date&gt;\\[(.*)\\]) (\&quot;)(?P&lt;verb&gt;(\\w+)) (?P&lt;request_path&gt;([^\&quot;]*)) (?P&lt;http_ver&gt;([^\&quot;]*))(\&quot;) (?P&lt;status_code&gt;\\d+) (?P&lt;bytes&gt;\\d+) (\&quot;)(?P&lt;referrer&gt;(([^\&quot;]*)))(\&quot;) (\&quot;)(?P&lt;user_agent&gt;(([^\&quot;]*)))(\&quot;)"</code></pre>

                <p>Filtering extracted fields:</p>
                <pre><code class="language-logql">{job="prod/logs"} |~ "doAPICall" | regexp "(?P&lt;ip&gt;\\d+.\\d+.\\d+.\\d+) (.*) (.*) (?P&lt;date&gt;\\[(.*)\\]) (\&quot;)(?P&lt;verb&gt;(\\w+)) (?P&lt;request_path&gt;([^\&quot;]*)) (?P&lt;http_ver&gt;([^\&quot;]*))(\&quot;) (?P&lt;status_code&gt;\\d+) (?P&lt;bytes&gt;\\d+) (\&quot;)(?P&lt;referrer&gt;(([^\&quot;]*)))(\&quot;) (\&quot;)(?P&lt;user_agent&gt;(([^\&quot;]*)))(\&quot;)" | status_code=201</code></pre>

                <p>Metric aggregation based on regex extraction:</p>
                <pre><code class="language-logql">sum by (ip) (count_over_time({job="dev/nginx", host="localhost"}
                | regexp `(?P&lt;ip&gt;\S+) (?P&lt;identd&gt;\S+) (?P&lt;user&gt;\S+) \[(?P&lt;timestamp&gt;[\w:\/]+\s[+\-]\d{4})\] "(?P&lt;action&gt;\S+)\s?(?P&lt;path&gt;\S+)\s?(?P&lt;protocol&gt;\S+)?\" (?P&lt;status&gt;\d{3}|-) (?P&lt;size&gt;\d+|-)\s?"(?P&lt;referrer&gt;[^\"]*)"?\s?"(?P&lt;useragent&gt;[^\"]*)?"?`
                | referrer=~"(http|https)://10.21.2.42:(80|443)/(.+)"[60s]))</code></pre>

                <h3>More Regex Examples</h3>
                <p>Nginx access log parsing:</p>
                <pre><code class="language-logql"># logline
                172.10.10.2 - - [10/Jun/2022:09:44:03 +0000] "GET /en/home HTTP/1.1" 200 5434 "https://example.com/en/direct/gohome" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.61 Safari/537.36"

                # regex
                {job="prod/nginx"}
                | regexp `(?P&lt;ip&gt;\S+) (?P&lt;identd&gt;\S+) (?P&lt;user&gt;\S+) \[(?P&lt;timestamp&gt;[\w:\/]+\s[+\-]\d{4})\] "(?P&lt;action&gt;\S+)\s?(?P&lt;path&gt;\S+)\s?(?P&lt;protocol&gt;\S+)?\" (?P&lt;status&gt;\d{3}|-) (?P&lt;size&gt;\d+|-)\s?"(?P&lt;referrer&gt;[^\"]*)"?\s?"(?P&lt;useragent&gt;[^\"]*)?"?`</code></pre>

                <p>Structured log parsing with regex:</p>
                <pre><code class="language-logql"># logline
                [2022-06-10 10:44:45] dev.INFO: {"logType":"Event","logTag":"SomeResponse","description":"SomeClientResponse: handleSomeRequest","attributes":{"foo":"bar"}}

                # regex
                {job="prod/logs"} | regexp `\[(?P&lt;timestamps&gt;(.*))\] (?P&lt;environment&gt;(prod|dev)).(?P&lt;loglevel&gt;(INFO|DEBUG|ERROR|WARN)): (?P&lt;jsonstring&gt;(.*))`</code></pre>

                <p>Combining regex, JSON parsing, and line formatting:</p>
                <pre><code class="language-logql"># message: EventID:12345678-1234-1234-1234-123456789abv - Some troubleshooting needed - runbookId:123456, categoryCode:DB, cpuValue:92.000000000000000000, serverName:Server01, versionId:1

                {job="serverlogs"} |= "logTag:event" | json | line_format "{{.message}}" | regexp "EventID:(?P&lt;event_id&gt;[a-f0-9\\-]+) - Some troubleshooting needed - runbookId:(?P&lt;runbook_id&gt;\\d+), categoryCode:(?P&lt;category_code&gt;\\w+), cpuValue:(?P&lt;cpu_value&gt;[\\d\\.]+), serverName:(?P&lt;server_name&gt;[^,]+), versionId:(?P&lt;version_id&gt;\\d+)"</code></pre>

                <h2>Accessing JSON Data</h2>
                <p>Parse and query structured JSON logs effectively.</p>

                <h3>Parsing and Accessing JSON Fields</h3>
                <p>If your log contains JSON data after a specific marker:</p>
                <pre><code class="language-logql">{job="dev/logs"} | regexp `\[(?P&lt;timestamps&gt;(.*))\] (?P&lt;environment&gt;(prod|dev)).(?P&lt;loglevel&gt;(INFO|DEBUG|ERROR|WARN)): (?P&lt;jsonstring&gt;(.*))` | line_format "{{.jsonstring}}" | json | __error__ != "JSONParserErr"</code></pre>

                <p>Filtering based on JSON keys and values:</p>
                <pre><code class="language-logql">{job="dev/logs"} | regexp `\[(?P&lt;timestamps&gt;(.*))\] (?P&lt;environment&gt;(prod|dev)).(?P&lt;loglevel&gt;(INFO|DEBUG|ERROR|WARN)): (?P&lt;jsonstring&gt;(.*))` | line_format "{{.jsonstring}}" | json | __error__ != "JSONParserErr" | logTag="BalanceCheck"</code></pre>

                <p>Querying numeric JSON fields:</p>
                <pre><code class="language-logql">{job="dev/logs"} | regexp `\[(?P&lt;timestamps&gt;(.*))\] (?P&lt;environment&gt;(prod|dev)).(?P&lt;loglevel&gt;(INFO|DEBUG|ERROR|WARN)): (?P&lt;jsonstring&gt;(.*))` | line_format "{{.jsonstring}}" | json | __error__ != "JSONParserErr" | logTag="BalanceCheck" | balance > 100</code></pre>

                <h3>Line Formatting with JSON</h3>
                <p>Format logs with extracted JSON fields:</p>
                <pre><code class="language-logql">{job="containerlogs"} | json | line_format "timestamp={{ .time }} source_ip={{ .req_headers_x_real_ip }} method={{ .req_method }} path={{ .req_url }} status_code={{ .res_statusCode }}"</code></pre>

                <p>Summing metrics based on JSON fields:</p>
                <pre><code class="language-logql">sum by (res_statusCode) (rate({job="containerlogs"} | json | line_format "timestamp={{ .time }} source_ip={{ .req_headers_x_real_ip }} method={{ .req_method }} path={{ .req_url }} status_code={{ .res_statusCode }}"[60s]))</code></pre>

                <h3>Accessing Nested JSON</h3>
                <p>Querying deeply nested JSON structures:</p>
                <pre><code class="language-logql">{namespace=~"$namespace", app=~"$app", pod=~"$pod"} | json  | line_format "{{.log}}" | json raw_body="message" | line_format "m: {{.raw_body}}" | __error__!= "JSONParserErr"</code></pre>

                <p>Filtering out JSON parsing errors:</p>
                <pre><code class="language-logql">{container="my-service"} |= "" | json | __error__!="JSONParserErr" | line_format "{{.message}} {{.stacktrace}}"</code></pre>

                <p>Extracting nested JSON key-value pairs:</p>
                <pre><code class="language-logql">{container="my-service"}
| pattern "&lt;_entry&gt;"
| json
| line_format "{{ .message }}\n{{ range $k, $v := (fromJson ._entry)}}{{if ne $k \"message\"}}{{$k}}: {{$v}} {{ end }}{{ end }}"</code></pre>

                <h2>Line Format Utility</h2>
                <p>Control the output format of your log lines.</p>

                <h3>Conditional Formatting</h3>
                <p>Include a stacktrace only if the key exists:</p>
                <pre><code class="language-logql">{container="my-service"} |= "" | json | line_format `{{.message}} {{if .stacktrace }} {{- .stacktrace -}} {{else}} {{- "-" -}} {{end}}`</code></pre>

                <h2>Metric Queries</h2>
                <p>Create powerful metrics from your log data.</p>

                <h3>Counting and Aggregating Logs</h3>
                <p>Count log events within a time range and group by application:</p>
                <pre><code class="language-logql">sum by (app)(count_over_time({app=~"my-service"} | json | line_format "{{.log}}" |~ "Unable to acquire"[$__interval]))</code></pre>

                <h2>External Resources</h2>
                <ul>
                    <li><a href="https://grafana.com/docs/loki/latest/logql/log_queries/" target="_blank" rel="noopener noreferrer">Grafana Loki LogQL Documentation</a></li>
                    <li><a href="https://grafana.com/docs/loki/latest/logql/#label-filter-expression" target="_blank" rel="noopener noreferrer">Loki Label Filter Expressions</a></li>
                    <li><a href="https://stackoverflow.com/questions/69761162/loki-display-log-message-and-extra-fields-separately/70000941#70000941" target="_blank" rel="noopener noreferrer">Stack Overflow: Loki Display Log Message and Extra Fields</a></li>
                    <li><a href="https://stackoverflow.com/a/69976898" target="_blank" rel="noopener noreferrer">Stack Overflow: LogQL Line Format Example</a></li>
                    <li><a href="https://github.com/grafana/loki/blob/master/docs/logql.md#filter-expression" target="_blank" rel="noopener noreferrer">Loki LogQL Filter Expressions (GitHub)</a></li>
                    <li><a href="https://medium.com/grafana-tutorials/logql-in-grafana-loki-ffc822a65f59" target="_blank" rel="noopener noreferrer">LogQL in Grafana Loki Tutorial</a></li>
                    <li><a href="https://megamorf.gitlab.io/cheat-sheets/loki/" target="_blank" rel="noopener noreferrer">Loki Cheat Sheet</a></li>
                </ul>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>
