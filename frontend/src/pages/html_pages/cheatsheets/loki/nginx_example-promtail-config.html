<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nginx Promtail Configuration Example - Log Collection</title>
    <meta name="description" content="Explore a practical Nginx Promtail configuration example for collecting journal, syslog, and Nginx access/error logs. Optimize your log aggregation with Promtail.">
    <meta name="keywords" content="promtail, nginx, log collection, log aggregation, loki, syslog, journald, configuration, example, devops, observability">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://your-domain.com/loki/nginx_example-promtail-config.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-domain.com/loki/nginx_example-promtail-config.html">
    <meta property="og:title" content="Nginx Promtail Configuration Example - Log Collection">
    <meta property="og:description" content="Explore a practical Nginx Promtail configuration example for collecting journal, syslog, and Nginx access/error logs. Optimize your log aggregation with Promtail.">
    <meta property="og:image" content="https://your-domain.com/path/to/your/og-image.jpg">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://your-domain.com/loki/nginx_example-promtail-config.html">
    <meta name="twitter:title" content="Nginx Promtail Configuration Example - Log Collection">
    <meta name="twitter:description" content="Explore a practical Nginx Promtail configuration example for collecting journal, syslog, and Nginx access/error logs. Optimize your log aggregation with Promtail.">
    <meta name="twitter:image" content="https://your-domain.com/path/to/your/twitter-image.jpg">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Nginx Promtail Configuration Example</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <p>This document provides a practical example of a Promtail configuration designed to collect logs from various sources, specifically focusing on Nginx web server logs, system journal, and syslog. Promtail is a log collection agent that forwards logs to Loki, a horizontally scalable, highly available, multi-tenant log aggregation system inspired by Prometheus.</p>

                <h2>Promtail Configuration Overview</h2>
                <p>The configuration below outlines how to set up Promtail to scrape and send logs. It includes settings for the Promtail server itself, client configurations for connecting to Loki, and detailed scrape configurations for different log types.</p>

                <h2>Journald Log Collection</h2>
                <p>This section configures Promtail to collect logs from systemd's journald. It specifies a maximum age for logs to consider and sets relevant labels for filtering and organization within Loki.</p>

                <h2>Syslog Log Collection</h2>
                <p>Here, Promtail is set up to collect logs from the standard syslog file. The configuration includes static targets and labels to identify these logs.</p>

                <h2>Nginx Log Collection (Access and Error)</h2>
                <p>This is a key part of the configuration, demonstrating how to collect both Nginx access logs and error logs. Each log type is assigned a specific job name and labels, including `level` (info/error) and `service_name`, which are crucial for effective log analysis and debugging in Loki.</p>

                <p>The configuration uses `static_configs` to define the log files to be scraped. It's important to ensure that the `__path__` directive correctly points to your Nginx log files. The labels applied, such as `job: prod/nginx`, `environment: production`, and `host: demo-app-prod`, help in categorizing and querying logs based on their origin and purpose.</p>

                <p>For more advanced scenarios, you might consider using `pipeline_stages` to parse log content, extract specific fields, or enrich logs with additional metadata before sending them to Loki.</p>

                <p><strong>External Resources:</strong></p>
                <ul>
                    <li><a href="https://grafana.com/docs/loki/latest/clients/promtail/" target="_blank" rel="noopener noreferrer">Promtail Documentation</a></li>
                    <li><a href="https://nginx.org/en/docs/debugging_log.html" target="_blank" rel="noopener noreferrer">Nginx Debugging Log</a></li>
                    <li><a href="https://www.freedesktop.org/software/systemd/man/journald.conf.html" target="_blank" rel="noopener noreferrer">Systemd Journald Configuration</a></li>
                </ul>
            </div>
            <pre><code class="language-yaml"># Example: promtail to collect journal, syslog and nginx logs
# Application called demo-app running in production
#
# job: prod/nginx
# environment: production
# host: demo-app-prod (or hostname)
# service_name: demo-app-prod

server:
  http_listen_port: 9080
  grpc_listen_port: 0
positions:
  filename: /var/lib/promtail/positions.yaml
clients:
  - url: https://&lt;LOKI_USERNAME&gt;:&lt;LOKI_PASSWORD&gt;@&lt;LOKI_FQDN&gt;/loki/api/v1/push

scrape_configs:
  - job_name: journal
    journal:
      max_age: 1h
      path: /var/log/journal
      labels:
        job: prod/journal
        environment: production
        host: demo-app-prod
    relabel_configs:
      - source_labels: ['__journal__systemd_unit']
        target_label: 'unit'

  - job_name: syslog
    pipeline_stages:
    static_configs:
    - targets:
        - localhost
      labels:
        job: prod/syslog
        host: demo-app-prod
        environment: production
        __path__: /var/log/syslog

  - job_name: nginx-info
    static_configs:
    - targets:
        - localhost
      labels:
        job: prod/nginx
        environment: production
        host: demo-app-prod
        level: info
        service_name: demo-app-prod
        __path__: /var/log/nginx/access.log

  - job_name: nginx-error
    static_configs:
    - targets:
        - localhost
      labels:
        job: prod/nginx
        environment: production
        host: demo-app-prod
        level: error
        service_name: demo-app-prod
        __path__: /var/log/nginx/error.log
</code></pre>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>