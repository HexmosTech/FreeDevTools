<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loki AWS Configuration - Log Management Setup</title>
    <meta name="description" content="Configure Loki for AWS S3 and DynamoDB storage. Learn how to set up ingestion, schema, and retention policies for efficient log management.">
    <meta name="keywords" content="loki config aws, loki s3, loki dynamodb, log management, grafana loki, aws storage, log aggregation, configuration, setup, retention policy">
    <link rel="canonical" href="https://yourdomain.com/loki/loki-config_aws.html">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Loki AWS Configuration - Log Management Setup">
    <meta property="og:description" content="Configure Loki for AWS S3 and DynamoDB storage. Learn how to set up ingestion, schema, and retention policies for efficient log management.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://yourdomain.com/loki/loki-config_aws.html">
    <meta property="og:image" content="https://yourdomain.com/path/to/your/og-image.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Loki AWS Configuration - Log Management Setup">
    <meta name="twitter:description" content="Configure Loki for AWS S3 and DynamoDB storage. Learn how to set up ingestion, schema, and retention policies for efficient log management.">
    <meta name="twitter:image" content="https://yourdomain.com/path/to/your/twitter-image.jpg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Loki AWS Configuration</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <p>This document outlines a sample configuration for Grafana Loki when using AWS S3 for object storage and DynamoDB for index tables. Proper configuration is crucial for efficient and scalable log management.</p>

                <h2>Loki AWS Configuration Overview</h2>
                <p>The following configuration details how Loki will interact with AWS services. It covers essential settings for the server, ingester, schema, storage, and retention policies.</p>

                <h2>Server and Ingester Settings</h2>
                <p>These settings define how Loki's server operates and how it ingests logs. Key parameters include listen ports, timeouts, log levels, and chunk encoding.</p>

                <h2>Storage Configuration with AWS S3 and DynamoDB</h2>
                <p>This section focuses on the core storage setup, specifying AWS S3 as the object store for log chunks and DynamoDB for managing indexes. It includes details on connection parameters and schema versions.</p>

                <h2>Retention and Limits Configuration</h2>
                <p>Managing data retention and ingestion limits is vital for cost control and performance. This part of the configuration ensures that old logs are purged and that ingestion rates are managed effectively.</p>

                <pre><code class="language-yaml">auth_enabled: false

server:
  http_listen_port: 3100
  http_listen_address: 127.0.0.1
  http_server_read_timeout: 1000s
  http_server_write_timeout: 1000s
  http_server_idle_timeout: 1000s
  log_level: "info"

ingester:
  lifecycler:
    address: 127.0.0.1
    ring:
      kvstore:
        store: inmemory
      replication_factor: 1
    final_sleep: 0s
  chunk_encoding: snappy
  chunk_idle_period: 5m
  chunk_retain_period: 30s
  max_transfer_retries: 0

# https://grafana.com/docs/loki/latest/configuration/#schema_config
schema_config:
  configs:
    - from: 2020-05-15
      store: aws
      object_store: s3
      schema: v11
      index:
        prefix: loki-logging-index
        #period: 168h

storage_config:
  aws:
    http_config:
      idle_conn_timeout: 90s
      response_header_timeout: 0s
    s3: s3://x:x@eu-west-1/loki-logs-datastore

    dynamodb:
      dynamodb_url: dynamodb://x:x@eu-west-1

limits_config:
  enforce_metric_name: false
  reject_old_samples: true
  reject_old_samples_max_age: 168h
  ingestion_rate_mb: 30
  ingestion_burst_size_mb: 60

# https://grafana.com/docs/loki/latest/operations/storage/retention/
# To avoid querying of data beyond the retention period, max_look_back_period config in chunk_store_config
# must be set to a value less than or equal to what is set in table_manager.retention_period
chunk_store_config:
  #max_look_back_period: 0s
  max_look_back_period: 720h

# https://grafana.com/docs/loki/latest/operations/storage/retention/
table_manager:
  #retention_deletes_enabled: false
  retention_deletes_enabled: true
  #retention_period: 0s
  retention_period: 720h
  chunk_tables_provisioning:
    inactive_read_throughput: 10
    inactive_write_throughput: 10
    provisioned_read_throughput: 50
    provisioned_write_throughput: 20
  index_tables_provisioning:
    inactive_read_throughput: 10
    inactive_write_throughput: 10
    provisioned_read_throughput: 50
    provisioned_write_throughput: 20
</code></pre>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>