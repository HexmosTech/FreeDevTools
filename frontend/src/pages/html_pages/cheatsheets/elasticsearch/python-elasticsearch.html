<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Elasticsearch Client - Manage and Query Data</title>
    <meta name="description" content="Learn to use the Python Elasticsearch client for managing indices, ingesting data, and performing searches. Includes examples for AWS IAM and HTTP Basic Auth.">
    <meta name="keywords" content="Python Elasticsearch, Elasticsearch client, Python Elasticsearch library, Elasticsearch indexing, Elasticsearch search, AWS Elasticsearch, HTTP Basic Auth, data ingestion, cluster health, index management">
    <link rel="canonical" href="https://your-domain.com/elasticsearch/python-elasticsearch.html">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Python Elasticsearch Client - Manage and Query Data">
    <meta property="og:description" content="Learn to use the Python Elasticsearch client for managing indices, ingesting data, and performing searches. Includes examples for AWS IAM and HTTP Basic Auth.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-domain.com/elasticsearch/python-elasticsearch.html">
    <meta property="og:image" content="https://your-domain.com/path/to/your/og-image.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Python Elasticsearch Client - Manage and Query Data">
    <meta name="twitter:description" content="Learn to use the Python Elasticsearch client for managing indices, ingesting data, and performing searches. Includes examples for AWS IAM and HTTP Basic Auth.">
    <meta name="twitter:image" content="https://your-domain.com/path/to/your/twitter-image.jpg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .content {
            padding: 20px;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 0;
        }
        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        .markdown-content {
            line-height: 1.7;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        .markdown-content pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
        }
        .markdown-content code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Python Elasticsearch Client</h1>
        </div>
        <div class="content">
            <div class="markdown-content">
                <h2>Elasticsearch Cheatsheet with Python</h2>
                <p>This cheatsheet provides essential commands and examples for using the Python Elasticsearch client to manage and query your data.</p>
                
                <h3>Key Features and Operations:</h3>
                <ul>
                    <li><a href="#python-library">Using the Python Elasticsearch Library</a></li>
                    <li><a href="#authenticate-with-aws-iam">Authentication with AWS IAM</a></li>
                    <li><a href="#authenticate-with-http-basic-auth">Authentication with HTTP Basic Auth</a></li>
                    <li><a href="#elasticsearch-info-response">Retrieving Elasticsearch Cluster Info</a></li>
                    <li><a href="#ingest-documents">Ingesting Single Documents</a></li>
                    <li><a href="#bulk-ingest">Performing Bulk Data Ingestion</a></li>
                    <li><a href="#view-indices">Viewing Available Indices</a></li>
                    <li><a href="#search-documents">Searching for Documents</a></li>
                    <li><a href="#using-python-requests">Interacting with Elasticsearch via Python Requests</a></li>
                    <li><a href="#create-index-requests">Creating an Index using Requests</a></li>
                </ul>

                <h2>Python Library Usage</h2>

                <h3>Setting up the Elasticsearch Client</h3>
                <h4>Connecting with AWS IAM Authentication</h4>
                <p>Securely connect to AWS Elasticsearch Service using IAM credentials.</p>
                <pre><code class="language-python">from elasticsearch import Elasticsearch, RequestsHttpConnection, helpers
from requests_aws4auth import AWS4Auth

# Replace with your actual AWS credentials and region
aws_access_key_id = "YOUR_ACCESS_KEY_ID"
aws_secret_access_key = "YOUR_SECRET_ACCESS_KEY"
aws_region = "YOUR_AWS_REGION"
es_endpoint = "YOUR_ES_ENDPOINT"
aws_session_token = "YOUR_SESSION_TOKEN" # Optional, if using temporary credentials

aws_auth = AWS4Auth(aws_access_key_id, aws_secret_access_key, aws_region, 'es', session_token=aws_session_token)

es = Elasticsearch(
    hosts = [{'host': es_endpoint, 'port': 443}],
    http_auth=aws_auth,
    use_ssl=True,
    verify_certs=True,
    connection_class=RequestsHttpConnection
)
</code></pre>

                <h4>Connecting with HTTP Basic Authentication</h4>
                <p>Connect to Elasticsearch using standard username and password authentication.</p>
                <pre><code class="language-python">from elasticsearch import Elasticsearch, RequestsHttpConnection, helpers

es_endpoint = "YOUR_ES_ENDPOINT"
es_username = "YOUR_USERNAME"
es_password = "YOUR_PASSWORD"

es = Elasticsearch(
    hosts = [{'host': es_endpoint, 'port': 443}],
    http_auth=(es_username, es_password),
    use_ssl=True,
    verify_certs=True,
    connection_class=RequestsHttpConnection
)
</code></pre>

                <h3>Elasticsearch Cluster Information</h3>
                <p>Retrieve detailed information about your Elasticsearch cluster.</p>
                <pre><code class="language-python">&gt;&gt;&gt; es.info()
{'name': 'elasticsearch-02', 'cluster_name': 'es-cluster', 'cluster_uuid': 'EJDqv5VrQyao07ndQuwhCw', 'version': {'number': '6.8.2', 'build_flavor': 'default', 'build_type': 'deb', 'build_hash': 'b506955', 'build_date': '2019-07-24T15:24:41.545295Z', 'build_snapshot': False, 'lucene_version': '7.7.0', 'minimum_wire_compatibility_version': '5.6.0', 'minimum_index_compatibility_version': '5.0.0'}, 'tagline': 'You Know, for Search'}
</code></pre>

                <p>For a more readable output, you can use JSON formatting:</p>
                <pre><code class="language-python">&gt;&gt;&gt; import json
&gt;&gt;&gt; print(json.dumps(es.info(), indent=2))
{
  "name": "elasticsearch-02",
  "cluster_name": "es-cluster",
  "cluster_uuid": "EJDqv5VrQyao07ndQuwhCw",
  "version": {
    "number": "6.8.2",
    "build_flavor": "default",
    "build_type": "deb",
    "build_hash": "b506955",
    "build_date": "2019-07-24T15:24:41.545295Z",
    "build_snapshot": false,
    "lucene_version": "7.7.0",
    "minimum_wire_compatibility_version": "5.6.0",
    "minimum_index_compatibility_version": "5.0.0"
  },
  "tagline": "You Know, for Search"
}
</code></pre>

                <h3>Ingesting Documents</h3>
                <h4>Ingesting a Single Document</h4>
                <p>Add a document to an index, specifying a unique document ID.</p>
                <pre><code class="language-python">doc = {
    'author': 'john_doe',
    'text': 'Elasticsearch is amazing!',
    'timestamp': '2023-10-27T10:00:00Z'
}
res = es.index(index="my-test-index", doc_type='tweet', id=1, body=doc)
print(res)
</code></pre>

                <h4>Bulk Data Ingestion</h4>
                <p>Efficiently ingest multiple documents using the <code>helpers.bulk</code> utility.</p>
                <pre><code class="language-python">from elasticsearch import Elasticsearch, RequestsHttpConnection, helpers

bulk_docs = []
list_of_dicts = [
    {"name": "ruan", "age": 32, "city": "New York"},
    {"name": "stefan", "age": 31, "city": "London"},
    {"name": "alice", "age": 29, "city": "Paris"}
]

for doc in list_of_dicts:
    action = {
        "_index": 'my-bulk-index',
        "_type": '_doc',
        "_source": doc
    }
    bulk_docs.append(action)

success, errors = helpers.bulk(es, bulk_docs)
print(f"Successfully indexed: {success} documents")
if errors:
    print(f"Encountered errors: {errors}")
</code></pre>

                <h3>Managing Indices</h3>
                <h4>View Available Indices</h4>
                <p>List all indices currently present in your Elasticsearch cluster.</p>
                <pre><code class="language-python">&gt;&gt;&gt; indices = es.indices.get_alias("*").keys()
&gt;&gt;&gt; print(list(indices))
['fluentd-2020.02.26', 'metricbeat-2020.02.25', 'filebeat-2020.02.25', 'fluentd-2020.02.26', '.tasks', 'fluentd-2020.02.24', 'metricbeat-2019', 'telegram-bot', '.kibana_1', 'metricbeat-2020.02.26', 'filebeat-2020.02.26', 'metricbeat-2020.02']
</code></pre>

                <h3>Searching Documents</h3>
                <p>Perform a search query against a specific index.</p>
                <p>Example Query: <code>{"query": {"match": {"text": "HI"}}}</code></p>
                <pre><code class="language-python">&gt;&gt;&gt; search_body = {
    "query": {
        "match": {
            "text": "HI"
        }
    }
}
&gt;&gt;&gt; response = es.search(index="telegram-bot", doc_type="_doc", body=search_body)
&gt;&gt;&gt; print(json.dumps(response, indent=2))
{
  "took": 335,
  "timed_out": false,
  "_shards": {
    "total": 5,
    "successful": 5,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": 1,
    "max_score": 0.6931472,
    "hits": [
      {
        "_index": "telegram-bot",
        "_type": "_doc",
        "_id": "x",
        "_score": 0.6931472,
        "_source": {
          "message_id": "x",
          "date": "x",
          "text": "HI",
          "entities": [],
          "caption_entities": [],
          "photo": [],
          "new_chat_members": [],
          "new_chat_photo": [],
          "delete_chat_photo": false,
          "group_chat_created": false,
          "supergroup_chat_created": false,
          "channel_chat_created": false
        }
      }
    ]
  }
}
</code></pre>

                <h2>Interacting with Elasticsearch via Python Requests</h2>
                <p>While the official client is recommended, you can also use the <code>requests</code> library for direct HTTP interactions.</p>

                <h3>Create an Index using Requests</h3>
                <p>Define index settings and create a new index.</p>
                <pre><code class="language-python">import requests
import json

es_url = 'https://es.x.x/my-new-index' # Replace with your Elasticsearch endpoint and index name
auth_user = 'username'
auth_pass = 'pass'

index_settings = {
    "settings": {
        "number_of_shards": 2,
        "number_of_replicas": 1
    }
}

response = requests.put(
    es_url,
    auth=(auth_user, auth_pass),
    headers={'content-type': 'application/json'},
    data=json.dumps(index_settings)
)

print(f"Status Code: {response.status_code}")
print(response.json())
</code></pre>

                <p>For more advanced operations and comprehensive documentation, refer to the official <a href="https://elasticsearch-py.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">Python Elasticsearch Client documentation</a> and the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="noopener noreferrer">Elasticsearch documentation</a>.</p>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>
