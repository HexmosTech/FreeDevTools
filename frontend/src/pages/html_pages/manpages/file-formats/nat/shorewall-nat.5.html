<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nat - Shorewall one-to-one NAT file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/shorewall">shorewall_5.2.8-6_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nat - Shorewall one-to-one NAT file

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>/etc/shorewall/nat</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This file is used to define one-to-one Network Address Translation (NAT).

           <b>Warning</b>

           If all you want to do is simple port forwarding, do NOT use this file. See
           <b>https://shorewall.org/FAQ.htm#faq1</b>[1]. Also, in many cases, Proxy ARP (<b>shorewall-proxyarp</b>[2](5)) or
           Proxy-NDP(<b>shorewall6-proxyndp</b>[3](5)) is a better solution that one-to-one NAT.

       The columns in the file are as follows (where the column name is followed by a different name in
       parentheses, the different name is used in the alternate specification syntax).

       <b>EXTERNAL</b> - {<u>address</u>|?COMMENT}
           External IP Address - this should NOT be the primary IP address of the interface named in the next
           column and must not be a DNS Name.

           If you put ?COMMENT in this column, the rest of the line will be attached as a comment to the
           Netfilter rule(s) generated by the following entries in the file. The comment will appear delimited
           by "/* ... */" in the output of "shorewall show nat"

           To stop the comment from being attached to further rules, simply include ?COMMENT on a line by
           itself.

       <b>INTERFACE</b> - <u>interfacelist</u>[<b>:</b>[<u>digit</u>]]
           Interfaces that have the <b>EXTERNAL</b> address. If ADD_IP_ALIASES=Yes in <b>shorewall.conf</b>[4](5), Shorewall
           will automatically add the EXTERNAL address to this interface. Also if ADD_IP_ALIASES=Yes, you may
           follow the interface name with ":" and a <u>digit</u> to indicate that you want Shorewall to add the alias
           with this name (e.g., "eth0:0"). That allows you to see the alias with ifconfig.  <b>That</b> <b>is</b> <b>the</b> <b>only</b>
           <b>thing</b> <b>that</b> <b>this</b> <b>name</b> <b>is</b> <b>good</b> <b>for</b> <b>--</b> <b>you</b> <b>cannot</b> <b>use</b> <b>it</b> <b>anywhere</b> <b>else</b> <b>in</b> <b>your</b> <b>Shorewall</b> <b>configuration.</b>

           Each interface must match an entry in <b>shorewall-interfaces</b>[5](5). Shorewall allows loose matches to
           wildcard entries in <b>shorewall-interfaces</b>[5](5). For example, ppp0 in this file will match a
           <b>shorewall-interfaces</b>[5](5) entry that defines ppp+.

           If you want to override ADD_IP_ALIASES=Yes for a particular entry, follow the interface name with ":"
           and no digit (e.g., "eth0:").

       <b>INTERNAL</b> - <u>address</u>
           Internal Address (must not be a DNS Name).

       <b>ALLINTS</b> - [<b>Yes</b>|<b>No</b>]
           If Yes or yes, NAT will be effective from all hosts. If No or no (or left empty) then NAT will be
           effective only through the interface named in the <b>INTERFACE</b> column.

           This column was formerly labelled ALL INTERFACES.

       <b>LOCAL</b> - [<b>Yes</b>|<b>No</b>]
           If <b>Yes</b> or <b>yes</b>, NAT will be effective from the firewall system

</pre><h4><b>RESTRICTIONS</b></h4><pre>
       DNAT rules always preempt one-to-one NAT rules. This has subtile consequences when there are sub-zones on
       an <u>interface</u>. Consider the following:

       /etc/shorewall/zones:

           #ZONE   TYPE    OPTIONS                 IN                      OUT
           #                                       OPTIONS                 OPTIONS
           fw      firewall
           net     ipv4
           loc     ipv4
           smc:net ipv4

       /etc/shorewall/interfaces:

           #ZONE   INTERFACE       OPTIONS
           net     eth0            dhcp,tcpflags,nosmurfs,routefilter,logmartians,sourceroute=0
           loc     eth1            tcpflags,nosmurfs,routefilter,logmartians

       /etc/shorewall/hosts:

           #ZONE   HOST(S)                                 OPTIONS
           smc     eth0:10.1.10.0/24

       /etc/shorewall/nat:

           #EXTERNAL       INTERFACE       INTERNAL        ALLINTS         LOCAL
           10.1.10.100     eth0            172.20.1.100

       Note that the EXTERNAL address is in the <b>smc</b> zone.

       /etc/shorewall/rules:

           #ACTION         SOURCE          DEST            PROTO   DPORT   SPORT           ORIGDEST        RATE            USER    MARK    CONNLIMIT       TIME            HEADERS     SWITCH           HELPER
           ?SECTION ALL
           ?SECTION ESTABLISHED
           ?SECTION RELATED
           ?SECTION INVALID
           ?SECTION UNTRACKED
           ?SECTION NEW
           ...
           DNAT            net             loc:172.20.1.4  tcp     80

       For the one-to-one NAT to work correctly in this configuration, one of two approaches can be taken:

        1. Define a CONTINUE policy with <b>smc</b> as the SOURCE zone (preferred):

               #SOURCE        DEST      POLICY         LOG LEVEL LIMIT:BURST
               <b>smc</b>       <b>$FW</b>       <b>CONTINUE</b>
               loc       net       ACCEPT
               net       all       DROP      info
               # THE FOLLOWING POLICY MUST BE LAST
               all       all       REJECT         info

        2. Set IMPLICIT_CONTINUE=Yes in <b><a href="../man5/shorewall.conf.5.html">shorewall.conf</a>(5)</b>[4].

</pre><h4><b>FILES</b></h4><pre>
       /etc/shorewall/nat

       /etc/shorewall6/nat

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>https://shorewall.org/NAT.htm</b>[6]

       <b>https://shorewall.org/configuration_file_basics.htm#Pairs</b>[7]

       <a href="../man8/shorewall.8.html">shorewall</a>(8)

</pre><h4><b>NOTES</b></h4><pre>
        1. https://shorewall.org/FAQ.htm#faq1
           https://shorewall.org/FAQ.htm#faq1

        2. shorewall-proxyarp
           https://shorewall.org/manpages/shorewall-proxyarp.html

        3. shorewall6-proxyndp
           https://shorewall.org/manpages/shorewall-proxyndp.html

        4. shorewall.conf
           https://shorewall.org/manpages/shorewall.conf.html

        5. shorewall-interfaces
           https://shorewall.org/manpages/shorewall-interfaces.html

        6. https://shorewall.org/NAT.htm
           https://shorewall.org/NAT.htm

        7. https://shorewall.org/configuration_file_basics.htm#Pairs
           https://shorewall.org/configuration_file_basics.htm#Pairs

Configuration Files                                09/24/2020                                   <u><a href="../man5/SHOREWALL-NAT.5.html">SHOREWALL-NAT</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>