<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>postfix-wrapper - Postfix multi-instance API</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/postfix">postfix_3.10.2-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       postfix-wrapper - Postfix multi-instance API

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Support  for  managing  multiple  Postfix  instances  is  available  as  of  version 2.6. Instances share
       executable files and documentation, but have their own directories  for  configuration,  queue  and  data
       files.

       This document describes how the familiar "postfix start" etc. user interface can be used to manage one or
       multiple  Postfix  instances, and gives details of an API to coordinate activities between the <a href="../man1/postfix.1.html">postfix</a>(1)
       command and a multi-instance manager program.

       With multi-instance support, the default Postfix instance is always required. This instance is identified
       by the config_directory parameter's default value.

</pre><h4><b>GENERAL</b> <b>OPERATION</b></h4><pre>
       Multi-instance support is backwards compatible: when you run only one Postfix instance, commands such  as
       "postfix start" will not change behavior at all.

       Even  with  multiple  Postfix  instances,  you  can keep using the same postfix commands in boot scripts,
       upgrade procedures, and other places. The commands do more work, but humans are not forced to  learn  new
       tricks.

       For example, to start all Postfix instances, use:

              # postfix start

       Other <a href="../man1/postfix.1.html">postfix</a>(1) commands also work as expected. For example, to find out what Postfix instances exist in
       a multi-instance configuration, use:

              # postfix status

       This enumerates the status of all Postfix instances within a multi-instance configuration.

</pre><h4><b>MANAGING</b> <b>AN</b> <b>INDIVIDUAL</b> <b>POSTFIX</b> <b>INSTANCE</b></h4><pre>
       To  manage  a  specific  Postfix  instance, specify its configuration directory on the <a href="../man1/postfix.1.html">postfix</a>(1) command
       line:

              # postfix -c <u>/path/to/config_directory</u> <u>command</u>

       Alternatively, the <a href="../man1/postfix.1.html">postfix</a>(1) command accepts the instance's configuration directory via the  MAIL_CONFIG
       environment variable (the -c command-line option has higher precedence).

       Otherwise, the <a href="../man1/postfix.1.html">postfix</a>(1) command will operate on all Postfix instances.

</pre><h4><b>ENABLING</b> <b><a href="../man1/POSTFIX.1.html">POSTFIX</a>(1)</b> <b>MULTI-INSTANCE</b> <b>MODE</b></h4><pre>
       By default, the <a href="../man1/postfix.1.html">postfix</a>(1) command operates in single-instance mode. In this mode the command invokes the
       postfix-script  file  directly  (currently  installed  in  the daemon directory).  This file contains the
       commands that start or stop one Postfix instance, that upgrade the configuration of one Postfix instance,
       and so on.

       When the <a href="../man1/postfix.1.html">postfix</a>(1) command operates in multi-instance mode as discussed  below,  the  command  needs  to
       execute  start,  stop,  etc.   commands  for  each  Postfix instance.  This multiplication of commands is
       handled by a multi-instance manager program.

       Turning on <a href="../man1/postfix.1.html">postfix</a>(1) multi-instance mode goes as follows: in  the  default  Postfix  instance's  main.cf
       file,  1)  specify  the  pathname  of  a  multi-instance  manager program with the multi_instance_wrapper
       parameter;  2)  populate  the  multi_instance_directories  parameter  with  the  configuration  directory
       pathnames of additional Postfix instances.  For example:

              /etc/postfix/main.cf:
                  multi_instance_wrapper = $daemon_directory/postfix-wrapper
                  multi_instance_directories = /etc/postfix-test

       The  $daemon_directory/postfix-wrapper  file  implements  a  simple manager and contains instructions for
       creating Postfix instances by hand.  The <a href="../man1/postmulti.1.html">postmulti</a>(1) command provides a  more  extensive  implementation
       including support for life-cycle management.

       The  multi_instance_directories  and  other  main.cf  parameters  are  listed  below in the CONFIGURATION
       PARAMETERS section.

       In multi-instance mode, the <a href="../man1/postfix.1.html">postfix</a>(1) command invokes the $multi_instance_wrapper command instead of the
       postfix-script  file.  This  multi-instance  manager  in  turn  executes  the   <a href="../man1/postfix.1.html">postfix</a>(1)   command   in
       single-instance mode for each Postfix instance.

       To  illustrate the main ideas behind multi-instance operation, below is an example of a simple but useful
       multi-instance manager implementation:

              #!<a href="file:/bin/sh">/bin/sh</a>

              : ${command_directory?"do not invoke this command directly"}

              POSTCONF=$command_directory/postconf
              POSTFIX=$command_directory/postfix
              instance_dirs=`$POSTCONF -h multi_instance_directories |
                              sed 'y/,/ /'` || exit 1

              err=0
              for dir in $config_directory $instance_dirs
              do
                  case "$1" in
                  stop|abort|flush|reload|drain)
                      test "`$POSTCONF -c $dir -h multi_instance_enable`" \
                          = yes || continue;;
                  start)
                      test "`$POSTCONF -c $dir -h multi_instance_enable`" \
                          = yes || {
                          $POSTFIX -c $dir check || err=$?
                          continue
                      };;
                  esac
                  $POSTFIX -c $dir "$@" || err=$?
              done

              exit $err

</pre><h4><b>PER-INSTANCE</b> <b>MULTI-INSTANCE</b> <b>MANAGER</b> <b>CONTROLS</b></h4><pre>
       Each Postfix instance has its own main.cf file  with  parameters  that  control  how  the  multi-instance
       manager operates on that instance.  This section discusses the most important settings.

       The  setting  "multi_instance_enable  =  yes" allows the multi-instance manager to start (stop, etc.) the
       corresponding Postfix instance. For safety reasons, this setting is not the default.

       The default setting "multi_instance_enable = no" is useful for manual testing with "postfix -c <u>/path/name</u>
       start" etc.  The multi-instance manager will not start such an instance, and it will skip  commands  such
       as  "stop"  or  "flush" that require a running Postfix instance.  The multi-instance manager will execute
       commands such as "check", "set-permissions" or "upgrade-configuration", and it will  replace  "start"  by
       "check" so that problems will be reported even when the instance is disabled.

</pre><h4><b>MAINTAINING</b> <b>SHARED</b> <b>AND</b> <b>NON-SHARED</b> <b>FILES</b></h4><pre>
       Some  files  are  shared  between Postfix instances, such as executables and manpages, and some files are
       per-instance, such as configuration files, mail queue files, and data files.  See  the  NON-SHARED  FILES
       section below for a list of per-instance files.

       Before  Postfix multi-instance support was implemented, the executables, manpages, etc., have always been
       maintained as part of the default Postfix instance.

       With multi-instance support, we simply continue to do this.  Specifically, a Postfix  instance  will  not
       check  or  update  shared  files  when  that instance's config_directory value is listed with the default
       main.cf file's multi_instance_directories parameter.

       The consequence of this approach is that the default Postfix  instance  should  be  checked  and  updated
       before any other instances.

</pre><h4><b>MULTI-INSTANCE</b> <b>API</b> <b>SUMMARY</b></h4><pre>
       Only the multi-instance manager implements support for the multi_instance_enable configuration parameter.
       The   multi-instance   manager   will   start   only   Postfix   instances   whose   main.cf   file   has
       "multi_instance_enable = yes". A setting of "no" allows a Postfix instance to be tested by hand.

       The <a href="../man1/postfix.1.html">postfix</a>(1) command operates on only one Postfix instance when the -c option  is  specified,  or  when
       MAIL_CONFIG is present in the process environment. This is necessary to terminate recursion.

       Otherwise,  when  the  multi_instance_directories  parameter  value  is non-empty, the <a href="../man1/postfix.1.html">postfix</a>(1) command
       executes the command specified with  the  multi_instance_wrapper  parameter,  instead  of  executing  the
       commands in postfix-script.

       The  multi-instance  manager  skips  commands  such  as "stop" or "reload" that require a running Postfix
       instance, when an instance does  not  have  "multi_instance_enable  =  yes".   This  avoids  false  error
       messages.

       The  multi-instance  manager replaces a "start" command by "check" when a Postfix instance's main.cf file
       does not have "multi_instance_enable = yes". This substitution ensures that  problems  will  be  reported
       even when the instance is disabled.

       No  Postfix command or script will update or check shared files when its config_directory value is listed
       in the default main.cf's multi_instance_directories parameter value.   Therefore,  the  default  instance
       should be checked and updated before any Postfix instances that depend on it.

       Set-gid  commands  such as <a href="../man1/postdrop.1.html">postdrop</a>(1) and <a href="../man1/postqueue.1.html">postqueue</a>(1) effectively append the multi_instance_directories
       parameter value to the  legacy  alternate_config_directories  parameter  value.  The  commands  use  this
       information  to  determine  whether a -c option or MAIL_CONFIG environment setting specifies a legitimate
       value.

       The legacy alternate_config_directories parameter remains necessary  for  non-default  Postfix  instances
       that are running different versions of Postfix, or that are not managed together with the default Postfix
       instance.

</pre><h4><b>ENVIRONMENT</b> <b>VARIABLES</b></h4><pre>
       MAIL_CONFIG
              When  present,  this  forces  the  <a href="../man1/postfix.1.html">postfix</a>(1)  command  to  operate  only on the specified Postfix
              instance. This environment variable is exported by the <a href="../man1/postfix.1.html">postfix</a>(1) -c option,  so  that  <a href="../man1/postfix.1.html">postfix</a>(1)
              commands in descendant processes will work correctly.

</pre><h4><b>CONFIGURATION</b> <b>PARAMETERS</b></h4><pre>
       The text below provides only a parameter summary. See <a href="../man5/postconf.5.html">postconf</a>(5) for more details.

       <b>multi_instance_directories</b> <b>(empty)</b>
              An  optional  list  of  non-default Postfix configuration directories; these directories belong to
              additional Postfix instances that share the Postfix executable files and  documentation  with  the
              default  Postfix  instance, and that are started, stopped, etc., together with the default Postfix
              instance.

       <b>multi_instance_wrapper</b> <b>(empty)</b>
              The pathname of a multi-instance manager command that the  <b><a href="../man1/postfix.1.html">postfix</a></b>(1)  command  invokes  when  the
              multi_instance_directories parameter value is non-empty.

       <b>multi_instance_name</b> <b>(empty)</b>
              The optional instance name of this Postfix instance.

       <b>multi_instance_group</b> <b>(empty)</b>
              The optional instance group name of this Postfix instance.

       <b>multi_instance_enable</b> <b>(no)</b>
              Allow this Postfix instance to be started, stopped, etc., by a multi-instance manager.

</pre><h4><b>NON-SHARED</b> <b>FILES</b></h4><pre>
       <b>config_directory</b> <b>(see</b> <b>'postconf</b> <b>-d'</b> <b>output)</b>
              The default location of the Postfix main.cf and master.cf configuration files.

       <b>data_directory</b> <b>(see</b> <b>'postconf</b> <b>-d'</b> <b>output)</b>
              The directory with Postfix-writable data files (for example: caches, pseudo-random numbers).

       <b>queue_directory</b> <b>(see</b> <b>'postconf</b> <b>-d'</b> <b>output)</b>
              The location of the Postfix top-level queue directory.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/postfix.1.html">postfix</a>(1) Postfix control program
       <a href="../man1/postmulti.1.html">postmulti</a>(1) full-blown multi-instance manager
       $daemon_directory/postfix-wrapper simple multi-instance manager

</pre><h4><b>LICENSE</b></h4><pre>
       The Secure Mailer license must be distributed with this software.

</pre><h4><b>AUTHOR(S)</b></h4><pre>
       Wietse Venema
       IBM T.J. Watson Research
       P.O. Box 704
       Yorktown Heights, NY 10598, USA

       Wietse Venema
       Google, Inc.
       111 8th Avenue
       New York, NY 10011, USA

                                                                                              <u><a href="../man5/POSTFIX-WRAPPER.5.html">POSTFIX-WRAPPER</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>