<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>snat - Shorewall SNAT/Masquerade definition file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/shorewall">shorewall_5.2.8-6_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       snat - Shorewall SNAT/Masquerade definition file

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>/etc/shorewall[6]/snat</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This file is used to define dynamic NAT (Masquerading) and to define Source NAT (SNAT). It superseded
       <b>shorewall-masq</b>[1](5) in Shorewall 5.0.14.

           <b>Warning</b>

           The entries in this file are order-sensitive. The first entry that matches a particular connection
           will be the one that is used.

           <b>Warning</b>

           If you have more than one ISP link, adding entries to this file will <b>not</b> force connections to go out
           through a particular link. You must use entries in <b>shorewall-rtrules</b>[2](5) or PREROUTING entries in
           <b>shorewall-mangle</b>[3](5) to do that.

       Beginning with Shorewall 5.2.6, the snat file supports two different formats:

        1. The SPORT (source port) column is omitted. This is the default unless a "?FORMAT 2" compiler
           directive is included.

        2. The SPORT column immediately follows the DPORT column.

       The columns in the file are as follows.

       <b>ACTION</b>
           Defines the type of rule to generate. Beginning with Shorewall 5.1.9, with the exception of NFLOG and
           ULOG, the action may be followed by a colon (":") and a <u>log</u> <u>level</u> (see <b><a href="../man5/shorewall-logging.5.html">shorewall-logging</a>(5)</b>[4]).

           Choices for ACTION are:

           <u>action</u>[+][(<u>parameter</u>,...)][:<u>level</u>]
               where <u>action</u> is an action declared in <b><a href="../man5/shorewall-actions.5.html">shorewall-actions</a>(5)</b>[5] with the <b>nat</b> option. See
               <b>https://shorewall.org/Actions.html</b>[6] for further information.

           <b>CONTINUE</b>[+]:<u>level</u>
               Causes matching packets to be exempted from any following rules in the file.

           <b>LOG:</b><u>level</u>
               Added in Shorewall 5.1.9. Simply log the packet and continue with the next rule.

           <b>MASQUERADE[+]</b>[([<u>lowport</u>[-<u>highport</u>]][<b>random</b>])][:<u>level</u>]
               Causes matching outgoing packages to have their source IP address set to the primary IP address
               of the interface specified in the DEST column. if <u>lowport</u>-<u>highport</u> is given, that port range will
               be used to assign a source port. If only <u>lowport</u> is given, that port will be assigned, if
               possible. If option <b>random</b> is used then port mapping will be randomized. MASQUERADE should only
               be used when the DEST interface has a dynamic IP address. Otherwise, SNAT should be used and
               should specify the interface's static address.

           <b>NFLOG</b>[(<u>nflog-parameters</u>)]
               Added in Shorewall 5.1.9. Queues matching packets to a back end logging daemon via a netlink
               socket then continues to the next rule. See <b><a href="../man5/shorewall-logging.5.html">shorewall-logging</a>(5)</b>[4].

               The <u>nflog-parameters</u> are a comma-separated list of up to 3 numbers:

               •   The first number specifies the netlink group (0-65535). If omitted (e.g., NFLOG(,0,10)) then
                   a value of 0 is assumed.

               •   The second number specifies the maximum number of bytes to copy. If omitted, 0 (no limit) is
                   assumed.

               •   The third number specifies the number of log messages that should be buffered in the kernel
                   before they are sent to user space. The default is 1.

               NFLOG is similar to <b>LOG:NFLOG</b>[(<u>nflog-parameters</u>)], except that the log level is not changed when
               this ACTION is used in an action or macro body and the invocation of that action or macro
               specifies a log level.

           <b>SNAT[+]</b>([<u>address-or-address-range</u>][:<u>lowport</u><b>[-</b><u>highport</u>]][<b>:random</b>][:<b>persistent</b>]|<b>detect</b>)[:<u>level</u>]
               If you specify an address here, matching packets will have their source address set to that
               address. If ADD_SNAT_ALIASES is set to Yes or yes in <b>shorewall.conf</b>[7](5) then Shorewall will
               automatically add this address to the INTERFACE named in the first column (IPv4 only).

               You may also specify a range of up to 256 IP addresses if you want the SNAT address to be
               assigned from that range in a round-robin fashion by connection. The range is specified by
               <u>first.ip.in.range</u>-<u>last.ip.in.range</u>. You may follow the port range with <b>:random</b> in which case
               assignment of ports from the list will be random.  <b>random</b> may also be specified by itself in this
               column in which case random local port assignments are made for the outgoing connections.

               Example: 206.124.146.177-206.124.146.180

               You may follow the port range (or <b>:random</b>) with <b>:persistent</b>. This is only useful when an address
               range is specified and causes a client to be given the same source/destination IP pair.

               You may also use the special value <b>detect</b> which causes Shorewall to determine the IP addresses
               configured on the interface named in the DEST column and substitute them in this column.

               DNS Names names are not allowed.

               Normally, Netfilter will attempt to retain the source port number. You may cause netfilter to
               remap the source port by following an address or range (if any) by ":" and a port range with the
               format <u>lowport</u>-<u>highport</u>. If this is done, you must specify "tcp", "udp", "dccp" or "stcp" in the
               PROTO column.

               Examples:

                           192.0.2.4:5000-6000
                           :4000-5000

               You may also specify a single port number, which will be assigned to the outgoing connection, if
               possible.

           <b>ULOG</b>[(<u>ulog-parameters</u>)]
               IPv4 only. Added in Shorewall 5.1.9. Queues matching packets to a back end logging daemon via a
               netlink socket then continues to the next rule. See <b><a href="../man5/shorewall-logging.5.html">shorewall-logging</a>(5)</b>[4].

               Similar to <b>LOG:ULOG</b>[(<u>ulog-parameters</u>)], except that the log level is not changed when this ACTION
               is used in an action or macro body and the invocation of that action or macro specifies a log
               level.

           Normally Masq/SNAT rules are evaluated after those for one-to-one NAT (defined in
           <b>shorewall-nat</b>[8](5)). If you want the rule to be applied before one-to-one NAT rules, follow the
           action name with "+": This feature should only be required if you need to insert rules in this file
           that preempt entries in <b>shorewall-nat</b>[8](5).

       <b>SOURCE</b> (Optional) - [<u>interface</u>|<u>address</u>[<b>,</b><u>address</u>...][<u>exclusion</u>]]
           Set of hosts that you wish to masquerade. You can specify this as an <u>address</u> (net or host) or as an
           <u>interface</u>. Unless you want to perform SNAT in the INPUT chain (see DEST below), if you give the name
           of an interface (deprecated), the interface must be up before you start the firewall and the
           Shorewall rules compiler will warn you of that fact. (Shorewall will use your main routing table to
           determine the appropriate addresses to masquerade).

           The preferred way to specify the SOURCE is to supply one or more host or network addresses separated
           by comma. You may use ipset names preceded by a plus sign (+) to specify a set of hosts.

       <b>DEST</b> - {<u>interface</u>[<b>:</b><u>digit][,interface</u>[<b>:</b><u>digit</u>]]...|$FW}[<b>:</b>[<u>dest-address</u>[<b>,</b><u>dest-address</u>]...[<u>exclusion</u>]]
           Outgoing <u>interface</u>s and destination networks. Multiple interfaces may be listed when the ACTION is
           MASQUERADE, but this is usually just your internet interface. If ADD_SNAT_ALIASES=Yes in
           <b>shorewall.conf</b>[7](5), you may add ":" and a <u>digit</u> to indicate that you want the alias added with that
           name (e.g., eth0:0). This will allow the alias to be displayed with ifconfig.  <b>That</b> <b>is</b> <b>the</b> <b>only</b> <b>use</b>
           <b>for</b> <b>the</b> <b>alias</b> <b>name;</b> <b>it</b> <b>may</b> <b>not</b> <b>appear</b> <b>in</b> <b>any</b> <b>other</b> <b>place</b> <b>in</b> <b>your</b> <b>Shorewall</b> <b>configuration.</b>

           Beginning with Shorewall 5.1.12, SNAT may be performed in the nat table's INPUT chain by specifying
           $FW rather than one or more interfaces.

           Each interface must match an entry in <b>shorewall-interfaces</b>[9](5). Shorewall allows loose matches to
           wildcard entries in <b>shorewall-interfaces</b>[9](5). For example, ppp0 in this file will match a
           <b>shorewall-interfaces</b>[9](5) entry that defines ppp+.

           Where <b>more</b> <b>that</b> <b>one</b> <b>internet</b> <b>provider</b> <b>share</b> <b>a</b> <b>single</b> <b>interface</b>[10], the provider is specified by
           including the provider name or number in parentheses:

                       eth0(Avvanta)

           In that case, you will want to specify the interface's address for that provider as the SNAT
           parameter.

           The interface may be qualified by adding the character ":" followed by a comma-separated list of
           destination host or subnet addresses to indicate that you only want to change the source IP address
           for packets being sent to those particular destinations. Exclusion is allowed (see
           <b>shorewall-exclusion</b>[11](5)) as are ipset names preceded by a plus sign '+';

           If you wish to inhibit the action of ADD_SNAT_ALIASES for this entry then include the ":" but omit
           the digit:

                       eth0(Avvanta):
                       eth2::192.0.2.32/27

           Comments may be attached to Netfilter rules generated from entries in this file through the use of
           ?COMMENT lines. These lines begin with ?COMMENT; the remainder of the line is treated as a comment
           which is attached to subsequent rules until another ?COMMENT line is found or until the end of the
           file is reached. To stop adding comments to rules, use a line containing only ?COMMENT.

       <b>PROTO</b> (Optional) - {<b>-</b>|[!]{<u>protocol-name</u>|<u>protocol-number</u>}[,...]|+<u>ipset</u>}
           If you wish to restrict this entry to a particular protocol then enter the protocol name (from
           <a href="../man5/protocols.5.html">protocols</a>(5)) or number here. See <b><a href="../man5/shorewall-rules.5.html">shorewall-rules</a>(5)</b>[12] for details.

           Beginning with Shorewall 4.5.12, this column can accept a comma-separated list of protocols.

           Beginning with Shorewall 4.6.0, an <u>ipset</u> name can be specified in this column. This is intended to be
           used with bitmap:port ipsets.

       <b>{PORT|DPORT}</b> (Optional) - {-|[!]<u>port-name-or-number</u>[,<u>port-name-or-number</u>]...|+<u>ipset</u>}
           The column was renamed to DPORT in Shorewall 5.2.6. Beginning with that release, both PORT and DPORT
           are accepted in the alternative input format,

           If the PROTO column specifies TCP (6), UDP (17), DCCP (33), SCTP (132) or UDPLITE (136) then you may
           list one or more port numbers (or names from <a href="../man5/services.5.html">services</a>(5)) or port ranges separated by commas.

           Port ranges are of the form <u>lowport</u>:<u>highport</u>.

           Beginning with Shorewall 4.6.0, an <u>ipset</u> name can be specified in this column. This is intended to be
           used with bitmap:port ipsets.

       <b>SPORT</b> <b>{-|[!]</b><u>port-name-or-number</u><b>[,</b><u>port-name-or-number</u><b>]...|+</b><u>ipset</u><b>}</b>
           FORMAT 2 only.

           If the PROTO column specifies TCP (6), UDP (17), DCCP (33), SCTP (132) or UDPLITE (136) then you may
           list one or more port numbers (or names from <a href="../man5/services.5.html">services</a>(5)) or port ranges separated by commas.

           Port ranges are of the form <u>lowport</u>:<u>highport</u>.

           An <u>ipset</u> name can be specified in this column. This is intended to be used with bitmap:port ipsets.

       <b>IPSEC</b> (Optional) - [<u>option</u>[<b>,</b><u>option</u>]...]
           If you specify a value other than "-" in this column, you must be running kernel 2.6 and your kernel
           and iptables must include policy match support.

           Comma-separated list of options from the following. Only packets that will be encrypted via an SA
           that matches these options will have their source address changed.

           <b>reqid=</b><u>number</u>
               where <u>number</u> is specified using <a href="../man8/setkey.8.html">setkey</a>(8) using the 'unique:<u>number</u> option for the SPD level.

           <b>spi=</b>&lt;number&gt;
               where <u>number</u> is the SPI of the SA used to encrypt/decrypt packets.

           <b>proto=ah</b>|<b>esp</b>|<b>ipcomp</b>
               IPSEC Encapsulation Protocol

           <b>mss=</b><u>number</u>
               sets the MSS field in TCP packets

           <b>mode=transport</b>|<b>tunnel</b>
               IPSEC mode

           <b>tunnel-src=</b><u>address</u>[/<u>mask</u>]
               only available with mode=tunnel

           <b>tunnel-dst=</b><u>address</u>[/<u>mask</u>]
               only available with mode=tunnel

           <b>strict</b>
               Means that packets must match all rules.

           <b>next</b>
               Separates rules; can only be used with strict

           <b>yes</b>
               When used by itself, causes all traffic that will be encrypted/encapsulated to match the rule.

       <b>MARK</b> - [<b>!</b>]<u>value</u>[/<u>mask</u>][<b>:C</b>]
           Defines a test on the existing packet or connection mark. The rule will match only if the test
           returns true.

           If you don't want to define a test but need to specify anything in the following columns, place a "-"
           in this field.

           !
               Inverts the test (not equal)

           <u>value</u>
               Value of the packet or connection mark.

           <u>mask</u>
               A mask to be applied to the mark before testing.

           <b>:C</b>
               Designates a connection mark. If omitted, the packet mark's value is tested.

       <b>USER</b> (Optional) - [<b>!</b>][<u>user-name-or-number</u>][<b>:</b><u>group-name-or-number</u>][<b>+</b><u>program-name</u>]
           This column was formerly labelled USER/GROUP.

           Only locally-generated connections will match if this column is non-empty.

           When this column is non-empty, the rule matches only if the program generating the output is running
           under the effective <u>user</u> and/or <u>group</u> specified (or is NOT running under that id if "!" is given).

           Examples:

           joe
               program must be run by joe

           :kids
               program must be run by a member of the 'kids' group

           !:kids
               program must not be run by a member of the 'kids' group

           +upnpd
               #program named upnpd

                   <b>Important</b>
                   The ability to specify a program name was removed from Netfilter in kernel version 2.6.14.

       <b>SWITCH</b> <b>-</b> <b>[!]</b><u>switch-name</u><b>[={0|1}]</b>
           Added in Shorewall 4.5.1 and allows enabling and disabling the rule without requiring <b>shorewall</b>
           <b>restart</b>.

           The rule is enabled if the value stored in /proc/net/nf_condition/<u>switch-name</u> is 1. The rule is
           disabled if that file contains 0 (the default). If '!' is supplied, the test is inverted such that
           the rule is enabled if the file contains 0.

           Within the <u>switch-name</u>, '@0' and '@{0}' are replaced by the name of the chain to which the rule is a
           added. The <u>switch-name</u> (after '@...' expansion) must begin with a letter and be composed of letters,
           decimal digits, underscores or hyphens. Switch names must be 30 characters or less in length.

           Switches are normally <b>off</b>. To turn a switch <b>on</b>:
               <b>echo</b> <b>1</b> <b>&gt;</b>
                           <b>/proc/net/nf_condition/</b><u>switch-name</u>
           To turn it <b>off</b> again:
               <b>echo</b> <b>0</b> <b>&gt;</b>
                           <b>/proc/net/nf_condition/</b><u>switch-name</u>
           Switch settings are retained over <b>shorewall</b> <b>restart</b>.

           Beginning with Shorewall 4.5.10, when the <u>switch-name</u> is followed by <b>=0</b> or <b>=1</b>, then the switch is
           initialized to off or on respectively by the <b>start</b> command. Other commands do not affect the switch
           setting.

       <b>ORIGDEST</b> - [<b>-</b>|<u>address</u>[,<u>address</u>]...[<u>exclusion</u>]|<u>exclusion</u>]
           (Optional) Added in Shorewall 4.5.6. This column may be included and may contain one or more
           addresses (host or network) separated by commas. Address ranges are not allowed. When this column is
           supplied, rules are generated that require that the original destination address matches one of the
           listed addresses. It is useful for specifying that SNAT should occur only for connections that were
           acted on by a DNAT when they entered the firewall.

           This column was formerly labelled ORIGINAL DEST.

       <b>PROBABILITY</b> - [<u>probability</u>]
           Added in Shorewall 5.0.0. When non-empty, requires the Statistics Match capability in your kernel and
           ip6tables and causes the rule to match randomly but with the given <u>probability</u>. The <u>probability</u> is a
           number 0 &lt; <u>probability</u> &lt;= 1 and may be expressed at up to 8 decimal points of precision.

</pre><h4><b>EXAMPLES</b></h4><pre>
       IPv4 Example 1:
           You have a simple masquerading setup where eth0 connects to a DSL or cable modem and eth1 connects to
           your local network with subnet 192.168.0.0/24.

           Your entry in the file will be:

                       #ACTION    SOURCE              DEST
                       MASQUERADE 192.168.0.0/24      eth0

       IPv4 Example 2:
           You add a router to your local network to connect subnet 192.168.1.0/24 which you also want to
           masquerade. You then add a second entry for eth0 to this file:

                       #ACTION    SOURCE              DEST
                       MASQUERADE 192.168.0.0/24      eth0
                       MASQUERADE 192.168.1.0/24      eth0

       IPv4 Example 3:
           You want all outgoing traffic from 192.168.1.0/24 through eth0 to use source address 206.124.146.176
           which is NOT the primary address of eth0. You want 206.124.146.176 to be added to eth0 with name
           eth0:0.

                       #ACTION                 SOURCE          DEST
                       SNAT(206.124.146.176)   192.168.1.0/24  eth0:0

       IPv4 Example 4:
           You want all outgoing SMTP traffic entering the firewall from 172.20.1.0/29 to be sent from eth0 with
           source IP address 206.124.146.177. You want all other outgoing traffic from 172.20.1.0/29 to be sent
           from eth0 with source IP address 206.124.146.176.

                       #INTERFACE   SOURCE           ADDRESS         PROTO   DPORT
                       eth0         172.20.1.0/29    206.124.146.177 tcp     smtp
                       eth0         172.20.1.0/29    206.124.146.176

                       #ACTION                 SOURCE          DEST        PROTO     PORT
                       SNAT(206.124.146.177)   172.20.1.0/29   eth0        tcp       smtp
                       SNAT(206.124.146.176)   172.20.1.0/29   eth0

               <b>Warning</b>
               The order of the above two rules is significant!

       IPv4 Example 5:
           Connections leaving on eth0 and destined to any host defined in the ipset <u>myset</u> should have the
           source IP address changed to 206.124.146.177.

                       #ACTION                 SOURCE          DEST
                       SNAT(206.124.146.177)   -               eth0:+myset[dst]

       IPv4 Example 6:
           SNAT outgoing connections on eth0 from 192.168.1.0/24 randomly to addresses 1.1.1.1, 1.1.1.3, and
           1.1.1.9 (Shorewall 5.0.0 and later).

               /etc/shorewall/snat:

                      #ACTION                 SOURCE          DEST
                      SNAT(1.1.1.1)           192.168.1.0/24  eth0  { probability=0.33 }
                      SNAT(1.1.1.3)           192.168.1.0/24  eth0  { probability=0.50 }
                      SNAT(1.1.1.9)           192.168.1.0/24  eth0

       IPv6 Example 1:
           You have a simple 'masquerading' setup where eth0 connects to a DSL or cable modem and eth1 connects
           to your local network with subnet 2001:470:b:787::0/64

           Your entry in the file will be:

                       #ACTION      SOURCE                  DEST
                       MASQUERADE   2001:470:b:787::0/64    eth0

       IPv6 Example 2:
           Your sit1 interface has two public IP addresses: 2001:470:a:227::1 and 2001:470:b:227::1. You want to
           use the iptables statistics match to masquerade outgoing connections evenly between these two
           addresses.

               /etc/shorewall/snat:

                      #ACTION                      SOURCE     DEST
                      SNAT(2001:470:a:227::1)      ::/0       sit1              { probability=0.50 }
                      SNAT(2001:470:a:227::2)      ::/0       sit

</pre><h4><b>FILES</b></h4><pre>
       /etc/shorewall/snat

       /etc/shorewall6/snat

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>https://shorewall.org/configuration_file_basics.htm#Pairs</b>[13]

       <a href="../man8/shorewall.8.html">shorewall</a>(8)

</pre><h4><b>NOTES</b></h4><pre>
        1. shorewall-masq
           https://shorewall.org/manpages/shorewall-masq.html

        2. shorewall-rtrules
           https://shorewall.org/manpages/shorewall-rtrules.html

        3. shorewall-mangle
           https://shorewall.org/manpages/shorewall-mangle.html

        4. <a href="../man5/shorewall-logging.5.html">shorewall-logging</a>(5)
           https://shorewall.org/manpages/shorewall-logging.html

        5. <a href="../man5/shorewall-actions.5.html">shorewall-actions</a>(5)
           https://shorewall.org/manpages/shorewall-actions.html

        6. https://shorewall.org/Actions.html
           https://shorewall.org/Actions.html

        7. shorewall.conf
           https://shorewall.org/manpages/shorewall.conf.html

        8. shorewall-nat
           https://shorewall.org/manpages/shorewall-nat.html

        9. shorewall-interfaces
           https://shorewall.org/manpages/shorewall-interfaces.html

       10. more that one internet provider share a single interface
           https://shorewall.org/4.4/MultiISP.html#Shared

       11. shorewall-exclusion
           https://shorewall.org/manpages/shorewall-exclusion.html

       12. <a href="../man5/shorewall-rules.5.html">shorewall-rules</a>(5)
           https://shorewall.org/manpages/shorewall-rules.html

       13. https://shorewall.org/configuration_file_basics.htm#Pairs
           https://shorewall.org/configuration_file_basics.htm#Pairs

Configuration Files                                09/24/2020                                  <u><a href="../man5/SHOREWALL-SNAT.5.html">SHOREWALL-SNAT</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>