<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mongodb_table - Postfix MongoDB client configuration</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/postfix">postfix_3.10.2-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mongodb_table - Postfix MongoDB client configuration

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>postmap</b> <b>-q</b> <b>"</b><u>string</u><b>"</b> <b>mongodb:/etc/postfix/</b><u>filename</u>

       <b>postmap</b> <b>-q</b> <b>-</b> <b>mongodb:/etc/postfix/</b><u>filename</u> <b>&lt;</b><u>inputfile</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  Postfix  mail  system  uses  optional tables for address rewriting or mail routing. These tables are
       usually in <b>dbm</b> or <b>db</b> format.

       Alternatively, lookup tables can be specified as MongoDB databases.  In order  to  use  MongoDB  lookups,
       define a MongoDB source as a lookup table in main.cf, for example:
           alias_maps = mongodb:/etc/postfix/mongodb-aliases.cf

       In  this  example,  the  file  /etc/postfix/mongodb-aliases.cf has the same format as the Postfix main.cf
       file, and can specify the parameters described below. It is also possible to have  the  configuration  in
       main.cf; see "OBSOLETE MAIN.CF PARAMETERS" below.

       It  is  strongly recommended to use proxy:mongodb, in order to reduce the number of database connections.
       For example:
           alias_maps = proxy:mongodb:/etc/postfix/mongodb-aliases.cf

       Note: when using proxy:mongodb:/<u>file</u>, the  file  must  be  readable  by  the  unprivileged  postfix  user
       (specified with the Postfix mail_owner configuration parameter).

</pre><h4><b>MONGODB</b> <b>PARAMETERS</b></h4><pre>
       <b>uri</b>    The URI of mongo server/cluster that Postfix will try to connect to and query from. Please see
              https://www.mongodb.com/docs/manual/reference/connection-string/

              Example:
                  uri = mongodb+srv://user:pass@loclhost:27017/mail

       <b>dbname</b> Name of the database to read the information from.  Example:
                  dbname = mail

       <b>collection</b>
              Name of the collection (table) to read the information from.  Example:
                  collection = mailbox

       <b>query_filter</b>
              The  MongoDB  query  template  used to search the database, where <b>%s</b> is a substitute for the email
              address that Postfix is trying to resolve. Please see:
              https://www.mongodb.com/docs/manual/tutorial/query-documents/

              Example:
                  query_filter = {"$or": [{"username": "%s"}, {"alias.address": "%s"}], "active": 1}

              This parameter supports the following '%' expansions:

              <b>%%</b>     This is replaced by a literal '%' character.

              <b>%s</b>     This is replaced by the input key. The %s  must  appear  in  quotes,  because  all  Postfix
                     queries  are  strings  containing  (parts from) a domain or email address. Postfix makes no
                     numerical queries.

              <b>%u</b>     When the input key is an address of the form user@domain, <b>%u</b> is replaced by the local  part
                     of the address.  Otherwise, <b>%u</b> is replaced by the entire search string.

              <b>%d</b>     When the input key is an address of the form user@domain, <b>%d</b> is replaced by the domain part
                     of the address.

              <b>%[1-9]</b> The patterns %1, %2, ... %9 are replaced by the corresponding most significant component of
                     the  input  key's  domain. If the input key is <u><a href="mailto:user@mail.example.com">user@mail.example.com</a></u>, then %1 is <b>com</b>, %2 is
                     <b>example</b> and %3 is <b>mail</b>.

              In the above substitutions, characters will be quoted as required by RFC 4627. For  example,  each
              double quote or backslash character will be escaped with a backslash characacter.

       <b>projection</b>
              Advanced MongoDB query projections. Please see:
              https://www.mongodb.com/docs/manual/tutorial/project-fields-from-query-results/

              •      If <b>projection</b> is non-empty, then <b>result_attribute</b> must be empty.

              •      This  implementation  can extract information only from result fields that have type <b>string</b>
                     (UTF8), <b>integer</b> (int32, int64) and <b>array</b>. Other  result  fields  will  be  ignored  with  a
                     warning. Please see:
                     https://mongoc.org/libbson/current/bson_type_t.html

              •      As  with <b>result_attribute</b>, the top-level _id field (type OID) is automatically removed from
                     projection results.

       <b>result_attribute</b>
              Comma or whitespace separated list with the names of fields to be returned in a lookup result.

              •      If <b>result_attribute</b> is non-empty, then <b>projection</b> must be empty.

              •      As with <b>projection</b>, the top-level _id field (type OID) is automatically removed from lookup
                     results.

       <b>result_format</b> <b>(default:</b> <b>%s</b>)
              Format template applied to the result from <b>projection</b> or <b>result_attribute</b>. Most commonly  used  to
              append (or prepend) text to the result. This parameter supports the following '%' expansions:

              <b>%%</b>     This is replaced by a literal '%' character.

              <b>%s</b>     This is replaced by the value of the result attribute. When result is empty it is skipped.

              <b>%u</b>     When  the  result  attribute value is an address of the form user@domain, <b>%u</b> is replaced by
                     the local part of the address. When the result has an empty localpart it is skipped.

              <b>%d</b>     When a result attribute value is an address of the form user@domain, <b>%d</b> is replaced by  the
                     domain part of the attribute value. When the result is unqualified it is skipped.

              <b>%[SUD1-9]</b>
                     The  upper-case  and decimal digit expansions interpolate the parts of the input key rather
                     than the result. Their behavior is identical to that described with  <b>query_filter</b>,  and  in
                     fact  because the input key is known in advance, lookups whose key does not contain all the
                     information specified in the result template are suppressed and return no results.

              For example, using "result_format = smtp:[%s]" allows one to use a mailHost attribute as the basis
              of a <a href="../man5/transport.5.html">transport</a>(5) table. After applying the result format, multiple  values  are  concatenated  as
              comma  separated strings. The expansion_limit parameter explained below allows one to restrict the
              number of values in the result, which is especially useful for maps that should  return  a  single
              value.

              The default value <b>%s</b> specifies that each attribute value should be used as is.

              NOTE: DO NOT put quotes around the result format! The result is not a JSON string.

       <b>domain</b> <b>(default:</b> <b>no</b> <b>domain</b> <b>list)</b>
              This  is  a  list of domain names, paths to files, or "type:table" databases. When specified, only
              fully qualified search keys with a *non-empty* localpart and a matching domain  are  eligible  for
              lookup:  'user'  lookups,  bare  domain  lookups and "@domain" lookups are not performed. This can
              significantly reduce the query load on the backend database. Example:
                  domain = postfix.org, hash:/etc/postfix/searchdomains

       <b>expansion_limit</b> <b>(default:</b> <b>0)</b>
              A limit on the total number of result elements returned (as a comma separated list)  by  a  lookup
              against the map.  A setting of zero disables the limit. Lookups fail with a temporary error if the
              limit is exceeded. Setting the limit to 1 ensures that lookups do not return multiple values.

</pre><h4><b>OBSOLETE</b> <b>MAIN.CF</b> <b>PARAMETERS</b></h4><pre>
       MongoDB  parameters  can  also be defined in main.cf. Specify as MongoDB source a name that doesn't begin
       with a slash or a dot. The MongoDB parameters will then be accessible as the name you've given the source
       in its definition, an underscore, and the name of the parameter. For example, if a map  is  specified  as
       "mongodb:<u>mongodb_source</u>", the "uri" parameter would be defined in main.cf as "<u>mongodb_source</u>_uri".

       Note:  with  this  form, passwords are written in main.cf, which is normally world-readable, and '$' in a
       mongodb parameter setting needs to be written as '$$'.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/postmap.1.html">postmap</a>(1), Postfix lookup table maintenance
       <a href="../man5/postconf.5.html">postconf</a>(5), configuration parameters

</pre><h4><b>README</b> <b>FILES</b></h4><pre>
       Use "<b>postconf</b> <b>readme_directory</b>" or "<b>postconf</b> <b>html_directory</b>" to locate this information.
       DATABASE_README, Postfix lookup table overview
       MONGODB_README, Postfix MONGODB client guide

</pre><h4><b>LICENSE</b></h4><pre>
       The Secure Mailer license must be distributed with this software.

</pre><h4><b>HISTORY</b></h4><pre>
       MongoDB support was introduced with Postfix version 3.9.

</pre><h4><b>AUTHOR(S)</b></h4><pre>
       Hamid Maadani (<a href="mailto:hamid@dexo.tech">hamid@dexo.tech</a>)
       Dextrous Technologies, LLC

       Edited by:
       Wietse Venema
       porcupine.org

       Based on prior work by:
       Stephan Ferraro
       Aionda GmbH

                                                                                                <u><a href="../man5/MONGODB_TABLE.5.html">MONGODB_TABLE</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>