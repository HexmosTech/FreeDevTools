<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iked.conf — IKEv2 configuration file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/openiked">openiked_7.4-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       iked.conf — IKEv2 configuration file

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>iked.conf</b>  is  the configuration file for <u><a href="../man8/iked.8.html">iked</a></u>(8), the Internet Key Exchange version 2 (IKEv2) daemon for
       IPsec.  IPsec itself is a pair  of  protocols:  Encapsulating  Security  Payload  (ESP),  which  provides
       integrity  and  confidentiality;  and  Authentication  Header  (AH), which provides integrity.  The IPsec
       protocol itself is described in <u><a href="../man4/ipsec.4.html">ipsec</a></u>(4).

       In its most basic form,  a  flow  is  established  between  hosts  and/or  networks,  and  then  Security
       Associations  (SA) are established, which detail how the desired protection will be achieved.  IPsec uses
       flows to determine whether to apply security services to an IP packet or not.  <u><a href="../man8/iked.8.html">iked</a></u>(8) is used to set  up
       flows and establish SAs automatically, by specifying ‘ikev2’ policies in <b>iked.conf</b> (see “AUTOMATIC KEYING
       POLICIES”, below).

       Alternative methods of setting up flows and SAs are also possible using manual keying or automatic keying
       using  the  older  ISAKMP/Oakley  a.k.a.  IKEv1  protocol.   Manual keying is not recommended, but can be
       convenient for quick setups and testing.  See <u><a href="../man5/ipsec.conf.5.html">ipsec.conf</a></u>(5) and <u><a href="../man8/isakmpd.8.html">isakmpd</a></u>(8)  for  more  information  about
       manual keying and ISAKMP support.

</pre><h4><b>IKED.CONF</b> <b>FILE</b> <b>FORMAT</b></h4><pre>
       <b>iked.conf</b> is divided into three main sections:

       <b>Macros</b>
             User-defined macros may be defined and used later, simplifying the configuration file.

       <b>Global</b> <b>Configuration</b>
             Global settings for <u><a href="../man8/iked.8.html">iked</a></u>(8).

       <b>Automatic</b> <b>Keying</b> <b>Policies</b>
             Policies to set up IPsec flows and SAs automatically.

       Lines beginning with ‘#’ and empty lines are regarded as comments, and ignored.  Lines may be split using
       the ‘\’ character.

       Argument names not beginning with a letter, digit, or underscore must be quoted.

       Addresses  can  be  specified  in  CIDR  notation (matching netblocks), as symbolic host names, interface
       names, or interface group names.

       Additional configuration files can be included with the <b>include</b> keyword, for example:

             include "/etc/macros.conf"

       Certain parameters can be expressed as lists, in which case <u><a href="../man8/iked.8.html">iked</a></u>(8)  generates  all  the  necessary  flow
       combinations.  For example:

             ikev2 esp proto { tcp, udp } \
                     from 192.168.1.1 to 10.0.0.18 \
                     peer 192.168.10.1

</pre><h4><b>MACROS</b></h4><pre>
       Macros  can  be  defined  that  will later be expanded in context.  Macro names must start with a letter,
       digit, or underscore, and may contain any of those characters.  Macro names may  not  be  reserved  words
       (for example <b>flow</b>, <b>from</b>, <b>esp</b>).  Macros are not expanded inside quotes.

       For example:

             remote_gw = "192.168.3.12"
             ikev2 esp from 192.168.7.0/24 to 192.168.8.0/24 peer $remote_gw

</pre><h4><b>GLOBAL</b> <b>CONFIGURATION</b></h4><pre>
       Here are the settings that can be set globally:

       <b>set</b> <b>active</b>
             Set  <u><a href="../man8/iked.8.html">iked</a></u>(8)  to  global  active  mode.   In  active mode the per-policy <u>mode</u> setting is respected.
             <u><a href="../man8/iked.8.html">iked</a></u>(8) will initiate policies set to <u>active</u> and wait for incoming requests  for  policies  set  to
             <u>passive</u>.  This is the default.

       <b>set</b> <b>passive</b>
             Set  <u><a href="../man8/iked.8.html">iked</a></u>(8)  to  global  passive  mode.   In  passive  mode  no  packets  are sent to peers and no
             connections are initiated by <u><a href="../man8/iked.8.html">iked</a></u>(8), even for <u>active</u> policies.  This option  is  used  for  setups
             using <u><a href="../man8/sasyncd.8.html">sasyncd</a></u>(8) and <u><a href="../man4/carp.4.html">carp</a></u>(4) to provide redundancy.  <u><a href="../man8/iked.8.html">iked</a></u>(8) will run in passive mode until sasyncd
             has determined that the host is the master and can switch to active mode.

       <b>set</b> <b>couple</b>
             Load the negotiated security associations (SAs) and flows into the kernel.  This is the default.

       <b>set</b> <b>decouple</b>
             Don't  load the negotiated SAs and flows from the kernel.  This mode is only useful for testing and
             debugging.

       <b>set</b> <b>dpd_check_interval</b> <u>time</u>
             Specify the liveness check interval, in seconds.  Setting <u>time</u> to  0  disables  DPD.   The  default
             value is 60 seconds.

       <b>set</b> <b>enforcesingleikesa</b>
             Allow  only  a  single  active  IKE  SA  for  each  <b>dstid</b>.   When  a  new SA with the same <b>dstid</b> is
             established, it replaces the old SA.

       <b>set</b> <b>noenforcesingleikesa</b>
             Don't limit the number of IKE SAs per <b>dstid</b>.  This is the default.

       <b>set</b> <b>fragmentation</b>
             Enable  IKEv2  Message  Fragmentation  (RFC  7383)  support.   This  allows  IKEv2  to  operate  in
             environments that might block IP fragments.

       <b>set</b> <b>nofragmentation</b>
             Disables IKEv2 Message Fragmentation support.  This is the default.

       <b>set</b> <b>mobike</b>
             Enable  MOBIKE  (RFC  4555) support.  This is the default.  MOBIKE allows the peer IP address to be
             changed for IKE and IPsec SAs.  Currently <u><a href="../man8/iked.8.html">iked</a></u>(8) only supports MOBIKE when acting as a responder.

       <b>set</b> <b>nomobike</b>
             Disables MOBIKE support.

       <b>set</b> <b>cert_partial_chain</b>
             Allow partial certificate chain if at least one certificate is a trusted CA from <u>/etc/iked/ca/</u>.

       <b>set</b> <b>ocsp</b> <u>URL</u> [<b>tolerate</b> <u>time</u> [<b>maxage</b> <u>time</u>]]
             Enable OCSP and set the fallback URL of the OCSP responder.  This fallback  will  be  used  if  the
             trusted  CA  from  <u>/etc/iked/ca/</u>  does  not  have  an  OCSP-URL  extension.  The matching responder
             certificates have to be placed in <u>/etc/iked/ocsp/responder.crt</u>.

             The optional <b>tolerate</b> parameter specifies how much the OCSP response attribute ‘thisUpdate’ may  be
             in  the  future  and how much ‘nextUpdate’ may be in the past, with respect to the local time.  The
             optional <b>maxage</b> parameter specifies how much ‘thisUpdate’ may be in the past.  If <b>tolerate</b>  is  set
             to 0 then the times are not verified at all.  This is the default setting.

       <b>set</b> <b>vendorid</b>
             Send OpenIKED Vendor ID payload.  This is the default.

       <b>set</b> <b>novendorid</b>
             Don't send a Vendor ID payload.

       <b>user</b> <u>name</u> <u>password</u>
             <u><a href="../man8/iked.8.html">iked</a></u>(8)  supports  user-based  authentication  by  tunneling the Extensible Authentication Protocol
             (EAP) over IKEv2.  In its most basic form,  the  users  will  be  authenticated  against  a  local,
             integrated  password  database that is configured with the <b>user</b> lines in <b>iked.conf</b> and the <u>name</u> and
             <u>password</u> arguments.  The password has to be specified in plain text which is  required  to  support
             different challenge-based EAP methods like EAP-MD5 or EAP-MSCHAPv2.

</pre><h4><b>AUTOMATIC</b> <b>KEYING</b> <b>POLICIES</b></h4><pre>
       This  section  is  used  to  configure  policies  that  will  be  used by <u><a href="../man8/iked.8.html">iked</a></u>(8) to set up flows and SAs
       automatically.  Some examples of setting up automatic keying:

          # Set up a VPN:
          # First between the gateway machines 192.168.3.1 and 192.168.3.2
          # Second between the networks 10.1.1.0/24 and 10.1.2.0/24
          ikev2 esp from 192.168.3.1 to 192.168.3.2
          ikev2 esp from 10.1.1.0/24 to 10.1.2.0/24 peer 192.168.3.2

       For incoming connections from remote peers, the policies are evaluated in sequential order, from first to
       last.  The last matching policy decides what action is taken; if no policy matches  the  connection,  the
       default  action  is  to  ignore  the  connection  attempt  or to use the <u>default</u> policy, if set.  See the
       “EXAMPLES” section for a detailed example of the policy evaluation.

       The first time an IKEv2 connection matches a policy, an IKE SA is created;  for  subsequent  packets  the
       connection  is  identified  by  the  IKEv2  parameters  that  are stored in the SA without evaluating any
       policies.  After the connection is closed or times out, the IKE SA is automatically removed.

       The commands are as follows:
       <b>ikev2</b> [<u>name</u>]
             The mandatory <b>ikev2</b> keyword will identify an IKEv2 automatic keying policy.  <u>name</u>  is  an  optional
             arbitrary  string  identifying  the  policy.   The  name should only occur once in <b>iked.conf</b> or any
             included files.  If omitted, a name will be generated automatically for the policy.

       [<u>eval</u>]
             The <u>eval</u> option modifies the policy evaluation for this policy.  It can be one of  <u>quick</u>,  <u>skip</u>  or
             <u>default</u>.   If  a new incoming connection matches a policy with the <u>quick</u> option set, that policy is
             considered the last matching policy, and evaluation of subsequent policies is  skipped.   The  <u>skip</u>
             option  will  disable  evaluation of this policy for incoming connections.  The <u>default</u> option sets
             the default policy and should only be specified once.

       [<u>mode</u>]
             <u>mode</u> specifies the IKEv2 mode to use: one of <u>passive</u> or <u>active</u>.  When <u>passive</u> is specified, <u><a href="../man8/iked.8.html">iked</a></u>(8)
             will not immediately start negotiation of this tunnel, but wait for an incoming  request  from  the
             remote  peer.   When <u>active</u> is specified, negotiation will be started at once.  If omitted, <u>passive</u>
             mode will be used.

       [<u>ipcomp</u>]
             The keyword <u>ipcomp</u> specifies that <u><a href="../man4/ipcomp.4.html">ipcomp</a></u>(4), the IP Payload Compression protocol, is negotiated  in
             addition  to  encapsulation.   The optional compression is applied before packets are encapsulated.
             IPcomp must be enabled in the kernel:

                   <b>#</b> <b>sysctl</b> <b>net.inet.ipcomp.enable=1</b>

       [<u>tmode</u>]
             <u>tmode</u> describes the encapsulation mode to be used.  Possible modes are <u>tunnel</u>  and  <u>transport</u>;  the
             default is <u>tunnel</u>.

       [<u>natt</u>]
             <u>natt</u> forces negotiation of NAT-Traversal after the initial handshake.

       [<u>encap</u>]
             <u>encap</u>  specifies  the  encapsulation  protocol  to be used.  Possible protocols are <u>esp</u> and <u>ah</u>; the
             default is <u>esp</u>.

       [<u>af</u>]  This policy only applies to endpoints of the specified address family which can be either  <u>inet</u>  or
             <u>inet6</u>.   This  only  matters  for  IKEv2  endpoints  and does not restrict the traffic selectors to
             negotiate flows with different address families, e.g. IPv6 flows negotiated by IPv4 endpoints.

       <b>proto</b> <u>protocol</u>
       <b>proto</b> <b>{</b> <u>protocol</u> <u>...</u> <b>}</b>
             The optional <b>proto</b> parameter restricts the flow to a specific IP protocol.   Common  protocols  are
             <u><a href="../man4/icmp.4.html">icmp</a></u>(4),  <u><a href="../man4/tcp.4.html">tcp</a></u>(4),  and  <u><a href="../man4/udp.4.html">udp</a></u>(4).   For  a  list  of all the protocol name to number mappings used by
             <u><a href="../man8/iked.8.html">iked</a></u>(8), see the file <u><a href="file:/etc/protocols">/etc/protocols</a></u>.

             Multiple <u>protocol</u> entries can be specified, separated by commas or whitespace, if enclosed in curly
             brackets:

                   proto { tcp, udp }

       <b>rdomain</b> <u>number</u>
             Specify a different routing domain for unencrypted traffic.  The resulting  IPsec  SAs  will  match
             outgoing  packets in the specified <b>rdomain</b> <u>number</u> and move the encrypted packets to the rdomain the
             <u><a href="../man8/iked.8.html">iked</a></u>(8) instance is running in.  Vice versa, incoming <u><a href="../man4/ipsec.4.html">ipsec</a></u>(4) traffic is moved to  <b>rdomain</b>  <u>number</u>
             after decryption.

       <b>from</b> <u>src</u> [<b>port</b> <u>sport</u>] [(<u>srcnat</u>)] <b>to</b> <u>dst</u> [<b>port</b> <u>dport</u>]
             Specify  one  or  more  traffic selectors for this policy which will be used to negotiate the IPsec
             flows between the IKEv2 peers.  During the negotiation, the peers may decide to narrow a flow to  a
             subset of the configured traffic selector networks to match the policies on each side.

             Each  traffic  selector will apply for packets with source address <u>src</u> and destination address <u>dst</u>.
             If the <u>src</u> argument specifies a fictional source ID, the <u>srcnat</u> parameter can be  used  to  specify
             the  actual  source  address.  This can be used in outgoing NAT/BINAT scenarios as described below.
             The keyword <u>any</u> will match any address (i.e. 0.0.0.0/0 and ::/0).  If the <b>config</b> <b>address</b> option  is
             specified,  the  <u>dynamic</u>  keyword  can  be used to create flows from or to the dynamically assigned
             address.

             The optional <b>port</b> modifiers restrict the traffic selectors to the specified ports.  They  are  only
             valid  in conjunction with the <u><a href="../man4/tcp.4.html">tcp</a></u>(4) and <u><a href="../man4/udp.4.html">udp</a></u>(4) protocols.  Ports can be specified by number or by
             name.  For a list of  all  port  name  to  number  mappings  used  by  <u><a href="../man8/ipsecctl.8.html">ipsecctl</a></u>(8),  see  the  file
             <u><a href="file:/etc/services">/etc/services</a></u>.

       <b>local</b> <u>localip</u> <b>peer</b> <u>remote</u>
             The  <b>local</b>  parameter  specifies  the address or FQDN of the local endpoint.  Unless the gateway is
             multi-homed or uses address aliases, this option is generally not needed.

             The <b>peer</b> parameter specifies the  address  or  FQDN  of  the  remote  endpoint.   For  host-to-host
             connections where <u>dst</u> is identical to <u>remote</u>, this option is generally not needed as it will be set
             to  <u>dst</u>  automatically.  If it is not specified or if the keyword <u>any</u> is given, the default peer is
             used.

       <b>ikesa</b> <b>auth</b> <u>algorithm</u> <b>enc</b> <u>algorithm</u> <b>prf</b> <u>algorithm</u> <b>group</b> <u>group</u>
             These parameters define  the  mode  and  cryptographic  transforms  to  be  used  for  the  IKE  SA
             negotiation,  also  known  as phase 1.  The IKE SA will be used to authenticate the machines and to
             set up an encrypted channel for the IKEv2 protocol.

             Possible values for <b>auth</b>, <b>enc</b>, <b>prf</b>, <b>group</b>, and the default proposals are described below in “CRYPTO
             TRANSFORMS”.  If omitted, <u><a href="../man8/iked.8.html">iked</a></u>(8) will use the default proposals for the IKEv2 protocol.

             The keyword <b>ikesa</b> can be used multiple times as a delimiter between IKE SA proposals.  The order of
             the proposals depend on the order in the configuration.  The keywords <b>auth</b>, <b>enc</b>, <b>prf</b> and <b>group</b>  can
             be used multiple times within a single proposal to configure multiple crypto transforms.

       <b>childsa</b> <b>auth</b> <u>algorithm</u> <b>enc</b> <u>algorithm</u> <b>group</b> <u>group</u> <b>esn</b>
             These  parameters define the cryptographic transforms to be used for the Child SA negotiation, also
             known as phase 2.  Each Child SA will be used to negotiate the actual IPsec SAs.  The initial Child
             SA is always negotiated with the initial IKEv2 key exchange; additional Child SAs may be negotiated
             with additional Child SA key exchanges for an established IKE SA.

             Possible values for <b>auth</b>, <b>enc</b>, <b>group</b>, <b>esn</b>, and the default proposals are described below in “CRYPTO
             TRANSFORMS”.  If omitted, <u><a href="../man8/iked.8.html">iked</a></u>(8) will use the default proposals for the ESP or AH protocol.

             The <b>group</b> option will only be used to enable Perfect Forward Secrecy (PFS) for additional Child SAs
             exchanges that are not part of the initial key exchange.

             The keyword <b>childsa</b> can be used multiple times as a delimiter  between  Child  SA  proposals.   The
             order  of the proposals depend on the order in the configuration.  The keywords <b>auth</b>, <b>enc</b> and <b>group</b>
             can be used multiple times within a single proposal to configure multiple crypto transforms.

       <b>srcid</b> <u>string</u> <b>dstid</b> <u>string</u>
             <b>srcid</b> defines an ID of type “FQDN”, “ASN1_DN”, “IPV4”, “IPV6”, or “UFQDN”  that  will  be  used  by
             <u><a href="../man8/iked.8.html">iked</a></u>(8) as the identity of the local peer.  If the argument is an email address (<a href="mailto:reyk@example.com">reyk@example.com</a>),
             <u><a href="../man8/iked.8.html">iked</a></u>(8)  will  use UFQDN as the ID type.  The ASN1_DN type will be used if the string starts with a
             slash ‘/’ (/C=DE/../CN=10.0.0.1/emailAddress=<a href="mailto:reyk@example.com">reyk@example.com</a>).  If the argument is an IPv4 address
             or a compressed IPv6 address, the ID types IPV4 or IPV6 will be used.  Anything else is  considered
             to be an FQDN.

             If  <b>srcid</b>  is  omitted, the default is to use the hostname of the local machine, see <u><a href="../man1/hostname.1.html">hostname</a></u>(1) to
             set or print the hostname.

             <b>dstid</b> is similar to <b>srcid</b>, but instead specifies the ID to be used by the remote peer.

       <b>ikelifetime</b> <u>time</u>
             The optional <b>ikelifetime</b> parameter defines the IKE  SA  expiration  timeout  by  the  <u>time</u>  SA  was
             created.  A zero value disables active IKE SA rekeying.  This is the default.

             The accepted format of the <u>time</u> specification is described below.

       <b>lifetime</b> <u>time</u> [<b>bytes</b> <u>bytes</u>]
             The  optional  <b>lifetime</b> parameter defines the Child SA expiration timeout by the <u>time</u> SA was in use
             and by the number of <u>bytes</u> that were processed using the SA.  Default values  are  3  hours  and  4
             gigabytes which means that SA will be rekeyed before reaching the time limit or 4 gigabytes of data
             will pass through.  Zero values disable rekeying.

             Several unit specifiers are recognized (ignoring case): ‘m’ and ‘h’ for minutes and hours, and ‘K’,
             ‘M’ and ‘G’ for kilo-, mega- and gigabytes accordingly.

             Rekeying must happen at least several times a day as IPsec security heavily depends on frequent key
             renewals.

       [<u>ikeauth</u>]
             Specify  a method to be used to authenticate the remote peer.  <u><a href="../man8/iked.8.html">iked</a></u>(8) will automatically determine
             a method based on public keys or certificates configured for the peer.   <u>ikeauth</u>  can  be  used  to
             override  this  behaviour.   Non-psk  modes  will  require setting up certificates and RSA or ECDSA
             public keys; see <u><a href="../man8/iked.8.html">iked</a></u>(8) for more information.

                   <b>eap</b> <u>type</u>
                            Use EAP to authenticate the initiator.  The only supported  EAP  <u>type</u>  is  currently
                            <u>MSCHAP-V2</u>.  The responder will use RSA public key authentication.
                   <b>ecdsa256</b>
                            Use ECDSA with a 256-bit elliptic curve key and SHA2-256 for authentication.
                   <b>ecdsa384</b>
                            Use ECDSA with a 384-bit elliptic curve key and SHA2-384 for authentication.
                   <b>ecdsa521</b>
                            Use ECDSA with a 521-bit elliptic curve key and SHA2-512 for authentication.
                   <b>psk</b> <u>string</u>
                            Use a pre-shared key <u>string</u> or hex value (starting with 0x) for authentication.
                   <b>psk</b> <b>file</b> <u>path</u>
                            Use a pre-shared hex key (without leading 0x) read from <u>path</u> for authentication.
                   <b>rfc7427</b>  Only use RFC 7427 signatures for authentication.  RFC 7427 signatures currently only
                            support SHA2-256 as the hash.
                   <b>rsa</b>      Use RSA public key authentication with SHA1 as the hash.

             The default is to allow any signature authentication.

       <b>config</b> <u>option</u> <u>address</u>
       <b>request</b> <u>option</u> <u>address</u>
             Request or serve one or more optional configuration payloads (CP).  The configuration <u>option</u> can be
             one of the following with the expected address format:

                   <b>address</b> <u>address</u>
                           Assign a static address on the internal network.
                   <b>address</b> <u>address/prefix</u>
                           Assign  a dynamic address on the internal network.  The address will be assigned from
                           an address pool with the size specified by <u>prefix</u>.
                   <b>netmask</b> <u>netmask</u>
                           The IPv4 netmask of the internal network.
                   <b>name-server</b> <u>address</u>
                           The DNS server address within the internal network.
                   <b>netbios-server</b> <u>address</u>
                           The NetBIOS name server (WINS) within the internal network.  This option is  provided
                           for compatibility with legacy clients.
                   <b>dhcp-server</b> <u>address</u>
                           The address of an internal DHCP server for further configuration.
                   <b>protected-subnet</b> <u>address/prefix</u>
                           The  address  of  an additional IPv4 or IPv6 subnet reachable over the gateway.  This
                           option is used to notify the peer of a subnet behind the gateway (that might  require
                           a  second SA).  Networks specified in this SA's "from" or "to" options do not need to
                           be included.
                   <b>access-server</b> <u>address</u>
                           The address of an internal remote access server.

       <b>iface</b> <u>interface</u>
             Enable automatic network configuration as initiator.  Received addresses,  routes  and  nameservers
             will be installed on the specified <u>interface</u>.

       <b>tag</b> <u>string</u>
             Add  a <u><a href="../man4/pf.4.html">pf</a></u>(4) tag to all packets of IPsec SAs created for this connection.  This will allow matching
             packets for this connection by defining rules in <u><a href="../man5/pf.conf.5.html">pf.conf</a></u>(5) using the <b>tagged</b> keyword.

             The following variables can be used in tags to include information from the remote peer on runtime:

                   <u>$id</u>      The <b>dstid</b> that was proposed by the remote peer  to  identify  itself.   It  will  be
                            expanded  to  <u>id-value</u>, e.g. <u>FQDN/foo.example.com</u>.  To limit the size of the derived
                            tag, <u><a href="../man8/iked.8.html">iked</a></u>(8) will extract the common  name  ‘CN=’  from  ASN1_DN  IDs,  for  example
                            <u>ASN1_ID//C=DE/../CN=10.1.1.1/..</u> will be expanded to <u>10.1.1.1</u>.
                   <u>$eapid</u>   For a connection using EAP, the identity (username) used by the remote peer.
                   <u>$domain</u>  Extract the domain from IDs of type FQDN, UFQDN or ASN1_DN.
                   <u>$name</u>    The  name  of  the  IKEv2  policy  that was configured in <b>iked.conf</b> or automatically
                            generated by <u><a href="../man8/iked.8.html">iked</a></u>(8).

             For example, if the ID is <u>FQDN/foo.example.com</u> or <u>UFQDN/<a href="mailto:user@example.com">user@example.com</a></u>,  “ipsec-$domain”  expands
             to  “ipsec-example.com”.   The variable expansion for the <u>tag</u> directive occurs only at runtime (not
             when the file is parsed) and must be quoted, or it will be interpreted as a macro.

       <b>tap</b> <u>interface</u>
             Send the decapsulated IPsec traffic to the specified <u><a href="../man4/enc.4.html">enc</a></u>(4) <u>interface</u> instead of <u>enc0</u> for filtering
             and monitoring.  The traffic will be blocked if the specified <u>interface</u> does not exist.

</pre><h4><b>PACKET</b> <b>FILTERING</b></h4><pre>
       IPsec traffic appears unencrypted on the <u><a href="../man4/enc.4.html">enc</a></u>(4) interface and  can  be  filtered  accordingly  using  the
       OpenBSD packet filter, <u><a href="../man4/pf.4.html">pf</a></u>(4).  The grammar for the packet filter is described in <u><a href="../man5/pf.conf.5.html">pf.conf</a></u>(5).

       The following components are relevant to filtering IPsec traffic:

             external interface
             Interface for IKE traffic and encapsulated IPsec traffic.

             proto udp port 500
             IKE traffic on the external interface.

             proto udp port 4500
             IKE NAT-Traversal traffic on the external interface.

             proto ah | esp
             Encapsulated IPsec traffic on the external interface.

             enc0
             Default  interface  for  outgoing traffic before it's been encapsulated, and incoming traffic after
             it's been decapsulated.  State on this interface should be interface bound; see <u><a href="../man4/enc.4.html">enc</a></u>(4) for  further
             information.

             proto ipencap
             [tunnel mode only] IP-in-IP traffic flowing between gateways on the enc0 interface.

             tagged ipsec-example.org
             Match traffic of IPsec SAs using the <b>tag</b> keyword.

       If the filtering rules specify to block everything by default, the following rule would ensure that IPsec
       traffic never hits the packet filtering engine, and is therefore passed:

             set skip on enc0

       In  the  following  example,  all  traffic  is  blocked  by default.  IPsec-related traffic from gateways
       {192.168.3.1, 192.168.3.2} and networks {10.0.1.0/24, 10.0.2.0/24} is permitted.

             block on ix0
             block on enc0

             pass  in on ix0 proto udp from 192.168.3.2 to 192.168.3.1 \
                     port {500, 4500}
             pass out on ix0 proto udp from 192.168.3.1 to 192.168.3.2 \
                     port {500, 4500}

             pass  in on ix0 proto esp from 192.168.3.2 to 192.168.3.1
             pass out on ix0 proto esp from 192.168.3.1 to 192.168.3.2

             pass  in on enc0 proto ipencap from 192.168.3.2 to 192.168.3.1 \
                     keep state (if-bound)
             pass out on enc0 proto ipencap from 192.168.3.1 to 192.168.3.2 \
                     keep state (if-bound)
             pass  in on enc0 from 10.0.2.0/24 to 10.0.1.0/24 \
                     keep state (if-bound)
             pass out on enc0 from 10.0.1.0/24 to 10.0.2.0/24 \
                     keep state (if-bound)

       <u><a href="../man4/pf.4.html">pf</a></u>(4) has the ability to filter IPsec-related packets based  on  an  arbitrary  <u>tag</u>  specified  within  a
       ruleset.  The tag is used as an internal marker which can be used to identify the packets later on.  This
       could be helpful, for example, in scenarios where users are connecting in from differing IP addresses, or
       to support queue-based bandwidth control, since the enc0 interface does not support it.

       The  following <u><a href="../man5/pf.conf.5.html">pf.conf</a></u>(5) fragment uses queues for all IPsec traffic with special handling for developers
       and employees:

             queue std on ix0 bandwidth 100M
             queue   deflt parent std bandwidth 10M default
             queue   developers parent std bandwidth 75M
             queue   employees parent std bandwidth 5M
             queue   ipsec parent std bandwidth 10M

             pass out on ix0 proto esp set queue ipsec

             pass out on ix0 tagged ipsec-developers.example.com \
                     set queue developers
             pass out on ix0 tagged ipsec-employees.example.com \
                     set queue employees

       The following example assigns the tags in the <b>iked.conf</b> configuration and also sets an alternative <u><a href="../man4/enc.4.html">enc</a></u>(4)
       device:

             ikev2 esp from 10.1.1.0/24 to 10.1.2.0/24 peer 192.168.3.2 \
                     tag "ipsec-$domain" tap "enc1"

</pre><h4><b>OUTGOING</b> <b>NETWORK</b> <b>ADDRESS</b> <b>TRANSLATION</b></h4><pre>
       In some network topologies it is desirable to perform NAT on traffic leaving through the VPN tunnel.   In
       order to achieve that, the <u>src</u> argument is used to negotiate the desired network ID with the peer and the
       <u>srcnat</u> parameter defines the true local subnet, so that a correct SA can be installed on the local side.

       For  example,  if  the  local subnet is 192.168.1.0/24 and all the traffic for a specific VPN peer should
       appear as coming from 10.10.10.1, the following configuration is used:

             ikev2 esp from 10.10.10.1 (192.168.1.0/24) to 192.168.2.0/24 \
                     peer 10.10.20.1

       Naturally, a relevant NAT rule is required in <u><a href="../man5/pf.conf.5.html">pf.conf</a></u>(5).  For the example above, this would be:

             match out on enc0 from 192.168.1.0/24 to 192.168.2.0/24 \
                     nat-to 10.10.10.1

       From the peer's point of view, the local end of the VPN tunnel is declared to be 10.10.10.1 and  all  the
       traffic arrives with that source address.

</pre><h4><b>CRYPTO</b> <b>TRANSFORMS</b></h4><pre>
       The following authentication types are permitted with the <b>auth</b> keyword:

             <u>Authentication</u>    <u>Key</u> <u>Length</u>    <u>Truncated</u> <u>Length</u>    <u>Default</u>
             <b>hmac-md5</b>          128 bits      96 bits
             <b>hmac-sha1</b>         160 bits      96 bits             x
             <b>hmac-sha2-256</b>     256 bits      128 bits            x
             <b>hmac-sha2-384</b>     384 bits      192 bits            x
             <b>hmac-sha2-512</b>     512 bits      256 bits            x

       The following pseudo-random function types are permitted with the <b>prf</b> keyword:

             <u>PRF</u>              <u>Key</u> <u>Length</u>    <u>Default</u>
             <b>hmac-md5</b>         128 bits                 [IKE only]
             <b>hmac-sha1</b>        160 bits      x          [IKE only]
             <b>hmac-sha2-256</b>    256 bits      x          [IKE only]
             <b>hmac-sha2-384</b>    384 bits      x          [IKE only]
             <b>hmac-sha2-512</b>    512 bits      x          [IKE only]

       The following cipher types are permitted with the <b>enc</b> keyword:

             <u>Cipher</u>               <u>Key</u> <u>Length</u>    <u>Default</u>
             <b>3des</b>                 168 bits      x
             <b>aes-128</b>              128 bits      x
             <b>aes-192</b>              192 bits      x
             <b>aes-256</b>              256 bits      x
             <b>aes-128-ctr</b>          160 bits                 [ESP only]
             <b>aes-192-ctr</b>          224 bits                 [ESP only]
             <b>aes-256-ctr</b>          288 bits                 [ESP only]
             <b>aes-128-gcm</b>          160 bits      x
             <b>aes-192-gcm</b>          224 bits                 [ESP only]
             <b>aes-256-gcm</b>          288 bits      x
             <b>aes-128-gcm-12</b>       160 bits                 [IKE only]
             <b>aes-256-gcm-12</b>       288 bits                 [IKE only]
             <b>blowfish</b>             160 bits                 [ESP only]
             <b>cast</b>                 128 bits                 [ESP only]
             <b>chacha20-poly1305</b>    288 bits                 [ESP only]

       The following cipher types provide only authentication, not encryption:

             <b>aes-128-gmac</b>         160 bits                 [ESP only]
             <b>aes-192-gmac</b>         224 bits                 [ESP only]
             <b>aes-256-gmac</b>         288 bits                 [ESP only]
             <b>null</b>                                          [ESP only]

       The Extended Sequence Numbers option can be enabled or disabled with the <b>esn</b> or <b>noesn</b> keywords:

             <u>ESN</u>      <u>Default</u>
             <b>esn</b>      x          [ESP only]
             <b>noesn</b>    x          [ESP only]

       Transforms followed by [IKE only] can only be used with the <b>ikesa</b> keyword, transforms with [ESP only] can
       only be used with the <b>childsa</b> keyword.

       Using  AES-GMAC  or  NULL  with  ESP will only provide authentication.  This is useful in setups where AH
       cannot be used, e.g. when NAT is involved.

       The following group types are permitted with the <b>group</b> keyword:

             <u>Name</u>              <u>Group</u>   <u>Size</u>     <u>Type</u>          <u>Default</u>
             <b>modp768</b>           grp1    768      MODP                    [insecure]
             <b>modp1024</b>          grp2    1024     MODP          x         [weak]
             <b>modp1536</b>          grp5    1536     MODP          x         [weak]
             <b>modp2048</b>          grp14   2048     MODP          x
             <b>modp3072</b>          grp15   3072     MODP          x
             <b>modp4096</b>          grp16   4096     MODP          x
             <b>modp6144</b>          grp17   6144     MODP
             <b>modp8192</b>          grp18   8192     MODP
             <b>ecp256</b>            grp19   256      ECP           x
             <b>ecp384</b>            grp20   384      ECP           x
             <b>ecp521</b>            grp21   521      ECP           x
             <b>ecp192</b>            grp25   192      ECP
             <b>ecp224</b>            grp26   224      ECP
             <b>brainpool224</b>      grp27   224      ECP
             <b>brainpool256</b>      grp28   256      ECP
             <b>brainpool384</b>      grp29   384      ECP
             <b>brainpool512</b>      grp30   512      ECP
             <b>curve25519</b>        grp31   256      Curve25519    x
             <b>sntrup761x25519</b>           1190 B   Hybrid PQKE

       The currently supported group types are either MODP (exponentiation groups modulo a prime), ECP (elliptic
       curve groups modulo a prime), or Curve25519.  MODP groups of less than 2048 bits are considered  as  weak
       or insecure (see RFC 8247 section 2.4) and only provided for backwards compatibility.

</pre><h4><b>FILES</b></h4><pre>
       <u>/etc/iked.conf</u>
       <u>/etc/examples/iked.conf</u>

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  first  example  is  intended for a server with clients connecting to <u><a href="../man8/iked.8.html">iked</a></u>(8) as an IPsec gateway, or
       IKEv2 responder, using mutual public  key  authentication  and  additional  challenge-based  EAP-MSCHAPv2
       password authentication:

             user "test" "password123"

             ikev2 "win7" esp \
                     from dynamic to 172.16.2.0/24 \
                     peer 10.0.0.0/8 local 192.168.56.0/24 \
                     eap "mschap-v2" \
                     config address 172.16.2.1 \
                     tag "$name-$id"

       The next example allows peers to authenticate using a pre-shared key ‘foobar’:

             ikev2 "big test" \
                     esp proto tcp \
                     from 10.0.0.0/8 port 23 to 20.0.0.0/8 port 40 \
                     from 192.168.1.1 to 192.168.2.2 \
                     peer any local any \
                     ikesa \
                             enc aes-128-gcm \
                             group ecp256 group curve25519 \
                     ikesa \
                             enc aes-128 auth hmac-sha2-256 \
                             group ecp256 group curve25519 \
                     childsa enc aes-128-gcm \
                     childsa enc aes-128 auth hmac-sha2-256  \
                     srcid host.example.com \
                     dstid 192.168.0.254 \
                     psk "foobar"

       The  following  example  illustrates  the  last matching policy evaluation for incoming connections on an
       IKEv2 gateway.  The peer 192.168.1.34 will always match the first policy because of  the  <u>quick</u>  keyword;
       connections  from  the peers 192.168.1.3 and 192.168.1.2 will be matched by one of the last two policies;
       any other connections from 192.168.1.0/24  will  be  matched  by  the  ‘subnet’  policy;  and  any  other
       connection will be matched by the ‘catch all’ policy.

             ikev2 quick esp from 10.10.10.0/24 to 10.20.20.0/24 \
                     peer 192.168.1.34
             ikev2 "catch all" esp from 10.0.1.0/24 to 10.0.2.0/24 \
                     peer any
             ikev2 "subnet" esp from 10.0.3.0/24 to 10.0.4.0/24 \
                     peer 192.168.1.0/24
             ikev2 esp from 10.0.5.0/30 to 10.0.5.4/30 peer 192.168.1.2
             ikev2 esp from 10.0.5.8/30 to 10.0.5.12/30 peer 192.168.1.3

       This  example  encrypts  a <u><a href="../man4/gre.4.html">gre</a></u>(4) tunnel from local machine A (2001:db8::aa:1) to peer D (2001:db8::dd:4)
       based on FQDN-based public key authentication; <u>transport</u> mode avoids double encapsulation:

             ikev2 transport \
                     proto gre \
                     from 2001:db8::aa:1 to 2001:db8::dd:4 \
                     peer D.example.com

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man4/enc.4.html">enc</a></u>(4), <u><a href="../man4/ipsec.4.html">ipsec</a></u>(4), <u><a href="../man5/ipsec.conf.5.html">ipsec.conf</a></u>(5), <u><a href="../man5/pf.conf.5.html">pf.conf</a></u>(5), <u><a href="../man8/ikectl.8.html">ikectl</a></u>(8), <u><a href="../man8/iked.8.html">iked</a></u>(8)

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>iked.conf</b> file format first appeared in OpenBSD 4.8.

</pre><h4><b>AUTHORS</b></h4><pre>
       The <u><a href="../man8/iked.8.html">iked</a></u>(8) program was written by Reyk Floeter &lt;<u><a href="mailto:reyk@openbsd.org">reyk@openbsd.org</a></u>&gt;.

Debian                                          November 4, 2024                                    <u><a href="../man5/IKED.CONF.5.html">IKED.CONF</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>