<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>logging.yaml - the logging.yaml file defines all custom log file formats, filters, and processing options</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/trafficserver">trafficserver_9.2.5+ds-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       logging.yaml - the logging.yaml file defines all custom log file formats, filters, and processing options

       <b>IMPORTANT:</b>
          This   configuration  file  replaces  the  XML  based  logs_xml.config,  as  well  as  the  Lua  based
          logging.config from past Traffic Server releases. If you are upgrading from a Traffic  Server  release
          which  used  either  the  XML  or  the  Lua configuration file format, and you have created custom log
          formats, filters, and destinations, you will need to update those settings to this format.

</pre><h4><b>LOG</b> <b>DEFINITIONS</b></h4><pre>
       Custom logs are configured by the combination of three key elements: a format, an optional filter, and  a
       log destination.

       A  <u>format</u>  defines  how log lines will appear (as well as whether the logs using the format will be event
       logs or summary logs).

       A <u>filter</u> defines what events do, and what events don't, make it into the logs employing the filter.

       A <u>log</u> defines where the record of events or summaries ends up.

   <b>Formats</b>
       Custom logging formats may be provided directly to a log definition, or they may be defined as a reusable
       variable in your <u>logging.yaml</u> for ease of reference, particularly when you may have  more  than  one  log
       using  the same format. Which approach you use is entirely up to you, though it's strongly recommended to
       create an explicit format object if you intend to reuse the same format for multiple log files.

       Custom formats are defined by choosing a <b>name</b> to identify the given logging format, and a <b>format</b>  string,
       which  defines  the output format string for every event. An optional <b>interval</b> attribute can be specified
       to define the aggregation interval for summary logs.

          # A one-line-per-event format that just prints event timestamps.
          formats:
          - name: myformat
            format: '%&lt;cqtq&gt;'

          # An aggregation/summary format that prints the last event timestamp from
          # the interval along with the total count of events in the same interval.
          # (Doing so every 30 seconds.)
          formats:
          - name: mysummaryformat
            format: '%&lt;LAST(cqtq)&gt; %&lt;COUNT(*)&gt;'
            interval: 30

       You may define as many and as varied a collection of format objects as you desire.

   <b>Format</b> <b>Specification</b>
       The format specification provided as the required <b>format</b> attribute of the objects listed in <b>formats</b> is  a
       simple  string,  containing  whatever mixture of logging field variables and literal characters meet your
       needs. Logging fields are discussed in great detail in the <u>Log</u> <u>Fields</u> section.

       Flexible enough to not only emulate the logging formats of most other proxy and HTTP servers, but also to
       provide even finer detail than many of them, the logging fields are very easy to use. Within  the  format
       string, logging fields are indicated by enclosing their name within angle brackets (<b>&lt;</b> and <b>&gt;</b>), preceded by
       a  percent  symbol  (<b>%</b>).  For  example,  returning to the altogether too simple format shown earlier, the
       following format string:

          '%&lt;cqtq&gt;'

       Defines a format in which nothing but the value of the  logging  field  <u>cqtq</u>  is  interpolated  for  each
       event's  entry  in  the  log.  We could include some literal characters in the log output by updating the
       format specification as so:

          'Event received at %&lt;cqtq&gt;'

       Because the string "Event received at " (including the trailing space) is just a bunch of characters, not
       enclosed in <b>%&lt;...&gt;</b>, it is repeated verbatim in the logging output.

       Multiple logging fields may of course be used:

          '%&lt;cqtq&gt; %&lt;chi&gt; %&lt;cqhm&gt; %&lt;cqtx&gt;'

       Each logging field is separately enclosed in its own percent-brace set.

       There are a small number of logging fields which extend this simple format, primarily those dealing  with
       request and response headers. Instead of defining a separate logging field name for every single possible
       HTTP  header  (an impossible task, given that arbitrary vendor/application headers may be present in both
       requests and responses), there are instead single logging fields for each of the major stages of an event
       lifecycle that permit access to named headers, such as:

          '%&lt;{User-Agent}cqh&gt;'

       Which emits to the log the value of the client request's <b>User-Agent</b> HTTP  header.  Other  stages  of  the
       event lifecycle have similar logging fields: <b>pqh</b> (proxy requests), <b>ssh</b> (origin server responses), and <b>psh</b>
       (proxy responses).

       You will find a complete listing of the available fields in <u>Log</u> <u>Fields</u>.

   <b>Aggregation</b> <b>Interval</b>
       Every  format  may  be  given  an  optional <b>interval</b> value, specified as the number of seconds over which
       events destined for a log using the  format  are  aggregated  and  summarized.  Logs  which  use  formats
       containing  an  aggregation interval do not behave like regular logs, with a single line for every event.
       Instead, they emit a single line only every <u>interval</u>-seconds.

       These types of logs are described in more detail in <u>Summary</u> <u>Logs</u>.

       Formats have no interval by default, and will generate event-based logs unless given one.

   <b>Filters</b>
       Trafficserver supports different type of filters : <b>accept</b>, <b>reject</b>  and  <b>wipe_field_value</b>.   They  may  be
       used, optionally, to accept, reject logging or mask query param values for matching events.

       Filter  objects  are created by assigning them a <b>name</b> to be used later to refer to the filter, as well as
       an <b>action</b> (either <b>accept</b>, <b>reject</b> or <b>wipe_field_value</b>). <b>Accept</b>, <b>reject</b> or <b>wipe_field_value</b> filters require
       a <b>condition</b> against which to match all events. The <b>condition</b> fields must be in the following format:

          &lt;field&gt; &lt;operator&gt; &lt;value&gt;

       For example, the following snippet defines a filter that matches all POST requests:

          filters:
          - name: postfilter
            action: accept
            condition: cqhm MATCH POST

   <b>Filter</b> <b>Fields</b>
       The log fields have already been discussed in the <u>Formats</u> section above. For a reference to the available
       log field names, see <u>Log</u> <u>Fields</u>.  Unlike with the log format specification, you do not wrap the log field
       names in any additional markup.

   <b>Filter</b> <b>Operators</b>
       The operators describe how to perform the matching in the  filter  rule,  and  may  be  any  one  of  the
       following:

       <b>MATCH</b>  True if the values of <b>field</b> and <b>value</b> are identical.  Case-sensitive.

       <b>CASE_INSENSITIVE_MATCH</b>
              True if the values of <b>field</b> and <b>value</b> are identical.  Case-insensitive.

       <b>CONTAIN</b>
              True  if  the  value of <b>field</b> contains <b>value</b> (i.e. <b>value</b> is a substring of the contents of <b>field</b>).
              Case-sensitive.

       <b>CASE_INSENSITIVE_CONTAIN</b>
              True if the value of <b>field</b> contains <b>value</b> (i.e. <b>value</b> is a substring of the  contents  of  <b>field</b>).
              Case-insensitive.

   <b>Filter</b> <b>Values</b>
       The final component of a filter string specifies the value against which the name field will be compared.

       For integer matches, all of the operators are effectively equivalent and require the field to be equal to
       the given integer. If you wish to match multiple integers, provide a comma separated list like this:

          &lt;field&gt; &lt;operator&gt; 4,5,6,7

       String  matches  work  similarly  to  integer  matches.  Multiple  matches are also supported via a comma
       separated list. For example:

          &lt;field&gt; &lt;operator&gt; e1host,host2,hostz

       For IP addresses, ranges may be specified by separating the first address and the last of the range  with
       a  single  <b>-</b>  dash, as <b>10.0.0.0-10.255.255.255</b> which gives the ranges for the 10/8 network. Other network
       notations are not supported at this time.

       <b>NOTE:</b>
          It may be tempting to attach multiple Filters to a log object reject multiple log fields (in  lieu  of
          providing  a  single  comma  separated list to a single Filter). Avoid this temptation and use a comma
          separated list of reject objects instead. Remember that  you  may  not  have  multiple  accept  filter
          objects.  Attaching multiple filters does the opposite of what you'd expect. If, for example, we had 2
          accept  log  filters,  each  disjoint  from  the  other, nothing will ever get logged on the given log
          object.

   <b>Logs</b>
       Up to this point, we've only described what events should be logged and what they should look like in the
       logging output. Now we define where those logs should be sent.

       Three options currently exist for the type of logging output: <b>ascii</b>, <b>binary</b>, and <b>ascii_pipe</b>.  Which  type
       of  logging output you choose depends largely on how you intend to process the logs with other tools, and
       a discussion of the merits of each is covered elsewhere, in <u>Deciding</u> <u>Between</u> <u>ASCII</u> <u>or</u> <u>Binary</u> <u>Output</u>.

       The following subsections cover the attributes you should specify when creating your logging object. Only
       <b>filename</b> and <b>format</b> are required.
                 ┌──────────────────────┬──────────────────┬────────────────────────────────────────┐
                 │ Name                 │ Type             │ Description                            │
                 ├──────────────────────┼──────────────────┼────────────────────────────────────────┤
                 │ filename             │ string           │ The  name  of  the   logfile           │
                 │                      │                  │ relative   to   the  default           │
                 │                      │                  │ logging directory (set  with           │
                 │                      │                  │ <u>proxy.config.log.logfile_dir</u>).         │
                 │                      │                  │ If  this is set to <b>stdout</b> or           │
                 │                      │                  │ <b>stderr</b>, then the  stdout  or           │
                 │                      │                  │ stderr stream will be logged           │
                 │                      │                  │ to, respectively.                      │
                 ├──────────────────────┼──────────────────┼────────────────────────────────────────┤
                 │ format               │ string           │ a  string  with  a valid named         │
                 │                      │                  │ format specification.                  │
                 ├──────────────────────┼──────────────────┼────────────────────────────────────────┤
                 │ header               │ string           │ If  present,  emitted  as  the         │
                 │                      │                  │ first  line  of  each  new log         │
                 │                      │                  │ file.                                  │
                 ├──────────────────────┼──────────────────┼────────────────────────────────────────┤
                 │ rolling_enabled      │ <u>see</u> <u>below</u>        │ Determines  the  type  of  log         │
                 │                      │                  │ rolling  to use (or whether to         │
                 │                      │                  │ disable  rolling).   Overrides         │
                 │                      │                  │ <u>proxy.config.log.rolling_enabled</u>.      │
                 ├──────────────────────┼──────────────────┼────────────────────────────────────────┤
                 │ rolling_interval_sec │ number           │ Interval  in  seconds between log      │
                 │                      │                  │ file     rolling.       Overrides      │
                 │                      │                  │ <u>proxy.config.log.rolling_interval_sec</u>. │
                 ├──────────────────────┼──────────────────┼────────────────────────────────────────┤
                 │ rolling_offset_hr    │ number           │ Specifies  an  hour  (from 0 to 23) at │
                 │                      │                  │ which log  rolling  is  guaranteed  to │
                 │                      │                  │ align.   Only   has   an   effect   if │
                 │                      │                  │ RollingIntervalSec is set  to  greater │
                 │                      │                  │ than      one      hour.     Overrides │
                 │                      │                  │ <u>proxy.config.log.rolling_offset_hr</u>.    │
                 ├──────────────────────┼──────────────────┼────────────────────────────────────────┤
                 │ rolling_size_mb      │ number           │ Size, in megabytes, at which log files │
                 │                      │                  │ are rolled.                            │
                 ├──────────────────────┼──────────────────┼────────────────────────────────────────┤
                 │ rolling_min_count    │ number           │ Specifies the minimum number of rolled │
                 │                      │                  │ logs to keep.                          │
                 ├──────────────────────┼──────────────────┼────────────────────────────────────────┤
                 │ filters              │ array of filters │ The optional list  of  filter  objects │
                 │                      │                  │ which  restrict  the individual events │
                 │                      │                  │ logged. The array may only contain one │
                 │                      │                  │ accept filter.                         │
                 └──────────────────────┴──────────────────┴────────────────────────────────────────┘

       Enabling log rolling may be done globally in <u>records.config</u>, or on a per-log basis by passing appropriate
       values for the <b>rolling_enabled</b> key. The latter method may  also  be  used  to  effect  different  rolling
       settings  for  individual  logs.  The  numeric  values  that  may  be  passed  are  the  same  as used by
       <u>proxy.config.log.rolling_enabled</u>. For convenience and readability, the following predefined variables may
       also be used in <u>logging.yaml</u>:

       <b>log.roll.none</b>
              Disable log rolling.

       <b>log.roll.time</b>
              Roll at a certain time frequency, specified by RollingIntervalSec and RollingOffsetHr.

       <b>log.roll.size</b>
              Roll when the size exceeds RollingSizeMb.

       <b>log.roll.both</b>
              Roll when either the specified rolling time is reached or the specified file size is reached.

       <b>log.roll.any</b>
              Roll the log file when the specified rolling time is reached if the size of  the  file  equals  or
              exceeds the specified size.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following is an example of a format that collects information using three common fields:

          formats:
          - name: minimalfmt
            format: '%&lt;chi&gt; , %&lt;cqu&gt; , %&lt;pssc&gt;'

       The following is an example of a format that uses aggregate operators to produce a summary log:

          formats:
          - name: summaryfmt
            format: '%&lt;LAST(cqts)&gt;:%&lt;COUNT(*)&gt;:%&lt;SUM(psql)&gt;'
            interval: 10

       The following is an example of a filter that will cause only REFRESH_HIT events to be logged:

          filters:
          - name: refreshhitfilter
            action: accept
            condition: pssc MATCH REFRESH_HIT

       The  following  is an example of a log specification that creates a local log file for the minimal format
       defined earlier. The log filename will be <b>minimal.log</b> because we select the ASCII logging format.

          logs:
          - mode: ascii
            filename: minimal
            format: minimalfmt

       The following is an example of a log specification that creates a local log file using the summary format
       from earlier, and only includes events that matched the REFRESH_HIT filter we created.

          logs:
          - mode: ascii
            filename: refreshhit_summary
            format: summaryfmt
            filters:
            - refreshhitfilter

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2025, <a href="mailto:dev@trafficserver.apache.org">dev@trafficserver.apache.org</a>

9.2                                               May 22, 2025                                   <u><a href="../man5/LOGGING.YAML.5.html">LOGGING.YAML</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>