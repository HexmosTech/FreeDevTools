<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ipsvd-instruct - format of the ipsvd(8) instructions directory</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/ipsvd">ipsvd_1.0.0-12_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ipsvd-instruct - format of the <a href="../man8/ipsvd.8.html">ipsvd</a>(8) instructions directory

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  internet  protocol  service  daemons,  <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7),  can be told to read and follow instructions from a
       directory on incoming connections to the socket they listen on.

       For mostly static instructions or for performance reasons, it is possible  to  compile  the  instructions
       from a directory into a constant database (cdb) with <b><a href="../man8/ipsvd-cdb.8.html">ipsvd-cdb</a></b>(8) for faster lookup, and to tell <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7)
       to read the instructions from there.

</pre><h4><b>MATCHING</b></h4><pre>
       On  each  incoming  connection,  the  <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7)  matches  the  client's  IP  address  against files in the
       instructions  directory.   For  example,   the   IP   address   <u>a.b.c.d</u>   which   reverse   resolves   to
       <u>moa.bit.smarden.org</u>  is matched against the following files in the instructions directory, in this order,
       first match wins:

       1.     <u>a.b.c.d</u>

       2.     <u>a.b.c</u>

       3.     <u>a.b</u>

       4.     <u>a</u>

       If the client's hostname has been successfully looked up in DNS:

       5.     <u>moa.bit.smarden.org</u>

       6.     <u>bit.smarden.org</u>

       7.     <u>smarden.org</u>

       8.     <u>org</u>

       And finally the catchall file ``0'' (zero):

       9.     <u>0</u>

       After successfully matching a client's  IP  address  or  hostname  against  the  instructions  directory,
       <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7) examines the file that matched the IP address or hostname, and acts accordingly:

       1.     If  neither the user's read permission, nor the user's execute permission is set for the file, the
              connection is closed immediately.

       2.     If the file has the user's execute permission set, <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7) reads the contents  of  the  file  and
              runs  <u><a href="file:/bin/sh">/bin/sh</a></u>  <u>-c</u>  <u>'&lt;contents&gt;'</u>  instead of the default program <u>prog</u> given at the command line for
              this connection.

       3.     If the file has the user's read permission set, <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7)  reads  the  contents  of  the  file  and
              interprets each line as an instruction for this connection (see below).

       If  the client's IP address or hostname doesn't match any file in the instructions directory, the default
       action is taken (the program <u>prog</u> is run to handle the connection).

</pre><h4><b>INSTRUCTIONS</b></h4><pre>
       If <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7) is given instructions for an  incoming  connection,  it  reads  the  corresponding  file  and
       interprets each line as follows.  The file may be empty, meaning that there is no special instruction.

       Empty lines and lines starting with ``#'' are ignored.

       <b>+</b><u>VAR=VALUE</u>
              environment.  If the line starts with a plus (``+''), and the string following the plus contains a
              ``='',  <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7)  puts  the string following the plus into the environment before starting <u>prog</u> to
              handle the connection.  If the string following the plus doesn't contain a ``='',  <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7)  makes
              sure that the environment variable with the name string is not set.

       <b>C</b><u>num</u>[:<u>msg</u>]
              concurrency.   If  the  line  starts  with  a  ``C'',  and  is  followed by a number, the per host
              concurrency limit for the IP address that initiated the connection is set to this number.  If  <u>num</u>
              is  zero, per host concurrency limit is disabled.  If <u>num</u> is followed by ``:<u>msg</u>'', the message <u>msg</u>
              is written to this client if possible, if the per host concurrency limit is reached.

              <u>msg</u> may contain  backslash-escaped  characters  as  follows:  ``\\''  is  converted  to  a  single
              backslash,  ``\n''  is  converted  to  a new line character, and ``\r'' is converted to a carriage
              return.

              On multiple concurrency instructions the last processed  concurrency  instruction  is  considered.
              Not all <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7)'s support per host concurrency.

       <b>=</b><u>hostname</u>[:<u>forward</u>]
              check hostname.  If the line starts with a ``='', and is followed by a hostname, <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7) looks up
              the IP addresses for <u>hostname</u> in DNS and checks if the client's IP address matches one of these IP
              addresses.   If so, <u><a href="../man7/ipsvd.7.html">ipsvd</a></u>(7) stops processing the instructions here and runs <u>prog</u>.  If <u>hostname</u> is
              followed a colon and <u>forward</u>, <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7) now examines the file <u>forward</u> and acts accordingly, instead
              of running <u>prog</u>.  All check hostname instructions in <u>forward</u> are ignored.   If  <u>forward</u>  does  not
              exist, the connection is closed.

              <u>hostname</u> may be ``0'' (zero), matching any IP address.

              Note: Using check hostname instructions can cause significant delay while responding to connection
              attempts, caused by DNS lookups.

       If  <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7) cannot interpret a line, it prints a warning, discards the line, and continues with the next
       instruction if any.

       After processing all instructions, <b><a href="../man7/ipsvd.7.html">ipsvd</a></b>(7) runs <u>prog</u>.  If the file contains at least one check  hostname
       instruction, and none was successful, it closes the connection instead of running <u>prog</u>.

</pre><h4><b>EXAMPLE</b> <b>INSTRUCTIONS</b></h4><pre>
       +MEMORY=20000
              This  instruction  causes  the  environment  variable  ``MEMORY''  with  the value ``20000'' to be
              available to the program <u>prog</u> that handles the connection.

       +DEBUG=
              This instruction adds the variable ``DEBUG'' with an empty value to the environment.

       +LOGNAME
              This instructions makes sure that the environment variable ``LOGNAME'' is unset when running <u>prog</u>.

       C16    Set the per host concurrency to 16.  A connection will be closed silently if there are already  16
              active connections from this client's IP address.

       =floyd.dyn.smarden.org:127.0.0.1
              Check  IP  address  of  the  dynamic  hostname  <u>floyd.dyn.smarden.org</u>.  If one of the IP addresses
              <u>floyd.dyn.smarden.org</u> currently resolves to matches the client's IP address, handle the connection
              through the file <u>127.0.0.1</u> in the instructions directory.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man7/ipsvd.7.html">ipsvd</a>(7), <a href="../man8/ipsvd-cdb.8.html">ipsvd-cdb</a>(8), <a href="../man8/tcpsvd.8.html">tcpsvd</a>(8), <a href="../man8/sslsvd.8.html">sslsvd</a>(8), <a href="../man8/udpsvd.8.html">udpsvd</a>(8), <a href="../man8/sslio.8.html">sslio</a>(8)

       <a href="http://smarden.org/ipsvd/">http://smarden.org/ipsvd/</a>

</pre><h4><b>AUTHOR</b></h4><pre>
       Gerrit Pape &lt;<a href="mailto:pape@smarden.org">pape@smarden.org</a>&gt;

                                                                                               <u><a href="../man5/ipsvd-instruct.5.html">ipsvd-instruct</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>