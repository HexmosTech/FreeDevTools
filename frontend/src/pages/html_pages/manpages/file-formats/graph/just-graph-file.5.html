<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>just-graph-file - The format of the action graph used by justbuild(1)</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/justbuild">justbuild_1.5.1-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       just-graph-file - The format of the action graph used by <b><a href="../man1/justbuild.1.html">justbuild</a></b>(1)

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  file  is  read  as JSON.  Any other serialization describing the same JSON object is equivalent.  We
       assume, that in JSON objects, each key occurs at most once; it is implementation defined how  repetitions
       of the same key are treated.

   <b>Artifacts</b> <b>and</b> <b>their</b> <b>serialization</b>
       There  are  four  different kind of artifacts.  The serialization of the artifact is always a JSON object
       with two keys: <u>"type"</u> and <u>"data"</u>.  The value for <u>"type"</u> is always on of  the  strings  <u>"LOCAL"</u>,  <u>"KNOWN"</u>,
       <u>"ACTION"</u>,  or  <u>"TREE"</u>.   The  value  for  <u>"data"</u>  is  a JSON object with keys depending on which type the
       artifact is of.

       • <u>"LOCAL"</u> artifacts refer to source files in a logical repository.  The describing data are

         • the <u>"repository"</u>, given as its global name, and

         • the <u>"path"</u>, given as path relative to the root of that repository.

       • <u>"KNOWN"</u> artifacts are described by the hash of their content.  The describing data are

         • the <u>"file_type"</u>, which is a one-letter string,

           • <u>"f"</u> for regular, non-executable files,

           • <u>"x"</u> for executable files, or

           • <u>"t"</u> for trees.

         • the <u>"id"</u> specifying the (applicable) hash of the file given as its hexadecimal  encoding,  a  string,
           and

         • the <u>"size"</u> of the artifact, a number, in bytes.

       • <u>"ACTION"</u> artifacts are the outputs of actions.  The defining data are

         • the <u>"id"</u>, a string with the name of the action, and

         • the <u>"path"</u>, specifying the path of this output artifact, relative to the root of the action directory

       • <u>"TREE"</u> artifacts refer to trees defined in the action graph.  The defining data are

         • the <u>"id"</u>, a string with the name of the tree.

   <b>Actions</b> <b>and</b> <b>their</b> <b>serialization</b>
       Actions are given by the data described in the following sections.  For each item a key is associated and
       the  serialization  of  the action is a JSON object mapping those keys to the respective serialization of
       the values.  For some data items default values are given; if the value for the  respective  item  equals
       the default, the respective key-value pair may be omitted in the serialization.

       • <u>"command"</u>  specifies  the  command  to  be  executed.  It is a non-empty list of strings that forms the
         argument vector; the first entry is taken as program.  This key is mandatory.

       • <u>"env"</u> specifies the environment variables the command should be executed with.  It is given as map from
         strings to strings.  The default is the empty map.

       • <u>"input"</u> describes the files available to the action.  The action must not modify them in any way.  They
         are specified as map from paths to artifacts (the latter serialized as described).  Paths  have  to  be
         relative paths and are taken relative to the working directory of the action.  The default is the empty
         map.

       • <u>"output"</u>  describes  the  files  the  action is supposed to generate, if any.  It is given as a list of
         strings, each specifying a file name by a path relative to the working directory of  the  action.   The
         default is the empty list.  However, every action has to produce some form of output, so if <u>"output"</u> is
         empty, <u>"output_dirs"</u> cannot be empty.

       • <u>"output_dirs"</u>  describes the directory output of the action, if any.  It is given as a list of strings,
         each specifying the a directory name by a path relative to the working directory of  the  action.   The
         <u>"output_dirs"</u>  may also specify directories from which individual files are specified as <u>"output"</u>.  The
         default value for <u>"output_dirs"</u> is the empty list.  However, every  action  to  produce  some  form  of
         output, so if <u>"output_dirs"</u> is empty, <u>"output"</u> cannot be empty.

       • <u>"may_fail"</u>  can  either be <u>null</u> or a string.  If it is a string, the build should be continued, even if
         that action returns a non-zero exit state.  If the action returns a non-zero  exit  code,  that  string
         should  be shown to the user in a suitable way (e.g., printing on the console).  Otherwise (i.e., if no
         <u>"may_fail"</u> string is given), the build should be aborted if the action returns a  non-zero  exit  code.
         The default for <u>"may_fail"</u> is <u>null</u>, i.e., abort on non-zero exit code.

       • <u>"no_cache"</u> is a boolean.  If <u>true</u>, the action should never be cached, not even on success.  The default
         is <u>false</u>.

   <b>The</b> <b>graph</b> <b>format</b>
       The action graph is given by a JSON object.

       • The  value  for  the  key <u>"blobs"</u> is a list of strings.  Those strings should be considered known; they
         might (additionally to what was agreed ahead of time as known) referred to as <u>"KNOWN"</u> artifacts.

       • The value for the key <u>"trees"</u> is a JSON object, mapping the names of trees to  their  definition.   The
         definition  of  a  tree  is  JSON  object  mapping  paths to artifacts (serialized in the way described
         earlier).  The paths are always interpreted as relative paths, relative to the root of the tree.  It is
         not a requirement that a new tree is defined for every subdirectory; if a path contains  the  hierarchy
         separator,  which  is slash, then implicitly a subdirectory is present, and all path going through that
         subdirectory contribute to its content.  It is, however, an error, if the a path is a prefix of another
         one (with the comparison done in the canonical form of that path).

       • The value for the key <u>"actions"</u> is a  JSON  object,  mapping  names  of  actions  to  their  respective
         definition (serialized as JSON).

   <b>Additional</b> <b>keys</b>
       Any  JSON object described here might have additional keys on top of the ones described.  Implementations
       reading the graph have to accept and ignore those.  Implementations writing action-graph files should  be
       aware that a future version of this file format might give a specific meaning to those extra keys.

       Graphs  written by <b><a href="../man1/justbuild.1.html">justbuild</a></b>(1) have the additional key <u>"origins"</u> in each action.  The value is a list of
       all places where this action was requested (so often, but not always, the list has length 1).  Each  such
       place is described by a JSON object with the following keys.

       • <u>"target"</u>  The target in which the action was requested.  It is given as a list, either a full qualified
         named target given as <u>"@"</u> followed by global repository name, module, and target name, or an  anonymous
         target, given by <u>"#"</u> followed by a hash of the rule binding and the node name.

       • <u>"subtask"</u>  The  running  number,  starting  from  0,  of  the  action,  as given by the (deterministic)
         evaluation order of he defining expression for the rule that defined the target.

       • <u>"config"</u> The effective configuration for that target, a JSON object.

</pre><h4><b>See</b> <b>also</b></h4><pre>
       <b><a href="../man1/justbuild.1.html">justbuild</a></b>(1)

                                                                      <u>JUST</u> <u>GRAPH</u> <u><a href="../man5/FILE.5.html">FILE</a>(5)</u> <u>|</u> <u>File</u> <u>Formats</u> <u>Manual</u>()
</pre>
 </div>
</div></section>
</div>
</body>
</html>