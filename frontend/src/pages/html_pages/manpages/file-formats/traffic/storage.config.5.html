<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>storage.config - Traffic Server cache storage configuration file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/trafficserver">trafficserver_9.2.5+ds-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       storage.config - Traffic Server cache storage configuration file

       The  <u>storage.config</u>  file  (by  default,  located  in <b>/usr/local/etc/trafficserver/</b>) lists all the files,
       directories, and/or hard disk partitions that make up the Traffic Server  cache.  After  you  modify  the
       <u>storage.config</u> file the new settings will not be effective until Traffic Server is restarted.

</pre><h4><b>FORMAT</b></h4><pre>
       The format of the <u>storage.config</u> file is a series of lines of the form
          <u>pathname</u> <u>size</u> [ <b>volume=</b><u>number</u> ] [ <b>id=</b><u>string</u> ]

       where  <u>pathname</u>  is  the name of a partition, directory or file, <u>size</u> is the size of the named partition,
       directory or file (in bytes), and <u>volume</u> is the  volume  number  used  in  the  files  <u>volume.config</u>  and
       <u>hosting.config</u>.  <u>id</u>  is  used  for seeding the <u>Assignment</u> <u>Table</u>. You must specify a size for directories;
       size is optional for files and raw partitions. <u>volume</u> and <u>id</u> are optional.

       <b>NOTE:</b>
          The <u>volume</u> option is independent of the <u>id</u> option and either can be used with or  without  the  other,
          and their ordering on the line is irrelevant.

       <b>NOTE:</b>
          If the <u>id</u> option is used every use must have a unique value for <u>string</u>.

       <b>NOTE:</b>
          Any change to this files can (and almost always will) invalidate the existing cache in its entirety.

       You can use any partition of any size. For best performance:

       • Use raw disk partitions.

       • For each disk, make all partitions the same size.

       • For each node, use the same number of partitions on all disks.

       • Group  similar  kinds of storage into different volumes. For example split out SSD's or RAM drives into
         their own volume.

       Specify pathnames according to your operating system requirements. See the  following  examples.  In  the
       <u>storage.config</u> file, a formatted or raw disk must be at least 128 MB.

       When  using  raw  disk  or  partitions,  you should make sure the <u>Traffic</u> <u>Server</u> <u>user</u> used by the Traffic
       Server process has read and write privileges on the raw disk device or partition. One good practice is to
       make sure the device file is set with 'g+rw' and the Traffic Server user is in the group which  owns  the
       device file.  However, some operating systems have stronger requirements - see the following examples for
       more information.

       As with standard <b>records.config</b> integers, human readable prefixes are also supported. They include

          • <b>K</b> Kilobytes (1024 bytes)

          • <b>M</b> Megabytes (1024^2 or 1,048,576 bytes)

          • <b>G</b> Gigabytes (1024^3 or 1,073,741,824 bytes)

          • <b>T</b> Terabytes (1024^4 or 1,099,511,627,776 bytes)

   <b>Assignment</b> <b>Table</b>
       Each  storage  element defined in <u>storage.config</u> is divided in to <u>stripes</u>. The assignment table maps from
       an object URL to a specific stripe. The table is initialized based on a pseudo-random  process  which  is
       seeded  by  hashing  a  string  for each stripe. This string is composed of a base string, an offset (the
       start of the stripe on the storage element), and the length of the stripe. By default the  path  for  the
       storage  is used as the base string. This ensures that each stripe has a unique string for the assignment
       hash. This does make the assignment table very sensitive  to  the  path  for  the  storage  elements  and
       changing even one can have a cascading effect which will effectively clear most of the cache. This can be
       problem when drives fail and a system reboot causes the path names to change.

       The  <u>id</u>  option can be used to create a fixed string that an administrator can use to keep the assignment
       table consistent by maintaining the mapping from physical device to base string even in the  presence  of
       hardware changes and failures.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following basic example shows 128 MB of cache storage in the <b>/big_dir</b> directory:

          /big_dir 134217728

       You  can use the <b>.</b> symbol for the current directory. Here is an example for 64 MB of cache storage in the
       current directory:

          . 134217728

       As an alternative, using the human readable prefixes, you can express a 64GB cache file with:

          /really_big_dir 64G

       <b>NOTE:</b>
          When using on-filesystem cache disk storage, you can only have one such directory specified. This will
          be addressed in a future version.

   <b>Solaris</b> <b>Example</b>
       The following example is for the Solaris operating system:

          /dev/rdsk/c0t0d0s5
          /dev/rdsk/c0t0d1s5

       <b>NOTE:</b>
          Size is optional. If not specified, the entire partition is used.

   <b>Linux</b> <b>Example</b>
       <b>NOTE:</b>
          Rather than refer to disk devices like <b>/dev/sda</b>, <b>/dev/sdb</b>, etc.,  modern  Linux  supports  <u>alternative</u>
          <u>symlinked</u>  <u>names</u>  <u>for</u>  <u>disk</u>  <u>devices</u> in the <b><a href="file:/dev/disk">/dev/disk</a></b> directory structure. As noted for the <u>Assignment</u>
          <u>Table</u> the path used for the disk can effect the cache if it changes. This can be ameliorated  in  some
          cases by using one of the alternate paths in via <b><a href="file:/dev/disk">/dev/disk</a></b>. Note that if the <b>by-id</b> or <b>by-path</b> style is
          used,  replacing  a  failed  drive  will  cause  that path to change because the new drive will have a
          different physical ID or path. The original hash string can be kept by adding  <u>id</u>  or  <u>path</u>  with  the
          original path to the storage line.

          If  this  is  not  sufficient  then  the <u>id</u> or <u>path</u> argument should be used to create a more permanent
          assignment table. An example would be:

              /dev/sde id=cache.disk.0
              /dev/sdg id=cache.disk.1

       The following example will use an entire raw disk in the Linux operating system:

          <a href="file:/dev/disk/by-id/">/dev/disk/by-id/</a>[DiskA_ID]    volume=1
          <a href="file:/dev/disk/by-path/">/dev/disk/by-path/</a>[DiskB_Path]   volume=2

       In order to make sure <b>traffic_server</b> will have access to this disk you can use  <b><a href="../man7/udev.7.html">udev</a>(7)</b>  to  persistently
       set  the  right  permissions.  The  following  rules  are  targeted  for  an Ubuntu system, and stored in
       <b>/etc/udev/rules.d/51-cache-disk.rules</b>:

          # Assign DiskA and DiskB to the tserver group
          # make the assignment final, no later changes allowed to the group!
          SUBSYSTEM=="block", KERNEL=="sd[ef]", GROUP:="tserver"

       In order to apply these settings, trigger a reload with <b><a href="../man8/udevadm.8.html">udevadm</a>(8)</b>::

          udevadm trigger --subsystem-match=block

   <b>FreeBSD</b> <b>Example</b>
       Starting with 5.1 FreeBSD dropped support for explicit  raw  devices.  All  devices  on  FreeBSD  can  be
       accessed raw now.

       The following example will use an entire raw disk in the FreeBSD operating system:

          /dev/ada1
          /dev/ada2

       In  order  to make sure <b>traffic_server</b> will have access to this disk you can use <b><a href="../man8/devfs.8.html">devfs</a>(8)</b> to persistently
       set the right permissions. The following rules are stored in <b><a href="../man5/devfs.conf.5.html">devfs.conf</a>(5)</b>:

          # Assign /dev/ada1 and /dev/ada2 to the tserver user
          own    ada[12]  tserver:tserver

   <b>Advanced</b>
       Because relative paths in <u>storage.config</u> are relative to the base prefix, when using  customized  runroot
       it  may  be  necessary to adjust such paths in <u>storage.config</u> or adjust <b>runroot.yaml</b> itself.  Despite the
       name, the cachedir value is not used for this file.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2025, <a href="mailto:dev@trafficserver.apache.org">dev@trafficserver.apache.org</a>

9.2                                               May 22, 2025                                 <u><a href="../man5/STORAGE.CONFIG.5.html">STORAGE.CONFIG</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>