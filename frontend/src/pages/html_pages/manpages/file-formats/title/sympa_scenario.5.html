<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sympa_scenario - Authorization scenario</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/sympa">sympa_6.2.76~dfsg-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sympa_scenario - Authorization scenario

</pre><h4><b>SYNOPSIS</b></h4><pre>
       An example <u>del.auth</u> file:

         title    deletion performed only by list owners, need authentication
         title.es eliminacin reservada slo para el propietario, necesita autentificacin

         is_owner([listname],[sender])  smtp       -&gt; request_auth
         is_listmaster([sender])        smtp       -&gt; request_auth
         true()                         md5,smime  -&gt; do_it

</pre><h4><b>DESCRIPTION</b></h4><pre>
   <b>File</b> <b>format</b>
       Basically, a scenario file is composed of titles on the first lines and a set of rules on the following
       lines.

       Rules consist of one or more line in the form:

         condition authentication_methods -&gt; action

       Some terms of conditions may take one or more arguments.  The arguments are variables or literals (see
       "Terms of conditions", "Variables").

       Authentication methods is a comma-separated list of one or more methods (see "Authentication methods").

       Some actions may have optional modifiers (see "Actions").

       <u>Terms</u> <u>of</u> <u>conditions</u>

       "true" "(" ")"
           Always returns true.

       "equal" "(" <u>var1</u>"," <u>var2</u> ")"
           Tests if two arguments are equal.

       "is_subscriber" "(" <u>listname</u>"," <u>var</u> ")"
       "is_owner" "(" <u>listname</u>"," <u>var</u> ")"
       "is_editor" "(" <u>listname</u>"," <u>var</u> ")"
           Tests  if  <u>var</u>  is  the  subscriber,  owner or editor of the list <u>listname</u>.  <u>listname</u> is the variable
           "[listname]" or list address, "<u>name</u>" or "<u>name</u>"@"<u>domain</u>".

       "is_listmaster" "(" <u>var</u> ")"
           Tests if <u>var</u> is the listmaster.

       "less_than" "(" <u>var1</u>"," <u>var2</u> ")"
           Tests if <u>var1</u> is less than <u>var2</u>.

       "match" "(" <u>var</u>"," "/"<u>perl_regexp</u>"/" ")"
           Tests if <u>var</u> matches with <u>perl_regexp</u>.

           <u>perl_regexp</u> is a perl regular expression.  Don't forget to escape special characters ("^", "$",  "{",
           "(",  ...):  Check  <b><a href="../man1/perlre.1.html">perlre</a></b>(1)  for  regular  expression syntax.  It can contain the string "[domain]"
           (interpreted at run time as the list or robot domain).

           Note: Sympa prior to 6.2.32 recognized "[host]" instead of "[domain]".

       "newer" "(" <u>date</u>"," <u>date</u> ")"
           Returns true if first date is posterior to the second

       "older" "(" <u>date</u>"," <u>date</u> ")"
           Returns true if first date is anterior to the second date

           <u>date</u> is Unix time or the string "<u>n</u>"y"<u>n</u>"m"<u>n</u>"d"<u>n</u>"h"<u>n</u>"min"<u>n</u>"sec"", where each <u>n</u> is a number.

       "search" "(" <u>named_filter_file</u>"," <u>var</u>")"
           Tests if <u>var</u> is found by named filter.

           <u>named_filter_file</u> is a file name ending with ".ldap", ".sql" or ".txt".

       "verify_netmask" "(" <u>network_block</u> ")"
           Tests if "REMOTE_ADDR" CGI environment variable matches with <u>network_block</u>.

           This allows the user to configure their local network to only be accessible to those that are members
           of it.

       "CustomCondition::"<u>package_name</u> "(" <u>arguments</u>, ... ")"
           Evaluates   custom   condition.    <u>package_name</u>   is   the   name    of    a    Perl    package    in
           <u>$SYSCONFDIR/custom_conditions/</u> (lowercase).

       <u>Variables</u>

       "[custom_vars-&gt;"<u>custom_var_name</u>"]"
           Allows  you  to  introduce  custom  parameters  in your scenario.  <u>custom_var_name</u> is the name of the
           custom parameter you want to use.

       "[date]"
           Date of reception of the message.

       "[domain]"
           Mail domain of current list.

           Note: This variable was introduced by Sympa 6.2.32.  Previous versions used a variable "[conf-&gt;host]"
           (obsoleted) instead.

       "[env-&gt;"<u>env_var</u>"]"
           <u>env_var</u> is the name of CGI environment variable (note that it is case-sensitive).

       "[is_bcc]"
           Set to 1 if the list is neither in To: nor Cc: field.

       "[listname]"
           Name of current list.

       "[msg_encrypted]"
           Set to ""smime"" if the message was S/MIME encrypted.

       "[msg_header-&gt;"<u>field_name</u>"]"
       "[msg_header-&gt;"<u>field_name</u>"]["<u>index</u>"]"
           Value of message header field, available only when evaluating the authorization scenario for  sending
           messages.   It  can  be  used,  for  example,  to  require  editor validation for multipart messages.
           Optional <u>index</u> may be integer (may be less than 0) to choose particular entry from multiple fields.

       "[msg_part-&gt;type]"
       "[msg_part-&gt;body]"
           The MIME content types and bodies; the body is available for MIME parts in text/xxx format only.

       "[previous_email]"
           Old email when changing subscription email in preference page.

       "[sender]"
           The email address of the current user (used on web or mail interface).  Default value is "nobody".

       "[topic]"
           Topic of the message.  This variable has a value if any of the following "[topic_*]" variables has  a
           value.

       "[topic_auto]"
           Topic of the message if it has been automatically tagged.

       "[topic_editor]"
           Topic of the message if it has been tagged by editor.

       "[topic_needed]"
           The message has not got any topic and message topic are required for the list.

       "[topic_sender]"
           Topic of the message if it has been tagged by sender.

       "[user_attributes-&gt;"<u>user_attributes_key_word</u>"]"
           <u>user_attributes_key_word</u>  is  one  of  the  names  of  user attributes provided by the SSO system via
           environment variables.  Available only if user authenticated with a "generic_sso".

       <u>Authentication</u> <u>methods</u>

       The e-mail of authenticated user is given by "[sender]" variable.  If it is not given, '"nobody"' will be
       set.

       "smtp"
           Default method.  No actual authentication, and if any, sender of the message is used.

       "md5"
           Authenticated by web authentication (password), or by authentication key in e-mail message.

       "smime"
           Authenticated by S/MIME signature, or TLS client certificate.

       Note: The "dkim" authentication method for scenarios was obsoleted on  Sympa  6.2.71b.1.   Now  it  is  a
       synonym of "smtp" method.

       <u>Actions</u>

       An action consists of an action name and optional modifiers.

       Action names:

       "do_it"
           Allows operation.

       "editor"
           The message will be forwarded to list editor.

       "editorkey"
           The message will be held for moderation by list editor.

       "listmaster"
           Same as "do_it" but makes newly created list be pending.

       "owner"
           The operation is held and waits for approval by list owner.

       "reject"
           Denies operation.

       "request_auth"
           The operation is held and waits for confirmation by the user.

       Modifiers:

       "([email])"
           Only  for "request_auth" action.  Sends authentication request to the target user of operation (given
           as the value of ""[email]"" variable) instead of original sender.

           Note that "[email]" is a literal and no other variable names can't be used.

       "," "notify"
           Only for "do_it" and "listmaster" actions.  Sends a notification to list owner.

       "," "quiet"
           Sends no notification to the message sender.

       "(reason='"<u>reason_key</u>"')"
           Only for "reject" action.  Matches a key in <u>mail_tt2/authorization_reject.tt2</u> template  corresponding
           to an information message about the reason of the reject of the user.  <u>reason_key</u> have to be a static
           string enclosed by '...'.

       "(tt2='"<u>tpl_name</u>"')"
           Only  for  "reject" action.  Corresponding template (<u>tpl_name</u>".tt2") is sent to the sender.  <u>tpl_name</u>
           have to be a static string enclosed by '...'.

   <b>Formal</b> <b>syntax</b>
       # Below is the formal syntax definition by modified BNF.

       rule : condition spaces auth_list "-&gt;" action

       # Condition

       condition : "!" condition
           | "true" "(" ")"
           | "equal" "(" var "," var ")"
           | "is_editor" "(" listname "," var ")"
           | "is_listmaster" "(" var ")"
           | "is_owner" "(" listname "," var ")"
           | "is_subscriber" "(" listname "," var ")"
           | "less_than" "(" var "," var ")"
           | "match" "(" var "," "/" perl_regexp "/" ")"
           | "newer" "(" date "," date ")"
           | "older" "(" date "," date ")"
           | "search" "(" named_filter_file ")"
           | "verify_netmask" "(" network_block ")"
           | "CustomCondition::" package_name "(" var* ")"

       var : "[email]"
           | "[conf-&gt;" conf_key_word "]"
           | "[current_date]"
           | "[custom_vars-&gt;" custom_var_name "]"
           | "[env-&gt;" env_var "]"
           | "[is_bcc]"
           | "[list-&gt;" list_key_word "]"
           | "[msg_body]"
           | "[msg_encrypted]"
           | "[msg_header-&gt;" field_name "]" "[" index "]"
           | "[msg_header-&gt;" field_name "]"
           | "[msg_part-&gt;type]"
           | "[msg_part-&gt;body]"
           | "[previous_email]"
           | "[sender]"
           | "[subscriber-&gt;" subscriber_key_word "]"
           | "[topic]"
           | "[topic_auto]"
           | "[topic_editor]"
           | "[topic_needed]"
           | "[topic_sender]"
           | "[user-&gt;" user_key_word "]"
           | "[user_attributes-&gt;" user_attributes_keyword "]"
           | string

       listname : "[listname]"
           | listname_string
           | listname_string "@" domain_string

       date : "[date]"
           | date_expr
           | integer

       user_key_word : "email"
           | "gecos"
           | "lang"
           | "password"
           | "cookie_delay_user"
           | additional_user_fields

       subscriber_key_word : "email"
           | "date"
           | "bounce"
           | "gecos"
           | "reception"
           | "update_date"
           | "visibility"
           | additional_subscriber_fields

       list_key_word : "name"
           | "address"
           | "domain"
           | "lang"
           | "max_size"
           | "priority"
           | "reply_to"
           | "status"
           | "subject"
           | "total"
           | "account"

       conf_key_word : "domain"
           | "default_list_priority"
           | "email"
           | "lang"
           | "listmaster"
           | "max_size"
           | "request_priority"
           | "sympa_priority"

       # Authentication methods

       auth_list : auth "," auth_list
           | auth
           | ""

       auth : "smtp"
           | "dkim"
           | "md5"
           | "smime"

       # Actions

       action : "do_it" ( "," "quiet" | "," "notify" )*
           | "editor" [ "," "quiet" ]
           | "editorkey" [ "," "quiet" ]
           | "listmaster" [ "," "notify" ]
           | "owner" [ "," "quiet" ]
           | "reject" (
                 "(" "reason=" reason_key ")"
               | "(" "tt2=" tpl_name ")"
               | "," "quiet"
             )*
           | "reject(tt2=" tpl_name ")" [ "," "quiet" ]
           | "request_auth" [ "([email])" ]

</pre><h4><b>FILES</b></h4><pre>
       $EXPLDIR"/"<u>list</u> <u>path</u>"/scenari"
       $SYSCONFDIR"/"<u>virtual</u> <u>host</u>"/scenari"
       $SYSCONFDIR"/scenari"
       $DEFAULTDIR"/scenari"
           Path of scenario files: List, robot and site levels, and distribution defaults.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Sympa::Scenario.

</pre><h4><b>HISTORY</b></h4><pre>
       Original contents of this document were partially taken  from  a  chapter  "Authorization  scenarios"  in
       <u>Sympa,</u> <u>Mailing</u> <u>List</u> <u>Management</u> <u>Software</u> <u>-</u> <u>Reference</u> <u>manual</u>.

6.2.76                                             2025-02-12                                  <u><a href="../man5/SYMPA_SCENARIO.5.html">SYMPA_SCENARIO</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>