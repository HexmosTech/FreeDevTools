<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fireqos-params-match - optional match parameters</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/fireqos-doc">fireqos-doc_3.1.8+ds-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       fireqos-params-match - optional match parameters

</pre><h4><b>SYNOPSIS</b></h4><pre>
       at { root | <u>name</u> }

       class <u>name</u>

       syn|syns

       ack|acks

       { proto|protocol <u>protocol</u> [,<u>protocol</u>...]  } |tcp|udp|icmp|gre|ipv6

       { tos | priority } <u>tosid</u> [,<u>tosid</u>...]

       { DSCP } <u>classname</u> [,<u>classname</u>...]

       mark <u>mark</u> [,<u>mark</u>...]

       connmark <u>mark</u> [,<u>mark</u>...]

       rawmark <u>mark</u> [,<u>mark</u>...]

       custommark <u>name</u> <u>mark</u> [,<u>mark</u>...]

       { port | ports } <u>port</u>[:<u>range</u>] [ ,<u>port</u>[:<u>range</u>]...  ]

       { sport | sports } <u>port</u>[:<u>range</u>] [ ,<u>port</u>[:<u>range</u>]...  ]

       { dport | dports } <u>port</u>[:<u>range</u>] [ ,<u>port</u>[:<u>range</u>]...  ]

       { ip | net | host } <u>net</u> [,<u>net</u>...]

       src <u>net</u> [,<u>net</u>...]

       dst <u>net</u> [,<u>net</u>...]

       { srcmac | smac } <u>mac</u>

       { dstmac | dmac } <u>mac</u>

       prio <u>id</u>

       input

       output

       custom `<u>custom</u> <u>tc</u> <u>parameters</u>'

       estimator <u>interval</u> <u>decay</u>

       police <u>police</u>

       insidegre

</pre><h4><b>DESCRIPTION</b></h4><pre>
       These options apply to match statements.

   <b>input,</b> <b>output</b>
       On  bidirectional interfaces, input and output will check the current direction of the interface.  If the
       match is input but the interface is output the match will be reversed.  The same will happen if output is
       given at the match and the interface is input.

       The parameters that are reversed are:

       • src and dst

       • sport and dport

       • srcmac and dstmac

       This allows a definition like this:

                interface dsl0 world bidirectional ...
                  class surfing ...
                    match input sport 0:1023

       The above will match sport 0:1023 at the input interface, and will  automatically  reverse  it  to  match
       dport 0:1023 at the output interface.

   <b>at</b>
       By  default a match is attached to the parent of its parent class.  For example, if its parent is a class
       directly under the interface, then the match is attached to the interface and  is  compared  against  all
       traffic  of the interface.  For nested classes, a match of a leaf, is attached to the parent class and is
       compared against all traffic of this parent class.

       With the at parameter, a match can be attached any class.  The <u>name</u> parameter should  be  a  class  name.
       The name root attaches the match to the interface.

   <b>class</b>
       Defines the <u>name</u> of the class that will get the packets matched by this match.

       By default it is the name of the class the match statement appears under.

              <u>Note</u>

              There is also a class definition for traffic, see <a href="../man5/fireqos-class.5.html">fireqos-class</a>(5).

   <b>syn,</b> <b>syns</b>
       Match TCP SYN packets.  Note that the tcp parameter must be specified.

       If  the  same  match  statement  includes  more protocols than TCP, then this match will work for the TCP
       packets (it will be silently ignored for all other protocols).

       For example, syn is ignored when generating the UDP filter in the below:

              match tcp syn
              match proto tcp,udp syn

   <b>ack,</b> <b>acks</b>
       Same as syn, but matching small TCP packets with the ACK bit set.

   <b>proto,</b> <b>protocol,</b> <b>tcp,</b> <b>udp,</b> <b>icmp,</b> <b>gre,</b> <b>ipv6</b>
       Match the <u>protocol</u> in the IP header.

   <b>tos,</b> <b>priority</b>
       Match to TOS field of ipv4 or the priority field of ipv6.  The <u>tosid</u> can be a value/mask  in  any  format
       <a href="../man8/tc.8.html">tc</a>(8) accepts, or one of the following:

       • min-delay, minimize-delay, minimum-delay, low-delay, interactive

       • maximize-throughput, maximum-throughput, max-throughput, high-throughput, bulk

       • maximize-reliability, maximum-reliability, max-reliability, reliable

       • min-cost, minimize-cost, minimum-cost, low-cost, cheap, normal-service, normal

         <u>Note</u>

         There is also a class parameter called priority, see <a href="../man5/fireqos-params-class.5.html">fireqos-params-class</a>(5).

   <b>dscp</b>
       Match to DSCP value in IP TOS header field.  The <u>classname</u> has to be one of the following values:

       • CS1, CS2, CS3, CS4, CS5, CS6, CS7

       • AF11, AF12, AF13

       • AF21, AF22, AF23

       • AF31, AF32, AF33

       • AF41, AF42, AF43

       • EF

         <u>Note</u>

         tc-filter  only  supports  ToS  parameters.  That is why a lookaside table is configured within fireqos
         code to translate the DSCP value to their matching TOS value.  See RFC2474 for more information.

   <b>mark,</b> <b>connmark,</b> <b>custommark,</b> <b>rawmark</b>
       Match an <a href="../man8/iptables.8.html">iptables</a>(8) MARK.  This works the same way it works for FireHOL.  FireHOL and FireQOS share  the
       same marks and their masks.

       Matching  <a href="../man8/iptables.8.html">iptables</a>(8)  MARKs  do not work on input interfaces.  You can use them only on output.  The IFB
       devices that are used for shaping inbound traffic do not have any iptables hooks to allow matching MARKs.
       If you try it, FireQOS will attempt to do it, but currently you will get an error from the <a href="../man8/tc.8.html">tc</a>(8)  command
       executed or they will be silently ignored by it.

       On  some  Linux  distributions  (e.g. OpenWRT) there is a module called act_commark that will enable this
       feature.  Set this within your fireqos.conf to enable it:

              FIREQOS_CONNMARK_RESTORE="act_connmark"

       Also note that matching marks requires a suitably configured kernel (with CONFIG_CLS_U32_MARK=y).   There
       is no error if the kernel is not configured correctly; it just silently drops the rules.  For details see
       this error report.

   <b>ports,</b> <b>sports,</b> <b>dports</b>
       Match  ports  of  the  IP  header.   ports  will  create  rules for matching source and destination ports
       (separate rules for each).  dports matches destination ports, sports matches source ports.

   <b>ip,</b> <b>net,</b> <b>host,</b> <b>src,</b> <b>dst</b>
       Match IPs of the IP header.  ip, net and host will create rules for matching source and  destination  IPs
       (separate rules for each).  src matches source IPs and dst destination IPs.

              <b>Note</b>

              If  the  class  these matches appear in are IPv4, then only IPv4 IPs can be used.  To override use
              match6 ... src/dst *IPV6_IP*

              Similarly, if the class is IPv6, then only IPv6 IPs can be  used.   To  override  use  match4  ...
              src/dst *IPV4_IP*.

       You  can  mix  IPv4  and  IPv6 in any way you like.  FireQOS supports inheritance, to figure out for each
       statement which is the default.  For example:

              interface46 eth0 lan output rate 1Gbit # ipv4 and ipv6 enabled
                class voip # ipv4 and ipv6 class, as interface is both
                  match udp port 53 # ipv4 and ipv6 rule, as class is both
                  match4 src 192.0.2.1 # ipv4 only rule
                  match6 src 2001:db8::1 # ipv6 only rule

                class4 realtime # ipv4 only class
                  match src 198.51.100.1 # ipv4 only rule, as class is ipv4-only

                class6 servers # ipv6 only class
                      match src 2001:db8::2 # ipv6 only rule, as class is ipv6-only

       To convert an IPv4 interface to IPv6, just replace interface with interface6.   All  the  rules  in  that
       interface,  will automatically inherit the new protocol.  Of course, if you use IP addresses for matching
       packets, make sure they are IPv6 IPs too.

   <b>prio</b> <b>(match)</b>
              <u>Note</u>

              There is also a class parameter called prio, see <a href="../man5/fireqos-params-class.5.html">fireqos-params-class</a>(5).

       All match statements are attached to the interface.  They forward traffic to their class,  but  they  are
       actually executed for all packets that are leaving the interface (note: input matches are actually output
       matches on an IFB device).

       By  default,  the  priority  they  are  executed,  is the priority they appear in the configuration file,
       i.e. the first match of the first class is executed first, then the rest matches of the  first  class  in
       the sequence they appear, then the matches of the second class, etc.

       It  is sometimes necessary to control the order of matches.  For example, when you want host 192.0.2.1 to
       be assigned the first class, except port tcp/1234  which  should  be  assigned  the  second  class.   The
       following will <u>not</u> work:

              interface eth0 lan output rate 1Gbit
                class high
                  match host 192.0.2.1

                class low
                  match host 192.0.2.1 port 1234 # Will never match

       In  this case, the first match is assigned priority 10 and the second priority 20.  The second match will
       never match anything, since all traffic for the host is already matched by the first one.

       Setting an explicit priority allows you to change the order in which the matches are  executed.   FireQOS
       gives  priority  10 to the first match of every interface, 20 to the second match, 30 to the third match,
       etc.  So the default is 10 x the sequence number.  You can set prio to overwrite this number.

       To force executing the second match before the first, just set a lower priority  for  it.   For  example,
       this will cause the desired behaviour:

              interface eth0 lan output rate 1Gbit
                class high
                  match host 192.0.2.1

                class low
                  match host 192.0.2.1 port 1234 prio 1 # Matches before host-only

   <b>insidegre</b>
       By  specifying  keyword  insidegre  a  GRE  (Generic  Routing Encapsulation) packet can be matched on the
       encapsulated IP packet header information.

       insidegre is available for the following matches:

       • src

       • dst

       • protocol

       • port

       • tos

       • dscp

           interface eth0 world ...
             class surfing commit 128kbit ceil 1024kbit prio 7
               match src 10.1.128.230 dst 8.8.8.8 insidegre
               match protocol ospf insidegre
               match port 25 insidegre
               match tos 3 insidegre
               match dscp ef insidegre

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       • <a href="../man1/fireqos.1.html">fireqos</a>(1) - FireQOS program

       • <a href="../man5/fireqos.conf.5.html">fireqos.conf</a>(5) - FireQOS configuration file

       • <a href="../man5/fireqos-match.5.html">fireqos-match</a>(5) - QOS traffic match

       • FireHOL Website

       • FireQOS Online PDF Manual

       • FireQOS Online Documentation

</pre><h4><b>AUTHORS</b></h4><pre>
       FireHOL Team.

FireQOS Reference                               Built 13 Apr 2025                        <u><a href="../man5/fireqos-params-match.5.html">fireqos-params-match</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>