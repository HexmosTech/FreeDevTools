<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>just-mr-repository-config - The format of the repository config used by just-mr(1)</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/justbuild">justbuild_1.5.1-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       just-mr-repository-config - The format of the repository config used by <b><a href="../man1/just-mr.1.html">just-mr</a></b>(1)

</pre><h4><b>DESCRIPTION</b></h4><pre>
       In  order  for the <b><a href="../man1/just-mr.1.html">just-mr</a></b>(1) tool to generate a repository configuration file usable by the <b><a href="../man1/justbuild.1.html">justbuild</a></b>(1)
       multi-repository build system, it  requires  a  configuration  file  describing  repositories  and  their
       dependencies.

       The  file is read as JSON.  Any other serialization describing the same JSON object is equivalent.  It is
       assumed that in JSON objects keys occur at most once; it is implementation defined how repetitions of the
       same key are treated.

   <b>Workspace</b> <b>root</b> <b>description</b>
       A repository’s <u>workspace</u> <u>root</u> <u>description</u> provides information about the location of  source  files.   It
       can  be  an explicit description, given as a JSON object, or an implicit one, given as the global name of
       another repository, from which the workspace root can be inferred.

       Explicit workspace roots can be of several types, distinguishable by the value of the key <u>"type"</u>  in  the
       JSON object.  Depending on this value, other fields in the object are also supported.

   <u>"file"</u>
       It defines as workspace root a directory on the file system.

       The following fields are supported:

       • <u>"path"</u> provides the root directory containing the source files.  This entry is mandatory.

   <u>"archive"</u> / <u>"zip"</u>
       They  define as workspace root a remote archive.  The only difference between the two types is the nature
       of the archive: a tarball (preferably compressed) in the case of <u>"archive"</u>, or a compressed zip  or  7zip
       file in the case of <u>"zip"</u>.

       The following fields are supported:

       • <u>"content"</u>  provides  the  Git blob hash of the archive file.  This has to be specified in hex encoding.
         This entry is mandatory.

       • <u>"fetch"</u> specifies the URL to the remote archive.  This entry is mandatory.

       • <u>"distfile"</u> provides an alternative name for the archive file.  This entry is optional.  If missing, the
         basename of the fetch URL is used.

       • <u>"mirrors"</u> is an optional list of alternative locations to try to fetch  from  if  contacting  the  main
         fetch location fails.  This entry is optional.

       • <u>"sha256"</u>,

       • <u>"sha512"</u>  provide optional checksum hashes in order to verify the integrity of the remote site archive.
         These have to be provided in hex encoding.  These checks are only performed  if  the  archive  file  is
         actually downloaded from the (potentially untrusted) network and not already available locally.

       • <u>"subdir"</u> specifies the subdirectory withing the unpacked archive.  This entry is optional.  If missing,
         the root directory of the archive is used.

   <u>"foreign</u> <u>file"</u>
       Define  a  root  as  consisting  of  single  file  with  given  content at a specific name with specified
       executable bit.

       The following fields are supported.

       • <u>"content"</u>, <u>"fetch"</u>, <u>"distfile"</u>, <u>"mirrors"</u>, <u>"sha256"</u>, and <u>"sha512"</u> specify the file content in the  same
         way as they specify the archive content for an <u>"archive"</u> repository.

       • <u>"name"</u>  specifies the name the content should have in the defined root.  It has to be a plain file name
         without implicitly specified subdirs.  This field is mandatory.

       • <u>"executable"</u> is a boolean indicating whether the fetched file should be provided  with  the  executable
         bit.  Defaults to false.

   <u>"git"</u>
       It defines as workspace root a part of a Git repository.

       The following fields are supported:

       • <u>"repository"</u>  provides  the  URL  of the Git repository.  This entry is mandatory.  Note that only URLs
         starting with /, ./, or file:// are considered file URLs.

       • <u>"commit"</u> contains the commit hash.  This has to be specified in hex encoding.  This entry is mandatory.

       • <u>"branch"</u> provides the branch name, with the promise that it contains the aforementioned  commit.   This
         entry is mandatory.

       • <u>"mirrors"</u>  is  an  optional  list  of alternative locations to try to fetch from if contacting the main
         repository fails.  This entry is optional.

       • <u>"subdir"</u> specifies the subdirectory containing the distribution files.  This  entry  is  optional.   If
         missing, the root directory of the Git repository is used.

       • <u>"inherit</u>  <u>env"</u>  provides  a  list  of  variables.   When just-mr shells out to git, those variables are
         inherited from the environment just-mr is called within, if set there.

   <u>"git</u> <u>tree"</u>
       It defines as workspace root as a fixed git tree, given by the corresponding tree  identifier.   If  that
       tree  is  not known already to just-mr, a specified command will be executed in a fresh directory that is
       expected to produce the given tree somewhere below the working directory.

       This type of root is the way builds against sources versioned in arbitrary version-control systems can be
       carried out.  The command then would be a call to the version control system requesting an  export  at  a
       particular version.

       As  the  root  is already fully determined by the specified git tree identifier, the corresponding action
       need not be fully isolated.  In fact, to check  out  a  repository  it  might  be  necessary  to  provide
       credentials  (which  do  not  matter for the checked-out tree, but differ from user to user).  To support
       this, the description of the  root  can  specify  environment  variables  to  inherit  from  the  ambient
       environment.  E.g., SSH_AUTH_SOCK can be specified here to support ssh-based authentication.

       The following fields are supported:

       • <u>"id"</u> provides the Git tree identifier.  This entry is mandatory.

       • <u>"cmd"</u>  provides  a  list  of  strings  forming a command which promises that, when executed in an empty
         directory (anywhere in the file system), creates in that directory a directory structure containing the
         promised Git tree (either top-level or in some subdirectory).  This entry is mandatory.

       • <u>"env"</u> provides a map of envariables to be set for executing the command.

       • <u>"inherit</u> <u>env"</u> provides a list of variables to be inherited  from  the  environment  just-mr  is  called
         within, if set there.

   <u>"distdir"</u>
       It  defines  as  workspace root a directory with the distribution archives of the specified repositories.
       Usually this root is realized as a Git tree in the Git repository in <b>justbuild</b>’s local build root.

       The following fields are supported:

       • <u>"repositories"</u> provides a list of global names of repositories.  This entry is mandatory.

   <u>"computed"</u>
       It defines a computed root, typically to be used as root by other repositories.  A computed root is given
       as the artifacts map of an export target of a content-fixed repository.  Computed  roots  themselves  are
       content fixed; the dependency of computed roots on one another must be cycle free.

       The following fields are supported:

       • <u>"repo"</u> specifies the repository the export target belongs to.  This entry is mandatory.

       • <u>"target"</u>  specifies  the  export target within the given repository in module-name form.  This entry is
         mandatory.

       • <u>"config"</u> specifies the configuration at which to evaluate the export target.  This  entry  is  optional
         and defaults to the empty map.

   <u>"tree</u> <u>structure"</u>
       It evaluates to the given root but with all files and symlinks replaced by empty blobs.  A tree structure
       root  is given by a content-fixed workspace of a repository.  Tree structure roots themselves are content
       fixed; the dependency of tree structure roots on one another must be cycle free.

       The following fields are supported:

       • <u>"repo"</u> specifies the repository whose workspace root must be evaluated.  This entry is mandatory.

   <b>Additional</b> <b>keys</b>
       The key <u>"pragma"</u> is reserved for type-specific repository directives which alter the workspace root.   It
       is  given  as a JSON object.  The different workspace roots might support different keys for this object;
       unsupported keys are always ignored.

       For a <u>"file"</u> workspace root the pragma key <u>"to_git"</u> is supported.  If its value is <u>true</u> then it indicates
       that the workspace root should be returned as a Git tree.  If the root directory is already part of a Git
       repository, its Git tree identifier is used; otherwise, the workspace root will be realized as a Git tree
       in the Git repository in <b>justbuild</b>’s local build root.

       For all workspace roots except <u>"distdir"</u>, <u>"computed"</u>, and <u>"tree</u> <u>structure"</u>, the pragma key  <u>"special"</u>  is
       supported.   If its value is <u>"ignore"</u> then it indicates that the workspace root should ignore all special
       (i.e., neither file, executable, nor tree) entries.  For a <u>"file"</u> workspace  root  or  for  an  <u>"archive"</u>
       workspace  root  a  value  of  <u>"resolve-completely"</u>  indicates that the workspace root should resolve all
       confined relative symbolic links, while a value of <u>"resolve-partially"</u> indicates that the workspace  root
       should  resolve  only the confined relative upwards symbolic links; for a <u>"file"</u> workspace root these two
       values imply <u>"to_git"</u> is <u>true</u>.

       For all workspace roots the pragma key <u>"absent"</u> is supported.  If its value is  <u>true</u>  then  it  indicates
       that  an  absent  root  should  be  generated,  i.e., one given only by its Git tree without any explicit
       witnessing repository.

   <b>Repository</b> <b>description</b>
       A <u>repository</u> <u>description</u> is defined as a JSON object, containing a <u>workspace</u> <u>root</u> <u>description</u>,  directory
       roots and names for targets, rules, and expressions files, and bindings to other repositories.

       Specifically, the following fields are supported:

       • <u>"repository"</u> contains a <u>workspace</u> <u>root</u> <u>description</u>.  This entry is mandatory.

       • <u>"target_root"</u>,

       • <u>"rule_root"</u>,

       • <u>"expression_root"</u>  define  the  root directories for the targets, rules, and expressions, respectively.
         If provided, they are passed on expanded to the workspace root of the repository named by their value.

       • <u>"target_file_name"</u>,

       • <u>"rule_file_name"</u>,

       • <u>"expression_file_name"</u> refer to the name of the files containing the targets, rules,  and  expressions,
         respectively,  located relative to the corresponding root directories.  These entries are optional.  If
         provided, they are passed on as-is.

       • <u>"bindings"</u> provides a JSON object defining dependencies on other repositories.  The object’s  keys  are
         strings  defining  local repository names, while the values are the corresponding global names of those
         repositories.  If provided, this entry is passed on as-is.

   <b>Repository</b> <b>configuration</b> <b>format</b>
       The repository configuration format is structured as a JSON object.  The following fields are supported:

       • <u>"main"</u> contains a JSON string that determines which of the provided repositories is considered the main
         repository.   This  entry  is  optional,  and  if  omitted,  it  will  be  omitted  in  the   generated
         <b>just-repository-config</b>.

       • <u>"repositories"</u>  contains  a  JSON  object,  where  each  key is the global name of a repository and its
         corresponding value is the <u>repository</u> <u>description</u>.

   <b>Additional</b> <b>keys</b>
       Any JSON object described in this format might have additional keys  besides  the  ones  mentioned.   The
       current  strategy of <b><a href="../man1/just-mr.1.html">just-mr</a></b>(1) is to accept and ignore them.  Users should be aware that future versions
       of this format might give specific meanings to these extra keys.

</pre><h4><b>See</b> <b>also</b></h4><pre>
       <b><a href="../man1/justbuild.1.html">justbuild</a></b>(1), <b><a href="../man1/just-mr.1.html">just-mr</a></b>(1), <b><a href="../man5/just-repository-config.5.html">just-repository-config</a></b>(5)

                                                            <u>JUST-MR</u> <u>REPOSITORY</u> <u><a href="../man5/CONFIG.5.html">CONFIG</a>(5)</u> <u>|</u> <u>File</u> <u>Formats</u> <u>Manual</u>()
</pre>
 </div>
</div></section>
</div>
</body>
</html>