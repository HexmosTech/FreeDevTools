<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>selabel_file  -  userspace SELinux labeling interface and configuration file format for the file contexts</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/selinux-utils">selinux-utils_3.8.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       selabel_file  -  userspace SELinux labeling interface and configuration file format for the file contexts
       backend

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;selinux/label.h&gt;</b>

       <b>int</b> <b>selabel_lookup(struct</b> <b>selabel_handle</b> <b>*</b><u>hnd</u><b>,</b>
                          <b>char</b> <b>**</b><u>context</u><b>,</b>
                          <b>const</b> <b>char</b> <b>*</b><u>path</u><b>,</b> <b>int</b> <u>mode</u><b>);</b>

       <b>int</b> <b>selabel_lookup_raw(struct</b> <b>selabel_handle</b> <b>*</b><u>hnd</u><b>,</b>
                          <b>char</b> <b>**</b><u>context</u><b>,</b>
                          <b>const</b> <b>char</b> <b>*</b><u>path</u><b>,</b> <b>int</b> <u>mode</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The file contexts backend maps from pathname/mode combinations into security contexts. It is used to find
       the appropriate context for each file when relabeling a file system. The returned <u>context</u> must  be  freed
       using <b><a href="../man3/freecon.3.html">freecon</a></b>(3).
       <b><a href="../man3/selabel_lookup.3.html">selabel_lookup</a></b>(3)  describes the function with its return and error codes, however the following <u>errno</u> is
       clarified further for the file contexts backend:

              <b>ENOENT</b> No context corresponding to the <u>path</u> and <u>mode</u> was found - This will also be  returned  when
                     the file contexts series of files have a context of <b>&lt;&lt;none&gt;&gt;</b> against the <u>path</u> (see the <b>FILE</b>
                     <b>FORMAT</b> section).

       The <u>path</u> argument should be set to the full pathname of the file whose assigned context is being checked.
       The  <u>mode</u>  argument  should  be  set to the mode bits of the file, as determined by <b><a href="../man2/lstat.2.html">lstat</a></b>(2). <u>mode</u> may be
       zero, however full matching may not occur.

       Any messages generated by <b><a href="../man3/selabel_lookup.3.html">selabel_lookup</a></b>(3) are sent to <u>stderr</u> by default, although this can  be  changed
       by <b><a href="../man3/selinux_set_callback.3.html">selinux_set_callback</a></b>(3).

       <b><a href="../man3/selabel_lookup_raw.3.html">selabel_lookup_raw</a></b>(3) behaves identically to <b><a href="../man3/selabel_lookup.3.html">selabel_lookup</a></b>(3) but does not perform context translation.

       The <b>FILES</b> section details the configuration files used to determine a file context.

</pre><h4><b>OPTIONS</b></h4><pre>
       In  addition  to  the  global options described in <b><a href="../man3/selabel_open.3.html">selabel_open</a></b>(3), this backend recognizes the following
       options:

              <b>SELABEL_OPT_PATH</b>
                     A non-null value for this option specifies a path to a file that will be opened in lieu  of
                     the  standard file contexts file.  This value is also used as the base name for determining
                     the names of local customization files.

              <b>SELABEL_OPT_BASEONLY</b>
                     A non-null value for this option indicates  that  any  local  customizations  to  the  file
                     contexts mapping should be ignored.

              <b>SELABEL_OPT_SUBSET</b>
                     A non-null value for this option is interpreted as a path prefix, for example "<a href="file:/etc">/etc</a>".  Only
                     file  context  specifications  with starting with a first component that prefix matches the
                     given prefix are loaded.  This may increase lookup performance, however any attempt to look
                     up a path not starting with the given prefix may fail.   This  optimization  is  no  longer
                     required due to the use of <u>file_contexts.bin</u> files and is deprecated.

</pre><h4><b>FILES</b></h4><pre>
       The  file  context  files  used to retrieve the default context depends on the <b>SELABEL_OPT_PATH</b> parameter
       passed to <b><a href="../man3/selabel_open.3.html">selabel_open</a></b>(3). If <u>NULL</u>, then the <b>SELABEL_OPT_PATH</b> value will default  to  the  active  policy
       file   contexts   location   (as   returned   by   <b><a href="../man3/selinux_file_context_path.3.html">selinux_file_context_path</a></b>(3)),  otherwise  the  actual
       <b>SELABEL_OPT_PATH</b> value specified is used.

       If <b>SELABEL_OPT_BASEONLY</b> is set, then the following files will be processed:

              1.  The mandatory  file  contexts  file  that  is  either  the  fully  qualified  file  name  from
                  <u>SELABEL_OPT_PATH.value</u> or if <u>NULL</u>, then the path returned by <b><a href="../man3/selinux_file_context_path.3.html">selinux_file_context_path</a></b>(3).

              2.  The  optional  local and distribution substitution files that perform path aliasing on the 'in
                  memory' version of the file contexts file.
                  These files have the same name as the mandatory file contexts file with the  extensions  <u>.subs</u>
                  and <u>.subs_dist</u> added.

       If the <b>SELABEL_OPT_BASEONLY</b> is not set, then the following files will be processed:

              1.  The  mandatory  file  contexts  file  that  is  either  the  fully  qualified  file  name from
                  <u>SELABEL_OPT_PATH.value</u> or if <u>NULL</u>, then the path returned by <b><a href="../man3/selinux_file_context_path.3.html">selinux_file_context_path</a></b>(3).

              2.  The optional local customizations file that has the same name as the mandatory  file  contexts
                  file with the extension <u>.local</u> added.
                  <b><a href="../man3/selinux_file_context_local_path.3.html">selinux_file_context_local_path</a></b>(3) will return the default path to this file.

              3.  The  optional  user home directory customizations file that has the same name as the mandatory
                  file contexts file with the extension <u>.homedirs</u> added.
                  <b><a href="../man3/selinux_file_context_homedir_path.3.html">selinux_file_context_homedir_path</a></b>(3) will return the default path to this file.

              4.  The optional local and distribution substitution files that perform any path aliasing  on  the
                  'in  memory'  version  of the file contexts file (and the <u>.local</u> and/or <u>.homedirs</u> if present).
                  These files have the same name as the mandatory file contexts file with the  extensions  <u>.subs</u>
                  and <u>.subs_dist</u> added.
                  <b><a href="../man3/selinux_file_context_subs_path.3.html">selinux_file_context_subs_path</a></b>(3)  and  <b><a href="../man3/selinux_file_context_subs_dist_path.3.html">selinux_file_context_subs_dist_path</a></b>(3) will return the
                  default paths to these files.

       The default file context series of files are:
             <u><a href="file:/etc/selinux/">/etc/selinux/</a>{SELINUXTYPE}/contexts/files/file_contexts</u>
             <u><a href="file:/etc/selinux/">/etc/selinux/</a>{SELINUXTYPE}/contexts/files/file_contexts.local</u>
             <u><a href="file:/etc/selinux/">/etc/selinux/</a>{SELINUXTYPE}/contexts/files/file_contexts.homedirs</u>
             <u><a href="file:/etc/selinux/">/etc/selinux/</a>{SELINUXTYPE}/contexts/files/file_contexts.subs</u>
             <u><a href="file:/etc/selinux/">/etc/selinux/</a>{SELINUXTYPE}/contexts/files/file_contexts.subs_dist</u>

       Where <u>{SELINUXTYPE}</u> is the entry from the selinux configuration file <u>config</u> (see <b><a href="../man5/selinux_config.5.html">selinux_config</a></b>(5)).

       Only the <u>file_contexts</u> file is mandatory, the remainder are optional.

       The entries within the file contexts series of files are shown in the <b>FILE</b> <b>FORMAT</b> section.

</pre><h4><b>FILE</b> <b>FORMAT</b></h4><pre>
</pre><h4><b>File</b> <b>Contexts</b> <b>Format</b></h4><pre>
       Each line within the <u>file_contexts</u> and the two customization files (<u>.local</u> and <u>.homedirs</u>) is as follows:

              <u>pathname</u> <u>[file_type]</u> <u>context</u>

       Where:
              <u>pathname</u>
                     An entry that defines the path to be labeled.  May contain either a fully  qualified  path,
                     or  a  Perl  compatible regular expression (PCRE), describing fully qualified path(s).  The
                     only PCRE flag in use is PCRE2_DOTALL, which causes  a  wildcard  '.'  to  match  anything,
                     including  a  new  line.   Strings representing paths are processed as bytes (as opposed to
                     Unicode), meaning that non-ASCII characters are not matched by a single wildcard.
              <u>file_type</u>
                     An optional file type consisting of:
                            <u>-b</u> - Block Device      <u>-c</u> - Character Device
                            <u>-d</u> - Directory         <u>-p</u> - Named Pipe
                            <u>-l</u> - Symbolic Link     <u>-s</u> - Socket
                            <u>--</u> - Ordinary file
              <u>context</u>
                     This entry can be either:

                            a.  The security context that will  be  assigned  to  the  file  (i.e.  returned  as
                                <u>context</u>).

                            b.  A  value  of <b>&lt;&lt;none&gt;&gt;</b> can be used to indicate that the matching files should not
                                be re-labeled and causes <b><a href="../man3/selabel_lookup.3.html">selabel_lookup</a></b>(3)  to  return  -1  with  <u>errno</u>  set  to
                                <b>ENOENT</b>.

       Example:
              # ./contexts/files/file_contexts
              # pathname file_type  context
              <a href="file:/.">/.</a>*                   system_u:object_r:default_t:s0
              /[^/]+        --      system_u:object_r:etc_runtime_t:s0
              <a href="file:/tmp/.">/tmp/.</a>*               &lt;&lt;none&gt;&gt;

</pre><h4><b>Substitution</b> <b>File</b> <b>Format</b></h4><pre>
       Each line within the substitution files (<u>.subs</u> and <u>.subs_dist</u>) has the form:
              <u>subs_pathname</u> <u>pathname</u>

       Where:
              <u>pathname</u>
                     A path that matches an entry in one or more of the file contexts policy configuration file.
              <u>subs_pathname</u>
                     The path that will be aliased (considered equivalent) with pathname by the look up process.

       Example:
              # ./contexts/files/file_contexts.subs
              # pathname  subs_pathname
              /myweb      <a href="file:/var/www">/var/www</a>
              /myspool    <a href="file:/var/spool/mail">/var/spool/mail</a>

              Using the above example, when <b><a href="../man3/selabel_lookup.3.html">selabel_lookup</a></b>(3) is passed a path of <u>/myweb/index.html</u> the function
              will substitute the <u>/myweb</u> component with <u><a href="file:/var/www">/var/www</a></u>, therefore the path used is:

                     <u>/var/www/index.html</u>

</pre><h4><b>NOTES</b></h4><pre>
       1.  If  contexts  are  to  be  validated,  then the global option <b>SELABEL_OPT_VALIDATE</b> must be set before
           calling <b><a href="../man3/selabel_open.3.html">selabel_open</a></b>(3). If this is not set, then it  is  possible  for  an  invalid  context  to  be
           returned.

       2.  If  the  size  of file contexts series of files contain many entries, then <b><a href="../man3/selabel_open.3.html">selabel_open</a></b>(3) may have a
           delay as it reads in the files, and if requested validates the entries.

       3.  Depending on the version of SELinux it is possible that a <u>file_contexts.template</u>  file  may  also  be
           present, however this is now deprecated.
           The  template  file  has  the same format as the <u>file_contexts</u> file and may also contain the keywords
           <b>HOME_ROOT</b>, <b>HOME_DIR</b>, <b>ROLE</b> and <b>USER</b>. This functionality has now been moved to  the  policy  store  and
           managed by <b><a href="../man8/semodule.8.html">semodule</a></b>(8) and <b><a href="../man8/genhomedircon.8.html">genhomedircon</a></b>(8).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/selinux.8.html">selinux</a></b>(8), <b><a href="../man3/selabel_open.3.html">selabel_open</a></b>(3), <b><a href="../man3/selabel_lookup.3.html">selabel_lookup</a></b>(3), <b><a href="../man3/selabel_stats.3.html">selabel_stats</a></b>(3), <b><a href="../man3/selabel_close.3.html">selabel_close</a></b>(3),
       <b><a href="../man3/selinux_set_callback.3.html">selinux_set_callback</a></b>(3), <b><a href="../man3/selinux_file_context_path.3.html">selinux_file_context_path</a></b>(3), <b><a href="../man3/freecon.3.html">freecon</a></b>(3), <b><a href="../man5/selinux_config.5.html">selinux_config</a></b>(5), <b><a href="../man2/lstat.2.html">lstat</a></b>(2),
       <b><a href="../man3/selinux_file_context_subs_path.3.html">selinux_file_context_subs_path</a></b>(3), <b><a href="../man3/selinux_file_context_subs_dist_path.3.html">selinux_file_context_subs_dist_path</a></b>(3),
       <b><a href="../man3/selinux_file_context_homedir_path.3.html">selinux_file_context_homedir_path</a></b>(3), <b><a href="../man3/selinux_file_context_local_path.3.html">selinux_file_context_local_path</a></b>(3), <b><a href="../man8/semodule.8.html">semodule</a></b>(8), <b><a href="../man8/genhomedircon.8.html">genhomedircon</a></b>(8)

Security Enhanced Linux                            01 Dec 2011                                   <u><a href="../man5/selabel_file.5.html">selabel_file</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>