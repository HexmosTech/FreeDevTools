<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>witness — lock validation facility</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       witness — lock validation facility

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>options</b> <b>WITNESS</b>
       <b>options</b> <b>WITNESS_COUNT</b>
       <b>options</b> <b>WITNESS_KDB</b>
       <b>options</b> <b>WITNESS_NO_VNODE</b>
       <b>options</b> <b>WITNESS_SKIPSPIN</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>witness</b> module keeps track of the locks acquired and released by each thread.  It also keeps track of
       the  order in which locks are acquired with respect to each other.  Each time a lock is acquired, <b>witness</b>
       uses these two lists to verify that a lock is not being acquired in the wrong order.   If  a  lock  order
       violation is detected, then a message is output to the kernel console or log detailing the locks involved
       and  the  locations in question.  Witness can also be configured to drop into the kernel debugger when an
       order violation occurs.

       The <b>witness</b> code also checks various other conditions such as verifying that one does not  recurse  on  a
       non-recursive  lock,  or  attempt  an  upgrade  on a shared lock held by another thread.  If any of these
       checks fail, then the kernel will panic.

       The WITNESS_COUNT kernel option controls the maximum number of <b>witness</b> entries that are  tracked  in  the
       kernel.  The maximum number of entries can be queried via the <u>debug.witness.count</u> sysctl.  It can also be
       set from the <u><a href="../man8/loader.8.html">loader</a></u>(8) via the <u>debug.witness.count</u> environment variable.

       The WITNESS_NO_VNODE kernel option tells <b>witness</b> to ignore locking issues between <u><a href="../man9/vnode.9.html">vnode</a></u>(9) objects.

       The  flag  that  controls  whether  or  not the kernel debugger is entered when a lock order violation is
       detected can be set in a variety of ways.  By default, the flag is off, but  if  the  WITNESS_KDB  kernel
       option  is  specified,  then  the flag will default to on.  It can also be set from the <u><a href="../man8/loader.8.html">loader</a></u>(8) via the
       <u>debug.witness.kdb</u> environment variable or after the kernel has booted via the  <u>debug.witness.kdb</u>  sysctl.
       If  the  flag  is  set to zero, then the debugger will not be entered.  If the flag is non-zero, then the
       debugger will be entered.

       The <b>witness</b> code can also be configured to skip all checks  on  spin  mutexes.   By  default,  this  flag
       defaults  to off, but it can be turned on by specifying the WITNESS_SKIPSPIN kernel option.  The flag can
       also be set via the <u><a href="../man8/loader.8.html">loader</a></u>(8) environment variable <u>debug.witness.skipspin</u>.  If the variable is set  to  a
       non-zero  value,  then spin mutexes are skipped.  Once the kernel has booted, the status of this flag can
       be examined but not set via the read-only sysctl <u>debug.witness.skipspin</u>.

       The sysctl <u>debug.witness.watch</u> specifies the level of witness involvement in the system.  A  value  of  1
       specifies  that  witness  is  enabled.   A value of 0 specifies that witness is disabled, but that can be
       enabled again.  This will maintain a small amount of overhead in the system.  A  value  of  -1  specifies
       that  witness is disabled permanently and cannot be enabled again.  The sysctl <u>debug.witness.watch</u> can be
       set via <u><a href="../man8/loader.8.html">loader</a></u>(8).

       The sysctl <u>debug.witness.output_channel</u> specifies the output channel used to display warnings emitted  by
       <b>witness</b>.   The  possible  values  are ‘console’, indicating that warnings are to be printed to the system
       console, ‘log’, indicating that warnings are to be logged via <u><a href="../man9/log.9.html">log</a></u>(9), and ‘none’.  This sysctl can be set
       via <u><a href="../man8/loader.8.html">loader</a></u>(8).

       The <b>witness</b> code also provides three extra <u><a href="../man4/ddb.4.html">ddb</a></u>(4) commands if both <b>witness</b> and <u><a href="../man4/ddb.4.html">ddb</a></u>(4) are  compiled  into
       the kernel:

       <b>show</b> <b>locks</b> [thread]
       Outputs  the list of locks held by a thread to the kernel console along with the filename and line number
       at which each lock was last acquired by the thread.  The optional <u>thread</u> argument may be  either  a  TID,
       PID,  or  pointer  to a thread structure.  If <u>thread</u> is not specified, then the locks held by the current
       thread are displayed.

       <b>show</b> <b>all</b> <b>locks</b>
       Outputs the list of locks held by all threads in the system to the kernel console.

       <b>show</b> <b>witness</b>
       Dump the current order list to the kernel console.  The code first displays the lock order tree  for  all
       of  the  sleep  locks.   Then  it  displays  the  lock order tree for all of the spin locks.  Finally, it
       displays a list of locks that have not yet been acquired.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man4/ddb.4.html">ddb</a></u>(4), <u><a href="../man8/loader.8.html">loader</a></u>(8), <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8), <u><a href="../man9/mutex.9.html">mutex</a></u>(9)

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>witness</b> code first appeared in BSD/OS 5.0 and was imported from there into FreeBSD 5.0.

Debian                                          November 18, 2015                                     <u><a href="../man4/WITNESS.4.html">WITNESS</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>