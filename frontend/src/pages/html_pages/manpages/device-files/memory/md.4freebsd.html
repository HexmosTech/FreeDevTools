<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>md — memory disk</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       md — memory disk

</pre><h4><b>SYNOPSIS</b></h4><pre>
       To compile this driver into the kernel, place the following lines in your kernel configuration file:

             <b>device</b> <b>md</b>

       Alternatively, to load the driver as a module at boot time, place the following line in <u><a href="../man5/loader.conf.5.html">loader.conf</a></u>(5):

             geom_md_load="YES"

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>md</b> driver provides support for four kinds of memory backed virtual disks:

       <b>malloc</b>   Backing  store  is  allocated using <u><a href="../man9/malloc.9.html">malloc</a></u>(9).  Only one malloc-bucket is used, which means that
                all <b>md</b> devices with <b>malloc</b> backing must share the malloc-per-bucket-quota.  The  exact  size  of
                this  quota  varies, in particular with the amount of RAM in the system.  The exact value can be
                determined with <u><a href="../man8/vmstat.8.html">vmstat</a></u>(8).

       <b>preload</b>  A module loaded by <u><a href="../man8/loader.8.html">loader</a></u>(8) with type ‘md_image’ is used  for  backing  store.   For  backwards
                compatibility  the  type  ‘mfs_root’  is also recognized.  See the description of module loading
                directives in <u><a href="../man5/loader.conf.5.html">loader.conf</a></u>(5) and note that the module name will either be an  absolute  path  to
                the image file or the name of a file in the <u>module_path</u>.

                If  the  kernel  is  created with option MD_ROOT the first preloaded image found will become the
                root file system.

       <b>vnode</b>    A regular file is used as backing store.  This  allows  for  mounting  ISO  images  without  the
                tedious detour over actual physical media.

       <b>swap</b>     Backing store is allocated from buffer memory.  Pages get pushed out to the swap when the system
                is  under  memory  pressure, otherwise they stay in the operating memory.  Using <b>swap</b> backing is
                generally preferable over <b>malloc</b> backing.

       For more information, please see <u><a href="../man8/mdconfig.8.html">mdconfig</a></u>(8).

</pre><h4><b>EXAMPLES</b></h4><pre>
       To create a kernel with a ramdisk or MD file system, your kernel config needs the following options:

             options         MD_ROOT                 # MD is a potential root device
             options         MD_ROOT_READONLY        # disallow mounting root writeable
             options         MD_ROOT_SIZE=8192       # 8MB ram disk
             makeoptions     MFS_IMAGE=/h/foo/ARM-MD
             options         ROOTDEVNAME=\"ufs:md0\"

       The image in <u>/h/foo/ARM-MD</u> will be loaded as the initial image each boot.  To create the  image  to  use,
       please follow the steps to create a file-backed disk found in the <u><a href="../man8/mdconfig.8.html">mdconfig</a></u>(8) man page.  Other tools will
       also create these images, such as NanoBSD.

</pre><h4><b>ARM</b> <b>KERNEL</b> <b>OPTIONS</b></h4><pre>
       On  armv6 and armv7 architectures, an MD_ROOT image larger than approximately 55 MiB may require building
       a custom kernel using several tuning options related to kernel memory usage.

       <b>options</b> <b>LOCORE_MAP_MB=&lt;num&gt;</b>
               This configures how much memory is mapped for the kernel during the early initialization  stages.
               The  value must be at least as large as the kernel plus all preloaded modules, including the root
               image.  There is no downside to setting this value too large, as long as it does not  exceed  the
               amount of physical memory.  The default is 64 MiB.

       <b>options</b> <b>NKPT2PG=&lt;num&gt;</b>
               This  configures  the  number  of  kernel  L2  page  table  pages  to  preallocate  during kernel
               initialization.  Each L2 page can map 4 MiB of kernel space.  The value must be large  enough  to
               map  the  kernel  plus all preloaded modules, including the root image.  The default value is 32,
               which is sufficient to map 128 MiB.

       <b>options</b> <b>VM_KMEM_SIZE_SCALE=&lt;num&gt;</b>
               This configures the amount of kernel virtual address (KVA) space to dedicate  to  the  kmem_arena
               map.   The  scale  value  is  the  ratio  of  physical  to virtual pages.  The default value of 3
               allocates a page of KVA for each 3 pages of physical ram in the system.

               The kernel and modules, including the root image, also consume KVA.  The combination of  a  large
               root image and the default scaling may preallocate so much KVA that there is not enough remaining
               address  space  to  allocate  kernel stacks, IO buffers, and other resources that are not part of
               kmem_arena.  Overallocating kmem_arena space is likely to manifest as failure to launch  userland
               processes with "cannot allocate kernel stack" messages.

               Setting  the  scale  value  too  high  may  result  in  kernel failure to allocate memory because
               kmem_arena  is  too  small,  and  the  failure  may  require  significant  runtime  to  manifest.
               Empirically,  a value of 5 works well for a 200 MiB root image on a system with 2 GiB of physical
               ram.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man8/gpart.8.html">gpart</a></u>(8), <u><a href="../man8/loader.8.html">loader</a></u>(8), <u><a href="../man8/mdconfig.8.html">mdconfig</a></u>(8), <u><a href="../man8/mdmfs.8.html">mdmfs</a></u>(8), <u><a href="../man8/newfs.8.html">newfs</a></u>(8), <u><a href="../man8/vmstat.8.html">vmstat</a></u>(8)

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>md</b> driver first appeared in FreeBSD 4.0 as a cleaner replacement for the MFS functionality previously
       used in PicoBSD and in the FreeBSD installation process.

       The <b>md</b> driver did a hostile takeover of the <u><a href="../man4/vn.4.html">vn</a></u>(4) driver in FreeBSD 5.0.

</pre><h4><b>AUTHORS</b></h4><pre>
       The <b>md</b> driver was written by Poul-Henning Kamp &lt;<u><a href="mailto:phk@FreeBSD.org">phk@FreeBSD.org</a></u>&gt;.

Debian                                           January 8, 2020                                           <u><a href="../man4/MD.4.html">MD</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>