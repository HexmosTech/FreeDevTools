<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ktr — kernel tracing facility</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ktr — kernel tracing facility

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>options</b> <b>KTR</b>
       <b>options</b> <b>ALQ</b>
       <b>options</b> <b>KTR_ALQ</b>
       <b>options</b> <b>KTR_COMPILE=(KTR_LOCK|KTR_INTR|KTR_PROC)</b>
       <b>options</b> <b>KTR_CPUMASK=0x3</b>
       <b>options</b> <b>KTR_ENTRIES=8192</b>
       <b>options</b> <b>KTR_MASK=(KTR_INTR|KTR_PROC)</b>
       <b>options</b> <b>KTR_VERBOSE</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>ktr</b> facility allows kernel events to be logged while the kernel executes so that they can be examined
       later when debugging.  The only mandatory option to enable <b>ktr</b> is “<b>options</b> <b>KTR</b>”.

       The  KTR_ENTRIES  option  sets the size of the buffer of events.  The size of the buffer in the currently
       running kernel can be found via the sysctl  <u>debug.ktr.entries</u>.   By  default  the  buffer  contains  1024
       entries.

   <b>Event</b> <b>Masking</b>
       Event  levels  can be enabled or disabled to trim excessive and overly verbose logging.  First, a mask of
       events is specified at compile time via the  KTR_COMPILE  option  to  limit  which  events  are  actually
       compiled into the kernel.  The default value for this option is for all events to be enabled.

       Secondly,  the  actual  events  logged while the kernel runs can be further masked via the run time event
       mask.  The KTR_MASK option sets the default value of the run time event mask.  The runtime event mask can
       also be set by the <u><a href="../man8/loader.8.html">loader</a></u>(8) via the <u>debug.ktr.mask</u> environment variable.  It can also  be  examined  and
       set  after  booting  via  the  <u>debug.ktr.mask</u>  sysctl.   By default the run time mask is set to block any
       tracing.  The definitions of the event mask bits can be found in &lt;<u>sys/ktr.h</u>&gt;.

       Furthermore, there is a CPU event mask whose default value can be changed  via  the  KTR_CPUMASK  option.
       When  two  or  more  parameters  to  KTR_CPUMASK,  are  used,  it  is important they are not separated by
       whitespace.  A CPU must have the bit corresponding to its logical id set in this bitmask for events  that
       occur  on  it  to be logged.  This mask can be set by the <u><a href="../man8/loader.8.html">loader</a></u>(8) via the <u>debug.ktr.cpumask</u> environment
       variable.  It can also be examined and set after booting via the <u>debug.ktr.cpumask</u> sysctl.   By  default,
       only CPUs specified in KTR_CPUMASK will log events.  See <u>sys/conf/NOTES</u> for more information.

   <b>Verbose</b> <b>Mode</b>
       By  default, events are only logged to the internal buffer for examination later, but if the verbose flag
       is set then they are dumped to the kernel console as well.  This flag can also be set from the loader via
       the <u>debug.ktr.verbose</u> environment variable, or  it  can  be  examined  and  set  after  booting  via  the
       <u>debug.ktr.verbose</u>  sysctl.   If  the  flag  is  set to zero, which is the default, then verbose output is
       disabled.  If the flag is set to one, then the contents of the log message and the CPU number are printed
       to the kernel console.  If the flag is greater than one, then the filename and line number of  the  event
       are output to the console in addition to the log message and the CPU number.  The KTR_VERBOSE option sets
       the flag to one.

   <b>Examining</b> <b>the</b> <b>Events</b>
       The  KTR buffer can be examined from within <u><a href="../man4/ddb.4.html">ddb</a></u>(4) via the <b>show</b> <b>ktr</b> [<b>/vV</b>] command.  This command displays
       the contents of the trace buffer one page at a time.  At the “<b>--more--</b>” prompt, the  Enter  key  displays
       one  more  entry and prompts again.  The spacebar displays another page of entries.  Any other key quits.
       By default the timestamp, filename, and line number are not displayed with each log  entry.   If  the  <b>/v</b>
       modifier  is  specified, then they are displayed in addition to the normal output.  If the <b>/V</b> modifier is
       specified, then just the timestamp is displayed in addition to the normal output.  Note that  the  events
       are displayed in reverse chronological order.  That is, the most recent events are displayed first.

   <b>Logging</b> <b>ktr</b> <b>to</b> <b>Disk</b>
       The KTR_ALQ option can be used to log <b>ktr</b> entries to disk for post analysis using the <u><a href="../man8/ktrdump.8.html">ktrdump</a></u>(8) utility.
       This  option  depends  on the ALQ option.  Due to the potentially high volume of trace messages the trace
       mask should be selected carefully.  This feature is configured through a group of sysctls.

       <u>debug.ktr.alq_file</u>    displays or sets the  file  that  <b>ktr</b>  will  log  to.   By  default  its  value  is
                             <u>/tmp/ktr.out</u>.   If  the  file name is changed while <b>ktr</b> is enabled it will not take
                             effect until the next invocation.

       <u>debug.ktr.alq_enable</u>  enables logging of <b>ktr</b> entries to disk if it is set to one.  Setting this to 0 will
                             terminate logging to disk and revert to logging to  the  normal  ktr  ring  buffer.
                             Data is not sent to the ring buffer while logging to disk.

       <u>debug.ktr.alq_max</u>     is  the maximum number of entries that will be recorded to disk, or 0 for infinite.
                             This is helpful for limiting the number of particularly high frequency entries that
                             are recorded.

       <u>debug.ktr.alq_depth</u>   determines the number of entries in the write buffer.   This  is  the  buffer  that
                             holds  entries  before  they  are  written to disk and defaults to the value of the
                             KTR_ENTRIES option.

       <u>debug.ktr.alq_failed</u>  records the number of times we failed to write an  entry  due  to  overflowing  the
                             write buffer.  This may happen if the frequency of the logged <b>ktr</b> messages outpaces
                             the depth of the queue.

       <u>debug.ktr.alq_cnt</u>     records the number of entries that have currently been written to disk.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man8/ktrdump.8.html">ktrdump</a></u>(8), <u><a href="../man9/alq.9.html">alq</a></u>(9), <u><a href="../man9/ktr.9.html">ktr</a></u>(9)

</pre><h4><b>HISTORY</b></h4><pre>
       The KTR kernel tracing facility first appeared in BSD/OS 3.0 and was imported into FreeBSD 5.0.

Debian                                          October 20, 2012                                          <u><a href="../man4/KTR.4.html">KTR</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>