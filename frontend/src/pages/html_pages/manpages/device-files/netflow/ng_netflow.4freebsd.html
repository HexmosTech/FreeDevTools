<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ng_netflow — Cisco's NetFlow implementation</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ng_netflow — Cisco's NetFlow implementation

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/types.h&gt;</b>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/netinet/in.h">netinet/in.h</a>&gt;</b>
       <b>#include</b> <b>&lt;netgraph/netflow/ng_netflow.h&gt;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>ng_netflow</b>  node  implements  Cisco's  NetFlow  export  protocol  on  a router running FreeBSD.  The
       <b>ng_netflow</b> node listens for incoming traffic and identifies unique flows in it.  Flows are  distinguished
       by  endpoint IP addresses, TCP/UDP port numbers, ToS and input interface.  Expired flows are exported out
       of the node in NetFlow version 5/9 UDP datagrams.  Expiration reason can be one of the following:

       <b>-</b>   RST or FIN TCP segment.

       <b>-</b>   Active timeout.  Flows cannot live more than the specified period  of  time.   The  default  is  1800
           seconds (30 minutes).

       <b>-</b>   Inactive timeout.  A flow was inactive for the specified period of time.  The default is 15 seconds.

       Node supports IPv6 accounting (NetFlow v9 only) and is aware of multiple fibs.  Different fibs are mapped
       to different domain_id in NetFlow V9 and different engine_id in NetFlow V5.

</pre><h4><b>HOOKS</b></h4><pre>
       This  node type supports up to NG_NETFLOW_MAXIFACES (default 65536) hooks named <u>iface0</u>, <u>iface1</u>, etc., and
       the same number of hooks named <u>out0</u>, <u>out1</u>, etc., plus two export hooks: <u>export</u> (for  NetFlow  version  5)
       and  <u>export9</u>  (for NetFlow version 9).  Export can be done simultaneously for all supported export hooks.
       By default (ingress NetFlow enabled) node does NetFlow accounting of data received on <u>iface*</u>  hooks.   If
       corresponding <u>out</u> hook is connected, unmodified data is bypassed to it, otherwise data is freed.  If data
       is  received  on  <u>out</u>  hook,  it  is  bypassed to corresponding <u>iface</u> hook without any processing (egress
       NetFlow disabled by default).  When full export datagram for an export protocol is built it  is  sent  to
       the  <u>export</u>  or  <u>export9</u>  hook.   In  normal  operation,  one  (or  more) export hook is connected to the
       <u>inet/dgram/udp</u> hook of the <u><a href="../man4/ng_ksocket.4.html">ng_ksocket</a></u>(4) node.

</pre><h4><b>CONTROL</b> <b>MESSAGES</b></h4><pre>
       This node type supports the generic control messages, plus the following:

       NGM_NETFLOW_INFO (<b>info</b>)
            Returns some node statistics and the current timeout values in a <u>struct</u> <u>ng_netflow_info</u>.

       NGM_NETFLOW_IFINFO (<b>ifinfo</b>)
            Returns information about the <u>ifaceN</u> hook.  The hook number is passed as an argument.

       NGM_NETFLOW_SETDLT (<b>setdlt</b>)
            Sets data link type on the <u>ifaceN</u> hook.  Currently, supported types are <b>DLT_RAW</b> (raw  IP  datagrams)
            and  <b>DLT_EN10MB</b>  (Ethernet).   DLT_  definitions can be found in &lt;<u>net/bpf.h</u>&gt; header.  Currently used
            values are 1 for <b>DLT_EN10MB</b> and 12 for <b>DLT_RAW</b>.  This message type uses <u>struct</u> <u>ng_netflow_setdlt</u>  as
            an argument:

                struct ng_netflow_setdlt {
                        uint16_t iface;         /* which iface dlt change */
                        uint8_t  dlt;           /* DLT_XXX from bpf.h */
                };

            The requested <u>ifaceN</u> hook must already be connected, otherwise message send operation will return an
            error.

       NGM_NETFLOW_SETIFINDEX (<b>setifindex</b>)
            In  some  cases,  <b>ng_netflow</b> may be unable to determine the input interface index of a packet.  This
            can happen if traffic enters the <b>ng_netflow</b> node before it comes to  the  system  interface's  input
            queue.   An  example  of  such  a  setup  is  capturing  a traffic <u>between</u> synchronous data line and
            <u><a href="../man4/ng_iface.4.html">ng_iface</a></u>(4).  In this case, the input index should be associated with a given hook.  The interface's
            index can  be  determined  via  <u><a href="../man3/if_nametoindex.3.html">if_nametoindex</a></u>(3)  from  userland.   This  message  requires  <u>struct</u>
            <u>ng_netflow_setifindex</u> as an argument:

                struct ng_netflow_setifindex {
                        uint16_t iface;         /* which iface index change */
                        uint16_t index;         /* new index */
                };

            The  requested  <u>ifaceN</u>  hook  must  already  be connected, otherwise the message send operation will
            return an error.

       NGM_NETFLOW_SETTIMEOUTS (<b>settimeouts</b>)
            Sets values  in  seconds  for  NetFlow  active/inactive  timeouts.   This  message  requires  <u>struct</u>
            <u>ng_netflow_settimeouts</u> as an argument:

                struct ng_netflow_settimeouts {
                        uint32_t inactive_timeout;      /* flow inactive timeout */
                        uint32_t active_timeout;        /* flow active timeout */
                };

       NGM_NETFLOW_SETCONFIG (<b>setconfig</b>)
            Sets  configuration  for the specified interface.  This message requires <u>struct</u> <u>ng_netflow_setconfig</u>
            as an argument:

                struct ng_netflow_setconfig {
                        uint16_t iface;         /* which iface config change */
                        uint32_t conf;          /* new config */
                #define NG_NETFLOW_CONF_INGRESS         1
                #define NG_NETFLOW_CONF_EGRESS          2
                #define NG_NETFLOW_CONF_ONCE            4
                #define NG_NETFLOW_CONF_THISONCE        8
                #define NG_NETFLOW_CONF_NOSRCLOOKUP     16
                #define NG_NETFLOW_CONF_NODSTLOOKUP     32
                };

            Configuration is a bitmask of several options.  Option NG_NETFLOW_CONF_INGRESS  enabled  by  default
            enables    ingress    NetFlow   generation   (for   data   coming   from   ifaceX   hook).    Option
            <u>NG_NETFLOW_CONF_EGRESS</u>  enables  egress  NetFlow  (for  data  coming  from   outX   hook).    Option
            <u>NG_NETFLOW_CONF_ONCE</u>  defines  that  packet should be accounted only once if it several times passes
            via netflow node.  Option <u>NG_NETFLOW_CONF_THISONCE</u> defines that packet should be accounted only once
            if it several times passes via exactly this netflow node.  These two options are important to  avoid
            duplicate    accounting    when   both   ingress   and   egress   NetFlow   are   enabled.    Option
            <u>NG_NETFLOW_CONF_NOSRCLOOKUP</u> skips radix lookup on flow source address used to fill in network  mask.
            Option  <u>NG_NETFLOW_CONF_NODSTLOOKUP</u>  skips radix lookup on destination (which fills egress interface
            id, destination mask and gateway).  If one doesn't need data provided by lookups, he/she can disable
            them, to reduce load on routers.

       NGM_NETFLOW_SETTEMPLATE (<b>settemplate</b>)
            Sets various timeouts to announce data flow templates (NetFlow v9-specific). This  message  requires
            <u>struct</u> <u>ng_netflow_settemplate</u> as an argument:

                struct ng_netflow_settemplate {
                        uint16_t time;          /* max time between announce */
                        uint16_t packets;       /* max packets between announce */
                };

            Value  of  time  field  represents  time in seconds to re-announce data templates.  Value of packets
            field represents maximum packets count between re-announcing data templates.

       NGM_NETFLOW_SETMTU (<b>setmtu</b>)
            Sets export interface MTU to build packets of specified size (NetFlow  v9-specific).   This  message
            requires <u>struct</u> <u>ng_netflow_setmtu</u> as an argument:

                struct ng_netflow_setemtu {
                        uint16_t mtu;           /* MTU for packet */
                };

            Default is 1500 bytes.

       NGM_NETFLOW_SHOW
            This  control  message asks a node to dump the entire contents of the flow cache.  It is called from
            <u><a href="../man8/flowctl.8.html">flowctl</a></u>(8), not directly from <u><a href="../man8/ngctl.8.html">ngctl</a></u>(8).

       NGM_NETFLOW_V9INFO (<b>v9info</b>)
            Returns some NetFlow v9 related values in a

                struct ng_netflow_v9info {
                    uint16_t        templ_packets;  /* v9 template packets */
                    uint16_t        templ_time;     /* v9 template time */
                    uint16_t        mtu;            /* v9 MTU */
                };

</pre><h4><b>SHUTDOWN</b></h4><pre>
       This node shuts down upon receipt of a  NGM_SHUTDOWN  control  message,  or  when  all  hooks  have  been
       disconnected.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The simplest possible configuration is one Ethernet interface, where flow collecting is enabled.

             /usr/sbin/ngctl -f- &lt;&lt;-SEQ
                     mkpeer fxp0: netflow lower iface0
                     name fxp0:lower netflow
                     connect fxp0: netflow: upper out0
                     mkpeer netflow: ksocket export inet/dgram/udp
                     msg netflow:export connect inet/10.0.0.1:4444
             SEQ

       This is a more complicated example of a router with 2 NetFlow-enabled interfaces <b>fxp0</b> and <b>ng0</b>.  Note that
       the <u>ng0:</u> node in this example is connected to <u><a href="../man4/ng_tee.4.html">ng_tee</a></u>(4).  The latter sends us a copy of IP packets, which
       we analyze and free.  On <u>fxp0:</u> we do not use tee, but send packets back to either node.

             /usr/sbin/ngctl -f- &lt;&lt;-SEQ
                     # connect ng0's tee to iface0 hook
                     mkpeer ng0:inet netflow right2left iface0
                     name ng0:inet.right2left netflow
                     # set DLT to raw mode
                     msg netflow: setdlt { iface=0 dlt=12 }
                     # set interface index (5 in this example)
                     msg netflow: setifindex { iface=0 index=5 }

                     # Connect fxp0: to iface1 and out1 hook
                     connect fxp0: netflow: lower iface1
                     connect fxp0: netflow: upper out1

                     # Create ksocket node on export hook, and configure it
                     # to send exports to proper destination
                     mkpeer netflow: ksocket export inet/dgram/udp
                     msg netflow:export connect inet/10.0.0.1:4444
             SEQ

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man2/setfib.2.html">setfib</a></u>(2), <u><a href="../man4/netgraph.4.html">netgraph</a></u>(4), <u><a href="../man4/ng_ether.4.html">ng_ether</a></u>(4), <u><a href="../man4/ng_iface.4.html">ng_iface</a></u>(4), <u><a href="../man4/ng_ksocket.4.html">ng_ksocket</a></u>(4), <u><a href="../man4/ng_tee.4.html">ng_tee</a></u>(4), <u><a href="../man8/flowctl.8.html">flowctl</a></u>(8), <u><a href="../man8/ngctl.8.html">ngctl</a></u>(8)

       B. Claise, Ed, <u>Cisco</u> <u>Systems</u> <u>NetFlow</u> <u>Services</u> <u>Export</u> <u>Version</u> <u>9</u>, RFC 3954.

       <u><a href="http://www.cisco.com/en/US/docs/ios/solutions_docs/netflow/nfwhite.html">http://www.cisco.com/en/US/docs/ios/solutions_docs/netflow/nfwhite.html</a></u>

</pre><h4><b>AUTHORS</b></h4><pre>
       The   <b>ng_netflow</b>   node  type  was  written  by  Gleb  Smirnoff  &lt;<u><a href="mailto:glebius@FreeBSD.org">glebius@FreeBSD.org</a></u>&gt;,  Alexander  Motin
       &lt;<u><a href="mailto:mav@FreeBSD.org">mav@FreeBSD.org</a></u>&gt;, Alexander Chernikov &lt;<u><a href="mailto:melifaro@ipfw.ru">melifaro@ipfw.ru</a></u>&gt;.  The  initial  code  was  based  on  <b>ng_ipacct</b>
       written by Roman V. Palagin &lt;<u><a href="mailto:romanp@unshadow.net">romanp@unshadow.net</a></u>&gt;.

</pre><h4><b>BUGS</b></h4><pre>
       Cache  snapshot  obtained  via  NGM_NETFLOW_SHOW command may lack some percentage of entries under severe
       load.

       The <b>ng_netflow</b> node type does not fill in AS numbers.  This is due to the lack of  necessary  information
       in  the  kernel  routing table.  However, this information can be injected into the kernel from a routing
       daemon such as GNU Zebra.  This functionality may become available in future releases.

Debian                                          December 10, 2012                                  <u><a href="../man4/NG_NETFLOW.4.html">NG_NETFLOW</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>