<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIFFCustomDirectory - routines to create a custom directory</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtiff-dev">libtiff-dev_4.7.0-3ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       TIFFCustomDirectory - routines to create a custom directory

</pre><h4><b>SYNOPSIS</b></h4><pre>
          #include &lt;tiffio.h&gt;

       <b>int</b> <b>TIFFCreateCustomDirectory(TIFF</b> <b>*tif,</b> <b>const</b> <b>TIFFFieldArray</b> <b>*infoarray)</b>

       <b>int</b> <b>TIFFCreateEXIFDirectory(TIFF</b> <b>*tif)</b>

       <b>int</b> <b>TIFFCreateGPSDirectory(TIFF</b> <b>*tif)</b>

       <b>int</b> <b>TIFFWriteCustomDirectory(TIFF</b> <b>*tif,</b> <b>uint64</b> <b>*pdiroff)</b>

       <b>int</b> <b>TIFFReadCustomDirectory(TIFF</b> <b>*tif,</b> <b>toff_t</b> <b>diroff,</b> <b>const</b> <b>TIFFFieldArray</b> <b>*infoarray)</b>

       <b>int</b> <b>TIFFReadEXIFDirectory(TIFF</b> <b>*tif,</b> <b>toff_t</b> <b>diroff)</b>

       <b>int</b> <b>TIFFReadGPSDirectory(TIFF</b> <b>*tif,</b> <b>toff_t</b> <b>diroff)</b>

       <b>const</b> <b>TIFFFieldArray</b> <b>*_TIFFGetExifFields(void)</b>

       <b>const</b> <b>TIFFFieldArray</b> <b>*_TIFFGetGpsFields(void)</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  following  routines  create a custom directory and retrieve information about directories in an open
       TIFF file.

       <u>TIFFCreateCustomDirectory()</u>, <u>TIFFCreateEXIFDirectory()</u>,  <u>TIFFCreateGPSDirectory()</u>  will  setup  a  custom
       directory  or one of the predefined EXIF or GPS directories and set the context of the TIFF-handle <b>tif</b> to
       that custom directory for functions like <u>TIFFSetField()</u>.

       <u>TIFFWriteCustomDirectory()</u> will write the contents of the current custom directory to the file and return
       the offset to that directory in <b>pdiroff</b>. That offset has to be written to the main-IFD:

           /* Go back to the first directory, and add the EXIFIFD pointer. */
          TIFFSetDirectory(tif, 0);
          TIFFSetField(tif, TIFFTAG_EXIFIFD, pdiroff);

       <u>TIFFReadCustomDirectory()</u> will read the custom directory from the arbitrary offset into the <b>infoarray</b> and
       sets the context of the TIFF-handle <b>tif</b> to that custom directory for functions like <b>TIFFReadField()</b>.  The
       <b>TIFFFieldArray</b>  <b>infoarray</b> has to be according the layout of the custom directory. For the predefined EXIF
       and  GPS  directories,  the  relevant  <b>TIFFFieldArray</b>  definitions  are  hidden  within   the   functions
       <u>TIFFReadEXIFDirectory()</u>  and <u>TIFFReadGPSDirectory()</u> The code is very similar to <u>TIFFReadDirectory()</u>.  The
       offset to the custom directory diroff has to be read from the relative TIFF tag first.

       <b>_</b><u>TIFFGetExifFields()</u> and <b>_</b><u>TIFFGetGpsFields()</u>  will return a pointer to the  <b>libtiff</b>  internal  definition
       list of the EXIF and GPS tags, respectively.

</pre><h4><b>NOTES</b></h4><pre>
       Be aware

       • that  until  a  directory  is not written to file AND read back, the query functions won't retrieve the
         correct information!

       • that  the  newly  created  directory  will  not  exist   on   the   file   till   <u>TIFFWriteDirectory()</u>,
         <u>TIFFCheckpointDirectory()</u>, <u>TIFFFlush()</u> or <u>TIFFClose()</u> has been called.

       • that <u>TIFFCreateDirectory()</u> and <u>TIFFWriteDirectory()</u> create a new directory, free the <b>*tif</b> structure and
         set up a new one.

       • that  unlike  <u>TIFFWriteDirectory()</u>,  <u>TIFFCheckpointDirectory()</u>  does  not  free  up  the directory data
         structures in memory.

       • that LibTiff does not support custom directory chains (NextIFD pointing to another  IFD).   NextIFD  of
         custom directories is always set to zero and should be zero when reading.

       Unfortunately  to create or read custom directories with predefined fields it is necessary to include the
       private tif_dir.h. However, for EXIF and GPS directories, which have a predefined schema within  <b>libtiff</b>,
       this  is  not necessary. There are some test programmes that briefly demonstrate the creation and reading
       of EXIF, GPS and custom directories.  See test/custom_dir.c and test/custom_dir_EXIF_231.c

       After    <b>libtiff</b>    version    4.6.0    <u>TIFFCreateCustomDirectory()</u>,    <u>TIFFCreateEXIFDirectory()</u>     and
       <u>TIFFCreateGPSDirectory()</u>   also   releases   the   directory   part  of  the  <u>tif</u>  structure  by  calling
       <u>TIFFFreeDirectory()</u>, which should have been  called  by  the  user  application  before  creating  a  new
       directory.

</pre><h4><b>HINTS</b> <b>AND</b> <b>DETAILED</b> <b>INSTRUCTIONS</b></h4><pre>
       Writing  TIFF  files  with more than one directory (IFD) is not easy because some side effects need to be
       known.

       The main point here is that there can only be one <b>tif</b> structure in the main memory for a file, which  can
       only  hold  the  tags  of  one  directory  at  a time. It is useless to work with two different tiffOut1,
       tiffOut2 pointers, because there is only ONE TIFF object (TIFF directory) within the <b>libtiff</b>. If you want
       to address a second directory in the file, the tags of the current directory must first be saved  in  the
       file,  otherwise they will be lost (overwritten or mixed). Then the <b>tif</b> structure in the main memory must
       be tidied up, otherwise the old tags will beincluded in the new directory.  This can be  done  either  by
       creating a new, empty <b>tif</b> structure or by reading in an directory previously saved in the file.

       A sequence to handle a second (or third) TIFF directory - in this case the GPS IFD - is as follows:

       1. Create TIFF file

       2. Complete the "normal" metadata

       3. Set  the tag for the custom directory with a “dummy” value in order to get the tag reserved. The final
          value will be inserted lateron. This prevents the main directory from being written to the file  again
          at an additional area, leaving the first memory area unused:

          TIFFSetField(tiffOut, TIFFTAG_GPSIFD, dir_offset);

       4. Save  current  TIFF-directory  to  file.  Otherwise, it will be lost.  Remember also the number of the
          current directory:

          TIFFWriteDirectory(tiffOut);
          dirNum = TIFFCurrentDirectory(tiffOut);

       5. Create the second TIFF-directory (e.g. custom  directory)  and  set  its  fields.  The  TIFFFieldArray
          infoarray has to be specified beforehand somewhere in your private include files.  An example is given
          for the EXIF directory in tif_dirinfo.c

          TIFFCreateCustomDirectory(tiffOut, infoarray);        /* for a real custom directory */
          /* or alternatively, use GPS or EXIF with pre-defined TIFFFieldArray IFD field structure */
          TIFFCreateGPSDirectory(tiffOut);
          TIFFSetField(tiffOut, GPSTAG_VERSIONID, gpsVersion);  /* set fields of the custom directory */

       Be aware that every <u>TIFFCreateDirectory()</u> or <u>TIFFWriteDirectory()</u> apparently frees the <b>*tif</b> structure and
       sets up a new one!

       6. Write custom directory to file. The offset to that directory in the file is returned in <b>dir_offset</b>.

          TIFFWriteCustomDirectory(tiffOut, &amp;dir_offset);

       7. Reload  the  first directory (i.e. the original TIFF directory).  Apparently, this reads the data back
          from file.

          TIFFSetDirectory(tiffOut, dirNum);

       8. Set the correct offset value of the custom directory IFD tag and save that changes to file.

          TIFFSetField(tiffOut, TIFFTAG_GPSIFD, dir_offset);
          TIFFWriteDirectory(tiffOut);

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       1 is returned when the contents are successfully written to the file.  Otherwise, 0  is  returned  if  an
       error was encountered when writing the directory contents.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       All  error messages are directed to the <u>TIFFErrorExtR()</u> routine.  Likewise, warning messages are directed
       to the <u>TIFFWarningExtR()</u> routine.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>libtiff</u>   (3tiff),   <u>TIFFCreateDirectory</u>   (3tiff),   <u>TIFFquery</u>   (3tiff),   <u>TIFFSetDirectory</u>    (3tiff),
       <u>TIFFWriteDirectory</u> (3tiff)

</pre><h4><b>AUTHOR</b></h4><pre>
       LibTIFF contributors

</pre><h4><b>COPYRIGHT</b></h4><pre>
       1988-2022, LibTIFF contributors

4.7                                               Apr 30, 2025                        <u><a href="../man3tiff/TIFFCUSTOMDIRECTORY.3tiff.html">TIFFCUSTOMDIRECTORY</a></u>(3tiff)
</pre>
 </div>
</div></section>
</div>
</body>
</html>