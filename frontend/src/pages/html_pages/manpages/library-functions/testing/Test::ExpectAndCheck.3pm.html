<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>"Test::ExpectAndCheck" - "expect/check"-style unit testing with object methods</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtest-expectandcheck-perl">libtest-expectandcheck-perl_0.07-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       "Test::ExpectAndCheck" - "expect/check"-style unit testing with object methods

</pre><h4><b>SYNOPSIS</b></h4><pre>
          use Test::More;
          use Test::ExpectAndCheck;

          my ( $controller, $mock ) = Test::ExpectAndCheck-&gt;create;

          {
             $controller-&gt;expect( act =&gt; 123, 45 )
                -&gt;will_return( 678 );

             is( $mock-&gt;act( 123, 45 ), 678, '$mock-&gt;act returns result' );

             $controller-&gt;check_and_clear( '-&gt;act' );
          }

          done_testing;

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This package creates objects that assist in writing unit tests with mocked object instances. Each mock
       instance will expect to receive a given list of method calls. Each method call is checked that it
       received the right arguments, and will return a prescribed result. At the end of each test, each object
       is checked to ensure all the expected methods were called.

   <b>Verbose</b> <b>Mode</b>
       Sometimes when debugging a failing test it can be useful to see a log of which expectations have been
       called. By setting the $VERBOSE package variable to a true value, extra printing will happen during the
       test.

          {
             local $Test::ExpectAndCheck::VERBOSE = 1;

             $controller-&gt;expect( ... );

             ...
          }

       This is printed directly to "STDERR" and is intended for temporary debugging during development.

</pre><h4><b>METHODS</b></h4><pre>
   <b>create</b>
          ( $controller, $mock ) = Test::ExpectAndCheck-&gt;create;

       Objects are created in "entangled pairs" by the "create" method. The first object is called the
       "controller", and is used by the unit testing script to set up what method calls are to be expected, and
       what their results shall be.  The second object is the "mock", the object to be passed to the code being
       tested, on which the expected method calls are (hopefully) invoked. It will have whatever interface is
       implied by the method call expectations.

   <b>expect</b>
          $exp = $controller-&gt;expect( $method, @args );

       Specifies that the mock will expect to receive a method call of the given name, with the given arguments.

       The argument values are compared using "cmp_deeply" in Test::Deep. Values can be specified literally, or
       using any of the "Special Comparisons" defined by Test::Deep. Additionally, the "namedargs" function
       listed below can also appear as the final argument test.

       The test script can call the "will_return" or "will_throw" methods on the expectation to set what the
       result of invoking this method will be.

   <b>whenever</b>
          $exp = $controller-&gt;whenever( $method, @args );

       <u>Since</u> <u>version</u> <u>0.05.</u>

       Specifies that the mock might expect to receive method calls of the given name with the given arguments.
       These expectations are not expired once called, nor do they expect to be called in any particular order.
       Furthermore it is not a test failure for one of these not to be invoked at all.

       These expectations do not directly form part of the test assertions checked by the "check_and_clear"
       method, but they may be useful to assist the code under test, such as providing support behaviours that
       it may rely on but would make the test script too fragile if spelled out in full using a regular
       "expect".

       These expectations are only used as a fallback mechanism, if the next real "expect"-based expectation
       does not match a method call. Individual special cases can still be set up using "expect" even though a
       "whenever" exists that might also match it.

       As with "expect", the argument values are compared using "Test::Deep", and results can be set with
       "will_return" or "will_throw".

   <b>check_and_clear</b>
          $controller-&gt;check_and_clear( $name );

       Checks that by now, every expected method has been called, and emits a new test output line via
       Test::Builder. Regardless, the expectations are also cleared out ready for the start of the next test.

</pre><h4><b>FUNCTIONS</b></h4><pre>
   <b>namedargs</b>
          $cmp = namedargs(name =&gt; $val, ...)

       <u>Since</u> <u>version</u> <u>0.07.</u>

       This exportable function may be used as the final argument to an "expect" or "whenever" expectation, to
       indicate that all of the remaining arguments passed at that position should be treated like named
       parameters in a list of key/value pairs. This makes then insensitive to the order that the values are
       passed by the caller.

       Each value given can be a literal value or a special comparison from "Test::Deep".

       For example, this simple expectation will fail 50% of the time due to hash order randomisation:

          $controller-&gt;expect( m =&gt; x =&gt; "X", y =&gt; "Y" );

          my %args = ( x =&gt; "X", y =&gt; "Y" );
          $puppet-&gt;m( %args );

       This is solved by using the namedargs() function.

          use Test::ExpectAndCheck 'namedargs';

          $controller-&gt;expect( m =&gt; namedargs(x =&gt; "X", y =&gt; "Y") );

       Additionally, positional arguments may appear before this call.

          $controller-&gt;expect( n =&gt; 1, 2, namedargs(x =&gt; "X", y =&gt; "Y") );
          $puppet-&gt;n( $one, $two, %args );

</pre><h4><b>EXPECTATIONS</b></h4><pre>
       Each value returned by the "expect" method is an "expectation", an object that represents one expected
       method call, the arguments it should receive, and the return value it should provide.

   <b>will_return</b>
          $exp-&gt;will_return( @result );

       <u>Since</u> <u>version</u> <u>0.04.</u>

       Sets the result that will be returned by this method call.

       This method used to be named "returns", which should be avoided in new code.  Uses of the old name will
       print a deprecation warning.

   <b>will_return_using</b>
          $exp-&gt;will_return_using( sub ($args) { ... } );

       <u>Since</u> <u>version</u> <u>0.05.</u>

       Sets the result that will be returned, calculated by invoking the code.

       The code block is invoked at the time that a result is needed. It is invoked with an array reference
       containing the arguments to the original method call.  This is especially useful for expectations created
       using "whenever".

       <u>Since</u> <u>version</u> <u>0.06</u> the code block is passed a reference to the caller's actual arguments array, and
       therefore can modify values in it if required - e.g. when trying to mock functions such as open() or
       sysread() which modify lvalues passed in as arguments.

       There is no corresponding "will_throw_using", but an exception thrown by this code will be seen by the
       calling code.

   <b>will_throw</b>
          $exp-&gt;will_throw( $e );

       <u>Since</u> <u>version</u> <u>0.04.</u>

       Sets the exception that will be thrown by this method call.

       This method used to be named "throws", which should be avoided in new code.

   <b>will_also</b>
          $exp-&gt;will_also( sub { ... } );

       <u>Since</u> <u>version</u> <u>0.04.</u>

       Adds extra code which is run when the expected method is called, in addition to generating the result
       value or exception.

       When invoked, the code body is invoked in void context with no additional arguments.

   <b>indefinitely</b>
          $exp-&gt;indefinitely;

       <u>Since</u> <u>version</u> <u>0.05.</u>

       On an expectation created using "whenever", this expectation will not be cleared by "check_and_clear",
       effectively establishing its effects for the entire lifetime of the test script.

       On an expectation created using "expect" this has no effect; such an expectation will still be cleared as
       usual.

</pre><h4><b>AUTHOR</b></h4><pre>
       Paul Evans &lt;<a href="mailto:leonerd@leonerd.org.uk">leonerd@leonerd.org.uk</a>&gt;

perl v5.40.0                                       2024-10-28                          <u>Test::<a href="../man3pm/ExpectAndCheck.3pm.html">ExpectAndCheck</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>