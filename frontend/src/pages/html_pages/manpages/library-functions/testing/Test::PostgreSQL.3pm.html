<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test::PostgreSQL - PostgreSQL runner for tests</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtest-postgresql-perl">libtest-postgresql-perl_1.29-1build1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Test::PostgreSQL - PostgreSQL runner for tests

</pre><h4><b>SYNOPSIS</b></h4><pre>
         use DBI;
         use Test::PostgreSQL;
         use Test::More;

         # optionally
         # (if not already set at shell):
         #
         # $ENV{POSTGRES_HOME} = '/path/to/my/pgsql/installation';

         my $pgsql = eval { Test::PostgreSQL-&gt;new() }
             or plan skip_all =&gt; $@;

         plan tests =&gt; XXX;

         my $dbh = DBI-&gt;connect($pgsql-&gt;dsn);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       "Test::PostgreSQL" automatically setups a PostgreSQL instance in a temporary directory, and destroys it
       when the perl script exits.

       This module is a fork of Test::postgresql, which was abandoned by its author several years ago.

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       "Test::PostgreSQL" object has the following attributes, overridable by passing corresponding argument to
       constructor:

   <b>dbname</b>
       Database name to use in this "Test::PostgreSQL" instance. Default is "test".

   <b>dbowner</b>
       Database owner user name. Default is "postgres".

   <b>host</b>
       Host name or IP address to use for PostgreSQL instance connections. Default is 127.0.0.1.

   <b>base_dir</b>
       Base directory under which the PostgreSQL instance is being created. The property can be passed as a
       parameter to the constructor, in which case the directory will not be removed at exit.

   <b>base_port</b>
       Connection port number to start with. If the port is already used we will increment the value and try
       again.

       Default: 15432.

   <b>unix_socket</b>
       Whether to only connect via UNIX sockets; if false (the default), connections can occur via localhost.
       [This changes the "dsn" returned to only give the UNIX socket directory, and avoids any issues with
       conflicting TCP ports on localhost.]

   <b>socket_dir</b>
       Unix socket directory to use if "unix_socket" is true. Default is "$base_dir/tmp".

   <b>pg_ctl</b>
       Path to "pg_ctl" program which is part of the PostgreSQL distribution.

       Starting with PostgreSQL version 9.0 "pg_ctl" can be used to start/stop postgres without having to use
       fork/pipe and will be chosen automatically if "pg_ctl" is not set but the program is found and the
       version is recent enough.

       <b>NOTE:</b> do NOT use this with PostgreSQL versions prior to version 9.0.

       By default we will try to find "pg_ctl" in PostgresSQL directory.

   <b>initdb</b>
       Path to "initdb" program which is part of the PostreSQL distribution. Default is to try and find it in
       PostgreSQL directory.

   <b>initdb_args</b>
       Arguments to pass to "initdb" program when creating a new PostgreSQL database cluster for
       Test::PostgreSQL session.

       Defaults to "-U postgres -A trust". See "dbowner".

   <b>extra_initdb_args</b>
       Extra args to be appended to "initdb_args". Default is empty.

   <b>pg_config</b>
       Configuration to place in "$base_dir/data/postgresql.conf". Use this to override PostgreSQL configuration
       defaults, e.g. to speed up PostgreSQL database init and seeding one might use something like this:

           my $pgsql = Test::PostgreSQL-&gt;new(
               pg_config =&gt; q|
               # foo baroo mymse throbbozongo
               fsync = off
               synchronous_commit = off
               full_page_writes = off
               bgwriter_lru_maxpages = 0
               shared_buffers = 512MB
               effective_cache_size = 512MB
               work_mem = 100MB
           |);

   <b>postmaster</b>
       Path to "postmaster" which is part of the PostgreSQL distribution. If not set, the programs are
       automatically searched by looking up $PATH and other prefixed directories. Since "postmaster" is
       deprecated in newer PostgreSQL versions "postgres" is used in preference to "postmaster".

   <b>postmaster_args</b>
       Defaults to "-h 127.0.0.1 -F".

   <b>extra_postmaster_args</b>
       Extra args to be appended to "postmaster_args". Default is empty.

   <b>psql</b>
       Path to "psql" client which is part of the PostgreSQL distribution.

       "psql" can be used to run SQL scripts against the temporary database created by "new":

           my $pgsql = Test::PostgreSQL-&gt;new();
           my $psql = $pgsql-&gt;psql;

           my $out = `$psql -f /path/to/script.sql 2&gt;&amp;1`;

           die "Error executing script.sql: $out" unless $? == 0;

   <b>psql_args</b>
       Command line arguments necessary for "psql" to connect to the correct PostgreSQL instance.

       Defaults to "-U postgres -d test -h 127.0.0.1 -p $self-&gt;port".

       See also "dbowner", "dbname", "host", "base_port".

   <b>extra_psql_args</b>
       Extra args to be appended to "psql_args".

   <b>run_psql_args</b>
       Arguments specific for "run_psql" invocation, used mostly to set up and seed database schema after
       PostgreSQL instance is launched and configured.

       Default is "-1Xqb -v ON_ERROR_STOP=1". This means:

       •   1: Run all SQL statements in passed scripts as single transaction

       •   X: Skip ".psqlrc" files

       •   q: Run quietly, print only notices and errors on stderr (if any)

       •   b: Echo SQL statements that cause PostgreSQL exceptions (version 9.5+)

       •   -v ON_ERROR_STOP=1: Stop processing SQL statements after the first error

   <b>seed_scripts</b>
       Arrayref  with  the  list  of  SQL scripts to run after the database was instanced and set up. Default is
       "[]".

       <b>NOTE</b> that "psql" older than 9.6 does not  support  multiple  "-c"  and  "-f"  switches  in  arguments  so
       "seed_scripts"  will  be  executed one by one. This implies multiple transactions instead of just one; if
       you need all seed statements to apply within a single transaction, combine them into one seed script.

   <b>auto_start</b>
       Integer  value  that  controls  whether  PostgreSQL  server  is  started   and   setup   after   creating
       "Test::PostgreSQL" instance. Possible values:

       0   Do not start PostgreSQL.

       1   Start PostgreSQL but do not run "setup".

       2   Start PostgreSQL and run "setup".

           Default is 2.

</pre><h4><b>METHODS</b></h4><pre>
   <b>new</b>
       Create  and  run  a  PostgreSQL  instance.  The  instance is terminated when the returned object is being
       DESTROYed.  If required programs (initdb and postmaster) were not found, the function returns  undef  and
       sets appropriate message to $Test::PostgreSQL::errstr.

   <b>dsn</b>
       Builds and returns dsn by using given parameters (if any).  Default username is "postgres", and dbname is
       "test" (an empty database).

   <b>uri</b>
       Builds  and  returns  a connection URI using the given parameters (if any). See URI::db for details about
       the format.

       Default username is "postgres", and dbname is "test" (an empty database).

   <b>pid</b>
       Returns process id of PostgreSQL (or undef if not running).

   <b>port</b>
       Returns TCP port number on which postmaster is accepting connections (or undef if not running).

   <b>start</b>
       Starts postmaster.

   <b>stop</b>
       Stops postmaster.

   <b>setup</b>
       Setups the PostgreSQL instance. Note that this method should be invoked <u>before</u> "start".

   <b>run_psql</b>
       Execute "psql" program with the given list of arguments. Usually this would be something like:

           $pgsql-&gt;run_psql('-c', q|'INSERT INTO foo (bar) VALUES (42)'|);

       Or:

           $pgsql-&gt;run_psql('-f', '/path/to/script.sql');

       Note that when using literal SQL statements with "-c" parameter you will need  to  escape  them  manually
       like shown above. "run_psql" will not quote them for you.

       The  actual  command line to execute "psql" will be concatenated from "psql_args", "extra_psql_args", and
       "run_psql_args".

       <b>NOTE</b> that "psql" older than 9.6 does not support multiple "-c" and/or "-f" switches in arguments.

   <b>run_psql_scripts</b>
       Given a list of script file paths, invoke "run_psql" once with "-f 'script'" for every path in PostgreSQL
       9.6+, or once per "-f 'script'" for older PostgreSQL versions.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
   <b>POSTGRES_HOME</b>
       If your postgres installation is not located in a well known path, or you have  many  versions  installed
       and want to run your tests against particular one, set this environment variable to the desired path. For
       example:

           export POSTGRES_HOME='/usr/local/pgsql94beta'

       This is the same idea and variable name which is used by the installer of DBD::Pg.

</pre><h4><b>AUTHOR</b></h4><pre>
       Toby Corkindale, Kazuho Oku, Peter Mottram, Alex Tokarev, plus various contributors.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Current version copyright X 2012-2015 Toby Corkindale.

       Previous versions copyright (C) 2009 Cybozu Labs, Inc.

</pre><h4><b>LICENSE</b></h4><pre>
       This    module   is   free   software,   released   under   the   Perl   Artistic   License   2.0.    See
       &lt;<a href="http://www.perlfoundation.org/artistic_license_2_0">http://www.perlfoundation.org/artistic_license_2_0</a>&gt; for more information.

perl v5.36.0                                       2023-01-18                              <u>Test::<a href="../man3pm/PostgreSQL.3pm.html">PostgreSQL</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>