<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tsv  -  Part  of  the  Tcl  threading extension allowing script level manipulation of data shared between</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/tcl-thread">tcl-thread_2.8.11-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tsv  -  Part  of  the  Tcl  threading extension allowing script level manipulation of data shared between
       threads.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       package require <b>Tcl</b>  <b>8.4</b>

       package require <b>Thread</b>  <b>?2.8?</b>

       <b>tsv::names</b> ?pattern?

       <b>tsv::object</b> <u>varname</u> <u>element</u>

       <b>tsv::set</b> <u>varname</u> <u>element</u> ?value?

       <b>tsv::get</b> <u>varname</u> <u>element</u> ?namedvar?

       <b>tsv::unset</b> <u>varname</u> ?element?

       <b>tsv::exists</b> <u>varname</u> <u>element</u>

       <b>tsv::pop</b> <u>varname</u> <u>element</u>

       <b>tsv::move</b> <u>varname</u> <u>oldname</u> <u>newname</u>

       <b>tsv::incr</b> <u>varname</u> <u>element</u> ?count?

       <b>tsv::append</b> <u>varname</u> <u>element</u> <u>value</u> ?value ...?

       <b>tsv::lock</b> <u>varname</u> <u>arg</u> ?arg ...?

       <b>tsv::handlers</b>

       <b>tsv::lappend</b> <u>varname</u> <u>element</u> <u>value</u> ?value ...?

       <b>tsv::linsert</b> <u>varname</u> <u>element</u> <u>index</u> <u>value</u> ?value ...?

       <b>tsv::lreplace</b> <u>varname</u> <u>element</u> <u>first</u> <u>last</u> ?value ...?

       <b>tsv::llength</b> <u>varname</u> <u>element</u>

       <b>tsv::lindex</b> <u>varname</u> <u>element</u> ?index?

       <b>tsv::lrange</b> <u>varname</u> <u>element</u> <u>from</u> <u>to</u>

       <b>tsv::lsearch</b> <u>varname</u> <u>element</u> ?options? <u>pattern</u>

       <b>tsv::lset</b> <u>varname</u> <u>element</u> <u>index</u> ?index ...? <u>value</u>

       <b>tsv::lpop</b> <u>varname</u> <u>element</u> ?index?

       <b>tsv::lpush</b> <u>varname</u> <u>element</u> ?index?

       <b>tsv::array</b> <b>set</b> <u>varname</u> <u>list</u>

       <b>tsv::array</b> <b>get</b> <u>varname</u> ?pattern?

       <b>tsv::array</b> <b>names</b> <u>varname</u> ?pattern?

       <b>tsv::array</b> <b>size</b> <u>varname</u>

       <b>tsv::array</b> <b>reset</b> <u>varname</u> <u>list</u>

       <b>tsv::array</b> <b>bind</b> <u>varname</u> <u>handle</u>

       <b>tsv::array</b> <b>unbind</b> <u>varname</u>

       <b>tsv::array</b> <b>isbound</b> <u>varname</u>

       <b>tsv::keyldel</b> <u>varname</u> <u>keylist</u> <u>key</u>

       <b>tsv::keylget</b> <u>varname</u> <u>keylist</u> <u>key</u> ?retvar?

       <b>tsv::keylkeys</b> <u>varname</u> <u>keylist</u> ?key?

       <b>tsv::keylset</b> <u>varname</u> <u>keylist</u> <u>key</u> <u>value</u> ?key value..?

________________________________________________________________________________________________________________

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This section describes commands implementing thread shared variables.  A thread shared variable  is  very
       similar  to a Tcl array but in contrast to a Tcl array it is created in shared memory and can be accessed
       from many threads at the same time. Important feature of thread shared variable is that  each  access  to
       the  variable  is  internaly  protected  by a mutex so script programmer does not have to take care about
       locking the variable himself.

       Thread shared variables are not bound to any thread explicitly. That  means  that  when  a  thread  which
       created  any of thread shared variables exits, the variable and associated memory is not unset/reclaimed.
       User has to explicitly unset the variable to reclaim the memory consumed by the variable.

</pre><h4><b>ELEMENT</b> <b>COMMANDS</b></h4><pre>
       <b>tsv::names</b> ?pattern?
              Returns names of shared variables matching optional ?pattern?  or all known variables  if  pattern
              is ommited.

       <b>tsv::object</b> <u>varname</u> <u>element</u>
              Creates  object  accessor  command  for  the  <u>element</u>  in  the shared variable <u>varname</u>. Using this
              command, one can apply most of the other shared variable  commands  as  method  functions  of  the
              element  object  command.  The object command is automatically deleted when the element which this
              command is pointing to is unset.

                  % tsv::set foo bar "A shared string"
                  % set string [tsv::object foo bar]
                  % $string append " appended"
                  =&gt; A shared string appended

       <b>tsv::set</b> <u>varname</u> <u>element</u> ?value?
              Sets the value of the <u>element</u> in the shared variable <u>varname</u> to <u>value</u> and  returns  the  value  to
              caller.  The  <u>value</u> may be ommited, in which case the command will return the current value of the
              element. If the element cannot be found, error is triggered.

       <b>tsv::get</b> <u>varname</u> <u>element</u> ?namedvar?
              Retrieves the value of the <u>element</u> from the shared variable <u>varname</u>.   If  the  optional  argument
              <u>namedvar</u>  is given, the value is stored in the named variable. Return value of the command depends
              of the existence of the optional argument <u>namedvar</u>.  If the argument is ommited and the  requested
              element cannot be found in the shared array, the command triggers error. If, however, the optional
              argument  is  given  on  the command line, the command returns true (1) if the element is found or
              false (0) if the element is not found.

       <b>tsv::unset</b> <u>varname</u> ?element?
              Unsets the <u>element</u> from the shared variable <u>varname</u>.  If the optional element  is  not  given,  it
              deletes the variable.

       <b>tsv::exists</b> <u>varname</u> <u>element</u>
              Checks wether the <u>element</u> exists in the shared variable <u>varname</u> and returns true (1) if it does or
              false (0) if it doesn't.

       <b>tsv::pop</b> <u>varname</u> <u>element</u>
              Returns  value  of  the  <u>element</u> in the shared variable <u>varname</u> and unsets the element, all in one
              atomic operation.

       <b>tsv::move</b> <u>varname</u> <u>oldname</u> <u>newname</u>
              Renames the element <u>oldname</u> to the <u>newname</u>  in  the  shared  variable  <u>varname</u>.  This  effectively
              performs an get/unset/set sequence of operations but all in one atomic step.

       <b>tsv::incr</b> <u>varname</u> <u>element</u> ?count?
              Similar  to  standard  Tcl <b>incr</b> command but increments the value of the <u>element</u> in shared variaboe
              <u>varname</u> instead of the Tcl variable.

       <b>tsv::append</b> <u>varname</u> <u>element</u> <u>value</u> ?value ...?
              Similar to standard Tcl <b>append</b> command but appends one or more values to  the  <u>element</u>  in  shared
              variable <u>varname</u> instead of the Tcl variable.

       <b>tsv::lock</b> <u>varname</u> <u>arg</u> ?arg ...?
              This  command  concatenates passed arguments and evaluates the resulting script under the internal
              mutex protection. During the script evaluation, the entire shared variable is locked.  For  shared
              variable  commands within the script, internal locking is disabled so no deadlock can occur. It is
              also allowed to unset the  shared  variable  from  within  the  script.  The  shared  variable  is
              automatically created if it did not exists at the time of the first lock operation.

                  % tsv::lock foo {
                      tsv::lappend foo bar 1
                      tsv::lappend foo bar 2
                      puts stderr [tsv::set foo bar]
                      tsv::unset foo
                  }

       <b>tsv::handlers</b>
              Returns  the names of all persistent storage handlers enabled at compile time.  See <b>ARRAY</b> <b>COMMANDS</b>
              for details.

</pre><h4><b>LIST</b> <b>COMMANDS</b></h4><pre>
       Those command are similar to the equivalently named Tcl command. The difference is that they  operate  on
       elements of shared arrays.

       <b>tsv::lappend</b> <u>varname</u> <u>element</u> <u>value</u> ?value ...?
              Similar  to  standard  Tcl <b>lappend</b> command but appends one or more values to the <u>element</u> in shared
              variable <u>varname</u> instead of the Tcl variable.

       <b>tsv::linsert</b> <u>varname</u> <u>element</u> <u>index</u> <u>value</u> ?value ...?
              Similar to standard Tcl <b>linsert</b> command but inserts one or more values at the <u>index</u> list  position
              in the <u>element</u> in the shared variable <u>varname</u> instead of the Tcl variable.

       <b>tsv::lreplace</b> <u>varname</u> <u>element</u> <u>first</u> <u>last</u> ?value ...?
              Similar  to  standard  Tcl  <b>lreplace</b> command but replaces one or more values between the <u>first</u> and
              <u>last</u> position in the <u>element</u> of the shared variable <u>varname</u> instead of the Tcl variable.

       <b>tsv::llength</b> <u>varname</u> <u>element</u>
              Similar to standard Tcl <b>llength</b> command but returns length of the <u>element</u> in the  shared  variable
              <u>varname</u> instead of the Tcl variable.

       <b>tsv::lindex</b> <u>varname</u> <u>element</u> ?index?
              Similar  to  standard  Tcl  <b>lindex</b> command but returns the value at the <u>index</u> list position of the
              <u>element</u> from the shared variable <u>varname</u> instead of the Tcl variable.

       <b>tsv::lrange</b> <u>varname</u> <u>element</u> <u>from</u> <u>to</u>
              Similar to standard Tcl <b>lrange</b> command but returns values between <u>from</u> and <u>to</u> list positions  from
              the <u>element</u> in the shared variable <u>varname</u> instead of the Tcl variable.

       <b>tsv::lsearch</b> <u>varname</u> <u>element</u> ?options? <u>pattern</u>
              Similar  to  standard  Tcl <b>lsearch</b> command but searches the <u>element</u> in the shared variable <u>varname</u>
              instead of the Tcl variable.

       <b>tsv::lset</b> <u>varname</u> <u>element</u> <u>index</u> ?index ...? <u>value</u>
              Similar to standard Tcl <b>lset</b> command but sets the <u>element</u> in the shared variable  <u>varname</u>  instead
              of the Tcl variable.

       <b>tsv::lpop</b> <u>varname</u> <u>element</u> ?index?
              Similar to the standard Tcl <b>lindex</b> command but in addition to returning, it also splices the value
              out  of  the <u>element</u> from the shared variable <u>varname</u> in one atomic operation.  In contrast to the
              Tcl <b>lindex</b> command, this command returns no value to the caller.

       <b>tsv::lpush</b> <u>varname</u> <u>element</u> ?index?
              This command performes the opposite of the <b>tsv::lpop</b> command.  As its counterpart, it  returns  no
              value to the caller.

</pre><h4><b>ARRAY</b> <b>COMMANDS</b></h4><pre>
       This  command  supports  most  of the options of the standard Tcl <b>array</b> command. In addition to those, it
       allows binding a shared variable to some persisten storage databases. Currently  the  persistent  options
       supported  are  the  famous  GNU  Gdbm  and  LMDB.  These  options have to be selected during the package
       compilation time.  The implementation provides hooks for defining other persistency layers, if needed.

       <b>tsv::array</b> <b>set</b> <u>varname</u> <u>list</u>
              Does the same as standard Tcl <b>array</b> <b>set</b>.

       <b>tsv::array</b> <b>get</b> <u>varname</u> ?pattern?
              Does the same as standard Tcl <b>array</b> <b>get</b>.

       <b>tsv::array</b> <b>names</b> <u>varname</u> ?pattern?
              Does the same as standard Tcl <b>array</b> <b>names</b>.

       <b>tsv::array</b> <b>size</b> <u>varname</u>
              Does the same as standard Tcl <b>array</b> <b>size</b>.

       <b>tsv::array</b> <b>reset</b> <u>varname</u> <u>list</u>
              Does the same as standard Tcl <b>array</b> <b>set</b> but it clears the <u>varname</u> and sets  new  values  from  the
              list atomically.

       <b>tsv::array</b> <b>bind</b> <u>varname</u> <u>handle</u>
              Binds   the   <u>varname</u>   to   the   persistent  storage  <u>handle</u>.   The  format  of  the  <u>handle</u>  is
              &lt;handler&gt;:&lt;address&gt;, where &lt;handler&gt; is "gdbm" for GNU Gdbm and "lmdb" for LMDB and  &lt;address&gt;  is
              the path to the database file.

       <b>tsv::array</b> <b>unbind</b> <u>varname</u>
              Unbinds the shared <u>array</u> from its bound persistent storage.

       <b>tsv::array</b> <b>isbound</b> <u>varname</u>
              Returns true (1) if the shared <u>varname</u> is bound to some persistent storage or zero (0) if not.

</pre><h4><b>KEYED</b> <b>LIST</b> <b>COMMANDS</b></h4><pre>
       Keyed  list commands are borrowed from the TclX package. Keyed lists provide a structured data type built
       upon standard Tcl lists. This is a functionality similar to structs in the C programming language.

       A keyed list is a list in which each element contains a key and  value  pair.  These  element  pairs  are
       stored  as lists themselves, where the key is the first element of the list, and the value is the second.
       The key-value pairs are referred to as fields.  This is an example of a keyed list:

                  {{NAME  {Frank  Zappa}} {JOB {musician and composer}}}

       Fields may contain subfields; `.' is the separator character. Subfields are actually  fields   where  the
       value  is another keyed list. Thus the following list has the top level fields ID and NAME, and subfields
       NAME.FIRST and NAME.LAST:

                  {ID 106} {NAME {{FIRST Frank} {LAST Zappa}}}

       There is no limit to the recursive depth of subfields, allowing one to  build  complex  data  structures.
       Keyed  lists  are constructed and accessed via a number of commands. All  keyed  list management commands
       take the name of the variable containing the keyed list as an argument (i.e. passed by reference), rather
       than passing the list directly.

       <b>tsv::keyldel</b> <u>varname</u> <u>keylist</u> <u>key</u>
              Delete the field specified by <u>key</u> from the keyed list <u>keylist</u>  in  the  shared  variable  <u>varname</u>.
              This removes both the key and the value from the keyed list.

       <b>tsv::keylget</b> <u>varname</u> <u>keylist</u> <u>key</u> ?retvar?
              Return  the  value associated with <u>key</u> from the keyed list <u>keylist</u> in the shared variable <u>varname</u>.
              If the optional <u>retvar</u> is not specified, then the value will be returned  as  the  result  of  the
              command. In this case, if key is not found in the list, an error will result.

              If  <u>retvar</u>  is specified and <u>key</u> is in the list, then the value is returned in the variable <u>retvar</u>
              and the command returns 1 if the key was present within the list. If <u>key</u> isn't in  the  list,  the
              command will return 0, and <u>retvar</u> will be left unchanged. If {} is specified for <u>retvar</u>, the value
              is  not  returned,  allowing  the  Tcl programmer to determine if a <u>key</u> is present in a keyed list
              without setting a variable as a side-effect.

       <b>tsv::keylkeys</b> <u>varname</u> <u>keylist</u> ?key?
              Return  the a list of the keys in the keyed list <u>keylist</u> in the shared variable <u>varname</u>. If <u>key</u> is
              specified, then it is the name of a key field who's subfield keys are to be retrieved.

       <b>tsv::keylset</b> <u>varname</u> <u>keylist</u> <u>key</u> <u>value</u> ?key value..?
              Set the value associated with <u>key</u>, in the keyed list <u>keylist</u> to <u>value</u>. If  the  <u>keylist</u>  does  not
              exists,  it  is  created.   If  <u>key</u>  is not currently in the list, it will be added. If it already
              exists, <u>value</u> replaces the existing value. Multiple keywords  and  values  may  be  specified,  if
              desired.

</pre><h4><b>DISCUSSION</b></h4><pre>
       The  current  implementation  of  thread  shared  variables allows for easy and convenient access to data
       shared between different threads.  Internally, the data is stored in Tcl objects and all package commands
       operate on internal data representation, thus minimizing shimmering and  improving  performance.  Special
       care has been taken to assure that all object data is properly locked and deep-copied when moving objects
       between threads.

       Due to the internal design of the Tcl core, there is no provision of full integration of shared variables
       within  the  Tcl  syntax,  unfortunately.  All  access to shared data must be performed with the supplied
       package commands.  Also, variable traces are not supported. But even so, benefits  of  easy,  simple  and
       safe shared data manipulation outweights imposed limitations.

</pre><h4><b>CREDITS</b></h4><pre>
       Thread  shared  variables  are  inspired  by  the nsv interface found in AOLserver, a highly scalable Web
       server from America Online.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       thread, tpool, ttrace

</pre><h4><b>KEYWORDS</b></h4><pre>
       locking, synchronization, thread shared data, threads

Tcl Threading                                          2.8                                             <u><a href="../man3tcl/tsv.3tcl.html">tsv</a></u>(3tcl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>