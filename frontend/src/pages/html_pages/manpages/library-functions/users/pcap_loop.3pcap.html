<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pcap_loop, pcap_dispatch - process packets from a live capture or savefile</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libpcap0.8-dev">libpcap0.8-dev_1.10.5-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pcap_loop, pcap_dispatch - process packets from a live capture or savefile

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;pcap/pcap.h&gt;</b>

       <b>typedef</b> <b>void</b> <b>(*pcap_handler)(u_char</b> <b>*user,</b> <b>const</b> <b>struct</b> <b>pcap_pkthdr</b> <b>*h,</b>
           <b>const</b> <b>u_char</b> <b>*bytes);</b>
       <b>int</b> <b>pcap_loop(pcap_t</b> <b>*p,</b> <b>int</b> <b>cnt,</b>
           <b>pcap_handler</b> <b>callback,</b> <b>u_char</b> <b>*user);</b>
       <b>int</b> <b>pcap_dispatch(pcap_t</b> <b>*p,</b> <b>int</b> <b>cnt,</b>
           <b>pcap_handler</b> <b>callback,</b> <b>u_char</b> <b>*user);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pcap_loop</b>()  processes  packets  from a live capture or ``savefile'' until <u>cnt</u> packets are processed, the
       end of the ``savefile'' is reached when reading from a ``savefile'', <b><a href="../man3PCAP/pcap_breakloop.3PCAP.html">pcap_breakloop</a></b>(3PCAP) is called,  or
       an  error occurs.  It does <b>not</b> return when live packet buffer timeouts occur.  A value of <b>-1</b> or <b>0</b> for <u>cnt</u>
       is equivalent to infinity, so that packets are processed until another ending condition occurs.

       <b>pcap_dispatch</b>() processes packets from a live capture or ``savefile'' until <u>cnt</u>  packets  are  processed,
       the  end  of  the  current  bufferful  of  packets  is  reached when doing a live capture, the end of the
       ``savefile'' is reached when reading from a ``savefile'', <b>pcap_breakloop</b>() is called, or an error occurs.
       Thus, when doing a live capture, <u>cnt</u> is the maximum number of packets to process before returning, but is
       not a minimum number; when reading a live capture, only one bufferful of packets is read at  a  time,  so
       fewer  than  <u>cnt</u>  packets may be processed. A value of <b>-1</b> or <b>0</b> for <u>cnt</u> causes all the packets received in
       one buffer to be processed when reading a live capture, and causes all the packets  in  the  file  to  be
       processed when reading a ``savefile''.

       Note  that,  when  doing  a live capture on some platforms, if the read timeout expires when there are no
       packets available, <b>pcap_dispatch</b>() will return 0, even when not in non-blocking mode,  as  there  are  no
       packets  to  process.   Applications  should  be  prepared  for  this  to happen, but must not rely on it
       happening.

       <u>callback</u> specifies a <b>pcap_handler</b> routine to be called with three arguments: a <b>u_char</b>  pointer  which  is
       passed  in  the  <u>user</u>  argument  to  <b>pcap_loop</b>()  or  <b>pcap_dispatch</b>(), a <b>const</b> <b>struct</b> <b>pcap_pkthdr</b> pointer
       pointing to the packet time stamp and lengths, and a <b>const</b> <b>u_char</b> pointer to the first <b>caplen</b>  (as  given
       in  the  <b>struct</b> <b>pcap_pkthdr</b>, a pointer to which is passed to the callback routine) bytes of data from the
       packet.  The <b>struct</b> <b>pcap_pkthdr</b> and the packet data are not to be freed by the callback routine, and  are
       not  guaranteed  to be valid after the callback routine returns; if the code needs them to be valid after
       the callback, it must make a copy of them.

       The bytes of data from the packet begin with a link-layer header.  The format of the link-layer header is
       indicated by the return value of the <b><a href="../man3PCAP/pcap_datalink.3PCAP.html">pcap_datalink</a></b>(3PCAP) routine  when  handed  the  <b>pcap_t</b>  value  also
       passed  to  <b>pcap_loop</b>()  or  <b>pcap_dispatch</b>().   <u>https://www.tcpdump.org/linktypes.html</u>  lists  the values
       <b>pcap_datalink</b>() can return and describes the packet formats that correspond to those values.   The  value
       it  returns  will  be valid for all packets received unless and until <b><a href="../man3PCAP/pcap_set_datalink.3PCAP.html">pcap_set_datalink</a></b>(3PCAP) is called;
       after a successful call to <b>pcap_set_datalink</b>(), all subsequent packets will have a link-layer  header  of
       the type specified by the link-layer header type value passed to <b>pcap_set_datalink</b>().

       Do  <b>NOT</b> assume that the packets for a given capture or ``savefile`` will have any given link-layer header
       type, such as <b>DLT_EN10MB</b> for Ethernet.  For example, the "any" device on Linux  will  have  a  link-layer
       header  type  of  <b>DLT_LINUX_SLL</b> or <b>DLT_LINUX_SLL2</b> even if all devices on the system at the time the "any"
       device is opened have some other data link type, such as <b>DLT_EN10MB</b> for Ethernet.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       <b>pcap_loop</b>() returns <b>0</b> if <u>cnt</u> is exhausted or if, when reading from a ``savefile'', no  more  packets  are
       available.   It  returns <b>PCAP_ERROR_BREAK</b> if the loop terminated due to a call to <b>pcap_breakloop</b>() before
       any packets were processed, <b>PCAP_ERROR_NOT_ACTIVATED</b> if called on a capture handle that has been  created
       but  not  activated,  or  <b>PCAP_ERROR</b> if another error occurs.  It does <b>not</b> return when live packet buffer
       timeouts occur; instead, it attempts to read more packets.

       <b>pcap_dispatch</b>() returns the number of packets processed on success; this can be 0 if no packets were read
       from a live capture (if, for example, they were discarded because they didn't pass the packet filter,  or
       if,  on platforms that support a packet buffer timeout that starts before any packets arrive, the timeout
       expires before any packets arrive, or if the file descriptor for the capture device  is  in  non-blocking
       mode  and no packets were available to be read) or if no more packets are available in a ``savefile.'' It
       returns <b>PCAP_ERROR_BREAK</b> if the loop terminated due to a call to <b>pcap_breakloop</b>() before any packets were
       processed, <b>PCAP_ERROR_NOT_ACTIVATED</b> if called  on  a  capture  handle  that  has  been  created  but  not
       activated,  or  <b>PCAP_ERROR</b> if another error occurs.  <b>If</b> <b>your</b> <b>application</b> <b>uses</b> <b>pcap_breakloop(),</b> <b>make</b> <b>sure</b>
       <b>that</b> <b>you</b> <b>explicitly</b> <b>check</b> <b>for</b> <b>PCAP_ERROR</b> <b>and</b> <b>PCAP_ERROR_BREAK,</b> <b>rather</b> <b>than</b> <b>just</b>  <b>checking</b>  <b>for</b>  <b>a</b>  <b>return</b>
       <b>value</b> <b>&lt;</b> <b>0.</b>

       If  <b>PCAP_ERROR</b>  is returned, <b><a href="../man3PCAP/pcap_geterr.3PCAP.html">pcap_geterr</a></b>(3PCAP) or <b><a href="../man3PCAP/pcap_perror.3PCAP.html">pcap_perror</a></b>(3PCAP) may be called with <u>p</u> as an argument
       to fetch or display the error text.

</pre><h4><b>BACKWARD</b> <b>COMPATIBILITY</b></h4><pre>
       In libpcap versions before 1.5.0, the behavior when <u>cnt</u> was <b>0</b>  was  undefined;  different  platforms  and
       devices  behaved differently, so code that must work with these versions of libpcap should use <b>-1</b>, not <b>0</b>,
       as the value of <u>cnt</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3PCAP/pcap.3PCAP.html">pcap</a></b>(3PCAP)

                                                  5 March 2022                                  <u><a href="../man3PCAP/PCAP_LOOP.3PCAP.html">PCAP_LOOP</a></u>(3PCAP)
</pre>
 </div>
</div></section>
</div>
</body>
</html>