<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zip_source_function, zip_source_function_create — create data source from function</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libzip-dev">libzip-dev_1.11.3-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       zip_source_function, zip_source_function_create — create data source from function

</pre><h4><b>LIBRARY</b></h4><pre>
       libzip (-lzip)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;zip.h&gt;</b>

       <u>zip_source_t</u> <u>*</u>
       <b>zip_source_function</b>(<u>zip_t</u> <u>*archive</u>, <u>zip_source_callback</u> <u>fn</u>, <u>void</u> <u>*userdata</u>);

       <u>zip_source_t</u> <u>*</u>
       <b>zip_source_function_create</b>(<u>zip_source_callback</u> <u>fn</u>, <u>void</u> <u>*userdata</u>, <u>zip_error_t</u> <u>*error</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  functions  <b>zip_source_function</b>() and <b>zip_source_function_create</b>() create a zip source from the user-
       provided function <u>fn</u>, which must be of the following type:

       <u>typedef</u>     <u>zip_int64_t</u>     (*<b>zip_source_callback</b>)(<u>void</u> <u>*userdata</u>,     <u>void</u> <u>*data</u>,      <u>zip_uint64_t</u> <u>len</u>,
       <u>zip_source_cmd_t</u> <u>cmd</u>)

       <u>archive</u> or <u>error</u> are used for reporting errors and can be NULL.

       When  called  by  the library, the first argument is the <u>userdata</u> argument supplied to the function.  The
       next two arguments are a buffer <u>data</u> of size <u>len</u> when data is passed in or expected to  be  returned,  or
       else NULL and 0.  The last argument, <u>cmd</u>, specifies which action the function should perform.

       Depending   on   the   uses,   there   are   three   useful  sets  of  commands  to  be  supported  by  a
       <b>zip_source_callback</b>():

       read source             Providing streamed  data  (for  file  data  added  to  archives).   Must  support
                               ZIP_SOURCE_OPEN,    ZIP_SOURCE_READ,   ZIP_SOURCE_CLOSE,   ZIP_SOURCE_STAT,   and
                               ZIP_SOURCE_ERROR.

                               If your source uses any allocated memory  (including  <u>userdata</u>)  it  should  also
                               implement ZIP_SOURCE_FREE to avoid memory leaks.

       seekable read source    Same as previous, but from a source allowing reading from arbitrary offsets (also
                               for   read-only   zip   archive).   Must  additionally  support  ZIP_SOURCE_SEEK,
                               ZIP_SOURCE_TELL, and ZIP_SOURCE_SUPPORTS.

       read/write source       Same as previous, but  additionally  allowing  writing  (also  for  writable  zip
                               archives).       Must      additionally      support      ZIP_SOURCE_BEGIN_WRITE,
                               ZIP_SOURCE_COMMIT_WRITE,    ZIP_SOURCE_ROLLBACK_WRITE,     ZIP_SOURCE_SEEK_WRITE,
                               ZIP_SOURCE_TELL_WRITE, and ZIP_SOURCE_REMOVE.

                               On  top  of  the  above, supporting the pseudo-command ZIP_SOURCE_SUPPORTS_REOPEN
                               allows calling <b>zip_source_open</b>() again after calling <b>zip_source_close</b>().

   ZIP_SOURCE_ACCEPT_EMPTY
       Return 1 if an empty source should be accepted as a valid zip archive.   This  is  the  default  if  this
       command is not supported by a source.  File system backed sources should return 0.

   ZIP_SOURCE_BEGIN_WRITE
       Prepare the source for writing.  Use this to create any temporary file(s).

   ZIP_SOURCE_BEGIN_WRITE_CLONING
       Prepare  the  source  for writing, keeping the first <u>len</u> bytes of the original file.  Only implement this
       command if it is more efficient than copying the data, and if it does  not  destructively  overwrite  the
       original file (you still have to be able to execute ZIP_SOURCE_ROLLBACK_WRITE).

       The next write should happen at byte <u>offset</u>.

   ZIP_SOURCE_CLOSE
       Reading is done.

   ZIP_SOURCE_COMMIT_WRITE
       Finish writing to the source.  Replace the original data with the newly written data.  Clean up temporary
       files  or  internal  buffers.   Subsequently  opening and reading from the source should return the newly
       written data.

   ZIP_SOURCE_ERROR
       Get error information.  <u>data</u> points to an array of two ints, which should be filled with the libzip error
       code and the corresponding system error code for the error that occurred.  See <u><a href="../man3/zip_errors.3.html">zip_errors</a></u>(3) for  details
       on  the  error  codes.  If the source stores error information in a zip_error_t, use <u><a href="../man3/zip_error_to_data.3.html">zip_error_to_data</a></u>(3)
       and return its return value.  Otherwise, return 2 * sizeof(int).

   ZIP_SOURCE_FREE
       Clean up and free all resources, including <u>userdata</u>.  The callback function will not be called again.

   ZIP_SOURCE_GET_FILE_ATTRIBUTES
       Provide information about various data.  Then the data should be put in  the  appropriate  entry  in  the
       passed <u>zip_file_attributes_t</u> argument, and the appropriate ZIP_FILE_ATTRIBUTES_* value must be or'ed into
       the  <u>valid</u>  member  to  denote  that  the  corresponding data has been provided.  A <u>zip_file_attributes_t</u>
       structure can be initialized using <u><a href="../man3/zip_file_attributes_init.3.html">zip_file_attributes_init</a></u>(3).

       ASCII mode  If a file is a plaintext file in ASCII.  Can be used by  extraction  tools  to  automatically
                   convert   line   endings  (part  of  the  internal  file  attributes).   Member  <u>ascii</u>,  flag
                   ZIP_FILE_ATTRIBUTES_ASCII.

       General Purpose Bit Flags (limited to Compression Flags)
                   The general purpose bit flag in the zip in the local and central  directory  headers  contain
                   information   about   the   compression   method.    Member   <u>general_purpose_bit_flags</u>   and
                   <u>general_purpose_bit_mask</u>    to    denote    which    members    have    been    set;     flag
                   ZIP_FILE_ATTRIBUTES_GENERAL_PURPOSE_BIT_FLAGS.

       External File Attributes
                   The    external    file    attributes    (usually    operating    system-specific).    Member
                   <u>external_file_attributes</u>, flag ZIP_FILE_ATTRIBUTES_EXTERNAL_FILE_ATTRIBUTES.

       Version Needed
                   A minimum version needed required to unpack this entry (in the usual "major  *  10  +  minor"
                   format).  Member <u>version_needed</u>, flag ZIP_FILE_ATTRIBUTES_VERSION_NEEDED.

       Operating System
                   One of the operating systems as defined by the ZIP_OPSYS_* variables (see <u>zip.h</u>).  This value
                   affects  the  interpretation  of  the  external  file  attributes.   Member <u>host_system</u>, flag
                   ZIP_FILE_ATTRIBUTES_HOST_SYSTEM.

   ZIP_SOURCE_OPEN
       Prepare for reading.

   ZIP_SOURCE_READ
       Read data into the buffer <u>data</u> of size <u>len</u>.  Return the number of bytes placed into <u>data</u> on success,  and
       zero for end-of-file.

   ZIP_SOURCE_REMOVE
       Remove the underlying file.  This is called if a zip archive is empty when closed.

   ZIP_SOURCE_ROLLBACK_WRITE
       Abort  writing  to  the  source.   Discard  written  data.  Clean up temporary files or internal buffers.
       Subsequently opening and reading from the source should return the original data.

   ZIP_SOURCE_SEEK
       Specify position to read next byte  from,  like  <u><a href="../man3/fseek.3.html">fseek</a></u>(3).   Use  <u><a href="../man3/ZIP_SOURCE_GET_ARGS.3.html">ZIP_SOURCE_GET_ARGS</a></u>(3)  to  decode  the
       arguments into the following struct:

       struct zip_source_args_seek {
           zip_int64_t offset;
           int whence;
       };

       If  the  size  of  the  source's  data  is  known,  use <u><a href="../man3/zip_source_seek_compute_offset.3.html">zip_source_seek_compute_offset</a></u>(3) to validate the
       arguments and compute the new offset.

   ZIP_SOURCE_SEEK_WRITE
       Specify position to write next byte to, like <u><a href="../man3/fseek.3.html">fseek</a></u>(3).  See ZIP_SOURCE_SEEK for details.

   ZIP_SOURCE_STAT
       Get meta information for the input data.  <u>data</u> points to an allocated <u>struct</u> <u>zip_stat</u>,  which  should  be
       initialized using <u><a href="../man3/zip_stat_init.3.html">zip_stat_init</a></u>(3) and then filled in.

       For uncompressed, unencrypted data, all information is optional.  However, fill in as much information as
       is readily available.

       If the data is compressed, ZIP_STAT_COMP_METHOD, ZIP_STAT_SIZE, and ZIP_STAT_CRC must be filled in.

       If   the   data   is  encrypted,  ZIP_STAT_ENCRYPTION_METHOD,  ZIP_STAT_COMP_METHOD,  ZIP_STAT_SIZE,  and
       ZIP_STAT_CRC must be filled in.

       Information only available after the source has been read (e.g., size) can be omitted in an earlier call.
       <u>NOTE</u>:  <b>zip_source_function</b>()  may  be  called  with  this  argument  even   after   being   called   with
       ZIP_SOURCE_CLOSE.

       Return sizeof(struct zip_stat) on success.

   ZIP_SOURCE_SUPPORTS
       Return  bitmap  specifying which commands are supported.  Use <u><a href="../man3/zip_source_make_command_bitmap.3.html">zip_source_make_command_bitmap</a></u>(3).  If this
       command is not implemented, the source is assumed to be a read source without seek support.

   ZIP_SOURCE_TELL
       Return the current read offset in the source, like <u><a href="../man3/ftell.3.html">ftell</a></u>(3).

   ZIP_SOURCE_TELL_WRITE
       Return the current write offset in the source, like <u><a href="../man3/ftell.3.html">ftell</a></u>(3).

   ZIP_SOURCE_WRITE
       Write data to the source.  Return number of bytes written.

   ZIP_SOURCE_SUPPORTS_REOPEN
       This command is  never  actually  invoked,  support  for  it  signals  the  ability  to  handle  multiple
       open/read/close cycles.

   <b>Return</b> <b>Values</b>
       Commands  should  return  -1  on  error.  ZIP_SOURCE_ERROR will be called to retrieve the error code.  On
       success, commands return 0, unless specified otherwise in the description above.

   <b>Calling</b> <b>Conventions</b>
       The library will  always  issue  ZIP_SOURCE_OPEN  before  issuing  ZIP_SOURCE_READ,  ZIP_SOURCE_SEEK,  or
       ZIP_SOURCE_TELL.   When it no longer wishes to read from this source, it will issue ZIP_SOURCE_CLOSE.  If
       the library wishes to read the data again, it will issue ZIP_SOURCE_OPEN a second time.  If the  function
       is unable to provide the data again, it should return -1.

       ZIP_SOURCE_BEGIN_WRITE   or   ZIP_SOURCE_BEGIN_WRITE_CLONING  will  be  called  before  ZIP_SOURCE_WRITE,
       ZIP_SOURCE_SEEK_WRITE,    or    ZIP_SOURCE_TELL_WRITE.     When    writing    is     complete,     either
       ZIP_SOURCE_COMMIT_WRITE or ZIP_SOURCE_ROLLBACK_WRITE will be called.

       ZIP_SOURCE_ACCEPT_EMPTY, ZIP_SOURCE_GET_FILE_ATTRIBUTES, and ZIP_SOURCE_STAT can be issued at any time.

       ZIP_SOURCE_ERROR will only be issued in response to the function returning -1.

       ZIP_SOURCE_FREE  will  be  the  last  command  issued;  if  ZIP_SOURCE_OPEN  was  called  and  succeeded,
       ZIP_SOURCE_CLOSE will be called before  ZIP_SOURCE_FREE,  and  similarly  for  ZIP_SOURCE_BEGIN_WRITE  or
       ZIP_SOURCE_BEGIN_WRITE_CLONING and ZIP_SOURCE_COMMIT_WRITE or ZIP_SOURCE_ROLLBACK_WRITE.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       Upon  successful  completion,  the created source is returned.  Otherwise, NULL is returned and the error
       code in <u>archive</u> or <u>error</u> is set to indicate the error (unless it is NULL).

</pre><h4><b>ERRORS</b></h4><pre>
       <b>zip_source_function</b>() fails if:

       [ZIP_ER_MEMORY]    Required memory could not be allocated.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man3/libzip.3.html">libzip</a></u>(3),    <u><a href="../man3/zip_file_add.3.html">zip_file_add</a></u>(3),    <u><a href="../man3/zip_file_attributes_init.3.html">zip_file_attributes_init</a></u>(3),    <u><a href="../man3/zip_file_replace.3.html">zip_file_replace</a></u>(3),     <u><a href="../man3/zip_source.3.html">zip_source</a></u>(3),
       <u><a href="../man3/zip_stat_init.3.html">zip_stat_init</a></u>(3)

</pre><h4><b>HISTORY</b></h4><pre>
       <b>zip_source_function</b>() and <b>zip_source_function_create</b>() were added in libzip 1.0.

</pre><h4><b>AUTHORS</b></h4><pre>
       Dieter Baron &lt;<u><a href="mailto:dillo@nih.at">dillo@nih.at</a></u>&gt; and Thomas Klausner &lt;<u><a href="mailto:wiz@gatalith.at">wiz@gatalith.at</a></u>&gt;

Debian                                           January 5, 2023                          <u><a href="../man3/ZIP_SOURCE_FUNCTION.3.html">ZIP_SOURCE_FUNCTION</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>