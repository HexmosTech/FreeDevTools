<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-posix-dev">manpages-posix-dev_2017a-2_all</a> <br><br><pre>
</pre><h4><b>PROLOG</b></h4><pre>
       This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface
       may differ (consult the corresponding Linux manual page for details of Linux behavior), or the  interface
       may not be implemented on Linux.

</pre><h4><b>NAME</b></h4><pre>
       getsubopt — parse suboption arguments from a string

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;

       int getsubopt(char **<u>optionp</u>, char * const *<u>keylistp</u>, char **<u>valuep</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <u>getsubopt</u>()  function  shall parse suboption arguments in a flag argument. Such options often result
       from the use of <u>getopt</u>().

       The <u>getsubopt</u>() argument <u>optionp</u> is a pointer to a pointer to the option argument string.  The  suboption
       arguments  shall  be  separated by &lt;comma&gt; characters and each may consist of either a single token, or a
       token-value pair separated by an &lt;equals-sign&gt;.

       The <u>keylistp</u> argument shall be a pointer to a vector of strings. The end of the vector is identified by a
       null pointer. Each entry in the vector is one of the possible tokens that might  be  found  in  *<u>optionp</u>.
       Since  &lt;comma&gt;  characters  delimit  suboption arguments in <u>optionp</u>, they should not appear in any of the
       strings pointed to by <u>keylistp</u>.  Similarly, because an &lt;equals-sign&gt; separates a token  from  its  value,
       the  application  should  not include an &lt;equals-sign&gt; in any of the strings pointed to by <u>keylistp</u>.  The
       <u>getsubopt</u>() function shall not modify the <u>keylistp</u> vector.

       The <u>valuep</u> argument is the address of a value string pointer.

       If a &lt;comma&gt; appears in <u>optionp</u>, it  shall  be  interpreted  as  a  suboption  separator.  After  &lt;comma&gt;
       characters  have been processed, if there are one or more &lt;equals-sign&gt; characters in a suboption string,
       the first &lt;equals-sign&gt; in any suboption string shall be interpreted as a separator between a token and a
       value. Subsequent &lt;equals-sign&gt; characters in a suboption string shall be  interpreted  as  part  of  the
       value.

       If  the  string  at  *<u>optionp</u> contains only one suboption argument (equivalently, no &lt;comma&gt; characters),
       <u>getsubopt</u>() shall update *<u>optionp</u> to point to the null character at the end of the string. Otherwise,  it
       shall  isolate the suboption argument by replacing the &lt;comma&gt; separator with a null character, and shall
       update *<u>optionp</u> to point to the start of the next suboption argument. If the suboption  argument  has  an
       associated  value (equivalently, contains an &lt;equals-sign&gt;), <u>getsubopt</u>() shall update *<u>valuep</u> to point to
       the value's first character.  Otherwise, it shall set *<u>valuep</u> to a null pointer. The calling  application
       may  use this information to determine whether the presence or absence of a value for the suboption is an
       error.

       Additionally, when <u>getsubopt</u>() fails to match the suboption argument with a token in the <u>keylistp</u>  array,
       the  calling  application  should  decide  if  this  is an error, or if the unrecognized option should be
       processed in another way.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       The <u>getsubopt</u>() function shall return the index of the matched token string, or -1 if  no  token  strings
       were matched.

</pre><h4><b>ERRORS</b></h4><pre>
       No errors are defined.

       <u>The</u> <u>following</u> <u>sections</u> <u>are</u> <u>informative.</u>

</pre><h4><b>EXAMPLES</b></h4><pre>
   <b>Parsing</b> <b>Suboptions</b>
       The  following  example  uses  the  <u>getsubopt</u>() function to parse a <u>value</u> argument in the <u>optarg</u> external
       variable returned by a call to <u>getopt</u>().

           #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
           #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
           #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;

           int do_all;
           const char *type;
           int read_size;
           int write_size;
           int read_only;

           enum
           {
               RO_OPTION = 0,
               RW_OPTION,
               READ_SIZE_OPTION,
               WRITE_SIZE_OPTION
           };

           const char *mount_opts[] =
           {
               [RO_OPTION] = "ro",
               [RW_OPTION] = "rw",
               [READ_SIZE_OPTION] = "rsize",
               [WRITE_SIZE_OPTION] = "wsize",
               NULL
           };

           int
           main(int argc, char *argv[])
           {
               char *subopts, *value;
               int opt;

               while ((opt = getopt(argc, argv, "at:o:")) != -1)
                   switch(opt)
                       {
                       case 'a':
                           do_all = 1;
                           break;
                       case 't':
                           type = optarg;
                           break;
                       case 'o':
                           subopts = optarg;
                           while (*subopts != ' ')
                           {
                               char *saved = subopts;
                               switch(getsubopt(&amp;subopts, (char **)mount_opts,
                                   &amp;value))
                               {
                               case RO_OPTION:
                                   read_only = 1;
                                   break;
                               case RW_OPTION:
                                   read_only = 0;
                                   break;
                               case READ_SIZE_OPTION:
                                   if (value == NULL)
                                       abort();
                                   read_size = atoi(value);
                                   break;
                               case WRITE_SIZE_OPTION:
                                   if (value == NULL)
                                       abort();
                                   write_size = atoi(value);
                                   break;
                               default:
                                   /* Unknown suboption. */
                                   printf("Unknown suboption `%s'\n", saved);
                                   abort();
                               }
                           }
                           break;
                       default:
                           abort();
                       }

               /* Do the real work. */

               return 0;
           }

       If the above example is invoked with:

           program -o ro,rsize=512

       then after option parsing, the variable <u>do_all</u> will be 0, <u>type</u> will be a null pointer, <u>read_size</u> will  be
       512, <u>write_size</u> will be 0, and <u>read_only</u> will be 1. If it is invoked with:

           program -o oops

       it will print:

           "Unknown suboption `oops'"

       before aborting.

</pre><h4><b>APPLICATION</b> <b>USAGE</b></h4><pre>
       The  value  of  *<u>valuep</u>  when  <u>getsubopt</u>()  returns -1 is unspecified. Historical implementations provide
       various incompatible extensions to allow an application to access the suboption text that was  not  found
       in the <u>keylistp</u> array.

</pre><h4><b>RATIONALE</b></h4><pre>
       The  <u>keylistp</u>  argument  of <u>getsubopt</u>() is typed as <b>char</b> <b>*</b> <b>const</b> <b>*</b> to match historical practice. However,
       the standard is clear that implementations will not modify either the array or the strings  contained  in
       the array, as if the argument had been typed <b>const</b> <b>char</b> <b>*</b> <b>const</b> <b>*</b>.

</pre><h4><b>FUTURE</b> <b>DIRECTIONS</b></h4><pre>
       None.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>getopt</u>()

       The Base Definitions volume of POSIX.1‐2017, <b>&lt;stdlib.h&gt;</b>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1-2017, Standard
       for  Information  Technology  --  Portable  Operating  System  Interface  (POSIX),  The  Open  Group Base
       Specifications Issue 7, 2018 Edition, Copyright (C) 2018 by the Institute of Electrical  and  Electronics
       Engineers, Inc and The Open Group.  In the event of any discrepancy between this version and the original
       IEEE  and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document.
       The original Standard can be obtained online at <a href="http://www.opengroup.org/unix/online.html">http://www.opengroup.org/unix/online.html</a> .

       Any typographical or formatting errors that appear in this page are most likely to have  been  introduced
       during   the   conversion  of  the  source  files  to  man  page  format.  To  report  such  errors,  see
       https://www.kernel.org/doc/man-pages/reporting_bugs.html .

IEEE/The Open Group                                   2017                                     <u><a href="../man3POSIX/GETSUBOPT.3POSIX.html">GETSUBOPT</a></u>(3POSIX)
</pre>
 </div>
</div></section>
</div>
</body>
</html>