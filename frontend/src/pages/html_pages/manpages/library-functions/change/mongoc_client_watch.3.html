<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mongoc_change_stream_t*</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmongoc-doc">libmongoc-doc_1.30.4-1ubuntu1_all</a> <br><br><pre>
</pre><h4><b>SYNOPSIS</b></h4><pre>
          mongoc_change_stream_t*
          mongoc_client_watch (mongoc_client_t *client,
                               const bson_t *pipeline,
                               const bson_t *opts);

       A  helper  function  to  create  a  change stream. It is preferred to call this function over using a raw
       aggregation to create a change stream.

       This function uses the read preference and read concern of the client. If  the  change  stream  needs  to
       re-establish  connection,  the  same  read  preference will be used. This may happen if the change stream
       encounters a resumable error.

       <b>WARNING:</b>
          A change stream is only supported with majority read concern.

       This function is considered a retryable read operation.  Upon a transient error (a network error,  errors
       due  to  replica set failover, etc.) the operation is safely retried once.  If <b>retryreads</b> is false in the
       URI (see <u>mongoc_uri_t</u>) the retry behavior does not apply.

</pre><h4><b>PARAMETERS</b></h4><pre>
       • <b>db</b>: A <u>mongoc_client_t</u> specifying the client which the change stream listens to.

       • <b>pipeline</b>: A <u>bson_t</u> representing an aggregation pipeline appended to the change stream. This may  be  an
         empty document.

       • <b>opts</b>: A <u>bson_t</u> containing change stream options.

       <b>opts</b> may be NULL or a BSON document with additional command options:

       • <b>batchSize</b>:  An  <b>int32</b>  representing  number  of  documents  requested  to  be  returned on each call to
         <u>mongoc_change_stream_next()</u>

       • <b>resumeAfter</b>: A <b>Document</b> representing the logical starting point of the change  stream.  The  result  of
         <u>mongoc_change_stream_get_resume_token()</u>  or  the <b>_id</b> field  of any change received from a change stream
         can be used here. This option is mutually exclusive with <b>startAfter</b> and <b>startAtOperationTime</b>.

       • <b>startAfter</b>:  A  <b>Document</b>  representing  the  logical  starting  point  of  the  change  stream.  Unlike
         <b>resumeAfter</b>,   this   can   resume   notifications   after   an   "invalidate"  event.  The  result  of
         <u>mongoc_change_stream_get_resume_token()</u> or the <b>_id</b> field  of any change received from a  change  stream
         can be used here.  This option is mutually exclusive with <b>resumeAfter</b> and <b>startAtOperationTime</b>.

       • <b>startAtOperationTime</b>:  A  <b>Timestamp</b>.  The change stream only provides changes that occurred at or after
         the specified timestamp. Any command run against the server will return an operation time that  can  be
         used here. This option is mutually exclusive with <b>resumeAfter</b> and <b>startAfter</b>.

       • <b>maxAwaitTimeMS</b>:  An <b>int64</b> representing the maximum amount of time a call to <u>mongoc_change_stream_next()</u>
         will block waiting for data

       • <b>fullDocument</b>: An optional UTF-8 string. Set this option to "default", "updateLookup",  "whenAvailable",
         or  "required",  If unset, The string "default" is assumed. Set this option to "updateLookup" to direct
         the change stream cursor to  lookup  the  most  current  majority-committed  version  of  the  document
         associated to an update change stream event.

       • <b>fullDocumentBeforeChange</b>:  An optional UTF-8 string. Set this option to "whenAvailable", "required", or
         "off". When unset, the default value is "off". Similar to "fullDocument", but returns the value of  the
         document before the associated change.

       • <b>showExpandedEvents</b>:  Set  to <b>true</b> to return an expanded list of change stream events. Available only on
         MongoDB versions &gt;=6.0

       • <b>comment</b>: A <u>bson_value_t</u> specifying the comment to attach to this command. The comment  will  appear  in
         log  messages, profiler output, and currentOp output. Only string values are supported prior to MongoDB
         4.4.

</pre><h4><b>RETURNS</b></h4><pre>
       A newly allocated <u>mongoc_change_stream_t</u> which must be freed with <u>mongoc_change_stream_destroy()</u> when  no
       longer  in  use.  The  returned  <u>mongoc_change_stream_t</u>  is  never  <b>NULL</b>. If there is an error, it can be
       retrieved with <u>mongoc_change_stream_error_document()</u>, and subsequent calls to <u>mongoc_change_stream_next()</u>
       will return <b>false</b>.

       <b>SEE</b> <b>ALSO:</b>
          <u>mongoc_database_watch()</u>

          <u>mongoc_collection_watch()</u>

</pre><h4><b>AUTHOR</b></h4><pre>
       MongoDB, Inc

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2009-present, MongoDB, Inc.

1.30.4                                            Jun 08, 2025                            <u><a href="../man3/MONGOC_CLIENT_WATCH.3.html">MONGOC_CLIENT_WATCH</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>