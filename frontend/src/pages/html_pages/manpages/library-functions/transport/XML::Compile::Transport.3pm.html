<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XML::Compile::Transport - base class for XML transporters</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libxml-compile-soap-perl">libxml-compile-soap-perl_3.28+ds-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       XML::Compile::Transport - base class for XML transporters

</pre><h4><b>INHERITANCE</b></h4><pre>
        XML::Compile::Transport
          is a XML::Compile::SOAP::Extension

        XML::Compile::Transport is extended by
          XML::Compile::Transport::SOAPHTTP
          XML::Compile::Transport::SOAPHTTP_AnyEvent

</pre><h4><b>SYNOPSIS</b></h4><pre>
        use XML::Compile::Transport::SOAPHTTP;
        my $trans  = XML::Compile::Transport::SOAPHTTP-&gt;new(...);
        my $call   = $trans-&gt;compileClient(...);

        my ($xmlout, $trace) = $call-&gt;($xmlin);
        my $xmlout = $call-&gt;($xmlin);   # when no trace needed

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This module defines the exchange of (XML) messages. The module does not known how to parse or compose
       XML, but only worries about the transport aspects.

       On the moment, there are three transporter implementations:

       XML::Compile::Transport::SOAPHTTP
           implements  an synchronous message exchange; the library waits for an answer before it returns to the
           user application. The information is exchanged using HTTP with SOAP encapsulation (SOAP also  defines
           a transport protocol over HTTP without encapsulation)

       XML::Compile::Transport::SOAPHTTP_AnyEvent
           Event-driven  implementation,  based  on AnyEvent.  The user provides a callback to handle responses.
           Many queries can be spawned in parallel, in a single process.  Find this in a separate distribution.

       XML::Compile::Transport::SOAPHTTP_MojoUA
           Event-driven implementation,  which fits in the Mojolicious infrastructure.  Find this in a  separate
           distribution.

       Extends "DESCRIPTION" in XML::Compile::SOAP::Extension.

</pre><h4><b>METHODS</b></h4><pre>
       Extends "METHODS" in XML::Compile::SOAP::Extension.

   <b>Constructors</b>
       Extends "Constructors" in XML::Compile::SOAP::Extension.

       XML::Compile::Transport-&gt;<b>new</b>(%options)
            -Option --Default
             address  '<a href="http://localhost">http://localhost</a>'
             charset  'UTF-8'

           address =&gt; URI|ARRAY-of-URI
             One or more URI which represents the servers.

           charset =&gt; STRING

   <b>WSDL11</b>
       Extends "WSDL11" in XML::Compile::SOAP::Extension.

       $obj-&gt;<b>wsdl11Init</b>($wsdl, $args)
       XML::Compile::Transport-&gt;<b>wsdl11Init</b>($wsdl, $args)
           Inherited, see "WSDL11" in XML::Compile::SOAP::Extension

   <b>SOAP11</b>
       Extends "SOAP11" in XML::Compile::SOAP::Extension.

       $obj-&gt;<b>soap11ClientWrapper</b>($operation, $call, $args)
           Inherited, see "SOAP11" in XML::Compile::SOAP::Extension

       $obj-&gt;<b>soap11HandlerWrapper</b>($operation, $callback, $args)
           Inherited, see "SOAP11" in XML::Compile::SOAP::Extension

       $obj-&gt;<b>soap11OperationInit</b>($operation, $args)
       XML::Compile::Transport-&gt;<b>soap11OperationInit</b>($operation, $args)
           Inherited, see "SOAP11" in XML::Compile::SOAP::Extension

   <b>SOAP12</b>
       Extends "SOAP12" in XML::Compile::SOAP::Extension.

       $obj-&gt;<b>soap12ClientWrapper</b>($operation, $call, $args)
           Inherited, see "SOAP12" in XML::Compile::SOAP::Extension

       $obj-&gt;<b>soap12HandlerWrapper</b>($operation, $callback, $args)
           Inherited, see "SOAP12" in XML::Compile::SOAP::Extension

       $obj-&gt;<b>soap12OperationInit</b>($operation, $args)
       XML::Compile::Transport-&gt;<b>soap12OperationInit</b>($operation, $args)
           Inherited, see "SOAP12" in XML::Compile::SOAP::Extension

   <b>Accessors</b>
       $obj-&gt;<b>address</b>()
           Get a server address to contact. If multiple addresses were specified, than one is chosen at random.

       $obj-&gt;<b>addresses</b>()
           Returns a list of all server contact addresses (URIs)

       $obj-&gt;<b>charset</b>()
           Returns the charset to be used when sending,

   <b>Handlers</b>
       $obj-&gt;<b>compileClient</b>(%options)
           Compile  a client handler.  Returned is a subroutine which is called with a text represenation of the
           XML request, or an XML::LibXML tree.  In SCALAR context, an XML::LibXML parsed  tree  of  the  answer
           message  is  returned.   In  LIST  context,  that  answer  is followed by a HASH which contains trace
           information.

            -Option    --Default
             hook        &lt;undef&gt;
             kind        'request-response'
             xml_format  0

           hook =&gt; CODE
             See section "Use of the transport hook".  When defined, the  hook  will  be  called,  in  stead  of
             transmitting   the   message.   The  hook  will  gets  three  parameters  passed  in:  the  textual
             representation of the XML message to be transmitted, the trace HASH with all  values  collected  so
             far,  and  the  transporter  object.   The  trace  HASH  will  have  a massive amount of additional
             information added as well.

             You may add information to the trace.  You have to return  a  textual  representation  of  the  XML
             answer, or "undef" to indicate that the message was totally unacceptable.

           kind =&gt; STRING
             Kind of communication, as defined by WSDL.

           xml_format =&gt; 0|1|2
             [2.26] See XML::LibXML::Document subroutine toString.  With '1', you will get beautified output.

</pre><h4><b>DETAILS</b></h4><pre>
   <b>Use</b> <b>of</b> <b>the</b> <b>transport</b> <b>hook</b>
       A  <u>transport</u> <u>hook</u> can be used to follow the process of creating a message to its furthest extend: it will
       be called with the data as used by the actual protocol, but will not connect to the internet.  Within the
       transport hook routine, you have to simulate the remote server's activities.

       There are two reasons to use a hook:

       .   You want to fake a server, to produce a test environment.

       .   You may need to modify the request or  answer  messages  outside  the  reach  of  XML::Compile::SOAP,
           because something is wrong in either your WSDL of XML::Compile message processing.

       <u>XML</u> <u>and</u> <u>Header</u> <u>Modifications</u>

       Some  servers  require  special  extensions,  which do not follow any standard (or logic). But even those
       features can be tricked, although it requires quite some programming skills.

       The "transport_hook" routine is called with a $trace hash, one of whose entries is  the  UserAgent  which
       was set up for the data transfer. You can modify the outgoing message XML body and headers, carry out the
       data  exchange  using the UserAgent, and then examine the returned Response for content and headers using
       methods similar to the following:

        sub transport_hook($$$)
        {   my ($request, $trace, $transporter) = @_;
            my $content = $request-&gt;content;

            # ... modify content if you need
            my $new_content = encode "UTF-8", $anything;
            $request-&gt;content($new_content);
            $request-&gt;header(Content_Length =&gt; length $new_content);
            $request-&gt;header(Content_Type =&gt; 'text/plain; charset=UTF-8');

            # ... update the headers
            $request-&gt;header(Name =&gt; "value");

            # sent the request myself
            my $ua = $trace-&gt;{user_agent};
            my $response = $ua-&gt;request($request);

            # ... check the response headers
            my $name = $response-&gt;header('Name');

            # ... use the response content
            my $received = $response-&gt;decoded_content || $response-&gt;content;

            $response;
        }

       You should be aware that if  you  change  the  size  or  length  of  the  content  you  MUST  update  the
       "Content-Length" header value, as demonstrated above.

       <u>Transport</u> <u>hook</u> <u>for</u> <u>debugging</u>

       The transport hook is a perfect means for producing automated tests.  Also, the XML::Compile::SOAP module
       tests use it extensively.  It works like this (for the SOAPHTTP simluation):

        use Test::More;

        sub fake_server($$)
        {  my ($request, $trace) = @_;
           my $content = $request-&gt;decoded_content;
           is($content, &lt;&lt;__EXPECTED_CONTENT);
       &lt;SOAP-ENV:Envelope&gt;...&lt;/SOAP-ENV:Envelope&gt;
       __EXPECTED_CONTENT

           HTTP::Response-&gt;new(200, 'Constant'
             , [ 'Content-Type' =&gt; 'text/xml' ]
             , &lt;&lt;__ANSWER
       &lt;SOAP-ENV:Envelope&gt;...&lt;/SOAP-ENV:Envelope&gt;
       __ANSWER
        }

       Then, the fake server is initiated in one of the follow ways:

         my $transport = XML::Compile::Transport::SOAPHTTP-&gt;new(...);
         my $http = $transport-&gt;compileClient(hook =&gt; \&amp;fake_server, ...);
         $wsdl-&gt;compileClient('GetLastTracePrice', transporter =&gt; $http);

       or

         my $soap = XML::Compile::SOAP11::Client-&gt;new(...);
         my $call = $soap-&gt;compileClient(encode =&gt; ..., decode =&gt; ...,
             transport_hook =&gt; \&amp;fake_server);

       or

         my $wsdl = XML::Compile::WSDL11-&gt;new(...);
         $wsdl-&gt;compileClient('GetLastTracePrice',
             transport_hook =&gt; \&amp;fake_server);

       <u>Transport</u> <u>hook</u> <u>for</u> <u>basic</u> <u>authentication</u>

       [Adapted  from  an  example  contributed  by  Kieron  Johnson]  This  example  shows a transport_hook for
       <b>compileClient()</b> to add to http headers for the basic http authentication.  The parameter can also be used
       for <b>compileAll()</b> and many other related functions.

         my $call = $wsdl-&gt;compileClient($operation
            , transport_hook =&gt; \&amp;basic_auth );

         # HTTP basic authentication encodes the username and password with
         # Base64. The encoded source string has format: "username:password"
         # With the below HTTP header being required:
         #        "Authorization: Basic [encoded password]"

         use MIME::Base64 'encode_base64';

         my $user     = 'myuserid' ;
         my $password = 'mypassword';

         sub basic_auth($$)
         {   my ($request, $trace) = @_;

             # Encode userid and password
             my $authorization = 'Basic '. encode_base64 "$user:$password";

             # Modify http header to include basic authorisation
             $request-&gt;header(Authorization =&gt; $authorization );

             my $ua = $trace-&gt;{user_agent};
             $ua-&gt;request($request);
         }

</pre><h4><b>Helpers</b></h4><pre>
       XML::Compile::Transport-&gt;<b>register</b>($uri)
           Declare an transporter type.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       This module is part of XML-Compile-SOAP distribution version 3.28, built on  August  01,  2022.  Website:
       <u><a href="http://perl.overmeer.net/CPAN/">http://perl.overmeer.net/CPAN/</a></u>

</pre><h4><b>LICENSE</b></h4><pre>
       Copyrights 2007-2022 by [Mark Overmeer &lt;<a href="mailto:markov@cpan.org">markov@cpan.org</a>&gt;]. For other contributors see ChangeLog.

       This  program  is  free  software;  you can redistribute it and/or modify it under the same terms as Perl
       itself.  See <u><a href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></u>

perl v5.34.0                                       2022-08-04                       <u>XML::Compile::<a href="../man3pm/Transport.3pm.html">Transport</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>