<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-posix-dev">manpages-posix-dev_2017a-2_all</a> <br><br><pre>
</pre><h4><b>PROLOG</b></h4><pre>
       This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface
       may differ (consult the corresponding Linux manual page for details of Linux behavior), or the  interface
       may not be implemented on Linux.

</pre><h4><b>NAME</b></h4><pre>
       fdopendir, opendir — open directory associated with file descriptor

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;<a href="file:/usr/include/dirent.h">dirent.h</a>&gt;

       DIR *fdopendir(int <u>fd</u>);
       DIR *opendir(const char *<u>dirname</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <u>fdopendir</u>()  function  shall  be  equivalent  to the <u>opendir</u>() function except that the directory is
       specified by a file descriptor rather than by a name. The file offset associated with the file descriptor
       at the time of the call determines which entries are returned.

       Upon successful return from <u>fdopendir</u>(), the file descriptor is under the control of the system,  and  if
       any  attempt  is made to close the file descriptor, or to modify the state of the associated description,
       other than by means of <u>closedir</u>(), <u>readdir</u>(), <u>readdir_r</u>(), <u>rewinddir</u>(), or  <u>seekdir</u>(),  the  behavior  is
       undefined. Upon calling <u>closedir</u>() the file descriptor shall be closed.

       It  is unspecified whether the FD_CLOEXEC flag will be set on the file descriptor by a successful call to
       <u>fdopendir</u>().

       The <u>opendir</u>() function shall open a directory stream corresponding to the directory named by the  <u>dirname</u>
       argument.  The  directory stream is positioned at the first entry. If the type <b>DIR</b> is implemented using a
       file descriptor, applications shall only be  able  to  open  up  to  a  total  of  {OPEN_MAX}  files  and
       directories.

       If  the  type  <b>DIR</b>  is  implemented  using  a file descriptor, the descriptor shall be obtained as if the
       O_DIRECTORY flag was passed to <u>open</u>().

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       Upon successful completion, these functions shall return a pointer to an object of type <b>DIR</b>.   Otherwise,
       these functions shall return a null pointer and set <u>errno</u> to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       The <u>fdopendir</u>() function shall fail if:

       <b>EBADF</b>  The <u>fd</u> argument is not a valid file descriptor open for reading.

       <b>ENOTDIR</b>
              The descriptor <u>fd</u> is not associated with a directory.

       The <u>opendir</u>() function shall fail if:

       <b>EACCES</b> Search  permission is denied for the component of the path prefix of <u>dirname</u> or read permission is
              denied for <u>dirname</u>.

       <b>ELOOP</b>  A loop exists in symbolic links encountered during resolution of the <u>dirname</u> argument.

       <b>ENAMETOOLONG</b>
              The length of a component of a pathname is longer than {NAME_MAX}.

       <b>ENOENT</b> A component of <u>dirname</u> does not name an existing directory or <u>dirname</u> is an empty string.

       <b>ENOTDIR</b>
              A component of <u>dirname</u> names an existing file that is neither a directory nor a symbolic link to a
              directory.

       The <u>opendir</u>() function may fail if:

       <b>ELOOP</b>  More than {SYMLOOP_MAX} symbolic links were encountered during resolution of the <u>dirname</u> argument.

       <b>EMFILE</b> All file descriptors available to the process are currently open.

       <b>ENAMETOOLONG</b>
              The length of a pathname exceeds {PATH_MAX}, or pathname resolution of a symbolic link produced an
              intermediate result with a length that exceeds {PATH_MAX}.

       <b>ENFILE</b> Too many files are currently open in the system.

       <u>The</u> <u>following</u> <u>sections</u> <u>are</u> <u>informative.</u>

</pre><h4><b>EXAMPLES</b></h4><pre>
   <b>Open</b> <b>a</b> <b>Directory</b> <b>Stream</b>
       The following program fragment demonstrates how the <u>opendir</u>() function is used.

           #include &lt;<a href="file:/usr/include/dirent.h">dirent.h</a>&gt;
           ...
               DIR *dir;
               struct dirent *dp;
           ...
               if ((dir = opendir (".")) == NULL) {
                   perror ("Cannot open .");
                   exit (1);
               }

               while ((dp = readdir (dir)) != NULL) {
           ...

   <b>Find</b> <b>And</b> <b>Open</b> <b>a</b> <b>File</b>
       The following program searches through a given directory looking for files whose name does not begin with
       a dot and whose size is larger than 1 MiB.

           #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
           #include &lt;<a href="file:/usr/include/dirent.h">dirent.h</a>&gt;
           #include &lt;<a href="file:/usr/include/fcntl.h">fcntl.h</a>&gt;
           #include &lt;sys/stat.h&gt;
           #include &lt;<a href="file:/usr/include/stdint.h">stdint.h</a>&gt;
           #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
           #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;

           int
           main(int argc, char *argv[])
           {
               struct stat statbuf;
               DIR *d;
               struct dirent *dp;
               int dfd, ffd;

               if ((d = fdopendir((dfd = open(".<a href="file:/tmp">/tmp</a>", O_RDONLY)))) == NULL) {
                   fprintf(stderr, "Cannot open .<a href="file:/tmp">/tmp</a> directory\n");
                   <a href="../man1/exit.1.html">exit</a>(1);
               }
               while ((dp = readdir(d)) != NULL) {
                   if (dp-&gt;d_name[0] == '.')
                       continue;
                   /* there is a possible race condition here as the file
                    * could be renamed between the readdir and the open */
                   if ((ffd = openat(dfd, dp-&gt;d_name, O_RDONLY)) == -1) {
                       perror(dp-&gt;d_name);
                       continue;
                   }
                   if (fstat(ffd, &amp;statbuf) == 0 &amp;&amp; statbuf.st_size &gt; (1024*1024)) {
                       /* found it ... */
                       printf("%s: %jdK\n", dp-&gt;d_name,
                           (intmax_t)(statbuf.st_size / 1024));
                   }
                   close(ffd);
               }
               closedir(d); // note this implicitly closes dfd
               return 0;
           }

</pre><h4><b>APPLICATION</b> <b>USAGE</b></h4><pre>
       The <u>opendir</u>() function should be used in conjunction  with  <u>readdir</u>(),  <u>closedir</u>(),  and  <u>rewinddir</u>()  to
       examine  the  contents  of  the  directory  (see  the  EXAMPLES  section  in  <u>readdir</u>()).  This method is
       recommended for portability.

</pre><h4><b>RATIONALE</b></h4><pre>
       The purpose of the <u>fdopendir</u>() function is to enable opening files in directories other than the  current
       working directory without exposure to race conditions. Any part of the path of a file could be changed in
       parallel to a call to <u>opendir</u>(), resulting in unspecified behavior.

       Based on historical implementations, the rules about file descriptors apply to directory streams as well.
       However, this volume of POSIX.1‐2017 does not mandate that the directory stream be implemented using file
       descriptors.  The description of <u>closedir</u>() clarifies that if a file descriptor is used for the directory
       stream, it is mandatory that <u>closedir</u>() deallocate the file descriptor. When a file descriptor is used to
       implement the directory stream, it behaves as if the FD_CLOEXEC had been set for the file descriptor.

       The directory entries for dot and dot-dot are optional. This volume of POSIX.1‐2017 does  not  provide  a
       way  to test <u>a</u> <u>priori</u> for their existence because an application that is portable must be written to look
       for (and usually ignore) those entries. Writing code that presumes that they are the  first  two  entries
       does  not always work, as many implementations permit them to be other than the first two entries, with a
       ``normal'' entry preceding them. There is negligible value in providing  a  way  to  determine  what  the
       implementation does because the code to deal with dot and dot-dot must be written in any case and because
       such  a  flag  would  add to the list of those flags (which has proven in itself to be objectionable) and
       might be abused.

       Since the structure and  buffer  allocation,  if  any,  for  directory  operations  are  defined  by  the
       implementation,  this  volume  of  POSIX.1‐2017 imposes no portability requirements for erroneous program
       constructs, erroneous data, or the use of unspecified values such as the use or  referencing  of  a  <u>dirp</u>
       value  or  a  <b>dirent</b> structure value after a directory stream has been closed or after a <u>fork</u>() or one of
       the <u>exec</u> function calls.

</pre><h4><b>FUTURE</b> <b>DIRECTIONS</b></h4><pre>
       None.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>closedir</u>(), <u>dirfd</u>(), <u>fstatat</u>(), <u>open</u>(), <u>readdir</u>(), <u>rewinddir</u>(), <u>symlink</u>()

       The Base Definitions volume of POSIX.1‐2017, <b>&lt;dirent.h&gt;</b>, <b>&lt;sys_types.h&gt;</b>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1-2017, Standard
       for Information  Technology  --  Portable  Operating  System  Interface  (POSIX),  The  Open  Group  Base
       Specifications  Issue  7, 2018 Edition, Copyright (C) 2018 by the Institute of Electrical and Electronics
       Engineers, Inc and The Open Group.  In the event of any discrepancy between this version and the original
       IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee  document.
       The original Standard can be obtained online at <a href="http://www.opengroup.org/unix/online.html">http://www.opengroup.org/unix/online.html</a> .

       Any  typographical  or formatting errors that appear in this page are most likely to have been introduced
       during  the  conversion  of  the  source  files  to  man  page  format.  To  report  such   errors,   see
       https://www.kernel.org/doc/man-pages/reporting_bugs.html .

IEEE/The Open Group                                   2017                                     <u><a href="../man3POSIX/FDOPENDIR.3POSIX.html">FDOPENDIR</a></u>(3POSIX)
</pre>
 </div>
</div></section>
</div>
</body>
</html>