<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lc_channel_nack_handler,  lc_channel_nack_handler_thr, lc_channel_nack_add_log - outgoing message logging</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/liblibrecast-dev">liblibrecast-dev_0.9.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       lc_channel_nack_handler,  lc_channel_nack_handler_thr, lc_channel_nack_add_log - outgoing message logging
       to handle NACK and replay requests

</pre><h4><b>LIBRARY</b></h4><pre>
       Librecast library (<u>liblibrecast</u>, <u>-llibrecast</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;librecast/net.h&gt;</b>

       <b>int</b> <b>lc_channel_nack_handler(lc_channel_t</b> <b>*chan,</b> <b>int</b> <b>n_seconds);</b>
       <b>int</b> <b>lc_channel_nack_handler_thr(lc_channel_t</b> <b>*chan,</b> <b>int</b> <b>n_seconds,</b> <b>void</b> <b>*(*nack_thread)(void</b> <b>*));</b>
       <b>int</b> <b>lc_channel_nack_add_log(lc_channel_t</b> <b>*chan,</b> <b>const</b> <b>void</b> <b>*buf,</b> <b>size_t</b> <b>len,</b> <b>lc_seq_t</b> <b>seq);</b>

       Compile and link with <u>-llibrecast</u>.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>lc_channel_nack_handler</b>() sets up a per-channel buffer to keep a  copy  of  outgoing  messages  sent  via
       <b>lc_msg_send</b>()  and also starts a new thread (called "nack thread") to handle any retransmission requests;
       the outgoing messages are kept for at least <u>n_seconds</u> seconds if there is sufficient free  memory  to  do
       so.  The  nack  thread  listens  for messages on a related channel, interprets them as NACK messages, and
       arranges for retransmission of the corresponding messages. The normal case is that  these  NACK  messages
       are  generated  as  a  result  of  calling  <b>lc_channel_detect_gaps</b>()  on  the  receiver  side.  A call to
       <b><a href="../man3/lc_channel_free.3.html">lc_channel_free</a></b>(3) will stop the nack thread if it's running.

       <b>lc_channel_nack_handler_thr</b>()  is  similar  to  <b>lc_channel_nack_handler</b>()  except  that  it  specifies  a
       different  function  to use for the nack thread; it will be called in a new thread with an opened channel
       and socket where it can receive NACK messages,  and  another  channel  it  can  use  to  resend  packets;
       currently,  there is no alternative thread to use, and this function is only used by the library's tests;
       however a different nack thread could be provided in future for example to deal with the special case  of
       messages sent from static data, which can be resent without storing recent messages in a memory buffer.

       <b>lc_channel_nack_add_log</b>()  adds  a  message  to  the  internal  memory  buffer,  making  it available for
       retransmission as a result of a NACK; it is not normally necessary to call this function if all  messages
       are  sent  using  <b>lc_msg_send</b>()  however an application which defines its own message format will need to
       call <b>lc_channel_nack_add_log</b>() with a copy of each message as it  goes  on  the  wire,  as  well  as  the
       sequence number it contains, as the library will have no way to find this information in the applicatin's
       own   message   format.   The   application   needs   to   call  <b>lc_channel_nack_handler</b>()  before  using
       <b>lc_channel_nack_add_log</b>() otherwise the call will not log anything:  this  could  be  useful  if  message
       logging   and   NACK   request   handling   is  optional,  so  the  application  can  conditionally  call
       <b>lc_channel_nack_handler</b>() during initialisation, but then unconditionally call  <b>lc_channel_nack_add_log</b>()
       for each message it sends.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       <b>lc_channel_nack_handler</b>()  and  <b>lc_channel_nack_handler_thr</b>()  return 0 on success, and -1 to indicate an
       error, setting the global variable <u>errno</u> to an appropriate code, most  likely  <b>ENOMEM</b>  to  indicate  that
       there was insufficient memory to set up the required data structures.

       The  <b>lc_channel_nack_add_log</b>()  function returns 0 on success and -1 to indicate that there was no memory
       to store the message in its internal buffers, setting <u>errno</u> to the value <b>ENOMEM</b>

</pre><h4><b>ERRORS</b></h4><pre>
       <b>lc_channel_nack_handler</b>() and <b>lc_channel_nack_handler_thr</b>() can fail with any of the errors the  <b>malloc</b>()
       library  function  can  produce,  as  well  as  any  errors  produces  by  the  <b>lc_channel_sidehash</b>()  or
       <b>lc_socket_new</b>() functions.

       <b>lc_channel_nack_add_log</b>() can fail with any of the errors the <b>malloc</b>() library function can produce.

</pre><h4><b>EXAMPLE</b></h4><pre>
   <b>Program</b> <b>source</b>

       lc_ctx_t *lctx;
       lc_channel_t *chan;
       lctx = lc_ctx_new();
       chan = lc_channel_new(lctx, "channel name");
       if (lc_channel_nack_handler(chan, 10) == -1) {
            /* handle this error */
       }

       /* your program goes here, likely calling lc_msg_send(chan, ...) */

       lc_channel_free(chan);
       lc_ctx_free(lctx);

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/lc_channel_detect_gaps.3.html">lc_channel_detect_gaps</a></b>(3), <b><a href="../man3/lc_channel_free.3.html">lc_channel_free</a></b>(3), <b><a href="../man3/lc_msg_send.3.html">lc_msg_send</a></b>(3)

LIBRECAST                                          2022-10-29                         <u><a href="../man3/LC_CHANNEL_NACK_HANDLER.3.html">LC_CHANNEL_NACK_HANDLER</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>