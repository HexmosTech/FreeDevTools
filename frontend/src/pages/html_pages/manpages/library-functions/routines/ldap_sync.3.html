<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ldap_sync_init,  ldap_sync_init_refresh_only,  ldap_sync_init_refresh_and_persist,  ldap_sync_poll - LDAP</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libldap-dev">libldap-dev_2.6.10+dfsg-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ldap_sync_init,  ldap_sync_init_refresh_only,  ldap_sync_init_refresh_and_persist,  ldap_sync_poll - LDAP
       sync routines

</pre><h4><b>LIBRARY</b></h4><pre>
       OpenLDAP LDAP (libldap, -lldap)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;ldap.h&gt;</b>

       <b>int</b> <b>ldap_sync_init(ldap_sync_t</b> <b>*</b><u>ls</u><b>,</b> <b>int</b> <u>mode</u><b>);</b>

       <b>int</b> <b>ldap_sync_init_refresh_only(ldap_sync_t</b> <b>*</b><u>ls</u><b>);</b>

       <b>int</b> <b>ldap_sync_init_refresh_and_persist(ldap_sync_t</b> <b>*</b><u>ls</u><b>);</b>

       <b>int</b> <b>ldap_sync_poll(ldap_sync_t</b> <b>*</b><u>ls</u><b>);</b>

       <b>ldap_sync_t</b> <b>*</b> <b>ldap_sync_initialize(ldap_sync_t</b> <b>*</b><u>ls</u><b>);</b>

       <b>void</b> <b>ldap_sync_destroy(ldap_sync_t</b> <b>*</b><u>ls</u><b>,</b> <b>int</b> <u>freeit</u><b>);</b>

       <b>typedef</b> <b>int</b> <b>(*</b><u>ldap_sync_search_entry_f</u><b>)(ldap_sync_t</b> <b>*</b><u>ls</u><b>,</b>
              <b>LDAPMessage</b> <b>*</b><u>msg</u><b>,</b> <b>struct</b> <b>berval</b> <b>*</b><u>entryUUID</u><b>,</b>
              <b>ldap_sync_refresh_t</b> <u>phase</u><b>);</b>

       <b>typedef</b> <b>int</b> <b>(*</b><u>ldap_sync_search_reference_f</u><b>)(ldap_sync_t</b> <b>*</b><u>ls</u><b>,</b>
              <b>LDAPMessage</b> <b>*</b><u>msg</u><b>);</b>

       <b>typedef</b> <b>int</b> <b>(*</b><u>ldap_sync_intermediate_f</u><b>)(ldap_sync_t</b> <b>*</b><u>ls</u><b>,</b>
              <b>LDAPMessage</b> <b>*</b><u>msg</u><b>,</b> <b>BerVarray</b> <u>syncUUIDs</u><b>,</b>
              <b>ldap_sync_refresh_t</b> <u>phase</u><b>);</b>

       <b>typedef</b> <b>int</b> <b>(*</b><u>ldap_sync_search_result_f</u><b>)(ldap_sync_t</b> <b>*</b><u>ls</u><b>,</b>
              <b>LDAPMessage</b> <b>*</b><u>msg</u><b>,</b> <b>int</b> <u>refreshDeletes</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       These routines provide an interface to the LDAP  Content  Synchronization  operation  (RFC  4533).   They
       require  an  <b>ldap_sync_t</b>  structure  to  be  set  up  with  parameters required for various phases of the
       operation; this includes setting some handlers for special events.  All handlers take a  pointer  to  the
       <b>ldap_sync_t</b>  structure as the first argument, and a pointer to the <b>LDAPMessage</b> structure as received from
       the server by the client library, plus, occasionally, other specific arguments.

       The members of the <b>ldap_sync_t</b> structure are:

       <b>char</b> <b>*</b><u>ls_base</u>
              The search base; by default, the <b>BASE</b> option in <b><a href="../man5/ldap.conf.5.html">ldap.conf</a></b>(5).

       <b>int</b> <u>ls_scope</u>
              The  search  scope  (one  of  <b>LDAP_SCOPE_BASE</b>,  <b>LDAP_SCOPE_ONELEVEL</b>,   <b>LDAP_SCOPE_SUBORDINATE</b>   or
              <b>LDAP_SCOPE_SUBTREE</b>; see <b>ldap.h</b> for details).

       <b>char</b> <b>*</b><u>ls_filter</u>
              The filter (RFC 4515); by default, <b>(objectClass=*)</b>.

       <b>char</b> <b>**</b><u>ls_attrs</u>
              The requested attributes; by default <b>NULL</b>, indicating all user attributes.

       <b>int</b> <u>ls_timelimit</u>
              The requested time limit (in seconds); by default <b>0</b>, to indicate no limit.

       <b>int</b> <u>ls_sizelimit</u>
              The requested size limit (in entries); by default <b>0</b>, to indicate no limit.

       <b>int</b> <u>ls_timeout</u>
              The  desired  timeout  during polling with <b><a href="../man3/ldap_sync_poll.3.html">ldap_sync_poll</a></b>(3).  A value of <b>-1</b> means that polling is
              blocking, so <b><a href="../man3/ldap_sync_poll.3.html">ldap_sync_poll</a></b>(3) will not return until a message is received; a  value  of  <b>0</b>  means
              that  polling returns immediately, no matter if any response is available or not; a positive value
              represents the timeout the <b><a href="../man3/ldap_sync_poll.3.html">ldap_sync_poll</a></b>(3) function will wait  for  response  before  returning,
              unless  a  message  is received; in that case, <b><a href="../man3/ldap_sync_poll.3.html">ldap_sync_poll</a></b>(3) returns as soon as the message is
              available.

       <b>ldap_sync_search_entry_f</b> <u>ls_search_entry</u>
              A function that is called whenever an entry is returned.  The <b>msg</b> argument is the <b>LDAPMessage</b> that
              contains the searchResultEntry; it can be parsed using  the  regular  client  API  routines,  like
              <b><a href="../man3/ldap_get_dn.3.html">ldap_get_dn</a></b>(3), <b><a href="../man3/ldap_first_attribute.3.html">ldap_first_attribute</a></b>(3), and so on.  The <b>entryUUID</b> argument contains the entryUUID
              of  the entry.  The <b>phase</b> argument indicates the type of operation: one of <b>LDAP_SYNC_CAPI_PRESENT</b>,
              <b>LDAP_SYNC_CAPI_ADD</b>,     <b>LDAP_SYNC_CAPI_MODIFY</b>,     <b>LDAP_SYNC_CAPI_DELETE</b>;     in      case      of
              <b>LDAP_SYNC_CAPI_PRESENT</b>  or  <b>LDAP_SYNC_CAPI_DELETE</b>, only the DN is contained in the <u>LDAPMessage</u>; in
              case of  <b>LDAP_SYNC_CAPI_MODIFY</b>,  the  whole  entry  is  contained  in  the  <u>LDAPMessage</u>,  and  the
              application  is  responsible  of  determining  the  differences  between the new view of the entry
              provided by the caller and the data already known.

       <b>ldap_sync_search_reference_f</b> <u>ls_search_reference</u>
              A function that is called whenever a search reference  is  returned.   The  <b>msg</b>  argument  is  the
              <b>LDAPMessage</b> that contains the searchResultReference; it can be parsed using the regular client API
              routines, like <b><a href="../man3/ldap_parse_reference.3.html">ldap_parse_reference</a></b>(3).

       <b>ldap_sync_intermediate_f</b> <u>ls_intermediate</u>
              A  function  that  is  called  whenever  something relevant occurs during the refresh phase of the
              search, which is marked by  an  <u>intermediateResponse</u>  message  type.   The  <b>msg</b>  argument  is  the
              <b>LDAPMessage</b> that contains the intermediate response; it can be parsed using the regular client API
              routines,  like  <b><a href="../man3/ldap_parse_intermediate.3.html">ldap_parse_intermediate</a></b>(3).  The <b>syncUUIDs</b> argument contains an array of UUIDs of
              the entries that depends on the value of the <b>phase</b> argument.  In case of  <b>LDAP_SYNC_CAPI_PRESENTS</b>,
              the  "present"  phase  is  being  entered;  this means that the following sequence of results will
              consist in entries in "present" sync state.  In  case  of  <b>LDAP_SYNC_CAPI_DELETES</b>,  the  "deletes"
              phase  is being entered; this means that the following sequence of results will consist in entries
              in "delete" sync state.  In case of <b>LDAP_SYNC_CAPI_PRESENTS_IDSET</b>, the message contains a  set  of
              UUIDs   of   entries   that   are   present;   it   replaces  a  "presents"  phase.   In  case  of
              <b>LDAP_SYNC_CAPI_DELETES_IDSET</b>, the message contains a set  of  UUIDs  of  entries  that  have  been
              deleted;  it  replaces a "deletes" phase.  In case of <b>LDAP_SYNC_CAPI_DONE,</b> a "presents" phase with
              "refreshDone"  set  to  "TRUE"  has  been  returned  to  indicate  that  the  refresh   phase   of
              refreshAndPersist   is   over,   and   the   client   should   start   polling.   Except  for  the
              <b>LDAP_SYNC_CAPI_PRESENTS_IDSET</b> and <b>LDAP_SYNC_CAPI_DELETES_IDSET</b> cases, <b>syncUUIDs</b> is NULL.

       <b>ldap_sync_search_result_f</b> <u>ls_search_result</u>
              A function that is called whenever a searchResultDone is returned.  In refreshAndPersist this  can
              only  occur  when the server decides that the search must be interrupted.  The <b>msg</b> argument is the
              <b>LDAPMessage</b> that contains the response; it can be parsed using the regular  client  API  routines,
              like  <b><a href="../man3/ldap_parse_result.3.html">ldap_parse_result</a></b>(3).   The  <b>refreshDeletes</b> argument is not relevant in this case; it should
              always be -1.

       <b>void</b> <b>*</b><u>ls_private</u>
              A pointer to private data.  The client may register here a pointer to data the handlers above  may
              need.

       <b>LDAP</b> <b>*</b><u>ls_ld</u>
              A  pointer to a LDAP structure that is used to connect to the server.  It is the responsibility of
              the client to initialize the structure and to provide appropriate authentication and  security  in
              place.

</pre><h4><b>GENERAL</b> <b>USE</b></h4><pre>
       A  <b>ldap_sync_t</b>  structure  is initialized by calling <b><a href="../man3/ldap_sync_initialize.3.html">ldap_sync_initialize</a>(3).</b>  This simply clears out the
       contents of an already existing <b>ldap_sync_t</b> structure, and sets  appropriate  values  for  some  members.
       After that, the caller is responsible for setting up the connection (member <b>ls_ld</b>), eventually setting up
       transport  security  (TLS),  for binding and any other initialization.  The caller must also fill all the
       documented search-related fields of the <b>ldap_sync_t</b> structure.

       At the end of a session, the structure can be cleaned up by  calling  <b><a href="../man3/ldap_sync_destroy.3.html">ldap_sync_destroy</a></b>(3),  which  takes
       care  of  freeing  all  data  assuming  it was allocated by <b>ldap_mem*</b>(3) routines.  Otherwise, the caller
       should take  care  of  destroying  and  zeroing  out  the  documented  search-related  fields,  and  call
       <b><a href="../man3/ldap_sync_destroy.3.html">ldap_sync_destroy</a></b>(3) to free undocumented members set by the API.

</pre><h4><b>REFRESH</b> <b>ONLY</b></h4><pre>
       The  <b>refreshOnly</b>  functionality  is  obtained  by periodically calling <b><a href="../man3/ldap_sync_init.3.html">ldap_sync_init</a></b>(3) with mode set to
       <b>LDAP_SYNC_REFRESH_ONLY</b>, or, which is equivalent, by directly calling <b><a href="../man3/ldap_sync_init_refresh_only.3.html">ldap_sync_init_refresh_only</a></b>(3).  The
       state of the search, and the consistency of the search parameters, is preserved across calls  by  passing
       the <b>ldap_sync_t</b> structure as left by the previous call.

</pre><h4><b>REFRESH</b> <b>AND</b> <b>PERSIST</b></h4><pre>
       The   <b>refreshAndPersist</b>  functionality  is  obtained  by  calling  <b><a href="../man3/ldap_sync_init.3.html">ldap_sync_init</a></b>(3)  with  mode  set  to
       <b>LDAP_SYNC_REFRESH_AND_PERSIST</b>,     or,     which     is     equivalent,     by      directly      calling
       <b><a href="../man3/ldap_sync_init_refresh_and_persist.3.html">ldap_sync_init_refresh_and_persist</a></b>(3)  and,  after  a  successful  return,  by  repeatedly  polling  with
       <b><a href="../man3/ldap_sync_poll.3.html">ldap_sync_poll</a></b>(3) according to the desired pattern.

       A client may insert a call to <b><a href="../man3/ldap_sync_poll.3.html">ldap_sync_poll</a></b>(3) into an external loop to check if  any  modification  was
       returned;  in  this case, it might be appropriate to set <b>ls_timeout</b> to 0, or to set it to a finite, small
       value.  Otherwise, if the client's main purpose consists in waiting for responses, a  timeout  of  -1  is
       most suitable, so that the function only returns after some data has been received and handled.

</pre><h4><b>ERRORS</b></h4><pre>
       All routines return any LDAP error resulting from a lower-level error in the API calls they are based on,
       or  LDAP_SUCCESS  in  case of success.  <b><a href="../man3/ldap_sync_poll.3.html">ldap_sync_poll</a></b>(3) may return <b>LDAP_SYNC_REFRESH_REQUIRED</b> if a full
       refresh is requested by the server.  In this case, it is appropriate  to  call  <b><a href="../man3/ldap_sync_init.3.html">ldap_sync_init</a></b>(3)  again,
       passing the same <b>ldap_sync_t</b> structure as resulted from any previous call.

</pre><h4><b>NOTES</b></h4><pre>
</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/ldap.3.html">ldap</a></b>(3), <b><a href="../man3/ldap_search_ext.3.html">ldap_search_ext</a></b>(3), <b><a href="../man3/ldap_result.3.html">ldap_result</a></b>(3)<b>;</b> <b>RFC</b> <b>4533</b> (<a href="http://www.rfc-editor.org">http://www.rfc-editor.org</a>),

</pre><h4><b>AUTHOR</b></h4><pre>
       Designed  and implemented by Pierangelo Masarati, based on RFC 4533 and loosely inspired by syncrepl code
       in <b><a href="../man8/slapd.8.html">slapd</a></b>(8).

</pre><h4><b>ACKNOWLEDGEMENTS</b></h4><pre>
       Initially developed by <b>SysNet</b> <b>s.n.c.</b>  <b>OpenLDAP</b> is  developed  and  maintained  by  The  OpenLDAP  Project
       (<a href="http://www.openldap.org/">http://www.openldap.org/</a>).  <b>OpenLDAP</b> is derived from University of Michigan LDAP 3.3 Release.

OpenLDAP 2.6.10+dfsg-1ubuntu1                      2025/05/22                                       <u><a href="../man3/LDAP_SYNC.3.html">LDAP_SYNC</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>