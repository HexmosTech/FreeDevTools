<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qpsmtpd::Transaction - single SMTP session transaction data</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/qpsmtpd">qpsmtpd_0.94-8_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Qpsmtpd::Transaction - single SMTP session transaction data

</pre><h4><b>SYNOPSIS</b></h4><pre>
         foreach my $recip ($transaction-&gt;recipients) {
           print "T", $recip-&gt;address, "\0";
         }

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Qpsmtpd::Transaction maintains a single SMTP session's data, including the envelope details and the mail
       header and body.

       The docs below cover using the $transaction object from within plugins rather than constructing a
       "Qpsmtpd::Transaction" object, because the latter is done for you by qpsmtpd.

</pre><h4><b>API</b></h4><pre>
   <b>add_recipient($recipient)</b>
       This adds a new recipient (as in RCPT TO) to the envelope of the mail.

       The $recipient is a "Qpsmtpd::Address" object. See Qpsmtpd::Address for more details.

   <b>remove_recipient($recipient)</b>
       This removes a recipient (as in RCPT TO) from the envelope of the mail.

       The $recipient is a "Qpsmtpd::Address" object. See Qpsmtpd::Address for more details.

   <b>recipients(</b> <b>)</b>
       This returns a list of the current recipients in the envelope.

       Each recipient returned is a "Qpsmtpd::Address" object.

       This method is also a setter. Pass in a list of recipients to change the recipient list to an entirely
       new list. Note that the recipients you pass in <b>MUST</b> be "Qpsmtpd::Address" objects.

   <b>sender(</b> <b>[</b> <b>ADDRESS</b> <b>]</b> <b>)</b>
       Get or set the sender (MAIL FROM) address in the envelope.

       The sender is a "Qpsmtpd::Address" object.

   <b>header(</b> <b>[</b> <b>HEADER</b> <b>]</b> <b>)</b>
       Get or set the header of the email.

       The header is a &lt;Mail::Header&gt; object, which gives you access to all the individual headers using a
       simple API. e.g.:

         my $headers = $transaction-&gt;header();
         my $msgid = $headers-&gt;get('Message-Id');
         my $subject = $headers-&gt;get('Subject');

   <b>notes(</b> <b>$key</b> <b>[,</b> <b>$value</b> <b>]</b> <b>)</b>
       Get or set a note on the transaction. This is a piece of data that you wish to attach to the transaction
       and read somewhere else. For example you can use this to pass data between plugins.

       Note though that these notes will be lost when a transaction ends, for example on a "RSET" or after
       "DATA" completes, so you might want to use the notes field in the "Qpsmtpd::Connection" object instead.

   <b>body_filename</b> <b>(</b> <b>)</b>
       Returns the temporary filename used to store the message contents; useful for virus scanners so that an
       additional copy doesn't need to be made.

       Calling body_filename() also forces spooling to disk. A message is not spooled to disk if it's size is
       smaller than <u>$self-&gt;config("size_threshold")</u>, default threshold is 0, the sample config file sets this to
       10000.

   <b>body_write(</b> <b>$data</b> <b>)</b>
       Write data to the end of the email.

       $data can be either a plain scalar, or a reference to a scalar.

   <b>body_size(</b> <b>)</b>
       <b>Deprecated</b>, Use <u><b>data_size()</b></u> instead.

   <b>data_size(</b> <b>)</b>
       Get the current size of the email. Note that this is not the size of the message that will be queued, it
       is the size of what the client sent after the "DATA" command. If you need the size that will be queued,
       use

        my $msg_len = length($transaction-&gt;header-&gt;as_string)
          + $transaction-&gt;body_length;

       The line above is of course only valid in <u>hook_queue(</u> <u>)</u>, as other plugins may add headers and qpsmtpd
       will add it's <u>Received:</u> header.

   <b>body_length(</b> <b>)</b>
       Get the current length of the body of the email. This length includes the empty line between the headers
       and the body. Until the client has sent some data of the body of the message (i.e. headers are finished
       and client sent the empty line) this will return 0.

   <b>body_resetpos(</b> <b>)</b>
       Resets the body filehandle to the start of the file (via seek()).

       Use this function before every time you wish to process the entire body of the email to ensure that some
       other plugin has not moved the file pointer.

   <b>body_getline(</b> <b>)</b>
       Returns a single line of data from the body of the email.

   <b>body_fh(</b> <b>)</b>
       Returns the file handle to the temporary file of the email. This will return undef if the file is not
       opened (yet). In <u>hook_data(</u> <u>)</u> or later you can force spooling to disk by calling
       <u>$transaction-&gt;body_filename</u>.

   <b>dup_body_fh(</b> <b>)</b>
       Returns a <b>dup()</b>'d file handle to the temporary file of the email. This can be useful if an external
       module may call <b>close()</b> on the filehandle that is passed to it.  This should only be used for reads, as
       writing to a dup'd filehandle may have unintended consequences.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Mail::Header, Qpsmtpd::Address, Qpsmtpd::Connection

perl v5.40.1                                       2025-03-21                          <u>Qpsmtpd::<a href="../man3pm/Transaction.3pm.html">Transaction</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>