<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cap_iab_init,   cap_iab_dup,   cap_iab_get_proc,   cap_iab_get_pid,   cap_iab_set_proc,  cap_iab_to_text,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcap-dev">libcap-dev_2.75-7ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       cap_iab_init,   cap_iab_dup,   cap_iab_get_proc,   cap_iab_get_pid,   cap_iab_set_proc,  cap_iab_to_text,
       cap_iab_from_text, cap_iab_get_vector, cap_iab_compare, cap_iab_set_vector, cap_iab_fill, cap_proc_root -
       inheritable IAB tuple support functions

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;sys/capability.h&gt;

       cap_iab_t cap_iab_init(void);
       cap_iab_t cap_iab_dup(cap_iab_t iab);
       cap_iab_t cap_iab_get_proc(void);
       cap_iab_t cap_iab_get_pid(pid_t pid);
       int cap_iab_set_proc(cap_iab_t iab);
       char *cap_iab_to_text(cap_iab_t iab);
       cap_iab_t cap_iab_from_text(const char *text);
       cap_flag_value_t cap_iab_get_vector(cap_iab_t iab, cap_iab_vector_t vec,
           cap_value_t val);
       int cap_iab_compare(cap_iab_t a, cap_iab_t b);
       int cap_iab_set_vector(cap_iab_t iab, cap_iab_vector_t vec, cap_value_t val,
           cap_flag_value_t enable);
       int cap_iab_fill(cap_iab_t iab, cap_iab_vector_t vec,
           cap_t set, cap_flag_t flag);
       char *cap_proc_root(const char *root);

       Link with <u>-lcap</u>.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The functions defined in this man page concern the three naively inheritable process capability  vectors:
       Inh,  Amb  and  Bound. This <u>IAB</u> 3-tuple of capability vectors, captured in type <u>cap_iab_t</u> combine to pass
       capabilities from one process to another through <b><a href="../man2/execve.2.html">execve</a></b>(2) system calls. The convolution rules using  the
       IAB tuple are a fail over set of rules when the executed file has no configured <u>file-capabilities</u>.

       There  are  some  constraints enforced by the kernel with respect to the three components of an IAB tuple
       and the Permitted process capability flag. They are: the Inh vector (<b>CAP_IAB_INH</b>) is  entirely  equal  to
       the  process  Inheritable  flag  at  all  times; the Amb vector (<b>CAP_IAB_AMB</b>) contains no more capability
       values than the intersection of the Inh vector and the Permitted flag for the process; and the Bound  (or
       <u>blocked</u>) vector (<b>CAP_IAB_BOUND</b>) is the twos-complement of the process bounding vector.

       In  some  environments,  it  is  considered  desirable  to  <u>naively</u>  inherit  capabilities.  That is pass
       capabilities, independent of the status of the executed binary, from parent to child through <b>exec*</b> system
       calls. The surviving capabilities become the Permitted flag for the post-exec  process.  This  method  of
       inheritance  differs significantly from the handshake inheritance between a pre-exec* process and a file-
       capability bestowed executable of the traditional (POSIX.1e) capability mechanism.

       The convolution rules for IAB style inheritance are: I'=I; A'=A&amp;I; P'=A&amp;I&amp;P. Where P etc are the pre-exec
       values and P' etc are the post-exec values.

       With an understanding of these convolution rules, we can explain how <b><a href="../man3/libcap.3.html">libcap</a></b>(3) support for the IAB  tuple
       is managed: the IAB API.

       <b>cap_iab_init</b>()  returns  an  empty  IAB  value.  That  is  a <u>mostly-harmless</u> tuple. It will not block any
       Permitted file capabilities through exec, but it won't bestow any either. The returned  <u>cap_iab_t</u>  should
       be freed with <b><a href="../man3/cap_free.3.html">cap_free</a></b>(3).

       <b>cap_iab_dup</b>()  returns  a  copy  of the specified IAB value.  The returned cap_iab_t should be freed with
       <b><a href="../man3/cap_free.3.html">cap_free</a></b>(3).

       <b>cap_iab_get_proc</b>() returns a copy of the IAB value for  the  current  process.   The  returned  cap_iab_t
       should be freed with <b><a href="../man3/cap_free.3.html">cap_free</a></b>(3).

       <b>cap_iab_get_pid</b>()  returns  a  copy  of  the IAB value for the specified process.  The returned cap_iab_t
       should be freed with <b><a href="../man3/cap_free.3.html">cap_free</a></b>(3).  This function defaults to searching  <b><a href="file:/proc/">/proc/</a></b>&lt;PID&gt;<b>/status</b>  for  the  IAB
       information, but that location can be overridden using the <b>cap_proc_root</b>() function.

       <b>cap_iab_set_proc</b>()  can  be used to set the IAB value carried by the current process. Such a setting will
       fail if the process is insufficiently capable. To raise I bits not present in the P flag, or newly  apply
       B  masking, requires <b>CAP_SETPCAP</b> is present in the Permitted flag (the function will temporarily raise it
       in the Effective flag if needed). In all cases, raised A values must be present in  the  intersection  of
       Permitted and Inh values.

       <b>cap_iab_to_text</b>()  will  convert  an  IAB tuple to a canonical text representation. The representation is
       slightly redundant but libcap will try to generate as short a representation as it is able.

       <b>cap_iab_from_text</b>() generates an IAB  tuple  from  a  text  string  (likely  generated  by  the  previous
       function). The returned IAB tuple should be freed with <b><a href="../man3/cap_free.3.html">cap_free</a></b>(3).

       The  text  format  accepted  by  <b>cap_iab_from_text</b>() is a comma separated list of capability values. Each
       capability is prefixed by nothing (or %)  (Inh);  !  (Bound,  but  think  Blocked);  ^  (Amb).  Or,  some
       combination  thereof.   Since  the  Amb  vector is constrained to be no greater than the Inh vector, ^ is
       equivalent to %^. Further, unless B is  non-zero,  %  can  be  omitted.  The  following  are  legal  text
       representations:    "!%cap_chown"    (Bound   but   Inh),   "!cap_chown,^cap_chown"   (Bound,   Inh+Amb).
       "cap_setuid,!cap_chown" (Inh, Bound). As noted above, this text representation  is  the  syntax  for  the
       <u>pam_cap.so</u> config file.

       <b>cap_iab_get_vector</b>() can be used to determine the specific capability value of an IAB vector.

       <b>cap_iab_compare</b>()  can  be  used  to compare two cap_iab_t tuples. When the return value is non-zero, the
       macro <b>CAP_IAB_DIFFERS</b>(<u>status</u>, <u>vector</u>) evaluates to non-zero if the returned status differs in its  <u>vector</u>
       components.

       <b>cap_iab_set_vector</b>() can be used to set a specific vector value to the enable setting.

       <b>cap_iab_fill</b>()  can  be  used  to wholesale copy a <u>cap_t</u> flag value into the vec vector of the IAB tuple.
       Copying into Amb (<b>CAP_IAB_AMB</b>) in this way may implicitly raise  Inh  (<b>CAP_IAB_INH</b>)  values  in  the  IAB
       tuple.  Similarly copying into the Inh vector may implicitly lower Amb values that are not present in the
       resulting Inh vector.

       <b>cap_proc_root</b>() can be used to determine the current location  queried  by  <b>cap_iab_get_pid</b>().   Returned
       values should be released with <b><a href="../man3/cap_free.3.html">cap_free</a></b>(3).  If the argument to <b>cap_proc_root</b>() is not <b>NULL</b>, a copy of it
       will become the replacement for <b><a href="file:/proc">/proc</a></b>.  Note, this function is <u>not</u> thread safe with respect to concurrent
       calls to <b>cap_iab_get_pid</b>().

</pre><h4><b>ERRORS</b></h4><pre>
       The  functions  returning  <u>cap_iab_t</u>  values  or  allocated memory in the form of a string return NULL on
       error.

       Integer return values are -1 on error and 0 on success.

       In the case of error consult <u>errno</u>.

</pre><h4><b>NOTES</b></h4><pre>
       Unlike the traditional <u>cap_t</u> capability  set,  the  IAB  tuple,  taken  together,  is  incompatible  with
       filesystem  capabilities  created  via tools like <b><a href="../man8/setcap.8.html">setcap</a></b>(8).  That is, the Amb vector of the IAB tuple is
       rendered moot when an executable with a file capability is executed.

       Further, there are libcap <b><a href="../man3/cap_mode.3.html">cap_mode</a></b>(3)s that render the Amb vector and its method of  process  inheritance
       disabled.

</pre><h4><b>HISTORY</b></h4><pre>
       The  IAB  format for inheritable variants of capabilities was first developed as the configuration syntax
       for the <u>pam_cap.so</u> Linux-PAM module in  libcap-2.29.  It  was  introduced  to  extend  the  <u>simple</u>  comma
       separated  list  of  process  Inheritable  capabilities,  that the module could besow on an authenticated
       process tree, to include enforced limits on the Bounding vector and introduce support  for  the  Amibient
       vector of capability bits.

       While  the  Inheritable  and  Bounding  vectors  were  anticipated  by the POSIX.1e draft that introduced
       capabilities, the Ambient vector is a Linux invention, and incompatible with the POSIX.1e file capability
       model. As such, it was felt that trying to meld together all of the 5 capability vectors  into  one  text
       representation  was  not going to work. Instead the <u>pam_cap.so</u> config syntax was generalized into a whole
       set of libcap functions for bundling together all three naively inheritable capabilities: the IAB  tuple.
       The support for this debuted in libcap-2.33.

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Please report bugs via:

       https://bugzilla.kernel.org/buglist.cgi?component=libcap&amp;list_id=1090757

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/libcap.3.html">libcap</a></b>(3), <b><a href="../man3/cap_launch.3.html">cap_launch</a></b>(3), <b><a href="../man3/cap_init.3.html">cap_init</a></b>(3), <b><a href="../man7/capabilities.7.html">capabilities</a></b>(7) and <b><a href="../man3/errno.3.html">errno</a></b>(3).

                                                   2022-10-16                                         <u><a href="../man3/CAP_IAB.3.html">CAP_IAB</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>