<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheSchwartz::Job - jobs for the reliable job queue</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtheschwartz-perl">libtheschwartz-perl_1.12-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       TheSchwartz::Job - jobs for the reliable job queue

</pre><h4><b>SYNOPSIS</b></h4><pre>
           my $client = TheSchwartz-&gt;new( databases =&gt; $DATABASE_INFO );

           my $job = TheSchwartz::Job-&gt;new_from_array('MyWorker', [ foo =&gt; 'bar' ]);
           $client-&gt;insert($job);

           $job = TheSchwartz::Job-&gt;new(
               funcname =&gt; 'MyWorker',
               uniqkey  =&gt; 7,
               arg      =&gt; [ foo =&gt; 'bar' ],
           );
           $client-&gt;insert($job);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       "TheSchwartz::Job" models the jobs that are posted to the job queue by your application, then grabbed and
       performed by your worker processes.

       "TheSchwartz::Job" is a "Data::ObjectDriver" model class. See Data::ObjectDriver::BaseObject.

</pre><h4><b>FIELDS</b></h4><pre>
       "TheSchwartz::Job" objects have these possible fields:

   <b>"jobid"</b>
       The unique numeric identifier for this job. Set automatically when saved.

   <b>"funcid"</b>
       The numeric identifier for the type of job to perform. "TheSchwartz" clients map function names (also
       known as abilities and worker class names) to these numbers using "TheSchwartz::FuncMap" records.

   <b>"arg"</b>
       Arbitrary state data to supply to the worker process for this job. If specified as a reference, the data
       is frozen to a blob with the "Storable" module.

   <b>"uniqkey"</b>
       An arbitrary string identifier used to prevent applications from posting duplicate jobs. At most one with
       the same "uniqkey" value can be posted to a single "TheSchwartz" database.

   <b>"insert_time"</b>
       The "insert_time" field is not used.

   <b>"run_after"</b>
       The UNIX system time after which the job can next be attempted by a worker process. This time stamp is
       set when a job is first created or is released after a failure.

   <b>"grabbed_until"</b>
       The UNIX system time after which the job can next be available by a worker process. This time stamp is
       set when a job is grabbed by a worker process, and reset to 0 when is released due to failure to complete
       the job.

   <b>"priority"</b>
       An integer value to specify the priority of the job to be executed; larger numbers mean higher priority.
       See "prioritize" property of TheSchwartz for details.

   <b>"coalesce"</b>
       A string used to discover jobs that can be efficiently pipe-lined with a given job due to some shared
       resource. For example, for email delivery jobs, the domain of an email address could be used as the
       "coalesce" value. A worker process could then deliver all the mail queued for a given mail host after
       connecting to it once.

</pre><h4><b>USAGE</b></h4><pre>
   <b>"TheSchwartz::Job-&gt;new(</b> <b>%args</b> <b>)"</b>
       Returns a new job object with the given data. Members of %args can be keyed on any of the fields
       described above, or "funcname".

   <b>"TheSchwartz::Job-&gt;new_from_array(</b> <b>$funcname,</b> <b>$arg</b> <b>)"</b>
       Returns a new job with the given function name (also called <u>ability</u> or <u>worker</u> <u>class</u>), and the scalar or
       reference $arg for an argument.

   <b>"$job-&gt;funcname([</b> <b>$funcname</b> <b>])"</b>
       Returns the function name for the given job, after setting it to $funcname, if specified.

   <b>"$job-&gt;handle([</b> <b>$handle</b> <b>])"</b>
       Returns the "TheSchwartz::JobHandle" object describing this job, after setting it to $handle, if
       specified. A <u>job</u> <u>handle</u> is a convenience class for accessing other records related to jobs; as its
       convenience methods are also available directly from "TheSchwartz::Job" instances, you will usually not
       need to work directly with job handles.

   <b>"$job-&gt;driver()"</b>
       Returns the "Data::ObjectDriver" object driver for accessing the database in which $job is stored. See
       Data::ObjectDriver.

   <b>"$job-&gt;add_failure(</b> <b>$msg</b> <b>)"</b>
       Records and returns a new "TheSchwartz::Error" object representing a failure to perform $job, for reason
       $msg.

   <b>"$job-&gt;exit_status()"</b>
       Returns the <u>exit</u> <u>status</u> specified by the worker that either completed the job or declared it failed
       permanently. The exit status for a job will be available for a period of time after the job has exited
       the queue. That time is defined in the job's worker class's "keep_exit_status_for()" method.

   <b>"$job-&gt;failure_log()"</b>
       Returns a list of the error messages specified to "add_failure()" when a worker failed to perform the
       given job.

   <b>"$job-&gt;failures()"</b>
       Returns the number of times a worker has grabbed this job, only to fail to complete it.

   <b>"$job-&gt;set_exit_status(</b> <b>$status</b> <b>)"</b>
       Records the exit status of the given job as $status.

   <b>"$job-&gt;did_something([</b> <b>$value</b> <b>])"</b>
       Returns whether the given job has been completed or failed since it was created or loaded, setting
       whether it has to $value first, if specified.

   <b>"$job-&gt;was_declined()"</b>
       Sets (if given an argument) and returns the value of the was_declined flag for a job object. See also
       "$job-&gt;declined()"

   <b>"$job-&gt;debug(</b> <b>$msg</b> <b>)"</b>
       Sends the given message to the job's "TheSchwartz" client as debug output.

   <b>"$job-&gt;set_as_current()"</b>
       Set $job as the current job being performed by its associated "TheSchwartz" client.

</pre><h4><b>WORKING</b></h4><pre>
       "TheSchwartz::Worker" classes should use these methods to update the status of their jobs:

   <b>"$job-&gt;completed()"</b>
       Records that the given job has been fully performed and removes it from the job queue. Completing a job
       records its exit status as 0.

   <b>"$job-&gt;failed(</b> <b>$msg,</b> <b>$exit_status</b> <b>)"</b>
       Records that the worker performing this job failed to complete it, for reason $msg.

       If workers have not failed to complete the job more times than the maximum number of retries for that
       type of job, the job will be reattempted after its retry delay has elapsed. The maximum number of retries
       and the delay before a retry are defined in the job's worker class definition as "max_retries()" and
       "retry_delay()" respectively.

       If workers <u>have</u> exceeded the maximum number of reattempts for this job, the job's exit status is recorded
       as $exit_status, and the job is removed from the queue. If $exit_status is not defined or 0, the job will
       be recorded with an exit status of 1, to indicate a failure.

   <b>"$job-&gt;permanent_failure(</b> <b>$msg,</b> <b>$exit_status</b> <b>)"</b>
       Records that the worker performing this job failed to complete it, as in "failed()", but that the job
       should <u>not</u> be reattempted, no matter how many times the job has been attempted before. The job's exit
       status is thus recorded as $exit_status (or 1), and the job is removed from the queue.

   <b>"$job-&gt;declined([</b> <b>$run_after</b> <b>])"</b>
       Report that the job has been declined for handling at this time, which means that the job will be retried
       after the next grabbed_until interval, and does not count against the max_retries count.

       If $run_after is set then the job will be grabbed_until will be reset and the job will be reconsidered at
       $run_after, and does not count against the max_retries count.

   <b>"$job-&gt;replace_with(</b> <b>@jobs</b> <b>)"</b>
       Atomically replaces the single job $job with the given set of jobs.

       This can be used to decompose one "meta job" posted by your application into a set of jobs workers can
       perform, or to post a job or jobs required to complete the process already partly performed.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Data::ObjectDriver, Data::ObjectDriver::BaseObject, Storable

perl v5.34.0                                       2022-06-28                              <u>TheSchwartz::<a href="../man3pm/Job.3pm.html">Job</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>