<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catmandu::AlephX - Low level client for Aleph X-Services</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcatmandu-alephx-perl">libcatmandu-alephx-perl_1.073-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
         Catmandu::AlephX - Low level client for Aleph X-Services

</pre><h4><b>SYNOPSIS</b></h4><pre>
         my $aleph = Catmandu::AlephX-&gt;new(url =&gt; "<a href="http://localhost/X">http://localhost/X</a>");
         my $item_data = $aleph-&gt;item_data(base =&gt; "rug01",doc_number =&gt; "001484477");

         #all public methods return a Catmandu::AlephX::Response
         # 'is_success' means that the xml-response did not contain the element 'error'
         # most methods return only one 'error', but some (like update_doc) multiple.
         # other errors are thrown (xml parse error, no connection ..)

         if($item_data-&gt;is_success){

           say "valid response from aleph x server";

         }else{

           say "aleph x server returned error-response: ".join("\n",@{$item_data-&gt;errors});

         }

</pre><h4><b>METHODS</b></h4><pre>
   <b>item-data</b>
       <u>documentation</u> <u>from</u> <u>AlephX</u>

       The service retrieves the document number from the user.  For each of the document's items it retrieves:
         Item information (From Z30).
         Loan information (from Z36).
         An indication whether the request is on-hold

       <u>example</u>

         my $item_data = $aleph-&gt;item_data(base =&gt; "rug01",doc_number =&gt; "001484477");
         if($item_data-&gt;is_success){
           for my $item(@{ $item_data-&gt;items() }){
             print Dumper($item);
           };
         }else{
           print STDERR join("\n",@{$item_data-&gt;errors})."\n";
         }

       <u>remarks</u>

         This method is equivalent to 'op' = 'item-data'

   <b>item-data-multi</b>
       <u>documentation</u> <u>from</u> <u>AlephX</u>

       This service takes a document number from the user and for each of the document's items retrieves the
       following:
         Item information (from Z30)
         Loan information (from Z36) An indication of whether or not the item is on hold, has hold requests, or
       is expected (that is, has not arrived yet but is expected) It is similar to the item_data X-service,
       except for the parameter START_POINT, which enables the retrieval of information for documents with more
       than 1000 items.

       <u>example</u>

         my $item_data_m = $aleph-&gt;item_data_multi(base =&gt; "rug01",doc_number =&gt; "001484477",start_point =&gt; '000000990');
         if($item_data_m-&gt;is_success){
           for my $item(@{ $item_data_m-&gt;items() }){
             print Dumper($item);
           };
         }else{
           print STDERR join("\n",@{$item_data_m-&gt;errors})."\n";
         }

         say "items retrieved, starting at ".$item_data_m-&gt;start_point() if $item_data_m-&gt;start_point();

       <u>remarks</u>

         This method is equivalent to 'op' = 'item-data-multi'
         The attribute 'start_point' only supplies a value, if the document has over 990 items

   <b>read_item</b>
       <u>documentation</u> <u>from</u> <u>AlephX</u>

         The service retrieves a requested item's record from a given ADM library in case such an item does exist in that ADM library.

       <u>example</u>

         my $readitem = $aleph-&gt;read_item(library=&gt;"usm50",item_barcode=&gt;293);
         if($readitem-&gt;is_success){
           for my $z30(@{ $readitem-&gt;z30 }){
             print Dumper($z30);
           }
         }else{
           say STDERR join("\n",@{$readitem-&gt;errors});
         }

       <u>remarks</u>

         This method is equivalent to 'op' = 'read-item'

   <b>find</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

         This service retrieves a set number and the number of records answering a search request inserted by the user.

       <u>example</u>

         my $find = $aleph-&gt;find(request =&gt; 'wrd=(art)',base=&gt;'rug01');
         if($find-&gt;is_success){
           say "set_number: ".$find-&gt;set_number;
           say "no_records: ".$find-&gt;no_records;
           say "no_entries: ".$find-&gt;no_entries;
         }else{
           say STDERR join("\n",@{$find-&gt;errors});
         }

       <u>remarks</u>

         This method is equivalent to 'op' = 'find'

       <u>arguments</u>

         request - search request
         adjacent - if 'Y' then the documents should contain all the search words adjacent to each other, otherwise 'N'

   <b>find_doc</b>
       <u>documentation</u> <u>from</u> <u>AlephX</u>

         This service retrieves the OAI XML format of an expanded document as given by the user.

       <u>example</u>

         my $find = $aleph-&gt;find_doc(base=&gt;'rug01',doc_num=&gt;'000000444',format=&gt;'marc');
         if($find-&gt;is_success){
           say Dumper($find-&gt;record);
         }else{
           say STDERR join("\n",@{$find-&gt;errors});
         }

       <u>remarks</u>

         This method is equivalent to 'op' = 'find-doc'

   <b>present</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

         This service retrieves OAI XML format of expanded documents.
         You can view documents according to the locations within a specific set number.

       <u>example</u>

         my $set_number = $aleph-&gt;find(request =&gt; "wrd=(BIB.AFF)",base =&gt; "rug01")-&gt;set_number;
         my $present = $aleph-&gt;present(
           set_number =&gt; $set_number,
           set_entry =&gt; "000000001-000000003"
         );
         if($present-&gt;is_success){
           for my $record(@{ $present-&gt;records() }){
             say "doc_number: ".$record-&gt;doc_number;
             say "\tmetadata: ".$record-&gt;metadata-&gt;type;
           }
         }else{
           say STDERR join("\n",@{$present-&gt;errors});
         }

       <u>remarks</u>

         This method is equivalent to 'op' = 'present'

   <b>ill_get_doc_short</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

         The service retrieves the doc number and the XML of the short document (Z13).

       <u>example</u>

         my $result = $aleph-&gt;ill_get_doc_short(doc_number =&gt; "000000001",library=&gt;"usm01");
         if($result-&gt;is_success){
           for my $z30(@{ $result-&gt;z13 }){
             print Dumper($z30);
           }
         }else{
           say STDERR join("\n",@{$result-&gt;errors});
         }

       <u>remarks</u>

         This method is equivalent to 'op' = 'ill-get-doc-short'

   <b>bor_auth</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

         This service retrieves the Global record (Z303), Local record (Z305) and the Data record (Z304) for a given Patron if the given ID and verification code match.
         Otherwise, an error message is returned.

       <u>example</u>

         my %args = (
           library =&gt; $library,
           bor_id =&gt; $bor_id,
           verification =&gt; $verification
         );
         my $auth = $aleph-&gt;bor_auth(%args);

         if($auth-&gt;is_success){

           for my $type(qw(z303 z304 z305)){
             say "$type:";
             my $data = $auth-&gt;$type();
             for my $key(keys %$data){
               say "\t$key : $data-&gt;{$key}-&gt;[0]";
             }
           }

         }else{
           say STDERR "error: ".join("\n",@{$auth-&gt;errors});
           exit 1;
         }

   <b>bor_info</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

         This service retrieves all information related to a given Patron: Global and Local records, Loan records, Loaned items records, Short doc record, Cash record, and so on, if the ID and verification code provided match.

         If not, an error message is returned. Since the bor-info X-Service retrieves a very large amount of data, and not all of it may be relevant, you can choose to receive a part of the data, based on your needs.

       <u>example</u>

         my %args = (
           library =&gt; $library,
           bor_id =&gt; $bor_id,
           verification =&gt; $verification,
           loans =&gt; 'P'
         );
         my $info = $aleph-&gt;bor_info(%args);

         if($info-&gt;is_success){

           for my $type(qw(z303 z304 z305)){
             say "$type:";
             my $data = $info-&gt;$type();
             for my $key(keys %$data){
               say "\t$key : $data-&gt;{$key}-&gt;[0]";
             }
           }
           say "fine:";
           for my $fine(@{ $info-&gt;fine() }){
             for my $type(qw(z13 z30 z31)){
               say "\t$type:";
               my $data = $fine-&gt;{$type}-&gt;[0];
               for my $key(keys %$data){
                 say "\t\t$key : $data-&gt;{$key}-&gt;[0]";
               }
             }
           }

         }else{
           say STDERR "error: ".join("\n",@{$info-&gt;errors});
           exit 1;
         }

   <b>ill_bor_info</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

         This service retrieves Z303, Z304, Z305 and Z308 records for a given borrower ID / barcode.

       <u>example</u>

   <b>circ_status</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

       The service retrieves the circulation status for each document number entered by the user.

         Item information (From Z30).
         Loan information (from Z36).
         Loan Status (Tab15), Due Date, Due Hour etc.

       <u>example</u>

   <b>circ_stat_m</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

       The service retrieves the circulation status for each document number entered by the user (suitable for
       documents with more than 1000 items).

         Item information (From Z30).
         Loan information (from Z36).
         Loan Status (Tab15), Due Date, Due Hour etc.

       This service is similar to circ-status X-service, except for the parameter START_POINT which enables to
       retrieve information for documents with more than 1000 items.

       <u>example</u>

   <b>publish_avail</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

       This service supplies the current availability status of a document.

       The X-Server does not change any data.

       <u>example</u>

       my $publish = $aleph-&gt;publish_avail(doc_num =&gt;
       '000196220,001313162,001484478,001484538,001317121,000000000',library=&gt;'rug01');
       if($publish-&gt;is_success){

         #format for $publish-&gt;list() : [ [&lt;id&gt;,&lt;marc-array&gt;], .. ]

         for my $item(@{ $publish-&gt;list }){

           say "id: $item-&gt;[0]";
           if($item-&gt;[1]){
             say "marc array:";
             say Dumper($item-&gt;[1]);
           }else{
             say "nothing for $item-&gt;[0]";
           }

           say "\n---";
         }
       }else{
         say STDERR join("\n",@{$publish-&gt;errors});
       }

       <u>remarks</u>

         The parameter 'doc_num' supports multiple values, separated by ','.
         Compare this to ill_get_doc, that does not support this.

   <b>ill_get_doc</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

       This service takes a document number and the library where the corresponding document is located and
       generates the XML of the requested document as it appears in the library given.

       <u>example</u>

       my $illgetdoc = $aleph-&gt;ill_get_doc(doc_number =&gt; '001317121',library=&gt;'rug01');
       if($illgetdoc-&gt;is_success){

         if($illgetdoc-&gt;record){
           say "data: ".to_json($illgetdoc-&gt;record,{ pretty =&gt; 1 });
         }
         else{
           say "nothing found";
         }

       }else{
         say STDERR join("\n",@{$illgetdoc-&gt;errors}); }

   <b>renew</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

         This service renews the loan of a given item for a given patron.
         The X-Service renews the loan only if it can be done. If, for example, there is a delinquency on the patron, the service does not renew the loan.

       <u>example</u>

   <b>hold_req</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

       The service creates a hold-request record (Z37) for a given item after performing initial checks.

       <u>example</u>

   <b>update_doc</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

         The service performs actions (Update / Insert / Delete) related to the update of a document.
         (The service uses pc_cat_c0203 which updates a document via the GUI).

       <u>notes</u>

         When executing an update request, most of the 'errors' will be warnings instead of real errors.
         This happens because AlephX performs an 'UPDATE-CHK' before trying to execute an 'UPDATE',
         and stores all warnings during that check in the xml attribute 'error'.

         Therefore the method 'is_success' of the Catmandu::AlephX::Response is not very useful in this case.
         Search for the last 'error', and check weather it contains 'updated successfully'.

       <u>warnings</u>

         An updates replaces the WHOLE record. So if you fail to supply 'xml_full_req' (or indirectly 'marc'),
         the record will be deleted!

         To be sure, please use the full xml response of 'find-doc', change the fields inside 'oai_marc', and
         supply this xml as xml_full_req.

         Every updates adds a CAT-field to the record. Your updates can be recognized by CAT$$a == "WWW-X".
         When updating a record you need to include the old CAT fields (default), otherwise these fields will be deleted
         (and all history will be lost).

         "Unlike other X-Services, the parameters can include XML up to 20,000 characters in length"

         When you update often (and therefore add a lot of CAT fields), this can lead to the error 'Server closed connection'.
         This is due to the maximum of characters allowed in an XML request.

         Possible solution:
           1. retrieve record by 'find_doc'
           2. get marc record:

               my $marc = $res-&gt;record-&gt;metadata-&gt;data

           3. filter out your CAT fields ($a == "WWW-X") to shorten the XML:

               $marc = [grep { !( $_-&gt;[0] eq "CAT" &amp;&amp; $_-&gt;[4] eq "WWW-X" ) } @$marc];

           4. update $marc
           5. send

               $aleph-&gt;update_doc(library =&gt; 'usm01',doc_action =&gt; 'UPDATE',doc_number =&gt; $doc_number,marc =&gt; $marc);

               =&gt; your xml will now contain one CAT field with subfield 'a' equal to 'WWW-X'.

       <u>example</u>

         my $aleph = Catmandu::AlephX-&gt;new(url =&gt; "<a href="http://localhost/X">http://localhost/X</a>");

         my $doc_number = '000000444';
         my $find_doc = $aleph-&gt;find_doc(
           doc_num =&gt; $doc_number,
           base =&gt; "usm01"
         );
         my $marc = $find_doc-&gt;record-&gt;metadata-&gt;data;
         my $content_ref = $find_doc-&gt;content_ref;

         my %args = (
           'library' =&gt; 'usm01',
           'doc_action' =&gt; 'UPDATE',
           'doc_number' =&gt; $doc_number,
           xml_full_req =&gt; $$content_ref
         );
         my $u = $aleph-&gt;update_doc(%args);
         if($u-&gt;is_success){
           say "all ok";
         }else{
           say STDERR join("\n",@{$u-&gt;errors});
         }

       <u>special</u> <u>support</u> <u>for</u> <u>catmandu</u> <u>marc</u> <u>records</u>

         when you supply the argument 'marc', an xml document will be created for you,
         and stored in the argument 'xml_full_req'. 'marc' must be an array of arrays.
         When you already supplied 'xml_full_req', it will be overwritten.

   <b>update_item</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

         The service updates an existing item in the required ADM library after performing all relevant initial checks prior to that action.

       <u>notes</u>

         AlephX stores not only errors in 'errors', but also the success message.

         Therefore the method 'is_success' of the Catmandu::AlephX::Response is not very useful in this case.
         Search for the last 'error', and check weather it contains 'updated successfully'.

         The result of 'read_item' often contains translations, instead of the real values. But these
         translation cannot be used when updating items.

         e.g. z30-item-status contains 'Regular loan' instead of '001'.

       <u>example</u>

         my $alephx = Catmandu::AlephX-&gt;new(url =&gt; "<a href="http://localhost/X">http://localhost/X</a>");
         my $item_barcode = '32044044980076';

         my %args = (
           'library' =&gt; 'usm50',
           'item_barcode' =&gt; $item_barcode,
         );

         my $z30 = $alephx-&gt;read_item(%args)-&gt;z30();

         my $xml = XMLout($z30,,RootName=&gt;"z30",NoAttr =&gt; 1);
         $xml = "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n".$xml;

         $args{xml_full_req} = $xml;

         my $u = alephx-&gt;update_item(%args);
         if($u-&gt;is_success){
           say "all ok";
         }else{
           say STDERR join("\n",@{$u-&gt;errors});
         }

   <b>create_item</b>
       <u>documentation</u> <u>from</u> <u>Aleph</u> <u>X</u>

       The service creates a new item in the required ADM library after performing all relevant initial checks
       prior to that action.

       The item can be created for a bib record when no ADM record is linked to it yet, or it can be created to
       an ADM record with existing items.

       <u>notes</u>

       <u>example</u>

         my $alephx = Catmandu::AlephX-&gt;new(url =&gt; "<a href="http://localhost/X">http://localhost/X</a>");
         my $item_barcode = '32044044980076';

         my %args = (
           'adm_library'    =&gt; 'rug50',
           'bib_library'    =&gt; 'rug01',
           'bib_doc_number' =&gt; '231843137',
         );

         my $xml = &lt;&lt;EOF;
         &lt;?xml version="1.0" encoding="UTF-8" ?&gt;
         &lt;z30&gt;
         &lt;z30-doc-number&gt;15&lt;/z30-doc-number&gt;
         &lt;z30-item-sequence&gt;10&lt;/z30-item-sequence&gt;
         &lt;z30-barcode&gt;32044003924339&lt;/z30-barcode&gt;
         &lt;z30-sub-library&gt;WID&lt;/z30-sub-library&gt;
         &lt;z30-material&gt;BOOK&lt;/z30-material&gt;
         &lt;z30-item-status&gt;01&lt;/z30-item-status&gt;
         &lt;z30-open-date&gt;19980804&lt;/z30-open-date&gt;
         &lt;z30-update-date&gt;20020708&lt;/z30-update-date&gt;
         &lt;z30-cataloger&gt;EXLIBRIS&lt;/z30-cataloger&gt;
         &lt;z30-date-last-return&gt;20080607&lt;/z30-date-last-return&gt;
         &lt;z30-hour-last-return&gt;1631&lt;/z30-hour-last-return&gt;
         &lt;z30-ip-last-return&gt;CONV&lt;/z30-ip-last-return&gt;
         &lt;z30-no-loans&gt;011&lt;/z30-no-loans&gt;
         &lt;z30-alpha&gt;L&lt;/z30-alpha&gt;
         &lt;z30-collection&gt;GEN&lt;/z30-collection&gt;
         &lt;z30-call-no-type&gt;7&lt;/z30-call-no-type&gt;
         &lt;z30-call-no&gt;Heb 2106.385.5&lt;/z30-call-no&gt;
         &lt;z30-call-no-key&gt;7 selected&lt;/z30-call-no-key&gt;
         &lt;z30-call-no-2-type /&gt;
         &lt;z30-call-no-2 /&gt;
         &lt;z30-call-no-2-key /&gt;
         &lt;z30-description&gt;v.1&lt;/z30-description&gt;
         &lt;z30-note-opac /&gt;
         &lt;z30-note-circulation /&gt;
         &lt;z30-note-internal /&gt;
         &lt;z30-order-number /&gt;
         &lt;z30-inventory-number /&gt;
         &lt;z30-inventory-number-date /&gt;
         &lt;z30-last-shelf-report-date&gt;00000000&lt;/z30-last-shelf-report-date&gt;
         &lt;z30-price /&gt;
         &lt;z30-shelf-report-number /&gt;
         &lt;z30-on-shelf-date&gt;00000000&lt;/z30-on-shelf-date&gt;
         &lt;z30-on-shelf-seq&gt;000000&lt;/z30-on-shelf-seq&gt;
         &lt;z30-doc-number-2&gt;000000015&lt;/z30-doc-number-2&gt;
         &lt;z30-schedule-sequence-2&gt;00000&lt;/z30-schedule-sequence-2&gt;
         &lt;z30-copy-sequence-2&gt;00000&lt;/z30-copy-sequence-2&gt;
         &lt;z30-vendor-code /&gt;
         &lt;z30-invoice-number /&gt;
         &lt;z30-line-number&gt;00000&lt;/z30-line-number&gt;
         &lt;z30-pages /&gt;
         &lt;z30-issue-date /&gt;
         &lt;z30-expected-arrival-date /&gt;
         &lt;z30-arrival-date /&gt;
         &lt;z30-item-statistic /&gt;
         &lt;z30-item-process-status&gt;XX&lt;/z30-item-process-status&gt;
         &lt;z30-copy-id&gt;1&lt;/z30-copy-id&gt;
         &lt;z30-hol-doc-number&gt;000000046&lt;/z30-hol-doc-number&gt;
         &lt;z30-temp-location&gt;No&lt;/z30-temp-location&gt;
         &lt;z30-enumeration-a /&gt;
         &lt;z30-enumeration-b /&gt;
         &lt;z30-enumeration-c /&gt;
         &lt;z30-enumeration-d /&gt;
         &lt;z30-enumeration-e /&gt;
         &lt;z30-enumeration-f /&gt;
         &lt;z30-enumeration-g /&gt;
         &lt;z30-enumeration-h /&gt;
         &lt;z30-chronological-i /&gt;
         &lt;z30-chronological-j /&gt;
         &lt;z30-chronological-k /&gt;
         &lt;z30-chronological-l /&gt;
         &lt;z30-chronological-m /&gt;
         &lt;z30-supp-index-o /&gt;
         &lt;z30-85x-type /&gt;
         &lt;z30-depository-id /&gt;
         &lt;z30-linking-number&gt;000000000&lt;/z30-linking-number&gt;
         &lt;z30-gap-indicator /&gt;
         &lt;z30-maintenance-count&gt;007&lt;/z30-maintenance-count&gt;
         &lt;z30-process-status-date&gt;20080408&lt;/z30-process-status-date&gt;
         &lt;/z30&gt;
       EOF

         $args{xml_full_req} = $xml;

         my $u = alephx-&gt;create_item(%args);
         if($u-&gt;is_success){
           say "all ok";
         }else{
           say STDERR join("\n",@{$u-&gt;errors});
         }

</pre><h4><b>AUTHOR</b></h4><pre>
       Nicolas Franck, "&lt;nicolas.franck at ugent.be&gt;"

</pre><h4><b>LICENSE</b> <b>AND</b> <b>COPYRIGHT</b></h4><pre>
       This program is free software; you can redistribute it and/or modify it under the terms of either: the
       GNU General Public License as published by the Free Software Foundation; or the Artistic License.

       See &lt;<a href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a>&gt; for more information.

perl v5.36.0                                       2023-02-02                              <u>Catmandu::<a href="../man3pm/AlephX.3pm.html">AlephX</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>