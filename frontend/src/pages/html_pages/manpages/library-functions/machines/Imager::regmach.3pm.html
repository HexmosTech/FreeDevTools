<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imager::regmach - documents the register virtual machine used by Imager::transform2().</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libimager-perl">libimager-perl_1.027+dfsg-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Imager::regmach - documents the register virtual machine used by Imager::transform2().

</pre><h4><b>SYNOPSIS</b></h4><pre>
       The register machine is a complete rewrite of the stack machine originally used by <b>Imager::transform()</b>,
       written for use by <b>Imager::transform2()</b>.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       (This document might be a little incoherent.)

       The register machine is a fast implementation of a small instruction set designed for evaluating an
       arithmetic expression to produce a color for an image.

       The machine takes as input:

       instructions
           An array of instructions

       numeric registers
           An array of numeric registers.  Some registers are initialized as literals.

       color registers
           An array of color registers.  Currently these registers aren't initialized.

       input images
           An array of Imager i_img pointers.  The "getpn" operators read pixels from these images.

       The instructions supplied each take up to 4 input numeric or color registers with a single output numeric
       or  color  register.   The  machine attempts to execute instructions as safely as possible, assuming that
       correct instructions have been provided, eg. the machine protects against divide  by  zero,  but  doesn't
       check register numbers for validity.

       The final instruction must be a "ret" instruction, which returns the result ;)

   <b>Adding</b> <b>new</b> <b>instructions</b>
       To add a new instruction:

       1.  Add  a  new  opcode  to  the  enumeration in <u>regmach.h</u> - make sure to add comment after the enum name
           giving the input registers ("rX" for numeric, "pX" for color) that the instruction takes.  These must
           be in the order that the instruction expects to take the.  Put a letter (r or p) after -&gt; to indicate
           the result type.

       2.  Add a case to <u>regmach.c</u> that executes the instruction.

       3.  make

       The <u>Makefile</u> should rebuild the <u>Regops.pm</u> file, and your new instruction will be added as a function.

       If you want to add a single alternative instruction that might take different  argument  types  (it  must
       take  the  same  number  of  parameters), create another instruction with that name followed by a p.  The
       current expression parsers explicitly look for such instruction names.

   <b>Future</b> <b>directions</b>
       Conditional and non-conditional jumps to implement iteration.  This will break the current  optimizer  in
       Imager::Expr (and the compilers for both expression compilers, for that matter.)

       Complex  arithmetic  (Addi suggested this one).  This would most likely be a separate machine.  Otherwise
       we'll have a very significant performance loss.

</pre><h4><b>WARNINGS</b></h4><pre>
       If you feed bad 'machine code' to the register machine, you have a good chance of a "SIGSEGV".

</pre><h4><b>AUTHOR</b></h4><pre>
       Tony Cook &lt;<a href="mailto:tonyc@cpan.org">tonyc@cpan.org</a>&gt;, Arnar M. Hrafnkelsson

perl v5.40.1                                       2025-03-16                               <u>Imager::<a href="../man3pm/regmach.3pm.html">regmach</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>