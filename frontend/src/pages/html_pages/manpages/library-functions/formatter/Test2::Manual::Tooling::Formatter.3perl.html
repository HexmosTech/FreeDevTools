<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test2::Manual::Tooling::Formatter - How to write a custom formatter, in our case a JSONL formatter.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/perl-doc">perl-doc_5.40.1-6_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Test2::Manual::Tooling::Formatter - How to write a custom formatter, in our case a JSONL formatter.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This tutorial explains a minimal formatter that outputs each event as a json string on its own line. A
       true formatter will probably be significantly more complicated, but this will give you the basics needed
       to get started.

</pre><h4><b>COMPLETE</b> <b>CODE</b> <b>UP</b> <b>FRONT</b></h4><pre>
           package Test2::Formatter::MyFormatter;
           use strict;
           use warnings;

           use JSON::MaybeXS qw/encode_json/;

           use base qw/Test2::Formatter/;

           sub new { bless {}, shift }

           sub encoding {};

           sub write {
               my ($self, $e, $num, $f) = @_;
               $f ||= $e-&gt;facet_data;

               print encode_json($f), "\n";
           }

           1;

</pre><h4><b>LINE</b> <b>BY</b> <b>LINE</b></h4><pre>
       use base qw/Test2::Formatter/;
           All formatters should inherit from Test2::Formatter.

       sub new { bless {}, shift }
           Formatters need to be instantiable objects, this is a minimal new() method.

       sub encoding {};
           For  this  example we leave this sub empty. In general you should implement this sub to make sure you
           honor situations where the encoding is set. Test2::V0 itself will try to set the encoding to UTF8.

       sub write { ... }
           The write() method is the most important, each event is sent here.

       my ($self, $e, $num, $f) = @_;
           The write() method receives 3 or 4 arguments, the fourth is optional.

           $self
               The formatter itself.

           $e  The event being written

           $num
               The most recent assertion number. If the event being processed is an  assertion  then  this  will
               have  been bumped by 1 since the last call to write. For non assertions this number is set to the
               most recent assertion.

           $f  This MAY be a hashref containing all the facet data from the event. More often then not this will
               be undefined. This is only set if the facet data was needed by the hub, and it usually is not.

       $f ||= $e-&gt;facet_data;
           We want to dump the event facet data. This will set $f to the facet data unless we already  have  the
           facet data.

       print encode_json($f), "\n";
           This line prints the JSON encoded facet data, and a newline.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Test2::Manual - Primary index of the manual.

</pre><h4><b>SOURCE</b></h4><pre>
       The source code repository for Test2-Manual can be found at <u>https://github.com/Test-More/Test2-Suite/</u>.

</pre><h4><b>MAINTAINERS</b></h4><pre>
       Chad Granum &lt;<a href="mailto:exodist@cpan.org">exodist@cpan.org</a>&gt;

</pre><h4><b>AUTHORS</b></h4><pre>
       Chad Granum &lt;<a href="mailto:exodist@cpan.org">exodist@cpan.org</a>&gt;

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2018 Chad Granum &lt;<a href="mailto:exodist@cpan.org">exodist@cpan.org</a>&gt;.

       This  program  is  free  software;  you can redistribute it and/or modify it under the same terms as Perl
       itself.

       See <u><a href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></u>

perl v5.40.1                                       2025-07-27            <u>Test2::Manual:...ling::<a href="../man3perl/Formatter.3perl.html">Formatter</a></u>(3perl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>