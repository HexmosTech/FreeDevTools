<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moose::Cookbook::Basics::Person_BUILDARGSAndBUILD - Using BUILDARGS and BUILD to hook into object</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmoose-perl">libmoose-perl_2.2207-1build3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Moose::Cookbook::Basics::Person_BUILDARGSAndBUILD - Using BUILDARGS and BUILD to hook into object
       construction

</pre><h4><b>VERSION</b></h4><pre>
       version 2.2207

</pre><h4><b>SYNOPSIS</b></h4><pre>
         package Person;

         has 'ssn' =&gt; (
             is        =&gt; 'ro',
             isa       =&gt; 'Str',
             predicate =&gt; 'has_ssn',
         );

         has 'country_of_residence' =&gt; (
             is      =&gt; 'ro',
             isa     =&gt; 'Str',
             default =&gt; 'usa'
         );

         has 'first_name' =&gt; (
             is  =&gt; 'ro',
             isa =&gt; 'Str',
         );

         has 'last_name' =&gt; (
             is  =&gt; 'ro',
             isa =&gt; 'Str',
         );

         around BUILDARGS =&gt; sub {
             my $orig = shift;
             my $class = shift;

             if ( @_ == 1 &amp;&amp; ! ref $_[0] ) {
                 return $class-&gt;$orig(ssn =&gt; $_[0]);
             }
             else {
                 return $class-&gt;$orig(@_);
             }
         };

         sub BUILD {
             my $self = shift;

             if ( $self-&gt;country_of_residence eq 'usa' ) {
                 die 'Cannot create a Person who lives in the USA without an ssn.'
                     unless $self-&gt;has_ssn;
             }
         }

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This recipe demonstrates the use of "BUILDARGS" and "BUILD". By defining these methods, we can hook into
       the object construction process without overriding "new".

       The "BUILDARGS" method is called <u>before</u> an object has been created. It is called as a class method, and
       receives all of the parameters passed to the "new" method. It is expected to do something with these
       arguments and return a hash reference. The keys of the hash must be attribute "init_arg"s.

       The primary purpose of "BUILDARGS" is to allow a class to accept something other than named arguments. In
       the case of our "Person" class, we are allowing it to be called with a single argument, a social security
       number:

         my $person = Person-&gt;new('123-45-6789');

       The key part of our "BUILDARGS" is this conditional:

             if ( @_ == 1 &amp;&amp; ! ref $_[0] ) {
                 return $class-&gt;$orig(ssn =&gt; $_[0]);
             }

       By default, Moose constructors accept a list of key-value pairs, or a hash reference. We need to make
       sure that $_[0] is not a reference before assuming it is a social security number.

       We call the original "BUILDARGS" method to handle all the other cases. You should always do this in your
       own "BUILDARGS" methods, since Moose::Object provides its own "BUILDARGS" method that handles hash
       references and a list of key-value pairs.

       The "BUILD" method is called <u>after</u> the object is constructed, but before it is returned to the caller.
       The "BUILD" method provides an opportunity to check the object state as a whole. This is a good place to
       put logic that cannot be expressed as a type constraint on a single attribute.

       In the "Person" class, we need to check the relationship between two attributes, "ssn" and
       "country_of_residence". We throw an exception if the object is not logically consistent.

</pre><h4><b>MORE</b> <b>CONSIDERATIONS</b></h4><pre>
       This recipe is made significantly simpler because all of the attributes are read-only. If the
       "country_of_residence" attribute were settable, we would need to check that a Person had an "ssn" if the
       new country was "usa". This could be done with a "before" modifier.

</pre><h4><b>CONCLUSION</b></h4><pre>
       We have repeatedly discouraged overriding "new" in Moose classes. This recipe shows how you can use
       "BUILDARGS" and "BUILD" to hook into object construction without overriding "new".

       The "BUILDARGS" method lets us expand on Moose's built-in parameter handling for constructors. The
       "BUILD" method lets us implement logical constraints across the whole object after it is created.

</pre><h4><b>AUTHORS</b></h4><pre>
       •   Stevan Little &lt;<a href="mailto:stevan@cpan.org">stevan@cpan.org</a>&gt;

       •   Dave Rolsky &lt;<a href="mailto:autarch@urth.org">autarch@urth.org</a>&gt;

       •   Jesse Luehrs &lt;<a href="mailto:doy@cpan.org">doy@cpan.org</a>&gt;

       •   Shawn M Moore &lt;<a href="mailto:sartak@cpan.org">sartak@cpan.org</a>&gt;

       •   יובל קוג'מן (Yuval Kogman) &lt;<a href="mailto:nothingmuch@woobling.org">nothingmuch@woobling.org</a>&gt;

       •   Karen Etheridge &lt;<a href="mailto:ether@cpan.org">ether@cpan.org</a>&gt;

       •   Florian Ragwitz &lt;<a href="mailto:rafl@debian.org">rafl@debian.org</a>&gt;

       •   Hans Dieter Pearcey &lt;<a href="mailto:hdp@cpan.org">hdp@cpan.org</a>&gt;

       •   Chris Prather &lt;<a href="mailto:chris@prather.org">chris@prather.org</a>&gt;

       •   Matt S Trout &lt;<a href="mailto:mstrout@cpan.org">mstrout@cpan.org</a>&gt;

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       This software is copyright (c) 2006 by Infinity Interactive, Inc.

       This  is  free  software;  you  can  redistribute  it and/or modify it under the same terms as the Perl 5
       programming language system itself.

perl v5.40.0                                       2024-10-20              <u>Moose::<a href="../man3pm/Cookboo...ILDARGSAndBUILD.3pm.html">Cookboo...ILDARGSAndBUILD</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>