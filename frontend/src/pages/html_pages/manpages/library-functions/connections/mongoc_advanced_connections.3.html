<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mongoc_advanced_connections - Advanced Connections</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/libmongoc-doc">libmongoc-doc_1.21.0-1build1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mongoc_advanced_connections - Advanced Connections

       The following guide contains information specific to certain types of MongoDB configurations.

       For  an  example of connecting to a simple standalone server, see the Tutorial. To establish a connection
       with authentication options enabled, see the Authentication page.

</pre><h4><b>CONNECTING</b> <b>TO</b> <b>A</b> <b>REPLICA</b> <b>SET</b></h4><pre>
       Connecting to a <u>replica</u> <u>set</u> is much like connecting to a standalone MongoDB server.  Simply  specify  the
       replica set name using the <b>?replicaSet=myreplset</b> URI option.

          #include &lt;bson/bson.h&gt;
          #include &lt;mongoc/mongoc.h&gt;

          int
          main (int argc, char *argv[])
          {
             mongoc_client_t *client;

             mongoc_init ();

             /* Create our MongoDB Client */
             client = mongoc_client_new (
                "mongodb://host01:27017,host02:27017,host03:27017/?replicaSet=myreplset");

             /* Do some work */
             /* TODO */

             /* Clean up */
             mongoc_client_destroy (client);
             mongoc_cleanup ();

             return 0;
          }

       <b>TIP:</b>
          Multiple  hostnames  can  be  specified  in the MongoDB connection string URI, with a comma separating
          hosts in the seed list.

          It is recommended to use a seed list of members of the replica set to allow the driver to  connect  to
          any node.

</pre><h4><b>CONNECTING</b> <b>TO</b> <b>A</b> <b>SHARDED</b> <b>CLUSTER</b></h4><pre>
       To connect to a <u>sharded</u> <u>cluster</u>, specify the <b>mongos</b> nodes the client should connect to. The C Driver will
       automatically detect that it has connected to a <b>mongos</b> sharding server.

       If  more  than  one  hostname  is  specified, a seed list will be created to attempt failover between the
       <b>mongos</b> instances.

       <b>WARNING:</b>
          Specifying the <b>replicaSet</b> parameter when connecting to a <b>mongos</b> sharding server is invalid.

          #include &lt;bson/bson.h&gt;
          #include &lt;mongoc/mongoc.h&gt;

          int
          main (int argc, char *argv[])
          {
             mongoc_client_t *client;

             mongoc_init ();

             /* Create our MongoDB Client */
             client = mongoc_client_new ("mongodb://myshard01:27017/");

             /* Do something with client ... */

             /* Free the client */
             mongoc_client_destroy (client);

             mongoc_cleanup ();

             return 0;
          }

</pre><h4><b>CONNECTING</b> <b>TO</b> <b>AN</b> <b>IPV6</b> <b>ADDRESS</b></h4><pre>
       The MongoDB C Driver will automatically resolve IPv6 addresses from host names. However,  to  specify  an
       IPv6 address directly, wrap the address in <b>[]</b>.

          mongoc_uri_t *uri = mongoc_uri_new ("mongodb://[::1]:27017");

</pre><h4><b>CONNECTING</b> <b>WITH</b> <b>IPV4</b> <b>AND</b> <b>IPV6</b></h4><pre>
       If  connecting  to  a  hostname that has both IPv4 and IPv6 DNS records, the behavior follows <u>RFC-6555</u>. A
       connection to the IPv6 address is attempted first. If IPv6 fails, then a connection is attempted  to  the
       IPv4  address.  If  the  connection attempt to IPv6 does not complete within 250ms, then IPv4 is tried in
       parallel. Whichever succeeds connection first cancels the other. The successful DNS result is cached  for
       10 minutes.

       As a consequence, attempts to connect to a mongod only listening on IPv4 may be delayed if there are both
       A (IPv4) and AAAA (IPv6) DNS records associated with the host.

       To  avoid  a  delay,  configure  hostnames  to match the MongoDB configuration. That is, only create an A
       record if the mongod is only listening on IPv4.

</pre><h4><b>CONNECTING</b> <b>TO</b> <b>A</b> <b>UNIX</b> <b>DOMAIN</b> <b>SOCKET</b></h4><pre>
       On UNIX-like systems, the C Driver can connect directly to a MongoDB server using a UNIX  domain  socket.
       Pass  the URL-encoded path to the socket, which <u>must</u> be suffixed with <b>.sock</b>. For example, to connect to a
       domain socket at <b>/tmp/mongodb-27017.sock</b>:

          mongoc_uri_t *uri = mongoc_uri_new ("mongodb://%2Ftmp%2Fmongodb-27017.sock");

       Include username and password like so:

          mongoc_uri_t *uri = mongoc_uri_new ("mongodb://user:pass@%2Ftmp%2Fmongodb-27017.sock");

</pre><h4><b>CONNECTING</b> <b>TO</b> <b>A</b> <b>SERVER</b> <b>OVER</b> <b>TLS</b></h4><pre>
       These are instructions for configuring TLS/SSL connections.

       To run a server locally (on port 27017, for example):

          $ mongod --port 27017 --tlsMode requireTLS --tlsCertificateKeyFile server.pem --tlsCAFile ca.pem

       Add <b>/?tls=true</b> to the end of a client URI.

          mongoc_client_t *client = NULL;
          client = mongoc_client_new ("mongodb://localhost:27017/?tls=true");

       MongoDB requires client certificates by default, unless the  <b>--tlsAllowConnectionsWithoutCertificates</b>  is
       provided.  The  C  Driver  can  be  configured  to  present  a  client  certificate  using the URI option
       <b>tlsCertificateKeyFile</b>, which may be referenced through the constant <b>MONGOC_URI_TLSCERTIFICATEKEYFILE</b>.

          mongoc_client_t *client = NULL;
          mongoc_uri_t *uri = mongoc_uri_new ("mongodb://localhost:27017/?tls=true");
          mongoc_uri_set_option_as_utf8 (uri, MONGOC_URI_TLSCERTIFICATEKEYFILE, "client.pem");

          client = mongoc_client_new_from_uri (uri);

       The client certificate provided by <b>tlsCertificateKeyFile</b> must be issued by  one  of  the  server  trusted
       Certificate  Authorities  listed in <b>--tlsCAFile</b>, or issued by a CA in the native certificate store on the
       server when omitted.

       See configuring_tls for more information on the various TLS related options.

</pre><h4><b>COMPRESSING</b> <b>DATA</b> <b>TO</b> <b>AND</b> <b>FROM</b> <b>MONGODB</b></h4><pre>
       MongoDB 3.4 added Snappy compression support, zlib compression in 3.6, and zstd compression in  4.2.   To
       enable compression support the client must be configured with which compressors to use:

          mongoc_client_t *client = NULL;
          client = mongoc_client_new ("mongodb://localhost:27017/?compressors=snappy,zlib,zstd");

       The  <b>compressors</b> option specifies the priority order of compressors the client wants to use. Messages are
       compressed if the client and server share any compressors in common.

       Note that the compressor used by the server might not be the same compressor as  the  client  used.   For
       example,  if  the  client  uses  the  connection  string <b>compressors=zlib,snappy</b> the client will use <b>zlib</b>
       compression to send data (if possible), but the server might still reply using <b>snappy</b>, depending  on  how
       the server was configured.

       The  driver  must be built with zlib and/or snappy and/or zstd support to enable compression support, any
       unknown (or not compiled in) compressor value will be ignored. Note: to build with  zstd  requires  cmake
       3.12 or higher.

</pre><h4><b>ADDITIONAL</b> <b>CONNECTION</b> <b>OPTIONS</b></h4><pre>
       The full list of connection options can be found in the <b>mongoc_uri_t</b> docs.

       Certain socket/connection related options are not configurable:
                      ┌───────────────┬──────────────────────────────┬────────────────────────┐
                      │ Option        │ Description                  │ Value                  │
                      ├───────────────┼──────────────────────────────┼────────────────────────┤
                      │ SO_KEEPALIVE  │ TCP Keep Alive               │ Enabled                │
                      ├───────────────┼──────────────────────────────┼────────────────────────┤
                      │ TCP_KEEPIDLE  │ How  long a connection needs │ 120 seconds            │
                      │               │ to remain  idle  before  TCP │                        │
                      │               │ starts   sending   keepalive │                        │
                      │               │ probes                       │                        │
                      ├───────────────┼──────────────────────────────┼────────────────────────┤
                      │ TCP_KEEPINTVL │ The time in seconds  between │ 10 seconds             │
                      │               │ TCP probes                   │                        │
                      ├───────────────┼──────────────────────────────┼────────────────────────┤
                      │ TCP_KEEPCNT   │ How  many  probes  to  send, │ 9 probes               │
                      │               │ without     acknowledgement, │                        │
                      │               │ before      dropping     the │                        │
                      │               │ connection                   │                        │
                      ├───────────────┼──────────────────────────────┼────────────────────────┤
                      │ TCP_NODELAY   │ Send  packets  as  soon   as │ Enabled (no buffering) │
                      │               │ possible   or  buffer  small │                        │
                      │               │ packets (Nagle algorithm)    │                        │
                      └───────────────┴──────────────────────────────┴────────────────────────┘

</pre><h4><b>AUTHOR</b></h4><pre>
       MongoDB, Inc

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2017-present, MongoDB, Inc

1.21.0                                            Feb 09, 2022                    <u><a href="../man3/MONGOC_ADVANCED_CONNECTIONS.3.html">MONGOC_ADVANCED_CONNECTIONS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>