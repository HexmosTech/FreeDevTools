<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cpg_model_initialize - Create a new connection to the CPG service</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcpg-dev">libcpg-dev_3.1.9-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       cpg_model_initialize - Create a new connection to the CPG service

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;corosync/cpg.h&gt;</b>

       <b>cs_error_t</b>  <b>cpg_model_initialize(cpg_handle_t</b>  <b>*</b><u>handle</u><b>,</b>  <b>cpg_model_t</b> <u>model</u><b>,</b> <b>cpg_model_data_t</b> <b>*</b><u>model_data</u><b>,</b>
       <b>void</b> <b>*</b><u>context</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>cpg_model_initialize</b> function is used to initialize a connection to the closed process groups API.

       Each application may have several connections to the CPG API.  Each application uses the <u>handle</u>  argument
       to  uniquely  identify  the  connection.   The  <u>handle</u>  argument  is then used in other function calls to
       identify the connection to be used for communication with the CPG service.

       Argument <u>model</u> is used to explicitly choose set of callbacks  and  internal  parameters.  Currently  only
       model <u>CPG_MODEL_V1</u> is defined.

       Callbacks  and  internal  parameters  are  passed by <u>model_data</u> argument. This is casted pointer (idea is
       similar as in sockaddr function) to one of structures  corresponding  to  chosen  model.  Currently  only
       <u>cpg_model_v1_data_t</u> is needed.

</pre><h4><b>MODEL_V1</b></h4><pre>
       The  <u>MODEL_V1</u>  is  backwards  compatible  with  original  callbacks initialized by <u>cpg_initialize</u> but new
       callback <u>cpg_totem_confchg_fn</u> is defined.

       Every time an CPG event occurs within the joined group, one of the callbacks specified  by  the  argument
       <u>callbacks</u> is called.  The callback functions are described by the following type definitions:

              typedef void (*cpg_deliver_fn_t) (
                      cpg_handle_t handle,
                      const struct cpg_name *group_name,
                      uint32_t nodeid,
                      uint32_t pid,
                      const void *msg,
                      size_t msg_len);

              typedef void (*cpg_confchg_fn_t) (
                      cpg_handle_t handle,
                      const struct cpg_name *group_name,
                      const struct cpg_address *member_list, size_t member_list_entries,
                      const struct cpg_address *left_list, size_t left_list_entries,
                      const struct cpg_address *joined_list, size_t joined_list_entries);

              typedef void (*cpg_totem_confchg_fn_t) (
                      cpg_handle_t handle,
                      struct cpg_ring_id ring_id,
                      uint32_t member_list_entries,
                      const uint32_t *member_list);

       The <u>cpg_model_v1_data_t</u> structure is defined as:

              typedef struct {
                      cpg_model_t model;
                      cpg_deliver_fn_t cpg_deliver_fn;
                      cpg_confchg_fn_t cpg_confchg_fn;
                      cpg_totem_confchg_fn_t cpg_totem_confchg_fn;
                      unsigned int flags;
              } cpg_model_v1_data_t;

       When  a  configuration  change occurs or a message is to be delivered one of the callbacks is called from
       the <b>cpg_dispatch()</b> function.  If a configuration change occurs, <u>cpg_confchg_fn</u> is called.  If a  delivery
       of a message occurs, <u>cpg_deliver_fn</u> is called.  When totem membership change occurs, <u>cpg_totem_confchg_fn</u>
       is  called.  You  can  OR <u>CPG_MODEL_V1_DELIVER_INITIAL_TOTEM_CONF</u> constant to flags to get callback after
       first confchg event.

       The <u>cpg_address</u> structure is defined

              struct cpg_address {
                      unsigned int nodeid;
                      unsigned int pid;
                      unsigned int reason;
              };

       where nodeid is a 32 bit unique node  identifier,  pid  is  the  process  ID  of  the  process  that  has
       joined/left  the  group  or  sent  the  message,  and  reason  is an integer code indicating why the node
       joined/left the group (this value is not set for the member_list items).

              CPG_REASON_JOIN      - the process joined a group using cpg_join().
              CPG_REASON_LEAVE     - the process left a group using cpg_leave()
              CPG_REASON_NODEDOWN  - the process left a group because the node left the cluster.
              CPG_REASON_NODEUP    - the process joined a group because it was already a member of a group on a node that has just joined the cluster
              CPG_REASON_PROCDOWN  - the process left a group without calling cpg_leave()
              CPG_REASON_UNDEFINED - a special value used for the member_list items

       The <u>cpg_ring_id</u> structure is defined

              struct cpg_ring_id {
                      uint32_t nodeid;
                      uint64_t seq;
              };

       where <u>nodeid</u> is the current Totem leader and <u>seq</u> is an increasing number.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       This call returns the CS_OK value if successful, otherwise an error is returned.

</pre><h4><b>ERRORS</b></h4><pre>
       The errors are undocumented.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/cpg_overview.3.html">cpg_overview</a></b>(3),  <b><a href="../man3/cpg_initialize.3.html">cpg_initialize</a></b>(3),  <b><a href="../man3/cpg_finalize.3.html">cpg_finalize</a></b>(3),   <b><a href="../man3/cpg_fd_get.3.html">cpg_fd_get</a></b>(3),   <b><a href="../man3/cpg_dispatch.3.html">cpg_dispatch</a></b>(3),   <b><a href="../man3/cpg_join.3.html">cpg_join</a></b>(3),
       <b><a href="../man3/cpg_leave.3.html">cpg_leave</a></b>(3),     <b><a href="../man3/cpg_mcast_joined.3.html">cpg_mcast_joined</a></b>(3),     <b><a href="../man3/cpg_membership_get.3.html">cpg_membership_get</a></b>(3)     <b><a href="../man3/cpg_zcb_alloc.3.html">cpg_zcb_alloc</a></b>(3)     <b><a href="../man3/cpg_zcb_free.3.html">cpg_zcb_free</a></b>(3)
       <b><a href="../man3/cpg_zcb_mcast_joined.3.html">cpg_zcb_mcast_joined</a></b>(3) <b><a href="../man3/cpg_context_get.3.html">cpg_context_get</a></b>(3) <b><a href="../man3/cpg_context_set.3.html">cpg_context_set</a></b>(3) <b><a href="../man3/cpg_local_get.3.html">cpg_local_get</a></b>(3) <b><a href="../man3/cpg_model_initialize.3.html">cpg_model_initialize</a></b>(3)

       <b>CS_ERR_TRY_AGAIN</b> Resource temporarily unavailable

       <b>CS_ERR_INVALID_PARAM</b> Invalid argument

       <b>CS_ERR_ACCESS</b> Permission denied

       <b>CS_ERR_LIBRARY</b> The connection failed

       <b>CS_ERR_INTERRUPT</b> System call interrupted by a signal

       <b>CS_ERR_NOT_SUPPORTED</b> The requested protocol/functionality not supported

       <b>CS_ERR_MESSAGE_ERROR</b> Incorrect auth message received

       <b>CS_ERR_NO_MEMORY</b> Not enough memory to complete the requested task

corosync Man Page                                  2024-07-15                            <u><a href="../man3/CPG_MODEL_INITIALIZE.3.html">CPG_MODEL_INITIALIZE</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>