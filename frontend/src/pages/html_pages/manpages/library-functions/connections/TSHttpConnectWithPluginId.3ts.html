<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSHttpConnectWithPluginId  -  allows  the  plugin  to initiate an http connection. This will tag the HTTP</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/trafficserver-dev">trafficserver-dev_9.2.5+ds-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       TSHttpConnectWithPluginId  -  allows  the  plugin  to initiate an http connection. This will tag the HTTP
       state machine with extra data that can be accessed by the logging interface. The connection is treated as
       an HTTP transaction as if it came from a client

       <b>NOTE:</b>
          This is a convenience function for <u>TSHttpConnectPlugin()</u> to provide a simpler interface  and  backward
          compatibility   for   existing   implementations.    When   this   function   is   used   instead   of
          <u>TSHttpConnectPlugin</u>, default buffer index and watermark values will be used when creating IOBuffers.

</pre><h4><b>SYNOPSIS</b></h4><pre>
          #include &lt;ts/ts.h&gt;

       <u>TSVConn</u> <b>TSHttpConnectWithPluginId(sockaddr</b> <b>const</b> <b>*addr,</b> <b>char</b> <b>const</b> <b>*tag,</b> <b>int64_t</b> <b>id)</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This call attempts to create an HTTP state machine and a virtual connection to that state  machine.  This
       is  more  efficient  than using <u>TSNetConnect()</u> because it avoids using the operating system stack via the
       loopback interface.

       <u>addr</u>   This is the network address of the target of the connection.  This includes the port which  should
              be stored in the <b>sockaddr</b> structure pointed at by <u>addr</u>.

       <u>tag</u>    This  is  a  tag that is passed through to the HTTP state machine.  It must be a persistent string
              that has a lifetime longer than the connection. It is accessible via the log field <u>pitag</u>. This  is
              intended  as a class or type identifier that is consistent across all connections for this plugin.
              In effect, the name of the plugin. This can be <b>NULL</b>.

       <u>id</u>     This is a numeric identifier that is passed through to the HTTP state machine.  It  is  accessible
              via  the  log  field  <u>piid</u>. This is intended as a connection identifier and should be distinct for
              every call to <u>TSHttpConnectWithPluginId()</u>.  The easiest mechanism is to  define  a  plugin  global
              value  and  increment it for each connection. The value <b>0</b> is reserved to mean "not set" and can be
              used as a default if this functionality is not needed.

       The virtual connection returned as the <u>TSVConn</u> is API equivalent to a network virtual connection both  to
       the  plugin  and  to  internal  mechanisms. Data is read and written to the connection (and thence to the
       target system) by reading and writing on this virtual connection.

       <b>NOTE:</b>
          This function only opens the connection. To drive the transaction an actual HTTP request must be  sent
          and  the  HTTP  response handled. The transaction is handled as a standard HTTP transaction and all of
          the standard configuration options and plugins will operate on it.

       The combination of <u>tag</u> and <u>id</u> is  intended  to  enable  correlation  in  log  post  processing.  The  <u>tag</u>
       identifies  the  connection  as  related  to the plugin and the <u>id</u> can be used in conjunction with plugin
       generated logs to correlate the log records.

</pre><h4><b>NOTES</b></h4><pre>
       The H2 implementation uses this to correlate client sessions with H2 streams. Each client  connection  is
       assigned  a distinct numeric identifier. This is passed as the <u>id</u> to <u>TSHttpConnectWithPluginId()</u>. The <u>tag</u>
       is selected to be the NPN string for the client session protocol, e.g.  "h2".  Log  post  processing  can
       then  count  the  number  of connections for the various supported protocols and the number of H2 virtual
       streams for each real client connection to Traffic Server.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3ts/TSHttpConnectPlugin.3ts.html">TSHttpConnectPlugin</a>(3ts)</b>, <b><a href="../man3ts/TSHttpConnect.3ts.html">TSHttpConnect</a>(3ts)</b>, <b><a href="../man3ts/TSNetConnect.3ts.html">TSNetConnect</a>(3ts)</b>, <b><a href="../man3ts/TSAPI.3ts.html">TSAPI</a>(3ts)</b>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2025, <a href="mailto:dev@trafficserver.apache.org">dev@trafficserver.apache.org</a>

9.2                                               May 22, 2025                    <u><a href="../man3ts/TSHTTPCONNECTWITHPLUGINID.3ts.html">TSHTTPCONNECTWITHPLUGINID</a></u>(3ts)
</pre>
 </div>
</div></section>
</div>
</body>
</html>