<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test2::Manual::Tooling::Plugin::TestExit - How to safely add pre-exit behaviors.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/perl-doc">perl-doc_5.40.1-5_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Test2::Manual::Tooling::Plugin::TestExit - How to safely add pre-exit behaviors.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This describes the correct/safe way to add pre-exit behaviors to tests via a custom plugin.

       The naive way to attempt this would be to add an "END { ... }" block. That can work, and may not cause
       problems.... On the other hand there are a lot of ways that can bite you. Describing all the potential
       problems of an END block, and how it might conflict with Test2 (Which has its own END block) is beyond
       the scope of this document.

</pre><h4><b>COMPLETE</b> <b>CODE</b> <b>UP</b> <b>FRONT</b></h4><pre>
           package Test2::Plugin::MyPlugin;

           use Test2::API qw{test2_add_callback_exit};

           sub import {
               my $class = shift;

               test2_add_callback_exit(sub {
                   my ($ctx, $orig_code, $new_exit_code_ref) = @_;

                   return if $orig_code == 42;

                   $$new_exit_code_ref = 42;
               });
           }

           1;

</pre><h4><b>LINE</b> <b>BY</b> <b>LINE</b></h4><pre>
       use Test2::API qw{test2_add_callback_exit};
           This imports the "(test2_add_callback_exit)" callback.

       test2_add_callback_exit(sub { ... });
           This adds our callback to be called before exiting.

       my ($ctx, $orig_code, $new_exit_code_ref) = @_
           The callback gets 3 arguments. First is a context object you may use. The second is the original exit
           code of the "END" block Test2 is using. The third argument is a scalar reference which you may use to
           get the current exit code, or set a new one.

       return if $orig_code == 42
           This is a short-cut to do nothing if the original exit code was already 42.

       $$new_exit_code_ref = 42
           This changes the exit code to 42.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Test2::Manual - Primary index of the manual.

</pre><h4><b>SOURCE</b></h4><pre>
       The source code repository for Test2-Manual can be found at <u>https://github.com/Test-More/Test2-Suite/</u>.

</pre><h4><b>MAINTAINERS</b></h4><pre>
       Chad Granum &lt;<a href="mailto:exodist@cpan.org">exodist@cpan.org</a>&gt;

</pre><h4><b>AUTHORS</b></h4><pre>
       Chad Granum &lt;<a href="mailto:exodist@cpan.org">exodist@cpan.org</a>&gt;

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2018 Chad Granum &lt;<a href="mailto:exodist@cpan.org">exodist@cpan.org</a>&gt;.

       This  program  is  free  software;  you can redistribute it and/or modify it under the same terms as Perl
       itself.

       See <u><a href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></u>

perl v5.40.1                                       2025-07-03             <u>Test2::Manual:...ugin::<a href="../man3perl/TestExit.3perl.html">TestExit</a></u>(3perl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>