<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apache2::PerlSections - write Apache configuration files in Perl</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libapache2-mod-perl2">libapache2-mod-perl2_2.0.13-2build1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Apache2::PerlSections - write Apache configuration files in Perl

</pre><h4><b>Synopsis</b></h4><pre>
         &lt;Perl&gt;
         @PerlModule = qw(Mail::Send Devel::Peek);

         #run the server as whoever starts it
         $User  = getpwuid(&gt;) || &gt;;
         $Group = getgrgid()) || );

         $ServerAdmin = $User;

         &lt;/Perl&gt;

</pre><h4><b>Description</b></h4><pre>
       With "&lt;Perl&gt;"..."&lt;/Perl&gt;" sections, it is possible to configure your server entirely in Perl.

       "&lt;Perl&gt;" sections can contain <u>any</u> and as much Perl code as you wish. These sections are compiled into a
       special package whose symbol table mod_perl can then walk and grind the names and values of Perl
       variables/structures through the Apache core configuration gears.

       Block sections such as "&lt;Location&gt;".."&lt;/Location&gt;" are represented in a %Location hash, e.g.:

         &lt;Perl&gt;
         $Location{"/~dougm/"} = {
           AuthUserFile   =&gt; '/tmp/htpasswd',
           AuthType       =&gt; 'Basic',
           AuthName       =&gt; 'test',
           DirectoryIndex =&gt; [qw(index.html index.htm)],
           Limit          =&gt; {
               "GET POST"    =&gt; {
                   require =&gt; 'user dougm',
               }
           },
         };
         &lt;/Perl&gt;

       If an Apache directive can take two or three arguments you may push strings (the lowest number of
       arguments will be shifted off the @list) or use an array reference to handle any number greater than the
       minimum for that directive:

         push @Redirect, "/foo", "<a href="http://www.foo.com/">http://www.foo.com/</a>";

         push @Redirect, "/imdb", "<a href="http://www.imdb.com/">http://www.imdb.com/</a>";

         push @Redirect, [qw(temp "/here" "<a href="http://www.there.com">http://www.there.com</a>")];

       Other section counterparts include %VirtualHost, %Directory and %Files.

       To pass all environment variables to the children with a single configuration directive, rather than
       listing each one via "PassEnv" or "PerlPassEnv", a "&lt;Perl&gt;" section could read in a file and:

         push @PerlPassEnv, [$key =&gt; $val];

       or

         Apache2-&gt;httpd_conf("PerlPassEnv $key $val");

       These are somewhat simple examples, but they should give you the basic idea. You can mix in any Perl code
       you desire. See <u>eg/httpd.conf.pl</u> and <u>eg/perl_sections.txt</u> in the mod_perl distribution for more examples.

       Assume that you have a cluster of machines with similar configurations and only small distinctions
       between them: ideally you would want to maintain a single configuration file, but because the
       configurations aren't <u>exactly</u> the same (e.g. the "ServerName" directive) it's not quite that simple.

       "&lt;Perl&gt;" sections come to rescue. Now you have a single configuration file and the full power of Perl to
       tweak the local configuration. For example to solve the problem of the "ServerName" directive you might
       have this "&lt;Perl&gt;" section:

         &lt;Perl&gt;
         $ServerName = `hostname`;
         &lt;/Perl&gt;

       For example if you want to allow personal directories on all machines except the ones whose names start
       with <u>secure</u>:

         &lt;Perl&gt;
         $ServerName = `hostname`;
         if ($ServerName !~ /^secure/) {
             $UserDir = "public.html";
         }
         else {
             $UserDir = "DISABLED";
         }
         &lt;/Perl&gt;

</pre><h4><b>API</b></h4><pre>
       "Apache2::PerlSections" provides the following functions and/or methods:

   <b>"server"</b>
       Get the current server's object for the &lt;Perl&gt; section

         &lt;Perl&gt;
           $s = Apache2::PerlSections-&gt;server();
         &lt;/Perl&gt;

       obj: "Apache2::PerlSections" (class name)
       ret: $s ( "Apache2::ServerRec object" )
       since: 2.0.03

</pre><h4><b>@PerlConfig</b> <b>and</b> <b>$PerlConfig</b></h4><pre>
       This  array  and scalar can be used to introduce literal configuration into the apache configuration. For
       example:

         push @PerlConfig, 'Alias /foo /bar';

       Or:
         $PerlConfig .= "Alias /foo /bar\n";

       See also "$r-&gt;add_config"

</pre><h4><b>Configuration</b> <b>Variables</b></h4><pre>
       There are a few variables that can be set to change the default behaviour of "&lt;Perl&gt;" sections.

   <b>$Apache2::PerlSections::Save</b>
       Each "&lt;Perl&gt;" section is evaluated in its unique namespace, by default residing  in  a  sub-namespace  of
       "Apache2::ReadConfig::",  therefore  any  local variables will end up in that namespace. For example if a
       "&lt;Perl&gt;"  section  happened  to  be  in  file  <u>/tmp/httpd.conf</u>  starting  on  line  20,  the   namespace:
       "Apache2::ReadConfig::tmp::httpd_conf::line_20" will be used. Now if it had:

         &lt;Perl&gt;
           $foo     = 5;
           my $bar  = 6;
           $My::tar = 7;
         &lt;/Perl&gt;

       The  local  global  variable  $foo becomes $Apache2::ReadConfig::tmp::httpd_conf::line_20::foo, the other
       variable remain where they are.

       By default, the namespace in which "&lt;Perl&gt;" sections are evaluated is cleared after each block closes. In
       our example nuking $Apache2::ReadConfig::tmp::httpd_conf::line_20::foo, leaving the rest untouched.

       By setting $Apache2::PerlSections::Save to a  true  value,  the  content  of  those  namespaces  will  be
       preserved  and will be available for inspection by "Apache2::Status" and "Apache2::PerlSections-&gt;dump" In
       our example $Apache2::ReadConfig::tmp::httpd_conf::line_20::foo will still be accessible from other  perl
       code, after the "&lt;Perl&gt;" section was parsed.

</pre><h4><b>PerlSections</b> <b>Dumping</b></h4><pre>
   <b>"Apache2::PerlSections-&gt;dump"</b>
       This  method  will dump out all the configuration variables mod_perl will be feeding to the apache config
       gears. The output is suitable to read back in via "eval".

         my $dump = Apache2::PerlSections-&gt;dump;

       ret: $dump ( string / "undef" )
           A string dump of all the Perl code encountered in &lt;Perl&gt; blocks, suitable to be read back via "eval"

       For example:

         &lt;Perl&gt;

         $Apache2::PerlSections::Save = 1;

         $Listen = 8529;

         $Location{"/perl"} = {
            SetHandler =&gt; "perl-script",
            PerlHandler =&gt; "ModPerl::Registry",
            Options =&gt; "ExecCGI",
         };

         @DirectoryIndex = qw(index.htm index.html);

         $VirtualHost{"www.foo.com"} = {
            DocumentRoot =&gt; "/tmp/docs",
            ErrorLog =&gt; "/dev/null",
            Location =&gt; {
              "/" =&gt; {
                Allowoverride =&gt; 'All',
                Order =&gt; 'deny,allow',
                Deny  =&gt; 'from all',
                Allow =&gt; 'from foo.com',
              },
            },
         };
         &lt;/Perl&gt;

         &lt;Perl&gt;
         print Apache2::PerlSections-&gt;dump;
         &lt;/Perl&gt;

       This will print something like this:

         $Listen = 8529;

         @DirectoryIndex = (
           'index.htm',
           'index.html'
         );

         $Location{'/perl'} = (
             PerlHandler =&gt; 'Apache2::Registry',
             SetHandler =&gt; 'perl-script',
             Options =&gt; 'ExecCGI'
         );

         $VirtualHost{'www.foo.com'} = (
             Location =&gt; {
               '/' =&gt; {
                 Deny =&gt; 'from all',
                 Order =&gt; 'deny,allow',
                 Allow =&gt; 'from foo.com',
                 Allowoverride =&gt; 'All'
               }
             },
             DocumentRoot =&gt; '/tmp/docs',
             ErrorLog =&gt; '/dev/null'
         );

         1;
         __END__

       It is important to put the call to "dump" in it's own "&lt;Perl&gt;" section,  otherwise  the  content  of  the
       current "&lt;Perl&gt;" section will not be dumped.

   <b>"Apache2::PerlSections-&gt;store"</b>
       This  method  will  call  the  "dump"  method, writing the output to a file, suitable to be pulled in via
       "require" or "do".

         Apache2::PerlSections-&gt;store($filename);

       arg1: $filename (string)
           The filename to save the dump output to

       ret: no return value

</pre><h4><b>Advanced</b> <b>API</b></h4><pre>
       mod_perl  2.0  now  introduces  the  same   general   concept   of   handlers   to   "&lt;Perl&gt;"   sections.
       Apache2::PerlSections simply being the default handler for them.

       To  specify  a different handler for a given perl section, an extra handler argument must be given to the
       section:

         &lt;Perl handler="My::PerlSection::Handler" somearg="test1"&gt;
           $foo = 1;
           $bar = 2;
         &lt;/Perl&gt;

       And in My/PerlSection/Handler.pm:

         sub My::Handler::handler : handler {
             my ($self, $parms, $args) = @_;
             #do your thing!
         }

       So, when that given "&lt;Perl&gt;" block in encountered, the code within will  first  be  evaluated,  then  the
       handler routine will be invoked with 3 arguments:

       arg1: $self
           self-explanatory

       arg2: $parms ( "Apache2::CmdParms" )
           $parms  is specific for the current Container, for example, you might want to call "$parms-&gt;server()"
           to get the current server.

       arg3: $args ( "APR::Table object")
           the table object of the section arguments. The 2 guaranteed ones will be:

             $args-&gt;{'handler'} = 'My::PerlSection::Handler';
             $args-&gt;{'package'} = 'Apache2::ReadConfig';

           Other "name="value"" pairs given on the "&lt;Perl&gt;" line will also be included.

       At this point, it's up to the handler routing to inspect the  namespace  of  the  $args-&gt;{'package'}  and
       chooses what to do.

       The  most  likely  thing  to  do  is  to  feed  configuration  data  back  into  apache.  To do that, use
       Apache2::Server-&gt;add_config("directive"), for example:

         $parms-&gt;server-&gt;add_config("Alias /foo /bar");

       Would create a new alias. The source code of "Apache2::PerlSections" is  a  good  place  to  look  for  a
       practical example.

</pre><h4><b>Verifying</b> <b>"&lt;Perl&gt;"</b> <b>Sections</b></h4><pre>
       If the "&lt;Perl&gt;" sections include no code requiring a running mod_perl, it is possible to check those from
       the command line. But the following trick should be used:

         # file: httpd.conf
         &lt;Perl&gt;
         #!perl

         # ... code here ...

         __END__
         &lt;/Perl&gt;

       Now you can run:

         % perl -c httpd.conf

</pre><h4><b>Bugs</b></h4><pre>
   <b>&lt;Perl&gt;</b> <b>directive</b> <b>missing</b> <b>closing</b> <b>'&gt;'</b>
       httpd-2.0.47  had  a  bug in the configuration parser which caused the startup failure with the following
       error:

         Starting httpd:
         Syntax error on line ... of /etc/httpd/conf/httpd.conf:
         &lt;Perl&gt; directive missing closing '&gt;'     [FAILED]

       This has been fixed in httpd-2.0.48. If you can't upgrade to this or a higher version, please add a space
       before the closing '&gt;' of the opening tag as a workaround. So if you had:

         &lt;Perl&gt;
         # some code
         &lt;/Perl&gt;

       change it to be:

         &lt;Perl &gt;
         # some code
         &lt;/Perl&gt;

   <b>&lt;Perl&gt;[...]&gt;</b> <b>was</b> <b>not</b> <b>closed.</b>
       On encountering a one-line &lt;Perl&gt; block, httpd's configuration parser will cause a startup  failure  with
       an error similar to this one:

         Starting httpd:
         Syntax error on line ... of /etc/httpd/conf/httpd.conf:
         &lt;Perl&gt;use&gt; was not closed.

       If you have written a simple one-line &lt;Perl&gt; section like this one :

         &lt;Perl&gt;use Apache::DBI;&lt;/Perl&gt;

       change it to be:

          &lt;Perl&gt;
          use Apache::DBI;
          &lt;/Perl&gt;

       This  is  caused by a limitation of httpd's configuration parser and is not likely to be changed to allow
       one-line block like the example above. Use multi-line blocks instead.

</pre><h4><b>See</b> <b>Also</b></h4><pre>
       mod_perl 2.0 documentation.

</pre><h4><b>Copyright</b></h4><pre>
       mod_perl 2.0 and its core modules are copyrighted under The Apache Software License, Version 2.0.

</pre><h4><b>Authors</b></h4><pre>
       The mod_perl development team and numerous contributors.

perl v5.40.0                                       2024-10-20              <u>libapache2-mod...2::<a href="../man3pm/PerlSections.3pm.html">PerlSections</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>