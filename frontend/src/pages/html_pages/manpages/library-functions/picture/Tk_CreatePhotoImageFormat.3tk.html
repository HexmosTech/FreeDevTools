<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tk_CreatePhotoImageFormat - define new file format for photo images</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/tk9.0-doc">tk9.0-doc_9.0.1-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Tk_CreatePhotoImageFormat - define new file format for photo images

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;tk.h&gt;</b>

       <b>Tk_CreatePhotoImageFormatVersion3</b>(<u>formatVersion3Ptr</u>)                                                      2

       <b>Tk_CreatePhotoImageFormat</b>(<u>formatPtr</u>)

</pre><h4><b>ARGUMENTS</b></h4><pre>
       const Tk_PhotoImageFormatVersion3 <u>*formatVersion3Ptr</u> (in)                                                 2
                                                                          Structure  that  defines  the new file 2
                                                                          format       including        metadata 2
                                                                          functionality.

       const Tk_PhotoImageFormat <u>*formatPtr</u> (in)                          Structure  that  defines  the new file
                                                                          format.
________________________________________________________________________________________________________________

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>Tk_CreatePhotoImageFormatVersion3</b> is invoked to define a new file format for  image  data  for  use  with
       photo  images.   The code that implements an image file format is called an image file format handler, or
       handler for short.  The photo image code maintains a list of handlers that can be used to read and  write
       data  to  or  from a file.  Some handlers may also support reading image data from a string or converting
       image data to a string format.  The user can  specify  which  handler  to  use  with  the  <b>-format</b>  image
       configuration option or the <b>-format</b> option to the <b>read</b> and <b>write</b> photo image subcommands.

       The  alternate  version  2  function  <b>Tk_CreatePhotoImageFormat</b> has identical functionality, but does not
       allow the handler to get or return the metadata dictionary of the image.   It  is  described  in  section
       <b>VERSION</b> <b>2</b> <b>INTERFACE</b> below.

       An  image  file  format handler consists of a collection of procedures plus a <b>Tk_PhotoImageFormatVersion3</b>
       structure, which contains the name of the image file format and pointers to six  procedures  provided  by
       the  handler  to  deal  with files and strings in this format.  The Tk_PhotoImageFormatVersion3 structure
       contains the following fields:                                                                            2
              typedef struct {                                                                                   2
                  const char *<u>name</u>;                                                                              2
                  Tk_ImageFileMatchProcVersion3 *<u>fileMatchProc</u>;                                                  2
                  Tk_ImageStringMatchProcVersion3 *<u>stringMatchProc</u>;                                              2
                  Tk_ImageFileReadProcVersion3 *<u>fileReadProc</u>;                                                    2
                  Tk_ImageStringReadProcVersion3 *<u>stringReadProc</u>;                                                2
                  Tk_ImageFileWriteProcVersion3 *<u>fileWriteProc</u>;                                                  2
                  Tk_ImageStringWriteProcVersion3 *<u>stringWriteProc</u>;                                              2
              } <b>Tk_PhotoImageFormatVersion3</b>;                                                                     2

       The handler need not provide implementations of all six procedures.  For  example,  the  procedures  that
       handle  string  data would not be provided for a format in which the image data are stored in binary, and
       could therefore contain null characters.  If any procedure is not implemented, the corresponding  pointer
       in  the  Tk_PhotoImageFormat structure should be set to NULL.  The handler must provide the <u>fileMatchProc</u>
       procedure if it provides the <u>fileReadProc</u> procedure, and the <u>stringMatchProc</u> procedure if it provides the
       <u>stringReadProc</u> procedure.

   <b>NAME</b>
       <u>formatPtr-&gt;name</u> provides a name for the image type.  Once <b>Tk_CreatePhotoImageFormatVersion3</b> returns, this
       name may be used in the <b>-format</b> photo image configuration and subcommand option.  The manual page for the
       photo image (<a href="../man3tk/photo.3tk.html">photo</a>(3tk)) describes how image file formats are chosen based on their names and  the  value
       given  to  the  <b>-format</b> option. The first character of <u>formatPtr-&gt;name</u> must not be an uppercase character
       from the ASCII character set (that is, one of the characters <b>A</b>-<b>Z</b>).  Such names are used only  for  legacy
       interface support (see below).                                                                            2

   <b>FILEMATCHPROC</b>                                                                                                 2
       <u>formatPtr-&gt;fileMatchProc</u>  provides  the address of a procedure for Tk to call when it is searching for an 2
       image file format handler suitable for reading data in a given file.  <u>formatPtr-&gt;fileMatchProc</u> must match 2
       the following prototype:                                                                                  2
              typedef int <b>Tk_ImageFileMatchProcVersion3</b>(                                                         2
                      Tcl_Interp *<u>interp</u>,                                                                        2
                      Tcl_Channel <u>chan</u>,                                                                          2
                      const char *<u>fileName</u>,                                                                      2
                      Tcl_Obj *<u>format</u>,                                                                           2
                      Tcl_Obj *<u>metadataIn</u>,                                                                       2
                      int *<u>widthPtr</u>,                                                                             2
                      int *<u>heightPtr</u>,                                                                            2
                      Tcl_Obj *<u>metadataOut</u>);                                                                     2
       The <u>fileName</u> argument is the name of the file containing the image data, which is  open  for  reading  as 2
       <u>chan</u>.  The <u>format</u> argument contains the value given for the <b>-format</b> option, or NULL if the option was not 2
       specified.   <b>metadataIn</b>  and <b>metadataOut</b> inputs and returns a metadata dictionary as described in section 2
       <b>METADATA</b> <b>INTERFACE</b> below.  If the data in the file appears to be in the format supported by this handler, 2
       the <u>formatPtr-&gt;fileMatchProc</u> procedure should store the width and height of the image  in  *<u>widthPtr</u>  and 2
       *<u>heightPtr</u> respectively, and return 1.  Otherwise it should return 0.                                     2

   <b>STRINGMATCHPROC</b>                                                                                               2
       <u>formatPtr-&gt;stringMatchProc</u> provides the address of a procedure for Tk to call when it is searching for an 2
       image file format handler suitable for reading data from a given string.  <u>formatPtr-&gt;stringMatchProc</u> must 2
       match the following prototype:                                                                            2
              typedef int <b>Tk_ImageStringMatchProcVersion3</b>(                                                       2
                      Tcl_Interp *<u>interp</u>,                                                                        2
                      Tcl_Obj *<u>data</u>,                                                                             2
                      Tcl_Obj *<u>format</u>,                                                                           2
                      Tcl_Obj *<u>metadataIn</u>,                                                                       2
                      int *<u>widthPtr</u>,                                                                             2
                      int *<u>heightPtr</u>,                                                                            2
                      Tcl_Obj *<u>metadataOut</u>);                                                                     2
       The <u>data</u> argument points to the object containing the image data.  The <u>format</u> argument contains the value 2
       given for the <b>-format</b> option, or NULL if the option was not specified.  <b>metadataIn</b> and <b>metadataOut</b> inputs 2
       and  returns  a metadata dictionary as described in section <b>METADATA</b> <b>INTERFACE</b> below.  If the data in the 2
       string appears to be in the format supported by this handler,  the  <u>formatPtr-&gt;stringMatchProc</u>  procedure 2
       should  store  the  width and height of the image in *<u>widthPtr</u> and *<u>heightPtr</u> respectively, and return 1. 2
       Otherwise it should return 0.                                                                             2

   <b>FILEREADPROC</b>                                                                                                  2
       <u>formatPtr-&gt;fileReadProc</u> provides the address of a procedure for Tk to call to read  data  from  an  image 2
       file into a photo image.  <u>formatPtr-&gt;fileReadProc</u> must match the following prototype:                     2
              typedef int <b>Tk_ImageFileReadProcVersion3</b>(                                                          2
                      Tcl_Interp *<u>interp</u>,                                                                        2
                      Tcl_Channel <u>chan</u>,                                                                          2
                      const char *<u>fileName</u>,                                                                      2
                      Tcl_Obj *<u>format</u>,                                                                           2
                      Tcl_Obj *<u>metadataIn</u>,                                                                       2
                      PhotoHandle <u>imageHandle</u>,                                                                   2
                      int <u>destX</u>, int <u>destY</u>,                                                                      2
                      int <u>width</u>, int <u>height</u>,                                                                     2
                      int <u>srcX</u>, int <u>srcY</u>,                                                                        2
                      Tcl_Obj *<u>metadataOut</u>);                                                                     2
       The  <u>interp</u>  argument is the interpreter in which the command was invoked to read the image; it should be 2
       used for reporting errors.  The image data is in the file named <u>fileName</u>, which is open  for  reading  as 2
       <u>chan</u>.  The <u>format</u> argument contains the value given for the <b>-format</b> option, or NULL if the option was not 2
       specified.   The  image  data  in  the  file,  or  a  subimage  of it, is to be read into the photo image 2
       identified by the handle <u>imageHandle</u>.  The subimage of the data in the file  is  of  dimensions  <u>width</u>  x 2
       <u>height</u>  and  has  its  top-left corner at coordinates (<u>srcX</u>,<u>srcY</u>).  It is to be stored in the photo image 2
       with its top-left corner at coordinates (<u>destX</u>,<u>destY</u>) using the <b>Tk_PhotoPutBlock</b>  procedure.   <b>metadataIn</b> 2
       and  <b>metadataOut</b>  inputs  and  returns  a  metadata dictionary as described in section <b>METADATA</b> <b>INTERFACE</b> 2
       below.  The return value is a standard Tcl return value.                                                  2

   <b>STRINGREADPROC</b>                                                                                                2
       <u>formatPtr-&gt;stringReadProc</u> provides the address of a procedure for Tk to call to read data from  a  string 2
       into a photo image.  <u>formatPtr-&gt;stringReadProc</u> must match the following prototype:                        2
              typedef int <b>Tk_ImageStringReadProcVersion3</b>(                                                        2
                      Tcl_Interp *<u>interp</u>,                                                                        2
                      Tcl_Obj *<u>data</u>,                                                                             2
                      Tcl_Obj *<u>format</u>,                                                                           2
                      Tcl_Obj *<u>metadataIn</u>,                                                                       2
                      PhotoHandle <u>imageHandle</u>,                                                                   2
                      int <u>destX</u>, int <u>destY</u>,                                                                      2
                      int <u>width</u>, int <u>height</u>,                                                                     2
                      int <u>srcX</u>, int <u>srcY</u>,                                                                        2
                      Tcl_Obj *<u>metadataOut</u>);                                                                     2
       The  <u>interp</u>  argument is the interpreter in which the command was invoked to read the image; it should be 2
       used for reporting errors.  The <u>data</u> argument points to the  image  data  in  object  form.   The  <u>format</u> 2
       argument  contains  the value given for the <b>-format</b> option, or NULL if the option was not specified.  The 2
       image data in the string, or a subimage of it, is to be read into  the  photo  image  identified  by  the 2
       handle  <u>imageHandle</u>.   The subimage of the data in the string is of dimensions <u>width</u> x <u>height</u> and has its 2
       top-left corner at coordinates (<u>srcX</u>,<u>srcY</u>).  It is to be stored in the  photo  image  with  its  top-left 2
       corner  at  coordinates  (<u>destX</u>,<u>destY</u>)  using the <b>Tk_PhotoPutBlock</b> procedure.  <b>metadataIn</b> and <b>metadataOut</b> 2
       inputs and returns a metadata dictionary as described in section <b>METADATA</b> <b>INTERFACE</b>  below.   The  return 2
       value is a standard Tcl return value.                                                                     2

   <b>FILEWRITEPROC</b>                                                                                                 2
       <u>formatPtr-&gt;fileWriteProc</u>  provides  the  address of a procedure for Tk to call to write data from a photo 2
       image to a file.  <u>formatPtr-&gt;fileWriteProc</u> must match the following prototype:                            2
              typedef int <b>Tk_ImageFileWriteProcVersion3</b>(                                                         2
                      Tcl_Interp *<u>interp</u>,                                                                        2
                      const char *<u>fileName</u>,                                                                      2
                      Tcl_Obj *<u>format</u>,                                                                           2
                      Tcl_Obj *<u>metadataIn</u>,                                                                       2
                      Tk_PhotoImageBlock *<u>blockPtr</u>);                                                             2
       The <u>interp</u> argument is the interpreter in which the command was invoked to write the image; it should  be 2
       used  for  reporting  errors.   The  image  data  to  be  written  are in memory and are described by the 2
       Tk_PhotoImageBlock structure pointed to by <u>blockPtr</u>; see the manual page <a href="../man3tk/FindPhoto.3tk.html">FindPhoto</a>(3tk) for details.  The 2
       <u>fileName</u> argument points to the string giving the name of the file in which to write the image data.  The 2
       <u>format</u> argument contains the value given for the <b>-format</b> option, or NULL if the option was not specified. 2
       The format string can contain extra characters after  the  name  of  the  format.   If  appropriate,  the 2
       <u>formatPtr-&gt;fileWriteProc</u>  procedure  may  interpret these characters to specify further details about the 2
       image file.  <b>metadataIn</b> may contain metadata keys that a driver may include into the  output  data.   The 2
       return value is a standard Tcl return value.                                                              2

   <b>STRINGWRITEPROC</b>                                                                                               2
       <u>formatPtr-&gt;stringWriteProc</u>  provides  the  address  of a procedure for Tk to call to translate image data 2
       from a photo image into a string.  <u>formatPtr-&gt;stringWriteProc</u> must match the following prototype:         2
              typedef int <b>Tk_ImageStringWriteProcVersion3</b>(                                                       2
                      Tcl_Interp *<u>interp</u>,                                                                        2
                      Tcl_Obj *<u>format</u>,                                                                           2
                      Tcl_Obj *<u>metadataIn</u>,                                                                       2
                      Tk_PhotoImageBlock *<u>blockPtr</u>);                                                             2
       The <u>interp</u> argument is the interpreter in which the command was invoked to convert the image;  it  should 2
       be  used  for  reporting  errors.   The image data to be converted are in memory and are described by the 2
       Tk_PhotoImageBlock structure pointed to by <u>blockPtr</u>; see the manual page <a href="../man3tk/FindPhoto.3tk.html">FindPhoto</a>(3tk) for details.  The 2
       data for the string should be put in the interpreter <u>interp</u> result.  The  <u>format</u>  argument  contains  the 2
       value  given  for  the  <b>-format</b>  option,  or NULL if the option was not specified.  The format string can 2
       contain extra characters after the name of the format.  If  appropriate,  the  <u>formatPtr-&gt;stringWriteProc</u> 2
       procedure may interpret these characters to specify further details about the image file.  <b>metadataIn</b> may 2
       contain metadata keys that a driver may include into the output data.  The return value is a standard Tcl 2
       return value.                                                                                             2

<b>METADATA</b> <b>INTERFACE</b>                                                                                               2
       Image formats contain a description of the image bitmap and may contain additional information like image 2
       resolution  or  comments.   Image metadata may be read from image files and passed to the script level by 2
       including dictionary keys into the metadata property of the image. Image metadata may be written to image 2
       data on file write or image data output.                                                                  2

   <b>METADATA</b> <b>KEYS</b>                                                                                                 2
       The metadata may contain any key.  A driver will handle only a set of dictionary keys documented  in  the 2
       documentation. See the photo image manual page for currently defined keys for the system drivers.         2

       The following rules may give guidance to name metadata keys:                                              2

       •                                                                                                         2
              Abbreviations are in upper case.                                                                   2

       •                                                                                                         2
              Words are in US English in small case (except proper nouns)                                        2

       •                                                                                                         2
              Vertical DPI is expressed as DPI/aspect. The reason is, that some image formats may feature aspect 2
              and no resolution value.                                                                           2

   <b>METADATA</b> <b>INPUT</b>                                                                                                2
       Each  driver function gets a Tcl object pointer <b>metadataIn</b> as parameter. This parameter serves to input a 2
       metadata dict to the driver function.  It may be NULL to flag that the metadata dict is empty.            2

       A typical driver code snipped to check for a metadata key is:                                             2
              if (NULL != metadataIn) {                                                                          2
                  Tcl_Obj *itemData;                                                                             2
                  Tcl_DictObjGet(interp, metadataIn, Tcl_NewStringObj("Comment",-1),                             2
                          &amp;itemData));                                                                           2
                  // use value reference in itemData                                                             2
              }                                                                                                  2

       The <b>-metadata</b> command option data of the following commands  is  passed  to  the  driver:  <b>image</b>  <b>create</b>, 2
       <b>configure</b>,  <b>put</b>,  <b>read</b>,  <b>data</b>  and  <b>write</b>.   If  no  <b>-metadata</b> command option available or not given, the 2
       metadata property of the image is passed to the driver using the  following  commands:  <b>cget</b>,  <b>configure</b>, 2
       <b>data</b> and <b>write</b>.                                                                                           2

       Note  that  setting  the <b>-metadata</b> property of an image using <b>configure</b> without any other option does not 2
       invoke any driver function.                                                                               2

       The metadata dictionary is not suited to pass options to the driver related to the bitmap representation, 2
       as the image bitmap is not recreated on a metadata change. The format string  should  be  used  for  this 2
       purpose.                                                                                                  2

   <b>METADATA</b> <b>OUTPUT</b>                                                                                               2
       The image match and read driver functions may set keys in a prepared metadata dict to return them.  Those 2
       functions  get  a Tcl object pointer <u>metadataOut</u> as parameter.  <u>metadataOut</u> may be NULL to indicate, that 2
       no metadata return is required (<b>put</b>, <b>read</b>  subcommands).  The  variable  pointed  to  by  <u>metadataOut</u>  is 2
       initialized  to  an  empty  unshared  dict  object  if metadata return is attended (<b>image</b> <b>create</b> command, 2
       <b>configure</b> subcommand). The driver may set dict keys in this  object  to  return  metadata.   If  a  match 2
       function succeeds, the metadataOut pointer is passed to the corresponding read function.                  2

       A sample driver code snippet is:                                                                          2
              if (NULL != metadataOut) {                                                                         2
                  Tcl_DictObjPut(NULL, metadataOut, Tcl_NewStringObj("XMP",-1),                                  2
                          Tcl_NewStringObj(xmpMetadata));                                                        2
              }                                                                                                  2

       The  metadata  keys  returned by the driver are merged into the present metadata property of the image or 2
       into the metadata dict given by the <b>-metadata</b> command line option.  At  the  script  level,  the  command 2
       <b>image</b> <b>create</b> and the <b>configure</b> method may return metadata from the driver.                                2

       Format  string  options  or  metadata keys may influence the creation of metadata within the driver.  For 2
       example, the creation of an expensive metadata key may depend on a format string option or on a  metadata 2
       input key.                                                                                                2

</pre><h4><b>VERSION</b> <b>2</b> <b>INTERFACE</b></h4><pre>
       Version 2 Interface does not include the possibility for the driver to use the metadata dict for input or
       output.

   <b>SYNOPSIS</b>
       <b>#include</b> <b>&lt;tk.h&gt;</b>

       <b>Tk_CreatePhotoImageFormat</b>(<u>formatPtr</u>)

   <b>ARGUMENTS</b>
       const Tk_PhotoImageFormat <u>*formatPtr</u> (in)          Structure that defines the new file format.
________________________________________________________________________________________________________________

   <b>DESCRIPTION</b>
       A  driver  using  the  version 2 interface invokes <b>Tk_CreatePhotoImageFormat</b> for driver registration. The
       Tk_PhotoImageFormat structure contains the following fields:
              typedef struct {
                  const char *<u>name</u>;
                  Tk_ImageFileMatchProc *<u>fileMatchProc</u>;
                  Tk_ImageStringMatchProc *<u>stringMatchProc</u>;
                  Tk_ImageFileReadProc *<u>fileReadProc</u>;
                  Tk_ImageStringReadProc *<u>stringReadProc</u>;
                  Tk_ImageFileWriteProc *<u>fileWriteProc</u>;
                  Tk_ImageStringWriteProc *<u>stringWriteProc</u>;
              } <b>Tk_PhotoImageFormat</b>;

   <b>FILEMATCHPROC</b>
       <u>formatPtr-&gt;fileMatchProc</u> must match the following prototype:
              typedef int <b>Tk_ImageFileMatchProc</b>(
                      Tcl_Channel <u>chan</u>,
                      const char *<u>fileName</u>,
                      Tcl_Obj *<u>format</u>,
                      int *<u>widthPtr</u>,
                      int *<u>heightPtr</u>,
                      Tcl_Interp *<u>interp</u>);

   <b>STRINGMATCHPROC</b>
       <u>formatPtr-&gt;stringMatchProc</u> must match the following prototype:
              typedef int <b>Tk_ImageStringMatchProc</b>(
                      Tcl_Obj *<u>data</u>,
                      Tcl_Obj *<u>format</u>,
                      int *<u>widthPtr</u>,
                      int *<u>heightPtr</u>,
                      Tcl_Interp *<u>interp</u>);

   <b>FILEREADPROC</b>
       <u>formatPtr-&gt;fileReadProc</u> must match the following prototype:
              typedef int <b>Tk_ImageFileReadProc</b>(
                      Tcl_Interp *<u>interp</u>,
                      Tcl_Channel <u>chan</u>,
                      const char *<u>fileName</u>,
                      Tcl_Obj *<u>format</u>,
                      PhotoHandle <u>imageHandle</u>,
                      int <u>destX</u>, int <u>destY</u>,
                      int <u>width</u>, int <u>height</u>,
                      int <u>srcX</u>, int <u>srcY</u>);

   <b>STRINGREADPROC</b>
       <u>formatPtr-&gt;stringReadProc</u> must match the following prototype:
              typedef int <b>Tk_ImageStringReadProc</b>(
                      Tcl_Interp *<u>interp</u>,
                      Tcl_Obj *<u>data</u>,
                      Tcl_Obj *<u>format</u>,
                      PhotoHandle <u>imageHandle</u>,
                      int <u>destX</u>, int <u>destY</u>,
                      int <u>width</u>, int <u>height</u>,
                      int <u>srcX</u>, int <u>srcY</u>);

   <b>FILEWRITEPROC</b>
       <u>formatPtr-&gt;fileWriteProc</u> must match the following prototype:
              typedef int <b>Tk_ImageFileWriteProc</b>(
                      Tcl_Interp *<u>interp</u>,
                      const char *<u>fileName</u>,
                      Tcl_Obj *<u>format</u>,
                      Tk_PhotoImageBlock *<u>blockPtr</u>);

   <b>STRINGWRITEPROC</b>
       <u>formatPtr-&gt;stringWriteProc</u> must match the following prototype:
              typedef int <b>Tk_ImageStringWriteProc</b>(
                      Tcl_Interp *<u>interp</u>,
                      Tcl_Obj *<u>format</u>,
                      Tk_PhotoImageBlock *<u>blockPtr</u>);

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Tk_FindPhoto, Tk_PhotoPutBlock

</pre><h4><b>KEYWORDS</b></h4><pre>
       photo image, image file

Tk                                                     9.0                        <u><a href="../man3tk/Tk_CreatePhotoImageFormat.3tk.html">Tk_CreatePhotoImageFormat</a></u>(3tk)
</pre>
 </div>
</div></section>
</div>
</body>
</html>