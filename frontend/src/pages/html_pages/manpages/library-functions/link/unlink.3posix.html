<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-posix-dev">manpages-posix-dev_2017a-2_all</a> <br><br><pre>
</pre><h4><b>PROLOG</b></h4><pre>
       This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface
       may differ (consult the corresponding Linux manual page for details of Linux behavior), or the  interface
       may not be implemented on Linux.

</pre><h4><b>NAME</b></h4><pre>
       unlink, unlinkat — remove a directory entry

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;

       int unlink(const char *<u>path</u>);

       #include &lt;<a href="file:/usr/include/fcntl.h">fcntl.h</a>&gt;

       int unlinkat(int <u>fd</u>, const char *<u>path</u>, int <u>flag</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <u>unlink</u>() function shall remove a link to a file. If <u>path</u> names a symbolic link, <u>unlink</u>() shall remove
       the  symbolic  link named by <u>path</u> and shall not affect any file or directory named by the contents of the
       symbolic link. Otherwise, <u>unlink</u>() shall remove the link named by the pathname pointed  to  by  <u>path</u>  and
       shall decrement the link count of the file referenced by the link.

       When  the  file's  link  count becomes 0 and no process has the file open, the space occupied by the file
       shall be freed and the file shall no longer be accessible. If one or more processes have  the  file  open
       when  the last link is removed, the link shall be removed before <u>unlink</u>() returns, but the removal of the
       file contents shall be postponed until all references to the file are closed.

       The <u>path</u> argument shall not name a directory unless  the  process  has  appropriate  privileges  and  the
       implementation supports using <u>unlink</u>() on directories.

       Upon  successful  completion,  <u>unlink</u>()  shall  mark  for update the last data modification and last file
       status change timestamps of the parent directory. Also, if the file's link count is not 0, the last  file
       status change timestamp of the file shall be marked for update.

       The  <u>unlinkat</u>() function shall be equivalent to the <u>unlink</u>() or <u>rmdir</u>() function except in the case where
       <u>path</u> specifies a relative path. In this case the directory entry to be removed is determined relative  to
       the  directory  associated  with  the file descriptor <u>fd</u> instead of the current working directory. If the
       access mode of the open file description associated  with  the  file  descriptor  is  not  O_SEARCH,  the
       function  shall  check  whether  directory  searches  are  permitted using the current permissions of the
       directory underlying the file descriptor. If the access mode is O_SEARCH, the function shall not  perform
       the check.

       Values  for  <u>flag</u>  are constructed by a bitwise-inclusive OR of flags from the following list, defined in
       <u>&lt;fcntl.h&gt;</u>:

       AT_REMOVEDIR
             Remove the directory entry specified by <u>fd</u> and <u>path</u> as a directory, not a normal file.

       If <u>unlinkat</u>() is passed the special value AT_FDCWD in the <u>fd</u> parameter,  the  current  working  directory
       shall  be  used  and  the  behavior  shall  be  identical  to a call to <u>unlink</u>() or <u>rmdir</u>() respectively,
       depending on whether or not the AT_REMOVEDIR bit is set in <u>flag</u>.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       Upon successful completion, these functions shall return 0. Otherwise, these functions  shall  return  -1
       and set <u>errno</u> to indicate the error. If -1 is returned, the named file shall not be changed.

</pre><h4><b>ERRORS</b></h4><pre>
       These functions shall fail and shall not unlink the file if:

       <b>EACCES</b> Search  permission  is denied for a component of the path prefix, or write permission is denied on
              the directory containing the directory entry to be removed.

       <b>EBUSY</b>  The file named by the <u>path</u> argument cannot be unlinked because it is being used by the  system  or
              another process and the implementation considers this an error.

       <b>ELOOP</b>  A loop exists in symbolic links encountered during resolution of the <u>path</u> argument.

       <b>ENAMETOOLONG</b>
              The length of a component of a pathname is longer than {NAME_MAX}.

       <b>ENOENT</b> A component of <u>path</u> does not name an existing file or <u>path</u> is an empty string.

       <b>ENOTDIR</b>
              A  component  of the path prefix names an existing file that is neither a directory nor a symbolic
              link to a directory, or the <u>path</u> argument contains at least one  non-&lt;slash&gt;  character  and  ends
              with  one  or  more  trailing &lt;slash&gt; characters and the last pathname component names an existing
              file that is neither a directory nor a symbolic link to a directory.

       <b>EPERM</b>  The file named by <u>path</u> is a directory, and either the calling process does  not  have  appropriate
              privileges, or the implementation prohibits using <u>unlink</u>() on directories.

       <b>EPERM</b> or <b>EACCES</b>
              The  S_ISVTX flag is set on the directory containing the file referred to by the <u>path</u> argument and
              the  process  does  not  satisfy  the  criteria  specified  in  the  Base  Definitions  volume  of
              POSIX.1‐2017, <u>Section</u> <u>4.3</u>, <u>Directory</u> <u>Protection</u>.

       <b>EROFS</b>  The directory entry to be unlinked is part of a read-only file system.

       The <u>unlinkat</u>() function shall fail if:

       <b>EACCES</b> The  access  mode  of  the  open  file  description  associated  with  <u>fd</u>  is not O_SEARCH and the
              permissions of the directory underlying <u>fd</u> do not permit directory searches.

       <b>EBADF</b>  The <u>path</u> argument does not specify an absolute path and the <u>fd</u> argument is neither AT_FDCWD nor  a
              valid file descriptor open for reading or searching.

       <b>ENOTDIR</b>
              The  <u>path</u>  argument  is  not  an  absolute path and <u>fd</u> is a file descriptor associated with a non-
              directory file.

       <b>EEXIST</b> or <b>ENOTEMPTY</b>
              The <u>flag</u> parameter has the AT_REMOVEDIR bit set and the <u>path</u> argument names a  directory  that  is
              not  an empty directory, or there are hard links to the directory other than dot or a single entry
              in dot-dot.

       <b>ENOTDIR</b>
              The <u>flag</u> parameter has the AT_REMOVEDIR bit set and <u>path</u> does not name a directory.

       These functions may fail and not unlink the file if:

       <b>EBUSY</b>  The file named by <u>path</u> is a named STREAM.

       <b>ELOOP</b>  More than {SYMLOOP_MAX} symbolic links were encountered during resolution of the <u>path</u> argument.

       <b>ENAMETOOLONG</b>
              The length of a pathname exceeds {PATH_MAX}, or pathname resolution of a symbolic link produced an
              intermediate result with a length that exceeds {PATH_MAX}.

       <b>ETXTBSY</b>
              The entry to be unlinked is the last directory entry to a pure procedure (shared text)  file  that
              is being executed.

       The <u>unlinkat</u>() function may fail if:

       <b>EINVAL</b> The value of the <u>flag</u> argument is not valid.

       <u>The</u> <u>following</u> <u>sections</u> <u>are</u> <u>informative.</u>

</pre><h4><b>EXAMPLES</b></h4><pre>
   <b>Removing</b> <b>a</b> <b>Link</b> <b>to</b> <b>a</b> <b>File</b>
       The  following  example  shows  how to remove a link to a file named <b>/home/cnd/mod1</b> by removing the entry
       named <b>/modules/pass1</b>.

           #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;

           char *path = "/modules/pass1";
           int   status;
           ...
           status = unlink(path);

   <b>Checking</b> <b>for</b> <b>an</b> <b>Error</b>
       The following example fragment creates a temporary password lock file named <b>LOCKFILE</b>, which is defined as
       <b>/etc/ptmp</b>, and gets a file descriptor for it. If the file cannot be opened for writing, <u>unlink</u>() is  used
       to remove the link between the file descriptor and <b>LOCKFILE</b>.

           #include &lt;sys/types.h&gt;
           #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
           #include &lt;<a href="file:/usr/include/fcntl.h">fcntl.h</a>&gt;
           #include &lt;<a href="file:/usr/include/errno.h">errno.h</a>&gt;
           #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;
           #include &lt;sys/stat.h&gt;

           #define LOCKFILE "/etc/ptmp"

           int pfd;  /* Integer for file descriptor returned by open call. */
           FILE *fpfd;  /* File pointer for use in putpwent(). */
           ...
           /* Open password Lock file. If it exists, this is an error. */
           if ((pfd = open(LOCKFILE, O_WRONLY| O_CREAT | O_EXCL, S_IRUSR
               | S_IWUSR | S_IRGRP | S_IROTH)) == -1)  {
               fprintf(stderr, "Cannot open /etc/ptmp. Try again later.\n");
               <a href="../man1/exit.1.html">exit</a>(1);
           }

           /* Lock file created; proceed with fdopen of lock file so that
              putpwent() can be used.
            */
           if ((fpfd = fdopen(pfd, "w")) == NULL) {
               close(pfd);
               unlink(LOCKFILE);
               <a href="../man1/exit.1.html">exit</a>(1);
           }

   <b>Replacing</b> <b>Files</b>
       The following example fragment uses <u>unlink</u>() to discard links to files, so that they can be replaced with
       new  versions  of  the  files. The first call removes the link to <b>LOCKFILE</b> if an error occurs. Successive
       calls remove the links to <b>SAVEFILE</b> and <b>PASSWDFILE</b> so that new links can be created, then removes the link
       to <b>LOCKFILE</b> when it is no longer needed.

           #include &lt;sys/types.h&gt;
           #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
           #include &lt;<a href="file:/usr/include/fcntl.h">fcntl.h</a>&gt;
           #include &lt;<a href="file:/usr/include/errno.h">errno.h</a>&gt;
           #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;
           #include &lt;sys/stat.h&gt;

           #define LOCKFILE "/etc/ptmp"
           #define PASSWDFILE "<a href="file:/etc/passwd">/etc/passwd</a>"
           #define SAVEFILE "/etc/opasswd"
           ...
           /* If no change was made, assume error and leave passwd unchanged. */
           if (!valid_change) {
               fprintf(stderr, "Could not change password for user %s\n", user);
               unlink(LOCKFILE);
               <a href="../man1/exit.1.html">exit</a>(1);
           }

           /* Change permissions on new password file. */
           chmod(LOCKFILE, S_IRUSR | S_IRGRP | S_IROTH);

           /* Remove saved password file. */
           unlink(SAVEFILE);

           /* Save current password file. */
           link(PASSWDFILE, SAVEFILE);

           /* Remove current password file. */
           unlink(PASSWDFILE);

           /* Save new password file as current password file. */
           link(LOCKFILE,PASSWDFILE);

           /* Remove lock file. */
           unlink(LOCKFILE);

           <a href="../man0/exit.0.html">exit</a>(0);

</pre><h4><b>APPLICATION</b> <b>USAGE</b></h4><pre>
       Applications should use <u>rmdir</u>() to remove a directory.

</pre><h4><b>RATIONALE</b></h4><pre>
       Unlinking a directory is restricted to the superuser in many historical implementations for reasons given
       in <u>link</u>() (see also <u>rename</u>()).

       The meaning of <b>[EBUSY]</b> in historical implementations is  ``mount  point  busy''.  Since  this  volume  of
       POSIX.1‐2017  does  not  cover  the  system  administration  concepts  of  mounting  and  unmounting, the
       description of the error was changed to ``resource busy''. (This meaning is used by some  device  drivers
       when  a  second  process  tries  to  open an exclusive use device.) The wording is also intended to allow
       implementations to refuse to remove a directory if it is the root or current  working  directory  of  any
       process.

       The  standard  developers reviewed TR 24715‐2006 and noted that LSB-conforming implementations may return
       <b>[EISDIR]</b> instead of <b>[EPERM]</b> when unlinking a directory. A change to permit this behavior by changing  the
       requirement  for  <b>[EPERM]</b> to <b>[EPERM]</b> or <b>[EISDIR]</b> was considered, but decided against since it would break
       existing strictly conforming and conforming applications. Applications written for  portability  to  both
       POSIX.1‐2008 and the LSB should be prepared to handle either error code.

       The  purpose  of  the  <u>unlinkat</u>()  function  is to remove directory entries in directories other than the
       current working directory without exposure to race conditions. Any part of the path of a  file  could  be
       changed  in  parallel  to  a  call  to  <u>unlink</u>(),  resulting  in  unspecified behavior. By opening a file
       descriptor for the target directory and using the <u>unlinkat</u>() function  it  can  be  guaranteed  that  the
       removed directory entry is located relative to the desired directory.

</pre><h4><b>FUTURE</b> <b>DIRECTIONS</b></h4><pre>
       None.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>close</u>(), <u>link</u>(), <u>remove</u>(), <u>rename</u>(), <u>rmdir</u>(), <u>symlink</u>()

       The Base Definitions volume of POSIX.1‐2017, <u>Section</u> <u>4.3</u>, <u>Directory</u> <u>Protection</u>, <b>&lt;fcntl.h&gt;</b>, <b>&lt;unistd.h&gt;</b>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1-2017, Standard
       for  Information  Technology  --  Portable  Operating  System  Interface  (POSIX),  The  Open  Group Base
       Specifications Issue 7, 2018 Edition, Copyright (C) 2018 by the Institute of Electrical  and  Electronics
       Engineers, Inc and The Open Group.  In the event of any discrepancy between this version and the original
       IEEE  and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document.
       The original Standard can be obtained online at <a href="http://www.opengroup.org/unix/online.html">http://www.opengroup.org/unix/online.html</a> .

       Any typographical or formatting errors that appear in this page are most likely to have  been  introduced
       during   the   conversion  of  the  source  files  to  man  page  format.  To  report  such  errors,  see
       https://www.kernel.org/doc/man-pages/reporting_bugs.html .

IEEE/The Open Group                                   2017                                        <u><a href="../man3POSIX/UNLINK.3POSIX.html">UNLINK</a></u>(3POSIX)
</pre>
 </div>
</div></section>
</div>
</body>
</html>