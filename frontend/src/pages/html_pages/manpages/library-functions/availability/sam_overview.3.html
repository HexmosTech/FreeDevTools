<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sam_overview - Overview of the Simple Availability Manager</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libsam-dev">libsam-dev_3.1.9-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sam_overview - Overview of the Simple Availability Manager

</pre><h4><b>OVERVIEW</b></h4><pre>
       The  SAM  library  provide  a  tool to check the health of an application.  The main purpose of SAM is to
       restart a local process when it fails to respond to a healthcheck request in a configured time interval.

       During <b><a href="../man3/sam_initialize.3.html">sam_initialize</a>(3)</b>, a duplicate copy of the process is created using the <b><a href="../man3/fork.3.html">fork</a>(3)</b> system call.  This
       duplicate process copy contains the logic for executing the SAM server.  The SAM  server  is  responsible
       for  requesting healthchecks from the active process, and controlling the lifecycle of the active process
       when it fails.  If the active process fails to respond to the healthcheck request sent by the SAM server,
       it will be sent a user configurable signal (default SIGTERM) to  request  shutdown  of  the  application.
       After  a  configured  time  interval, the process will be forcibly killed by being sent a SIGKILL signal.
       Once the active process terminates, the SAM server will create a new active process.

       The Simple Availability Manager is meant to be used in conjunction with the cpg service.  Used  together,
       it is possible to restart a cpg process that fails healthchecking during operation.

       The main features of SAM include:

              •  A configurable recovery policy.

              •  A configurable time interval for health check operations.

              •  A notification via signal before recovery action is taken.

              •  A  mechanism  to  indicate  to  the  application the number of times an active process has been
                 created by the SAM server.

              •  Both application driven health checking and event driven health checking.

</pre><h4><b>Initializing</b> <b>SAM</b></h4><pre>
       The SAM library is initialized by <b><a href="../man3/sam_initialize.3.html">sam_initialize</a>(3)</b>.   <b><a href="../man3/sam_initalize.3.html">sam_initalize</a>(3)</b>  may  only  be  called  once  per
       process.  Calling it more then once has undefined results and is not recommended or tested.

</pre><h4><b>Setting</b> <b>warning</b> <b>callback</b></h4><pre>
       User  configurable signal (default <u>SIGTERM</u>) is sent to the application when a recovery action is planned.
       The application can use the <b><a href="../man3/signal.3.html">signal</a>(3)</b> system call to monitor for this signal.

       There are no special constraints  on  what  SAM  apis  may  be  called  in  a  warning  callback.   After
       <u>time_interval</u> expires, a SIGKILL signal is sent to the active process to force its termination.

</pre><h4><b>Registering</b> <b>the</b> <b>active</b> <b>process</b></h4><pre>
       The  active  process  is  registered  with  SAM by calling <b><a href="../man3/sam_register.3.html">sam_register</a>(3)</b>.  This function should only be
       called one time in a process.  After a recovery action is  taken,  the  new  active  process  will  begin
       execution at the next line of code in a user process after <b><a href="../man3/sam_register.3.html">sam_register</a>(3)</b>.

</pre><h4><b>Enabling</b> <b>event</b> <b>driven</b> <b>healthchecking</b></h4><pre>
       Two types of healthchecking are available to the user.  The first model is one where the user application
       healthchecks during its normal operation.  It is never requested to healtcheck, and if the active process
       doesn't respond within the time interval, the process will be restarted.

       A  more  useful  mechanism  for  healthchecking  is  event  driven healthchecking.  Because this model is
       directed by the SAM server, It isn't necessary to guess or add timers to the active process to  signal  a
       healthcheck operation is successful.  To use event driven healthchecking, the <b><a href="../man3/sam_hc_callback_register.3.html">sam_hc_callback_register</a>(3)</b>
       function should be executed.

</pre><h4><b>Quorum</b> <b>integration</b></h4><pre>
       SAM  has special policies (<u>SAM_RECOVERY_POLICY_QUIT</u> and <u>SAM_RECOVERY_POLICY_RESTART</u>) for integration with
       quorum service. This policies changes SAM behaviour in two aspects.

              •  Call of <b><a href="../man3/sam_start.3.html">sam_start</a>(3)</b> blocks until corosync becomes quorate

              •  User selected recovery action is taken immediately after lost of quorum.

</pre><h4><b>Storing</b> <b>user</b> <b>data</b></h4><pre>
       Sometimes there is need to store some data, which survives between instances.  One can in such  case  use
       files,   databases,   ...   or   much   simpler   in  memory  solution  presented  by  <b><a href="../man3/sam_data_store.3.html">sam_data_store</a>(3)</b>,
       <b><a href="../man3/sam_data_restore.3.html">sam_data_restore</a>(3)</b> and <b><a href="../man3/sam_data_getsize.3.html">sam_data_getsize</a>(3)</b> functions.

</pre><h4><b>Confdb</b> <b>integration</b></h4><pre>
       SAM has policy flag used for confdb  system  integration  (<u>SAM_RECOVERY_POLICY_CONFDB</u>).   If  process  is
       registered with this flag, new confdb object PROCESS_NAME:PID is created with following keys:

              •  <u>recovery</u> - will be quit or restart depending on policy

              •  <u>poll_period</u> - period of health checking in milliseconds

              •  <u>last_updated</u> - Timestamp (in nanoseconds) of the last health check.

              •  <u>state</u> - state of process (can be one of registered, started, failed, waiting for quorum)

       Object is automatically deleted if process exits with stopped health checking.

       Confdb integration with corosync watchdog can be used in implicit and explicit way.

       Implicit  way  is  achieved  by  setting recovery policy to QUIT and let process exit with started health
       checking.  If this happened, object is not deleted and corosync watchdog will take required action.

       Explicit way is useful for situations, when developer can deal with some non-fatal fall  of  application.
       This  mode is achieved by setting policy to RESTART and using SAM same as without Confdb integration.  If
       real  fail  is  needed  (like  too  many  restarts  at  all,  per/sec,  ...),  it's   possible   to   use
       <b><a href="../man3/sam_mark_failed.3.html">sam_mark_failed</a>(3)</b> and let corosync watchdog take required action.

</pre><h4><b>BUGS</b></h4><pre>
</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/sam_initialize.3.html">sam_initialize</a></b>(3),    <b><a href="../man3/sam_data_getsize.3.html">sam_data_getsize</a></b>(3),   <b><a href="../man3/sam_data_restore.3.html">sam_data_restore</a></b>(3),   <b><a href="../man3/sam_data_store.3.html">sam_data_store</a></b>(3),   <b><a href="../man3/sam_finalize.3.html">sam_finalize</a></b>(3),
       <b><a href="../man3/sam_mark_failed.3.html">sam_mark_failed</a></b>(3), <b><a href="../man3/sam_start.3.html">sam_start</a></b>(3), <b><a href="../man3/sam_stop.3.html">sam_stop</a></b>(3), <b><a href="../man3/sam_register.3.html">sam_register</a></b>(3),  <b><a href="../man3/sam_warn_signal_set.3.html">sam_warn_signal_set</a></b>(3),  <b><a href="../man3/sam_hc_send.3.html">sam_hc_send</a></b>(3),
       <b><a href="../man3/sam_hc_callback_register.3.html">sam_hc_callback_register</a></b>(3)

corosync Man Page                                  21/05/2010                                    <u><a href="../man3/SAM_OVERVIEW.3.html">SAM_OVERVIEW</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>