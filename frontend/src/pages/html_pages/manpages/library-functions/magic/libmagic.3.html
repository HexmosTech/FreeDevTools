<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>magic_open,   magic_close,  magic_error,  magic_errno,  magic_descriptor,  magic_buffer,  magic_getflags,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmagic-dev">libmagic-dev_5.46-5_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       magic_open,   magic_close,  magic_error,  magic_errno,  magic_descriptor,  magic_buffer,  magic_getflags,
       magic_setflags, magic_check, magic_compile, magic_list, magic_load,  magic_load_buffers,  magic_setparam,
       magic_getparam, magic_version — Magic number recognition library

</pre><h4><b>LIBRARY</b></h4><pre>
       Magic Number Recognition Library (libmagic, -lmagic)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;magic.h&gt;</b>

       <u>magic_t</u>
       <b>magic_open</b>(<u>int</u> <u>flags</u>);

       <u>void</u>
       <b>magic_close</b>(<u>magic_t</u> <u>cookie</u>);

       <u>const</u> <u>char</u> <u>*</u>
       <b>magic_error</b>(<u>magic_t</u> <u>cookie</u>);

       <u>int</u>
       <b>magic_errno</b>(<u>magic_t</u> <u>cookie</u>);

       <u>const</u> <u>char</u> <u>*</u>
       <b>magic_descriptor</b>(<u>magic_t</u> <u>cookie</u>, <u>int</u> <u>fd</u>);

       <u>const</u> <u>char</u> <u>*</u>
       <b>magic_file</b>(<u>magic_t</u> <u>cookie</u>, <u>const</u> <u>char</u> <u>*filename</u>);

       <u>const</u> <u>char</u> <u>*</u>
       <b>magic_buffer</b>(<u>magic_t</u> <u>cookie</u>, <u>const</u> <u>void</u> <u>*buffer</u>, <u>size_t</u> <u>length</u>);

       <u>int</u>
       <b>magic_getflags</b>(<u>magic_t</u> <u>cookie</u>);

       <u>int</u>
       <b>magic_setflags</b>(<u>magic_t</u> <u>cookie</u>, <u>int</u> <u>flags</u>);

       <u>int</u>
       <b>magic_check</b>(<u>magic_t</u> <u>cookie</u>, <u>const</u> <u>char</u> <u>*filename</u>);

       <u>int</u>
       <b>magic_compile</b>(<u>magic_t</u> <u>cookie</u>, <u>const</u> <u>char</u> <u>*filename</u>);

       <u>int</u>
       <b>magic_list</b>(<u>magic_t</u> <u>cookie</u>, <u>const</u> <u>char</u> <u>*filename</u>);

       <u>int</u>
       <b>magic_load</b>(<u>magic_t</u> <u>cookie</u>, <u>const</u> <u>char</u> <u>*filename</u>);

       <u>int</u>
       <b>magic_load_buffers</b>(<u>magic_t</u> <u>cookie</u>, <u>void</u> <u>**buffers</u>, <u>size_t</u> <u>*sizes</u>, <u>size_t</u> <u>nbuffers</u>);

       <u>int</u>
       <b>magic_getparam</b>(<u>magic_t</u> <u>cookie</u>, <u>int</u> <u>param</u>, <u>void</u> <u>*value</u>);

       <u>int</u>
       <b>magic_setparam</b>(<u>magic_t</u> <u>cookie</u>, <u>int</u> <u>param</u>, <u>const</u> <u>void</u> <u>*value</u>);

       <u>int</u>
       <b>magic_version</b>(<u>void</u>);

       <u>const</u> <u>char</u> <u>*</u>
       <b>magic_getpath</b>(<u>const</u> <u>char</u> <u>*magicfile</u>, <u>int</u> <u>action</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       These functions operate on the magic database file which is described in <u><a href="../man5/magic.5.html">magic</a></u>(5).

       The function <b>magic_open</b>() creates a magic cookie pointer and returns it.  It returns NULL if there was an
       error  allocating  the  magic  cookie.  The <u>flags</u> argument specifies how the other magic functions should
       behave:

       MAGIC_NONE      No special handling.

       MAGIC_DEBUG     Print debugging messages to stderr.

       MAGIC_SYMLINK   If the file queried is a symlink, follow it.

       MAGIC_COMPRESS  If the file is compressed, unpack it and look at the contents.

       MAGIC_DEVICES   If the file is a block or character special device, then open the device and try to  look
                       in its contents.

       MAGIC_MIME_TYPE
                       Return a MIME type string, instead of a textual description.

       MAGIC_MIME_ENCODING
                       Return a MIME encoding, instead of a textual description.

       MAGIC_MIME      A shorthand for MAGIC_MIME_TYPE | MAGIC_MIME_ENCODING.

       MAGIC_CONTINUE  Return all matches, not just the first.

       MAGIC_CHECK     Check the magic database for consistency and print warnings to stderr.

       MAGIC_PRESERVE_ATIME
                       On  systems  that  support  <u><a href="../man3/utime.3.html">utime</a></u>(3) or <u><a href="../man2/utimes.2.html">utimes</a></u>(2), attempt to preserve the access time of
                       files analysed.

       MAGIC_RAW       Don't translate unprintable characters to a \ooo octal representation.

       MAGIC_ERROR     Treat operating system errors while trying to open files  and  follow  symlinks  as  real
                       errors, instead of printing them in the magic buffer.

       MAGIC_APPLE     Return the Apple creator and type.

       MAGIC_EXTENSION
                       Return a slash-separated list of extensions for this file type.

       MAGIC_COMPRESS_TRANSP
                       Don't report on compression, only report about the uncompressed data.

       MAGIC_NO_CHECK_APPTYPE
                       Don't check for EMX application type (only on EMX).

       MAGIC_NO_COMPRESS_FORK
                       Don't allow decompressors that use fork.

       MAGIC_NO_CHECK_CDF
                       Don't get extra information on MS Composite Document Files.

       MAGIC_NO_CHECK_COMPRESS
                       Don't look inside compressed files.

       MAGIC_NO_CHECK_ELF
                       Don't print ELF details.

       MAGIC_NO_CHECK_ENCODING
                       Don't check text encodings.

       MAGIC_NO_CHECK_SOFT
                       Don't consult magic files.

       MAGIC_NO_CHECK_TAR
                       Don't examine tar files.

       MAGIC_NO_CHECK_TEXT
                       Don't check for various types of text files.

       MAGIC_NO_CHECK_TOKENS
                       Don't look for known tokens inside ascii files.

       MAGIC_NO_CHECK_JSON
                       Don't examine JSON files.

       MAGIC_NO_CHECK_CSV
                       Don't examine CSV files.

       MAGIC_NO_CHECK_SIMH
                       Don't examine SIMH tape files.

       The <b>magic_close</b>() function closes the <u><a href="../man5/magic.5.html">magic</a></u>(5) database and deallocates any resources used.

       The  <b>magic_error</b>()  function  returns  a  textual  explanation of the last error, or NULL if there was no
       error.

       The <b>magic_errno</b>() function returns the last operating system error number (<u><a href="../man2/errno.2.html">errno</a></u>(2)) that was encountered
       by a system call.

       The <b>magic_file</b>() function returns a textual description of the contents of the <u>filename</u> argument, or NULL
       if an error occurred.  If the <u>filename</u> is NULL, then stdin is used.

       The <b>magic_descriptor</b>() function returns a textual description of the contents of the <u>fd</u> argument, or NULL
       if an error occurred.

       The <b>magic_buffer</b>() function returns a textual description of the contents of  the  <u>buffer</u>  argument  with
       <u>length</u> bytes size.

       The <b>magic_getflags</b>() functions returns a value representing current <u>flags</u> set.

       The  <b>magic_setflags</b>()  function sets the <u>flags</u> described above.  Note that using both MIME flags together
       can also return extra information on the charset.

       The <b>magic_check</b>() function can be used to check the validity of entries in the colon  separated  database
       files  passed  in  as  <u>filename</u>,  or  NULL  for  the default database.  It returns 0 on success and -1 on
       failure.

       The <b>magic_compile</b>() function can be used to compile the colon separated list of database files passed  in
       as  <u>filename</u>, or NULL for the default database.  It returns 0 on success and -1 on failure.  The compiled
       files created are named from the <u><a href="../man1/basename.1.html">basename</a></u>(1) of each file argument with “.mgc” appended to it.

       The <b>magic_list</b>() function dumps all magic entries in a human readable format, dumping first  the  entries
       that  are  matched  against  binary files and then the ones that match text files.  It takes and optional
       <u>filename</u> argument which is a colon separated list of database files, or NULL for the default database.

       The <b>magic_load</b>() function must be used to load the colon separated list of database files  passed  in  as
       <u>filename</u>, or NULL for the default database file before any magic queries can performed.

       The  default  database file is named by the MAGIC environment variable.  If that variable is not set, the
       default database file name is /usr/share/misc/magic.  <b>magic_load</b>() adds “.mgc” to the  database  filename
       as appropriate.

       The  <b>magic_load_buffers</b>()  function takes an array of size <u>nbuffers</u> of <u>buffers</u> with a respective size for
       each in the array of <u>sizes</u> loaded with the contents of the magic databases  from  the  filesystem.   This
       function  can  be  used  in  environment  where  the  magic  library  does  not have direct access to the
       filesystem, but can access the magic database via shared memory or other IPC means.

       The <b>magic_getparam</b>() and <b>magic_setparam</b>() allow getting and setting various limits related to  the  magic
       library.

             <b>Parameter</b>                    <b>Type</b>      <b>Default</b>
             <b>MAGIC_PARAM_INDIR_MAX</b>        size_t    15
             <b>MAGIC_PARAM_NAME_MAX</b>         size_t    30
             <b>MAGIC_PARAM_ELF_NOTES_MAX</b>    size_t    256
             <b>MAGIC_PARAM_ELF_PHNUM_MAX</b>    size_t    128
             <b>MAGIC_PARAM_ELF_SHNUM_MAX</b>    size_t    32768
             <b>MAGIC_PARAM_REGEX_MAX</b>        size_t    8192
             <b>MAGIC_PARAM_BYTES_MAX</b>        size_t    7340032
             <b>MAGIC_PARAM_ENCODING_MAX</b>     size_t    1048576
             <b>MAGIC_PARAM_ELF_SHSIZE_MAX</b>   size_t    134217728
             <b>MAGIC_PARAM_MAGWARN_MAX</b>      size_t    64

       The  MAGIC_PARAM_INDIR_RECURSION  parameter  controls  how  many levels of recursion will be followed for
       indirect magic entries.

       The MAGIC_PARAM_NAME_RECURSION parameter controls how many levels of recursion will be followed  for  for
       name/use calls.

       The MAGIC_PARAM_NAME_MAX parameter controls the maximum number of calls for name/use.

       The MAGIC_PARAM_NOTES_MAX parameter controls how many ELF notes will be processed.

       The MAGIC_PARAM_PHNUM_MAX parameter controls how many ELF program sections will be processed.

       The MAGIC_PARAM_SHNUM_MAX parameter controls how many ELF sections will be processed.

       The MAGIC_PARAM_REGEX_MAX parameter controls the maximum length for regex searches.

       The MAGIC_PARAM_BYTES_MAX parameter controls the maximum number of bytes to look inside a file.

       The  MAGIC_PARAM_ENCODING_MAX  parameter  controls  the  maximum  number  of  bytes  to scan for encoding
       detection.

       The MAGIC_PARAM_ELF_SHSIZE_MAX parameter controls the maximum number of bytes in an elf section.

       The MAGIC_PARAM_MAGWARN_MAX parameter controls the maximum number of warnings  to  tolerate  in  a  magic
       file.

       The  <b>magic_version</b>() command returns the version number of this library which is compiled into the shared
       library using the constant MAGIC_VERSION from &lt;<u>magic.h</u>&gt;.  This can be used by client programs  to  verify
       that the version they compile against is the same as the version that they run against.

       The  <b>magic_getpath</b>()  command  returns  the  colon  separated  list  of magic database locations.  If the
       <u>filename</u> is non-NULL, then it is returned.  Otherwise, if the MAGIC environment variable is defined, then
       it is returned.  Otherwise, if <u>action</u> is 0 (meaning "file load"), then any user-specific  magic  database
       file is included.  Otherwise, only the system default magic database path is included.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       The  function  <b>magic_open</b>()  returns  a  magic  cookie on success and NULL on failure setting errno to an
       appropriate value.  It will set errno to EINVAL if  an  unsupported  value  for  flags  was  given.   The
       <b>magic_list</b>(),  <b>magic_load</b>(),  <b>magic_compile</b>(),  and <b>magic_check</b>() functions return 0 on success and -1 on
       failure.  The <b>magic_buffer</b>(), <b>magic_getpath</b>(), and <b>magic_file</b>(), functions return a string on success and
       NULL on failure.  The <b>magic_error</b>() function returns a textual description of the  errors  of  the  above
       functions,  or  NULL if there was no error.  The <b>magic_version</b>() always returns the version number of the
       library.  Finally, <b>magic_setflags</b>() returns -1 on systems that don't support <u><a href="../man3/utime.3.html">utime</a></u>(3), or <u><a href="../man2/utimes.2.html">utimes</a></u>(2)  when
       MAGIC_PRESERVE_ATIME is set.

</pre><h4><b>FILES</b></h4><pre>
       <u><a href="file:/usr/share/misc/magic">/usr/share/misc/magic</a></u>      The non-compiled default magic database.
       <u><a href="file:/usr/share/misc/magic.mgc">/usr/share/misc/magic.mgc</a></u>  The compiled default magic database.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/file.1.html">file</a></u>(1), <u><a href="../man5/magic.5.html">magic</a></u>(5)

</pre><h4><b>BUGS</b></h4><pre>
       The  results from <b>magic_buffer</b>() and <b>magic_file</b>() where the buffer and the file contain the same data can
       produce different results, because in the <b>magic_file</b>() case, the program can  <u><a href="../man2/lseek.2.html">lseek</a></u>(2)  and  <u><a href="../man2/stat.2.html">stat</a></u>(2)  the
       file descriptor.

</pre><h4><b>AUTHORS</b></h4><pre>
       Måns Rullgård Initial libmagic implementation, and configuration.
       Christos Zoulas API cleanup, error code and allocation handling.

Debian                                          December 29, 2023                                    <u><a href="../man3/LIBMAGIC.3.html">LIBMAGIC</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>