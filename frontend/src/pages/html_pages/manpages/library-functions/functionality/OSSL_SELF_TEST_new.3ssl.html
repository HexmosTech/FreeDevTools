<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSSL_SELF_TEST_new, OSSL_SELF_TEST_free, OSSL_SELF_TEST_onbegin, OSSL_SELF_TEST_oncorrupt_byte,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libssl-doc">libssl-doc_3.5.0-2ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       OSSL_SELF_TEST_new, OSSL_SELF_TEST_free, OSSL_SELF_TEST_onbegin, OSSL_SELF_TEST_oncorrupt_byte,
       OSSL_SELF_TEST_onend - functionality to trigger a callback during a self test

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;openssl/self_test.h&gt;

        OSSL_SELF_TEST *OSSL_SELF_TEST_new(OSSL_CALLBACK *cb, void *cbarg);
        void OSSL_SELF_TEST_free(OSSL_SELF_TEST *st);

        void OSSL_SELF_TEST_onbegin(OSSL_SELF_TEST *st, const char *type,
                                    const char *desc);
        int OSSL_SELF_TEST_oncorrupt_byte(OSSL_SELF_TEST *st, unsigned char *bytes);
        void OSSL_SELF_TEST_onend(OSSL_SELF_TEST *st, int ret);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       These methods are intended for use by provider implementers, to display diagnostic information during
       self testing.

       <b>OSSL_SELF_TEST_new()</b> allocates an opaque <b>OSSL_SELF_TEST</b> object that has a callback and callback argument
       associated with it.

       The callback <u>cb</u> may be triggered multiple times by a self test to indicate different phases.

       <b>OSSL_SELF_TEST_free()</b> frees the space allocated by <b>OSSL_SELF_TEST_new()</b>.  If the argument is NULL,
       nothing is done.

       <b>OSSL_SELF_TEST_onbegin()</b> may be inserted at the start of a block of self test code. It can be used for
       diagnostic purposes.  If this method is called the callback <u>cb</u> will receive the following <b><a href="../man3/OSSL_PARAM.3.html">OSSL_PARAM</a></b>(3)
       object.

       "st-phase" (<b>OSSL_PROV_PARAM_SELF_TEST_PHASE</b>) &lt;UTF8 string&gt;
           The value is the string "Start"

       <b>OSSL_SELF_TEST_oncorrupt_byte()</b> may be inserted just after the known answer is calculated, but before the
       self  test  compares  the result. The first byte in the passed in array of <u>bytes</u> will be corrupted if the
       callback returns 0, otherwise it leaves the array unaltered. It can be used  for  failure  testing.   The
       <u>type</u>  and  <u>desc</u>  can  be used to identify an individual self test to target for failure testing.  If this
       method is called the callback <u>cb</u> will receive the following <b><a href="../man3/OSSL_PARAM.3.html">OSSL_PARAM</a></b>(3) object.

       "st-phase" (<b>OSSL_PROV_PARAM_SELF_TEST_PHASE</b>) &lt;UTF8 string&gt;
           The value is the string "Corrupt"

       <b>OSSL_SELF_TEST_onend()</b> may be inserted at the end of a block of self test code  just  before  cleanup  to
       indicate  if the test passed or failed. It can be used for diagnostic purposes.  If this method is called
       the callback <u>cb</u> will receive the following <b><a href="../man3/OSSL_PARAM.3.html">OSSL_PARAM</a></b>(3) object.

       "st-phase" (<b>OSSL_PROV_PARAM_SELF_TEST_PHASE</b>) &lt;UTF8 string&gt;
           The value of the string is "Pass" if <u>ret</u> is non zero, otherwise it has the value "Fail".

       After the callback <u>cb</u> has been called the values that were set by <b>OSSL_SELF_TEST_onbegin()</b> for  <u>type</u>  and
       <u>desc</u> are set to the value "None".

       If  <b>OSSL_SELF_TEST_onbegin()</b>,  <b>OSSL_SELF_TEST_oncorrupt_byte()</b>  or  <b>OSSL_SELF_TEST_onend()</b>  is called the
       following additional <b><a href="../man3/OSSL_PARAM.3.html">OSSL_PARAM</a></b>(3) are passed to the callback.

       "st-type" (<b>OSSL_PROV_PARAM_SELF_TEST_TYPE</b>) &lt;UTF8 string&gt;
           The value is setup by the <u>type</u> passed to  <b>OSSL_SELF_TEST_onbegin()</b>.   This  allows  the  callback  to
           identify the type of test being run.

       "st-desc" (<b>OSSL_PROV_PARAM_SELF_TEST_DESC</b>) &lt;UTF8 string&gt;
           The  value  is  setup  by  the  <u>type</u> passed to <b>OSSL_SELF_TEST_onbegin()</b>.  This allows the callback to
           identify the sub category of the test being run.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>OSSL_SELF_TEST_new()</b> returns the allocated <b>OSSL_SELF_TEST</b> object, or NULL if it fails.

       <b>OSSL_SELF_TEST_oncorrupt_byte()</b> returns 1 if corruption occurs, otherwise it returns 0.

</pre><h4><b>EXAMPLES</b></h4><pre>
       A single self test could be set up in the following way:

           OSSL_SELF_TEST *st = NULL;
           OSSL_CALLBACK *cb;
           void *cbarg;
           int ok = 0;
           unsigned char out[EVP_MAX_MD_SIZE];
           unsigned int out_len = 0;
           EVP_MD_CTX *ctx = EVP_MD_CTX_new();
           EVP_MD *md = EVP_MD_fetch(libctx, t-&gt;algorithm, NULL);

           /*
            * Retrieve the callback - will be NULL if not set by the application via
            * OSSL_SELF_TEST_set_callback().
            */
           OSSL_SELF_TEST_get_callback(libctx, &amp;cb, &amp;cbarg);

           st = OSSL_SELF_TEST_new(cb, cb_arg);

           /* Trigger the optional callback */
           OSSL_SELF_TEST_onbegin(st, OSSL_SELF_TEST_TYPE_KAT_DIGEST,
                                  OSSL_SELF_TEST_DESC_MD_SHA2);

           if (!EVP_DigestInit_ex(ctx, md, NULL)
               || !EVP_DigestUpdate(ctx, pt, pt_len)
               || !EVP_DigestFinal(ctx, out, &amp;out_len))
               goto err;

           /* Optional corruption - If the application callback returns 0 */
           OSSL_SELF_TEST_oncorrupt_byte(st, out);

           if (out_len != t-&gt;expected_len
               || memcmp(out, t-&gt;expected, out_len) != 0)
               goto err;
           ok = 1;
         err:
           OSSL_SELF_TEST_onend(st, ok);
           <a href="../manmd/EVP_MD_free.md.html">EVP_MD_free</a>(md);
           EVP_MD_CTX_free(ctx);

       Multiple self test's can be set up in a similar way by repeating the pattern of <b>OSSL_SELF_TEST_onbegin()</b>,
       <b>OSSL_SELF_TEST_oncorrupt_byte()</b>, <b>OSSL_SELF_TEST_onend()</b> for each test.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/OSSL_SELF_TEST_set_callback.3.html">OSSL_SELF_TEST_set_callback</a></b>(3), <b><a href="../man7/openssl-core.h.7.html">openssl-core.h</a></b>(7), <b><a href="../man7/OSSL_PROVIDER-FIPS.7.html">OSSL_PROVIDER-FIPS</a></b>(7)

</pre><h4><b>HISTORY</b></h4><pre>
       The functions described here were added in OpenSSL 3.0.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2020-2024 The OpenSSL Project Authors. All Rights Reserved.

       Licensed under the Apache License 2.0 (the "License").  You may not use this file  except  in  compliance
       with  the  License.   You  can  obtain  a  copy  in  the  file  LICENSE  in the source distribution or at
       &lt;https://www.openssl.org/source/license.html&gt;.

3.5.0                                              2025-06-04                           <u><a href="../man3SSL/OSSL_SELF_TEST_NEW.3SSL.html">OSSL_SELF_TEST_NEW</a></u>(3SSL)
</pre>
 </div>
</div></section>
</div>
</body>
</html>