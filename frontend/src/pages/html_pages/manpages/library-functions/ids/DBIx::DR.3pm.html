<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBIx::DR - easy DBI helper (perl inside SQL and blessed results)</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libdbix-dr-perl">libdbix-dr-perl_0.32-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       DBIx::DR - easy DBI helper (perl inside SQL and blessed results)

</pre><h4><b>SYNOPSIS</b></h4><pre>
           my $dbh = DBIx::DR-&gt;connect($dsn, $login, $passed);

           $dbh-&gt;perform(
               'UPDATE tbl SET a = 1 WHERE id = &lt;%= $id %&gt;',
               id =&gt; 123
           );

           my $rowset = $dbh-&gt;select(
               'SELECT * FROM tbl WHERE id IN (&lt;% list @$ids %&gt;)',
               ids =&gt; [ 123, 456 ]
           );
           my $rowset = $dbh-&gt;select(-f =&gt; 'sqlfile.sql.ep', ids =&gt; [ 123, 456 ]);

           while(my $row = $rowset-&gt;next) {
               print "id: %d, value: %s\n", $row-&gt;id, $row-&gt;value;
           }

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The package <u>extends</u> DBI and allows You:

       •   to use perl inside Your SQL requests;

       •   to bless resultsets into Your package;

       •   to place Your SQL's into dedicated directory;

       •   to use usual DBI methods.

</pre><h4><b>Additional</b> <b>'connect'</b> <b>options.</b></h4><pre>
   <b>dr_iterator</b>
       A string describes iterator class.  Default value is '<b>dbix-dr-iterator#new</b>' (decamelized string).

   <b>dr_item</b>
       A  string  describes  item  (one  row)  class.  Default value is '<b>dbix-dr-iterator-item#new</b>' (decamelized
       string).

   <b>dr_sql_dir</b>
       Directory path to seek sql files (If You use dedicated SQLs).

   <b>dr_decode_errors</b>
       Decode database errors into utf-8

   <b>dr_sql_utf8</b>
       Default value: "true". If true, it will open sql files with option ":utf8".

</pre><h4><b>METHODS</b></h4><pre>
       All methods can receive the following arguments:

       -f =&gt; $sql_file_name
           It will load SQL-request from file. It will seek file in directory that  was  defined  in  dr_sql_dir
           param of connect.

           You needn't to use suffixes (<b>.sql.ep</b>) here, but You can.

       -item =&gt; 'decamelized_obj_define'
           It  will  bless (or construct) row into specified class. See below.  Default value defined by dr_item
           argument of <b>DBI::connect</b>.

       -noitem
           Do not bless row into any class.

       -iterator =&gt; 'decamelized_obj_define'
           It will bless (or construct) rowset into specified  class.   Default  value  defined  by  dr_iterator
           argument of <b>DBI::connect</b>.

       -noiterator
           Do not bless rowset into any class.

       -noitem_iter
           Do not pass iterator as second argument to item constructor.

       -dbi =&gt; HASHREF
           Additional DBI arguments.

       -hash =&gt; FIELDNAME
           Selects into HASH. Iterator will operate by names (not numbers).

       -die =&gt; 0|1
           If <b>true</b> the method will die with SQL-request.

       -warn =&gt; 0|1
           If <b>true</b> the method will warn with SQL-request.

   <b>Decamelized</b> <b>strings</b>
       Are strings that represent class [ and method ].

        foo_bar                =&gt; FooBar
        foo_bar#subroutine     =&gt; FooBar-&gt;subroutine
        foo_bar-baz            =&gt; FooBar::Baz

   <b>perform</b>
       Does SQL-request like '<b>UPDATE</b>', '<b>INSERT</b>', etc.

           $dbh-&gt;perform($sql, value =&gt; 1, other_value =&gt; 'abc');
           $dbh-&gt;perform(-f =&gt; $sql_file_name, value =&gt; 1, other_value =&gt; 'abc');

   <b>select</b>
       Does SQL-request, pack results into iterator class. By default it uses DBIx::DR::Iterator class.

           my $res = $dbh-&gt;select(-f =&gt; $sql_file_name, value =&gt; 1);
           while(my $row = $res-&gt;next) {
               printf "RowId: %d, RowValue: %s\n", $row-&gt;id, $row-&gt;value;
           }

           my $row = $row-&gt;<a href="../man15/get.15.html">get</a>(15);  # row 15

           my $res = $dbh-&gt;select(-f =&gt; $sql_file_name,
                   value =&gt; 1, -hash =&gt; 'name');
           while(my $row = $res-&gt;next) {
               printf "RowId: %d, RowName: %s\n", $row-&gt;id, $row-&gt;name;
           }

           my $row = $row-&gt;get('Vasya');  # row with name eq 'Vasya'

   <b>single</b>
       Does SQL-request that returns one row. Pack results into item class.  Does SQL-request, pack results (one
       row) into item class. By default it uses DBIx::DR::Iterator::Item class.

</pre><h4><b>Template</b> <b>language</b></h4><pre>
       You can use perl inside Your SQL requests:

           % my $foo = 1;
           % my $bar = 2;
           &lt;% my $foo_bar = $foo + $bar %&gt;

           ..

           % use POSIX;
           % my $gid = POSIX::getgid;

       There are two functions available inside perl:

   <b>quote</b>
       Replaces argument to '<b>?</b>', add argument value into bindlist.  You can also use shortcut '<b>=</b>' instead of the
       function.

       <b>Example</b> <b>1</b>

           SELECT
               *
           FROM
               tbl
           WHERE
               id = &lt;% quote $id %&gt;

       <b>Result</b>

           SELECT
               *
           FROM
               tbl
           WHERE
               id = ?

       and <b>bindlist</b> will contain <b>id</b> value.

       If You use DBIx::DR::ByteStream in place of string the function will recall immediate function.

       <b>Example</b> <b>2</b>

           SELECT
               *
           FROM
               tbl
           WHERE
               id = &lt;%= $id %&gt;

   <b>immediate</b>
       Replaces argument to its value.  You can also use shortcut '<b>==</b>' instead of the function.

       <b>Example</b> <b>1</b>

           SELECT
               *
           FROM
               tbl
           WHERE
               id = &lt;% immediate $id %&gt;

       <b>Result</b>

           SELECT
               *
           FROM
               tbl
           WHERE
               id = 123

       Where 123 is <b>id</b> value.

       Be carful! Using the operator You can produce code that will be amenable to SQL-injection.

       <b>Example</b> <b>2</b>

           SELECT
               *
           FROM
               tbl
           WHERE
               id = &lt;%== $id %&gt;

</pre><h4><b>Helpers</b></h4><pre>
       There are a few default helpers.

   <b>list</b>
       Expands array into Your SQL request.

       <u>Example</u>

           SELECT
               *
           FROM
               tbl
           WHERE
               status IN (&lt;% list @$ids %&gt;)

       Result

           SELECT
               *
           FROM
               tbl
           WHERE
               status IN (?,?,? ...)

       and <b>bindlist</b> will contain <b>ids</b> values.

   <b>hlist</b>
       Expands  array  of  hash into Your SQL request. The first argument can be a list of required keys. Places
       each group into brackets.

       <u>Example</u>

           INSERT INTO
               tbl
                   ('a', 'b')
           VALUES
               &lt;% hlist ['a', 'b'] =&gt; @$inserts

       Result

           INSERT INTO
               tbl
                   ('a', 'b')
           VALUES
               (?, ?), (?, ?) ...

       and <b>bindlist</b> will contain all <b>inserts</b> values.

   <b>include</b>
       Includes the other SQL-part.

       <u>Example</u>

           % include 'other_sql', argument1 =&gt; 1, argument2 =&gt; 2;

   <b>stacktrace</b>
       Returns perl stacktrace. You can use the helper for debug Your code.  The helper receives  the  following
       position-arguments:

       (first) $skip (default = 0)
           How many frames to skip.

       (second) $dept (default = 0)
           How many frames to print.

       (third) $separator (default ", ")
           Separator between stackframes.

       <u>Examples</u>

           /* &lt;%= stacktrace %&gt; */

           /* &lt;%= stacktrace $skip, $depth, $separator %&gt; */

</pre><h4><b>User's</b> <b>helpers</b></h4><pre>
       You can add Your helpers using method set_helper.

   <b>set_helper</b>
       Sets (or replaces) helpers.

           $dbh-&gt;set_helper(foo =&gt; sub { ... }, bar =&gt; sub { ... });

       Each helper receives template object as the first argument.

       Examples:

           $dbh-&gt;set_helper(foo_AxB =&gt; sub {
               my ($tpl, $a, $b) = @_;
               $tpl-&gt;quote($a * $b);
           });

       You can use quote and immediate functions inside Your helpers.

       If  You  want  use the other helper inside Your helper You have to do that by Yourself. To call the other
       helper You can also use "$tpl-&gt;call_helper" function.

       <u>call_helper</u>

           $dbh-&gt;set_helper(
               foo =&gt; sub {
                   my ($tpl, $a, $b) = @_;
                   $tpl-&gt;quote('foo' . $a . $b);
               },
               bar =&gt; sub {
                   my $tpl = shift;
                   $tpl-&gt;call_helper(foo =&gt; 'b', 'c');
               }
           );

</pre><h4><b>COPYRIGHT</b></h4><pre>
        Copyright (C) 2011 Dmitry E. Oboukhov &lt;<a href="mailto:unera@debian.org">unera@debian.org</a>&gt;
        Copyright (C) 2011 Roman V. Nikolaev &lt;<a href="mailto:rshadow@rambler.ru">rshadow@rambler.ru</a>&gt;

        This program is free software, you can redistribute it and/or
        modify it under the terms of the Artistic License.

</pre><h4><b>VCS</b></h4><pre>
       The project is placed git repo on github: &lt;https://github.com/unera/dbix-dr/&gt;

perl v5.34.0                                       2022-03-15                                      <u>DBIx::<a href="../man3pm/DR.3pm.html">DR</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>