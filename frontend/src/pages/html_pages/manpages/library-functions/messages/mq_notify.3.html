<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mq_notify - register for notification when a message is available</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mq_notify - register for notification when a message is available

</pre><h4><b>LIBRARY</b></h4><pre>
       Real-time library (<u>librt</u>, <u>-lrt</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/mqueue.h">mqueue.h</a>&gt;</b>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/signal.h">signal.h</a>&gt;</b>           /* Definition of SIGEV_* constants */

       <b>int</b> <b>mq_notify(mqd_t</b> <u>mqdes</u><b>,</b> <b>const</b> <b>struct</b> <b>sigevent</b> <b>*</b><u>sevp</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>mq_notify</b>()  allows  the  calling  process  to  register  or  unregister  for delivery of an asynchronous
       notification when a new message arrives on the empty message queue  referred  to  by  the  message  queue
       descriptor <u>mqdes</u>.

       The  <u>sevp</u>  argument is a pointer to a <u>sigevent</u> structure.  For the definition and general details of this
       structure, see <b><a href="../man3type/sigevent.3type.html">sigevent</a></b>(3type).

       If <u>sevp</u> is a non-null pointer,  then  <b>mq_notify</b>()  registers  the  calling  process  to  receive  message
       notification.   The  <u>sigev_notify</u>  field  of  the  <u>sigevent</u>  structure to which <u>sevp</u> points specifies how
       notification is to be performed.  This field has one of the following values:

       <b>SIGEV_NONE</b>
              A "null" notification: the calling process is registered as the target for notification, but  when
              a message arrives, no notification is sent.

       <b>SIGEV_SIGNAL</b>
              Notify  the  process  by  sending  the  signal  specified in <u>sigev_signo</u>.  See <b><a href="../man3type/sigevent.3type.html">sigevent</a></b>(3type) for
              general details.  The <u>si_code</u> field of the <u>siginfo_t</u>  structure  will  be  set  to  <b>SI_MESGQ</b>.   In
              addition,  <u>si_pid</u>  will be set to the PID of the process that sent the message, and <u>si_uid</u> will be
              set to the real user ID of the sending process.

       <b>SIGEV_THREAD</b>
              Upon message delivery, invoke <u>sigev_notify_function</u> as if it were the  start  function  of  a  new
              thread.  See <b><a href="../man3type/sigevent.3type.html">sigevent</a></b>(3type) for details.

       Only one process can be registered to receive notification from a message queue.

       If  <u>sevp</u>  is  NULL,  and  the  calling  process is currently registered to receive notifications for this
       message queue, then the registration is removed; another process can then register to receive  a  message
       notification for this queue.

       Message  notification  occurs only when a new message arrives and the queue was previously empty.  If the
       queue was not empty at the time <b>mq_notify</b>() was called, then a notification will  occur  only  after  the
       queue is emptied and a new message arrives.

       If  another  process or thread is waiting to read a message from an empty queue using <b><a href="../man3/mq_receive.3.html">mq_receive</a></b>(3), then
       any message notification registration is ignored: the message is  delivered  to  the  process  or  thread
       calling <b><a href="../man3/mq_receive.3.html">mq_receive</a></b>(3), and the message notification registration remains in effect.

       Notification  occurs  once:  after a notification is delivered, the notification registration is removed,
       and another process can register for message notification.  If the notified process wishes to receive the
       next notification, it can use <b>mq_notify</b>() to request a further notification.  This should be done  before
       emptying  all  unread  messages  from  the  queue.   (Placing the queue in nonblocking mode is useful for
       emptying the queue of messages without blocking once it is empty.)

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success <b>mq_notify</b>() returns 0; on error, -1 is returned, with <u>errno</u> set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EBADF</b>  The message queue descriptor specified in <u>mqdes</u> is invalid.

       <b>EBUSY</b>  Another process has already registered to receive notification for this message queue.

       <b>EINVAL</b> <u>sevp-&gt;sigev_notify</u> is not one of the permitted values; or <u>sevp-&gt;sigev_notify</u> is  <b>SIGEV_SIGNAL</b>  and
              <u>sevp-&gt;sigev_signo</u> is not a valid signal number.

       <b>ENOMEM</b> Insufficient memory.

       POSIX.1-2008  says that an implementation <u>may</u> generate an <b>EINVAL</b> error if <u>sevp</u> is NULL, and the caller is
       not currently registered to receive notifications for the queue <u>mqdes</u>.

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       For an explanation of the terms used in this section, see <b><a href="../man7/attributes.7.html">attributes</a></b>(7).
       ┌─────────────────────────────────────────────────────────────────────────────┬───────────────┬─────────┐
       │ <b>Interface</b>                                                                   │ <b>Attribute</b>     │ <b>Value</b>   │
       ├─────────────────────────────────────────────────────────────────────────────┼───────────────┼─────────┤
       │ <b>mq_notify</b>()                                                                 │ Thread safety │ MT-Safe │
       └─────────────────────────────────────────────────────────────────────────────┴───────────────┴─────────┘

</pre><h4><b>VERSIONS</b></h4><pre>
   <b>C</b> <b>library/kernel</b> <b>differences</b>
       In the glibc implementation, the <b>mq_notify</b>() library function is implemented on top of the system call of
       the same name.  When <u>sevp</u> is NULL, or specifies a notification mechanism  other  than  <b>SIGEV_THREAD</b>,  the
       library  function directly invokes the system call.  For <b>SIGEV_THREAD</b>, much of the implementation resides
       within the library, rather than the kernel.  (This is  necessarily  so,  since  the  thread  involved  in
       handling  the  notification  is  one that must be managed by the C library POSIX threads implementation.)
       The implementation involves the use of a raw  <b><a href="../man7/netlink.7.html">netlink</a></b>(7)  socket  and  creates  a  new  thread  for  each
       notification that is delivered to the process.

</pre><h4><b>STANDARDS</b></h4><pre>
       POSIX.1-2008.

</pre><h4><b>HISTORY</b></h4><pre>
       POSIX.1-2001.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  following  program  registers a notification request for the message queue named in its command-line
       argument.  Notification is performed by creating a thread.  The thread executes a  function  which  reads
       one message from the queue and then terminates the process.

   <b>Program</b> <b>source</b>
       #include &lt;<a href="file:/usr/include/mqueue.h">mqueue.h</a>&gt;
       #include &lt;<a href="file:/usr/include/pthread.h">pthread.h</a>&gt;
       #include &lt;<a href="file:/usr/include/signal.h">signal.h</a>&gt;
       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
       #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
       #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;

       #define <a href="../manmsg/handle_error.msg.html">handle_error</a>(msg) \
           do { <a href="../manmsg/perror.msg.html">perror</a>(msg); exit(EXIT_FAILURE); } while (0)

       static void                     /* Thread start function */
       tfunc(union sigval sv)
       {
           struct mq_attr attr;
           ssize_t nr;
           void *buf;
           mqd_t mqdes = *((mqd_t *) sv.sival_ptr);

           /* Determine max. msg size; allocate buffer to receive msg */

           if (mq_getattr(mqdes, &amp;attr) == -1)
               handle_error("mq_getattr");
           buf = malloc(attr.mq_msgsize);
           if (buf == NULL)
               handle_error("malloc");

           nr = mq_receive(mqdes, buf, attr.mq_msgsize, NULL);
           if (nr == -1)
               handle_error("mq_receive");

           printf("Read %zd bytes from MQ\n", nr);
           free(buf);
           exit(EXIT_SUCCESS);         /* Terminate the process */
       }

       int
       main(int argc, char *argv[])
       {
           mqd_t mqdes;
           struct sigevent sev;

           if (argc != 2) {
               fprintf(stderr, "Usage: %s &lt;mq-name&gt;\n", argv[0]);
               exit(EXIT_FAILURE);
           }

           mqdes = mq_open(argv[1], O_RDONLY);
           if (mqdes == (mqd_t) -1)
               handle_error("mq_open");

           sev.sigev_notify = SIGEV_THREAD;
           sev.sigev_notify_function = tfunc;
           sev.sigev_notify_attributes = NULL;
           sev.sigev_value.sival_ptr = &amp;mqdes;   /* Arg. to thread func. */
           if (mq_notify(mqdes, &amp;sev) == -1)
               handle_error("mq_notify");

           pause();    /* Process will be terminated by thread function */
       }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/mq_close.3.html">mq_close</a></b>(3),   <b><a href="../man3/mq_getattr.3.html">mq_getattr</a></b>(3),   <b><a href="../man3/mq_open.3.html">mq_open</a></b>(3),   <b><a href="../man3/mq_receive.3.html">mq_receive</a></b>(3),  <b><a href="../man3/mq_send.3.html">mq_send</a></b>(3),  <b><a href="../man3/mq_unlink.3.html">mq_unlink</a></b>(3),  <b><a href="../man7/mq_overview.7.html">mq_overview</a></b>(7),
       <b><a href="../man3type/sigevent.3type.html">sigevent</a></b>(3type)

Linux man-pages 6.9.1                              2024-06-15                                       <u><a href="../man3/mq_notify.3.html">mq_notify</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>