<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tracefs_instance_get_stat, tracefs_instance_put_stat, tracefs_buffer_stat_entries,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtracefs-doc">libtracefs-doc_1.8.1-1ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tracefs_instance_get_stat, tracefs_instance_put_stat, tracefs_buffer_stat_entries,
       tracefs_buffer_stat_overrun, tracefs_buffer_stat_commit_overrun, tracefs_buffer_stat_bytes,
       tracefs_buffer_stat_event_timestamp, tracefs_buffer_stat_timestamp, tracefs_buffer_stat_dropped_events,
       tracefs_buffer_stat_read_events - Handling tracing buffer stats

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;tracefs.h&gt;</b>

       struct tracefs_buffer_stat *<b>tracefs_instance_get_stat</b>(struct tracefs_instance *<u>instance</u>, int <u>cpu</u>);
       void <b>tracefs_instance_put_stat</b>(struct tracefs_buffer_stat *<u>tstat</u>);
       ssize_t <b>tracefs_buffer_stat_entries</b>(struct tracefs_buffer_stat *<u>tstat</u>);
       ssize_t <b>tracefs_buffer_stat_overrun</b>(struct tracefs_buffer_stat *<u>tstat</u>);
       ssize_t <b>tracefs_buffer_stat_commit_overrun</b>(struct tracefs_buffer_stat *<u>tstat</u>);
       ssize_t <b>tracefs_buffer_stat_bytes</b>(struct tracefs_buffer_stat *<u>tstat</u>);
       long long <b>tracefs_buffer_stat_event_timestamp</b>(struct tracefs_buffer_stat *<u>tstat</u>);
       long long <b>tracefs_buffer_stat_timestamp</b>(struct tracefs_buffer_stat *<u>tstat</u>);
       ssize_t <b>tracefs_buffer_stat_dropped_events</b>(struct tracefs_buffer_stat *<u>tstat</u>);
       ssize_t <b>tracefs_buffer_stat_read_events</b>(struct tracefs_buffer_stat *<u>tstat</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This set of functions read and parse the tracefs/per_cpu/cpuX/stats file. These files hold the statistics
       of the per CPU ring buffer, such as how many events are in the ring buffer, how many have been read and
       so on.

       The <b>tracefs_instance_get_stat()</b> function will read and parse a given statistics file for a given <u>instance</u>
       and <u>cpu</u>. As the ring buffer is split into per_cpu buffers, the information is only associated to the
       given <u>cpu</u>. The returned tracefs_buffer_stat pointer can be used with the other <b>tracefs_buffer_stat</b>
       functions and must be freed with <b>tracefs_instance_put_stat()</b>.

       The <b>tracefs_instance_put_stat()</b> will free the resources allocated for the given <u>stat</u> that was created by
       <b>tracefs_instance_get_stat()</b>.

       The <b>tracefs_buffer_stat_entries()</b> returns the number of events that are currently in the ring buffer
       associated with <u>tstat</u>.

       The <b>tracefs_buffer_stat_overrun()</b> returns the number of events that were lost by the ring buffer writer
       overrunning the reader.

       The <b>tracefs_buffer_stat_commit_overrun()</b> returns the number of events that were lost because the ring
       buffer was too small and an interrupt interrupted a lower context event being recorded and it added more
       events than the ring buffer could hold. Note this is not a common occurrence and when it happens it means
       that something was not set up properly.

       The <b>tracefs_buffer_stat_bytes()</b> returns the number of bytes that the current events take up. Note, it
       includes the meta data for the events, but does not include the meta data for the sub-buffers.

       The <b>tracefs_buffer_stat_event_timestamp()</b> returns the timestamp of the last event in the ring buffer.

       The <b>tracefs_buffer_stat_timestamp()</b> returns the current timestamp of the ring buffer. Note, it is only
       read when <b>tracefs_instance_get_stat()</b> is called. It will have the timestamp of the ring buffer when that
       function was called.

       The <b>tracefs_buffer_stat_dropped_events()</b> returns the number of events that were dropped if overwrite mode
       is disabled. It will show the events that were lost because the writer caught up to the reader and could
       not write any more events.

       The <b>tracefs_buffer_stat_read_events()</b> returns the number of events that were consumed by a reader.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       The <b>tracefs_instance_get_stat()</b> returns a tracefs_buffer_stat structure that can be used to retrieve the
       statistics via the other functions. It must be freed with <b>tracefs_instance_put_stat()</b>.

       The other functions that return different values from the tracefs_buffer_stat structure all return the
       value, or -1 if the value was not found.

</pre><h4><b>EXAMPLE</b></h4><pre>
           #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
           #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;
           #include &lt;tracefs.h&gt;

           int main(int argc, char **argv)
           {
                   char *trace;
                   char buf[1000];
                   int ret;
                   int i;

                   for (i = 0; i &lt; sizeof(buf) - 1; i++) {
                           buf[i] = '0' + i % 10;
                   }
                   buf[i] = '\0';

                   tracefs_instance_clear(NULL);

                   for (i = 0; i &lt; 4; i++) {
                           ret = tracefs_printf(NULL, "%s\n", buf);
                           if (ret &lt; 0)
                                   perror("write");
                   }

                   trace = tracefs_instance_file_read(NULL, "trace", NULL);
                   printf("%s\n", trace);
                   free(trace);

                   for (i = 0; i &lt; sysconf(_SC_NPROCESSORS_CONF); i++) {
                           struct tracefs_buffer_stat *tstat;
                           ssize_t entries, eread;

                           tstat = tracefs_instance_get_stat(NULL, i);
                           if (!tstat)
                                   continue;

                           entries = tracefs_buffer_stat_entries(tstat);
                           eread = tracefs_buffer_stat_read_events(tstat);
                           if (!entries &amp;&amp; !eread) {
                                   tracefs_instance_put_stat(tstat);
                                   continue;
                           }

                           printf("CPU: %d\n", i);;
                           printf("\tentries: %zd\n", entries);
                           printf("\toverrun: %zd\n", tracefs_buffer_stat_overrun(tstat));
                           printf("\tcommit_overrun: %zd\n", tracefs_buffer_stat_commit_overrun(tstat));
                           printf("\tbytes: %zd\n", tracefs_buffer_stat_bytes(tstat));
                           printf("\tevent_timestamp: %lld\n", tracefs_buffer_stat_event_timestamp(tstat));
                           printf("\ttimestamp: %lld\n", tracefs_buffer_stat_timestamp(tstat));
                           printf("\tdropped_events: %zd\n", tracefs_buffer_stat_dropped_events(tstat));
                           printf("\tread_events: %zd\n", eread);

                           tracefs_instance_put_stat(tstat);
                   }
           }

</pre><h4><b>FILES</b></h4><pre>
           <b>tracefs.h</b>
                   Header file to include in order to have access to the library APIs.
           <b>-ltracefs</b>
                   Linker switch to add when building a program that uses the library.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/libtracefs.3.html">libtracefs</a></b>(3), <b><a href="../man3/libtraceevent.3.html">libtraceevent</a></b>(3), <b><a href="../man1/trace-cmd.1.html">trace-cmd</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
           <b>Steven</b> <b>Rostedt</b> &lt;<b><a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a></b>[1]&gt;

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;<b><a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a></b>[2]&gt;

</pre><h4><b>LICENSE</b></h4><pre>
       libtracefs is Free Software licensed under the GNU LGPL 2.1

</pre><h4><b>RESOURCES</b></h4><pre>
       <b>https://git.kernel.org/pub/scm/libs/libtrace/libtracefs.git/</b>

</pre><h4><b>COPYING</b></h4><pre>
       Copyright (C) 2020 VMware, Inc. Free use of this software is granted under the terms of the GNU Public
       License (GPL).

</pre><h4><b>NOTES</b></h4><pre>
        1. <a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a>
           <a href="mailto:rostedt@goodmis.org">mailto:rostedt@goodmis.org</a>

        2. <a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a>
           <a href="mailto:linux-trace-devel@vger.kernel.org">mailto:linux-trace-devel@vger.kernel.org</a>

libtracefs 1.8.1                                   06/05/2025                                      <u><a href="../man3/LIBTRACEFS.3.html">LIBTRACEFS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>