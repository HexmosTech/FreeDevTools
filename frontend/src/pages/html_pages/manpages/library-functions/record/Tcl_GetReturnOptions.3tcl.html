<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tcl_GetReturnOptions,       Tcl_SetReturnOptions,       Tcl_AddErrorInfo,       Tcl_AppendObjToErrorInfo,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/tcl9.0-doc">tcl9.0-doc_9.0.1+dfsg-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Tcl_GetReturnOptions,       Tcl_SetReturnOptions,       Tcl_AddErrorInfo,       Tcl_AppendObjToErrorInfo,
       Tcl_AddObjErrorInfo,   Tcl_SetObjErrorCode,   Tcl_SetErrorCode,    Tcl_SetErrorLine,    Tcl_GetErrorLine,
       Tcl_PosixError, Tcl_LogCommandInfo - retrieve or record information about errors and other return options

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;tcl.h&gt;</b>

       Tcl_Obj *
       <b>Tcl_GetReturnOptions</b>(<u>interp,</u> <u>code</u>)

       int
       <b>Tcl_SetReturnOptions</b>(<u>interp,</u> <u>options</u>)

       <b>Tcl_AddErrorInfo</b>(<u>interp,</u> <u>message</u>)

       <b>Tcl_AppendObjToErrorInfo</b>(<u>interp,</u> <u>objPtr</u>)

       <b>Tcl_AddObjErrorInfo</b>(<u>interp,</u> <u>message,</u> <u>length</u>)

       <b>Tcl_SetObjErrorCode</b>(<u>interp,</u> <u>errorObjPtr</u>)

       <b>Tcl_SetErrorCode</b>(<u>interp,</u> <u>element,</u> <u>element,</u> <u>...</u> <b>(char</b> <b>*)NULL</b>)

       int
       <b>Tcl_GetErrorLine</b>(<u>interp</u>)

       <b>Tcl_SetErrorLine</b>(<u>interp,</u> <u>lineNum</u>)

       const char *
       <b>Tcl_PosixError</b>(<u>interp</u>)

       <b>Tcl_LogCommandInfo</b>(<u>interp,</u> <u>script,</u> <u>command,</u> <u>commandLength</u>)

</pre><h4><b>ARGUMENTS</b></h4><pre>
       Tcl_Interp <u>*interp</u> (in)                Interpreter in which to record information.

       int          <u>code</u>                      The code returned from script evaluation.

       Tcl_Obj      <u>*options</u>                  A dictionary of return options.

       const char <u>*message</u> (in)               For <b>Tcl_AddErrorInfo</b>, this is a conventional C string to append to
                                              the  <b>-errorinfo</b>  return  option.   For  <b>Tcl_AddObjErrorInfo</b>,  this
                                              points to the first byte of an array of <u>length</u> bytes containing  a
                                              string to append to the <b>-errorinfo</b> return option.  This byte array
                                              may contain embedded null bytes unless <u>length</u> is negative.

       Tcl_Obj <u>*objPtr</u> (in)                   A  message  to  be appended to the <b>-errorinfo</b> return option in the
                                              form of a Tcl_Obj value.

       Tcl_Size <u>length</u> (in)                   The number of bytes to copy from <u>message</u>  when  appending  to  the
                                              <b>-errorinfo</b>  return option.  If negative, all bytes up to the first
                                              null byte are used.

       Tcl_Obj <u>*errorObjPtr</u> (in)              The <b>-errorcode</b> return option will be set to this value.

       const char <u>*element</u> (in)               String to record as one element of the <b>-errorcode</b>  return  option.
                                              Last <u>element</u> argument must be (char *)NULL.

       int          <u>lineNum</u>                   The line number of a script where an error occurred.

       const char <u>*script</u> (in)                Pointer  to  first character in script containing command (must be
                                              &lt;= <u>command</u>).

       const char <u>*command</u> (in)               Pointer to first character  in  the  command  that  generated  the
                                              error; must point within the string given by <u>script</u>.

       Tcl_Size <u>commandLength</u> (in)            Number  of  bytes in command; a negative value means use all bytes
                                              up to the first null byte.
________________________________________________________________________________________________________________

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>Tcl_SetReturnOptions</b> and <b>Tcl_GetReturnOptions</b> routines expose the same capabilities as the <b>return</b> and
       <b>catch</b> commands, respectively, in the form of a C interface.

       <b>Tcl_GetReturnOptions</b> retrieves the dictionary of return options from an interpreter  following  a  script
       evaluation.  Routines such as <b>Tcl_Eval</b> are called to evaluate a script in an interpreter.  These routines
       return  an  integer  completion  code.   These routines also leave in the interpreter both a result and a
       dictionary of return options generated by script evaluation.   Just  as  <b>Tcl_GetObjResult</b>  retrieves  the
       result,  <b>Tcl_GetReturnOptions</b>  retrieves  the  dictionary of return options.  The integer completion code
       should be passed as the <u>code</u> argument to <b>Tcl_GetReturnOptions</b>  so  that  all  required  options  will  be
       present in the dictionary.  Specifically, a <u>code</u> value of <b>TCL_ERROR</b> will ensure that entries for the keys
       <b>-errorinfo</b>,  <b>-errorcode</b>,  and  <b>-errorline</b>  will appear in the dictionary.  Also, the entries for the keys
       <b>-code</b> and <b>-level</b> will be adjusted if necessary to agree with the value of <u>code</u>.  The <b>(Tcl_Obj</b> <b>*)</b> returned
       by <b>Tcl_GetReturnOptions</b> points to an unshared <b>Tcl_Obj</b> with reference count of zero.  The  dictionary  may
       be written to, either adding, removing, or overwriting any entries in it, without the need to check for a
       shared  value.   As  with any <b>Tcl_Obj</b> with reference count of zero, it is up to the caller to arrange for
       its disposal with <b>Tcl_DecrRefCount</b> or to a reference to it via  <b>Tcl_IncrRefCount</b>  (or  one  of  the  many
       functions that call that, notably including <b>Tcl_SetObjResult</b> and <b>Tcl_SetVar2Ex</b>).

       A  typical  usage  for <b>Tcl_GetReturnOptions</b> is to retrieve the stack trace when script evaluation returns
       <b>TCL_ERROR</b>, like so:

              int code = Tcl_EvalEx(interp, script, -1, 0);
              if (code == TCL_ERROR) {
                  Tcl_Obj *options = <b>Tcl_GetReturnOptions</b>(interp, code);
                  Tcl_Obj *key = Tcl_NewStringObj("-errorinfo", -1);
                  Tcl_Obj *stackTrace;
                  Tcl_IncrRefCount(key);
                  Tcl_DictObjGet(NULL, options, key, &amp;stackTrace);
                  Tcl_DecrRefCount(key);
                  /* Do something with stackTrace */
                  Tcl_DecrRefCount(options);
              }

       <b>Tcl_SetReturnOptions</b> sets the return options of <u>interp</u> to be <u>options</u>.  If <u>options</u>  contains  any  invalid
       value  for any key, TCL_ERROR will be returned, and the interp result will be set to an appropriate error
       message.  Otherwise, a completion code in agreement with the <b>-code</b> and <b>-level</b> keys  in  <u>options</u>  will  be
       returned.

       As an example, Tcl's <b>return</b> command itself could be implemented in terms of <b>Tcl_SetReturnOptions</b> like so:

              if ((objc % 2) == 0) { /* explicit result argument */
                  objc--;
                  Tcl_SetObjResult(interp, objv[objc]);
              }
              return <b>Tcl_SetReturnOptions</b>(interp, Tcl_NewListObj(objc-1, objv+1));

       (It  is  not  really  implemented  that  way.   Internal  access  privileges  allow  for a more efficient
       alternative that meshes better with the bytecode compiler.)

       Note that a newly created <b>Tcl_Obj</b> may be passed in as the <u>options</u> argument without the need  to  tend  to
       any reference counting.  This is analogous to <b>Tcl_SetObjResult</b>.

       While  <b>Tcl_SetReturnOptions</b>  provides  a general interface to set any collection of return options, there
       are a handful of return options  that  are  very  frequently  used.   Most  notably  the  <b>-errorinfo</b>  and
       <b>-errorcode</b>  return  options  should  be  set  properly  when  the  command procedure of a command returns
       <b>TCL_ERROR</b>.  The <b>-errorline</b> return option is also read by commands  that  evaluate  scripts  and  wish  to
       supply  detailed error location information in the stack trace text they append to the <b>-errorinfo</b> option.
       Tcl provides several simpler interfaces to more directly set these return options.

       The <b>-errorinfo</b> option holds a stack trace of the operations that were in progress when an error occurred,
       and is intended to be human-readable.  The <b>-errorcode</b> option holds a Tcl list of items that are  intended
       to  be  machine-readable.   The  first  item  in  the <b>-errorcode</b> value identifies the class of error that
       occurred (e.g., POSIX means an error occurred in a  POSIX  system  call)  and  additional  elements  hold
       additional  pieces  of  information  that  depend  on  the  class.  See the manual entry on the <b>errorCode</b>
       variable for details on the various formats for the <b>-errorcode</b> option used by Tcl's built-in commands.

       The <b>-errorinfo</b> option value is gradually built up as an error  unwinds  through  the  nested  operations.
       Each  time an error code is returned to <b>Tcl_Eval</b>, or any of the routines that performs script evaluation,
       the procedure <b>Tcl_AddErrorInfo</b> is called to add additional text to the <b>-errorinfo</b>  value  describing  the
       command  that  was being executed when the error occurred.  By the time the error has been passed all the
       way back to the application, it will contain a complete trace of the activity in progress when the  error
       occurred.

       It  is sometimes useful to add additional information to the <b>-errorinfo</b> value beyond what can be supplied
       automatically by the script evaluation routines.  <b>Tcl_AddErrorInfo</b> may be  used  for  this  purpose:  its
       <u>message</u>  argument  is an additional string to be appended to the <b>-errorinfo</b> option.  For example, when an
       error arises during the <b>source</b> command, the procedure <b>Tcl_AddErrorInfo</b> is called to record  the  name  of
       the file being processed and the line number on which the error occurred.  Likewise, when an error arises
       during  evaluation  of  a  Tcl  procedures,  the  procedure name and line number within the procedure are
       recorded, and so on.  The best time to call <b>Tcl_AddErrorInfo</b> is just after a  script  evaluation  routine
       has  returned  <b>TCL_ERROR</b>.   The  value  of  the  <b>-errorline</b>  return  option  (retrieved  via  a  call  to
       <b>Tcl_GetReturnOptions</b>) often makes up a useful part of the <u>message</u> passed to <b>Tcl_AddErrorInfo</b>.

       <b>Tcl_AppendObjToErrorInfo</b> is an alternative interface  to  the  same  functionality  as  <b>Tcl_AddErrorInfo</b>.
       <b>Tcl_AppendObjToErrorInfo</b>  is  called  when  the  string  value to be appended to the <b>-errorinfo</b> option is
       available as a <b>Tcl_Obj</b> instead of as a <b>char</b> array.

       <b>Tcl_AddObjErrorInfo</b> is nearly identical to <b>Tcl_AddErrorInfo</b>, except that  it  has  an  additional  <u>length</u>
       argument.   This  allows  the <u>message</u> string to contain embedded null bytes.  This is essentially never a
       good idea.  If the <u>message</u> needs to contain the null character  <b>U+0000</b>,  Tcl's  usual  internal  encoding
       rules  should be used to avoid the need for a null byte.  If the <b>Tcl_AddObjErrorInfo</b> interface is used at
       all, it should be with a negative <u>length</u> value.

       The procedure <b>Tcl_SetObjErrorCode</b> is used  to  set  the  <b>-errorcode</b>  return  option  to  the  list  value
       <u>errorObjPtr</u>  built  up  by the caller.  <b>Tcl_SetObjErrorCode</b> is typically invoked just before returning an
       error. If  an  error  is  returned  without  calling  <b>Tcl_SetObjErrorCode</b>  or  <b>Tcl_SetErrorCode</b>  the  Tcl
       interpreter automatically sets the <b>-errorcode</b> return option to <b>NONE</b>.

       The procedure <b>Tcl_SetErrorCode</b> is also used to set the <b>-errorcode</b> return option. However, it takes one or
       more strings to record instead of a value. Otherwise, it is similar to <b>Tcl_SetObjErrorCode</b> in behavior.

       The  procedure <b>Tcl_GetErrorLine</b> is used to read the integer value of the <b>-errorline</b> return option without
       the overhead of a full call to <b>Tcl_GetReturnOptions</b>.   Likewise,  <b>Tcl_SetErrorLine</b>  sets  the  <b>-errorline</b>
       return option value.

       <b>Tcl_PosixError</b> sets the <b>-errorcode</b> variable after an error in a POSIX kernel call.  It reads the value of
       the  <b>errno</b> C variable and calls <b>Tcl_SetErrorCode</b> to set the <b>-errorcode</b> return option in the <b>POSIX</b> format.
       The caller must previously have called <b>Tcl_SetErrno</b> to set <b>errno</b>; this is  necessary  on  some  platforms
       (e.g. Windows) where Tcl is linked into an application as a shared library, or when the error occurs in a
       dynamically loaded extension. See the manual entry for <b>Tcl_SetErrno</b> for more information.

       <b>Tcl_PosixError</b>  returns  a  human-readable  diagnostic message for the error (this is the same value that
       will appear as the third element in the <b>-errorcode</b> value).  It may be convenient to include  this  string
       as part of the error message returned to the application in the interpreter's result.

       <b>Tcl_LogCommandInfo</b>  is  invoked  after  an error occurs in an interpreter.  It adds information about the
       command that was being executed when the error occurred to the <b>-errorinfo</b>  value,  and  the  line  number
       stored internally in the interpreter is set.

       In  older  releases  of  Tcl,  there  was  no <b>Tcl_GetReturnOptions</b> routine.  In its place, the global Tcl
       variables <b>errorInfo</b> and <b>errorCode</b> were the only place to retrieve the error information.   Much  existing
       code written for older Tcl releases still access this information via those global variables.

       It  is  important  to  realize  that while reading from those global variables remains a supported way to
       access these return option values, it is important not to assume that writing to those  global  variables
       will properly set the corresponding return options.  It has long been emphasized in this manual page that
       it is important to call the procedures described here rather than setting <b>errorInfo</b> or <b>errorCode</b> directly
       with <b>Tcl_ObjSetVar2</b>.

       If the procedure <b>Tcl_ResetResult</b> is called, it clears all of the state of the interpreter associated with
       script  evaluation,  including  the  entire return options dictionary.  In particular, the <b>-errorinfo</b> and
       <b>-errorcode</b> options are reset.  If an error had occurred, the <b>Tcl_ResetResult</b> call will  clear  the  error
       state  to  make  it  appear  as  if  no error had occurred after all.  The global variables <b>errorInfo</b> and
       <b>errorCode</b> are not modified by <b>Tcl_ResetResult</b> so they continue to hold a record of information about  the
       most recent error seen in an interpreter.

</pre><h4><b>REFERENCE</b> <b>COUNT</b> <b>MANAGEMENT</b></h4><pre>
       The  result  of  <b>Tcl_GetReturnOptions</b> will have at least one reference to it from the Tcl interpreter. If
       not using it immediately, you should use <b>Tcl_IncrRefCount</b> to add your own reference.

       The <u>options</u> argument to <b>Tcl_SetReturnOptions</b> will have a reference added by the Tcl interpreter;  it  may
       safely be called with a zero-reference value.

       <b>Tcl_AppendObjToErrorInfo</b> only reads its <u>objPtr</u> argument; it does not modify its reference count at all.

       The  <u>errorObjPtr</u>  argument  to <b>Tcl_SetObjErrorCode</b> will have a reference added by the Tcl interpreter; it
       may safely be called with a zero-reference value.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man3tcl/Tcl_DecrRefCount.3tcl.html">Tcl_DecrRefCount</a>(3tcl),      <a href="../man3tcl/Tcl_IncrRefCount.3tcl.html">Tcl_IncrRefCount</a>(3tcl),       <a href="../man3tcl/Tcl_Interp.3tcl.html">Tcl_Interp</a>(3tcl),       <a href="../man3tcl/Tcl_ResetResult.3tcl.html">Tcl_ResetResult</a>(3tcl),
       <a href="../man3tcl/Tcl_SetErrno.3tcl.html">Tcl_SetErrno</a>(3tcl), <a href="../man3tcl/errorCode.3tcl.html">errorCode</a>(3tcl), <a href="../man3tcl/errorInfo.3tcl.html">errorInfo</a>(3tcl)

</pre><h4><b>KEYWORDS</b></h4><pre>
       error, value, value result, stack, trace, variable

Tcl                                                    8.5                                <u><a href="../man3tcl/Tcl_AddErrorInfo.3tcl.html">Tcl_AddErrorInfo</a></u>(3tcl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>