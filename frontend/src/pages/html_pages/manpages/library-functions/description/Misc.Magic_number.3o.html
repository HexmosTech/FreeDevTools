<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misc.Magic_number - no description</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/ocaml-man">ocaml-man_5.3.0-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Misc.Magic_number - no description

</pre><h4><b>Module</b></h4><pre>
       Module   Misc.Magic_number

</pre><h4><b>Documentation</b></h4><pre>
       Module <b>Magic_number</b>
        : <b>sig</b> <b>end</b>

       a  typical  magic  number  is  "Caml1999I011";  it  is  formed of an alphanumeric prefix, here Caml1990I,
       followed by a version, here 011. The prefix identifies the  kind  of  the  versioned  data:  here  the  I
       indicates that it is the magic number for .cmi files.

       All  magic  numbers have the same byte length, <b>magic_length</b> , and this is important for users as it gives
       them the number of bytes to read to obtain the byte sequence that should be a magic number. Typical  user
       code will look like:
               <b>let</b> <b>ic</b> <b>=</b> <b>open_in_bin</b> <b>path</b> <b>in</b>
               <b>let</b> <b>magic</b> <b>=</b>
                 <b>try</b> <b>really_input_string</b> <b>ic</b> <b>Magic_number.magic_length</b>
                 <b>with</b> <b>End_of_file</b> <b>-&gt;</b> <b>...</b> <b>in</b>
               <b>match</b> <b>Magic_number.parse</b> <b>magic</b> <b>with</b>
               <b>|</b> <b>Error</b> <b>parse_error</b> <b>-&gt;</b> <b>...</b>
               <b>|</b> <b>Ok</b> <b>info</b> <b>-&gt;</b> <b>...</b>

       A  given  compiler  version  expects  one specific version for each kind of object file, and will fail if
       given an unsupported version. Because versions grow monotonically, you can  compare  the  parsed  version
       with  the  expected  "current version" for a kind, to tell whether the wrong-magic object file comes from
       the past or from the future.

       An example of code block that expects the "currently supported version" of a given kind of magic numbers,
       here <b>Cmxa</b> , is as follows:
               <b>let</b> <b>ic</b> <b>=</b> <b>open_in_bin</b> <b>path</b> <b>in</b>
               <b>begin</b>
                 <b>try</b> <b>Magic_number.(expect_current</b> <b>Cmxa</b> <b>(get_info</b> <b>ic))</b> <b>with</b>
                 <b>|</b> <b>Parse_error</b> <b>error</b> <b>-&gt;</b> <b>...</b>
                 <b>|</b> <b>Unexpected</b> <b>error</b> <b>-&gt;</b> <b>...</b>
               <b>end;</b>
               <b>...</b>

       Parse errors distinguish inputs that are <b>Not_a_magic_number</b> <b>str</b> , which are likely to come from the  file
       being completely different, and <b>Truncated</b> <b>str</b> , raised by headers that are the (possibly empty) prefix of
       a valid magic number.

       Unexpected  errors  correspond  to  valid  magic numbers that are not the one expected, either because it
       corresponds to a different kind, or to a newer or older version.

       The helper functions <b>explain_parse_error</b> and <b>explain_unexpected_error</b> will generate a textual explanation
       of each error, for use in error messages.

       <u>type</u> <u>native_obj_config</u> = {
        flambda : <b>bool</b> ;
        }

       native object files have a format and magic number that depend on certain  native-compiler  configuration
       parameters. This configuration space is expressed by the <b>native_obj_config</b> type.

       <u>val</u> <u>native_obj_config</u> : <b>native_obj_config</b>

       the native object file configuration of the active/configured compiler.

       <u>type</u> <u>version</u> = <b>int</b>

       <u>type</u> <u>kind</u> =
        | Exec
        | Cmi
        | Cmo
        | Cma
        | Cmx <b>of</b> <b>native_obj_config</b>
        | Cmxa <b>of</b> <b>native_obj_config</b>
        | Cmxs
        | Cmt
        | Ast_impl
        | Ast_intf

       <u>type</u> <u>info</u> = {
        kind : <b>kind</b> ;
        version  :  <b>version</b> ;  (* Note: some versions of the compiler use the same <b>version</b> suffix for all kinds,
       but others use different versions counters for different kinds. We may  only  assume  that  versions  are
       growing monotonically (not necessarily always by one) between compiler versions.
        *)
        }

       <u>type</u> <u>raw</u> = <b>string</b>

       the type of raw magic numbers, such as "Caml1999A027" for the .cma files of OCaml 4.10

   <b>Parsing</b> <b>magic</b> <b>numbers</b>
       <u>type</u> <u>parse_error</u> =
        | Truncated <b>of</b> <b>string</b>
        | Not_a_magic_number <b>of</b> <b>string</b>

       <u>val</u> <u>explain_parse_error</u> : <b>kind</b> <b>option</b> <b>-&gt;</b> <b>parse_error</b> <b>-&gt;</b> <b>string</b>

       Produces  an  explanation  for  a  parse  error. If no kind is provided, we use an unspecific formulation
       suggesting that any compiler-produced object file would have been satisfying.

       <u>val</u> <u>parse</u> : <b>raw</b> <b>-&gt;</b> <b>(info,</b> <b>parse_error)</b> <b>result</b>

       Parses a raw magic number

       <u>val</u> <u>read_info</u> : <b>in_channel</b> <b>-&gt;</b> <b>(info,</b> <b>parse_error)</b> <b>result</b>

       Read a raw magic number from an input channel.

       If the data read <b>str</b> is not a valid  magic  number,  it  can  be  recovered  from  the  <b>Truncated</b>  <b>str</b>  <b>|</b>
       <b>Not_a_magic_number</b> <b>str</b> payload of the <b>Error</b> <b>parse_error</b> case.

       If  parsing  succeeds  with an <b>Ok</b> <b>info</b> result, we know that exactly <b>magic_length</b> bytes have been consumed
       from the input_channel.

       If  you  also  wish  to  enforce   that   the   magic   number   is   at   the   current   version,   see
       <b>Misc.Magic_number.read_current_info</b> below.

       <u>val</u> <u>magic_length</u> : <b>int</b>

       all magic numbers take the same number of bytes

   <b>Checking</b> <b>that</b> <b>magic</b> <b>numbers</b> <b>are</b> <b>current</b>
       <u>type</u> <b>'a</b> <u>unexpected</u> = {
        expected : <b>'a</b> ;
        actual : <b>'a</b> ;
        }

       <u>type</u> <u>unexpected_error</u> =
        | Kind <b>of</b> <b>kind</b> <b>unexpected</b>
        | Version <b>of</b> <b>kind</b> <b>*</b> <b>version</b> <b>unexpected</b>

       <u>val</u> <u>check_current</u> : <b>kind</b> <b>-&gt;</b> <b>info</b> <b>-&gt;</b> <b>(unit,</b> <b>unexpected_error)</b> <b>result</b>

       <b>check_current</b>  <b>kind</b>  <b>info</b>  checks  that  the  provided magic <b>info</b> is the current version of <b>kind</b> 's magic
       header.

       <u>val</u> <u>explain_unexpected_error</u> : <b>unexpected_error</b> <b>-&gt;</b> <b>string</b>

       Provides an explanation of the <b>unexpected_error</b> .

       <u>type</u> <u>error</u> =
        | Parse_error <b>of</b> <b>parse_error</b>
        | Unexpected_error <b>of</b> <b>unexpected_error</b>

       <u>val</u> <u>read_current_info</u> : <b>expected_kind:kind</b> <b>option</b> <b>-&gt;</b> <b>in_channel</b> <b>-&gt;</b> <b>(info,</b> <b>error)</b> <b>result</b>

       Read a magic number as <b>read_info</b> , and check that it  is  the  current  version  as  its  kind.   If  the
       <b>expected_kind</b> argument is <b>None</b> , any kind is accepted.

   <b>Information</b> <b>on</b> <b>magic</b> <b>numbers</b>
       <u>val</u> <u>string_of_kind</u> : <b>kind</b> <b>-&gt;</b> <b>string</b>

       a user-printable string for a kind, eg. "exec" or "cmo", to use in error messages.

       <u>val</u> <u>human_name_of_kind</u> : <b>kind</b> <b>-&gt;</b> <b>string</b>

       a  user-meaningful  name  for  a  kind,  eg. "executable file" or "bytecode object file", to use in error
       messages.

       <u>val</u> <u>current_raw</u> : <b>kind</b> <b>-&gt;</b> <b>raw</b>

       the current magic number of each kind

       <u>val</u> <u>current_version</u> : <b>kind</b> <b>-&gt;</b> <b>version</b>

       the current version of each kind

   <b>Raw</b> <b>representations</b>
       Mainly for internal usage and testing.

       <u>type</u> <u>raw_kind</u> = <b>string</b>

       the type of raw magic numbers kinds, such as "Caml1999A" for .cma files

       <u>val</u> <u>parse_kind</u> : <b>raw_kind</b> <b>-&gt;</b> <b>kind</b> <b>option</b>

       parse a raw kind into a kind

       <u>val</u> <u>raw_kind</u> : <b>kind</b> <b>-&gt;</b> <b>raw_kind</b>

       the current raw representation of a kind.

       In some cases the raw representation of a kind has changed over compiler versions, so other files of  the
       same  kind  may  have  different  raw kinds.  Note that all currently known cases are parsed correctly by
       <b>parse_kind</b> .

       <u>val</u> <u>raw</u> : <b>info</b> <b>-&gt;</b> <b>raw</b>

       A valid raw representation of the magic number.

       Due to past and future changes in the string representation of magic numbers, we  cannot  guarantee  that
       the raw strings returned for past and future versions actually match the expectations of those compilers.
       The  representation  is  accurate  for current versions, and it is correctly parsed back into the desired
       version by the parsing functions above.

       <u>val</u> <u>all_kinds</u> : <b>kind</b> <b>list</b>

OCamldoc                                           2025-06-12                              <u><a href="../man3o/Misc.Magic_number.3o.html">Misc.Magic_number</a></u>(3o)
</pre>
 </div>
</div></section>
</div>
</body>
</html>