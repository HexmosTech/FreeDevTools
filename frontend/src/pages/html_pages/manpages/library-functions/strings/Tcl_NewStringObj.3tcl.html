<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tcl_NewStringObj,    Tcl_NewUnicodeObj,    Tcl_SetStringObj,   Tcl_SetUnicodeObj,   Tcl_GetStringFromObj,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/tcl9.0-doc">tcl9.0-doc_9.0.1+dfsg-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Tcl_NewStringObj,    Tcl_NewUnicodeObj,    Tcl_SetStringObj,   Tcl_SetUnicodeObj,   Tcl_GetStringFromObj,
       Tcl_GetString, Tcl_GetUnicodeFromObj, Tcl_GetUnicode,  Tcl_GetUniChar,  Tcl_GetCharLength,  Tcl_GetRange,
       Tcl_AppendToObj,        Tcl_AppendUnicodeToObj,        Tcl_AppendObjToObj,        Tcl_AppendStringsToObj,
       Tcl_AppendLimitedToObj,   Tcl_Format,   Tcl_AppendFormatToObj,   Tcl_ObjPrintf,    Tcl_AppendPrintfToObj,
       Tcl_SetObjLength, Tcl_AttemptSetObjLength, Tcl_ConcatObj - manipulate Tcl values as strings

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;tcl.h&gt;</b>

       Tcl_Obj *
       <b>Tcl_NewStringObj</b>(<u>bytes,</u> <u>length</u>)

       Tcl_Obj *
       <b>Tcl_NewUnicodeObj</b>(<u>unicode,</u> <u>numChars</u>)

       void
       <b>Tcl_SetStringObj</b>(<u>objPtr,</u> <u>bytes,</u> <u>length</u>)

       void
       <b>Tcl_SetUnicodeObj</b>(<u>objPtr,</u> <u>unicode,</u> <u>numChars</u>)

       char *
       <b>Tcl_GetStringFromObj</b>(<u>objPtr,</u> <u>lengthPtr</u>)

       char *
       <b>Tcl_GetString</b>(<u>objPtr</u>)

       Tcl_UniChar *
       <b>Tcl_GetUnicodeFromObj</b>(<u>objPtr,</u> <u>lengthPtr</u>)

       Tcl_UniChar *
       <b>Tcl_GetUnicode</b>(<u>objPtr</u>)

       int
       <b>Tcl_GetUniChar</b>(<u>objPtr,</u> <u>index</u>)

       Tcl_Size
       <b>Tcl_GetCharLength</b>(<u>objPtr</u>)

       Tcl_Obj *
       <b>Tcl_GetRange</b>(<u>objPtr,</u> <u>first,</u> <u>last</u>)

       void
       <b>Tcl_AppendToObj</b>(<u>objPtr,</u> <u>bytes,</u> <u>length</u>)

       void
       <b>Tcl_AppendUnicodeToObj</b>(<u>objPtr,</u> <u>unicode,</u> <u>numChars</u>)

       void
       <b>Tcl_AppendObjToObj</b>(<u>objPtr,</u> <u>appendObjPtr</u>)

       void
       <b>Tcl_AppendStringsToObj</b>(<u>objPtr,</u> <u>string,</u> <u>string,</u> <u>...</u> <b>(char</b> <b>*)NULL</b>)

       void
       <b>Tcl_AppendLimitedToObj</b>(<u>objPtr,</u> <u>bytes,</u> <u>length,</u> <u>limit,</u> <u>ellipsis</u>)

       Tcl_Obj *
       <b>Tcl_Format</b>(<u>interp,</u> <u>format,</u> <u>objc,</u> <u>objv</u>)

       int
       <b>Tcl_AppendFormatToObj</b>(<u>interp,</u> <u>objPtr,</u> <u>format,</u> <u>objc,</u> <u>objv</u>)

       Tcl_Obj *
       <b>Tcl_ObjPrintf</b>(<u>format,</u> <u>...</u>)

       void
       <b>Tcl_AppendPrintfToObj</b>(<u>objPtr,</u> <u>format,</u> <u>...</u>)

       void
       <b>Tcl_SetObjLength</b>(<u>objPtr,</u> <u>newLength</u>)

       int
       <b>Tcl_AttemptSetObjLength</b>(<u>objPtr,</u> <u>newLength</u>)

       Tcl_Obj *
       <b>Tcl_ConcatObj</b>(<u>objc,</u> <u>objv</u>)

</pre><h4><b>ARGUMENTS</b></h4><pre>
       const char <u>*bytes</u> (in)                        Points to the first byte of an array of UTF-8-encoded bytes
                                                     used  to  set or append to a string value.  This byte array
                                                     may contain embedded null  characters  unless  <u>numChars</u>  is
                                                     negative.    (Applications   needing   null   bytes  should
                                                     represent them  as  the  two-byte  sequence  <u>\300\200</u>,  use
                                                     <b>Tcl_ExternalToUtf</b> to convert, or <b>Tcl_NewByteArrayObj</b> if the
                                                     string is a collection of uninterpreted bytes.)

       Tcl_Size <u>length</u> (in)                          The  number  of bytes to copy from <u>bytes</u> when initializing,
                                                     setting, or appending to a string value.  If negative,  all
                                                     bytes up to the first null are used.

       const Tcl_UniChar <u>*unicode</u> (in)               Points  to the first byte of an array of Unicode characters
                                                     used to set or append to a string value.  This  byte  array
                                                     may  contain  embedded  null  characters unless <u>numChars</u> is
                                                     negative.

       Tcl_Size <u>numChars</u> (in)                        The number of Unicode characters to copy from <u>unicode</u>  when
                                                     initializing,  setting, or appending to a string value.  If
                                                     negative, all characters up to the first null character are
                                                     used.

       Tcl_Size <u>index</u> (in)                           The index of the Unicode character to return.

       Tcl_Size <u>first</u> (in)                           The index of the first Unicode  character  in  the  Unicode
                                                     range  to  be  returned as a new value. If negative, behave
                                                     the same as if the value was 0.

       Tcl_Size <u>last</u> (in)                            The index of the last  Unicode  character  in  the  Unicode
                                                     range  to be returned as a new value. If negative, take all
                                                     characters up to the last one available.

       Tcl_Obj <u>*objPtr</u> (in/out)                      A pointer to a value to read, or to an  unshared  value  to
                                                     modify.

       Tcl_Obj <u>*appendObjPtr</u> (in)                    The value to append to <u>objPtr</u> in <b>Tcl_AppendObjToObj</b>.

       Tcl_Size | int <u>*lengthPtr</u> (out)               The  location  where  <b>Tcl_GetStringFromObj</b>  will  store the
                                                     length  of  a  value's  string  representation.    May   be
                                                     (Tcl_Size  *)NULL when not used. If it points to a variable
                                                     which type is not <b>Tcl_Size</b>,  a  compiler  warning  will  be
                                                     generated.    If   your   extensions   is   compiled   with
                                                     -DTCL_8_API, this function will panic for strings with more
                                                     than  INT_MAX  bytes/characters,  otherwise  expect  it  to
                                                     crash.

       const char <u>*string</u> (in)                       Null-terminated string value to append to <u>objPtr</u>.

       Tcl_Size <u>limit</u> (in)                           Maximum number of bytes to be appended.

       const char <u>*ellipsis</u> (in)                     Suffix to append when the limit leads to string truncation.
                                                     If NULL is passed then the suffix “...”  is used.

       const char <u>*format</u> (in)                       Format control string including % conversion specifiers.

       Tcl_Size <u>objc</u> (in)                            The number of elements to format or concatenate.

       Tcl_Obj <u>*objv[]</u> (in)                          The array of values to format or concatenate.

       Tcl_Size <u>newLength</u> (in)                       New  length  for  the string value of <u>objPtr</u>, not including
                                                     the final null character.
________________________________________________________________________________________________________________

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The procedures described in this manual entry allow Tcl values to be manipulated as string values.   They
       use  the  internal  representation  of  the  value  to  store  additional  information to make the string
       manipulations more efficient.  In particular, they make  a  series  of  append  operations  efficient  by
       allocating  extra  storage  space  for  the string so that it does not have to be copied for each append.
       Also, indexing and length computations  are  optimized  because  the  Unicode  string  representation  is
       calculated  and cached as needed.  When using the <b>Tcl_Append*</b> family of functions where the interpreter's
       result is the value being appended to, it is important to call Tcl_ResetResult first to  ensure  you  are
       not unintentionally appending to existing data in the result value.

       <b>Tcl_NewStringObj</b>  and  <b>Tcl_SetStringObj</b>  create a new value or modify an existing value to hold a copy of
       the string given by <u>bytes</u> and <u>length</u>.  <b>Tcl_NewUnicodeObj</b> and <b>Tcl_SetUnicodeObj</b>  create  a  new  value  or
       modify  an  existing  value  to  hold  a  copy  of  the  Unicode  string  given  by <u>unicode</u> and <u>numChars</u>.
       <b>Tcl_NewStringObj</b> and <b>Tcl_NewUnicodeObj</b> return a pointer to a newly created  value  with  reference  count
       zero.   All  four  procedures set the value to hold a copy of the specified string.  <b>Tcl_SetStringObj</b> and
       <b>Tcl_SetUnicodeObj</b> free any old string representation as well as any old internal  representation  of  the
       value.

       <b>Tcl_GetStringFromObj</b>  and  <b>Tcl_GetString</b>  return  a  value's string representation.  This is given by the
       returned byte pointer and (for <b>Tcl_GetStringFromObj</b>) length, which is stored in <u>lengthPtr</u> if it  is  non-
       NULL.   If  the  value's  UTF  string  representation  is  invalid (its byte pointer is NULL), the string
       representation is regenerated from the value's internal representation.  The storage  referenced  by  the
       returned  byte  pointer  is  owned by the value manager.  It is passed back as a writable pointer so that
       extension author creating their own <b>Tcl_ObjType</b> will be able to modify the string  representation  within
       the  <b>Tcl_UpdateStringProc</b> of their <b>Tcl_ObjType</b>.  Except for that limited purpose, the pointer returned by
       <b>Tcl_GetStringFromObj</b> or <b>Tcl_GetString</b> should be treated  as  read-only.   It  is  recommended  that  this
       pointer  be  assigned to a (const char *) variable.  Even in the limited situations where writing to this
       pointer is acceptable, one should take care to respect the copy-on-write semantics required by <b>Tcl_Obj</b>'s,
       with appropriate calls to <b>Tcl_IsShared</b> and <b>Tcl_DuplicateObj</b> prior to any  in-place  modification  of  the
       string  representation.  The procedure <b>Tcl_GetString</b> is used in the common case where the caller does not
       need the length of the string representation.

       <b>Tcl_GetUnicodeFromObj</b> and <b>Tcl_GetUnicode</b> return a value's value as a Unicode string.  This  is  given  by
       the  returned  pointer and (for <b>Tcl_GetUnicodeFromObj</b>) length, which is stored in <u>lengthPtr</u> if it is non-
       NULL.  The storage referenced by the returned byte pointer is owned by the value manager and  should  not
       be modified by the caller.  The procedure <b>Tcl_GetUnicode</b> is used in the common case where the caller does
       not need the length of the unicode string representation.

       <b>Tcl_GetUniChar</b>  returns the <u>index</u>'th character in the value's Unicode representation. If the index is out
       of range it returns -1;

       <b>Tcl_GetRange</b> returns a newly created value comprised of the characters between <u>first</u> and <u>last</u> (inclusive)
       in the value's Unicode representation.  If the value's Unicode representation  is  invalid,  the  Unicode
       representation  is  regenerated  from  the value's string representation.  If <u>first</u> is negative, then the
       returned string starts at the beginning of the value. If <u>last</u> negative, then the returned string ends  at
       the end of the value.

       <b>Tcl_GetCharLength</b> returns the number of characters (as opposed to bytes) in the string value.

       <b>Tcl_AppendToObj</b>  appends  the  data  given  by <u>bytes</u> and <u>length</u> to the string representation of the value
       specified by <u>objPtr</u>.  If the value has an invalid string representation,  then  an  attempt  is  made  to
       convert  <u>bytes</u>  to the Unicode format.  If the conversion is successful, then the converted form of <u>bytes</u>
       is appended to the value's Unicode representation.  Otherwise,  the  value's  Unicode  representation  is
       invalidated  and  converted  to  the  UTF  format,  and  <u>bytes</u>  is  appended  to  the  value's new string
       representation.  Eventually buffer growth is done by large allocations to optimize multiple calls.

       <b>Tcl_AppendUnicodeToObj</b> appends the Unicode string given by <u>unicode</u> and <u>numChars</u> to the value specified by
       <u>objPtr</u>.  If the value has an invalid Unicode representation, then <u>unicode</u> is converted to the UTF  format
       and  appended  to  the  value's  string representation.  Appends are optimized to handle repeated appends
       relatively efficiently (it over-allocates the string or Unicode space to avoid repeated reallocations and
       copies of value's string value).

       <b>Tcl_AppendObjToObj</b> is similar to <b>Tcl_AppendToObj</b>, but it appends the string or Unicode  value  (whichever
       exists and is best suited to be appended to <u>objPtr</u>) of <u>appendObjPtr</u> to <u>objPtr</u>.

       <b>Tcl_AppendStringsToObj</b>  is similar to <b>Tcl_AppendToObj</b> except that it can be passed more than one value to
       append and each value must be a null-terminated string (i.e. none of the values may contain internal null
       characters).  Any number of <u>string</u> arguments may be provided, but the last argument must be (char  *)NULL
       to indicate the end of the list.

       <b>Tcl_AppendLimitedToObj</b> is similar to <b>Tcl_AppendToObj</b> except that it imposes a limit on how many bytes are
       appended.   This  can  be  handy  when the string to be appended might be very large, but the value being
       constructed should not be allowed to grow without bound. A common usage is  when  constructing  an  error
       message,  where  the end result should be kept short enough to be read.  Bytes from <u>bytes</u> are appended to
       <u>objPtr</u>, but no more than <u>limit</u> bytes total are to be appended. If the limit  prevents  all  <u>length</u>  bytes
       that  are  available  from being appended, then the appending is done so that the last bytes appended are
       from the string <u>ellipsis</u>. This allows for an indication of the truncation to be left in the string.  When
       <u>length</u> is negative, all bytes up to the first zero byte are appended, subject to the limit. When <u>ellipsis</u>
       is NULL, the default string <b>...</b> is used. When <u>ellipsis</u>  is  non-NULL,  it  must  point  to  a  zero-byte-
       terminated  string  in  Tcl's  internal  UTF encoding.  The number of bytes appended can be less than the
       lesser of <u>length</u> and <u>limit</u> when appending fewer bytes  is  necessary  to  append  only  whole  multi-byte
       characters.

       <b>Tcl_Format</b>  is  the  C-level interface to the engine of the <b>format</b> command.  The actual command procedure
       for <b>format</b> is little more than

              <b>Tcl_Format</b>(interp, <b>Tcl_GetString</b>(objv[1]), objc-2, objv+2);

       The <u>objc</u> Tcl_Obj values in <u>objv</u> are formatted into a string according to the conversion specification  in
       <u>format</u>  argument,  following the documentation for the <b>format</b> command.  The resulting formatted string is
       converted to a new Tcl_Obj with refcount of zero and returned.  If some error happens  during  production
       of  the formatted string, NULL is returned, and an error message is recorded in <u>interp</u>, if <u>interp</u> is non-
       NULL.

       <b>Tcl_AppendFormatToObj</b> is an appending alternative form of <b>Tcl_Format</b> with functionality equivalent to:

              Tcl_Obj *newPtr = <b>Tcl_Format</b>(interp, format, objc, objv);
              if (newPtr == NULL) return TCL_ERROR;
              <b>Tcl_AppendObjToObj</b>(objPtr, newPtr);
              <b>Tcl_DecrRefCount</b>(newPtr);
              return TCL_OK;

       but with greater convenience and efficiency when the appending functionality is needed.

       <b>Tcl_ObjPrintf</b> serves as a replacement for the common sequence

              char buf[SOME_SUITABLE_LENGTH];
              sprintf(buf, format, ...);
              <b>Tcl_NewStringObj</b>(buf, -1);

       but with greater convenience and no need to determine <b>SOME_SUITABLE_LENGTH</b>. The formatting is  done  with
       the  same  core  formatting  engine  used  by  <b>Tcl_Format</b>.   This  means  the set of supported conversion
       specifiers is that of the <b>format</b> command but the behavior is as similar as possible to <b>sprintf</b>. The  "hh"
       and  (Microsoft-specific) "w" format specifiers are not supported. The "L" format specifier means that an
       "mp_int *" argument is expected (or a "long double" in combination with <b>[aAeEgGaA]</b>).  When  a  conversion
       specifier  passed  to  <b>Tcl_ObjPrintf</b>  includes  a  precision, the value is taken as a number of bytes, as
       <b>sprintf</b> does, and not as a number of characters, as <b>format</b> does.  This is done on the assumption  that  C
       code  is  more  likely  to know how many bytes it is passing around than the number of encoded characters
       those bytes happen to represent.  The variable number of arguments passed in should be of the types  that
       would be suitable for passing to <b>sprintf</b>.  Note in this example usage, <u>x</u> is of type <b>int</b>.

              int x = 5;
              Tcl_Obj *objPtr = <b>Tcl_ObjPrintf</b>("Value is %d", x);

       If  the  value  of  <u>format</u>  contains internal inconsistencies or invalid specifier formats, the formatted
       string result produced by <b>Tcl_ObjPrintf</b> will be an error message describing the error.  It is  impossible
       however to provide runtime protection against mismatches between the format and any subsequent arguments.
       Compile-time protection may be provided by some compilers.

       <b>Tcl_AppendPrintfToObj</b> is an appending alternative form of <b>Tcl_ObjPrintf</b> with functionality equivalent to

              Tcl_Obj *newPtr = <b>Tcl_ObjPrintf</b>(format, ...);
              <b>Tcl_AppendObjToObj</b>(objPtr, newPtr);
              <b>Tcl_DecrRefCount</b>(newPtr);

       but with greater convenience and efficiency when the appending functionality is needed.

       The  <b>Tcl_SetObjLength</b>  procedure  changes  the length of the string value of its <u>objPtr</u> argument.  If the
       <u>newLength</u> argument is greater than the space allocated for the value's string, then the string  space  is
       reallocated  and the old value is copied to the new space; the bytes between the old length of the string
       and the new length may have arbitrary values.  If the <u>newLength</u> argument is less than the current  length
       of the value's string, with <u>objPtr-&gt;length</u> is reduced without reallocating the string space; the original
       allocated  size  for  the string is recorded in the value, so that the string length can be enlarged in a
       subsequent call to <b>Tcl_SetObjLength</b> without reallocating storage.  In all cases <b>Tcl_SetObjLength</b> leaves a
       null character at <u>objPtr-&gt;bytes[newLength]</u>.

       <b>Tcl_AttemptSetObjLength</b> is identical in function to <b>Tcl_SetObjLength</b> except that if sufficient memory  to
       satisfy  the  request  cannot  be  allocated,  it  does not cause the Tcl interpreter to <b>panic</b>.  Thus, if
       <u>newLength</u> is greater than the space allocated for the value's string, and  there  is  not  enough  memory
       available  to  satisfy  the request, <b>Tcl_AttemptSetObjLength</b> will take no action and return 0 to indicate
       failure.  If there is enough memory to satisfy the request,  <b>Tcl_AttemptSetObjLength</b>  behaves  just  like
       <b>Tcl_SetObjLength</b> and returns 1 to indicate success.

       The <b>Tcl_ConcatObj</b> function returns a new string value whose value is the space-separated concatenation of
       the  string  representations of all of the values in the <u>objv</u> array. <b>Tcl_ConcatObj</b> eliminates leading and
       trailing white space as it copies the string representations of the <u>objv</u>  array  to  the  result.  If  an
       element  of the <u>objv</u> array consists of nothing but white space, then that value is ignored entirely. This
       white-space removal was added to make the output of the  <b>concat</b>  command  cleaner-looking.  <b>Tcl_ConcatObj</b>
       returns a pointer to a newly-created value whose ref count is zero.

</pre><h4><b>REFERENCE</b> <b>COUNT</b> <b>MANAGEMENT</b></h4><pre>
       <b>Tcl_NewStringObj</b>,  <b>Tcl_NewUnicodeObj</b>,  <b>Tcl_Format</b>, <b>Tcl_ObjPrintf</b>, and <b>Tcl_ConcatObj</b> always return a zero-
       reference object, much like <b>Tcl_NewObj</b>.

       <b>Tcl_GetStringFromObj</b>,    <b>Tcl_GetString</b>,    <b>Tcl_GetUnicodeFromObj</b>,     <b>Tcl_GetUnicode</b>,     <b>Tcl_GetUniChar</b>,
       <b>Tcl_GetCharLength</b>,  and  <b>Tcl_GetRange</b>  all  only  work with an existing value; they do not manipulate its
       reference count in any way.

       <b>Tcl_SetStringObj</b>,   <b>Tcl_SetUnicodeObj</b>,   <b>Tcl_AppendToObj</b>,   <b>Tcl_AppendUnicodeToObj</b>,   <b>Tcl_AppendObjToObj</b>,
       <b>Tcl_AppendStringsToObj</b>,    <b>Tcl_AppendStringsToObjVA</b>,    <b>Tcl_AppendLimitedToObj</b>,    <b>Tcl_AppendFormatToObj</b>,
       <b>Tcl_AppendPrintfToObj</b>, <b>Tcl_SetObjLength</b>, and <b>Tcl_AttemptSetObjLength</b> and require their <u>objPtr</u>  to  be  an
       unshared value (i.e, a reference count no more than 1) as they will modify it.

       Additional  arguments  to the above functions (the <u>appendObjPtr</u> argument to <b>Tcl_AppendObjToObj</b>, values in
       the <u>objv</u> argument to <b>Tcl_Format</b>, <b>Tcl_AppendFormatToObj</b>, and <b>Tcl_ConcatObj</b>) can have any reference  count,
       but reference counts of zero are not recommended.

       <b>Tcl_Format</b>  and  <b>Tcl_AppendFormatToObj</b>  may  modify  the  interpreter result, which involves changing the
       reference count of a value.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man3tcl/Tcl_NewObj.3tcl.html">Tcl_NewObj</a>(3tcl), <a href="../man3tcl/Tcl_IncrRefCount.3tcl.html">Tcl_IncrRefCount</a>(3tcl), <a href="../man3tcl/Tcl_DecrRefCount.3tcl.html">Tcl_DecrRefCount</a>(3tcl), <a href="../man3tcl/format.3tcl.html">format</a>(3tcl), <a href="../man3/sprintf.3.html">sprintf</a>(3)

</pre><h4><b>KEYWORDS</b></h4><pre>
       append, internal representation, value, value type, string value,  string  type,  string  representation,
       concat, concatenate, unicode

Tcl                                                    8.1                                   <u><a href="../man3tcl/Tcl_StringObj.3tcl.html">Tcl_StringObj</a></u>(3tcl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>