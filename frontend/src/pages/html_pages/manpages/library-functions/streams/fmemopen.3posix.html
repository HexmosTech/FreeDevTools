<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-posix-dev">manpages-posix-dev_2017a-2_all</a> <br><br><pre>
</pre><h4><b>PROLOG</b></h4><pre>
       This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface
       may differ (consult the corresponding Linux manual page for details of Linux behavior), or the  interface
       may not be implemented on Linux.

</pre><h4><b>NAME</b></h4><pre>
       fmemopen — open a memory buffer stream

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;

       FILE *fmemopen(void *restrict <u>buf</u>, size_t <u>size</u>,
           const char *restrict <u>mode</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <u>fmemopen</u>() function shall associate the buffer given by the <u>buf</u> and <u>size</u> arguments with a stream. The
       <u>buf</u> argument shall be either a null pointer or point to a buffer that is at least <u>size</u> bytes long.

       The  <u>mode</u>  argument points to a string. If the string is one of the following, the stream shall be opened
       in the indicated mode. Otherwise, the behavior is undefined.

       <u>r</u>       Open the stream for reading.

       <u>w</u>       Open the stream for writing.

       <u>a</u>       Append; open the stream for writing at the first null byte.

       <u>r</u>+      Open the stream for update (reading and writing).

       <u>w</u>+      Open the stream for update (reading and writing). Truncate the buffer contents.

       <u>a</u>+      Append; open the stream for update (reading and writing); the initial position is  at  the  first
               null byte.

       Implementations  shall accept all mode strings allowed by <u>fopen</u>(), but the use of the character <b>'b'</b> shall
       produce implementation-defined results, where the resulting <b>FILE</b> <b>*</b> need not behave the  same  as  if  <b>'b'</b>
       were omitted.

       If  a null pointer is specified as the <u>buf</u> argument, <u>fmemopen</u>() shall allocate <u>size</u> bytes of memory as if
       by a call to <u>malloc</u>().  This buffer shall be automatically freed when the stream is closed.  Because this
       feature is only useful when the stream is opened for updating (because there is no way to get  a  pointer
       to the buffer) the <u>fmemopen</u>() call may fail if the <u>mode</u> argument does not include a <b>'+'</b>.

       The  stream  shall  maintain  a  current  position in the buffer. This position shall be initially set to
       either the beginning of the buffer (for <u>r</u> and <u>w</u> modes) or to the first null byte in  the  buffer  (for  <u>a</u>
       modes).  If no null byte is found in append mode, the initial position shall be set to one byte after the
       end of the buffer.

       If <u>buf</u> is a null pointer, the initial position shall always be set to the beginning of the buffer.

       The stream shall also maintain the size of the current buffer contents; use of <u>fseek</u>() or <u>fseeko</u>() on the
       stream with SEEK_END shall seek relative to this size. For modes <u>r</u> and <u>r+</u> the size shall be  set  to  the
       value  given  by the <u>size</u> argument. For modes <u>w</u> and <u>w+</u> the initial size shall be zero and for modes <u>a</u> and
       <u>a+</u> the initial size shall be:

        *  Zero, if <u>buf</u> is a null pointer

        *  The position of the first null byte in the buffer, if one is found

        *  The value of the <u>size</u> argument, if <u>buf</u> is not a null pointer and no null byte is found

       A read operation on the stream shall not advance the current buffer position beyond  the  current  buffer
       size.  Reaching  the  buffer  size  in a read operation shall count as ``end-of-file''. Null bytes in the
       buffer shall have no special meaning for reads. The read operation shall  start  at  the  current  buffer
       position of the stream.

       A write operation shall start either at the current position of the stream (if <u>mode</u> has not specified <b>'a'</b>
       as the first character) or at the current size of the stream (if <u>mode</u> had <b>'a'</b> as the first character). If
       the  current  position at the end of the write is larger than the current buffer size, the current buffer
       size shall be set to the current position. A write operation on the stream shall not advance the  current
       buffer size beyond the size given in the <u>size</u> argument.

       When a stream open for writing is flushed or closed, a null byte shall be written at the current position
       or  at  the  end  of  the  buffer,  depending on the size of the contents. If a stream open for update is
       flushed or closed and the last write has advanced the current buffer size, a null byte shall  be  written
       at the end of the buffer if it fits.

       An  attempt to seek a memory buffer stream to a negative position or to a position larger than the buffer
       size given in the <u>size</u> argument shall fail.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       Upon successful completion, <u>fmemopen</u>() shall return a pointer  to  the  object  controlling  the  stream.
       Otherwise, a null pointer shall be returned, and <u>errno</u> shall be set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       The <u>fmemopen</u>() function shall fail if:

       <b>EMFILE</b> {STREAM_MAX} streams are currently open in the calling process.

       The <u>fmemopen</u>() function may fail if:

       <b>EINVAL</b> The value of the <u>mode</u> argument is not valid.

       <b>EINVAL</b> The <u>buf</u> argument is a null pointer and the <u>mode</u> argument does not include a <b>'+'</b> character.

       <b>EINVAL</b> The <u>size</u> argument specifies a buffer size of zero and the implementation does not support this.

       <b>ENOMEM</b> The <u>buf</u> argument is a null pointer and the allocation of a buffer of length <u>size</u> has failed.

       <b>EMFILE</b> {FOPEN_MAX} streams are currently open in the calling process.

       <u>The</u> <u>following</u> <u>sections</u> <u>are</u> <u>informative.</u>

</pre><h4><b>EXAMPLES</b></h4><pre>
           #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
           #include &lt;<a href="file:/usr/include/string.h">string.h</a>&gt;

           static char buffer[] = "foobar";

           int
           main (void)
           {
               int ch;
               FILE *stream;

               stream = fmemopen(buffer, strlen (buffer), "r");
               if (stream == NULL)
                   /* handle error */;

               while ((ch = fgetc(stream)) != EOF)
                   printf("Got %c\n", ch);

               fclose(stream);
               return (0);
           }

       This program produces the following output:

           Got f
           Got o
           Got o
           Got b
           Got a
           Got r

</pre><h4><b>APPLICATION</b> <b>USAGE</b></h4><pre>
       None.

</pre><h4><b>RATIONALE</b></h4><pre>
       This  interface  has  been  introduced to eliminate many of the errors encountered in the construction of
       strings, notably overflowing of strings. This interface prevents overflow.

</pre><h4><b>FUTURE</b> <b>DIRECTIONS</b></h4><pre>
       A future version of this standard may mandate specific behavior when the <u>mode</u> argument includes <b>'b'</b>.

       A future version of this standard may require support of zero-length buffer streams explicitly.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>fdopen</u>(), <u>fopen</u>(), <u>freopen</u>(), <u>fseek</u>(), <u>malloc</u>(), <u>open_memstream</u>()

       The Base Definitions volume of POSIX.1‐2017, <b>&lt;stdio.h&gt;</b>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1-2017, Standard
       for Information  Technology  --  Portable  Operating  System  Interface  (POSIX),  The  Open  Group  Base
       Specifications  Issue  7, 2018 Edition, Copyright (C) 2018 by the Institute of Electrical and Electronics
       Engineers, Inc and The Open Group.  In the event of any discrepancy between this version and the original
       IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee  document.
       The original Standard can be obtained online at <a href="http://www.opengroup.org/unix/online.html">http://www.opengroup.org/unix/online.html</a> .

       Any  typographical  or formatting errors that appear in this page are most likely to have been introduced
       during  the  conversion  of  the  source  files  to  man  page  format.  To  report  such   errors,   see
       https://www.kernel.org/doc/man-pages/reporting_bugs.html .

IEEE/The Open Group                                   2017                                      <u><a href="../man3POSIX/FMEMOPEN.3POSIX.html">FMEMOPEN</a></u>(3POSIX)
</pre>
 </div>
</div></section>
</div>
</body>
</html>