<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tracefs_instance_set_affinity, tracefs_instance_set_affinity_set, tracefs_instance_set_affinity_raw,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtracefs-doc">libtracefs-doc_1.8.1-1ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tracefs_instance_set_affinity, tracefs_instance_set_affinity_set, tracefs_instance_set_affinity_raw,
       tracefs_instance_get_affinity, tracefs_instance_get_affinity_set, tracefs_instance_get_affinity_raw -
       Sets or retrieves the affinity for an instance or top level for what CPUs enable tracing.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;tracefs.h&gt;</b>

       int <b>tracefs_instance_set_affinity</b>(struct tracefs_instance *<u>instance</u>, const char *<u>cpu_str</u>);
       int <b>tracefs_instance_set_affinity_set</b>(struct tracefs_instance *<u>instance</u>, cpu_set_t *<u>set</u>, size_t <u>set_size</u>);
       int <b>tracefs_instance_set_affinity_raw</b>(struct tracefs_instance *<u>instance</u>, const char *<u>mask</u>);

       char *<b>tracefs_instance_get_affinity</b>(struct tracefs_instance *<u>instance</u>);
       int <b>tracefs_instance_get_affinity_set</b>(struct tracefs_instance *<u>instance</u>, cpu_set_t *<u>set</u>, size_t <u>set_size</u>);
       char *<b>tracefs_instance_get_affinity_raw</b>(struct tracefs_instance *<u>instance</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       These functions set or retrieve the CPU affinity that limits what CPUs will have tracing enabled for a
       given instance defined by the <u>instance</u> parameter. If <u>instance</u> is NULL, then the top level instance is
       affected.

       The <b>tracefs_instance_set_affinity()</b> function takes a string <u>cpu_str</u> that is a list of CPUs to set the
       affinity for. If <u>cpu_str</u> is NULL, then all the CPUs in the system will be set. The format of <u>cpu_str</u> is a
       comma delimited string of decimal numbers with no spaces. A range may be specified by a hyphen.

       For example: "1,4,6-8"

       The numbers do not need to be in order except for ranges, where the second number must be equal to or
       greater than the first.

       The <b>tracefs_instance_set_affinity_set()</b> function takes a CPU set defined by <b><a href="../man3/CPU_SET.3.html">CPU_SET</a></b>(3). The size of the
       set defined by <u>set_size</u> is the size in bytes of <u>set</u>. If <u>set</u> is NULL then all the CPUs on the system will
       be set, and <u>set_size</u> is ignored.

       The <b>tracefs_instance_set_affinity_raw()</b> function takes a string that holds a hexidecimal bitmask, where
       each 32 bits is separated by a comma. For a machine with more that 32 CPUs, to set CPUS 1-10 and CPU 40:

           "100,000007fe"

       Where the above is a hex representation of bits 1-10 and bit 40 being set.

       The <b>tracefs_instance_get_affinity()</b> will retrieve the affinity in a human readable form.

       For example: "1,4,6-8"

       The string returned must be freed with <b><a href="../man3/free.3.html">free</a></b>(3).

       The <b>tracefs_instance_get_affinity_set()</b> will set all the bits in the passed in cpu set (from <b><a href="../man3/CPU_SET.3.html">CPU_SET</a></b>(3)).
       Note it will not clear any bits that are already set in the set but the CPUs are not. If only the bits
       for the CPUs that are enabled should be set, a CPU_ZERO_S() should be performed on the set before calling
       this function.

       The <b>tracefs_instance_get_affinity_raw()</b> will simply read the instance tracing_cpumask and return that
       string. The returned string must be freed with <b><a href="../man3/free.3.html">free</a></b>(3).

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       All the set functions return 0 on success and -1 on error.

       The functions <b>tracefs_instance_get_affinity()</b> and <b>tracefs_instance_get_affinity_raw()</b> returns an
       allocated string that must be freed with <b><a href="../man3/free.3.html">free</a></b>(3), or NULL on error.

       The function <b>tracefs_instance_get_affinity_set()</b> returns the number of CPUs that were found set, or -1 on
       error.

</pre><h4><b>ERRORS</b></h4><pre>
       The following errors are for all the above calls:

       <b>EFBIG</b> if a CPU is set that is greater than what is in the system.

       <b>EINVAL</b> One of the parameters was invalid.

       The following errors are for <b>tracefs_instance_set_affinity</b>() and <b>tracefs_instance_set_affinity_set</b>():

       <b>ENOMEM</b> Memory allocation error.

       <b>ENODEV</b> dynamic events of requested type are not configured for the running kernel.

       The following errors are just for <b>tracefs_instance_set_affinity</b>()

       <b>EACCES</b> The <u>cpu_str</u> was modified by another thread when processing it.

</pre><h4><b>EXAMPLE</b></h4><pre>
           #include &lt;<a href="file:/usr/include/sched.h">sched.h</a>&gt;
           #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
           #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
           #include &lt;tracefs.h&gt;

           int main (int argc, char **argv)
           {
                   struct trace_seq seq;
                   cpu_set_t *set;
                   size_t set_size;
                   char *c;
                   int cpu1;
                   int cpu2;
                   int i;

                   c = tracefs_instance_get_affinity(NULL);
                   printf("The affinity was %s\n", c);
                   free(c);

                   if (argc &lt; 2) {
                           tracefs_instance_set_affinity(NULL, NULL);
                           <a href="../man0/exit.0.html">exit</a>(0);
                   }
                   /* Show example using a set */
                   if (argc == 2 &amp;&amp; !strchr(argv[1],',')) {
                           cpu1 = atoi(argv[1]);
                           c = strchr(argv[1], '-');
                           if (c++)
                                   cpu2 = atoi(c);
                           else
                                   cpu2 = cpu1;
                           if (cpu2 &lt; cpu1) {
                                   fprintf(stderr, "Invalid CPU range\n");
                                   exit(-1);
                           }
                           set = CPU_ALLOC(cpu2 + 1);
                           set_size = CPU_ALLOC_SIZE(cpu2 + 1);
                           CPU_ZERO_S(set_size, set);
                           for ( ; cpu1 &lt;= cpu2; cpu1++)
                                   CPU_SET(cpu1, set);
                           tracefs_instance_set_affinity_set(NULL, set, set_size);
                           CPU_FREE(set);
                           <a href="../man0/exit.0.html">exit</a>(0);
                   }

                   trace_seq_init(&amp;seq);
                   for (i = 1; i &lt; argc; i++) {
                           if (i &gt; 1)
                                   trace_seq_putc(&amp;seq, ',');
                           trace_seq_puts(&amp;seq, argv[i]);
                   }
                   trace_seq_terminate(&amp;seq);
                   tracefs_instance_set_affinity(NULL, seq.buffer);
                   trace_seq_destroy(&amp;seq);
                   <a href="../man0/exit.0.html">exit</a>(0);

                   return 0;
           }

</pre><h4><b>FILES</b></h4><pre>
           <b>tracefs.h</b>
                   Header file to include in order to have access to the library APIs.
           <b>-ltracefs</b>
                   Linker switch to add when building a program that uses the library.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/libtracefs.3.html">libtracefs</a></b>(3), <b><a href="../man3/libtraceevent.3.html">libtraceevent</a></b>(3), <b><a href="../man1/trace-cmd.1.html">trace-cmd</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
           <b>Steven</b> <b>Rostedt</b> &lt;<b><a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a></b>[1]&gt;
           <b>Tzvetomir</b> <b>Stoyanov</b> &lt;<b><a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a></b>[2]&gt;

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;<b><a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a></b>[3]&gt;

</pre><h4><b>LICENSE</b></h4><pre>
       libtracefs is Free Software licensed under the GNU LGPL 2.1

</pre><h4><b>RESOURCES</b></h4><pre>
       <b>https://git.kernel.org/pub/scm/libs/libtrace/libtracefs.git/</b>

</pre><h4><b>COPYING</b></h4><pre>
       Copyright (C) 2020 VMware, Inc. Free use of this software is granted under the terms of the GNU Public
       License (GPL).

</pre><h4><b>NOTES</b></h4><pre>
        1. <a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a>
           <a href="mailto:rostedt@goodmis.org">mailto:rostedt@goodmis.org</a>

        2. <a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a>
           <a href="mailto:tz.stoyanov@gmail.com">mailto:tz.stoyanov@gmail.com</a>

        3. <a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a>
           <a href="mailto:linux-trace-devel@vger.kernel.org">mailto:linux-trace-devel@vger.kernel.org</a>

libtracefs 1.8.1                                   06/05/2025                                      <u><a href="../man3/LIBTRACEFS.3.html">LIBTRACEFS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>