<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nbd_set_handshake_flags - control use of handshake flags</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libnbd-dev">libnbd-dev_1.22.2-1build2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nbd_set_handshake_flags - control use of handshake flags

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;libnbd.h&gt;

        int nbd_set_handshake_flags (
              struct nbd_handle *h, uint32_t flags
            );

</pre><h4><b>DESCRIPTION</b></h4><pre>
       By default, libnbd tries to negotiate all possible handshake flags that are also supported by the server,
       since omitting a handshake flag can prevent the use of other functionality such as TLS encryption or
       structured replies.  However, for integration testing, it can be useful to reduce the set of flags
       supported by the client to test that a particular server can handle various clients that were compliant
       to older versions of the NBD specification.

       The "flags" argument is a bitmask, including zero or more of the following handshake flags:

       "LIBNBD_HANDSHAKE_FLAG_FIXED_NEWSTYLE" = 1
           The  server  gracefully  handles  unknown option requests from the client, rather than disconnecting.
           Without this flag, a client cannot safely request  to  use  extensions  such  as  TLS  encryption  or
           structured replies, as the request may cause an older server to drop the connection.

       "LIBNBD_HANDSHAKE_FLAG_NO_ZEROES" = 2
           If the client is forced to use "NBD_OPT_EXPORT_NAME" instead of the preferred "NBD_OPT_GO", this flag
           allows the server to send fewer all-zero padding bytes over the connection.

       For  convenience,  the constant "LIBNBD_HANDSHAKE_FLAG_MASK" is available to describe all flags supported
       by this build of libnbd.  Future NBD extensions may add further flags, which in turn may  be  enabled  by
       default in newer libnbd.  As such, when attempting to disable only one specific bit, it is wiser to first
       call <b><a href="../man3/nbd_get_handshake_flags.3.html">nbd_get_handshake_flags</a></b>(3) and modify that value, rather than blindly setting a constant value.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       If the call is successful the function returns 0.

</pre><h4><b>ERRORS</b></h4><pre>
       On error -1 is returned.

       Refer to "ERROR HANDLING" in <b><a href="../man3/libnbd.3.html">libnbd</a></b>(3) for how to get further details of the error.

       The  following  parameters  must  not  be  NULL:  "h".  For more information see "Non-NULL parameters" in
       <b><a href="../man3/libnbd.3.html">libnbd</a></b>(3).

</pre><h4><b>HANDLE</b> <b>STATE</b></h4><pre>
       nbd_set_handshake_flags can be called when the handle is in the following state:

        ┌─────────────────────────────────────┬─────────────────────────┐
        │ Handle created, before connecting   │ ✅ allowed              │
        │ Connecting                          │ ❌ error                │
        │ Connecting &amp; handshaking (opt_mode) │ ❌ error                │
        │ Connected to the server             │ ❌ error                │
        │ Connection shut down                │ ❌ error                │
        │ Handle dead                         │ ❌ error                │
        └─────────────────────────────────────┴─────────────────────────┘

</pre><h4><b>VERSION</b></h4><pre>
       This function first appeared in libnbd 1.2.

       If you need to test if this function is available at  compile  time  check  if  the  following  macro  is
       defined:

        #define LIBNBD_HAVE_NBD_SET_HANDSHAKE_FLAGS 1

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/nbd_create.3.html">nbd_create</a></b>(3), <b><a href="../man3/nbd_get_handshake_flags.3.html">nbd_get_handshake_flags</a></b>(3), <b><a href="../man3/nbd_set_request_structured_replies.3.html">nbd_set_request_structured_replies</a></b>(3), <b><a href="../man3/libnbd.3.html">libnbd</a></b>(3).

</pre><h4><b>AUTHORS</b></h4><pre>
       Eric Blake

       Richard W.M. Jones

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright Red Hat

</pre><h4><b>LICENSE</b></h4><pre>
       This library is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser
       General  Public License as published by the Free Software Foundation; either version 2 of the License, or
       (at your option) any later version.

       This library is distributed in the hope that it will be useful, but WITHOUT ANY  WARRANTY;  without  even
       the  implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General
       Public License for more details.

       You should have received a copy of the GNU Lesser General Public License along with this library; if not,
       write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA

libnbd-1.22.2                                      2025-06-16                         <u><a href="../man3/nbd_set_handshake_flags.3.html">nbd_set_handshake_flags</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>