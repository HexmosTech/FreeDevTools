<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tracefs_instance_get_subbuf_size, tracefs_instance_set_subbuf_size - Helper functions for working with</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtracefs-doc">libtracefs-doc_1.8.1-1ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tracefs_instance_get_subbuf_size, tracefs_instance_set_subbuf_size - Helper functions for working with
       ring buffer sub buffers.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;tracefs.h&gt;</b>

       size_t <b>tracefs_instance_get_subbuf_size</b>(struct tracefs_instance *<u>instance</u>);
       int <b>tracefs_instance_set_subbuf_size</b>(struct tracefs_instance *<u>instance</u>, size_t <u>size</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Helper functions for working with the sub-buffers of the tracing ring buffer. The tracing ring buffer is
       broken up into <b>sub-buffers</b>. An event can not be bigger than the data section of the sub-buffer (see
       <b><a href="../man3/tep_get_sub_buffer_data_size.3.html">tep_get_sub_buffer_data_size</a></b>(3)). By default, the ring buffer uses the architectures <b>page_size</b> as the
       default size of the sub-buffer, but this can be limiting if there is a need for large events, for
       example, the application wants to write large strings into the trace_marker file.

       The <b>tracefs_instance_get_subbuf_size()</b> returns the current size in kilobytes fo the ring buffer
       sub-buffers.

       The <b>tracefs_instance_set_subbuf_size()</b> will write the size in kilobytes of what the new sub-buffer size
       should be. Note, that this is only a hint to what the minimum sub-buffer size should be. It also does not
       take into account the meta-data that is used by the sub-buffer, so the size written should be no less
       than 16 bytes more than the maximum event size that will be used. The kernel will likely make the
       sub-buffer size larger than specified, as it may need to align the size for implementation purposes.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       The <b>tracefs_instance_get_subbuf_size()</b> returns the size of the current sub-buffer for the given <u>instance</u>
       ring buffer or -1 on error.

       The <b>tracefs_instance_set_subbuf_size()</b> will return 0 if it successfully set the <u>instance</u> ring buffer
       sub-buffer size in kilobytes, or -1 on error.

</pre><h4><b>EXAMPLE</b></h4><pre>
           #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
           #include &lt;tracefs.h&gt;
           #include &lt;<a href="file:/usr/include/errno.h">errno.h</a>&gt;

           int main(int argc, char **argv)
           {
                   struct tep_handle *tep;
                   ssize_t save_subsize;
                   ssize_t subsize;
                   char *trace;
                   char buf[3000];
                   int meta_size;
                   int ret;
                   int i;

                   tep = tep_alloc();
                   ret = tracefs_load_headers(NULL, tep);
                   tep_free(tep);

                   if (ret &lt; 0) {
                           perror("reading headers");
                           exit(-1);
                   }

                   meta_size = tep_get_sub_buffer_size(tep) - tep_get_sub_buffer_data_size(tep);

                   save_subsize = tracefs_instance_get_subbuf_size(NULL);
                   if (save_subsize &lt; 0) {
                           printf("Changing sub-buffer size not available\n");
                           exit(-1);
                   }

                   subsize = save_subsize * 1024;

                   /* Have at least 4 writes fit on a sub-buffer */
                   if (subsize - meta_size &lt; sizeof(buf) *4 ) {
                           subsize = ((sizeof(buf) * 4 + meta_size) + 1023) / 1024;
                           tracefs_instance_set_subbuf_size(NULL, subsize);
                   }

                   for (i = 0; i &lt; sizeof(buf) - 1; i++) {
                           buf[i] = '0' + i % 10;
                   }
                   buf[i] = '\0';

                   tracefs_instance_clear(NULL);

                   for (i = 0; i &lt; 4; i++) {
                           ret = tracefs_printf(NULL, "%s\n", buf);
                           if (ret &lt; 0)
                                   perror("write");
                   }

                   trace = tracefs_instance_file_read(NULL, "trace", NULL);
                   printf("%s\n", trace);
                   free(trace);

                   printf("Buffer size was: %zd * 1024\n",
                          tracefs_instance_get_subbuf_size(NULL));

                   tracefs_instance_set_subbuf_size(NULL, save_subsize);
           }

</pre><h4><b>FILES</b></h4><pre>
           <b>tracefs.h</b>
                   Header file to include in order to have access to the library APIs.
           <b>-ltracefs</b>
                   Linker switch to add when building a program that uses the library.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/libtracefs.3.html">libtracefs</a></b>(3), <b><a href="../man3/libtraceevent.3.html">libtraceevent</a></b>(3), <b><a href="../man1/trace-cmd.1.html">trace-cmd</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
           <b>Steven</b> <b>Rostedt</b> &lt;<b><a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a></b>[1]&gt;
           <b>Tzvetomir</b> <b>Stoyanov</b> &lt;<b><a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a></b>[2]&gt;

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;<b><a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a></b>[3]&gt;

</pre><h4><b>LICENSE</b></h4><pre>
       libtracefs is Free Software licensed under the GNU LGPL 2.1

</pre><h4><b>RESOURCES</b></h4><pre>
       <b>https://git.kernel.org/pub/scm/libs/libtrace/libtracefs.git/</b>

</pre><h4><b>COPYING</b></h4><pre>
       Copyright (C) 2020 VMware, Inc. Free use of this software is granted under the terms of the GNU Public
       License (GPL).

</pre><h4><b>NOTES</b></h4><pre>
        1. <a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a>
           <a href="mailto:rostedt@goodmis.org">mailto:rostedt@goodmis.org</a>

        2. <a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a>
           <a href="mailto:tz.stoyanov@gmail.com">mailto:tz.stoyanov@gmail.com</a>

        3. <a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a>
           <a href="mailto:linux-trace-devel@vger.kernel.org">mailto:linux-trace-devel@vger.kernel.org</a>

libtracefs 1.8.1                                   06/05/2025                                      <u><a href="../man3/LIBTRACEFS.3.html">LIBTRACEFS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>