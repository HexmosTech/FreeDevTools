<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wl_shm_buffer - A SHM buffer.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libwayland-doc">libwayland-doc_1.24.0-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       wl_shm_buffer - A SHM buffer.

</pre><h4><b>SYNOPSIS</b></h4><pre>
   <b>Public</b> <b>Member</b> <b>Functions</b>
       void * <b>wl_shm_buffer_get_data</b> (struct <b>wl_shm_buffer</b> *buffer)
       struct <b>wl_shm_buffer</b> * <b>wl_shm_buffer_ref</b> (struct <b>wl_shm_buffer</b> *buffer)
       void <b>wl_shm_buffer_unref</b> (struct <b>wl_shm_buffer</b> *buffer)
       struct <b>wl_shm_pool</b> * <b>wl_shm_buffer_ref_pool</b> (struct <b>wl_shm_buffer</b> *buffer)
       void <b>wl_shm_buffer_begin_access</b> (struct <b>wl_shm_buffer</b> *buffer)
       void <b>wl_shm_buffer_end_access</b> (struct <b>wl_shm_buffer</b> *buffer)

   <b>Data</b> <b>Fields</b>
       struct <b>wl_resource</b> * <b>resource</b>
       int <b>internal_refcount</b>
       int <b>external_refcount</b>
       struct <b>wl_client</b> * <b>client</b>
       struct <b>wl_listener</b> <b>client_destroy_listener</b>
       int32_t <b>width</b>
       int32_t <b>height</b>
       int32_t <b>stride</b>
       uint32_t <b>format</b>
       int <b>offset</b>
       struct <b>wl_shm_pool</b> * <b>pool</b>

</pre><h4><b>Detailed</b> <b>Description</b></h4><pre>
       A SHM buffer.

       <b>wl_shm_buffer</b> provides a helper for accessing the contents of a wl_buffer resource created via the wl_shm
       interface.

       A <b>wl_shm_buffer</b> becomes invalid as soon as its <b>wl_resource</b> is destroyed.

</pre><h4><b>Member</b> <b>Function</b> <b>Documentation</b></h4><pre>
   <b>void</b> <b>wl_shm_buffer_begin_access</b> <b>(struct</b> <b>wl_shm_buffer</b> <b>*</b> <b>buffer)</b>
       Mark that the given SHM buffer is about to be accessed

       <b>Parameters</b>
           <u>buffer</u> The SHM buffer

       An SHM buffer is a memory-mapped file given by the client. According to POSIX, reading from a memory-
       mapped region that extends off the end of the file will cause a SIGBUS signal to be generated. Normally
       this would cause the compositor to terminate. In order to make the compositor robust against clients that
       change the size of the underlying file or lie about its size, you should protect access to the buffer by
       calling this function before reading from the memory and call <b>wl_shm_buffer_end_access()</b> afterwards. This
       will install a signal handler for SIGBUS which will prevent the compositor from crashing.

       After calling this function the signal handler will remain installed for the lifetime of the compositor
       process. Note that this function will not work properly if the compositor is also installing its own
       handler for SIGBUS.

       If a SIGBUS signal is received for an address within the range of the SHM pool of the given buffer then
       the client will be sent an error event when <b>wl_shm_buffer_end_access()</b> is called. If the signal is for an
       address outside that range then the signal handler will reraise the signal which would will likely cause
       the compositor to terminate.

       It is safe to nest calls to these functions as long as the nested calls are all accessing the same pool.
       The number of calls to <b>wl_shm_buffer_end_access()</b> must match the number of calls to
       <b>wl_shm_buffer_begin_access()</b>. These functions are thread-safe and it is allowed to simultaneously access
       different buffers or the same buffer from multiple threads.

   <b>void</b> <b>wl_shm_buffer_end_access</b> <b>(struct</b> <b>wl_shm_buffer</b> <b>*</b> <b>buffer)</b>
       Ends the access to a buffer started by <b>wl_shm_buffer_begin_access()</b>

       <b>Parameters</b>
           <u>buffer</u> The SHM buffer

       This should be called after <b>wl_shm_buffer_begin_access()</b> once the buffer is no longer being accessed. If
       a SIGBUS signal was generated in-between these two calls then the resource for the given buffer will be
       sent an error.

   <b>void</b> <b>*</b> <b>wl_shm_buffer_get_data</b> <b>(struct</b> <b>wl_shm_buffer</b> <b>*</b> <b>buffer)</b>
       Get a pointer to the memory for the SHM buffer

       <b>Parameters</b>
           <u>buffer</u> The buffer object

       Returns a pointer which can be used to read the data contained in the given SHM buffer.

       As this buffer is memory-mapped, reading from it may generate SIGBUS signals. This can happen if the
       client claims that the buffer is larger than it is or if something truncates the underlying file. To
       prevent this signal from causing the compositor to crash you should call <b>wl_shm_buffer_begin_access()</b> and
       <b>wl_shm_buffer_end_access()</b> around code that reads from the memory.

   <b>struct</b> <b>wl_shm_buffer</b> <b>*</b> <b>wl_shm_buffer_ref</b> <b>(struct</b> <b>wl_shm_buffer</b> <b>*</b> <b>buffer)</b>
       Reference a shm_buffer

       <b>Parameters</b>
           <u>buffer</u> The buffer object

       Returns a pointer to the buffer and increases the refcount.

       The compositor must remember to call <b>wl_shm_buffer_unref()</b> when it no longer needs the reference to
       ensure proper destruction of the buffer.

       <b>See</b> <b>also</b>
           <b>wl_shm_buffer_unref</b>

   <b>struct</b> <b>wl_shm_pool</b> <b>*</b> <b>wl_shm_buffer_ref_pool</b> <b>(struct</b> <b>wl_shm_buffer</b> <b>*</b> <b>buffer)</b>
       Get a reference to a shm_buffer's <b>shm_pool</b>

       <b>Parameters</b>
           <u>buffer</u> The buffer object

       Returns a pointer to a buffer's <b>shm_pool</b> and increases the <b>shm_pool</b> refcount.

       The compositor must remember to call <b>wl_shm_pool_unref()</b> when it no longer needs the reference to ensure
       proper destruction of the pool.

       <b>See</b> <b>also</b>
           <b>wl_shm_pool_unref</b>

   <b>void</b> <b>wl_shm_buffer_unref</b> <b>(struct</b> <b>wl_shm_buffer</b> <b>*</b> <b>buffer)</b>
       Unreference a shm_buffer

       <b>Parameters</b>
           <u>buffer</u> The buffer object

       Drops a reference to a buffer object.

       This is only necessary if the compositor has explicitly taken a reference with <b>wl_shm_buffer_ref()</b>,
       otherwise the buffer will be automatically destroyed when appropriate.

       <b>See</b> <b>also</b>
           <b>wl_shm_buffer_ref</b>

</pre><h4><b>Field</b> <b>Documentation</b></h4><pre>
   <b>struct</b> <b>wl_client*</b> <b>wl_shm_buffer::client</b>
   <b>struct</b> <b>wl_listener</b> <b>wl_shm_buffer::client_destroy_listener</b>
   <b>int</b> <b>wl_shm_buffer::external_refcount</b>
   <b>uint32_t</b> <b>wl_shm_buffer::format</b>
   <b>int32_t</b> <b>wl_shm_buffer::height</b>
   <b>int</b> <b>wl_shm_buffer::internal_refcount</b>
   <b>int</b> <b>wl_shm_buffer::offset</b>
   <b>struct</b> <b>wl_shm_pool*</b> <b>wl_shm_buffer::pool</b>
   <b>struct</b> <b>wl_resource*</b> <b>wl_shm_buffer::resource</b>
   <b>int32_t</b> <b>wl_shm_buffer::stride</b>
   <b>int32_t</b> <b>wl_shm_buffer::width</b>
</pre><h4><b>Author</b></h4><pre>
       Generated automatically by Doxygen for Wayland from the source code.

Version 1.24.0                              Mon Jul 28 2025 16:07:33                            <u><a href="../man3/wl_shm_buffer.3.html">wl_shm_buffer</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>