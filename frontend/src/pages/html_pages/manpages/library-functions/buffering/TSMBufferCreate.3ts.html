<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSMBufferCreate - traffic Server marshall buffer API</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/trafficserver-dev">trafficserver-dev_9.2.5+ds-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       TSMBufferCreate - traffic Server marshall buffer API

</pre><h4><b>SYNOPSIS</b></h4><pre>
          #include &lt;ts/ts.h&gt;

       <u>TSMBuffer</u> <b>TSMBufferCreate(void)</b>

       <u>TSReturnCode</u> <b>TSMBufferDestroy(</b><u>TSMBuffer</u> <b>bufp)</b>

       <u>TSReturnCode</u> <b>TSHandleMLocRelease(</b><u>TSMBuffer</u> <b>bufp,</b> <u>TSMLoc</u> <b>parent,</b> <u>TSMLoc</u> <b>mloc)</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  marshal  buffer or <u>TSMBuffer</u> is a heap data structure that stores parsed URLs, MIME headers and HTTP
       headers. You can allocate new objects out of marshal buffers, and change the values  within  the  marshal
       buffer.  Whenever you manipulate an object, you require the handle to the object (<u>TSMLoc</u>) and the marshal
       buffer containing the object (<u>TSMBuffer</u>).

       Any  marshal  buffer fetched by transaction getters will be used by other parts of the system. Be careful
       not to destroy these shared, transaction marshal buffers.

       <u>TSMBufferCreate()</u> creates a new marshal buffer and initializes the  reference  count.  <u>TSMBufferDestroy()</u>
       Ignores  the  reference  count  and destroys the marshal buffer bufp. The internal data buffer associated
       with the marshal buffer is also destroyed if the marshal buffer allocated it.

       <u>TSHandleMLocRelease()</u> Releases the <u>TSMLoc</u> mloc created from the <u>TSMLoc</u> parent. If a  <u>TSMLoc</u>  is  obtained
       from a transaction, it does not have a parent <u>TSMLoc</u>. Use the the constant <u>TS_NULL_MLOC</u> as its parent.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <u>TSMBufferDestroy()</u>  and  <u>TSHandleMLocRelease()</u>  return  <u>TS_SUCCESS</u>  on  success,  or <u>TS_ERROR</u> on failure.
       <u>TSMBufferCreate()</u> returns the new <u>TSMBuffer</u>.

</pre><h4><b>EXAMPLES</b></h4><pre>
          #include &lt;ts/ts.h&gt;

          static void
          copyResponseMimeHdr (TSCont pCont, TSHttpTxn pTxn)
          {
              TSMBuffer respHdrBuf, tmpBuf;
              TSMLoc respHttpHdrLoc, tmpMimeHdrLoc;

              if (!TSHttpTxnClientRespGet(pTxn, &amp;respHdrBuf, &amp;respHttpHdrLoc)) {
                  TSError("couldn't retrieve client response header0);
                  TSHandleMLocRelease(respHdrBuf, TS_NULL_MLOC, respHttpHdrLoc);
                  goto done;
              }

              tmpBuf = TSMBufferCreate();
              tmpMimeHdrLoc = TSMimeHdrCreate(tmpBuf);
              TSMimeHdrCopy(tmpBuf, tmpMimeHdrLoc, respHdrBuf, respHttpHdrLoc);
              TSHandleMLocRelease(tmpBuf, TS_NULL_MLOC, tmpMimeHdrLoc);
              TSHandleMLocRelease(respHdrBuf, TS_NULL_MLOC, respHttpHdrLoc);
              TSMBufferDestroy(tmpBuf);

          done:
              TSHttpTxnReenable(pTxn, TS_EVENT_HTTP_CONTINUE);
          }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3ts/TSAPI.3ts.html">TSAPI</a>(3ts)</b>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2025, <a href="mailto:dev@trafficserver.apache.org">dev@trafficserver.apache.org</a>

9.2                                               May 22, 2025                              <u><a href="../man3ts/TSMBUFFERCREATE.3ts.html">TSMBUFFERCREATE</a></u>(3ts)
</pre>
 </div>
</div></section>
</div>
</body>
</html>