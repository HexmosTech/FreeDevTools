<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>opus_encoder - Opus Encoder</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libopus-doc">libopus-doc_1.5.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       opus_encoder - Opus Encoder

        - This page describes the process and functions used to encode Opus.

</pre><h4><b>SYNOPSIS</b></h4><pre>
   <b>Typedefs</b>
       typedef struct <b>OpusEncoder</b> <b>OpusEncoder</b>
           Opus encoder state.

   <b>Functions</b>
       int <b>opus_encoder_get_size</b> (int channels)
           Gets the size of an OpusEncoder structure.
       <b>OpusEncoder</b> * <b>opus_encoder_create</b> (<b>opus_int32</b> Fs, int channels, int application, int *error)
           Allocates and initializes an encoder state.
       int <b>opus_encoder_init</b> (<b>OpusEncoder</b> *st, <b>opus_int32</b> Fs, int channels, int application)
           Initializes a previously allocated encoder state The memory pointed to by st must be at least the
           size returned by <b>opus_encoder_get_size()</b>.
       <b>opus_int32</b> <b>opus_encode</b> (<b>OpusEncoder</b> *st, const <b>opus_int16</b> *pcm, int frame_size, unsigned char *data,
           <b>opus_int32</b> max_data_bytes)
           Encodes an Opus frame.
       <b>opus_int32</b> <b>opus_encode_float</b> (<b>OpusEncoder</b> *st, const float *pcm, int frame_size, unsigned char *data,
           <b>opus_int32</b> max_data_bytes)
           Encodes an Opus frame from floating point input.
       void <b>opus_encoder_destroy</b> (<b>OpusEncoder</b> *st)
           Frees an OpusEncoder allocated by <b>opus_encoder_create()</b>.
       int <b>opus_encoder_ctl</b> (<b>OpusEncoder</b> *st, int request,...)
           Perform a CTL function on an Opus encoder.

</pre><h4><b>Detailed</b> <b>Description</b></h4><pre>
       This page describes the process and functions used to encode Opus.

       Since Opus is a stateful codec, the encoding process starts with creating an encoder state. This can be
       done with:

       int          error;
       OpusEncoder *enc;
       enc = opus_encoder_create(Fs, channels, application, &amp;error);

       From this point, enc can be used for encoding an audio stream. An encoder state <b>must</b> <b>not</b> be used for more
       than one stream at the same time. Similarly, the encoder state <b>must</b> <b>not</b> be re-initialized for each frame.

       While <b>opus_encoder_create()</b> allocates memory for the state, it's also possible to initialize pre-
       allocated memory:

       int          size;
       int          error;
       OpusEncoder *enc;
       size = opus_encoder_get_size(channels);
       enc = malloc(size);
       error = opus_encoder_init(enc, Fs, channels, application);

       where <b>opus_encoder_get_size()</b> returns the required size for the encoder state. Note that future versions
       of this code may change the size, so no assumptions should be made about it.

       The encoder state is always continuous in memory and only a shallow copy is sufficient to copy it (e.g.
       memcpy())

       It is possible to change some of the encoder's settings using the <b>opus_encoder_ctl()</b> interface. All these
       settings already default to the recommended value, so they should only be changed when necessary. The
       most common settings one may want to change are:

       opus_encoder_ctl(enc, OPUS_SET_BITRATE(bitrate));
       opus_encoder_ctl(enc, OPUS_SET_COMPLEXITY(complexity));
       opus_encoder_ctl(enc, OPUS_SET_SIGNAL(signal_type));

       where

       •
        bitrate is in bits per second (b/s)
       •
        complexity is a value from 1 to 10, where 1 is the lowest complexity and 10 is the highest
       •
        signal_type is either OPUS_AUTO (default), OPUS_SIGNAL_VOICE, or OPUS_SIGNAL_MUSIC
       See  <b>Encoder</b>  <b>related</b> <b>CTLs</b> and <b>Generic</b> <b>CTLs</b> for a complete list of parameters that can be set or queried.
       Most parameters can be set or changed at any time during a stream.
       To encode a frame, <b>opus_encode()</b> or <b>opus_encode_float()</b> must be called with exactly one  frame  (2.5,  5,
       10, 20, 40 or 60 ms) of audio data:
       len = opus_encode(enc, audio_frame, frame_size, packet, max_packet);

       where
       • audio_frame is the audio data in opus_int16 (or float for <b>opus_encode_float()</b>)
       • frame_size is the duration of the frame in samples (per channel)
       • packet is the byte array to which the compressed data is written
       • max_packet  is  the  maximum  number  of  bytes  that  can  be  written  in  the  packet (4000 bytes is
         recommended). Do not use max_packet to control VBR target bitrate,  instead  use  the  <b>OPUS_SET_BITRATE</b>
         CTL.
       <b>opus_encode()</b>  and  <b>opus_encode_float()</b>  return  the  number of bytes actually written to the packet. The
       return value <b>can</b> <b>be</b> <b>negative</b>, which indicates that an error has occurred. If the return value is 2  bytes
       or less, then the packet does not need to be transmitted (DTX).
       Once the encoder state if no longer needed, it can be destroyed with
       opus_encoder_destroy(enc);
       If  the encoder was created with <b>opus_encoder_init()</b> rather than <b>opus_encoder_create()</b>, then no action is
       required aside from potentially freeing the memory that was manually allocated for it (calling  free(enc)
       for the example above)
</pre><h4><b>Typedef</b> <b>Documentation</b></h4><pre>
   <b>typedef</b> <b>struct</b> <b>OpusEncoder</b> <b>OpusEncoder</b>
       Opus  encoder  state. This contains the complete state of an Opus encoder. It is position independent and
       can be freely copied.
       <b>See</b> <b>also</b>
           <b>opus_encoder_create</b>,<b>opus_encoder_init</b>
</pre><h4><b>Function</b> <b>Documentation</b></h4><pre>
   <b>opus_int32</b> <b>opus_encode</b> <b>(OpusEncoder</b> <b>*</b> <b>st,</b> <b>const</b> <b>opus_int16</b> <b>*</b> <b>pcm,</b>  <b>int</b>  <b>frame_size,</b>  <b>unsigned</b>  <b>char</b>  <b>*</b>  <b>data,</b>
       <b>opus_int32</b> <b>max_data_bytes)</b>
       Encodes an Opus frame.
       <b>Parameters</b>
           <u>st</u> OpusEncoder*: Encoder state
           <u>pcm</u>     opus_int16*:     Input     signal     (interleaved     if     2    channels).    length    is
           frame_size*channels*sizeof(opus_int16)
           <u>frame_size</u> int: Number of samples per channel in the input signal. This must be an  Opus  frame  size
           for  the encoder's sampling rate. For example, at 48 kHz the permitted values are 120, 240, 480, 960,
           1920, and 2880. Passing in a duration of less than 10 ms (480 samples at 48  kHz)  will  prevent  the
           encoder from using the LPC or hybrid modes.
           <u>data</u> unsigned char*: Output payload. This must contain storage for at least <u>max_data_bytes</u>.
           <u>max_data_bytes</u>  opus_int32:  Size of the allocated memory for the output payload. This may be used to
           impose an upper limit on the instant bitrate, but should not be used as the only bitrate control. Use
           <b>OPUS_SET_BITRATE</b> to control the bitrate.
       <b>Returns</b>
           The length of the encoded packet (in bytes) on success or a negative error code (see <b>Error</b> <b>codes</b>)  on
           failure.
   <b>opus_int32</b>  <b>opus_encode_float</b>  <b>(OpusEncoder</b>  <b>*</b>  <b>st,</b>  <b>const</b> <b>float</b> <b>*</b> <b>pcm,</b> <b>int</b> <b>frame_size,</b> <b>unsigned</b> <b>char</b> <b>*</b> <b>data,</b>
       <b>opus_int32</b> <b>max_data_bytes)</b>
       Encodes an Opus frame from floating point input.
       <b>Parameters</b>
           <u>st</u> OpusEncoder*: Encoder state
           <u>pcm</u> float*: Input in float format (interleaved if 2 channels), with a normal range of +/-1.0. Samples
           with a range beyond +/-1.0 are supported but will be clipped by decoders using the  integer  API  and
           should  only  be  used  if  it  is  known that the far end supports extended dynamic range. length is
           frame_size*channels*sizeof(float)
           <u>frame_size</u> int: Number of samples per channel in the input signal. This must be an  Opus  frame  size
           for  the encoder's sampling rate. For example, at 48 kHz the permitted values are 120, 240, 480, 960,
           1920, and 2880. Passing in a duration of less than 10 ms (480 samples at 48  kHz)  will  prevent  the
           encoder from using the LPC or hybrid modes.
           <u>data</u> unsigned char*: Output payload. This must contain storage for at least <u>max_data_bytes</u>.
           <u>max_data_bytes</u>  opus_int32:  Size of the allocated memory for the output payload. This may be used to
           impose an upper limit on the instant bitrate, but should not be used as the only bitrate control. Use
           <b>OPUS_SET_BITRATE</b> to control the bitrate.
       <b>Returns</b>
           The length of the encoded packet (in bytes) on success or a negative error code (see <b>Error</b> <b>codes</b>)  on
           failure.
   <b>OpusEncoder</b> <b>*</b> <b>opus_encoder_create</b> <b>(opus_int32</b> <b>Fs,</b> <b>int</b> <b>channels,</b> <b>int</b> <b>application,</b> <b>int</b> <b>*</b> <b>error)</b>
       Allocates and initializes an encoder state. There are three coding modes:
       <b>OPUS_APPLICATION_VOIP</b>  gives  best  quality  at  a given bitrate for voice signals. It enhances the input
       signal by high-pass filtering and emphasizing formants and  harmonics.  Optionally  it  includes  in-band
       forward  error  correction  to  protect against packet loss. Use this mode for typical VoIP applications.
       Because of the enhancement, even at high bitrates the output may sound different from the input.
       <b>OPUS_APPLICATION_AUDIO</b> gives best quality at a given bitrate for most non-voice signals like  music.  Use
       this  mode  for music and mixed (music/voice) content, broadcast, and applications requiring less than 15
       ms of coding delay.
       <b>OPUS_APPLICATION_RESTRICTED_LOWDELAY</b> configures low-delay mode that disables the speech-optimized mode in
       exchange for slightly reduced delay. This mode can only be set on an newly initialized or  freshly  reset
       encoder because it changes the codec delay.
       This  is  useful  when  the  caller  knows  that  the speech-optimized modes will not be needed (use with
       caution).
       <b>Parameters</b>
           <u>Fs</u> opus_int32: Sampling rate of input signal (Hz) This must be one of 8000, 12000, 16000,  24000,  or
           48000.
           <u>channels</u> int: Number of channels (1 or 2) in input signal
           <u>application</u>   int:   Coding   mode   (one   of   <b>OPUS_APPLICATION_VOIP</b>,   <b>OPUS_APPLICATION_AUDIO</b>,  or
           <b>OPUS_APPLICATION_RESTRICTED_LOWDELAY</b>)
           <u>error</u> int*: <b>Error</b> <b>codes</b>
       <b>Note</b>
           Regardless of the sampling rate and number channels selected, the Opus encoder can switch to a  lower
           audio  bandwidth or number of channels if the bitrate selected is too low. This also means that it is
           safe to always use 48 kHz stereo input and let the encoder optimize the encoding.
   <b>int</b> <b>opus_encoder_ctl</b> <b>(OpusEncoder</b> <b>*</b> <b>st,</b> <b>int</b> <b>request,</b>  <b>...)</b>
       Perform a CTL function on an Opus encoder. Generally the request and subsequent arguments  are  generated
       by a convenience macro.
       <b>Parameters</b>
           <u>st</u> OpusEncoder*: Encoder state.
           <u>request</u>  This  and  all  remaining  parameters should be replaced by one of the convenience macros in
           <b>Generic</b> <b>CTLs</b> or <b>Encoder</b> <b>related</b> <b>CTLs</b>.
       <b>See</b> <b>also</b>
           <b>Generic</b> <b>CTLs</b>
           <b>Encoder</b> <b>related</b> <b>CTLs</b>
   <b>void</b> <b>opus_encoder_destroy</b> <b>(OpusEncoder</b> <b>*</b> <b>st)</b>
       Frees an OpusEncoder allocated by <b>opus_encoder_create()</b>.
       <b>Parameters</b>
           <u>st</u> OpusEncoder*: State to be freed.
   <b>int</b> <b>opus_encoder_get_size</b> <b>(int</b> <b>channels)</b>
       Gets the size of an OpusEncoder structure.
       <b>Parameters</b>
           <u>channels</u> int: Number of channels. This must be 1 or 2.
       <b>Returns</b>
           The size in bytes.
   <b>int</b> <b>opus_encoder_init</b> <b>(OpusEncoder</b> <b>*</b> <b>st,</b> <b>opus_int32</b> <b>Fs,</b> <b>int</b> <b>channels,</b> <b>int</b> <b>application)</b>
       Initializes a previously allocated encoder state The memory pointed to by st must be at  least  the  size
       returned  by  <b>opus_encoder_get_size()</b>.  This  is  intended for applications which use their own allocator
       instead of malloc.
       <b>See</b> <b>also</b>
           <b>opus_encoder_create()</b>,<b>opus_encoder_get_size()</b> To  reset  a  previously  initialized  state,  use  the
           <b>OPUS_RESET_STATE</b> CTL.
       <b>Parameters</b>
           <u>st</u> OpusEncoder*: Encoder state
           <u>Fs</u>  opus_int32:  Sampling rate of input signal (Hz) This must be one of 8000, 12000, 16000, 24000, or
           48000.
           <u>channels</u> int: Number of channels (1 or 2) in input signal
           <u>application</u>  int:   Coding   mode   (one   of   OPUS_APPLICATION_VOIP,   OPUS_APPLICATION_AUDIO,   or
           OPUS_APPLICATION_RESTRICTED_LOWDELAY)
       <b>Return</b> <b>values</b>
           <b>OPUS_OK</b> <b>Success</b> <b>or</b> <b>Error</b> <b>codes</b>
</pre><h4><b>Author</b></h4><pre>
       Generated automatically by Doxygen for Opus from the source code.

Version 1.5.2                                Wed Jul 3 2024 11:41:33                             <u><a href="../man3/opus_encoder.3.html">opus_encoder</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>