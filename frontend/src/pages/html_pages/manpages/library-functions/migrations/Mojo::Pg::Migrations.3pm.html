<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mojo::Pg::Migrations - Migrations</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmojo-pg-perl">libmojo-pg-perl_4.27-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Mojo::Pg::Migrations - Migrations

</pre><h4><b>SYNOPSIS</b></h4><pre>
         use Mojo::Pg::Migrations;

         my $migrations = Mojo::Pg::Migrations-&gt;new(pg =&gt; $pg);
         $migrations-&gt;from_file('/home/sri/migrations.sql')-&gt;migrate;

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Mojo::Pg::Migrations is used by Mojo::Pg to allow database schemas to evolve easily over time. A
       migration file is just a collection of sql blocks, with one or more statements, separated by comments of
       the form "-- VERSION UP/DOWN".

         -- 1 up
         CREATE TABLE messages (message TEXT);
         INSERT INTO messages VALUES ('I ♥ Mojolicious!');
         -- 1 down
         DROP TABLE messages;

         -- 2 up (...you can comment freely here...)
         CREATE TABLE stuff (whatever INT);
         -- 2 down
         DROP TABLE stuff;

       The idea is to let you migrate from any version, to any version, up and down. Migrations are very safe,
       because they are performed in transactions and only one can be performed at a time. If a single statement
       fails, the whole migration will fail and get rolled back. Every set of migrations has a "name", which is
       stored together with the currently active version in an automatically created table named
       "mojo_migrations".

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       Mojo::Pg::Migrations implements the following attributes.

   <b>name</b>
         my $name    = $migrations-&gt;name;
         $migrations = $migrations-&gt;name('foo');

       Name for this set of migrations, defaults to "migrations".

   <b>pg</b>
         my $pg      = $migrations-&gt;pg;
         $migrations = $migrations-&gt;pg(Mojo::Pg-&gt;new);

       Mojo::Pg object these migrations belong to. Note that this attribute is weakened.

</pre><h4><b>METHODS</b></h4><pre>
       Mojo::Pg::Migrations inherits all methods from Mojo::Base and implements the following new ones.

   <b>active</b>
         my $version = $migrations-&gt;active;

       Currently active version.

   <b>from_data</b>
         $migrations = $migrations-&gt;from_data;
         $migrations = $migrations-&gt;from_data('main');
         $migrations = $migrations-&gt;from_data('main', 'file_name');

       Extract migrations from a file in the DATA section of a class with "data_section" in Mojo::Loader,
       defaults to using the caller class and "name".

         __DATA__
         @@ migrations
         -- 1 up
         CREATE TABLE messages (message TEXT);
         INSERT INTO messages VALUES ('I ♥ Mojolicious!');
         -- 1 down
         DROP TABLE messages;

   <b>from_dir</b>
         $migrations = $migrations-&gt;from_dir('/home/sri/migrations');

       Extract migrations from a directory tree where each versioned migration is in a directory, named for the
       version, and each migration has one or both of the files named "up.sql" or "down.sql".

         migrations/1/up.sql
         migrations/1/down.sql
         migrations/2/up.sql
         migrations/3/up.sql
         migrations/3/down.sql

   <b>from_file</b>
         $migrations = $migrations-&gt;from_file('/home/sri/migrations.sql');

       Extract migrations from a file.

   <b>from_string</b>
         $migrations = $migrations-&gt;from_string(
           '-- 1 up
            CREATE TABLE foo (bar INT);
            -- 1 down
            DROP TABLE foo;'
         );

       Extract migrations from string.

   <b>latest</b>
         my $version = $migrations-&gt;latest;

       Latest version available.

   <b>migrate</b>
         $migrations = $migrations-&gt;migrate;
         $migrations = $migrations-&gt;<a href="../man3/migrate.3.html">migrate</a>(3);

       Migrate from "active" to a different version, up or down, defaults to using "latest". All version numbers
       need to be positive, with version 0 representing an empty database.

         # Reset database
         $migrations-&gt;<a href="../man0/migrate.0.html">migrate</a>(0)-&gt;migrate;

   <b>sql_for</b>
         my $sql = $migrations-&gt;sql_for(5, 10);

       Get SQL to migrate from one version to another, up or down.

</pre><h4><b>DEBUGGING</b></h4><pre>
       You can set the "MOJO_MIGRATIONS_DEBUG" environment variable to get some advanced diagnostics information
       printed to "STDERR".

         MOJO_MIGRATIONS_DEBUG=1

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Mojo::Pg, Mojolicious::Guides, &lt;https://mojolicious.org&gt;.

perl v5.34.0                                       2022-03-19                          <u>Mojo::Pg::<a href="../man3pm/Migrations.3pm.html">Migrations</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>