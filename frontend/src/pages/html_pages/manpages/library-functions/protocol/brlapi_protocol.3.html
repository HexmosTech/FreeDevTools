<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>brlapi_protocol - BrlAPI's protocol</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libbrlapi-dev">libbrlapi-dev_6.7-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       brlapi_protocol - BrlAPI's protocol

        - Instructions and constants for <u>BrlAPI</u> 's protocol.

</pre><h4><b>SYNOPSIS</b></h4><pre>
   <b>Data</b> <b>Structures</b>
       struct <b>brlapi_header_t</b>
       struct <b>brlapi_versionPacket_t</b>
       struct <b>brlapi_authClientPacket_t</b>
       struct <b>brlapi_authServerPacket_t</b>
       struct <b>brlapi_errorPacket_t</b>
       struct <b>brlapi_getDriverSpecificModePacket_t</b>
       struct <b>brlapi_writeArgumentsPacket_t</b>
       struct <b>brlapi_paramValuePacket_t</b>
       struct <b>brlapi_paramRequestPacket_t</b>
       union <b>brlapi_packet_t</b>

   <b>Macros</b>
       #define <b>BRLAPI_PROTOCOL_VERSION</b>   ((uint32_t) 8) /** Communication protocol version */
       #define <b>BRLAPI_MAXPACKETSIZE</b>   4096
       #define <b>BRLAPI_PACKET_VERSION</b>   'v'
       #define <b>BRLAPI_PACKET_AUTH</b>   'a'
       #define <b>BRLAPI_PACKET_GETDRIVERNAME</b>   'n'
       #define <b>BRLAPI_PACKET_GETMODELID</b>   'd'
       #define <b>BRLAPI_PACKET_GETDISPLAYSIZE</b>   's'
       #define <b>BRLAPI_PACKET_ENTERTTYMODE</b>   't'
       #define <b>BRLAPI_PACKET_SETFOCUS</b>   'F'
       #define <b>BRLAPI_PACKET_LEAVETTYMODE</b>   'L'
       #define <b>BRLAPI_PACKET_KEY</b>   'k'
       #define <b>BRLAPI_PACKET_IGNOREKEYRANGES</b>   'm'
       #define <b>BRLAPI_PACKET_ACCEPTKEYRANGES</b>   'u'
       #define <b>BRLAPI_PACKET_WRITE</b>   'w'
       #define <b>BRLAPI_PACKET_ENTERRAWMODE</b>   '*'
       #define <b>BRLAPI_PACKET_LEAVERAWMODE</b>   '#'
       #define <b>BRLAPI_PACKET_PACKET</b>   'p'
       #define <b>BRLAPI_PACKET_ACK</b>   'A'
       #define <b>BRLAPI_PACKET_ERROR</b>   'e'
       #define <b>BRLAPI_PACKET_EXCEPTION</b>   'E'
       #define <b>BRLAPI_PACKET_SUSPENDDRIVER</b>   'S'
       #define <b>BRLAPI_PACKET_RESUMEDRIVER</b>   'R'
       #define <b>BRLAPI_PACKET_SYNCHRONIZE</b>   'Z'
       #define <b>BRLAPI_PACKET_PARAM_VALUE</b>   (('P'&lt;&lt;8) + 'V')
       #define <b>BRLAPI_PACKET_PARAM_REQUEST</b>   (('P'&lt;&lt;8) + 'R')
       #define <b>BRLAPI_PACKET_PARAM_UPDATE</b>   (('P'&lt;&lt;8) + 'U')
       #define <b>BRLAPI_DEVICE_MAGIC</b>   (0xdeadbeefL)
       #define <b>BRLAPI_HEADERSIZE</b>   sizeof(<b>brlapi_header_t</b>)
       #define <b>BRLAPI_AUTH_NONE</b>   'N'
       #define <b>BRLAPI_AUTH_KEY</b>   'K'
       #define <b>BRLAPI_AUTH_CRED</b>   'C'
       #define <b>BRLAPI_WF_DISPLAYNUMBER</b>   0X01
       #define <b>BRLAPI_WF_REGION</b>   0X02
       #define <b>BRLAPI_WF_TEXT</b>   0X04
       #define <b>BRLAPI_WF_ATTR_AND</b>   0X08
       #define <b>BRLAPI_WF_ATTR_OR</b>   0X10
       #define <b>BRLAPI_WF_CURSOR</b>   0X20
       #define <b>BRLAPI_WF_CHARSET</b>   0X40
       #define <b>BRLAPI_PVF_GLOBAL</b>   0X01    /** Value is the global value */
       #define <b>BRLAPI_MAXPARAMSIZE</b>   (<b>BRLAPI_MAXPACKETSIZE</b> - (sizeof(uint32_t) + sizeof(<b>brlapi_param_t</b>) +
           2*sizeof(uint32_t)))
       #define <b>BRLAPI_PARAMF_GET</b>   0X100    /** Get current parameter value    */
       #define <b>BRLAPI_PARAMF_SUBSCRIBE</b>   0X200    /** Subscribe to parameter updates */
       #define <b>BRLAPI_PARAMF_UNSUBSCRIBE</b>   0X400    /** Unsubscribe from parameter updates */

   <b>Functions</b>
       ssize_t <b>brlapi_writePacket</b> (<b>brlapi_fileDescriptor</b> fd, <b>brlapi_packetType_t</b> type, const void *buf, size_t
           size)
       ssize_t <b>brlapi_readPacketHeader</b> (<b>brlapi_fileDescriptor</b> fd, <b>brlapi_packetType_t</b> *packetType)
       ssize_t <b>brlapi_readPacketContent</b> (<b>brlapi_fileDescriptor</b> fd, size_t packetSize, void *buf, size_t bufSize)
       ssize_t <b>brlapi_readPacket</b> (<b>brlapi_fileDescriptor</b> fd, <b>brlapi_packetType_t</b> *type, void *buf, size_t size)

   <b>Variables</b>
       pthread_mutex_t <b>brlapi_fd_mutex</b>

</pre><h4><b>Detailed</b> <b>Description</b></h4><pre>
       These are defines for the protocol between <u>BrlAPI</u> 's server and clients. Understanding is not needed to
       use the <u>BrlAPI</u> library, so reading this is not needed unless really wanting to connect to <u>BrlAPI</u> without
       <u>BrlAPI</u> 's library.

</pre><h4><b>Macro</b> <b>Definition</b> <b>Documentation</b></h4><pre>
   <b>#define</b> <b>BRLAPI_AUTH_CRED</b>   <b>'C'</b>
       Explicit socket credentials authorization

   <b>#define</b> <b>BRLAPI_AUTH_KEY</b>   <b>'K'</b>
       Key authorization

   <b>#define</b> <b>BRLAPI_AUTH_NONE</b>   <b>'N'</b>
       No or implicit authorization

   <b>#define</b> <b>BRLAPI_DEVICE_MAGIC</b>   <b>(0xdeadbeefL)</b>
       Magic number to give when sending a BRLPACKET_ENTERRAWMODE or BRLPACKET_SUSPEND packet

   <b>#define</b> <b>BRLAPI_HEADERSIZE</b>   <b>sizeof(brlapi_header_t)</b>
       Size of packet headers

   <b>#define</b> <b>BRLAPI_MAXPACKETSIZE</b>   <b>4096</b>
       Maximum packet size for packets exchanged on sockets and with braille terminal

   <b>#define</b> <b>BRLAPI_MAXPARAMSIZE</b>   <b>(BRLAPI_MAXPACKETSIZE</b> <b>-</b> <b>(sizeof(uint32_t)</b> <b>+</b> <b>sizeof(brlapi_param_t)</b> <b>+</b>
       <b>2*sizeof(uint32_t)))</b>
   <b>#define</b> <b>BRLAPI_PACKET_ACCEPTKEYRANGES</b>   <b>'u'</b>
       Unmask key ranges

   <b>#define</b> <b>BRLAPI_PACKET_ACK</b>   <b>'A'</b>
       Acknowledgement

   <b>#define</b> <b>BRLAPI_PACKET_AUTH</b>   <b>'a'</b>
       Authorization

   <b>#define</b> <b>BRLAPI_PACKET_ENTERRAWMODE</b>   <b>'*'</b>
       Enter in raw mode

   <b>#define</b> <b>BRLAPI_PACKET_ENTERTTYMODE</b>   <b>'t'</b>
       Asks for a specified tty

   <b>#define</b> <b>BRLAPI_PACKET_ERROR</b>   <b>'e'</b>
       non-fatal error

   <b>#define</b> <b>BRLAPI_PACKET_EXCEPTION</b>   <b>'E'</b>
       Exception

   <b>#define</b> <b>BRLAPI_PACKET_GETDISPLAYSIZE</b>   <b>'s'</b>
       Dimensions of brl display

   <b>#define</b> <b>BRLAPI_PACKET_GETDRIVERNAME</b>   <b>'n'</b>
       Ask which driver is used

   <b>#define</b> <b>BRLAPI_PACKET_GETMODELID</b>   <b>'d'</b>
       Ask which model is used

   <b>#define</b> <b>BRLAPI_PACKET_IGNOREKEYRANGES</b>   <b>'m'</b>
       Mask key ranges

   <b>#define</b> <b>BRLAPI_PACKET_KEY</b>   <b>'k'</b>
       Braille key

   <b>#define</b> <b>BRLAPI_PACKET_LEAVERAWMODE</b>   <b>'#'</b>
       Leave raw mode

   <b>#define</b> <b>BRLAPI_PACKET_LEAVETTYMODE</b>   <b>'L'</b>
       Release the tty

   <b>#define</b> <b>BRLAPI_PACKET_PACKET</b>   <b>'p'</b>
       Raw packets

   <b>#define</b> <b>BRLAPI_PACKET_PARAM_REQUEST</b>   <b>(('P'&lt;&lt;8)</b> <b>+</b> <b>'R')</b>
       Parameter request

   <b>#define</b> <b>BRLAPI_PACKET_PARAM_UPDATE</b>   <b>(('P'&lt;&lt;8)</b> <b>+</b> <b>'U')</b>
       Parameter update

   <b>#define</b> <b>BRLAPI_PACKET_PARAM_VALUE</b>   <b>(('P'&lt;&lt;8)</b> <b>+</b> <b>'V')</b>
       Parameter value

   <b>#define</b> <b>BRLAPI_PACKET_RESUMEDRIVER</b>   <b>'R'</b>
       Resume driver

   <b>#define</b> <b>BRLAPI_PACKET_SETFOCUS</b>   <b>'F'</b>
       Set current tty focus

   <b>#define</b> <b>BRLAPI_PACKET_SUSPENDDRIVER</b>   <b>'S'</b>
       Suspend driver

   <b>#define</b> <b>BRLAPI_PACKET_SYNCHRONIZE</b>   <b>'Z'</b>
       Synchronize exceptions

   <b>#define</b> <b>BRLAPI_PACKET_VERSION</b>   <b>'v'</b>
       Version

   <b>#define</b> <b>BRLAPI_PACKET_WRITE</b>   <b>'w'</b>
       Write

   <b>#define</b> <b>BRLAPI_PARAMF_GET</b>   <b>0X100</b>    <b>/**</b> <b>Get</b> <b>current</b> <b>parameter</b> <b>value</b>    <b>*/</b>
       Flags for parameter requests

   <b>#define</b> <b>BRLAPI_PARAMF_SUBSCRIBE</b>   <b>0X200</b>    <b>/**</b> <b>Subscribe</b> <b>to</b> <b>parameter</b> <b>updates</b> <b>*/</b>
   <b>#define</b> <b>BRLAPI_PARAMF_UNSUBSCRIBE</b>   <b>0X400</b>    <b>/**</b> <b>Unsubscribe</b> <b>from</b> <b>parameter</b> <b>updates</b> <b>*/</b>
   <b>#define</b> <b>BRLAPI_PROTOCOL_VERSION</b>   <b>((uint32_t)</b> <b>8)</b> <b>/**</b> <b>Communication</b> <b>protocol</b> <b>version</b> <b>*/</b>
   <b>#define</b> <b>BRLAPI_PVF_GLOBAL</b>   <b>0X01</b>    <b>/**</b> <b>Value</b> <b>is</b> <b>the</b> <b>global</b> <b>value</b> <b>*/</b>
       Flags for parameter values

   <b>#define</b> <b>BRLAPI_WF_ATTR_AND</b>   <b>0X08</b>
       And attributes

   <b>#define</b> <b>BRLAPI_WF_ATTR_OR</b>   <b>0X10</b>
       Or attributes

   <b>#define</b> <b>BRLAPI_WF_CHARSET</b>   <b>0X40</b>
       Charset

   <b>#define</b> <b>BRLAPI_WF_CURSOR</b>   <b>0X20</b>
       Cursor position

   <b>#define</b> <b>BRLAPI_WF_DISPLAYNUMBER</b>   <b>0X01</b>
       Flags for writing Display number

   <b>#define</b> <b>BRLAPI_WF_REGION</b>   <b>0X02</b>
       Region parameter

   <b>#define</b> <b>BRLAPI_WF_TEXT</b>   <b>0X04</b>
       Contains some text

</pre><h4><b>Function</b> <b>Documentation</b></h4><pre>
   <b>ssize_t</b> <b>brlapi_readPacket</b> <b>(brlapi_fileDescriptor</b> <b>fd,</b> <b>brlapi_packetType_t</b> <b>*</b> <b>type,</b> <b>void</b> <b>*</b> <b>buf,</b> <b>size_t</b> <b>size)</b>
       Read a packet from <u>BrlAPI</u> server

       This function is for internal use, but one might use it if one really knows what one is doing...

       <u>type</u> is where the function will store the packet type; it should always be one of the above defined
       BRLPACKET_* (or else something very nasty must have happened :/).

       The syntax is the same as read()'s.

       <b>Returns</b>
           packet's size, -2 if EOF occurred, -1 on error or signal interruption.

       If the packet is larger than the supplied buffer, the buffer will be filled with the beginning of the
       packet, the rest of the packet being discarded. This follows the semantics of the recv system call when
       the MSG_TRUNC option is given.

       <b>See</b> <b>also</b>
           <b>brlapi_writePacket()</b>

   <b>ssize_t</b> <b>brlapi_readPacketContent</b> <b>(brlapi_fileDescriptor</b> <b>fd,</b> <b>size_t</b> <b>packetSize,</b> <b>void</b> <b>*</b> <b>buf,</b> <b>size_t</b> <b>bufSize)</b>
       Read the content of a packet from <u>BrlAPI</u> server

       This function is for internal use, but one might use it if one really knows what one is doing...

       <u>packetSize</u> is the size announced by <b>brlapi_readPacketHeader()</b>

       <u>bufSize</u> is the size of <u>buf</u>

       <b>Returns</b>
           packetSize, -2 if EOF occurred, -1 on error.

       If the packet is larger than the supplied buffer, the buffer will be filled with the beginning of the
       packet, the rest of the packet being discarded. This follows the semantics of the recv system call when
       the MSG_TRUNC option is given.

       <b>See</b> <b>also</b>
           <b>brlapi_writePacket()</b> <b>brlapi_readPacketHeader()</b> <b>brlapi_readPacket()</b>

   <b>ssize_t</b> <b>brlapi_readPacketHeader</b> <b>(brlapi_fileDescriptor</b> <b>fd,</b> <b>brlapi_packetType_t</b> <b>*</b> <b>packetType)</b>
       Read the header (type+size) of a packet from <u>BrlAPI</u> server

       This function is for internal use, but one might use it if one really knows what one is doing...

       <u>type</u> is where the function will store the packet type; it should always be one of the above defined
       BRLPACKET_* (or else something very nasty must have happened :/).

       <b>Returns</b>
           packet's size, -2 if EOF occurred, -1 on error or signal interruption.

       <b>See</b> <b>also</b>
           <b>brlapi_writePacket()</b> <b>brlapi_readPacketContent</b> <b>brlapi_readPacket</b>

   <b>ssize_t</b> <b>brlapi_writePacket</b> <b>(brlapi_fileDescriptor</b> <b>fd,</b> <b>brlapi_packetType_t</b> <b>type,</b> <b>const</b> <b>void</b> <b>*</b> <b>buf,</b> <b>size_t</b>
       <b>size)</b>
       Send a packet to <u>BrlAPI</u> server

       This function is for internal use, but one might use it if one really knows what one is doing...

       <u>type</u> should only be one of the above defined BRLPACKET_*.

       The syntax is the same as write()'s.

       <b>Returns</b>
           0 on success, -1 on failure.

       <b>See</b> <b>also</b>
           <b>brlapi_readPacketHeader()</b> <b>brlapi_readPacketContent()</b> <b>brlapi_readPacket()</b>

</pre><h4><b>Variable</b> <b>Documentation</b></h4><pre>
   <b>pthread_mutex_t</b> <b>brlapi_fd_mutex</b> <b>[extern]</b>
       Mutex for protecting concurrent fd access

       In order to regulate concurrent access to the library's file descriptor and requests to / answers from
       <u>BrlAPI</u> server, every function of the library locks this mutex, namely

       • <b>brlapi_openConnection()</b>

       • <b>brlapi_closeConnection()</b>

       • <b>brlapi_enterRawMode()</b>

       • <b>brlapi_leaveRawMode()</b>

       • <b>brlapi_sendRaw()</b>

       • <b>brlapi_recvRaw()</b>

       • <b>brlapi_getDriverName()</b>

       • <b>brlapi_getDisplaySize()</b>

       • <b>brlapi_enterTtyMode()</b>

       • <b>brlapi_enterTtyModeWithPath()</b>

       • <b>brlapi_leaveTtyMode()</b>

       • brlapi_*write*()

       • brlapi_(un)?ignorekey(Range|Set)()

       • <b>brlapi_readKey()</b>

       If  both  these  functions  and  <b>brlapi_writePacket()</b>  or <b>brlapi_readPacket()</b> are used in a multithreaded
       application, this mutex must be locked before calling <b>brlapi_writePacket()</b>  or  <b>brlapi_readPacket()</b>,  and
       unlocked afterwards.

</pre><h4><b>Author</b></h4><pre>
       Generated automatically by Doxygen for BrlAPI from the source code.

BrlAPI                                             Version 0.8                                <u><a href="../man3/brlapi_protocol.3.html">brlapi_protocol</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>