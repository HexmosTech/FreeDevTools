<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ssh_file  -  Default  callback  module  for  the  client's  and  server's  database operations in the ssh</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/erlang-manpages">erlang-manpages_24.2.1+dfsg-1ubuntu0.5_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ssh_file  -  Default  callback  module  for  the  client's  and  server's  database operations in the ssh
       application

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This module is the default callback handler for the client's and the server's user  and  host  "database"
       operations.  All  data,  for instance key pairs, are stored in files in the normal file system. This page
       documents the files, where they are stored and configuration options for this callback module.

       The intention is to be compatible with the OpenSSH storage in files. Therefore it mimics directories  and
       filenames of OpenSSH.

       Ssh_file  implements  the ssh_server_key_api and the ssh_client_key_api. This enables the user to make an
       own interface using for example a database handler.

       Such another callback module could be used by setting the option <u>key_cb</u>  when  starting  a  client  or  a
       server (with for example ssh:connect, ssh:daemon of ssh:shell ).

   <b>Note:</b>
       The functions are <u>Callbacks</u>  for the SSH app. They are not intended to be called from the user's code!

</pre><h4><b>FILES,</b> <b>DIRECTORIES</b> <b>AND</b> <b>WHO</b> <b>USES</b> <b>THEM</b></h4><pre>
   <b>Daemons</b>
       Daemons uses all files stored in the SYSDIR directory.

       Optionaly,  in  case  of  <u>publickey</u>  authorization,  one  or more of the remote user's public keys in the
       USERDIR directory are used. See the files <u>USERDIR/authorized_keys</u> and <u>USERDIR/authorized_keys2</u>.

   <b>Clients</b>
       Clients uses all files stored in the USERDIR directory.

   <b>Directory</b> <b>contents</b>
         <b>LOCALUSER:</b>
           The user name of the OS process running the Erlang virtual machine (emulator).

         <b>SYSDIR:</b>
           This is the directory holding the server's files:

           * <u>ssh_host_dsa_key</u> - private dss host key (optional)

           * <u>ssh_host_rsa_key</u> - private rsa host key (optional)

           * <u>ssh_host_ecdsa_key</u> - private ecdsa host key (optional)

           * <u>ssh_host_ed25519_key</u> - private eddsa host key for curve 25519 (optional)

           * <u>ssh_host_ed448_key</u> - private eddsa host key for curve 448 (optional)

           The key files could be generated with OpenSSH's ssh-keygen command.

           At least one host key must be defined. The default value of SYSDIR is <u><a href="file:/etc/ssh">/etc/ssh</a></u>.

           For security reasons, this directory is normally accessible only to the root user.

           To change the SYSDIR, see the system_dir option.

         <b>USERDIR:</b>
           This is the directory holding the files:

           * <u>authorized_keys</u> and, as second alternative <u>authorized_keys2</u> - the user's  public  keys  are  stored
             concatenated in one of those files.

             It is composed of lines as for OpenSSH:

           (options)? keytype base64-encoded-key comment

             where

           options :: option(,option)*
           option :: % All options are skipped
           keytype :: 'ssh-dsa'
                    | 'ssh-rsa'
                    | 'ssh-ecdsa-nistp256'
                 | 'ssh-ecdsa-nistp384'
                    | 'ssh-ecdsa-nistp521'
                    | 'ssh-ed25519'
                 | 'ssh-ed448'
           base64-encoded-key :: % The user's public key
           comment :: % Comments are skipped

           * <u>known_hosts</u>  -  host  keys  from  hosts  visited  concatenated. The file is created and used by the
             client.

             It is composed of lines as for OpenSSH:

           (option)? pattern(,pattern)* keytype key (comment)?

             where

           option :: '@revoked'
           pattern :: host | '[' host ']:' port
           host :: ip-address | hostname | '*'
           port :: portnumber | '*'
           keytype :: 'ssh-dsa'
                    | 'ssh-rsa'
                    | 'ssh-ecdsa-nistp256'
                 | 'ssh-ecdsa-nistp384'
                    | 'ssh-ecdsa-nistp521'
                    | 'ssh-ed25519'
                 | 'ssh-ed448'
           key :: % encoded key from eg ssh_host_*.pub

           * <u>id_dsa</u> - private dss user key (optional)

           * <u>id_rsa</u> - private rsa user key (optional)

           * <u>id_ecdsa</u> - private ecdsa user key (optional)

           * <u>id_ed25519</u> - private eddsa user key for curve 25519 (optional)

           * <u>id_ed448</u> - private eddsa user key for curve 448 (optional)

           The key files could be generated with OpenSSH's ssh-keygen command.

           The default value of USERDIR is <u>/home/LOCALUSER/.ssh</u>.

           To change the USERDIR, see the user_dir option

</pre><h4><b>DATA</b> <b>TYPES</b></h4><pre>
   <b>Options</b> <b>for</b> <b>the</b> <b>default</b> <b>ssh_file</b> <b>callback</b> <b>module</b>
       <b>user_dir_common_option()</b> = {user_dir, string()}

              Sets the user directory.

       <b>user_dir_fun_common_option()</b> = {user_dir_fun, user2dir()}

       <b>user2dir()</b> =
           fun((RemoteUserName :: string()) -&gt; UserDir :: string())

              Sets the user directory dynamically by evaluating the <u>user2dir</u> function.

       <b>system_dir_daemon_option()</b> = {system_dir, string()}

              Sets the system directory.

       <b>pubkey_passphrase_client_options()</b> =
           {dsa_pass_phrase, string()} |
           {rsa_pass_phrase, string()} |
           {ecdsa_pass_phrase, string()}

              If the user's DSA, RSA or ECDSA key is protected by a passphrase, it can be supplied  with  thoose
              options.

              Note that EdDSA passhrases (Curves 25519 and 448) are not implemented.

       <b>optimize_key_lookup()</b> = {optimize, time | space}

              Make  the  handling  of large files fast by setting <u>time</u>, but this will use more memory. The <u>space</u>
              variant shrinks the memory requirements, but with a higher time consumption.

              To  set  it,  set  the  option  <u>{key_cb,</u>  <u>{ssh_file,</u>  <u>[{optimize,TimeOrSpace}]}</u>  in  the  call  of
              "ssh:connect/3, ssh:daemon/2 or similar function call that initiates an ssh connection.

</pre><h4><b>EXPORTS</b></h4><pre>
       <b>host_key(Algorithm,</b> <b>Options)</b> <b>-&gt;</b> <b>Result</b>

              Types:

                 Algorithm = ssh:pubkey_alg()
                 Result = {ok, public_key:private_key()} | {error, term()}
                 Options = ssh_server_key_api:daemon_key_cb_options(none())

              <b>Types</b> <b>and</b> <b>description</b>

              See the api description in ssh_server_key_api, Module:host_key/2.

              <b>Options</b>

                * system_dir

              <b>Files</b>

                * <u>SYSDIR/ssh_host_rsa_key</u>

                * <u>SYSDIR/ssh_host_dsa_key</u>

                * <u>SYSDIR/ssh_host_ecdsa_key</u>

                * <u>SYSDIR/ssh_host_ed25519_key</u>

                * <u>SYSDIR/ssh_host_ed448_key</u>c&gt;

       <b>is_auth_key(Key,</b> <b>User,</b> <b>Options)</b> <b>-&gt;</b> <b>boolean()</b>

              Types:

                 Key = public_key:public_key()
                 User = string()
                 Options =
                     ssh_server_key_api:daemon_key_cb_options(optimize_key_lookup())

              <b>Types</b> <b>and</b> <b>description</b>

              See the api description in ssh_server_key_api: Module:is_auth_key/3.

              <b>Options</b>

                * user_dir_fun

                * user_dir

              <b>Files</b>

                * <u>USERDIR/authorized_keys</u>

                * <u>USERDIR/authorized_keys2</u>

              This  functions  discards  all  options  in the begining of the lines of thoose files when reading
              them.

       <b>add_host_key(Host,</b> <b>Port,</b> <b>Key,</b> <b>Options)</b> <b>-&gt;</b> <b>Result</b>

              Types:

                 Host =
                     inet:ip_address() |
                     inet:hostname() |
                     [inet:ip_address() | inet:hostname()]
                 Port = inet:port_number()
                 Key = public_key:public_key()
                 Options = ssh_client_key_api:client_key_cb_options(none())
                 Result = ok | {error, term()}

              <b>Types</b> <b>and</b> <b>description</b>

              See the api description in ssh_client_key_api, Module:add_host_key/4.

              Note that the alternative, the old Module:add_host_key/3 is no longer supported by <u>ssh_file</u>.

              <b>Option</b>

                * user_dir

              <b>File</b>

                * <u>USERDIR/known_hosts</u>

       <b>is_host_key(Key,</b> <b>Host,</b> <b>Port,</b> <b>Algorithm,</b> <b>Options)</b> <b>-&gt;</b> <b>Result</b>

              Types:

                 Key = public_key:public_key()
                 Host =
                     inet:ip_address() |
                     inet:hostname() |
                     [inet:ip_address() | inet:hostname()]
                 Port = inet:port_number()
                 Algorithm = ssh:pubkey_alg()
                 Options =
                     ssh_client_key_api:client_key_cb_options(optimize_key_lookup())
                 Result = boolean() | {error, term()}

              <b>Types</b> <b>and</b> <b>description</b>

              See the api description in ssh_client_key_api, Module:is_host_key/5.

              Note that the alternative, the old Module:is_host_key/4 is no longer supported by <u>ssh_file</u>.

              <b>Option</b>

                * user_dir

              <b>File</b>

                * <u>USERDIR/known_hosts</u>

       <b>user_key(Algorithm,</b> <b>Options)</b> <b>-&gt;</b> <b>Result</b>

              Types:

                 Algorithm = ssh:pubkey_alg()
                 Result = {ok, public_key:private_key()} | {error, string()}
                 Options = ssh_client_key_api:client_key_cb_options(none())

              <b>Types</b> <b>and</b> <b>description</b>

              See the api description in ssh_client_key_api, Module:user_key/2.

              <b>Options</b>

                * user_dir

                * dsa_pass_phrase

                * rsa_pass_phrase

                * ecdsa_pass_phrase

              Note that EdDSA passhrases (Curves 25519 and 448) are not implemented.

              <b>Files</b>

                * <u>USERDIR/id_dsa</u>

                * <u>USERDIR/id_rsa</u>

                * <u>USERDIR/id_ecdsa</u>

                * <u>USERDIR/id_ed25519</u>

                * <u>USERDIR/id_ed448</u>

       <b>decode(SshBin,</b> <b>ssh2_pubkey)</b> <b>-&gt;</b> <b>Key</b>
       <b>decode(SshBin,</b> <b>rfc4716_key)</b> <b>-&gt;</b> <b>ResultRfc4716</b>
       <b>decode(SshBin,</b> <b>openssh_key)</b> <b>-&gt;</b> <b>ResultOpenSsh</b>
       <b>decode(SshBin,</b> <b>public_key)</b> <b>-&gt;</b> <b>ResultRfc4716</b> <b>|</b> <b>ResultOpenSsh</b>

              Types:

                 SshBin = binary()
                 ResultRfc4716 = [{Key, [{headers,Hdrs}]}] | Error
                 ResultOpenSsh = [{Key, [{comment,string()}]}] | Error
                 Key = public_key:public_key()
                 Hdrs = [{Tag::string(), Value::string()}]
                 Error = {error,term()}

              Decodes an SSH file-binary.

              If <u>Type</u> is <u>public_key</u> the binary can be either an RFC4716 public key or an OpenSSH public key.

          <b>Note:</b>
              The following key types have been renamed from the deprecated public_key:ssh_decode/2:

                * rfc4716_public_key -&gt; rfc4716_key

                * openssh_public_key -&gt; openssh_key

       <b>encode(Key,</b> <b>ssh2_pubkey)</b> <b>-&gt;</b> <b>Result</b>
       <b>encode(KeyAttrsRfc4716,</b> <b>rfc4716_key)</b> <b>-&gt;</b> <b>Result</b>
       <b>encode(KeyAttrsOpenSsh,</b> <b>openssh_key)</b> <b>-&gt;</b> <b>Result</b>

              Types:

                 Key = public_key:public_key()
                 Result = binary() | Error
                 KeyAttrsRfc4716 = [{Key, [{headers,Hdrs}]}] | Error
                 KeyAttrsOpenSsh = [{Key, [{comment,string()}]}] | Error
                 Hdrs = [{Tag::string(), Value::string()}]
                 Error = {error,term()}

              Encodes a list of SSH file entries (public keys and attributes) to a binary.

          <b>Note:</b>
              The following key types have been renamed from the deprecated public_key:ssh_encode/2:

                * rfc4716_public_key -&gt; rfc4716_key

                * openssh_public_key -&gt; openssh_key

Ericsson AB                                         ssh 4.13                                      <u><a href="../man3erl/ssh_file.3erl.html">ssh_file</a></u>(3erl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>