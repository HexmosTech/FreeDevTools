<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CURLMOPT_PUSHFUNCTION - callback that approves or denies server pushes</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcurl4-doc">libcurl4-doc_8.14.1-1ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       CURLMOPT_PUSHFUNCTION - callback that approves or denies server pushes

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;curl/curl.h&gt;

       int curl_push_callback(CURL *parent,
                              CURL *easy,
                              size_t num_headers,
                              struct curl_pushheaders *headers,
                              void *clientp);

       CURLMcode curl_multi_setopt(CURLM *handle, CURLMOPT_PUSHFUNCTION,
                                   curl_push_callback func);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  callback gets called when a new HTTP/2 stream is being pushed by the server (using the PUSH_PROMISE
       frame). If no push callback is set, all offered pushes are denied automatically.

</pre><h4><b>CALLBACK</b> <b>DESCRIPTION</b></h4><pre>
       The callback gets its arguments like this:

       <u>parent</u> is the handle of the stream on which this push arrives. The new handle has  been  duplicated  from
       the  parent,  meaning  that  it has gotten all its options inherited. It is then up to the application to
       alter any options if desired.

       <u>easy</u> is a newly created handle that represents this upcoming transfer.

       <u>num_headers</u> is the number of name+value pairs that was received and can be accessed

       <u>headers</u> is a handle used to access push headers using the accessor functions described below.  This  only
       accesses  and  provides  the PUSH_PROMISE headers, the normal response headers are provided in the header
       callback as usual.

       <u>clientp</u> is the pointer set with <u><a href="../man3/CURLMOPT_PUSHDATA.3.html">CURLMOPT_PUSHDATA</a>(3)</u>

       If the callback returns CURL_PUSH_OK, the new easy handle is added to the multi handle, the callback must
       not do that by itself.

       The callback can access PUSH_PROMISE headers with two accessor functions. These  functions  can  only  be
       used   from   within   this   callback   and   they   can   only   access   the   PUSH_PROMISE   headers:
       <u><a href="../man3/curl_pushheader_byname.3.html">curl_pushheader_byname</a>(3)</u> and <u><a href="../man3/curl_pushheader_bynum.3.html">curl_pushheader_bynum</a>(3)</u>. The normal response headers  are  passed  to  the
       header callback for pushed streams just as for normal streams.

       The header fields can also be accessed with <u><a href="../man3/curl_easy_header.3.html">curl_easy_header</a>(3)</u>, introduced in later libcurl versions.

</pre><h4><b>CALLBACK</b> <b>RETURN</b> <b>VALUE</b></h4><pre>
       CURL_PUSH_OK (0)
              The  application has accepted the stream and it can now start receiving data, the ownership of the
              curl handle has been taken over by the application.

       CURL_PUSH_DENY (1)
              The callback denies the stream and no data reaches the application, the easy handle  is  destroyed
              by libcurl.

       CURL_PUSH_ERROROUT (2)
              Returning  this  code  rejects  the  pushed  stream and returns an error back on the parent stream
              making it get closed with an error. (Added in 7.72.0)

       *      All other return codes are reserved for future use.

</pre><h4><b>DEFAULT</b></h4><pre>
       NULL, no callback

</pre><h4><b>PROTOCOLS</b></h4><pre>
       This functionality affects http only

</pre><h4><b>EXAMPLE</b></h4><pre>
       #include &lt;<a href="file:/usr/include/string.h">string.h</a>&gt;

       /* only allow pushes for filenames starting with "push-" */
       int push_callback(CURL *parent,
                         CURL *easy,
                         size_t num_headers,
                         struct curl_pushheaders *headers,
                         void *clientp)
       {
         char *headp;
         int *transfers = (int *)clientp;
         FILE *out;
         headp = curl_pushheader_byname(headers, ":path");
         if(headp &amp;&amp; !strncmp(headp, "/push-", 6)) {
           fprintf(stderr, "The PATH is %s\n", headp);

           /* save the push here */
           out = fopen("pushed-stream", "wb");

           /* write to this file */
           curl_easy_setopt(easy, CURLOPT_WRITEDATA, out);

           (*transfers)++; /* one more */

           return CURL_PUSH_OK;
         }
         return CURL_PUSH_DENY;
       }

       int main(void)
       {
         int counter;
         CURLM *multi = curl_multi_init();
         curl_multi_setopt(multi, CURLMOPT_PUSHFUNCTION, push_callback);
         curl_multi_setopt(multi, CURLMOPT_PUSHDATA, &amp;counter);
       }

</pre><h4><b>AVAILABILITY</b></h4><pre>
       Added in curl 7.44.0

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       <u><a href="../man3/curl_multi_setopt.3.html">curl_multi_setopt</a>(3)</u> returns a CURLMcode indicating success or error.

       CURLM_OK (0) means everything was OK, non-zero means an error occurred, see <u><a href="../man3/libcurl-errors.3.html">libcurl-errors</a>(3)</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/CURLMOPT_PIPELINING.3.html">CURLMOPT_PIPELINING</a></b>(3), <b><a href="../man3/CURLMOPT_PUSHDATA.3.html">CURLMOPT_PUSHDATA</a></b>(3), <b><a href="../man3/CURLOPT_PIPEWAIT.3.html">CURLOPT_PIPEWAIT</a></b>(3), <b>RFC</b>7540

libcurl                                            2025-06-16                           <u><a href="../man3/CURLMOPT_PUSHFUNCTION.3.html">CURLMOPT_PUSHFUNCTION</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>