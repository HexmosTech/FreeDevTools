<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CURLMOPT_SOCKETFUNCTION - callback informed about what to wait for</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcurl4-doc">libcurl4-doc_8.14.1-1ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       CURLMOPT_SOCKETFUNCTION - callback informed about what to wait for

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;curl/curl.h&gt;

       int socket_callback(CURL *easy,      /* easy handle */
                           curl_socket_t s, /* socket */
                           int what,        /* describes the socket */
                           void *clientp,   /* private callback pointer */
                           void *socketp);  /* private socket pointer */

       CURLMcode curl_multi_setopt(CURLM *handle, CURLMOPT_SOCKETFUNCTION, socket_callback);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Pass a pointer to your callback function, which should match the prototype shown above.

       When  the <u><a href="../man3/curl_multi_socket_action.3.html">curl_multi_socket_action</a>(3)</u> function is called, it uses this callback to inform the application
       about updates in the socket (file descriptor) status by  doing  none,  one,  or  multiple  calls  to  the
       <b>socket_callback</b>.  The  callback  function  gets  status  updates with changes since the previous time the
       callback was called. If the given callback pointer is set to NULL, no callback is called.

       libcurl then expects the application to monitor the sockets for the specific activities and tell  libcurl
       again when something happens on one of them. Tell libcurl by calling <u><a href="../man3/curl_multi_socket_action.3.html">curl_multi_socket_action</a>(3)</u>.

       This  callback may get invoked at any time when interacting with libcurl.  This may even happen after all
       transfers are done and is <u>likely</u> to happen <u>during</u> a call to <u><a href="../man3/curl_multi_cleanup.3.html">curl_multi_cleanup</a>(3)</u> when cached connections
       are shut down.

</pre><h4><b>CALLBACK</b> <b>ARGUMENTS</b></h4><pre>
       <u>easy</u> identifies the specific transfer for which this update is related.  Since this  callback  manages  a
       whole  multi  handle,  an  application  should not make assumptions about which particular handle that is
       passed here. It might even be an internal easy handle that the application did not add itself.

       <u>s</u> is the specific socket this function invocation concerns. If the <b>what</b> argument is not  CURL_POLL_REMOVE
       then  it  holds  information  about  what activity on this socket the application is supposed to monitor.
       Subsequent calls to this callback might update the <b>what</b> bits for a socket that is already monitored.

       The socket callback should return 0 on success, and -1 on error. If  this  callback  returns  error,  <b>all</b>
       transfers currently in progress in this multi handle are aborted and made to fail.

       <b>clientp</b> is set with <u><a href="../man3/CURLMOPT_SOCKETDATA.3.html">CURLMOPT_SOCKETDATA</a>(3)</u>.

       <b>socketp</b> is set with <u><a href="../man3/curl_multi_assign.3.html">curl_multi_assign</a>(3)</u> or NULL.

       The  <b>what</b>  parameter  informs  the  callback  on the status of the given socket. It can hold one of these
       values:

       CURL_POLL_IN
              Wait for incoming data. For the socket to become readable.

       CURL_POLL_OUT
              Wait for outgoing data. For the socket to become writable.

       CURL_POLL_INOUT
              Wait for incoming and outgoing data. For the socket to become readable or writable.

       CURL_POLL_REMOVE
              The specified socket/file descriptor is no longer used by libcurl  for  any  active  transfer.  It
              might soon be added again.

</pre><h4><b>DEFAULT</b></h4><pre>
       NULL (no callback)

</pre><h4><b>PROTOCOLS</b></h4><pre>
       This functionality affects all supported protocols

</pre><h4><b>EXAMPLE</b></h4><pre>
       struct priv {
         void *ours;
       };

       static int sock_cb(CURL *e, curl_socket_t s, int what, void *cbp, void *sockp)
       {
         struct priv *p = sockp;
         printf("our ptr: %p\n", p-&gt;ours);

         if(what == CURL_POLL_REMOVE) {
           /* remove the socket from our collection */
         }
         if(what &amp; CURL_POLL_IN) {
           /* wait for read on this socket */
         }
         if(what &amp; CURL_POLL_OUT) {
           /* wait for write on this socket */
         }

         return 0;
       }

       int main(void)
       {
         struct priv setup;
         CURLM *multi = curl_multi_init();
         /* ... use socket callback and custom pointer */
         curl_multi_setopt(multi, CURLMOPT_SOCKETFUNCTION, sock_cb);
         curl_multi_setopt(multi, CURLMOPT_SOCKETDATA, &amp;setup);
       }

</pre><h4><b>AVAILABILITY</b></h4><pre>
       Added in curl 7.15.4

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       Returns CURLM_OK.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/CURLMOPT_SOCKETDATA.3.html">CURLMOPT_SOCKETDATA</a></b>(3), <b><a href="../man3/CURLMOPT_TIMERFUNCTION.3.html">CURLMOPT_TIMERFUNCTION</a></b>(3), <b><a href="../man3/curl_multi_socket_action.3.html">curl_multi_socket_action</a></b>(3)

libcurl                                            2025-06-16                         <u><a href="../man3/CURLMOPT_SOCKETFUNCTION.3.html">CURLMOPT_SOCKETFUNCTION</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>