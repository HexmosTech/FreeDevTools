<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CURLOPT_SSL_CTX_FUNCTION - SSL context callback</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcurl4-doc">libcurl4-doc_8.14.1-1ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       CURLOPT_SSL_CTX_FUNCTION - SSL context callback

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;curl/curl.h&gt;

       CURLcode ssl_ctx_callback(CURL *curl, void *ssl_ctx, void *clientp);

       CURLcode curl_easy_setopt(CURL *handle, CURLOPT_SSL_CTX_FUNCTION,
                                 ssl_ctx_callback);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Pass a pointer to your callback function, which should match the prototype shown above.

       This  callback  function gets called by libcurl just before the initialization of an SSL connection after
       having processed all other SSL related options to give a last chance to  an  application  to  modify  the
       behavior  of  the SSL initialization. The <u>ssl_ctx</u> parameter is a pointer to the SSL library's <u>SSL_CTX</u> for
       OpenSSL or wolfSSL, a pointer to <u>mbedtls_ssl_config</u> for mbedTLS or a pointer to <u>br_ssl_client_context</u> for
       BearSSL. If an error is returned from the callback no attempt to establish a connection is made  and  the
       perform  operation returns the callback's error code. Set the <u>clientp</u> argument passed in to this callback
       with the <u><a href="../man3/CURLOPT_SSL_CTX_DATA.3.html">CURLOPT_SSL_CTX_DATA</a>(3)</u> option.

       This function gets called for all new connections made to a server, during  the  SSL  negotiation.  While
       <u>ssl_ctx</u>  points  to a newly initialized object each time, the pointer may still be the same as in a prior
       call.

       To use this callback, a non-trivial amount of knowledge of your SSL library is  necessary.  For  example,
       you  can  use  this  function  to  call  library-specific callbacks to add additional validation code for
       certificates, and even to change the actual URI of an HTTPS request.

       For OpenSSL, asynchronous certificate verification  via  <u>SSL_set_retry_verify</u>  is  supported.  (Added  in
       8.3.0)

       The <u><a href="../man3/CURLOPT_SSL_CTX_FUNCTION.3.html">CURLOPT_SSL_CTX_FUNCTION</a>(3)</u> callback allows the application to reach in and modify SSL details in the
       connection  without libcurl itself knowing anything about it, which then subsequently can lead to libcurl
       unknowingly  reusing  SSL  connections  with  different  properties.  To  remedy   this   you   may   set
       <u><a href="../man3/CURLOPT_FORBID_REUSE.3.html">CURLOPT_FORBID_REUSE</a>(3)</u> from the callback function.

       If  you are using DNS-over-HTTPS (DoH) via <u><a href="../man3/CURLOPT_DOH_URL.3.html">CURLOPT_DOH_URL</a>(3)</u> then this callback is also called for those
       transfers and the curl handle is set to an internal handle.  <b>This</b>  <b>behavior</b>  <b>is</b>  <b>subject</b>  <b>to</b>  <b>change.</b>  We
       recommend  setting <u><a href="../man3/CURLOPT_PRIVATE.3.html">CURLOPT_PRIVATE</a>(3)</u> on your curl handle so you can identify it correctly in the context
       callback. If you have a reason to modify DoH SSL context please let us know on the  curl-library  mailing
       list because we are considering removing this capability.

       libcurl does not guarantee the lifetime of the passed in object once this callback function has returned.
       Your application must not assume that it can keep using the SSL context or data derived from it once this
       function is completed.

       For  libcurl builds using TLS backends that support CA caching and <u><a href="../man3/CURLOPT_CA_CACHE_TIMEOUT.3.html">CURLOPT_CA_CACHE_TIMEOUT</a>(3)</u> is not set
       to zero, multiple calls to this callback may be done with the same CA store in memory.

</pre><h4><b>DEFAULT</b></h4><pre>
       NULL

</pre><h4><b>PROTOCOLS</b></h4><pre>
       This functionality affects all TLS based protocols: HTTPS, FTPS, IMAPS, POP3S, SMTPS etc.

       This option works only with the following TLS backends: BearSSL, OpenSSL, mbedTLS and wolfSSL

</pre><h4><b>EXAMPLE</b></h4><pre>
       /* OpenSSL specific */

       #include &lt;openssl/ssl.h&gt;
       #include &lt;curl/curl.h&gt;
       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;

       static CURLcode sslctx_function(CURL *curl, void *sslctx, void *parm)
       {
         X509_STORE *store;
         X509 *cert = NULL;
         BIO *bio;
         char *mypem = parm;
         /* get a BIO */
         bio = BIO_new_mem_buf(mypem, -1);
         /* use it to read the PEM formatted certificate from memory into an
          * X509 structure that SSL can use
          */
         PEM_read_bio_X509(bio, &amp;cert, 0, NULL);
         if(!cert)
           printf("PEM_read_bio_X509 failed...\n");

         /* get a pointer to the X509 certificate store (which may be empty) */
         store = SSL_CTX_get_cert_store((SSL_CTX *)sslctx);

         /* add our certificate to this store */
         if(X509_STORE_add_cert(store, cert) == 0)
           printf("error adding certificate\n");

         /* decrease reference counts */
         X509_free(cert);
         BIO_free(bio);

         /* all set to go */
         return CURLE_OK;
       }

       int main(void)
       {
         CURL *ch;
         CURLcode rv;
         char *mypem = /* example CA cert PEM - shortened */
           "-----BEGIN CERTIFICATE-----\n"
           "MIIHPTCCBSWgAwIBAgIBADANBgkqhkiG9w0BAQQFADB5MRAwDgYDVQQKEwdSb290\n"
           "IENBMR4wHAYDVQQLExVodHRwOi8vd3d3LmNhY2VydC5vcmcxIjAgBgNVBAMTGUNB\n"
           "IENlcnQgU2lnbmluZyBBdXRob3JpdHkxITAfBgkqhkiG9w0BCQEWEnN1cHBvcnRA\n"
           "Y2FjZXJ0Lm9yZzAeFw0wMzAzMzAxMjI5NDlaFw0zMzAzMjkxMjI5NDlaMHkxEDAO\n"
           "GCSNe9FINSkYQKyTYOGWhlC0elnYjyELn8+CkcY7v2vcB5G5l1YjqrZslMZIBjzk\n"
           "zk6q5PYvCdxTby78dOs6Y5nCpqyJvKeyRKANihDjbPIky/qbn3BHLt4Ui9SyIAmW\n"
           "omTxJBzcoTWcFbLUvFUufQb1nA5V9FrWk9p2rSVzTMVD\n"
           "-----END CERTIFICATE-----\n";

         curl_global_init(CURL_GLOBAL_ALL);
         ch = curl_easy_init();

         curl_easy_setopt(ch, CURLOPT_SSLCERTTYPE, "PEM");
         curl_easy_setopt(ch, CURLOPT_SSL_VERIFYPEER, 1L);
         curl_easy_setopt(ch, CURLOPT_URL, "https://www.example.com/");

         curl_easy_setopt(ch, CURLOPT_SSL_CTX_FUNCTION, *sslctx_function);
         curl_easy_setopt(ch, CURLOPT_SSL_CTX_DATA, mypem);
         rv = curl_easy_perform(ch);
         if(!rv)
           printf("*** transfer succeeded ***\n");
         else
           printf("*** transfer failed ***\n");

         curl_easy_cleanup(ch);
         curl_global_cleanup();
         return rv;
       }

</pre><h4><b>AVAILABILITY</b></h4><pre>
       Added in curl 7.10.6

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       CURLE_OK if supported; or an error such as:

       CURLE_NOT_BUILT_IN - Not supported by the SSL backend

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/CURLOPT_CAINFO.3.html">CURLOPT_CAINFO</a></b>(3),    <b><a href="../man3/CURLOPT_CAINFO_BLOB.3.html">CURLOPT_CAINFO_BLOB</a></b>(3),    <b><a href="../man3/CURLOPT_CA_CACHE_TIMEOUT.3.html">CURLOPT_CA_CACHE_TIMEOUT</a></b>(3),    <b><a href="../man3/CURLOPT_SSL_CTX_DATA.3.html">CURLOPT_SSL_CTX_DATA</a></b>(3),
       <b><a href="../man3/CURLOPT_SSL_VERIFYHOST.3.html">CURLOPT_SSL_VERIFYHOST</a></b>(3), <b><a href="../man3/CURLOPT_SSL_VERIFYPEER.3.html">CURLOPT_SSL_VERIFYPEER</a></b>(3)

libcurl                                            2025-06-16                        <u><a href="../man3/CURLOPT_SSL_CTX_FUNCTION.3.html">CURLOPT_SSL_CTX_FUNCTION</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>