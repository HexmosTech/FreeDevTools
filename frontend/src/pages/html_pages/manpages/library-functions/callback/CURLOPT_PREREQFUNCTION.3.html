<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CURLOPT_PREREQFUNCTION  -  user  callback  called  when  a  connection has been established, but before a</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcurl4-doc">libcurl4-doc_8.14.1-1ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       CURLOPT_PREREQFUNCTION  -  user  callback  called  when  a  connection has been established, but before a
       request has been made.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;curl/curl.h&gt;

       /* These are the return codes for the pre-request callback. */
       #define CURL_PREREQFUNC_OK 0
       #define CURL_PREREQFUNC_ABORT 1 /* fail the entire transfer */

       int prereq_callback(void *clientp,
                           char *conn_primary_ip,
                           char *conn_local_ip,
                           int conn_primary_port,
                           int conn_local_port);

       CURLcode curl_easy_setopt(CURL *handle, CURLOPT_PREREQFUNCTION, prereq_callback);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Pass a pointer to your callback function, which should match the prototype shown above.

       This function gets called by libcurl after a connection has been established or  a  connection  has  been
       reused  (including  any  SSL handshaking), but before any request is actually made on the connection. For
       example, for HTTP, this callback is called once a connection has been  established  to  the  server,  but
       before a GET/HEAD/POST/etc request has been sent.

       This  function  may  be  called  multiple  times  if redirections are enabled and are being followed (see
       <u><a href="../man3/CURLOPT_FOLLOWLOCATION.3.html">CURLOPT_FOLLOWLOCATION</a>(3)</u>).

       The callback function must return <u>CURL_PREREQFUNC_OK</u> on success, or <u>CURL_PREREQFUNC_ABORT</u>  to  cause  the
       transfer to fail with result <u>CURLE_ABORTED_BY_CALLBACK</u>.

       This function is passed the following arguments:

       conn_primary_ip
              A pointer to a null-terminated C string containing the primary IP of the remote server established
              with  this  connection.  For  FTP,  this  is the IP for the control connection. IPv6 addresses are
              represented without surrounding brackets.

       conn_local_ip
              A pointer to a null-terminated C string containing the originating IP for  this  connection.  IPv6
              addresses are represented without surrounding brackets.

       conn_primary_port
              The  primary  port number on the remote server established with this connection.  For FTP, this is
              the port for the control connection. This can be a TCP or a  UDP  port  number  depending  on  the
              protocol.

       conn_local_port
              The  originating port number for this connection. This can be a TCP or a UDP port number depending
              on the protocol.

       clientp
              The pointer you set with <u><a href="../man3/CURLOPT_PREREQDATA.3.html">CURLOPT_PREREQDATA</a>(3)</u>.

</pre><h4><b>DEFAULT</b></h4><pre>
       NULL

</pre><h4><b>PROTOCOLS</b></h4><pre>
       This functionality affects all supported protocols

</pre><h4><b>EXAMPLE</b></h4><pre>
       struct priv {
         void *custom;
       };

       static int prereq_callback(void *clientp,
                                  char *conn_primary_ip,
                                  char *conn_local_ip,
                                  int conn_primary_port,
                                  int conn_local_port)
       {
         printf("Connection made to %s:%d\n", conn_primary_ip, conn_primary_port);
         return CURL_PREREQFUNC_OK;
       }

       int main(void)
       {
         struct priv prereq_data;
         CURL *curl = curl_easy_init();
         if(curl) {
           curl_easy_setopt(curl, CURLOPT_PREREQFUNCTION, prereq_callback);
           curl_easy_setopt(curl, CURLOPT_PREREQDATA, &amp;prereq_data);
           curl_easy_perform(curl);
         }
       }

</pre><h4><b>AVAILABILITY</b></h4><pre>
       Added in curl 7.80.0

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       <u><a href="../man3/curl_easy_setopt.3.html">curl_easy_setopt</a>(3)</u> returns a CURLcode indicating success or error.

       CURLE_OK (0) means everything was OK, non-zero means an error occurred, see <u><a href="../man3/libcurl-errors.3.html">libcurl-errors</a>(3)</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/CURLINFO_PRIMARY_IP.3.html">CURLINFO_PRIMARY_IP</a></b>(3), <b><a href="../man3/CURLINFO_PRIMARY_PORT.3.html">CURLINFO_PRIMARY_PORT</a></b>(3), <b><a href="../man3/CURLOPT_PREREQDATA.3.html">CURLOPT_PREREQDATA</a></b>(3)

libcurl                                            2025-06-16                          <u><a href="../man3/CURLOPT_PREREQFUNCTION.3.html">CURLOPT_PREREQFUNCTION</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>