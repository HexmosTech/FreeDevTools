<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>k_hasafs,   k_hasafs_recheck,   k_pioctl,   k_unlog,   k_setpag,   k_afs_cell_of_file,  kafs_set_verbose,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/heimdal-dev">heimdal-dev_7.8.git20221117.28daf24+dfsg-9ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       k_hasafs,   k_hasafs_recheck,   k_pioctl,   k_unlog,   k_setpag,   k_afs_cell_of_file,  kafs_set_verbose,
       kafs_settoken_rxkad,   kafs_settoken,   krb_afslog,    krb_afslog_uid,    kafs_settoken5,    krb5_afslog,
       krb5_afslog_uid — AFS library

</pre><h4><b>LIBRARY</b></h4><pre>
       AFS cache manager access library (libkafs, -lkafs)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;kafs.h&gt;</b>

       <u>int</u>
       <b>k_afs_cell_of_file</b>(<u>const</u> <u>char</u> <u>*path</u>, <u>char</u> <u>*cell</u>, <u>int</u> <u>len</u>);

       <u>int</u>
       <b>k_hasafs</b>(<u>void</u>);

       <u>int</u>
       <b>k_hasafs_recheck</b>(<u>void</u>);

       <u>int</u>
       <b>k_pioctl</b>(<u>char</u> <u>*a_path</u>, <u>int</u> <u>o_opcode</u>, <u>struct</u> <u>ViceIoctl</u> <u>*a_paramsP</u>, <u>int</u> <u>a_followSymlinks</u>);

       <u>int</u>
       <b>k_setpag</b>(<u>void</u>);

       <u>int</u>
       <b>k_unlog</b>(<u>void</u>);

       <u>void</u>
       <b>kafs_set_verbose</b>(<u>void</u> <u>(*func)(void</u> <u>*,</u> <u>const</u> <u>char</u> <u>*,</u> <u>int)</u>, <u>void</u> <u>*</u>);

       <u>int</u>
       <b>kafs_settoken_rxkad</b>(<u>const</u> <u>char</u> <u>*cell</u>, <u>struct</u> <u>ClearToken</u> <u>*token</u>, <u>void</u> <u>*ticket</u>, <u>size_t</u> <u>ticket_len</u>);

       <u>int</u>
       <b>kafs_settoken</b>(<u>const</u> <u>char</u> <u>*cell</u>, <u>uid_t</u> <u>uid</u>, <u>CREDENTIALS</u> <u>*c</u>);

       <b>krb_afslog</b>(<u>char</u> <u>*cell</u>, <u>char</u> <u>*realm</u>);

       <u>int</u>
       <b>krb_afslog_uid</b>(<u>char</u> <u>*cell</u>, <u>char</u> <u>*realm</u>, <u>uid_t</u> <u>uid</u>);

       <u>krb5_error_code</u>
       <b>krb5_afslog_uid</b>(<u>krb5_context</u>   <u>context</u>,   <u>krb5_ccache</u>  <u>id</u>,  <u>const</u>  <u>char</u>  <u>*cell</u>,  <u>krb5_const_realm</u>  <u>realm</u>,
           <u>uid_t</u> <u>uid</u>);

       <u>int</u>
       <b>kafs_settoken5</b>(<u>const</u> <u>char</u> <u>*cell</u>, <u>uid_t</u> <u>uid</u>, <u>krb5_creds</u> <u>*c</u>);

       <u>krb5_error_code</u>
       <b>krb5_afslog</b>(<u>krb5_context</u> <u>context</u>, <u>krb5_ccache</u> <u>id</u>, <u>const</u> <u>char</u> <u>*cell</u>, <u>krb5_const_realm</u> <u>realm</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>k_hasafs</b>() initializes some library internal structures, and tests for the presence of AFS in the kernel,
       none of the other functions should be called before <b>k_hasafs</b>() is called, or if it fails.

       <b>k_hasafs_recheck</b>() forces a  recheck  if  a  AFS  client  has  started  since  last  time  <b>k_hasafs</b>()  or
       <b>k_hasafs_recheck</b>() was called.

       <b>kafs_set_verbose</b>()  set  a  log  function  that  will be called each time the kafs library does something
       important so that the application using  libkafs  can  output  verbose  logging.   Calling  the  function
       <u>kafs_set_verbose</u>  with  the  function  argument  set  to  NULL will stop libkafs from calling the logging
       function (if set).

       <b>kafs_settoken_rxkad</b>() set <b>rxkad</b> with the <u>token</u> and <u>ticket</u> (that have the length <u>ticket_len</u>) for  a  given
       <u>cell</u>.

       <b>kafs_settoken</b>()  and  <b>kafs_settoken5</b>() work the same way as <b>kafs_settoken_rxkad</b>() but internally converts
       the Kerberos 4 or 5 credential to a afs cleartoken and ticket.

       <b>krb_afslog</b>(), and <b>krb_afslog_uid</b>() obtains new tokens (and possibly tickets) for the specified  <u>cell</u>  and
       <u>realm</u>.  If <u>cell</u> is NULL, the local cell is used. If <u>realm</u> is NULL, the function tries to guess what realm
       to  use.  Unless  you   have  some  good  knowledge  of  what cell or realm to use, you should pass NULL.
       <b>krb_afslog</b>() will use the real user-id for the ViceId field in the token, <b>krb_afslog_uid</b>() will use <u>uid</u>.

       <b>krb5_afslog</b>(),  and  <b>krb5_afslog_uid</b>()  are   the   Kerberos   5   equivalents   of   <b>krb_afslog</b>(),   and
       <b>krb_afslog_uid</b>().

       <b>krb5_afslog</b>(),  <b>kafs_settoken5</b>()  can  be  configured  to behave differently via a <b>krb5_appdefault</b> option
       <b>afs-use-524</b> in <u>krb5.conf</u>.  Possible values for <b>afs-use-524</b> are:

       yes    use the 524 server in the realm to convert the ticket

       no     use the Kerberos 5 ticket directly, can be used with if the afs cell support 2b token.

       local, 2b
              convert the Kerberos 5 credential to a 2b token locally (the same work as a 2b 524  server  should
              have done).

       Example:

       [appdefaults]
               SU.SE = { afs-use-524 = local }
               PDC.KTH.SE = { afs-use-524 = yes }
               afs-use-524 = yes

       libkafs will use the <b>libkafs</b> as application name when running the <b>krb5_appdefault</b> function call.

       The (uppercased) cell name is used as the realm to the <b>krb5_appdefault</b> <b>function.</b>

       <b>k_afs_cell_of_file</b>() will in <u>cell</u> return the cell of a specified file, no more than <u>len</u> characters is put
       in <u>cell</u>.

       <b>k_pioctl</b>()  does  a  <b>pioctl</b>()  system  call  with the specified arguments. This function is equivalent to
       <b>lpioctl</b>().

       <b>k_setpag</b>() initializes a new PAG.

       <b>k_unlog</b>() removes destroys all tokens in the current PAG.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>k_hasafs</b>() returns 1 if AFS is present in the kernel, 0  otherwise.   <b>krb_afslog</b>()  and  <b>krb_afslog_uid</b>()
       returns  0  on  success,  or  a  Kerberos  error  number  on  failure.  <b>k_afs_cell_of_file</b>(), <b>k_pioctl</b>(),
       <b>k_setpag</b>(), and <b>k_unlog</b>() all return the value of the underlaying system call, 0 on success.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       The following environment variable affect the mode of operation of <b>kafs</b>:

       AFS_SYSCALL  Normally, <b>kafs</b> will try to figure out the correct system call(s) that are  used  by  AFS  by
                    itself.  If it does not manage to do that, or does it incorrectly, you can set this variable
                    to the system call number or list of system call numbers that should be used.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  following  code  from  <b>login</b> will obtain a new PAG and tokens for the local cell and the cell of the
       users home directory.

       if (k_hasafs()) {
               char cell[64];
               k_setpag();
               if(k_afs_cell_of_file(pwd-&gt;pw_dir, cell, sizeof(cell)) == 0)
                       krb_afslog(cell, NULL);
               krb_afslog(NULL, NULL);
       }

</pre><h4><b>ERRORS</b></h4><pre>
       If any of these functions (apart from <b>k_hasafs</b>()) is called without AFS being present in the kernel,  the
       process will usually (depending on the operating system) receive a SIGSYS signal.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man3/krb5_appdefault.3.html">krb5_appdefault</a></u>(3), <u><a href="../man5/krb5.conf.5.html">krb5.conf</a></u>(5)

       Transarc Corporation, “File Server/Cache Manager Interface”, <u>AFS-3</u> <u>Programmer's</u> <u>Reference</u>, 1991.

</pre><h4><b>FILES</b></h4><pre>
       libkafs  will search for <u>ThisCell</u> <u>and</u> <u>TheseCells</u> in the following locations: <u>/usr/vice/etc</u>, <u>/etc/openafs</u>,
       <u>/var/db/openafs/etc</u>, <u>/usr/arla/etc</u>, <u>/etc/arla</u>, and <u>/etc/afs</u>

</pre><h4><b>BUGS</b></h4><pre>
       AFS_SYSCALL has no effect under AIX.

HEIMDAL                                            May 1, 2006                                           <u><a href="../man3/KAFS.3.html">KAFS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>