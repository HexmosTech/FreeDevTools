<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIO_s_datagram, BIO_new_dgram, BIO_ctrl_dgram_connect, BIO_ctrl_set_connected, BIO_dgram_recv_timedout,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libssl-doc">libssl-doc_3.5.0-2ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       BIO_s_datagram, BIO_new_dgram, BIO_ctrl_dgram_connect, BIO_ctrl_set_connected, BIO_dgram_recv_timedout,
       BIO_dgram_send_timedout, BIO_dgram_get_peer, BIO_dgram_set_peer, BIO_dgram_detect_peer_addr,
       BIO_dgram_get_mtu_overhead - Network BIO with datagram semantics

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;openssl/bio.h&gt;

        BIO_METHOD *BIO_s_datagram(void);
        BIO *BIO_new_dgram(int fd, int close_flag);

        int BIO_ctrl_dgram_connect(BIO *bio, const BIO_ADDR *peer);
        int BIO_ctrl_set_connected(BIO *bio, const BIO_ADDR *peer);
        int BIO_dgram_recv_timedout(BIO *bio);
        int BIO_dgram_send_timedout(BIO *bio);
        int BIO_dgram_get_peer(BIO *bio, BIO_ADDR *peer);
        int BIO_dgram_set_peer(BIO *bio, const BIO_ADDR *peer);
        int BIO_dgram_get_mtu_overhead(BIO *bio);
        int BIO_dgram_detect_peer_addr(BIO *bio, BIO_ADDR *peer);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>BIO_s_datagram()</b> is a BIO implementation designed for use with network sockets which provide datagram
       semantics, such as UDP sockets. It is suitable for use with DTLSv1 or QUIC.

       Because <b>BIO_s_datagram()</b> has datagram semantics, a single <b>BIO_write()</b> call sends a single datagram and a
       single <b>BIO_read()</b> call receives a single datagram. If the size of the buffer passed to <b>BIO_read()</b> is
       inadequate, the datagram is silently truncated.

       For a memory-based BIO which provides datagram semantics identical to those of <b>BIO_s_datagram()</b>, see
       <b><a href="../man3/BIO_s_dgram_pair.3.html">BIO_s_dgram_pair</a></b>(3).

       This BIO supports the <b><a href="../man3/BIO_sendmmsg.3.html">BIO_sendmmsg</a></b>(3) and <b><a href="../man3/BIO_recvmmsg.3.html">BIO_recvmmsg</a></b>(3) functions.

       When using <b>BIO_s_datagram()</b>, it is important to note that:

       •   This  BIO  can be used with either a connected or unconnected network socket. A connected socket is a
           network socket which has had <b><a href="../man3/BIO_connect.3.html">BIO_connect</a></b>(3) or a similar OS-specific function called on  it.  Such  a
           socket  can only receive datagrams from the specified peer. Any other socket is an unconnected socket
           and can receive datagrams from any host.

       •   Despite their naming, neither <b>BIO_ctrl_dgram_connect()</b> nor <b>BIO_ctrl_set_connected()</b> cause a socket to
           become connected. These controls are provided to indicate to the BIO how  the  underlying  socket  is
           configured and how it is to be used; see below.

       •   Use  of  <b>BIO_s_datagram()</b> with an unconnected network socket is hazardous hecause any successful call
           to <b>BIO_read()</b> results in the peer address used for any subsequent call to <b>BIO_write()</b>  being  set  to
           the source address of the datagram received by that call to <b>BIO_read()</b>. Thus, unless the caller calls
           <b>BIO_dgram_set_peer()</b>  immediately  prior to every call to <b>BIO_write()</b>, or never calls <b>BIO_read()</b>, any
           host on the network may cause future datagrams written to be redirected to that host.  Therefore,  it
           is  recommended  that  users  either  use  <b>BIO_s_dgram()</b>  only  with a connected socket, or, if using
           <b>BIO_s_dgram()</b> with an unconnected socket, to use the <b><a href="../man3/BIO_sendmmsg.3.html">BIO_sendmmsg</a></b>(3) and <b><a href="../man3/BIO_recvmmsg.3.html">BIO_recvmmsg</a></b>(3) methods only
           and forego use of <b><a href="../man3/BIO_read.3.html">BIO_read</a></b>(3) and <b><a href="../man3/BIO_write.3.html">BIO_write</a></b>(3). An exception is where <b><a href="../man3/DTLSv1_listen.3.html">DTLSv1_listen</a></b>(3) must be  used;
           see <b><a href="../man3/DTLSv1_listen.3.html">DTLSv1_listen</a></b>(3) for further discussion.

       •   Unlike  <b><a href="../man3/BIO_read.3.html">BIO_read</a></b>(3)  and  <b><a href="../man3/BIO_write.3.html">BIO_write</a></b>(3), the <b><a href="../man3/BIO_sendmmsg.3.html">BIO_sendmmsg</a></b>(3) and <b><a href="../man3/BIO_recvmmsg.3.html">BIO_recvmmsg</a></b>(3) methods are stateless
           and do not cause the internal state of the <b>BIO_s_datagram()</b> to change.

       Various controls are available for configuring the <b>BIO_s_datagram()</b> using <b><a href="../man3/BIO_ctrl.3.html">BIO_ctrl</a></b>(3):

       BIO_ctrl_dgram_connect (BIO_CTRL_DGRAM_CONNECT)
           This is equivalent to calling <b><a href="../man3/BIO_dgram_set_peer.3.html">BIO_dgram_set_peer</a></b>(3).

           Despite its name, this function does not cause the underlying socket to become connected.

       BIO_ctrl_set_connected (BIO_CTRL_SET_CONNECTED)
           This informs the <b>BIO_s_datagram()</b> whether the underlying socket has been connected, and therefore how
           the <b>BIO_s_datagram()</b> should attempt to use the socket.

           If the <u>peer</u> argument is non-NULL, <b>BIO_s_datagram()</b>  assumes  that  the  underlying  socket  has  been
           connected  and  will attempt to use the socket using OS APIs which do not specify peer addresses (for
           example, <b><a href="../man3/send.3.html">send</a></b>(3) and <b><a href="../man3/recv.3.html">recv</a></b>(3) or similar). The <u>peer</u> argument should specify the peer address to  which
           the socket is connected.

           If  the  <u>peer</u>  argument is NULL, <b>BIO_s_datagram()</b> assumes that the underlying socket is not connected
           and will attempt to use the socket using an OS  APIs  which  specify  peer  addresses  (for  example,
           <b><a href="../man3/sendto.3.html">sendto</a></b>(3) and <b><a href="../man3/recvfrom.3.html">recvfrom</a></b>(3)).

           This control does not affect the operation of <b><a href="../man3/BIO_sendmmsg.3.html">BIO_sendmmsg</a></b>(3) or <b><a href="../man3/BIO_recvmmsg.3.html">BIO_recvmmsg</a></b>(3).

       BIO_dgram_get_peer (BIO_CTRL_DGRAM_GET_PEER)
           This  outputs  a  <b>BIO_ADDR</b>  which  specifies  one  of  the  following values, whichever happened most
           recently:

           •   The   peer   address   last   passed   to   <b>BIO_dgram_set_peer()</b>,   <b>BIO_ctrl_dgram_connect()</b>   or
               <b>BIO_ctrl_set_connected()</b>.

           •   The peer address of the datagram last received by a call to <b>BIO_read()</b>.

       BIO_dgram_set_peer (BIO_CTRL_DGRAM_SET_PEER)
           Sets the peer address to be used for subsequent writes to this BIO.

           Warning:  When used with an unconnected network socket, the value set may be modified by future calls
           to <b><a href="../man3/BIO_read.3.html">BIO_read</a></b>(3), making use of <b>BIO_s_datagram()</b> hazardous when used with unconnected network  sockets;
           see above.

           This does not affect the operation of <b><a href="../man3/BIO_sendmmsg.3.html">BIO_sendmmsg</a></b>(3).  <b><a href="../man3/BIO_recvmmsg.3.html">BIO_recvmmsg</a></b>(3) does not affect the value set
           by <b>BIO_dgram_set_peer()</b>.

       BIO_dgram_detect_peer_addr (BIO_CTRL_DGRAM_DETECT_PEER_ADDR)
           This  is  similar to <b>BIO_dgram_get_peer()</b> except that if the peer address has not been set on the BIO
           object, an OS call such as <b><a href="../man2/getpeername.2.html">getpeername</a></b>(2) will be attempted to try and autodetect the peer address to
           which the underlying socket is connected. Other BIOs may also implement  this  control  if  they  are
           capable  of  sensing  a  peer address, without necessarily also implementing <b>BIO_dgram_set_peer()</b> and
           <b>BIO_dgram_get_peer()</b>.

       BIO_dgram_recv_timeout (BIO_CTRL_DGRAM_GET_RECV_TIMER_EXP)
           Returns 1 if the last I/O operation performed on the BIO (for example, via a call to <b><a href="../man3/BIO_read.3.html">BIO_read</a></b>(3)) may
           have been caused by a receive timeout.

       BIO_dgram_send_timedout (BIO_CTRL_DGRAM_GET_SEND_TIMER_EXP)
           Returns 1 if the last I/O operation performed on the BIO (for example, via a  call  to  <b><a href="../man3/BIO_write.3.html">BIO_write</a></b>(3))
           may have been caused by a send timeout.

       BIO_dgram_get_mtu_overhead (BIO_CTRL_DGRAM_GET_MTU_OVERHEAD)
           Returns a quantity in bytes which is a rough estimate of the number of bytes of overhead which should
           typically  be  added  to  a  datagram payload size in order to estimate the final size of the Layer 3
           (e.g. IP) packet which will contain the datagram. In most cases, the maximum  datagram  payload  size
           which  can  be transmitted can be determined by determining the link MTU in bytes and subtracting the
           value returned by this call.

           The value returned by this call depends on the network layer protocol being used.

           The value returned is not fully reliable because datagram overheads can be higher in atypical network
           configurations, for example where IPv6 extension headers or IPv4 options are used.

       BIO_CTRL_DGRAM_SET_DONT_FRAG
           If <u>num</u> is nonzero, configures the underlying network socket to enable Don't Fragment mode,  in  which
           datagrams will be set with the IP Don't Fragment (DF) bit set. If <u>num</u> is zero, Don't Fragment mode is
           disabled.

       BIO_CTRL_DGRAM_QUERY_MTU
           Queries the OS for its assessment of the Path MTU for the destination to which the underlying network
           socket, and returns that Path MTU in bytes. This control can only be used with a connected socket.

           This  is  not  supported  on  all  platforms  and depends on OS support being available. Returns 0 on
           failure.

       BIO_CTRL_DGRAM_MTU_DISCOVER
           This control requests that Path MTU discovery be enabled on the underlying network socket.

       BIO_CTRL_DGRAM_GET_FALLBACK_MTU
           Returns the estimated minimum size of datagram payload which should always be supported on  the  BIO.
           This  size  is  determined  by  the minimum MTU required to be supported by the applicable underlying
           network layer. Use of datagrams of this size may  lead  to  suboptimal  performance,  but  should  be
           routable  in all circumstances. The value returned is the datagram payload size in bytes and does not
           include the size of layer 3 or layer 4 protocol headers.

       BIO_CTRL_DGRAM_MTU_EXCEEDED
           Returns 1 if the last attempted write to the BIO failed due  to  the  size  of  the  attempted  write
           exceeding the applicable MTU.

       BIO_CTRL_DGRAM_SET_NEXT_TIMEOUT
           Accepts  a  pointer  to  a  <b>struct</b> <b>timeval</b>. If the time specified is zero, disables receive timeouts.
           Otherwise, configures the specified time interval as the receive  timeout  for  the  socket  for  the
           purposes of future <b><a href="../man3/BIO_read.3.html">BIO_read</a></b>(3) calls.

       BIO_CTRL_DGRAM_SET_PEEK_MODE
           If  <b>num</b>  is  nonzero,  enables  peek mode; otherwise, disables peek mode. Where peek mode is enabled,
           calls to <b><a href="../man3/BIO_read.3.html">BIO_read</a></b>(3) read datagrams from the underlying network socket in peek mode, meaning  that  a
           future call to <b><a href="../man3/BIO_read.3.html">BIO_read</a></b>(3) will yield the same datagram until peek mode is disabled.

           <b><a href="../man3/BIO_recvmmsg.3.html">BIO_recvmmsg</a></b>(3) is not affected by this control.

       <b>BIO_new_dgram()</b>  is  a  helper function which instantiates a <b>BIO_s_datagram()</b> and sets the BIO to use the
       socket given in <u>fd</u> by calling <b>BIO_set_fd()</b>.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>BIO_s_datagram()</b> returns a BIO method.

       <b>BIO_new_dgram()</b> returns a BIO on success and NULL on failure.

       <b>BIO_ctrl_dgram_connect()</b>, <b>BIO_ctrl_set_connected()</b> and <b>BIO_dgram_set_peer()</b> return 1 on success and 0  on
       failure.

       <b>BIO_dgram_get_peer()</b> and <b>BIO_dgram_detect_peer_addr()</b> return 0 on failure and the number of bytes for the
       outputted address representation (a positive value) on success.

       <b>BIO_dgram_recv_timedout()</b>  and <b>BIO_dgram_send_timedout()</b> return 0 or 1 depending on the circumstance; see
       discussion above.

       <b>BIO_dgram_get_mtu_overhead()</b> returns a value in bytes.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/BIO_sendmmsg.3.html">BIO_sendmmsg</a></b>(3), <b><a href="../man3/BIO_s_dgram_pair.3.html">BIO_s_dgram_pair</a></b>(3), <b><a href="../man3/DTLSv1_listen.3.html">DTLSv1_listen</a></b>(3), <b><a href="../man7/bio.7.html">bio</a></b>(7)

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2022-2023 The OpenSSL Project Authors. All Rights Reserved.

       Licensed under the Apache License 2.0 (the "License").  You may not use this file  except  in  compliance
       with  the  License.   You  can  obtain  a  copy  in  the  file  LICENSE  in the source distribution or at
       &lt;https://www.openssl.org/source/license.html&gt;.

3.5.0                                              2025-06-04                               <u><a href="../man3SSL/BIO_S_DATAGRAM.3SSL.html">BIO_S_DATAGRAM</a></u>(3SSL)
</pre>
 </div>
</div></section>
</div>
</body>
</html>