<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deprecated      since      version      1.11.0:     Use     mongoc_collection_count_documents()     or</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmongoc-doc">libmongoc-doc_1.30.4-1ubuntu1_all</a> <br><br><pre>
</pre><h4><b>WARNING:</b></h4><pre>
          Deprecated      since      version      1.11.0:     Use     <u>mongoc_collection_count_documents()</u>     or
          <u>mongoc_collection_estimated_document_count()</u> instead.

          <u>mongoc_collection_count_documents()</u> has similar performance to calling <u>mongoc_collection_count()</u>  with
          a  non-NULL  <b>query</b>,  and  is  guaranteed  to retrieve an accurate collection count. See <u>migrating</u> <u>from</u>
          <u>deprecated</u> <u>count</u> <u>functions</u> for details.

          <u>mongoc_collection_estimated_document_count()</u>    has    the     same     performance     as     calling
          <u>mongoc_collection_count()</u>  with a NULL <b>query</b>, but is not guaranteed to retrieve an accurate collection
          count.

</pre><h4><b>SYNOPSIS</b></h4><pre>
          int64_t
          mongoc_collection_count_with_opts (mongoc_collection_t *collection,
                                             mongoc_query_flags_t flags,
                                             const bson_t *query,
                                             int64_t skip,
                                             int64_t limit,
                                             const bson_t *opts,
                                             const mongoc_read_prefs_t *read_prefs,
                                             bson_error_t *error);

</pre><h4><b>PARAMETERS</b></h4><pre>
       • <b>collection</b>: A <u>mongoc_collection_t</u>.

       • <b>flags</b>: A <u>mongoc_query_flags_t</u>.

       • <b>query</b>: A <u>bson_t</u> containing the query.

       • <b>skip</b>: A int64_t, zero to ignore.

       • <b>limit</b>: A int64_t, zero to ignore.

       • <b>opts</b>: A <u>bson_t</u>, <b>NULL</b> to ignore.

       • <b>read_prefs</b>: An optional <u>mongoc_read_prefs_t</u>, otherwise uses the collection's read preference.

       • <b>error</b>: An optional location for a <u>bson_error_t</u> or <b>NULL</b>.

       <b>opts</b> may be NULL or a BSON document with additional command options:

       • <b>readConcern</b>: Construct a <u>mongoc_read_concern_t</u> and use <u>mongoc_read_concern_append()</u>  to  add  the  read
         concern to <b>opts</b>. See the example code for <u>mongoc_client_read_command_with_opts()</u>. Read concern requires
         MongoDB 3.2 or later, otherwise an error is returned.

       • <b>sessionId</b>: First, construct a <u>mongoc_client_session_t</u> with <u>mongoc_client_start_session()</u>. You can begin
         a     transaction     with     <u>mongoc_client_session_start_transaction()</u>,     optionally     with     a
         <u>mongoc_transaction_opt_t</u>  that   overrides   the   options   inherited   from   <b>collection</b>,   and   use
         <u>mongoc_client_session_append()</u>   to   add   the   session   to   <b>opts</b>.   See   the   example  code  for
         <u>mongoc_client_session_t</u>.

       • <b>collation</b>: Configure textual comparisons. See <u>Setting</u> <u>Collation</u> <u>Order</u>, and <u>the</u> <u>MongoDB</u> <u>Manual</u> <u>entry</u>  <u>on</u>
         <u>Collation</u>. Collation requires MongoDB 3.2 or later, otherwise an error is returned.

       • <b>serverId</b>:  To  target  a  specific  server, include an int32 "serverId" field. Obtain the id by calling
         <u>mongoc_client_select_server()</u>, then <u>mongoc_server_description_id()</u> on its return value.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This function shall execute a count query on  the  underlying  'collection'.  The  bson  'query'  is  not
       validated, simply passed along as appropriate to the server.  As such, compatibility and errors should be
       validated in the appropriate server documentation.

       The  <u>mongoc_read_concern_t</u>  specified  on  the <u>mongoc_collection_t</u> will be used, if any. If <b>read_prefs</b> is
       NULL, the collection's read preferences are used.

       In addition to the standard functionality available from mongoc_collection_count,  this  function  allows
       the  user  to  add arbitrary extra keys to the count.  This pass through enables features such as hinting
       for counts.

       For more information, see the <u>query</u> <u>reference</u> at the MongoDB website.

       This function is considered a retryable read operation.  Upon a transient error (a network error,  errors
       due  to  replica set failover, etc.) the operation is safely retried once.  If <b>retryreads</b> is false in the
       URI (see <u>mongoc_uri_t</u>) the retry behavior does not apply.

</pre><h4><b>ERRORS</b></h4><pre>
       Errors are propagated via the <b>error</b> parameter.

</pre><h4><b>RETURNS</b></h4><pre>
       -1 on failure, otherwise the number of documents counted.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Basic Counting

          #include &lt;bson/bson.h&gt;
          #include &lt;mongoc/mongoc.h&gt;
          #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;

          static void
          print_query_count (mongoc_collection_t *collection, bson_t *query)
          {
             bson_error_t error;
             int64_t count;
             bson_t opts;

             bson_init (&amp;opts);
             BSON_APPEND_UTF8 (&amp;opts, "hint", "_id_");

             count = mongoc_collection_count_with_opts (
                collection, MONGOC_QUERY_NONE, query, 0, 0, &amp;opts, NULL, &amp;error);

             bson_destroy (&amp;opts);

             if (count &lt; 0) {
                fprintf (stderr, "Count failed: %s\n", error.message);
             } else {
                printf ("%" PRId64 " documents counted.\n", count);
             }
          }

       Counting with Collation

          #include &lt;bson/bson.h&gt;
          #include &lt;mongoc/mongoc.h&gt;
          #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;

          static void
          print_query_count (mongoc_collection_t *collection, bson_t *query)
          {
             bson_t *selector;
             bson_t *opts;
             bson_error_t error;
             int64_t count;

             selector = BCON_NEW ("_id", "{", "$gt", BCON_UTF8 ("one"), "}");

             /* "One" normally sorts before "one"; make "one" come first */
             opts = BCON_NEW ("collation",
                              "{",
                              "locale",
                              BCON_UTF8 ("en_US"),
                              "caseFirst",
                              BCON_UTF8 ("lower"),
                              "}");

             count = mongoc_collection_count_with_opts (
                collection, MONGOC_QUERY_NONE, query, 0, 0, opts, NULL, &amp;error);

             bson_destroy (selector);
             bson_destroy (opts);

             if (count &lt; 0) {
                fprintf (stderr, "Count failed: %s\n", error.message);
             } else {
                printf ("%" PRId64 " documents counted.\n", count);
             }
          }

</pre><h4><b>AUTHOR</b></h4><pre>
       MongoDB, Inc

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2009-present, MongoDB, Inc.

1.30.4                                            Jun 08, 2025              <u><a href="../man3/MONGOC_COLLECTION_COUNT_WITH_OPTS.3.html">MONGOC_COLLECTION_COUNT_WITH_OPTS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>