<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UR::Context::Transaction - API for software transactions</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libur-perl">libur-perl_0.470+ds-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       UR::Context::Transaction - API for software transactions

</pre><h4><b>SYNOPSIS</b></h4><pre>
         my $o = Some::Obj-&gt;create(foo =&gt; 1);
         print "o's foo is ",$o-&gt;foo,"\n";  # prints 1

         my $t = UR::Context::Transaction-&gt;begin();

         $o-&gt;<a href="../man4/foo.4.html">foo</a>(4);

         print "In transaction, o's foo is ",$o-&gt;foo,"\n";  # prints 4

         if (&amp;should_we_commit()) {
             $t-&gt;commit();
             print "Transaction committed, o's foo is ",$o-&gt;foo,"\n";  # prints 4

         } else {
             $t-&gt;rollback();
             print "Transaction rollback, o's foo is ",$o-&gt;foo,"\n";  # prints 1
         }

</pre><h4><b>DESCRIPTION</b></h4><pre>
       UR::Context::Transaction instances represent in-memory transactions as a diff of the contents of the
       object cache in the Process context.  Transactions are nestable.  Their instances exist in the object
       cache and  are subject to the same scoping rules as other UR-based objects, meaning that they do not
       disappear mearly because the lexical variable they're assigned to goes out of scope.  They must be
       explicitly disposed of via the commit or rollback methods.

</pre><h4><b>INHERITANCE</b></h4><pre>
       UR::Context::Transaction is a subclass of UR::Context

</pre><h4><b>CONSTRUCTOR</b></h4><pre>
       begin
             $t = UR::Context::Transaction-&gt;begin();

           Creates  a new software transaction context to track changes to UR-based objects.  As all activity to
           objects occurs in some kind of transaction context,  the  newly  created  transaction  exists  within
           whatever context was current before the call to <b>begin()</b>.

             $t = UR::Context::Transaction-&gt;begin(commit_validator =&gt; sub { ... });

           A  validation function may be assigned with the "commit_validator" property.  When the transaction is
           committed, this function is called.  The commit proceeds if this function returns a true value.   The
           default  function, "changes_can_be_saved" requires that all objects changed within the transaction be
           valid, ie. that "$obj-"__errors__()&gt; returns an empty list.  The validation function  is  passed  one
           argument: the transaction object being committed.

</pre><h4><b>METHODS</b></h4><pre>
       commit
             $t-&gt;commit();

           Causes all objects with changes to save those changes back to the underlying context.

           If  the  validation  function  (specified  with the "commit_validator" param when the transaction was
           created with begin()) returns false, the changes are  not  committed  to  the  encompassing  context,
           commit() returns false and this transaction remains in effect.

           Returns  true  if  all  the  transaction's  changes  are committed to the encompassing Context.  This
           transaction object then becomes invalid, and its state will be 'committed'.

       rollback
             $t-&gt;rollback();

           Causes all objects with changes to have those changes reverted to their state  when  the  transaction
           began.   Classes  with  properties whose meta-property is_transactional =&gt; 0 are not tracked within a
           transaction and will not be reverted.

           After rollback(), this transaction becomes invalid, and the object will become a UR::DeletedRef.

       delete
             $t-&gt;delete();

           <b>delete()</b> is a synomym for rollback

       has_changes
             $bool = $t-&gt;has_changes();

           Returns true if any UR-based objects have changes within the transaction.

       get_changes
             @changes = $t-&gt;get_changes();

           Return a list or UR::Change objects representing changes within the transaction.

</pre><h4><b>CLASS</b> <b>METHODS</b></h4><pre>
       eval
             UR::Context::Transaction::eval BLOCK

           Executes the BLOCK (with no arguments) wrapped by a software transaction and a  CORE::eval.   If  the
           BLOCK dies then the exception is caught and the software transaction is rolled back.

       do
             UR::Context::Transaction::do BLOCK

           Executes  the  BLOCK  (with no arguments) wrapped by a software transaction and a CORE::eval.  If the
           BLOCK returns a true value and does not die then the software transaction is committed.  If the BLOCK
           returns false or dies then the software transaction is rolled back.

           If the BLOCK throws an exception, it will be caught, the software transaction rolled  back,  and  the
           exception will be re-thrown with <b>die()</b>.

</pre><h4><b>EXPORTS</b></h4><pre>
       This   module   can   export   constants   that   match   the  valid  values  of  the  "state"  property:
       TRANSACTION_STATE_OPEN and TRANSACTION_STATE_COMMITTED

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       UR::Context

perl v5.38.2                                       2024-06-15                      <u>UR::Context::<a href="../man3pm/Transaction.3pm.html">Transaction</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>