<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmNewContext - establish a new PMAPI context</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libpcp3-dev">libpcp3-dev_6.3.8-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmNewContext</b> - establish a new PMAPI context

</pre><h4><b>C</b> <b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;pcp/pmapi.h&gt;</b>

       <b>int</b> <b>pmNewContext(int</b> <u>type</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>name</u><b>);</b>

       <b>cc</b> <b>...</b> <b>-lpcp</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       An  application  using  the  Performance Metrics Application Programming Interface (PMAPI) may manipulate
       several concurrent contexts, each associated with a source of performance metrics, e.g. <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  on  some
       host,  or a set of archives of performance metrics as created by <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1), or a stand-alone connection
       on the local host that does not involve <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1).

       <b>pmNewContext</b> may be used to establish a new context.  The source of the metrics is  identified  by  <u>name</u>,
       and  may be either a host name (<u>type</u> is <b>PM_CONTEXT_HOST</b>), or a comma-separated list of names referring to
       a set of archives (<u>type</u> is <b>PM_CONTEXT_ARCHIVE</b>).  Each element of the list may either  be  the  base  name
       common to all of the physical files of an archive or the name of a directory containing archives.

       For  a  <u>type</u>  of  <b>PM_CONTEXT_HOST</b>,  in addition to identifying a host the <u>name</u> may also be used to encode
       additional optional information in the form of a <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) port number, a <b><a href="../man1/pmproxy.1.html">pmproxy</a></b>(1) hostname and  a  proxy
       port number. For example the <u>name</u> "app23:14321,<a href="mailto:4321@firewall.example.com">4321@firewall.example.com</a>:11111" specifies a connection on
       port  <u>14321</u>  (or  port  <u>4321</u>  if  <u>14321</u>  is  unavailable)  to <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) on the host <u>app23</u> via port <u>11111</u> to
       <b><a href="../man1/pmproxy.1.html">pmproxy</a></b>(1) on the host <u>firewall.example.com</u>.

       Alternatively, for a <u>type</u> of <b>PM_CONTEXT_HOST</b>, <u>name</u> may be <b>unix:</b> for an authenticated Unix  domain  socket
       connection  to  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  on  the  localhost  or  <b>local:</b> for an authenticated connection to <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) on the
       localhost via a Unix domain socket if available, else via an internet  socket  connection  to  <b>localhost</b>.
       <b>local:</b>  is  the default choice for most applications when calling <b>pmNewContext</b> to establish a context for
       <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) on the local host.

       For a <u>type</u> of <b>PM_CONTEXT_ARCHIVE</b>, each element of the list of names in <u>name</u> may also be the name  of  any
       of  the  physical  files  of an archive, e.g.  <u>myarchive</u><b>.meta</b> (the metadata file) or <u>myarchive</u><b>.index</b> (the
       temporal  index)  or  <u>myarchive</u><b>.0</b>  (the  first  data  volume  of  the  archive)  or  <u>myarchive</u><b>.0.bz2</b>   or
       <u>myarchive</u><b>.0.bz</b>  (the  first  data  volume compressed with <b><a href="../man1/bzip2.1.html">bzip2</a></b>(1)) or <u>myarchive</u><b>.0.gz</b> or <u>myarchive</u><b>.0.Z</b> or
       <u>myarchive</u><b>.0.z</b> (the first  data  volume  compressed  with  <b><a href="../man1/gzip.1.html">gzip</a></b>(1)),  <u>myarchive</u><b>.1</b>  or  <u>myarchive</u><b>.3.bz2</b>  or
       <u>myarchive</u><b>.42.gz</b> etc.

       If  more  than  one archive is specified for a <u>type</u> of <b>PM_CONTEXT_ARCHIVE</b>, there are some restrictions on
       the archives within the set:
       •  The archives must all have been generated on the same host.
       •  The archives must not overlap in time.
       •  The archives must all have been created using the same time zone.
       •  The <u>PMID</u> of each metric should be the same in all of  the  archives.   Multiple  <u>PMID</u>s  are  currently
          tolerated by using the first <u>PMID</u> defined for each metric and ignoring subsequent <u>PMID</u>s.
       •  The type of each metric must be the same in all of the archives.
       •  The semantics of each metric must be the same in all of the archives.
       •  The units of each metric must be the same in all of the archives.
       •  The instance domain of each metric must be the same in all of the archives.

       In  the  case  where  <u>type</u>  is  <b>PM_CONTEXT_LOCAL</b>,  <u>name</u>  is  ignored,  and the context uses a stand-alone
       connection to the PMDA methods used by <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1).  The mechanism in the library uses  the  same  ``plugin''
       architecture  that  operates  between  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) and DSO PMDAs, so operations involve function calls rather
       than IPC message passing - for <b>PM_CONTEXT_LOCAL</b> contexts this may mean lower latency for operations  like
       <b><a href="../man3/pmFetch.3.html">pmFetch</a></b>(3),  but  at  the  cost  of  longer  initialization  time and possible access control differences
       compared to <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1).  When this type of context is used, the range of accessible performance  metrics  is
       constrained   to   those   from   the   DSO   PMDAs   defined   in   the   <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)   configuration   file
       <b>/etc/pcp/pmcd/pmcd.conf</b>, so those reported by the command
               $ awk '$3 == "dso" {print}' /etc/pcp/pmcd/pmcd.conf
       or alternatively reported by the command
               $ pminfo -f pmcd.agent.type | grep 'value 0'
       This usually means the PMDA exporting metrics from the operating system and the ``pmcd'', ``pmproxy'' and
       may includes some others like ``mmv''.  Alternate DSO PMDAs can be used, refer to <b><a href="../man3/pmSpecLocalPMDA.3.html">pmSpecLocalPMDA</a></b>(3).

       In the case where <u>type</u> is <b>PM_CONTEXT_HOST</b>, additional flags can be added to the <u>type</u> to indicate  if  the
       connection  to  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  should  be  encrypted  (<b>PM_CTXFLAG_SECURE</b>),  should  be  encrypted  if  possible
       (<b>PM_CTXFLAG_RELAXED</b>), is deferred  (<b>PM_CTXFLAG_SHALLOW</b>),  should  use  authentication  (<b>PM_CTXFLAG_AUTH</b>),
       should  be  a  connection  to  a  container  (<b>PM_CTXFLAG_CONTAINER</b>),  or  if  the file descriptor used to
       communicate with <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1),  should  not  be  shared  across  contexts  (<b>PM_CTXFLAG_EXCLUSIVE</b>).   Both  the
       <b>PM_CTXFLAG_SHALLOW</b> and <b>PM_CTXFLAG_EXCLUSIVE</b> flags are now deprecated and ignored.

       When <u>type</u> is <b>PM_CONTEXT_ARCHIVE</b>, additional flags can be added to the <u>type</u> for restricted handling of the
       archive   suited   to   applications   that   are   aware  of  the  structure  of  PCP  archives,  namely
       <b>PM_CTXFLAG_NO_FEATURE_CHECK</b>  (do  not  check  feature   compatibility   for   archive   label   records),
       <b>PM_CTXFLAG_METADATA_ONLY</b>   (open   only  the  metadata,  not  the  data  volume(s)  nor  the  index)  and
       <b>PM_CTXFLAG_LAST_VOLUME</b> (open the archive at the start of the <u>last</u> data volume,  instead  of  the  default
       start of the <u>first</u> data volume).

       Multiple flags can be specified by bit-wise ``or-ing'' of the <b>PM_CTXFLAG</b> macros, but not all combinations
       make    sense,    e.g.    if   <b>PM_CTXFLAG_METADATA_ONLY</b>   and   <b>PM_CTXFLAG_LAST_VOLUME</b>   are   specified,
       <b>PM_CTXFLAG_METADATA_ONLY</b> takes precedence.

       The initial instance profile is set up to select all instances in all instance domains.  In the case of a
       set of archives, the initial collection time is also set to zero, so  that  an  initial  <b><a href="../man3/pmFetch.3.html">pmFetch</a></b>(3)  will
       result in the earliest set of metrics being returned from the set of archives.

       Once  established, the association between a context and a source of metrics is fixed for the life of the
       context, however routines are provided  to  independently  manipulate  both  the  instance  profile  (see
       <b><a href="../man3/pmAddProfile.3.html">pmAddProfile</a></b>(3) and <b><a href="../man3/pmDelProfile.3.html">pmDelProfile</a></b>(3)) and the collection time for archives (see <b><a href="../man3/pmSetMode.3.html">pmSetMode</a></b>(3)).

       <b>pmNewContext</b> returns a handle that may be used with subsequent calls to <b><a href="../man3/pmUseContext.3.html">pmUseContext</a></b>(3).

       The  new  context  remains  the  current  PMAPI  context for all subsequent calls across the PMAPI, until
       another call to  <b><a href="../man3/pmNewContext.3.html">pmNewContext</a></b>(3)  is  made,  or  the  context  is  explicitly  changed  with  a  call  to
       <b><a href="../man3/pmDupContext.3.html">pmDupContext</a></b>(3) or <b><a href="../man3/pmUseContext.3.html">pmUseContext</a></b>(3), or destroyed using <b><a href="../man3/pmDestroyContext.3.html">pmDestroyContext</a></b>(3).

       When  attempting  to  connect  to  a  remote  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  on  a  machine that is booting, <b>pmNewContext</b> could
       potentially block for a long time until the remote machine  finishes  its  initialization.   <b>pmNewContext</b>
       will  abort  and return an error if the connection has not been established after some specified interval
       has elapsed.  The default interval is 5 seconds.  This may be modified by setting <b>PMCD_CONNECT_TIMEOUT</b> in
       the environment to a real number of seconds for the desired timeout.  This is most useful in cases  where
       the  remote  host is at the end of a slow network, requiring longer latencies to establish the connection
       correctly.

</pre><h4><b>CAVEATS</b></h4><pre>
       When using a <u>type</u> of <b>PM_CONTEXT_LOCAL</b>, the operating system PMDA may export data structures directly from
       the kernel, which means that the <b>pmNewContext</b> caller should be an executable  program  compiled  for  the
       same object code format as the booted kernel.

       In  addition,  applications  using a <b>PM_CONTEXT_LOCAL</b> context must be single-threaded because the various
       DSO PMDAs may not be thread-safe.  This restriction is enforced  at  the  <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3),  where  routines  may
       return the error code <b>PM_ERR_THREAD</b> if the library detects calls from more than one thread.

       Applications  that  use  <b><a href="../man3/gethostbyname.3.html">gethostbyname</a></b>(3)  should  exercise  caution  because the static fields in <u>struct</u>
       <u>hostent</u>  may  not  be  preserved  across  some  <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3)  calls.   In  particular,  <b><a href="../man3/pmNewContext.3.html">pmNewContext</a></b>(3)   and
       <b><a href="../man3/pmReconnectContext.3.html">pmReconnectContext</a></b>(3) both may call <b><a href="../man3/gethostbyname.3.html">gethostbyname</a></b>(3) internally.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       <b>PM_ERR_PERMISSION</b>

              No permission to perform requested operation

       <b>PM_ERR_CONNLIMIT</b>

              PMCD connection limit for this host exceeded

       <b>PM_ERR_NOCONTEXT</b>

              Requested context type was not <b>PM_CONTEXT_LOCAL</b>, <b>PM_CONTEXT_HOST</b> or <b>PM_CONTEXT_ARCHIVE</b>.

       <b>PM_ERR_LOGOVERLAP</b>

              Archives overlap in time

       <b>PM_ERR_LOGHOST</b>

              Archives differ by host

       <b>PM_ERR_LOGCHANGETYPE</b>

              The type of a metric differs among archives

       <b>PM_ERR_LOGCHANGESEM</b>

              The semantics of a metric differs among archives

       <b>PM_ERR_LOGCHANGEINDOM</b>

              The instance domain of a metric differs among archives

       <b>PM_ERR_LOGCHANGEUNITS</b>

              The units of a metric differs among archives

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       <b>PMCD_CONNECT_TIMEOUT</b>
              Timeout period (in seconds) for <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) connection attempts.

       <b>PMCD_PORT</b>
              TCP/IP  port(s)  for connecting to <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1), historically was 4321 and more recently the officially
              registered port 44321; in the current release, <b>pmcd</b> listens on both these ports as a  transitional
              arrangement.  If used, should be set to a comma-separated list of numerical port numbers.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1),   <b><a href="../man1/pminfo.1.html">pminfo</a></b>(1),   <b><a href="../man1/pmproxy.1.html">pmproxy</a></b>(1),   <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3),  <b><a href="../man3/pmAddProfile.3.html">pmAddProfile</a></b>(3),  <b><a href="../man3/pmDelProfile.3.html">pmDelProfile</a></b>(3),  <b><a href="../man3/pmDestroyContext.3.html">pmDestroyContext</a></b>(3),
       <b><a href="../man3/pmDupContext.3.html">pmDupContext</a></b>(3), <b><a href="../man3/pmFetch.3.html">pmFetch</a></b>(3),  <b><a href="../man3/pmGetConfig.3.html">pmGetConfig</a></b>(3),  <b><a href="../man3/pmReconnectContext.3.html">pmReconnectContext</a></b>(3),  <b><a href="../man3/pmSetMode.3.html">pmSetMode</a></b>(3),  <b><a href="../man3/pmSpecLocalPMDA.3.html">pmSpecLocalPMDA</a></b>(3),
       <b><a href="../man3/pmUseContext.3.html">pmUseContext</a></b>(3), <b><a href="../man3/pmWhichContext.3.html">pmWhichContext</a></b>(3), <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5) and <b><a href="../man5/pcp.env.5.html">pcp.env</a></b>(5).

Performance Co-Pilot                                   PCP                                       <u><a href="../man3/PMNEWCONTEXT.3.html">PMNEWCONTEXT</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>