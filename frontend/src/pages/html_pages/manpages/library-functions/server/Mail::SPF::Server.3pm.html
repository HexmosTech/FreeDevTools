<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mail::SPF::Server - Server class for processing SPF requests</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmail-spf-perl">libmail-spf-perl_3.20250505-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Mail::SPF::Server - Server class for processing SPF requests

</pre><h4><b>VERSION</b></h4><pre>
       version 3.20250505

</pre><h4><b>SYNOPSIS</b></h4><pre>
           use Mail::SPF;

           my $spf_server  = Mail::SPF::Server-&gt;new(
               # Optional custom default for authority explanation:
               default_authority_explanation =&gt;
                   'See <a href="http://www">http://www</a>.%{d}/why/id=%{S};ip=%{I};r=%{R}'
           );

           my $result      = $spf_server-&gt;process($request);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>Mail::SPF::Server</b> is a server class for processing SPF requests.  Each server instance can be configured
       with specific processing parameters.  Also, the default <u>Net::DNS::Resolver</u> DNS resolver used for making
       DNS look-ups can be overridden with a custom resolver object.

   <b>Constructor</b>
       The following constructor is provided:

       <b>new(%options)</b>: returns <u>Mail::SPF::Server</u>
           Creates a new server object for processing SPF requests.

           %options is a list of key/value pairs representing any of the following options:

           <b>default_authority_explanation</b>
               A  <u>string</u>  denoting  the  default (not macro-expanded) authority explanation string to use if the
               authority domain does not specify an explanation string of its own.  Defaults to:

                   'Rejected by SPF record.'

               As can be seen from the default, a non-standard "_scope" pseudo macro is supported  that  expands
               to  the  name  of the identity's scope.  (Note: Do <u>not</u> use any non-standard macros in explanation
               strings published in DNS.)

           <b>hostname</b>
               A <u>string</u> denoting the local system's fully qualified host name that should be used for  expanding
               the "r" macro in explanation strings.  Defaults to the system's configured host name.

           <b>dns_resolver</b>
               An  optional DNS resolver object.  If none is specified, a new <u>Net::DNS::Resolver</u> object is used.
               The resolver object may be of a different class, but it must  provide  an  interface  similar  to
               <u>Net::DNS::Resolver</u>  --  at  least the "send" and "errorstring" methods must be supported, and the
               "send" method must return either an object of class <u>Net::DNS::Packet</u>,  or,  in  the  case  of  an
               error, <b>undef</b>.

           <b>query_rr_types</b>
               For  which RR types to query when looking up and selecting SPF records.  The following values are
               supported:

               <b>Mail::SPF::Server-&gt;query_rr_type_all</b>
                   Both "TXT" and "SPF" type RRs.

               <b>Mail::SPF::Server-&gt;query_rr_type_txt</b> (default)
                   "TXT" type RRs only.

               <b>Mail::SPF::Server-&gt;query_rr_type_spf</b>
                   "SPF" type RRs only.

               For years <b>Mail::SPF</b> has defaulted to looking up both "SPF" and "TXT" type RRs as  recommended  by
               RFC  4408.  Experience has shown, however, that a significant portion of name servers suffer from
               serious brain damage with regard to the handling of queries for RR  types  that  are  unknown  to
               them,  such  as  the "SPF" RR type.  Consequently <b>Mail::SPF</b> now defaults to looking up only "TXT"
               type RRs.  This may be overridden by setting the <b>query_rr_types</b> option.

               See RFC 4408, 3.1.1, for  a  discussion  of  the  topic,  as  well  as  the  description  of  the
               "select_record" method.

           <b>max_dns_interactive_terms</b>
               An  <u>integer</u>  denoting  the  maximum number of terms (mechanisms and modifiers) per SPF check that
               perform DNS look-ups, as defined in RFC 4408, 10.1, paragraph 6.  If <b>undef</b> is specified, there is
               no limit on the number of such terms.  Defaults to <b>10</b>, which is the value defined in RFC 4408.

               A value above the default is <u>strongly</u> <u>discouraged</u>  for  security  reasons.   A  value  below  the
               default has implications with regard to the predictability of SPF results.  Only deviate from the
               default if you know what you are doing!

           <b>max_name_lookups_per_term</b>
               An  <u>integer</u> denoting the maximum number of DNS name look-ups per term (mechanism or modifier), as
               defined in RFC 4408, 10.1, paragraph 7.  If <b>undef</b> is specified, there is no limit on  the  number
               of look-ups performed.  Defaults to <b>10</b>, which is the value defined in RFC 4408.

               A  value  above  the  default  is  <u>strongly</u>  <u>discouraged</u> for security reasons.  A value below the
               default has implications with regard to the predictability of SPF results.  Only deviate from the
               default if you know what you are doing!

           <b>max_name_lookups_per_mx_mech</b>
           <b>max_name_lookups_per_ptr_mech</b>
               An <u>integer</u>  denoting  the  maximum  number  of  DNS  name  look-ups  per  <b>mx</b>  or  <b>ptr</b>  mechanism,
               respectively.   Defaults  to  the value of the "max_name_lookups_per_term" option.  See there for
               additional information and security notes.

           <b>max_void_dns_lookups</b>
               An <u>integer</u> denoting the maximum number of "void" DNS look-ups per SPF check, i.e. the  number  of
               DNS  look-ups that were caused by DNS-interactive terms and macros (as defined in RFC 4408, 10.1,
               paragraphs 6 and 7) and that are allowed to return an empty  answer  with  RCODE  0  or  RCODE  3
               ("NXDOMAIN")  before  processing  is  aborted  with a "permerror" result.  If <b>undef</b> is specified,
               there is no stricter limit on the number of void DNS look-ups beyond the usual processing limits.
               Defaults to <b>2</b>.

               Specifically, the DNS look-ups that are subject to this limit are those caused by the "a",  "mx",
               "ptr", and "exists" mechanisms and the "p" macro.

               A  value  of  <b>2</b>  is  likely  to prevent effective DoS attacks against third-party victim domains.
               However, a definite limit may cause  "permerror"  results  even  with  certain  (overly  complex)
               innocent sender policies where useful results would normally be returned.

   <b>Class</b> <b>methods</b>
       The following class methods are provided:

       <b>result_class</b>: returns <u>class</u>
       <b>result_class($name)</b>: returns <u>class</u>
           Returns  a  <u>Mail::SPF::Result</u> descendent class determined from the given result name via the server's
           inherent result base class, or returns the server's inherent result base class if no result  name  is
           given.  This method may also be used as an instance method.

           <u>Note</u>:   Do  not  write code invoking class methods on <u>literal</u> result class names as this would ignore
           any derivative result classes provided by <b>Mail::SPF</b> extension modules.

       <b>throw_result($name,</b> <b>$request)</b>: throws <u>Mail::SPF::Result</u>
       <b>throw_result($name,</b> <b>$request,</b> <b>$text)</b>: throws <u>Mail::SPF::Result</u>
           Throws a <u>Mail::SPF::Result</u> descendant determined from the given result name via the server's inherent
           result base class, passing an optional result  text  and  associating  the  given  <u>Mail::SPF::Request</u>
           object with the result object.  This method may also be used as an instance method.

           <u>Note</u>:   Do  not  write  code  invoking "throw" on <u>literal</u> result class names as this would ignore any
           derivative result classes provided by <b>Mail::SPF</b> extension modules.

   <b>Instance</b> <b>methods</b>
       The following instance methods are provided:

       <b>process($request)</b>: returns <u>Mail::SPF::Result</u>
           Processes the given <u>Mail::SPF::Request</u> object, queries the authoritative domain  for  an  SPF  sender
           policy  (see  the description of the "select_record" method), evaluates the policy with regard to the
           given identity and other request parameters, and returns  a  <u>Mail::SPF::Result</u>  object  denoting  the
           result of the policy evaluation.  See RFC 4408, 4, and RFC 4406, 4, for details.

       <b>select_record($request)</b>: returns <u>Mail::SPF::Record</u>; throws <u>Mail::SPF::EDNSError</u>,
       <u>Mail::SPF::ENoAcceptableRecord</u>, <u>Mail::SPF::ERedundantAcceptableRecords</u>, <u>Mail::SPF::ESyntaxError</u>
           Queries  the  authority  domain  of the given <u>Mail::SPF::Request</u> object for SPF sender policy records
           and, if multiple records are available, selects the record of the highest acceptable  record  version
           that covers the requested scope.

           More precisely, the following algorithm is performed (assuming that both "TXT" and "SPF" RR types are
           being queried):

           1.  Determine the authority domain, the set of acceptable SPF record versions, and the identity scope
               from the given request object.

           2.  Query  the authority domain for SPF records of the "SPF" DNS RR type, discarding any records that
               are of an inacceptable version or do not cover the desired scope.

               If this yields no SPF records, query the authority domain for SPF records of  the  "TXT"  DNS  RR
               type,  discarding  any  records  that  are of an inacceptable version or do not cover the desired
               scope.

               If still no acceptable  SPF  records  could  be  found,  throw  a  <u>Mail::SPF::ENoAcceptableRecord</u>
               exception.

           3.  Discard all records but those of the highest acceptable version found.

               If     exactly     one     record     remains,     return     it.      Otherwise,     throw     a
               <u>Mail::SPF::ERedundantAcceptableRecords</u> exception.

           If the querying of either RR type has been disabled  via  the  "new"  constructor's  "query_rr_types"
           option, the respective part in step 2 will be skipped.

           <u>Mail::SPF::EDNSError</u>  exceptions  due  to  DNS look-ups and <u>Mail::SPF::ESyntaxError</u> exceptions due to
           invalid acceptable records may also be thrown.

       <b>get_acceptable_records_from_packet($packet,</b> <b>$rr_type,</b> <b>\@versions,</b> <b>$scope,</b> <b>$domain)</b>: returns <u>list</u> of
       <u>Mail::SPF::Record</u>
           Filters from the given <u>Net::DNS::Packet</u> object all resource records of the given RR type and for  the
           given  domain  name,  discarding  any  records  that  are  not  SPF  records  at  all, that are of an
           inacceptable SPF record version, or that do not cover the given scope.  Returns a list of  acceptable
           records.

       <b>dns_lookup($domain,</b> <b>$rr_type)</b>: returns <u>Net::DNS::Packet</u>; throws <u>Mail::SPF::EDNSTimeout</u>,
       <u>Mail::SPF::EDNSError</u>
           Queries  the  DNS  using  the  configured  resolver  for  resource records of the desired type at the
           specified domain and returns a <u>Net::DNS::Packet</u> object if an answer packet was  received.   Throws  a
           <u>Mail::SPF::EDNSTimeout</u> exception if a DNS time-out occurred.  Throws a <u>Mail::SPF::EDNSError</u> exception
           if an error (other than RCODE 3 AKA "NXDOMAIN") occurred.

       <b>count_dns_interactive_term($request)</b>: throws <u>Mail::SPF::EProcessingLimitExceeded</u>
           Increments  by  one the count of DNS-interactive mechanisms and modifiers that have been processed so
           far during the evaluation of the given <u>Mail::SPF::Request</u> object.  If  this  exceeds  the  configured
           limit    (see    the    "new"    constructor's    "max_dns_interactive_terms"   option),   throws   a
           <u>Mail::SPF::EProcessingLimitExceeded</u> exception.

           This method is supposed to be called by the "match" and  "process"  methods  of  <u>Mail::SPF::Mech</u>  and
           <u>Mail::SPF::Mod</u> sub-classes before (and only if) they do any DNS look-ups.

       <b>count_void_dns_lookup($request)</b>: throws <u>Mail::SPF::EProcessingLimitExceeded</u>
           Increments by one the count of "void" DNS look-ups that have occurred so far during the evaluation of
           the  given  <u>Mail::SPF::Request</u>  object.   If  this  exceeds  the  configured  limit  (see  the  "new"
           constructor's "max_void_dns_lookups" option), throws a <u>Mail::SPF::EProcessingLimitExceeded</u> exception.

           This method is supposed to be called by any code after any calls to the "dns_lookup" method  whenever
           (i)  no  answer  records  were  returned, and (ii) this fact is a possible indication of a DoS attack
           against a third-party victim domain,  and  (iii)  the  number  of  "void"  look-ups  is  not  already
           constrained  otherwise  (as  for  example is the case with the "include" mechanism and the "redirect"
           modifier).  Specifically, this applies to look-ups performed by the "a", "mx",  "ptr",  and  "exists"
           mechanisms and the "p" macro.

       <b>default_authority_explanation</b>: returns <u>Mail::SPF::MacroString</u>
           Returns  the default authority explanation as a <u>MacroString</u> object.  See the description of the "new"
           constructor's "default_authority_explanation" option.

       <b>hostname</b>: returns <u>string</u>
           Returns the local system's host name.  See the description  of  the  "new"  constructor's  "hostname"
           option.

       <b>dns_resolver</b>: returns <u>Net::DNS::Resolver</u> or compatible object
           Returns the DNS resolver object of the server object.  See the description of the "new" constructor's
           "dns_resolver" option.

       <b>query_rr_types</b>: returns <u>integer</u>
           Returns  a  value denoting the RR types for which to query when looking up and selecting SPF records.
           See the description of the "new" constructor's "query_rr_types" option.

       <b>max_dns_interactive_terms</b>: returns <u>integer</u>
       <b>max_name_lookups_per_term</b>: returns <u>integer</u>
       <b>max_name_lookups_per_mx_mech</b>: returns <u>integer</u>
       <b>max_name_lookups_per_ptr_mech</b>: returns <u>integer</u>
       <b>max_void_dns_lookups</b>: returns <u>integer</u>
           Return the limit values of the server  object.   See  the  description  of  the  "new"  constructor's
           corresponding options.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Mail::SPF, Mail::SPF::Request, Mail::SPF::Result

       &lt;<a href="http://tools.ietf.org/html/rfc4408">http://tools.ietf.org/html/rfc4408</a>&gt;

       For availability, support, and license information, see the README file included with Mail::SPF.

</pre><h4><b>AUTHORS</b></h4><pre>
       Julian Mehnle &lt;<a href="mailto:julian@mehnle.net">julian@mehnle.net</a>&gt;, Shevek &lt;<a href="mailto:cpan@anarres.org">cpan@anarres.org</a>&gt;

perl v5.40.1                                       2025-05-10                             <u>Mail::SPF::<a href="../man3pm/Server.3pm.html">Server</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>