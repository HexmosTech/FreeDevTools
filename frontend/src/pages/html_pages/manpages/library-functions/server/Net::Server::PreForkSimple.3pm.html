<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Net::Server::PreForkSimple - Net::Server personality</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libnet-server-perl">libnet-server-perl_2.014-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Net::Server::PreForkSimple - Net::Server personality

</pre><h4><b>SYNOPSIS</b></h4><pre>
           use base qw(Net::Server::PreForkSimple);

           sub process_request {
               #...code...
           }

           __PACKAGE__-&gt;run();

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Please read the pod on Net::Server first.  This module is a personality, or extension, or sub class, of
       the Net::Server module.

       This personality binds to one or more ports and then forks "max_servers" child processes.  The server
       will make sure that at any given time there are always "max_servers" available to receive a client
       request.  Each of these children will process up to "max_requests" client connections.  This type is good
       for a heavily hit site that can keep "max_servers" processes dedicated to the serving.  (Multi port
       accept defaults to using flock to serialize the children).

       At this time, it does not appear that this module will pass tests on Win32 systems.  Any ideas or patches
       for making the tests pass would be welcome.

</pre><h4><b>SAMPLE</b> <b>CODE</b></h4><pre>
       Please see the sample listed in Net::Server.

</pre><h4><b>COMMAND</b> <b>LINE</b> <b>ARGUMENTS</b></h4><pre>
       In addition to the command line arguments of the Net::Server base class, Net::Server::PreFork contains
       several other configurable parameters.

           Key               Value                   Default
           max_servers       \d+                     50
           max_requests      \d+                     1000

           serialize         (flock|semaphore
                              |pipe|none)  undef
           # serialize defaults to flock on multi_port or on Solaris
           lock_file         "filename"              File::Temp-&gt;new

           check_for_dead    \d+                     30

           max_dequeue       \d+                     undef
           check_for_dequeue \d+                     undef

       max_servers
           The maximum number of child servers to start and maintain.  This does not apply to dequeue processes.

       max_requests
           The number of client connections to receive before a child terminates.

       serialize
           Determines  whether  the  server  serializes child connections.  Options are undef, flock, semaphore,
           pipe, or none.  Default is undef.  On multi_port servers  or  on  servers  running  on  Solaris,  the
           default  is flock.  The flock option uses blocking exclusive flock on the file specified in <u>lock_file</u>
           (see below).  The semaphore option uses IPC::Semaphore (thanks  to  Bennett  Todd)  for  giving  some
           sample  code.   The  pipe  option reads on a pipe to choose the next.  the flock option should be the
           most bulletproof while the pipe option should be the most portable.  (Flock is able to relinquish the
           block if the process dies between accept on the  socket  and  reading  of  the  client  connection  -
           semaphore  and  pipe  do  not).   An option of none will not perform any serialization.  If "none" is
           passed and there are multiple ports then a the default serialization will be used instead of "none."

       lock_file
           Filename to use in flock serialized accept in order to serialize  the  accept  sequence  between  the
           children.   This  will  default  to  a  generated  temporary  filename.  If default value is used the
           lock_file will be removed when the server closes.

       check_for_dead
           Seconds to wait before checking to see if a child died without letting the parent know.

       max_dequeue
           The maximum number of dequeue processes to start.  If a value of zero or undef is given,  no  dequeue
           processes  will  be  started.   The  number  of  running  dequeue  processes  will  be checked by the
           check_for_dead variable.

       check_for_dequeue
           Seconds to wait before forking off a dequeue process.  The run_dequeue  hook  must  be  defined  when
           using  this  setting.   It  is intended to use the dequeue process to take care of items such as mail
           queues.  If a value of undef is given, no dequeue processes will be started.

</pre><h4><b>CONFIGURATION</b> <b>FILE</b></h4><pre>
       "Net::Server::PreFork" allows for the use of a configuration file to  read  in  server  parameters.   The
       format of this conf file is simple key value pairs.  Comments and white space are ignored.

           #-------------- file test.conf --------------

           ### server information
           max_servers   80

           max_requests  1000

           ### user and group to become
           user        somebody
           group       everybody

           ### logging ?
           log_file    /var/log/server.log
           log_level   3
           pid_file    /tmp/server.pid

           ### access control
           allow       .+\.(net|com)
           allow       domain\.com
           deny        a.+

           ### background the process?
           background  1

           ### ports to bind
           host        127.0.0.1
           port        localhost:20204
           port        20205

           ### reverse lookups ?
           # reverse_lookups on

           #-------------- file test.conf --------------

</pre><h4><b>PROCESS</b> <b>FLOW</b></h4><pre>
       Process  flow  follows Net::Server until the loop phase.  At this point "max_servers" are forked and wait
       for connections.  When a child accepts a connection, finishes processing a client, or  exits,  it  relays
       that information to the parent, which keeps track and makes sure there are always "max_servers" running.

</pre><h4><b>HOOKS</b></h4><pre>
       The  PreForkSimple  server  has  the following hooks in addition to the hooks provided by the Net::Server
       base class.  See Net::Server

       "$self-&gt;run_n_children_hook()"
           This hook occurs at the top of run_n_children which is called each time the server goes to start more
           child processes.  This gives the parent to do a little of its own accounting (as desired).  Idea  for
           this hook came from James FitzGibbon.

       "$self-&gt;child_init_hook()"
           This  hook takes place immediately after the child process forks from the parent and before the child
           begins accepting connections.  It  is  intended  for  any  additional  chrooting  or  other  security
           measures.   It  is  suggested  that  all  perl modules be used by this point, so that the most shared
           memory possible is used.

       "$self-&gt;child_finish_hook()"
           This hook takes place immediately before the child tells the  parent  that  it  is  exiting.   It  is
           intended for saving out logged information or other general cleanup.

       "$self-&gt;run_dequeue()"
           This hook only gets called in conjunction with the check_for_dequeue setting.

       "$self-&gt;idle_loop_hook()"
           This hook is called in every pass through the main process wait loop.

</pre><h4><b>HOT</b> <b>DEPLOY</b></h4><pre>
       Since  version  2.000,  the  PreForkSimple server has accepted the TTIN and TTOU signals.  When a TTIN is
       received, the max_servers is increased by 1.  If a TTOU signal is received the max_servers  is  decreased
       by 1.  This allows for adjusting the number of handling processes without having to restart the server.

</pre><h4><b>BUGS</b></h4><pre>
       Tests don't seem to work on Win32.  Any ideas or patches would be welcome.

</pre><h4><b>TO</b> <b>DO</b></h4><pre>
       See Net::Server

</pre><h4><b>AUTHOR</b></h4><pre>
       Paul T. Seamons <a href="mailto:paul@seamons.com">paul@seamons.com</a>

</pre><h4><b>THANKS</b></h4><pre>
       See Net::Server

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Please  see  also  Net::Server::Fork,  Net::Server::INET,  Net::Server::PreFork,  Net::Server::MultiType,
       Net::Server::Single Net::Server::SIG Net::Server::Daemonize Net::Server::Proto

perl v5.36.0                                       2023-06-11                    <u>Net::Server::<a href="../man3pm/PreForkSimple.3pm.html">PreForkSimple</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>