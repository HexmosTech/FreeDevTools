<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Net::Server::PreFork - Net::Server personality</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libnet-server-perl">libnet-server-perl_2.014-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Net::Server::PreFork - Net::Server personality

</pre><h4><b>SYNOPSIS</b></h4><pre>
           use base qw(Net::Server::PreFork);

           sub process_request {
               #...code...
           }

           __PACKAGE__-&gt;run();

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Please read the pod on Net::Server and Net::Server::PreForkSimple first.  This module is a personality,
       or extension, or sub class, of the Net::Server::PreForkSimple class which is a sub class of Net::Server.
       See Net::Server::PreForkSimple.

       This personality binds to one or more ports and then forks "min_servers" child process.  The server will
       make sure that at any given time there are "min_spare_servers" available to receive a client request, up
       to "max_servers".  Each of these children will process up to "max_requests" client connections.  This
       type is good for a heavily hit site, and should scale well for most applications.  (Multi port accept is
       accomplished using flock to serialize the children).

       At this time, it does not appear that this module will pass tests on Win32 systems.  Any ideas or patches
       for making the tests pass would be welcome.

</pre><h4><b>SAMPLE</b> <b>CODE</b></h4><pre>
       Please see the sample listed in Net::Server.

</pre><h4><b>COMMAND</b> <b>LINE</b> <b>ARGUMENTS</b></h4><pre>
       In addition to the command line arguments of the Net::Server base class and the
       Net::Server::PreForkSimple parent class, Net::Server::PreFork contains several other configurable
       parameters.  You really should also see Net::Server::PreForkSimple.

           Key                 Value                   Default
           min_servers         \d+                     5
           min_spare_servers   \d+                     2
           max_spare_servers   \d+                     10
           max_servers         \d+                     50
           max_requests        \d+                     1000

           serialize           (flock|semaphore
                                |pipe|none)            undef
           # serialize defaults to flock on multi_port or on Solaris
           lock_file           "filename"              File::Temp-&gt;new

           check_for_dead      \d+                     30
           check_for_waiting   \d+                     10

           max_dequeue         \d+                     undef
           check_for_dequeue   \d+                     undef

           child_communication 1                       undef

       min_servers
           The minimum number of servers to keep running.

       min_spare_servers
           The  minimum  number of servers to have waiting for requests.  Minimum and maximum numbers should not
           be set to close to each other or the server will fork and kill children too often.

       max_spare_servers
           The maximum number of servers to have waiting for requests.  See <u>min_spare_servers</u>.

       max_servers
           The maximum number of child servers to start.  This does not apply to dequeue processes.

       check_for_waiting
           Seconds to wait before checking to see if we can kill off some waiting servers.

       check_for_spawn
           Seconds between checking to see if we need to spawn more children

       min_child_ttl
           Minimum number of seconds between starting children and killing a child process

       child_communication
           Enable child communication to parent via unix sockets.  If set to true, will let  children  write  to
           the  socket  contained  in  $self-&gt;{'server'}-&gt;{'parent_sock'}.   The parent will be notified through
           child_is_talking_hook where the first argument is the socket to the child.   The  child's  socket  is
           stored in $self-&gt;{'server'}-&gt;{'children'}-&gt;{$child_pid}-&gt;{'sock'}.

       serialize
           See the documentation under Net::Server::PreForkSimple.

</pre><h4><b>CONFIGURATION</b> <b>FILE</b></h4><pre>
       "Net::Server::PreFork"  allows  for  the  use  of a configuration file to read in server parameters.  The
       format of this conf file is simple key value pairs.  Comments and white space are ignored.

           #-------------- file test.conf --------------

           ### server information
           min_servers   20
           max_servers   80
           min_spare_servers 10
           min_spare_servers 15

           max_requests  1000

           ### user and group to become
           user        somebody
           group       everybody

           ### logging ?
           log_file    /var/log/server.log
           log_level   3
           pid_file    /tmp/server.pid

           ### access control
           allow       .+\.(net|com)
           allow       domain\.com
           deny        a.+

           ### background the process?
           background  1

           ### ports to bind
           host        127.0.0.1
           port        localhost:20204
           port        20205

           ### reverse lookups ?
           # reverse_lookups on

           ### enable child communication ?
           # child_communication

           #-------------- file test.conf --------------

</pre><h4><b>PROCESS</b> <b>FLOW</b></h4><pre>
       Process flow follows Net::Server until the loop phase.  At this point "min_servers" are forked  and  wait
       for  connections.   When  a child accepts a connection, finishes processing a client, or exits, it relays
       that information to the parent, which keeps track and makes sure there are  enough  children  to  fulfill
       "min_servers", "min_spare_servers", "max_spare_servers", and "max_servers".

</pre><h4><b>HOOKS</b></h4><pre>
       The  PreFork  server  has  the  following  hooks in addition to the hooks provided by PreForkSimple.  See
       Net::Server::PreForkSimple.

       "$self-&gt;run_n_children_hook()"
           This hook occurs at the top of run_n_children which is called each time the server goes to start more
           child processes.  This gives the parent to do a little of its own accounting (as desired).  Idea  for
           this hook came from James FitzGibbon.

       "$self-&gt;parent_read_hook()"
           This  hook occurs any time that the parent reads information from the child.  The line from the child
           is sent as an argument.

       "$self-&gt;child_is_talking_hook()"
           This   hook   occurs   if   child_communication   is   true   and   the   child   has   written    to
           $self-&gt;{'server'}-&gt;{'parent_sock'}.  The first argument will be the open socket to the child.

       "$self-&gt;idle_loop_hook()"
           This  hook  is  called  in  every  pass through the main process wait loop, every "check_for_waiting"
           seconds.  The first argument is a reference to an array of file descriptors that can be read  at  the
           moment.

       "$self-&gt;cleanup_dead_child_hook( $child )"
           This  hook  is called when a dead child is detected.  A child is considered dead when the pid does no
           longer exist.  This hook could be used to cleanup possible temporary files or locks left  over  by  a
           dead child.

</pre><h4><b>HOT</b> <b>DEPLOY</b></h4><pre>
       Since version 2.000, the PreFork server has accepted the TTIN and TTOU signals.  When a TTIN is received,
       the  min  and  max_servers  are  increased  by  1.   If a TTOU signal is received the min max_servers are
       decreased by 1.  This allows for adjusting the number of handling processes without having to restart the
       server.

</pre><h4><b>BUGS</b></h4><pre>
       Tests don't seem to work on Win32.  Any ideas or patches would be welcome.

</pre><h4><b>TO</b> <b>DO</b></h4><pre>
       See Net::Server

</pre><h4><b>AUTHOR</b></h4><pre>
       Paul T. Seamons <a href="mailto:paul@seamons.com">paul@seamons.com</a>

</pre><h4><b>THANKS</b></h4><pre>
       See Net::Server

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Please see also Net::Server::Fork, Net::Server::INET, Net::Server::PreForkSimple, Net::Server::MultiType,
       Net::Server::Single Net::Server::SIG Net::Server::Daemonize Net::Server::Proto

perl v5.36.0                                       2023-06-11                          <u>Net::Server::<a href="../man3pm/PreFork.3pm.html">PreFork</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>