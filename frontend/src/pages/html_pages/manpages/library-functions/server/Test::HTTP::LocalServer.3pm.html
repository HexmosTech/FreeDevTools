<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test::HTTP::LocalServer - spawn a local HTTP server for testing</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtest-http-localserver-perl">libtest-http-localserver-perl_0.76-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Test::HTTP::LocalServer - spawn a local HTTP server for testing

</pre><h4><b>SYNOPSIS</b></h4><pre>
         use HTTP::Tiny;
         my $server = Test::HTTP::LocalServer-&gt;spawn(
             request_pause =&gt; 1, # wait one second before accepting the next request
         );

         my $res = HTTP::Tiny-&gt;new-&gt;get( $server-&gt;url );
         print $res-&gt;{content};

         $server-&gt;stop;

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This module implements a tiny web server suitable for running "live" tests of HTTP clients against it. It
       also takes care of cleaning %ENV from settings that influence the use of a local proxy etc.

       Use this web server if you write an HTTP client and want to exercise its behaviour in your test suite
       without talking to the outside world.

</pre><h4><b>METHODS</b></h4><pre>
   <b>"Test::HTTP::LocalServer-&gt;spawn</b> <b>%ARGS"</b>
         my $server = Test::HTTP::LocalServer-&gt;spawn;

       This spawns a new HTTP server. The server will stay running until

         $server-&gt;stop

       is called. Ideally, you explicitly call "-&gt;stop" or use

         undef $server

       before the main program ends so that the program exit code reflects the real exit code and not the chlid
       exit code.

       Valid arguments are :

       •   "html =&gt;" scalar containing the page to be served

           If this is not specified, an informative default page will be used.

       •   "request_pause =&gt;" number of seconds to sleep before accepting the next request

           If your system is slow or needs to wait some time before a socket connection is ready again, use this
           parameter to make the server wait a bit before handling the next connection.

       •   "file =&gt;" filename containing the page to be served

       •   "debug =&gt; 1" to make the spawned server output debug information

       •   "eval =&gt;" string that will get evaluated per request in the server

           Try  to  avoid  characters  that are special to the shell, especially quotes.  A good idea for a slow
           server would be

             eval =&gt; sleep+10

       All served HTML will have the first %s replaced by the current location.

       The following entries will be removed from %ENV when making a request:

           HTTP_PROXY
           http_proxy
           HTTP_PROXY_ALL
           http_proxy_all
           HTTPS_PROXY
           https_proxy
           CGI_HTTP_PROXY
           ALL_PROXY
           all_proxy

   <b>"$server-&gt;port"</b>
       This returns the port of the current server. As new instances will most  likely  run  under  a  different
       port, this is convenient if you need to compare results from two runs.

   <b>"$server-&gt;url"</b>
       This  returns  the  URI where you can contact the server. This url is valid until the $server goes out of
       scope or you call

         $server-&gt;stop;

       The returned object is a copy that you can modify at your leisure.

   <b>"$server-&gt;server_url"</b>
       This returns the URI object of the server URL. Use "$server-&gt;url" instead.  Use this object if  you  want
       to modify the hostname or other properties of the server object.

       Consider this basically an emergency accessor. In about every case, using "-&gt;url()" does what you want.

   <b>"$server-&gt;stop"</b>
       This stops the server process by requesting a special url.

   <b>"$server-&gt;kill"</b>
       This kills the server process via "kill". The log cannot be retrieved then.

   <b>"$server-&gt;get_log"</b>
       This  returns  the  output  of the server process. This output will be a list of all requests made to the
       server concatenated together as a string.

   <b>"$server-&gt;local"</b>
         my $url = $server-&gt;local('foo.html');
         # file:///.../foo.html

       Returns an URL for a local file which will be read and served by the webserver. The filename  must  be  a
       relative filename relative to the location of the current program.

</pre><h4><b>URLs</b> <b>implemented</b> <b>by</b> <b>the</b> <b>server</b></h4><pre>
   <b>arbitrary</b> <b>content</b> <b>"$server-&gt;content($html)"</b>
         $server-&gt;content(&lt;&lt;'HTML');
             &lt;script&gt;alert("Hello World");&lt;/script&gt;
         HTML

       The  URL will contain the HTML as supplied. This is convenient for supplying Javascript or special URL to
       your user agent.

   <b>download</b> <b>"$server-&gt;download($name)"</b>
       This URL will send a file with a "Content-Disposition" header and  indicate  the  suggested  filename  as
       passed in.

   <b>302</b> <b>redirect</b> <b>"$server-&gt;redirect($target)"</b>
       This  URL  will issue a redirect to $target. No special care is taken towards URL-decoding $target as not
       to complicate the server code.  You need to be wary about issuing requests with escaped URL parameters.

   <b>401</b> <b>basic</b> <b>authentication</b> <b>challenge</b> <b>"$server-&gt;basic_auth($user,</b> <b>$pass)"</b>
       This URL will issue a 401 basic authentication challenge. The expected user and password are  encoded  in
       the URL.

           my $challenge_url = $server-&gt;basic_auth('foo','secret');
           my $wrong_pw = URI-&gt;new( $challenge_url );
           $wrong_pw-&gt;userinfo('foo:hunter2');
           $res = HTTP::Tiny-&gt;new-&gt;get($wrong_pw);
           is $res-&gt;{status}, 401, "We get the challenge with a wrong user/password";

   <b>404</b> <b>error</b> <b>"$server-&gt;error_notfound($target)"</b>
       This URL will response with status code 404.

   <b>Timeout</b> <b>"$server-&gt;error_timeout($seconds)"</b>
       This URL will send a 599 error after $seconds seconds.

   <b>Timeout+close</b> <b>"$server-&gt;error_close($seconds)"</b>
       This URL will send nothing and close the connection after $seconds seconds.

   <b>Error</b> <b>in</b> <b>response</b> <b>content</b> <b>"$server-&gt;error_after_headers"</b>
       This  URL  will  send  headers  for a successful response but will close the socket with an error after 2
       blocks of 16 spaces have been sent.

   <b>Chunked</b> <b>response</b> <b>"$server-&gt;chunked"</b>
       This URL will return 5 blocks of 16 spaces at a rate of one block per second in a chunked response.

   <b>Surprisingly</b> <b>large</b> <b>bzip2</b> <b>encoded</b> <b>response</b> <b>"$server-&gt;bzip2"</b>
       This URL will return a short HTTP response that expands to 16M body.

   <b>Surprisingly</b> <b>large</b> <b>gzip</b> <b>encoded</b> <b>response</b> <b>"$server-&gt;gzip"</b>
       This URL will return a short HTTP response that expands to 16M body.

   <b>Other</b> <b>URLs</b>
       All other URLs will echo back the cookies and query parameters.

</pre><h4><b>EXPORT</b></h4><pre>
       None by default.

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       This library is free software; you can redistribute it and/or modify it under  the  same  terms  as  Perl
       itself.

       Copyright (C) 2003-2024 Max Maischein

</pre><h4><b>AUTHOR</b></h4><pre>
       Max Maischein, &lt;<a href="mailto:corion@cpan.org">corion@cpan.org</a>&gt;

       Please contact me if you find bugs or otherwise improve the module. More tests are also very welcome !

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       WWW::Mechanize,WWW::Mechanize::Shell,WWW::Mechanize::Firefox

perl v5.38.2                                       2024-03-09                       <u>Test::HTTP::<a href="../man3pm/LocalServer.3pm.html">LocalServer</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>