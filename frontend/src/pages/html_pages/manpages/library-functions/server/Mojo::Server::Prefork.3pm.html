<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mojo::Server::Prefork - Pre-forking non-blocking I/O HTTP and WebSocket server</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmojolicious-perl">libmojolicious-perl_9.39+dfsg-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Mojo::Server::Prefork - Pre-forking non-blocking I/O HTTP and WebSocket server

</pre><h4><b>SYNOPSIS</b></h4><pre>
         use Mojo::Server::Prefork;

         my $prefork = Mojo::Server::Prefork-&gt;new(listen =&gt; ['http://*:8080']);
         $prefork-&gt;unsubscribe('request')-&gt;on(request =&gt; sub ($prefork, $tx) {

           # Request
           my $method = $tx-&gt;req-&gt;method;
           my $path   = $tx-&gt;req-&gt;url-&gt;path;

           # Response
           $tx-&gt;res-&gt;<a href="../man200/code.200.html">code</a>(200);
           $tx-&gt;res-&gt;headers-&gt;content_type('text/plain');
           $tx-&gt;res-&gt;body("$method request for $path!");

           # Resume transaction
           $tx-&gt;resume;
         });
         $prefork-&gt;run;

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Mojo::Server::Prefork is a full featured, UNIX optimized, pre-forking non-blocking I/O HTTP and WebSocket
       server, built around the very well tested and reliable Mojo::Server::Daemon, with IPv6, TLS, SNI, UNIX
       domain socket, Comet (long polling), keep-alive and multiple event loop support. Note that the server
       uses signals for process management, so you should avoid modifying signal handlers in your applications.

       For better scalability (epoll, kqueue) and to provide non-blocking name resolution, SOCKS5 as well as TLS
       support, the optional modules EV (4.32+), Net::DNS::Native (0.15+), IO::Socket::Socks (0.64+) and
       IO::Socket::SSL (1.84+) will be used automatically if possible. Individual features can also be disabled
       with the "MOJO_NO_NNR", "MOJO_NO_SOCKS" and "MOJO_NO_TLS" environment variables.

       See "DEPLOYMENT" in Mojolicious::Guides::Cookbook for more.

</pre><h4><b>MANAGER</b> <b>SIGNALS</b></h4><pre>
       The Mojo::Server::Prefork manager process can be controlled at runtime with the following signals.

   <b>INT,</b> <b>TERM</b>
       Shut down server immediately.

   <b>QUIT</b>
       Shut down server gracefully.

   <b>TTIN</b>
       Increase worker pool by one.

   <b>TTOU</b>
       Decrease worker pool by one.

</pre><h4><b>WORKER</b> <b>SIGNALS</b></h4><pre>
       Mojo::Server::Prefork worker processes can be controlled at runtime with the following signals.

   <b>QUIT</b>
       Stop worker gracefully.

</pre><h4><b>EVENTS</b></h4><pre>
       Mojo::Server::Prefork inherits all events from Mojo::Server::Daemon and can emit the following new ones.

   <b>finish</b>
         $prefork-&gt;on(finish =&gt; sub ($prefork, $graceful) {...});

       Emitted when the server shuts down.

         $prefork-&gt;on(finish =&gt; sub ($prefork, $graceful) {
           say $graceful ? 'Graceful server shutdown' : 'Server shutdown';
         });

   <b>heartbeat</b>
         $prefork-&gt;on(heartbeat =&gt; sub ($prefork, $pid) {...});

       Emitted when a heartbeat message has been received from a worker.

         $prefork-&gt;on(heartbeat =&gt; sub ($prefork, $pid) { say "Worker $pid has a heartbeat" });

   <b>reap</b>
         $prefork-&gt;on(reap =&gt; sub ($prefork, $pid) {...});

       Emitted when a child process exited.

         $prefork-&gt;on(reap =&gt; sub ($prefork, $pid) { say "Worker $pid stopped" });

   <b>spawn</b>
         $prefork-&gt;on(spawn =&gt; sub ($prefork, $pid) {...});

       Emitted when a worker process is spawned.

         $prefork-&gt;on(spawn =&gt; sub ($prefork, $pid) { say "Worker $pid started" });

   <b>wait</b>
         $prefork-&gt;on(wait =&gt; sub ($prefork) {...});

       Emitted when the manager starts waiting for new heartbeat messages.

         $prefork-&gt;on(wait =&gt; sub ($prefork) {
           my $workers = $prefork-&gt;workers;
           say "Waiting for heartbeat messages from $workers workers";
         });

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       Mojo::Server::Prefork inherits all attributes from Mojo::Server::Daemon and implements the following new
       ones.

   <b>accepts</b>
         my $accepts = $prefork-&gt;accepts;
         $prefork    = $prefork-&gt;<a href="../man100/accepts.100.html">accepts</a>(100);

       Maximum number of connections a worker is allowed to accept, before stopping gracefully and then getting
       replaced with a newly started worker, passed along to "max_accepts" in Mojo::IOLoop, defaults to 10000.
       Setting the value to 0 will allow workers to accept new connections indefinitely. Note that up to half of
       this value can be subtracted randomly to improve load balancing, and to make sure that not all workers
       restart at the same time.

   <b>cleanup</b>
         my $bool = $prefork-&gt;cleanup;
         $prefork = $prefork-&gt;cleanup($bool);

       Delete "pid_file" automatically once it is not needed anymore, defaults to a true value.

   <b>graceful_timeout</b>
         my $timeout = $prefork-&gt;graceful_timeout;
         $prefork    = $prefork-&gt;<a href="../man15/graceful_timeout.15.html">graceful_timeout</a>(15);

       Maximum amount of time in seconds stopping a worker gracefully may take before being forced, defaults to
       120. Note that this value should usually be a little larger than the maximum amount of time you expect
       any one request to take.

   <b>heartbeat_interval</b>
         my $interval = $prefork-&gt;heartbeat_interval;
         $prefork     = $prefork-&gt;<a href="../man3/heartbeat_interval.3.html">heartbeat_interval</a>(3);

       Heartbeat interval in seconds, defaults to 5.

   <b>heartbeat_timeout</b>
         my $timeout = $prefork-&gt;heartbeat_timeout;
         $prefork    = $prefork-&gt;<a href="../man2/heartbeat_timeout.2.html">heartbeat_timeout</a>(2);

       Maximum amount of time in seconds before a worker without a heartbeat will be stopped gracefully,
       defaults to 50.  Note that this value should usually be a little larger than the maximum amount of time
       you expect any one operation to block the event loop.

   <b>pid_file</b>
         my $file = $prefork-&gt;pid_file;
         $prefork = $prefork-&gt;pid_file('/tmp/prefork.pid');

       Full path of process id file, defaults to "prefork.pid" in a temporary directory.

   <b>spare</b>
         my $spare = $prefork-&gt;spare;
         $prefork  = $prefork-&gt;<a href="../man4/spare.4.html">spare</a>(4);

       Temporarily spawn up to this number of additional workers if there is a need, defaults to 2. This allows
       for new workers to be started while old ones are still shutting down gracefully, drastically reducing the
       performance cost of worker restarts.

   <b>workers</b>
         my $workers = $prefork-&gt;workers;
         $prefork    = $prefork-&gt;<a href="../man10/workers.10.html">workers</a>(10);

       Number of worker processes, defaults to 4. A good rule of thumb is two worker processes per CPU core for
       applications that perform mostly non-blocking operations, blocking operations often require more and
       benefit from decreasing concurrency with "max_clients" in Mojo::Server::Daemon (often as low as 1).

</pre><h4><b>METHODS</b></h4><pre>
       Mojo::Server::Prefork inherits all methods from Mojo::Server::Daemon and implements the following new
       ones.

   <b>check_pid</b>
         my $pid = $prefork-&gt;check_pid;

       Get process id for running server from "pid_file" or delete it if server is not running.

         say 'Server is not running' unless $prefork-&gt;check_pid;

   <b>ensure_pid_file</b>
         $prefork-&gt;ensure_pid_file($pid);

       Ensure "pid_file" exists.

   <b>healthy</b>
         my $healthy = $prefork-&gt;healthy;

       Number of currently active worker processes with a heartbeat.

   <b>run</b>
         $prefork-&gt;run;

       Run server and wait for "MANAGER SIGNALS".

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Mojolicious, Mojolicious::Guides, &lt;https://mojolicious.org&gt;.

perl v5.40.0                                       2024-12-07                         <u>Mojo::Server::<a href="../man3pm/Prefork.3pm.html">Prefork</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>