<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMDA - introduction to the Performance Metrics Domain Agent support library</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libpcp-pmda3-dev">libpcp-pmda3-dev_6.3.8-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>PMDA</b> - introduction to the Performance Metrics Domain Agent support library

</pre><h4><b>C</b> <b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;pcp/pmapi.h&gt;</b>
       <b>#include</b> <b>&lt;pcp/pmda.h&gt;</b>

        ... assorted routines ...

       <b>cc</b> <b>...</b> <b>-lpcp_pmda</b> <b>-lpcp</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       To  assist  in  the  development of Performance Metric Domain Agents (<b>PMDA</b>s) for the Performance Co-Pilot
       (PCP), a procedural interface is provided that extends the Performance  Metrics  Application  Programming
       Interface  (<b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3))  library.   These procedures are designed to enable a programmer to quickly build a
       PMDA which can then be tested and refined.  However, this also implies  that  a  PMDA  has  a  particular
       structure which may not be suitable for all PMDA implementations.

       Once  you are familiar with the PCP and PMDA frameworks, you can quickly implement a new PMDA with only a
       few data structures and functions.  This is covered in far greater detail  in  the  <u>Performance</u>  <u>Co-Pilot</u>
       <u>Programmer's</u> <u>Guide</u>.

       A  PMDA  is  responsible  for a set of performance metrics, in the sense that it must respond to requests
       from <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) for information about performance metrics, instance domains, and instantiated values.

       This man page contains sections of the <b>simple</b> <b>PMDA</b> which is located at <u>$PCP_PMDAS_DIR</u>/simple.

</pre><h4><b>COMMUNICATING</b> <b>WITH</b> <b>PMCD</b></h4><pre>
       Two approaches may be used for connecting a PMDA to a <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) process.  A Dynamic Shared Object (DSO) can
       be attached by <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) using <b><a href="../man3/dlopen.3.html">dlopen</a></b>(3) when the <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  process  is  started.   A  procedural  interface
       referenced through a shared data structure is used to handle requests from <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) to the PMDA .

       The  preferred  approach  is  for  a  separate  process  (daemon)  to  communicate with <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) using the
       Performance Data Units (PDU) Inter-Process Communication (IPC) protocol.

       All PMDAs are launched and controlled by the <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) process on the local host.  The  requests  from  the
       clients  are  received  by <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) and forwarded to the appropriate PMDAs.  Responses, when required, are
       returned through <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) to the clients.  The requests (PDUs) that may be sent to a PMDA from <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) are
       <b>PDU_FETCH</b>, <b>PDU_PROFILE</b>,  <b>PDU_INSTANCE_REQ</b>,  <b>PDU_DESC_REQ</b>,  <b>PDU_TEXT_REQ</b>  and  <b>PDU_RESULT</b>.   If  the  PMDA
       implements  any  dynamic  metrics  it  may  also receive <b>PDU_PMNS_CHILD</b>, <b>PDU_PMNS_IDS</b>, <b>PDU_PMNS_NAMES</b> and
       <b>PDU_PMNS_TRAVERSE</b> PDUs.

</pre><h4><b>DEFAULT</b> <b>CALLBACKS</b> <b>FOR</b> <b>HANDLING</b> <b>PDUs</b></h4><pre>
       To allow a consistent framework, <b><a href="../man3/pmdaMain.3.html">pmdaMain</a></b>(3) can be used by a daemon PMDA  to  handle  the  communication
       protocol  using  the  same  callbacks  as  a DSO PMDA.  The structure <b>pmdaInterface</b> is used to convey the
       common procedural interface and state information that is  used  by  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  and  a  PMDA.   This  state
       information includes tables describing the supported metrics and instance domains.

       As most of the procedural interface is identical for all PMDAs, they are provided as part of this support
       library  (<b><a href="../man3/pmdaProfile.3.html">pmdaProfile</a></b>(3),  <b><a href="../man3/pmdaFetch.3.html">pmdaFetch</a></b>(3),  <b><a href="../man3/pmdaInstance.3.html">pmdaInstance</a></b>(3),  <b><a href="../man3/pmdaDesc.3.html">pmdaDesc</a></b>(3),  <b><a href="../man3/pmdaText.3.html">pmdaText</a></b>(3)  and <b><a href="../man3/pmdaStore.3.html">pmdaStore</a></b>(3)).
       However, these routines require access to the <b>pmdaInterface</b> state information so  it  must  be  correctly
       initialized   using   <b><a href="../man3/pmdaConnect.3.html">pmdaConnect</a></b>(3),   <b><a href="../man3/pmdaDaemon.3.html">pmdaDaemon</a></b>(3),   <b><a href="../man3/pmdaOpenLog.3.html">pmdaOpenLog</a></b>(3),  <b><a href="../man3/pmdaDSO.3.html">pmdaDSO</a></b>(3),  <b><a href="../man3/pmdaGetOpt.3.html">pmdaGetOpt</a></b>(3)  and
       <b><a href="../man3/pmdaInit.3.html">pmdaInit</a></b>(3).

</pre><h4><b>INSTANCES</b> <b>AND</b> <b>INSTANCE</b> <b>DOMAINS</b></h4><pre>
       Three structures are declared in <u>/usr/include/pcp/pmda.h</u> which provide  a  framework  for  declaring  the
       metrics and instances supported by the PMDA.

       Every  instance  requires  a  unique  integer  identifier  and a unique name, as defined by the structure
       <b>pmdaInstid</b>:

            /*
             * Instance description: index and name
             */

            typedef struct {
                int         i_inst;        /* internal instance identifier */
                char        *i_name;       /* external instance identifier */
            } pmdaInstid;

       An instance domain requires its own unique identification (<b>pmInDom</b>), the number of instances  the  domain
       represents,  and  a  pointer  to  an  array  of  instance descriptions.  This is defined in the structure
       <b>pmdaIndom</b>:

            /*
             * Instance domain description: unique instance id,
             * number of instances in this domain, and the list of
             * instances (not null terminated).
             */

            typedef struct {
                pmInDom     it_indom;       /* indom, filled in */
                int         it_numinst;     /* number of instances */
                pmdaInstid  *it_set;        /* instance identifiers */
            } pmdaIndom;

       The <b>simple</b> <b>PMDA</b> has one instance domain for <u>simple</u>.<u>color</u> with three instances (<u>red</u>, <u>green</u> and <u>blue</u>),  and
       a  second  instance  domain  for  <u>simple</u>.<u>now</u>  with  instances  which can be specified at run-time.  These
       instance domains are defined as:

            static pmdaInstid _color[] = {
                { 0, "red" }, { 1, "green" }, { 2, "blue" }
            };
            static pmdaInstid *_timenow = NULL;

            static pmdaIndom indomtab[] = {
            #define COLOR_INDOM 0
                { COLOR_INDOM, 3, _color },
            #define NOW_INDOM 1
                { NOW_INDOM, 0, NULL },
            };

       The preprocessor macros <b>COLOR_INDOM</b> and <b>NOW_INDOM</b> are used in the metric description  table  to  identify
       the  instance domains of individual metrics.  These correspond to the <u>serial</u> value in the instance domain
       <b>pmInDom</b> structure (the <u>domain</u> field is set by <b><a href="../man3/pmdaInit.3.html">pmdaInit</a></b>(3) at run-time).  The serial value must be  unique
       for each instance domain within the PMDA.

       The  indom  table  shown  above which is usually passed to <b><a href="../man3/pmdaInit.3.html">pmdaInit</a></b>(3) does not need to be created if one
       wants to write one's own Fetch and Instance functions.  See <b><a href="../man3/pmdaInit.3.html">pmdaInit</a></b>(3) for more details.

</pre><h4><b>NAMESPACE</b></h4><pre>
       Every PMDA has its own unique <b>namespace</b> using the format defined in <b><a href="../man5/PMNS.5.html">PMNS</a></b>(5).  In summary,  the  namespace
       matches  the  names  of  the  metrics  to  the  unique identifier.  The <b>simple</b> <b>PMDA</b> defines five metrics:
       <u>simple</u>.<u>numfetch</u>, <u>simple</u>.<u>color</u>, <u>simple</u>.<u>time</u>.<u>user,</u> <u>simple</u>.<u>time</u>.<u>sys</u> and <u>simple</u>.<u>now</u>.  The namespace for these
       metrics is defined in <u>$PCP_PMDAS_DIR</u>/simple/pmns and is installed as:

            simple {
                numfetch    253:0:0
                color       253:0:1
                time
                now         253:2:4
            }

            simple.time {
                user        253:1:2
                sys         253:1:3
            }

       The domain number of <u>253</u> is obtained from <u>$PCP_VAR_DIR</u>/pmns/stdpmid.  New PMDAs should specify  a  unique
       domain  number in this file, and obtain the number during installation.  This allows the domain number to
       change by modifying only the file <u>$PCP_VAR_DIR</u>/pmns/stdpmid.

       The <u>simple.time</u> and <u>simple.now</u> metrics are defined in separate clusters to the other metrics which allows
       a PMDA to support more than 1024 metrics, as well as grouping similar metrics together.   Therefore,  the
       item  numbers  for a new cluster may be identical to the item numbers in other clusters.  The <b>simple</b> <b>PMDA</b>
       continues to increment the item numbers to permit direct mapping (see <b><a href="../man3/pmdaInit.3.html">pmdaInit</a></b>(3)).

       The namespace file should be installed and removed with the agent using <b><a href="../man1/pmnsadd.1.html">pmnsadd</a></b>(1) and  <b><a href="../man1/pmnsdel.1.html">pmnsdel</a></b>(1).   See
       the later sections on INSTALLATION and REMOVAL.

       A simple ASCII namespace can be constructed by creating a file similar to <u>$PCP_PMDAS_DIR</u>/simple/root:

            /*
             * fake "root" for validating the local PMNS subtree
             */

            #include "$PCP_VAR_DIR/pmns/stdpmid"

            root { simple }

            #include "pmns"

       and can be referred to with the <b>-n</b> option in most PCP tools.

</pre><h4><b>METRIC</b> <b>DESCRIPTIONS</b></h4><pre>
       Each  metric  requires  a  description (<b>pmDesc</b>), which contains its Performance Metric Identifier (PMID),
       data type specification, instance domain, semantics and units (see <b><a href="../man3/pmLookupDesc.3.html">pmLookupDesc</a></b>(3)).  A  handle  is  also
       provided for application specific information in the <b>pmdaMetric</b> structure:

            /*
             * Metric description: handle for extending description,
             * and the description.
             */

            typedef struct {
                void*       m_user;         /* for users external use */
                pmDesc      m_desc;         /* metric description */
            } pmdaMetric;

       The <b>simple</b> <b>PMDA</b> defines the metrics as:

            static pmdaMetric metrictab[] = {
            /* numfetch */
                { (void *)0,
                  { PMDA_PMID(0,0), PM_TYPE_U32, PM_INDOM_NULL, PM_SEM_INSTANT,
                    { 0,0,0,0,0,0} }, },
            /* color */
                { (void *)0,
                  { PMDA_PMID(0,1), PM_TYPE_32, COLOR_INDOM, PM_SEM_INSTANT,
                    { 0,0,0,0,0,0} }, },
            /* time.user */
                { (void*)0,
                  { PMDA_PMID(1,2), PM_TYPE_DOUBLE, PM_INDOM_NULL, PM_SEM_COUNTER,
                       { 0, 1, 0, 0, PM_TIME_SEC, 0 } }, },
            /* time.sys */
                { (void*)0,
                  { PMDA_PMID(1,3), PM_TYPE_DOUBLE, PM_INDOM_NULL, PM_SEM_COUNTER,
                       { 0, 1, 0, 0, PM_TIME_SEC, 0 } }, },
            /* now */
                { NULL,
                  { PMDA_PMID(2,4), PM_TYPE_U32, NOW_INDOM, PM_SEM_INSTANT,
                    { 0,0,0,0,0,0 } }, },
            };

       The  macro  <b>PMDA_PMID</b>  (defined  in <u>/usr/include/pcp/pmda.h</u>) is used to specify each metric's <u>cluster</u> and
       <u>item</u> fields of the associated <b>pmID</b>.  As with instance domains, the <u>domain</u> field is set by <b><a href="../man3/pmdaInit.3.html">pmdaInit</a></b>(3)  at
       run-time, however, the default domain is assumed to be defined by the PMDA in the macro <b>MYDOMAIN</b>.

       The  metric  table  shown above which is usually passed to <b><a href="../man3/pmdaInit.3.html">pmdaInit</a></b>(3) does not need to be created if one
       wants to write one's own Fetch and Descriptor functions.  See <b><a href="../man3/pmdaInit.3.html">pmdaInit</a></b>(3) for more details.

</pre><h4><b>DSO</b> <b>PMDA</b></h4><pre>
       A PMDA that is run as a DSO  is  opened  by  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  with  <b><a href="../man3/dlopen.3.html">dlopen</a></b>(3).   <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  will  call  the  PMDA's
       initialization  function that is specified in <u>$PCP_PMCDCONF_PATH</u>.  This function is passed a pointer to a
       <b>pmdaInterface</b> structure which must be completed.  Any callbacks which are <u>not</u> the  default  PMDA  support
       library callbacks must be specified in the <b>pmdaInterface</b> structure.

       The  <b>simple</b> <b>PMDA</b> uses its own store and fetch callback.  <b>simple_fetch</b>() calls <b><a href="../man3/pmdaFetch.3.html">pmdaFetch</a></b>(3) which requires
       a callback to be set with <b><a href="../man3/pmdaSetFetchCallBack.3.html">pmdaSetFetchCallBack</a></b>(3) as can be seen in <u>$PCP_PMDAS_DIR</u>/simple/simple.c.

       The flag <b>_isDSO</b> is used to determine if the PMDA is a daemon or a DSO so that the correct  initialization
       routine, <b><a href="../man3/pmdaDaemon.3.html">pmdaDaemon</a></b>(3) or <b><a href="../man3/pmdaDSO.3.html">pmdaDSO</a></b>(3), is called.

</pre><h4><b>DAEMON</b> <b>PMDA</b></h4><pre>
       A  PMDA  that  is  run  as a daemon is forked and executed by <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1).  Therefore, unlike a DSO PMDA, the
       starting point for a daemon PMDA is <b>main</b>().  The agent should parse the command line arguments, create  a
       log file and initialize some data structures that <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) would initialize for a DSO agent.

       The  <b>pmdaInterface</b>  structure  must be completely defined by the daemon PMDA.  The function <b><a href="../man3/pmdaDaemon.3.html">pmdaDaemon</a></b>(3)
       can be called at the start of <b>main</b>() to set most of these fields.  Command line parsing can be simplified
       by using <b><a href="../man3/pmdaGetOpt.3.html">pmdaGetOpt</a></b>(3), which is similar to <b><a href="../man2/getopt.2.html">getopt</a></b>(2), but extracts a common  set  of  options  into  the
       <b>pmdaInterface</b>  structure.   <u>stderr</u> can be mapped to a log file using <b><a href="../man3/pmdaOpenLog.3.html">pmdaOpenLog</a></b>(3) to simplify debugging
       and error messages.  The connection to <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) can be made with <b><a href="../man3/pmdaConnect.3.html">pmdaConnect</a></b>(3) and the loop which handles
       the  incoming  PDUs,  <b><a href="../man3/pmdaMain.3.html">pmdaMain</a></b>(3),  should  be  the  last  function  called.   This  can   be   seen   in
       <u>$PCP_PMDAS_DIR</u>/simple/simple.c.

       The <b>simple_init</b>() routine is common to an agent that can be run as both a Daemon and DSO PMDA.

</pre><h4><b>HELP</b> <b>TEXT</b></h4><pre>
       Each  PMDA  must be able to provide <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) with the help text for each metric.  Most PMDAs use specially
       created files with indexes to support efficient retrieval of the help text.  Tools are provided with  PCP
       to create the help text files of appropriate format. See <b><a href="../man1/newhelp.1.html">newhelp</a></b>(1).

</pre><h4><b>INSTALLATION</b> <b>AND</b> <b>REMOVAL</b></h4><pre>
       A  series  of  shell  procedures are defined in <u>$PCP_SHARE_DIR</u>/lib/pmdaproc.sh which greatly simplify the
       installation and removal of a PMDA.

       The <u>Install</u> scripts for most PMDAs should only need to  specify  the  name  of  the  PMDA  in  <b>iam</b>,  call
       <b>pmdaSetup</b> which sets up some default variables, checks permissions (you have to be ``root'' to install or
       remove  a  PMDA),  checks  that  you're  in  the  right directory (somewhere that ends with /pmdas/<u>$iam</u>),
       optionally generate the Performance Metrics Name Space (PMNS) and PMDA domain number files  for  Perl  or
       Python  PMDAs,  checks  the  PMDA  domain number is valid, etc., specify the communication protocols, and
       finally call <b>pmdaInstall</b> to do all the work of updating the PMNS,  updating  the  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  control  file,
       notifying or restarting <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1),

       Beyond  <b>pmdaSetup</b>  and  <b>pmdaInstall</b>, another optional helper routines is <b>pmdaChooseConfigFile</b> that may be
       used to interactively select or create a PMDA-specific configuration file, e.g. <b><a href="../man1/pmdalogger.1.html">pmdalogger</a></b>(1).

       The <u>Remove</u> scripts are even simpler as setting up the communication protocols are not  required,  so  set
       the name of the PMDA in <u>iam</u>, then call <b>pmdaSetup</b> followed by a call to <b>pmdaRemove</b>.

       Further information is contained in the <u>$PCP_SHARE_DIR</u>/lib/pmdaproc.sh file and the following section.

       Optionally,  a  PMDA  may provide an <u>Upgrade</u> script alongside <u>Install</u> and <u>Remove</u>.  If present this script
       will be used by the <b>pmcd</b> startup process to ensure corrections to an installation have been  made  before
       starting  the  PMDA.   Examples  of  such corrections include: updates to <u>pmcd.conf</u> when a PMDA script or
       binary has been renamed, when the PMDA supports a new format of its configuration file, or  if  there  is
       some  latent  problem  from an earlier install (e.g. some PMDAs may need to introduce use of the <b>notready</b>
       keyword in <u>pmcd.conf</u>, as described below).

</pre><h4><b>INSTALLATION</b> <b>REFINEMENTS</b></h4><pre>
       As outlined below there are a number of variables that can be set in a PMDA's <u>Install</u> script to influence
       the behaviour of the installation procedures.  These would typically need to be set before  the  call  to
       <b>pmdaInstall</b>, but in some instances (like <u>$iam</u> and the cases specifically noted below), before the call to
       <b>pmdaSetup</b>.

       The  following variables control the communication options between the PMDA and <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1).  At least one of
       <u>$daemon_opt</u>, <u>$dso_opt</u>, <u>$perl_opt</u>  or  <u>$python_opt</u>  must  be  set  to  define  the  supported  mode(s)  of
       communication.   If  more than one of these is set the user will be prompted to make a selection when the
       <u>Install</u> script is run.

       <u>daemon_opt</u>      We are willing to install the PMDA as a daemon.
                       Default: true

       <u>dso_opt</u>         We are willing to install the PMDA as a DSO, so <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  will  use  the  dynamic  linking
                       loader  to  attach  the PMDA's DSO at run-time and communication from <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) to the PMDA
                       and back uses procedure calls, not an IPC channel.
                       Default: false

       <u>dso_entry</u>       For a DSO PMDA, this is the name of the PMDA's initialization routine.
                       Default: <u>${iam}</u>_init

       <u>dso_name</u>        For a DSO PMDA, this is the full pathanme of the PMDA's DSO file.
                       Default: <u>$PCP_PMDAS_DIR</u>/<u>$iam</u>/pmda_<u>$iam</u>.<u>$dso_suffix</u>

       <u>pipe_opt</u>        For a daemon PMDA, is the default IPC channel via a <b><a href="../man2/pipe.2.html">pipe</a></b>(2)?
                       Default: Platform-specific, so <b>true</b> for most, but <b>false</b> for Windows

       <u>perl_opt</u>        We are willing to install the PMDA as a Perl script and  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)  will  use  the  <b><a href="../man1/perl.1.html">perl</a></b>(1)
                       interpreter to run the PMDA.
                       Default: false

       <u>pmda_dir</u>        Full  pathname  to the directory where the PMDA's installation files (executable, script,
                       PMNS source, help text source, etc) are to be found.
                       Default: output from <a href="../man1/pwd.1.html">pwd</a>(1)

                       If set, must be done before the call to <b>pmdaSetup</b>.

       <u>pmda_name</u>       For a daemon PMDA, this is the name of the  PMDA's  executable  binary  relative  to  the
                       <u>$pmda_dir</u> directory.
                       Default: pmda<u>$iam</u>

       <u>python_opt</u>      We  are willing to install the PMDA as a Python script and <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) will use the <b><a href="../man1/python.1.html">python</a></b>(1)
                       interpreter to run the PMDA.
                       Default: false

       <u>ipc_prot</u>        For a daemon PMDA, this can be set to either <b>binary</b> or <b>text</b>.  The default is  <b>binary</b>  and
                       <b>text</b>  is  rarely  used.   In  addition, an optional IPC parameter <b>notready</b> can be used to
                       signify that the PMDA  will  start  up  in  the  <b>notready</b>  state,  e.g.  <b>ipc_prot="binary</b>
                       <b>notready"</b>.   Note  that the quotes are required.  The IPC parameters for a PMDA appear in
                       <b>pmcd.conf</b> in the <b>IPC</b> <b>Params</b> column.  For further details, see <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) but basically  <b>pmcd</b>
                       will  not  issue  any requests to a PMDA that has started in the <b>notready</b> state until the
                       PMDA sends a <b>PM_ERR_PMDAREADY</b>  PDU.   This  allows  PMDAs  with  long  startup  times  to
                       initialize  correctly without timing out.  For details, see <b><a href="../man3/pmdaSendError.3.html">pmdaSendError</a></b>(3) and <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1).
                       When a PMDA is in the <b>notready</b> state, any client requests  sent  to  <b>pmcd</b>  for  the  PMDA
                       domain will return with the <b>PM_ERR_PMDANOTREADY</b> error.

       <u>socket_inet_def</u> For  a  daemon PMDA using a <b><a href="../man2/socket.2.html">socket</a></b>(2) as the IPC channel the default Internet port number
                       or service name (if known).
                       Default: ""

       <u>socket_opt</u>      For a daemon PMDA, is the default IPC channel via a <b><a href="../man2/socket.2.html">socket</a></b>(2)?
                       Default: Platform-specific, so <b>false</b> for most, but <b>true</b> for Windows

       The following variables control the PMNS options.

       <u>pmns_dupok</u>      Most PMDAs do not have duplicate names for the same PMID in their PMNS.  But if  this  is
                       not the case, <u>pmns_dupok</u> should be set to <b>true</b>.
                       Default: false

       <u>pmns_name</u>       Each  PMDA  will  add one or more non-leaf nodes to the top of the PMNS.  The most common
                       case is that all of the metrics for a PMDA will be placed below the node named <u>$iam</u>.   If
                       this  is  not  the case, and especially when the PMDA adds more than one non-leaf node at
                       the top of the PMNS, <u>pmns_name</u> needs to be set to the list of node  names  (separated  by
                       white space), e.g. for <b><a href="../man1/pmdaproc.1.html">pmdaproc</a></b>(1) <u>pmns_name</u> is set to "proc cgroup hotproc".
                       Default: <u>$iam</u>

                       It  is  most  important  that  if  <u>pmns_name</u> is set to a non-default value in the <u>Install</u>
                       script then it must also be set to the same value in the <u>Remove</u> script.

       <u>pmns_source</u>     The name of the PMDA's PMNS source file.  By  default,  the  name  is  interpreted  as  a
                       relative pathname from the <u>$pmda_dir</u> directory.
                       Default: pmns

       The following variables provide assorted additional options associated with the installation of a PMDA.

       <u>args</u>            Additional  command line args for the PMDA.  These will be appended to the PMDA's control
                       line in <u>$PCP_PMCDCONF_PATH</u>.
                       Default: ""

       <u>check_delay</u>     Delay (in seconds) after finishing the PMDA installation (or removal) before checking the
                       availability of metrics from the PMDA.  May need to  be  increased  if  the  PMDA  has  a
                       lengthy startup procedure.
                       Default: 0.3

       <u>signal_delay</u>    Delay  (in  seconds) after notifying <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) with a signal.  Required to allow <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) to
                       complete processing before proceeding to the next step of the installation (or removal).
                       Default: 1

       <u>configdir</u>       Determines the directory in which a PMDA's configuration file will be  stored.   Used  by
                       <b>pmdaChooseConfigFile</b> so should be set before calling that procedure.
                       Default: <u>$PCP_VAR_DIR</u>/config/<u>$iam</u>

       <u>configfile</u>      Preferred configuration file for the PMDA.  Used by <b>pmdaChooseConfigFile</b> so should be set
                       before calling that procedure.
                       Default: ""

       <u>default_configfile</u>
                       Default  configuration  file for the PMDA.  Used by <b>pmdaChooseConfigFile</b> so should be set
                       before calling that procedure.
                       Default: ""

       <u>dso_suffix</u>      Standard suffix for a DSO.  Should not need to be changed under normal circumstances.
                       Default: Platform-specific, so 'so' for Linux, 'dylib' for Mac OS X, 'dll'  for  Windows,
                       etc.

                       If set, must be done before the call to <b>pmdaSetup</b>.

       <u>help_source</u>     The  name  of the help text source file that should be used as input to <b><a href="../man1/pmnewhelp.1.html">pmnewhelp</a></b>(1).  By
                       default, the name is interpreted as a relative pathname from the <u>$pmda_dir</u> directory.
                       Default: help

       <u>python_name</u>     Full pathname of the Python script for a Python PMDA.
                       Default: <u>$pmda_dir</u>/pmda<u>$iam</u>.python or <u>$pmda_dir</u>/pmda<u>$iam</u>.py

       The shell procedures in <u>$PCP_SHARE_DIR</u>/lib/pmdaproc.sh manipulate a number of temporary files  using  the
       variable  <u>$tmp</u>  as  the prefix for the name of the temporary files.  <u>$tmp</u> is a directory that is created,
       used and removed internally within the procedures of <u>$PCP_SHARE_DIR</u>/lib/pmdaproc.sh but can also be  used
       as  the  prefix for temporary files needed by a PMDA's <u>Install</u> or <u>Remove</u> scripts.  When used in this way,
       <u>$tmp</u> should be followed by a ``/'' and then a suffix, e.g. <u>$tmp</u>/myfoo.  The <u>Install</u>  and  <u>Remove</u>  scripts
       should  not  use  other  temporary file name prefixes nor use <b><a href="../man1/sh.1.html">sh</a></b>(1) <b>trap</b> statements to clean up temporary
       files as this is all done within <u>$PCP_SHARE_DIR</u>/lib/pmdaproc.sh.

</pre><h4><b>CAVEAT</b></h4><pre>
       Failing to complete any of the data structures or calling any of the library routines out  of  order  may
       cause unexpected behavior in the PMDA.

       Due  to  changes  to  the  <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3)  and  <b><a href="../man3/PMDA.3.html">PMDA</a></b>(3) API in the PCP 2.0 release, as described in the product
       release notes, PMDAs  built  using  PCP  2.0  must  specify  <b>PMDA_INTERFACE_2</b>  or  later  and  link  with
       <u>libpcp_pmda.so.2</u> and <u>libpcp.so.2</u>.  Pre-existing Daemon PMDAs specifying <b>PMDA_INTERFACE_1</b> will continue to
       function  using the backwards compatible <u>libpcp_pmda.so.1</u> and <u>libpcp.so.1</u> libraries and may be recompiled
       using the headers installed in <u>/usr/include/pcp1.x/</u> without any modification.  These backwards compatible
       headers and libraries are contained in the <u>pcp.sw.compat</u> subsystem.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       Any PMDA which uses this library can set <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3) debugging control option <b>libpmda</b> (with <b>-Dlibpmda</b> on the
       command line or via <b>3</b>pmSetDebug<b>(3))</b> to to enable the display of debugging information which may be useful
       during development (see <b><a href="../man1/pmdbg.1.html">pmdbg</a></b>(1)).

       The <u>status</u> field of the <b>pmdaInterface</b> structure should be zero  after  <b>pmdaDaemon</b>,  <b>pmdaDSO</b>,  <b>pmdaGetOpt</b>,
       <b>pmdaConnect</b> and <b>pmdaInit</b> are called.  A value less than zero indicates that initialization has failed.

       Some error messages that are common to most functions in this library are:

       <b>PMDA</b> <b>interface</b> <b>version</b> <u>interface</u> <b>not</b> <b>supported</b>
                      Most  of  the functions require that the <u>comm.version</u> field of the <b>pmdaInterface</b> structure
                      be set to <b>PMDA_INTERFACE_2</b> or later.  <b>PMDA_INTERFACE_2</b> or  <b>PMDA_INTERFACE_3</b>  implies  that
                      the  <u>version.two</u> fields are correctly initialized, while <b>PMDA_INTERFACE_4</b> implies that the
                      <u>version.four</u> fields are correctly initialized (see <b><a href="../man3/pmdaDaemon.3.html">pmdaDaemon</a></b>(3) and <b><a href="../man3/pmdaDSO.3.html">pmdaDSO</a></b>(3)).

</pre><h4><b>FILES</b></h4><pre>
       <u>/usr/include/pcp/pmda.h</u>
                 Header file for the PMDA support library.

       <u>/usr/lib/libpcp_pmda.so</u>
                 Dynamic library containing PMDA support library routines.

       <u>$PCP_PMDAS_DIR</u>/trivial
                 The source of the <b>trivial</b> <b>PMDA</b>.

       <u>$PCP_PMDAS_DIR</u>/simple
                 The source of the <b>simple</b> <b>PMDA</b>.

       <u>$PCP_PMDAS_DIR</u>/txmon
                 The source of the <b>txmon</b> <b>PMDA</b>.

       <u>$PCP_PMCDCONF_PATH</u>
                 Configuration file for <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1).

       <u>$PCP_VAR_DIR</u>/pmns
                 Location of namespace descriptions for every PMDA.

       <u>$PCP_VAR_DIR</u>/pmns/stdpmid
                 The unique domain identifiers for each PMDA.

       <u>$PCP_SHARE_DIR</u>/lib/pmdaproc.sh
                 Shell procedures for installing and removing a PMDA.

</pre><h4><b>PCP</b> <b>ENVIRONMENT</b></h4><pre>
       Environment variables with the prefix <b>PCP_</b> are used to parameterize the file and directory names used  by
       PCP.   On  each  installation, the file <u>/etc/pcp.conf</u> contains the local values for these variables.  The
       <u>$PCP_CONF</u> variable may be used to specify an alternative configuration file, as described in <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5).
       Values for these variables may be obtained programmatically using the <u><a href="../man3/pmGetConfig.3.html">pmGetConfig</a></u>(3) function.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/dbpmda.1.html">dbpmda</a></b>(1),  <b><a href="../man1/newhelp.1.html">newhelp</a></b>(1),  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1),  <b><a href="../man1/pmnsadd.1.html">pmnsadd</a></b>(1),   <b><a href="../man1/pmnsdel.1.html">pmnsdel</a></b>(1),   <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3),   <b><a href="../man3/PMWEBAPI.3.html">PMWEBAPI</a></b>(3),   <b><a href="../man3/pmdaConnect.3.html">pmdaConnect</a></b>(3),
       <b><a href="../man3/pmdaDaemon.3.html">pmdaDaemon</a></b>(3),   <b><a href="../man3/pmdaDesc.3.html">pmdaDesc</a></b>(3),  <b><a href="../man3/pmdaDSO.3.html">pmdaDSO</a></b>(3),  <b><a href="../man3/pmdaFetch.3.html">pmdaFetch</a></b>(3),  <b><a href="../man3/pmdaGetOpt.3.html">pmdaGetOpt</a></b>(3),  <b><a href="../man3/pmdaInit.3.html">pmdaInit</a></b>(3),  <b><a href="../man3/pmdaInstance.3.html">pmdaInstance</a></b>(3),
       <b><a href="../man3/pmdaMain.3.html">pmdaMain</a></b>(3), <b><a href="../man3/pmdaOpenLog.3.html">pmdaOpenLog</a></b>(3), <b><a href="../man3/pmdaProfile.3.html">pmdaProfile</a></b>(3), <b><a href="../man3/pmdaStore.3.html">pmdaStore</a></b>(3), <b><a href="../man3/pmdaText.3.html">pmdaText</a></b>(3), <b><a href="../man3/pmLookupDesc.3.html">pmLookupDesc</a></b>(3) and <b><a href="../man5/PMNS.5.html">PMNS</a></b>(5).

       For a complete description of the <u>pcp_pmda</u> library and the PMDA development process, refer to the Insight
       book <u>Performance</u> <u>Co-Pilot</u> <u>Programmer's</u> <u>Guide</u>.

Performance Co-Pilot                                   PCP                                               <u><a href="../man3/PMDA.3.html">PMDA</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>