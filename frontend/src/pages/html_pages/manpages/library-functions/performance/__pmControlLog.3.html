<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>__pmControlLog - enable, disable or enquire about logging of performance metrics</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libpcp3-dev">libpcp3-dev_6.3.8-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>__pmControlLog</b> - enable, disable or enquire about logging of performance metrics

</pre><h4><b>C</b> <b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>"pmapi.h"</b>
       <b>#include</b> <b>"libpcp.h"</b>

       <b>int</b> <b>__pmControlLog(int</b> <u>fd</u><b>,</b> <b>const</b> <b>pmResult</b> <b>*</b><u>request</u><b>,</b> <b>int</b> <u>control</u><b>,</b> <b>int</b> <u>state</u><b>,</b> <b>int</b> <u>delta</u><b>,</b>
               <b>pmResult</b> <b>**</b><u>status</u><b>);</b>

       <b>cc</b> <b>...</b> <b>-lpcp</b>

</pre><h4><b>CAVEAT</b></h4><pre>
       This documentation is intended for internal Performance Co-Pilot (PCP) developer use.

       These  interfaces  are  not part of the PCP APIs that are guaranteed to remain fixed across releases, and
       they may not work, or may provide different semantics at some point in the future.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>__pmControlLog</b> may be used to enable or disable the archiving  for  particular  performance  metrics,  as
       identified by the <u>request</u> parameter; see <b><a href="../man3/pmFetch.3.html">pmFetch</a></b>(3) for an explanation of the <u>pmResult</u> structure.

       The  application  must  have previously issued a call to <b><a href="../man3/__pmConnectLogger.3.html">__pmConnectLogger</a></b>(3) to establish a control-port
       connection to the <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) instance to whom the control request is to be directed, and <u>fd</u> (the  result
       from <b><a href="../man3/__pmConnectLogger.3.html">__pmConnectLogger</a></b>(3)) identifies this connection.

       Within  <u>request</u>, only the details of the performance metrics and their associated instances will be used,
       i.e.  the values of the metrics, if any, will be ignored.  <u>request</u> would typically be constructed as  the
       result of an earlier call to <b><a href="../man3/pmFetch.3.html">pmFetch</a></b>(3).  For metrics with a singular value (having an instance domain of
       <b>PM_INDOM_NULL</b>)  the corresponding <u>pmValueSet</u> should have the value one in the <u>numval</u> field and <b>PM_IN_NULL</b>
       as the <u>inst</u> field of the single <u>pmValue</u> supplied.  If multiple explicit instances are to be  logged,  the
       <u>numval</u> field of the <u>pmValueSet</u> should contain the number of instances supplied and the <u>inst</u> fields of the
       <u>pmValue</u>  structures  should  contain specific instance identifiers (which may not have the reserved value
       <b>PM_IN_NULL</b>).

       If the <u>numval</u> field within any of the <u>pmValueSet</u> structures in <u>request</u> has a value of zero, it  indicates
       that  all  available  instances  of the metric should be used.  Enumeration of the instance domain is de‐
       ferred until the logger fetches the metric prior to writing it to the archive,  rather  than  being  per‐
       formed  when  the  <b>__pmControlLog</b>  request is received.  This is useful for metrics with instance domains
       that change over time.  It is an error to specify <u>numval</u> equal to zero if the corresponding metric has  a
       singular value (no instance domain).

       There  are  several  sorts  of logging control available, namely mandatory or advisory, as defined by the
       <u>control</u> argument, and on, off or maybe as defined by the <u>state</u> argument. These different types of control
       may be used to ensure that some performance metrics can be guaranteed to always be in the archive,  while
       others may be dynamically enabled or disabled as determined by the level and type of system activity.

       The actual action to be performed is defined by the combination of <u>control</u> and <u>state</u> as follows.  If <u>con‐</u>
       <u>trol</u> is <b>PM_LOG_MANDATORY</b> and <u>state</u> is <b>PM_LOG_ON</b>, then logging is enabled.  If <u>control</u> is <b>PM_LOG_MANDATORY</b>
       and  <u>state</u>  is  <b>PM_LOG_OFF</b>,  then  logging  is  disabled.   If  <u>control</u>  is <b>PM_LOG_MANDATORY</b> and <u>state</u> is
       <b>PM_LOG_MAYBE</b>, then subsequent advisory controls will be honored.  If the logging state prior to  the  re‐
       quest  was mandatory (on or off), the state is changed to advisory off.  If the logging state was already
       advisory (either on or off), it remains unchanged.  If <u>control</u> is <b>PM_LOG_ADVISORY</b> and the last  mandatory
       control  for  the  metric was <b>PM_LOG_MAYBE</b>, then logging is enabled or disabled as specified by the <u>state</u>
       argument, i.e.  <b>PM_LOG_ON</b> or <b>PM_LOG_OFF</b>.  When the arguments <u>state</u>  and  <u>control</u>  specify  a  request  to
       change  the  logging  behavior, the argument <u>delta</u> defines the logging interval in milliseconds to be ap‐
       plied to all metrics and instances identified in <u>request</u>.

       The result argument <u>status</u> returns the current logging state for each of the nominated  performance  met‐
       rics.   There is a 1:1 correspondence between the elements of <u>request</u> and <u>status.</u>  For metrics in <u>request</u>
       that have <u>pmValueSet</u>s with <u>numval</u> equal to zero, the corresponding <u>pmValueSet</u> in <u>result</u>  will  contain  a
       value  for  each  available  instance at the time of the call.  Each metric value in <u>status</u> will have the
       current logging state encoded in it.  The detailed outcome of the operation for each metric can be deter‐
       mined by comparing these values to that requested via <u>control</u>, <u>state</u> and <u>delta</u>.

       Macros defined in <b>libpcp.h</b> may be used to extract the state and logging interval from the returned metric
       values.  <b>PMLC_GET_ON</b> returns true if logging is on, or false if it is off; <b>PMLC_GET_MAND</b> returns true  if
       logging  is  mandatory,  or  false  if it is advisory; <b>PMLC_GET_INLOG</b> returns true if the metric has been
       logged at least once, or false otherwise; <b>PMLC_GET_AVAIL</b> returns true if the metric  was  available  from
       its source the last time it was supposed to be logged, or false if it was unavailable; and <b>PMLC_GET_DELTA</b>
       returns the current logging interval for the metric (in milliseconds).  <b>PMLC_MAX_DELTA</b> defines the great‐
       est <u>delta</u> that can be returned in an encoded metric value.

       As  a  special  case, when <u>control</u> is <b>PM_LOG_ENQUIRE</b>, <u>state</u> and <u>delta</u> are ignored, and <u>status</u> returns the
       current logging state of the nominated performance metrics (this variant makes no changes to the  logging
       state).

       If the value of the logging interval is 0, either for <u>delta</u> in a request to change state to <b>PM_LOG_ON</b>, or
       encoded  in  the  value  returned from <b>PM_LOG_ENQUIRE</b>, then this corresponds to the special ``once only''
       logging of metrics that appear once in the archive, and are never logged again.

       <b>__pmControlLog</b> returns zero on success.

</pre><h4><b>NOTE</b></h4><pre>
       This routine is not thread-safe as there is no serialization on the use of the communication channel  be‐
       tween  the  sending  of  the  request  and receiving the reply.  It is assumed that the caller is single-
       threaded, which is true for the only current user of this routine, namely <b><a href="../man1/pmlc.1.html">pmlc</a></b>(1).

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       <b>PM_ERR_TOOSMALL</b>
              The number of metrics in <u>request</u> is less than one.

       <b>PM_ERR_VALUE</b>
              One or more of the <u>pmValueSet</u>s in <u>request</u> had <u>numval</u> (the number of instances) less than one.

       <b>EINVAL</b> An invalid combination of <u>control</u> and <u>state</u> was specified, or <u>delta</u> was negative.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/pmlc.1.html">pmlc</a></b>(1), <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1), <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3), <b><a href="../man3/pmFetch.3.html">pmFetch</a></b>(3) and <b><a href="../man3/__pmConnectLogger.3.html">__pmConnectLogger</a></b>(3).

Performance Co-Pilot                                   PCP                                       <u><a href="../man3/PMCONTROLLOG.3.html">PMCONTROLLOG</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>