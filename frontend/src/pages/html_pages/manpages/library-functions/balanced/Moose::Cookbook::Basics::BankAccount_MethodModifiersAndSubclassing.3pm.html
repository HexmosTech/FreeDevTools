<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moose::Cookbook::Basics::BankAccount_MethodModifiersAndSubclassing - Demonstrates the use of method</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmoose-perl">libmoose-perl_2.2207-1build3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Moose::Cookbook::Basics::BankAccount_MethodModifiersAndSubclassing - Demonstrates the use of method
       modifiers in a subclass

</pre><h4><b>VERSION</b></h4><pre>
       version 2.2207

</pre><h4><b>SYNOPSIS</b></h4><pre>
         package BankAccount;
         use Moose;

         has 'balance' =&gt; ( isa =&gt; 'Int', is =&gt; 'rw', default =&gt; 0 );

         sub deposit {
             my ( $self, $amount ) = @_;
             $self-&gt;balance( $self-&gt;balance + $amount );
         }

         sub withdraw {
             my ( $self, $amount ) = @_;
             my $current_balance = $self-&gt;balance();
             ( $current_balance &gt;= $amount )
                 || confess "Account overdrawn";
             $self-&gt;balance( $current_balance - $amount );
         }

         package CheckingAccount;
         use Moose;

         extends 'BankAccount';

         has 'overdraft_account' =&gt; ( isa =&gt; 'BankAccount', is =&gt; 'rw' );

         before 'withdraw' =&gt; sub {
             my ( $self, $amount ) = @_;
             my $overdraft_amount = $amount - $self-&gt;balance();
             if ( $self-&gt;overdraft_account &amp;&amp; $overdraft_amount &gt; 0 ) {
                 $self-&gt;overdraft_account-&gt;withdraw($overdraft_amount);
                 $self-&gt;deposit($overdraft_amount);
             }
         };

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The first recipe demonstrated how to build very basic Moose classes, focusing on creating and
       manipulating attributes. The objects in that recipe were very data-oriented, and did not have much in the
       way of behavior (i.e. methods). In this recipe, we expand upon the concepts from the first recipe to
       include some real behavior. In particular, we show how you can use a method modifier to implement new
       behavior for a method.

       The classes in the SYNOPSIS show two kinds of bank account. A simple bank account has one attribute, the
       balance, and two behaviors, depositing and withdrawing money.

       We then extend the basic bank account in the CheckingAccount class. This class adds another attribute, an
       overdraft account. It also adds overdraft protection to the withdraw method. If you try to withdraw more
       than you have, the checking account attempts to reconcile the difference by withdrawing money from the
       overdraft account. (1)

       The first class, <b>BankAccount</b>, introduces a new attribute feature, a default value:

         has 'balance' =&gt; ( isa =&gt; 'Int', is =&gt; 'rw', default =&gt; 0 );

       This says that a <b>BankAccount</b> has a "balance" attribute, which has an "Int" type constraint, a read/write
       accessor, and a default value of 0. This means that every instance of <b>BankAccount</b> that is created will
       have its "balance" slot initialized to 0, unless some other value is provided to the constructor.

       The "deposit" and "withdraw" methods should be fairly self-explanatory, as they are just plain old Perl 5
       OO. (2)

       As you know from the first recipe, the keyword "extends" sets a class's superclass. Here we see that
       <b>CheckingAccount</b> "extends" <b>BankAccount</b>. The next line introduces yet another new attribute feature, class-
       based type constraints:

         has 'overdraft_account' =&gt; ( isa =&gt; 'BankAccount', is =&gt; 'rw' );

       Up until now, we have only seen the "Int" type constraint, which (as we saw in the first recipe) is a
       builtin type constraint. The "BankAccount" type constraint is new, and was actually defined the moment we
       created the <b>BankAccount</b> class itself. In fact, Moose creates a corresponding type constraint for every
       class in your program (3).

       This means that in the first recipe, constraints for both "Point" and "Point3D" were created. In this
       recipe, both "BankAccount" and "CheckingAccount" type constraints are created automatically. Moose does
       this as a convenience so that your classes and type constraint can be kept in sync with one another. In
       short, Moose makes sure that it will just DWIM (4).

       In <b>CheckingAccount</b>, we see another method modifier, the "before" modifier.

         before 'withdraw' =&gt; sub {
             my ( $self, $amount ) = @_;
             my $overdraft_amount = $amount - $self-&gt;balance();
             if ( $self-&gt;overdraft_account &amp;&amp; $overdraft_amount &gt; 0 ) {
                 $self-&gt;overdraft_account-&gt;withdraw($overdraft_amount);
                 $self-&gt;deposit($overdraft_amount);
             }
         };

       Just as with the "after" modifier from the first recipe, Moose will handle calling the superclass method
       (in this case "BankAccount-&gt;withdraw").

       The "before" modifier will (obviously) run <u>before</u> the code from the superclass is run. Here, "before"
       modifier implements overdraft protection by first checking if there are available funds in the checking
       account. If not (and if there is an overdraft account available), it transfers the amount needed into the
       checking account (5).

       As with the method modifier in the first recipe, we could use "SUPER::" to get the same effect:

         sub withdraw {
             my ( $self, $amount ) = @_;
             my $overdraft_amount = $amount - $self-&gt;balance();
             if ( $self-&gt;overdraft_account &amp;&amp; $overdraft_amount &gt; 0 ) {
                 $self-&gt;overdraft_account-&gt;withdraw($overdraft_amount);
                 $self-&gt;deposit($overdraft_amount);
             }
             $self-&gt;SUPER::withdraw($amount);
         }

       The benefit of taking the method modifier approach is we do not need to remember to call
       "SUPER::withdraw" and pass it the $amount argument when writing "CheckingAccount-&gt;withdraw".

       This is actually more than just a convenience for forgetful programmers. Using method modifiers helps
       isolate subclasses from changes in the superclasses. For instance, if <b>BankAccount-&gt;withdraw</b> were to add
       an additional argument of some kind, the version of <b>CheckingAccount-&gt;withdraw</b> which uses
       "SUPER::withdraw" would not pass that extra argument correctly, whereas the method modifier version would
       automatically pass along all arguments correctly.

       Just as with the first recipe, object instantiation uses the "new" method, which accepts named
       parameters.

         my $savings_account = BankAccount-&gt;new( balance =&gt; 250 );

         my $checking_account = CheckingAccount-&gt;new(
             balance           =&gt; 100,
             overdraft_account =&gt; $savings_account,
         );

       And as with the first recipe, a more in-depth example can be found in the
       <u>t/recipes/basics_bankaccount_methodmodifiersandsubclassing.t</u> test file.

</pre><h4><b>CONCLUSION</b></h4><pre>
       This recipe expanded on the basic concepts from the first recipe with a more "real world" use case.

</pre><h4><b>FOOTNOTES</b></h4><pre>
       (1) If  you're  paying  close attention, you might realize that there's a circular loop waiting to happen
           here. A smarter example would have to make sure that we don't accidentally create a loop between  the
           checking account and its overdraft account.

       (2) Note that for simple methods like these, which just manipulate some single piece of data, it is often
           not  necessary  to  write  them  at  all.  For instance, "deposit" could be implemented via the "inc"
           native  delegation  for  counters  -  see  Moose::Meta::Attribute::Native::Trait::Counter  for   more
           specifics, and Moose::Meta::Attribute::Native for a broader overview.

       (3) In  reality, this creation is sensitive to the order in which modules are loaded. In more complicated
           cases, you may find that you need to explicitly declare a class type before the  corresponding  class
           is loaded.

       (4) Moose  does  not attempt to encode a class's is-a relationships within the type constraint hierarchy.
           Instead, Moose just considers the class type constraint to be a subtype of "Object", and  specializes
           the  constraint  check  to  allow for subclasses. This means that an instance of <b>CheckingAccount</b> will
           pass  a  "BankAccount"  type  constraint  successfully.  For  more  details,  please  refer  to   the
           Moose::Util::TypeConstraints documentation.

       (5) If  the  overdraft  account  does  not have the amount needed, it will throw an error. Of course, the
           overdraft account could also have overdraft protection. See note 1.

</pre><h4><b>ACKNOWLEDGMENT</b></h4><pre>
       The BankAccount example in this recipe is directly taken from the examples in this chapter of  "Practical
       Common Lisp":

       &lt;<a href="http://www.gigamonkeys.com/book/object-reorientation-generic-functions.html">http://www.gigamonkeys.com/book/object-reorientation-generic-functions.html</a>&gt;

</pre><h4><b>AUTHORS</b></h4><pre>
       •   Stevan Little &lt;<a href="mailto:stevan@cpan.org">stevan@cpan.org</a>&gt;

       •   Dave Rolsky &lt;<a href="mailto:autarch@urth.org">autarch@urth.org</a>&gt;

       •   Jesse Luehrs &lt;<a href="mailto:doy@cpan.org">doy@cpan.org</a>&gt;

       •   Shawn M Moore &lt;<a href="mailto:sartak@cpan.org">sartak@cpan.org</a>&gt;

       •   יובל קוג'מן (Yuval Kogman) &lt;<a href="mailto:nothingmuch@woobling.org">nothingmuch@woobling.org</a>&gt;

       •   Karen Etheridge &lt;<a href="mailto:ether@cpan.org">ether@cpan.org</a>&gt;

       •   Florian Ragwitz &lt;<a href="mailto:rafl@debian.org">rafl@debian.org</a>&gt;

       •   Hans Dieter Pearcey &lt;<a href="mailto:hdp@cpan.org">hdp@cpan.org</a>&gt;

       •   Chris Prather &lt;<a href="mailto:chris@prather.org">chris@prather.org</a>&gt;

       •   Matt S Trout &lt;<a href="mailto:mstrout@cpan.org">mstrout@cpan.org</a>&gt;

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       This software is copyright (c) 2006 by Infinity Interactive, Inc.

       This  is  free  software;  you  can  redistribute  it and/or modify it under the same terms as the Perl 5
       programming language system itself.

perl v5.40.0                                       2024-10-20             <u>Moose::<a href="../man3pm/Cookbook...sAndSubclassing.3pm.html">Cookbook...sAndSubclassing</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>