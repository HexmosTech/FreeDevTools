<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tcl_Main,  Tcl_MainEx,  Tcl_MainExW,  Tcl_SetStartupScript,  Tcl_GetStartupScript, Tcl_SetMainLoop - main</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/tcl9.0-doc">tcl9.0-doc_9.0.1+dfsg-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Tcl_Main,  Tcl_MainEx,  Tcl_MainExW,  Tcl_SetStartupScript,  Tcl_GetStartupScript, Tcl_SetMainLoop - main
       program, startup script, and event loop definition for Tcl-based applications

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;tcl.h&gt;</b>

       <b>Tcl_Main</b>(<u>argc,</u> <u>argv,</u> <u>appInitProc</u>)

       <b>Tcl_MainEx</b>(<u>argc,</u> <u>charargv,</u> <u>appInitProc,</u> <u>interp</u>)

       <b>Tcl_MainExW</b>(<u>argc,</u> <u>wideargv,</u> <u>appInitProc,</u> <u>interp</u>)

       <b>Tcl_SetStartupScript</b>(<u>path,</u> <u>encoding</u>)

       Tcl_Obj *
       <b>Tcl_GetStartupScript</b>(<u>encodingPtr</u>)

       <b>Tcl_SetMainLoop</b>(<u>mainLoopProc</u>)

</pre><h4><b>ARGUMENTS</b></h4><pre>
       Tcl_Size <u>argc</u> (in)                           Number of elements in <u>argv</u>.

       char <u>*argv[]</u> (in)                            Array  of  strings  containing  command-line  arguments.  On
                                                    Windows, when using -DUNICODE, the parameter type changes to
                                                    wchar_t *.

       char <u>*charargv[]</u> (in)                        As argv, but does not change type to wchar_t.

       char <u>*wideargv[]</u> (in)                        As argv, but type is always wchar_t.

       Tcl_AppInitProc <u>*appInitProc</u> (in)            Address of an application-specific initialization procedure.
                                                    The value for this argument is usually <b>Tcl_AppInit</b>.

       Tcl_Obj <u>*path</u> (in)                           Name of file to use as startup script, or NULL.

       const char <u>*encoding</u> (in)                    Encoding of file to use as startup script, or NULL.

       const char <u>**encodingPtr</u> (out)               If  non-NULL, location to write a copy of the (const char *)
                                                    pointing to the encoding name.

       Tcl_MainLoopProc <u>*mainLoopProc</u> (in)          Address of an application-specific event loop procedure.

       Tcl_Interp <u>*interp</u> (in)                      Already created Tcl Interpreter.
________________________________________________________________________________________________________________

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>Tcl_Main</b> can serve as the main program for Tcl-based shell applications.   A  “shell  application”  is  a
       program  like  tclsh  or  wish  that  supports both interactive interpretation of Tcl and evaluation of a
       script contained in a file given as a command line argument.  <b>Tcl_Main</b> is offered  as  a  convenience  to
       developers  of  shell  applications,  so  they  do  not  have  to  reproduce  all  of the code for proper
       initialization of the Tcl library and interactive shell operation.  Other styles of embedding Tcl  in  an
       application  are  not  supported by <b>Tcl_Main</b>.  Those must be achieved by calling lower level functions in
       the Tcl library directly.

       The <b>Tcl_Main</b> function has been offered by the Tcl library since release Tcl 7.4.  In  older  releases  of
       Tcl,  the  Tcl  library itself defined a function <b>main</b>, but that lacks flexibility of embedding style and
       having a function <b>main</b> in a library (particularly a shared library)  causes  problems  on  many  systems.
       Having  <b>main</b>  in  the  Tcl library would also make it hard to use Tcl in C++ programs, since C++ programs
       must have special C++ <b>main</b> functions.

       Normally each shell application contains a small <b>main</b> function that does  nothing  but  invoke  <b>Tcl_Main</b>.
       <b>Tcl_Main</b> then does all the work of creating and running a <b>tclsh</b>-like application.

       <b>Tcl_Main</b> is not provided by the public interface of Tcl's stub library.  Programs that call <b>Tcl_Main</b> must
       be  linked  against  the  standard  Tcl  library.  If the standard Tcl library is a dll (so, not a static
       .lib/.a) , then the program must be linked against the stub library as well. Extensions (stub-enabled  or
       not) are not intended to call <b>Tcl_Main</b>.

       <b>Tcl_Main</b>  is  not  thread-safe.   It  should  only  be called by a single main thread of a multi-threaded
       application.  This restriction is not a problem with normal use described above.

       <b>Tcl_Main</b> and therefore all applications based upon it, like <b>tclsh</b>, use  <b>Tcl_GetStdChannel</b>  to  initialize
       the standard channels to their default values. See <b>Tcl_StandardChannels</b> for more information.

       <b>Tcl_Main</b>  supports  two  modes  of operation, depending on whether the filename and encoding of a startup
       script has been established.  The routines <b>Tcl_SetStartupScript</b> and <b>Tcl_GetStartupScript</b>  are  the  tools
       for controlling this configuration of <b>Tcl_Main</b>.

       <b>Tcl_SetStartupScript</b>  registers  the  value  <u>path</u> as the name of the file for <b>Tcl_Main</b> to evaluate as its
       startup script.  The value <u>encoding</u> is Tcl's name for the encoding used to store the text in  that  file.
       A value of <b>NULL</b> for <u>encoding</u> is a signal to use the system encoding.  A value of <b>NULL</b> for <u>path</u> erases any
       existing registration so that <b>Tcl_Main</b> will not evaluate any startup script.

       <b>Tcl_GetStartupScript</b>   queries   the   registered   file  name  and  encoding  set  by  the  most  recent
       <b>Tcl_SetStartupScript</b> call in the same thread.  The stored file name is returned, and the stored  encoding
       name is written to space pointed to by <u>encodingPtr</u>, when that is not NULL.

       The  file  name and encoding values managed by the routines <b>Tcl_SetStartupScript</b> and <b>Tcl_GetStartupScript</b>
       are stored per-thread.  Although the storage and retrieval  functions  of  these  routines  work  in  any
       thread, only those calls in the same main thread as <b>Tcl_Main</b> can have any influence on it.

       The  caller  of <b>Tcl_Main</b> may call <b>Tcl_SetStartupScript</b> first to establish its desired startup script.  If
       <b>Tcl_Main</b> finds that no such startup script has been established, it consults the first few  arguments  in
       <u>argv</u>.   If they match ?<b>-encoding</b> <u>name</u>? <u>fileName</u>, where <u>fileName</u> does not begin with the character <u>-</u>, then
       <u>fileName</u> is taken to be the name of a file containing a <u>startup</u> <u>script</u>, and <u>name</u> is taken to be the  name
       of  the  encoding  of  the  contents  of  that file.  <b>Tcl_Main</b> then calls <b>Tcl_SetStartupScript</b> with these
       values.

       <b>Tcl_Main</b> then defines in its main interpreter the Tcl variables <u>argc</u>, <u>argv</u>, <u>argv0</u>,  and  <u>tcl_interactive</u>,
       as described in the documentation for <b>tclsh</b>.

       When  it  has  finished  its  own  initialization,  but  before it processes commands, <b>Tcl_Main</b> calls the
       procedure given by the <u>appInitProc</u> argument.  This procedure provides a “hook”  for  the  application  to
       perform  its  own  initialization  of  the interpreter created by <b>Tcl_Main</b>, such as defining application-
       specific commands.  The application  initialization  routine  might  also  call  <b>Tcl_SetStartupScript</b>  to
       (re-)set the file and encoding to be used as a startup script.  The procedure must have an interface that
       matches the type <b>Tcl_AppInitProc</b>:

              typedef int <b>Tcl_AppInitProc</b>(
                      Tcl_Interp *<u>interp</u>);

       <u>AppInitProc</u>  is  almost  always  a  pointer  to  <b>Tcl_AppInit</b>; for more details on this procedure, see the
       documentation for <b>Tcl_AppInit</b>.

       When the <u>appInitProc</u> is finished, <b>Tcl_Main</b> calls <b>Tcl_GetStartupScript</b> to determine  what  startup  script
       has  been  requested,  if  any.  If a startup script has been provided, <b>Tcl_Main</b> attempts to evaluate it.
       Otherwise, interactive  mode  begins  with  examination  of  the  variable  <u>tcl_rcFileName</u>  in  the  main
       interpreter.   If  that  variable exists and holds the name of a readable file, the contents of that file
       are evaluated in the main interpreter.  Then interactive  operations  begin,  with  prompts  and  command
       evaluation  results  written  to  the  standard output channel, and commands read from the standard input
       channel and then evaluated.  The prompts written to the standard output  channel  may  be  customized  by
       defining  the Tcl variables <u>tcl_prompt1</u> and <u>tcl_prompt2</u> as described in the documentation for <b>tclsh</b>.  The
       prompts and command evaluation results are written to  the  standard  output  channel  only  if  the  Tcl
       variable <u>tcl_interactive</u> in the main interpreter holds a non-zero integer value.

       <b>Tcl_SetMainLoop</b>  allows  setting  an  event loop procedure to be run.  This allows, for example, Tk to be
       dynamically loaded and set its event loop.  The event loop will run following the startup script.  If you
       are in interactive mode, setting the main loop procedure will cause the prompt to become fileevent  based
       and  then the loop procedure is called.  When the loop procedure returns in interactive mode, interactive
       operation will continue.  The  main  loop  procedure  must  have  an  interface  that  matches  the  type
       <b>Tcl_MainLoopProc</b>:

              typedef void <b>Tcl_MainLoopProc</b>(void);

       <b>Tcl_Main</b>  does  not return.  Normally a program based on <b>Tcl_Main</b> will terminate when the <b>exit</b> command is
       evaluated.  In interactive mode, if an EOF or channel error is encountered on the standard input channel,
       then <b>Tcl_Main</b> itself will evaluate the <b>exit</b> command after the main loop procedure (if any)  returns.   In
       non-interactive  mode,  after <b>Tcl_Main</b> evaluates the startup script, and the main loop procedure (if any)
       returns, <b>Tcl_Main</b> will also evaluate the <b>exit</b> command.

       <b>Tcl_Main</b> can not be used in stub-enabled extensions.

       The difference between Tcl_MainEx and Tcl_MainExW is that the arguments are passed as characters or  wide
       characters.  When  used in stub-enabled embedders, the stubs table must be first initialized using one of
       <b>Tcl_InitSubsystems</b>, <b>Tcl_SetPanicProc</b>, <b>Tcl_FindExecutable</b> or <b>TclZipfs_AppHook</b>.

</pre><h4><b>REFERENCE</b> <b>COUNT</b> <b>MANAGEMENT</b></h4><pre>
       <b>Tcl_SetStartupScript</b> takes a value (or NULL) for its <u>path</u> argument,  and  will  increment  the  reference
       count of it.

       <b>Tcl_GetStartupScript</b>  returns  a value with reference count at least 1, or NULL. It's <u>encodingPtr</u> is also
       used (if non-NULL) to return a value with a reference count at least 1, or NULL. In both cases, the owner
       of the values is the current thread.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/tclsh.1.html">tclsh</a>(1),    <a href="../man3tcl/Tcl_GetStdChannel.3tcl.html">Tcl_GetStdChannel</a>(3tcl),    <a href="../man3tcl/Tcl_StandardChannels.3tcl.html">Tcl_StandardChannels</a>(3tcl),    <a href="../man3tcl/Tcl_AppInit.3tcl.html">Tcl_AppInit</a>(3tcl),    <a href="../man3tcl/exit.3tcl.html">exit</a>(3tcl),
       <a href="../man3tcl/encoding.3tcl.html">encoding</a>(3tcl)

</pre><h4><b>KEYWORDS</b></h4><pre>
       application-specific initialization, command-line arguments, main program

Tcl                                                    9.0                                        <u><a href="../man3tcl/Tcl_Main.3tcl.html">Tcl_Main</a></u>(3tcl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>