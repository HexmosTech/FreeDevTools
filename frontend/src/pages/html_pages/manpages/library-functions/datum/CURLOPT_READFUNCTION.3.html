<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CURLOPT_READFUNCTION - read callback for data uploads</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcurl4-doc">libcurl4-doc_8.14.1-1ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       CURLOPT_READFUNCTION - read callback for data uploads

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;curl/curl.h&gt;

       size_t read_callback(char *buffer, size_t size, size_t nitems, void *userdata);

       CURLcode curl_easy_setopt(CURL *handle, CURLOPT_READFUNCTION, read_callback);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Pass a pointer to your callback function, as the prototype shows above.

       This callback function gets called by libcurl as soon as it needs to read data in order to send it to the
       peer  -  like if you ask it to upload or post data to the server. The data area pointed at by the pointer
       <u>buffer</u> should be filled up with at most <u>size</u> multiplied with <u>nitems</u> number of  bytes  by  your  function.
       <u>size</u> is always 1.

       Set the <u>userdata</u> argument with the <u><a href="../man3/CURLOPT_READDATA.3.html">CURLOPT_READDATA</a>(3)</u> option.

       Your  function  must  return the actual number of bytes that it stored in the data area pointed at by the
       pointer <u>buffer</u>. Returning 0 signals end-of-file to  the  library  and  causes  it  to  stop  the  current
       transfer.

       If  you  stop the current transfer by returning 0 "pre-maturely" (i.e before the server expected it, like
       when you have said you would upload N bytes and you upload less than N bytes), you  may  experience  that
       the server "hangs" waiting for the rest of the data that is not sent.

       The  read callback may return <u>CURL_READFUNC_ABORT</u> to stop the current operation immediately, resulting in
       a <u>CURLE_ABORTED_BY_CALLBACK</u> error code from the transfer.

       The callback can return  <u>CURL_READFUNC_PAUSE</u>  to  cause  reading  from  this  connection  to  pause.  See
       <u><a href="../man3/curl_easy_pause.3.html">curl_easy_pause</a>(3)</u> for further details.

       <b>Bugs</b>: when doing TFTP uploads, you must return the exact amount of data that the callback wants, or it is
       considered the final packet by the server end and the transfer ends there.

       If  you set this callback pointer to NULL, or do not set it at all, the default internal read function is
       used. It is doing an fread() on the FILE * userdata set with <u><a href="../man3/CURLOPT_READDATA.3.html">CURLOPT_READDATA</a>(3)</u>.

       You can set the total  size  of  the  data  you  are  sending  by  using  <u><a href="../man3/CURLOPT_INFILESIZE_LARGE.3.html">CURLOPT_INFILESIZE_LARGE</a>(3)</u>  or
       <u><a href="../man3/CURLOPT_POSTFIELDSIZE_LARGE.3.html">CURLOPT_POSTFIELDSIZE_LARGE</a>(3)</u>,  depending  on  the  type  of transfer. For some transfer types it may be
       required and it allows for better error checking.

       When  this  option  is  used  in  combination   with   telling   libcurl   to   follow   redirects   with
       <u><a href="../man3/CURLOPT_FOLLOWLOCATION.3.html">CURLOPT_FOLLOWLOCATION</a>(3)</u>,  the data might need to be rewound and sent again. The <u><a href="../man3/CURLOPT_SEEKFUNCTION.3.html">CURLOPT_SEEKFUNCTION</a>(3)</u>
       can then be invoked for that rewind operation.

</pre><h4><b>DEFAULT</b></h4><pre>
       <a href="../man3/fread.3.html">fread</a>(3)

</pre><h4><b>PROTOCOLS</b></h4><pre>
       This functionality affects all supported protocols

</pre><h4><b>EXAMPLE</b></h4><pre>
       size_t read_callback(char *ptr, size_t size, size_t nmemb, void *userdata)
       {
         FILE *readhere = (FILE *)userdata;
         curl_off_t nread;

         /* copy as much data as possible into the 'ptr' buffer, but no more than
            'size' * 'nmemb' bytes. */
         size_t retcode = fread(ptr, size, nmemb, readhere);

         nread = (curl_off_t)retcode;

         fprintf(stderr, "*** We read %" CURL_FORMAT_CURL_OFF_T
                 " bytes from file\n", nread);
         return retcode;
       }

       int main(int argc, char **argv)
       {
         FILE *file = fopen(argv[1], "rb");
         CURLcode result;

         CURL *curl = curl_easy_init();
         if(curl) {
           /* set callback to use */
           curl_easy_setopt(curl, CURLOPT_READFUNCTION, read_callback);

           /* pass in suitable argument to callback */
           curl_easy_setopt(curl, CURLOPT_READDATA, (void *)file);

           result = curl_easy_perform(curl);
         }
       }

</pre><h4><b>HISTORY</b></h4><pre>
       CURL_READFUNC_PAUSE return code was added in 7.18.0 and CURL_READFUNC_ABORT was added in 7.12.1.

</pre><h4><b>AVAILABILITY</b></h4><pre>
       Added in curl 7.1

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       This returns CURLE_OK.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/CURLOPT_POST.3.html">CURLOPT_POST</a></b>(3),         <b><a href="../man3/CURLOPT_READDATA.3.html">CURLOPT_READDATA</a></b>(3),         <b><a href="../man3/CURLOPT_SEEKFUNCTION.3.html">CURLOPT_SEEKFUNCTION</a></b>(3),         <b><a href="../man3/CURLOPT_UPLOAD.3.html">CURLOPT_UPLOAD</a></b>(3),
       <b><a href="../man3/CURLOPT_UPLOAD_BUFFERSIZE.3.html">CURLOPT_UPLOAD_BUFFERSIZE</a></b>(3), <b><a href="../man3/CURLOPT_WRITEFUNCTION.3.html">CURLOPT_WRITEFUNCTION</a></b>(3)

libcurl                                            2025-06-16                            <u><a href="../man3/CURLOPT_READFUNCTION.3.html">CURLOPT_READFUNCTION</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>