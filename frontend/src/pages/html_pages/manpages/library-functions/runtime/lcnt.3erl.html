<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lcnt - A runtime system Lock Profiling tool.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/erlang-manpages">erlang-manpages_24.2.1+dfsg-1ubuntu0.5_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       lcnt - A runtime system Lock Profiling tool.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <u>lcnt</u>  module  is  used to profile the internal ethread locks in the Erlang Runtime System. With <u>lcnt</u>
       enabled, internal counters in the runtime system are updated each time a  lock  is  taken.  The  counters
       stores  information  about the number of acquisition tries and the number of collisions that has occurred
       during the acquisition tries. The counters also record the waiting time a lock has caused for  a  blocked
       thread when a collision has occurred.

       The  data  produced by the lock counters will give an estimate on how well the runtime system will behave
       from a parallelizable view point for the scenarios tested. This tool was mainly developed to help  Erlang
       runtime developers iron out potential and generic bottlenecks.

       Locks  in  the emulator are named after what type of resource they protect and where in the emulator they
       are initialized, those are lock 'classes'. Most of those locks are also instantiated several  times,  and
       given  unique  identifiers,  to  increase  locking granularity. Typically an instantiated lock protects a
       disjunct set of the resource, for example ets tables, processes or ports. In other cases  it  protects  a
       specific range of a resource, for example <u>pix_lock</u> which protects index to process mappings, and is given
       a  unique  number  within  the  class.  A  unique  lock  in  <u>lcnt</u>  is referenced by a name (class) and an
       identifier: <u>{Name,</u> <u>Id}</u>.

       Some locks in the system are static and  protects  global  resources,  for  example  <u>bif_timers</u>  and  the
       <u>run_queue</u>  locks.  Other  locks are dynamic and not necessarily long lived, for example process locks and
       ets-table locks. The statistics data from short lived locks can be stored separately when the  locks  are
       deleted.   This   behavior  is  by  default  turned  off  to  save  memory  but  can  be  turned  on  via
       <u>lcnt:rt_opt({copy_save,</u> <u>true})</u>. The <u>lcnt:apply/1,2,3</u> functions enables this behavior during profiling.

</pre><h4><b>EXPORTS</b></h4><pre>
       <b>start()</b> <b>-&gt;</b> <b>{ok,</b> <b>Pid}</b> <b>|</b> <b>{error,</b> <b>{already_started,</b> <b>Pid}}</b>

              Types:

                 Pid = pid()

              Starts the lock profiler server. The server only act  as  a  medium  for  the  user  and  performs
              filtering and printing of data collected by <u>lcnt:collect/1</u>.

       <b>stop()</b> <b>-&gt;</b> <b>ok</b>

              Stops the lock profiler server.

       <b>collect()</b> <b>-&gt;</b> <b>ok</b>

              Same as <u>collect(node())</u>.

       <b>collect(Node)</b> <b>-&gt;</b> <b>ok</b>

              Types:

                 Node = node()

              Collects  lock  statistics  from  the  runtime  system.  The function starts a server if it is not
              already started. It then populates the server with lock statistics. If the server  held  any  lock
              statistics data before the collect then that data is lost.

       <b>clear()</b> <b>-&gt;</b> <b>ok</b>

              Same as <u>clear(node())</u>.

       <b>clear(Node)</b> <b>-&gt;</b> <b>ok</b>

              Types:

                 Node = node()

              Clears  the  internal lock statistics from the runtime system. This does not clear the data on the
              server only on runtime system. All counters  for  static  locks  are  zeroed,  all  dynamic  locks
              currently  alive  are  zeroed  and  all  saved locks now destroyed are removed. It also resets the
              duration timer.

       <b>conflicts()</b> <b>-&gt;</b> <b>ok</b>

              Same as <u>conflicts([])</u>.

       <b>conflicts(Options)</b> <b>-&gt;</b> <b>ok</b>

              Types:

                 Options = [option()]
                 <b>option()</b> =
                     {sort, Sort :: sort()} |
                     {reverse, boolean()} |
                     {locations, boolean()} |
                     {thresholds, Thresholds :: [threshold()]} |
                     {print,
                      PrintOptions :: [print() | {print(), integer() &gt;= 0}]} |
                     {max_locks, MaxLocks :: integer() &gt;= 0 | none} |
                     {combine, boolean()}
                 <b>print()</b> =
                     colls | duration | entry | id | name | ratio | time | tries |
                     type
                 <b>sort()</b> =
                     colls | entry | id | name | ratio | time | tries | type
                 <b>threshold()</b> =
                     {colls, integer() &gt;= 0} |
                     {time, integer() &gt;= 0} |
                     {tries, integer() &gt;= 0}

              Prints a list of internal locks and its statistics.

              For option description, see <u>lcnt:inspect/2</u>.

       <b>locations()</b> <b>-&gt;</b> <b>ok</b>

              Same as <u>locations([])</u>.

       <b>locations(Options)</b> <b>-&gt;</b> <b>ok</b>

              Types:

                 Options = [option()]
                 <b>option()</b> =
                     {sort, Sort :: sort()} |
                     {reverse, boolean()} |
                     {locations, boolean()} |
                     {thresholds, Thresholds :: [threshold()]} |
                     {print,
                      PrintOptions :: [print() | {print(), integer() &gt;= 0}]} |
                     {max_locks, MaxLocks :: integer() &gt;= 0 | none} |
                     {combine, boolean()}
                 <b>print()</b> =
                     colls | duration | entry | id | name | ratio | time | tries |
                     type
                 <b>sort()</b> =
                     colls | entry | id | name | ratio | time | tries | type
                 <b>threshold()</b> =
                     {colls, integer() &gt;= 0} |
                     {time, integer() &gt;= 0} |
                     {tries, integer() &gt;= 0}

              Prints a list of internal lock counters by source code locations.

              For option description, see <u>lcnt:inspect/2</u>.

       <b>inspect(Lock)</b> <b>-&gt;</b> <b>ok</b>

              Types:

                 Lock = Name | {Name, Id | [Id]}
                 Name = atom() | pid() | port()
                 Id = atom() | integer() | pid() | port()

              Same as <u>inspect(Lock,</u> <u>[])</u>.

       <b>inspect(Lock,</b> <b>Options)</b> <b>-&gt;</b> <b>ok</b>

              Types:

                 Lock = Name | {Name, Id | [Id]}
                 Name = atom() | pid() | port()
                 Id = atom() | integer() | pid() | port()
                 Options = [option()]
                 <b>option()</b> =
                     {sort, Sort :: sort()} |
                     {reverse, boolean()} |
                     {locations, boolean()} |
                     {thresholds, Thresholds :: [threshold()]} |
                     {print,
                      PrintOptions :: [print() | {print(), integer() &gt;= 0}]} |
                     {max_locks, MaxLocks :: integer() &gt;= 0 | none} |
                     {combine, boolean()}
                 <b>print()</b> =
                     colls | duration | entry | id | name | ratio | time | tries |
                     type
                 <b>sort()</b> =
                     colls | entry | id | name | ratio | time | tries | type
                 <b>threshold()</b> =
                     {colls, integer() &gt;= 0} |
                     {time, integer() &gt;= 0} |
                     {tries, integer() &gt;= 0}

              Prints a list of internal lock counters for a specific lock.

              Lock <u>Name</u> and <u>Id</u> for ports and processes are interchangeable with the use of  <u>lcnt:swap_pid_keys/0</u>
              and  is  the  reason why <u>pid()</u> and <u>port()</u> options can be used in both <u>Name</u> and <u>Id</u> space. Both pids
              and ports are special identifiers with stripped creation and can be  recreated  with  <u>lcnt:pid/2,3</u>
              and <u>lcnt:port/1,2</u>.

              Option description:

                <u>{combine,</u> <u>boolean()}</u>:
                  Combine the statistics from different instances of a lock class.
                  Default: <u>true</u>

                <u>{locations,</u> <u>boolean()}</u>:
                  Print the statistics by source file and line numbers.
                  Default: <u>false</u>

                <u>{max_locks,</u> <u>MaxLocks}</u>:
                  Maximum number of locks printed or no limit with <u>none</u>.
                  Default: <u>20</u>

                <u>{print,</u> <u>PrintOptions}</u>:
                  Printing options:

                  <u>name</u>:
                    Named  lock or named set of locks (classes). The same name used for initializing the lock in
                    the VM.

                  <u>id</u>:
                    Internal id for set of locks, not always unique. This could be table  name  for  ets  tables
                    (db_tab), port id for ports, integer identifiers for allocators, etc.

                  <u>type</u>:
                    Type of lock: <u>rw_mutex</u>, <u>mutex</u>, <u>spinlock</u>, <u>rw_spinlock</u> or <u>proclock</u>.

                  <u>entry</u>:
                    In combination with <u>{locations,</u> <u>true}</u> this option prints the lock operations source file and
                    line number entry-points along with statistics for each entry.

                  <u>tries</u>:
                    Number of acquisitions of this lock.

                  <u>colls</u>:
                    Number  of  collisions  when  a thread tried to acquire this lock. This is when a trylock is
                    EBUSY, a write try on read held rw_lock, a try read on write held rw_lock, a thread tries to
                    lock an already locked lock. (Internal states supervises this).

                  <u>ratio</u>:
                    The ratio between the number of  collisions  and  the  number  of  tries  (acquisitions)  in
                    percentage.

                  <u>time</u>:
                    Accumulated  waiting  time for this lock. This could be greater than actual wall clock time,
                    it is accumulated for all threads. Trylock conflicts does not accumulate time.

                  <u>duration</u>:
                    Percentage of accumulated waiting time of wall clock time. This  percentage  can  be  higher
                    than 100% since accumulated time is from all threads.
                Default: <u>[name,id,tries,colls,ratio,time,duration]</u>

                <u>{reverse,</u> <u>boolean()}</u>:
                  Reverses the order of sorting.
                  Default: <u>false</u>

                <u>{sort,</u> <u>Sort}</u>:
                  Column sorting orders.
                  Default: <u>time</u>

                <u>{thresholds,</u> <u>Thresholds}</u>:
                  Filtering thresholds. Anything values above the threshold value are passed through.
                  Default: <u>[{tries,</u> <u>0},</u> <u>{colls,</u> <u>0},</u> <u>{time,</u> <u>0}]</u>

       <b>information()</b> <b>-&gt;</b> <b>ok</b>

              Prints lcnt server state and generic information about collected lock statistics.

       <b>swap_pid_keys()</b> <b>-&gt;</b> <b>ok</b>

              Swaps places on <u>Name</u> and <u>Id</u> space for ports and processes.

       <b>load(Filename)</b> <b>-&gt;</b> <b>ok</b>

              Types:

                 Filename = file:filename()

              Restores previously saved data to the server.

       <b>save(Filename)</b> <b>-&gt;</b> <b>ok</b>

              Types:

                 Filename = file:filename()

              Saves the collected data to file.

</pre><h4><b>CONVENIENCE</b> <b>FUNCTIONS</b></h4><pre>
       The following functions are used for convenience.

</pre><h4><b>EXPORTS</b></h4><pre>
       <b>apply(Fun)</b> <b>-&gt;</b> <b>term()</b>

              Types:

                 Fun = function()

              Same as <u>apply(Fun,</u> <u>[])</u>.

       <b>apply(Fun,</b> <b>Args)</b> <b>-&gt;</b> <b>term()</b>

              Types:

                 Fun = function()
                 Args = [term()]

              Clears  the  lock  counters and then setups the instrumentation to save all destroyed locks. After
              setup the function is called, passing the elements in <u>Args</u> as arguments. When the function returns
              the statistics are immediately collected to the server. After the collection  the  instrumentation
              is returned to its previous behavior. The result of the applied function is returned.

          <b>Warning:</b>
              This function should only be used for micro-benchmarks; it sets <u>copy_save</u> to <u>true</u> for the duration
              of the call, which can quickly lead to running out of memory.

       <b>apply(Module,</b> <b>Function,</b> <b>Args)</b> <b>-&gt;</b> <b>term()</b>

              Types:

                 Module = module()
                 Function = atom()
                 Args = [term()]

              Same as <u>apply(fun()</u> <u>-&gt;</u> <u>erlang:apply(Module,</u> <u>Function,</u> <u>Args)</u> <u>end)</u>.

       <b>pid(Id,</b> <b>Serial)</b> <b>-&gt;</b> <b>pid()</b>

              Types:

                 Id = Serial = integer()

              Same as <u>pid(node(),</u> <u>Id,</u> <u>Serial)</u>.

       <b>pid(Node,</b> <b>Id,</b> <b>Serial)</b> <b>-&gt;</b> <b>pid()</b>

              Types:

                 Node = node()
                 Id = Serial = integer()

              Creates a process id with creation 0.

       <b>port(Id)</b> <b>-&gt;</b> <b>port()</b>

              Types:

                 Id = integer()

              Same as <u>port(node(),</u> <u>Id)</u>.

       <b>port(Node,</b> <b>Id)</b> <b>-&gt;</b> <b>port()</b>

              Types:

                 Node = node()
                 Id = integer()

              Creates a port id with creation 0.

</pre><h4><b>INTERNAL</b> <b>RUNTIME</b> <b>LOCK</b> <b>COUNTER</b> <b>CONTROLLERS</b></h4><pre>
       The following functions control the behavior of the internal counters.

</pre><h4><b>EXPORTS</b></h4><pre>
       <b>rt_collect()</b> <b>-&gt;</b> <b>[lock_counter_data()]</b>

              Types:

                 <b>lock_counter_data()</b> = term()

              Same as <u>rt_collect(node())</u>.

       <b>rt_collect(Node)</b> <b>-&gt;</b> <b>[lock_counter_data()]</b>

              Types:

                 Node = node()
                 <b>lock_counter_data()</b> = term()

              Returns a list of raw lock counter data.

       <b>rt_clear()</b> <b>-&gt;</b> <b>ok</b>

              Same as <u>rt_clear(node())</u>.

       <b>rt_clear(Node)</b> <b>-&gt;</b> <b>ok</b>

              Types:

                 Node = node()

              Clear the internal counters. Same as <u>lcnt:clear(Node)</u>.

       <b>rt_mask()</b> <b>-&gt;</b> <b>[category_atom()]</b>

              Types:

                 <b>category_atom()</b> = atom()

              Same as <u>rt_mask(node())</u>.

       <b>rt_mask(Node)</b> <b>-&gt;</b> <b>[category_atom()]</b>

              Types:

                 Node = node()
                 <b>category_atom()</b> = atom()

              Refer to <u>rt_mask/2</u>. for a list of valid categories. All categories are enabled by default.

       <b>rt_mask(Categories)</b> <b>-&gt;</b> <b>ok</b> <b>|</b> <b>{error,</b> <b>copy_save_enabled}</b>

              Types:

                 Categories = [category_atom()]
                 <b>category_atom()</b> = atom()

              Same as <u>rt_mask(node(),</u> <u>Categories)</u>.

       <b>rt_mask(Node,</b> <b>Categories)</b> <b>-&gt;</b> <b>ok</b> <b>|</b> <b>{error,</b> <b>copy_save_enabled}</b>

              Types:

                 Node = node()
                 Categories = [category_atom()]
                 <b>category_atom()</b> = atom()

              Sets the lock category mask to the given categories.

              This will fail if the <u>copy_save</u> option is enabled; see <u>lcnt:rt_opt/2</u>.

              Valid categories are:

                * <u>allocator</u>

                * <u>db</u> (ETS tables)

                * <u>debug</u>

                * <u>distribution</u>

                * <u>generic</u>

                * <u>io</u>

                * <u>process</u>

                * <u>scheduler</u>

              This list is subject to change at any time, as is the category any given lock may belong to.

       <b>rt_opt(Option)</b> <b>-&gt;</b> <b>boolean()</b>

              Types:

                 Option = {Type, Value :: boolean()}
                 Type = copy_save | process_locks

              Same as <u>rt_opt(node(),</u> <u>{Type,</u> <u>Value})</u>.

       <b>rt_opt(Node,</b> <b>Option)</b> <b>-&gt;</b> <b>boolean()</b>

              Types:

                 Node = node()
                 Option = {Type, Value :: boolean()}
                 Type = copy_save | process_locks

              Option description:

                <u>{copy_save,</u> <u>boolean()}</u>:
                  Retains the statistics of destroyed locks.
                  Default: <u>false</u>

            <b>Warning:</b>
                This  option  will use a lot of memory when enabled, which must be reclaimed with <u>lcnt:rt_clear</u>.
                Note that it makes no distinction between locks that were destroyed and locks for which counting
                was disabled, so enabling this option will disable changes to the lock category mask.

                <u>{process_locks,</u> <u>boolean()}</u>:
                  Profile process locks, equal to adding <u>process</u> to the lock category mask; see <u>lcnt:rt_mask/2</u>
                  Default: <u>true</u>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       LCNT User's Guide

Ericsson AB                                        tools 3.5.2                                        <u><a href="../man3erl/lcnt.3erl.html">lcnt</a></u>(3erl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>