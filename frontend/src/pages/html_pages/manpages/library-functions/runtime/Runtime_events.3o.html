<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runtime_events - Runtime events - ring buffer-based runtime tracing</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/ocaml-man">ocaml-man_5.3.0-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Runtime_events - Runtime events - ring buffer-based runtime tracing

</pre><h4><b>Module</b></h4><pre>
       Module   Runtime_events

</pre><h4><b>Documentation</b></h4><pre>
       Module <b>Runtime_events</b>
        : <b>sig</b> <b>end</b>

       Runtime events - ring buffer-based runtime tracing

       This  module enables users to enable and subscribe to tracing events from the Garbage Collector and other
       parts of the OCaml runtime. This can be useful for diagnostic or performance  monitoring  purposes.  This
       module can be used to subscribe to events for the current process or external processes asynchronously.

       When  enabled  (either  via  setting  the  OCAML_RUNTIME_EVENTS_START  environment  variable  or  calling
       Runtime_events.start) a file with the pid of the process  and  extension  .events  will  be  created.  By
       default  this  is  in  the  current  directory  but  can  be  over-ridden by the OCAML_RUNTIME_EVENTS_DIR
       environment variable. Each domain maintains its own ring buffer in a section  of  the  larger  file  into
       which it emits events.

       There  is  additionally a set of C APIs in runtime_events.h that can enable zero-impact monitoring of the
       current process or bindings for other languages.

       The runtime events system's behaviour can be controlled by the following environment variables:

       -OCAML_RUNTIME_EVENTS_START if set will cause the runtime events system to be  started  as  part  of  the
       OCaml runtime initialization.

       -OCAML_RUNTIME_EVENTS_DIR  sets  the  directory where the runtime events ring buffers will be located. If
       not present the program's working directory will be used.

       -OCAML_RUNTIME_EVENTS_PRESERVE if set will prevent the OCaml runtime from removing its ring buffers  when
       it terminates. This can help if monitoring very short running programs.

       <u>type</u> <u>runtime_counter</u> =
        | EV_C_FORCE_MINOR_ALLOC_SMALL  (* Triggering of a minor collection due to a full minor heap.

       <b>Since</b> 5.0
        *)
        | EV_C_FORCE_MINOR_MAKE_VECT  (* Triggering of a minor collection due to Array.make.

       <b>Since</b> 5.0
        *)
        | EV_C_FORCE_MINOR_SET_MINOR_HEAP_SIZE  (* Triggering of a minor collection due to Gc.minor_heap_size.

       <b>Since</b> 5.0
        *)
        | EV_C_FORCE_MINOR_MEMPROF  (* Triggering of a minor collection during memprof young sampling.

       <b>Since</b> 5.3
        *)
        |  EV_C_MINOR_PROMOTED   (*  Total  words  promoted  from  the minor heap to the major in the last minor
       collection.

       <b>Since</b> 5.0
        *)
        | EV_C_MINOR_ALLOCATED  (* Total bytes allocated in the minor heap in the last minor collection.

       <b>Since</b> 5.0
        *)
        | EV_C_REQUEST_MAJOR_ALLOC_SHR  (* Major slice requested due to allocation in major heap.

       <b>Since</b> 5.0
        *)
        | EV_C_REQUEST_MAJOR_ADJUST_GC_SPEED  (* Major slice requested by <b>caml_adjust_gc_speed</b> .

       <b>Since</b> 5.0
        *)
        |  EV_C_REQUEST_MINOR_REALLOC_REF_TABLE   (*  Triggering  of  a  minor  collection  due  to  ref   table
       reallocation.

       <b>Since</b> 5.0
        *)
        |  EV_C_REQUEST_MINOR_REALLOC_EPHE_REF_TABLE   (* Triggering of a minor collection due to ephe_ref table
       reallocation.

       <b>Since</b> 5.0
        *)
        | EV_C_REQUEST_MINOR_REALLOC_CUSTOM_TABLE  (* Triggering of a  minor  collection  due  to  custom  table
       reallocation.

       <b>Since</b> 5.0
        *)
        |  EV_C_MAJOR_HEAP_POOL_WORDS   (*  Total  words  in  a  Domain's  major  heap pools. This is the sum of
       unallocated and live words in each pool.

       <b>Since</b> 5.1
        *)
        | EV_C_MAJOR_HEAP_POOL_LIVE_WORDS  (* Current live words in a Domain's major heap pools.

       <b>Since</b> 5.1
        *)
        | EV_C_MAJOR_HEAP_LARGE_WORDS  (* Total words of a Domain's  major  heap  large  allocations.   A  large
       allocation is an allocation larger than the largest sized pool.

       <b>Since</b> 5.1
        *)
        |  EV_C_MAJOR_HEAP_POOL_FRAG_WORDS   (* Words in a Domain's major heap pools lost to fragmentation. This
       is due to there not being a pool with the exact size of an allocation and a larger sized pool needing  to
       be used.

       <b>Since</b> 5.1
        *)
        | EV_C_MAJOR_HEAP_POOL_LIVE_BLOCKS  (* Live blocks of a Domain's major heap pools.

       <b>Since</b> 5.1
        *)
        | EV_C_MAJOR_HEAP_LARGE_BLOCKS  (* Live blocks of a Domain's major heap large allocations.

       <b>Since</b> 5.1
        *)
        | EV_C_MAJOR_HEAP_WORDS  (* Major heap size in words of a Domain.

       <b>Since</b> 5.3
        *)
        |  EV_C_MAJOR_ALLOCATED_WORDS   (* Allocations to the major heap of this Domain in words, since the last
       major slice.

       <b>Since</b> 5.3
        *)
        | EV_C_MAJOR_ALLOCATED_WORK  (* The amount of major GC  'work'  needing  to  be  done  as  a  result  of
       allocations to the major heap of this Domain in words, since the last major slice.

       <b>Since</b> 5.3
        *)
        |  EV_C_MAJOR_DEPENDENT_WORK   (*  The  amount  of  major  GC  'work'  needing to be done as a result of
       dependent allocations to the major heap of this Domain in words, since the last  major  slice.  Dependent
       memory is non-heap memory that depends on heap memory being collected in order to be freed.

       <b>Since</b> 5.3
        *)
        |  EV_C_MAJOR_EXTRA_WORK   (*  The  amount  of  major  GC 'work' needing to be done as a result of extra
       non-memory resources that are dependent on heap memory being collected in order to be freed.

       <b>Since</b> 5.3
        *)
        | EV_C_MAJOR_WORK_COUNTER  (* The global amount of major GC 'work' done by all domains since the program
       began.

       <b>Since</b> 5.3
        *)
        | EV_C_MAJOR_ALLOC_COUNTER  (* The global words of major GC allocations done by all  domains  since  the
       program began.

       <b>Since</b> 5.3
        *)
        |  EV_C_MAJOR_SLICE_TARGET   (* The target amount of global 'work' that should be done by all domains at
       the end of the major slice (see EV_C_MAJOR_SLICE_COUNTER).

       <b>Since</b> 5.3
        *)
        | EV_C_MAJOR_SLICE_BUDGET  (* The budget in 'work' that a domain has to do during the major slice.

       <b>Since</b> 5.3
        *)

       The type for counter events emitted by the runtime. Counter events are used to measure a  quantity  at  a
       point in time or record the occurence of an event.  In the latter case their value will be one.

       <u>type</u> <u>runtime_phase</u> =
        | EV_EXPLICIT_GC_SET  (* Event spanning a call to Gc.set.

       <b>Since</b> 5.0
        *)
        | EV_EXPLICIT_GC_STAT  (* Event spanning a call to Gc.stat.

       <b>Since</b> 5.0
        *)
        | EV_EXPLICIT_GC_MINOR  (* Event spanning a call to Gc.minor, which forces a minor collection.

       <b>Since</b> 5.0
        *)
        | EV_EXPLICIT_GC_MAJOR  (* Event spanning a call to Gc.major, which forces a major collection.

       <b>Since</b> 5.0
        *)
        |  EV_EXPLICIT_GC_FULL_MAJOR   (*  Event  spanning  a  call  to Gc.full_major, which forces a full major
       collection.

       <b>Since</b> 5.0
        *)
        | EV_EXPLICIT_GC_COMPACT  (* Event spanning a call to Gc.compact, which triggers a compaction.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR  (* Event spanning any major GC work.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_SWEEP  (* Event spanning the sweeping work of a major GC.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_MARK_ROOTS  (* Event spanning the marking of roots in a major GC.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_MEMPROF_ROOTS  (* Event spanning the marking of memprof roots in a major GC.

       <b>Since</b> 5.3
        *)
        | EV_MAJOR_MARK  (* Event spanning the marking of the heap in a major GC.

       <b>Since</b> 5.0
        *)
        | EV_MINOR  (* Event spanning any minor GC work.

       <b>Since</b> 5.0
        *)
        | EV_MINOR_LOCAL_ROOTS  (* Event spanning the scanning and major allocation  of  local  roots  during  a
       minor GC.

       <b>Since</b> 5.0
        *)
        | EV_MINOR_MEMPROF_ROOTS  (* Event spanning the scanning and promotion of memprof roots in a minor GC.

       <b>Since</b> 5.3
        *)
        |  EV_MINOR_MEMPROF_CLEAN  (* Event spanning cleaning and updating of memprof structures at the end of a
       minor GC.

       <b>Since</b> 5.3
        *)
        | EV_MINOR_FINALIZED  (* Event spanning the running of finalisers for dead custom blocks at the end of a
       minor GC.

       <b>Since</b> 5.0
        *)
        | EV_EXPLICIT_GC_MAJOR_SLICE  (* Event spanning a call to Gc.major_slice.

       <b>Since</b> 5.0
        *)
        | EV_FINALISE_UPDATE_FIRST  (* Event spanning time spent in the first phase of finalisation at  the  end
       of a major GC cycle.

       <b>Since</b> 5.0
        *)
        |  EV_FINALISE_UPDATE_LAST  (* Event spanning time spent in the last phase of finalisation at the end of
       a major GC cycle.

       <b>Since</b> 5.0
        *)
        | EV_INTERRUPT_REMOTE  (* Event spanning work triggered by an interrupt from  another  domain.  This  is
       usually a stop-the-world request.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_EPHE_MARK  (* Event spanning the marking of ephemeron tables in a major GC.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_EPHE_SWEEP  (* Event spanning the sweeping of ephemeron tables in a major GC.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_FINISH_MARKING  (* Event spanning work done at the end of marking in a major GC.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_GC_CYCLE_DOMAINS  (* Event spanning work done at the end of a major GC cycle. This includes a
       minor collection.

       <b>Since</b> 5.0
        *)
        |  EV_MAJOR_GC_PHASE_CHANGE   (*  Event  spanning  the  change of phase in the major GC which involves a
       global barrier.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_GC_STW  (* Event spanning the stop-the-world phase done at the end of a major GC cycle.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_MARK_OPPORTUNISTIC  (* Event spanning the work done during opportunistic marking in  a  major
       GC.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_SLICE  (* Event spanning the work done during a major slice in a major GC.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_FINISH_CYCLE  (* Event spanning attempts to drive all domains to the end of a major GC cycle.

       <b>Since</b> 5.0
        *)
        |  EV_MINOR_CLEAR  (* Event spanning the cleaning of the minor heap and supporting structures at the end
       of a minor GC.

       <b>Since</b> 5.0
        *)
        | EV_MINOR_FINALIZERS_OLDIFY  (* Event spanning the promotion of finalisers during a minor GC.

       <b>Since</b> 5.0
        *)
        | EV_MINOR_GLOBAL_ROOTS  (* Event spanning the scanning and major allocation of global  roots  during  a
       minor GC.

       <b>Since</b> 5.0
        *)
        |  EV_MINOR_LEAVE_BARRIER   (*  Event  spanning  the time spent in the barrier at the end of a minor GC,
       waiting for all domains to finish their work.

       <b>Since</b> 5.0
        *)
        | EV_STW_API_BARRIER  (* Event spanning the time spent waiting  for  all  other  domains  to  reach  the
       stop-the-world entry barrier.

       <b>Since</b> 5.0
        *)
        |  EV_STW_HANDLER   (* Event spanning the time spent in the stop-the-world handler, including time spent
       in the stop-the-world callback itself.

       <b>Since</b> 5.0
        *)
        | EV_STW_LEADER  (* Event spanning the time spent as the leader of a stop-the-world.

       <b>Since</b> 5.0
        *)
        | EV_MAJOR_FINISH_SWEEPING  (* Event spanning the time spent finishing sweeping when forced to  as  part
       of domain termination.

       <b>Since</b> 5.0
        *)
        |  EV_MAJOR_MEMPROF_CLEAN   (* Event spanning the time spent cleaning memprof structures at the end of a
       major GC.

       <b>Since</b> 5.3
        *)
        | EV_MINOR_FINALIZERS_ADMIN  (* Event spanning finalisers book-keeping at the end of a minor GC.

       <b>Since</b> 5.0
        *)
        | EV_MINOR_REMEMBERED_SET  (* Event spanning the scanning and major allocation of remembered sets during
       a minor GC.

       <b>Since</b> 5.0
        *)
        | EV_MINOR_REMEMBERED_SET_PROMOTE  (* Event spanning the promotion of blocks in the remembered  set  and
       global roots during a minor GC.

       <b>Since</b> 5.0
        *)
        | EV_MINOR_LOCAL_ROOTS_PROMOTE  (* Event spanning the promotion of local roots during a minor GC.

       <b>Since</b> 5.0
        *)
        | EV_DOMAIN_CONDITION_WAIT  (* Event spanning waiting in Condition.wait.

       <b>Since</b> 5.0
        *)
        | EV_DOMAIN_RESIZE_HEAP_RESERVATION  (* Event spanning resizing the domain heap reservation, as a result
       of minor heap size changes.

       <b>Since</b> 5.0
        *)
        | EV_COMPACT  (* Event spanning compaction of the heap during a call to Gc.compact.

       <b>Since</b> 5.2
        *)
        | EV_COMPACT_EVACUATE  (* Event spanning evacuating major GC pools during a compaction.

       <b>Since</b> 5.2
        *)
        |  EV_COMPACT_FORWARD   (*  Event  spanning  the walking of the heap to update changed pointers after an
       evacuation during a compaction.

       <b>Since</b> 5.2
        *)
        | EV_COMPACT_RELEASE  (* Event spanning releasing the evacuated pools at the end of a compaction.

       <b>Since</b> 5.2
        *)

       The type for span events emitted by the runtime.

       <u>type</u> <u>lifecycle</u> =
        | EV_RING_START  (* Event indicating that the Runtime_events ring buffer has been started. Includes  the
       PID of the process as an argument.

       <b>Since</b> 5.0
        *)
        | EV_RING_STOP  (* Event indicating that the Runtime_events ring buffer has been stopped.

       <b>Since</b> 5.0
        *)
        | EV_RING_PAUSE  (* Event indicating that the Runtime_events ring buffer has been paused.

       <b>Since</b> 5.0
        *)
        | EV_RING_RESUME  (* Event indicating that the Runtime_events ring buffer has been resumed.

       <b>Since</b> 5.0
        *)
        |  EV_FORK_PARENT   (*  Event  indicating that a fork has occurred and the current domain is the parent.
       Includes the PID of the child as an argument.

       <b>Since</b> 5.0
        *)
        | EV_FORK_CHILD  (* Event indicating that a fork has occurred and the current domain is the child.

       <b>Since</b> 5.0
        *)
        | EV_DOMAIN_SPAWN  (* Event indicating that a new domain has been spawned. Includes the PID of  the  new
       domain as an argument.

       <b>Since</b> 5.0
        *)
        |  EV_DOMAIN_TERMINATE  (* Event indicating that a domain has terminated. Includes the PID of the domain
       as an argument.

       <b>Since</b> 5.0
        *)

       Lifecycle events for Runtime_events and domains.

       <u>val</u> <u>lifecycle_name</u> : <b>lifecycle</b> <b>-&gt;</b> <b>string</b>

       Return a string representation of a given lifecycle event type.

       <u>val</u> <u>runtime_phase_name</u> : <b>runtime_phase</b> <b>-&gt;</b> <b>string</b>

       Return a string representation of a given runtime phase event type.

       <u>val</u> <u>runtime_counter_name</u> : <b>runtime_counter</b> <b>-&gt;</b> <b>string</b>

       Return a string representation of a given runtime counter type.

       <u>type</u> <u>cursor</u>

       Type of the cursor used when consuming.

       <u>module</u> <u>Timestamp</u> <u>:</u> <b>sig</b> <b>end</b>

       <u>module</u> <u>Type</u> <u>:</u> <b>sig</b> <b>end</b>

       <u>module</u> <u>User</u> <u>:</u> <b>sig</b> <b>end</b>

       <u>module</u> <u>Callbacks</u> <u>:</u> <b>sig</b> <b>end</b>

       <u>val</u> <u>start</u> : <b>unit</b> <b>-&gt;</b> <b>unit</b>

       <b>start</b> <b>()</b> will start the collection of events in the runtime if not already started.

       Events can be consumed by creating a cursor with <b>create_cursor</b> and providing a set  of  callbacks  to  be
       called for each type of event.

       <u>val</u> <u>path</u> : <b>unit</b> <b>-&gt;</b> <b>string</b> <b>option</b>

       If  runtime  events  are  being collected, <b>path</b> <b>()</b> returns <b>Some</b> <b>p</b> where <b>p</b> is a path to the runtime events
       file. Otherwise, it returns None.

       <u>val</u> <u>pause</u> : <b>unit</b> <b>-&gt;</b> <b>unit</b>

       <b>pause</b> <b>()</b> will pause the collection of events in the runtime.  Traces are collected  if  the  program  has
       called <b>Runtime_events.start</b> <b>()</b> or the OCAML_RUNTIME_EVENTS_START environment variable has been set.

       <u>val</u> <u>resume</u> : <b>unit</b> <b>-&gt;</b> <b>unit</b>

       <b>resume</b>  <b>()</b>  will resume the collection of events in the runtime.  Traces are collected if the program has
       called <b>Runtime_events.start</b> <b>()</b> or the OCAML_RUNTIME_EVENTS_START environment variable has been set.

       <u>val</u> <u>create_cursor</u> : <b>(string</b> <b>*</b> <b>int)</b> <b>option</b> <b>-&gt;</b> <b>cursor</b>

       <b>create_cursor</b> <b>path_pid</b> creates a cursor to read from an  runtime_events.   Cursors  can  be  created  for
       runtime_events in and out of process. A runtime_events ring-buffer may have multiple cursors reading from
       it  at  any  point  in  time  and  a  program may have multiple cursors open concurrently (for example if
       multiple consumers want different sets of events). If <b>path_pid</b> is None then a cursor is created  for  the
       current  process.   Otherwise  the  pair  contains  a  string <b>path</b> to the directory that contains the <b>pid</b>
       .events file and int <b>pid</b> for the runtime_events of an external process to monitor.

       <u>val</u> <u>free_cursor</u> : <b>cursor</b> <b>-&gt;</b> <b>unit</b>

       Free a previously created runtime_events cursor.

       <u>val</u> <u>read_poll</u> : <b>cursor</b> <b>-&gt;</b> <b>Callbacks.t</b> <b>-&gt;</b> <b>int</b> <b>option</b> <b>-&gt;</b> <b>int</b>

       <b>read_poll</b> <b>cursor</b> <b>callbacks</b> <b>max_option</b> calls the corresponding functions on <b>callbacks</b> for up to <b>max_option</b>
       events read off <b>cursor</b> 's runtime_events and returns the number of events read.

OCamldoc                                           2025-06-12                                 <u><a href="../man3o/Runtime_events.3o.html">Runtime_events</a></u>(3o)
</pre>
 </div>
</div></section>
</div>
</body>
</html>