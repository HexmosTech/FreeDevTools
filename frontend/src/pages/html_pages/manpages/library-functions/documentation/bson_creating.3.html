<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bson_creating - Creating a BSON Document</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/libbson-doc">libbson-doc_1.21.0-1build1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       bson_creating - Creating a BSON Document

</pre><h4><b>THE</b> <b>BSON_T</b> <b>STRUCTURE</b></h4><pre>
       BSON  documents  are  created using the <b>bson_t</b> structure. This structure encapsulates the necessary logic
       for encoding using the <u>BSON</u> <u>Specification</u>. At the core, <b>bson_t</b> is a buffer manager and  set  of  encoding
       routines.

       <b>TIP:</b>
          BSON  documents  can live on the stack or the heap based on the performance needs or preference of the
          consumer.

       Let's start by creating a new BSON document on the stack. Whenever using libbson, make sure you  <b>#include</b>
       <b>&lt;bson/bson.h&gt;</b>.

          bson_t b;

          bson_init (&amp;b);

       This creates an empty document. In JSON, this would be the same as <b>{}</b>.

       We  can  now  proceed  to  adding  items  to  the  BSON  document.  A  variety of functions prefixed with
       <b>bson_append_</b> can be used based on the type of field you want to append.  Let's  append  a  UTF-8  encoded
       string.

          bson_append_utf8 (&amp;b, "key", -1, "value", -1);

       Notice  the  two  <b>-1</b> parameters. The first indicates that the length of <b>key</b> in bytes should be determined
       with <b>strlen()</b>. Alternatively, we could have passed the number <b>3</b>. The same goes for the second <b>-1</b>, but for
       <b>value</b>.

       Libbson provides macros to make this less tedious when using string literals. The following  two  appends
       are identical.

          bson_append_utf8 (&amp;b, "key", -1, "value", -1);
          BSON_APPEND_UTF8 (&amp;b, "key", "value");

       Now let's take a look at an example that adds a few different field types to a BSON document.

          bson_t b = BSON_INITIALIZER;

          BSON_APPEND_INT32 (&amp;b, "a", 1);
          BSON_APPEND_UTF8 (&amp;b, "hello", "world");
          BSON_APPEND_BOOL (&amp;b, "bool", true);

       Notice  that we omitted the call to <b>bson_init()</b>. By specifying <b>BSON_INITIALIZER</b> we can remove the need to
       initialize the structure to a base state.

</pre><h4><b>SUB-DOCUMENTS</b> <b>AND</b> <b>SUB-ARRAYS</b></h4><pre>
       To   simplify   the   creation   of   sub-documents   and   arrays,   <b>bson_append_document_begin()</b>    and
       <b>bson_append_array_begin()</b>  exist.  These  can  be used to build a sub-document using the parent documents
       memory region as the destination buffer.

          bson_t parent;
          bson_t child;
          char *str;

          bson_init (&amp;parent);
          bson_append_document_begin (&amp;parent, "foo", 3, &amp;child);
          bson_append_int32 (&amp;child, "baz", 3, 1);
          bson_append_document_end (&amp;parent, &amp;child);

          str = bson_as_canonical_extended_json (&amp;parent, NULL);
          printf ("%s\n", str);
          bson_free (str);

          bson_destroy (&amp;parent);

          { "foo" : { "baz" : 1 } }

</pre><h4><b>SIMPLIFIED</b> <b>BSON</b> <b>C</b> <b>OBJECT</b> <b>NOTATION</b></h4><pre>
       Creating BSON documents by hand can be tedious and time consuming. BCON, or BSON C Object  Notation,  was
       added  to  allow  for  the  creation  of  BSON documents in a format that looks closer to the destination
       format.

       The following example shows the use of BCON. Notice that values for fields  are  wrapped  in  the  <b>BCON_*</b>
       macros. These are required for the variadic processor to determine the parameter type.

          bson_t *doc;

          doc = BCON_NEW ("foo",
                          "{",
                          "int",
                          BCON_INT32 (1),
                          "array",
                          "[",
                          BCON_INT32 (100),
                          "{",
                          "sub",
                          BCON_UTF8 ("value"),
                          "}",
                          "]",
                          "}");

       Creates the following document

          { "foo" : { "int" : 1, "array" : [ 100, { "sub" : "value" } ] } }

</pre><h4><b>AUTHOR</b></h4><pre>
       MongoDB, Inc

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2017-present, MongoDB, Inc

1.21.0                                            Feb 09, 2022                                  <u><a href="../man3/BSON_CREATING.3.html">BSON_CREATING</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>