<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UILib_intro — User interface library intro</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcanna1g-dev">libcanna1g-dev_3.7p3-25_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       UILib_intro — User interface library intro

</pre><h4><b>DESCRIPTION</b></h4><pre>
       User  interface  libraries  are  responding  to  one-chracter  or  one-key input, return various kinds of
       information.  They include the unfixed character string, fixed character string, marked segment position,
       status display character string, and candidate list character string.

       The application program displays the data according to the returned information.   It  can  also  control
       mode  transition  by triggering through something other than key pressing (for example, selection through
       the mouse).

       The user interface library provides <u>jrKanjiString</u> and <u>jrKanjiControl</u> for the input through the  TTY.   It
       also provides <u>XLookupKanjiString</u> and <u>XKanjiControl</u> for the input through the X window.

       Use of the user interface library requires the following:

       -  Through the TTY:

          Function            jrKanjiString, jrKanjiControl

          Header file         canna/jrkanji.h

          Library             libcanna.a, libcanna.so

       -  Through the X window:

          Function            XLookupKanjiString, XKanjiControl

          Header file         canna/kanji.h

          Library             libXn.a, libXn.so, libcanna.a, libcanna.so

</pre><h4><b>Outline</b></h4><pre>
       jrKanjiString       Converts  ordinary  keyboard  input  (input through the TTY, input with X) into Kanji
                           strings.

       jrKanjiControl      Executes the control with jrKanjiString according to the specified parameters.

       XLookupKanjiString  Converts the keyboard input (key event) into Kanji strings in the X window system.

       XKanjiControl       Executes the control with XLookupKanjiString according to the specified parameters.

                                                                                                   <u><a href="../man3/UILIBINTRO.3.html">UILIBINTRO</a></u>(3)
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────
<u><a href="../man3/JRKANJISTRING.3.html">JRKANJISTRING</a></u>(3)                            Library Functions Manual                            <u><a href="../man3/JRKANJISTRING.3.html">JRKANJISTRING</a></u>(3)

</pre><h4><b>NAME</b></h4><pre>
       jrKanjiString — Kana-to-Kanji Conversion for ordinary keyboard input

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;canna/jrkanji.h&gt;</b>
       <b>int</b> <b>jrKanjiString(</b><u>context_id,</u> <u>ch,</u> <u>buffer_return,</u> <u>bytes_buffer,</u> <u>kanji_status_return</u><b>)</b>
       <b>int</b> <u>context_id</u><b>;</b>
       <b>int</b> <u>ch</u><b>;</b>
       <b>char</b> <u>*buffer_return</u><b>;</b>
       <b>int</b> <u>bytes_buffer</u><b>;</b>
       <b>jrKanjiStatus</b> <u>*kanji_status_return</u><b>;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>jrKanjiString</u> converts ordinary keyboard input (input through the TTY, input with X) into Kanji strings.

       <u>jrKanjiString</u> is a convenient routine which returns the character strings to be  displayed.   To  convert
       the  key input represented in ASCII code, into the Japanese characters, <u>jrKanjiString</u> specifies the input
       key code using <u>ch</u>.  Romaji-to-Kana or Kana-to-Kanji Conversion is executed in <u>jrKanjiString</u>.

       For a  function  or  cursor  key,  specify  a  special  code  (listed  in  <b>``FUNCTION</b>  <b>KEYS''</b>  below)  to
       <u>jrKanjiString</u>.  Do not specify the sequence caused by the key.

       For  the  context identifier specified in <u>context_id</u>, the value is not used as it is.  Instead, a context
       that uses the context identifier as the key is created and  used.   Thus,  the  application  program  may
       specify  any  value for the context identifier to be specified for <u>jrKanjiString</u>.  It is recommended that
       the input port's file descriptor be specified for this identifier.  If 0 is specified for the identifier,
       the context prepared as the system default will be used by way of exception.

       It is recommended that 0 be specified unless particular consideration  is  given  to  the  context.   The
       intermediate result to be displayed is returned to the application through <u>kanji_status_return</u>.

       Responding to the input, it is necessary to display the intermediate result of Romaji-to-Kana or Kana-to-
       Kanji  Conversion.   The  application  must  display the intermediate result according to the information
       returned by <u>kanji_status_return</u>, which is a jrKanjiStatus type structure.

       The jrKanjiStatus structure is defined as follows:

       typedef struct {
         unsigned char *echoStr; /* Character string for local echo */
         int           length;   /* Length of the local echo character string */
         int           revPos;   /* Offset to the reverse display field
                                    within local echo character string */
         int           revLen;   /* Length of the reverse display within
                                    local echo echo character string */
         unsigned long info;     /* Other information */
         unsigned char *mode;    /* Mode information */
         struct {
           unsigned char *line;  /* Candidate list character string */
           int           length; /* Length of candidate list character string */
           int           revPos; /* Offset to the reverse display field
                                    within candidate list character string */
           int           revLen; /* Length of reverse display field within
                                    candidate list character string */
         } gline;                /* Information about the candidate list*/
       } jrKanjiStatus;

       When Kana-to-Kanji conversion is used during Japanese input, information  such  as  the  readings  to  be
       converted  need  to  be  echoed (local echo).  <u>jrKanjiString</u> does not perform display such as local echo.
       Instead, it returns the character strings to be submitted to local echo, to the application by using  the
       jrKanjiStatus structure.

       The  EUC  character  strings to be submitted to local echo include characters already converted into Kana
       from Romaji and conversion candidate characters.  Until the conversion is fixed, they are returned by the
       <u>echoStr</u> member.  At this time, the length of local echo  character  string  is  returned  by  the  <u>length</u>
       member.   Also,  the  starting  position  and  length (bytes) of reverse display area are returned by the
       <u>revPos</u> and <u>revLen</u> member, respectively.   The  buffer  for  local  echo  character  strings  is  reserved
       automatically  by  <u>jrKanjiString</u>.  It must be used only for reading.  No character string must be written
       into this buffer.

       If no character string is to be submitted to local echo, 0 will be returned by the <u>length</u> member.

       The contents to be submitted to local echo may be the same as when <u>jrKanjiString</u> was  previously  called.
       (This  occurs,  for  example,  when a control code is pressed and the key is disabled.)  In this case, -1
       returns to the <u>length</u> member.

       Mode changes and existence of information about the candidate list are passed by  the  <u>info</u>  member.   If
       <u>info</u>  member's KanjiModeInfo bit is on, the character string indicating the new mode will return to <u>mode</u>.
       If the <u>info</u> member's KanjiGLineInfo bit is on, the <u>gline</u> structure has contained information such as  the
       candidate list.

       The  character  string  for  candidate  list  display  returns to the <u>gline</u> structure's line member.  The
       length, reverse dispaly starting position, and reverse display duration of the candidate  list  character
       string return to the <u>gline</u> structure's <u>line</u>, <u>revPos</u>, and <u>revLen</u>, respectively.

       If there is an EUC character string fixed during conversion, it will be stored into buffer <u>buffer_return</u>.
       In  this  case,  the  length (bytes) of this character string will return. If there is no fixed character
       string, the return value will be 0.  Using <u>bytes_buffer</u>, specify the  size  of  the  buffer  that  is  to
       contain  the  fixed  character  string  (<u>buffer_return</u>).   If  the  fixed character string is longer than
       <u>bytes_buffer</u>, only the <u>bytes_buffer</u> substring is stored into <u>buffer_return</u>.   In  this  case,  the  value
       specified in <u>bytes_buffer</u> will be the return value of <u>jrKanjiString</u>.

</pre><h4><b>FUNCTION</b> <b>KEYS</b></h4><pre>
       For  any  function key that issue an Escape sequence, specify one of the following codes as <u>ch</u> instead of
       the Escape sequence:

       Logical name
                   Code

       Nfer        CANNA_KEY_Nfer

       Xfer        CANNA_KEY_Xfer

       Up          CANNA_KEY_Up

       Left        CANNA_KEY_Left

       Right       CANNA_KEY_Right

       Down        CANNA_KEY_Down

       Insert      CANNA_KEY_Insert

       Rollup      CANNA_KEY_Rollup

       Rolldown    CANNA_KEY_Rolldown

       Home        CANNA_KEY_Home

       Help        CANNA_KEY_Help

       S-Nfer      CANNA_KEY_Shift_Nfer

       S-Xfer      CANNA_KEY_Shift_Xfer

       S-Up        CANNA_KEY_Shift_Up

       S-Left      CANNA_KEY_Shift_Left

       S-Right     CANNA_KEY_Shift_Right

       S-Down      CANNA_KEY_Shift_Down

       C-Nfer      CANNA_KEY_Control_Nfer

       C-Xfer      CANNA_KEY_Control_Xfer

       C-Up        CANNA_KEY_Control_Up

       C-Left      CANNA_KEY_Control_Left

       C-Right     CANNA_KEY_Control_Right

       C-Down      CANNA_KEY_Control_Down

       F1          CANNA_KEY_F1

       PF1         CANNA_KEY_PF1

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man3/jrKanjiControl.3.html">jrKanjiControl</a>(3)

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       If an error occurs during input processing, -1 will return as the return value of this function.  In this
       case, the error message will be stored in external variable (char*)jrKanjiError.

       If a call to this function causes a character string to be fixed, the length (bytes)  of  this  character
       string will return.  Otherwise, 0 will return.

                                                                                                <u><a href="../man3/JRKANJISTRING.3.html">JRKANJISTRING</a></u>(3)
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────
<u><a href="../man3/JRKANJICONTROL.3.html">JRKANJICONTROL</a></u>(3)                           Library Functions Manual                           <u><a href="../man3/JRKANJICONTROL.3.html">JRKANJICONTROL</a></u>(3)

</pre><h4><b>NAME</b></h4><pre>
       jrKanjiControl — Control the jrKanjiControl modes and processes

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;canna/jrkanji.h&gt;</b>
       <b>int</b> <b>jrKanjiControl(</b><u>context_id,</u> <u>request,</u> <u>arg</u><b>)</b>
       <b>int</b> <u>context_id</u><b>;</b>
       <b>int</b> <u>request</u><b>;</b>
       <b>char</b> <u>*arg</u><b>;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>jrKanjiControl</u>   executes  process  request  for  conversion  context  <u>context_id</u>.   Some  processes  are
       accompanied by the argument, specified in <u>arg</u>.

       <u>jrKanjiControl</u> controls the following 13 functions:

       <u>request</u> name      Function

       KC_INITIALIZE     Initializes Kana-to-Kanji conversion.

       KC_CHANGEMODE     Changes the input mode.

       KC_SETWIDTH       Specifies the width used to display the candidate

       KC_FINALIZE       Finalizes (terminates) Kana-to-Kanji conversion processing.

       KC_SETUNDEFKEYFUNCTION
                         Sets a function for an undefined key.

       KC_SETMODEINFOSTYLE
                         Specifies whether mode information is represented in numeric form.

       KC_KAKUTEI        Fixes the currently entered character string.

       KC_KILL           Deletes the currently entered character string.

       KC_QUERYMODE      Queries about the current mode.

       KC_SETSERVERNAME  Specifies the server to be connected.

       KC_SETINITFILENAME
                         Specifies the customize file.

       KC_CLOSEUICONTEXT Closes the context.

       KC_QUERYMAXMODESTR
                         Obtains the maximum length of mode display character string.

       Basically, <u>jrKanjiControl</u> is enabled only for something specified in the context.   This  rule  does  not
       apply to the initialize and terminate processes.

       The  unfixed  character  string  condition  may change, or details of the mode may vary, depending on the
       <u>jrKanjiControl</u> operation.  If this may occur, pass the pointer to a structure that can contain the varied
       information in the <u>arg</u> field.  This structure is defined as follows:

       typedef struct {
         int      val;          /* The length of the character string in the
                                   buffer returns. */
         unsigned char *buffer; /* Specifies the buffer used to store the
                                   fixed character string. */
         int      bytes_buffer; /* Specifies the size of the above buffer. */
         jrKanjiStatus *ks;     /* Pointer to the structure that contains
                                   information about the unfixed character string. */
       } jrKanjiStatusWithValue;

       The <u>jrKanjiControl</u> functions can be executed in the following ways:

       (1)   KC_INITIALIZE — Initializes Kana-to-Kanji conversion.

             KC_INITIALIZE initializes Kana-to-Kanji conversion  by  specifying  KC_INITIALIZE  in  the  <u>request</u>
             field.   Specify  one of the following in arg: (1) the pointer to the char ** type variable used to
             store the warning message and (2) NULL.

             The initialize process is basically executed automatically when <u><a href="../man3/jrKanjiString.3.html">jrKanjiString</a></u>(3) is  first  called.
             This is skipped by using <u>jrKanjiControl</u> for initialization.

             For  example,  when  control about Kana-to-Kanji conversion is executed using <u>jrKanjiControl</u> before
             use of <u><a href="../man3/jrKanjiString.3.html">jrKanjiString</a></u>(3), Kana-to-Kanji conversion must be initialized.

             When the process terminates normally, 0 returns  as  the  <u>jrKanjiControl</u>  return  value.   When  it
             terminates abnormally, -1 returns.

             When  KC_INITIALIZE  is  executed, a warning, rather than an error, may occur.  When it occurs, the
             pointer to the warning character string array is stored in and returns to the variable specified in
             <u>arg</u>.  If no warning occurs, NULL is stored and returns.

             (Example)
               int res; /* Prepare for error return */
               char **warning;
               .....
               res = jrKanjiControl(0, KC_INITIALIZE, &amp;warning);
               if (warning) {
                 char **p;

                 for (p = warning ; *p ; p++) {
                   fprintf(stderr, "%s0, *p);
                 }
               }

             In the library, malloc is done for the warning message  returning  to  the  third  argument.   This
             message  is  freed  when KC_INITIALIZE or KC_FINALIZE is executed next.  The application programmer
             must not free it.  The maximum number of warning messages is restricted to 64 now.  The  subsequent
             ones are discarded.

             The following warnings may be included in a message:

             -  All customize files including those of the system are unavailable.

             -  The customize file contains a syntax error.

             -  The Romaji-to-Kana conversion dictionary is unavailable.

             -  The Kana-to-Kanji conversion dictionary is unavailable.

             -  Connection to the Kana-to-Kanji conversion server is disabled.

             If NULL is specified as the third argument, any warning message will be discarded.

       (2)   KC_CHANGEMODE — Changes the input mode.

             KC_CHANGEMODE  changes  the  input mode from the application.  Specify KC_CHANGEMODE in the <u>request</u>
             field.  Specify the jrKanjiStatusWithValue structure in <u>arg</u>.

             The  Japanese  mode  is  changed  by  specifying  the  mode  number  with   the   <u>val</u>   member   of
             jrKanjiStatusWithValue structure.  The mode number is indicated by the following macros:

             Macro number            Mode

             CANNA_MODE_AlphaMode    Alphabet mode

             CANNA_MODE_HenkanMode   Conversion input mode

             CANNA_MODE_KigoMode     Symbol input mode

             CANNA_MODE_ZenHiraKakuteiMode
                                     Full-wide Hiragana fixed input mode

             CANNA_MODE_ZenKataKakuteiMode
                                     Full-wide Katakana fixed mode

             CANNA_MODE_HanKataKakuteiMode
                                     Half-wide Katakana fixed input mode

             CANNA_MODE_ZenAlphaKakuteiMode
                                     Full-wide alphabet fixed input mode

             CANNA_MODE_HanAlphaKakuteiMode
                                     Half-wide alphabet fixed input mode

             CANNA_MODE_HexMode      Hexadecimal code input mode

             CANNA_MODE_BushuMode    Bushu input mode

             CANNA_MODE_TorokuMode   Word register mode

             This  function  causes  much  dispaly  (mode  name etc.) to vary in response to a mode change.  The
             display change is returned by the jrKanjiStatusWithValue structure specified as <u>arg</u>.

             (Example)
               jrKanjiStatus ks;
               jrKanjiStatusWithValue ksv;
               unsigned char buf[SOMESIZE];
               .....
               ksv.ks = &amp;ks;
               ksv.buffer = buf;
               ksv.bytes_buffer = SOMESIZE;
               ksv.val = CANNA_MODE_HexMode;

               jrKanjiControl(context, KC_CHANGEMODE, &amp;ksv);
               len = ksv.val;
               .....

             /* Information about the unfixed or fixed character string is returned
                by ksv. */

       (3)   KC_SETWIDTH — Specifies the width used to display the candidate list.

             KC_SETWIDTH specifies the number of columns of the area on  which  the  candidate  list  is  to  be
             displayed.  The width of one column equals that of an alphabetical or half-wide Katakana character.
             Each  full-wide  Kanji  character  occupies  two  columns.  Using KC_SETWIDTH, specify the width of
             candidate list display area to be specified in the <u>request</u> field.  At this time, specify the number
             of columns in <u>arg</u>.

             (Example)
               jrKanjiControl(0, KC_SETWIDTH, (char *)60);

       (4)   KC_FINALIZE — Finalizes (terminates) processing of Kana-to-Kanji conversion

             KC_FINALIZE specifies that Kana-to-Kanji conversion also finalizes (terminates) at the end  of  the
             program and in other cases.
              Be  sure  to  execute  this  process  when  terminating  Kana-to-Kanji conversion processing.  All
             contents learned up to now are registered in the file.  Specify KC_FINALIZE in the <u>request</u> field.

             When the process terminates normally, 0 returns.  When it terminates abnormally, -1 returns.

             When KC_FINALIZE is executed, a warning, rather than an error, may  occur.   When  it  occurs,  the
             pointer to the warning character string array is stored in and returns to the variable specified in
             <u>arg</u>.  If no warning occurs, NULL is stored and returns.

             (Example)
               int res; /* Prepare for error return */
               char **warning;
               .....
               res = jrKanjiControl(0, KC_FINALIZE, &amp;warning);
               if (warning) {
                 char **p;

                 for (p = warning ; *p ; p++) {
                   fprintf(stderr, "%s0, *p);
                 }
               }

             In  the  library,  malloc  is  done  for the warning message returning to the third argument.  This
             message is freed when KC_INITIALIZE or KC_FINALIZE is executed next.   The  application  programmer
             must not free it.

             The maximum number of warning messages is restricted to 64 now.  The subsequent ones are discarded.

             The following warning may be included in a message:

             -  The dictionary cannot be unmounted.

             If NULL is specified as the third argument, any warning message will be discarded.

       (5)   KC_SETUNDEFKEYFUNCTION — Sets a function for an undefined key.

             For  example, if you press CTRL-t during input of a reading, it is regarded as undefined key input.
             The following processes are executed, responding to undefined key input:

             Macro name  Process

             kc_normal   Beep

             kc_through  Passes the input to the application

             kc_kakutei  Fixes the input and passes it to the application program.

             kc_kill     Deletes the input and passes it to the application program.

             If kc_normal is specified, the function set in external variable jrBeepFunc is called automatically
             by the library when an undefined key is input.  If the value is  not  set  in  jrBeepFunc,  nothing
             occurs when ``jrBeepFunc == NULL'' appears.

             (Example)
               extern (*jrBeepFunc)(), beep();

               jrBeepFunc = beep;
               jrKanjiControl(0, KC_SETUNDEFKEYFUNCTION, kc_normal);

       (6)   KC_SETMODEINFOSTYLE — Specifies mode information representation.

             You  may  want  to  display  mode  information with data such as the bit map, rather than character
             strings.  In this case, return of numeric data as mode information helps you execute  the  process.
             Specify  KC_SETMODEINFOSTYLE  in  <u>jrKanjiControl</u>,  and  pass  1  to <u>arg</u>.  After this, one character
             representing the mode code (numeric) plus ´@' (0x40) returns to the jrKanjiStatus structure's  <u>mode</u>
             member.   To  convert the value into the mode code, subtract '@' (0x40) from the returned character
             string.  For the mode codes, see the mode change description of Item (2) KC_CHANGEMODE.

       (7)   KC_KAKUTEI, (8) KC_KILL — Kill the currently input character string.

             You may want to relinquish the currently entered character string for some reason.  There  are  two
             relinquishing  methods.   One  is  to relinquish the character string after including the currently
             entered character string as a fixed one.  The other is to discard the character  string  completely
             then  relinquish  it.   For the first method, specify KC_KAKUTEI in <u>jrKanjiControl</u>.  For the second
             method, specify KC_KILL.

             Each of the above influences the display.  The jrKanjiStatusWithValue must thus be specified as the
             third argument.

             (Example)
               jrKanjiStatusWithValue ksv;
               jrKanjiStatus ks;
               unsigned char buf[SOMESIZE];
               .....
               ksv.ks = &amp;ks;
               ksv.buffer = buf;
               ksv.bytes_buffer = SOMESIZE;

               jrKanjiControl(context, KC_KAKUTEI, &amp;ksv);
               len = ksv.val;
               .....

       (9)   KC_QUERYMODE — Inquiry about the mode

             To inquire about the current mode, specify KC_QUERYMODE in <u>jrKanjiControl</u>.

             Specify the pointer to the character array in which the mode character string is to be stored.  The
             mode character string is a character string ending with a null  character.   To  return  a  numeric
             here, specify KC_SETMODEINFOSTYLE in <u>jrKanjiControl</u> to change the mode character string style.

             (Example)
               char currentMode[MAXMODELEN];
               .....
               jrKanjiControl(0, KC_QUERYMODE, currentMode);
               .....

       (10)  KC_SETSERVERNAME   Specifies the server to be connected.

             KC_SETSERVERNAME  enables you to switch the Kana-to-Kanji conversion server without terminating the
             application program.  To set the server to connect as the Kana-to-Kanji conversion server,  specify
             KC_SETSERVERNAME  in  <u>jrKanjiControl</u>.   In the third argument, specify the name of the server to be
             connected.

       (11)  KC_SETINITFILENAME — Specifies the customize file.

             KC_SETINITFILENAM enables the application program to change the  customize  file.   To  change  the
             customize  file,  specify  KC_SETINITFILENAME  as  the  second argument and the file name character
             string as the third argument.  This process must be executed before KC_INTIALIZE.

             (Example)
               char *inifile = "app-own.canna"
               .....
               jrKanjiControl(0, KC_SETINITFILENAME, initfile);
               .....

       (12)  KC_CLOSEUICONTEXT   Closes the context.

             Any integer may be assigned as the context ID that represents the conversion context.  A context ID
             that has never been used can be  assigned  to  <u>jrKanjiString</u>  or  <u>jrKanjiControl</u>.   In  this  case,
             initialization for this context is executed to reserve the required memory.

             If  an  input  port  used  up  to now is not used, you may want to free the memory reserved for the
             context ID assigned to this port.  To do so, call <u>jrKanjiControl</u> by specifying KC_CLOSEUICONTEXT as
             the second argument.

             Because this  process  causes  a  display  change,  specify  jrKanjiStatusWithValue  as  the  third
             structure.

             (Example)
               jrKanjiStatusWithValue ksv;
               jrKanjiStatus ks;
               unsigned char buf[SOMESIZE];
               .....
               ksv.ks = &amp;ks;
               ksv.buffer = buf;
               ksv.bytes_buffer = SOMESIZE;

               jrKanjiControl(0, KC_CLOSEUICONTEXT, &amp;ksv);
               .....

       (13)  KC_QUERYMAXMODESTR — Obtains the maximum length of mode display character string.

             The  mode display character string can be customized using the initialize file.  It is necessary to
             examine the size of the display area (in the customized resulting mode  display  character  string)
             that   is   to  be  reserved.   Specify  KC_QUERYMAXMODESTR  as  the  second  argument,  then  call
             <u>jrKanjiControl</u>.  As a result, the number of columns necessary for the mode display character string
             is returned.  The number of columns is represented,  defining  that  the  width  of  one  half-wide
             alphanumeric character is 1.

             The third argument is unused; dummy value 0 is assigned to it.

             (Example)
               int max_mode_columns;
               .....
               max_mode_columns = jrKanjiControl(0, KC_QUERYMAXMODESTR, 0);
               .....

                                                                                               <u><a href="../man3/JRKANJICONTROL.3.html">JRKANJICONTROL</a></u>(3)
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────
<u><a href="../man3/XLookupKanjiString.3.html">XLookupKanjiString</a></u>(3)                       Library Functions Manual                       <u><a href="../man3/XLookupKanjiString.3.html">XLookupKanjiString</a></u>(3)

</pre><h4><b>NAME</b></h4><pre>
       XLookupKanjiString — Converts the keyboard input into Kanji

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;X11/Xlib.h&gt;</b>
       <b>#include</b> <b>&lt;X11/kanji.h&gt;</b>

       <b>int</b>
       <b>XLookupKanjiString(</b><u>event_struct,</u> <u>buffer_return,</u> <u>bytes_buffer,</u>
                          <u>keysym_return,</u> <u>status_return,</u> <u>kanji_status_return</u><b>)</b>
               <b>XKeyEvent</b> <u>*event_struct</u><b>;</b>
               <b>char</b> <u>*buffer_return</u><b>;</b>
               <b>int</b> <u>bytes_buffer</u><b>;</b>
               <b>KeySym</b> <u>*keysym_return</u><b>;</b>
               <b>XComposeStatus</b> <u>*status_return</u><b>;</b>
               <b>XKanjiStatus</b> <u>*kanji_status_return</u><b>;</b>

</pre><h4><b>ARGUMENTS</b></h4><pre>
              <u>event_struct</u>    Specifies the key event.

              <u>buffer_return</u>   Returns the resulting Kanji string.

              <u>bytes_buffer</u>    Specifies the buffer length.

              <u>keysym_return</u>   Returns the key symbol.  NULL may be specified

              <u>status_return</u>   Specifies the pointer to the XCompose structure.

              <u>kanji_status_return</u>
                              Returns the Kana-to-Kanji conversion status.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>XLookupKanjiString</u>  is a convenient routine that associates a key event with a Japanese character string.
       It uses the modifier key bit to processes such as shift, lock, and control.

       <u>XLookupKanjiString</u> enables eight- and 16-bit Japanese characters to be processed.

       <u>XLookupKanjiString</u> processes alphabetical characters in the same way as XLookupString.

       For Japanese character processing, Romaji-to-Kana conversion and Kana-to-Kanji  conversion  are  done  in
       this function.  The XKanjiStatus, defined below, is used during Japanese data input:

            typedef struct _XKanjiStatus {
                unsigned char *echoStr;     /* local echo string */
                int length;                  /* length of echo string */
                int revPos;                 /* reverse position  */
                int revLen;                 /* reverse length    */
                unsigned long info;       /* other information */
                unsigned char *mode; /* mode information */
                struct {
                 unsigned char *line;     /* a grance of Kanji characters */
                 int length;         /* length of it */
                 int revPos;         /* reverse position of it */
                 int revLen;         /* reverse length of it */
                } gline;             /* a grancing line information */
            } XKanjiStatus;

            #define KanjiModeInfo    01
            #define KanjiGLineInfo   02

       When  Kana-to-Kanji  conversion  is  used  during  Japanese input, information such as the readings to be
       converted need to be echoed (local echo).  <u>XLookupKanjiString</u> does not  perform  display  such  as  local
       echo.   Instead,  it  returns  the character strings to be submitted to local echo, to the application by
       using the <u>XKanjiStatus</u> structure.

       The EUC character strings to be submitted to local echo include characters already  converted  into  Kana
       from Romaji and conversion candidate characters.  Until the conversion is fixed, they are returned by the
       <u>echoStr</u>  member.   At  this  time,  the  length  of local echo character string is returned by the <u>length</u>
       member.  Also, the starting position and length (bytes) of reverse display are returned by the <u>revPos</u> and
       <u>revLen</u> member, respectively.  The buffer for local echo character strings is  reserved  automatically  by
       <u>XLookupKanjiString</u>.   It  should be used only for reading.  No character string must be written into this
       buffer.

       If no character string is to be submitted to local echo, 0 will return to the length member.

       The contents to be submitted to local echo may be the same  as  when  <u>XLookupKanjiString</u>  was  previously
       called.   (This  occurs,  for  example,  when the Shift key is pressed.)  In this case, -1 returns to the
       length member.

       Mode changes and existence of information about the candidate list are passed by  the  <u>info</u>  member.   If
       <u>info</u>  member's KanjiModeInfo bit is on, the character string indicating the new mode will return to <u>mode</u>.
       If the info member's KanjiGLineInfo bit is on, the <u>gline</u> structure has contained information such as  the
       candidate list.

       The  character  string  for  candidate  list  display  returns to the <u>gline</u> structure's line member.  The
       length, reverse dispaly starting position, and reverse display duration of the candidate  list  character
       string return to the <u>gline</u> structure's <u>line</u>, <u>revPos</u>, and <u>revLen</u>, respectively.

       If there is an EUC character string fixed during conversion, it will be stored in <u>buffer_return</u>.  In this
       case,  the  length (bytes) of this character string will return as the return value of this function.  If
       there is no fixed character string, the return value will be 0.

                                                                                           <u><a href="../man3/XLookupKanjiString.3.html">XLookupKanjiString</a></u>(3)
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────
<u><a href="../man3/XKANJICONTROL.3.html">XKANJICONTROL</a></u>(3)                            Library Functions Manual                            <u><a href="../man3/XKANJICONTROL.3.html">XKANJICONTROL</a></u>(3)

</pre><h4><b>NAME</b></h4><pre>
       XKanjiControl — Control the XLookupKanjiString mode and process.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;X11/kanji.h&gt;</b>
       <b>int</b> <b>XKanjiControl(</b><u>dpy,</u> <u>win,</u> <u>request,</u> <u>arg</u><b>)</b>
       <b>Display</b> <u>dpy</u><b>;</b>
       <b>Window</b> <u>win</u><b>;</b>
       <b>int</b> <u>request</u><b>;</b>
       <b>char</b> <u>*arg</u><b>;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>XKanjiControl</u> executes a process that relates to Japanese input within the window defined by <u>dpy</u> and <u>win</u>.
       The process is specified in <u>request</u>.  Some processes are accompanied by the argument, specified in <u>arg</u>.

       <u>XKanjiControl</u> controls the following functions:

       <u>request</u> name      Function

       KC_INITIALIZE     Initializes Kana-to-Kanji conversion.

       KC_CHANGEMODE     Changes the input mode.

       KC_SETWIDTH       Specifies the width used to display the candidate

       KC_FINALIZE       Finalizes (terminates) Kana-to-Kanji conversion processing.

       KC_SETUNDEFKEYFUNCTION
                         Sets a function for an undefined key.

       KC_SETMODEINFOSTYLE
                         Specifies whether mode information is represented in numeric form.

       KC_KAKUTEI        Fixes the currently entered character string.

       KC_KILL           Deletes the currently entered character string.

       KC_QUERYMODE      Queries about the current mode.

       KC_SETSERVERNAME  Specifies the server to be connected.

       KC_SETINITFILENAME
                         Specifies the customize file.

       KC_CLOSEUICONTEXT Closes the context.

       KC_QUERYMAXMODESTR
                         Obtains the maximum length of mode display character string.

       Basically, <u>XKanjiControl</u> is enabled only for the window specified in the <u>dpy</u> and <u>win</u>.  This rule does not
       apply to the initialize and terminate processes.

       The unfixed character string condition may change, or details of the mode  may  vary,  depending  on  the
       <u>XKanjiControl</u>  operation.  If this may occur, pass the pointer to a structure that can contain the varied
       information in the arg field.  This structure is defined as follows:

       typedef struct {
         int      val;          /* The length of the character string in the
                                   buffer returns. */
         unsigned char *buffer; /* Specifies the buffer used to store the
                                   fixed character string. */
         int      bytes_buffer; /* Specifies the size of the above buffer. */
         XKanjiStatus *ks;      /* Pointer to the structure that contains
                                   information about the unfixed character string. */
       } XKanjiStatusWithValue;

       The <u>XKanjiControl</u> functions can be executed in the following ways:

       (1)   KC_INITIALIZE — Initializes Kana-to-Kanji conversion.

             KC_INITIALIZE initializes Kana-to-Kanji conversion  by  specifying  KC_INITIALIZE  in  the  <u>request</u>
             field.   Specify  one of the following in arg: (1) the pointer to the char ** type variable used to
             store the warning message and (2) NULL.  The initialize process is basically executed automatically
             when  <u><a href="../man3/XLookupKanjiString.3.html">XLookupKanjiString</a></u>(3)  is  first  called.   This  is  skipped  by  using  <u>XKanjiControl</u>   for
             initialization.

             For example, when control about Kana-to-Kanji conversion is executed using <u>XKanjiControl</u> before use
             of <u><a href="../man3/XLookupKanjiString.3.html">XLookupKanjiString</a></u>(3), Kana-to-Kanji conversion must be initialized.

             When  the  process  terminates  normally,  0  returns  as  the <u>XKanjiControl</u> return value.  When it
             terminates abnormally, -1 returns.

             When KC_INITIALIZE is executed, a warning, rather than an error, may occur.  When  it  occurs,  the
             pointer to the warning character string array is stored in and returns to the variable specified in
             <u>arg</u>.  If no warning occurs, NULL is stored and returns.

             (Example)
               int res; /* Prepare for error return */
               char **warning;
               .....
               res = XKanjiControl(dpy, win, KC_INITIALIZE, &amp;warning);
               if (warning) {
                 char **p;

                 for (p = warning ; *p ; p++) {
                   fprintf(stderr, "%s0, *p);
                 }
               }

             In  the  library,  malloc  is  done for the warning message returning to the fourth argument.  This
             message is freed when KC_INITIALIZE or KC_FINALIZE is executed next.   The  application  programmer
             must  not free it.  The maximum number of warning messages is restricted to 64 now.  The subsequent
             ones are discarded.

             The following warnings may be included in a message:

             -  All customize files including those of the system are unavailable.

             -  The customize file contains a syntax error.

             -  The Romaji-to-Kana conversion dictionary is unavailable.

             -  The Kana-to-Kanji conversion dictionary is unavailable.

             -  Connection to the Kana-to-Kanji conversion server is disabled.

             If NULL is specified as the fourth argument, any warning message will be discarded.

       (2)   KC_CHANGEMODE — Changes the input mode.

             KC_CHANGEMODE changes the input mode from the application.  Specify KC_CHANGEMODE  in  the  <u>request</u>
             field.   Specify  the  XKanjiStatusWithValue  structure  in  <u>arg</u>.   The Japanese mode is changed by
             specifying the <u>mode</u> number with the <u>val</u> member of XKanjiStatusWithValue structure.  The mode number
             is indicated by the following macros:

             Macro number            Mode

             CANNA_MODE_AlphaMode    Alphabet mode

             CANNA_MODE_HenkanMode   Conversion input mode

             CANNA_MODE_KigoMode     Symbol input mode

             CANNA_MODE_ZenHiraKakuteiMode
                                     Full-wide Hiragana fixed input mode

             CANNA_MODE_ZenKataKakuteiMode
                                     Full-wide Katakana fixed mode

             CANNA_MODE_HanKataKakuteiMode
                                     Half-wide Katakana fixed input mode

             CANNA_MODE_ZenAlphaKakuteiMode
                                     Full-wide alphabet fixed input mode

             CANNA_MODE_HanAlphaKakuteiMode
                                     Half-wide alphabet fixed input mode

             CANNA_MODE_HexMode      Hexadecimal code input mode

             CANNA_MODE_BushuMode    Bushu input mode

             CANNA_MODE_TorokuMode   Word register mode

             This function causes much dispaly (mode name etc.) to vary in  response  to  a  mode  change.   The
             display change is returned by the XKanjiStatusWithValue structure specified as <u>arg</u>.

             (Example)
               XKanjiStatus ks;
               XKanjiStatusWithValue ksv;
               unsigned char buf[SOMESIZE];
               .....
               ksv.ks = &amp;ks;
               ksv.buffer = buf;
               ksv.bytes_buffer = SOMESIZE;
               ksv.val = CANNA_MODE_HexMode;

               XKanjiControl(dpy, win, KC_CHANGEMODE, &amp;ksv);
               len = ksv.val;
               .....
               /* Information about the unfixed or fixed character string is
                  returned by ksv. */

       (3)   KC_SETWIDTH — Specifies the width used to display the candidate list.

             KC_SETWIDTH  specifies  the  number  of  columns  of  the area on which the candidate list is to be
             displayed.  The width of one column equals that of an alphabetical or half-wide Katakana character.
             Each full-wide Kanji character occupies two columns.   Using  KC_SETWIDTH,  specify  the  width  of
             candidate list display area to be specified in the <u>request</u> field.  At this time, specify the number
             of columns in <u>arg</u>.

             (Example)
               XKanjiControl(dpy, win, KC_SETWIDTH, (char *)60);

       (4)   KC_FINALIZE — Finalizes (terminates) processing of Kana-to-Kanji conversion

             KC_FINALIZE  specifies  that Kana-to-Kanji conversion also finalizes (terminates) at the end of the
             program and in other cases.  Be  sure  to  execute  this  process  when  terminating  Kana-to-Kanji
             conversion  processing.   All  contents  learned  up  to  now  are registered in the file.  Specify
             KC_FINALIZE in the <u>request</u> field.

             When the process terminates normally, 0 returns.  When it terminates abnormally, -1 returns.

             When KC_INITIALIZE is executed, a warning, rather than an error, may occur.  When  it  occurs,  the
             pointer to the warning character string array is stored in and returns to the variable specified in
             arg.  If no warning occurs, NULL is stored and returns.

             (Example)
               int res; /* Prepare for error return */
               char **warning;
               .....
               res = XKanjiControl(dpy, win, KC_FINALIZE, &amp;warning);
               if (warning) {
                 char **p;

                 for (p = warning ; *p ; p++) {
                   fprintf(stderr, "%s0, *p);
                 }
               }

             In  the  library,  malloc  is  done for the warning message returning to the fourth argument.  This
             message is freed when KC_INITIALIZE or KC_FINALIZE is executed next.   The  application  programmer
             must not free it.

             The maximum number of warning messages is restricted to 64 now.  The subsequent ones are discarded.

             The following warning may be included in a message:

             -  The dictionary cannot be unmounted.

             If NULL is specified as the fourth argument, any warning message will be discarded.

       (5)   KC_SETUNDEFKEYFUNCTION — Sets a function for an undefined key.

             For  example, if you press CTRL-t during input of a reading, it is regarded as undefined key input.
             The following processes are executed, responding to undefined key input:

             Macro name  Process

             kc_normal   Beep

             kc_through  Passes the input to the application program.

             kc_kakutei  Fixes the input and passes it to the application program.

             kc_kill     Deletes the input and passes it to the application program.

             If kc_normal is specified, the function set in external variable <u>jrBeepFunc</u> is called automatically
             by the library when an undefined key is input.  If the value is  not  set  in  jrBeepFunc,  nothing
             occurs when "jrBeepFunc == NULL" appears.

             (Example)
               extern (*jrBeepFunc)(), beep();

               jrBeepFunc = beep;
               XKanjiControl(dpy, win, KC_SETUNDEFKEYFUNCTION, kc_normal);

       (6)   KC_SETMODEINFOSTYLE — Specifies mode information representation.

             You  may  want  to  display  mode  information with data such as the bit map, rather than character
             strings.  In this case, return of numeric data as mode information helps you execute  the  process.
             Specify  KC_SETMODEINFOSTYLE  in  <u>XKanjiControl</u>,  and  pass  1  to  <u>arg</u>.  After this, one character
             representing the mode code (numeric) plus ´@' (0x40) returns to the XKanjiStatus  structure's  <u>mode</u>
             member.   To  convert the value into the mode code, subtract '@' (0x40) from the returned character
             string.  For the mode codes, see the mode change description of Item (2) KC_CHANGEMODE.

       (7)   KC_KAKUTEI, (8) KC_KILL — Kill the currently input character string.

             You may want to relinquish the currently entered character string for some reason.  There  are  two
             relinquishing  methods.   One  is  to relinquish the character string after including the currently
             entered character string as a fixed one.  The other is to discard the character  string  completely
             then  relinquish  it.   For the first method, specify KC_KAKUTEI in <u>jrKanjiControl</u>.  For the second
             method, specify KC_KILL.

             Each of the above influences the display.  The XKanjiStatusWithValue must thus be specified as  the
             fourth argument.

             (Example)
               XKanjiStatusWithValue ksv;
               XKanjiStatus ks;
               unsigned char buf[SOMESIZE];
               .....
               ksv.ks = &amp;ks;
               ksv.buffer = buf;
               ksv.bytes_buffer = SOMESIZE;

               XKanjiControl(dpy, win, KC_KAKUTEI, &amp;ksv);
               len = ksv.val;
               .....

       (9)   KC_QUERYMODE — Inquiry about the mode

             To inquire about the current mode, specify KC_QUERYMODE in <u>XKanjiControl</u>.

             Specify the pointer to the character array in which the mode character string is to be stored.  The
             mode  character  string  is  a  character string ending with a null character.  To return a numeric
             here, specify KC_SETMODEINFOSTYLE in <u>XKanjiControl</u> to change the mode character string style.

             (Example)
               char currentMode[MAXMODELEN];
               .....
               XKanjiControl(dpy, win, KC_QUERYMODE, currentMode);
               .....

       (10)  KC_SETSERVERNAME — Specifies the server to be connected.

             KC_SETSERVERNAME enables you to switch the Kana-to-Kanji conversion server without terminating  the
             application  program.  To set the server to connect as the Kana-to-Kanji conversion server, specify
             KC_SETSERVERNAME in <u>XKanjiControl</u>.  In the fourth argument, specify the name of the  server  to  be
             connected.

       (11)  KC_SETINITFILENAME — Specifies the customize file.

             KC_SETINITFILENAM  enables  the  application  program  to change the customize file.  To change the
             customize file, specify KC_SETINITFILENAME as the third argument and the file name character string
             as the fourth argument.  This process must be executed before KC_INTIALIZE.

             (Example)
               char *inifile = "app-own.canna"
               .....
               XKanjiControl(dpy, win, KC_SETINITFILENAME, initfile);
               .....

       (12)  KC_CLOSEUICONTEXT   Closes the context.

             When <u>XKanjiControl</u>  or  <u>XLookupKanjiString</u>  is  called,  one  conversion  context  is  assigned  to
             combination  of  <u>dpy</u>  and  <u>win</u>.   Combination  of  <u>dpy</u>  and  <u>win</u>  not used yet can be specified for
             <u>XKanjiControl</u> or <u>XLookupKanjiString</u>.  When this is done, a new context is created  for  the  window
             and the required memory is reserved.

             If  a  window  used  up  to  now is not used, you may want to free the context memory that has been
             assigned to this window.  To do so, call <u>XKanjiControl</u> by specifying KC_CLOSEUICONTEXT as the third
             argument.

             Because this  process  causes  a  display  change,  specify  XKanjiStatusWithValue  as  the  fourth
             structure.

             (Example)
               XKanjiStatusWithValue ksv;
               XKanjiStatus ks;
               unsigned char buf[SOMESIZE];
               .....
               ksv.ks = &amp;ks;
               ksv.buffer = buf;
               ksv.bytes_buffer = SOMESIZE;

               XKanjiControl(dpy, win, KC_CLOSEUICONTEXT, &amp;ksv);
               .....

       (13)  KC_QUERYMAXMODESTR — Obtains the maximum length of mode display character string.

             The  mode display character string can be customized using the initialize file.  It is necessary to
             examine the size of the display area (in the customized resulting mode  display  character  string)
             that is to be reserved.  Specify KC_QUERYMAXMODESTR as the third argument, then call <u>XKanjiControl</u>.
             As  a  result,  the  number of columns necessary for the mode display character string is returned.
             (The number of columns is represented, defining  that  the  width  of  one  half-wide  alphanumeric
             character is 1.

             The fourth argument is unused; dummy value 0 is assigned to it.

             (Example)
               int max_mode_columns;
               .....
               max_mode_columns = XKanjiControl(dpy, win, KC_QUERYMAXMODESTR, 0);
               .....

                                                                                                <u><a href="../man3/XKANJICONTROL.3.html">XKANJICONTROL</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>