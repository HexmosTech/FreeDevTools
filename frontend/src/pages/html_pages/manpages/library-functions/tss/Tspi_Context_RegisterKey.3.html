<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tspi_Context_RegisterKey - register a key in the TSS Persistent Storage database</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtspi-dev">libtspi-dev_0.3.15-0.4_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Tspi_Context_RegisterKey - register a key in the TSS Persistent Storage database

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;tss/platform.h&gt;</b>
       <b>#include</b> <b>&lt;tss/tcpa_defines.h&gt;</b>
       <b>#include</b> <b>&lt;tss/tcpa_typedef.h&gt;</b>
       <b>#include</b> <b>&lt;tss/tcpa_struct.h&gt;</b>
       <b>#include</b> <b>&lt;tss/tss_typedef.h&gt;</b>
       <b>#include</b> <b>&lt;tss/tss_structs.h&gt;</b>
       <b>#include</b> <b>&lt;tss/tspi.h&gt;</b>

       <b>TSS_RESULT</b> <b>Tspi_Context_RegisterKey(TSS_HCONTEXT</b> <u>hContext</u><b>,</b>                    <b>TSS_HKEY</b> <u>hKey</u><b>,</b>
                                           <b>TSS_FLAG</b>     <u>persistentStorageType</u><b>,</b>       <b>TSS_UUID</b> <u>uuidKey</u><b>,</b>
                                           <b>TSS_FLAG</b>     <u>persistentStorageTypeParent</u><b>,</b> <b>TSS_UUID</b> <u>uuidParentKey</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>Tspi_Context_RegisterKey</b> is the API that registers a key with the TSS Persistent Storage database so that
       it  can be loaded as necessary. It also includes all information required for loading the key, as well as
       information about its parent key.

</pre><h4><b>PARAMETERS</b></h4><pre>
   <b>hContext</b>
       The <u>hContext</u> parameter is the handle of the context object.

   <b>hKey</b>
       The <u>hKey</u> parameter is the handle of the key object addressing the key to be registered.

   <b>persistentStorageType</b>
       The <u>persistentStorageType</u> parameter indicates the persistent storage the key is registered in.

   <b>uuidKey</b>
       The <u>uuidKey</u> parameter is the UUID by which the key is registered in persistent storage.

   <b>persistentStorageTypeParent</b>
       The <u>persistentStorageTypeParent</u> parameter indicates the persistent storage that the parent key is  regis‐
       tered in.

   <b>uuidParentKey</b>
       The <u>uuidParentKey</u> parameter is the UUID by which the parent key is registered in persistent storage.

</pre><h4><b>RETURN</b> <b>CODES</b></h4><pre>
       <b>Tspi_Context_RegisterKey</b>  returns  TSS_SUCCESS  on  success, otherwise one of the following values is re‐
       turned:

       TSS_E_INVALID_HANDLE
              <u>hContext</u> is not a valid handle.

       TSS_E_PS_KEY_NOTFOUND
              The key cannot be found in the persistent storage database.

       TSS_E_INTERNAL_ERROR
              An internal SW error has been detected.

       TSS_E_BAD_PARAMETER
              One or more parameters is bad.

</pre><h4><b>EXAMPLE</b></h4><pre>
       #include &lt;trousers/tss.h&gt;

       int
       main(void)
       {
            TSS_FLAGS initFlags = ...;
            TSS_HKEY  hKey, hSRK;
            TSS_UUID  keyUUID = {...};

            // Create a TSP handle
            result = Tspi_Context_Create(&amp;hContext);
            if (result != TSS_SUCCESS)
                 Error_Path();

            // Connect to the TCSD
            result = Tspi_Context_Connect(hContext, GLOBALSERVER);
            if (result != TSS_SUCCESS)
                 Error_Path();

            // Create the Key Object
            result = Tspi_Context_CreateObject(hContext,
                           TSS_OBJECT_TYPE_RSAKEY,
                           initFlags, &amp;hKey);
            if (result != TSS_SUCCESS)
                 Error_Path();

            // Load parent Key by UUID
            result = Tspi_Context_LoadKeyByUUID(hContext, TSS_PS_TYPE_SYSTEM,
                                     SRK_UUID, &amp;hSRK);
            if (result != TSS_SUCCESS)
                 Error_Path();

            // Do policy/secret handling here

            result = Tspi_Key_CreateKey(hKey, hSRK, 0);
            if (result != TSS_SUCCESS)
                 Error_Path();

            // Register the Key in System PS (on the TCSD's platform)
               result = Tspi_Context_RegisterKey(hContext, hKey, TSS_PS_TYPE_SYSTEM,
                                keyUUID, TSS_PS_TYPE_SYSTEM,
                                SRK_UUID);
            if (result != TSS_SUCCESS)
                 Error_Path();

            /* ...
             *
             * Use the key as needed, exiting the program if necessary, reloading
             * the key using Tspi_Context_LoadKeyByUUID() after each restart. Once
             * the key is no longer useful, unregister it from system PS as part
             * of clean up.
             */

               // Unregister the Key
            result = Tspi_Context_UnregisterKey(hContext, TSS_PS_TYPE_SYSTEM,
                                migratableSignUUID, &amp;hKey);
            if (result != TSS_SUCCESS)
                 Error_Path();

            // exit, discarding hKey
       }

</pre><h4><b>CONFORMING</b> <b>TO</b></h4><pre>
       <b>Tspi_Context_RegisterKey</b> conforms to the Trusted Computing Group Software Specification version 1.1 Gold‐
       en

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/Tspi_Context_UnregisterKey.3.html">Tspi_Context_UnregisterKey</a></b>(3), <b><a href="../man3/Tspi_Context_LoadKeyByUUID.3.html">Tspi_Context_LoadKeyByUUID</a></b>(3), <b><a href="../man3/Tspi_Context_GetRegisteredKeyByUUID.3.html">Tspi_Context_GetRegisteredKeyByUUID</a></b>(3).

TSS 1.1                                            2004-05-25                        <u><a href="../man3/Tspi_Context_RegisterKey.3.html">Tspi_Context_RegisterKey</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>