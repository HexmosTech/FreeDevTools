<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>coap_pdu_access, coap_check_option, coap_decode_var_bytes, coap_decode_var_bytes8, coap_get_data,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcoap3t64">libcoap3t64_4.3.4-1.1build4_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       coap_pdu_access, coap_check_option, coap_decode_var_bytes, coap_decode_var_bytes8, coap_get_data,
       coap_opt_length, coap_opt_value, coap_option_filter_clear, coap_option_filter_get,
       coap_option_filter_set, coap_option_filter_unset, coap_option_iterator_init, coap_option_next,
       coap_pdu_get_code, coap_pdu_get_mid, coap_pdu_get_token, coap_pdu_get_type, coap_get_uri_path - Accessing
       CoAP PDUs

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;coap3/coap.h&gt;</b>

       <b>coap_opt_t</b> <b>*coap_check_option(const</b> <b>coap_pdu_t</b> <b>*</b><u>pdu</u><b>,</b> <b>coap_option_num_t</b> <u>number</u><b>,</b> <b>coap_opt_iterator_t</b> <b>*</b><u>oi</u><b>);</b>

       <b>unsigned</b> <b>int</b> <b>coap_decode_var_bytes(const</b> <b>uint8_t</b> <b>*</b><u>buf</u><b>,</b> <b>size_t</b> <u>length</u><b>);</b>

       <b>uint64_t</b> <b>coap_decode_var_bytes8(const</b> <b>uint8_t</b> <b>*</b><u>buf</u><b>,</b> <b>size_t</b> <u>length</u><b>);</b>

       <b>int</b> <b>coap_get_data(const</b> <b>coap_pdu_t</b> <b>*</b><u>pdu</u><b>,</b> <b>size_t</b> <b>*</b><u>length,</u> <u>const</u> <u>uint8_t</u> <u>**_data</u><b>);</b>

       <b>uint32_t</b> <b>coap_opt_length(const</b> <b>coap_opt_t</b> <b>*</b><u>opt</u><b>);</b>

       <b>const</b> <b>uint8_t</b> <b>*coap_opt_value(const</b> <b>coap_opt_t</b> <b>*</b><u>opt</u><b>);</b>

       <b>void</b> <b>coap_option_filter_clear(coap_opt_filter_t</b> <b>*</b><u>filter</u><b>);</b>

       <b>int</b> <b>coap_option_filter_get(coap_opt_filter_t</b> <b>*</b><u>filter</u><b>,</b> <b>coap_option_num_t</b> <u>number</u><b>);</b>

       <b>int</b> <b>coap_option_filter_set(coap_opt_filter_t</b> <b>*</b><u>filter</u><b>,</b> <b>coap_option_num_t</b> <u>number</u><b>)</b>;

       <b>int</b> <b>coap_option_filter_unset(coap_opt_filter_t</b> <b>*</b><u>filter</u><b>,</b> <b>coap_option_num_t</b> <u>number</u><b>);</b>

       <b>coap_opt_iterator_t</b> <b>*coap_option_iterator_init(const</b> <b>coap_pdu_t</b> <b>*</b><u>pdu</u><b>,</b> <b>coap_opt_iterator_t</b> <b>*</b><u>oi</u><b>,</b> <b>const</b>
       <b>coap_opt_filter_t</b> <b>*</b><u>filter</u><b>);</b>

       <b>coap_opt_t</b> <b>*coap_option_next(coap_opt_iterator_t</b> <b>*</b><u>oi</u><b>);</b>

       <b>coap_pdu_code_t</b> <b>coap_pdu_get_code(const</b> <b>coap_pdu_t</b> <b>*</b><u>pdu</u><b>);</b>

       <b>coap_mid_t</b> <b>coap_pdu_get_mid(const</b> <b>coap_pdu_t</b> <b>*</b><u>pdu</u><b>);</b>

       <b>coap_bin_const_t</b> <b>coap_pdu_get_token(const</b> <b>coap_pdu_t</b> <b>*</b><u>pdu</u><b>);</b>

       <b>coap_pdu_type_t</b> <b>coap_pdu_get_type(const</b> <b>coap_pdu_t</b> <b>*</b><u>pdu</u><b>);</b>

       <b>coap_string_t</b> <b>*coap_get_uri_path(const</b> <b>coap_pdu_t</b> <b>*</b><u>pdu</u><b>);</b>

       For specific (D)TLS library support, link with <b>-lcoap-3-notls</b>, <b>-lcoap-3-gnutls</b>, <b>-lcoap-3-openssl</b>,
       <b>-lcoap-3-mbedtls</b> or <b>-lcoap-3-tinydtls</b>. Otherwise, link with <b>-lcoap-3</b> to get the default (D)TLS library
       support.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The CoAP PDU is of the form


       --header--|--optional token--|--optional options--|--optional payload--
       The terminology used is taken mainly from "RFC7252 1.2. Terminology".

       The following functions provide access to the information held within different parts of a PDU.

</pre><h4><b>PDU</b> <b>HEADER</b> <b>FUNCTIONS</b></h4><pre>
       <b>Function:</b> <b>coap_pdu_get_type()</b>

       The <b>coap_pdu_get_type</b>() function returns one of the messages types below from the PDU <u>pdu</u> header.

           COAP_MESSAGE_CON  Type confirmable.
           COAP_MESSAGE_NON  Type non-confirmable.
           COAP_MESSAGE_ACK  Type acknowledge
           COAP_MESSAGE_RST  Type reset.

       <b>NOTE:</b> For reliable messages RFC8323, this will always return COAP_MESSAGE_CON.

       <b>Function:</b> <b>coap_pdu_get_code()</b>

       The <b>coap_pdu_get_code</b>() function returns one of the codes below from the PDU <u>pdu</u> header. It is possible
       that new codes are added in over time.

           COAP_EMPTY_CODE                               0.00
           COAP_REQUEST_CODE_GET                         0.01
           COAP_REQUEST_CODE_POST                        0.02
           COAP_REQUEST_CODE_PUT                         0.03
           COAP_REQUEST_CODE_DELETE                      0.04
           COAP_REQUEST_CODE_FETCH                       0.05
           COAP_REQUEST_CODE_PATCH                       0.06
           COAP_REQUEST_CODE_IPATCH                      0.07
           COAP_RESPONSE_CODE_OK                         2.00
           COAP_RESPONSE_CODE_CREATED                    2.01
           COAP_RESPONSE_CODE_DELETED                    2.02
           COAP_RESPONSE_CODE_VALID                      2.03
           COAP_RESPONSE_CODE_CHANGED                    2.04
           COAP_RESPONSE_CODE_CONTENT                    2.05
           COAP_RESPONSE_CODE_CONTINUE                   2.31
           COAP_RESPONSE_CODE_BAD_REQUEST                4.00
           COAP_RESPONSE_CODE_UNAUTHORIZED               4.01
           COAP_RESPONSE_CODE_BAD_OPTION                 4.02
           COAP_RESPONSE_CODE_FORBIDDEN                  4.03
           COAP_RESPONSE_CODE_NOT_FOUND                  4.04
           COAP_RESPONSE_CODE_NOT_ALLOWED                4.05
           COAP_RESPONSE_CODE_NOT_ACCEPTABLE             4.06
           COAP_RESPONSE_CODE_INCOMPLETE                 4.08
           COAP_RESPONSE_CODE_CONFLICT                   4.09
           COAP_RESPONSE_CODE_PRECONDITION_FAILED        4.12
           COAP_RESPONSE_CODE_REQUEST_TOO_LARGE          4.13
           COAP_RESPONSE_CODE_UNSUPPORTED_CONTENT_FORMAT 4.15
           COAP_RESPONSE_CODE_UNPROCESSABLE              4.22
           COAP_RESPONSE_CODE_TOO_MANY_REQUESTS          4.29
           COAP_RESPONSE_CODE_INTERNAL_ERROR             5.00
           COAP_RESPONSE_CODE_NOT_IMPLEMENTED            5.01
           COAP_RESPONSE_CODE_BAD_GATEWAY                5.02
           COAP_RESPONSE_CODE_SERVICE_UNAVAILABLE        5.03
           COAP_RESPONSE_CODE_GATEWAY_TIMEOUT            5.04
           COAP_RESPONSE_CODE_PROXYING_NOT_SUPPORTED     5.05
           COAP_RESPONSE_CODE_HOP_LIMIT_REACHED          5.08
           COAP_SIGNALING_CODE_CSM                       7.01
           COAP_SIGNALING_CODE_PING                      7.02
           COAP_SIGNALING_CODE_PONG                      7.03
           COAP_SIGNALING_CODE_RELEASE                   7.04
           COAP_SIGNALING_CODE_ABORT                     7.05

       <b>NOTE:</b> For reliable messages "ttps://rfc-editor.org/rfc/rfc8323[RFC8323], this will always return
       COAP_EMPTY_CODE.

       <b>Function:</b> <b>coap_pdu_get_mid()</b>

       The <b>coap_pdu_get_mid</b>() returns the message id from the PDU <u>pdu</u> header.

       <b>NOTE:</b> For reliable messages RFC8323, this will always return 0.

</pre><h4><b>PDU</b> <b>TOKEN</b> <b>FUNCTIONS</b></h4><pre>
       <b>Function:</b> <b>coap_pdu_get_token()</b>

       The <b>coap_pdu_get_token</b>() returns the token information held in the PDU <u>pdu</u> token which may be zero
       length.

</pre><h4><b>PDU</b> <b>OPTIONS</b> <b>FUNCTIONS</b></h4><pre>
       The following is the current list of options with their numeric value

           /*
            * The C, U, and N flags indicate the properties
            * Critical, Unsafe, and NoCacheKey, respectively.
            * If U is set, then N has no meaning as per
            * https://rfc-editor.org/rfc/rfc7252#section-5.10
            * and is set to a -.
            * Separately, R is for the options that can be repeated
            *
            * The least significant byte of the option is set as followed
            * as per https://rfc-editor.org/rfc/rfc7252#section-5.4.6
            *
            *   0   1   2   3   4   5   6   7
            * --+---+---+---+---+---+---+---+
            *           | NoCacheKey| U | C |
            * --+---+---+---+---+---+---+---+
            *
            * https://rfc-editor.org/rfc/rfc8613#section-4 goes on to define E, I and U
            * properties Encrypted and Integrity Protected, Integrity Protected Only and
            * Unprotected respectively.  Integrity Protected Only is not currently used.
            *
            * An Option is tagged with CUNREIU with any of the letters replaced with _ if
            * not set, or - for N if U is set (see above) for aiding understanding of the
            * Option.
            */

           COAP_OPTION_IF_MATCH        1 /* C__RE__, opaque,    0-8 B, RFC7252 */
           COAP_OPTION_URI_HOST        3 /* CU-___U, String,  1-255 B, RFC7252 */
           COAP_OPTION_ETAG            4 /* ___RE__, opaque,    1-8 B, RFC7252 */
           COAP_OPTION_IF_NONE_MATCH   5 /* C___E__, empty,       0 B, RFC7252 */
           COAP_OPTION_OBSERVE         6 /* _U-_E_U, empty/uint,  0 B/0-3 B, RFC7641 */
           COAP_OPTION_URI_PORT        7 /* CU-___U, uint,      0-2 B, RFC7252 */
           COAP_OPTION_LOCATION_PATH   8 /* ___RE__, String,  0-255 B, RFC7252 */
           COAP_OPTION_OSCORE          9 /* C_____U, *,       0-255 B, RFC8613 */
           COAP_OPTION_URI_PATH       11 /* CU-RE__, String,  0-255 B, RFC7252 */
           COAP_OPTION_CONTENT_FORMAT 12 /* ____E__, uint,      0-2 B, RFC7252 */
           /* COAP_OPTION_MAXAGE default 60 seconds if not set */
           COAP_OPTION_MAXAGE         14 /* _U-_E_U, uint,      0-4 B, RFC7252 */
           COAP_OPTION_URI_QUERY      15 /* CU-RE__, String,  1-255 B, RFC7252 */
           COAP_OPTION_HOP_LIMIT      16 /* ______U, uint,        1 B, RFC8768 */
           COAP_OPTION_ACCEPT         17 /* C___E__, uint,      0-2 B, RFC7252 */
           COAP_OPTION_LOCATION_QUERY 20 /* ___RE__, String,  0-255 B, RFC7252 */
           COAP_OPTION_BLOCK2         23 /* CU-_E_U, uint,      0-3 B, RFC7959 */
           COAP_OPTION_BLOCK1         27 /* CU-_E_U, uint,      0-3 B, RFC7959 */
           COAP_OPTION_SIZE2          28 /* __N_E_U, uint,      0-4 B, RFC7959 */
           COAP_OPTION_PROXY_URI      35 /* CU-___U, String, 1-1034 B, RFC7252 */
           COAP_OPTION_PROXY_SCHEME   39 /* CU-___U, String,  1-255 B, RFC7252 */
           COAP_OPTION_SIZE1          60 /* __N_E_U, uint,      0-4 B, RFC7252 */
           COAP_OPTION_NORESPONSE    258 /* _U-_E_U, uint,      0-1 B, RFC7967 */

       See FURTHER INFORMATION as to how to get the latest list.

       <b>Function:</b> <b>coap_check_option()</b>

       The <b>coap_check_option</b>() function is used to check whether the specified option <u>number</u> is in the PDU <u>pdu</u>
       options. The option iterator <u>oi</u> is used as a scratch (does not need to be initialized) internal storage
       location while iterating through the options looking for the specific <u>number</u>. If the <u>number</u> is repeated
       in the <u>pdu</u>, only the first occurrence will be returned. If the option is not found, NULL is returned.

       <b>Function:</b> <b>coap_option_iterator_init()</b>

       The <b>coap_option_iterator_init</b>() function can be used to initialize option iterator <u>oi</u>, applying a filter
       <u>filter</u> to indicate which options are to be ignored when iterating through the options. The <u>filter</u> can be
       NULL (or COAP_OPT_ALL) if all of the options are required. To set up the filter otherwise, the following
       4 functions are available.

       <b>Function:</b> <b>coap_option_filter_clear()</b>

       The <b>coap_option_filter_clear</b>() function initializes <u>filter</u> to have no options set.

       <b>Function:</b> <b>coap_option_filter_get()</b>

       The <b>coap_option_filter_get</b>() function is used to check whether option <u>number</u> is set in <u>filter</u>.

       <b>Function:</b> <b>coap_option_filter_set()</b>

       The <b>coap_option_filter_set</b>() function is used to set option <u>number</u> in <u>filter</u>.

       <b>Function:</b> <b>coap_option_filter_unset()</b>

       The <b>coap_option_filter_unset</b>() function is used to remove option <u>number</u> in <u>filter</u>.

       <b>Function:</b> <b>coap_option_next()</b>

       The <b>coap_option_next</b>() function is then used following <b>coap_option_iterator_init</b>() in a loop to return
       all the appropriate options until NULL is returned - indicating the end of the available options. See
       EXAMPLES below for further information.

       <b>Function:</b> <b>coap_opt_length()</b>

       The <b>coap_opt_length</b>() function returns the length of the option <u>opt</u> (as returned by <b>coap_check_option</b>()
       or <b>coap_option_next</b>()).

       <b>Function:</b> <b>coap_opt_value()</b>

       The <b>coap_opt_value</b>() function returns a pointer to the start of the data for the option <u>opt</u> (as returned
       by <b>coap_check_option</b>() or <b>coap_option_next</b>()).

       <b>Function:</b> <b>coap_decode_var_bytes()</b>

       The <b>coap_decode_var_bytes</b>() function will decode an option value up to 4 bytes long from <u>buf</u> and <u>length</u>
       into an unsigned 32bit number.

       <b>Function:</b> <b>coap_decode_var_bytes8()</b>

       The <b>coap_decode_var_bytes8</b>() function will decode an option value up to 8 bytes long from <u>buf</u> and <u>length</u>
       into an unsigned 64bit number.

       <b>Function:</b> <b>coap_get_uri_path()</b>

       The <b>coap_get_uri_path</b>() function will abstract the uri path from the specified <u>pdu</u> options. The returned
       uri path will need to be freed off when no longer required.

</pre><h4><b>PDU</b> <b>PAYLOAD</b> <b>FUNCTIONS</b></h4><pre>
       <b>Function:</b> <b>coap_get_data()</b>

       The <b>coap_get_data</b>() function is used abstract from the <u>pdu</u> payload information about the received data by
       updating <u>length</u> with the length of data available, and <u>data</u> with a pointer to where the data is located.

       <b>NOTE:</b> This function has been updated by <b>coap_get_data_large</b>() when large transfers may take place. See
       <a href="../man3/coap_block.3.html">coap_block</a>(3).

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>coap_check_option</b>() and <b>coap_option_next</b>() returns a coap_opt_t* or NULL if not found.

       <b>coap_decode_var_bytes</b>() and <b>coap_decode_var_bytes8</b>() return the decoded value.

       <b>coap_pdu_get_code</b>(), <b>coap_pdu_get_mid</b>(), <b>coap_pdu_get_type</b>() return the appropriate value.

       <b>coap_option_filter_get</b>(), <b>coap_option_filter_set</b>() and <b>coap_option_filter_unset</b>() return 1 on success or
       0 on failure.

       <b>coap_get_data</b>() returns 1 if data, else 0.

       <b>coap_opt_length</b>() returns the option length.

       <b>coap_opt_value</b>() returns a pointer to the start of the option value or NULL if error.

       <b>coap_option_iterator_init</b>() returns ap pointer to the provided iterator or NULL on error.

       <b>coap_pdu_get_token</b>() returns a pointer to the token in the pdu.

       <b>coap_get_uri_path</b>() returns an allocated pointer to the uri path in the pdu or NULL on error. This
       pointer will need to be freed off.

</pre><h4><b>EXAMPLES</b></h4><pre>
       <b>Abstract</b> <b>information</b> <b>from</b> <b>PDU</b>

           #include &lt;coap3/coap.h&gt;

           static void
           get_pdu_information(coap_pdu_t *pdu) {

             int ret;
             /* Header variables */
             coap_pdu_type_t pdu_type;
             coap_pdu_code_t pdu_code;
             coap_mid_t pdu_mid;
             /* Token variables */
             coap_bin_const_t pdu_token;
             /* Option variables */
             coap_opt_iterator_t opt_iter;
             coap_opt_t *option;
             coap_opt_filter_t ignore_options;

             /* Data payload variables */
             size_t pdu_data_length;
             const uint8_t *pdu_data;
             size_t pdu_data_offset;
             size_t pdu_data_total_length;

             /* Pull in the header information */
             pdu_type = coap_pdu_get_type(pdu);
             pdu_code = coap_pdu_get_code(pdu);
             pdu_mid = coap_pdu_get_mid(pdu);

             /* Pull in the token information */
             pdu_token = coap_pdu_get_token(pdu);

             /* Pull in the option information */
             /* Specific option check */
             option = coap_check_option(pdu, COAP_OPTION_OBSERVE, &amp;opt_iter);
             if (option) {
               uint32_t value = coap_decode_var_bytes(coap_opt_value(option),
                                                      coap_opt_length(option));
               coap_log_info("Option OBSERVE, value %u\n", value);
             }
             /* Iterate through all options */
             coap_option_iterator_init(pdu, &amp;opt_iter, COAP_OPT_ALL);
             while ((option = coap_option_next(&amp;opt_iter))) {
               coap_log_info("A: Option %d, Length %u\n",
                        opt_iter.number, coap_opt_length(option));
             }
             /* Iterate through options, some ignored */
             coap_option_filter_clear(&amp;ignore_options);
             coap_option_filter_set(&amp;ignore_options, COAP_OPTION_OBSERVE);
             coap_option_iterator_init(pdu, &amp;opt_iter, &amp;ignore_options);
             while ((option = coap_option_next(&amp;opt_iter))) {
               coap_log_info("I: Option %d, Length %u\n",
                        opt_iter.number, coap_opt_length(option));
             }

             /* Pull in the payload information */
             ret = coap_get_data(pdu, &amp;pdu_data_length, &amp;pdu_data);
               /* or */
             ret = coap_get_data_large(pdu, &amp;pdu_data_length, &amp;pdu_data,
                                       &amp;pdu_data_offset, &amp;pdu_data_total_length);

           }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/coap_block.3.html">coap_block</a></b>(3) and <b><a href="../man3/coap_pdu_setup.3.html">coap_pdu_setup</a></b>(3)

</pre><h4><b>FURTHER</b> <b>INFORMATION</b></h4><pre>
       See

       "RFC7252: The Constrained Application Protocol (CoAP)"

       "RFC8613: Object Security for Constrained RESTful Environments (OSCORE)"

       for further information.

       See https://www.iana.org/assignments/core-parameters/core-parameters.xhtml#option-numbers for the current
       set of defined CoAP Options.

</pre><h4><b>BUGS</b></h4><pre>
       Please report bugs on the mailing list for libcoap: <a href="mailto:libcoap-developers@lists.sourceforge.net">libcoap-developers@lists.sourceforge.net</a> or raise an
       issue on GitHub at https://github.com/obgm/libcoap/issues

</pre><h4><b>AUTHORS</b></h4><pre>
       The libcoap project &lt;<a href="mailto:libcoap-developers@lists.sourceforge.net">libcoap-developers@lists.sourceforge.net</a>&gt;

coap_pdu_access 4.3.4                              04/15/2024                                 <u><a href="../man3/COAP_PDU_ACCESS.3.html">COAP_PDU_ACCESS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>