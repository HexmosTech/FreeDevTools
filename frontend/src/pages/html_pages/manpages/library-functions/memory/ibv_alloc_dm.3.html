<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ibv_alloc_dm,  ibv_free_dm,  ibv_memcpy_to/from_dm  -  allocate  or free a device memory buffer (DMs) and</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libibverbs-dev">libibverbs-dev_56.1-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ibv_alloc_dm,  ibv_free_dm,  ibv_memcpy_to/from_dm  -  allocate  or free a device memory buffer (DMs) and
       perform memory copy to or from it

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;infiniband/verbs.h&gt;</b>

       <b>struct</b> <b>ibv_dm</b> <b>*ibv_alloc_dm(struct</b> <b>ibv_context</b> <u>*context</u><b>,</b>
                                   <b>struct</b> <b>ibv_alloc_dm_attr</b> <u>*attr</u><b>);</b>

       <b>int</b> <b>ibv_free_dm(struct</b> <b>ibv_dm</b> <u>*dm</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>ibv_alloc_dm()</b> allocates a device memory buffer for the RDMA device context <u>context</u>.  The  argument  <u>attr</u>
       is a pointer to an ibv_alloc_dm_attr struct, as defined in &lt;infiniband/verbs.h&gt;.

       <b>ibv_free_dm()</b> free the device memory buffer <u>dm</u>.

       struct ibv_alloc_dm_attr {
               size_t length;           /* Length of desired device memory buffer */
               uint32_t log_align_req;       /* Log base 2 of address alignment requirement */
               uint32_t comp_mask;      /* Compatibility mask that defines which of the following variables are valid */
       };

       Address alignment may be required in cases where RDMA atomic operations will be performed using the device memory.

       In such cases, the user may specify the device memory start address alignment using the log_align_req parameter

       in the allocation attributes struct.

</pre><h4><b>Accessing</b> <b>an</b> <b>allocated</b> <b>device</b> <b>memory</b></h4><pre>
       In order to perform a write/read memory access to an allocated device memory, a user could use the ibv_memcpy_to_dm
       and ibv_memcpy_from_dm calls respectively.

       <b>int</b> <b>ibv_memcpy_to_dm(struct</b> <b>ibv_dm</b> <u>*dm</u><b>,</b> <b>uint64_t</b> <u>dm_offset</u><b>,</b>
                            <b>void</b> <u>*host_addr</u><b>,</b> <b>size_t</b> <u>length</u><b>);</b>

       <b>int</b> <b>ibv_memcpy_from_dm(void</b> <u>*host_addr</u><b>,</b> <b>struct</b> <b>ibv_dm</b> <u>*dm</u><b>,</b>
                          <b>uint64_t</b> <u>dm_offset</u><b>,</b> <b>size_t</b> <u>length</u><b>);</b>

       <u>dm_offest</u>
       is the byte offset from the beginning of the allocated device memory buffer to access.

       <u>host_addr</u>
       is the host memory buffer address to access.

       <u>length</u>
       is the copy length in bytes.

</pre><h4><b>Device</b> <b>memory</b> <b>registration</b></h4><pre>
       User may register the allocated device memory as a memory region and use the lkey/rkey inside sge when posting receive
       or sending work request. This type of MR is defined as zero based and therefore any reference to it (specifically in sge)
       is done with a byte offset from the beginning of the region.

       This type of registration is done using ibv_reg_dm_mr.

       <b>struct</b> <b>ibv_mr*</b> <b>ibv_reg_dm_mr(struct</b> <b>ibv_pd</b> <u>*pd</u><b>,</b> <b>struct</b> <b>ibv_dm</b> <u>*dm</u><b>,</b> <b>uint64_t</b> <u>dm_offset</u><b>,</b>
                         <b>size_t</b> <u>length</u><b>,</b> <b>uint32_t</b> <u>access</u><b>);</b>

       <u>pd</u>
       the associated pd for this registration.

       <u>dm</u>
       the associated dm for this registration.

       <u>dm_offest</u>
       is the byte offset from the beginning of the allocated device memory buffer to register.

       <u>length</u>
       the memory length to register.

       <u>access</u>
       mr access flags (Use enum ibv_access_flags). For this type of registration, user must set the IBV_ACCESS_ZERO_BASED
       flag.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       <b>ibv_alloc_dm()</b>  returns  a  pointer  to  an  ibv_dm  struct  or NULL if the request fails.  The output dm
       contains the handle which could be used by user to import this device memory.

       <b>ibv_free_dm()</b> returns 0 on success, or the value  of  errno  on  failure  (which  indicates  the  failure
       reason).

       <b>ibv_reg_dm_mr()</b> returns a pointer to an ibv_mr struct on success or NULL if request fails.

       <b>ibv_memcpy_to_dm()/ibv_memcpy_from_dm()</b> returns 0 on success or the failure reason value on failure.

</pre><h4><b>NOTES</b></h4><pre>
       <b>ibv_alloc_dm()</b>  may  fail  if  device  has  no  more free device memory left, where the maximum amount of
       allocated memory is provided by the <u>max_dm_size</u> attribute in  <u>ibv_device_attr_ex</u>  struct.   <b>ibv_free_dm()</b>
       may fail if any other resources (such as an MR) is still associated with the DM being freed.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/ibv_query_device_ex.3.html">ibv_query_device_ex</a></b>(3),

</pre><h4><b>AUTHORS</b></h4><pre>
       Ariel Levkovich &lt;<a href="mailto:lariel@mellanox.com">lariel@mellanox.com</a>&gt;

libibverbs                                         2017-07-25                                    <u><a href="../man3/IBV_ALLOC_DM.3.html">IBV_ALLOC_DM</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>