<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pack_gp.c</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libg2c-dev">libg2c-dev_2.1.0-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pack_gp.c

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include 'grib2_int.h'
       #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;

   <b>Macros</b>
       #define <b>FALSE_</b>   (0)
           False.
       #define <b>TRUE_</b>   (1)
           True.

   <b>Functions</b>
       int <b>pack_gp</b> (<b>g2int</b> *kfildo, <b>g2int</b> *ic, <b>g2int</b> *nxy, <b>g2int</b> *is523, <b>g2int</b> *minpk, <b>g2int</b> *inc, <b>g2int</b> *missp,
           <b>g2int</b> *misss, <b>g2int</b> *jmin, <b>g2int</b> *jmax, <b>g2int</b> *lbit, <b>g2int</b> *nov, <b>g2int</b> *ndg, <b>g2int</b> *lx, <b>g2int</b> *ibit,
           <b>g2int</b> *jbit, <b>g2int</b> *kbit, <b>g2int</b> *novref, <b>g2int</b> *lbitref, <b>g2int</b> *ier)
           Determines groups of variable size, but at least of size minpk, the associated max (jmax( )) and min
           (jmin( )), the number of bits necessary to hold the values in each group (lbit( )), the number of
           values in each group (nov( )), the number of bits necessary to pack the jmin( ) values (ibit), the
           number of bits necessary to pack the lbit( ) values (jbit), and the number of bits necessary to pack
           the nov( ) values (kbit).

</pre><h4><b>Detailed</b> <b>Description</b></h4><pre>
       <b>Author</b>
           Glahn

       <b>Date</b>
           february 1994

       Definition in file <b>pack_gp.c</b>.

</pre><h4><b>Macro</b> <b>Definition</b> <b>Documentation</b></h4><pre>
   <b>#define</b> <b>FALSE_</b>   <b>(0)</b>
       False.

       Definition at line <b>10</b> of file <b>pack_gp.c</b>.

   <b>#define</b> <b>TRUE_</b>   <b>(1)</b>
       True.

       Definition at line <b>9</b> of file <b>pack_gp.c</b>.

</pre><h4><b>Function</b> <b>Documentation</b></h4><pre>
   <b>int</b> <b>pack_gp</b> <b>(g2int</b> <b>*</b> <b>kfildo,</b> <b>g2int</b> <b>*</b> <b>ic,</b> <b>g2int</b> <b>*</b> <b>nxy,</b> <b>g2int</b> <b>*</b> <b>is523,</b> <b>g2int</b> <b>*</b> <b>minpk,</b> <b>g2int</b> <b>*</b> <b>inc,</b> <b>g2int</b> <b>*</b>
       <b>missp,</b> <b>g2int</b> <b>*</b> <b>misss,</b> <b>g2int</b> <b>*</b> <b>jmin,</b> <b>g2int</b> <b>*</b> <b>jmax,</b> <b>g2int</b> <b>*</b> <b>lbit,</b> <b>g2int</b> <b>*</b> <b>nov,</b> <b>g2int</b> <b>*</b> <b>ndg,</b> <b>g2int</b> <b>*</b> <b>lx,</b>
       <b>g2int</b> <b>*</b> <b>ibit,</b> <b>g2int</b> <b>*</b> <b>jbit,</b> <b>g2int</b> <b>*</b> <b>kbit,</b> <b>g2int</b> <b>*</b> <b>novref,</b> <b>g2int</b> <b>*</b> <b>lbitref,</b> <b>g2int</b> <b>*</b> <b>ier)</b>
       Determines groups of variable size, but at least of size minpk, the associated max (jmax( )) and min
       (jmin( )), the number of bits necessary to hold the values in each group (lbit( )), the number of values
       in each group (nov( )), the number of bits necessary to pack the jmin( ) values (ibit), the number of
       bits necessary to pack the lbit( ) values (jbit), and the number of bits necessary to pack the nov( )
       values (kbit). The routine is designed to determine the groups such that a small number of bits is
       necessary to pack the data without excessive computations. If all values in the group are zero, the
       number of bits to use in packing is defined as zero when there can be no missing values; when there can
       be missing values, the number of bits must be at least 1 to have the capability to recognize the missing
       value. However, if all values in a group are missing, the number of bits needed is 0, and the unpacker
       recognizes this. All variables are g2int. Even though the groups are initially of size minpk or larger,
       an adjustment between two groups (the lookback procedure) may make a group smaller than minpk. The
       control on group size is that the sum of the sizes of the two consecutive groups, each of size minpk or
       larger, is not decreased. When determining the number of bits necessary for packing, the largest value
       that can be accommodated in, say, mbits, is 2**mbits-1; this largest value (and the next smallest value)
       is reserved for the missing value indicator (only) when is523 ne 0. If the dimension ndg is not large
       enough to hold all the groups, the local value of minpk is increased by 50 percent. This is repeated
       until ndg will suffice. A diagnostic is printed whenever this happens, which should be very rarely. If it
       happens often, ndg in subroutine pack should be increased and a corresponding increase in subroutine
       unpack made. Considerable code is provided so that no more checking for missing values within loops is
       done than necessary; the added efficiency of this is relatively minor, but does no harm. For grib2, the
       reference value for the length of groups in nov( ) and for the number of bits necessary to pack group
       values are determined, and subtracted before jbit and kbit are determined.

       When 1 or more groups are large compared to the others, the width of all groups must be as large as the
       largest. A subroutine reduce breaks up large groups into 2 or more to reduce total bits required. If
       reduce should abort, pack_gp will be executed again without the call to reduce.

       PROGRAM HISTORY LOG:

       • February 1994 Glahn tdl mos-2000

       • June 1995 Glahn modified for lmiss error.

       • July 1996 Glahn added misss

       • February 1997 Glahn removed 4 redundant tests for missp.eq.0; inserted a test to better handle a string
         of 9999's

       • February 1997 Glahn added loops to eliminate test for misss when misss = 0

       • March 1997 Glahn corrected for secondary missing value

       • March 1997 Glahn corrected for use of local value of minpk

       • March 1997 Glahn corrected for secondary missing value

       • March  1997  Glahn  changed  calculating number of bits through exponents to an array (improved overall
         packing performance by about 35 percent!). allowed 0 bits for packing jmin( ), lbit( ), and nov( ).

       • May 1997 Glahn a number of changes for efficiency. mod functions eliminated and one ifthen added. jount
         removed. recomputation of bits not made unless necessary after moving points from one group to another.
         nendb adjusted to eliminate possibility of very small group at the end. about 8 percent improvement  in
         overall  packing. iskipa removed; there is always a group b that can become group a. control on size of
         group b (statement below 150) added. added adda, and use of ge and le instead of gt  and  lt  in  loops
         between 150 and 160. ibitbs added to shorten trips through loop.

       • March 2000 Glahn modified for grib2; changed name from packgp

       • january  2001  Glahn comments; ier = 706 substituted for stops; added return1; removed statement number
         110; added ier and * return

       • November 2001 Glahn changed some diagnostic formats to allow printing larger numbers

       • November 2001 Glahn added misslx( ) to put maximum value into jmin( ) when all values missing to  agree
         with grib standard.

       • November  2001  Glahn  changed  two tests on missp and misss eq 0 to tests on is523. however, missp and
         misss cannot in general be = 0.

       • November 2001 Glahn added call to reduce; defined itest before loops  to  reduce  computation;  started
         large group when all same value

       • December 2001 Glahn modified and added a few comments

       • January 2002 Glahn removed loop before 150 to determine a group of all same value

       • January 2002 Glahn changed mallow from 9999999 to 2**30+1, and made it a parameter

       • March 2002 Glahn added non fatal ier = 716, 717; removed nendb=nxy above 150; added iersav=0; comments

       DATA SET USE

       • kfildo - unit number for output (print) file. (output)

       <b>Parameters</b>
           <u>kfildo</u> unit number for output (print) file. (input)
           <u>ic</u>  array  to hold data for packing. the values do not have to be positive at this point, but must be
           in the range -2**30 to +2**30 (the the value of mallow). these g2int values will be retained  exactly
           through packing and unpacking. (input)
           <u>nxy</u> number of values in ic( ). also treated as its dimension. (input)
           <u>is523</u>  missing  value  management  0=data  contains no missing values 1=data contains primary missing
           values 2=data contains primary and secondary missing values (input)
           <u>minpk</u> the minimum size of each group, except possibly the last one. (input)
           <u>inc</u> the number of values to add to an already existing group in determining whether or not to start a
           new group. ideally, this would be 1, but each time inc values are attempted, the max and min  of  the
           next minpk values must be found. this is 'a loop within a loop,' and a slightly larger value may give
           about  as  good  results  with  slightly  less  computational  time. if inc is le 0, 1 is used, and a
           diagnostic is output. note: it is expected that inc will equal 1. the code uses inc primarily in  the
           loops  starting  at  statement 180. if inc were 1, there would not need to be loops as such. however,
           kinc (the local value of inc) is set ge 1 when near the end of the data to  forestall  a  very  small
           group at the end. (input)
           <u>missp</u>  when missing points can be present in the data, they will have the value missp or misss. missp
           is the primary missing value and misss is the secondary missing value . these must not be values that
           would occur with subtracting the minimum (reference) value or scaling. for example, missp =  0  would
           not be advisable. (input)
           <u>misss</u> secondary missing value indicator (see missp). (input)
           <u>jmin</u> the minimum of each group (j=1,lx). (output)
           <u>jmax</u>  the  maximum of each group (j=1,lx). this is not really needed, but since the max of each group
           must be found, saving it here is cheap in case the user wants it. (output)
           <u>lbit</u> the number of bits necessary to pack each group (j=1,lx). it is  assumed  the  minimum  of  each
           group  will  be  removed  before  packing,  and  the values to pack will, therefore, all be positive.
           however, ic( ) does not necessarily contain all positive values. if  the  overall  minimum  has  been
           removed (the usual case), then ic( ) will contain only positive values. (output)
           <u>nov</u> the number of values in each group (j=1,lx). (output)
           <u>ndg</u> the dimension of jmin, jmax, lbit, and nov. (input)
           <u>lx</u> the number of groups determined. (output)
           <u>ibit</u> the number of bits necessary to pack the jmin(j) values, j=1,lx. (output)
           <u>jbit</u> the number of bits necessary to pack the lbit(j) values, j=1,lx. (output)
           <u>kbit</u> the number of bits necessary to pack the nov(j) values, j=1,lx. (output)
           <u>novref</u> reference value for nov( ). (output)
           <u>lbitref</u> reference value for lbit( ). (output)
           <u>ier</u> Error code

           • 0 No error.

           • 706 value will not pack in 30 bits--fatal

           • 714 error in reduce--non-fatal

           • 715 ngp not large enough in reduce--non-fatal

           • 716 minpk inceased--non-fatal

           • 717 inc set

           • 1--non-fatal

           • alternate return when ier ne 0 and fatal error.

       <b>Returns</b>
           0 - check ier for error code.

              INTERNAL VARIABLES

                         cfeed = contains the character representation
                                 of a printer form feed.
                         ifeed = contains the g2int value of a printer
                                 form feed.
                          kinc = working copy of inc. may be modified.
                          mina = minimum value in group a.
                          maxa = maximum value in group a.
                         nenda = the place in ic( ) where group a ends.
                        kstart = the place in ic( ) where group a starts.
                         ibita = number of bits needed to hold values in group a.
                          minb = minimum value in group b.
                          maxb = maximum value in group b.
                         nendb = the place in ic( ) where group b ends.
                         ibitb = number of bits needed to hold values in group b.
                          minc = minimum value in group c.
                          maxc = maximum value in group c.
                        ktotal = count of number of values in ic( ) processed.
                         nount = number of values added to group a.
                         lmiss = 0 when is523 = 0. when packing into a
                                 specific number of bits, say mbits,
                                 the maximum value that can be handled is
                                 2**mbits-1. when is523 = 1, indicating
                                 primary missing values, this maximum value
                                 is reserved to hold the primary missing value
                                 indicator and lmiss = 1. when is523 = 2,
                                 the value just below the maximum i.e.,
                                 2**mbits-2 is reserved to hold the secondary
                                 missing value indicator and lmiss = 2.
                        lminpk = local value of minpk. this will be adjusted
                                 upward whenever ndg is not large enough to hold
                                 all the groups.
                        mallow = the largest allowable value for packing.
                        mislla = set to 1 when all values in group a are missing.
                                 this is used to distinguish between a real
                                 minimum when all values are not missing
                                 and a minimum that has been set to zero when
                                 all values are missing. 0 otherwise.
                                 note that this does not distinguish between
                                 primary and secondary missings when secondary
                                 missings are present. this means that
                                 lbit( ) will not be zero with the resulting
                                 compression efficiency when secondary missings
                                 are present. also note that a check has been
                                 made earlier to determine that secondary
                                 missings are really there.
                        misllb = set to 1 when all values in group b are missing.
                                 this is used to distinguish between a real
                                 minimum when all values are not missing
                                 and a minimum that has been set to zero when
                                 all values are missing. 0 otherwise.
                        misllc = performs the same function for group c that
                                 mislla and misllb do for groups b and c,
                                 respectively.
                      ibxx2(j) = an array that when this routine is first entered
                                 is set to 2**j, j=0,30. <a href="../man30/ibxx2.30.html">ibxx2</a>(30) = 2**30, which
                                 is the largest value packable, because 2**31
                                 is larger than the g2int word size.
                        ifirst = set by data statement to 0. changed to 1 on
                                 first
                                 entry when ibxx2( ) is filled.
                         minak = keeps track of the location in ic( ) where the
                                 minimum value in group a is located.
                         maxak = does the same as minak, except for the maximum.
                         minbk = the same as minak for group b.
                         maxbk = the same as maxak for group b.
                         minck = the same as minak for group c.
                         maxck = the same as maxak for group c.
                          adda = keeps track whether or not an attempt to add
                                 points to group a was made. if so, then adda
                                 keeps from trying to put one back into b.
                                 (g2int)
                        ibitbs = keeps current value if ibitb so that loop
                                 ending at 166 doesn't have to start at
                                 ibitb = 0 every time.
                     misslx(j) = mallow except when a group is all one value (and
                                 lbit(j) = 0) and that value is missing. in
                                 that case, misslx(j) is missp or misss. this
                                 gets inserted into jmin(j) later as the
                                 missing indicator; it can't be put in until
                                 the end, because jmin( ) is used to calculate
                                 the maximum number of bits (ibits) needed to
                                 pack jmin( ).

       Definition at line <b>255</b> of file <b>pack_gp.c</b>.

       References <b>FALSE_</b>, <b>reduce()</b>, and <b>TRUE_</b>.

       Referenced by <b>compack()</b>, and <b>misspack()</b>.

</pre><h4><b>Author</b></h4><pre>
       Generated automatically by Doxygen for NCEPLIBS-g2c from the source code.

NCEPLIBS-g2c                                      Version 2.1.0                                     <u><a href="../man3/pack_gp.c.3.html">pack_gp.c</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>