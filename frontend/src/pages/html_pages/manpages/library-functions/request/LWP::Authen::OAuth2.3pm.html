<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LWP::Authen::OAuth2 - Make requests to OAuth2 APIs.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/liblwp-authen-oauth2-perl">liblwp-authen-oauth2-perl_0.20-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       LWP::Authen::OAuth2 - Make requests to OAuth2 APIs.

</pre><h4><b>VERSION</b></h4><pre>
       version 0.20

</pre><h4><b>SYNOPSIS</b></h4><pre>
       OAuth 2 is a protocol that lets a <u>user</u> tell a <u>service</u> <u>provider</u> that a <u>consumer</u> has permission to use the
       <u>service</u> <u>provider</u>'s APIs to do things that require access to the <u>user</u>'s account.  This module tries to
       make life easier for someone who wants to write a <u>consumer</u> in Perl.

       Specifically it provides convenience methods for all of the requests that are made to the <u>service</u>
       <u>provider</u> as part of the permission handshake, and after that will proxy off of LWP::UserAgent to let you
       send properly authenticated requests to the API that you are trying to use.  When possible, this will
       include transparent refresh/retry logic for access tokens expiration.

       For a full explanation of OAuth 2, common terminology, the requests that get made, and the necessary
       tasks that this module does not address, please see LWP::Authen::OAuth2::Overview

       This module will not help with OAuth 1.  See the similarly named but unrelated LWP::Authen::OAuth for a
       module that can help with that.

       Currently LWP::Authen::OAuth2 provides ready-to-use classes to use OAuth2 with

       •   Dwolla

           LWP::Authen::OAuth2::ServiceProvider::Dwolla

           implemented by Adi Fairbank &lt;https://github.com/adifairbank&gt;

       •   Google

           LWP::Authen::OAuth2::ServiceProvider::Google

       •   Line

           LWP::Authen::OAuth2::ServiceProvider::Line

           implemented by Adam Millerchip &lt;https://github.com/amillerchip&gt;

       •   Strava

           LWP::Authen::OAuth2::ServiceProvider::Strava

           implemented by Leon Wright &lt;https://github.com/techman83&gt;

       •   Withings

           LWP::Authen::OAuth2::ServiceProvider::Withings

           implemented by Brian Foley &lt;https://github.com/foleybri&gt;

       •   Yahoo

           LWP::Authen::OAuth2::ServiceProvider::Yahoo

           implemented by Michael Stevens &lt;https://github.com/michael-stevens&gt;

       You  can  also access any other OAuth2 service by setting up a plain "LWP::Authen::OAuth2" object. If you
       do, and the service provider might be of interest to other people,  please  submit  a  patch  so  we  can
       include it in this distribution, or release it as a standalone package.

       Here are examples of simple usage.

           use LWP::Authen::OAuth2;

           # Constructor
           my $oauth2 = LWP::Authen::OAuth2-&gt;new(
                            client_id =&gt; "Public from service provider",
                            client_secret =&gt; "s3cr3t fr0m svc prov",
                            service_provider =&gt; "Google",
                            redirect_uri =&gt; "https://your.url.com/",

                            # Optional hook, but recommended.
                            save_tokens =&gt; \&amp;save_tokens,
                            save_tokens_args =&gt; [ $dbh ],

                            # This is for when you have tokens from last time.
                            token_string =&gt; $token_string.
                        );

           # URL for user to go to to start the process.
           my $url = $oauth2-&gt;authorization_url();

           # The authorization_url sends the user to the service provider to
           # say that you want to be authorized.  After the user confirms that
           # request, the service provider sends the user back to you with a
           # code.  This might be a CGI parameter, something that the user is
           # supposed to paste to you - that's between you and the service
           # provider.

           # Assuming that you have your code, get your tokens from the service
           # provider.
           $oauth2-&gt;request_tokens(code =&gt; $code);

           # Get your token as a string you can easily store, pass around, etc.
           # If you have a save_tokens callback, that gets passed this string
           # whenever the tokens change.
           #
           # This string bears a suspicious resemblance to serialized JSON.
           my $token_string = $oauth2-&gt;token_string,

           # Access the API.  Consult the service_provider's documentation for when
           # to use which type of request.  Note that argument processing is the
           # same as in LWP.  Thus the parameters array and headers hash are both
           # optional.
           $oauth2-&gt;get($url, %header);
           $oauth2-&gt;post($url, \@parameters, %header);
           $oauth2-&gt;put($url, %header);
           $oauth2-&gt;delete($url, %header);
           $oauth2-&gt;head($url, %header);

           # And if you need more flexibility, you can use LWP::UserAgent's request
           # method
           $oauth2-&gt;request($http_request, $content_file);

           # In some flows you can refresh tokens, in others you have to go through
           # the handshake yourself.  This method lets you know whether a refresh
           # looks possible.
           $oauth2-&gt;can_refresh_tokens();

           # This method lets you know when it is time to reauthorize so that you
           # can find out in a nicer way than failing an API call.
           $oauth2-&gt;should_refresh();

</pre><h4><b>CONSTRUCTOR</b></h4><pre>
       When  you  call  "LWP::Authen::OAuth2-&gt;new(...)",  arguments  are  passed  as a key/value list.  They are
       processed in the following phases:

       Construct service provider
       Service provider collects arguments it wants
       LWP::Authen::OAuth2 overrides defaults from arguments
       Sanity check

       Here are those phases in more detail.

       Construct service provider
           There are two ways to construct a service provider.

           Prebuilt class
               To load a prebuilt class you just need one or two arguments.

               "service_provider =&gt; $Foo,"
                   In the above construct, $Foo identifies the base class for your service provider.  The actual
                   class will be the first of the following two classes that can be  loaded.   Failure  to  find
                   either is an error.

                       LWP::Authen::OAuth2::ServiceProvider $Foo
                       $Foo

                   A  list  of  prebuilt  service provider classes is in LWP::Authen::OAuth2::ServiceProvider as
                   well as instructions for making a new one.

               "client_type =&gt; $name_of_client_type"
                   Some service providers  will  keep  track  of  your  client  type  ("webserver"  application,
                   "installed"  application,  etc),  and  will  treat them differently.  A base service provider
                   class can choose to accept a "client_type" parameter to let it know what to expect.

                   Whether this is done, and the allowable values, are up to the service provider class.

           Built on the fly
               The behavior of simple service providers can be described on the fly without needing  a  prebuilt
               class.   To  do  that,  the  following  arguments  can be filled with arguments from your service
               provider:

               "authorization_endpoint =&gt; $auth_url,"
                   This is the URL which the user is directed to in the authorization request.

               "token_endpoint =&gt; $token_url,"
                   This is the URL which the consumer goes to for tokens.

               Various optional fields
                   LWP::Authen::OAuth2::ServiceProvider documents many methods that are available  to  customize
                   the actual requests made, and defaults available.  Simple service providers can likely get by
                   without  this,  but  here  is  a  list  of those methods that can be specified instead in the
                   constructor:

                       # Arrayrefs
                       required_init
                       optional_init
                       authorization_required_params
                       authorization_optional_params
                       request_required_params
                       request_optional_params
                       refresh_required_params
                       refresh_optional_params

                       # Hashrefs
                       authorization_default_params
                       request_default_params
                       refresh_default_params

           Service provider collects arguments it wants
               In general, arguments passed into the constructor do not have to be passed into individual method
               calls.  Furthermore in order to  be  able  to  do  the  automatic  token  refresh  for  you,  the
               constructor must include the arguments that will be required.

               By  default  you  are  required to pass your "client_id" and "client_secret".  And optionally can
               pass a "redirect_uri" and "scope".  (The omission of "state" is a deliberate hint that if you use
               that field, you should be generating random values on the fly.  And not  trying  to  go  to  some
               reasonable default.)

               However what is required is up to the service provider.

           LWP::Authen::OAuth2 overrides defaults from arguments
               The  following  defaults  are available to be overridden in the constructor, or can be overridden
               later.  In the unlikely event that there is a conflict with  the  service  provider's  arguments,
               these will have to be overridden later.

               "error_handler =&gt; \&amp;error_handler,"
                   Specifies the function that will be called when errors happen.  The default is "Carp::croak".

               "is_strict =&gt; $bool,"
                   Is  strict  mode  on?   If  it  is,  then  excess parameters to requests that are part of the
                   authorization process will trigger errors.  If it is not, then excess arguments are passed to
                   the service provider as is, who according to the specification is supposed to ignore them.

                   Strict mode is the default.

               "early_refresh_time =&gt; $seconds,"
                   How many seconds  before  the  end  of  estimated  access  token  expiration  you  will  have
                   "should_refresh" start returning true.

               "prerefresh =&gt; \&amp;prerefresh,"
                   A handler to be called before attempting to refresh tokens.  It is passed the $oauth2 object.
                   If  it  returns  a token string, that will be used to generate tokens instead of going to the
                   service provider.

                   The purpose of this hook is so that, even if you have multiple  processes  accessing  an  API
                   simultaneously,  only  one  of  them  will  try  to refresh tokens with the service provider.
                   (Service providers may dislike having multiple refresh requests arrive at once from the  same
                   consumer for the same user.)

                   By default this is not provided.

               "save_tokens =&gt; \&amp;save_tokens,"
                   Whenever  tokens  are  returned from the service provider, this callback will receive a token
                   string that can be stored and then retrieved in another process that  needs  to  construct  a
                   $oauth2 object.

                   By default this is not provided.  However if you intend to access the API multiple times from
                   multiple processes, it is recommended.

               "save_tokens_args =&gt; [ args ],"
                   Additional arguments passed to the save_tokens callback function after the token string. This
                   can be used to pass things like database handles or other data to the callback along with the
                   token  string.  Provide  a  reference  to an array of arguments in the constructure. When the
                   callback is called the arguments are passed to the callback as an array, so  in  the  example
                   below $arg1 will be "foo" and $arg2 will be "bar"

                       ...
                       save_tokens =&gt; \&amp;save_tokens,
                       save_tokens_args =&gt; [ "foo", "bar" ],
                       ...

                       sub save_tokens {
                           my ($token_string, $arg1, $arg2) = @_;

                           ...
                       }

               "token_string =&gt; $token_string,"
                   Supply  tokens  generated  in  a  previous  request so that you don't have to ask the service
                   provider for new ones.  Some service providers refuse to hand out tokens too quickly, so this
                   can be important.

               "user_agent =&gt; $ua,"
                   What user agent gets used under the hood?  Defaults to a new LWP::UserAgent  created  on  the
                   fly.

           Sanity check
               Any arguments that are left over are assumed to be mistakes and a fatal warning is generated.

</pre><h4><b>METHODS</b></h4><pre>
       Once you have an object, the following methods may be useful for writing a consumer.

   <b>"$oauth2-&gt;authorization_url(%opts)"</b>
       Generate  a  URL  for  the  user  to  go  to  to request permissions.  By default the "response_type" and
       "client_id" are defaulted, and all of "redirect_uri", "state" and "scope" are optional but not  required.
       However  in  practice  this  all varies by service provider and client type, so look for documentation on
       that for the actual list that you need.

   <b>"$oauth2-&gt;request_tokens(%opts)"</b>
       Request tokens from the service provider (if possible).  By default  the  "grant_type",  "client_id"  and
       "client_secret"  are  defaulted,  and  the  "scope"  is required.  However in practice this all varies by
       service provider and client type, so look for documentation on that for the actual list that you need.

   <b>"$oauth2-&gt;get(...)"</b>
       Issue a "get" request to an OAuth 2 protected URL, just like you would using LWP::UserAgent to  a  normal
       URL.

   <b>"$oauth2-&gt;head(...)"</b>
       Issue  a "head" request to an OAuth 2 protected URL, just like you would using LWP::UserAgent to a normal
       URL.

   <b>"$oauth2-&gt;post(...)"</b>
       Issue a "post" request to an OAuth 2 protected URL, just like you would using LWP::UserAgent to a  normal
       URL.

   <b>"$oauth2-&gt;delete(...)"</b>
       Issue  a  "delete" request to an OAuth 2 protected URL, similar to the previous examples.  (This shortcut
       is not by default available with LWP::UserAgent.)

   <b>"$oauth2-&gt;put(...)"</b>
       Issue a "put" request to an OAuth 2 protected URL, similar to the previous examples.  (This  shortcut  is
       not by default available with LWP::UserAgent.)

   <b>"$oauth2-&gt;request(...)"</b>
       Issue  any  "request" that you could issue with LWP::UserAgent, except that it will be properly signed to
       go to an OAuth 2 protected URL.

   <b>"$oauth2-&gt;make_api_call($uri,</b> <b>$params,</b> <b>$headers)"</b>
       This is a convenience method which makes a call to an OAuth2 API endpoint given by $uri, and returns  the
       JSON  response  decoded  to a hash.  If the $params hashref arg is set, its contents will be JSON encoded
       and sent as POST request content; otherwise it will make a GET request.  Optional $headers  may  be  sent
       which will be passed through to "$oauth-&gt;get()" or "$oauth-&gt;post()".

       If  the call succeeds, it will return the response's JSON content decoded as hash, or if no response body
       was returned, a value of 1 to indicate success.  On failure returns undef, and error message is available
       from "$oauth2-&gt;api_call_error()".

   <b>"$oauth2-&gt;api_call_error()"</b>
       If an error occurred in "$oauth2-&gt;make_api_call()", this method will return it.  The error message  comes
       from "HTTP::Response-&gt;error_as_HTML()".

   <b>"$oauth2-&gt;api_url_base()"</b>
       Returns  the  base  URL  of  the service provider, which is sometimes useful to be used in the content of
       OAuth2 API calls.

   <b>"$oauth2-&gt;can_refresh_tokens"</b>
       Is sufficient information available to try to refresh tokens?

   <b>"$oauth2-&gt;should_refresh()"</b>
       Is it time to refresh tokens?

   <b>"$oauth2-&gt;set_early_refresh_time($seconds)"</b>
       Set how many seconds before the end of token expiration the method "should_refresh"  will  start  turning
       true.   Values over half the initial expiration time of access tokens will be ignored to avoid refreshing
       too often.  This defaults to 300.

   <b>"$oauth2-&gt;expires_time()"</b>
       Returns the raw epoch expiration time of the current  access  token.   Typically  this  is  3600  seconds
       greater than the time of token creation.

   <b>"$oauth2-&gt;set_is_strict($mode)"</b>
       Set  strict mode on/off.  See the discussion of "is_strict" in the constructor for an explanation of what
       it does.

   <b>"$oauth2-&gt;set_error_handler(\&amp;error_handler)"</b>
       Set the error handler.  See the discussion of "error_handler" in the constructor for  an  explanation  of
       what it does.

   <b>"$oauth2-&gt;set_prerefresh(\&amp;prerefresh)"</b>
       Set  the  prerefresh  handler.   See  the  discussion  of  "prerefresh_handler" in the constructor for an
       explanation of what it does.

   <b>"$oauth2-&gt;set_save_tokens($ua)"</b>
       Set the save tokens handler.  See the discussion of "save_tokens" in the constructor for  an  explanation
       of what it does.

   <b>"$oauth2-&gt;set_user_agent($ua)"</b>
       Set the user agent.  This should respond to the same methods that a LWP::UserAgent responds to.

   <b>"$oauth2-&gt;user_agent()"</b>
       Get the user agent.  The default if none was explicitly set is a new LWP::UserAgent object.

   <b>Contributors</b>
       •   Leon Wright &lt;https://github.com/techman83&gt;

       •   Thomas Klausner &lt;https://github.com/domm&gt;

       •   Alex Dutton &lt;https://github.com/alexdutton&gt;

       •   Chris &lt;https://github.com/TheWatcher&gt;

       •   Adi Fairbank &lt;https://github.com/adifairbank&gt;

       •   Adam Millerchip &lt;https://github.com/amillerchip&gt;

       •   Andre Bras &lt;https://github.com/whity&gt;

</pre><h4><b>ACKNOWLEDGEMENTS</b></h4><pre>
       Thanks  to  Rent.com  &lt;<a href="http://www.rent.com">http://www.rent.com</a>&gt;  for their generous support in letting me develop and release
       this module.  My thanks also to Nick Wellnhofer &lt;<a href="mailto:wellnhofer@aevum.de">wellnhofer@aevum.de</a>&gt; for  Net::Google::Analytics::OAuth2
       which was very enlightening while I was trying to figure out the details of how to connect to Google with
       OAuth2.

       Thanks to

       •   Thomas Klausner &lt;https://github.com/domm&gt; for reporting that client type specific parameters were not
           available when the client type was properly specified

       •   Alex  Dutton  &lt;https://github.com/alexdutton&gt;  for  making  "ServiceProvider"  work without requiring
           subclassing.

       •   Leon Wright &lt;https://github.com/techman83&gt; for adding a Strava   Service  Provider  and  various  bug
           fixes

       •   Adi  Fairbank  &lt;https://github.com/adifairbank&gt;  for adding a Dwolla  Service Provider and some other
           improvements

       •   Adam Millerchip &lt;https://github.com/amillerchip&gt;  for  adding  a  Line   Service  Provider  and  some
           refactoring

       •   Michael  Stevens  &lt;https://github.com/mstevens&gt;  for  adding  a "Yahoo | https://developer.yahoo.com"
           Service Provider and some dist cleanup

       •   Nick Morrott for fixing some documentation typos

</pre><h4><b>AUTHORS</b></h4><pre>
       •   Ben Tilly, &lt;btilly at gmail.com&gt;

       •   Thomas Klausner &lt;<a href="mailto:domm@plix.at">domm@plix.at</a>&gt;

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       This software is copyright (c) 2013 - 2022 by Ben Tilly, Rent.com, Thomas Klausner.

       This is free software; you can redistribute it and/or modify it under  the  same  terms  as  the  Perl  5
       programming language system itself.

perl v5.36.0                                       2023-02-04                           <u>LWP::Authen::<a href="../man3pm/OAuth2.3pm.html">OAuth2</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>