<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mlx5dv_qp_cancel_posted_send_wrs  -  Cancel  all pending send work requests with supplied WRID in a QP in</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libibverbs-dev">libibverbs-dev_56.1-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mlx5dv_qp_cancel_posted_send_wrs  -  Cancel  all pending send work requests with supplied WRID in a QP in
       SQD state

</pre><h4><b>SYNOPSIS</b></h4><pre>
              #include &lt;infiniband/mlx5dv.h&gt;

              int mlx5dv_qp_cancel_posted_send_wrs(struct mlx5dv_qp_ex *mqp, uint64_t wr_id);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The canceled work requests are replaced with NOPs (no operation),  and  will  generate  good  completions
       according  to  the signaling originally requested in the send flags, or “flushed” completions in case the
       QP goes to error.  A work request can only be canceled when the QP is in SQD state.

       The cancel function is a part of  the  signature  pipelining  feature.   The  feature  allows  posting  a
       signature  related transfer operation together with a SEND with a good response to the client.  Normally,
       the application must wait for the transfer to end, check the MKEY for errors, and only then send  a  good
       or bad response.  However this increases the latency of the good flow of a transaction.

       To  enable  this  feature,  a  QP must be created with the <b>MLX5DV_QP_CREATE_SIG_PIPELINING</b> creation flag.
       Such  QP  will  stop  after  a  transfer  operation  that  failed  signature  validation  in  SQD  state.
       <b>IBV_EVENT_SQ_DRAINED</b> is generated to inform about the new state.

       The  SEND operation that might need to be canceled due to a bad signature of a previous operation must be
       posted with the <b>IBV_SEND_FENCE</b> option in <b>ibv_qp_ex-&gt;wr_flags</b> field.

       When QP stopped at SQD, it means that at least one WR caused signature error.  It may not be the last WR.
       It may be that more than one WRs cause signature errors by the  time  the  QP  finally  stopped.   It  is
       guaranteed  that the QP has stopped somewhere between the WQE that generated the signature error, and the
       next WQE that has <b>IBV_SEND_FENCE</b> on it.

       Software must handle the SQD event as described below:

       1. Poll everything (polling until 0 once) on the respective CQ, allowing the discovery  of  all  possible
          signature errors.

       2. Look  through  all “open” transactions, check related signature MKEYs using <b><a href="../man3/mlx5dv_mkey_check.3.html">mlx5dv_mkey_check</a></b>(3), find
          the one with the signature error, get a <b>WRID</b> from the operation software context and handle the failed
          operation.

       3. Cancel the SEND WR by the WRID using <b>mlx5dv_qp_cancel_posted_send_wrs</b>().

       4. Modify the QP back to RTS state.

</pre><h4><b>ARGUMENTS</b></h4><pre>
       <u>mqp</u>    The QP to investigate, which must be in SQD state.

       <u>wr_id</u>  The WRID to cancel.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       Number of work requests that were canceled, or -errno on error.

</pre><h4><b>NOTES</b></h4><pre>
       A DEVX context should be opened by using <b><a href="../man3/mlx5dv_open_device.3.html">mlx5dv_open_device</a></b>(3).

       Must be called with a QP in SQD state.

       QP should be created with <b>MLX5DV_QP_CREATE_SIG_PIPELINING</b> creation flag.  Application must listen  on  QP
       events, and expect a SQD event.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/mlx5dv_mkey_check.3.html">mlx5dv_mkey_check</a></b>(3),            <b><a href="../man3/mlx5dv_wr_mkey_configure.3.html">mlx5dv_wr_mkey_configure</a></b>(3),            <b><a href="../man3/mlx5dv_wr_set_mkey_sig_block.3.html">mlx5dv_wr_set_mkey_sig_block</a></b>(3),
       <b><a href="../man3/mlx5dv_create_mkey.3.html">mlx5dv_create_mkey</a></b>(3), <b><a href="../man3/mlx5dv_destroy_mkey.3.html">mlx5dv_destroy_mkey</a></b>(3)

</pre><h4><b>AUTHORS</b></h4><pre>
       Oren Duer <a href="mailto:oren@nvidia.com">oren@nvidia.com</a>

       Sergey Gorenko <a href="mailto:sergeygo@nvidia.com">sergeygo@nvidia.com</a>

                                                                             <u><a href="../man3/mlx5dv_qp_cancel_posted_send_wrs.3.html">mlx5dv_qp_cancel_posted_send_wrs</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>