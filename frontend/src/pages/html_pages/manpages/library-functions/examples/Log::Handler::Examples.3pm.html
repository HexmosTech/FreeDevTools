<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log::Handler::Examples - Examples.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/liblog-handler-perl">liblog-handler-perl_0.90-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Log::Handler::Examples - Examples.

</pre><h4><b>CREATE</b> <b>LOGGER</b></h4><pre>
       Quite simple

           use Log::Handler;

           my $log = Log::Handler-&gt;new();
           $log-&gt;add( screen =&gt; \%options );

       Create a application wide logger

           my $log = Log::Handler-&gt;create_logger("myapp");
           $log-&gt;add( screen =&gt; \%options );

       Once created you can use the application logger in all modules of your project:

           package MyApp;
           use Log::Handler;

           my $log = Log::Handler-&gt;create_logger("myapp");
           $log-&gt;add( screen =&gt; \%options );

           package MyApp::Admin;
           use Log::Handler;

           my $log = Log::Handler-&gt;get_logger("myapp");
           $log-&gt;info("message");

</pre><h4><b>ADD</b> <b>OUTPUTS</b></h4><pre>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;add( dbi     =&gt; \%options );
           $log-&gt;add( email   =&gt; \%options );
           $log-&gt;add( file    =&gt; \%options );
           $log-&gt;add( forward =&gt; \%options );
           $log-&gt;add( screen  =&gt; \%options );
           $log-&gt;add( socket  =&gt; \%options );

       This is the same like

           $log-&gt;add( "Log::Handler::Output::DBI"     =&gt; \%options );
           $log-&gt;add( "Log::Handler::Output::Email"   =&gt; \%options );
           $log-&gt;add( "Log::Handler::Output::File"    =&gt; \%options );
           $log-&gt;add( "Log::Handler::Output::Forward" =&gt; \%options );
           $log-&gt;add( "Log::Handler::Output::Screen"  =&gt; \%options );
           $log-&gt;add( "Log::Handler::Output::Socket"  =&gt; \%options );

</pre><h4><b>RELOAD</b> <b>THE</b> <b>LOGGER</b></h4><pre>
   <b>Quite</b> <b>simple</b>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;config(config =&gt; "logger.conf");

           $log-&gt;reload(config =&gt; "logger.conf");

   <b>Reload</b> <b>on</b> <b>HUP</b>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;config(config =&gt; "logger.conf");

           $SIG{HUP} = sub {
               unless ($log-&gt;reload(config =&gt; "logger.conf")) {
                   warn "unable to reload configuration";
                   warn $log-&gt;errstr;
               }
           };

   <b>Validate</b> <b>first</b>
       It's possible to make a configuration check before you reload:

           $log-&gt;validate(config =&gt; "logger.conf")
               or warn $log-&gt;errstr;

</pre><h4><b>LOG</b> <b>VIA</b> <b>DBI</b></h4><pre>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               dbi =&gt; {
                   database   =&gt; "database",
                   driver     =&gt; "mysql",
                   host       =&gt; "127.0.0.1",
                   port       =&gt; 3306,
                   user       =&gt; "user",
                   password   =&gt; "password",
                   table      =&gt; "messages",
                   columns    =&gt; [ qw/level ctime cdate pid hostname caller progname mtime message/ ],
                   values     =&gt; [ qw/%level %time %date %pid %hostname %caller %progname %mtime %message/ ],
                   maxlevel   =&gt; "error",
                   minlevel   =&gt; "emergency"
                   newline    =&gt; 0,
                   message_pattern =&gt; "%L %T %D %P %H %C %S %t %m",
               }
           );

           $log-&gt;error("log an error");

       Or with "dbname"

           $log-&gt;add(
               dbi =&gt; {
                   dbname     =&gt; "database",
                   driver     =&gt; "Pg",
                   host       =&gt; "127.0.0.1",
                   port       =&gt; 5432,
                   user       =&gt; "user",
                   password   =&gt; "password",
                   table      =&gt; "messages",
                   columns    =&gt; [ qw/level ctime cdate pid hostname caller progname mtime message/ ],
                   values     =&gt; [ qw/%level %time %date %pid %hostname %caller %progname %mtime %message/ ],
                   maxlevel   =&gt; "error",
                   minlevel   =&gt; "emergency"
                   newline    =&gt; 0,
                   message_pattern =&gt; "%L %T %D %P %H %C %S %t %m",
               }
           );

       Or with "data_source"

           $log-&gt;add(
               dbi =&gt; {
                   data_source =&gt; "dbi:SQLite:dbname=database.sqlite",
                   table       =&gt; "messages",
                   columns     =&gt; [ qw/level ctime cdate pid hostname caller progname mtime message/ ],
                   values      =&gt; [ qw/%level %time %date %pid %hostname %caller %progname %mtime %message/ ],
                   maxlevel    =&gt; "error",
                   minlevel    =&gt; "emergency"
                   newline     =&gt; 0,
                   message_pattern =&gt; "%L %T %D %P %H %C %S %t %m",
               }
           );

</pre><h4><b>LOG</b> <b>VIA</b> <b>EMAIL</b></h4><pre>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               email =&gt; {
                   host     =&gt; "mx.bar.example",
                   hello    =&gt; "EHLO my.domain.example",
                   timeout  =&gt; 30,
                   from     =&gt; "<a href="mailto:bar@foo.example">bar@foo.example</a>",
                   to       =&gt; "<a href="mailto:foo@bar.example">foo@bar.example</a>",
                   subject  =&gt; "your subject",
                   buffer   =&gt; 0,
                   maxlevel =&gt; "emergency",
                   minlevel =&gt; "emergency",
                   message_pattern =&gt; '%L',
               }
           );

           $log-&gt;emergency("log an emergency issue");

</pre><h4><b>LOG</b> <b>VIA</b> <b>SENDMAIL</b></h4><pre>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               sendmail =&gt; {
                   from     =&gt; "<a href="mailto:bar@foo.example">bar@foo.example</a>",
                   to       =&gt; "<a href="mailto:foo@bar.example">foo@bar.example</a>",
                   subject  =&gt; "your subject",
                   maxlevel =&gt; "error",
                   minlevel =&gt; "error",
                   message_pattern =&gt; '%L',
               }
           );

           $log-&gt;emergency("message");

</pre><h4><b>LOG</b> <b>VIA</b> <b>FILE</b></h4><pre>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               file =&gt; {
                   filename =&gt; "file1.log",
                   maxlevel =&gt; 7,
                   minlevel =&gt; 0
               }
           );

           $log-&gt;error("log an error");

</pre><h4><b>LOG</b> <b>VIA</b> <b>FORWARD</b></h4><pre>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               forward =&gt; {
                   forward_to      =&gt; \&amp;my_func,
                   message_pattern =&gt; [ qw/%L %T %P %H %C %S %t/ ],
                   message_layout  =&gt; "%m",
                   maxlevel        =&gt; "info",
               }
           );

           $log-&gt;info("log a information");

           sub my_func {
               my $params = shift;
               print Dumper($params);
           }

</pre><h4><b>LOG</b> <b>VIA</b> <b>SCREEN</b></h4><pre>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               screen =&gt; {
                   log_to   =&gt; "STDERR",
                   maxlevel =&gt; "info",
               }
           );

           $log-&gt;info("log to the screen");

</pre><h4><b>LOG</b> <b>VIA</b> <b>SOCKET</b></h4><pre>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               socket =&gt; {
                   peeraddr =&gt; "127.0.0.1",
                   peerport =&gt; 44444,
                   maxlevel =&gt; "info",
                   die_on_errors =&gt; 0,
               }
           );

           while ( 1 ) {
               $log-&gt;info("test")
                   or warn "unable to send message: ", $log-&gt;errstr;
               sleep 1;
           }

   <b>SIMPLE</b> <b>SOCKET</b> <b>SERVER</b> <b>(TCP)</b>
           use strict;
           use warnings;
           use IO::Socket::INET;
           use Log::Handler::Output::File;

           my $sock = IO::Socket::INET-&gt;new(
               LocalAddr =&gt; "127.0.0.1",
               LocalPort =&gt; 44444,
               Listen    =&gt; 2,
           ) or die $!;

           my $file = Log::Handler::Output::File-&gt;new(
               filename =&gt; "file.log",
               fileopen =&gt; 1,
               reopen   =&gt; 1,
           );

           while ( 1 ) {
               $file-&gt;log(message =&gt; "waiting for next connection\n");

               while (my $request = $sock-&gt;accept) {
                   my $ipaddr = sprintf("%-15s", $request-&gt;peerhost);
                   while (my $message = &lt;$request&gt;) {
                       $file-&gt;log(message =&gt; "$ipaddr - $message");
                   }
               }
           }

</pre><h4><b>DIFFERENT</b> <b>OUTPUTS</b></h4><pre>
           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               file =&gt; {
                   filename =&gt; "common.log",
                   maxlevel =&gt; 6,
                   minlevel =&gt; 5,
               }
           );

           $log-&gt;add(
               file =&gt; {
                   filename =&gt; "error.log",
                   maxlevel =&gt; 4,
                   minlevel =&gt; 0,
               }
           );

           $log-&gt;add(
               email =&gt; {
                   host     =&gt; "mx.bar.example",
                   hello    =&gt; "EHLO my.domain.example",
                   timeout  =&gt; 120,
                   from     =&gt; "<a href="mailto:bar@foo.example">bar@foo.example</a>",
                   to       =&gt; "<a href="mailto:foo@bar.example">foo@bar.example</a>",
                   subject  =&gt; "your subject",
                   buffer   =&gt; 0,
                   maxlevel =&gt; 0,
               }
           );

           # log to common.log
           $log-&gt;info("this is a info message");

           # log to error.log
           $log-&gt;warning("this is a warning");

           # log to error.log and to <a href="mailto:foo@bar.example">foo@bar.example</a>
           $log-&gt;emergency("this is a emergency message");

</pre><h4><b>FILTER</b> <b>MESSAGES</b></h4><pre>
           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               screen =&gt; {
                   maxlevel =&gt; 6,
                   filter_message =&gt; {
                       match1    =&gt; "foo",
                       match2    =&gt; "bar",
                       match3    =&gt; "baz",
                       condition =&gt; "(match1 &amp;&amp; match2) &amp;&amp; !match3"
                   }
               }
           );

           $log-&gt;info("foo");
           $log-&gt;info("foo bar");
           $log-&gt;info("foo baz");

   <b>FILTER</b> <b>CALLER</b>
       This example shows you how it's possible to debug messages only from a special namespace.

           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               file =&gt; {
                   filename =&gt; "file1.log",
                   maxlevel =&gt; "warning",
               }
           );

           $log-&gt;add(
               screen =&gt; {
                   maxlevel =&gt; "debug",
                   message_layout =&gt; "message from %p - %m",
                   filter_caller  =&gt; qr/^Foo::Bar\z/,
               }
           );

           $log-&gt;warning("a warning here");

           package Foo::Bar;
           $log-&gt;info("an info here");
           1;

   <b>ANOTHER</b> <b>FILTER</b>
           filter_message =&gt; "as string"

           filter_message =&gt; qr/as regexp/

           filter_message =&gt; sub { shift-&gt;{message} =~ /as code ref/ }

           # or with conditions

           filter_message =&gt; {
               match1    =&gt; "as string",
               match2    =&gt; qr/as regexp/,
               condition =&gt; "match1 || match2",
           }

           filter_caller =&gt; "as string"

           filter_caller =&gt; qr/as regexp/

</pre><h4><b>CONFIG</b></h4><pre>
       Examples:

           my $log = Log::Handler-&gt;new( config =&gt; "logger.conf" );

           # or

           $log-&gt;add( config =&gt; "logger.conf" );

           # or

           $log-&gt;config( config =&gt; "logger.conf" );

       Example with Config::General.

       Script:

           use Log::Handler;

           my $log = Log::Handler-&gt;new();

           $log-&gt;config( config =&gt; "logger.conf" );

       Config (logger.conf):

           &lt;file&gt;
               alias    = common
               filename = example.log
               maxlevel = info
               minlevel = warn
           &lt;/file&gt;

           &lt;file&gt;
               alias    = error
               filename = example-error.log
               maxlevel = warn
               minlevel = emergency
           &lt;/file&gt;

           &lt;file&gt;
               alias    = debug
               filename = example-debug.log
               maxlevel = debug
               minlevel = debug
           &lt;/file&gt;

           &lt;screen&gt;
               log_to   = STDERR
               dump     = 1
               maxlevel = debug
               minlevel = debug
           &lt;/screen&gt;

</pre><h4><b>CHECK</b> <b>FOR</b> <b>ACTIVE</b> <b>LEVELS</b></h4><pre>
       It can be very useful if you want to check if a level is active.

           use Log::Handler;
           use Data::Dumper;

           my $log = Log::Handler-&gt;new();

           $log-&gt;add(
               file =&gt; {
                   filename   =&gt; "file1.log",
                   maxlevel   =&gt; 4,
               }
           );

           my %hash = (foo =&gt; 1, bar =&gt; 2);

       Now you want to dump the hash, but not in any case.

           if ( $log-&gt;is_debug ) {
               my $dump = Dumper(\%hash);
               $log-&gt;debug($dump);
           }

       This would dump the hash only if the level debug is active.

</pre><h4><b>AUTHOR</b></h4><pre>
       Jonny Schulz &lt;jschulz.cpan(at)bloonix.de&gt;.

perl v5.36.0                                       2022-08-28                        <u>Log::Handler::<a href="../man3pm/Examples.3pm.html">Examples</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>