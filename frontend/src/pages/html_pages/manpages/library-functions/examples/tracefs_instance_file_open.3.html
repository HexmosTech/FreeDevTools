<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tracefs_instance_file_open, tracefs_instance_file_write, tracefs_instance_file_write_number,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtracefs-doc">libtracefs-doc_1.8.1-1ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tracefs_instance_file_open, tracefs_instance_file_write, tracefs_instance_file_write_number,
       tracefs_instance_file_append, tracefs_instance_file_clear, tracefs_instance_file_read,
       tracefs_instance_file_read_number - Work with files in tracing instances.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;tracefs.h&gt;</b>

       int <b>tracefs_instance_file_open</b>(struct tracefs_instance *<u>instance</u>, const char *<u>file</u>, int <u>mode</u>);
       int <b>tracefs_instance_file_write</b>(struct tracefs_instance *<u>instance</u>, const char *<u>file</u>, const char *<u>str</u>);
       int <b>tracefs_instance_file_write_number</b>(struct tracefs_instance *<u>instance</u>, const char *<u>file</u>, size_t <u>val</u>);
       int <b>tracefs_instance_file_append</b>(struct tracefs_instance *<u>instance</u>, const char *<u>file</u>, const char *<u>str</u>);
       int <b>tracefs_instance_file_clear</b>(struct tracefs_instance *<u>instance</u>, const char *<u>file</u>);
       char *<b>tracefs_instance_file_read</b>(struct tracefs_instance *<u>instance</u>, const char *<u>file</u>, int *<u>psize</u>);
       int <b>tracefs_instance_file_read_number</b>(struct tracefs_instance *<u>instance</u>, const char *<u>file</u>, long long int *<u>res</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This set of APIs can be used to work with trace files in all trace instances. Each of these APIs take an
       <u>instance</u> argument, that can be NULL to act on the top level instance. Otherwise, it acts on an instance
       created with <b><a href="../man3/tracefs_insance_create.3.html">tracefs_insance_create</a></b>(3)

       The <b>tracefs_instance_file_open()</b> function opens trace <u>file</u> from given <u>instance</u> and returns a file
       descriptor to it. The file access <u>mode</u> can be specified, see <b><a href="../man3/open.3.html">open</a></b>(3) for more details. If -1 is passed as
       <u>mode</u>, default O_RDWR is used.

       The <b>tracefs_instance_file_write()</b> function writes a string <u>str</u> in a <u>file</u> from the given <u>instance</u>, without
       the terminating NULL character. When opening the file, this function tries to truncates the size of the
       file to zero, which clears all previously existing settings.

       The <b>tracefs_instance_file_write_number()</b> function converts <u>val</u> into a string and then writes it to the
       given file. This is a helper function that does the number conversion to string and then calls
       <b>tracefs_instance_file_write()</b>.

       The <b>tracefs_instance_file_append()</b> function writes a string <u>str</u> in a <u>file</u> from the given <u>instance</u>,
       without the terminating NULL character. This function is similar to <b>tracefs_instance_file_write()</b>, but
       the existing content of the is not cleared. Thus the new settings are appended to the existing ones (if
       any).

       The <b>tracefs_instance_file_clear()</b> function tries to truncates the size of the file to zero, which clears
       all previously existing settings. If the file has content that does not get cleared in this way, this
       will not have any effect.

       The <b>tracefs_instance_file_read()</b> function reads the content of a <u>file</u> from the given <u>instance</u>.

       The <b>tracefs_instance_file_read_number()</b> function reads the content of a <u>file</u> from the given <u>instance</u> and
       converts it to a long long integer, which is stored in <u>res</u>.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       The <b>tracefs_instance_file_open()</b> function returns a file descriptor to the opened file. It must be closed
       with <b><a href="../man3/close.3.html">close</a></b>(3). In case of an error, -1 is returned.

       The <b>tracefs_instance_file_write()</b> function returns the number of written bytes, or -1 in case of an
       error.

       The <b>tracefs_instance_file_write_number()</b> function returns 0 on success and -1 on error.

       The <b>tracefs_instance_file_append()</b> function returns the number of written bytes, or -1 in case of an
       error.

       The <b>tracefs_instance_file_clear()</b> function returns 0 on success, or -1 in case of an error.

       The <b>tracefs_instance_file_read()</b> function returns a pointer to a NULL terminated string, read from the
       file, or NULL in case of an error. The returned string must be freed with free().

       The <b>tracefs_instance_file_read_number()</b> function returns 0 if a valid integer is read from the file and
       stored in <u>res</u> or -1 in case of an error.

</pre><h4><b>EXAMPLE</b></h4><pre>
           #include &lt;tracefs.h&gt;

           struct tracefs_instance *inst = tracefs_instance_create("foo");
                   if (!inst) {
                           /* Error creating a new trace instance */
                           ...
                   }

                   if (tracefs_file_exists(inst,"trace_clock")) {
                           /* The instance foo supports trace clock */
                           char *path, *clock;
                           int size;

                           path =  = tracefs_instance_get_file(inst, "trace_clock")
                           if (!path) {
                                   /* Error getting the path to trace_clock file in instance foo */
                                   ...
                           }
                           ...
                           tracefs_put_tracing_file(path);

                           clock = tracefs_instance_file_read(inst, "trace_clock", &amp;size);
                           if (!clock) {
                                   /* Failed to read trace_clock file in instance foo */
                                   ...
                           }
                           ...
                           free(clock);

                           if (tracefs_instance_file_write(inst, "trace_clock", "global") != strlen("global")) {
                                   /* Failed to set gloabl trace clock in instance foo */
                                   ...
                           }
                   } else {
                           /* The instance foo does not support trace clock */
                   }

                   if (tracefs_dir_exists(inst,"options")) {
                           /* The instance foo supports trace options */
                           char *path = tracefs_instance_get_file(inst, "options");
                           if (!path) {
                                   /* Error getting the path to options directory in instance foo */
                                   ...
                           }

                           tracefs_put_tracing_file(path);
                   } else {
                           /* The instance foo does not support trace options */
                   }

                   ...

                   if (tracefs_instance_is_new(inst))
                           tracefs_instance_destroy(inst);
                   else
                           tracefs_instance_free(inst);
                   ...

                   long long int res;
                   if (tracefs_instance_file_read_number(NULL, "tracing_on", &amp;res) == 0) {
                           if (res == 0) {
                                   /* tracing is disabled in the top instance */
                           } else if (res == 1) {
                                   /* tracing is enabled in the top instance */
                           } else {
                                   /* Unknown tracing state of the top instance */
                           }
                   } else {
                           /* Failed to read integer from tracing_on file */
                   }

                   ...

                   int fd;
                   fd = tracefs_instance_file_open(NULL, "tracing_on", O_WRONLY);
                   if (fd &gt;= 0) {
                           /* Got file descriptor to the tracing_on file from the top instance for writing */
                           ...
                           close(fd);
                   }

</pre><h4><b>FILES</b></h4><pre>
           <b>tracefs.h</b>
                   Header file to include in order to have access to the library APIs.
           <b>-ltracefs</b>
                   Linker switch to add when building a program that uses the library.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/libtracefs.3.html">libtracefs</a></b>(3), <b><a href="../man3/libtraceevent.3.html">libtraceevent</a></b>(3), <b><a href="../man1/trace-cmd.1.html">trace-cmd</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
           <b>Steven</b> <b>Rostedt</b> &lt;<b><a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a></b>[1]&gt;
           <b>Tzvetomir</b> <b>Stoyanov</b> &lt;<b><a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a></b>[2]&gt;

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;<b><a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a></b>[3]&gt;

</pre><h4><b>LICENSE</b></h4><pre>
       libtracefs is Free Software licensed under the GNU LGPL 2.1

</pre><h4><b>RESOURCES</b></h4><pre>
       <b>https://git.kernel.org/pub/scm/libs/libtrace/libtracefs.git/</b>

</pre><h4><b>COPYING</b></h4><pre>
       Copyright (C) 2020 VMware, Inc. Free use of this software is granted under the terms of the GNU Public
       License (GPL).

</pre><h4><b>NOTES</b></h4><pre>
        1. <a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a>
           <a href="mailto:rostedt@goodmis.org">mailto:rostedt@goodmis.org</a>

        2. <a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a>
           <a href="mailto:tz.stoyanov@gmail.com">mailto:tz.stoyanov@gmail.com</a>

        3. <a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a>
           <a href="mailto:linux-trace-devel@vger.kernel.org">mailto:linux-trace-devel@vger.kernel.org</a>

libtracefs 1.8.1                                   06/05/2025                                      <u><a href="../man3/LIBTRACEFS.3.html">LIBTRACEFS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>