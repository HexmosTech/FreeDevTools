<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mongoc_authentication - Authentication</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/libmongoc-doc">libmongoc-doc_1.21.0-1build1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mongoc_authentication - Authentication

       This  guide  covers  the use of authentication options with the MongoDB C Driver. Ensure that the MongoDB
       server is also properly configured for authentication before making a connection. For  more  information,
       see the <u>MongoDB</u> <u>security</u> <u>documentation</u>.

       The  MongoDB  C  driver  supports several authentication mechanisms through the use of MongoDB connection
       URIs.

       By default, if a username and password are provided as part of the connection  string  (and  an  optional
       authentication  database),  they  are  used  to  connect  via the default authentication mechanism of the
       server.

       To select a specific authentication mechanism other than the default, see the list of supported mechanism
       below.

          mongoc_client_t *client = mongoc_client_new ("mongodb://user:password@localhost/?authSource=mydb");

       Currently supported values for the authMechanism connection string option are:

       • <u>SCRAM-SHA-1</u>

       • <u>MONGODB-CR</u> <u>(deprecated)</u>

       • <u>GSSAPI</u>

       • <u>PLAIN</u>

       • <u>X509</u>

       • <u>MONGODB-AWS</u>

</pre><h4><b>BASIC</b> <b>AUTHENTICATION</b> <b>(SCRAM-SHA-256)</b></h4><pre>
       MongoDB 4.0 introduces support for authenticating using the SCRAM protocol with the more  secure  SHA-256
       hash described in <u>RFC</u> <u>7677</u>. Using this authentication mechanism means that the password is never actually
       sent  over the wire when authenticating, but rather a computed proof that the client password is the same
       as the password the server knows. In MongoDB  4.0,  the  C  driver  can  determine  the  correct  default
       authentication mechanism for users with stored SCRAM-SHA-1 and SCRAM-SHA-256 credentials:

          mongoc_client_t *client =  mongoc_client_new ("mongodb://user:password@localhost/?authSource=mydb");
          /* the correct authMechanism is negotiated between the driver and server. */

       Alternatively, SCRAM-SHA-256 can be explicitly specified as an authMechanism.

          mongoc_client_t *client =  mongoc_client_new ("mongodb://user:password@localhost/?authMechanism=SCRAM-SHA-256&amp;authSource=mydb");

       Passwords  for  SCRAM-SHA-256  undergo  the  preprocessing  step known as SASLPrep specified in <u>RFC</u> <u>4013</u>.
       SASLPrep will only be performed for passwords containing non-ASCII characters.  SASLPrep requires libicu.
       If libicu is not available, attempting to authenticate over SCRAM-SHA-256 with non-ASCII  passwords  will
       result in error.

       Usernames <u>never</u> undergo SASLPrep.

       By  default,  when  building  the  C  driver  libicu is linked if available. This can be changed with the
       <b>ENABLE_ICU</b> cmake option. To specify an installation path of libicu, specify <b>ICU_ROOT</b> as a  cmake  option.
       See the <u>FindICU</u> documentation for more information.

</pre><h4><b>BASIC</b> <b>AUTHENTICATION</b> <b>(SCRAM-SHA-1)</b></h4><pre>
       The  default  authentication  mechanism  before  MongoDB  4.0  is  <b>SCRAM-SHA-1</b>  (<u>RFC</u>  <u>5802</u>).  Using  this
       authentication  mechanism  means  that  the  password  is  never  actually  sent  over  the   wire   when
       authenticating,  but  rather  a  computed  proof that the client password is the same as the password the
       server knows.

          mongoc_client_t *client = mongoc_client_new ("mongodb://user:password@localhost/?authMechanism=SCRAM-SHA-1&amp;authSource=mydb");

       <b>NOTE:</b>
          <b>SCRAM-SHA-1</b> authenticates against the <b>admin</b> database by default. If the user  is  created  in  another
          database, then specifying the authSource is required.

</pre><h4><b>LEGACY</b> <b>AUTHENTICATION</b> <b>(MONGODB-CR)</b></h4><pre>
       The  MONGODB-CR  authMechanism is deprecated and will no longer function in MongoDB 4.0. Instead, specify
       no authMechanism and the driver will use an authentication mechanism compatible with your server.

</pre><h4><b>GSSAPI</b> <b>(KERBEROS)</b> <b>AUTHENTICATION</b></h4><pre>
       <b>NOTE:</b>
          Kerberos support requires compiling the  driver  against  <b>cyrus-sasl</b>  on  UNIX-like  environments.  On
          Windows, configure the driver to build against the Windows Native SSPI.

       <b>GSSAPI</b> (Kerberos) authentication is available in the Enterprise Edition of MongoDB. To authenticate using
       <b>GSSAPI</b>, the MongoDB C driver must be installed with SASL support.

       On UNIX-like environments, run the <b>kinit</b> command before using the following authentication methods:

          $ kinit <a href="mailto:mongodbuser@EXAMPLE.COM">mongodbuser@EXAMPLE.COM</a>
          <a href="mailto:mongodbuser@EXAMPLE.COM">mongodbuser@EXAMPLE.COM</a>'s Password:
          $ klistCredentials cache: FILE:/tmp/krb5cc_1000
                  Principal: <a href="mailto:mongodbuser@EXAMPLE.COM">mongodbuser@EXAMPLE.COM</a>

            Issued                Expires               Principal
          Feb  9 13:48:51 2013  Feb  9 23:48:51 2013  krbtgt/<a href="mailto:EXAMPLE.COM@EXAMPLE.COM">EXAMPLE.COM@EXAMPLE.COM</a>

       Now authenticate using the MongoDB URI. <b>GSSAPI</b> authenticates against the <b>$external</b> virtual database, so a
       database does not need to be specified in the URI. Note that the Kerberos principal <u>must</u> be URL-encoded:

          mongoc_client_t *client;

          client = mongoc_client_new ("mongodb://mongodbuser%<a href="mailto:40EXAMPLE.COM@mongo-server.example.com">40EXAMPLE.COM@mongo-server.example.com</a>/?authMechanism=GSSAPI");

       <b>NOTE:</b>
          <b>GSSAPI</b>  authenticates  against  the  <b>$external</b>  database, so specifying the authSource database is not
          required.

       The driver supports these GSSAPI properties:

       • <b>CANONICALIZE_HOST_NAME</b>: This might  be  required  with  Cyrus-SASL  when  the  hosts  report  different
         hostnames than what is used in the Kerberos database. The default is "false".

       • <b>SERVICE_NAME</b>: Use a different service name than the default, "mongodb".

       Set properties in the URL:

          mongoc_client_t *client;

          client = mongoc_client_new ("mongodb://mongodbuser%<a href="mailto:40EXAMPLE.COM@mongo-server.example.com">40EXAMPLE.COM@mongo-server.example.com</a>/?authMechanism=GSSAPI&amp;"
                                      "authMechanismProperties=SERVICE_NAME:other,CANONICALIZE_HOST_NAME:true");

       If  you  encounter  errors such as <b>Invalid</b> <b>net</b> <b>address</b>, check if the application is behind a NAT (Network
       Address Translation) firewall. If so, create a ticket that  uses  <b>forwardable</b>  and  <b>addressless</b>  Kerberos
       tickets. This can be done by passing <b>-f</b> <b>-A</b> to <b>kinit</b>.

          $ kinit -f -A <a href="mailto:mongodbuser@EXAMPLE.COM">mongodbuser@EXAMPLE.COM</a>

</pre><h4><b>SASL</b> <b>PLAIN</b> <b>AUTHENTICATION</b></h4><pre>
       <b>NOTE:</b>
          The MongoDB C Driver must be compiled with SASL support in order to use <b>SASL</b> <b>PLAIN</b> authentication.

       MongoDB  Enterprise  Edition  supports  the  <b>SASL</b>  <b>PLAIN</b> authentication mechanism, initially intended for
       delegating authentication to an LDAP server. Using the <b>SASL</b>  <b>PLAIN</b>  mechanism  is  very  similar  to  the
       challenge  response  mechanism  with  usernames  and  passwords.  This  authentication mechanism uses the
       <b>$external</b> virtual database for <b>LDAP</b> support:

       <b>NOTE:</b>
          <b>SASL</b> <b>PLAIN</b> is a clear-text authentication mechanism. It is strongly recommended to connect to  MongoDB
          using TLS with certificate validation when using the <b>PLAIN</b> mechanism.

          mongoc_client_t *client;

          client = mongoc_client_new ("mongodb://user:<a href="mailto:password@example.com">password@example.com</a>/?authMechanism=PLAIN");

       <b>PLAIN</b>  authenticates  against  the  <b>$external</b>  database,  so  specifying  the  authSource database is not
       required.

</pre><h4><b>X.509</b> <b>CERTIFICATE</b> <b>AUTHENTICATION</b></h4><pre>
       <b>NOTE:</b>
          The MongoDB C Driver must be compiled with TLS support for X.509 authentication support. Once this  is
          done, start a server with the following options:

              $ mongod --tlsMode requireTLS --tlsCertificateKeyFile server.pem --tlsCAFile ca.pem

       The  <b>MONGODB-X509</b>  mechanism  authenticates a username derived from the distinguished subject name of the
       X.509 certificate presented by the driver during TLS negotiation. This authentication method requires the
       use of TLS connections with certificate validation.

          mongoc_client_t *client;
          mongoc_ssl_opt_t ssl_opts = { 0 };

          ssl_opts.pem_file = "mycert.pem";
          ssl_opts.pem_pwd = "mycertpassword";
          ssl_opts.ca_file = "myca.pem";
          ssl_opts.ca_dir = "trust_dir";
          ssl_opts.weak_cert_validation = false;

          client = mongoc_client_new ("mongodb://x509_derived_username@localhost/?authMechanism=MONGODB-X509");
          mongoc_client_set_ssl_opts (client, &amp;ssl_opts);

       <b>MONGODB-X509</b> authenticates against the <b>$external</b> database, so specifying the authSource database  is  not
       required. For more information on the x509_derived_username, see the MongoDB server <u>x.509</u> <u>tutorial</u>.

       <b>NOTE:</b>
          The MongoDB C Driver will attempt to determine the x509 derived username when none is provided, and as
          of MongoDB 3.4 providing the username is not required at all.

</pre><h4><b>AUTHENTICATION</b> <b>VIA</b> <b>AWS</b> <b>IAM</b></h4><pre>
       The  <b>MONGODB-AWS</b> mechanism authenticates to MongoDB servers with credentials provided by AWS Identity and
       Access Management (IAM).

       To authenticate, create a user with an associated Amazon Resource Name (ARN) on the  <b>$external</b>  database,
       and specify the <b>MONGODB-AWS</b> <b>authMechanism</b> in the URI.

          mongoc_uri_t *uri = mongoc_uri_new ("mongodb://localhost/?authMechanism=MONGODB-AWS");

       Since  <b>MONGODB-AWS</b>  always  authenticates  against  the  <b>$external</b> database, so specifying the authSource
       database is not required.

       Credentials include the <b>access</b> <b>key</b> <b>id</b>, <b>secret</b> <b>access</b>  <b>key</b>,  and  optional  <b>session</b>  <b>token</b>.  They  may  be
       obtained from the following ways.

   <b>AWS</b> <b>credentials</b> <b>via</b> <b>URI</b>
       Credentials may be passed directly in the URI as username/password.

          mongoc_uri_t *uri = mongoc_uri_new ("mongodb://&lt;access key id&gt;:&lt;secret access key&gt;localhost/?authMechanism=MONGODB-AWS");

       This may include a <b>session</b> <b>token</b> passed with <b>authMechanismProperties</b>.

          mongoc_uri_t *uri = mongoc_uri_new ("mongodb://&lt;access key id&gt;:&lt;secret access key&gt;localhost/?authMechanism=MONGODB-AWS&amp;authMechanismProperties=AWS_SESSION_TOKEN:&lt;token&gt;");

   <b>AWS</b> <b>credentials</b> <b>via</b> <b>environment</b>
       If  credentials  are  not  passed  through  the  URI,  libmongoc will check for the following environment
       variables.

       • AWS_ACCESS_KEY_ID

       • AWS_SECRET_ACCESS_KEY

       • AWS_SESSION_TOKEN (optional)

   <b>AWS</b> <b>Credentials</b> <b>via</b> <b>ECS</b>
       If credentials are not passed in the URI or with environment  variables,  libmongoc  will  check  if  the
       environment  variable  <b>AWS_CONTAINER_CREDENTIALS_RELATIVE_URI</b>  is  set,  and  if  so, attempt to retrieve
       temporary credentials from the ECS task metadata by querying a link local address.

   <b>AWS</b> <b>Credentials</b> <b>via</b> <b>EC2</b>
       If credentials are not passed in the URI or with environment  variables,  and  the  environment  variable
       <b>AWS_CONTAINER_CREDENTIALS_RELATIVE_URI</b>   is  not  set,  libmongoc  will  attempt  to  retrieve  temporary
       credentials from the EC2 machine metadata by querying link local addresses.

</pre><h4><b>AUTHOR</b></h4><pre>
       MongoDB, Inc

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2017-present, MongoDB, Inc

1.21.0                                            Feb 09, 2022                          <u><a href="../man3/MONGOC_AUTHENTICATION.3.html">MONGOC_AUTHENTICATION</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>