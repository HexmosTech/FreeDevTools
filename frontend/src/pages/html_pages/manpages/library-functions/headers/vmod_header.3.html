<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vmod_header - Header VMOD for Varnish</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/varnish-modules">varnish-modules_0.25.0-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       vmod_header - Header VMOD for Varnish

</pre><h4><b>SYNOPSIS</b></h4><pre>
          import header [as name] [from "path"]

          VOID append(HEADER, STRING)

          VOID copy(HEADER, HEADER)

          STRING get(HEADER header, REGEX regex)

          VOID remove(HEADER header, REGEX regex)

          VOID regsub(HTTP, REGEX regex, STRING sub, BOOL all)

          HEADER dyn(HTTP, STRING)

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Varnish Module for manipulation of duplicated HTTP headers, for instance multiple Set-Cookie headers.

       Example:

          vcl 4.0;
          import header;

          backend default { .host = "192.0.2.11"; .port = "8080"; }

          sub vcl_backend_response {
              if (beresp.http.Set-Cookie) {
                  # Add another line of Set-Cookie in the response.
                  header.append(beresp.http.Set-Cookie, "VSESS=abbabeef");

                  # CMS always set this, but doesn't really need it.
                  header.remove(beresp.http.Set-Cookie, "JSESSIONID=");
              }
          }

   <b>VOID</b> <b>append(HEADER,</b> <b>STRING)</b>
       <b>Description</b>
              Append an extra occurrence to an existing header.

       <b>Example</b>
              :: header.append(beresp.http.Set-Cookie, "foo=bar")

   <b>VOID</b> <b>copy(HEADER,</b> <b>HEADER)</b>
       <b>Description</b>
              Copy all source headers to a new header.

       <b>Example</b>
              :: header.copy(beresp.http.set-cookie, beresp.http.x-old-cookie);

   <b>STRING</b> <b>get(HEADER</b> <b>header,</b> <b>REGEX</b> <b>regex)</b>
       <b>Description</b>
              Fetches the value of the first <u>header</u> that matches the given regular expression <u>regex</u>.

       <b>Example</b>
              :: set beresp.http.xusr = header.get(beresp.http.set-cookie,"user=");

   <b>VOID</b> <b>remove(HEADER</b> <b>header,</b> <b>REGEX</b> <b>regex)</b>
       <b>Description</b>
              Remove all occurrences of <u>header</u> that matches <u>regex</u>.

       <b>Example</b>
              :: header.remove(beresp.http.set-cookie,"^(?!(funcookie=))");

   <b>VOID</b> <b>regsub(HTTP,</b> <b>REGEX</b> <b>regex,</b> <b>STRING</b> <b>sub,</b> <b>BOOL</b> <b>all=0)</b>
       <b>Description</b>
              For  every  header line in the HTTP object, which can be one of <b>req</b>, <b>resp</b>, <b>bereq</b> or <b>beresp</b>, if the
              line matches the regular expression <b>regex</b>, then replace it with the result of a substitution using
              the string <b>sub</b>. <b>sub</b> may include backreferences of the form <b>\1</b> through <b>\9</b>, which refer to capturing
              expressions in the <b>regex</b>, or <b>\0</b> to refer to the entire matched portion of the header line.

              If <b>all</b> is <b>false</b>, replace the first matched portion of the header line with <b>sub</b>. This is  the  same
              operation performed by the VCL native function <b>regsub()</b>. <b>all</b> is <b>false</b> by default.

              If  <b>all</b> is <b>true</b>, replace each non-overlapping matched portion of the header line with <b>sub</b>. This is
              the same operation performed by native <b>regsuball()</b>.

              Note that unlike the other functions in this VMOD, <b>regsub()</b> applies to  the  <u>entire</u>  header  line,
              including  the  header  name, colon separator, and header value. Take care that your substitutions
              result in valid headers, since ill-formed headers can interfere with the HTTP protocol.

              Consider case sensitivity in the regex match. The standard dictates that  header  names  are  case
              insensitive,  but header values are not. The VMOD function does not take care of that for you, but
              you can express it in the <b>regex</b> using the <b>(?i)</b> flag, as shown in the example below (use  <b>(?-i)</b>  to
              turn it off).

              Consider  using the <b>^</b> starting anchor in <b>regex</b> to be sure to match a header name (and not the same
              string somewhere in the middle of the line).

       <b>Example</b>
              :: header.regsub(req, "^(?i)Foo(\d): (?-i)bar=(.*)$", "Bar\1: \2")

   <b>HEADER</b> <b>dyn(HTTP,</b> <b>STRING)</b>
       <b>Description</b>
              Return a dynamic header name.

              Most other functions of this vmod require a <u>HEADER</u> argument, which usually is a VCL-defined header
              like <b>req.http.foo</b>.

              This function allows to construct a header name from  an  arbitrary  string,  which  may  also  be
              dynamically created, for example from a variable.

              <u>Notice</u>  that  there  are no syntactic checks on the <u>STRING</u> argument by purpose in order to support
              exotic use cases. It is entirely up to the user and at their own risk to  supply  a  string  which
              represents a valid HTTP header name (or not).

       <b>Example</b>
              :: # create this request header # 42: is the answer header.append(header.dyn(req, 35 + 7), "is the
              answer");

</pre><h4><b>ACKNOWLEDGEMENTS</b></h4><pre>
       The    development   of   this   plugin   was   made   possible   by   the   sponsorship   of   Softonic,
       &lt;<a href="http://en.softonic.com/">http://en.softonic.com/</a>&gt;  .

       Also thanks to Imo Klabun and Anders Nordby for bug reports.

</pre><h4><b>BUGS</b></h4><pre>
       You can't use dynamic regular expressions, which also  holds  true  for  normal  regular  expressions  in
       regsub().

                                                                                                  <u><a href="../man3/VMOD_HEADER.3.html">VMOD_HEADER</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>