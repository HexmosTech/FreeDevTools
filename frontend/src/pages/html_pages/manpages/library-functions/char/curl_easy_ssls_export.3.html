<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>curl_easy_ssls_export - export SSL sessions</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcurl4-doc">libcurl4-doc_8.14.1-1ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       curl_easy_ssls_export - export SSL sessions

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;curl/curl.h&gt;

       typedef CURLcode curl_ssls_export_function(CURL *handle,
                                                  void *userptr,
                                                  const char *session_key,
                                                  const unsigned char *shmac,
                                                  size_t shmac_len,
                                                  const unsigned char *sdata,
                                                  size_t sdata_len,
                                                  curl_off_t valid_until,
                                                  int ietf_tls_id,
                                                  const char *alpn,
                                                  size_t earlydata_max);

       CURLcode curl_easy_ssls_export(CURL *handle,
                                      curl_ssls_export_function *export_fn,
                                      void *userptr);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  function  iterates  over  all  SSL  session  tickets that belong to the easy handle and invokes the
       <b>export_fn</b> callback on each of them, as long as the callback returns <b>CURLE_OK</b>.

       The callback may then store this information and use <u><a href="../man3/curl_easy_ssls_import.3.html">curl_easy_ssls_import</a>(3)</u> in another libcurl instance
       to add SSL session tickets again. Reuse of SSL session tickets may result in faster handshakes  and  some
       connections might be able to send request data in the initial packets (0-RTT).

       From  all  the  parameters  passed  to the <b>export_fn</b> only two need to be persisted: either <b>session_key</b> or
       <b>shamc</b> and always <b>sdata</b>. All other parameters are informative, e.g. allow the  callback  to  act  only  on
       specific session tickets.

       Note that SSL sessions that involve a client certificate or SRP username/password are not exported.

</pre><h4><b>Export</b> <b>Function</b> <b>Parameter</b></h4><pre>
       Session Key
              This  is  a printable, null-terminated string that starts with <b>hostname:port</b> the session ticket is
              originating from and also contains all relevant SSL parameters used in  the  connection.  The  key
              also carries the name and version number of the TLS backend used.

              It  is recommended to only persist <b>session_key</b> when it can be protected from outside access. Since
              the hostname appears in plain text, it would allow any third party to see how curl has  been  used
              for.

       Salted Hash
              A  binary blob of <b>shmac_len</b> bytes that contains a random salt and a cryptographic hash of the salt
              and <b>session_key</b>.  The  salt  is  generated  for  every  session  individually.  Storing  <b>shmac</b>  is
              recommended when placing session tickets in a file, for example.

              A third party may brute-force known hostnames, but cannot just "grep" for them.

       Session Data
              A binary blob of <b>sdata_len</b> bytes, <b>sdata</b> contains all relevant SSL session ticket information for a
              later import - apart from <b>session_key</b> and <b>shmac</b>.

       valid_until
              Seconds since EPOCH (1970-01-01) until the session ticket is considered valid.

       TLS Version
              The  IETF  assigned  number for the TLS version the session ticket originates from. This is <b>0x0304</b>
              for TLSv1.3, <b>0x0303</b>  for  1.2,  etc.  Session  tickets  from  version  1.3  have  better  security
              properties, so an export might store only those.

       ALPN   The  ALPN protocol that had been negotiated with the host. This may be <b>NULL</b> if negotiation gave no
              result or had not been attempted.

       Early Data
              The maximum amount of bytes the server supports to receive in early data (0-RTT). This is 0 unless
              the server explicitly indicates support.

</pre><h4><b>PROTOCOLS</b></h4><pre>
       This functionality affects all TLS based protocols: HTTPS, FTPS, IMAPS, POP3S, SMTPS etc.

       This option works only with the following TLS backends: BearSSL, GnuTLS, OpenSSL, mbedTLS and wolfSSL

</pre><h4><b>EXAMPLE</b></h4><pre>
       CURLcode my_export_cb(CURL *handle,
                             void *userptr,
                             const char *session_key,
                             const unsigned char *shmac,
                             size_t shmac_len,
                             const unsigned char *sdata,
                             size_t sdata_len,
                             curl_off_t valid_until,
                             int ietf_tls_id,
                             const char *alpn,
                             size_t earlydata_max)
       {
         /* persist sdata */
         return CURLE_OK;
       }

       int main(void)
       {
         CURLSHcode sh;
         CURLSH *share = curl_share_init();
         CURLcode rc;
         CURL *curl;

         sh = curl_share_setopt(share, CURLSHOPT_SHARE, CURL_LOCK_DATA_SSL_SESSION);
         if(sh)
           printf("Error: %s\n", curl_share_strerror(sh));

         curl = curl_easy_init();
         if(curl) {
           curl_easy_setopt(curl, CURLOPT_SHARE, share);

           rc = curl_easy_ssls_export(curl, my_export_cb, NULL);

           /* always cleanup */
           curl_easy_cleanup(curl);
         }
         curl_share_cleanup(share);
       }

</pre><h4><b>AVAILABILITY</b></h4><pre>
       Added in curl 8.12.0

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       This function returns a CURLcode indicating success or error.

       CURLE_OK (0) means everything was OK,  non-zero  means  an  error  occurred,  see  <u><a href="../man3/libcurl-errors.3.html">libcurl-errors</a>(3)</u>.  If
       <u><a href="../man3/CURLOPT_ERRORBUFFER.3.html">CURLOPT_ERRORBUFFER</a>(3)</u> was set with <u><a href="../man3/curl_easy_setopt.3.html">curl_easy_setopt</a>(3)</u> there can be an error message stored in the error
       buffer when non-zero is returned.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/CURLOPT_SHARE.3.html">CURLOPT_SHARE</a></b>(3), <b><a href="../man3/curl_easy_ssls_import.3.html">curl_easy_ssls_import</a></b>(3), <b><a href="../man3/curl_share_setopt.3.html">curl_share_setopt</a></b>(3)

libcurl                                            2025-06-16                           <u><a href="../man3/curl_easy_ssls_export.3.html">curl_easy_ssls_export</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>