<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmMergeLabels, pmMergeLabelSets - merge sets of performance metric labels</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libpcp3-dev">libpcp3-dev_6.3.8-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmMergeLabels</b>, <b>pmMergeLabelSets</b> - merge sets of performance metric labels

</pre><h4><b>C</b> <b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;pcp/pmapi.h&gt;</b>

       <b>int</b> <b>pmMergeLabels(char</b> <b>**</b><u>sets</u><b>,</b> <b>int</b> <u>nsets</u><b>,</b> <b>char</b> <b>*</b><u>buffer</u><b>,</b> <b>int</b> <u>length</u><b>);</b>

       <b>int</b> <b>pmMergeLabelSets(pmLabelSet</b> <b>**</b><u>sets</u><b>,</b> <b>int</b> <u>nsets</u><b>,</b> <b>char</b> <b>*</b><u>buffer</u><b>,</b> <b>int</b> <u>length</u><b>,</b> <b>int</b> <b>(*</b><u>filter</u><b>)(const</b> <b>pmLabel</b>
               <b>*,</b> <b>const</b> <b>char</b> <b>*,</b> <b>void</b> <b>*),</b> <b>void</b> <b>*</b><u>arg</u><b>);</b>

       <b>cc</b> <b>...</b> <b>-lpcp</b>

</pre><h4><b>PYTHON</b> <b>SYNOPSIS</b></h4><pre>
       <b>from</b> <b>pcp</b> <b>import</b> <b>pmapi</b>

       <u>buffer</u> = pmapi.pmContext().pmMergeLabels(<u>sets</u>)
       <u>buffer</u> = pmapi.pmContext().pmMergeLabelSets(<u>sets</u>, <u>filter</u>)

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pmMergeLabels</b>  takes  multiple (<u>nsets</u>) performance metric label <u>sets</u> and merges them into a single result
       <u>buffer</u> of <u>length</u> bytes.  Both the input <u>sets</u> and the result <u>buffer</u> are <u>name</u>:<u>value</u> pairs  in  the  "JSONB"
       format described on <b><a href="../man3/pmLookupLabels.3.html">pmLookupLabels</a></b>(3).

       The  <b>pmMergeLabelSets</b>  interface  serves  the  same  purpose, but allows for indexed <u>sets</u> of labels to be
       merged.  The format of the <u>pmLabelSet</u> data structure is described in detail in <b><a href="../man3/pmLookupLabels.3.html">pmLookupLabels</a></b>(3).

       Although names may repeat across the provided label <u>sets</u>, duplicate names are not allowed  in  the  final
       <u>buffer</u>.   Any label names occurring in more than one of the input label <u>sets</u> are reduced to one using the
       rules described in the "PRECEDENCE" section of <b>pmLookupLabels</b>.  The position of each element in the  <u>sets</u>
       array is significant in terms of the precedence rules - earlier positions are taken to be of lower prece‐
       dence to later positions.

       Values must be primitive JSON entities (e.g. numbers, strings), one-dimensional arrays or maps (i.e. sim‐
       ple associative arrays).

       In  addition to using indexed label <u>sets</u> the <b>pmMergeLabelSets</b> interface provides an optional <u>filter</u> call‐
       back function.  If non-NULL, this function will be called for each label that would be added to the  out‐
       put <u>buffer</u>, allowing finer-grained control over the final merged set.  This mechanism can be used to <u>fil‐</u>
       <u>ter</u>  individual  labels  based  on  their name, value, and/or flags.  If the <u>filter</u> function returns zero
       (false), then the given label is filtered from the resulting set.  Any non-zero  return  value  indicates
       that the label should be included in the <u>buffer</u>.

</pre><h4><b>PYTHON</b> <b>EXAMPLE</b></h4><pre>
       <b>import</b> <b>sys</b>
       <b>import</b> <b>json</b>
       <b>from</b> <b>pcp</b> <b>import</b> <b>pmapi</b>
       <b>import</b> <b>cpmapi</b> <b>as</b> <b>c_api</b>

       <b>def</b> <b>merge_callback(label,</b> <b>jsondata,</b> <b>data=None):</b>
           <b>d</b> <b>=</b> <b>json.loads(jsondata)</b>
           <b>labelsD.update(d)</b>
           <b>return</b> <b>0</b>

       <b>ctx</b> <b>=</b> <b>pmapi.pmContext()</b>

       <b>for</b> <b>metric</b> <b>in</b> <b>sys.argv[1:]:</b>
           <b>pmid</b> <b>=</b> <b><a href="../manmetric/ctx.pmLookupName.metric.html">ctx.pmLookupName</a>(metric)[0]</b>
           <b>lset</b> <b>=</b> <b>ctx.pmLookupLabels(pmid)</b>
           <b>labelsD</b> <b>=</b> <b>{}</b>
           <b>ctx.pmMergeLabelSets(lset,</b> <b>merge_callback)</b>
           <b>print("==</b> <b>%s</b> <b>==="</b> <b>%</b> <b>metric)</b>
           <b>for</b> <b>n,v</b> <b>in</b> <b>labelsD.items():</b>
               <b>print("</b>    <b>%s</b> <b>=</b> <b>%s"</b> <b>%</b> <b>(n,v))</b>
           <b>ctx.pmFreeLabelSets(lset)</b>

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       On success, both <b>pmMergeLabels</b> and <b>pmMergeLabelSets</b> returns the number of bytes written into the supplied
       <u>buffer</u>.

       Failure  to  parse  the  input strings, failure to allocate memory, or any internal inconsistencies found
       will result in a negative return code.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/pminfo.1.html">pminfo</a></b>(1), <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3) and <b><a href="../man3/pmLookupLabels.3.html">pmLookupLabels</a></b>(3).

Performance Co-Pilot                                   PCP                                      <u><a href="../man3/PMMERGELABELS.3.html">PMMERGELABELS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>