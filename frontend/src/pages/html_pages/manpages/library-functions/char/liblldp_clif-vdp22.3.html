<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clif_vsi,clif_vsievt,clif_vsiwait - Manipulate VDP IEEE 802.1 Ratified Standard Associations</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/lldpad-dev">lldpad-dev_1.1.1-1build1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       clif_vsi,clif_vsievt,clif_vsiwait - Manipulate VDP IEEE 802.1 Ratified Standard Associations

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include "include/clif.h"

       <b>int</b>  <b>clif_vsi(struct</b>  <b>clif</b>  <b>*connp,</b>  <b>char</b>  <b>*ifname,</b>  <b>unsigned</b>  <b>int</b>  <b>tlvid,</b> <b>char</b> <b>*cmd,</b> <b>char</b> <b>*reply,</b> <b>size_t</b>
       <b>*reply_len);</b>

       <b>int</b> <b>clif_vsievt(struct</b> <b>clif</b> <b>*connp,</b> <b>char</b> <b>*reply,</b> <b>size_t</b> <b>*reply_len,</b> <b>int</b> <b>wait);</b>

       <b>int</b> <b>clif_vsiwait(struct</b> <b>clif</b> <b>*connp,</b> <b>char</b> <b>*ifname,</b> <b>unsigned</b> <b>int</b> <b>tlvid,</b> <b>char</b>  <b>*cmd,</b>  <b>char</b>  <b>*reply,</b>  <b>size_t</b>
       <b>*reply_len,</b> <b>int</b> <b>wait);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  Virtual  station  interface  Discovery  Protocol  is  a  protocol  to  manage  the  association  and
       deassociation of virtual machine network interfaces (VSIs) between the station and  an  adjacent  switch.
       VDP is typically used with the local switch in VEPA mode and the adjacent switch port in reflective relay
       (also called haripin) mode.  This allows all traffic to be sent to the switch for processing.  Reflective
       relay mode is negotiated via EVB TLVs (see lldptool-evb).

       This  man  pages  describes  the IEEE 802.1 Qbg ratified standard dated from July 5th, 2012. This differs
       from the draft 0.2 which is implemented as well, see <b><a href="../man8/lldptool-vdp.8.html">lldptool-vdp</a></b>(8).  For clarification in this man page
       the version complying to the ratified standard is called VDP22 and the version complying to the draft 0.2
       is called VDP.

   <b>VSI</b> <b>Parameter</b>
       Each VDP22 TLVs contains a command mode, manager identifier, type identifier,  type  identifier  version,
       VSI instance identifier, migiration hints and filter information.  The fields are explained next:

       <b>Command</b> <b>Mode:</b>
              The  command  mode  determines  the type of the VSI association to be established.  It is an ascii
              string can be one of:

              assoc: Create an VSI association.

              preassoc:
                     Create an VSI preassociation. The association is only announced to the switch.

              preassoc-rr:
                     Create an VSI preassociation. The association is only  announced  to  the  switch  and  the
                     switch should reserve the resources.

              deassoc:
                     Delete an VSI association.
       Other strings are not recognized and return an error.

       <b>Manager</b> <b>identifier:</b>
              The  manager  identifier  is a string of up to 16 alphanumeric characters.  It can also be an UUID
              according to RFC 4122 with optional dashes in between.

       <b>Type</b> <b>Identifier:</b>
              The type identifier is a number in the range of 0 to 2^24 - 1.

       <b>Type</b> <b>Identifier</b> <b>Version:</b>
              The type identifier version is a number in the range of 0 to 255.

       <b>VSI</b> <b>Instance</b> <b>Identifier:</b>
              The VSI instance identifier is an UUID according to RFC 4122 with optional dashes in between.

       <b>Migration</b> <b>Hints:</b>
              The migiration hints is a string aiding in migration of virtual machines:

              none:  No hints available.

              from:  The virtual machine is migriting away.

              to:    The virtual machine is migriting to.

       <b>Filter</b> <b>Information</b> <b>Data:</b>
              The filter information data can be supplied in four different formats:

              vlan (1)
                     A vlan number only, also known as filter information format 1.  The vlan  identifier  is  a
                     number in the range of 1 to 2^16 - 1.  The high order 4 bits are used as quality of service
                     bits.   The  vlan identifier can be zero, a vlan identifier is then selected by the switch.
                     Refer to IEEE 802.1 Qbg ratified standard for details.

              vlan-mac (2)
                     A vlan number and MAC address delimited by a slash ('-'), also known as filter  information
                     format  2.   The  MAC address is specified in the format xx:xx:xx:xx:xx:xx.  The colons are
                     mandatory.  For vlan details see (1).

              vlan-mac-group (4)
                     A vlan number, MAC address and group identifier, each delimited  by  a  slash  ('-'),  also
                     known  as  filter information format 4.  The group identifier is a 32 bit number.  For vlan
                     and MAC address details see (1) and (2).

              vlan--group (3)
                     A vlan number and group identifier, delimited by two slashes ('--'), also known  as  filter
                     information format 3.  For vlan and group details see (1) and (4).
       Several  filter  information fields can be supplied.  The have to be separated by comma (',') and must be
       of the same format.

   <b>clif_vsi</b>
       This function sends a VSI command  to  <b><a href="../man8/lldpad.8.html">lldpad</a></b>(8).   Parameter  <u>connp</u>  is  a  pointer  to  the  connection
       information.  This information is obtained by calling <u>clif_open</u> and <u>clif_attach</u>.  Parameter <u>ifname</u> is the
       interface  name <b>lldpad</b> (8) uses to send the VSI data.  Paramenter <u>tlvid</u> is the number of the VSI request.
       Valid numbers are 1 (for Preassociation), 2 (for Preassociation with resource  reservation)  and  3  (for
       association),  4  (for  Deassociation).   Parameter  <u>cmd</u>  points to a character string containing the VSI
       command.  The layout of the VSI command has been  explained  above.   All  VSI  fields  are  concatenated
       together  and  separated  to by commas (',') to form one large string.  Parameter <u>reply</u> is a pointer to a
       character array to receive the reply from <b><a href="../man8/lldpad.8.html">lldpad</a></b>(8).  Parameter <u>reply_len</u> holds  the  maximum  number  of
       characters  available  in  the  array  pointed  to by <u>reply</u>.  On successful return of the call, <u>reply_len</u>
       contains the number of characters stored by <b><a href="../man8/lldpad.8.html">lldpad</a></b>(8) as the response of the command.

       The functions returns zero on success and the <u>reply</u> and <u>reply_len</u> parameters are set.  <u>Reply_len</u> contains
       the number of bytes in the memory area pointed to by <u>reply</u>.  <u>Reply</u>  contains  the  same  information  and
       format as the <u>cmd</u> parameter with several exceptions:

              Command Mode:
                     This  field should be the same as in <u>cmd</u> parameter. If it contains <u>deassoc</u> then the command
                     failed and the field <u>,igration</u> <u>hints</u> contains an error number.

              Migration Hints:
                     This field contains the error number on why the command  was  not  accepted  by  <b><a href="../man8/lldpad.8.html">lldpad</a></b>(8).
                     This  command  failed  to  pass the <b><a href="../man8/lldpad.8.html">lldpad</a></b>(8) sanity checks.  Note that the command was not
                     even sent to the switch for processing.  If no error occurred, this field contains  a  dash
                     ('-').

              Filter Information Data:
                     If  parameter  <u>cmd</u>  contained the a <u>vlan</u> <u>identifier</u> of value zero or a <u>group</u> <u>identifier</u> the
                     switch is allowed to assign a different <u>vlan</u> <u>identifier</u>, which is saved and returned in the
                     reply buffer.
       All the other fields should be returned unchanged.

       The function returns zero when the command was accepted by <b><a href="../man8/lldpad.8.html">lldpad</a></b>(8).  Otherwise it  returns  a  positive
       number on why the command was not accepted.

   <b>clif_vsievt</b>
       After  a  successful  return  of  <u>clif_vsi</u>,  <b><a href="../man8/lldpad.8.html">lldpad</a></b>(8) has sent the command to the switch and waits for a
       response from the switch.  The switch can  still  deny  the  request.   Function  <u>clif_vsievt</u>  waits  for
       parameter <u>wait</u> seconds for a reply from <b><a href="../man8/lldpad.8.html">lldpad</a></b>(8).  Parameter <u>reply_len</u> specifies the maximum buffer size
       pointed to by parameter <u>reply.</u>  If a response was received in <u>wait</u> seconds, the function returns zero and
       sets  <u>reply_len</u>  to the number of bytes received and <u>reply</u> contains the response.  The format is the same
       as in <u>clif_vsi</u>.

       Since the switch can disassociate an established VSI association any time,  it  is  recommended  to  call
       <u>clif_vsievt</u> periodically to check for disassociate event messages from <u><a href="../man8/lldpad.8.html">lldpad</a></u>(8).

       If the functions fails it returns

       -EINVAL
              No attachment to <b><a href="../man8/lldpad.8.html">lldpad</a></b>(8) or <u>wait</u> is negative.

       -EAGAIN
              No message was received during the wait.

       -EIO   Message was received but could not be read.

       -EBADF Message was received but was not an event message.

   <b>clif_vsiwait</b>
       This function combines <u>clif_vsi</u> and <u>clif_vsievt</u> into one function call.

</pre><h4><b>EXAMPLE</b> <b>&amp;</b> <b>USAGE</b></h4><pre>
       Code sample to create an VSI association on <u>eth0</u>:

       char ok[MAX_CLIF_MSGBUF];
       int rc;
       size_t ok_len = sizeof(ok);
       char *cmd ="assoc,blabla,12345,1,00000000-1111-2222-3333-aabbccddeeff"
                 ",none,10-aa:bb:00:00:00:10,11-aa:bb:00:00:00:11";
       struct clif *tool_conn = clif_open();

       if (!tool_conn) {
             fprintf(stderr, "%s can not open connection to LLDPAD0,
                  progname);
             <a href="../man5/exit.5.html">exit</a>(5);
       }

       /* Attach to the vdp22 module */
       if (clif_attach(tool_conn, "80c4")) {
            fprintf(stderr, "%s can not attach to LLDPAD0, progname);
            clif_close(tool_conn);
            tool_conn = NULL;
            <a href="../man5/exit.5.html">exit</a>(5);
       }

       rc = clif_vsiwait(tool_conn, "eth0", 1, cmd, ok, &amp;ok_len, 5);
       if (!rc) {
            /* Parse the response in ok */
            ....
       }
       clif_detach(tool_conn));
       clif_close(tool_conn);

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/lldptool-vdp.8.html">lldptool-vdp</a></b>(8), <b><a href="../man8/lldptool-evb.8.html">lldptool-evb</a></b>(8), <b><a href="../man8/lldptool-evb22.8.html">lldptool-evb22</a></b>(8), <b><a href="../man8/lldptool.8.html">lldptool</a></b>(8), <b><a href="../man8/lldpad.8.html">lldpad</a></b>(8)
       IEEE 802.1Qbg (<a href="http://www.ieee802.org/1/pages/802.1bg.html">http://www.ieee802.org/1/pages/802.1bg.html</a>)

</pre><h4><b>AUTHOR</b></h4><pre>
       Thomas Richter

open-lldp                                         February 2014                                  <u><a href="../man3/liblldp_clif.3.html">liblldp_clif</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>