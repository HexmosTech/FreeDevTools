<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tracefs_function_filter, tracefs_function_notrace, tracefs_filter_functions - Functions to modify the the</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtracefs-doc">libtracefs-doc_1.8.1-1ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tracefs_function_filter, tracefs_function_notrace, tracefs_filter_functions - Functions to modify the the
       function trace filters

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;tracefs.h&gt;</b>

       int <b>tracefs_function_filter</b>(struct tracefs_instance *<u>instance</u>, const char *<u>filter</u>, const char *<u>module</u>, int <u>flags</u>);
       int <b>tracefs_function_notrace</b>(struct tracefs_instance *<u>instance</u>, const char *<u>filter</u>, const char *<u>module</u>, int <u>flags</u>);
       int <b>tracefs_filter_functions</b>(const char *<u>filter</u>, const char *<u>module</u>, char ***<u>list</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>tracefs_function_filter</b> and <b>tracefs_function_notrace</b> can be used to limit the Linux kernel functions that
       would be traced by the function and function-graph tracers. The <b>tracefs_function_filter</b> defines a list of
       functions that can be traced. The <b>tracefs_function_notrace</b> defines a list of functions that will not be
       traced. If a function is in both lists, it will not be traced.

       They take an <u>instance</u> , that can be NULL for the top level tracing, <u>filter</u>, a string that represents a
       filter that should be applied to define what functions are to be traced, <u>module</u>, to limit the filtering
       on a specific module (or NULL to filter on all functions), <u>flags</u> which holds control knobs on how the
       filters will be handled (see <b>FLAGS</b>) section below.

       The <b>tracefs_filter_functions</b> returns a list of functions that can be filtered on via the <u>filter</u> and
       <u>module</u> that are supplied. If both <u>filter</u> and <u>module</u> are NULL then, all available functions that can be
       filtered is returned. On success, <u>list</u> must be freed with <b>tracefs_list_free()</b>(3).

       The <u>filter</u> may be either a straight match of a function, a glob or <a href="../man3/regex.3.html">regex</a>(3). A glob is where <u>*</u> matches
       zero or more characters, <u>?</u> will match zero or one character, and <u>.</u> only matches a period. If the <u>filter</u>
       is determined to be a regex (where it contains anything other than alpha numeric characters, or <u>.</u>, <u>*</u>, <u>?</u>)
       the <u>filter</u> will be processed as a <a href="../man3/regex.3.html">regex</a>(3) following the rules of <a href="../man3/regex.3.html">regex</a>(3), and <u>.</u> is not a period, but
       will match any one character. To force a regular expression, either prefix <u>filter</u> with a <u>^</u> or append it
       with a <u>$</u> as the <u>filter</u> does complete matches of the functions anyway.

       If <u>module</u> is set and <u>filter</u> is NULL, this will imply the same as <u>filter</u> being equal to "*". Which will
       enable all functions for a given <u>module</u>. Otherwise the <u>filter</u> may be NULL if a previous call to
       <b>tracefs_function_filter()</b> with the same <u>instance</u> had <b>TRACEFS_FL_CONTINUE</b> set and this call does not. This
       is useful to simply commit the previous filters. It may also be NULL if <b>TRACEFS_FL_RESET</b> is set and the
       previous call did not have the same <u>instance</u> and <b>TRACEFS_FL_CONTINUE</b> set. This is useful to just clear
       the filter.

</pre><h4><b>FLAGS</b></h4><pre>
       The <u>flags</u> parameter may have the following set, or be zero.

       <b>TRACEFS_FL_RESET</b> : If <u>flags</u> contains <b>TRACEFS_FL_RESET</b>, then it will clear the filters that are currently
       set before applying <u>filter</u>. Otherwise, <u>filter</u> is added to the current set of filters already enabled. If
       this flag is set and the previous call to tracefs_function_filter() had the same <u>instance</u> and the
       <b>TRACEFS_FL_CONTINUE</b> flag was set, then the function will fail with a return of -1 and errno set to EBUSY.

       <b>TRACEFS_FL_CONTINUE</b> : If <u>flags</u> contains <b>TRACEFS_FL_CONTINUE</b>, then <u>filter</u> will not take effect after a
       successful call to tracefs_function_filter(). This allows for multiple calls to tracefs_function_filter()
       to update the filter function and then a single call (one without the <b>TRACEFS_FL_CONTINUE</b> flag set) to
       commit all the filters. It can be called multiple times to add more filters. A call without this flag set
       will commit the changes before returning (if the <u>filter</u> passed in successfully matched). A
       tracefs_function_filter() call after one that had the <b>TRACEFS_FL_CONTINUE</b> flag set for the same instance
       will fail if <b>TRACEFS_FL_RESET</b> flag is set, as the reset flag is only applicable for the first filter to
       be added before committing.

       <b>TRACEFS_FL_FUTURE</b> : If <u>flags</u> contains <b>TRACEFS_FL_FUTURE</b> and <u>module</u> holds a string of a module, then if
       the module is not loaded it will attemp to write the filter with the module in the filter file. Starting
       in Linux v4.13 module functions could be added to the filter before they are loaded. The filter will be
       cached, and when the module is loaded, the filter will be set before the module executes, allowing to
       trace init functions of a module. This will only work if the <u>filter</u> is not a regular expression.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       For <b>tracefs_function_filter()</b> and <b>tracefs_function_notrace()</b> a return of 0 means success. If the there is
       an error but the filtering was not started, then 1 is returned. If filtering was started but an error
       occurs, then -1 is returned. The state of the filtering may be in an unknown state.

       If <b>TRACEFS_FL_CONTINUE</b> was set, and 0 or -1 was returned, then another call to <b>tracefs_function_filter()</b>
       must be done without <b>TRACEFS_FL_CONTINUE</b> set in order to commit (and close) the filtering.

       For <b>tracefs_filter_functions()</b>, a return of 0 means success, and the <u>list</u> parameter is filled with a list
       of function names that matched <u>filter</u> and <u>module</u>. <u>list</u> is a string array, where the last string pointer
       in the array is NULL. The <u>list</u> must be freed with <b>tracefs_list_free()</b>. On failure, a negative is
       returned, and <u>list</u> is ignored.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>tracefs_function_filter</b>() can fail with the following errors:

       <b>EINVAL</b> The filter is invalid or did not match any functions.

       <b>EBUSY</b> The previous call of <b>tracefs_function_filter</b>() was called with the same instance and
       <b>TRACEFS_FL_CONTINUE</b> set and the current call had <b>TRACEFS_FL_RESET</b> set.

       Other errors may also happen caused by internal system calls.

</pre><h4><b>EXAMPLE</b></h4><pre>
           #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
           #include &lt;<a href="file:/usr/include/errno.h">errno.h</a>&gt;
           #include &lt;tracefs.h&gt;

           #define INST "dummy"

           static const char *filters[] = { "run_init_process", "try_to_run_init_process", "dummy1", NULL };

           int main(int argc, char *argv[])
           {
                   struct tracefs_instance *inst = tracefs_instance_create(INST);
                   char **func_list;
                   int ret;
                   int i;

                   if (!inst) {
                           /* Error creating new trace instance */
                   }

                   if (tracefs_filter_functions("*lock*", NULL, &amp;func_list) &lt; 0) {
                           printf("Failed to read filter functions\n");
                           goto out;
                   }
                   printf("Ignoring the following functions:\n");
                   for (i = 0; func_list[i]; i++)
                           printf("  %s\n", func_list[i]);
                   tracefs_list_free(func_list);

                   /* Do not trace any function with the word "lock" in it */
                   ret = tracefs_function_notrace(inst, "*lock*", NULL, TRACEFS_FL_RESET);
                   if (ret) {
                           printf("Failed to set the notrace filter\n");
                           goto out;
                   }

                   /* First reset the filter */
                   ret = tracefs_function_filter(inst, NULL, NULL,
                                                 TRACEFS_FL_RESET | TRACEFS_FL_CONTINUE);
                   if (ret) {
                           printf("Failed to reset the filter\n");
                           /* Make sure it is closed, -1 means filter was started */
                           if (ret &lt; 0)
                                   tracefs_function_filter(inst, NULL, NULL, 0);
                   }

                   for (i = 0; filters[i]; i++) {
                           ret = tracefs_function_filter(inst, filters[i], NULL,
                                                         TRACEFS_FL_CONTINUE);

                           if (ret) {
                                   if (errno == EINVAL)
                                           printf("Filter %s did not match\n", filters[i]);
                                   else
                                           printf("Failed writing %s\n", filters[i]);
                           }
                   }

                   ret = tracefs_function_filter(inst, "*", "ext4", 0);
                   if (ret) {
                           printf("Failed to set filters for ext4\n");
                           /* Force the function to commit previous filters */
                           tracefs_function_filter(inst, NULL, NULL, 0);
                   }

            out:
                   tracefs_instance_destroy(inst);
                   return ret;
           }

</pre><h4><b>FILES</b></h4><pre>
           <b>tracefs.h</b>
                   Header file to include in order to have access to the library APIs.
           <b>-ltracefs</b>
                   Linker switch to add when building a program that uses the library.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/libtracefs.3.html">libtracefs</a></b>(3), <b><a href="../man3/libtraceevent.3.html">libtraceevent</a></b>(3), <b><a href="../man1/trace-cmd.1.html">trace-cmd</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
           <b>Steven</b> <b>Rostedt</b> &lt;<b><a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a></b>[1]&gt;
           <b>Tzvetomir</b> <b>Stoyanov</b> &lt;<b><a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a></b>[2]&gt;
           <b>sameeruddin</b> <b>shaik</b> &lt;<b><a href="mailto:sameeruddin.shaik8@gmail.com">sameeruddin.shaik8@gmail.com</a></b>[3]&gt;

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;<b><a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a></b>[4]&gt;

</pre><h4><b>LICENSE</b></h4><pre>
       libtracefs is Free Software licensed under the GNU LGPL 2.1

</pre><h4><b>RESOURCES</b></h4><pre>
       <b>https://git.kernel.org/pub/scm/libs/libtrace/libtracefs.git/</b>

</pre><h4><b>COPYING</b></h4><pre>
       Copyright (C) 2020 VMware, Inc. Free use of this software is granted under the terms of the GNU Public
       License (GPL).

</pre><h4><b>NOTES</b></h4><pre>
        1. <a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a>
           <a href="mailto:rostedt@goodmis.org">mailto:rostedt@goodmis.org</a>

        2. <a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a>
           <a href="mailto:tz.stoyanov@gmail.com">mailto:tz.stoyanov@gmail.com</a>

        3. <a href="mailto:sameeruddin.shaik8@gmail.com">sameeruddin.shaik8@gmail.com</a>
           <a href="mailto:sameeruddin.shaik8@gmail.com">mailto:sameeruddin.shaik8@gmail.com</a>

        4. <a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a>
           <a href="mailto:linux-trace-devel@vger.kernel.org">mailto:linux-trace-devel@vger.kernel.org</a>

libtracefs 1.8.1                                   06/05/2025                                      <u><a href="../man3/LIBTRACEFS.3.html">LIBTRACEFS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>