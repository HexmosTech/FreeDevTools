<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>upscli_get - Retrieve data from an UPS</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libupsclient-dev">libupsclient-dev_2.8.3-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       upscli_get - Retrieve data from an UPS

</pre><h4><b>SYNOPSIS</b></h4><pre>
               #include &lt;upsclient.h&gt;

               int upscli_get(
                       UPSCONN_t *ups,
                       size_t numq,
                       const char **query,
                       size_t *numa,
                       char ***answer)

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>upscli_get()</b> function takes the pointer <u>ups</u> to a UPSCONN_t state structure, and the pointer <u>query</u> to
       an array of <u>numq</u> query elements. It builds a properly-formatted request from those elements and transmits
       it to <b><a href="../man8/upsd.8.html">upsd</a></b>(8).

       Upon success, the response will be split into separate components. A pointer to those components will be
       returned in <u>answer</u>. The number of usable answer components will be returned in <u>numa</u>.

</pre><h4><b>USES</b></h4><pre>
       This function implements the "GET" command in the NUT protocol. As a result, you can use it to request
       many different things from the server.

       Some examples are:

       •   GET NUMLOGINS &lt;ups&gt;

       •   GET UPSDESC &lt;ups&gt;

       •   GET VAR &lt;ups&gt; &lt;var&gt;

       •   GET TYPE &lt;ups&gt; &lt;var&gt;

       •   GET DESC &lt;ups&gt; &lt;var&gt;

       •   GET CMDDESC &lt;ups&gt; &lt;cmd&gt;

</pre><h4><b>QUERY</b> <b>FORMATTING</b></h4><pre>
       To generate a request for GET NUMLOGINS su700, you would populate query and numq as follows:

                   size_t numq;
                   const char *query[2];

                   query[0] = "NUMLOGINS";
                   query[1] = "su700";
                   numq = 2;

       All escaping of special characters and quoting of elements with spaces is handled for you inside this
       function.

</pre><h4><b>ANSWER</b> <b>FORMATTING</b></h4><pre>
       The raw response from upsd to the above query would be NUMLOGINS su700 1.

       Since this is split up for you, the values work out like this:

                   size_t numa;

                   numa = 3;
                   answer[0] = "NUMLOGINS"
                   answer[1] = "su700"
                   answer[2] = "1"

       Notice that the value which you seek typically starts at answer[numq].

</pre><h4><b>ERROR</b> <b>CHECKING</b></h4><pre>
       This function will check your query against the response from <b><a href="../man8/upsd.8.html">upsd</a></b>(8) data server.

       For example, if you send "VAR" "su700" "ups.status", it will expect to see those at the beginning of the
       response.

       If the results from upsd do not pass this case-insensitive test against your request, this function will
       return an error. When this happens, <b><a href="../man3/upscli_upserror.3.html">upscli_upserror</a></b>(3) will return <u>UPSCLI_ERR_PROTOCOL</u>.

</pre><h4><b>ANSWER</b> <b>ARRAY</b> <b>LIFETIME</b></h4><pre>
       The pointers contained within the <u>answer</u> array are only valid until the next call to an <u>upsclient</u>
       function which references them. If you need to use data from multiple calls, you must copy it somewhere
       else first.

       The <u>answer</u> array and its elements may change locations, so you must not rely on previous addresses. You
       must only use the addresses which were returned by the most recent call. You also must not attempt to use
       more than <u>numa</u> elements in <u>answer</u>. Such behavior is undefined, and may yield bogus data or a crash.

       The array will be deleted after calling <b><a href="../man3/upscli_disconnect.3.html">upscli_disconnect</a></b>(3). Any access after that point is also
       undefined.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       The <b>upscli_get()</b> function returns <u>0</u> on success, or <u>-1</u> if an error occurs.

       If <b>upsd</b> disconnects, you may need to handle or ignore SIGPIPE in order to prevent your program from
       terminating the next time that the library writes to the disconnected socket.

       The following code in your initialization function will allow the <b>upscli_get()</b> call to return an error in
       that case:

                   #include &lt;<a href="file:/usr/include/signal.h">signal.h</a>&gt;
                   ...
                   signal (SIGPIPE, SIG_IGN);
                   ...

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/upscli_list_start.3.html">upscli_list_start</a></b>(3), <b><a href="../man3/upscli_list_next.3.html">upscli_list_next</a></b>(3), <b><a href="../man3/upscli_strerror.3.html">upscli_strerror</a></b>(3), <b><a href="../man3/upscli_upserror.3.html">upscli_upserror</a></b>(3)

Network UPS Tools 2.8.3                            07/08/2025                                      <u><a href="../man3/UPSCLI_GET.3.html">UPSCLI_GET</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>