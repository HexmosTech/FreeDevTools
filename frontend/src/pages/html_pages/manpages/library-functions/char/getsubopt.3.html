<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>getsubopt - parse suboption arguments from a string</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       getsubopt - parse suboption arguments from a string

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;</b>

       <b>int</b> <b>getsubopt(char</b> <b>**restrict</b> <u>optionp</u><b>,</b> <b>char</b> <b>*const</b> <b>*restrict</b> <u>tokens</u><b>,</b>
                     <b>char</b> <b>**restrict</b> <u>valuep</u><b>);</b>

   Feature Test Macro Requirements for glibc (see <b><a href="../man7/feature_test_macros.7.html">feature_test_macros</a></b>(7)):

       <b>getsubopt</b>():
           _XOPEN_SOURCE &gt;= 500
               || /* Since glibc 2.12: */ _POSIX_C_SOURCE &gt;= 200809L

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>getsubopt</b>() parses the list of comma-separated suboptions provided in <u>optionp</u>.  (Such a suboption list is
       typically  produced  when  <b><a href="../man3/getopt.3.html">getopt</a></b>(3)  is  used  to parse a command line; see for example the <u>-o</u> option of
       <b><a href="../man8/mount.8.html">mount</a></b>(8).)  Each suboption may include an associated value, which is separated from the suboption name by
       an equal sign.  The following is an example of the kind of string that might be passed in <u>optionp</u>:

           <b>ro,name=xyz</b>

       The <u>tokens</u> argument is a pointer to a NULL-terminated array of pointers to the  tokens  that  <b>getsubopt</b>()
       will look for in <u>optionp</u>.  The tokens should be distinct, null-terminated strings containing at least one
       character, with no embedded equal signs or commas.

       Each  call to <b>getsubopt</b>() returns information about the next unprocessed suboption in <u>optionp</u>.  The first
       equal sign in a suboption (if any) is interpreted as a separator between the name and the value  of  that
       suboption.   The  value  extends to the next comma, or (for the last suboption) to the end of the string.
       If the name of the suboption matches a known name from <u>tokens</u>, and a value string was found,  <b>getsubopt</b>()
       sets  <u>*valuep</u> to the address of that string.  The first comma in <u>optionp</u> is overwritten with a null byte,
       so <u>*valuep</u> is precisely the "value string" for that suboption.

       If the suboption is recognized, but no value string was found, <u>*valuep</u> is set to NULL.

       When <b>getsubopt</b>() returns, <u>optionp</u> points to the next suboption, or to the null byte ('\0') at the end  of
       the string if the last suboption was just processed.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       If  the first suboption in <u>optionp</u> is recognized, <b>getsubopt</b>() returns the index of the matching suboption
       element in <u>tokens</u>.  Otherwise, -1 is returned and <u>*valuep</u> is the entire <u>name</u><b>[=</b><u>value</u><b>]</b> string.

       Since <u>*optionp</u> is changed, the first suboption before the call to <b>getsubopt</b>() is  not  (necessarily)  the
       same as the first suboption after <b>getsubopt</b>().

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       For an explanation of the terms used in this section, see <b><a href="../man7/attributes.7.html">attributes</a></b>(7).
       ┌─────────────────────────────────────────────────────────────────────────────┬───────────────┬─────────┐
       │ <b>Interface</b>                                                                   │ <b>Attribute</b>     │ <b>Value</b>   │
       ├─────────────────────────────────────────────────────────────────────────────┼───────────────┼─────────┤
       │ <b>getsubopt</b>()                                                                 │ Thread safety │ MT-Safe │
       └─────────────────────────────────────────────────────────────────────────────┴───────────────┴─────────┘

</pre><h4><b>STANDARDS</b></h4><pre>
       POSIX.1-2008.

</pre><h4><b>HISTORY</b></h4><pre>
       POSIX.1-2001.

</pre><h4><b>NOTES</b></h4><pre>
       Since <b>getsubopt</b>() overwrites any commas it finds in the string <u>*optionp</u>, that string must be writable; it
       cannot be a string constant.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following program expects suboptions following a "-o" option.

       #define _XOPEN_SOURCE 500
       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
       #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;

       #include &lt;<a href="file:/usr/include/assert.h">assert.h</a>&gt;

       int
       main(int argc, char *argv[])
       {
           enum {
               RO_OPT = 0,
               RW_OPT,
               NAME_OPT
           };
           char *const token[] = {
               [RO_OPT]   = "ro",
               [RW_OPT]   = "rw",
               [NAME_OPT] = "name",
               NULL
           };
           char *subopts;
           char *value;
           int opt;

           int readonly = 0;
           int readwrite = 0;
           char *name = NULL;
           int errfnd = 0;

           while ((opt = getopt(argc, argv, "o:")) != -1) {
               switch (opt) {
               case 'o':
                   subopts = optarg;
                   while (*subopts != '\0' &amp;&amp; !errfnd) {

                       switch (getsubopt(&amp;subopts, token, &amp;value)) {
                       case RO_OPT:
                           readonly = 1;
                           break;

                       case RW_OPT:
                           readwrite = 1;
                           break;

                       case NAME_OPT:
                           if (value == NULL) {
                               fprintf(stderr,
                                       "Missing value for suboption '%s'\n",
                                       token[NAME_OPT]);
                               errfnd = 1;
                               continue;
                           }

                           name = value;
                           break;

                       default:
                           fprintf(stderr,
                                   "No match found for token: /%s/\n", value);
                           errfnd = 1;
                           break;
                       }
                   }
                   if (readwrite &amp;&amp; readonly) {
                       fprintf(stderr,
                               "Only one of '%s' and '%s' can be specified\n",
                               token[RO_OPT], token[RW_OPT]);
                       errfnd = 1;
                   }
                   break;

               default:
                   errfnd = 1;
               }
           }

           if (errfnd || argc == 1) {
               fprintf(stderr, "\nUsage: %s -o &lt;suboptstring&gt;\n", argv[0]);
               fprintf(stderr,
                       "suboptions are 'ro', 'rw', and 'name=&lt;value&gt;'\n");
               exit(EXIT_FAILURE);
           }

           /* Remainder of program... */

           exit(EXIT_SUCCESS);
       }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/getopt.3.html">getopt</a></b>(3)

Linux man-pages 6.9.1                              2024-06-15                                       <u><a href="../man3/getsubopt.3.html">getsubopt</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>