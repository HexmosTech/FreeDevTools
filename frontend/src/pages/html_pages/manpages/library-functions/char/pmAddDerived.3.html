<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmAddDerived, pmAddDerivedMetric  - register a per-context derived metric name and definition</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libpcp3-dev">libpcp3-dev_6.3.8-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmAddDerived</b>, <b>pmAddDerivedMetric</b>  - register a per-context derived metric name and definition

</pre><h4><b>C</b> <b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;pcp/pmapi.h&gt;</b>

       <b>char</b> <b>*pmAddDerived(char</b> <b>*</b><u>name</u><b>,</b> <b>char</b> <b>*</b><u>expr</u><b>);</b>
       <b>int</b> <b>pmAddDerivedMetric(char</b> <b>*</b><u>name</u><b>,</b> <b>char</b> <b>*</b><u>expr</u><b>,</b> <b>char</b> <b>**</b><u>errmsg</u><b>);</b>

       <b>cc</b> <b>...</b> <b>-lpcp</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Derived  metrics  provide  a  way of extending the Performance Metrics Name Space (PMNS) with new metrics
       defined at the PCP client-side using expressions over the existing performance metrics.

       The <b>pmAddDerived</b> and <b>pmAddDerivedMetric</b> routines may be used to create per-context derived  metrics,  and
       can only be used after the current PMAPI context has been created with <b><a href="../man3/pmNewContext.3.html">pmNewContext</a></b>(3).

       Per-context  derived  metrics  are  similar  in  all aspects except scope to global derived metrics.  The
       latter are defined across all PMAPI contexts and are created with  the  associated  <b><a href="../man3/pmRegisterDerived.3.html">pmRegisterDerived</a></b>(3),
       <b><a href="../man3/pmRegisterDerivedMetric.3.html">pmRegisterDerivedMetric</a></b>(3) and <b><a href="../man3/pmLoadDerivedConfig.3.html">pmLoadDerivedConfig</a></b>(3) routines.

       The  arguments  to <b>pmAddDerived</b> are the <u>name</u> of the new derived metric and <u>expr</u> is an expression defining
       how the values of <u>name</u> should be computed.

       <b>pmAddDerivedMetric</b> is the  exact  functional  equivalent  to  <b>pmAddDerived</b>  except  that  it  provides  a
       simplified model of error handling, where a formatted message is returned via the <u>errmsg</u> parameter.

       Refer  to  the  <b><a href="../man3/pmRegisterDerived.3.html">pmRegisterDerived</a></b>(3) man page for a complete description of the syntactic rules for <u>name</u>,
       the syntactic and semantic rules for <u>expr</u>, return values and the associated error  reporting  mechanisms,
       and the expression evaluation rules.

       Note  that  for  per-context derived metrics, all syntactic and semantic checks are performed at the time
       <b>pmAddDerived</b> or <b>pmAddDerivedMetric</b> is called.  This is different to  global  derived  metrics  where  the
       semantic checks are delayed until the metric is used in a specific PMAPI context.

       There  is no ``unregister'' method, so once registered a per-context derived metric persists for the life
       of the PMAPI context, but it is destroyed as a side-effect of <b><a href="../man3/pmDestroyContext.3.html">pmDestroyContext</a></b>(3).

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       On success, <b>pmAddDerived</b> returns NULL.

       If a syntactic error is found at the time of calling, the value returned by  <b>pmAddDerived</b>  is  a  pointer
       into  <u>expr</u>  indicating <b>where</b> the error was found.  To identify <b>what</b> the error was, the application should
       call <b><a href="../man3/pmDerivedErrStr.3.html">pmDerivedErrStr</a></b>(3) to retrieve the corresponding parser error message.

       <b>pmAddDerivedMetric</b> returns 0 and <u>errmsg</u> is undefined if the parsing is successful.

       If the given <u>expr</u> does not conform to the required syntax <b>pmAddDerivedMetric</b> returns -1 and a dynamically
       allocated error message string in <u>errmsg</u>.  The error message is terminated with a  newline  and  includes
       both  the  input  <u>name</u> and <u>expr</u>, along with an indicator of the position at which the error was detected.
       e.g.
                 Error: pmAddDerivedMetric("my.disk.rates", ...) syntax error
                 <u>4rat(disk.dev.read)</u>
                     <u>^</u>

       The position indicator line may be followed by an additional diagnostic line describing the nature of the
       error, when available.

       In the case of an error, the caller is responsible for calling <b><a href="../man3/free.3.html">free</a></b>(3) to release the space allocated for
       <u>errmsg</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1), <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3), <b><a href="../man3/pmDerivedErrStr.3.html">pmDerivedErrStr</a></b>(3), <b><a href="../man3/pmDestroyContext.3.html">pmDestroyContext</a></b>(3), <b><a href="../man3/pmLoadDerivedConfig.3.html">pmLoadDerivedConfig</a></b>(3),  <b><a href="../man3/pmNewContext.3.html">pmNewContext</a></b>(3),
       <b><a href="../man3/pmRegisterDerived.3.html">pmRegisterDerived</a></b>(3), <b><a href="../man3/pmRegisterDerivedMetric.3.html">pmRegisterDerivedMetric</a></b>(3) and <b><a href="../man5/PMNS.5.html">PMNS</a></b>(5).

Performance Co-Pilot                                                                             <u><a href="../man3/PMADDDERIVED.3.html">PMADDDERIVED</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>