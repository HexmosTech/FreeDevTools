<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vmod_var - Variable support for Varnish VCL</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/varnish-modules">varnish-modules_0.25.0-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       vmod_var - Variable support for Varnish VCL

</pre><h4><b>SYNOPSIS</b></h4><pre>
          import var [as name] [from "path"]

          VOID set(STRING key, STRING value)

          STRING get(STRING)

          VOID global_set(STRING, STRING)

          STRING global_get(STRING)

          VOID set_int(STRING key, INT value)

          INT get_int(STRING key)

          VOID set_string(STRING key, STRING value)

          STRING get_string(STRING key)

          VOID set_real(STRING key, REAL value)

          REAL get_real(STRING key)

          VOID set_duration(STRING key, DURATION value)

          DURATION get_duration(STRING key)

          VOID set_ip(STRING key, IP value)

          IP get_ip(STRING key)

          VOID set_backend(STRING key, BACKEND value)

          BACKEND get_backend(STRING key)

          VOID clear()

       This VMOD implements basic variable support in VCL.

       It  supports  strings, integers, real numbers, durations, IP addresses and backends. There are methods to
       get and set each data type.

       Global variables have a lifespan that extends across requests and VCLs,  for  as  long  as  the  vmod  is
       loaded. Global variables only support strings.

       The remaining functions have PRIV_TASK lifespan and are local to a single request or backend request.

       Example:

          vcl 4.0;
          import var;

          backend default { .host = "192.0.2.11"; .port = "8080"; }

          sub vcl_recv {
              # Set and get some values.
              var.set("foo", "bar");
              set req.http.x-foo = var.get("foo");

              var.set_int("ten", 10);
              var.set_int("five", 5);
              set req.http.twenty = var.get_int("ten") + var.get_int("five") + 5;

              # VCL will use the first token to decide final data type. Headers are strings.
              # set req.http.X-lifetime = var.get_int("ten") + " seconds"; #  Won't work.
              set req.http.X-lifetime = "" + var.get_int("ten") + " seconds";  # Works!

              var.set_duration("timedelta", 1m);  # 60s
              set req.http.d1 = var.get_duration("timedelta");

              var.set_ip("endpoint", client.ip);
              set req.http.x-client = var.get_ip("endpoint");

              # Unset all non-global variables.
              var.clear();

              # Demonstrate use of global variables as state flags.
              if (req.url ~ "/close$") {
                  var.global_set("open", "no");
              }
              else if (req.url ~ "/open$") {
                  var.global_set("open", "yes");
              }

              if (var.global_get("open") != "yes") {
                  return (synth(200, "We are currently closed, sorry!"));
              }
          }

   <b>VOID</b> <b>set(STRING</b> <b>key,</b> <b>STRING</b> <b>value)</b>
       Set <u>key</u> to <u>value</u>.

   <b>STRING</b> <b>get(STRING)</b>
       Get <u>key</u> with data type STRING. If stored <u>key</u> is not a STRING a NULL string is returned.

   <b>VOID</b> <b>global_set(STRING,</b> <b>STRING)</b>
   <b>STRING</b> <b>global_get(STRING)</b>
   <b>VOID</b> <b>set_int(STRING</b> <b>key,</b> <b>INT</b> <b>value)</b>
       Set <u>key</u> to <u>value</u>.

   <b>INT</b> <b>get_int(STRING</b> <b>key)</b>
       Get <u>key</u> with data type INT. If stored <u>key</u> is not an INT zero will be returned.

   <b>VOID</b> <b>set_string(STRING</b> <b>key,</b> <b>STRING</b> <b>value)</b>
       Identical to set().

   <b>STRING</b> <b>get_string(STRING</b> <b>key)</b>
       Identical to get().

   <b>VOID</b> <b>set_real(STRING</b> <b>key,</b> <b>REAL</b> <b>value)</b>
       Set <u>key</u> to <u>value</u>.

   <b>REAL</b> <b>get_real(STRING</b> <b>key)</b>
       Get <u>key</u> with data type REAL. If stored <u>key</u> is not a REAL zero will be returned.

   <b>VOID</b> <b>set_duration(STRING</b> <b>key,</b> <b>DURATION</b> <b>value)</b>
       Set <u>key</u> to <u>value</u>.

   <b>DURATION</b> <b>get_duration(STRING</b> <b>key)</b>
       Get <u>key</u> with data type DURATION. If stored <u>key</u> is not a DURATION zero will be returned.

   <b>VOID</b> <b>set_ip(STRING</b> <b>key,</b> <b>IP</b> <b>value)</b>
       Set <u>key</u> to <u>value</u>.

   <b>IP</b> <b>get_ip(STRING</b> <b>key)</b>
       Get <u>key</u> with data type IP. If stored <u>key</u> is not an IP null will be returned.

   <b>VOID</b> <b>set_backend(STRING</b> <b>key,</b> <b>BACKEND</b> <b>value)</b>
       Set <u>key</u> to <u>value</u>.

   <b>BACKEND</b> <b>get_backend(STRING</b> <b>key)</b>
       Get <u>key</u> with data type BACKEND. If stored <u>key</u> is not a BACKEND, null will be returned.

   <b>VOID</b> <b>clear()</b>
       Clear all non-global variables.

                                                                                                     <u><a href="../man3/VMOD_VAR.3.html">VMOD_VAR</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>