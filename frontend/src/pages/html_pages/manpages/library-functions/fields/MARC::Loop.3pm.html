<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARC::Loop - process a batch of MARC21 records</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmarc-loop-perl">libmarc-loop-perl_0.01-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       MARC::Loop - process a batch of MARC21 records

</pre><h4><b>SYNOPSIS</b></h4><pre>
           use MARC::Loop qw(marcloop marcbuild TAG VALREF DEL);
           my $filehandle = \*STDIN;
           my $deleted999 = 0;
           my $fixed035 = 0;
           marcloop {
               my ($leader, $fields, $raw_marc_ref) = @_;
               my $changed;
               foreach my $field (@$fields) {
                   if ($field-&gt;[TAG] eq '035') {
                       # Normalize OCLC numbers
                       my $valref = $field-&gt;[VALREF];
                       $$valref =~ s/\(OCoLC\)oc[mn]0*/(OCoLC)/g;
                       $fixed035++;
                       $changed = 1;
                   }
                   elsif ($field-&gt;[TAG] eq '999') {
                       # Delete 999 fields
                       $field-&gt;[DEL] = 1;
                       $deleted999++;
                       $changed = 1;
                   }
               }
               # Print only changed records
               print marcbuild($leader, $fields) if $changed;
           } $filehandle;
           print STDERR "$deleted999 999 fields were deleted\n",
                        "$fixed035 035 fields were fixed\n";

</pre><h4><b>DESCRIPTION</b></h4><pre>
       MARC::Loop is an alternative to MARC::File and MARC::Record that eschews an object-oriented approach in
       favor of a bare-bones procedural one.

</pre><h4><b>FUNCTIONS</b></h4><pre>
       All of these functions are exported upon request.

   <b>marcloop</b>
           # This example prints a MARC record in human-readable form, using a single
           # line for each field no matter how many subfields it might have.
           use MARC::Loop <a href="../manmarcloop/qw.marcloop.html">qw</a>(marcloop);
           marcloop {
               my ($leader, $fields, $raw_marc_ref) = @_;
               foreach my $field (@$fields) {
                   if ($field-&gt;[TAG] lt '010) {
                       # Control field
                       my $valref = $field-&gt;[VALREF];
                       print $field-&gt;[TAG], '    ', $$valref, "\n";
                   }
                   else {
                       # Data field
                       my ($i1, $i2) = ($field-&gt;[IND1], $field-&gt;[IND2]);
                       print "$field-&gt;[TAG] $i1$i2";
                       my @subfields  = @{ $field-&gt;[SUBS..$#$field] };
                       foreach my $subfield (@subfields) {
                           my ($code, $valref) = @$subfield;
                           print '$', $code, ' ', $$valref;
                       }
                       print "\n";
                   }
               }
           } $filehandle, %options;

       Options:

       <b>print_all</b>
           All  MARC  records  will  be  printed  to  STDOUT.  Any changes you make will be reflected in what is
           printed.

       <b>drop</b> <u>array_ref</u>
               'drop' =&gt; [ '001', '090' ]

           Tags of fields to be dropped unconditionally.

       <b>only</b> <u>array_ref</u>
               'only' =&gt; [ qw(001 004 008 852 856) ]

           Tags of fields to be preserved; all other fields will be dropped.  (The leader is never  dropped,  of
           course.)

       <b>error</b>
           A code reference to call when there is an error.

               'error' =&gt; sub { exit -1 }

       <b>strict</b>
               'strict' =&gt; 1

           Halt processing when an ill-formed MARC record is encountered.

       Options will be more fully documented in a future release; in the meantime, read the source code.

   <b>marcparse</b>
           ($leader, $fields) = marcparse(\$string, %options);

       Parses a MARC record into the same data structure that <b>marcloop</b> uses.  Options are mostly the same as for
       <b>marcloop</b>.

   <b>marcbuild</b>
           print marcbuild($leader, $fields);

       Builds a raw MARC record from the same data structure that <b>marcloop</b> uses and that <b>marcparse</b> produces.

   <b>marcfield</b>
           # Control field
           push $@fields, marcfield(
               '001',   # Tag
               1234567, # Content
           );

           # Data field
           push $@fields, marcfield(
               '245',              # Tag
               ' ', ' ',           # Indicators
               'a' =&gt; 'Blah blah', # Subfield $a
               'c' =&gt; 'Amy Emu',   # Subfield $c
               ...                 # More subfields
           );

       A convenience function to build a data structure representing a single MARC21 field.

</pre><h4><b>BUGS</b></h4><pre>
       The  documentation is woefully lacking and probably just plain wrong.  Read the source code -- or, better
       yet, step through it in the Perl debugger -- to get a better understanding of what this code does.

       Unhandled errors cause ill-formed records to be dropped without notice.  You must specify an <b>error</b> option
       to <b>marcloop</b> to get around this.

</pre><h4><b>AUTHOR</b></h4><pre>
       Paul Hoffman &lt;<a href="mailto:paul@flo.org">paul@flo.org</a>&gt;.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2009-2010 Fenway Libraries Online.  Released under the GNU Public License, version 3.

perl v5.36.0                                       2023-01-27                                    <u>MARC::<a href="../man3pm/Loop.3pm.html">Loop</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>