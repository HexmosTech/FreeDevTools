<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nflog_fd, nflog_callback_register, nflog_handle_packet, nflog_bind_group, nflog_unbind_group,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libnetfilter-log-doc">libnetfilter-log-doc_1.0.2-4build1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nflog_fd, nflog_callback_register, nflog_handle_packet, nflog_bind_group, nflog_unbind_group,
       nflog_set_mode, nflog_set_timeout, nflog_set_qthresh, nflog_set_nlbufsiz, nflog_set_flags - Group
       handling

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;stddef.h&gt;</b>
       <b>#include</b> <b>&lt;libnetfilter_log/libnetfilter_log.h&gt;</b>

       int <b>nflog_fd</b> (struct nflog_handle *h)
       int <b>nflog_callback_register</b> (struct nflog_g_handle *gh, nflog_callback *cb, void *data)
       int <b>nflog_handle_packet</b> (struct nflog_handle *h, char *buf, int len)
       struct nflog_g_handle * <b>nflog_bind_group</b> (struct nflog_handle *h, uint16_t num)
       int <b>nflog_unbind_group</b> (struct nflog_g_handle *gh)
       int <b>nflog_set_mode</b> (struct nflog_g_handle *gh, uint8_t mode, uint32_t range)
       int <b>nflog_set_timeout</b> (struct nflog_g_handle *gh, uint32_t timeout)
       int <b>nflog_set_qthresh</b> (struct nflog_g_handle *gh, uint32_t qthresh)
       int <b>nflog_set_nlbufsiz</b> (struct nflog_g_handle *gh, uint32_t nlbufsiz)
       int <b>nflog_set_flags</b> (struct nflog_g_handle *gh, uint16_t flags)

</pre><h4><b>Detailed</b> <b>Description</b></h4><pre>
       Once libnetfilter_log library has been initialised (See <b>LibrarySetup</b>), it is possible to bind the program
       to a specific group. This can be done using <b>nflog_bind_group()</b>.

       The group can then be tuned via <b>nflog_set_mode()</b> among many others.

       Here's a little code snippet that binds to the group 100:

               printf('binding this socket to group 100\0);
               gh = nflog_bind_group(h, 100);
               if (!gh) {
                       fprintf(stderr, 'no handle for group 100\0);
                       <a href="../man1/exit.1.html">exit</a>(1);
               }

               printf('setting copy_packet mode\0);
               if (nflog_set_mode(gh, NFULNL_COPY_PACKET, 0xffff) &lt; 0) {
                       fprintf(stderr, 'can't set packet copy mode\0);
                       <a href="../man1/exit.1.html">exit</a>(1);
               }

       Next step is the handling of incoming packets which can be done via a loop:

               fd = nflog_fd(h);

               while ((rv = recv(fd, buf, sizeof(buf), 0)) &amp;&amp; rv &gt;= 0) {
                       printf('pkt received (len=%u)\0, rv);
                       nflog_handle_packet(h, buf, rv);
               }

       Data and information about the packet can be fetched by using message parsing functions.

       <b>See</b> <b>also:</b>
           <b>LibrarySetup</b> man page (<b>man</b> <b>nflog_open</b>)
           <b>Parsing</b> man page (<b>man</b> <b>nflog_get_gid</b>)

</pre><h4><b>Function</b> <b>Documentation</b></h4><pre>
   <b>struct</b> <b>nflog_g_handle</b> <b>*</b> <b>nflog_bind_group</b> <b>(struct</b> <b>nflog_handle</b> <b>*</b> <b>h,</b> <b>uint16_t</b> <b>num)</b>
       nflog_bind_group - bind a new handle to a specific group number.

       <b>Parameters</b>
           <u>h</u> Netfilter log handle obtained via call to <b>nflog_open()</b>
           <u>num</u> the number of the group to bind to

       <b>Returns</b>
           an nflog_g_handle for the newly created group or NULL on failure.

       <b>Errors</b>
           <b>EBUSY</b> This process has already binded to the group
           <b>EOPNOTSUPP</b> Request rejected by kernel. Another process has already binded to the group, or this
           process is not running as root

       Definition at line <b>464</b> of file <b>libnetfilter_log.c</b>.

   <b>int</b> <b>nflog_callback_register</b> <b>(struct</b> <b>nflog_g_handle</b> <b>*</b> <b>gh,</b> <b>nflog_callback</b> <b>*</b> <b>cb,</b> <b>void</b> <b>*</b> <b>data)</b>
       nflog_callback_register - register function to process packets

       <b>Parameters</b>
           <u>gh</u> Netfilter log group handle obtained by call to <b>nflog_bind_group()</b>
           <u>cb</u> callback function to call for each logged packet
           <u>data</u> custom data to pass to the callback function

       <b>Returns</b>
           0

       Definition at line <b>343</b> of file <b>libnetfilter_log.c</b>.

   <b>int</b> <b>nflog_fd</b> <b>(struct</b> <b>nflog_handle</b> <b>*</b> <b>h)</b>
       nflog_fd - get the file descriptor associated with the nflog handler

       <b>Parameters</b>
           <u>h</u> handler obtained via call to <b>nflog_open()</b>

       <b>Returns</b>
           a file descriptor for the netlink connection associated with the given log connection handle. The
           file descriptor can then be used for receiving the logged packets for processing.

       Definition at line <b>245</b> of file <b>libnetfilter_log.c</b>.

   <b>int</b> <b>nflog_handle_packet</b> <b>(struct</b> <b>nflog_handle</b> <b>*</b> <b>h,</b> <b>char</b> <b>*</b> <b>buf,</b> <b>int</b> <b>len)</b>
       nflog_handle_packet - handle a packet received from the nflog subsystem

       <b>Parameters</b>
           <u>h</u> Netfilter log handle obtained via call to <b>nflog_open()</b>
           <u>buf</u> nflog data received from the kernel
           <u>len</u> length of packet data in buffer

       Triggers an associated callback for each packet contained in <b>buf</b>. Data can be read from the queue using
       <b>nflog_fd()</b> and <b>recv()</b>. See example code in the Detailed Description.

       <b>Returns</b>
           0 on success, -1 if either the callback returned -ve or <b>buf</b> contains corrupt data. <b>errno</b> is not
           reliably set: caller should zeroise first if interested.

       Definition at line <b>366</b> of file <b>libnetfilter_log.c</b>.

   <b>int</b> <b>nflog_set_flags</b> <b>(struct</b> <b>nflog_g_handle</b> <b>*</b> <b>gh,</b> <b>uint16_t</b> <b>flags)</b>
       nflog_set_flags - set the nflog flags for this group

       <b>Parameters</b>
           <u>gh</u> Netfilter log group handle obtained by call to <b>nflog_bind_group()</b>.
           <u>flags</u> Flags that you want to set

       There are two existing flags:

        - NFULNL_CFG_F_SEQ: This enables local nflog sequence numbering.
        - NFULNL_CFG_F_SEQ_GLOBAL: This enables global nflog sequence numbering.
        - NFULNL_CFG_F_CONNTRACK: This enables to acquire related conntrack.

       <b>Returns</b>
           0 on success, -1 on failure with <b>errno</b> set.

       <b>Errors</b>
           from underlying calls, in exceptional circumstances

       Definition at line <b>664</b> of file <b>libnetfilter_log.c</b>.

   <b>int</b> <b>nflog_set_mode</b> <b>(struct</b> <b>nflog_g_handle</b> <b>*</b> <b>gh,</b> <b>uint8_t</b> <b>mode,</b> <b>uint32_t</b> <b>range)</b>
       nflog_set_mode - set the amount of packet data that nflog copies to userspace

       <b>Parameters</b>
           <u>gh</u> Netfilter log group handle obtained by call to <b>nflog_bind_group()</b>.
           <u>mode</u> the part of the packet that we are interested in
           <u>range</u> size of the packet that we want to get

       Sets the amount of data to be copied to userspace for each packet logged to the given group.

       • NFULNL_COPY_NONE - do not copy any data

       • NFULNL_COPY_META - copy only packet metadata

       • NFULNL_COPY_PACKET - copy entire packet

       <b>Returns</b>
           0 on success, -1 on failure with <b>errno</b> set.

       <b>Errors</b>
           from underlying calls, in exceptional circumstances

       Definition at line <b>534</b> of file <b>libnetfilter_log.c</b>.

   <b>int</b> <b>nflog_set_nlbufsiz</b> <b>(struct</b> <b>nflog_g_handle</b> <b>*</b> <b>gh,</b> <b>uint32_t</b> <b>nlbufsiz)</b>
       nflog_set_nlbufsiz - set the size of the nflog buffer for this group

       <b>Parameters</b>
           <u>gh</u> Netfilter log group handle obtained by call to <b>nflog_bind_group()</b>.
           <u>nlbufsiz</u> Size of the nflog buffer

       This function sets the size (in bytes) of the buffer that is used to stack log messages in nflog.

       <b>Warning</b>
           The  use of this function is strongly discouraged. The default buffer size (which is one memory page)
           provides the optimum results in terms of performance. Do not use this function in your applications.

       <b>Returns</b>
           0 on success, -1 on failure with <b>errno</b> set.

       <b>Errors</b>
           from underlying calls, in exceptional circumstances

       Definition at line <b>627</b> of file <b>libnetfilter_log.c</b>.

   <b>int</b> <b>nflog_set_qthresh</b> <b>(struct</b> <b>nflog_g_handle</b> <b>*</b> <b>gh,</b> <b>uint32_t</b> <b>qthresh)</b>
       nflog_set_qthresh - set the maximum amount of logs in buffer for this group

       <b>Parameters</b>
           <u>gh</u> Netfilter log group handle obtained by call to <b>nflog_bind_group()</b>.
           <u>qthresh</u> Maximum number of log entries

       This function determines the maximum number of log entries in the buffer until it is pushed to userspace.

       <b>Returns</b>
           0 on success, -1 on failure with <b>errno</b> set.

       <b>Errors</b>
           from underlying calls, in exceptional circumstances

       Definition at line <b>596</b> of file <b>libnetfilter_log.c</b>.

   <b>int</b> <b>nflog_set_timeout</b> <b>(struct</b> <b>nflog_g_handle</b> <b>*</b> <b>gh,</b> <b>uint32_t</b> <b>timeout)</b>
       nflog_set_timeout - set the maximum time to push log buffer for this group

       <b>Parameters</b>
           <u>gh</u> Netfilter log group handle obtained by call to <b>nflog_bind_group()</b>.
           <u>timeout</u> Time to wait until the log buffer is pushed to userspace

       This function allows one to set the maximum time that nflog waits until  it  pushes  the  log  buffer  to
       userspace  if  no  new  logged  packets  have occured. Basically, nflog implements a buffer to reduce the
       computational cost of delivering the log message to userspace.

       <b>Returns</b>
           0 on success, -1 on failure with <b>errno</b> set.

       <b>Errors</b>
           from underlying calls, in exceptional circumstances

       Definition at line <b>569</b> of file <b>libnetfilter_log.c</b>.

   <b>int</b> <b>nflog_unbind_group</b> <b>(struct</b> <b>nflog_g_handle</b> <b>*</b> <b>gh)</b>
       nflog_unbind_group - unbind a group handle.

       <b>Parameters</b>
           <u>gh</u> Netfilter log group handle obtained via <b>nflog_bind_group()</b>

       <b>Returns</b>
           0 on success, -1 on failure with <b>errno</b> set.

       <b>Errors</b>
           from underlying calls, in exceptional circumstances

       Definition at line <b>506</b> of file <b>libnetfilter_log.c</b>.

</pre><h4><b>Author</b></h4><pre>
       Generated automatically by Doxygen for libnetfilter_log from the source code.

libnetfilter_log                                  Version 1.0.2                                           <u><a href="../man3/Log.3.html">Log</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>