<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rex::Commands::Pkg - Install/Remove Software packages</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/rex">rex_1.16.0-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Rex::Commands::Pkg - Install/Remove Software packages

</pre><h4><b>DESCRIPTION</b></h4><pre>
       With this module you can install packages and files.

</pre><h4><b>SYNOPSIS</b></h4><pre>
        pkg "somepkg",
          ensure =&gt; "present";
        pkg "somepkg",
          ensure =&gt; "latest",
          on_change =&gt; sub {
            say "package was updated.";
            service someservice =&gt; "restart";
          };
        pkg "somepkg",
          ensure =&gt; "absent";

</pre><h4><b>EXPORTED</b> <b>FUNCTIONS</b></h4><pre>
   <b>pkg($package</b> <b>[,</b> <b>%options])</b>
       Since: 0.45

       Use this resource to install or update a package. This resource will generate reports.

        pkg "httpd",
          ensure    =&gt; "latest",    # ensure that the newest version is installed (auto-update)
          on_change =&gt; sub { say "package was installed/updated"; };

        pkg "httpd",
          ensure =&gt; "absent";    # remove the package

        pkg "httpd",
          ensure =&gt; "present";   # ensure that some version is installed (no auto-update)

        pkg "httpd",
          ensure =&gt; "2.4.6";    # ensure that version 2.4.6 is installed

        pkg "apache-server",    # with a custom resource name
          package =&gt; "httpd",
          ensure  =&gt; "present";

   <b>install($type,</b> <b>$data,</b> <b>$options)</b>
       The install function can install packages (for CentOS, OpenSuSE and Debian) and files.

       If you need reports, please use the <b>pkg()</b> resource.

       installing a package (This is only supported on CentOS, OpenSuSE and Debian systems.)
                task "prepare", "server01", sub {
                  install package =&gt; "perl";

                  # or if you have to install more packages.
                  install package =&gt; [
                                 "perl",
                                 "ntp",
                                 "dbus",
                                 "hal",
                                 "sudo",
                                 "vim",
                               ];
                };

       installing a file
               This is deprecated since 0.9. Please use File <u>file</u> instead.

                task "prepare", "server01", sub {
                  install file =&gt; "<a href="file:/etc/passwd">/etc/passwd</a>", {
                               source =&gt; "/export/files/etc/passwd",
                               owner  =&gt; "root",
                               group  =&gt; "root",
                               mode  =&gt; 644,
                             };
                };

       installing a file and do something if the file was changed.
                task "prepare", "server01", sub {
                  install file =&gt; "/etc/httpd/apache2.conf", {
                               source   =&gt; "/export/files/etc/httpd/apache2.conf",
                               owner    =&gt; "root",
                               group    =&gt; "root",
                               mode    =&gt; 644,
                               on_change =&gt; sub { say "File was modified!"; }
                             };
                };

       installing a file from a template.
                task "prepare", "server01", sub {
                  install file =&gt; "/etc/httpd/apache2.tpl", {
                               source   =&gt; "/export/files/etc/httpd/apache2.conf",
                               owner    =&gt; "root",
                               group    =&gt; "root",
                               mode    =&gt; 644,
                               on_change =&gt; sub { say "File was modified!"; },
                               template  =&gt; {
                                          greeting =&gt; "hello",
                                          name    =&gt; "Ben",
                                        },
                             };
                };

       This function supports the following hooks:

       before
           This gets executed before anything is done. All original parameters are passed to it.

           The return value of this hook overwrites the original parameters of the function-call.

       before_change
           This  gets  executed right before the new package is installed. All original parameters are passed to
           it.

           This hook is only available for package installations. If you need file hooks, you have  to  use  the
           <b>file()</b> function.

       after_change
           This  gets  executed right after the new package was installed. All original parameters, and the fact
           of change ("{ changed =" TRUE|FALSE }&gt;) are passed to it.

           This hook is only available for package installations. If you need file hooks, you have  to  use  the
           <b>file()</b> function.

       after
           This  gets  executed  right  before  the install() function returns. All original parameters, and any
           returned results are passed to it.

   <b>remove($type,</b> <b>$package,</b> <b>$options)</b>
       This function will remove the given package from a system.

        task "cleanup", "server01", sub {
          remove package =&gt; "vim";
        };

   <b>update_system</b>
       This function does a complete system update.

       For example <u>apt-get</u> <u>upgrade</u> or <u>yum</u> <u>update</u>.

        task "update-system", "server1", sub {
          update_system;
        };

       If you want to get the packages that where updated, you can use the <u>on_change</u> hook.

        task "update-system", "server1", sub {
          update_system
            on_change =&gt; sub {
              my (@modified_packages) = @_;
              for my $pkg (@modified_packages) {
                say "Name: $pkg-&gt;{name}";
                say "Version: $pkg-&gt;{version}";
                say "Action: $pkg-&gt;{action}";   # some of updated, installed or removed
              }
            };
        };

       Options for <u>update_system</u>

       update_metadata
           Set to <u>TRUE</u> if the package metadata should be updated. Since 1.5 default to <u>FALSE</u> if possible. Before
           1.5 it depends on the package manager.

       update_package
           Set to <u>TRUE</u> if you want to update the packages. Default is <u>TRUE</u>.

       dist_upgrade
           Set to <u>TRUE</u> if you want to run a dist-upgrade if your distribution supports it. Default is <u>FALSE</u>.

   <b>installed_packages</b>
       This function returns all installed packages and their version.

        task "get-installed", "server1", sub {

           for my $pkg (installed_packages()) {
             say "name    : " . $pkg-&gt;{"name"};
             say "  version: " . $pkg-&gt;{"version"};
           }

        };

   <b>is_installed</b>
       This function tests if $package is installed. Returns 1 if true. 0 if false.

        task "isinstalled", "server01", sub {
          if( is_installed("rex") ) {
            say "Rex is installed";
          }
          else {
            say "Rex is not installed";
          }
        };

   <b>update_package_db</b>
       This function updates the local package database. For example, on CentOS it will execute <u>yum</u> <u>makecache</u>.

        task "update-pkg-db", "server1", "server2", sub {
          update_package_db;
          install package =&gt; "apache2";
        };

   <b>repository($action,</b> <b>%data)</b>
       Add or remove a repository from the package manager.

       For Debian: If you have no source repository, or if you don't want to add  it,  just  remove  the  <u>source</u>
       parameter.

        task "add-repo", "server1", "server2", sub {
          repository "add" =&gt; "repository-name",
             url      =&gt; "<a href="http://rex.linux-files.org/debian/squeeze">http://rex.linux-files.org/debian/squeeze</a>",
             key_url  =&gt; "<a href="http://rex.linux-files.org/DPKG-GPG-KEY-REXIFY-REPO">http://rex.linux-files.org/DPKG-GPG-KEY-REXIFY-REPO</a>"
             distro    =&gt; "squeeze",
             repository =&gt; "rex",
             source    =&gt; 1;
        };

       To specify a key from a file use key_file =&gt; '/tmp/mykeyfile'.

       To use a keyserver use key_server and key_id.

       For ALT Linux: If repository is unsigned, just remove the <u>sign_key</u> parameter.

        task "add-repo", "server1", "server2", sub {
          repository "add" =&gt; "altlinux-sisyphus",
             url      =&gt; "<a href="ftp://ftp.altlinux.org/pub/distributions/ALTLinux/Sisyphus">ftp://ftp.altlinux.org/pub/distributions/ALTLinux/Sisyphus</a>",
             sign_key  =&gt; "alt",
             arch     =&gt; "noarch, x86_64",
             repository =&gt; "classic";
        };

       For CentOS, Mageia and SuSE only the name and the url are needed.

        task "add-repo", "server1", "server2", sub {
          repository add =&gt; "repository-name",
             url =&gt; '<a href="http://rex.linux-files.org/CentOS/">http://rex.linux-files.org/CentOS/</a>$releasever/rex/$basearch/';

        };

       To remove a repository just delete it with its name.

        task "rm-repo", "server1", sub {
          repository remove =&gt; "repository-name";
        };

       You can also use one call to repository to add repositories on multiple platforms:

        task "add-repo", "server1", "server2", sub {
         repository add =&gt; myrepo =&gt; {
           Ubuntu =&gt; {
             url =&gt; "<a href="http://foo.bar/repo">http://foo.bar/repo</a>",
             distro =&gt; "precise",
             repository =&gt; "foo",
           },
           Debian =&gt; {
             url =&gt; "<a href="http://foo.bar/repo">http://foo.bar/repo</a>",
             distro =&gt; "squeeze",
             repository =&gt; "foo",
           },
           CentOS =&gt; {
             url =&gt; "<a href="http://foo.bar/repo">http://foo.bar/repo</a>",
           },
         };
        };

   <b>package_provider_for</b> <b>$os</b> <b>=&gt;</b> <b>$type;</b>
       To set another package provider as the default, use this function.

        user "root";

        group "db" =&gt; "db[01..10]";
        package_provider_for SunOS =&gt; "blastwave";

        task "prepare", group =&gt; "db", sub {
           install package =&gt; "vim";
        };

       This  example  will  install  <u>vim</u>  on every db server. If the server is a Solaris (SunOS) it will use the
       <u>blastwave</u> Repositories.

perl v5.40.0                                       2025-02-06                            <u>Rex::Commands::<a href="../man3pm/Pkg.3pm.html">Pkg</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>