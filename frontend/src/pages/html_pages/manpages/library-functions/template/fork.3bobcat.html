<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FBB::Fork - Implements fork(2) using the Template Design Pattern</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libbobcat-dev">libbobcat-dev_6.07.01-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       FBB::Fork - Implements <b><a href="../man2/fork.2.html">fork</a></b>(2) using the Template Design Pattern

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;bobcat/fork&gt;</b>
       Linking option: <u>-lbobcat</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>FBB::Fork</b>  objects  may  be  used  to implement the <b><a href="../man2/fork.2.html">fork</a></b>(2) call as part of the Template Algorithm Design
       Pattern. The class was designed as a virtual base class for classes implementing the essential  parts  of
       the  forking  process.  The  class  is  a  virtual base class. Derived classes <u>must</u> implement the members
       <u>childProcess</u> and <u>parentProcess</u> as part of the `Template Method Design Pattern’ (see Gamma <u>et</u> <u>al.</u>, 1995).

       Terminating child processes send <u>SIGCHLD</u> signals to their parents. The <b>C</b>  library  offers  the  following
       <u>macros</u>  to  analyze the <u>status</u> values received by the parent process using a <b><a href="../man2/wait.2.html">wait</a></b>(2) or <b><a href="../man2/waitpid.2.html">waitpid</a></b>(2) system
       call:

       o      <b>int</b> <b>WIFEXITED(int</b> <b>status)</b>:
              This macro returns a nonzero value if  the  child  process  terminated  normally  with  `exit’  or
              `_exit’.

       o      <b>int</b> <b>WEXITSTATUS(int</b> <b>status)</b>:
              If  `WIFEXITED’  is  true  of `<u>status</u>’, this macro returns the low-order 8 bits of the exit status
              value from the child process.

       o      <b>int</b> <b>WIFSIGNALED(int</b> <b>status)</b>:
              This macro returns a nonzero value if the child process terminated because it  received  a  signal
              that was not handled.

       o      <b>int</b> <b>WTERMSIG(int</b> <b>status)</b>:
              If  `WIFSIGNALED’  is  true  of  `<u>status</u>’, this macro returns the signal number of the signal that
              terminated the child process.

       o      <b>int</b> <b>WCOREDUMP(int</b> <b>status)</b>:
              This macro returns a nonzero value if the child process terminated and produced a core dump.

       o      <b>int</b> <b>WIFSTOPPED(int</b> <b>status)</b>:
              This macro returns a nonzero value if the child process is stopped.

       o      <b>int</b> <b>WSTOPSIG(int</b> <b>status)</b>:
              If `WIFSTOPPED’ is true of `<u>status</u>’, this macro returns the  signal  number  of  the  signal  that
              caused the child process to stop.

</pre><h4><b>NAMESPACE</b></h4><pre>
       <b>FBB</b>
       All  constructors,  members,  operators  and manipulators, mentioned in this man-page, are defined in the
       namespace <b>FBB</b>.

</pre><h4><b>INHERITS</b> <b>FROM</b></h4><pre>
       -

</pre><h4><b>CONSTRUCTORS</b></h4><pre>
       Only the default constructor is available.

</pre><h4><b>DESTRUCTOR</b></h4><pre>
       o      <b>virtual</b> <b>~Fork()</b>:
              Derived classes may define their own destructor, which is  called  when  the  <u>Fork</u>  destructor  is
              activated.

</pre><h4><b>MEMBER</b> <b>FUNCTIONS</b></h4><pre>
       o      <b>void</b> <b>fork()</b>:
              Performs  the  actual  forking. It is implemented in such a way that the corresponding parent- and
              child- processes are activated from virtual members of <b>Fork</b>. If the forking  operation  fails,  an
              <u>FBB::Exception</u> exception is thrown.

</pre><h4><b>PROTECTED</b> <b>MEMBER</b> <b>FUNCTIONS</b></h4><pre>
       o      <b>int</b> <b>endChild()</b> <b>const</b>:
              This  member  may  be called by <u>parentProcess</u> to end the child process. To end the child process a
              <u>SIGTERM</u> is sent to the child process, followed by a <u>SIGKILL</u> (cf. <b><a href="../man7/signal.7.html">signal</a></b>(7)). If the child  process
              has  already  ended then the child process’s exit value is returned, otherwise the child process’s
              end is forced (by calling <u>kill</u>) and -2 is returned.  This  member  also  calls  <u>waitForChild</u>  (see
              below).

       o      <b>pid_t</b> <b>pid()</b> <b>const</b>:
              Returns  the child’s process id in the parent’s code (i.e., in the <b>parent-</b>members below), and 0 in
              the child’s code (i.e., in the <b>child-</b>members below). The <u>pid</u> member returns -1 when called  <u>before</u>
              the member <u>fork</u> has been called.

       o      <b>void</b> <b>prepareDaemon()</b> <b>const</b>:
              Prepares  for  a  daemon  childprocess.  This function may (should) be called from <u>childProcess</u> to
              ensure that the child process changes its current working directory to  the  root  (/)  directory,
              thus  freeing  up mount points; that the child process starts a new session/process group to allow
              the parent (group leader) to kill all its processes without terminating the daemon; and makes sure
              that the child process closes and reopens the standard streams by associating them with  <u>/dev/null</u>
              to  prevent  ghost  input  and  output  actions  from  interfering  with  the daemon’s actions. An
              <u>FBB::Exception</u> is thrown if changing directory to the root directory fails.

       o      <b>void</b> <b>prepareDaemon(std::string</b> <b>const</b> <b>&amp;out,</b> <b>std::string</b> <b>const</b> <b>&amp;err,</b> <b>mode_t</b> <b>mode</b> <b>=</b> <b>0600)</b> <b>const</b>:
              Prepares for a daemon childprocess like the previous member function, but  allows  redirection  of
              the  standard  output  (<u>out</u>)  and  standard error (<u>err</u>) streams to files. Specify empty strings to
              redirect these streams to <u>/dev/null</u>. With non-empty strings the  specified  files  are  opened  in
              append-mode (and created if not yet existing), by default using mode 0600 (read/write mode for the
              user  only).  An  <u>FBB::Exception</u> is thrown if changing directory to the root directory or if using
              the specified <b>s</b> fails.

       o      <b>int</b> <b>waitForChild()</b> <b>const</b>:
              This member may be called by <u>parentProcess</u> to wait for the completion of  the  child-process.  The
              return  value  (exit-code)  of  the child process is returned as a value between 0 and 255. If the
              child process terminates before the completion of the parent process, then <u>waitForChild</u> should  be
              called  to  prevent <u>zombies</u> from occurring. Alternatively, the parent process may terminate (e.g.,
              using <b><a href="../man2/exit.2.html">exit</a></b>(2)) while the child process is still alive. This is the normal way to create  a  <u>daemon</u>
              process.

</pre><h4><b>PRIVATE</b> <b>(VIRTUAL)</b> <b>MEMBER</b> <b>FUNCTIONS</b></h4><pre>
       o      <b>virtual</b> <b>void</b> <b>childProcess()</b> <b>=</b> <b>0</b>:
              This  member  <u>must</u> be implemented by derived classes. It defines the actions that are performed by
              the child process, following  the  <b><a href="../man2/fork.2.html">fork</a></b>(2)  system  call.  Just  before  <u>childProcess</u>  is  called,
              <u>childRedirections</u>  (see below) has been executed. The <u>childProcess()</u> function should terminate the
              child process. A good way to do this is to throw an exception which is caught by <u>main()</u>’s function
              try block. Terminating a process using <b><a href="../man2/exit.2.html">exit</a></b>(2) is deprecated in <b>C++</b>.

       o      <b>virtual</b> <b>void</b> <b>childRedirections()</b>:
              This function <u>may</u> be redefined in derived classes to set up the redirections that are necessary to
              communicate with the parent process. See also the classes <b><a href="../man3bobcat/redirector.3bobcat.html">redirector</a></b>(3bobcat)  and  <b><a href="../man3bobcat/pipe.3bobcat.html">pipe</a></b>(3bobcat).
              By default, <u>childRedirections</u> does nothing.

       o      <b>virtual</b> <b>void</b> <b>parentProcess()</b> <b>=</b> <b>0</b>:
              This  member  <u>must</u> be implemented by derived classes. It defines the actions that are performed by
              the parent process, following the <b><a href="../man2/fork.2.html">fork</a></b>(2)  system  call.  Just  before  <u>parentProcess</u>  is  called,
              <u>parentRedirections</u> (see below) has been executed.

              When  deriving classes from <u>Fork</u> their <u>parentProcess</u> implementation preferably handles all actions
              to perform by the parent process. If the child process remains  active  when  the  parent  process
              decides  that  the  program  has  performed  its  duties (e.g., the child process is replaced by a
              program started by an <u>exec..</u> function, continuously producing output, interpreted  by  the  parent
              process)  then  the  parent  process  can call <u>endChild</u> to end the child process before ending the
              <u>parentProcess</u> function.

       o      <b>virtual</b> <b>void</b> <b>parentRedirections()</b>:
              This function <u>may</u> be redefined in derived classes to set up the redirections that are necessary to
              communicate with, e.g., the parent. See, e.g., the classes <b><a href="../man3bobcat/redirector.3bobcat.html">redirector</a></b>(3bobcat) and  <b><a href="../man3bobcat/pipe.3bobcat.html">pipe</a></b>(3bobcat).
              By default, <u>parentRedirections</u> does nothing.

</pre><h4><b>EXAMPLES</b></h4><pre>
       #include &lt;iostream&gt;
       #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;

       #include &lt;bobcat/fork&gt;

       using namespace std;
       using namespace FBB;

       class Background: public Fork
       {
           public:
               void childProcess()     override;
               void parentProcess()    override;
       };

       void Background::childProcess()
       {
           for (int idx = 0; idx &lt; 3; ++idx)
           {
               cout &lt;&lt; "Hello world # " &lt;&lt; idx &lt;&lt; endl;
               <a href="../man1/sleep.1.html">sleep</a>(1);
           }
           throw 0;    // caught in main()
       }

       void Background::parentProcess()
       {
           cout &lt;&lt; "Waiting for the child process to end...\n"
                   "The child returns value " &lt;&lt; waitForChild() &lt;&lt; endl;
       }

       int main()
       try
       {
           Background bg;

           bg.fork();
           cout &lt;&lt; "This is from the parent\n";
       }
       catch(int x)
       {
           cout &lt;&lt; "The child terminates with: " &lt;&lt; x &lt;&lt; endl;
           return x;
       }

       Here’s a more extensive example:

       #include &lt;iostream&gt;
       #include &lt;string&gt;

       #include &lt;<a href="file:/usr/include/signal.h">signal.h</a>&gt;
       #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;

       #include &lt;sys/types.h&gt;

       #include &lt;bobcat/pipe&gt;
       #include &lt;bobcat/ofdstream&gt;
       #include &lt;bobcat/ifdstream&gt;
       #include &lt;bobcat/process&gt;
       #include &lt;bobcat/fork&gt;

       class ChildIO: public FBB::Fork
       {
           FBB::Pipe childInput;   // child reads this
           FBB::Pipe childOutput;   // child writes this

           public:
               void childRedirections()    override;
               void childProcess()         override;
               void parentProcess()        override;
       };

       using namespace std;
       using namespace FBB;

       void ChildIO::childRedirections()
       {
           childInput.readFrom(Redirector::STDIN);
           childOutput.writtenBy(Redirector::STDOUT);
       }

       void ChildIO::childProcess()
       {
               // The <a href="file:/bin/cat">/bin/cat</a> program replaces the
               // child process started by Fork::fork()
           Process process(Process::DIRECT, "<a href="file:/bin/cat">/bin/cat</a>");
           process.start();

           // this point is never reached
       }

       void ChildIO::parentProcess()
       {
               // Set up the parent’s sides of the pipes
           IFdStream fromChild(childOutput.readOnly());
           OFdStream toChild(childInput.writeOnly());

               // write lines to the child, read its output
           string line;
           while (true)
           {
               cout &lt;&lt; "? ";
               line.clear();
               getline(cin, line);

               if (line.empty())
               {
                   kill(pid(), SIGTERM);
                   break;
               }

               toChild &lt;&lt; line &lt;&lt; endl;

               getline(fromChild, line);
               cout &lt;&lt; "Got: " &lt;&lt; line &lt;&lt; endl;
           }
           cout &lt;&lt; "The child returns value " &lt;&lt; waitForChild() &lt;&lt; endl;
       }

       int main()
       try
       {
           ChildIO io;

           io.fork();

           return 0;
       }
       catch(exception const &amp;exc)
       {
           cerr &lt;&lt; "Exception: " &lt;&lt; exc.what() &lt;&lt; endl;
       }
       catch(int x)
       {
           cout &lt;&lt; "The child terminates with: " &lt;&lt; x &lt;&lt; endl;
           return x;
       }

</pre><h4><b>FILES</b></h4><pre>
       <u>bobcat/fork</u> - defines the class interface

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/bobcat.7.html">bobcat</a></b>(7),  <b><a href="../man3bobcat/cerrextractor.3bobcat.html">cerrextractor</a></b>(3bobcat), <b><a href="../man3bobcat/cininserter.3bobcat.html">cininserter</a></b>(3bobcat), <b><a href="../man3bobcat/coutextractor.3bobcat.html">coutextractor</a></b>(3bobcat), <b><a href="../man3/exec.3.html">exec</a></b>(3), <b><a href="../man3bobcat/exec.3bobcat.html">exec</a></b>(3bobcat),
       <b><a href="../man2/fork.2.html">fork</a></b>(2), <b><a href="../man2/kill.2.html">kill</a></b>(2), <b><a href="../man3bobcat/pipe.3bobcat.html">pipe</a></b>(3bobcat), <b><a href="../man3bobcat/redirector.3bobcat.html">redirector</a></b>(3bobcat), <b><a href="../man3bobcat/stdextractor.3bobcat.html">stdextractor</a></b>(3bobcat), <b><a href="../man2/wait.2.html">wait</a></b>(2), <b><a href="../man2/waitpid.2.html">waitpid</a></b>(2).

</pre><h4><b>BUGS</b></h4><pre>
       None Reported.

</pre><h4><b>BOBCAT</b> <b>PROJECT</b> <b>FILES</b></h4><pre>
       o      <u>https://fbb-git.gitlab.io/bobcat/</u>: gitlab project page;

       Debian Bobcat project files:

       o      <u>libbobcat6</u>: debian package containing the shared library, changelog and copyright note;

       o      <u>libbobcat-dev</u>: debian package containing the static library, headers, manual pages, and  developer
              info;

</pre><h4><b>BOBCAT</b></h4><pre>
       Bobcat is an acronym of `Brokken’s Own Base Classes And Templates’.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       This is free software, distributed under the terms of the GNU General Public License (GPL).

</pre><h4><b>AUTHOR</b></h4><pre>
       Frank B. Brokken (<b><a href="mailto:f.b.brokken@rug.nl">f.b.brokken@rug.nl</a></b>).

libbobcat-dev_6.07.01                               2005-2025                                 <u>FBB::<a href="../man3bobcat/Fork.3bobcat.html">Fork</a></u>(3bobcat)
</pre>
 </div>
</div></section>
</div>
</body>
</html>