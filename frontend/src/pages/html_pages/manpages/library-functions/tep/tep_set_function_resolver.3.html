<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tep_set_function_resolver, tep_reset_function_resolver, tep_register_function, tep_register_print_string,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtraceevent-doc">libtraceevent-doc_1.8.4-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tep_set_function_resolver, tep_reset_function_resolver, tep_register_function, tep_register_print_string,
       tep_get_function_count - function related tep APIs

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;event-parse.h&gt;</b>

       typedef char *(<b>tep_func_resolver_t</b>)(void *<u>priv</u>, unsigned long long *<u>addrp</u>, char **<u>modp</u>);
       int <b>tep_set_function_resolver</b>(struct tep_handle *<u>tep</u>, tep_func_resolver_t *<u>func</u>, void *<u>priv</u>);
       void <b>tep_reset_function_resolver</b>(struct tep_handle *<u>tep</u>);
       int <b>tep_register_function</b>(struct tep_handle *<u>tep</u>, char *<u>name</u>, unsigned long long <u>addr</u>, char *<u>mod</u>);
       int <b>tep_register_print_string</b>(struct tep_handle *<u>tep</u>, const char *<u>fmt</u>, unsigned long long <u>addr</u>);
       int <b>tep_get_function_count</b>(struct tep_handle *<u>tep</u>)

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Some tools may have already a way to resolve the kernel functions. These APIs allow them to keep using it
       instead of duplicating all the entries inside.

       The <u>tep_func_resolver_t</u> type is the prototype of the alternative kernel functions resolver. This function
       receives a pointer to its custom context (set with the <b>tep_set_function_resolver()</b> call ) and the address
       of a kernel function, which has to be resolved. In case of success, it should return the name of the
       function and its module (if any) in <u>modp</u>.

       The <b>tep_set_function_resolver()</b> function registers <u>func</u> as an alternative kernel functions resolver. The
       <u>tep</u> argument is trace event parser context. The <u>priv</u> argument is a custom context of the <u>func</u> function.
       The function resolver is used by the APIs <b><a href="../man3/tep_find_function.3.html">tep_find_function</a></b>(3), <b><a href="../man3/tep_find_function_address.3.html">tep_find_function_address</a></b>(3), and
       <b>tep_print_func_field()</b> to resolve a function address to a function name.

       The <b>tep_reset_function_resolver()</b> function resets the kernel functions resolver to the default function.
       The <u>tep</u> argument is trace event parser context.

       These APIs can be used to find function name and start address, by given address. The given address does
       not have to be exact, it will select the function that would contain it.

       The <b>tep_register_function()</b> function registers a function name mapped to an address and (optional)
       module. This mapping is used in case the function tracer or events have "%pS" parameter in its format
       string. It is common to pass in the kallsyms function names with their corresponding addresses with this
       function. The <u>tep</u> argument is the trace event parser context. The <u>name</u> is the name of the function, the
       string is copied internally. The <u>addr</u> is the start address of the function. The <u>mod</u> is the kernel module
       the function may be in (NULL for none).

       The <b>tep_register_print_string()</b> function registers a string by the address it was stored in the kernel.
       Some strings internal to the kernel with static address are passed to certain events. The "%s" in the
       eventâ€™s format field which has an address needs to know what string would be at that address. The
       tep_register_print_string() supplies the parsing with the mapping between kernel addresses and those
       strings. The <u>tep</u> argument is the trace event parser context. The <u>fmt</u> is the string to register, it is
       copied internally. The <u>addr</u> is the address the string was located at.

       <b>tep_get_function_count</b>() returns the number of registered functions in a tep handler.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       The <b>tep_set_function_resolver()</b> function returns 0 in case of success, or -1 in case of an error.

       The <b>tep_register_function()</b> function returns 0 in case of success. In case of an error -1 is returned,
       and errno is set to the appropriate error number.

       The <b>tep_register_print_string()</b> function returns 0 in case of success. In case of an error -1 is
       returned, and errno is set to the appropriate error number.

</pre><h4><b>EXAMPLE</b></h4><pre>
           #include &lt;event-parse.h&gt;
           ...
           struct tep_handle *tep = tep_alloc();
           ...
           char *my_resolve_kernel_addr(void *context,
                                        unsigned long long *addrp, char **modp)
           {
                   struct db *function_database = context;
                   struct symbol *sym = sql_lookup(function_database, *addrp);

                   if (!sym)
                           return NULL;

                   *modp = sym-&gt;module_name;
                   return sym-&gt;name;
           }

           void show_function( unsigned long long addr)
           {
                   unsigned long long fstart;
                   const char *fname;

                   if (tep_set_function_resolver(tep, my_resolve_kernel_addr,
                                                 function_database) != 0) {
                           /* failed to register my_resolve_kernel_addr */
                   }

                   /* These APIs use my_resolve_kernel_addr() to resolve the addr */
                   fname = tep_find_function(tep, addr);
                   fstart = tep_find_function_address(tep, addr);

                   /*
                      addr is in function named fname, starting at fstart address,
                      at offset (addr - fstart)
                   */

                   tep_reset_function_resolver(tep);

           }
           ...
                   if (tep_register_function(tep, "kvm_exit",
                                           (unsigned long long) 0x12345678, "kvm") != 0) {
                           /* Failed to register kvm_exit address mapping */
                   }
           ...
                   if (tep_register_print_string(tep, "print string",
                                           (unsigned long long) 0x87654321, NULL) != 0) {
                           /* Failed to register "print string" address mapping */
                   }
           ...

</pre><h4><b>FILES</b></h4><pre>
           <b>event-parse.h</b>
                   Header file to include in order to have access to the library APIs.
           <b>-ltraceevent</b>
                   Linker switch to add when building a program that uses the library.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/libtraceevent.3.html">libtraceevent</a></b>(3), <b><a href="../man1/trace-cmd.1.html">trace-cmd</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
           <b>Steven</b> <b>Rostedt</b> &lt;<b><a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a></b>[1]&gt;, author of <b>libtraceevent</b>.
           <b>Tzvetomir</b> <b>Stoyanov</b> &lt;<b><a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a></b>[2]&gt;, author of this man page.

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;<b><a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a></b>[3]&gt;

</pre><h4><b>LICENSE</b></h4><pre>
       libtraceevent is Free Software licensed under the GNU LGPL 2.1

</pre><h4><b>RESOURCES</b></h4><pre>
       <b>https://git.kernel.org/pub/scm/libs/libtrace/libtraceevent.git/</b>

</pre><h4><b>NOTES</b></h4><pre>
        1. <a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a>
           <a href="mailto:rostedt@goodmis.org">mailto:rostedt@goodmis.org</a>

        2. <a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a>
           <a href="mailto:tz.stoyanov@gmail.com">mailto:tz.stoyanov@gmail.com</a>

        3. <a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a>
           <a href="mailto:linux-trace-devel@vger.kernel.org">mailto:linux-trace-devel@vger.kernel.org</a>

libtraceevent 1.8.4                                12/24/2024                                   <u><a href="../man3/LIBTRACEEVENT.3.html">LIBTRACEEVENT</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>