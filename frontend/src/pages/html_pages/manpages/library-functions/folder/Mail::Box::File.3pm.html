<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mail::Box::File - handle file-based folders</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmail-box-perl">libmail-box-perl_3.011-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Mail::Box::File - handle file-based folders

</pre><h4><b>INHERITANCE</b></h4><pre>
        Mail::Box::File
          is a Mail::Box
          is a Mail::Reporter

        Mail::Box::File is extended by
          Mail::Box::Dbx
          Mail::Box::Mbox

</pre><h4><b>SYNOPSIS</b></h4><pre>
</pre><h4><b>DESCRIPTION</b></h4><pre>
       "Mail::Box::File" is the base-class for all file-based folders: folders which bundle multiple messages
       into one single file.  Usually, these messages are separated by a special line which indicates the start
       of the next one.

       Extends "DESCRIPTION" in Mail::Box.

</pre><h4><b>OVERLOADED</b></h4><pre>
       Extends "OVERLOADED" in Mail::Box.

       overload: <b>""</b>
           Inherited, see "OVERLOADED" in Mail::Box

       overload: <b>@{}</b>
           Inherited, see "OVERLOADED" in Mail::Box

       overload: <b>cmp</b>
           Inherited, see "OVERLOADED" in Mail::Box

</pre><h4><b>METHODS</b></h4><pre>
       Extends "METHODS" in Mail::Box.

   <b>Constructors</b>
       Extends "Constructors" in Mail::Box.

       Mail::Box::File-&gt;<b>new</b>(%options)
            -Option           --Defined in     --Default
             access             Mail::Box        'r'
             body_delayed_type  Mail::Box        Mail::Message::Body::Delayed
             body_type                           &lt;see description&gt;
             coerce_options     Mail::Box        []
             create             Mail::Box        &lt;false&gt;
             extract            Mail::Box        10240
             field_type         Mail::Box        undef
             fix_headers        Mail::Box        &lt;false&gt;
             folder             Mail::Box        $ENV{MAIL}
             folderdir          Mail::Box        $ENV{HOME}.'/Mail'
             head_delayed_type  Mail::Box        Mail::Message::Head::Delayed
             head_type          Mail::Box        Mail::Message::Head::Complete
             keep_dups          Mail::Box        &lt;false&gt;
             lock_extension                      '.lock'
             lock_file          Mail::Box        &lt;foldername&gt;&lt;lock-extension&gt;
             lock_timeout       Mail::Box        1 hour
             lock_type          Mail::Box        Mail::Box::Locker::DotLock
             lock_wait          Mail::Box        10 seconds
             locker             Mail::Box        undef
             log                Mail::Reporter   'WARNINGS'
             manager            Mail::Box        undef
             message_type       Mail::Box        Mail::Box::File::Message
             multipart_type     Mail::Box        Mail::Message::Body::Multipart
             remove_when_empty  Mail::Box        &lt;true&gt;
             save_on_exit       Mail::Box        &lt;true&gt;
             trace              Mail::Reporter   'WARNINGS'
             trusted            Mail::Box        &lt;depends on folder location&gt;
             write_policy                        undef

           access =&gt; MODE
           body_delayed_type =&gt; CLASS
           body_type =&gt; CLASS|CODE
             The default "body_type" option for "File" folders, which will cause messages larger than 10kB to be
             stored in files and smaller files in memory, is implemented like this:

              sub determine_body_type($$)
              {   my $head = shift;
                  my $size = shift || 0;
                  'Mail::Message::Body::'
                     . ($size &gt; 10000 ? 'File' : 'Lines');
              }

           coerce_options =&gt; ARRAY
           create =&gt; BOOLEAN
           extract =&gt; INTEGER | CODE | METHOD | 'LAZY'|'ALWAYS'
           field_type =&gt; CLASS
           fix_headers =&gt; BOOLEAN
           folder =&gt; FOLDERNAME
           folderdir =&gt; DIRECTORY
           head_delayed_type =&gt; CLASS
           head_type =&gt; CLASS
           keep_dups =&gt; BOOLEAN
           lock_extension =&gt; FILENAME|STRING
             When the dotlock locking mechanism is used, the lock is created with a hardlink to the folder file.
             For  "Mail::Box::File"  type  of  folders,  this file is by default named as the folder-file itself
             followed by ".lock".  For example: the "Mail/inbox" folder  file  will  have  a  hardlink  made  as
             "Mail/inbox.lock".

             You  may  specify  an  absolute  filename,  a  relative (to the folder's directory) filename, or an
             extension (preceded by a dot).  So valid examples are:

              .lock        # appended to the folder's filename
              my_own_lockfile.test   # full filename, same dir
              <a href="file:/etc/passwd">/etc/passwd</a>            # somewhere else

             When the program runs with less privileges (as normal user), often the default inbox folder can not
             be locked with the lockfile name which is produced by default.

           lock_file =&gt; FILENAME
           lock_timeout =&gt; SECONDS
           lock_type =&gt; CLASS|STRING|ARRAY
           lock_wait =&gt; SECONDS
           locker =&gt; OBJECT
           log =&gt; LEVEL
           manager =&gt; MANAGER
           message_type =&gt; CLASS
           multipart_type =&gt; CLASS
           remove_when_empty =&gt; BOOLEAN
           save_on_exit =&gt; BOOLEAN
           trace =&gt; LEVEL
           trusted =&gt; BOOLEAN
           write_policy =&gt; 'REPLACE'|'INPLACE'|undef
             Sets the default write policy, as default for a later call to  write(policy).   With  "undef",  the
             best policy is autodetected.

   <b>The</b> <b>folder</b>
       Extends "The folder" in Mail::Box.

       $obj-&gt;<b>addMessage</b>($message, %options)
           Inherited, see "The folder" in Mail::Box

       $obj-&gt;<b>addMessages</b>(@messages)
           Inherited, see "The folder" in Mail::Box

       Mail::Box::File-&gt;<b>appendMessages</b>(%options)
           Appending  messages  to a file based folder which is not opened is a little risky.  In practice, this
           is often done without locking the folder.  So, another application may write to  the  folder  at  the
           same time... :( Hopefully, all goes fast enough that the chance on collision is small.

           All %options of <b>Mail::Box::Mbox::new()</b> can be supplied.

            -Option   --Defined in     --Default
             folder     Mail::Box        &lt;required&gt;
             lock_type                   NONE
             message    Mail::Box        undef
             messages   Mail::Box        undef
             share      Mail::Box        &lt;false&gt;

           folder =&gt; FOLDERNAME
           lock_type =&gt; ...
             See Mail::Box::new(lock_type) for possible values.

           message =&gt; MESSAGE
           messages =&gt; ARRAY-OF-MESSAGES
           share =&gt; BOOLEAN
       $obj-&gt;<b>close</b>(%options)
           Inherited, see "The folder" in Mail::Box

       $obj-&gt;<b>copyTo</b>($folder, %options)
           Inherited, see "The folder" in Mail::Box

       $obj-&gt;<b>delete</b>(%options)
           Inherited, see "The folder" in Mail::Box

       $obj-&gt;<b>filename</b>()
           Returns the filename for this folder, which may be an absolute or relative path to the file.

           example:

            print $folder-&gt;filename;

       $obj-&gt;<b>folderdir</b>( [$directory] )
           Inherited, see "The folder" in Mail::Box

       $obj-&gt;<b>name</b>()
           Inherited, see "The folder" in Mail::Box

       $obj-&gt;<b>organization</b>()
           Inherited, see "The folder" in Mail::Box

       $obj-&gt;<b>size</b>()
           Inherited, see "The folder" in Mail::Box

       $obj-&gt;<b>type</b>()
           Inherited, see "The folder" in Mail::Box

       $obj-&gt;<b>update</b>(%options)
           Inherited, see "The folder" in Mail::Box

       $obj-&gt;<b>url</b>()
           Inherited, see "The folder" in Mail::Box

   <b>Folder</b> <b>flags</b>
       Extends "Folder flags" in Mail::Box.

       $obj-&gt;<b>access</b>()
           Inherited, see "Folder flags" in Mail::Box

       $obj-&gt;<b>isModified</b>()
           Inherited, see "Folder flags" in Mail::Box

       $obj-&gt;<b>modified</b>( [BOOLEAN] )
           Inherited, see "Folder flags" in Mail::Box

       $obj-&gt;<b>writable</b>()
           Inherited, see "Folder flags" in Mail::Box

   <b>The</b> <b>messages</b>
       Extends "The messages" in Mail::Box.

       $obj-&gt;<b>current</b>( [$number|$message|$message_id] )
           Inherited, see "The messages" in Mail::Box

       $obj-&gt;<b>find</b>($message_id)
           Inherited, see "The messages" in Mail::Box

       $obj-&gt;<b>findFirstLabeled</b>( $label, [BOOLEAN, [$msgs]] )
           Inherited, see "The messages" in Mail::Box

       $obj-&gt;<b>message</b>( $index, [$message] )
           Inherited, see "The messages" in Mail::Box

       $obj-&gt;<b>messageId</b>( $message_id, [$message] )
           Inherited, see "The messages" in Mail::Box

       $obj-&gt;<b>messageIds</b>()
           Inherited, see "The messages" in Mail::Box

       $obj-&gt;<b>messages</b>( &lt;'ALL'|$range|'ACTIVE'|'DELETED'|$label| !$label|$filter&gt; )
           Inherited, see "The messages" in Mail::Box

       $obj-&gt;<b>nrMessages</b>(%options)
           Inherited, see "The messages" in Mail::Box

       $obj-&gt;<b>scanForMessages</b>($message, $message_ids, $timespan, $window)
           Inherited, see "The messages" in Mail::Box

   <b>Sub-folders</b>
       Extends "Sub-folders" in Mail::Box.

       $obj-&gt;<b>listSubFolders</b>(%options)
       Mail::Box::File-&gt;<b>listSubFolders</b>(%options)
           Inherited, see "Sub-folders" in Mail::Box

       $obj-&gt;<b>nameOfSubFolder</b>( $subname, [$parentname] )
       Mail::Box::File-&gt;<b>nameOfSubFolder</b>( $subname, [$parentname] )
           Inherited, see "Sub-folders" in Mail::Box

       $obj-&gt;<b>openRelatedFolder</b>(%options)
           Inherited, see "Sub-folders" in Mail::Box

       $obj-&gt;<b>openSubFolder</b>($subname, %options)
           Inherited, see "Sub-folders" in Mail::Box

       $obj-&gt;<b>topFolderWithMessages</b>()
       Mail::Box::File-&gt;<b>topFolderWithMessages</b>()
           Inherited, see "Sub-folders" in Mail::Box

   <b>Internals</b>
       Extends "Internals" in Mail::Box.

       $obj-&gt;<b>coerce</b>($message, %options)
           Inherited, see "Internals" in Mail::Box

       $obj-&gt;<b>create</b>($foldername, %options)
       Mail::Box::File-&gt;<b>create</b>($foldername, %options)
            -Option   --Defined in--Default
             folderdir  Mail::Box   undef

           folderdir =&gt; DIRECTORY
       $obj-&gt;<b>determineBodyType</b>($message, $head)
           Inherited, see "Internals" in Mail::Box

       $obj-&gt;<b>folderToFilename</b>( $foldername, $folderdir, [$subext] )
       Mail::Box::File-&gt;<b>folderToFilename</b>( $foldername, $folderdir, [$subext] )
           Translate  a  folder  name  into  a  filename,  using  the $folderdir value to replace a leading "=".
           $subext is only used for MBOX folders.

       Mail::Box::File-&gt;<b>foundIn</b>( [$foldername], %options )
           Inherited, see "Internals" in Mail::Box

       $obj-&gt;<b>lineSeparator</b>( [&lt;STRING|'CR'|'LF'|'CRLF'&gt;] )
           Inherited, see "Internals" in Mail::Box

       $obj-&gt;<b>locker</b>()
           Inherited, see "Internals" in Mail::Box

       $obj-&gt;<b>messageCreateOptions</b>( [$type, $config] )
           Returns a key-value list of options to be used each time a new message is read from a file.  The list
           is preceded by the $type of message which has to be created.

           This  data  is  used  by  <b>readMessages()</b>  and  <b>updateMessages()</b>.   With  $type  and  $config,  a  new
           configuration is set.

       $obj-&gt;<b>moveAwaySubFolder</b>($directory, $extension)
           The  $directory  is  renamed by appending the $extension, which defaults to ".d", to make place for a
           folder file on that specific location.  "false" is returned if this failed.

       $obj-&gt;<b>parser</b>()
           Create a parser for this mailbox.  The parser stays alive as long as the folder is open.

       $obj-&gt;<b>read</b>(%options)
           Inherited, see "Internals" in Mail::Box

       $obj-&gt;<b>readMessages</b>(%options)
           Inherited, see "Internals" in Mail::Box

       $obj-&gt;<b>storeMessage</b>($message)
           Inherited, see "Internals" in Mail::Box

       $obj-&gt;<b>toBeThreaded</b>($messages)
           Inherited, see "Internals" in Mail::Box

       $obj-&gt;<b>toBeUnthreaded</b>($messages)
           Inherited, see "Internals" in Mail::Box

       $obj-&gt;<b>updateMessages</b>(%options)
           For file based folders, the file handle stays open until the folder is closed.  Update  is  therefore
           rather simple: move to the end of the last known message, and continue reading...

       $obj-&gt;<b>write</b>(%options)
            -Option      --Defined in     --Default
             force         Mail::Box        &lt;false&gt;
             policy                         undef
             save_deleted  Mail::Box        &lt;false&gt;

           force =&gt; BOOLEAN
           policy =&gt; 'REPLACE'|'INPLACE'|undef
             In  what  way will the mail folder be updated.  If not specified during the write, the value of the
             new(write_policy) at folder creation is taken.

             Valid values:

             •   "REPLACE"

                 First a new folder is written in the same directory as the folder which has to be updated,  and
                 then a call to move will throw away the old immediately replacing it by the new.

                 Writing  in  "REPLACE" module is slightly optimized: messages which are not modified are copied
                 from file to file, byte by byte.  This is much faster than printing the data which is  will  be
                 done for modified messages.

             •   "INPLACE"

                 The  original  folder file will be opened read/write.  All message which where not changed will
                 be left untouched, until the first deleted  or  modified  message  is  detected.   All  further
                 messages are printed again.

             •   "undef"

                 As  default, or when "undef" is explicitly specified, first "REPLACE" mode is tried.  Only when
                 that fails, an "INPLACE" update is performed.

             "INPLACE" will be much faster than "REPLACE" when applied on large folders,  however  requires  the
             "truncate"  function  to  be  implemented  on  your operating system (at least available for recent
             versions of Linux, Solaris, Tru64, HPUX).  It is also dangerous: when the  program  is  interrupted
             during the update process, the folder is corrupted.  Data may be lost.

             However,  in  some  cases it is not possible to write the folder with "REPLACE".  For instance, the
             usual incoming mail folder on UNIX is stored in a directory where a user can not write.  Of course,
             the "root" and "mail" users can, but if you want to use this  Perl  module  with  permission  of  a
             normal  user,  you  can  only get it to work in "INPLACE" mode.  Be warned that in this case folder
             locking via a lockfile is not possible as well.

           save_deleted =&gt; BOOLEAN
       $obj-&gt;<b>writeMessages</b>(%options)
           Inherited, see "Internals" in Mail::Box

   <b>Other</b> <b>methods</b>
       Extends "Other methods" in Mail::Box.

       $obj-&gt;<b>timespan2seconds</b>($time)
       Mail::Box::File-&gt;<b>timespan2seconds</b>($time)
           Inherited, see "Other methods" in Mail::Box

   <b>Error</b> <b>handling</b>
       Extends "Error handling" in Mail::Box.

       $obj-&gt;<b>AUTOLOAD</b>()
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>addReport</b>($object)
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>defaultTrace</b>( [$level]|[$loglevel, $tracelevel]|[$level, $callback] )
       Mail::Box::File-&gt;<b>defaultTrace</b>( [$level]|[$loglevel, $tracelevel]|[$level, $callback] )
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>errors</b>()
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>log</b>( [$level, [$strings]] )
       Mail::Box::File-&gt;<b>log</b>( [$level, [$strings]] )
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>logPriority</b>($level)
       Mail::Box::File-&gt;<b>logPriority</b>($level)
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>logSettings</b>()
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>notImplemented</b>()
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>report</b>( [$level] )
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>reportAll</b>( [$level] )
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>trace</b>( [$level] )
           Inherited, see "Error handling" in Mail::Reporter

       $obj-&gt;<b>warnings</b>()
           Inherited, see "Error handling" in Mail::Reporter

   <b>Cleanup</b>
       Extends "Cleanup" in Mail::Box.

       $obj-&gt;<b>DESTROY</b>()
           Inherited, see "Cleanup" in Mail::Box

   <b>DETAILS</b>
       <u>File</u> <u>based</u> <u>folders</u>

       File based folders maintain a folder (a set of messages) in one single file.  The advantage is that  your
       folder has only one single name, which speeds-up access to all messages at once.

       The  disadvantage  over  directory  based  folder (see Mail::Box::Dir) is that you have to construct some
       means to keep all message apart, for instance  by  adding  a  message  separator,  and  this  will  cause
       problems.   Where  access  to  all  messages  at once is faster in file based folders, access to a single
       message is (much) slower, because the whole folder must be read.

</pre><h4><b>DETAILS</b></h4><pre>
       Extends "DETAILS" in Mail::Box.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       Error: Cannot append messages to folder file $filename: $!
           Appending messages to a not-opened file-organized folder may fail when the operating system does  not
           allow write access to the file at hand.

       Error: Cannot create directory $dir for folder $name.
           While  creating  a  file-organized  folder,  at  most  one  level of directories is created above it.
           Apparently, more levels of directories are needed, or the operating system  does  not  allow  you  to
           create the directory.

       Error: Cannot create folder file $name: $!
           The  file-organized  folder  file  cannot  be created for the indicated reason.  In common cases, the
           operating system does not grant you write access to the directory where the  folder  file  should  be
           stored.

       Error: Cannot get a lock on $type folder $self.
           A lock is required to get access to the folder.  If no locking is needed, specify the NONE lock type.

       Error: Cannot move away sub-folder $dir
       Warning: Cannot remove folder $name file $filename: $!
           Writing  an  empty folder will usually cause that folder to be removed, which fails for the indicated
           reason.  new(remove_when_empty)

       Warning: Cannot remove folder $name file $filename: $!
           Writing an empty folder will usually cause that folder to be removed, which fails for  the  indicated
           reason.   new(remove_when_empty)  controls whether the empty folder will removed; setting it to false
           (0) may be needed to avoid this message.

       Error: Cannot replace $filename by $tempname, to update folder $name: $!
           The replace policy wrote a new folder file to update the existing, but was unable to give  the  final
           touch: replacing the old version of the folder file for the indicated reason.

       Warning: Changes not written to read-only folder $self.
           You have opened the folder read-only --which is the default set by new(access)--, made modifications,
           and  now  want  to  close it.  Set close(force) if you want to overrule the access mode, or close the
           folder with close(write) set to "NEVER".

       Error: Copying failed for one message.
           For some reason, for instance disc full, removed by  external  process,  or  read-protection,  it  is
           impossible to copy one of the messages.  Copying will proceed for the other messages.

       Error: Destination folder $name is not writable.
           The  folder where the messages are copied to is not opened with write access (see new(access)).  This
           has no relation with write permission to the folder which is controlled by your operating system.

       Warning: Different messages with id $msgid
           The message id is discovered more than once within the same folder, but the content  of  the  message
           seems to be different.  This should not be possible: each message must be unique.

       Error: File too short to get write message $nr ($size, $need)
           Mail::Box  is  lazy:  it tries to leave messages in the folders until they are used, which saves time
           and memory usage.  When this message appears, something is terribly  wrong:  some  lazy  message  are
           needed for updating the folder, but they cannot be retrieved from the original file anymore.  In this
           case, messages can be lost.

           This  message does appear regularly on Windows systems when using the 'replace' write policy.  Please
           help to find the  cause,  probably  something  to  do  with  Windows  incorrectly  handling  multiple
           filehandles open in the same file.

       Warning: Folder $name file $filename is write-protected.
           The  folder  is  opened  writable or for appending via new(access), but the operating system does not
           permit writing to the file.  The folder will be opened read-only.

       Error: Folder $name not deleted: not writable.
           The folder must be opened with write access via new(access), otherwise removing it will  be  refused.
           So, you may have write-access according to the operating system, but that will not automatically mean
           that this "delete" method permits you to.  The reverse remark is valid as well.

       Error: Invalid timespan '$timespan' specified.
           The string does not follow the strict rules of the time span syntax which is permitted as parameter.

       Warning: Message-id '$msgid' does not contain a domain.
           According  to  the  RFCs,  message-ids  need to contain a unique random part, then an "@", and then a
           domain name.  This is made to avoid the creation of two messages  with  the  same  id.   The  warning
           emerges when the "@" is missing from the string.

       Error: Package $package does not implement $method.
           Fatal  error:  the specific package (or one of its superclasses) does not implement this method where
           it should. This message means that some other related classes do implement this  method  however  the
           class  at  hand does not.  Probably you should investigate this and probably inform the author of the
           package.

       Error: Unable to create subfolder $name of $folder.
           The copy includes the subfolders, but for some reason it was not  possible  to  copy  one  of  these.
           Copying will proceed for all other sub-folders.

       Error: Unable to update folder $self.
           When a folder is to be written, both replace and inplace write policies are tried,  If both fail, the
           whole update fails.  You may see other, related, error messages to indicate the real problem.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       This  module  is  part  of  Mail-Box  distribution  version  3.011,  built  on  April  18, 2025. Website:
       <u><a href="http://perl.overmeer.net/CPAN/">http://perl.overmeer.net/CPAN/</a></u>

</pre><h4><b>LICENSE</b></h4><pre>
       Copyrights 2001-2025 by [Mark Overmeer]. For other contributors see ChangeLog.

       This program is free software; you can redistribute it and/or modify it under  the  same  terms  as  Perl
       itself.  See <u><a href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a></u>

perl v5.40.1                                       2025-04-25                               <u>Mail::Box::<a href="../man3pm/File.3pm.html">File</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>