<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>archive_entry_linkresolver,    archive_entry_linkresolver_new,   archive_entry_linkresolver_set_strategy,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libarchive-dev">libarchive-dev_3.7.7-0ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       archive_entry_linkresolver,    archive_entry_linkresolver_new,   archive_entry_linkresolver_set_strategy,
       archive_entry_linkresolver_free, archive_entry_linkify â€” hardlink resolver functions

</pre><h4><b>LIBRARY</b></h4><pre>
       Streaming Archive Library (libarchive, -larchive)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;archive_entry.h&gt;</b>

       <u>struct</u> <u>archive_entry_linkresolver</u> <u>*</u>
       <b>archive_entry_linkresolver_new</b>(<u>void</u>);

       <u>void</u>
       <b>archive_entry_linkresolver_set_strategy</b>(<u>struct</u> <u>archive_entry_linkresolver</u> <u>*resolver</u>, <u>int</u> <u>format</u>);

       <u>void</u>
       <b>archive_entry_linkresolver_free</b>(<u>struct</u> <u>archive_entry_linkresolver</u> <u>*resolver</u>);

       <u>void</u>
       <b>archive_entry_linkify</b>(<u>struct</u> <u>archive_entry_linkresolver</u> <u>*resolver</u>,          <u>struct</u> <u>archive_entry</u> <u>**entry</u>,
           <u>struct</u> <u>archive_entry</u> <u>**sparse</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Programs  that  want  to create archives have to deal with hardlinks.  Hardlinks are handled in different
       ways by the archive formats.  The basic strategies are:

       1.   Ignore hardlinks and store the body for each reference (old cpio, zip).

       2.   Store the body the first time an inode is seen (ustar, pax).

       3.   Store the body the last time an inode is seen (new cpio).

       The <b>archive_entry_linkresolver</b>  functions  help  by  providing  a  unified  interface  and  handling  the
       complexity behind the scene.

       The <b>archive_entry_linkresolver</b> functions assume that <u>archive_entry</u> instances have valid nlinks, inode and
       device  values.   The  inode  and  device  value  is  used to match entries.  The nlinks value is used to
       determined if all references have been found and if the internal references can be recycled.

       The <b>archive_entry_linkresolver_new</b>() function allocates a new link resolver.  The instance can  be  freed
       using  <b>archive_entry_linkresolver_free</b>().   All  deferred entries are flushed and the internal storage is
       freed.

       The <b>archive_entry_linkresolver_set_strategy</b>() function selects the  optimal  hardlink  strategy  for  the
       given  format.   The format code can be obtained from <u><a href="../man3/archive_format.3.html">archive_format</a></u>(3).  The function can be called more
       than once, but it is recommended to flush all deferred entries first.

       The <b>archive_entry_linkify</b>() function is the core of  <b>archive_entry_linkresolver</b>.   The  <b>entry</b>()  argument
       points  to  the  <u>archive_entry</u>  that  should  be written.  Depending on the strategy one of the following
       actions is taken:

       1.   For the simple archive formats <u>*entry</u> is left unmodified and <u>*sparse</u> is set to NULL.

       2.   For tar like archive formats, <u>*sparse</u> is set to NULL.  If <u>*entry</u> is NULL, no action  is  taken.   If
            the  hardlink count of <u>*entry</u> is larger than 1 and the file type is a regular file or symbolic link,
            the internal list is searched for a matching inode.  If such an inode is found, the  link  count  is
            decremented and the file size of <u>*entry</u> is set to 0 to notify that no body should be written.  If no
            such inode is found, a copy of the entry is added to the internal cache with a link count reduced by
            one.

       3.   For  new cpio like archive formats a value for <u>*entry</u> of NULL is used to flush deferred entries.  In
            that case <u>*entry</u> is set to an arbitrary deferred entry and the entry  itself  is  removed  from  the
            internal  list.   If  the internal list is empty, <u>*entry</u> is set to NULL.  In either case, <u>*sparse</u> is
            set to NULL and the function returns.  If the hardlink count of <u>*entry</u> is one or the file type is  a
            directory or device, <u>*sparse</u> is set to NULL and no further action is taken.  Otherwise, the internal
            list  is  searched  for  a matching inode.  If such an inode is not found, the entry is added to the
            internal list, both <u>*entry</u> and <u>*sparse</u> are set to NULL and the function returns.  If such  an  inode
            is  found,  the link count is decremented.  If it remains larger than one, the existing entry on the
            internal list is swapped with <u>*entry</u> after retaining the link count.  The existing entry is returned
            in <u>*entry</u>.  If the link count reached one, the new entry is also removed from the internal list  and
            returned in <u>*sparse</u>.  Otherwise <u>*sparse</u> is set to NULL.

       The general usage is therefore:

       1.   For each new archive entry, call <b>archive_entry_linkify</b>().

       2.   Keep in mind that the entries returned may have a size of 0 now.

       3.   If <u>*entry</u> is not NULL, archive it.

       4.   If <u>*sparse</u> is not NULL, archive it.

       5.   After  all  entries  have been written to disk, call <b>archive_entry_linkify</b>() with <u>*entry</u> set to NULL
            and archive the returned entry as long as it is not NULL.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>archive_entry_linkresolver_new</b>() returns NULL on <u><a href="../man3/malloc.3.html">malloc</a></u>(3) failures.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man3/archive_entry.3.html">archive_entry</a></u>(3)

Debian                                          February 2, 2012                        <u><a href="../man3/ARCHIVE_ENTRY_LINKIFY.3.html">ARCHIVE_ENTRY_LINKIFY</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>