<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>res_ninit,  res_nquery,  res_nsearch,  res_nquerydomain,  res_nmkquery,  res_nsend, res_nclose, res_init,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       res_ninit,  res_nquery,  res_nsearch,  res_nquerydomain,  res_nmkquery,  res_nsend, res_nclose, res_init,
       res_query, res_search, res_querydomain, res_mkquery, res_send, dn_comp, dn_expand - resolver routines

</pre><h4><b>LIBRARY</b></h4><pre>
       Resolver library (<u>libresolv</u>, <u>-lresolv</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/netinet/in.h">netinet/in.h</a>&gt;</b>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/arpa/nameser.h">arpa/nameser.h</a>&gt;</b>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/resolv.h">resolv.h</a>&gt;</b>

       <b>struct</b> <b>__res_state;</b>
       <b>typedef</b> <b>struct</b> <b>__res_state</b> <b>*res_state;</b>

       <b>int</b> <b>res_ninit(res_state</b> <u>statep</u><b>);</b>

       <b>void</b> <b>res_nclose(res_state</b> <u>statep</u><b>);</b>

       <b>int</b> <b>res_nquery(res_state</b> <u>statep</u><b>,</b>
                  <b>const</b> <b>char</b> <b>*</b><u>dname</u><b>,</b> <b>int</b> <u>class</u><b>,</b> <b>int</b> <u>type</u><b>,</b>
                  <b>unsigned</b> <b>char</b> <u>answer</u><b>[.</b><u>anslen</u><b>],</b> <b>int</b> <u>anslen</u><b>);</b>

       <b>int</b> <b>res_nsearch(res_state</b> <u>statep</u><b>,</b>
                  <b>const</b> <b>char</b> <b>*</b><u>dname</u><b>,</b> <b>int</b> <u>class</u><b>,</b> <b>int</b> <u>type</u><b>,</b>
                  <b>unsigned</b> <b>char</b> <u>answer</u><b>[.</b><u>anslen</u><b>],</b> <b>int</b> <u>anslen</u><b>);</b>

       <b>int</b> <b>res_nquerydomain(res_state</b> <u>statep</u><b>,</b>
                  <b>const</b> <b>char</b> <b>*</b><u>name</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>domain</u><b>,</b>
                  <b>int</b> <u>class</u><b>,</b> <b>int</b> <u>type</u><b>,</b> <b>unsigned</b> <b>char</b> <u>answer</u><b>[.</b><u>anslen</u><b>],</b>
                  <b>int</b> <u>anslen</u><b>);</b>

       <b>int</b> <b>res_nmkquery(res_state</b> <u>statep</u><b>,</b>
                  <b>int</b> <u>op</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>dname</u><b>,</b> <b>int</b> <u>class</u><b>,</b>
                  <b>int</b> <u>type</u><b>,</b> <b>const</b> <b>unsigned</b> <b>char</b> <u>data</u><b>[.</b><u>datalen</u><b>],</b> <b>int</b> <u>datalen</u><b>,</b>
                  <b>const</b> <b>unsigned</b> <b>char</b> <b>*</b><u>newrr</u><b>,</b>
                  <b>unsigned</b> <b>char</b> <u>buf</u><b>[.</b><u>buflen</u><b>],</b> <b>int</b> <u>buflen</u><b>);</b>

       <b>int</b> <b>res_nsend(res_state</b> <u>statep</u><b>,</b>
                  <b>const</b> <b>unsigned</b> <b>char</b> <u>msg</u><b>[.</b><u>msglen</u><b>],</b> <b>int</b> <u>msglen</u><b>,</b>
                  <b>unsigned</b> <b>char</b> <u>answer</u><b>[.</b><u>anslen</u><b>],</b> <b>int</b> <u>anslen</u><b>);</b>

       <b>int</b> <b>dn_comp(const</b> <b>char</b> <b>*</b><u>exp_dn</u><b>,</b> <b>unsigned</b> <b>char</b> <u>comp_dn</u><b>[.</b><u>length</u><b>],</b>
                  <b>int</b> <u>length</u><b>,</b> <b>unsigned</b> <b>char</b> <b>**</b><u>dnptrs</u><b>,</b>
                  <b>unsigned</b> <b>char</b> <b>**</b><u>lastdnptr</u><b>);</b>

       <b>int</b> <b>dn_expand(const</b> <b>unsigned</b> <b>char</b> <b>*</b><u>msg</u><b>,</b>
                  <b>const</b> <b>unsigned</b> <b>char</b> <b>*</b><u>eomorig</u><b>,</b>
                  <b>const</b> <b>unsigned</b> <b>char</b> <b>*</b><u>comp_dn</u><b>,</b> <b>char</b> <u>exp_dn</u><b>[.</b><u>length</u><b>],</b>
                  <b>int</b> <u>length</u><b>);</b>

       <b>[[deprecated]]</b> <b>extern</b> <b>struct</b> <b>__res_state</b> <b>_res;</b>

       <b>[[deprecated]]</b> <b>int</b> <b>res_init(void);</b>

       <b>[[deprecated]]</b>
       <b>int</b> <b>res_query(const</b> <b>char</b> <b>*</b><u>dname</u><b>,</b> <b>int</b> <u>class</u><b>,</b> <b>int</b> <u>type</u><b>,</b>
                  <b>unsigned</b> <b>char</b> <u>answer</u><b>[.</b><u>anslen</u><b>],</b> <b>int</b> <u>anslen</u><b>);</b>

       <b>[[deprecated]]</b>
       <b>int</b> <b>res_search(const</b> <b>char</b> <b>*</b><u>dname</u><b>,</b> <b>int</b> <u>class</u><b>,</b> <b>int</b> <u>type</u><b>,</b>
                  <b>unsigned</b> <b>char</b> <u>answer</u><b>[.</b><u>anslen</u><b>],</b> <b>int</b> <u>anslen</u><b>);</b>

       <b>[[deprecated]]</b>
       <b>int</b> <b>res_querydomain(const</b> <b>char</b> <b>*</b><u>name</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>domain</u><b>,</b>
                  <b>int</b> <u>class</u><b>,</b> <b>int</b> <u>type</u><b>,</b> <b>unsigned</b> <b>char</b> <u>answer</u><b>[.</b><u>anslen</u><b>],</b>
                  <b>int</b> <u>anslen</u><b>);</b>

       <b>[[deprecated]]</b>
       <b>int</b> <b>res_mkquery(int</b> <u>op</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>dname</u><b>,</b> <b>int</b> <u>class</u><b>,</b>
                  <b>int</b> <u>type</u><b>,</b> <b>const</b> <b>unsigned</b> <b>char</b> <u>data</u><b>[.</b><u>datalen</u><b>],</b> <b>int</b> <u>datalen</u><b>,</b>
                  <b>const</b> <b>unsigned</b> <b>char</b> <b>*</b><u>newrr</u><b>,</b>
                  <b>unsigned</b> <b>char</b> <u>buf</u><b>[.</b><u>buflen</u><b>],</b> <b>int</b> <u>buflen</u><b>);</b>

       <b>[[deprecated]]</b>
       <b>int</b> <b>res_send(const</b> <b>unsigned</b> <b>char</b> <u>msg</u><b>[.</b><u>msglen</u><b>],</b> <b>int</b> <u>msglen</u><b>,</b>
                  <b>unsigned</b> <b>char</b> <u>answer</u><b>[.</b><u>anslen</u><b>],</b> <b>int</b> <u>anslen</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>Note:</b> This page is incomplete (various resolver functions provided by glibc are not described) and likely
       out of date.

       The functions described below make queries to and interpret  the  responses  from  Internet  domain  name
       servers.

       The  API consists of a set of more modern, reentrant functions and an older set of nonreentrant functions
       that have been superseded.  The traditional resolver interfaces such as <b>res_init</b>()  and  <b>res_query</b>()  use
       some static (global) state stored in the <b>_</b><u>res</u> structure, rendering these functions non-thread-safe.  BIND
       8.2  introduced  a  set of new interfaces <b>res_ninit</b>(), <b>res_nquery</b>(), and so on, which take a <u>res_state</u> as
       their first argument, so you can use a per-thread resolver state.

       The <b>res_ninit</b>() and <b>res_init</b>() functions read the configuration files (see  <b><a href="../man5/resolv.conf.5.html">resolv.conf</a></b>(5))  to  get  the
       default  domain name and name server address(es).  If no server is given, the local host is tried.  If no
       domain is given, that associated with the local host is used.  It can be overridden with the  environment
       variable  <b>LOCALDOMAIN</b>.   <b>res_ninit</b>()  or  <b>res_init</b>() is normally executed by the first call to one of the
       other functions.  Every call to <b>res_ninit</b>() requires a corresponding call to <b>res_nclose</b>() to free  memory
       allocated by <b>res_ninit</b>() and subsequent calls to <b>res_nquery</b>().

       The <b>res_nquery</b>() and <b>res_query</b>() functions query the name server for the fully qualified domain name <u>name</u>
       of  specified  <u>type</u>  and  <u>class</u>.  The reply is left in the buffer <u>answer</u> of length <u>anslen</u> supplied by the
       caller.

       The <b>res_nsearch</b>() and <b>res_search</b>() functions make a query and waits for the  response  like  <b>res_nquery</b>()
       and  <b>res_query</b>(),  but in addition they implement the default and search rules controlled by <b>RES_DEFNAMES</b>
       and <b>RES_DNSRCH</b> (see description of <b>_</b><u>res</u> options below).

       The <b>res_nquerydomain</b>() and <b>res_querydomain</b>() functions make a query using <b>res_nquery</b>()/<b>res_query</b>() on the
       concatenation of <u>name</u> and <u>domain</u>.

       The following functions are lower-level routines used by <b>res_nquery</b>()/<b>res_query</b>().

       The <b>res_nmkquery</b>() and <b>res_mkquery</b>() functions construct a query message in <u>buf</u> of length <u>buflen</u> for  the
       domain name <u>dname</u>.  The query type <u>op</u> is one of the following (typically <b>QUERY</b>):

       <b>QUERY</b>  Standard query.

       <b>IQUERY</b> Inverse  query.   This  option  was  removed in glibc 2.26, since it has not been supported by DNS
              servers for a very long time.

       <b>NS_NOTIFY_OP</b>
              Notify secondary of SOA (Start of Authority) change.

       <u>newrr</u> is currently unused.

       The <b>res_nsend</b>() and <b>res_send</b>() function send a preformatted query given  in  <u>msg</u>  of  length  <u>msglen</u>  and
       returns  the answer in <u>answer</u> which is of length <u>anslen</u>.  They will call <b>res_ninit</b>()/<b>res_init</b>() if it has
       not already been called.

       The <b>dn_comp</b>() function compresses the domain name <u>exp_dn</u> and stores it in the buffer  <u>comp_dn</u>  of  length
       <u>length</u>.   The  compression uses an array of pointers <u>dnptrs</u> to previously compressed names in the current
       message.  The first pointer points to the beginning of the message and the  list  ends  with  NULL.   The
       limit  of  the  array  is specified by <u>lastdnptr</u>.  If <u>dnptr</u> is NULL, domain names are not compressed.  If
       <u>lastdnptr</u> is NULL, the list of labels is not updated.

       The <b>dn_expand</b>() function expands the compressed domain name <u>comp_dn</u> to  a  full  domain  name,  which  is
       placed  in  the  buffer  <u>exp_dn</u>  of  size  <u>length</u>.   The compressed name is contained in a query or reply
       message, and <u>msg</u> points to the beginning of the message.

       The resolver routines use configuration and  state  information  contained  in  a  <b>__</b><u>res_state</u>  structure
       (either  passed  as  the  <u>statep</u>  argument,  or  in  the  global  variable <b>_</b><u>res</u>, in the case of the older
       nonreentrant functions).  The only field of this structure that is normally manipulated by  the  user  is
       the <u>options</u> field.  This field can contain the bitwise "OR" of the following options:

       <b>RES_INIT</b>
              True if <b>res_ninit</b>() or <b>res_init</b>() has been called.

       <b>RES_DEBUG</b>
              Print  debugging  messages.   This  option  is  available  only  if glibc was built with debugging
              enabled, which is not the default.

       <b>RES_AAONLY</b> (unimplemented; deprecated in glibc 2.25)
              Accept authoritative answers only.  <b>res_send</b>() continues until it finds an authoritative answer or
              returns an error.  This option was present but unimplemented until glibc 2.24; since  glibc  2.25,
              it is deprecated, and its usage produces a warning.

       <b>RES_USEVC</b>
              Use TCP connections for queries rather than UDP datagrams.

       <b>RES_PRIMARY</b> (unimplemented; deprecated in glibc 2.25)
              Query  primary  domain  name  server  only.  This option was present but unimplemented until glibc
              2.24; since glibc 2.25, it is deprecated, and its usage produces a warning.

       <b>RES_IGNTC</b>
              Ignore truncation errors.  Don't retry with TCP.

       <b>RES_RECURSE</b>
              Set the recursion desired bit in queries.  Recursion is carried out by the domain name server, not
              by <b>res_send</b>().  [Enabled by default].

       <b>RES_DEFNAMES</b>
              If set, <b>res_search</b>() will append the default domain name to single component names—that is,  those
              that do not contain a dot.  [Enabled by default].

       <b>RES_STAYOPEN</b>
              Used with <b>RES_USEVC</b> to keep the TCP connection open between queries.

       <b>RES_DNSRCH</b>
              If  set, <b>res_search</b>() will search for hostnames in the current domain and in parent domains.  This
              option is used by <b><a href="../man3/gethostbyname.3.html">gethostbyname</a></b>(3).  [Enabled by default].

       <b>RES_INSECURE1</b>
              Accept a response from a wrong server.  This can be used to detect potential security hazards, but
              you need to compile glibc with debugging enabled and  use  <b>RES_DEBUG</b>  option  (for  debug  purpose
              only).

       <b>RES_INSECURE2</b>
              Accept  a  response  which  contains a wrong query.  This can be used to detect potential security
              hazards, but you need to compile glibc with debugging enabled and use <b>RES_DEBUG</b> option (for  debug
              purpose only).

       <b>RES_NOALIASES</b>
              Disable usage of <b>HOSTALIASES</b> environment variable.

       <b>RES_USE_INET6</b>
              Try  an  AAAA query before an A query inside the <b><a href="../man3/gethostbyname.3.html">gethostbyname</a></b>(3) function, and map IPv4 responses
              in IPv6 "tunneled form" if no AAAA records are found but an A  record  set  exists.   Since  glibc
              2.25,  this  option  is  deprecated,  and  its  usage  produces a warning; applications should use
              <b><a href="../man3/getaddrinfo.3.html">getaddrinfo</a></b>(3), rather than <b><a href="../man3/gethostbyname.3.html">gethostbyname</a></b>(3).

       <b>RES_ROTATE</b>
              Causes round-robin selection of name servers from among those listed.   This  has  the  effect  of
              spreading  the  query  load among all listed servers, rather than having all clients try the first
              listed server first every time.

       <b>RES_NOCHECKNAME</b> (unimplemented; deprecated in glibc 2.25)
              Disable the modern BIND checking of incoming hostnames and mail names for invalid characters  such
              as  underscore  (_),  non-ASCII, or control characters.  This option was present until glibc 2.24;
              since glibc 2.25, it is deprecated, and its usage produces a warning.

       <b>RES_KEEPTSIG</b> (unimplemented; deprecated in glibc 2.25)
              Do not strip TSIG records.  This option was present but  unimplemented  until  glibc  2.24;  since
              glibc 2.25, it is deprecated, and its usage produces a warning.

       <b>RES_BLAST</b> (unimplemented; deprecated in glibc 2.25)
              Send  each  query  simultaneously  and  recursively  to  all servers.  This option was present but
              unimplemented until glibc 2.24; since glibc 2.25, it is  deprecated,  and  its  usage  produces  a
              warning.

       <b>RES_USEBSTRING</b> (glibc 2.3.4 to glibc 2.24)
              Make  reverse IPv6 lookups using the bit-label format described in RFC 2673; if this option is not
              set (which is the default), then nibble format is used.  This option was removed  in  glibc  2.25,
              since it relied on a backward-incompatible DNS extension that was never deployed on the Internet.

       <b>RES_NOIP6DOTINT</b> (glibc 2.24 and earlier)
              Use  <u>ip6.arpa</u>  zone  in  IPv6  reverse  lookup instead of <u>ip6.int</u>, which is deprecated since glibc
              2.3.4.  This option is present up to and including glibc 2.24, where it is enabled by default.  In
              glibc 2.25, this option was removed.

       <b>RES_USE_EDNS0</b> (since glibc 2.6)
              Enables support for the DNS extensions (EDNS0) described in RFC 2671.

       <b>RES_SNGLKUP</b> (since glibc 2.10)
              By default, glibc performs IPv4 and IPv6 lookups in parallel since glibc 2.9.  Some appliance  DNS
              servers cannot handle these queries properly and make the requests time out.  This option disables
              the  behavior and makes glibc perform the IPv6 and IPv4 requests sequentially (at the cost of some
              slowdown of the resolving process).

       <b>RES_SNGLKUPREOP</b>
              When <b>RES_SNGLKUP</b> option is enabled, opens a new socket for the each request.

       <b>RES_USE_DNSSEC</b>
              Use DNSSEC with OK bit in OPT record.  This option implies <b>RES_USE_EDNS0</b>.

       <b>RES_NOTLDQUERY</b>
              Do not look up unqualified name as a top-level domain (TLD).

       <b>RES_DEFAULT</b>
              Default option which implies: <b>RES_RECURSE</b>, <b>RES_DEFNAMES</b>, <b>RES_DNSRCH</b>, and <b>RES_NOIP6DOTINT</b>.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       The <b>res_ninit</b>() and <b>res_init</b>() functions return 0 on success, or -1 if an error occurs.

       The  <b>res_nquery</b>(),  <b>res_query</b>(),  <b>res_nsearch</b>(),  <b>res_search</b>(),  <b>res_nquerydomain</b>(),   <b>res_querydomain</b>(),
       <b>res_nmkquery</b>(),  <b>res_mkquery</b>(),  <b>res_nsend</b>(), and <b>res_send</b>() functions return the length of the response,
       or -1 if an error occurs.

       The <b>dn_comp</b>() and <b>dn_expand</b>() functions return the length of the compressed  name,  or  -1  if  an  error
       occurs.

       In   the   case   of  an  error  return  from  <b>res_nquery</b>(),  <b>res_query</b>(),  <b>res_nsearch</b>(),  <b>res_search</b>(),
       <b>res_nquerydomain</b>(), or <b>res_querydomain</b>(), the global  variable  <u>h_errno</u>  (see  <b><a href="../man3/gethostbyname.3.html">gethostbyname</a></b>(3))  can  be
       consulted to determine the cause of the error.

</pre><h4><b>FILES</b></h4><pre>
       <u><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></u>
              resolver configuration file

       <u><a href="file:/etc/host.conf">/etc/host.conf</a></u>
              resolver configuration file

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       For an explanation of the terms used in this section, see <b><a href="../man7/attributes.7.html">attributes</a></b>(7).
       ┌──────────────────────────────────────────────────────────────────────┬───────────────┬────────────────┐
       │ <b>Interface</b>                                                            │ <b>Attribute</b>     │ <b>Value</b>          │
       ├──────────────────────────────────────────────────────────────────────┼───────────────┼────────────────┤
       │ <b>res_ninit</b>(), <b>res_nclose</b>(), <b>res_nquery</b>(), <b>res_nsearch</b>(),              │ Thread safety │ MT-Safe locale │
       │ <b>res_nquerydomain</b>(), <b>res_nsend</b>()                                      │               │                │
       ├──────────────────────────────────────────────────────────────────────┼───────────────┼────────────────┤
       │ <b>res_nmkquery</b>(), <b>dn_comp</b>(), <b>dn_expand</b>()                               │ Thread safety │ MT-Safe        │
       └──────────────────────────────────────────────────────────────────────┴───────────────┴────────────────┘

</pre><h4><b>STANDARDS</b></h4><pre>
       None.

</pre><h4><b>HISTORY</b></h4><pre>
       4.3BSD.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/gethostbyname.3.html">gethostbyname</a></b>(3), <b><a href="../man5/resolv.conf.5.html">resolv.conf</a></b>(5), <b><a href="../man5/resolver.5.html">resolver</a></b>(5), <b><a href="../man7/hostname.7.html">hostname</a></b>(7), <b><a href="../man8/named.8.html">named</a></b>(8)

       The GNU C library source file <u>resolv/README</u>.

Linux man-pages 6.9.1                              2024-05-02                                        <u><a href="../man3/resolver.3.html">resolver</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>