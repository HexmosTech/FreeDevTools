<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cpl_complete_word,    cfc_file_start,    cfc_literal_escapes,    cfc_set_check_fn,    cpl_add_completion,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libtecla-dev">libtecla-dev_1.6.3-3.1build1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       cpl_complete_word,    cfc_file_start,    cfc_literal_escapes,    cfc_set_check_fn,    cpl_add_completion,
       cpl_file_completions,   cpl_last_error,   cpl_list_completions,   cpl_recall_matches,   cpl_record_error,
       del_CplFileConf,  del_WordCompletion,  new_CplFileConf,  new_WordCompletion - lookup possible completions
       for a word

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
       #include &lt;libtecla.h&gt;

       WordCompletion *new_WordCompletion(void);

       WordCompletion *del_WordCompletion(WordCompletion *cpl);

       #define CPL_MATCH_FN(fn) int (fn)(WordCompletion *cpl, \
                                         void *data, \
                                         const char *line, \
                                         int word_end)
       typedef CPL_MATCH_FN(CplMatchFn);

       CPL_MATCH_FN(cpl_file_completions);

       CplMatches *cpl_complete_word(WordCompletion *cpl,
                                     const char *line,
                                     int word_end, void *data,
                                     CplMatchFn *match_fn);

       CplMatches *cpl_recall_matches(WordCompletion *cpl);

       int cpl_list_completions(CplMatches *result, FILE *fp,
                                int term_width);

       int cpl_add_completion(WordCompletion *cpl,
                              const char *line, int word_start,
                              int word_end, const char *suffix,
                              const char *type_suffix,
                              const char *cont_suffix);

       void cpl_record_error(WordCompletion *cpl,
                             const char *errmsg);

       const char *cpl_last_error(WordCompletion *cpl);

       #define CPL_CHECK_FN(fn) int (fn)(void *data, \
                                         const char *pathname)

       typedef CPL_CHECK_FN(CplCheckFn);

       CPL_CHECK_FN(cpl_check_exe);

       CplFileConf *new_CplFileConf(void);

       CplFileConf *del_CplFileConf(CplFileConf *cfc);

       void cfc_literal_escapes(CplFileConf *cfc, int literal);

       void cfc_file_start(CplFileConf *cfc, int start_index);

       void cfc_set_check_fn(CplFileConf *cfc, CplCheckFn *chk_fn,
                             void *chk_data);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>cpl_complete_word()</b> function is part of the tecla library (see  the  <a href="../man3/libtecla.3.html">libtecla</a>(3)  man  page).  It  is
       usually called behind the scenes by <b><a href="../man3/gl_get_line.3.html">gl_get_line</a>(3)</b>, but can also be called separately.

       Given  an  input  line  containing  an incomplete word to be completed, it calls a user-provided callback
       function (or the provided file-completion callback function) to look up all possible completion  suffixes
       for  that  word.  The  callback  function  is  expected  to  look backward in the line, starting from the
       specified cursor position, to find the start of the word to be completed, then to look  up  all  possible
       completions of that word and record them, one at a time by calling <b>cpl_add_completion()</b>.

       Descriptions of the functions of this module are as follows:

         WordCompletion *new_WordCompletion(void)

       This function creates the resources used by the <b>cpl_complete_word()</b> function. In particular, it maintains
       the memory that is used to return the results of calling <b>cpl_complete_word()</b>.

         WordCompletion *del_WordCompletion(WordCompletion *cpl)

       This  function  deletes  the  resources that were returned by a previous call to <b>new_WordCompletion()</b>. It
       always returns <b>NULL</b> (ie. a deleted object). It does nothing if the <b>cpl</b> argument is <b>NULL</b>.

       The callback functions which lookup possible completions should  be  defined  with  the  following  macro
       (which is defined in libtecla.h).

         #define CPL_MATCH_FN(fn) int (fn)(WordCompletion *cpl, \
                                           void *data, \
                                           const char *line, \
                                           int word_end)

       Functions  of  this  type are called by <b>cpl_complete_word()</b>, and all of the arguments of the callback are
       those that were passed to said function. In  particular,  the  <b>line</b>  argument  contains  the  input  line
       containing  the  word  to  be completed, and <b>word_end</b> is the index of the character that follows the last
       character of the incomplete word within this string. The callback is  expected  to  look  backwards  from
       <b>word_end</b>  for  the  start of the incomplete word. What constitutes the start of a word clearly depends on
       the application, so it makes sense for the callback to take on  this  responsibility.  For  example,  the
       builtin  filename  completion  function looks backwards until it hits an unescaped space, or the start of
       the line.  Having found the start of the word, the callback should then lookup all  possible  completions
       of  this  word,  and  record  each completion via separate calls to <b>cpl_add_completion()</b>. If the callback
       needs access to an application-specific symbol table, it can pass it and any other data  that  it  needs,
       via the <b>data</b> argument. This removes any need for globals.

       The  callback  function should return 0 if no errors occur. On failure it should return 1, and register a
       terse description of the error by calling <b>cpl_record_error()</b>.

         void cpl_record_error(WordCompletion *cpl,
                               const char *errmsg);

       The last error message recorded by calling <b>cpl_record_error()</b>, can subsequently  be  queried  by  calling
       <b>cpl_last_error()</b>, as described later.

         int cpl_add_completion(WordCompletion *cpl,
                                const char *line, int word_start,
                                int word_end, const char *suffix,
                                const char *type_suffix,
                                const char *cont_suffix);

       The  <b>cpl_add_completion()</b>  function  is  called zero or more times by the completion callback function to
       record  each  possible  completion  in  the  specified  <b>WordCompletion</b>  object.  These  completions   are
       subsequently  returned  by <b>cpl_complete_word()</b>, as described later. The <b>cpl</b>, <b>line</b>, and <b>word_end</b> arguments
       should be those that were passed to the callback function. The <b>word_start</b> argument should  be  the  index
       within the input line string of the start of the word that is being completed. This should equal <b>word_end</b>
       if  a  zero-length  string  is  being  completed. The <b>suffix</b> argument is the string that would have to be
       appended to the incomplete word to complete  it.   If  this  needs  any  quoting  (eg.  the  addition  of
       backslashes  before  special  characters)  to  be  valid  within the displayed input line, this should be
       included. A copy of the suffix string is allocated internally, so there is no need to maintain your  copy
       of the string after <b>cpl_add_completion()</b> returns.

       Note that in the array of possible completions which the <b>cpl_complete_word()</b> function returns, the suffix
       recorded  by  <b>cpl_add_completion()</b>  is  listed along with the concatentation of this suffix with the word
       that lies between <b>word_start</b> and <b>word_end</b> in the input line.

       The <b>type_suffix</b> argument specifies an optional string to be appended to the completion if it is displayed
       as part of a list of completions by <b>cpl_list_completions()</b>. The intention is that this  indicate  to  the
       user  the type of each completion. For example, the file completion function places a directory separator
       after completions that are directories, to indicate their nature to the user. Similary, if the completion
       were a function, you could indicate this to the user by  setting  <b>type_suffix</b>  to  "()".  Note  that  the
       <b>type_suffix</b>  string isn't copied, so if the argument isn't a literal string between speech marks, be sure
       that the string remains valid for at least as long as the results of <b>cpl_complete_word()</b> are needed.

       The <b>cont_suffix</b> is a continuation suffix to append to the completed word in the input line if this is the
       only completion. This is something that isn't part of the completion itself, but that gives the  user  an
       indication  about how they might continue to extend the token.  For example, the file-completion callback
       function adds a directory separator if the completed word is a directory. If the completed  word  were  a
       function name, you could similarly aid the user by arranging for an open parenthesis to be appended.

         CplMatches *cpl_complete_word(WordCompletion *cpl,
                                       const char *line,
                                       int word_end, void *data,
                                       CplMatchFn *match_fn);

       The  <b>cpl_complete_word()</b>  is  normally called behind the scenes by <b><a href="../man3/gl_get_line.3.html">gl_get_line</a>(3)</b>, but can also be called
       separately if you separately allocate a <b>WordCompletion</b> object. It performs word completion, as  described
       at  the  beginning  of  this  section.  Its  first  argument  is a resource object previously returned by
       <b>new_WordCompletion()</b>.  The <b>line</b> argument is the input line string, containing the word to  be  completed.
       The  <b>word_end</b>  argument contains the index of the character in the input line, that just follows the last
       character of the word to be completed. When called by <b>gl_get_line()</b>, this is the character over which the
       user pressed <b>TAB</b>. The <b>match_fn</b> <b>argument</b> <b>is</b> <b>the</b> <b>function</b> <b>pointer</b>  <b>of</b>  <b>the</b>  <b>callback</b>  <b>function</b>  <b>which</b>  <b>will</b>
       <b>lookup</b> <b>possible</b> <b>completions</b> <b>of</b> <b>the</b> <b>word,</b> <b>as</b> <b>described</b> <b>above,</b> <b>and</b> <b>the</b> <b>data</b> argument provides a way for the
       application to pass arbitrary data to the callback function.

       If  no  errors  occur,  the  <b>cpl_complete_word()</b> function returns a pointer to a <b>CplMatches</b> container, as
       defined  below.  This  container  is  allocated  as  part  of  the  <b>cpl</b>  object  that   was   passed   to
       <b>cpl_complete_word()</b>, and will thus change on each call which uses the same <b>cpl</b> argument.

         typedef struct {
           char *completion;        /* A matching completion */
                                    /*  string */
           char *suffix;            /* The part of the */
                                    /*  completion string which */
                                    /*  would have to be */
                                    /*  appended to complete the */
                                    /*  original word. */
           const char *type_suffix; /* A suffix to be added when */
                                    /*  listing completions, to */
                                    /*  indicate the type of the */
                                    /*  completion. */
         } CplMatch;

         typedef struct {
           char *suffix;            /* The common initial part */
                                    /*  of all of the completion */
                                    /*  suffixes. */
           const char *cont_suffix; /* Optional continuation */
                                    /*  string to be appended to */
                                    /*  the sole completion when */
                                    /*  nmatch==1. */
           CplMatch *matches;       /* The array of possible */
                                    /*  completion strings, */
                                    /*  sorted into lexical */
                                    /*  order. */
           int nmatch;              /* The number of elements in */
                                    /*  the above matches[] */
                                    /*  array. */
         } CplMatches;

       If an error occurs during completion, <b>cpl_complete_word()</b> returns NULL. A description of the error can be
       acquired by calling the <b>cpl_last_error()</b> <b>function.</b>

         <b>const</b> <b>char</b> <b>*cpl_last_error(WordCompletion</b> <b>*cpl);</b>

       <b>The</b> <b>cpl_last_error()</b> <b>function</b> <b>returns</b> <b>a</b> <b>terse</b> <b>description</b> <b>of</b> <b>the</b> <b>error</b> <b>which</b> <b>occurred</b> <b>on</b> <b>the</b> <b>last</b> <b>call</b> <b>to</b>
       <b>cpl_complete_word()</b> or <b>cpl_add_completion()</b>.

         CplMatches *cpl_recall_matches(WordCompletion *cpl);

       As  a  convenience,  the  return value of the last call to <b>cpl_complete_word()</b> can be recalled at a later
       time by calling <b>cpl_recall_matches()</b>. If <b>cpl_complete_word()</b> returned <b>NULL</b>, so will <b>cpl_recall_matches()</b>.

         int cpl_list_completions(CplMatches *result, FILE *fp,
                                  int terminal_width);

       When the <b>cpl_complete_word()</b> function returns multiple possible completions,  the  <b>cpl_list_completions()</b>
       function  can  be called upon to list them, suitably arranged across the available width of the terminal.
       It arranges for the displayed columns of completions to all have the  same  width,  set  by  the  longest
       completion.  It  also  appends  the  <b>type_suffix</b>  strings  that  were recorded with each completion, thus
       indicating their types to the user.

</pre><h4><b>THE</b> <b>BUILT-IN</b> <b>FILENAME-COMPLETION</b> <b>CALLBACK</b></h4><pre>
       By  default  the  <b><a href="../man3/gl_get_line.3.html">gl_get_line</a>(3)</b>  function,  passes  the  following  completion  callback   function   to
       <b>cpl_complete_word()</b>.   This   function   can   also   be   used  separately,  either  by  sending  it  to
       <b>cpl_complete_word()</b>, or by calling it directly from your own completion callback function.

         CPL_MATCH_FN(cpl_file_completions);

       Certain aspects of the behavior of this callback can be changed via its <b>data</b> argument. If you  are  happy
       with  its  default  behavior  you  can  pass <b>NULL</b> in this argument. Otherwise it should be a pointer to a
       <b>CplFileConf</b> object, previously allocated by calling <b>new_CplFileConf()</b>.

         CplFileConf *new_CplFileConf(void);

       <b>CplFileConf</b> objects encapsulate the configuration parameters of <b>cpl_file_completions()</b>. These parameters,
       which start out with default values, can be changed by calling the accessor functions described below.

       By default, the <b>cpl_file_completions()</b> <b>callback</b> <b>function</b> <b>searches</b> <b>backwards</b> <b>for</b> <b>the</b> <b>start</b> <b>of</b> <b>the</b> <b>filename</b>
       <b>being</b> <b>completed,</b> <b>looking</b> <b>for</b> <b>the</b> <b>first</b> <b>un-escaped</b> <b>space</b> <b>or</b> <b>the</b> <b>start</b> <b>of</b> <b>the</b> <b>input</b> <b>line.</b> <b>If</b>  <b>you</b>  <b>wish</b>  <b>to</b>
       <b>specify</b>  <b>a</b>  <b>different</b>  <b>location,</b> <b>call</b> <b>cfc_file_start()</b> with the index at which the filename starts in the
       input line. Passing start_index=-1 re-enables the default behavior.

         void cfc_file_start(CplFileConf *cfc, int start_index);

       By default, when <b>cpl_file_completions()</b> looks at a filename in the input line, each lone backslash in the
       input line is interpreted as being a special character which removes  any  special  significance  of  the
       character  which  follows  it,  such as a space which should be taken as part of the filename rather than
       delimiting the start of the filename. These backslashes are thus ignored while looking  for  completions,
       and  subsequently  added  before spaces, tabs and literal backslashes in the list of completions. To have
       unescaped backslashes treated as normal characters, call <b>cfc_literal_escapes()</b> with a non-zero  value  in
       its <b>literal</b> argument.

         void cfc_literal_escapes(CplFileConf *cfc, int literal);

       By  default,  <b>cpl_file_completions()</b>  reports  all  files who's names start with the prefix that is being
       completed. If you only want a selected subset of these files to be reported in the list  of  completions,
       you  can  arrange  this  by  providing  a  callback function which takes the full pathname of a file, and
       returns <b>0</b> if the file should be ignored, or <b>1</b> if the file should be included in the list of  completions.
       To  register  such  a  function for use by <b>cpl_file_completions()</b>, call <b>cfc_set_check_fn()</b>, and pass it a
       pointer to the function, together with a pointer to any data that you would like passed to this  callback
       whenever  it  is  called. Your callback can make its decisions based on any property of the file, such as
       the filename itself, whether the file is readable, writable or executable, or even based on what the file
       contains.

         #define CPL_CHECK_FN(fn) int (fn)(void *data, \
                                           const char *pathname)
         typedef CPL_CHECK_FN(CplCheckFn);

         void cfc_set_check_fn(CplFileConf *cfc,
                               CplCheckFn *chk_fn, void *chk_data);

       The  <b>cpl_check_exe()</b>  function  is  a   provided   callback   of   the   above   type,   for   use   with
       <b>cpl_file_completions()</b>.  It  returns  non-zero  if the filename that it is given represents a normal file
       that the user has execute permission to. You could use this  to  have  <b>cpl_file_completions()</b>  only  list
       completions of executable files.

       When  you  have finished with a <b>CplFileConf</b> variable, you can pass it to the <b>del_CplFileConf()</b> destructor
       function to reclaim its memory.

         CplFileConf *del_CplFileConf(CplFileConf *cfc);

</pre><h4><b>THREAD</b> <b>SAFETY</b></h4><pre>
       In multi-threaded programs, you should use the <b>libtecla_r.a</b> version  of  the  library.  This  uses  POSIX
       reentrant  functions  where  available  (hence  the  <b>_r</b>  suffix), and disables features that rely on non-
       reentrant system functions. In the case of this module, the only disabled feature is username  completion
       in <b>~username/</b> expressions, in <b>cpl_file_completions()</b>.

       Using  the  <b>libtecla_r.a</b>  version  of  the  library,  it  is safe to use the facilities of this module in
       multiple threads, provided that each thread uses a separately allocated <b>WordCompletion</b> object.  In  other
       words,  if two threads want to do word completion, they should each call <b>new_WordCompletion()</b> to allocate
       their own completion objects.

</pre><h4><b>FILES</b></h4><pre>
       libtecla.a    -    The tecla library
       libtecla.h    -    The tecla header file.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man3/libtecla.3.html">libtecla</a>(3), <a href="../man3/gl_get_line.3.html">gl_get_line</a>(3), <a href="../man3/ef_expand_file.3.html">ef_expand_file</a>(3),
       <a href="../man3/pca_lookup_file.3.html">pca_lookup_file</a>(3)

</pre><h4><b>AUTHOR</b></h4><pre>
       Martin Shepherd  (<a href="mailto:mcs@astro.caltech.edu">mcs@astro.caltech.edu</a>)

                                                                                            <u><a href="../man3/cpl_complete_word.3.html">cpl_complete_word</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>