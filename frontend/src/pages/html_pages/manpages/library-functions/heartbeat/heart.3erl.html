<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>heart - Heartbeat monitoring of an Erlang runtime system.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/erlang-manpages">erlang-manpages_24.2.1+dfsg-1ubuntu0.5_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       heart - Heartbeat monitoring of an Erlang runtime system.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  modules contains the interface to the <u>heart</u> process. <u>heart</u> sends periodic heartbeats to an external
       port program, which is also named <u>heart</u>. The purpose of the <u>heart</u> port  program  is  to  check  that  the
       Erlang  runtime  system  it  is  supervising  is  still running. If the port program has not received any
       heartbeats within <u>HEART_BEAT_TIMEOUT</u> seconds (defaults to 60 seconds), the system can be rebooted.

       An Erlang runtime system to be monitored by a heart program is  to  be  started  with  command-line  flag
       <u>-heart</u> (see also <u><a href="../man1/erl.1.html">erl</a>(1)</u>). The <u>heart</u> process is then started automatically:

       % erl -heart ...

       If  the  system  is  to be rebooted because of missing heartbeats, or a terminated Erlang runtime system,
       environment variable <u>HEART_COMMAND</u> must be set before the system is started. If this variable is not set,
       a warning text is printed but the system does not reboot.

       To reboot on Windows, <u>HEART_COMMAND</u> can be set to <u>heart</u> <u>-shutdown</u> (included in the Erlang delivery) or to
       any other suitable program that can activate a reboot.

       The environment variable <u>HEART_BEAT_TIMEOUT</u> can be used to configure the heart time-outs; it can  be  set
       in the operating system shell before Erlang is started or be specified at the command line:

       % erl -heart -env HEART_BEAT_TIMEOUT 30 ...

       The value (in seconds) must be in the range 10 &lt; X &lt;= 65535.

       When  running on OSs lacking support for monotonic time, <u>heart</u> is susceptible to system clock adjustments
       of more than <u>HEART_BEAT_TIMEOUT</u> seconds. When this happens, <u>heart</u> times  out  and  tries  to  reboot  the
       system.  This can occur, for example, if the system clock is adjusted automatically by use of the Network
       Time Protocol (NTP).

       If a crash occurs, an <u>erl_crash.dump</u> is <u>not</u> written unless environment variable <u>ERL_CRASH_DUMP_SECONDS</u> is
       set:

       % erl -heart -env ERL_CRASH_DUMP_SECONDS 10 ...

       If a regular core dump is wanted, let <u>heart</u> know by setting the kill signal to  abort  using  environment
       variable  <u>HEART_KILL_SIGNAL=SIGABRT</u>.  If  unset,  or  not  set to <u>SIGABRT</u>, the default behavior is a kill
       signal using <u>SIGKILL</u>:

       % erl -heart -env HEART_KILL_SIGNAL SIGABRT ...

       If heart should <u>not</u> kill the Erlang runtime system, this can be indicated using the environment  variable
       <u>HEART_NO_KILL=TRUE</u>.  This  can be useful if the command executed by heart takes care of this, for example
       as part of a specific cleanup sequence. If unset, or not set to <u>TRUE</u>, the default behaviour  will  be  to
       kill as described above.

       % erl -heart -env HEART_NO_KILL 1 ...

       Furthermore, <u>ERL_CRASH_DUMP_SECONDS</u> has the following behavior on <u>heart</u>:

         <u>ERL_CRASH_DUMP_SECONDS=0</u>:
           Suppresses  the writing of a crash dump file entirely, thus rebooting the runtime system immediately.
           This is the same as not setting the environment variable.

         <u>ERL_CRASH_DUMP_SECONDS=-1</u>:
           Setting the environment variable to a negative value does not reboot the  runtime  system  until  the
           crash dump file is completly written.

         <u>ERL_CRASH_DUMP_SECONDS=S</u>:
           <u>heart</u>  waits  for <u>S</u> seconds to let the crash dump file be written. After <u>S</u> seconds, <u>heart</u> reboots the
           runtime system, whether the crash dump file is written or not.

       In the following descriptions, all functions fail with reason <u>badarg</u> if <u>heart</u> is not started.

</pre><h4><b>DATA</b> <b>TYPES</b></h4><pre>
       <b>heart_option()</b> = check_schedulers

</pre><h4><b>EXPORTS</b></h4><pre>
       <b>set_cmd(Cmd)</b> <b>-&gt;</b> <b>ok</b> <b>|</b> <b>{error,</b> <b>{bad_cmd,</b> <b>Cmd}}</b>

              Types:

                 Cmd = string()

              Sets a temporary reboot command. This command is used  if  a  <u>HEART_COMMAND</u>  other  than  the  one
              specified with the environment variable is to be used to reboot the system. The new Erlang runtime
              system uses (if it misbehaves) environment variable <u>HEART_COMMAND</u> to reboot.

              Limitations:  Command  string  <u>Cmd</u> is sent to the <u>heart</u> program as an ISO Latin-1 or UTF-8 encoded
              binary, depending on the filename encoding mode of the emulator (see <u>file:native_name_encoding/0</u>).
              The size of the encoded binary must be less than 2047 bytes.

       <b>clear_cmd()</b> <b>-&gt;</b> <b>ok</b>

              Clears the temporary boot command. If the system terminates, the normal <u>HEART_COMMAND</u> is  used  to
              reboot.

       <b>get_cmd()</b> <b>-&gt;</b> <b>{ok,</b> <b>Cmd}</b>

              Types:

                 Cmd = string()

              Gets the temporary reboot command. If the command is cleared, the empty string is returned.

       <b>set_callback(Module,</b> <b>Function)</b> <b>-&gt;</b>
                       ok | {error, {bad_callback, {Module, Function}}}

              Types:

                 Module = Function = atom()

              This  validation  callback  will be executed before any heartbeat is sent to the port program. For
              the validation to succeed it needs to return with the value <u>ok</u>.

              An exception within the callback will be treated as a validation failure.

              The callback will be removed if the system reboots.

       <b>clear_callback()</b> <b>-&gt;</b> <b>ok</b>

              Removes the validation callback call before heartbeats.

       <b>get_callback()</b> <b>-&gt;</b> <b>{ok,</b> <b>{Module,</b> <b>Function}}</b> <b>|</b> <b>none</b>

              Types:

                 Module = Function = atom()

              Get the validation callback. If the callback is cleared, <u>none</u> will be returned.

       <b>set_options(Options)</b> <b>-&gt;</b> <b>ok</b> <b>|</b> <b>{error,</b> <b>{bad_options,</b> <b>Options}}</b>

              Types:

                 Options = [heart_option()]

              Valid options <u>set_options</u> are:

                <u>check_schedulers</u>:
                  If enabled, a signal will be sent to each scheduler to check its  responsiveness.  The  system
                  check occurs before any heartbeat sent to the port program. If any scheduler is not responsive
                  enough  the  heart  program  will  not receive its heartbeat and thus eventually terminate the
                  node.

              Returns with the value <u>ok</u> if the options are valid.

       <b>get_options()</b> <b>-&gt;</b> <b>{ok,</b> <b>Options}</b> <b>|</b> <b>none</b>

              Types:

                 Options = [atom()]

              Returns <u>{ok,</u> <u>Options}</u> where <u>Options</u> is a list  of  current  options  enabled  for  heart.  If  the
              callback is cleared, <u>none</u> will be returned.

Ericsson AB                                        kernel 8.2                                        <u><a href="../man3erl/heart.3erl.html">heart</a></u>(3erl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>