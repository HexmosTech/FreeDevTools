<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mtrace, muntrace - malloc tracing</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mtrace, muntrace - malloc tracing

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/mcheck.h">mcheck.h</a>&gt;</b>

       <b>void</b> <b>mtrace(void);</b>
       <b>void</b> <b>muntrace(void);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>mtrace</b>() function installs hook functions for the memory-allocation functions (<b><a href="../man3/malloc.3.html">malloc</a></b>(3), <b><a href="../man3/realloc.3.html">realloc</a></b>(3)
       <b><a href="../man3/memalign.3.html">memalign</a></b>(3), <b><a href="../man3/free.3.html">free</a></b>(3)).  These hook functions record  tracing  information  about  memory  allocation  and
       deallocation.   The  tracing  information  can  be  used  to  discover  memory leaks and attempts to free
       nonallocated memory in a program.

       The <b>muntrace</b>() function disables the hook functions installed by <b>mtrace</b>(), so that tracing information is
       no longer recorded for the memory-allocation functions.  If no hook functions were successfully installed
       by <b>mtrace</b>(), <b>muntrace</b>() does nothing.

       When <b>mtrace</b>() is called, it checks the value of  the  environment  variable  <b>MALLOC_TRACE</b>,  which  should
       contain  the  pathname  of a file in which the tracing information is to be recorded.  If the pathname is
       successfully opened, it is truncated to zero length.

       If <b>MALLOC_TRACE</b> is not set, or the pathname it specifies  is  invalid  or  not  writable,  then  no  hook
       functions  are  installed,  and  <b>mtrace</b>()  has  no  effect.   In  set-user-ID  and set-group-ID programs,
       <b>MALLOC_TRACE</b> is ignored, and <b>mtrace</b>() has no effect.

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       For an explanation of the terms used in this section, see <b><a href="../man7/attributes.7.html">attributes</a></b>(7).
       ┌───────────────────────────────────────────────────────────────────────────┬───────────────┬───────────┐
       │ <b>Interface</b>                                                                 │ <b>Attribute</b>     │ <b>Value</b>     │
       ├───────────────────────────────────────────────────────────────────────────┼───────────────┼───────────┤
       │ <b>mtrace</b>(), <b>muntrace</b>()                                                      │ Thread safety │ MT-Unsafe │
       └───────────────────────────────────────────────────────────────────────────┴───────────────┴───────────┘

</pre><h4><b>STANDARDS</b></h4><pre>
       GNU.

</pre><h4><b>NOTES</b></h4><pre>
       In normal usage, <b>mtrace</b>() is called once at the start of execution of a program, and <b>muntrace</b>() is  never
       called.

       The  tracing  output produced after a call to <b>mtrace</b>() is textual, but not designed to be human readable.
       The GNU C library provides a Perl script, <b><a href="../man1/mtrace.1.html">mtrace</a></b>(1), that interprets the trace log  and  produces  human-
       readable output.  For best results, the traced program should be compiled with debugging enabled, so that
       line-number information is recorded in the executable.

       The  tracing  performed  by  <b>mtrace</b>()  incurs  a  performance penalty (if <b>MALLOC_TRACE</b> points to a valid,
       writable pathname).

</pre><h4><b>BUGS</b></h4><pre>
       The line-number information produced by <b><a href="../man1/mtrace.1.html">mtrace</a></b>(1) is not always precise: the line number  references  may
       refer to the previous or following (nonblank) line of the source code.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  shell  session  below  demonstrates  the use of the <b>mtrace</b>() function and the <b><a href="../man1/mtrace.1.html">mtrace</a></b>(1) command in a
       program that has memory leaks at two different locations.  The demonstration uses the following program:

           $ <b>cat</b> <b>t_mtrace.c</b>
           #include &lt;<a href="file:/usr/include/mcheck.h">mcheck.h</a>&gt;
           #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
           #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;

           int
           main(void)
           {
               mtrace();

               for (unsigned int j = 0; j &lt; 2; j++)
                   <a href="../man100/malloc.100.html">malloc</a>(100);            /* Never freed--a memory leak */

               calloc(16, 16);             /* Never freed--a memory leak */
               exit(EXIT_SUCCESS);
           }

       When we run the program as follows, we  see  that  <b>mtrace</b>()  diagnosed  memory  leaks  at  two  different
       locations in the program:

           $ <b>cc</b> <b>-g</b> <b>t_mtrace.c</b> <b>-o</b> <b>t_mtrace</b>
           $ <b>export</b> <b>MALLOC_TRACE=/tmp/t</b>
           $ <b>./t_mtrace</b>
           $ <b>mtrace</b> <b>./t_mtrace</b> <b>$MALLOC_TRACE</b>
           Memory not freed:
           -----------------
              Address     Size     Caller
           0x084c9378     0x64  at /home/cecilia/t_mtrace.c:12
           0x084c93e0     0x64  at /home/cecilia/t_mtrace.c:12
           0x084c9448    0x100  at /home/cecilia/t_mtrace.c:16

       The  first  two  messages about unfreed memory correspond to the two <b><a href="../man3/malloc.3.html">malloc</a></b>(3) calls inside the <u>for</u> loop.
       The final message corresponds to the call to <b><a href="../man3/calloc.3.html">calloc</a></b>(3) (which in turn calls <b><a href="../man3/malloc.3.html">malloc</a></b>(3)).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/mtrace.1.html">mtrace</a></b>(1), <b><a href="../man3/malloc.3.html">malloc</a></b>(3), <b><a href="../man3/malloc_hook.3.html">malloc_hook</a></b>(3), <b><a href="../man3/mcheck.3.html">mcheck</a></b>(3)

Linux man-pages 6.9.1                              2024-05-02                                          <u><a href="../man3/mtrace.3.html">mtrace</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>