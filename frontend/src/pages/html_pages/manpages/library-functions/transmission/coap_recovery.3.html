<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>coap_recovery, coap_session_set_ack_random_factor, coap_session_get_ack_random_factor,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcoap3t64">libcoap3t64_4.3.4-1.1build4_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       coap_recovery, coap_session_set_ack_random_factor, coap_session_get_ack_random_factor,
       coap_session_set_ack_timeout, coap_session_get_ack_timeout, coap_session_set_default_leisure,
       coap_session_get_default_leisure, coap_session_set_max_payloads, coap_session_get_max_payloads,
       coap_session_set_max_retransmit, coap_session_get_max_retransmit, coap_session_set_non_max_retransmit,
       coap_session_get_non_max_retransmit, coap_session_set_non_receive_timeout,
       coap_session_get_non_receive_timeout, coap_session_set_non_timeout, coap_session_get_non_timeout,
       coap_session_set_nstart, coap_session_get_nstart, coap_session_set_probing_rate,
       coap_session_get_probing_rate, coap_debug_set_packet_loss - Work with CoAP packet transmissions

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;coap3/coap.h&gt;</b>

       <b>void</b> <b>coap_session_set_ack_random_factor(coap_session_t</b> <b>*</b><u>session</u><b>,</b> <b>coap_fixed_point_t</b> <u>value</u><b>)</b>;

       <b>coap_fixed_point_t</b> <b>coap_session_get_ack_random_factor(</b> <b>const</b> <b>coap_session_t</b> <b>*</b><u>session</u><b>)</b>;

       <b>void</b> <b>coap_session_set_ack_timeout(coap_session_t</b> <b>*</b><u>session</u><b>,</b> <b>coap_fixed_point_t</b> <u>value</u><b>)</b>;

       <b>coap_fixed_point_t</b> <b>coap_session_get_ack_timeout(</b> <b>const</b> <b>coap_session_t</b> <b>*</b><u>session</u><b>)</b>;

       <b>void</b> <b>coap_session_set_default_leisure(coap_session_t</b> <b>*</b><u>session</u><b>,</b> <b>coap_fixed_point_t</b> <u>value</u><b>)</b>;

       <b>coap_fixed_point_t</b> <b>coap_session_get_default_leisure(</b> <b>const</b> <b>coap_session_t</b> <b>*</b><u>session</u><b>)</b>;

       <b>void</b> <b>coap_session_set_max_payloads(coap_session_t</b> <b>*</b><u>session</u><b>,</b> <b>uint16_t</b> <u>value</u><b>)</b>;

       <b>uint16_t</b> <b>coap_session_get_max_payloads(const</b> <b>coap_session_t</b> <b>*</b><u>session</u><b>)</b>;

       <b>void</b> <b>coap_session_set_max_retransmit(coap_session_t</b> <b>*</b><u>session</u><b>,</b> <b>uint16_t</b> <u>value</u><b>)</b>;

       <b>uint16_t</b> <b>coap_session_get_max_retransmit(const</b> <b>coap_session_t</b> <b>*</b><u>session</u><b>)</b>;

       <b>void</b> <b>coap_session_set_non_max_retransmit(coap_session_t</b> <b>*</b><u>session</u><b>,</b> <b>uint16_t</b> <u>value</u><b>)</b>;

       <b>uint16_t</b> <b>coap_session_get_non_max_retransmit(const</b> <b>coap_session_t</b> <b>*</b><u>session</u><b>)</b>;

       <b>void</b> <b>coap_session_set_non_receive_timeout(coap_session_t</b> <b>*</b><u>session</u><b>,</b> <b>coap_fixed_point_t</b> <u>value</u><b>)</b>;

       <b>coap_fixed_point_t</b> <b>coap_session_get_non_receive_timeout(</b> <b>const</b> <b>coap_session_t</b> <b>*</b><u>session</u><b>)</b>;

       <b>void</b> <b>coap_session_set_non_timeout(coap_session_t</b> <b>*</b><u>session</u><b>,</b> <b>coap_fixed_point_t</b> <u>value</u><b>)</b>;

       <b>coap_fixed_point_t</b> <b>coap_session_get_non_timeout(</b> <b>const</b> <b>coap_session_t</b> <b>*</b><u>session</u><b>)</b>;

       <b>void</b> <b>coap_session_set_nstart(coap_session_t</b> <b>*</b><u>session</u><b>,</b> <b>uint16_t</b> <u>value</u><b>)</b>;

       <b>uint16_t</b> <b>coap_session_get_nstart(const</b> <b>coap_session_t</b> <b>*</b><u>session</u><b>)</b>;

       <b>void</b> <b>coap_session_set_probing_rate(coap_session_t</b> <b>*</b><u>session</u><b>,</b> <b>uint32_t</b> <u>value</u><b>)</b>;

       <b>uint32_t</b> <b>coap_session_get_probing_rate(const</b> <b>coap_session_t</b> <b>*</b><u>session</u><b>)</b>;

       <b>int</b> <b>coap_debug_set_packet_loss(const</b> <b>char</b> <b>*</b><u>loss_level</u><b>)</b>;

       For specific (D)TLS library support, link with <b>-lcoap-3-notls</b>, <b>-lcoap-3-gnutls</b>, <b>-lcoap-3-openssl</b>,
       <b>-lcoap-3-mbedtls</b> or <b>-lcoap-3-tinydtls</b>. Otherwise, link with <b>-lcoap-3</b> to get the default (D)TLS library
       support.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       There is CoAP Confirmable message transmission recovery as defined in RFC7252, as well CoAP
       Non-Confirmable split into blocks message transmission recovery support as defined in RFC9177.

       For CoAP Confirmable messages, it is possible to define the retry counts, repeat rate etc. for error
       recovery. Further information can be found in "RFC7272 4.2. Messages Transmitted Reliably", with the
       default values defined in "RFC7272 4.8. Transmission Parameters".

       It is not recommended that the suggested default setting are changed, but there may be some special
       requirements that need different values and the consequences of changing these values is fully
       understood.

       Some of the parameters or return values are in fixed point format as defined by the coap_fixed_point_t
       structure as below

           typedef struct coap_fixed_point_t {
             uint16_t integer_part;    /* Integer part of fixed point variable */
             uint16_t fractional_part; /* Fractional part of fixed point variable
                                          1/1000 (3 points) precision */
           } coap_fixed_point_t;

       The CoAP Confirmable message retry rules are (with the default values to compute the time)

           1st retransmit after 1 * ack_timeout * ack_random factor (3 seconds)
           2nd retransmit after 2 * ack_timeout * ack_random factor (6 seconds)
           3rd retransmit after 3 * ack_timeout * ack_random factor (12 seconds)
           4th retransmit after 4 * ack_timeout * ack_random factor (24 seconds)
           5th retransmit after 5 * ack_timeout * ack_random factor (48 seconds)

           As max_retransmit (by default) is 4, then the 5th retransmit does not get sent,
           but at that point COAP_NACK_TOO_MANY_RETRIES gets raised in the nack_handler
           (if defined). Note that the sum of the seconds is 93 matching
           "https://rfc-editor.org/rfc/rfc7252#section-4.8.2[RFC7252 4.8.2.
           MAX_TRANSMIT_WAIT]".

       It should be noted that these retries are separate from the DTLS or TLS encrypted session setup retry
       timeouts. For DTLS, the initial requesting packet will get sent max_retransmit times before reporting
       failure. For TLS the initial TCP connection will timeout before reporting failure.

       For CoAP Non-Confirmable messages with RFC9177 enabled at both ends of a session, it is possible to
       define the retry counts etc. for data recovery. Further information can be found in "RFC9177 7.2.
       Non-confirmable (NON)".

       It is also possible to set up packet losses, for both confirmable, and non-confirmable messages. This can
       be used for stress testing packet transmission recovery as well as application handling of lossy
       networks.

</pre><h4><b>FUNCTIONS</b></h4><pre>
       The following functions reflect the RFC7252 and RFC9177 uppercase names in lowercase following the
       coap_session_set_ or coap_session_get_ function prefix.

       <b>Function:</b> <b>coap_session_set_ack_random_factor()</b>

       The <b>coap_session_set_ack_random_factor</b>() function updates the <u>session</u> ack random wait factor, used to
       randomize re-transmissions, with the new <u>value</u>. The default value is 1.5 (RFC7252).

       <b>Function:</b> <b>coap_session_get_ack_random_factor()</b>

       The <b>coap_session_get_ack_random_factor</b>() function returns the current <u>session</u> ack random wait factor
       (RFC7252).

       <b>Function:</b> <b>coap_session_set_ack_timeout()</b>

       The <b>coap_session_set_ack_timeout</b>() function updates the <u>session</u> initial ack or response timeout with the
       new <u>value</u>. The default value is 2.0 (RFC7252).

       <b>Function:</b> <b>coap_session_get_ack_timeout()</b>

       The <b>coap_session_get_ack_timeout</b>() function returns the current <u>session</u> initial ack or response timeout
       (RFC7252).

       <b>Function:</b> <b>coap_session_set_default_leisure()</b>

       The <b>coap_session_set_default_leisure</b>() function updates the <u>session</u> default leisure time with the new
       <u>value</u>. The default value is 5.0 (RFC7252).

       <b>Function:</b> <b>coap_session_get_default_leisure()</b>

       The <b>coap_session_get_default_leisure</b>() function returns the current <u>session</u> default leisure time
       (RFC7252).

       <b>Function:</b> <b>coap_session_set_max_payloads()</b>

       The <b>coap_session_set_max_payloads</b>() function updates the <u>session</u> maximum payloads count with the new
       <u>value</u>. The default value is 10 (RFC9177).

       <b>NOTE:</b> Both ends of the session must have the same maximum payloads value to minimize any recovery times.

       <b>Function:</b> <b>coap_session_get_max_payloads()</b>

       The <b>coap_session_get_max_payloads</b>() function returns the current <u>session</u> maximum payloads count
       (RFC9177).

       <b>Function:</b> <b>coap_session_set_max_retransmit()</b>

       The <b>coap_session_set_max_retransmit</b>() function updates the <u>session</u> maximum retransmit count with the new
       <u>value</u>. The default value is 4 (RFC7252).

       <b>Function:</b> <b>coap_session_get_max_retransmit()</b>

       The <b>coap_session_get_max_retransmit</b>() function returns the current <u>session</u> maximum retransmit count
       (RFC7252).

       <b>Function:</b> <b>coap_session_set_non_max_retransmit()</b>

       The <b>coap_session_set_non_max_retransmit</b>() function updates the <u>session</u> maximum non retransmit count with
       the new <u>value</u>. The default value is 4 (RFC9177).

       <b>Function:</b> <b>coap_session_get_non_max_retransmit()</b>

       The <b>coap_session_get_non_max_retransmit</b>() function returns the current <u>session</u> maximum non retransmit
       count (RFC9177).

       <b>Function:</b> <b>coap_session_set_non_receive_timeout()</b>

       The <b>coap_session_set_non_receive_timeout</b>() function updates the <u>session</u> non receive timeout with the new
       <u>value</u>. The default value is 4.0 (RFC9177).

       <b>Function:</b> <b>coap_session_get_non_receive_timeout()</b>

       The <b>coap_session_get_non_receive_timeout</b>() function returns the current <u>session</u> non receive timeout
       (RFC9177).

       <b>Function:</b> <b>coap_session_set_non_timeout()</b>

       The <b>coap_session_set_non_timeout</b>() function updates the <u>session</u> non timeout with the new <u>value</u>. The
       default value is 2.0 (RFC9177).

       <b>Function:</b> <b>coap_session_get_non_timeout()</b>

       The <b>coap_session_get_non_timeout</b>() function returns the current <u>session</u> non timeout (RFC9177).

       <b>Function:</b> <b>coap_session_set_nstart()</b>

       The <b>coap_session_set_nstart</b>() function updates the <u>session</u> nstart with the new <u>value</u>. The default value
       is 1 (RFC7252).

       <b>Function:</b> <b>coap_session_set_probing_rate()</b>

       The <b>coap_session_get_nstart</b>() function returns the current <u>session</u> nstart value (RFC7252).

       <b>Function:</b> <b>coap_session_set_probing_rate()</b>

       The <b>coap_session_set_probing_rate</b>() function updates the <u>session</u> probing rate with the new <u>value</u>. The
       default value is 1 byte per second (RFC7252).

       <b>Function:</b> <b>coap_session_get_probing_rate()</b>

       The <b>coap_session_get_probing_rate</b>() function returns the current <u>session</u> probing rate value (RFC7252).

       <b>Function:</b> <b>coap_debug_set_packet_loss()</b>

       The <b>coap_debug_set_packet_loss</b>() function is uses to set the packet loss levels as defined in <u>loss_level</u>.
       <u>loss_level</u> can be set as a percentage from "0%" to "100%". Alternatively, it is possible to specify which
       packets of a packet sequence are dropped. A definition of "1,5-9,11-20,101" means that packets 1, 5
       through 9, 11 through 20 and 101 will get dropped. A maximum of 10 different packet sets is supported.
       The packet count is reset to 0 when <b>coap_debug_set_packet_loss</b>() is called. To remove any packet losses,
       set the <u>loss_level</u> to "0%".

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>coap_session_get_ack_random_factor</b>(), <b>coap_session_get_ack_timeout</b>(), <b>coap_session_get_default_leisure</b>(),
       <b>coap_session_get_max_payloads</b>(), <b>coap_session_get_max_retransmit</b>(),
       <b>coap_session_get_non_max_retransmit</b>(), <b>coap_session_get_non_receive_timeout</b>(),
       <b>coap_session_get_non_timeout</b>(), <b>coap_session_get_nstart</b>() and <b>coap_session_get_probing_rate</b>() return
       their respective current values.

       <b>coap_debug_set_packet_loss</b>() returns 0 if <u>loss_level</u> does not parse correctly, otherwise 1 if successful.

</pre><h4><b>TESTING</b></h4><pre>
       The libcoap RFC7252 recovery/re-transmit logic will only work for confirmable requests or if RFC9177
       support is enabled for non-confirmable large body transmissions that need to span multiple packets.

       To see what is happening (other than by sniffing the network traffic), the logging level needs to be set
       to COAP_LOG_DEBUG in the client by using <b>coap_set_log_level</b>(COAP_LOG_DEBUG) and
       <b>coap_dtls_set_log_level</b>(COAP_LOG_DEBUG).

       The server can either be stopped, or if packet loss levels are set to 100% by using
       <b>coap_debug_set_packet_loss</b>("100%") when receiving the client requests.

       <b>NOTE:</b> If the server end of the connection is returning ICMP unreachable packets after being turned off,
       you will get a debug message of the form "coap_network_read: unreachable", so libcoap will stop doing the
       retries. If this is the case, then you need to make use of (on the server)
       <b>coap_debug_set_packet_loss</b>("100%") or put in some packet filtering to drop the packets.

       For confirmable transmissions, the client should then restart transmitting the requests based on the
       ack_timeout, ack_random_factor and max_retransmit values. The client’s nack_handler will get called with
       COAP_NACK_TOO_MANY_RETRIES when the confirmable request cannot be successfully transmitted.

       For non-confirmable block transmissions (RFC9177 enabled), the client should then restart transmitting
       the missing requests based on the max_payloads, non_timeout, non_receive_timeout, and non_max_retransmit
       values. The client’s nack_handler will get called with COAP_NACK_TOO_MANY_RETRIES when the
       non-confirmable large body request cannot be successfully transmitted.

</pre><h4><b>FURTHER</b> <b>INFORMATION</b></h4><pre>
       See

       "RFC7252: The Constrained Application Protocol (CoAP)"

       "RFC9177: Constrained Application Protocol (CoAP) Block-Wise Transfer Options Supporting Robust
       Transmission"

       for further information.

</pre><h4><b>BUGS</b></h4><pre>
       Please report bugs on the mailing list for libcoap: <a href="mailto:libcoap-developers@lists.sourceforge.net">libcoap-developers@lists.sourceforge.net</a> or raise an
       issue on GitHub at https://github.com/obgm/libcoap/issues

</pre><h4><b>AUTHORS</b></h4><pre>
       The libcoap project &lt;<a href="mailto:libcoap-developers@lists.sourceforge.net">libcoap-developers@lists.sourceforge.net</a>&gt;

coap_recovery 4.3.4                                04/15/2024                                   <u><a href="../man3/COAP_RECOVERY.3.html">COAP_RECOVERY</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>