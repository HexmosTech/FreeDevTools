<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>switched - switch/option management.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/tcllib">tcllib_2.0+dfsg-4_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       switched - switch/option management.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       package require <b>Tcl</b> <b>8.5</b> <b>9</b>

       package require <b>switched</b> <b>?2.2.2?</b>

       <b>&lt;switched&gt;</b> <b>complete</b> <u>this</u>

       <b>&lt;switched&gt;</b> <b>options</b> <u>this</u>

       <b>&lt;switched&gt;</b> <b>set-option</b> <u>this</u> <u>value</u>

________________________________________________________________________________________________________________

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>switched</b>  class serves as base class for user classes with switch / option configuration procedures.
       It provides facilities for managing options through a simple interface.

       For example:

              set vehicle [new car -length 4.5 -width 2 -power 100 -fuel diesel]
              puts "my car was running on [switched::cget $vehicle -fuel]"
              switched::configure $vehicle -power 40 -fuel electricity
              puts "but is now running on clean [switched::cget $vehicle -fuel]"

       Of course, as you might have guessed, the <b>car</b> class is derived from the <b>switched</b> class. Let us see how it
       works:

              class car {
                  proc car {this args} switched {$args} {
                      # car specific initialization code here
                      switched::complete $this
                  }
                  ...
              }

       The switched class constructor takes the optional configuration option / value pairs as parameters.   The
       switched class layer then completely manages the switched options: it checks their validity, stores their
       values and provides a clean interface to the user layer configuration setting procedures.

       The switched class members available to the programmer are:

       <b>&lt;switched&gt;</b> <b>complete</b> <u>this</u>
              This  procedure  is  used  to  tell the switched layer that the derived class object (a car in the
              examples) is completely built.  At that time, the initial configuration  of  the  switched  object
              occurs,  using default option values (see procedure <b>options</b>) eventually overridden by construction
              time values, passed at the time of the <b>new</b> operator invocation.  This  procedure  must  be  called
              only  once,  usually around or at the end of the derived class constructor.  (<u>Note</u>: Also check the
              <b>complete</b> data member later in this chapter).

       <b>&lt;switched&gt;</b> <b>options</b> <u>this</u>
              This procedure must return the configuration description for <u>all</u> options that the switched  object
              will  accept.  It is a pure virtual member procedure and therefore its implementation is <u>mandatory</u>
              in the derived class layer.  The procedure must return a list of lists.  Each list pertains  to  a
              single option and is composed of the switch name, the default value for the option and an optional
              initial value.  For example:

              class car {
                  ...
                  proc options {this} {
                      return [list [list -fuel petrol petrol] [list -length {} {}] [list -power {} {}] [list -width {} {}] ]
                  }
                  proc set-fuel {this value} {
                      ...
                  }
                  ...
              }

       In this case, 4 options are specified: <b>fuel</b>, <b>length</b>, <b>power</b> and <b>width</b>.  The default and initial values for
       the <b>fuel</b> option are identical and set to <b>petrol</b>.  For the other options, values are all empty.

       For  each  option, there must be a corresponding <b>set-option</b> procedure defined in the derived class layer.
       For example, since we defined a <b>fuel</b> option, there is  a  <b>set-fuel</b>  procedure  in  the  car  class.   The
       parameters  always  are  the  object  identifier  (since  this  is  not  a static procedure, but rather a
       dynamically defined virtual one), followed by the new value for the option.  A  <b>set-option</b>  procedure  is
       only  invoked if the new value differs from the current one (a caching scheme for improving performance),
       or if there is no initial value set in the <b>options</b> procedure for that option.

       In this procedure, if the initial value differs from the  default  value  or  is  omitted,  then  initial
       configuration  is  forced  and the corresponding <b>set-option</b> procedure is invoked by the switched <b>complete</b>
       procedure located at the end of the derived class constructor.  For example:

              class car {
                  ...
                  proc options {this} {
                      return [list [list -fuel petrol] [list -length {} {}] [list -power 100 50] [list -width {} {}] ]
                  }
                  ...
              }

              In this case, configuration is forced on the <b>fuel</b> and <b>power</b> options,  that  is  the  corresponding
              <b>set-option</b>  procedures  will  be  invoked  when the switched object is constructed (see <b>set-option</b>
              procedures documentation below).

              For the <b>fuel</b> option, since there is no initial value, the <b>set-fuel</b> procedure is  called  with  the
              default  value  (<b>petrol</b>)  as argument.  For the <b>power</b> option, since the initial value differs from
              the default value, the <b>set-power</b> procedure is called with the initial value as argument (<b>50</b>).

              For the other options, since the initial values (last elements of the option lists) are  identical
              to  their  default  values, the corresponding <b>set-option</b> procedures will not be invoked. It is the
              programmer's responsibility to insure that the initial option values are correct.

       <b>&lt;switched&gt;</b> <b>set-option</b> <u>this</u> <u>value</u>
              These procedures may be viewed as dynamic virtual functions.  There must be one implementation per
              supported option, as returned by the <b>options</b> procedure.  For example:

              class car {
                  ...
                  proc options {this} {
                      return [list ...
                          [list -width {} {}] ]
                  }
                  ...
                  proc set-width {this value} {
                      ...
                  }
                  ...
              }

              Since the <b>-width</b> option was listed in the <b>options</b> procedure, a <b>set-width</b> procedure  implementation
              is provided, which of course would proceed to set the width of the car (and would modify the looks
              of a graphical representation, for example).

              As  you  add  a  supported <b>option</b> in the list returned by the <b>options</b> procedure, the corresponding
              <b>set-option</b> procedure may be called as soon as the switched object is complete, which  occurs  when
              the switched level <b>complete</b> procedure is invoked.  For example:

              class car {
                  proc car {this args} switched {args} {
                      ...
                      switched::complete $this
                 }
                  ...
                  proc options {this} {
                      return [list [list -fuel petrol] [list -length 4.5] [list -power 350] [list -width 1.8] ]
                  }
                  proc set-fuel {this value} {
                      ...
                  }
                  proc set-length {this value} {
                      ...
                  }
                  proc set-power {this value} {
                      ...
                  }
                  proc set-width {this value} {
                      ...
                  }
              }

              new car

       In  this case, a new car is created with no options, which causes the car constructor to be called, which
       in turns calls  the  switched  level  <b>complete</b>  procedure  after  the  car  object  layer  is  completely
       initialized.   At  this  point,  since  there  are  no  initial  values in any option list in the options
       procedure, the <b>set-fuel</b> procedure is called with its default value of <b>petrol</b> as  parameter,  followed  by
       the  <b>set-length</b>  call  with  <b>4.5</b>  value,  <b>set-power</b> with <b>350</b> value and finally with <b>set-width</b> with <b>1.8</b> as
       parameter.  This is a good way to test the <b>set-option</b> procedures when  debugging,  and  when  done,  just
       fill-in the initial option values.

       The  switched  layer  checks  that  an  option  is  valid  (that is, listed in the <b>options</b> procedure) but
       obviously does not check the validity of the value passed to the <b>set-option</b> procedure, which should throw
       an error (for example by using the Tcl error command) if the value is invalid.

       The switched layer also keeps track of the options current values, so  that  a  <b>set-option</b>  procedure  is
       called  only  when the corresponding option value passed as parameter is different from the current value
       (see <b>-option</b> data members description).

       <b>-option</b>

              The <b>-option</b> data member is an options current value.  There is one for each option listed  in  the
              options  procedure. It is a read-only value which the switched layer checks against when an option
              is changed.  It is rarely used at the layer derived from switched, except in the few  cases,  such
              as in the following example:

              ...
              proc car::options {this} {
                  return {
                      ...
                      {-manufacturer {} {}}
                      ...
                  }
              }

              proc car::set-manufacturer {this value} {}

              proc car::printData {this} {
                  puts "manufacturer: $switched::($this,-manufacturer)"
                  ...
              }

       In  this  case,  the  manufacturer's  name  is  stored  at the switched layer level (this is why the set-
       manufacturer procedure has nothing to do) and later retrieved in the printData procedure.

       <b>complete</b>

              The <b>complete</b> data member (not to be confused with the  <b>complete</b>  procedure)  is  a  boolean.   Its
              initial  value  is <b>false</b> and it is set to <b>true</b> at the very end of the switched <b>complete</b> procedure.
              It becomes useful when some options should be set at construction time only and  not  dynamically,
              as the following example shows:

              proc car::set-width {this value} {
                  if {$switched::($this,complete)} {
                      error {option -width cannot be set dynamically}
                  }
                  ...
              }

</pre><h4><b>BUGS,</b> <b>IDEAS,</b> <b>FEEDBACK</b></h4><pre>
       This  document,  and  the package it describes, will undoubtedly contain bugs and other problems.  Please
       report such in the category <u>stooop</u> of the <u>Tcllib</u> <u>Trackers</u> [<a href="http://core.tcl.tk/tcllib/reportlist">http://core.tcl.tk/tcllib/reportlist</a>].  Please
       also report any ideas for enhancements you may have for either package and/or documentation.

       When proposing code changes, please provide <u>unified</u> <u>diffs</u>, i.e the output of <b>diff</b> <b>-u</b>.

       Note further that <u>attachments</u> are strongly preferred over inlined patches. Attachments  can  be  made  by
       going  to the <b>Edit</b> form of the ticket immediately after its creation, and then using the left-most button
       in the secondary navigation bar.

</pre><h4><b>KEYWORDS</b></h4><pre>
       C++, class, object, object oriented

</pre><h4><b>CATEGORY</b></h4><pre>
       Programming tools

tcllib                                                2.2.2                                       <u><a href="../man3tcl/switched.3tcl.html">switched</a></u>(3tcl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>