<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-posix-dev">manpages-posix-dev_2017a-2_all</a> <br><br><pre>
</pre><h4><b>PROLOG</b></h4><pre>
       This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface
       may differ (consult the corresponding Linux manual page for details of Linux behavior), or the  interface
       may not be implemented on Linux.

</pre><h4><b>NAME</b></h4><pre>
       pthread_setcancelstate, pthread_setcanceltype, pthread_testcancel — set cancelability state

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;<a href="file:/usr/include/pthread.h">pthread.h</a>&gt;

       int pthread_setcancelstate(int <u>state</u>, int *<u>oldstate</u>);
       int pthread_setcanceltype(int <u>type</u>, int *<u>oldtype</u>);
       void pthread_testcancel(void);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <u>pthread_setcancelstate</u>() function shall atomically both set the calling thread's cancelability state
       to the indicated <u>state</u> and return  the  previous  cancelability  state  at  the  location  referenced  by
       <u>oldstate</u>.  Legal values for <u>state</u> are PTHREAD_CANCEL_ENABLE and PTHREAD_CANCEL_DISABLE.

       The <u>pthread_setcanceltype</u>() function shall atomically both set the calling thread's cancelability type to
       the  indicated  <u>type</u>  and  return  the previous cancelability type at the location referenced by <u>oldtype</u>.
       Legal values for <u>type</u> are PTHREAD_CANCEL_DEFERRED and PTHREAD_CANCEL_ASYNCHRONOUS.

       The cancelability state and type of any newly created threads, including the thread in which  <u>main</u>()  was
       first invoked, shall be PTHREAD_CANCEL_ENABLE and PTHREAD_CANCEL_DEFERRED respectively.

       The  <u>pthread_testcancel</u>()  function  shall  create  a  cancellation  point  in  the  calling  thread. The
       <u>pthread_testcancel</u>() function shall have no effect if cancelability is disabled.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       If successful, the <u>pthread_setcancelstate</u>() and  <u>pthread_setcanceltype</u>()  functions  shall  return  zero;
       otherwise, an error number shall be returned to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       The <u>pthread_setcancelstate</u>() function may fail if:

       <b>EINVAL</b> The specified state is not PTHREAD_CANCEL_ENABLE or PTHREAD_CANCEL_DISABLE.

       The <u>pthread_setcanceltype</u>() function may fail if:

       <b>EINVAL</b> The specified type is not PTHREAD_CANCEL_DEFERRED or PTHREAD_CANCEL_ASYNCHRONOUS.

       These functions shall not return an error code of <b>[EINTR]</b>.

       <u>The</u> <u>following</u> <u>sections</u> <u>are</u> <u>informative.</u>

</pre><h4><b>EXAMPLES</b></h4><pre>
       None.

</pre><h4><b>APPLICATION</b> <b>USAGE</b></h4><pre>
       In  order  to  write  a  signal  handler for an asynchronous signal which can run safely in a cancellable
       thread, <u>pthread_setcancelstate</u>() must be used to disable cancellation for the duration of any calls  that
       the  signal  handler  makes which are cancellation points. However, the standard does not permit strictly
       conforming applications to call <u>pthread_setcancelstate</u>() from a signal handler since it is not  currently
       required  to be async-signal-safe. On implementations where <u>pthread_setcancelstate</u>() is not async-signal-
       safe, alternatives are to ensure either that the corresponding signals are blocked  during  execution  of
       functions that are not async-cancel-safe or that cancellation is disabled during times when those signals
       could  be  delivered.  Implementations  are  strongly  encouraged to make <u>pthread_setcancelstate</u>() async-
       signal-safe.

</pre><h4><b>RATIONALE</b></h4><pre>
       The <u>pthread_setcancelstate</u>() and <u>pthread_setcanceltype</u>() functions control the points at which  a  thread
       may be asynchronously canceled. For cancellation control to be usable in modular fashion, some rules need
       to be followed.

       An  object  can be considered to be a generalization of a procedure. It is a set of procedures and global
       variables written as a unit and called by clients not known by the object. Objects may  depend  on  other
       objects.

       First,  cancelability  should  only  be disabled on entry to an object, never explicitly enabled. On exit
       from an object, the cancelability state should always be restored to its value on entry to the object.

       This follows from a modularity argument: if the client of an object (or the client of an object that uses
       that object) has disabled cancelability, it is because the client does not want  to  be  concerned  about
       cleaning up if the thread is canceled while executing some sequence of actions. If an object is called in
       such a state and it enables cancelability and a cancellation request is pending for that thread, then the
       thread is canceled, contrary to the wish of the client that disabled.

       Second,  the cancelability type may be explicitly set to either <u>deferred</u> or <u>asynchronous</u> upon entry to an
       object. But as with the cancelability state, on exit from an object the cancelability type should  always
       be restored to its value on entry to the object.

       Finally,  only  functions  that  are  cancel-safe  may  be  called  from  a thread that is asynchronously
       cancelable.

</pre><h4><b>FUTURE</b> <b>DIRECTIONS</b></h4><pre>
       The <u>pthread_setcancelstate</u>() function may be added to the table of async-signal-safe functions in <u>Section</u>
       <u>2.4.3</u>, <u>Signal</u> <u>Actions</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>pthread_cancel</u>()

       The Base Definitions volume of POSIX.1‐2017, <b>&lt;pthread.h&gt;</b>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1-2017, Standard
       for Information  Technology  --  Portable  Operating  System  Interface  (POSIX),  The  Open  Group  Base
       Specifications  Issue  7, 2018 Edition, Copyright (C) 2018 by the Institute of Electrical and Electronics
       Engineers, Inc and The Open Group.  In the event of any discrepancy between this version and the original
       IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee  document.
       The original Standard can be obtained online at <a href="http://www.opengroup.org/unix/online.html">http://www.opengroup.org/unix/online.html</a> .

       Any  typographical  or formatting errors that appear in this page are most likely to have been introduced
       during  the  conversion  of  the  source  files  to  man  page  format.  To  report  such   errors,   see
       https://www.kernel.org/doc/man-pages/reporting_bugs.html .

IEEE/The Open Group                                   2017                        <u><a href="../man3POSIX/PTHREAD_SETCANCELSTATE.3POSIX.html">PTHREAD_SETCANCELSTATE</a></u>(3POSIX)
</pre>
 </div>
</div></section>
</div>
</body>
</html>