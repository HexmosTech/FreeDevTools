<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tracecmd_open, tracecmd_open_fd, tracecmd_open_head, tracecmd_init_data, tracecmd_close,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/trace-cmd">trace-cmd_3.3.1-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tracecmd_open, tracecmd_open_fd, tracecmd_open_head, tracecmd_init_data, tracecmd_close,
       tracecmd_set_private, tracecmd_get_private - Open and close a trace file.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;trace-cmd.h&gt;</b>

       struct tracecmd_input *<b>tracecmd_open</b>(const char *<u>file</u>, int <u>flags</u>);
       struct tracecmd_input *<b>tracecmd_open_fd</b>(int <u>fd</u>, int <u>flags</u>);
       struct tracecmd_input *<b>tracecmd_open_head</b>(const char *<u>file</u>, int <u>flags</u>);
       int <b>tracecmd_init_data</b>(struct tracecmd_input *<u>handle</u>);
       void <b>tracecmd_close</b>(struct tracecmd_input *<u>handle</u>);
       void <b>tracecmd_set_private</b>(struct tracecmd_input *<u>handle</u>, void *<u>data</u>);
       void *<b>tracecmd_get_private</b>(struct tracecmd_input *<u>handle</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This set of APIs can be used to open and close a trace file recorded by <b><a href="../man1/trace-cmd.1.html">trace-cmd</a>(1)</b> and containing
       tracing information from ftrace, the official Linux kernel tracer. The opened file is represented by a
       <u>tracecmd_input</u> structure, all other library APIs that work with the file require a pointer to the
       structure. The APIs for opening a trace file have a <u>flag</u> input parameter, which controls how the file
       will be opened and parsed. The <u>flag</u> is a combination of these options:

           TRACECMD_FL_LOAD_NO_PLUGINS - Do not load any plugins
           TRACECMD_FL_LOAD_NO_SYSTEM_PLUGINS - Do not load system wide plugins, load only "local only"
                                                  plugins from user's home directory.

       The <b>tracecmd_open()</b> function opens a given trace <u>file</u>, parses the metadata headers from the file,
       allocates and initializes а <u>tracecmd_input</u> handler structure representing the file. It also initializes
       the handler for reading trace data from the file. The returned handler is ready to be used with
       <u>tracecmd_read</u><b>_</b> APIs.

       The <b>tracecmd_open_fd()</b> function does the same as <b>tracecmd_open()</b>, but works with a file descriptor to a
       trace file, opened for reading.

       The <b>tracecmd_open_head()</b> function is the same as <b>tracecmd_open()</b>, but does not initialize the handler for
       reading trace data. It reads and parses the metadata headers only. The <b>tracecmd_init_data()</b> should be
       used before using the <u>tracecmd_read</u><b>_</b> APIs.

       The <b>tracecmd_init_data()</b> function initializes a <u>handle</u>, allocated with <b>tracecmd_open_head()</b>, for reading
       trace data from the file associated with it. This API must be called before any of the <u>tracecmd_read</u><b>_</b>
       APIs.

       The <b>tracecmd_close()</b> function frees a <u>handle</u>, pointer to tracecmd_input structure, previously allocated
       with <b>tracecmd_open()</b>, <b>tracecmd_open_fd()</b> or <b>tracecmd_open_head()</b> APIs.

       The <b>tracecmd_set_private()</b> function allows to add specific <u>data</u> to the <u>handle</u> that can be retrieved
       later.

       The <b>tracecmd_get_private()</b> function will retrieve the <u>data</u> set by <b>tracecmd_set_private()</b> for the given
       <u>handle</u>.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       The <b>tracecmd_open()</b>, <b>tracecmd_open_fd()</b> and <b>tracecmd_open_head()</b> functions return a pointer to
       tracecmd_input structure or NULL in case of an error. The returned structure must be free with
       <b>tracecmd_close()</b>. Note that if <b>tracecmd_open_fd()</b> is used to allocate a tracecmd_input handler, when
       <b>tracecmd_close()</b> is called to close it, that fd will be closed also.

       The <b>tracecmd_init_data()</b> function returns -1 in case of an error or 0 otherwise.

       The <b>tracecmd_get_private()</b> returns the <u>data</u> set by <b>tracecmd_set_private()</b>.

</pre><h4><b>EXAMPLE</b></h4><pre>
           The are two different use patterns for opening and reading trace data from
           a trace file, which can be used depending on the use case.

           1. Open and initialise the trace file in а single step:

           #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
           #include &lt;trace-cmd.h&gt;

           static int print_events(struct tracecmd_input *handle, struct tep_record *record, int cpu, void *data)
           {
                   static struct trace_seq seq;
                   struct tep_handle *tep = tracecmd_get_tep(handle);
                   const char *file = tracecmd_get_private(handle);

                   if (!seq.buffer)
                           trace_seq_init(&amp;seq);

                   trace_seq_reset(&amp;seq);
                   trace_seq_printf(&amp;seq, "%s: ", file);
                   tep_print_event(tep, &amp;seq, record, "%6.1000d [%03d] %s-%d %s: %s\n",
                                   TEP_PRINT_TIME, TEP_PRINT_CPU, TEP_PRINT_COMM, TEP_PRINT_PID,
                                   TEP_PRINT_NAME, TEP_PRINT_INFO);
                   trace_seq_terminate(&amp;seq);
                   trace_seq_do_printf(&amp;seq);
                   return 0;
           }

           int main(int argc, char **argv)
           {
                   struct tracecmd_input *handle;

                   if (argc &lt; 2) {
                           printf("usage: %s trace.dat\n", argv[0]);
                           exit(-1);
                   }

                   handle = tracecmd_open(argv[i], 0);
                   if (!handle)
                           exit(-1);

                   tracecmd_set_private(handles[nr_handles], argv[i]);
                   tracecmd_iterate_events(handles, NULL, 0, print_events, NULL);

                   tracecmd_close(handle);
           }

           2. Open and initialise the trace file in two steps. This allows to perform
           some processing based on metadata, read from the file, before initialising
           the trace data for reading. Example for such use case is when opening multiple
           trace files recorded in a same trace session. In that case timestamps of all
           trace events must be adjusted based on the information from  the file's metadata
           and before reading the trace data.

           #include &lt;trace-cmd.h&gt;
           ...
           struct tracecmd_input *handle = tracecmd_open_head("trace.dat");
                   if (!handle) {
                           /* Failed to open trace.dat file */
                   }
           ...
                   /* do some processing, before initialising the trace data for reading */
           ...
                   if (tracecmd_init_data(handle) &lt; 0) {
                           /* Failed to initialize hadle for reading the trace data */
                   }
           ...
                   /* Read tracing data from the file, using the handle */
           ...
                   tracecmd_close(handle);
           ...

</pre><h4><b>FILES</b></h4><pre>
           <b>trace-cmd.h</b>
                   Header file to include in order to have access to the library APIs.
           <b>-ltracecmd</b>
                   Linker switch to add when building a program that uses the library.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/libtracefs.3.html">libtracefs</a>(3)</b>, <b><a href="../man3/libtraceevent.3.html">libtraceevent</a>(3)</b>, <b><a href="../man1/trace-cmd.1.html">trace-cmd</a>(1)</b> <b><a href="../man5/trace-cmd.dat.5.html">trace-cmd.dat</a>(5)</b>

</pre><h4><b>AUTHOR</b></h4><pre>
           <b>Steven</b> <b>Rostedt</b> &lt;<b><a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a></b>[1]&gt;
           <b>Tzvetomir</b> <b>Stoyanov</b> &lt;<b><a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a></b>[2]&gt;

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;<b><a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a></b>[3]&gt;

</pre><h4><b>LICENSE</b></h4><pre>
       libtracecmd is Free Software licensed under the GNU LGPL 2.1

</pre><h4><b>RESOURCES</b></h4><pre>
       <b>https://git.kernel.org/pub/scm/utils/trace-cmd/trace-cmd.git/</b>

</pre><h4><b>COPYING</b></h4><pre>
       Copyright (C) 2020 VMware, Inc. Free use of this software is granted under the terms of the GNU Public
       License (GPL).

</pre><h4><b>NOTES</b></h4><pre>
        1. <a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a>
           <a href="mailto:rostedt@goodmis.org">mailto:rostedt@goodmis.org</a>

        2. <a href="mailto:tz.stoyanov@gmail.com">tz.stoyanov@gmail.com</a>
           <a href="mailto:tz.stoyanov@gmail.com">mailto:tz.stoyanov@gmail.com</a>

        3. <a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a>
           <a href="mailto:linux-trace-devel@vger.kernel.org">mailto:linux-trace-devel@vger.kernel.org</a>

libtracefs                                         06/23/2025                                     <u><a href="../man3/LIBTRACECMD.3.html">LIBTRACECMD</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>