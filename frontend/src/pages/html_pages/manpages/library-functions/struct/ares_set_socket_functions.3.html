<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ares_set_socket_functions, ares_set_socket_functions_ex - Set socket io callbacks</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libc-ares-dev">libc-ares-dev_1.34.5-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ares_set_socket_functions, ares_set_socket_functions_ex - Set socket io callbacks

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;ares.h&gt;

       typedef enum {
         ARES_SOCKFUNC_FLAG_NONBLOCKING = 1 &lt;&lt; 0
       } ares_sockfunc_flags_t;

       typedef enum {
         ARES_SOCKET_OPT_SENDBUF_SIZE,
         ARES_SOCKET_OPT_RECVBUF_SIZE,
         ARES_SOCKET_OPT_BIND_DEVICE,
         ARES_SOCKET_OPT_TCP_FASTOPEN
       } ares_socket_opt_t;

       typedef enum {
         ARES_SOCKET_CONN_TCP_FASTOPEN = 1 &lt;&lt; 0
       } ares_socket_connect_flags_t;

       typedef enum {
         ARES_SOCKET_BIND_TCP = 1 &lt;&lt; 0,
         ARES_SOCKET_BIND_CLIENT = 1 &lt;&lt; 1
       } ares_socket_bind_flags_t;

       struct ares_socket_functions_ex {
         unsigned int version; /* ABI Version: must be "1" */
         unsigned int flags;

         ares_socket_t (*asocket)(int domain, int type, int protocol, void *user_data);
         int (*aclose)(ares_socket_t sock, void *user_data);
         int (*asetsockopt)(ares_socket_t sock, ares_socket_opt_t opt, const void *val,
                            ares_socklen_t val_size, void *user_data);
         int (*aconnect)(ares_socket_t sock, const struct sockaddr *address,
                         ares_socklen_t address_len, unsigned int flags,
                         void *user_data);
         ares_ssize_t (*arecvfrom)(ares_socket_t sock, void *buffer, size_t length,
                                   int flags, struct sockaddr *address,
                                   ares_socklen_t *address_len, void *user_data);
         ares_ssize_t (*asendto)(ares_socket_t sock, const void *buffer, size_t length,
                                 int flags, const struct sockaddr *address,
                                 ares_socklen_t address_len, void *user_data);
         int (*agetsockname)(ares_socket_t sock, struct sockaddr *address,
                             ares_socklen_t *address_len, void *user_data);
         int (*abind)(ares_socket_t sock, unsigned int flags,
                      const struct sockaddr *address, socklen_t address_len,
                      void *user_data);
         unsigned int (*aif_nametoindex)(const char *ifname, void *user_data);
         const char *(*aif_indextoname)(unsigned int ifindex, char *ifname_buf,
                                        size_t ifname_buf_len, void *user_data);
       };

       ares_status_t ares_set_socket_functions_ex(ares_channel_t *channel,
         const struct ares_socket_functions_ex *funcs, void *user_data);

       struct ares_socket_functions {
           ares_socket_t (*<u>asocket</u>)(int, int, int, void *);
           int (*<u>aclose</u>)(ares_socket_t, void *);
           int (*<u>aconnect</u>)(ares_socket_t, const struct sockaddr *, ares_socklen_t, void *);
           ares_ssize_t (*<u>arecvfrom</u>)(ares_socket_t, void *, size_t, int,
                                     struct sockaddr *, ares_socklen_t *, void *);
           ares_ssize_t (*<u>asendv</u>)(ares_socket_t, const struct iovec *, int, void *);
       };

       void ares_set_socket_functions(ares_channel_t *<u>channel</u>,
                                      const struct ares_socket_functions * <u>functions</u>,
                                      void *<u>user_data</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b><a href="../man3/ares_set_socket_functions_ex.3.html">ares_set_socket_functions_ex</a>(3)</b>  sets  a  set  of  callback  <u>functions</u>  in the given ares channel handle.
       Cannot be used when <b>ARES_OPT_EVENT_THREAD</b> is passed to <u><a href="../man3/ares_init_options.3.html">ares_init_options</a>(3)</u>.  This function replaces  the
       now deprecated <b><a href="../man3/ares_set_socket_functions.3.html">ares_set_socket_functions</a>(3)</b> call.

       These  callback functions will be invoked to create/destroy socket objects and perform io, instead of the
       normal system calls. A client application can  override  normal  network  operation  fully  through  this
       functionality, and provide its own transport layer.

       Some  callbacks may be optional and are documented as such below, but failing to implement such callbacks
       will disable certain features within c-ares.  It is strongly recommended to implement all callbacks.

       All callback functions are expected to operate like their system equivalents,  and  to  set  <b><a href="../man2/errno.2.html">errno</a>(2)</b>  or
       <b><a href="../man2/WSASetLastError.2.html">WSASetLastError</a>(2)</b>  to an appropriate error code on failure. It is strongly recommended that io callbacks
       are implemented to be asynchronous and indicated as such in the  <u>flags</u>  member.   The  io  callbacks  can
       return error codes of <b>EAGAIN</b>, <b>EWOULDBLOCK</b>, or <b>WSAEWOULDBLOCK</b> when they would otherwise block.

       The <u>user_data</u> value is provided to each callback function invocation to serve as context.

       The <b><a href="../man3/ares_set_socket_functions_ex.3.html">ares_set_socket_functions_ex</a>(3)</b> must provide the following structure members and callbacks (which are
       different from the <b><a href="../man3/ares_set_socket_functions.3.html">ares_set_socket_functions</a>(3)</b> members and callbacks):

           <b>unsigned</b> <b>int</b> <u>version</u>
                   ABI Version of structure.  Must be set to a value of "1".

           <b>unsigned</b> <b>int</b> <u>flags</u>
                   Flags available are specified in <u>ares_sockfunc_flags_t</u>.

           <b>ares_socket_t</b> <b>(*</b><u>asocket</u><b>)(int</b> <u>domain</u><b>,</b> <b>int</b> <u>type</u><b>,</b> <b>int</b> <u>protocol</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   <u>REQUIRED</u>.  Creates  an endpoint for communication and returns a descriptor. <u>domain</u>, <u>type</u>, and
                   <u>protocol</u> each correspond to the parameters of  <b><a href="../man2/socket.2.html">socket</a>(2)</b>.  Returns  a  handle  to  the  newly
                   created socket, or <b>ARES_SOCKET_BAD</b> on error.

           <b>int</b> <b>(*</b><u>aclose</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   <u>REQUIRED</u>. Closes the socket endpoint indicated by <u>fd</u>. See <b><a href="../man2/close.2.html">close</a>(2)</b>.

           <b>int</b> <b>(*</b><u>asetsockopt</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>ares_socket_opt_t</b> <u>opt</u><b>,</b> <b>const</b> <b>void</b> <b>*</b> <u>val</u><b>,</b> <b>ares_socklen_t</b>
           <u>val_size</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   <u>REQUIRED</u>.  Set  socket  option.   This shares a similar syntax to the BSD <u><a href="../man2/setsockopt.2.html">setsockopt</a>(2)</u> call,
                   however c-ares uses different options for portability. The value is a pointer to the  desired
                   value,  and  each  option  has  its  own  data  type  listed  in the options below defined in
                   <u>ares_socket_opt_t</u>.

           <b>int</b> <b>(*</b><u>aconnect</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>const</b> <b>struct</b> <b>sockaddr</b> <b>*</b> <u>addr</u><b>,</b> <b>ares_socklen_t</b> <u>addr_len</u><b>,</b> <b>unsigned</b> <b>int</b>
           <u>flags</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   <u>REQUIRED</u>. Initiate a connection to the address indicated by  <u>addr</u>  on  a  socket.  Additional
                   flags controlling behavior are in <u>ares_socket_connect_flags_t</u>. See <b><a href="../man2/connect.2.html">connect</a>(2)</b>.

           <b>ares_ssize_t</b> <b>(*</b><u>arecvfrom</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>void</b> <b>*</b> <u>buffer</u><b>,</b> <b>size_t</b> <u>buf_size</u><b>,</b> <b>int</b> <u>flags</u><b>,</b> <b>struct</b>
           <b>sockaddr</b> <b>*</b> <u>addr</u><b>,</b> <b>ares_socklen_t</b> <b>*</b> <u>addr_len</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   <u>REQUIRED</u>.  Receives  data from remote socket endpoint, if available. If the <u>addr</u> parameter is
                   not NULL and the connection protocol provides the source address, the  callback  should  fill
                   this in. The <u>flags</u> parameter is currently unused. See <b><a href="../man2/recvfrom.2.html">recvfrom</a>(2)</b>.

           <b>ares_ssize_t</b> <b>(*</b><u>asendto</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>const</b> <b>void</b> <b>*</b> <u>buffer</u><b>,</b> <b>size_t</b> <u>length</u><b>,</b> <b>int</b> <u>flags</u><b>,</b> <b>const</b> <b>struct</b>
           <b>sockaddr</b> <b>*</b> <u>address</u><b>,</b> <b>ares_socklen_t</b> <u>address_len</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   <u>REQUIRED</u>.  Send data, as provided by the <u>buffer</u>, to the socket endpoint. The <u>flags</u> member may
                   be used on systems that have <b>MSG_NOSIGNAL</b> defined but is otherwise  unused.   An  <u>address</u>  is
                   provided  primarily  to  support  TCP  FastOpen  scenarios,  which  will  be  NULL  in  other
                   circumstances. See <b><a href="../man2/sendto.2.html">sendto</a>(2)</b>.

           <b>int</b> <b>(*</b><u>agetsockname</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>struct</b> <b>sockaddr</b> <b>*</b> <u>address</u><b>,</b> <b>ares_socklen_t</b> <b>*</b> <u>address_len</u><b>,</b> <b>void</b> <b>*</b>
           <u>user_data</u><b>)</b>
                   <u>Optional</u>. Retrieve the local address of a socket and  store  it  into  the  provided  <u>address</u>
                   buffer. May impact DNS Cookies if not provided. See <b><a href="../man2/getsockname.2.html">getsockname</a>(2)</b>.

           <b>int</b> <b>(*</b><u>abind</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>unsigned</b> <b>int</b> <u>flags</u><b>,</b> <b>const</b> <b>struct</b> <b>sockaddr</b> <b>*</b> <u>address</u><b>,</b> <b>ares_socklen_t</b>
           <u>address_len</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   <u>Optional</u>. Bind the socket to an address.  This can be used for client connections to bind the
                   source  address  for  packets before connect, or for server connections to bind to an address
                   and port before listening.  Currently c-ares only supports client  connections.   <u>flags</u>  from
                   <u>ares_socket_bind_flags_t</u> can be specified.  See <b><a href="../man2/bind.2.html">bind</a>(2)</b>.

           <b>unsigned</b> <b>int</b> <b>(*</b><u>aif_nametoindex</u><b>)(const</b> <b>char</b> <b>*</b> <u>ifname</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   <u>Optional</u>.  Convert  an  interface  name  into  the  interface index.  If this callback is not
                   specified, then IPv6 Link-Local DNS servers cannot be used.  See <b><a href="../man2/if_nametoindex.2.html">if_nametoindex</a>(2)</b>.

           <b>const</b> <b>char</b> <b>*</b> <b>(*</b><u>aif_indextoname</u><b>)(unsigned</b> <b>int</b> <u>ifindex</u><b>,</b> <b>char</b> <b>*</b> <u>ifname_buf</u><b>,</b> <b>size_t</b> <u>ifname_buf_len</u><b>,</b> <b>void</b>
           <b>*</b> <u>user_data</u><b>)</b>
                   <u>Optional</u>. Convert an interface index into the  interface  name.   If  this  callback  is  not
                   specified,  then  IPv6  Link-Local  DNS  servers cannot be used.  <u>ifname_buf</u> must be at least
                   <b>IF_NAMESIZE</b> or <b>IFNAMSIZ</b> in size.  See <b><a href="../man2/if_indextoname.2.html">if_indextoname</a>(2)</b>.

       <b>ares_sockfunc_flags_t</b> values:

           <u>ARES_SOCKFUNC_FLAG_NONBLOCKING</u>
                   Used to indicate the implementation of the io functions are asynchronous.

       <b>ares_socket_opt_t</b> values:

           <u>ARES_SOCKET_OPT_SENDBUF_SIZE</u>
                   Set the Send Buffer size.  Value is a pointer to an int. (SO_SNDBUF).

           <u>ARES_SOCKET_OPT_RECVBUF_SIZE</u>
                   Set the Receive Buffer size.  Value is a pointer to an int. (SO_RCVBUF).

           <u>ARES_SOCKET_OPT_BIND_DEVICE</u>
                   Set the network interface to use as the source  for  communication.  Value  is  a  C  string.
                   (SO_BINDTODEVICE)

           <u>ARES_SOCKET_OPT_TCP_FASTOPEN</u>
                   Enable TCP Fast Open.  Value is a pointer to an <u>ares_bool_t</u>.  On some systems this could be a
                   no-op if it is known it is on by default and return success.  Other systems may be a no-op if
                   known the system does not support the feature and returns failure with errno set to <b>ENOSYS</b> or
                   <b>WSASetLastError(WSAEOPNOTSUPP);</b>.

       <b>ares_socket_connect_flags_t</b> values:

           <u>ARES_SOCKET_CONN_TCP_FASTOPEN</u>
                   Connect using TCP Fast Open.

       <b>ares_socket_bind_flags_t</b> values:

           <u>ARES_SOCKET_BIND_TCP</u>
                   Bind is for a TCP connection.

           <u>ARES_SOCKET_BIND_CLIENT</u>
                              Bind is for a client connection, not server.

       <b><a href="../man3/ares_set_socket_functions.3.html">ares_set_socket_functions</a>(3)</b>  sets  a set of callback <u>functions</u> in the given ares channel handle.  Cannot
       be used when <b>ARES_OPT_EVENT_THREAD</b> is passed to <u><a href="../man3/ares_init_options.3.html">ares_init_options</a>(3)</u>.  This function is deprecated as  of
       c-ares 1.34.0 in favor of <u><a href="../man3/ares_set_socket_functions_ex.3.html">ares_set_socket_functions_ex</a>(3)</u>.

       <b><a href="../man3/ares_set_socket_functions.3.html">ares_set_socket_functions</a>(3)</b>  allows  you  to  choose to only implement some of the socket functions, and
       provide NULL to any others and c-ares will use its built-in system functions in that case.

       All callback functions are expected to operate like their system equivalents,  and  to  set  <b><a href="../man2/errno.2.html">errno</a>(2)</b>  or
       <b><a href="../man2/WSASetLastError.2.html">WSASetLastError</a>(2)</b>  to  an appropriate error code on failure. It is strongly recommended all io functions
       behave asynchronously and return error codes of <b>EAGAIN</b>, <b>EWOULDBLOCK</b>, or <b>WSAEWOULDBLOCK</b>  when  they  would
       otherwise block.

       The <u>user_data</u> value is provided to each callback function invocation to serve as context.

       The  <b><a href="../man3/ares_set_socket_functions.3.html">ares_set_socket_functions</a>(3)</b>  must  provide  the  following  callbacks (which are different from the
       <b><a href="../man3/ares_set_socket_functions_ex.3.html">ares_set_socket_functions_ex</a>(3)</b> callbacks):

           <b>ares_socket_t</b> <b>(*</b><u>asocket</u><b>)(int</b> <u>domain</u><b>,</b> <b>int</b> <u>type</u><b>,</b> <b>int</b> <u>protocol</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   Creates an endpoint for communication and returns a descriptor. <u>domain</u>,  <u>type</u>,  and  <u>protocol</u>
                   each  correspond to the parameters of <b><a href="../man2/socket.2.html">socket</a>(2)</b>. Returns ahandle to the newly created socket,
                   or ARES_SOCKET_BAD on error.

           <b>int</b> <b>(*</b><u>aclose</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   Closes the socket endpoint indicated by <u>fd</u>. See <b><a href="../man2/close.2.html">close</a>(2)</b>.

           <b>int</b> <b>(*</b><u>aconnect</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>const</b> <b>struct</b> <b>sockaddr</b> <b>*</b> <u>addr</u><b>,</b> <b>ares_socklen_t</b> <u>addr_len</u><b>,</b> <b>void</b> <b>*</b>
           <u>user_data</u><b>)</b>
                   Initiate a connection to the address indicated by <u>addr</u> on a socket. See <b><a href="../man2/connect.2.html">connect</a>(2)</b>

           <b>ares_ssize_t</b> <b>(*</b><u>arecvfrom</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>void</b> <b>*</b> <u>buffer</u><b>,</b> <b>size_t</b> <u>buf_size</u><b>,</b> <b>int</b> <u>flags</u><b>,</b> <b>struct</b>
           <b>sockaddr</b> <b>*</b> <u>addr</u><b>,</b> <b>ares_socklen_t</b> <b>*</b> <u>addr_len</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   Receives data from remote socket endpoint, if available. If the <u>addr</u> parameter  is  not  NULL
                   and  the  connection  protocol provides the source address, the callback should fill this in.
                   See <b><a href="../man2/recvfrom.2.html">recvfrom</a>(2)</b>

           <b>ares_ssize_t</b> <b>(*</b><u>asendv</u><b>)(ares_socket_t</b> <u>fd</u><b>,</b> <b>const</b> <b>struct</b> <b>iovec</b> <b>*</b> <u>data</u><b>,</b> <b>int</b> <u>len</u><b>,</b> <b>void</b> <b>*</b> <u>user_data</u><b>)</b>
                   Send data, as provided by the iovec array <u>data</u>, to the socket endpoint.  See <b><a href="../man2/writev.2.html">writev</a>(2)</b>

       The <b><a href="../man3/ares_set_socket_functions.3.html">ares_set_socket_functions</a>(3)</b> struct provided is not copied but directly  referenced,  and  must  thus
       remain   valid   through   out   the   channels   and   any  created  socket's  lifetime.   However,  the
       <b><a href="../man3/ares_set_socket_functions_ex.3.html">ares_set_socket_functions_ex</a>(3)</b> struct is duplicated and does not need to survive past the  call  to  the
       function.

</pre><h4><b>AVAILABILITY</b></h4><pre>
       ares_socket_functions added in c-ares 1.13.0, ares_socket_functions_ex added in c-ares 1.34.0

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/ares_init_options.3.html">ares_init_options</a></b>(3),  <b><a href="../man2/socket.2.html">socket</a></b>(2),  <b><a href="../man2/close.2.html">close</a></b>(2), <b><a href="../man2/connect.2.html">connect</a></b>(2), <b><a href="../man2/recvfrom.2.html">recvfrom</a></b>(2), <b><a href="../man2/sendto.2.html">sendto</a></b>(2), <b><a href="../man2/bind.2.html">bind</a></b>(2), <b><a href="../man2/getsockname.2.html">getsockname</a></b>(2),
       <b><a href="../man2/setsockopt.2.html">setsockopt</a></b>(2), <b><a href="../man2/writev.2.html">writev</a></b>(2)

                                                   8 Oct 2024                       <u><a href="../man3/ARES_SET_SOCKET_FUNCTIONS.3.html">ARES_SET_SOCKET_FUNCTIONS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>