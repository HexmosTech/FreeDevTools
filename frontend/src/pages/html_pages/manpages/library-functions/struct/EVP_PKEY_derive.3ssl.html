<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVP_PKEY_derive_init, EVP_PKEY_derive_init_ex, EVP_PKEY_derive_set_peer_ex, EVP_PKEY_derive_set_peer,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libssl-doc">libssl-doc_3.5.0-2ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       EVP_PKEY_derive_init, EVP_PKEY_derive_init_ex, EVP_PKEY_derive_set_peer_ex, EVP_PKEY_derive_set_peer,
       EVP_PKEY_derive - derive public key algorithm shared secret

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;openssl/evp.h&gt;

        int EVP_PKEY_derive_init(EVP_PKEY_CTX *ctx);
        int EVP_PKEY_derive_init_ex(EVP_PKEY_CTX *ctx, const OSSL_PARAM params[]);
        int EVP_PKEY_derive_set_peer_ex(EVP_PKEY_CTX *ctx, EVP_PKEY *peer,
                                        int validate_peer);
        int EVP_PKEY_derive_set_peer(EVP_PKEY_CTX *ctx, EVP_PKEY *peer);
        int EVP_PKEY_derive(EVP_PKEY_CTX *ctx, unsigned char *key, size_t *keylen);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>EVP_PKEY_derive_init()</b> initializes a public key algorithm context <u>ctx</u> for shared secret derivation using
       the algorithm given when the context was created using <b><a href="../man3/EVP_PKEY_CTX_new.3.html">EVP_PKEY_CTX_new</a></b>(3) or variants thereof.  The
       algorithm is used to fetch a <b>EVP_KEYEXCH</b> method implicitly, see "Implicit fetch" in <b><a href="../man7/provider.7.html">provider</a></b>(7) for more
       information about implicit fetches.

       <b>EVP_PKEY_derive_init_ex()</b> is the same as <b>EVP_PKEY_derive_init()</b> but additionally sets the passed
       parameters <u>params</u> on the context before returning.

       <b>EVP_PKEY_derive_set_peer_ex()</b> sets the peer key: this will normally be a public key. The <u>validate_peer</u>
       will validate the public key if this value is non zero.

       <b>EVP_PKEY_derive_set_peer()</b> is similar to <b>EVP_PKEY_derive_set_peer_ex()</b> with <u>validate_peer</u> set to 1.

       <b>EVP_PKEY_derive()</b> derives a shared secret using <u>ctx</u>.  If <u>key</u> is NULL then the maximum size of the output
       buffer is written to the <u>keylen</u> parameter. If <u>key</u> is not NULL then before the call the <u>keylen</u> parameter
       should contain the length of the <u>key</u> buffer, if the call is successful the shared secret is written to
       <u>key</u> and the amount of data written to <u>keylen</u>.

</pre><h4><b>NOTES</b></h4><pre>
       After the call to <b>EVP_PKEY_derive_init()</b>, algorithm specific control operations can be performed to set
       any appropriate parameters for the operation.

       The function <b>EVP_PKEY_derive()</b> can be called more than once on the same context if several operations are
       performed using the same parameters.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>EVP_PKEY_derive_init()</b> and <b>EVP_PKEY_derive()</b> return 1 for success and 0 or a negative value for failure.
       In particular a return value of -2 indicates the operation is not supported by the public key algorithm.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Derive shared secret (for example DH or EC keys):

        #include &lt;openssl/evp.h&gt;
        #include &lt;openssl/rsa.h&gt;

        EVP_PKEY_CTX *ctx;
        ENGINE *eng;
        unsigned char *skey;
        size_t skeylen;
        EVP_PKEY *pkey, *peerkey;
        /* NB: assumes pkey, eng, peerkey have been already set up */

        ctx = EVP_PKEY_CTX_new(pkey, eng);
        if (!ctx)
            /* Error occurred */
        if (EVP_PKEY_derive_init(ctx) &lt;= 0)
            /* Error */
        if (EVP_PKEY_derive_set_peer(ctx, peerkey) &lt;= 0)
            /* Error */

        /* Determine buffer length */
        if (EVP_PKEY_derive(ctx, NULL, &amp;skeylen) &lt;= 0)
            /* Error */

        skey = OPENSSL_malloc(skeylen);

        if (!skey)
            /* malloc failure */

        if (EVP_PKEY_derive(ctx, skey, &amp;skeylen) &lt;= 0)
            /* Error */

        /* Shared secret is skey bytes written to buffer skey */

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/EVP_PKEY_CTX_new.3.html">EVP_PKEY_CTX_new</a></b>(3), <b><a href="../man3/EVP_PKEY_encrypt.3.html">EVP_PKEY_encrypt</a></b>(3), <b><a href="../man3/EVP_PKEY_decrypt.3.html">EVP_PKEY_decrypt</a></b>(3), <b><a href="../man3/EVP_PKEY_sign.3.html">EVP_PKEY_sign</a></b>(3), <b><a href="../man3/EVP_PKEY_verify.3.html">EVP_PKEY_verify</a></b>(3),
       <b><a href="../man3/EVP_PKEY_verify_recover.3.html">EVP_PKEY_verify_recover</a></b>(3), <b><a href="../man3/EVP_KEYEXCH_fetch.3.html">EVP_KEYEXCH_fetch</a></b>(3)

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>EVP_PKEY_derive_init()</b>, <b>EVP_PKEY_derive_set_peer()</b> and <b>EVP_PKEY_derive()</b> functions were originally
       added in OpenSSL 1.0.0.

       The <b>EVP_PKEY_derive_init_ex()</b> and <b>EVP_PKEY_derive_set_peer_ex()</b> functions were added in OpenSSL 3.0.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2006-2022 The OpenSSL Project Authors. All Rights Reserved.

       Licensed under the Apache License 2.0 (the "License").  You may not use this file except in compliance
       with the License.  You can obtain a copy in the file LICENSE in the source distribution or at
       &lt;https://www.openssl.org/source/license.html&gt;.

3.5.0                                              2025-06-04                              <u><a href="../man3SSL/EVP_PKEY_DERIVE.3SSL.html">EVP_PKEY_DERIVE</a></u>(3SSL)
</pre>
 </div>
</div></section>
</div>
</body>
</html>