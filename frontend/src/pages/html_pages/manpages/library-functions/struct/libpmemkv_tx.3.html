<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmemkv_tx - Transactions API for libpmemkv</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/libpmemkv-dev">libpmemkv-dev_1.5.0-4build1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmemkv_tx</b> - Transactions API for libpmemkv

       This API is <b>EXPERIMENTAL</b> and might change.

</pre><h4><b>SYNOPSIS</b></h4><pre>
              #include &lt;libpmemkv.h&gt;

              int pmemkv_tx_begin(pmemkv_db *db, pmemkv_tx **tx);
              int pmemkv_tx_put(pmemkv_tx *tx, const char *k, size_t kb, const char *v, size_t vb);
              int pmemkv_tx_remove(pmemkv_tx *tx, const char *k, size_t kb);
              int pmemkv_tx_commit(pmemkv_tx *tx);
              void pmemkv_tx_abort(pmemkv_tx *tx);
              void pmemkv_tx_end(pmemkv_tx *tx);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  transaction  allows  grouping put and remove operations into a single atomic action (with respect to
       persistence and concurrency).  Concurrent engines provide transactions with ACID (atomicity, consistency,
       isolation, durability) properties.  Transactions for single threaded engines provide  atomicity,  consis‐
       tency and durability.  Actions in a transaction are executed in the order in which they were called.

       <b>int</b> <b>pmemkv_tx_begin(pmemkv_db</b> <b>*db,</b> <b>pmemkv_tx</b> <b>**tx);</b>
              Starts a pmemkv transaction and stores a pointer to a <u>pmemkv_tx</u> instance in *tx.

       <b>int</b> <b>pmemkv_tx_put(pmemkv_tx</b> <b>*tx,</b> <b>const</b> <b>char</b> <b>*k,</b> <b>size_t</b> <b>kb,</b> <b>const</b> <b>char</b> <b>*v,</b> <b>size_t</b> <b>vb);</b>
              Inserts a key-value pair into pmemkv database.  kb is the length of the key k and vb is the length
              of  value v.  When this function returns, caller is free to reuse both buffers.  The inserted ele‐
              ment is visible only after calling pmemkv_tx_commit.

       <b>int</b> <b>pmemkv_tx_remove(pmemkv_tx</b> <b>*tx,</b> <b>const</b> <b>char</b> <b>*k,</b> <b>size_t</b> <b>kb);</b>
              Removes record with the key k of length kb.  The removed elements are still visible until  calling
              pmemkv_tx_commit.  This function will succeed even if there is no element in the database.

       <b>int</b> <b>pmemkv_tx_commit(pmemkv_tx</b> <b>*tx);</b>
              Commits  the  transaction.  All operations of this transaction are applied as a single power fail-
              safe atomic action.

       <b>void</b> <b>pmemkv_tx_abort(pmemkv_tx</b> <b>*tx);</b>
              Discards all uncommitted operations.

       <b>void</b> <b>pmemkv_tx_end(pmemkv_tx</b> <b>*tx);</b>
              Deletes the pmemkv transaction object and discards all uncommitted operations.

   <b>ERRORS</b>
       Each function, except for <u>pmemkv_tx_abort()</u> and <u>pmemkv_tx_end()</u> returns status.  Possible  return  values
       are listed in <b><a href="../man3/libpmemkv.3.html">libpmemkv</a></b>(3).

</pre><h4><b>EXAMPLE</b></h4><pre>
       The following example is taken from examples/pmemkv_transaction_c directory.

       Usage of pmemkv transaction in C:

              #include &lt;<a href="file:/usr/include/assert.h">assert.h</a>&gt;
              #include &lt;libpmemkv.h&gt;
              #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
              #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
              #include &lt;<a href="file:/usr/include/string.h">string.h</a>&gt;

              #define ASSERT(expr)                                                                     \
                  do {                                                                             \
                      if (!(expr))                                                             \
                          puts(pmemkv_errormsg());                                         \
                      assert(expr);                                                            \
                  } while (0)

              #define <a href="../manmsg/LOG.msg.html">LOG</a>(msg) <a href="../manmsg/puts.msg.html">puts</a>(msg)

              /*
               * This example expects a path to already created database pool.
               *
               * To create a pool use one of the following commands.
               *
               * For regular pools use:
               * pmempool create -l -s 1G "pmemkv_radix" obj path_to_a_pool
               *
               * For poolsets use:
               * pmempool create -l "pmemkv_radix" obj ../examples/example.poolset
               */
              int main(int argc, char *argv[])
              {
                  if (argc &lt; 2) {
                      printf("Usage: %s pool\n", argv[0]);
                      <a href="../man1/exit.1.html">exit</a>(1);
                  }

                  /* See <a href="../man3/libpmemkv_config.3.html">libpmemkv_config</a>(3) for more detailed example of config creation */
                  LOG("Creating config");
                  pmemkv_config *cfg = pmemkv_config_new();
                  ASSERT(cfg != NULL);

                  int s = pmemkv_config_put_path(cfg, argv[1]);
                  ASSERT(s == PMEMKV_STATUS_OK);

                  LOG("Opening pmemkv database with 'radix' engine");
                  pmemkv_db *db = NULL;
                  s = pmemkv_open("radix", cfg, &amp;db);
                  ASSERT(s == PMEMKV_STATUS_OK);
                  ASSERT(db != NULL);

                  const char *key1 = "key1";
                  const char *value1 = "value1";
                  const char *key2 = "key2";
                  const char *value2 = "value2";
                  const char *key3 = "key3";
                  const char *value3 = "value3";

                  LOG("Putting new key");
                  s = pmemkv_put(db, key1, strlen(key1), value1, strlen(value1));
                  ASSERT(s == PMEMKV_STATUS_OK);

                  LOG("Starting a tx");
                  pmemkv_tx *tx;
                  s = pmemkv_tx_begin(db, &amp;tx);
                  ASSERT(s == PMEMKV_STATUS_OK);

                  s = pmemkv_tx_remove(tx, key1, strlen(key1));
                  s = pmemkv_tx_put(tx, key2, strlen(key2), value2, strlen(value2));
                  s = pmemkv_tx_put(tx, key3, strlen(key3), value3, strlen(value3));

                  /* Until transaction is committed, changes are not visible */
                  s = pmemkv_exists(db, key1, strlen(key1));
                  ASSERT(s == PMEMKV_STATUS_OK);
                  s = pmemkv_exists(db, key2, strlen(key2));
                  ASSERT(s == PMEMKV_STATUS_NOT_FOUND);
                  s = pmemkv_exists(db, key3, strlen(key3));
                  ASSERT(s == PMEMKV_STATUS_NOT_FOUND);

                  s = pmemkv_tx_commit(tx);
                  ASSERT(s == PMEMKV_STATUS_OK);

                  /* Changes are now visible and pmemkv_tx object is destroyed */
                  s = pmemkv_exists(db, key1, strlen(key1));
                  ASSERT(s == PMEMKV_STATUS_NOT_FOUND);
                  s = pmemkv_exists(db, key2, strlen(key2));
                  ASSERT(s == PMEMKV_STATUS_OK);
                  s = pmemkv_exists(db, key3, strlen(key3));
                  ASSERT(s == PMEMKV_STATUS_OK);

                  LOG("Ending transaction");
                  pmemkv_tx_end(tx);

                  LOG("Closing database");
                  pmemkv_close(db);

                  return 0;
              }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/libpmemkv.7.html">libpmemkv</a></b>(7), <b><a href="../man3/libpmemkv.3.html">libpmemkv</a></b>(3) and <b>&lt;https://pmem.io&gt;</b>

PMEMKV - pmemkv version 1.5.0                      2022-03-09                                       <u><a href="../man3/PMEMKV_TX.3.html">PMEMKV_TX</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>