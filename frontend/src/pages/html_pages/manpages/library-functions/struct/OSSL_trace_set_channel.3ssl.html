<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSSL_trace_set_channel, OSSL_trace_set_prefix, OSSL_trace_set_suffix, OSSL_trace_set_callback,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libssl-doc">libssl-doc_3.5.0-2ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       OSSL_trace_set_channel, OSSL_trace_set_prefix, OSSL_trace_set_suffix, OSSL_trace_set_callback,
       OSSL_trace_cb - Enabling trace output

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;openssl/trace.h&gt;

        typedef size_t (*OSSL_trace_cb)(const char *buf, size_t cnt,
                                        int category, int cmd, void *data);

        void OSSL_trace_set_channel(int category, BIO *bio);
        void OSSL_trace_set_prefix(int category, const char *prefix);
        void OSSL_trace_set_suffix(int category, const char *suffix);
        void OSSL_trace_set_callback(int category, OSSL_trace_cb cb, void  *data);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       If available (see "Configure Tracing" below), the application can request internal trace output.  This
       output comes in form of free text for humans to read.

       The trace output is divided into categories which can be enabled individually.  Every category can be
       enabled individually by attaching a so-called <u>trace</u> <u>channel</u> to it, which in the simplest case is just a
       BIO object to which the application can write the tracing output for this category.  Alternatively, the
       application can provide a tracer callback in order to get more finegrained trace information. This
       callback will be wrapped internally by a dedicated BIO object.

       For the tracing code, both trace channel types are indistinguishable.  These are called a <u>simple</u> <u>trace</u>
       <u>channel</u> and a <u>callback</u> <u>trace</u> <u>channel</u>, respectively.

       <b><a href="../man3/OSSL_TRACE_ENABLED.3.html">OSSL_TRACE_ENABLED</a></b>(3) can be used to check whether tracing is currently enabled for the given category.
       Functions like <b><a href="../man3/OSSL_TRACE1.3.html">OSSL_TRACE1</a></b>(3) and macros like <b><a href="../man3/OSSL_TRACE_BEGIN.3.html">OSSL_TRACE_BEGIN</a></b>(3) can be used for producing free-text
       trace output.

   <b>Functions</b>
       <b>OSSL_trace_set_channel()</b> is used to enable the given trace "category" by attaching the <b>BIO</b> <u>bio</u> object as
       (simple) trace channel.  On success the ownership of the BIO is transferred to the channel, so the caller
       must not free it directly.

       <b>OSSL_trace_set_prefix()</b> and <b>OSSL_trace_set_suffix()</b> can be used to add an extra line for each channel, to
       be output before and after group of tracing output.  What constitutes an output group is decided by the
       code that produces the output.  The lines given here are considered immutable; for more dynamic tracing
       prefixes, consider setting a callback with <b>OSSL_trace_set_callback()</b> instead.

       <b>OSSL_trace_set_callback()</b> is used to enable the given trace <u>category</u> by giving it the tracer callback <u>cb</u>
       with the associated data <u>data</u>, which will simply be passed through to <u>cb</u> whenever it's called. The
       callback function is internally wrapped by a dedicated BIO object, the so-called <u>callback</u> <u>trace</u> <u>channel</u>.
       This should be used when it's desirable to do form the trace output to something suitable for application
       needs where a prefix and suffix line aren't enough.

       <b>OSSL_trace_set_channel()</b> and <b>OSSL_trace_set_callback()</b> are mutually exclusive, calling one of them will
       clear whatever was set by the previous call.

       Calling <b>OSSL_trace_set_channel()</b> with NULL for <u>channel</u> or <b>OSSL_trace_set_callback()</b> with NULL for <u>cb</u>
       disables tracing for the given <u>category</u>.

   <b>Trace</b> <b>callback</b>
       The tracer callback must return a <b>size_t</b>, which must be zero on error and otherwise return the number of
       bytes that were output.  It receives a text buffer <u>buf</u> with <u>cnt</u> bytes of text, as well as the <u>category</u>, a
       control number <u>cmd</u>, and the <u>data</u> that was passed to <b>OSSL_trace_set_callback()</b>.

       The possible control numbers are:

       <b>OSSL_TRACE_CTRL_BEGIN</b>
           The  callback is called from <b>OSSL_trace_begin()</b>, which gives the callback the possibility to output a
           dynamic starting line, or set a prefix that should be output  at  the  beginning  of  each  line,  or
           something other.

       <b>OSSL_TRACE_CTRL_WRITE</b>
           This  callback  is called whenever data is written to the BIO by some regular BIO output routine.  An
           arbitrary number of <b>OSSL_TRACE_CTRL_WRITE</b> callbacks can occur inside a group  marked  by  a  pair  of
           <b>OSSL_TRACE_CTRL_BEGIN</b> and <b>OSSL_TRACE_CTRL_END</b> calls, but never outside such a group.

       <b>OSSL_TRACE_CTRL_END</b>
           The  callback  is  called from <b>OSSL_trace_end()</b>, which gives the callback the possibility to output a
           dynamic ending line, or reset the line prefix that was set with <b>OSSL_TRACE_CTRL_BEGIN</b>,  or  something
           other.

   <b>Trace</b> <b>categories</b>
       The trace categories are simple numbers available through macros.

       <b>OSSL_TRACE_CATEGORY_TRACE</b>
           Traces the OpenSSL trace API itself.

           More precisely, this will generate trace output any time a new trace hook is set.

       <b>OSSL_TRACE_CATEGORY_INIT</b>
           Traces OpenSSL library initialization and cleanup.

           This needs special care, as OpenSSL will do automatic cleanup after exit from main(), and any tracing
           output  done  during  this  cleanup will be lost if the tracing channel or callback were cleaned away
           prematurely.  A suggestion is to make such cleanup part of a function that's  registered  very  early
           with <b><a href="../man3/atexit.3.html">atexit</a></b>(3).

       <b>OSSL_TRACE_CATEGORY_TLS</b>
           Traces the TLS/SSL protocol.

       <b>OSSL_TRACE_CATEGORY_TLS_CIPHER</b>
           Traces the ciphers used by the TLS/SSL protocol.

       <b>OSSL_TRACE_CATEGORY_CONF</b>
           Traces details about the provider and engine configuration.

       <b>OSSL_TRACE_CATEGORY_ENGINE_TABLE</b>
           Traces the ENGINE algorithm table selection.

           More  precisely,  functions  like  <b>ENGINE_get_pkey_asn1_meth_engine()</b>, <b>ENGINE_get_pkey_meth_engine()</b>,
           <b>ENGINE_get_cipher_engine()</b>, <b>ENGINE_get_digest_engine()</b>, will generate trace summaries of the handling
           of internal tables.

       <b>OSSL_TRACE_CATEGORY_ENGINE_REF_COUNT</b>
           Traces the ENGINE reference counting.

           More precisely, both reference counts in the ENGINE structure will be monitored with a line of  trace
           output generated for each change.

       <b>OSSL_TRACE_CATEGORY_PKCS5V2</b>
           Traces PKCS#5 v2 key generation.

       <b>OSSL_TRACE_CATEGORY_PKCS12_KEYGEN</b>
           Traces PKCS#12 key generation.

       <b>OSSL_TRACE_CATEGORY_PKCS12_DECRYPT</b>
           Traces PKCS#12 decryption.

       <b>OSSL_TRACE_CATEGORY_X509V3_POLICY</b>
           Traces X509v3 policy processing.

           More precisely, this generates the complete policy tree at various point during evaluation.

       <b>OSSL_TRACE_CATEGORY_BN_CTX</b>
           Traces BIGNUM context operations.

       <b>OSSL_TRACE_CATEGORY_CMP</b>
           Traces CMP client and server activity.

       <b>OSSL_TRACE_CATEGORY_STORE</b>
           Traces STORE operations.

       <b>OSSL_TRACE_CATEGORY_DECODER</b>
           Traces decoder operations.

       <b>OSSL_TRACE_CATEGORY_ENCODER</b>
           Traces encoder operations.

       <b>OSSL_TRACE_CATEGORY_REF_COUNT</b>
           Traces decrementing certain ASN.1 structure references.

       <b>OSSL_TRACE_CATEGORY_HTTP</b>
           Traces the HTTP client, such as message headers being sent and received.

       There is also <b>OSSL_TRACE_CATEGORY_ALL</b>, which works as a fallback and can be used to get <u>all</u> trace output.

       Note, however, that in this case all trace output will effectively be associated with the 'ALL' category,
       which  is  undesirable  if  the application intends to include the category name in the trace output.  In
       this case it is better to register separate channels for each trace category instead.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>OSSL_trace_set_channel()</b>, <b>OSSL_trace_set_prefix()</b>, <b>OSSL_trace_set_suffix()</b>, and <b>OSSL_trace_set_callback()</b>
       return 1 on success, or 0 on failure.

</pre><h4><b>EXAMPLES</b></h4><pre>
       In all examples below, the trace producing code is assumed to be the following:

        int foo = 42;
        const char bar[] = { 0,  1,  2,  3,  4,  5,  6,  7,
                             8,  9, 10, 11, 12, 13, 14, 15 };

        OSSL_TRACE_BEGIN(TLS) {
            BIO_puts(trc_out, "foo: ");
            BIO_printf(trc_out, "%d\n", foo);
            BIO_dump(trc_out, bar, sizeof(bar));
        } OSSL_TRACE_END(TLS);

   <b>Simple</b> <b>example</b>
       An example with just a channel and constant prefix / suffix.

        int main(int argc, char *argv[])
        {
            BIO *err = BIO_new_fp(stderr, BIO_NOCLOSE | BIO_FP_TEXT);
            OSSL_trace_set_channel(OSSL_TRACE_CATEGORY_SSL, err);
            OSSL_trace_set_prefix(OSSL_TRACE_CATEGORY_SSL, "BEGIN TRACE[TLS]");
            OSSL_trace_set_suffix(OSSL_TRACE_CATEGORY_SSL, "END TRACE[TLS]");

            /* ... work ... */
        }

       When the trace producing code above is performed, this will be output on standard error:

        BEGIN TRACE[TLS]
        foo: 42
        0000 - 00 01 02 03 04 05 06 07-08 09 0a 0b 0c 0d 0e 0f   ................
        END TRACE[TLS]

   <b>Advanced</b> <b>example</b>
       This example uses the callback, and depends on pthreads functionality.

        static size_t cb(const char *buf, size_t cnt,
                        int category, int cmd, void *vdata)
        {
            BIO *bio = vdata;
            const char *label = NULL;

            switch (cmd) {
            case OSSL_TRACE_CTRL_BEGIN:
                label = "BEGIN";
                break;
            case OSSL_TRACE_CTRL_END:
                label = "END";
                break;
            }

            if (label != NULL) {
                union {
                    pthread_t tid;
                    unsigned long ltid;
                } tid;

                tid.tid = pthread_self();
                BIO_printf(bio, "%s TRACE[%s]:%lx\n",
                           label, OSSL_trace_get_category_name(category), tid.ltid);
            }
            return (size_t)BIO_puts(bio, buf);
        }

        int main(int argc, char *argv[])
        {
            BIO *err = BIO_new_fp(stderr, BIO_NOCLOSE | BIO_FP_TEXT);
            OSSL_trace_set_callback(OSSL_TRACE_CATEGORY_SSL, cb, err);

            /* ... work ... */
        }

       The output is almost the same as for the simple example above.

        BEGIN TRACE[TLS]:7f9eb0193b80
        foo: 42
        0000 - 00 01 02 03 04 05 06 07-08 09 0a 0b 0c 0d 0e 0f   ................
        END TRACE[TLS]:7f9eb0193b80

</pre><h4><b>NOTES</b></h4><pre>
   <b>Configure</b> <b>Tracing</b>
       By default, the OpenSSL library is  built  with  tracing  disabled.  To  use  the  tracing  functionality
       documented here, it is therefore necessary to configure and build OpenSSL with the 'enable-trace' option.

       When   the   library   is  built  with  tracing  disabled,  the  macro  <b>OPENSSL_NO_TRACE</b>  is  defined  in
       <u>&lt;openssl/opensslconf.h&gt;</u> and all functions described here are inoperational, i.e. will do nothing.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/OSSL_TRACE_ENABLED.3.html">OSSL_TRACE_ENABLED</a></b>(3), <b><a href="../man3/OSSL_TRACE_BEGIN.3.html">OSSL_TRACE_BEGIN</a></b>(3), <b><a href="../man3/OSSL_TRACE1.3.html">OSSL_TRACE1</a></b>(3), <b><a href="../man3/atexit.3.html">atexit</a></b>(3)

</pre><h4><b>HISTORY</b></h4><pre>
       <b>OSSL_trace_set_channel()</b>, <b>OSSL_trace_set_prefix()</b>, <b>OSSL_trace_set_suffix()</b>, and <b>OSSL_trace_set_callback()</b>
       were all added in OpenSSL 3.0.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2019-2023 The OpenSSL Project Authors. All Rights Reserved.

       Licensed under the Apache License 2.0 (the "License").  You may not use this file  except  in  compliance
       with  the  License.   You  can  obtain  a  copy  in  the  file  LICENSE  in the source distribution or at
       &lt;https://www.openssl.org/source/license.html&gt;.

3.5.0                                              2025-06-04                       <u><a href="../man3SSL/OSSL_TRACE_SET_CHANNEL.3SSL.html">OSSL_TRACE_SET_CHANNEL</a></u>(3SSL)
</pre>
 </div>
</div></section>
</div>
</body>
</html>