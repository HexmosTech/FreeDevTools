<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKCS12_create, PKCS12_create_ex, PKCS12_create_cb, PKCS12_create_ex2 - create a PKCS#12 structure</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libssl-doc">libssl-doc_3.5.0-2ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       PKCS12_create, PKCS12_create_ex, PKCS12_create_cb, PKCS12_create_ex2 - create a PKCS#12 structure

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;openssl/pkcs12.h&gt;

        PKCS12 *PKCS12_create(const char *pass, const char *name, EVP_PKEY *pkey,
                              X509 *cert, STACK_OF(X509) *ca,
                              int nid_key, int nid_cert, int iter, int mac_iter, int keytype);
        PKCS12 *PKCS12_create_ex(const char *pass, const char *name, EVP_PKEY *pkey,
                                 X509 *cert, STACK_OF(X509) *ca, int nid_key, int nid_cert,
                                 int iter, int mac_iter, int keytype,
                                 OSSL_LIB_CTX *ctx, const char *propq);

        typedef int PKCS12_create_cb(PKCS12_SAFEBAG *bag, void *cbarg);

        PKCS12 *PKCS12_create_ex2(const char *pass, const char *name, EVP_PKEY *pkey,
                                  X509 *cert, STACK_OF(X509) *ca, int nid_key, int nid_cert,
                                  int iter, int mac_iter, int keytype,
                                  OSSL_LIB_CTX *ctx, const char *propq,
                                  PKCS12_create_cb *cb, void *cbarg);
       =head1 DESCRIPTION

       <b>PKCS12_create()</b> creates a PKCS#12 structure.

       <u>pass</u> is the passphrase to use. <u>name</u> is the <b>friendlyName</b> to use for the supplied certificate and key. <u>pkey</u>
       is the private key to include in the structure and <u>cert</u> its corresponding certificates. <u>ca</u>, if not <b>NULL</b>
       is an optional set of certificates to also include in the structure.

       <u>nid_key</u> and <u>nid_cert</u> are the encryption algorithms that should be used for the key and certificate
       respectively. The modes GCM, CCM, XTS, and OCB are unsupported. <u>iter</u> is the encryption algorithm
       iteration count to use and <u>mac_iter</u> is the MAC iteration count to use.  <u>keytype</u> is the type of key.

       <b>PKCS12_create_ex()</b> is identical to <b>PKCS12_create()</b> but allows for a library context <u>ctx</u> and property
       query <u>propq</u> to be used to select algorithm implementations.

       <b>PKCS12_create_ex2()</b> is identical to <b>PKCS12_create_ex()</b> but allows for a user defined callback <u>cb</u> of type
       <b>PKCS12_create_cb</b> to be specified and also allows for an optional argument <u>cbarg</u> to be passed back to the
       callback.

       The <u>cb</u> if specified will be called for every safebag added to the PKCS12 structure and allows for
       optional application processing on the associated safebag. For example one such use could be to add
       attributes to the safebag.

</pre><h4><b>NOTES</b></h4><pre>
       The parameters <u>nid_key</u>, <u>nid_cert</u>, <u>iter</u>, <u>mac_iter</u> and <u>keytype</u> can all be set to zero and sensible defaults
       will be used.

       These defaults are: AES password based encryption (PBES2 with PBKDF2 and AES-256-CBC) for private keys
       and certificates, the PBKDF2 and MAC key derivation iteration count of <b>PKCS12_DEFAULT_ITER</b> (currently
       2048), and MAC algorithm HMAC with SHA2-256. The MAC key derivation algorithm used for the outer PKCS#12
       structure is PKCS12KDF.

       The default MAC iteration count is 1 in order to retain compatibility with old software which did not
       interpret MAC iteration counts. If such compatibility is not required then <u>mac_iter</u> should be set to
       PKCS12_DEFAULT_ITER.

       <u>keytype</u> adds a flag to the store private key. This is a non standard extension that is only currently
       interpreted by MSIE. If set to zero the flag is omitted, if set to <b>KEY_SIG</b> the key can be used for
       signing only, if set to <b>KEY_EX</b> it can be used for signing and encryption. This option was useful for old
       export grade software which could use signing only keys of arbitrary size but had restrictions on the
       permissible sizes of keys which could be used for encryption.

       If <u>name</u> is <b>NULL</b> and <u>cert</u> contains an <u>alias</u> then this will be used for the corresponding <b>friendlyName</b> in
       the PKCS12 structure instead.  Similarly, if <u>pkey</u> is NULL and <u>cert</u> contains a <u>keyid</u> then this will be
       used for the corresponding <b>localKeyID</b> in the PKCS12 structure instead of the id calculated from the <u>pkey</u>.

       For all certificates in <u>ca</u> then if a certificate contains an <u>alias</u> or <u>keyid</u> then this will be used for
       the corresponding <b>friendlyName</b> or <b>localKeyID</b> in the PKCS12 structure.

       Either <u>pkey</u>, <u>cert</u> or both can be <b>NULL</b> to indicate that no key or certificate is required. In previous
       versions both had to be present or a fatal error is returned.

       <u>nid_key</u> or <u>nid_cert</u> can be set to -1 indicating that no encryption should be used.

       <u>mac_iter</u> can be set to -1 and the MAC will then be omitted entirely.  This can be useful when running
       with the FIPS provider as the PKCS12KDF is not a FIPS approvable algorithm.

       <b>PKCS12_create()</b> makes assumptions regarding the encoding of the given pass phrase.  See
       <b><a href="../man7/passphrase-encoding.7.html">passphrase-encoding</a></b>(7) for more information.

       If <u>cb</u> is specified, then it should return 1 for success and -1 for a fatal error.  A return of 0 is
       intended to mean to not add the bag after all.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>PKCS12_create()</b> returns a valid <b>PKCS12</b> structure or NULL if an error occurred.

</pre><h4><b>CONFORMING</b> <b>TO</b></h4><pre>
       IETF RFC 7292 (&lt;https://tools.ietf.org/html/rfc7292&gt;)

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/EVP_KDF-PKCS12KDF.7.html">EVP_KDF-PKCS12KDF</a></b>(7), <b><a href="../man3/d2i_PKCS12.3.html">d2i_PKCS12</a></b>(3), <b><a href="../man7/OSSL_PROVIDER-FIPS.7.html">OSSL_PROVIDER-FIPS</a></b>(7), <b><a href="../man7/passphrase-encoding.7.html">passphrase-encoding</a></b>(7)

</pre><h4><b>HISTORY</b></h4><pre>
       <b>PKCS12_create_ex()</b> was added in OpenSSL 3.0.  <b>PKCS12_create_ex2()</b> was added in OpenSSL 3.2.

       The defaults for encryption algorithms, MAC algorithm, and the MAC key derivation iteration count were
       changed in OpenSSL 3.0 to more modern standards.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2002-2024 The OpenSSL Project Authors. All Rights Reserved.

       Licensed under the Apache License 2.0 (the "License").  You may not use this file except in compliance
       with the License.  You can obtain a copy in the file LICENSE in the source distribution or at
       &lt;https://www.openssl.org/source/license.html&gt;.

3.5.0                                              2025-06-04                                <u><a href="../man3SSL/PKCS12_CREATE.3SSL.html">PKCS12_CREATE</a></u>(3SSL)
</pre>
 </div>
</div></section>
</div>
</body>
</html>