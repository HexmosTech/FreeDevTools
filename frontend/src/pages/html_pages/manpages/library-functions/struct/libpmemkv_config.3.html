<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmemkv_config - Configuration API for libpmemkv</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/libpmemkv-dev">libpmemkv-dev_1.5.0-4build1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmemkv_config</b> - Configuration API for libpmemkv

</pre><h4><b>SYNOPSIS</b></h4><pre>
              #include &lt;libpmemkv.h&gt;

              pmemkv_config *pmemkv_config_new(void);
              void pmemkv_config_delete(pmemkv_config *config);

              int pmemkv_config_put_size(pmemkv_config *config, uint64_t value);
              int pmemkv_config_put_path(pmemkv_config *config, const char *value);
              int **deprecated** pmemkv_config_put_force_create(pmemkv_config *config,
                                             bool value);
              int pmemkv_config_put_create_or_error_if_exists(pmemkv_config *config, bool value);
              int pmemkv_config_put_create_if_missing(pmemkv_config *config, bool value)
              int pmemkv_config_put_comparator(pmemkv_config *config, pmemkv_comparator *comparator);
              int pmemkv_config_put_oid(pmemkv_config *config, PMEMoid *oid);

              int pmemkv_config_put_data(pmemkv_config *config, const char *key, const void *value,
                          size_t value_size);
              int pmemkv_config_put_object(pmemkv_config *config, const char *key, void *value,
                          void (*deleter)(void *));
              int pmemkv_config_put_object_cb(pmemkv_config *config, const char *key, void *value,
                              void *(*getter)(void *), void (*deleter)(void *));
              int pmemkv_config_put_uint64(pmemkv_config *config, const char *key, uint64_t value);
              int pmemkv_config_put_int64(pmemkv_config *config, const char *key, int64_t value);
              int pmemkv_config_put_string(pmemkv_config *config, const char *key, const char *value);

              int pmemkv_config_get_data(pmemkv_config *config, const char *key, const void **value,
                          size_t *value_size);
              int pmemkv_config_get_object(pmemkv_config *config, const char *key, void **value);
              int pmemkv_config_get_uint64(pmemkv_config *config, const char *key, uint64_t *value);
              int pmemkv_config_get_int64(pmemkv_config *config, const char *key, int64_t *value);
              int pmemkv_config_get_string(pmemkv_config *config, const char *key, const char **value);

              pmemkv_comparator *pmemkv_comparator_new(pmemkv_compare_function *fn, const char *name,
                                   void *arg);
              void pmemkv_comparator_delete(pmemkv_comparator *comparator);

       For general description of pmemkv and available engines see <b><a href="../man7/libpmemkv.7.html">libpmemkv</a></b>(7).  For description of pmemkv core
       API see <b><a href="../man3/libpmemkv.3.html">libpmemkv</a></b>(3).

</pre><h4><b>DESCRIPTION</b></h4><pre>
       pmemkv database is configured using pmemkv_config structure.  It stores mappings of keys (null-terminated
       strings) to values.  A value can be:

       • <b>uint64_t</b>

       • <b>int64_t</b>

       • <b>c-style</b> <b>string</b>

       • <b>binary</b> <b>data</b>

       • <b>pointer</b> <b>to</b> <b>an</b> <b>object</b> (with accompanying deleter function)

       It  also  delivers methods to store and read configuration items provided by a user.  Once the configura‐
       tion object is set (with all required parameters), it can be passed to <u>pmemkv_open()</u> method.

       List of options which are required by pmemkv database is specific to an engine.  Every engine  has  docu‐
       mented all supported config parameters (please see <b><a href="../man7/libpmemkv.7.html">libpmemkv</a></b>(7) for details).

       <b>pmemkv_config</b> <b>*pmemkv_config_new(void);</b>
              Creates an instance of configuration for pmemkv database.  On failure, NULL is returned.

       <b>void</b> <b>pmemkv_config_delete(pmemkv_config</b> <b>*config);</b>
              Deletes pmemkv_config.  Should be called ONLY for configs which were not passed to pmemkv_open (as
              this function moves ownership of the config to the database).

       <b>int</b> <b>pmemkv_config_put_size(pmemkv_config</b> <b>*config,</b> <b>uint64_t</b> <b>value);</b>
              Puts  value to a config at key size, it’s required when creating new database pool.  This function
              provides type safety for <b>size</b> parameter.

       <b>int</b> <b>pmemkv_config_put_path(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*value);</b>
              Puts value to a config at key <b>path</b>.  It’s a path to a database file or  to  a  poolset  file  (see
              <b><a href="../man5/poolset.5.html">poolset</a></b>(5)  for details), to open or create.  Note that when using poolset file, size should be 0.
              This function provides type safety for path parameter.

       <b>int</b> <b>pmemkv_config_put_force_create(pmemkv_config</b> <b>*config,</b> <b>bool</b> <b>value);</b>
              It is <b>deprecated</b> and kept for compatibility.  It’s an  alias  for  pmemkv_config_put_create_or_er‐
              ror_if_exists - use it instead.

       <b>int</b> <b>pmemkv_config_put_create_or_error_if_exists(pmemkv_config</b> <b>*config,</b> <b>bool</b> <b>value);</b>
              Puts  value  to  a  config at key create_or_error_if_exists.  This flag is mutually exclusive with
              <b>create_if_missing</b>.  It works only with engines supporting this flag and it means: If true:  pmemkv
              creates  the  pool, unless it exists - then it fails.  If false: pmemkv opens the pool, unless the
              path does not exist - then it fails.  False by default.

       <b>int</b> <b>pmemkv_config_put_create_if_missing(pmemkv_config</b> <b>*config,</b> <b>bool</b> <b>value)</b>
              Puts value to a config at key create_if_missing.   This  flag  is  mutually  exclusive  with  <b>cre‐</b>
              <b>ate_or_error_if_exists</b>.   It  works  only with engines supporting this flag and it means: If true:
              pmemkv tries to open the pool and if that doesn’t succeed it means there’s (most likely)  no  pool
              to use, so it tries to create it.  If false: pmemkv opens the pool, unless the path does not exist
              - then it fails.  False by default.

       <b>int</b> <b>pmemkv_config_put_comparator(pmemkv_config</b> <b>*config,</b> <b>pmemkv_comparator</b> <b>*comparator);</b>
              Puts  comparator  object  to  a  config.   To  create  an  instance  of  pmemkv_comparator object,
              pmemkv_comparator_new() function should be used.

       <b>int</b> <b>pmemkv_config_put_oid(pmemkv_config</b> <b>*config,</b> <b>PMEMoid</b> <b>*oid);</b>
              Puts PMEMoid object to a config (for details see <b><a href="../man7/libpmemkv.7.html">libpmemkv</a></b>(7)).

       <b>int</b> <b>pmemkv_config_put_uint64(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>uint64_t</b> <b>value);</b>
              Puts uint64_t value value to pmemkv_config at key key.

       <b>int</b> <b>pmemkv_config_put_int64(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>int64_t</b> <b>value);</b>
              Puts int64_t value value to pmemkv_config at key key.

       <b>int</b> <b>pmemkv_config_put_string(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>const</b> <b>char</b> <b>*value);</b>
              Puts null-terminated string to pmemkv_config.  The string is copied to the config.

       <b>int</b> <b>pmemkv_config_put_data(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>const</b> <b>void</b> <b>*value,</b> <b>size_t</b> <b>value_size);</b>
              Puts copy of binary data pointed by value to pmemkv_config.  value_size specifies size of the  da‐
              ta.

       <b>int</b> <b>pmemkv_config_put_object(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>void</b> <b>*value,</b> <b>void</b> <b>(*deleter)(void</b>
       <b>*));</b>
              Puts  value  to  pmemkv_config.  value can point to arbitrary object.  deleter parameter specifies
              function which will be called for value when the config is destroyed (using pmemkv_config_delete).

       <b>int</b> <b>pmemkv_config_put_object_cb(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>void</b> <b>*value,</b> <b>void</b> <b>*(*getter)(void</b>
       <b>*),</b> <b>void</b> <b>(*deleter)(void</b> <b>*));</b>
              Extended version of pmemkv_config_put_object.  It accepts one additional argument - a getter call‐
              back.  This callback interprets the custom object (value) and returns a pointer which is  expected
              by pmemkv.

              Calling pmemkv_config_put_object_cb with getter implemented as:

                     void *getter(void *arg) { return arg; }

              is equivalent to calling pmemkv_config_put_object.

       <b>int</b> <b>pmemkv_config_get_uint64(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>uint64_t</b> <b>*value);</b>
              Gets value of a config item with key key.  Value is copied to variable pointed by value.

       <b>int</b> <b>pmemkv_config_get_int64(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>int64_t</b> <b>*value);</b>
              Gets value of a config item with key key.  Value is copied to variable pointed by value.

       <b>int</b> <b>pmemkv_config_get_string(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>const</b> <b>char</b> <b>**value);</b>
              Gets  pointer to a null-terminated string.  The string is not copied.  After successful call value
              points to string stored in pmemkv_config.

       <b>int</b> <b>pmemkv_config_get_data(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>const</b> <b>void</b> <b>**value,</b> <b>size_t</b> <b>*val‐</b>
       <b>ue_size);</b>
              Gets pointer to binary data.  Data is not copied.  After successful call  *value  points  to  data
              stored in pmemkv_config and value_size holds size of the data.

       <b>int</b> <b>pmemkv_config_get_object(pmemkv_config</b> <b>*config,</b> <b>const</b> <b>char</b> <b>*key,</b> <b>const</b> <b>void</b> <b>**value);</b>
              Gets pointer to an object.  After successful call, *value points to the object.

       Config items stored in pmemkv_config, which were put using a specific function can be obtained only using
       corresponding  pmemkv_config_get_  function (for example, config items put using pmemkv_config_put_object
       can only be obtained using pmemkv_config_get_object).  Exception from this rule are functions for  uint64
       and  int64.   If  value  put  by  pmemkv_config_put_int64  is  in uint64_t range it can be obtained using
       pmemkv_config_get_uint64 and vice versa.

       <b>pmemkv_comparator</b> <b>*pmemkv_comparator_new(pmemkv_compare_function</b> <b>*fn,</b> <b>const</b> <b>char</b> <b>*name,</b> <b>void</b> <b>*arg);</b>
              Creates instance of a comparator object.  Accepts comparison function fn, name and arg. In case of
              persistent engines,nameis stored within the engine. Attempt to open a database which was  createad
              with  different comparator of different name will fail with PMEMKV_STATUS_COMPARATOR_MISMATCH.arg`
              is saved in the comparator and passed to a comparison function on each invocation.

              Neither fn nor name can be NULL.

              fn should perform a three-way comparison.  Return values: * negative value if  the  first  key  is
              less  than  the  second  one * zero if both keys are the same * positive value if the first key is
              greater than the second one

              The comparison function should be thread safe - it can be called from multiple threads.

              On failure, NULL is returned.

       <b>void</b> <b>pmemkv_comparator_delete(pmemkv_comparator</b> <b>*comparator);</b>
              Removes the comparator object.  Should be called ONLY for comparators which were not put to config
              (as config takes ownership of the comparator).

       To set a comparator for the database use pmemkv_config_put_object:

              pmemkv_comparator *cmp = pmemkv_comparator_new(&amp;compare_fn, "my_comparator", NULL);

              pmemkv_config_put_object(cfg, "comparator", cmp, (void (*)(void *)) &amp; pmemkv_comparator_delete);

   <b>ERRORS</b>
       Each function, except for <u>pmemkv_config_new()</u> and <u>pmemkv_config_delete()</u>, returns status.   Possible  re‐
       turn values are:

       • <b>PMEMKV_STATUS_OK</b> – no error

       • <b>PMEMKV_STATUS_UNKNOWN_ERROR</b> – unknown error

       • <b>PMEMKV_STATUS_NOT_FOUND</b> – record (or config item) not found

       • <b>PMEMKV_STATUS_CONFIG_PARSING_ERROR</b> – parsing data to config failed

       • <b>PMEMKV_STATUS_CONFIG_TYPE_ERROR</b> – config item has different type than expected

</pre><h4><b>EXAMPLE</b></h4><pre>
       The following examples are taken from examples/pmemkv_config_c directory.

   <b>BASIC</b> <b>EXAMPLE</b>
       Usage  of  basic  config  functions  to  set  parameters based on their functionalities, e.g. pmemkv_con‐
       fig_put_path() or pmemkv_config_put_size().

              #include &lt;<a href="file:/usr/include/assert.h">assert.h</a>&gt;
              #include &lt;libpmemkv.h&gt;
              #include &lt;libpmemobj/pool_base.h&gt;
              #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
              #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
              #include &lt;<a href="file:/usr/include/string.h">string.h</a>&gt;

              #define ASSERT(expr)                                                                     \
                  do {                                                                             \
                      if (!(expr))                                                             \
                          puts(pmemkv_errormsg());                                         \
                      assert(expr);                                                            \
                  } while (0)

              static const uint64_t SIZE = 1024UL * 1024UL * 1024UL;

              int key_length_compare(const char *key1, size_t keybytes1, const char *key2,
                             size_t keybytes2, void *arg)
              {
                  if (keybytes2 &lt; keybytes1)
                      return -1;
                  else if (keybytes2 &gt; keybytes1)
                      return 1;
                  else
                      return 0;
              }

              int main(int argc, char *argv[])
              {
                  if (argc &lt; 2) {
                      fprintf(stderr, "Usage: %s file\n", argv[0]);
                      <a href="../man1/exit.1.html">exit</a>(1);
                  }

                  /* Create config */
                  pmemkv_config *config = pmemkv_config_new();
                  ASSERT(config != NULL);

                  /* Add path parameter to config. Meaning of this is dependent on chosen engine.
                   *  E.g. if config is used with cmap engine,
                   *  it is a path to a database file or to a poolset file. However for
                   *  vcmap it is a path to an existing directory */
                  int status = pmemkv_config_put_path(config, argv[1]);
                  ASSERT(status == PMEMKV_STATUS_OK);

                  /* Specifies size of the database */
                  status = pmemkv_config_put_size(config, SIZE);
                  ASSERT(status == PMEMKV_STATUS_OK);

                  /* Specifies value of create_if_missing flag.
                   * Alternatively, another flag - 'create_or_error_if_exists' can be set using:
                   * `pmemkv_config_put_create_or_error_if_exists`
                   * For differences between the two, see manpage <a href="../man7/libpmemkv.7.html">libpmemkv</a>(7). */
                  status = pmemkv_config_put_create_if_missing(config, true);
                  ASSERT(status == PMEMKV_STATUS_OK);

                  /* Specifies comparator used by the engine */
                  pmemkv_comparator *cmp =
                      pmemkv_comparator_new(&amp;key_length_compare, "key_length_compare", NULL);
                  ASSERT(cmp != NULL);
                  status = pmemkv_config_put_comparator(config, cmp);
                  ASSERT(status == PMEMKV_STATUS_OK);

                  /* Adds pointer to oid (for details see <a href="../man7/libpmemkv.7.html">libpmemkv</a>(7)) to the config */
                  PMEMoid oid;
                  status = pmemkv_config_put_oid(config, &amp;oid);
                  ASSERT(status == PMEMKV_STATUS_OK);

                  pmemkv_config_delete(config);

                  return 0;
              }

   <b>TYPE</b> <b>BASED</b> <b>CONFIGURATION</b> <b>EXAMPLE</b>
       Usage of config functions to set and get data based on their data type, e.g. pmemkv_config_put_int64() or
       pmemkv_config_put_object().

              #include &lt;<a href="file:/usr/include/assert.h">assert.h</a>&gt;
              #include &lt;libpmemkv.h&gt;
              #include &lt;libpmemkv_json_config.h&gt;
              #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
              #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
              #include &lt;<a href="file:/usr/include/string.h">string.h</a>&gt;

              #define ASSERT(expr)                                                                     \
                  do {                                                                             \
                      if (!(expr))                                                             \
                          puts(pmemkv_errormsg());                                         \
                      assert(expr);                                                            \
                  } while (0)

              /* deleter for int pointer */
              void free_int_ptr(void *ptr)
              {
                  free(ptr);
              }

              int main()
              {
                  pmemkv_config *config = pmemkv_config_new();
                  ASSERT(config != NULL);

                  /* Put int64_t value */
                  int status = pmemkv_config_put_int64(config, "size", 1073741824);
                  ASSERT(status == PMEMKV_STATUS_OK);

                  char buffer[] = "ABC";

                  /* Put binary data stored in buffer */
                  status = pmemkv_config_put_data(config, "binary", buffer, 3);
                  ASSERT(status == PMEMKV_STATUS_OK);

                  const void *data;
                  size_t data_size;

                  /* Get pointer to binary data stored in config */
                  status = pmemkv_config_get_data(config, "binary", &amp;data, &amp;data_size);
                  ASSERT(status == PMEMKV_STATUS_OK);
                  ASSERT(data_size == 3);
                  ASSERT(((const char *)data)[0] == 'A');

                  int *int_ptr = malloc(sizeof(int));
                  ASSERT(int_ptr != NULL);
                  *int_ptr = 10;

                  /* Put pointer to dynamically allocated object, free_int_ptr is called on
                   * pmemkv_config_delete */
                  status = pmemkv_config_put_object(config, "int_ptr", int_ptr, &amp;free_int_ptr);
                  ASSERT(status == PMEMKV_STATUS_OK);

                  int *get_int_ptr;

                  /* Get pointer to object stored in config */
                  status = pmemkv_config_get_object(config, "int_ptr", (void **)&amp;get_int_ptr);
                  ASSERT(status == PMEMKV_STATUS_OK);
                  ASSERT(*get_int_ptr == 10);

                  pmemkv_config_delete(config);

                  pmemkv_config *config_from_json = pmemkv_config_new();
                  ASSERT(config_from_json != NULL);

                  /* Parse JSON and put all items found into config_from_json */
                  status = pmemkv_config_from_json(config_from_json, "{\"path\":\"<a href="file:/dev/shm">/dev/shm</a>\",\
                       \"size\":1073741824,\
                       \"subconfig\":{\
                          \"size\":1073741824\
                          }\
                      }");
                  ASSERT(status == PMEMKV_STATUS_OK);

                  const char *path;
                  status = pmemkv_config_get_string(config_from_json, "path", &amp;path);
                  ASSERT(status == PMEMKV_STATUS_OK);
                  ASSERT(strcmp(path, "<a href="file:/dev/shm">/dev/shm</a>") == 0);

                  pmemkv_config *subconfig;

                  /* Get pointer to nested configuration "subconfig" */
                  status = pmemkv_config_get_object(config_from_json, "subconfig",
                                    (void **)&amp;subconfig);
                  ASSERT(status == PMEMKV_STATUS_OK);

                  size_t sub_size;
                  status = pmemkv_config_get_uint64(subconfig, "size", &amp;sub_size);
                  ASSERT(status == PMEMKV_STATUS_OK);
                  ASSERT(sub_size == 1073741824);

                  pmemkv_config_delete(config_from_json);

                  return 0;
              }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/libpmemkv.7.html">libpmemkv</a></b>(7), <b><a href="../man3/libpmemkv.3.html">libpmemkv</a></b>(3) , <b><a href="../man3/libpmemkv_json_config.3.html">libpmemkv_json_config</a></b>(3) and <b>&lt;https://pmem.io&gt;</b>

PMEMKV - pmemkv version 1.5.0                      2022-03-09                                   <u><a href="../man3/PMEMKV_CONFIG.3.html">PMEMKV_CONFIG</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>