<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKCS7_verify, PKCS7_get0_signers - verify a PKCS#7 signedData structure</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libssl-doc">libssl-doc_3.5.0-2ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       PKCS7_verify, PKCS7_get0_signers - verify a PKCS#7 signedData structure

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;openssl/pkcs7.h&gt;

        int PKCS7_verify(PKCS7 *p7, STACK_OF(X509) *certs, X509_STORE *store,
                         BIO *indata, BIO *out, int flags);

        STACK_OF(X509) *PKCS7_get0_signers(PKCS7 *p7, STACK_OF(X509) *certs, int flags);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>PKCS7_verify()</b> is very similar to <b><a href="../man3/CMS_verify.3.html">CMS_verify</a></b>(3).  It verifies a PKCS#7 signedData structure given in <u>p7</u>.
       The optional <u>certs</u> parameter refers to a set of certificates in which to search for signer's
       certificates.  It is also used as a source of untrusted intermediate CA certificates for chain building.
       <u>p7</u> may contain extra untrusted CA certificates that may be used for chain building as well as CRLs that
       may be used for certificate validation.  <u>store</u> may be NULL or point to the trusted certificate store to
       use for chain verification.  <u>indata</u> refers to the signed data if the content is detached from <u>p7</u>.
       Otherwise <u>indata</u> should be NULL, and then the signed data must be in <u>p7</u>.  The content is written to the
       BIO <u>out</u> unless it is NULL.  <u>flags</u> is an optional set of flags, which can be used to modify the operation.

       <b>PKCS7_get0_signers()</b> retrieves the signer's certificates from <u>p7</u>, it does <b>not</b> check their validity or
       whether any signatures are valid. The <u>certs</u> and <u>flags</u> parameters have the same meanings as in
       <b>PKCS7_verify()</b>.

</pre><h4><b>VERIFY</b> <b>PROCESS</b></h4><pre>
       Normally the verify process proceeds as follows.

       Initially some sanity checks are performed on <u>p7</u>. The type of <u>p7</u> must be SignedData. There must be at
       least one signature on the data and if the content is detached <u>indata</u> cannot be NULL.  If the content is
       not detached and <u>indata</u> is not NULL then the structure has both embedded and external content. To treat
       this as an error, use the flag <b>PKCS7_NO_DUAL_CONTENT</b>.  The default behavior allows this, for
       compatibility with older versions of OpenSSL.

       An attempt is made to locate all the signer's certificates, first looking in the <u>certs</u> parameter (if it
       is not NULL). Then they are looked up in any certificates contained in the <u>p7</u> structure unless
       <b>PKCS7_NOINTERN</b> is set.  If any signer's certificates cannot be located the operation fails.

       Each signer's certificate is chain verified using the <b>smimesign</b> purpose and using the trusted certificate
       store <u>store</u> if supplied.  Any internal certificates in the message, which may have been added using
       <b><a href="../man3/PKCS7_add_certificate.3.html">PKCS7_add_certificate</a></b>(3), are used as untrusted CAs unless <b>PKCS7_NOCHAIN</b> is set.  If CRL checking is
       enabled in <u>store</u> and <b>PKCS7_NOCRL</b> is not set, any internal CRLs, which may have been added using
       <b><a href="../man3/PKCS7_add_crl.3.html">PKCS7_add_crl</a></b>(3), are used in addition to attempting to look them up in <u>store</u>.  If <u>store</u> is not NULL and
       any chain verify fails an error code is returned.

       Finally the signed content is read (and written to <u>out</u> unless it is NULL) and the signature is checked.

       If all signatures verify correctly then the function is successful.

       Any of the following flags (ored together) can be passed in the <u>flags</u> parameter to change the default
       verify behaviour.  Only the flag <b>PKCS7_NOINTERN</b> is meaningful to <b>PKCS7_get0_signers()</b>.

       If <b>PKCS7_NOINTERN</b> is set the certificates in the message itself are not searched when locating the
       signer's certificates.  This means that all the signer's certificates must be in the <u>certs</u> parameter.

       If <b>PKCS7_NOCRL</b> is set and CRL checking is enabled in <u>store</u> then any CRLs in the message itself are
       ignored.

       If the <b>PKCS7_TEXT</b> flag is set MIME headers for type "text/plain" are deleted from the content. If the
       content is not of type "text/plain" then an error is returned.

       If <b>PKCS7_NOVERIFY</b> is set the signer's certificates are not chain verified.

       If <b>PKCS7_NOCHAIN</b> is set then the certificates contained in the message are not used as untrusted CAs.
       This means that the whole verify chain (apart from the signer's certificates) must be contained in the
       trusted store.

       If <b>PKCS7_NOSIGS</b> is set then the signatures on the data are not checked.

</pre><h4><b>NOTES</b></h4><pre>
       One application of <b>PKCS7_NOINTERN</b> is to only accept messages signed by a small number of certificates.
       The acceptable certificates would be passed in the <u>certs</u> parameter. In this case if the signer's
       certificate is not one of the certificates supplied in <u>certs</u> then the verify will fail because the signer
       cannot be found.

       Care should be taken when modifying the default verify behaviour, for example setting
       "PKCS7_NOVERIFY|PKCS7_NOSIGS" will totally disable all verification and any signed message will be
       considered valid. This combination is however useful if one merely wishes to write the content to <u>out</u> and
       its validity is not considered important.

       Chain verification should arguably be performed using the signing time rather than the current time.
       However, since the signing time is supplied by the signer it cannot be trusted without additional
       evidence (such as a trusted timestamp).

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>PKCS7_verify()</b> returns 1 for a successful verification and 0 if an error occurs.

       <b>PKCS7_get0_signers()</b> returns all signers or NULL if an error occurred.

       The error can be obtained from <b><a href="../man3/ERR_get_error.3.html">ERR_get_error</a></b>(3).

</pre><h4><b>BUGS</b></h4><pre>
       The trusted certificate store is not searched for the signer's certificates.  This is primarily due to
       the inadequacies of the current <b>X509_STORE</b> functionality.

       The lack of single pass processing means that the signed content must all be held in memory if it is not
       detached.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/CMS_verify.3.html">CMS_verify</a></b>(3), <b><a href="../man3/PKCS7_add_certificate.3.html">PKCS7_add_certificate</a></b>(3), <b><a href="../man3/PKCS7_add_crl.3.html">PKCS7_add_crl</a></b>(3), <b><a href="../man3/ERR_get_error.3.html">ERR_get_error</a></b>(3), <b><a href="../man3/PKCS7_sign.3.html">PKCS7_sign</a></b>(3)

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2002-2024 The OpenSSL Project Authors. All Rights Reserved.

       Licensed under the Apache License 2.0 (the "License").  You may not use this file except in compliance
       with the License.  You can obtain a copy in the file LICENSE in the source distribution or at
       &lt;https://www.openssl.org/source/license.html&gt;.

3.5.0                                              2025-06-04                                 <u><a href="../man3SSL/PKCS7_VERIFY.3SSL.html">PKCS7_VERIFY</a></u>(3SSL)
</pre>
 </div>
</div></section>
</div>
</body>
</html>