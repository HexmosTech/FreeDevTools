<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>libssh2_userauth_publickey_sk - authenticate a session with a FIDO2 authenticator</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libssh2-1-dev">libssh2-1-dev_1.11.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       libssh2_userauth_publickey_sk - authenticate a session with a FIDO2 authenticator

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;libssh2.h&gt;

       int
       libssh2_userauth_publickey_sk(LIBSSH2_SESSION *session,
                                     const char *username,
                                     size_t username_len,
                                     const unsigned char *publickeydata,
                                     size_t publickeydata_len,
                                     const char *privatekeydata,
                                     size_t privatekeydata_len,
                                     const char *passphrase,
                                     LIBSSH2_USERAUTH_SK_SIGN_FUNC((*sign_callback)),
                                     void **abstract);

</pre><h4><b>CALLBACK</b></h4><pre>
       #define LIBSSH2_SK_PRESENCE_REQUIRED     0x01
       #define LIBSSH2_SK_VERIFICATION_REQUIRED 0x04

       typedef struct _LIBSSH2_SK_SIG_INFO {
           uint8_t flags;
           uint32_t counter;
           unsigned char *sig_r;
           size_t sig_r_len;
           unsigned char *sig_s;
           size_t sig_s_len;
       } LIBSSH2_SK_SIG_INFO;

       int name(LIBSSH2_SESSION *session, LIBSSH2_SK_SIG_INFO *sig_info,
                const unsigned char *data, size_t data_len, int algorithm,
                uint8_t flags, const char *application,
                const unsigned char *key_handle, size_t handle_len,
                void **abstract);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>session</u> - Session instance as returned by <b><a href="../man3/libssh2_session_init_ex.3.html">libssh2_session_init_ex</a>(3)</b>

       <u>username</u> - Name of user to attempt authentication for.

       <u>username_len</u> - Length of username parameter.

       <u>publickeydata</u>  -  Buffer  containing  the  contents of a public key file. If NULL, the public key will be
       extracted from the privatekeydata. When using certificate authentication, this buffer should contain  the
       public certificate data.

       <u>publickeydata_len</u> - Length of public key data.

       <u>privatekeydata</u> - Buffer containing the contents of a private key file.

       <u>privatekeydata_len</u> - Length of private key data.

       <u>passphrase</u> - Passphrase to use when decoding private key file.

       <u>sign_callback</u> - Callback to communicate with FIDO2 authenticator.

       <u>abstract</u> - User-provided data to pass to callback.

       Attempt    FIDO2    authentication.    using   either   the   <a href="mailto:sk-ssh-ed25519@openssh.com">sk-ssh-ed25519@openssh.com</a>   or   sk-ecdsa-
       <a href="mailto:sha2-nistp256@openssh.com">sha2-nistp256@openssh.com</a> key exchange algorithms.

       This function is only supported when libssh2 is backed by OpenSSL.

</pre><h4><b>CALLBACK</b> <b>DESCRIPTION</b></h4><pre>
       <u>session</u> - Session instance as returned by <b><a href="../man3/libssh2_session_init_ex.3.html">libssh2_session_init_ex</a>(3)</b>

       <u>sig_info</u> - Filled  in  by  the  callback  with  the  signature  and  accompanying  information  from  the
       authenticator.

       <u>data</u> - The data to sign.

       <u>data_len</u> - The length of the data parameter.

       <u>algorithm</u>  -  The  signing  algorithm  to  use.  Possible  values  are  LIBSSH2_HOSTKEY_TYPE_ED25519  and
       LIBSSH2_HOSTKEY_TYPE_ECDSA_256.

       <u>flags</u> - A bitmask specifying options for the authenticator. When LIBSSH2_SK_PRESENCE_REQUIRED is set, the
       authenticator requires a touch. When LIBSSH2_SK_VERIFICATION_REQUIRED is set, the authenticator  requires
       a  PIN.   Many  servers  and authenticators do not work properly when LIBSSH2_SK_PRESENCE_REQUIRED is not
       set.

       <u>application</u> - A user-defined string to use as the RP name for the authenticator. Usually "ssh:".

       <u>key_handle</u> - The key handle to use for the authenticator's allow list.

       <u>handle_len</u> - The length of the key_handle parameter.

       <u>abstract</u> - User-defined data. When a PIN is required, use this to pass in the PIN, or a function  pointer
       to retrieve the PIN.

       The  <u>sign_callback</u>  is  responsible  for  communicating  with  the  hardware  authenticator to generate a
       signature. On success, the signature information must be placed in the `<u>sig_info</u> sig_info  parameter  and
       the callback must return 0. On failure, it should return a negative number.

       The fields of the LIBSSH2_SK_SIG_INFO are as follows.

       <u>flags</u>  -  A  bitmask specifying options for the authenticator. This should be read from the authenticator
       and not merely copied from the flags parameter to the callback.

       <u>counter</u> - A value returned from the authenticator.

       <u>sig_r</u> - For Ed25519 signatures, this contains  the  entire  signature,  as  returned  directly  from  the
       authenticator.  For  ECDSA  signatures,  this  contains  the r component of the signature in a big-endian
       binary representation. For both algorithms, use LIBSSH2_ALLOC to allocate memory. It will be freed by the
       caller.

       <u>sig_r_len</u> - The length of the sig_r parameter.

       <u>sig_s</u> - For ECDSA signatures, this contains the s component of  the  signature  in  a  big-endian  binary
       representation.  Use  LIBSSH2_ALLOC  to  allocate  memory.  It  will  be freed by the caller. For Ed25519
       signatures, set this to NULL.

       <u>sig_s_len</u> - The length of the sig_s parameter.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       Return 0 on success or negative on failure. It  returns  LIBSSH2_ERROR_EAGAIN  when  it  would  otherwise
       block. While LIBSSH2_ERROR_EAGAIN is a negative number, it is not really a failure per se.

</pre><h4><b>ERRORS</b></h4><pre>
       Some of the errors this function may return include:

       <u>LIBSSH2_ERROR_ALLOC</u> - An internal memory allocation call failed.

       <u>LIBSSH2_ERROR_SOCKET_SEND</u> - Unable to send data on socket.

       <u>LIBSSH2_ERROR_AUTHENTICATION_FAILED</u> - failed, invalid username/key.

</pre><h4><b>AVAILABILITY</b></h4><pre>
       Added in libssh2 1.10.0

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/libssh2_session_init_ex.3.html">libssh2_session_init_ex</a>(3)</b>

libssh2                                            1 Jun 2022                   <u><a href="../man3/libssh2_userauth_publickey_sk.3.html">libssh2_userauth_publickey_sk</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>