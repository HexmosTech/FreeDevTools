<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-posix-dev">manpages-posix-dev_2017a-2_all</a> <br><br><pre>
</pre><h4><b>PROLOG</b></h4><pre>
       This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface
       may differ (consult the corresponding Linux manual page for details of Linux behavior), or the  interface
       may not be implemented on Linux.

</pre><h4><b>NAME</b></h4><pre>
       getc_unlocked, getchar_unlocked, putc_unlocked, putchar_unlocked — stdio with explicit client locking

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;

       int getc_unlocked(FILE *<u>stream</u>);
       int getchar_unlocked(void);
       int putc_unlocked(int <u>c</u>, FILE *<u>stream</u>);
       int putchar_unlocked(int <u>c</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Versions  of  the  functions <u>getc</u>(), <u>getchar</u>(), <u>putc</u>(), and <u>putchar</u>() respectively named <u>getc_unlocked</u>(),
       <u>getchar_unlocked</u>(), <u>putc_unlocked</u>(), and <u>putchar_unlocked</u>() shall  be  provided  which  are  functionally
       equivalent to the original versions, with the exception that they are not required to be implemented in a
       fully thread-safe manner. They shall be thread-safe when used within a scope protected by <u>flockfile</u>() (or
       <u>ftrylockfile</u>()) and <u>funlockfile</u>().  These functions can safely be used in a multi-threaded program if and
       only  if  they  are  called  while  the  invoking thread owns the (<b>FILE</b> <b>*</b>) object, as is the case after a
       successful call to the <u>flockfile</u>() or <u>ftrylockfile</u>() functions.

       If <u>getc_unlocked</u>() or <u>putc_unlocked</u>() are implemented as macros they may evaluate <u>stream</u> more than  once,
       so the <u>stream</u> argument should never be an expression with side-effects.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       See <u>getc</u>(), <u>getchar</u>(), <u>putc</u>(), and <u>putchar</u>().

</pre><h4><b>ERRORS</b></h4><pre>
       See <u>getc</u>(), <u>getchar</u>(), <u>putc</u>(), and <u>putchar</u>().

       <u>The</u> <u>following</u> <u>sections</u> <u>are</u> <u>informative.</u>

</pre><h4><b>EXAMPLES</b></h4><pre>
       None.

</pre><h4><b>APPLICATION</b> <b>USAGE</b></h4><pre>
       Since  they  may  be  implemented  as macros, <u>getc_unlocked</u>() and <u>putc_unlocked</u>() may treat incorrectly a
       <u>stream</u> argument with side-effects. In particular, <u>getc_unlocked</u>(*f++) and  <u>putc_unlocked</u>(c,*f++)  do  not
       necessarily work as expected.  Therefore, use of these functions in such situations should be preceded by
       the following statement as appropriate:

           #undef getc_unlocked
           #undef putc_unlocked

</pre><h4><b>RATIONALE</b></h4><pre>
       Some  I/O  functions are typically implemented as macros for performance reasons (for example, <u>putc</u>() and
       <u>getc</u>()).  For safety, they need to be synchronized, but it is often too expensive to synchronize on every
       character. Nevertheless, it was felt that the safety concerns  were  more  important;  consequently,  the
       <u>getc</u>(),  <u>getchar</u>(),  <u>putc</u>(),  and  <u>putchar</u>()  functions are required to be thread-safe. However, unlocked
       versions are also provided with names that clearly indicate the unsafe nature of their operation but  can
       be  used  to  exploit  their  higher performance.  These unlocked versions can be safely used only within
       explicitly locked program regions, using exported locking primitives. In particular, a sequence such as:

           flockfile(fileptr);
           putc_unlocked('1', fileptr);
           putc_unlocked('\n', fileptr);
           fprintf(fileptr, "Line 2\n");
           funlockfile(fileptr);

       is permissible, and results in the text sequence:

           1
           Line 2

       being printed without being interspersed with output from other threads.

       It would be wrong to have the standard names such as <u>getc</u>(), <u>putc</u>(), and so on, map to the ``faster,  but
       unsafe''  rather  than the ``slower, but safe'' versions. In either case, you would still want to inspect
       all uses of <u>getc</u>(), <u>putc</u>(), and so on, by hand when converting existing code. Choosing the safe  bindings
       as  the  default,  at  least,  results  in  correct  code and maintains the ``atomicity at the function''
       invariant. To do otherwise would introduce gratuitous synchronization errors into converted code.   Other
       routines that modify the <u>stdio</u> (<b>FILE</b> <b>*</b>) structures or buffers are also safely synchronized.

       Note  that there is no need for functions of the form <u>getc_locked</u>(), <u>putc_locked</u>(), and so on, since this
       is the functionality of <u>getc</u>(), <u>putc</u>(), <u>et</u> <u>al</u>.  It would be inappropriate to use a feature test macro  to
       switch  a  macro definition of <u>getc</u>() between <u>getc_locked</u>() and <u>getc_unlocked</u>(), since the ISO C standard
       requires an actual function to exist, a function whose behavior could not be changed by the feature  test
       macro.  Also,  providing both the <u>xxx_locked</u>() and <u>xxx_unlocked</u>() forms leads to the confusion of whether
       the suffix describes the behavior of the function or the circumstances under which it should be used.

       Three additional routines, <u>flockfile</u>(), <u>ftrylockfile</u>(), and <u>funlockfile</u>()  (which  may  be  macros),  are
       provided to allow the user to delineate a sequence of I/O statements that are executed synchronously.

       The  <u>ungetc</u>()  function  is  infrequently  called  relative  to the other functions/macros so no unlocked
       variation is needed.

</pre><h4><b>FUTURE</b> <b>DIRECTIONS</b></h4><pre>
       None.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>Section</u> <u>2.5</u>, <u>Standard</u> <u>I/O</u> <u>Streams</u>, <u>flockfile</u>(), <u>getc</u>(), <u>getchar</u>(), <u>putc</u>(), <u>putchar</u>()

       The Base Definitions volume of POSIX.1‐2017, <b>&lt;stdio.h&gt;</b>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1-2017, Standard
       for Information  Technology  --  Portable  Operating  System  Interface  (POSIX),  The  Open  Group  Base
       Specifications  Issue  7, 2018 Edition, Copyright (C) 2018 by the Institute of Electrical and Electronics
       Engineers, Inc and The Open Group.  In the event of any discrepancy between this version and the original
       IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee  document.
       The original Standard can be obtained online at <a href="http://www.opengroup.org/unix/online.html">http://www.opengroup.org/unix/online.html</a> .

       Any  typographical  or formatting errors that appear in this page are most likely to have been introduced
       during  the  conversion  of  the  source  files  to  man  page  format.  To  report  such   errors,   see
       https://www.kernel.org/doc/man-pages/reporting_bugs.html .

IEEE/The Open Group                                   2017                                 <u><a href="../man3POSIX/GETC_UNLOCKED.3POSIX.html">GETC_UNLOCKED</a></u>(3POSIX)
</pre>
 </div>
</div></section>
</div>
</body>
</html>