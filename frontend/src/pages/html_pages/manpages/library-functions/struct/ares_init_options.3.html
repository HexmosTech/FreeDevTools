<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ares_init_options, ares_init - Initialize a resolver channel</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libc-ares-dev">libc-ares-dev_1.34.5-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ares_init_options, ares_init - Initialize a resolver channel

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;ares.h&gt;

       struct ares_server_failover_options {
         unsigned short retry_chance;
         size_t retry_delay;
       };

       struct ares_options {
         int flags;
         int timeout; /* in seconds or milliseconds, depending on options */
         int tries;
         int ndots;
         unsigned short udp_port;
         unsigned short tcp_port;
         int socket_send_buffer_size;
         int socket_receive_buffer_size;
         struct in_addr *servers;
         int nservers;
         char **domains;
         int ndomains;
         char *lookups;
         ares_sock_state_cb sock_state_cb;
         void *sock_state_cb_data;
         struct apattern *sortlist;
         int nsort;
         int ednspsz;
         char *resolvconf_path;
         char *hosts_path;
         int udp_max_queries;
         int maxtimeout; /* in milliseconds */
         unsigned int qcache_max_ttl; /* in seconds */
         ares_evsys_t evsys;
         struct ares_server_failover_options server_failover_opts;
       };

       int ares_init_options(ares_channel_t **<u>channelptr</u>,
                             const struct ares_options *<u>options</u>,
                             int <u>optmask</u>);

       int ares_init(ares_channel_t **<u>channelptr</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b><a href="../man3/ares_init.3.html">ares_init</a>(3)</b>  function  is  equivalent  to  calling  <b>ares_init_options(channelptr,</b>  <b>NULL,</b> <b>0)</b>.  It is
       recommended to use <b><a href="../man3/ares_init_options.3.html">ares_init_options</a>(3)</b> instead and to set or make configurable the  appropriate  options
       for your application.

       The  <b><a href="../man3/ares_init_options.3.html">ares_init_options</a>(3)</b>  function initializes a communications channel for name service lookups.  If it
       returns successfully, <b><a href="../man3/ares_init_options.3.html">ares_init_options</a>(3)</b> will set the variable pointed to by  <u>channelptr</u>  to  a  handle
       used  to  identify the name service channel.  The caller should invoke <u><a href="../man3/ares_destroy.3.html">ares_destroy</a>(3)</u> on the handle when
       the channel is no longer needed.

       It is recommended for an application to have at most one ares channel and use this for  all  DNS  queries
       for  the  life  of  the  application.  When system configuration changes, <u><a href="../man3/ares_reinit.3.html">ares_reinit</a>(3)</u> can be called to
       reload the configuration if necessary.  The recommended concurrent query limit is about 32k queries,  but
       remembering  that  when  specifying  AF_UNSPEC for <b><a href="../man3/ares_getaddrinfo.3.html">ares_getaddrinfo</a>(3)</b> or <b><a href="../man3/ares_gethostbyname.3.html">ares_gethostbyname</a>(3)</b>, they may
       spawn 2 queries internally.  The reason for the limit is c-ares does not allow duplicate  DNS  query  ids
       (which  have  a  maximum  of  64k)  to  be oustanding at a given time, and it must randomly search for an
       available id thus 32k will limit the number of searches.  This limitation should not  be  a  concern  for
       most implementations and c-ares may implement queuing in future releases to lift this limitation.

       The <u>optmask</u> parameter generally specifies which fields in the structure pointed to by <u>options</u> are set, as
       follows:

       <b>ARES_OPT_FLAGS</b>    <b>int</b> <u>flags</u><b>;</b>
                         Flags controlling the behavior of the resolver:

           <b>ARES_FLAG_USEVC</b>        Always  use  TCP  queries  (the  "virtual  circuit")  instead  of UDP queries.
                                  Normally, TCP is only used if a UDP query yields a truncated result.

           <b>ARES_FLAG_PRIMARY</b>      Only query the first server in the list of servers to query.

           <b>ARES_FLAG_IGNTC</b>        If a truncated response to a UDP query is received, do not fall back  to  TCP;
                                  simply continue on with the truncated response.

           <b>ARES_FLAG_NORECURSE</b>    Do  not  set the "recursion desired" bit on outgoing queries, so that the name
                                  server being contacted will not try to fetch the answer from other servers  if
                                  it  doesn't  know  the  answer  locally.  Be  aware  that ares will not do the
                                  recursion for you.  Recursion must be handled by the application calling  ares
                                  if <u>ARES_FLAG_NORECURSE</u> is set.

           <b>ARES_FLAG_STAYOPEN</b>     Do not close communications sockets when the number of active queries drops to
                                  zero.

           <b>ARES_FLAG_NOSEARCH</b>     Do  not  use  the  default  search  domains;  only query hostnames as-is or as
                                  aliases.

           <b>ARES_FLAG_NOALIASES</b>    Do not honor the HOSTALIASES environment variable, which normally specifies  a
                                  file of hostname translations.

           <b>ARES_FLAG_NOCHECKRESP</b>  Do  not  discard responses with the SERVFAIL, NOTIMP, or REFUSED response code
                                  or responses whose  questions  don't  match  the  questions  in  the  request.
                                  Primarily useful for writing clients which might be used to test or debug name
                                  servers.

           <b>ARES_FLAG_EDNS</b>         Include  an  EDNS pseudo-resource record (RFC 2671) in generated requests.  As
                                  of v1.22, this is on by default if flags are otherwise not set.

           <b>ARES_FLAG_NO_DFLT_SVR</b>  Do not attempt to add a default local named  server  if  there  are  no  other
                                  servers available.  Instead, fail initialization with <u>ARES_ENOSERVER</u>.

           <b>ARES_FLAG_DNS0x20</b>      Enable         support         for        DNS        0x20        as        per
                                  https://datatracker.ietf.org/doc/html/draft-vixie-dnsext-dns0x20-00 which adds
                                  additional entropy to the request by randomizing the case of the  query  name.
                                  Integrators  need to ensure they treat DNS name responses as case-insensitive.
                                  In rare circumstances this may cause the inability to lookup  certain  domains
                                  if  the  upstream  server  or  the authoritative server for the domain is non-
                                  compliant.

       <b>ARES_OPT_TIMEOUT</b>  <b>int</b> <u>timeout</u><b>;</b>
                         The number of seconds each name server is given to respond to a query on the first try.
                         See <u>ARES_OPT_TIMEOUTMS</u> which this value is converted into.

       <b>ARES_OPT_TIMEOUTMS</b>
                         <b>int</b> <u>timeout</u><b>;</b>
                         The number of milliseconds each name server is given to respond to a query on the first
                         try of any given server. The default is two seconds, however any value below 250ms will
                         automatically be set to 250ms (roughly the RTT half-way around the  world).  Note  that
                         this  option is specified with the same struct field as the former <u>ARES_OPT_TIMEOUT</u>, it
                         is but the option bits that tell c-ares how to interpret the number.  This  option  was
                         added in c-ares 1.5.2.

                         As  of  c-ares 1.32.0, this option is only honored on the first successful query to any
                         given server, after that the timeout is automatically calculated based on  prior  query
                         history.

       <b>ARES_OPT_TRIES</b>    <b>int</b> <u>tries</u><b>;</b>
                         The number of tries the resolver will try contacting each name server before giving up.
                         The default is three tries.

       <b>ARES_OPT_NDOTS</b>    <b>int</b> <u>ndots</u><b>;</b>
                         The  number of dots which must be present in a domain name for it to be queried for "as
                         is" prior to querying for it with the default domain extensions appended.  The  default
                         value is 1 unless set otherwise by resolv.conf or the RES_OPTIONS environment variable.
                         Valid range is 0-15.

       <b>ARES_OPT_MAXTIMEOUTMS</b>
                         <b>int</b> <u>maxtimeout</u><b>;</b>
                         The  upper bound for timeout between sequential retry attempts.  When retrying queries,
                         the timeout is increased from the requested timeout parameter, this caps the value.

       <b>ARES_OPT_UDP_PORT</b> <b>unsigned</b> <b>short</b> <u>udp_port</u><b>;</b>
                         The port to use for queries over UDP, in host byte order.  The default value is 53, the
                         standard name service port.

       <b>ARES_OPT_TCP_PORT</b> <b>unsigned</b> <b>short</b> <u>tcp_port</u><b>;</b>
                         The port to use for queries over TCP, in host byte order.  The default value is 53, the
                         standard name service port.

       <b>ARES_OPT_SERVERS</b>  <b>struct</b> <b>in_addr</b> <b>*</b><u>servers</u><b>;</b>
                         <b>int</b> <u>nservers</u><b>;</b>
                         The list of IPv4 servers to contact, instead of the servers specified in resolv.conf or
                         the local named. In order to allow specification of either IPv4 or IPv6  name  servers,
                         the <b>0</b> <b>instead.</b>

       <b>ARES_OPT_DOMAINS</b>  <b>char</b> <b>**</b><u>domains</u><b>;</b>
                         <b>int</b> <u>ndomains</u><b>;</b>
                         The  domains  to  search, instead of the domains specified in resolv.conf or the domain
                         derived from the kernel hostname variable.

       <b>ARES_OPT_LOOKUPS</b>  <b>char</b> <b>*</b><u>lookups</u><b>;</b>
                         The lookups to perform for host queries.  <u>lookups</u> should be set  to  a  string  of  the
                         characters  "b"  or "f", where "b" indicates a DNS lookup and "f" indicates a lookup in
                         the hosts file.

       <b>ARES_OPT_SOCK_STATE_CB</b>
                         <b>void</b> <b>(*</b><u>sock_state_cb</u><b>)(void</b> <b>*data,</b> <b>ares_socket_t</b> <b>socket_fd,</b> <b>int</b> <b>readable,</b> <b>int</b> <b>writable);</b>
                         <b>void</b> <b>*</b><u>sock_state_cb_data</u><b>;</b>
                         A callback function to be invoked when a  socket  changes  state.   <u>socket_fd</u>  will  be
                         passed  the  socket whose state has changed; <u>readable</u> will be set to true if the socket
                         should listen for read events, and <u>writable</u> will be set to true if  the  socket  should
                         listen  for  write  events.  The value of <u>sock_state_cb_data</u> will be passed as the <u>data</u>
                         argument.  The channel lock is  held  during  this  callback,  if  in  a  multithreaded
                         application,  care  must  be taken to ensure lock order is correct to be able to handle
                         this and avoid deadlocks.

                         Cannot be used with <b>ARES_OPT_EVENT_THREAD</b>.

       <b>ARES_OPT_SORTLIST</b> <b>struct</b> <b>apattern</b> <b>*</b><u>sortlist</u><b>;</b>
                         <b>int</b> <u>nsort</u><b>;</b>
                         A list of IP address ranges that specifies the order of preference  that  results  from
                         <u>ares_gethostbyname</u>  should  be  returned  in.   Note  that this can only be used with a
                         sortlist retrieved via <b><a href="../man3/ares_save_options.3.html">ares_save_options</a>(3)</b> (because <b>struct</b> <b>apattern</b> is opaque); to set
                         a fresh sort list, use <b><a href="../man3/ares_set_sortlist.3.html">ares_set_sortlist</a>(3)</b>.

       <b>ARES_OPT_SOCK_SNDBUF</b>
                         <b>int</b> <u>socket_send_buffer_size</u><b>;</b>
                         The send buffer size to set for the socket.

       <b>ARES_OPT_SOCK_RCVBUF</b>
                         <b>int</b> <u>socket_receive_buffer_size</u><b>;</b>
                         The receive buffer size to set for the socket.

       <b>ARES_OPT_EDNSPSZ</b>  <b>int</b> <u>ednspsz</u><b>;</b>
                         The message size to be advertised in EDNS; only takes effect if the <b>ARES_FLAG_EDNS</b> flag
                         is set.  Defaults to 1232, the recommended size.

       <b>ARES_OPT_RESOLVCONF</b>
                         <b>char</b> <b>*</b><u>resolvconf_path</u><b>;</b>
                         The path to use for reading the resolv.conf file. The <u>resolvconf_path</u> should be set  to
                         a   path   string,  and  will  be  honoured  on  *nix  like  systems.  The  default  is
                         <b><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></b>

       <b>ARES_OPT_HOSTS_FILE</b>
                         <b>char</b> <b>*</b><u>hosts_path</u><b>;</b>
                         The path to use for reading the hosts file. The <u>hosts_path</u> should  be  set  to  a  path
                         string, and will be honoured on *nix like systems. The default is <b><a href="file:/etc/hosts">/etc/hosts</a></b>

       <b>ARES_OPT_UDP_MAX_QUERIES</b>
                         <b>int</b> <u>udp_max_queries</u><b>;</b>
                         The  maximum  number  of  udp  queries that can be sent on a single ephemeral port to a
                         given DNS server before a new ephemeral port is assigned.  Any value of 0 or less  will
                         be considered unlimited, and is the default.

       <b>ARES_OPT_QUERY_CACHE</b>
                         <b>unsigned</b> <b>int</b> <u>qcache_max_ttl</u><b>;</b>
                         As  of  c-ares  1.31.0,  the  query  cache is enabled by default with a TTL of 1hr.  To
                         disable the query cache, specify this option with a TTL of 0.  The query cache is based
                         on the returned TTL in the DNS message.   Only  fully  successful  and  NXDOMAIN  query
                         results  will be cached.  Fill in the <u>qcache_max_ttl</u> with the maximum number of seconds
                         a query result may be cached which will override a larger TTL in the response  message.
                         This must be a non-zero value otherwise the cache will be disabled. Choose a reasonable
                         value  for  your application such as 300 (5 minutes) or 3600 (1 hour).  The query cache
                         is automatically flushed if a server configuration change is made.

       <b>ARES_OPT_EVENT_THREAD</b>
                         <b>ares_evsys_t</b> <u>evsys</u><b>;</b>
                         Enable the built-in event thread (Recommended). Introduced in c-ares 1.26.0.   Set  the
                         <u>evsys</u>  parameter  to <b>ARES_EVSYS_DEFAULT</b> (0).  Other values are reserved for testing and
                         should not be used by integrators.

                         This  option  cannot  be  used  with  the  <b>ARES_OPT_SOCK_STATE_CB</b>   option,   nor   the
                         <u><a href="../man3/ares_set_socket_functions.3.html">ares_set_socket_functions</a>(3)</u> or <u><a href="../man3/ares_set_socket_configure_callback.3.html">ares_set_socket_configure_callback</a>(3)</u> functions.

                         When  enabled,  the  integrator  is  no  longer responsible for notifying c-ares of any
                         events on the file descriptors, so <u><a href="../man3/ares_process.3.html">ares_process</a>(3)</u> nor <u><a href="../man3/ares_process_fd.3.html">ares_process_fd</a>(3)</u>  should  ever
                         be called when this option is enabled.

                         As  of  c-ares  1.29.0,  when  enabled,  it  will also automatically re-load the system
                         configuration when changes are detected.

                         Use <u><a href="../man3/ares_threadsafety.3.html">ares_threadsafety</a>(3)</u> to determine if this option is available to be used.

                         Returns <b>ARES_ENOTIMP</b> if this option is passed but not available, and <b>ARES_ESERVFAIL</b>  if
                         there is a critical failure during initialization of the event thread.

       <b>ARES_OPT_SERVER_FAILOVER</b>
                         <b>struct</b> <b>ares_server_failover_options</b> <u>server_failover_opts</u><b>;</b>
                         Configure  server  failover  retry  behavior.   When a DNS server fails to respond to a
                         query, c-ares will deprioritize the server.  On subsequent queries, servers with  fewer
                         consecutive  failures will be selected in preference.  However, in order to detect when
                         such a server has recovered, c-ares will occasionally retry failed servers  by  probing
                         with  a copy of the query, without affecting the latency of the actual requested query.
                         The <u>ares_server_failover_options</u> structure contains options to control  this  behavior.
                         The  <u>retry_chance</u>  field gives the probability (1/N) of retrying a failed server on any
                         given query.  Setting to a value of 0 disables retries.  The  <u>retry_delay</u>  field  gives
                         the  minimum  delay  in  milliseconds  that c-ares will wait before retrying a specific
                         failed server.  If this option is not specificed then c-ares will use a probability  of
                         10% and a minimum delay of 5 seconds.

       The  <u>optmask</u> parameter also includes options without a corresponding field in the <b>ares_options</b> structure,
       as follows:

       <b>ARES_OPT_ROTATE</b>        Perform round-robin selection of the nameservers configured for  the  channel  for
                              each resolution.

       <b>ARES_OPT_NOROTATE</b>      Do   not  perform  round-robin  nameserver  selection;  always  use  the  list  of
                              nameservers in the same order.  The default is not to rotate servers, however  the
                              system configuration can specify the desire to rotate and this configuration value
                              can negate such a system configuration.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b><a href="../man3/ares_init_options.3.html">ares_init_options</a>(3)</b> and <b><a href="../man3/ares_init.3.html">ares_init</a>(3)</b> can return any of the following values:

       <b>ARES_SUCCESS</b>  Initialization succeeded.

       <b>ARES_EFILE</b>    A configuration file could not be read.

       <b>ARES_ENOMEM</b>   The process's available memory was exhausted.

       <b>ARES_ENOTINITIALIZED</b>
                     c-ares library initialization not yet performed.

       <b>ARES_ENOSERVER</b>
                     No DNS servers were available to use.

</pre><h4><b>NOTES</b></h4><pre>
       When  initializing  from  <b><a href="file:/etc/resolv.conf">/etc/resolv.conf</a>,</b> (or, alternatively when specified by the <u>resolvconf_path</u> path
       location) <b><a href="../man3/ares_init_options.3.html">ares_init_options</a>(3)</b> and <b><a href="../man3/ares_init.3.html">ares_init</a>(3)</b> reads the <u>domain</u> and <u>search</u> directives to  allow  lookups
       of  short names relative to the domains specified. The <u>domain</u> and <u>search</u> directives override one another.
       If more than one instance of either <u>domain</u> or <u>search</u> directives is specified, the last  occurrence  wins.
       For more information, please see the <b><a href="../man5/resolv.conf.5.html">resolv.conf</a></b>(5) manual page.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/ares_reinit.3.html">ares_reinit</a></b>(3),     <b><a href="../man3/ares_destroy.3.html">ares_destroy</a></b>(3),     <b><a href="../man3/ares_dup.3.html">ares_dup</a></b>(3),     <b><a href="../man3/ares_library_init.3.html">ares_library_init</a></b>(3),     <b><a href="../man3/ares_save_options.3.html">ares_save_options</a></b>(3),
       <b><a href="../man3/ares_set_servers.3.html">ares_set_servers</a></b>(3), <b><a href="../man3/ares_set_sortlist.3.html">ares_set_sortlist</a></b>(3), <b><a href="../man3/ares_threadsafety.3.html">ares_threadsafety</a></b>(3)

                                                  5 March 2010                              <u><a href="../man3/ARES_INIT_OPTIONS.3.html">ARES_INIT_OPTIONS</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>