<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tracecmd_map_vcpus, tracecmd_get_cpu_map, tracecmd_map_find_by_host_pid, tracecmd_map_get_host_pid,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/trace-cmd">trace-cmd_3.3.1-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tracecmd_map_vcpus, tracecmd_get_cpu_map, tracecmd_map_find_by_host_pid, tracecmd_map_get_host_pid,
       tracecmd_map_get_guest, tracecmd_map_set_private, tracecmd_map_get_private - Mapping host and guest data

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;trace-cmd.h&gt;</b>

       int <b>tracecmd_map_vcpus</b>(struct tracecmd_input **handles, int nr_handles);
       struct tracecmd_cpu_map *<b>tracecmd_get_cpu_map</b>(struct tracecmd_input *handle, int cpu);
       struct tracecmd_cpu_map *<b>tracecmd_map_find_by_host_pid</b>(struct tracecmd_input *handle,
                                                             int host_pid);
       int <b>tracecmd_map_get_host_pid</b>(struct tracecmd_cpu_map *map);
       struct tracecmd_input *<b>tracecmd_map_get_guest</b>(struct tracecmd_cpu_map *map);
       void <b>tracecmd_map_set_private</b>(struct tracecmd_cpu_map *map, void *priv);
       void *<b>tracecmd_map_get_private</b>(struct tracecmd_cpu_map *map);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This set of APIs is used to map host and guest trace files for to facilitate further tracing analysis.

       The <b>tracecmd_map_vcpus()</b> takes an array of <u>handles</u> where each item in that array was created by one of
       the <b><a href="../man3/tracecmd_open.3.html">tracecmd_open</a>(3)</b> functions, and the number of handles as <u>nr_handles</u>. The first handle in the array of
       <u>handles</u> is expected to be the descriptor for the host tracing file, and the rest are guest trace files
       that run on the host, and were created by the <b>trace-cmd</b> <b><a href="../man1/record.1.html">record</a>(1)</b> and <b>trace-cmd</b> <b><a href="../man1/agent.1.html">agent</a>(1)</b> interactions. It
       returns the number of guests found in <u>handles</u> that were associated with the host, or negative on error.

       The <b>tracecmd_get_cpu_map()</b> returns a descriptor for a given CPU for a handle. If the <u>handle</u> was a guest
       defined from <b>tracecmd_map_vcpus()</b> then the mapping created from that function that is associated to this
       particular vCPU (denoted by <u>cpu</u>) from <u>handle</u>. This destriptor can be used by <b>tarcecmd_map_get_guest()</b>,
       <b>tracecmd_map_set_private()</b> and <b>tracecmd_map_get_private()</b> functions.

       The <b>tracecmd_map_find_by_host_pid()</b> will return a mapping for a guest virtual CPU that is handled by the
       given <u>host_pid</u>. Note, the <u>handle</u> passed in can be either the host handle or one of the guestâ€™s handles
       for that host that was mapped by <b>tracecmd_map_vcpus()</b>, even if the guest handle does not have the vCPU
       that the <u>host_pid</u> represents.

       The <b>tracecmd_map_get_host_pid()</b> will recturn the host_pid for a given <u>map</u> that was retrieved by one of
       the above functions.

       The <b>tracecmd_map_get_guest()</b> will recturn the guest_handle for a given <u>map</u> that was retrieved by one of
       the above functions.

       The <b>tracecmd_map_set_private()</b> allows the application to assign private data for a given guest vCPU to
       host thread mapping defined by <u>map</u>.

       The <b>tracecmd_map_get_private()</b> retrieves the <u>priv</u> data from <u>map</u> that was set by
       <b>tracecmd_map_set_private()</b>.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       <b>tracecmd_map_vcpus()</b> returns the number of guests in the <u>handles</u> array that were mapped to the host
       handle that is the first entry in <u>handles</u>. It returns -1 on error.

       <b>tracecmd_get_cpu_map()</b> returns a map created by <b>tracecmd_map_vcpus()</b> for a given <u>cpu</u> for a given <u>handle</u>,
       or NULL if it is not found.

       <b>tracecmd_map_find_by_host_pid()</b> returns a map that is associated by the host task with <u>host_pid</u> as its
       process ID. <u>handle</u> can be either a the host handle, or one of the guest handles that were mapped to the
       host via <b>tracecmd_map_vcpus()</b>, even if the guest handle is another guest than the one that the mapping is
       for. It returns NULL if not found.

       <b>tracecmd_map_get_host_pid()</b> returns the host process ID for an associated mapping defined by <u>map</u>.

       <b>tracecmd_map_get_guest()</b> returns the guest handle for an associated mapping defined by <u>map</u>.

       <b>tracecmd_map_get_private()</b> returns the private data of a mapping defined by <u>map</u> that was set by
       <b>tracecmd_map_set_private()</b>.

</pre><h4><b>EXAMPLE</b></h4><pre>
           #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
           #include &lt;<a href="file:/usr/include/errno.h">errno.h</a>&gt;
           #include &lt;trace-cmd.h&gt;

           int main(int argc, char **argv)
           {
                   struct tracecmd_input **handles = NULL;
                   int nr_handles;
                   int i;

                   if (argc &lt; 2) {
                           printf("usage: host_trace.dat guest1_trace.dat [guest2_trace.dat ...]\n");
                           exit(-1);
                   }

                   for (i = 1; i &lt; argc; i++) {
                           handles = realloc(handles, sizeof(*handles) * (nr_handles + 1));
                           if (!handles)
                                   exit(-1);
                           handles[nr_handles] = tracecmd_open(argv[i], 0);
                           if (!handles[nr_handles]) {
                                   perror(argv[1]);
                                   exit(-1);
                           }
                           tracecmd_set_private(handles[nr_handles], argv[i]);
                           nr_handles++;
                   }

                   tracecmd_map_vcpus(handles, nr_handles);

                   for (i = 1; i &lt; nr_handles; i++) {
                           struct tracecmd_cpu_map *map;
                           struct tep_handle *tep;
                           const char *file = tracecmd_get_private(handles[i]);
                           int cpus, cpu;

                           printf("Mappings for guest %s:\n", file);
                           tep = tracecmd_get_tep(handles[i]);
                           cpus = tep_get_cpus(tep);
                           for (cpu = 0; cpu &lt; cpus; cpu++) {
                                   printf("  [%03d] ", cpu);
                                   map = tracecmd_get_cpu_map(handles[i], cpu);
                                   if (!map) {
                                           printf("Has no mapping!\n");
                                           continue;
                                   }
                                   printf("host_pid: %d\n", <a href="../manmap/tracecmd_map_get_host_pid.map.html">tracecmd_map_get_host_pid</a>(map));
                           }
                   }
                   for (i = 0; i &lt; nr_handles; i++)
                           tracecmd_close(handles[i]);
                   free(handles);
                   <a href="../man0/exit.0.html">exit</a>(0);
           }

</pre><h4><b>FILES</b></h4><pre>
           <b>trace-cmd.h</b>
                   Header file to include in order to have access to the library APIs.
           <b>-ltracecmd</b>
                   Linker switch to add when building a program that uses the library.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/libtracefs.3.html">libtracefs</a>(3)</b>, <b><a href="../man3/libtraceevent.3.html">libtraceevent</a>(3)</b>, <b><a href="../man1/trace-cmd.1.html">trace-cmd</a>(1)</b> <b><a href="../man5/trace-cmd.dat.5.html">trace-cmd.dat</a>(5)</b>

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;<b><a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a></b>[1]&gt;

</pre><h4><b>LICENSE</b></h4><pre>
       libtracecmd is Free Software licensed under the GNU LGPL 2.1

</pre><h4><b>RESOURCES</b></h4><pre>
       <b>https://git.kernel.org/pub/scm/utils/trace-cmd/trace-cmd.git/</b>

</pre><h4><b>COPYING</b></h4><pre>
       Copyright (C) 2020 VMware, Inc. Free use of this software is granted under the terms of the GNU Public
       License (GPL).

</pre><h4><b>NOTES</b></h4><pre>
        1. <a href="mailto:linux-trace-devel@vger.kernel.org">linux-trace-devel@vger.kernel.org</a>
           <a href="mailto:linux-trace-devel@vger.kernel.org">mailto:linux-trace-devel@vger.kernel.org</a>

libtracefs                                         06/23/2025                                     <u><a href="../man3/LIBTRACECMD.3.html">LIBTRACECMD</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>