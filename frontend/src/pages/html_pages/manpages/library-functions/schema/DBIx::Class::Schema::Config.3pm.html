<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBIx::Class::Schema::Config - Credential Management for DBIx::Class</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libdbix-class-schema-config-perl">libdbix-class-schema-config-perl_0.001014-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       DBIx::Class::Schema::Config - Credential Management for DBIx::Class

</pre><h4><b>DESCRIPTION</b></h4><pre>
       DBIx::Class::Schema::Config is a subclass of DBIx::Class::Schema that allows the loading of credentials &amp;
       configuration from a file.  The actual code itself would only need to know about the name used in the
       configuration file. This aims to make it simpler for operations teams to manage database credentials.

       A simple tutorial that compliments this documentation and explains converting an existing DBIx::Class
       Schema to use this software to manage credentials can be found at
       &lt;<a href="http://www.symkat.com/credential-management-in-dbix-class">http://www.symkat.com/credential-management-in-dbix-class</a>&gt;

</pre><h4><b>SYNOPSIS</b></h4><pre>
           /etc/dbic.yaml
           MY_DATABASE:
               dsn: "dbi:Pg:host=localhost;database=blog"
               user: "TheDoctor"
               password: "dnoPydoleM"
               TraceLevel: 1

           package My::Schema
           use warnings;
           use strict;

           use base 'DBIx::Class::Schema::Config';
           __PACKAGE__-&gt;load_namespaces;

           package My::Code;
           use warnings;
           use strict;
           use My::Schema;

           my $schema = My::Schema-&gt;connect('MY_DATABASE');

           # arbitrary config access from anywhere in your $app
           my $level = My::Schema-&gt;config-&gt;{TraceLevel};

</pre><h4><b>CONFIG</b> <b>FILES</b></h4><pre>
       This module will load the files in the following order if they exist:

       •   $ENV{DBIX_CONFIG_DIR} . '/dbic',

           $ENV{DBIX_CONFIG_DIR} can be configured at run-time, for instance:

               DBIX_CONFIG_DIR="<a href="file:/var/local/">/var/local/</a>" ./my_program.pl

       •   ./dbic.*

       •   <a href="file:~/.dbic.">~/.dbic.</a>*

       •   /etc/dbic.*

       The files should have an extension that Config::Any recognizes, for example /etc/dbic.<b>yaml</b>.

       NOTE:   The  first  available  credential  will be used.  Therefore <u>DATABASE</u> in <a href="file:~/.dbic.yaml">~/.dbic.yaml</a> will only be
       looked at if it was not found in ./dbic.yaml.  If there are duplicates in one file (such that DATABASE is
       listed twice in <a href="file:~/.dbic.yaml">~/.dbic.yaml</a>,) the first configuration will be used.

</pre><h4><b>CHANGE</b> <b>CONFIG</b> <b>PATH</b></h4><pre>
       Use "__PACKAGE__-&gt;config_paths([( '/file/stub', '/var/www/etc/dbic')]);" to change  the  paths  that  are
       searched.  For example:

           package My::Schema
           use warnings;
           use strict;

           use base 'DBIx::Class::Schema::Config';
           __PACKAGE__-&gt;config_paths([( '/var/www/secret/dbic', '/opt/database' )]);

       The above code would have <u>/var/www/secret/dbic.*</u> and <u>/opt/database.*</u>  searched, in that order.  As above,
       the  first credentials found would be used.  This will replace the files originally searched for, not add
       to them.

</pre><h4><b>USE</b> <b>SPECIFIC</b> <b>CONFIG</b> <b>FILES</b></h4><pre>
       If you would rather explicitly state the configuration files you want  loaded,  you  can  use  the  class
       accessor "config_files" instead.

           package My::Schema
           use warnings;
           use strict;

           use base 'DBIx::Class::Schema::Config';
           __PACKAGE__-&gt;config_files([( '/var/www/secret/dbic.yaml', '/opt/database.yaml' )]);

       This  will  check  the  files,  "/var/www/secret/dbic.yaml",  and "/opt/database.yaml" in the same way as
       "config_paths", however it will only check the specific files, instead of  checking  for  each  extension
       that Config::Any supports.  You MUST use the extension that corresponds to the file type you are loading.
       See Config::Any for information on supported file types and extension mapping.

</pre><h4><b>ACCESSING</b> <b>THE</b> <b>CONFIG</b> <b>FILE</b></h4><pre>
       The  config  file  is stored via the  "__PACKAGE__-&gt;config" accessor, which can be called as both a class
       and instance method.

</pre><h4><b>OVERRIDING</b></h4><pre>
       The API has been designed to be simple  to  override  if  you  have  additional  needs  in  loading  DBIC
       configurations.

   <b>Mojo::Pg-Like</b> <b>Connection</b> <b>Strings</b>
       Calls to connect with Mojo::Pg-like URIs are supported.

           my $schema = My::Schema-&gt;connect( 'postgresql://username:password@localhost/dbname' );

   <b>Overriding</b> <b>Connection</b> <b>Configuration</b>
       Simple cases where one wants to replace specific configuration tokens can be given as extra parameters in
       the -&gt;connect call.

       For example, suppose we have the database MY_DATABASE from above:

           MY_DATABASE:
               dsn: "dbi:Pg:host=localhost;database=blog"
               user: "TheDoctor"
               password: "dnoPydoleM"
               TraceLevel: 1

       If you’d like to replace the username with “Eccleston” and we’d like to turn PrintError off.

       The following connect line would achieve this:

           $Schema-&gt;connect(“MY_DATABASE”, “Eccleston”, undef, { PrintError =&gt; 0 } );

       The  name  of  the  connection  to load from the configuration file is still given as the first argument,
       while other arguments may be given exactly as you would for any other call to "connect".

       Historical Note: This class accepts numerous ways to connect to DBIC that would otherwise not  be  valid.
       These connection methods are discouraged but tested for and kept for compatibility with earlier versions.
       For         valid         ways        of        connecting        to        DBIC        please        see
       &lt;https://metacpan.org/pod/DBIx::Class::Storage::DBI#connect_info&gt;

   <b>filter_loaded_credentials</b>
       Override this function if you want to change the loaded credentials before they are passed to DBIC.  This
       is useful for use-cases that include decrypting encrypted passwords or making programmatic changes to the
       configuration before using it.

           sub filter_loaded_credentials {
               my ( $class, $loaded_credentials, $connect_args ) = @_;
               ...
               return $loaded_credentials;
           }

       $loaded_credentials is the structure after it has been loaded from the configuration file.  In this case,
       "$loaded_credentials-&gt;{user}"      eq      <b>WalterWhite</b>      and      "$loaded_credentials-&gt;{dsn}"      eq
       <b>DBI:mysql:database=students;host=%s;port=3306</b>.

       $connect_args  is  the structure originally passed on "-&gt;connect()" after it has been turned into a hash.
       For instance, "-&gt;connect('DATABASE', 'USERNAME')" will result in "$connect_args-&gt;{dsn}" eq  <b>DATABASE</b>  and
       "$connect_args-&gt;{user}" eq <b>USERNAME</b>.

       Additional  parameters  can  be  added  by  appending  a  hashref, to the connection call, as an example,
       "-&gt;connect( 'CONFIG', { hostname =&gt; "db.foo.com" } );" will give $connect_args a structure like "{ dsn =&gt;
       'CONFIG', hostname =&gt; "db.foo.com" }".

       For instance, if you want to use hostnames when you make the initial connection to DBIC and are using the
       configuration primarily for usernames, passwords and other configuration data, you can  create  a  config
       like the following:

           DATABASE:
               dsn: "DBI:mysql:database=students;host=%s;port=3306"
               user: "WalterWhite"
               password: "relykS"

       In your Schema class, you could include the following:

           package My::Schema
           use warnings;
           use strict;
           use base 'DBIx::Class::Schema::Config';

           sub filter_loaded_credentials {
               my ( $class, $loaded_credentials, $connect_args ) = @_;
               if ( $loaded_credentials-&gt;{dsn} =~ /\%s/ ) {
                   $loaded_credentials-&gt;{dsn} = sprintf( $loaded_credentials-&gt;{dsn},
                       $connect_args-&gt;{hostname});
               }
           }

           __PACKAGE__-&gt;load_classes;
           1;

       Then the connection could be done with "$Schema-&gt;connect('DATABASE', { hostname =" 'my.hostname.com' });&gt;

       See  "load_credentials"  for  more  complex changes that require changing how the configuration itself is
       loaded.

   <b>load_credentials</b>
       Override this function to  change  the  way  that  DBIx::Class::Schema::Config  loads  credentials.   The
       function takes the class name, as well as a hashref.

       If  you take the route of having "-&gt;connect('DATABASE')" used as a key for whatever configuration you are
       loading, <u>DATABASE</u> would be "$config-&gt;{dsn}"

           Some::Schema-&gt;connect(
               "SomeTarget",
               "Yuri",
               "Yawny",
               {
                   TraceLevel =&gt; 1
               }
           );

       Would result in the following data structure as $config in "load_credentials($class, $config)":

           {
               dsn             =&gt; "SomeTarget",
               user            =&gt; "Yuri",
               password        =&gt; "Yawny",
               TraceLevel      =&gt; 1,
           }

       Currently, load_credentials will NOT be called if the first argument to "-&gt;connect()" looks like a  valid
       DSN.  This is determined by match the DSN with "/^dbi:/i".

       The function should return the same structure.  For instance:

           package My::Schema
           use warnings;
           use strict;
           use base 'DBIx::Class::Schema::Config';
           use LWP::Simple;
           use JSON

           # Load credentials from internal web server.
           sub load_credentials {
               my ( $class, $config ) = @_;

               return decode_json(
                   get( "<a href="http://someserver.com/v1.0/database">http://someserver.com/v1.0/database</a>?key=somesecret&amp;db=" .
                       $config-&gt;{dsn}  ));
           }

           __PACKAGE__-&gt;load_classes;

</pre><h4><b>AUTHOR</b></h4><pre>
       Kaitlyn Parkhurst (SymKat) <u>&lt;<a href="mailto:symkat@symkat.com">symkat@symkat.com</a>&gt;</u> ( Blog: &lt;<a href="http://symkat.com/">http://symkat.com/</a>&gt; )

</pre><h4><b>CONTRIBUTORS</b></h4><pre>
       •   Matt S. Trout (mst) <u>&lt;<a href="mailto:mst@shadowcat.co.uk">mst@shadowcat.co.uk</a>&gt;</u>

       •   Peter Rabbitson (ribasushi) <u>&lt;<a href="mailto:ribasushi@cpan.org">ribasushi@cpan.org</a>&gt;</u>

       •   Christian Walde (Mihtaldu) <u>&lt;<a href="mailto:walde.christian@googlemail.com">walde.christian@googlemail.com</a>&gt;</u>

       •   Dagfinn Ilmari Mannsåker (ilmari) <u>&lt;<a href="mailto:ilmari@ilmari.org">ilmari@ilmari.org</a>&gt;</u>

       •   Matthew Phillips (mattp)  <u>&lt;<a href="mailto:mattp@cpan.org">mattp@cpan.org</a>&gt;</u>

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       This library is free software and may be distributed under the same terms as perl itself.

</pre><h4><b>AVAILABILITY</b></h4><pre>
       The latest version of this software is available at &lt;https://github.com/symkat/DBIx-Class-Schema-Config&gt;

perl v5.34.0                                       2022-03-20                   <u>DBIx::Class::Schema::<a href="../man3pm/Config.3pm.html">Config</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>