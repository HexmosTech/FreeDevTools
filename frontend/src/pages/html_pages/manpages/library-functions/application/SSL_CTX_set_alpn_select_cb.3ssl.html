<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSL_CTX_set_alpn_protos, SSL_set_alpn_protos, SSL_CTX_set_alpn_select_cb,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libssl-doc">libssl-doc_3.5.0-2ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       SSL_CTX_set_alpn_protos, SSL_set_alpn_protos, SSL_CTX_set_alpn_select_cb,
       SSL_CTX_set_next_proto_select_cb, SSL_CTX_set_next_protos_advertised_cb, SSL_select_next_proto,
       SSL_get0_alpn_selected, SSL_get0_next_proto_negotiated - handle application layer protocol negotiation
       (ALPN)

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;openssl/ssl.h&gt;

        int SSL_CTX_set_alpn_protos(SSL_CTX *ctx, const unsigned char *protos,
                                    unsigned int protos_len);
        int SSL_set_alpn_protos(SSL *ssl, const unsigned char *protos,
                                unsigned int protos_len);
        void SSL_CTX_set_alpn_select_cb(SSL_CTX *ctx,
                                        int (*cb) (SSL *ssl,
                                                   const unsigned char **out,
                                                   unsigned char *outlen,
                                                   const unsigned char *in,
                                                   unsigned int inlen,
                                                   void *arg), void *arg);
        void SSL_get0_alpn_selected(const SSL *ssl, const unsigned char **data,
                                    unsigned int *len);

        void SSL_CTX_set_next_protos_advertised_cb(SSL_CTX *ctx,
                                                   int (*cb)(SSL *ssl,
                                                             const unsigned char **out,
                                                             unsigned int *outlen,
                                                             void *arg),
                                                   void *arg);
        void SSL_CTX_set_next_proto_select_cb(SSL_CTX *ctx,
                                      int (*cb)(SSL *s,
                                                unsigned char **out,
                                                unsigned char *outlen,
                                                const unsigned char *in,
                                                unsigned int inlen,
                                                void *arg),
                                      void *arg);
        int SSL_select_next_proto(unsigned char **out, unsigned char *outlen,
                                  const unsigned char *server,
                                  unsigned int server_len,
                                  const unsigned char *client,
                                  unsigned int client_len);
        void SSL_get0_next_proto_negotiated(const SSL *s, const unsigned char **data,
                                    unsigned *len);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>SSL_CTX_set_alpn_protos()</b> and <b>SSL_set_alpn_protos()</b> are used by the client to set the list of protocols
       available to be negotiated. The <b>protos</b> must be in protocol-list format, described below. The length of
       <b>protos</b> is specified in <b>protos_len</b>. Setting <b>protos_len</b> to 0 clears any existing list of ALPN protocols and
       no ALPN extension will be sent to the server.

       <b>SSL_CTX_set_alpn_select_cb()</b> sets the application callback <b>cb</b> used by a server to select which protocol
       to use for the incoming connection. When <b>cb</b> is NULL, ALPN is not used. The <b>arg</b> value is a pointer which
       is passed to the application callback.

       <b>cb</b> is the application defined callback. The <b>in</b>, <b>inlen</b> parameters are a vector in protocol-list format.
       The value of the <b>out</b>, <b>outlen</b> vector should be set to the value of a single protocol selected from the <b>in</b>,
       <b>inlen</b> vector. The <b>out</b> buffer may point directly into <b>in</b>, or to a buffer that outlives the handshake. The
       <b>arg</b> parameter is the pointer set via <b>SSL_CTX_set_alpn_select_cb()</b>.

       <b>SSL_select_next_proto()</b> is a helper function used to select protocols. It implements the standard
       protocol selection. It is expected that this function is called from the application callback <b>cb</b>. The
       protocol data in <b>server</b>, <b>server_len</b> and <b>client</b>, <b>client_len</b> must be in the protocol-list format described
       below. The first item in the <b>server</b>, <b>server_len</b> list that matches an item in the <b>client</b>, <b>client_len</b> list
       is selected, and returned in <b>out</b>, <b>outlen</b>. The <b>out</b> value will point into either <b>server</b> or <b>client</b>, so it
       should be copied immediately. The client list must include at least one valid (nonempty) protocol entry
       in the list.

       The <b>SSL_select_next_proto()</b> helper function can be useful from either the ALPN callback or the NPN
       callback (described below). If no match is found, the first item in <b>client</b>, <b>client_len</b> is returned in
       <b>out</b>, <b>outlen</b> and <b>OPENSSL_NPN_NO_OVERLAP</b> is returned. This can be useful when implementing the NPN
       callback. In the ALPN case, the value returned in <b>out</b> and <b>outlen</b> must be ignored if
       <b>OPENSSL_NPN_NO_OVERLAP</b> has been returned from <b>SSL_select_next_proto()</b>.

       <b>SSL_CTX_set_next_proto_select_cb()</b> sets a callback <b>cb</b> that is called when a client needs to select a
       protocol from the server's provided list, and a user-defined pointer argument <b>arg</b> which will be passed to
       this callback.  For the callback itself, <b>out</b> must be set to point to the selected protocol (which may be
       within <b>in</b>).  The length of the protocol name must be written into <b>outlen</b>. The server's advertised
       protocols are provided in <b>in</b> and <b>inlen</b>. The callback can assume that <b>in</b> is syntactically valid. The
       client must select a protocol (although it may be an empty, zero length protocol). It is fatal to the
       connection if this callback returns a value other than <b>SSL_TLSEXT_ERR_OK</b> or if the zero length protocol
       is selected. The <b>arg</b> parameter is the pointer set via <b>SSL_CTX_set_next_proto_select_cb()</b>.

       <b>SSL_CTX_set_next_protos_advertised_cb()</b> sets a callback <b>cb</b> that is called when a TLS server needs a list
       of supported protocols for Next Protocol Negotiation. The returned list must be in protocol-list format,
       described below.  The list is returned by setting <b>out</b> to point to it and <b>outlen</b> to its length. This
       memory will not be modified, but the <b>SSL</b> does keep a reference to it. The callback should return
       <b>SSL_TLSEXT_ERR_OK</b> if it wishes to advertise. Otherwise, no such extension will be included in the
       ServerHello.

       <b>SSL_get0_alpn_selected()</b> returns a pointer to the selected protocol in <b>data</b> with length <b>len</b>. It is not
       NUL-terminated. <b>data</b> is set to NULL and <b>len</b> is set to 0 if no protocol has been selected. <b>data</b> must not
       be freed.

       <b>SSL_get0_next_proto_negotiated()</b> sets <b>data</b> and <b>len</b> to point to the client's requested protocol for this
       connection. If the client did not request any protocol or NPN is not enabled, then <b>data</b> is set to NULL
       and <b>len</b> to 0. Note that the client can request any protocol it chooses. The value returned from this
       function need not be a member of the list of supported protocols provided by the callback.

       NPN functionality cannot be used with QUIC SSL objects. Use of ALPN is mandatory when using QUIC SSL
       objects. <b>SSL_CTX_set_next_protos_advertised_cb()</b> and <b>SSL_CTX_set_next_proto_select_cb()</b> have no effect if
       called on a QUIC SSL context.

</pre><h4><b>NOTES</b></h4><pre>
       The protocol-lists must be in wire-format, which is defined as a vector of nonempty, 8-bit length-
       prefixed, byte strings. The length-prefix byte is not included in the length. Each string is limited to
       255 bytes. A byte-string length of 0 is invalid. A truncated byte-string is invalid. The length of the
       vector is not in the vector itself, but in a separate variable.

       Example:

        unsigned char vector[] = {
            6, 's', 'p', 'd', 'y', '/', '1',
            8, 'h', 't', 't', 'p', '/', '1', '.', '1'
        };
        unsigned int length = sizeof(vector);

       The ALPN callback is executed after the servername callback; as that servername callback may update the
       SSL_CTX, and subsequently, the ALPN callback.

       If there is no ALPN proposed in the ClientHello, the ALPN callback is not invoked.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>SSL_CTX_set_alpn_protos()</b> and <b>SSL_set_alpn_protos()</b> return 0 on success, and non-0 on failure. WARNING:
       these functions reverse the return value convention.

       <b>SSL_select_next_proto()</b> returns one of the following:

       OPENSSL_NPN_NEGOTIATED
           A match was found and is returned in <b>out</b>, <b>outlen</b>.

       OPENSSL_NPN_NO_OVERLAP
           No match was found. The first item in <b>client</b>, <b>client_len</b> is returned in <b>out</b>, <b>outlen</b> (or <b>NULL</b> and 0 in
           the case where the first entry in <b>client</b> is invalid).

       The ALPN select callback <b>cb</b>, must return one of the following:

       SSL_TLSEXT_ERR_OK
           ALPN protocol selected.

       SSL_TLSEXT_ERR_ALERT_FATAL
           There was no overlap between the client's supplied list and the server configuration.

       SSL_TLSEXT_ERR_NOACK
           ALPN protocol not selected, e.g., because no ALPN protocols are configured for this connection.

       The  callback set using <b>SSL_CTX_set_next_proto_select_cb()</b> should return <b>SSL_TLSEXT_ERR_OK</b> if successful.
       Any other value is fatal to the connection.

       The callback set using <b>SSL_CTX_set_next_protos_advertised_cb()</b>  should  return  <b>SSL_TLSEXT_ERR_OK</b>  if  it
       wishes to advertise. Otherwise, no such extension will be included in the ServerHello.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/ssl.7.html">ssl</a></b>(7), <b><a href="../man3/SSL_CTX_set_tlsext_servername_callback.3.html">SSL_CTX_set_tlsext_servername_callback</a></b>(3), <b><a href="../man3/SSL_CTX_set_tlsext_servername_arg.3.html">SSL_CTX_set_tlsext_servername_arg</a></b>(3)

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2016-2024 The OpenSSL Project Authors. All Rights Reserved.

       Licensed  under  the  Apache License 2.0 (the "License").  You may not use this file except in compliance
       with the License.  You can obtain  a  copy  in  the  file  LICENSE  in  the  source  distribution  or  at
       &lt;https://www.openssl.org/source/license.html&gt;.

3.5.0                                              2025-06-04                   <u><a href="../man3SSL/SSL_CTX_SET_ALPN_SELECT_CB.3SSL.html">SSL_CTX_SET_ALPN_SELECT_CB</a></u>(3SSL)
</pre>
 </div>
</div></section>
</div>
</body>
</html>