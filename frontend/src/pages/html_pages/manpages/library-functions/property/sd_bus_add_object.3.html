<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sd_bus_add_object, sd_bus_add_fallback, sd_bus_add_object_vtable, sd_bus_add_fallback_vtable,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libsystemd-dev">libsystemd-dev_257.7-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sd_bus_add_object, sd_bus_add_fallback, sd_bus_add_object_vtable, sd_bus_add_fallback_vtable,
       sd_bus_add_filter, SD_BUS_VTABLE_CAPABILITY, SD_BUS_VTABLE_START, SD_BUS_VTABLE_END,
       SD_BUS_METHOD_WITH_NAMES_OFFSET, SD_BUS_METHOD_WITH_NAMES, SD_BUS_METHOD_WITH_OFFSET, SD_BUS_METHOD,
       SD_BUS_SIGNAL_WITH_NAMES, SD_BUS_SIGNAL, SD_BUS_WRITABLE_PROPERTY, SD_BUS_PROPERTY, SD_BUS_PARAM -
       Declare properties and methods for a D-Bus path

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;systemd/sd-bus-vtable.h&gt;</b>

       <b>typedef</b> <b>int</b> <b>(*sd_bus_message_handler_t)(sd_bus_message</b> <b>*</b><u>m</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>,</b> <b>sd_bus_error</b> <b>*</b><u>ret_error</u><b>);</b>

       <b>typedef</b> <b>int</b> <b>(*sd_bus_property_get_t)(sd_bus</b> <b>*</b><u>bus</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>path</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>interface</u><b>,</b>
                                            <b>const</b> <b>char</b> <b>*</b><u>property</u><b>,</b> <b>sd_bus_message</b> <b>*</b><u>reply</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>,</b>
                                            <b>sd_bus_error</b> <b>*</b><u>ret_error</u><b>);</b>

       <b>typedef</b> <b>int</b> <b>(*sd_bus_property_set_t)(sd_bus</b> <b>*</b><u>bus</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>path</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>interface</u><b>,</b>
                                            <b>const</b> <b>char</b> <b>*</b><u>property</u><b>,</b> <b>sd_bus_message</b> <b>*</b><u>value</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>,</b>
                                            <b>sd_bus_error</b> <b>*</b><u>ret_error</u><b>);</b>

       <b>typedef</b> <b>int</b> <b>(*sd_bus_object_find_t)(const</b> <b>char</b> <b>*</b><u>path</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>interface</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>,</b>
                                           <b>void</b> <b>**</b><u>ret_found</u><b>,</b> <b>sd_bus_error</b> <b>*</b><u>ret_error</u><b>);</b>

       <b>int</b> <b>sd_bus_add_object(sd_bus</b> <b>*</b><u>bus</u><b>,</b> <b>sd_bus_slot</b> <b>**</b><u>slot</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>path</u><b>,</b>
                             <b>sd_bus_message_handler_t</b> <u>callback</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>);</b>

       <b>int</b> <b>sd_bus_add_fallback(sd_bus</b> <b>*</b><u>bus</u><b>,</b> <b>sd_bus_slot</b> <b>**</b><u>slot</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>path</u><b>,</b>
                               <b>sd_bus_message_handler_t</b> <u>callback</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>);</b>

       <b>int</b> <b>sd_bus_add_object_vtable(sd_bus</b> <b>*</b><u>bus</u><b>,</b> <b>sd_bus_slot</b> <b>**</b><u>slot</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>path</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>interface</u><b>,</b>
                                    <b>const</b> <b>sd_bus_vtable</b> <b>*</b><u>vtable</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>);</b>

       <b>int</b> <b>sd_bus_add_fallback_vtable(sd_bus</b> <b>*</b><u>bus</u><b>,</b> <b>sd_bus_slot</b> <b>**</b><u>slot</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>prefix</u><b>,</b>
                                      <b>const</b> <b>char</b> <b>*</b><u>interface</u><b>,</b> <b>const</b> <b>sd_bus_vtable</b> <b>*</b><u>vtable</u><b>,</b>
                                      <b>sd_bus_object_find_t</b> <u>find</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>);</b>

       <b>int</b> <b>sd_bus_add_filter(sd_bus</b> <b>*</b><u>bus</u><b>,</b> <b>sd_bus_slot</b> <b>**</b><u>slot</u><b>,</b> <b>sd_bus_message_handler_t</b> <u>callback</u><b>,</b>
                             <b>void</b> <b>*</b><u>userdata</u><b>);</b>

       <b>SD_BUS_VTABLE_CAPABILITY(</b><u>capability</u><b>)</b>

       <b>SD_BUS_VTABLE_START(</b><u>flags</u><b>)</b>

       <b>SD_BUS_VTABLE_END</b>

       <b>SD_BUS_METHOD_WITH_ARGS_OFFSET(</b><u>member</u><b>,</b> <u>args</u><b>,</b> <u>result</u><b>,</b> <u>handler</u><b>,</b> <u>offset</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_METHOD_WITH_ARGS(</b><u>member</u><b>,</b> <u>args</u><b>,</b> <u>result</u><b>,</b> <u>handler</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_METHOD_WITH_NAMES_OFFSET(</b><u>member</u><b>,</b> <u>signature</u><b>,</b> <u>in_names</u><b>,</b> <u>result</u><b>,</b> <u>out_names</u><b>,</b> <u>handler</u><b>,</b> <u>offset</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_METHOD_WITH_NAMES(</b><u>member</u><b>,</b> <u>signature</u><b>,</b> <u>in_names</u><b>,</b> <u>result</u><b>,</b> <u>out_names</u><b>,</b> <u>handler</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_METHOD_WITH_OFFSET(</b><u>member</u><b>,</b> <u>signature</u><b>,</b> <u>result</u><b>,</b> <u>handler</u><b>,</b> <u>offset</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_METHOD(</b><u>member</u><b>,</b> <u>signature</u><b>,</b> <u>result</u><b>,</b> <u>handler</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_SIGNAL_WITH_ARGS(</b><u>member</u><b>,</b> <u>args</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_SIGNAL_WITH_NAMES(</b><u>member</u><b>,</b> <u>signature</u><b>,</b> <u>names</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_SIGNAL(</b><u>member</u><b>,</b> <u>signature</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_WRITABLE_PROPERTY(</b><u>member</u><b>,</b> <u>signature</u><b>,</b> <u>get</u><b>,</b> <u>set</u><b>,</b> <u>offset</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_PROPERTY(</b><u>member</u><b>,</b> <u>signature</u><b>,</b> <u>get</u><b>,</b> <u>offset</u><b>,</b> <u>flags</u><b>)</b>

       <b>SD_BUS_PARAM(</b><u>name</u><b>)</b>

       <b>SD_BUS_ARGS(</b><u>...</u><b>)</b>

       <b>SD_BUS_RESULT(</b><u>...</u><b>)</b>

       <b>SD_BUS_NO_ARGS</b>

       <b>SD_BUS_NO_RESULT</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>sd_bus_add_object_vtable()</b> is used to declare attributes for the object path <u>path</u> connected to the bus
       connection <u>bus</u> under the interface <u>interface</u>. The table <u>vtable</u> may contain property declarations using
       <b>SD_BUS_PROPERTY()</b> or <b>SD_BUS_WRITABLE_PROPERTY()</b>, method declarations using <b>SD_BUS_METHOD()</b>,
       <b>SD_BUS_METHOD_WITH_NAMES()</b>, <b>SD_BUS_METHOD_WITH_OFFSET()</b>, or <b>SD_BUS_METHOD_WITH_NAMES_OFFSET()</b>, and signal
       declarations using <b>SD_BUS_SIGNAL_WITH_NAMES()</b> or <b>SD_BUS_SIGNAL()</b>, see below. The <u>userdata</u> parameter
       contains a pointer that will be passed to various callback functions. It may be specified as <b>NULL</b> if no
       value is necessary. An interface can have any number of vtables attached to it.

       <b>sd_bus_add_fallback_vtable()</b> is similar to <b>sd_bus_add_object_vtable()</b>, but is used to register "fallback"
       attributes. When looking for an attribute declaration, bus object paths registered with
       <b>sd_bus_add_object_vtable()</b> are checked first. If no match is found, the fallback vtables are checked for
       each prefix of the bus object path, i.e. with the last slash-separated components successively removed.
       This allows the vtable to be used for an arbitrary number of dynamically created objects.

       Parameter <u>find</u> is a function which is used to locate the target object based on the bus object path <u>path</u>.
       It must return <b>1</b> and set the <u>ret_found</u> output parameter if the object is found, return <b>0</b> if the object
       was not found, and return a negative errno-style error code or initialize the error structure <u>ret_error</u>
       on error. The pointer passed in <u>ret_found</u> will be used as the <u>userdata</u> parameter for the callback
       functions (offset by the <u>offset</u> offsets as specified in the vtable entries).

       <b>sd_bus_add_object()</b> attaches a callback directly to the object path <u>path</u>. An object path can have any
       number of callbacks attached to it. Each callback is prepended to the list of callbacks which are always
       called in order.  <b>sd_bus_add_fallback()</b> is similar to <b>sd_bus_add_object()</b> but applies to fallback paths
       instead.

       <b>sd_bus_add_filter()</b> installs a callback that is invoked for each incoming D-Bus message. Filters can be
       used to handle logic common to all messages received by a service (e.g. authentication or authorization).

       When a request is received, any associated callbacks are called sequentially until a callback returns a
       non-zero integer. Return zero from a callback to give other callbacks the chance to process the request.
       Callbacks are called in the following order: first, global callbacks installed with <b>sd_bus_add_filter()</b>
       are called. Second, callbacks attached directly to the request object path are called, followed by any
       D-Bus method callbacks attached to the request object path, interface and member. Finally, the property
       callbacks attached to the request object path, interface and member are called. If the final callback
       returns zero, an error reply is sent back to the caller indicating no matching object for the request was
       found.

       Note that you can return a positive integer from a <u>method</u> callback without immediately sending a reply.
       This informs sd-bus this callback will take responsibility for replying to the request without forcing
       the callback to produce a reply immediately. This allows a callback to perform any number of asynchronous
       operations required to construct a reply. However, if producing a reply takes too long, the method call
       will time out at the caller. This is only available to methods and not properties.

       If a callback was invoked to handle a request that expects a reply and the callback returns a negative
       value, the value is interpreted as a negative errno-style error code and sent back to the caller as a
       D-Bus error as if <b><a href="../man3/sd_bus_reply_method_errno.3.html">sd_bus_reply_method_errno</a></b>(3) was called. Additionally, all callbacks take a
       sd_bus_error output parameter that can be used to provide more detailed error information. If <u>ret_error</u>
       is set when the callback finishes, the corresponding D-Bus error is sent back to the caller as if
       <b><a href="../man3/sd_bus_reply_method_error.3.html">sd_bus_reply_method_error</a></b>(3) was called. Any error stored in <u>ret_error</u> takes priority over any negative
       values returned by the same callback when determining which error to send back to the caller. Use
       <b><a href="../man3/sd_bus_error_set.3.html">sd_bus_error_set</a></b>(3) or one of its variants to set <u>ret_error</u> and return a negative integer from a callback
       with a single function call. To send an error reply after a callback has already finished, use
       <b><a href="../man3/sd_bus_reply_method_errno.3.html">sd_bus_reply_method_errno</a></b>(3) or one of its variants.

       For all functions, a match slot is created internally. If the output parameter <u>slot</u> is <b>NULL</b>, a "floating"
       slot object is created, see <b><a href="../man3/sd_bus_slot_set_floating.3.html">sd_bus_slot_set_floating</a></b>(3). Otherwise, a pointer to the slot object is
       returned. In that case, the reference to the slot object should be dropped when the vtable is not needed
       anymore, see <b><a href="../man3/sd_bus_slot_unref.3.html">sd_bus_slot_unref</a></b>(3).

   <b>The</b> <b>sd_bus_vtable</b> <b>array</b>
       The array consists of the structures of type sd_bus_vtable, but it should never be filled in manually,
       but through one of the following macros:

       <b>SD_BUS_VTABLE_START(</b><u>flags</u><b>)</b>, <b>SD_BUS_VTABLE_END</b>
           Those must always be the first and last element. The <u>flags</u> parameter can be used to set attributes
           that apply to the whole array; see the "Flags" section below.

       <b>SD_BUS_METHOD_WITH_ARGS_OFFSET()</b>, <b>SD_BUS_METHOD_WITH_ARGS()</b>
           Declare a D-Bus method with the name <u>member</u>, arguments <u>args</u> and result <u>result</u>.  <u>args</u> expects a
           sequence of argument type/name pairs wrapped in the <b>SD_BUS_ARGS()</b> macro. The elements at even indices
           in this list describe the types of the method's arguments. The method's parameter signature is the
           concatenation of all the string literals at even indices in <u>args</u>. If a method has no parameters, pass
           <b>SD_BUS_NO_ARGS</b> to <u>args</u>. The elements at uneven indices describe the names of the method's arguments.
           <u>result</u> expects a sequence of type/name pairs wrapped in the <b>SD_BUS_RESULT()</b> macro in the same format
           as <b>SD_BUS_ARGS()</b>. The method's result signature is the concatenation of all the string literals at
           even indices in <u>result</u>. If a method has no result, pass <b>SD_BUS_NO_RESULT</b> to <u>result</u>. Note that
           argument types are expected to be quoted string literals and argument names are expected to be
           unquoted string literals. See below for a complete example.

           The handler function <u>handler</u> must be of type <b>sd_bus_message_handler_t</b>. It will be called to handle
           the incoming messages that call this method. It receives a pointer that is the <u>userdata</u> parameter
           passed to the registration function offset by <u>offset</u> bytes. This may be used to pass pointers to
           different fields in the same data structure to different methods in the same vtable. To send a reply
           from <u>handler</u>, call <b><a href="../man3/sd_bus_reply_method_return.3.html">sd_bus_reply_method_return</a></b>(3) with the message the callback was invoked with.
           Parameter <u>flags</u> is a combination of flags, see below.

           <b>SD_BUS_METHOD_WITH_ARGS()</b> is a shorthand for calling <b>SD_BUS_METHOD_WITH_ARGS_OFFSET()</b> with an offset
           of zero.

       <b>SD_BUS_METHOD_WITH_NAMES_OFFSET()</b>, <b>SD_BUS_METHOD_WITH_NAMES()</b>, <b>SD_BUS_METHOD_WITH_OFFSET()</b>,
       <b>SD_BUS_METHOD()</b>
           Declare a D-Bus method with the name <u>member</u>, parameter signature <u>signature</u>, result signature <u>result</u>.
           Parameters <u>in_names</u> and <u>out_names</u> specify the argument names of the input and output arguments in the
           function signature.  <u>in_names</u> and <u>out_names</u> should be created using the <b>SD_BUS_PARAM()</b> macro, see
           below. In all other regards, this macro behaves exactly the same as <b>SD_BUS_METHOD_WITH_ARGS_OFFSET()</b>.

           <b>SD_BUS_METHOD_WITH_NAMES()</b>, <b>SD_BUS_METHOD_WITH_OFFSET()</b>, and <b>SD_BUS_METHOD()</b> are variants which
           specify zero offset (<u>userdata</u> parameter is passed with no change), leave the names unset (i.e. no
           parameter names), or both.

           Prefer using <b>SD_BUS_METHOD_WITH_ARGS_OFFSET()</b> and <b>SD_BUS_METHOD_WITH_ARGS()</b> over these macros as they
           allow specifying argument types and names next to each other which is less error-prone than first
           specifying all argument types followed by specifying all argument names.

       <b>SD_BUS_SIGNAL_WITH_ARGS()</b>
           Declare a D-Bus signal with the name <u>member</u> and arguments <u>args</u>.  <u>args</u> expects a sequence of argument
           type/name pairs wrapped in the <b>SD_BUS_ARGS()</b> macro. The elements at even indices in this list
           describe the types of the signal's arguments. The signal's parameter signature is the concatenation
           of all the string literals at even indices in <u>args</u>. If a signal has no parameters, pass
           <b>SD_BUS_NO_ARGS</b> to <u>args</u>. The elements at uneven indices describe the names of the signal's arguments.
           Parameter <u>flags</u> is a combination of flags. See below for a complete example.

       <b>SD_BUS_SIGNAL_WITH_NAMES()</b>, <b>SD_BUS_SIGNAL()</b>
           Declare a D-Bus signal with the name <u>member</u>, parameter signature <u>signature</u>, and argument names <u>names</u>.
           <u>names</u> should be created using the <b>SD_BUS_PARAM()</b> macro, see below. Parameter <u>flags</u> is a combination
           of flags, see below.

           <b>SD_BUS_SIGNAL()</b> is equivalent to <b>SD_BUS_SIGNAL_WITH_NAMES()</b> with the <u>names</u> parameter unset (i.e. no
           parameter names).

           Prefer using <b>SD_BUS_SIGNAL_WITH_ARGS()</b> over these macros as it allows specifying argument types and
           names next to each other which is less error-prone than first specifying all argument types followed
           by specifying all argument names.

       <b>SD_BUS_WRITABLE_PROPERTY()</b>, <b>SD_BUS_PROPERTY()</b>
           Declare a D-Bus property with the name <u>member</u> and value signature <u>signature</u>. Parameters <u>get</u> and <u>set</u>
           are the getter and setter methods. They are called with a pointer that is the <u>userdata</u> parameter
           passed to the registration function offset by <u>offset</u> bytes. This may be used pass pointers to
           different fields in the same data structure to different setters and getters in the same vtable.
           Parameter <u>flags</u> is a combination of flags, see below.

           The setter and getter methods may be omitted (specified as <b>NULL</b>), if the property is one of the basic
           types or "as" in case of read-only properties. In those cases, the <u>userdata</u> and <u>offset</u> parameters
           must together point to a valid variable of the corresponding type. A default setter and getter will
           be provided, which simply copy the argument between this variable and the message.

           <b>SD_BUS_PROPERTY()</b> is used to define a read-only property.

       <b>SD_BUS_PARAM()</b>
           Parameter names should be wrapped in this macro, see the example below.

   <b>Flags</b>
       The <u>flags</u> parameter is used to specify a combination of <b>D-Bus</b> <b>annotations</b>[1].

       <b>SD_BUS_VTABLE_DEPRECATED</b>
           Mark this vtable entry as deprecated using the <b>org.freedesktop.DBus.Deprecated</b> annotation in
           introspection data. If specified for <b>SD_BUS_VTABLE_START()</b>, the annotation is applied to the
           enclosing interface.

       <b>SD_BUS_VTABLE_HIDDEN</b>
           Make this vtable entry hidden. It will not be shown in introspection data. If specified for
           <b>SD_BUS_VTABLE_START()</b>, all entries in the array are hidden.

       <b>SD_BUS_VTABLE_METHOD_NO_REPLY</b>
           Mark this vtable entry as a method that will not return a reply using the
           <b>org.freedesktop.DBus.Method.NoReply</b> annotation in introspection data.

       <b>SD_BUS_VTABLE_PROPERTY_CONST</b>, <b>SD_BUS_VTABLE_PROPERTY_EMITS_CHANGE</b>,
       <b>SD_BUS_VTABLE_PROPERTY_EMITS_INVALIDATION</b>
           Those three flags correspond to different values of the
           <b>org.freedesktop.DBus.Property.EmitsChangedSignal</b> annotation, which specifies whether the
           <b>org.freedesktop.DBus.Properties.PropertiesChanged</b> signal is emitted whenever the property changes.
           <b>SD_BUS_VTABLE_PROPERTY_CONST</b> corresponds to <b>const</b> and means that the property never changes during
           the lifetime of the object it belongs to, so no signal needs to be emitted.
           <b>SD_BUS_VTABLE_PROPERTY_EMITS_CHANGE</b> corresponds to <b>true</b> and means that the signal is emitted.
           <b>SD_BUS_VTABLE_PROPERTY_EMITS_INVALIDATION</b> corresponds to <b>invalidates</b> and means that the signal is
           emitted, but the value is not included in the signal.

       <b>SD_BUS_VTABLE_PROPERTY_EXPLICIT</b>
           Mark this vtable property entry as requiring explicit request to for the value to be shown (generally
           because the value is large or slow to calculate). This entry cannot be combined with
           <b>SD_BUS_VTABLE_PROPERTY_EMITS_CHANGE</b>, and will not be shown in property listings by default (e.g.
           <b>busctl</b> <b>introspect</b>). This corresponds to the <b>org.freedesktop.systemd1.Explicit</b> annotation in
           introspection data.

       <b>SD_BUS_VTABLE_SENSITIVE</b>
           Mark this vtable method entry as processing sensitive data. When set, incoming method call messages
           and their outgoing reply messages are marked as sensitive using <b><a href="../man3/sd_bus_message_sensitive.3.html">sd_bus_message_sensitive</a></b>(3), so that
           they are erased from memory when freed.

       <b>SD_BUS_VTABLE_ABSOLUTE_OFFSET</b>
           Mark this vtable method or property entry so that the user data pointer passed to its associated
           handler functions is determined slightly differently: instead of adding the offset parameter of the
           entry to the user data pointer specified during vtable registration, the offset is passed directly,
           converted to a pointer, without taking the user data pointer specified during vtable registration
           into account.

       <b>SD_BUS_VTABLE_CAPABILITY(</b><u>capability</u><b>)</b>
           Access to this vtable entry will be allowed if the calling process has the capability <u>capability</u>, as
           described in <b><a href="../man3/sd_bus_query_sender_privilege.3.html">sd_bus_query_sender_privilege</a></b>(3). If used for <b>SD_BUS_VTABLE_START()</b>, provides a default
           for all entries in the array. If not specified, either for an individual entry or the whole array,
           <b>CAP_SYS_ADMIN</b> is checked by default. See <b><a href="../man7/capabilities.7.html">capabilities</a></b>(7) for information about capabilities.

           Note that vtable entries may be marked as unprivileged and the whole bus may be marked as trusted,
           see the discussion of <b>SD_BUS_VTABLE_UNPRIVILEGED</b> below.

       <b>SD_BUS_VTABLE_UNPRIVILEGED</b>
           Mark this vtable entry as unprivileged. Access to privileged entries is limited to users with
           appropriate capabilities as described above. In practice many vtable entries are marked as
           unprivileged, and either are open to everyone, or the decision whether to allow access is taken
           later, e.g. by delegating to <b>polkit</b>[2].

           The whole bus may be marked as trusted, in which case annotations at the entry level are ignored, see
           <b><a href="../man3/sd_bus_set_trusted.3.html">sd_bus_set_trusted</a></b>(3).

           When <u>not</u> specified, the <b>org.freedesktop.systemd1.Privileged</b> annotation with value "true" will be
           shown in introspection data.

           <b>SD_BUS_VTABLE_UNPRIVILEGED</b> may not be applied to read-only properties, but read access (to both
           read-only and writable properties) is always unrestricted.

           Note that this page describes checks implemented in the D-Bus client. The D-Bus server has an
           additional policy that may permit or deny connections, see "CONFIGURATION FILE" in <b><a href="../man1/dbus-daemon.1.html">dbus-daemon</a></b>(1).

</pre><h4><b>EXAMPLES</b></h4><pre>
       <b>Example</b> <b>1.</b> <b>Create</b> <b>a</b> <b>simple</b> <b>listener</b> <b>on</b> <b>the</b> <b>bus</b>

           /* SPDX-License-Identifier: MIT-0 */

           #define _GNU_SOURCE 1
           #include &lt;<a href="file:/usr/include/errno.h">errno.h</a>&gt;
           #include &lt;stdbool.h&gt;
           #include &lt;stddef.h&gt;
           #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
           #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
           #include &lt;systemd/sd-bus.h&gt;

           #define _cleanup_(f) __attribute__((cleanup(f)))

           typedef struct object {
             char *name;
             uint32_t number;
           } object;

           static int method(sd_bus_message *m, void *userdata, sd_bus_error *error) {
             int r;

             printf("Got called with userdata=%p\n", userdata);

             if (sd_bus_message_is_method_call(m,
                                               "org.freedesktop.systemd.VtableExample",
                                               "Method4"))
               return 1;

             const char *string;
             r = sd_bus_message_read(m, "s", &amp;string);
             if (r &lt; 0) {
               fprintf(stderr, "sd_bus_message_read() failed: %s\n", strerror(-r));
               return 0;
             }

             r = sd_bus_reply_method_return(m, "s", string);
             if (r &lt; 0) {
               fprintf(stderr, "sd_bus_reply_method_return() failed: %s\n", strerror(-r));
               return 0;
             }

             return 1;
           }

           static const sd_bus_vtable vtable[] = {
                   <a href="../man0/SD_BUS_VTABLE_START.0.html">SD_BUS_VTABLE_START</a>(0),
                   SD_BUS_METHOD(
                       "Method1", "s", "s", method, 0),
                   SD_BUS_METHOD_WITH_NAMES_OFFSET(
                       "Method2",
                       "so", SD_BUS_PARAM(string) SD_BUS_PARAM(path),
                       "s", SD_BUS_PARAM(returnstring),
                       method, offsetof(object, number),
                       SD_BUS_VTABLE_DEPRECATED),
                   SD_BUS_METHOD_WITH_ARGS_OFFSET(
                       "Method3",
                       SD_BUS_ARGS("s", string, "o", path),
                       SD_BUS_RESULT("s", returnstring),
                       method, offsetof(object, number),
                       SD_BUS_VTABLE_UNPRIVILEGED),
                   SD_BUS_METHOD_WITH_ARGS(
                       "Method4",
                       SD_BUS_NO_ARGS,
                       SD_BUS_NO_RESULT,
                       method,
                       SD_BUS_VTABLE_UNPRIVILEGED),
                   SD_BUS_SIGNAL(
                       "Signal1",
                       "so",
                       0),
                   SD_BUS_SIGNAL_WITH_NAMES(
                       "Signal2",
                       "so", SD_BUS_PARAM(string) SD_BUS_PARAM(path),
                       0),
                   SD_BUS_SIGNAL_WITH_ARGS(
                       "Signal3",
                       SD_BUS_ARGS("s", string, "o", path),
                       0),
                   SD_BUS_WRITABLE_PROPERTY(
                       "AutomaticStringProperty", "s", NULL, NULL,
                       offsetof(object, name),
                       SD_BUS_VTABLE_PROPERTY_EMITS_CHANGE),
                   SD_BUS_WRITABLE_PROPERTY(
                       "AutomaticIntegerProperty", "u", NULL, NULL,
                       offsetof(object, number),
                       SD_BUS_VTABLE_PROPERTY_EMITS_INVALIDATION),
                   SD_BUS_VTABLE_END
           };

           int main(int argc, char **argv) {
             _cleanup_(sd_bus_flush_close_unrefp) sd_bus *bus = NULL;
             int r;

             sd_bus_default(&amp;bus);

             object object = { .number = 666 };
             object.name = strdup("name");
             if (!object.name) {
               fprintf(stderr, "OOM\n");
               return EXIT_FAILURE;
             }

             r = sd_bus_add_object_vtable(bus, NULL,
                                          "/org/freedesktop/systemd/VtableExample",
                                          "org.freedesktop.systemd.VtableExample",
                                          vtable,
                                          &amp;object);
             if (r &lt; 0) {
               fprintf(stderr, "sd_bus_add_object_vtable() failed: %s\n", strerror(-r));
               return EXIT_FAILURE;
             }

             r = sd_bus_request_name(bus,
                                     "org.freedesktop.systemd.VtableExample",
                                     0);
             if (r &lt; 0) {
               fprintf(stderr, "sd_bus_request_name() failed: %s\n", strerror(-r));
               return EXIT_FAILURE;
             }

             for (;;) {
               r = sd_bus_wait(bus, UINT64_MAX);
               if (r &lt; 0) {
                 fprintf(stderr, "sd_bus_wait() failed: %s\n", strerror(-r));
                 return EXIT_FAILURE;
               }

               r = sd_bus_process(bus, NULL);
               if (r &lt; 0) {
                 fprintf(stderr, "sd_bus_process() failed: %s\n", strerror(-r));
                 return EXIT_FAILURE;
               }
             }

             r = sd_bus_release_name(bus, "org.freedesktop.systemd.VtableExample");
             if (r &lt; 0) {
               fprintf(stderr, "sd_bus_release_name() failed: %s\n", strerror(-r));
               return EXIT_FAILURE;
             }

             free(object.name);

             return 0;
           }

       This creates a simple client on the bus (the user bus, when run as normal user). We may use the D-Bus
       <b>org.freedesktop.DBus.Introspectable.Introspect</b> call to acquire the XML description of the interface:

           &lt;!DOCTYPE node PUBLIC "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN"
           "https://www.freedesktop.org/standards/dbus/1.0/introspect.dtd"&gt;
           &lt;!-- SPDX-License-Identifier: LGPL-2.1-or-later --&gt;
           &lt;node&gt;
            &lt;interface name="org.freedesktop.DBus.Peer"&gt;
             &lt;method name="Ping"/&gt;
             &lt;method name="GetMachineId"&gt;
              &lt;arg type="s" name="machine_uuid" direction="out"/&gt;
             &lt;/method&gt;
            &lt;/interface&gt;
            &lt;interface name="org.freedesktop.DBus.Introspectable"&gt;
             &lt;method name="Introspect"&gt;
              &lt;arg name="xml_data" type="s" direction="out"/&gt;
             &lt;/method&gt;
            &lt;/interface&gt;
            &lt;interface name="org.freedesktop.DBus.Properties"&gt;
             &lt;method name="Get"&gt;
              &lt;arg name="interface_name" direction="in" type="s"/&gt;
              &lt;arg name="property_name" direction="in" type="s"/&gt;
              &lt;arg name="value" direction="out" type="v"/&gt;
             &lt;/method&gt;
             &lt;method name="GetAll"&gt;
              &lt;arg name="interface_name" direction="in" type="s"/&gt;
              &lt;arg name="props" direction="out" type="a{sv}"/&gt;
             &lt;/method&gt;
             &lt;method name="Set"&gt;
              &lt;arg name="interface_name" direction="in" type="s"/&gt;
              &lt;arg name="property_name" direction="in" type="s"/&gt;
              &lt;arg name="value" direction="in" type="v"/&gt;
             &lt;/method&gt;
             &lt;signal name="PropertiesChanged"&gt;
              &lt;arg type="s" name="interface_name"/&gt;
              &lt;arg type="a{sv}" name="changed_properties"/&gt;
              &lt;arg type="as" name="invalidated_properties"/&gt;
             &lt;/signal&gt;
            &lt;/interface&gt;
            &lt;interface name="org.freedesktop.systemd.VtableExample"&gt;
             &lt;method name="Method1"&gt;
              &lt;arg type="s" direction="in"/&gt;
              &lt;arg type="s" direction="out"/&gt;
             &lt;/method&gt;
             &lt;method name="Method2"&gt;
              &lt;arg type="s" name="string" direction="in"/&gt;
              &lt;arg type="o" name="path" direction="in"/&gt;
              &lt;arg type="s" name="returnstring" direction="out"/&gt;
              &lt;annotation name="org.freedesktop.DBus.Deprecated" value="true"/&gt;
             &lt;/method&gt;
             &lt;property name="AutomaticStringProperty" type="s" access="readwrite"&gt;
             &lt;/property&gt;
             &lt;property name="AutomaticIntegerProperty" type="u" access="readwrite"&gt;
              &lt;annotation name="org.freedesktop.DBus.Property.EmitsChangedSignal" value="invalidates"/&gt;
             &lt;/property&gt;
            &lt;/interface&gt;
           &lt;/node&gt;

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>sd_bus_add_object_vtable()</b> and <b>sd_bus_add_fallback_vtable()</b> return a non-negative integer. On
       failure, they return a negative errno-style error code.

   <b>Errors</b>
       Returned errors may indicate the following problems:

       <b>-EINVAL</b>
           One of the required parameters is <b>NULL</b> or invalid. A reserved D-Bus interface was passed as the
           <u>interface</u> parameter.

       <b>-ENOPKG</b>
           The bus cannot be resolved.

       <b>-ECHILD</b>
           The bus was created in a different process, library or module instance.

       <b>-ENOMEM</b>
           Memory allocation failed.

       <b>-EPROTOTYPE</b>
           <b>sd_bus_add_object_vtable()</b> and <b>sd_bus_add_fallback_vtable()</b> have been both called for the same bus
           object path, which is not allowed.

       <b>-EEXIST</b>
           This vtable has already been registered for this <u>interface</u> and <u>path</u>.

</pre><h4><b>NOTES</b></h4><pre>
       Functions described here are available as a shared library, which can be compiled against and linked to
       with the <b>libsystemd</b> <b><a href="../man1/pkg-config.1.html">pkg-config</a></b>(1) file.

       The code described here uses <b><a href="../man3/getenv.3.html">getenv</a></b>(3), which is declared to be not multi-thread-safe. This means that
       the code calling the functions described here must not call <b><a href="../man3/setenv.3.html">setenv</a></b>(3) from a parallel thread. It is
       recommended to only do calls to <b>setenv()</b> from an early phase of the program when no other threads have
       been started.

</pre><h4><b>HISTORY</b></h4><pre>
       <b>sd_bus_property_get_t()</b>, <b>sd_bus_property_set_t()</b>, <b>sd_bus_object_find_t()</b>, <b>sd_bus_add_object()</b>,
       <b>sd_bus_add_fallback()</b>, <b>sd_bus_add_object_vtable()</b>, <b>sd_bus_add_fallback_vtable()</b>, and <b>sd_bus_add_filter()</b>
       were added in version 221.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/sd-bus.3.html">sd-bus</a></b>(3), <b><a href="../man1/busctl.1.html">busctl</a></b>(1), <b><a href="../man3/sd_bus_emit_properties_changed.3.html">sd_bus_emit_properties_changed</a></b>(3), <b><a href="../man3/sd_bus_emit_object_added.3.html">sd_bus_emit_object_added</a></b>(3)

</pre><h4><b>NOTES</b></h4><pre>
        1. D-Bus annotations
           https://dbus.freedesktop.org/doc/dbus-specification.html#introspection-format

        2. polkit
           https://www.freedesktop.org/software/polkit/docs/latest/

systemd 257.7                                                                               <u><a href="../man3/SD_BUS_ADD_OBJECT.3.html">SD_BUS_ADD_OBJECT</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>