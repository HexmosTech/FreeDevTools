<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pappl-device - pappl device functions</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libpappl-dev">libpappl-dev_1.4.9-0ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pappl-device - pappl device functions

</pre><h4><b>LIBRARY</b></h4><pre>
       Printer Application Framework (libpappl, "pkg-config --cflags --libs pappl")

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;pappl/pappl.h&gt;</b>

       <u>typedef</u> <u>struct</u> <b>_</b><u>pappl_device_s</u> <b>pappl_device_t;</b>

       <u>void</u>
       <b>papplDeviceAddScheme</b><u>(const</u>    <u>char</u>    <u>*scheme,</u>    <u>pappl_dtype_t</u>    <u>dtype,</u>   <u>pappl_devlist_cb_t</u>   <u>list_cb,</u>
       <u>pappl_devopen_cb_t</u> <u>open_cb,</u> <u>pappl_devclose_cb_t</u> <u>close_cb,</u> <u>pappl_devread_cb_t</u> <u>read_cb,</u> <u>pappl_devwrite_cb_t</u>
       <u>write_cb,</u> <u>pappl_devstatus_cb_t</u> <u>status_cb);</u>

       <u>void</u>
       <b>papplDeviceClose</b><u>(pappl_device_t</u> <u>*device);</u>

       <u>void</u>
       <b>papplDeviceError</b><u>(pappl_device_t</u> <u>*device,</u> <u>const</u> <u>char</u> <u>*message,</u> <u>...);</u>

       <u>void</u>
       <b>papplDeviceFlush</b><u>(pappl_device_t</u> <u>*device);</u>

       <u>void</u> <u>*</u>
       <b>papplDeviceGetData</b><u>(pappl_device_t</u> <u>*device);</u>

       <u>pappl_dmetrics_t</u> <u>*</u>
       <b>papplDeviceGetMetrics</b><u>(pappl_device_t</u> <u>*device,</u> <u>pappl_dmetrics_t</u> <u>*metrics);</u>

       <u>pappl_preason_t</u>
       <b>papplDeviceGetStatus</b><u>(pappl_device_t</u> <u>*device);</u>

       <u>bool</u>
       <b>papplDeviceList</b><u>(pappl_dtype_t</u> <u>types,</u> <u>pappl_device_cb_t</u> <u>cb,</u> <u>void</u> <u>*data,</u> <u>pappl_deverror_cb_t</u>  <u>err_cb,</u>  <u>void</u>
       <u>*err_data);</u>

       <u>pappl_device_t</u> <u>*</u>
       <b>papplDeviceOpen</b><u>(const</u> <u>char</u> <u>*device_uri,</u> <u>const</u> <u>char</u> <u>*name,</u> <u>pappl_deverror_cb_t</u> <u>err_cb,</u> <u>void</u> <u>*err_data);</u>

       <u>int</u>
       <b>papplDeviceParse1284ID</b><u>(const</u> <u>char</u> <u>*device_id,</u> <u>cups_option_t</u> <u>**pairs);</u>

       <u>ssize_t</u>
       <b>papplDevicePrintf</b><u>(pappl_device_t</u> <u>*device,</u> <u>const</u> <u>char</u> <u>*format,</u> <u>...);</u>

       <u>ssize_t</u>
       <b>papplDevicePuts</b><u>(pappl_device_t</u> <u>*device,</u> <u>const</u> <u>char</u> <u>*s);</u>

       <u>ssize_t</u>
       <b>papplDeviceRead</b><u>(pappl_device_t</u> <u>*device,</u> <u>void</u> <u>*buffer,</u> <u>size_t</u> <u>bytes);</u>

       <u>void</u>
       <b>papplDeviceSetData</b><u>(pappl_device_t</u> <u>*device,</u> <u>void</u> <u>*data);</u>

       <u>ssize_t</u>
       <b>papplDeviceWrite</b><u>(pappl_device_t</u> <u>*device,</u> <u>const</u> <u>void</u> <u>*buffer,</u> <u>size_t</u> <u>bytes);</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>PAPPL</b>  device  functions  provide  access  to output device connections and to list available output
       devices.   Output  devices  are  accessed  using  Uniform  Resource  Identifier  (URI)  strings  such  as
       "file:///path/to/file-or-directory", "socket://11.22.33.44", and "usb://make/model?serial=number".

       The  <b>papplDeviceList</b>  function  lists available output devices, providing each available output device to
       the supplied callback function.  The list only contains devices whose URI scheme supports  discovery,  at
       present USB printers and network printers that advertise themselves using DNS-SD/mDNS and/or SNMPv1.

       The  <b>papplDeviceOpen</b>  function opens a connection to an output device using its URI. The <b>papplDeviceClose</b>
       function closes the connection.

       The <b>papplDevicePrintf,</b> <b>papplDevicePuts,</b> and <b>papplDeviceWrite</b> functions send data to the device, while the
       <b>papplDeviceRead</b> function reads data from the device.

       The <b>papplDeviceGetMetrics</b> function gets statistical information about all communications with the  device
       while  it has been open, while the <b>papplDeviceGetStatus</b> function gets the hardware status of a device and
       maps it to the <b>pappl_preason_t</b> bitfield.

</pre><h4><b>ENUMERATIONS</b></h4><pre>
   <b>pappl_devtype_e</b>
       Device type bit values

       PAPPL_DEVTYPE_ALL
            All printers

       PAPPL_DEVTYPE_CUSTOM_LOCAL
            Local printer using a custom interface or protocol

       PAPPL_DEVTYPE_CUSTOM_NETWORK
            Network printer using a custom interface or protocol

       PAPPL_DEVTYPE_DNS_SD
            Network printers discovered via DNS-SD/mDNS

       PAPPL_DEVTYPE_FILE
            Local file/directory

       PAPPL_DEVTYPE_LOCAL
            All local printers

       PAPPL_DEVTYPE_NETWORK
            All network printers

       PAPPL_DEVTYPE_SNMP
            Network printers discovered via SNMP

       PAPPL_DEVTYPE_SOCKET
            Network printers using raw socket

       PAPPL_DEVTYPE_USB
            USB printers

</pre><h4><b>FUNCTIONS</b></h4><pre>
   <b>papplDeviceAddScheme</b>
       Add a device URI scheme.

       void papplDeviceAddScheme (
           const char *scheme,
           pappl_devtype_t dtype,
           pappl_devlist_cb_t list_cb,
           pappl_devopen_cb_t open_cb,
           pappl_devclose_cb_t close_cb,
           pappl_devread_cb_t read_cb,
           pappl_devwrite_cb_t write_cb,
           pappl_devstatus_cb_t status_cb,
           pappl_devid_cb_t id_cb
       );

       This function registers a device URI scheme with PAPPL, so  that  devices  using  the  named  scheme  can
       receive  print  data,  report status information, and so forth.  PAPPL includes support for the following
       URI schemes:

       •    <b>dnssd</b>: Network printers discovered using DNS-SD.

       •    <b>file</b>: Character device files, plain files, and directories.

       •    <b>snmp</b>: Network printers discovered using SNMPv1.

       •    <b>socket</b>: Network printers using a hostname or numeric IP address.

       •    <b>usb</b>: Class 1 (unidirectional) or 2 (bidirectional) USB printers.

       The "scheme" parameter specifies the URI scheme and must consist of lowercase letters, digits, "-",  "_",
       and/or ".", for example "x-foo" or "com.example.bar".

       The  "dtype"  parameter  specifies  the  device  type  and should be <b>PAPPL_DTYPE_CUSTOM_LOCAL</b> for locally
       connected printers and <b>PAPPL_DTYPE_CUSTOM_NETWORK</b> for network printers.

       Each of the callbacks corresponds to one of the <b>papplDevice</b> functions:

       •    "list_cb": Implements discovery of devices (optional)

       •    "open_cb": Opens communication with a device and allocates any device-
              specific data as needed

       •    "close_cb": Closes communication with a device and frees any device-
              specific data as needed

       •    "read_cb": Reads data from a device

       •    "write_cb": Write data to a device

       •    "status_cb": Gets basic printer state information from a device (optional)

       •    "id_cb": Gets the current IEEE-1284 device ID from a device (optional)

       The "open_cb" callback typically calls <u>papplDeviceSetData</u> to store a pointer  to  contextual  information
       for  the  connection  while  the  "close_cb",  "id_cb",  "read_cb", "write_cb", and "status_cb" callbacks
       typically call <u>papplDeviceGetData</u> to retrieve it.

   <b>papplDeviceAddScheme2</b>
       Add a device URI scheme with supply-level queries.

       void papplDeviceAddScheme2 (
           const char *scheme,
           pappl_devtype_t dtype,
           pappl_devlist_cb_t list_cb,
           pappl_devopen_cb_t open_cb,
           pappl_devclose_cb_t close_cb,
           pappl_devread_cb_t read_cb,
           pappl_devwrite_cb_t write_cb,
           pappl_devstatus_cb_t status_cb,
           pappl_devsupplies_cb_t supplies_cb,
           pappl_devid_cb_t id_cb
       );

       This function registers a device URI scheme with PAPPL, so  that  devices  using  the  named  scheme  can
       receive  print  data,  report status information, and so forth.  PAPPL includes support for the following
       URI schemes:

       •    <b>dnssd</b>: Network printers discovered using DNS-SD.

       •    <b>file</b>: Character device files, plain files, and directories.

       •    <b>snmp</b>: Network printers discovered using SNMPv1.

       •    <b>socket</b>: Network printers using a hostname or numeric IP address.

       •    <b>usb</b>: Class 1 (unidirectional) or 2 (bidirectional) USB printers.

       The "scheme" parameter specifies the URI scheme and must consist of lowercase letters, digits, "-",  "_",
       and/or ".", for example "x-foo" or "com.example.bar".

       The  "dtype"  parameter  specifies  the  device  type  and should be <b>PAPPL_DTYPE_CUSTOM_LOCAL</b> for locally
       connected printers and <b>PAPPL_DTYPE_CUSTOM_NETWORK</b> for network printers.

       Each of the callbacks corresponds to one of the <b>papplDevice</b> functions:

       •    "list_cb": Implements discovery of devices (optional)

       •    "open_cb": Opens communication with a device and allocates any device-
              specific data as needed

       •    "close_cb": Closes communication with a device and frees any device-
              specific data as needed

       •    "read_cb": Reads data from a device

       •    "write_cb": Write data to a device

       •    "status_cb": Gets basic printer state information from a device (optional)

       •    "supplies_cb": Gets supply level information from a device (optional)

       •    "id_cb": Gets the current IEEE-1284 device ID from a device (optional)

       The "open_cb" callback typically calls <u>papplDeviceSetData</u> to store a pointer  to  contextual  information
       for  the  connection while the "close_cb", "id_cb", "read_cb", "write_cb", "status_cb", and "supplies_cb"
       callbacks typically call <u>papplDeviceGetData</u> to retrieve it.

   <b>papplDeviceClose</b>
       Close a device connection.

       void papplDeviceClose (
           pappl_device_t *device
       );

       This function flushes any pending write data and closes the connection to a device.

   <b>papplDeviceError</b>
       Report an error on a device.

       void papplDeviceError (
           pappl_device_t *device,
           const char *message,
           ...
       );

       This function reports an error on a device using the client-supplied callback function.  It  is  normally
       called from any custom device URI scheme callbacks you implement.

   <b>papplDeviceFlush</b>
       Flush any buffered data to the device.

       void papplDeviceFlush (
           pappl_device_t *device
       );

       This  function  flushes  any  pending  write  data  sent using the <u>papplDevicePrintf</u>, <u>papplDevicePuts</u>, or
       <u>papplDeviceWrite</u> functions to the device.

   <b>papplDeviceGetData</b>
       Get device-specific data.

       void * papplDeviceGetData (
           pappl_device_t *device
       );

       This function returns any device-specific data that has been set by the  device  open  callback.   It  is
       normally only called from any custom device URI scheme callbacks you implement.

   <b>papplDeviceGetID</b>
       Get the IEEE-1284 device ID.

       char * papplDeviceGetID (
           pappl_device_t *device,
           char *buffer,
           size_t bufsize
       );

       This  function queries the IEEE-1284 device ID from the device and copies it to the provided buffer.  The
       buffer must be at least 64 bytes and should be at least 1024 bytes in length.

       5      <u>Note:</u> This function can block for up to several seconds depending on

       5      the type of connection.

   <b>papplDeviceGetMetrics</b>
       Get the device metrics.

       pappl_devmetrics_t * papplDeviceGetMetrics (
           pappl_device_t *device,
           pappl_devmetrics_t *metrics
       );

       This function returns a copy of the device metrics data, which includes the number,  length  (in  bytes),
       and  duration  (in  milliseconds)  of  read,  status,  and  write requests for the current session.  This
       information is normally used for performance measurement and optimization during development of a printer
       application.  It can also be useful diagnostic information.

   <b>papplDeviceGetStatus</b>
       Get the printer status bits.

       pappl_preason_t  papplDeviceGetStatus (
           pappl_device_t *device
       );

       This function returns the current printer status bits, as applicable to the current device.

       The status bits for USB devices come from the original Centronics parallel printer "standard"  which  was
       later  formally  standardized in IEEE 1284-1984 and the USB Device Class Definition for Printing Devices.
       Some vendor extensions are also supported.

       The status bits for network devices come from the hrPrinterDetectedErrorState property that is defined in
       the SNMP Printer MIB v2 (RFC 3805).

       This function returns a <u>pappl_preason_t</u> bitfield  which  can  be  passed  to  the  <u>papplPrinterSetReasons</u>
       function.  Use the <u>PAPPL_PREASON_DEVICE_STATUS</u> value as the value of the "remove" argument.

       5      Note: This function can block for several seconds while getting the status

       5      information.

   <b>papplDeviceGetSupplies</b>
       Get the current printer supplies.

       int  papplDeviceGetSupplies (
           pappl_device_t *device,
           int max_supplies,
           pappl_supply_t *supplies
       );

       This  function returns the number, type, and level of current printer supply levels, as applicable to the
       current device.

       The supply levels for network devices come from the prtSupplyTable and prtMarkerColorantTable  properties
       that are defined in the SNMP Printer MIB v2 (RFC 3805).

       The supply levels for other devices are not standardized and must be queried using other methods.

       5      Note: This function can block for several seconds while getting the supply

       5      information.

   <b>papplDeviceIsSupported</b>
       Determine whether a given URI is supported.

       bool  papplDeviceIsSupported (
           const char *uri
       );

       This function determines whether a given URI or URI scheme is supported as a device.

   <b>papplDeviceList</b>
       List available devices.

       bool  papplDeviceList (
           pappl_devtype_t types,
           pappl_device_cb_t cb,
           void *data,
           pappl_deverror_cb_t err_cb,
           void *err_data
       );

       This  function  lists  the  available  devices,  calling  the  "cb"  function  once  per  device  that is
       discovered/listed.  The callback function receives the device URI, IEEE-1284  device  ID  (if  any),  and
       "data" pointer, and returns <b>true</b> to stop listing devices and <b>false</b> to continue.

       The  "types"  argument  determines  which devices are listed, for example <b>PAPPL_DEVTYPE_ALL</b> will list all
       types of devices while <b>PAPPL_DEVTYPE_USB</b> only lists USB printers.

       Any errors are reported using the supplied "err_cb" function.  If you specify  <b>NULL</b>  for  this  argument,
       errors are sent to <b>stderr</b>.

       5      Note: This function will block (not return) until each of the device URI

       5      schemes has reported all of the devices <u>or</u> the supplied callback function

       5      returns <b>true</b>.

   <b>papplDeviceOpen</b>
       Open a connection to a device.

       pappl_device_t * papplDeviceOpen (
           const char *device_uri,
           const char *name,
           pappl_deverror_cb_t err_cb,
           void *err_data
       );

       This  function  opens  a  connection  to  the specified device URI.  The "name" argument provides textual
       context for the connection and is usually the name (title) of the print job.

       Any errors are reported using the supplied "err_cb" function.  If you specify  <b>NULL</b>  for  this  argument,
       errors are sent to <b>stderr</b>.

   <b>papplDeviceParseID</b>
       Parse an IEEE-1284 device ID string.

       int  papplDeviceParseID (
           const char *device_id,
           cups_option_t **pairs
       );

       This  function  parses  an  IEEE-1284  device  ID  string  and  returns  an array of key/value pairs as a
       <b>cups_option_t</b> array.  The returned array must be freed using the <b>cupsFreeOptions</b> function.

   <b>papplDevicePrintf</b>
       Write a formatted string.

       ssize_t  papplDevicePrintf (
           pappl_device_t *device,
           const char *format,
           ...
       );

       This function buffers a formatted string that will be sent to the device.  The "format" argument  accepts
       all <b>printf</b> format specifiers and behaves identically to that function.

       Call the <u>papplDeviceFlush</u> function to ensure that the formatted string is immediately sent to the device.

   <b>papplDevicePuts</b>
       Write a literal string.

       ssize_t  papplDevicePuts (
           pappl_device_t *device,
           const char *s
       );

       This  function  buffers  a  literal  string  that  will be sent to the device.  Call the <u>papplDeviceFlush</u>
       function to ensure that the literal string is immediately sent to the device.

   <b>papplDeviceRead</b>
       Read from a device.

       ssize_t  papplDeviceRead (
           pappl_device_t *device,
           void *buffer,
           size_t bytes
       );

       This function reads data from the device.  Depending on the device, this function may block indefinitely.

   <b>papplDeviceRemoveScheme</b>
       Remove the named device URI scheme.

       void papplDeviceRemoveScheme (
           const char *scheme
       );

       This function removes support for the named device URI scheme.  Use only when you want to disable  a  URI
       scheme for security or functional reasons, for example to disable the "file" URI scheme.

   <b>papplDeviceRemoveTypes</b>
       Remove device URI schemes of the specified types.

       void papplDeviceRemoveTypes (
           pappl_devtype_t types
       );

       This  function  removes device URI schemes of the specified types.  Use only when you want to disable URI
       schemes for security or functional reasons, for example to disable all network URI schemes.

   <b>papplDeviceSetData</b>
       Set device-specific data.

       void papplDeviceSetData (
           pappl_device_t *device,
           void *data
       );

       This function sets any device-specific data needed to communicate with the device.  It is  normally  only
       called from the open callback that was registered for the device URI scheme.

   <b>papplDeviceWrite</b>
       Write to a device.

       ssize_t  papplDeviceWrite (
           pappl_device_t *device,
           const void *buffer,
           size_t bytes
       );

       This function buffers data that will be sent to the device.  Call the <u>papplDeviceFlush</u> function to ensure
       that the data is immediately sent to the device.

</pre><h4><b>STRUCTURES</b></h4><pre>
   <b>pappl_devmetrics_s</b>
       Device metrics

       struct pappl_devmetrics_s
       {
         size_t read_bytes;
         size_t read_msecs;
         size_t read_requests;
         size_t status_msecs;
         size_t status_requests;
         size_t write_bytes;
         size_t write_msecs;
         size_t write_requests;
       };

</pre><h4><b>TYPES</b></h4><pre>
   <b>pappl_devclose_cb_t</b>
       Device close callback

       typedef void (*pappl_devclose_cb_t)(pappl_device_t *device);

   <b>pappl_deverror_cb_t</b>
       Device error callback

       typedef void (*pappl_deverror_cb_t)(const char *message, void *err_data);

   <b>pappl_device_cb_t</b>
       Device callback - return <b>true</b> to stop, <b>false</b> to continue

       typedef bool (*pappl_device_cb_t)(const char *device_info, const char *device_uri, const char *device_id, void *data);

   <b>pappl_devid_cb_t</b>
       Device ID callback

       typedef char * (*pappl_devid_cb_t)(pappl_device_t *device, char *buffer, size_t bufsize);

   <b>pappl_devlist_cb_t</b>
       Device list callback

       typedef bool (*pappl_devlist_cb_t)(pappl_device_cb_t cb, void *data, pappl_deverror_cb_t err_cb, void *err_data);

   <b>pappl_devmetrics_t</b>
       Device metrics

       typedef struct pappl_devmetrics_s pappl_devmetrics_t;

   <b>pappl_devopen_cb_t</b>
       Device open callback

       typedef bool (*pappl_devopen_cb_t)(pappl_device_t *device, const char *device_uri, const char *name);

   <b>pappl_devread_cb_t</b>
       Device read callback

       typedef ssize_t (*pappl_devread_cb_t)(pappl_device_t *device, void *buffer, size_t bytes);

   <b>pappl_devstatus_cb_t</b>
       Device status callback

       typedef pappl_preason_t (*pappl_devstatus_cb_t)(pappl_device_t *device);

   <b>pappl_devsupplies_cb_t</b>
       Device supplies callback

       typedef int (*pappl_devsupplies_cb_t)(pappl_device_t *device, int max_supplies, pappl_supply_t *supplies);

   <b>pappl_devtype_t</b>
       Device type bitfield

       typedef unsigned pappl_devtype_t;

   <b>pappl_devwrite_cb_t</b>
       Device write callback

       typedef ssize_t (*pappl_devwrite_cb_t)(pappl_device_t *device, const void *buffer, size_t bytes);

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/pappl.1.html">pappl</a></b>(1),   <b><a href="../man3/pappl-client.3.html">pappl-client</a></b>(3),   <b><a href="../man3/pappl-device.3.html">pappl-device</a></b>(3),  <b><a href="../man3/pappl-job.3.html">pappl-job</a></b>(3),  <b><a href="../man3/pappl-log.3.html">pappl-log</a></b>(3),  <b><a href="../man3/pappl-mainline.3.html">pappl-mainline</a></b>(3),  <b><a href="../man1/papplmakeresheader.1.html">pappl-</a></b>
       <b><a href="../man1/papplmakeresheader.1.html">makeresheader</a></b>(1), <b><a href="../man3/pappl-printer.3.html">pappl-printer</a></b>(3), <b><a href="../man3/pappl-resource.3.html">pappl-resource</a></b>(3), <b><a href="../man3/pappl-system.3.html">pappl-system</a></b>(3), https://www.msweet.org/pappl

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright © 2019-2022 by Michael R Sweet.

       <b>PAPPL</b> is licensed under the Apache License Version 2.0 with an  (optional)  exception  to  allow  linking
       against  GPL2/LGPL2 software (like older versions of CUPS), so it can be used <u>freely</u> in any project you'd
       like.  See the files "LICENSE" and "NOTICE" in the source distribution for more information.

2025-03-20                                   pappl device functions                              <u><a href="../man3/pappl-device.3.html">pappl-device</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>