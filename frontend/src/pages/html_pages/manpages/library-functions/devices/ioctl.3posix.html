<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-posix-dev">manpages-posix-dev_2017a-2_all</a> <br><br><pre>
</pre><h4><b>PROLOG</b></h4><pre>
       This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface
       may differ (consult the corresponding Linux manual page for details of Linux behavior), or the  interface
       may not be implemented on Linux.

</pre><h4><b>NAME</b></h4><pre>
       ioctl — control a STREAMS device (<b>STREAMS</b>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;stropts.h&gt;

       int ioctl(int <u>fildes</u>, int <u>request</u>, ... /* arg */);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <u>ioctl</u>()  function  shall  perform a variety of control functions on STREAMS devices. For non-STREAMS
       devices, the functions performed by this call are unspecified. The <u>request</u> argument and an optional third
       argument (with varying type) shall be passed to and interpreted by the appropriate  part  of  the  STREAM
       associated with <u>fildes</u>.

       The <u>fildes</u> argument is an open file descriptor that refers to a device.

       The  <u>request</u> argument selects the control function to be performed and shall depend on the STREAMS device
       being addressed.

       The <u>arg</u> argument represents additional information that is needed by  this  specific  STREAMS  device  to
       perform the requested function. The type of <u>arg</u> depends upon the particular control request, but it shall
       be either an integer or a pointer to a device-specific data structure.

       The  <u>ioctl</u>()  commands  applicable  to  STREAMS, their arguments, and error conditions that apply to each
       individual command are described below.

       The following <u>ioctl</u>() commands, with error values indicated, are applicable to all STREAMS files:

       I_PUSH      Pushes the module whose name is pointed to by <u>arg</u> onto the top of the  current  STREAM,  just
                   below the STREAM head. It then calls the <u>open</u>() function of the newly-pushed module.

                   The <u>ioctl</u>() function with the I_PUSH command shall fail if:

                   <b>EINVAL</b> Invalid module name.

                   <b>ENXIO</b>  Open function of new module failed.

                   <b>ENXIO</b>  Hangup received on <u>fildes</u>.

       I_POP       Removes  the  module  just below the STREAM head of the STREAM pointed to by <u>fildes</u>.  The <u>arg</u>
                   argument should be 0 in an I_POP request.

                   The <u>ioctl</u>() function with the I_POP command shall fail if:

                   <b>EINVAL</b> No module present in the STREAM.

                   <b>ENXIO</b>  Hangup received on <u>fildes</u>.

       I_LOOK      Retrieves the name of the module just below the STREAM head  of  the  STREAM  pointed  to  by
                   <u>fildes</u>,  and places it in a character string pointed to by <u>arg</u>.  The buffer pointed to by <u>arg</u>
                   should be at least FMNAMESZ+1 bytes long, where FMNAMESZ is defined in <u>&lt;stropts.h&gt;</u>.

                   The <u>ioctl</u>() function with the I_LOOK command shall fail if:

                   <b>EINVAL</b> No module present in the STREAM.

       I_FLUSH     Flushes read and/or write queues, depending on the value of <u>arg</u>.  Valid <u>arg</u> values are:

                   FLUSHR      Flush all read queues.

                   FLUSHW      Flush all write queues.

                   FLUSHRW     Flush all read and all write queues.

                   The <u>ioctl</u>() function with the I_FLUSH command shall fail if:

                   <b>EINVAL</b> Invalid <u>arg</u> value.

                   <b>EAGAIN</b> or <b>ENOSR</b>
                          Unable to allocate buffers for flush message.

                   <b>ENXIO</b>  Hangup received on <u>fildes</u>.

       I_FLUSHBAND Flushes a particular band of messages. The <u>arg</u> argument points to a <b>bandinfo</b>  structure.  The
                   <u>bi_flag</u> member may be one of FLUSHR, FLUSHW, or FLUSHRW as described above. The <u>bi_pri</u> member
                   determines the priority band to be flushed.

       I_SETSIG    Requests  that the STREAMS implementation send the SIGPOLL signal to the calling process when
                   a particular event has occurred on the STREAM associated with <u>fildes</u>.  I_SETSIG  supports  an
                   asynchronous  processing  capability in STREAMS. The value of <u>arg</u> is a bitmask that specifies
                   the events for which the process should be signaled. It is the bitwise-inclusive  OR  of  any
                   combination of the following constants:

                   S_RDNORM    A  normal  (priority  band  set to 0) message has arrived at the head of a STREAM
                               head read queue. A signal shall be generated even  if  the  message  is  of  zero
                               length.

                   S_RDBAND    A  message with a non-zero priority band has arrived at the head of a STREAM head
                               read queue. A signal shall be generated even if the message is of zero length.

                   S_INPUT     A message, other than a high-priority message, has  arrived  at  the  head  of  a
                               STREAM  head  read  queue.  A signal shall be generated even if the message is of
                               zero length.

                   S_HIPRI     A high-priority message is present on a STREAM head read queue. A signal shall be
                               generated even if the message is of zero length.

                   S_OUTPUT    The write queue for normal data (priority band 0) just below the STREAM  head  is
                               no  longer  full.  This  notifies the process that there is room on the queue for
                               sending (or writing) normal data downstream.

                   S_WRNORM    Equivalent to S_OUTPUT.

                   S_WRBAND    The write queue for a non-zero priority band just below the  STREAM  head  is  no
                               longer  full.  This  notifies  the  process  that  there is room on the queue for
                               sending (or writing) priority data downstream.

                   S_MSG       A STREAMS signal message that contains the SIGPOLL signal has reached  the  front
                               of the STREAM head read queue.

                   S_ERROR     Notification of an error condition has reached the STREAM head.

                   S_HANGUP    Notification of a hangup has reached the STREAM head.

                   S_BANDURG   When  used  in  conjunction with S_RDBAND, SIGURG is generated instead of SIGPOLL
                               when a priority message reaches the front of the STREAM head read queue.

                   If <u>arg</u> is 0, the calling process shall be unregistered and shall not receive further  SIGPOLL
                   signals for the stream associated with <u>fildes</u>.

                   Processes  that wish to receive SIGPOLL signals shall ensure that they explicitly register to
                   receive them using I_SETSIG. If several processes register to receive  this  signal  for  the
                   same event on the same STREAM, each process shall be signaled when the event occurs.

                   The <u>ioctl</u>() function with the I_SETSIG command shall fail if:

                   <b>EINVAL</b> The value of <u>arg</u> is invalid.

                   <b>EINVAL</b> The value of <u>arg</u> is 0 and the calling process is not registered to receive the SIGPOLL
                          signal.

                   <b>EAGAIN</b> There were insufficient resources to store the signal request.

       I_GETSIG    Returns the events for which the calling process is currently registered to be sent a SIGPOLL
                   signal.  The  events  are returned as a bitmask in an <b>int</b> pointed to by <u>arg</u>, where the events
                   are those specified in the description of I_SETSIG above.

                   The <u>ioctl</u>() function with the I_GETSIG command shall fail if:

                   <b>EINVAL</b> Process is not registered to receive the SIGPOLL signal.

       I_FIND      Compares the names of all modules currently present in the STREAM to the name pointed  to  by
                   <u>arg</u>,  and  returns  1 if the named module is present in the STREAM, or returns 0 if the named
                   module is not present.

                   The <u>ioctl</u>() function with the I_FIND command shall fail if:

                   <b>EINVAL</b> <u>arg</u> does not contain a valid module name.

       I_PEEK      Retrieves the information in the first message on the STREAM head read queue  without  taking
                   the  message  off  the  queue.  It is analogous to <u>getmsg</u>() except that this command does not
                   remove the message from the queue.  The <u>arg</u> argument points to a <b>strpeek</b> structure.

                   The application shall ensure that  the  <u>maxlen</u>  member  in  the  <b>ctlbuf</b>  and  <b>databuf</b>  <b>strbuf</b>
                   structures  is  set  to  the  number of bytes of control information and/or data information,
                   respectively, to retrieve. The <u>flags</u> member may be marked RS_HIPRI  or  0,  as  described  by
                   <u>getmsg</u>().   If  the process sets <u>flags</u> to RS_HIPRI, for example, I_PEEK shall only look for a
                   high-priority message on the STREAM head read queue.

                   I_PEEK returns 1 if a message was retrieved, and returns 0 if no message  was  found  on  the
                   STREAM  head read queue, or if the RS_HIPRI flag was set in <u>flags</u> and a high-priority message
                   was not present on the STREAM head read queue. It does not wait for a message to  arrive.  On
                   return,  <b>ctlbuf</b> specifies information in the control buffer, <b>databuf</b> specifies information in
                   the data buffer, and <u>flags</u> contains the value RS_HIPRI or 0.

       I_SRDOPT    Sets the read mode using the value of the argument <u>arg</u>.  Read modes are described in  <u>read</u>().
                   Valid <u>arg</u> flags are:

                   RNORM       Byte-stream mode, the default.

                   RMSGD       Message-discard mode.

                   RMSGN       Message-nondiscard mode.

                   The  bitwise-inclusive OR of RMSGD and RMSGN shall return <b>[EINVAL]</b>.  The bitwise-inclusive OR
                   of RNORM and either RMSGD or RMSGN shall result in the other flag overriding RNORM  which  is
                   the default.

                   In  addition,  treatment of control messages by the STREAM head may be changed by setting any
                   of the following flags in <u>arg</u>:

                   RPROTNORM   Fail <u>read</u>() with <b>[EBADMSG]</b> if a message containing a control part is at the front
                               of the STREAM head read queue.

                   RPROTDAT    Deliver the control part of a message as data when a process issues a <u>read</u>().

                   RPROTDIS    Discard the control part of a  message,  delivering  any  data  portion,  when  a
                               process issues a <u>read</u>().

                   The <u>ioctl</u>() function with the I_SRDOPT command shall fail if:

                   <b>EINVAL</b> The <u>arg</u> argument is not valid.

       I_GRDOPT    Returns  the  current  read  mode  setting,  as  described above, in an <b>int</b> pointed to by the
                   argument <u>arg</u>.  Read modes are described in <u>read</u>().

       I_NREAD     Counts the number of data bytes in the data part of the first message on the STREAM head read
                   queue and places this value in the <b>int</b> pointed to by <u>arg</u>.  The return value for  the  command
                   shall  be the number of messages on the STREAM head read queue. For example, if 0 is returned
                   in <u>arg</u>, but the <u>ioctl</u>() return value is greater than 0, this  indicates  that  a  zero-length
                   message is next on the queue.

       I_FDINSERT  Creates  a message from specified buffer(s), adds information about another STREAM, and sends
                   the message downstream. The message contains a control part and an optional  data  part.  The
                   data  and  control  parts  to  be sent are distinguished by placement in separate buffers, as
                   described below. The <u>arg</u> argument points to a <b>strfdinsert</b> structure.

                   The application shall ensure that the <u>len</u> member in the <b>ctlbuf</b> <b>strbuf</b> structure is set to the
                   size of a <b>t_uscalar_t</b> plus the number of bytes of control information to  be  sent  with  the
                   message.  The <u>fildes</u> member specifies the file descriptor of the other STREAM, and the <u>offset</u>
                   member, which must be suitably aligned for use as a <b>t_uscalar_t</b>, specifies  the  offset  from
                   the   start  of  the  control  buffer  where  I_FDINSERT  shall  store  a  <b>t_uscalar_t</b>  whose
                   interpretation is specific to the STREAM end. The  application  shall  ensure  that  the  <u>len</u>
                   member  in  the <b>databuf</b> <b>strbuf</b> structure is set to the number of bytes of data information to
                   be sent with the message, or to 0 if no data part is to be sent.

                   The <u>flags</u> member specifies the type of message to be created. A normal message is created  if
                   <u>flags</u>  is  set  to 0, and a high-priority message is created if <u>flags</u> is set to RS_HIPRI. For
                   non-priority messages, I_FDINSERT shall block if the  STREAM  write  queue  is  full  due  to
                   internal  flow  control conditions.  For priority messages, I_FDINSERT does not block on this
                   condition. For non-priority messages, I_FDINSERT does not block when the write queue is  full
                   and O_NONBLOCK is set. Instead, it fails and sets <u>errno</u> to <b>[EAGAIN]</b>.

                   I_FDINSERT  also  blocks,  unless  prevented  by  lack of internal resources, waiting for the
                   availability of message blocks in the STREAM, regardless of priority  or  whether  O_NONBLOCK
                   has been specified. No partial message is sent.

                   The <u>ioctl</u>() function with the I_FDINSERT command shall fail if:

                   <b>EAGAIN</b> A  non-priority message is specified, the O_NONBLOCK flag is set, and the STREAM write
                          queue is full due to internal flow control conditions.

                   <b>EAGAIN</b> or <b>ENOSR</b>
                          Buffers cannot be allocated for the message that is to be created.

                   <b>EINVAL</b> One of the following:

                               --  The <u>fildes</u> member of the <b>strfdinsert</b> structure is not a  valid,  open  STREAM
                                   file descriptor.

                               --  The  size of a <b>t_uscalar_t</b> plus <u>offset</u> is greater than the <u>len</u> member for the
                                   buffer specified through <b>ctlbuf</b>.

                               --  The <u>offset</u> member does not specify a properly-aligned location  in  the  data
                                   buffer.

                               --  An undefined value is stored in <u>flags</u>.

                   <b>ENXIO</b>  Hangup  received  on the STREAM identified by either the <u>fildes</u> argument or the <u>fildes</u>
                          member of the <b>strfdinsert</b> structure.

                   <b>ERANGE</b> The <u>len</u> member for the buffer specified through <b>databuf</b> does not fall within the range
                          specified by the maximum and minimum packet sizes of the topmost STREAM module; or the
                          <u>len</u> member for the buffer  specified  through  <b>databuf</b>  is  larger  than  the  maximum
                          configured  size  of  the  data  part  of  a message; or the <u>len</u> member for the buffer
                          specified through <b>ctlbuf</b> is larger than the maximum configured  size  of  the  control
                          part of a message.

       I_STR       Constructs  an  internal  STREAMS  <u>ioctl</u>() message from the data pointed to by <u>arg</u>, and sends
                   that message downstream.

                   This mechanism is provided to send <u>ioctl</u>() requests to downstream  modules  and  drivers.  It
                   allows  information  to be sent with <u>ioctl</u>(), and returns to the process any information sent
                   upstream by the downstream recipient. I_STR shall block until the system responds with either
                   a positive or negative acknowledgement message, or until the request  times  out  after  some
                   period of time. If the request times out, it shall fail with <u>errno</u> set to <b>[ETIME]</b>.

                   At  most,  one  I_STR  can  be  active on a STREAM. Further I_STR calls shall block until the
                   active I_STR completes at the STREAM head. The default timeout interval for these requests is
                   15 seconds. The O_NONBLOCK flag has no effect on this call.

                   To send requests downstream, the application shall ensure  that  <u>arg</u>  points  to  a  <b>strioctl</b>
                   structure.

                   The  <u>ic_cmd</u> member is the internal <u>ioctl</u>() command intended for a downstream module or driver
                   and <u>ic_timout</u> is the number of seconds  (-1=infinite,  0=use  implementation-defined  timeout
                   interval, &gt;0=as specified) an I_STR request shall wait for acknowledgement before timing out.
                   <u>ic_len</u>  is  the  number  of  bytes  in  the data argument, and <u>ic_dp</u> is a pointer to the data
                   argument. The <u>ic_len</u> member has two uses: on input,  it  contains  the  length  of  the  data
                   argument  passed  in,  and  on return from the command, it contains the number of bytes being
                   returned to the process (the buffer pointed to by <u>ic_dp</u> should be large enough to contain the
                   maximum amount of data that any module or the driver in the STREAM can return).

                   The STREAM head shall convert the information pointed to by  the  <b>strioctl</b>  structure  to  an
                   internal <u>ioctl</u>() command message and send it downstream.

                   The <u>ioctl</u>() function with the I_STR command shall fail if:

                   <b>EAGAIN</b> or <b>ENOSR</b>
                          Unable to allocate buffers for the <u>ioctl</u>() message.

                   <b>EINVAL</b> The  <u>ic_len</u>  member  is  less than 0 or larger than the maximum configured size of the
                          data part of a message, or <u>ic_timout</u> is less than -1.

                   <b>ENXIO</b>  Hangup received on <u>fildes</u>.

                   <b>ETIME</b>  A downstream <u>ioctl</u>() timed out before acknowledgement was received.

                   An I_STR can also fail while waiting for an acknowledgement if a message indicating an  error
                   or  a  hangup  is received at the STREAM head.  In addition, an error code can be returned in
                   the positive or negative acknowledgement message, in  the  event  the  <u>ioctl</u>()  command  sent
                   downstream  fails.  For  these  cases,  I_STR  shall  fail with <u>errno</u> set to the value in the
                   message.

       I_SWROPT    Sets the write mode using the value of the argument <u>arg</u>.  Valid bit settings for <u>arg</u> are:

                   SNDZERO     Send a zero-length message downstream when a <u>write</u>() of 0 bytes  occurs.  To  not
                               send  a  zero-length  message  when  a <u>write</u>() of 0 bytes occurs, the application
                               shall ensure that this bit is not set in <u>arg</u> (for example, <u>arg</u> would  be  set  to
                               0).

                   The <u>ioctl</u>() function with the I_SWROPT command shall fail if:

                   <b>EINVAL</b> <u>arg</u> is not the above value.

       I_GWROPT    Returns  the current write mode setting, as described above, in the <b>int</b> that is pointed to by
                   the argument <u>arg</u>.

       I_SENDFD    Creates a new reference to the open file description associated with the file descriptor <u>arg</u>,
                   and writes a message on the STREAMS-based pipe <u>fildes</u>  containing  this  reference,  together
                   with the user ID and group ID of the calling process.

                   The <u>ioctl</u>() function with the I_SENDFD command shall fail if:

                   <b>EAGAIN</b> The  sending STREAM is unable to allocate a message block to contain the file pointer;
                          or the read queue of the receiving STREAM head is full and cannot accept  the  message
                          sent by I_SENDFD.

                   <b>EBADF</b>  The <u>arg</u> argument is not a valid, open file descriptor.

                   <b>EINVAL</b> The <u>fildes</u> argument is not connected to a STREAM pipe.

                   <b>ENXIO</b>  Hangup received on <u>fildes</u>.

                   The <u>ioctl</u>() function with the I_SENDFD command may fail if:

                   <b>EINVAL</b> The <u>arg</u> argument is equal to the <u>fildes</u> argument.

       I_RECVFD    Retrieves the reference to an open file description from a message written to a STREAMS-based
                   pipe  using  the I_SENDFD command, and allocates a new file descriptor in the calling process
                   that refers to this open file description. The <u>arg</u> argument is a pointer to a <b>strrecvfd</b>  data
                   structure as defined in <u>&lt;stropts.h&gt;</u>.

                   The  <u>fd</u>  member  is  a file descriptor. The <u>uid</u> and <u>gid</u> members are the effective user ID and
                   effective group ID, respectively, of the sending process.

                   If O_NONBLOCK is not set, I_RECVFD shall block until a message is present at the STREAM head.
                   If O_NONBLOCK is set, I_RECVFD shall fail with <u>errno</u> set to <b>[EAGAIN]</b> if no message is present
                   at the STREAM head.

                   If the message at the STREAM head is a message sent by an I_SENDFD,  a  new  file  descriptor
                   shall  be  allocated  for  the  open  file descriptor referenced in the message. The new file
                   descriptor is placed in the <u>fd</u> member of the <b>strrecvfd</b> structure pointed to by <u>arg</u>.

                   The <u>ioctl</u>() function with the I_RECVFD command shall fail if:

                   <b>EAGAIN</b> A message is not present at the STREAM head read queue and the O_NONBLOCK flag is set.

                   <b>EBADMSG</b>
                          The message at the STREAM head read queue is not a message containing  a  passed  file
                          descriptor.

                   <b>EMFILE</b> All file descriptors available to the process are currently open.

                   <b>ENXIO</b>  Hangup received on <u>fildes</u>.

       I_LIST      Allows  the  process  to  list  all  the  module names on the STREAM, up to and including the
                   topmost driver name. If <u>arg</u> is a null pointer, the  return  value  shall  be  the  number  of
                   modules,  including  the  driver, that are on the STREAM pointed to by <u>fildes</u>.  This lets the
                   process allocate enough space for the module names.  Otherwise, it should point to a <b>str_list</b>
                   structure.

                   The <u>sl_nmods</u> member indicates the number of entries the process has allocated in  the  array.
                   Upon return, the <u>sl_modlist</u> member of the <b>str_list</b> structure shall contain the list of module
                   names,  and the number of entries that have been filled into the <u>sl_modlist</u> array is found in
                   the <u>sl_nmods</u> member (the number includes the number of modules  including  the  driver).  The
                   return  value  from  <u>ioctl</u>() shall be 0. The entries are filled in starting at the top of the
                   STREAM and continuing downstream until either the end of the STREAM is reached, or the number
                   of requested modules (<u>sl_nmods</u>) is satisfied.

                   The <u>ioctl</u>() function with the I_LIST command shall fail if:

                   <b>EINVAL</b> The <u>sl_nmods</u> member is less than 1.

                   <b>EAGAIN</b> or <b>ENOSR</b>
                          Unable to allocate buffers.

       I_ATMARK    Allows the process to see if the message at the head of the STREAM head read queue is  marked
                   by  some  module  downstream. The <u>arg</u> argument determines how the checking is done when there
                   may be multiple marked messages on the STREAM head read queue. It may take on  the  following
                   values:

                   ANYMARK     Check if the message is marked.

                   LASTMARK    Check if the message is the last one marked on the queue.

                   The bitwise-inclusive OR of the flags ANYMARK and LASTMARK is permitted.

                   The return value shall be 1 if the mark condition is satisfied; otherwise, the value shall be
                   0.

                   The <u>ioctl</u>() function with the I_ATMARK command shall fail if:

                   <b>EINVAL</b> Invalid <u>arg</u> value.

       I_CKBAND    Checks  if  the  message  of a given priority band exists on the STREAM head read queue. This
                   shall return 1 if a message of the given priority exists, 0 if no such message exists, or  -1
                   on error.  <u>arg</u> should be of type <b>int</b>.

                   The <u>ioctl</u>() function with the I_CKBAND command shall fail if:

                   <b>EINVAL</b> Invalid <u>arg</u> value.

       I_GETBAND   Returns  the  priority band of the first message on the STREAM head read queue in the integer
                   referenced by <u>arg</u>.

                   The <u>ioctl</u>() function with the I_GETBAND command shall fail if:

                   <b>ENODATA</b>
                          No message on the STREAM head read queue.

       I_CANPUT    Checks if a certain band is writable.  <u>arg</u> is set to  the  priority  band  in  question.  The
                   return  value  shall be 0 if the band is flow-controlled, 1 if the band is writable, or -1 on
                   error.

                   The <u>ioctl</u>() function with the I_CANPUT command shall fail if:

                   <b>EINVAL</b> Invalid <u>arg</u> value.

       I_SETCLTIME This request allows the process to set the time the STREAM head shall delay when a STREAM  is
                   closing  and  there  is  data  on the write queues.  Before closing each module or driver, if
                   there is data on its write queue, the STREAM head shall delay for  the  specified  amount  of
                   time  to  allow  the  data  to drain. If, after the delay, data is still present, it shall be
                   flushed. The <u>arg</u> argument is a pointer to an integer specifying the number of milliseconds to
                   delay, rounded up to the nearest valid value. If I_SETCLTIME is not performed on a STREAM, an
                   implementation-defined default timeout interval is used.

                   The <u>ioctl</u>() function with the I_SETCLTIME command shall fail if:

                   <b>EINVAL</b> Invalid <u>arg</u> value.

       I_GETCLTIME Returns the close time delay in the integer pointed to by <u>arg</u>.

   <b>Multiplexed</b> <b>STREAMS</b> <b>Configurations</b>
       The following commands are used for connecting  and  disconnecting  multiplexed  STREAMS  configurations.
       These commands use an implementation-defined default timeout interval.

       I_LINK      Connects  two  STREAMs,  where  <u>fildes</u>  is the file descriptor of the STREAM connected to the
                   multiplexing driver, and <u>arg</u> is the file  descriptor  of  the  STREAM  connected  to  another
                   driver.  The  STREAM  designated  by  <u>arg</u>  is connected below the multiplexing driver. I_LINK
                   requires the multiplexing driver to send  an  acknowledgement  message  to  the  STREAM  head
                   regarding  the connection. This call shall return a multiplexer ID number (an identifier used
                   to disconnect the multiplexer; see I_UNLINK) on success, and -1 on failure.

                   The <u>ioctl</u>() function with the I_LINK command shall fail if:

                   <b>ENXIO</b>  Hangup received on <u>fildes</u>.

                   <b>ETIME</b>  Timeout before acknowledgement message was received at STREAM head.

                   <b>EAGAIN</b> or <b>ENOSR</b>
                          Unable to allocate STREAMS storage to perform the I_LINK.

                   <b>EBADF</b>  The <u>arg</u> argument is not a valid, open file descriptor.

                   <b>EINVAL</b> The <u>fildes</u> argument does not support multiplexing; or  <u>arg</u>  is  not  a  STREAM  or  is
                          already  connected  downstream  from  a multiplexer; or the specified I_LINK operation
                          would connect the STREAM head in more than one place in the multiplexed STREAM.

                   An I_LINK can also fail while waiting for the multiplexing driver to acknowledge the request,
                   if a message indicating an error or a hangup is received at the STREAM head  of  <u>fildes</u>.   In
                   addition,  an error code can be returned in the positive or negative acknowledgement message.
                   For these cases, I_LINK fails with <u>errno</u> set to the value in the message.

       I_UNLINK    Disconnects the two STREAMs specified by <u>fildes</u> and <u>arg</u>.  <u>fildes</u> is the  file  descriptor  of
                   the  STREAM  connected  to  the  multiplexing  driver. The <u>arg</u> argument is the multiplexer ID
                   number that was returned by the I_LINK <u>ioctl</u>() command when a STREAM was connected downstream
                   from the multiplexing driver. If <u>arg</u> is MUXID_ALL, then all STREAMs that  were  connected  to
                   <u>fildes</u> shall be disconnected. As in I_LINK, this command requires acknowledgement.

                   The <u>ioctl</u>() function with the I_UNLINK command shall fail if:

                   <b>ENXIO</b>  Hangup received on <u>fildes</u>.

                   <b>ETIME</b>  Timeout before acknowledgement message was received at STREAM head.

                   <b>EAGAIN</b> or <b>ENOSR</b>
                          Unable to allocate buffers for the acknowledgement message.

                   <b>EINVAL</b> Invalid multiplexer ID number.

                   An  I_UNLINK  can  also  fail  while  waiting  for the multiplexing driver to acknowledge the
                   request if a message indicating an error or a hangup  is  received  at  the  STREAM  head  of
                   <u>fildes</u>.    In  addition,  an  error  code  can  be  returned  in  the  positive  or  negative
                   acknowledgement message. For these cases, I_UNLINK shall fail with <u>errno</u> set to the value  in
                   the message.

       I_PLINK     Creates  a  <u>persistent</u> <u>connection</u> between two STREAMs, where <u>fildes</u> is the file descriptor of
                   the STREAM connected to the multiplexing driver, and <u>arg</u> is the file descriptor of the STREAM
                   connected to another driver. This call shall create a persistent connection which  can  exist
                   even  if  the  file  descriptor  <u>fildes</u>  associated with the upper STREAM to the multiplexing
                   driver is closed.  The STREAM designated by <u>arg</u> gets connected via  a  persistent  connection
                   below  the  multiplexing  driver.  I_PLINK  requires  the  multiplexing  driver  to  send  an
                   acknowledgement message to the STREAM head. This call shall return a  multiplexer  ID  number
                   (an identifier that may be used to disconnect the multiplexer; see I_PUNLINK) on success, and
                   -1 on failure.

                   The <u>ioctl</u>() function with the I_PLINK command shall fail if:

                   <b>ENXIO</b>  Hangup received on <u>fildes</u>.

                   <b>ETIME</b>  Timeout before acknowledgement message was received at STREAM head.

                   <b>EAGAIN</b> or <b>ENOSR</b>
                          Unable to allocate STREAMS storage to perform the I_PLINK.

                   <b>EBADF</b>  The <u>arg</u> argument is not a valid, open file descriptor.

                   <b>EINVAL</b> The  <u>fildes</u>  argument  does  not  support  multiplexing;  or <u>arg</u> is not a STREAM or is
                          already connected downstream from a multiplexer; or the  specified  I_PLINK  operation
                          would connect the STREAM head in more than one place in the multiplexed STREAM.

                   An  I_PLINK  can  also  fail  while  waiting  for  the multiplexing driver to acknowledge the
                   request, if a message indicating an error or a hangup is  received  at  the  STREAM  head  of
                   <u>fildes</u>.    In  addition,  an  error  code  can  be  returned  in  the  positive  or  negative
                   acknowledgement message. For these cases, I_PLINK shall fail with <u>errno</u> set to the  value  in
                   the message.

       I_PUNLINK   Disconnects  the  two  STREAMs  specified by <u>fildes</u> and <u>arg</u> from a persistent connection. The
                   <u>fildes</u> argument is the file descriptor of the STREAM connected to  the  multiplexing  driver.
                   The  <u>arg</u>  argument  is  the  multiplexer  ID  number that was returned by the I_PLINK <u>ioctl</u>()
                   command when a STREAM was connected downstream  from  the  multiplexing  driver.  If  <u>arg</u>  is
                   MUXID_ALL, then all STREAMs which are persistent connections to <u>fildes</u> shall be disconnected.
                   As in I_PLINK, this command requires the multiplexing driver to acknowledge the request.

                   The <u>ioctl</u>() function with the I_PUNLINK command shall fail if:

                   <b>ENXIO</b>  Hangup received on <u>fildes</u>.

                   <b>ETIME</b>  Timeout before acknowledgement message was received at STREAM head.

                   <b>EAGAIN</b> or <b>ENOSR</b>
                          Unable to allocate buffers for the acknowledgement message.

                   <b>EINVAL</b> Invalid multiplexer ID number.

                   An  I_PUNLINK  can  also  fail  while  waiting for the multiplexing driver to acknowledge the
                   request if a message indicating an error or a hangup  is  received  at  the  STREAM  head  of
                   <u>fildes</u>.    In  addition,  an  error  code  can  be  returned  in  the  positive  or  negative
                   acknowledgement message. For these cases, I_PUNLINK shall fail with <u>errno</u> set to the value in
                   the message.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       Upon successful completion, <u>ioctl</u>() shall return a value other than -1  that  depends  upon  the  STREAMS
       device control function. Otherwise, it shall return -1 and set <u>errno</u> to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       Under the following general conditions, <u>ioctl</u>() shall fail if:

       <b>EBADF</b>  The <u>fildes</u> argument is not a valid open file descriptor.

       <b>EINTR</b>  A signal was caught during the <u>ioctl</u>() operation.

       <b>EINVAL</b> The  STREAM or multiplexer referenced by <u>fildes</u> is linked (directly or indirectly) downstream from
              a multiplexer.

       If an underlying device driver detects an error, then <u>ioctl</u>() shall fail if:

       <b>EINVAL</b> The <u>request</u> or <u>arg</u> argument is not valid for this device.

       <b>EIO</b>    Some physical I/O error has occurred.

       <b>ENOTTY</b> The file associated with the <u>fildes</u>  argument  is  not  a  STREAMS  device  that  accepts  control
              functions.

       <b>ENXIO</b>  The  <u>request</u>  and <u>arg</u> arguments are valid for this device driver, but the service requested cannot
              be performed on this particular sub-device.

       <b>ENODEV</b> The <u>fildes</u> argument refers to a valid STREAMS device, but the corresponding device driver does not
              support the <u>ioctl</u>() function.

       If a STREAM is connected downstream from a multiplexer, any <u>ioctl</u>() command except I_UNLINK and I_PUNLINK
       shall set <u>errno</u> to <b>[EINVAL]</b>.

       <u>The</u> <u>following</u> <u>sections</u> <u>are</u> <u>informative.</u>

</pre><h4><b>EXAMPLES</b></h4><pre>
       None.

</pre><h4><b>APPLICATION</b> <b>USAGE</b></h4><pre>
       The implementation-defined timeout interval for STREAMS has historically been 15 seconds.

</pre><h4><b>RATIONALE</b></h4><pre>
       None.

</pre><h4><b>FUTURE</b> <b>DIRECTIONS</b></h4><pre>
       The <u>ioctl</u>() function may be removed in a future version.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>Section</u> <u>2.6</u>, <u>STREAMS</u>, <u>close</u>(), <u>fcntl</u>(), <u>getmsg</u>(), <u>open</u>(), <u>pipe</u>(), <u>poll</u>(), <u>putmsg</u>(), <u>read</u>(),  <u>sigaction</u>(),
       <u>write</u>()

       The Base Definitions volume of POSIX.1‐2017, <b>&lt;stropts.h&gt;</b>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1-2017, Standard
       for  Information  Technology  --  Portable  Operating  System  Interface  (POSIX),  The  Open  Group Base
       Specifications Issue 7, 2018 Edition, Copyright (C) 2018 by the Institute of Electrical  and  Electronics
       Engineers, Inc and The Open Group.  In the event of any discrepancy between this version and the original
       IEEE  and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document.
       The original Standard can be obtained online at <a href="http://www.opengroup.org/unix/online.html">http://www.opengroup.org/unix/online.html</a> .

       Any typographical or formatting errors that appear in this page are most likely to have  been  introduced
       during   the   conversion  of  the  source  files  to  man  page  format.  To  report  such  errors,  see
       https://www.kernel.org/doc/man-pages/reporting_bugs.html .

IEEE/The Open Group                                   2017                                         <u><a href="../man3POSIX/IOCTL.3POSIX.html">IOCTL</a></u>(3POSIX)
</pre>
 </div>
</div></section>
</div>
</body>
</html>