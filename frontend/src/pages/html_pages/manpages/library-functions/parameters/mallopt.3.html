<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mallopt - set memory allocation parameters</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mallopt - set memory allocation parameters

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/malloc.h">malloc.h</a>&gt;</b>

       <b>int</b> <b>mallopt(int</b> <u>param</u><b>,</b> <b>int</b> <u>value</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>mallopt</b>()  function  adjusts parameters that control the behavior of the memory-allocation functions
       (see <b><a href="../man3/malloc.3.html">malloc</a></b>(3)).  The <u>param</u> argument specifies the parameter to be modified, and <u>value</u> specifies the  new
       value for that parameter.

       The following values can be specified for <u>param</u>:

       <b>M_ARENA_MAX</b>
              If  this  parameter  has  a nonzero value, it defines a hard limit on the maximum number of arenas
              that can be created.  An arena represents a pool of memory that can  be  used  by  <b><a href="../man3/malloc.3.html">malloc</a></b>(3)  (and
              similar)  calls  to  service  allocation  requests.  Arenas are thread safe and therefore may have
              multiple concurrent memory requests.  The trade-off is between  the  number  of  threads  and  the
              number  of  arenas.  The more arenas you have, the lower the per-thread contention, but the higher
              the memory usage.

              The default value of this parameter is 0, meaning that the  limit  on  the  number  of  arenas  is
              determined according to the setting of <b>M_ARENA_TEST</b>.

              This  parameter  has  been  available since glibc 2.10 via <b>--enable-experimental-malloc</b>, and since
              glibc 2.15 by default.  In some versions of the allocator there was no  limit  on  the  number  of
              created arenas (e.g., CentOS 5, RHEL 5).

              When  employing  newer glibc versions, applications may in some cases exhibit high contention when
              accessing arenas.  In these cases, it may be beneficial  to  increase  <b>M_ARENA_MAX</b>  to  match  the
              number  of  threads.   This  is  similar  in behavior to strategies taken by tcmalloc and jemalloc
              (e.g., per-thread allocation pools).

       <b>M_ARENA_TEST</b>
              This parameter specifies a value,  in  number  of  arenas  created,  at  which  point  the  system
              configuration  will  be  examined to determine a hard limit on the number of created arenas.  (See
              <b>M_ARENA_MAX</b> for the definition of an arena.)

              The computation of the arena hard limit is implementation-defined and is usually calculated  as  a
              multiple  of  the  number of available CPUs.  Once the hard limit is computed, the result is final
              and constrains the total number of arenas.

              The default value for the <b>M_ARENA_TEST</b>  parameter  is  2  on  systems  where  <u>sizeof(long)</u>  is  4;
              otherwise the default value is 8.

              This  parameter  has  been  available since glibc 2.10 via <b>--enable-experimental-malloc</b>, and since
              glibc 2.15 by default.

              The value of <b>M_ARENA_TEST</b> is not used when <b>M_ARENA_MAX</b> has a nonzero value.

       <b>M_CHECK_ACTION</b>
              Setting this parameter controls how glibc responds when various kinds of  programming  errors  are
              detected  (e.g.,  freeing  the same pointer twice).  The 3 least significant bits (2, 1, and 0) of
              the value assigned to this parameter determine the glibc behavior, as follows:

              Bit 0  If this bit is set, then print a one-line message on <u>stderr</u> that provides details about the
                     error.  The message starts with  the  string  "*** glibc  detected ***",  followed  by  the
                     program name, the name of the memory-allocation function in which the error was detected, a
                     brief description of the error, and the memory address where the error was detected.

              Bit 1  If  this bit is set, then, after printing any error message specified by bit 0, the program
                     is terminated by calling <b><a href="../man3/abort.3.html">abort</a></b>(3).  Since glibc 2.4, if bit 0 is also  set,  then,  between
                     printing  the  error  message  and  aborting,  the program also prints a stack trace in the
                     manner  of  <b><a href="../man3/backtrace.3.html">backtrace</a></b>(3),  and  prints  the  process's  memory  mapping  in  the  style  of
                     <u><a href="file:/proc/">/proc/</a></u>pid<u>/maps</u> (see <b><a href="../man5/proc.5.html">proc</a></b>(5)).

              Bit 2 (since glibc 2.4)
                     This  bit  has  an effect only if bit 0 is also set.  If this bit is set, then the one-line
                     message describing the error is simplified to contain just the name of the  function  where
                     the error was detected and the brief description of the error.

              The remaining bits in <u>value</u> are ignored.

              Combining the above details, the following numeric values are meaningful for <b>M_CHECK_ACTION</b>:

                   <b>0</b>      Ignore error conditions; continue execution (with undefined results).

                   <b>1</b>      Print a detailed error message and continue execution.

                   <b>2</b>      Abort the program.

                   <b>3</b>      Print detailed error message, stack trace, and memory mappings, and abort the program.

                   <b>5</b>      Print a simple error message and continue execution.

                   <b>7</b>      Print simple error message, stack trace, and memory mappings, and abort the program.

              Since  glibc  2.3.4,  the default value for the <b>M_CHECK_ACTION</b> parameter is 3.  In glibc 2.3.3 and
              earlier, the default value is 1.

              Using a nonzero <b>M_CHECK_ACTION</b> value can be useful because  otherwise  a  crash  may  happen  much
              later, and the true cause of the problem is then very hard to track down.

       <b>M_MMAP_MAX</b>
              This  parameter  specifies  the  maximum  number of allocation requests that may be simultaneously
              serviced using <b><a href="../man2/mmap.2.html">mmap</a></b>(2).  This parameter exists because some  systems  have  a  limited  number  of
              internal tables for use by <b><a href="../man2/mmap.2.html">mmap</a></b>(2), and using more than a few of them may degrade performance.

              The  default value is 65,536, a value which has no special significance and which serves only as a
              safeguard.  Setting this parameter to 0 disables the use of <b><a href="../man2/mmap.2.html">mmap</a></b>(2) for servicing large allocation
              requests.

       <b>M_MMAP_THRESHOLD</b>
              For allocations greater than or equal to the limit specified (in bytes) by  <b>M_MMAP_THRESHOLD</b>  that
              can't  be  satisfied from the free list, the memory-allocation functions employ <b><a href="../man2/mmap.2.html">mmap</a></b>(2) instead of
              increasing the program break using <b><a href="../man2/sbrk.2.html">sbrk</a></b>(2).

              Allocating memory using <b><a href="../man2/mmap.2.html">mmap</a></b>(2) has the significant advantage that the allocated memory blocks can
              always be independently released back to the system.  (By contrast, the heap can be  trimmed  only
              if memory is freed at the top end.)  On the other hand, there are some disadvantages to the use of
              <b><a href="../man2/mmap.2.html">mmap</a></b>(2):  deallocated  space is not placed on the free list for reuse by later allocations; memory
              may be wasted because <b><a href="../man2/mmap.2.html">mmap</a></b>(2) allocations must be page-aligned; and the kernel  must  perform  the
              expensive  task  of  zeroing out memory allocated via <b><a href="../man2/mmap.2.html">mmap</a></b>(2).  Balancing these factors leads to a
              default setting of 128*1024 for the <b>M_MMAP_THRESHOLD</b> parameter.

              The lower limit for this parameter is 0.  The upper limit is <b>DEFAULT_MMAP_THRESHOLD_MAX</b>:  512*1024
              on 32-bit systems or <u>4*1024*1024*sizeof(long)</u> on 64-bit systems.

              <u>Note</u>:  Nowadays,  glibc  uses  a  dynamic  mmap  threshold  by  default.  The initial value of the
              threshold is 128*1024, but when blocks larger than the current threshold and less than or equal to
              <b>DEFAULT_MMAP_THRESHOLD_MAX</b> are freed, the threshold is adjusted upward to the size  of  the  freed
              block.   When  dynamic mmap thresholding is in effect, the threshold for trimming the heap is also
              dynamically adjusted to be twice the dynamic mmap  threshold.   Dynamic  adjustment  of  the  mmap
              threshold  is  disabled if any of the <b>M_TRIM_THRESHOLD</b>, <b>M_TOP_PAD</b>, <b>M_MMAP_THRESHOLD</b>, or <b>M_MMAP_MAX</b>
              parameters is set.

       <b>M_MXFAST</b> (since glibc 2.3)
              Set the upper limit for memory allocation requests that  are  satisfied  using  "fastbins".   (The
              measurement  unit  for this parameter is bytes.)  Fastbins are storage areas that hold deallocated
              blocks of memory of the same size without merging adjacent free blocks.   Subsequent  reallocation
              of  blocks  of  the same size can be handled very quickly by allocating from the fastbin, although
              memory fragmentation and the overall memory footprint of the program can increase.

              The default value for this parameter is <u>64*sizeof(size_t)/4</u> (i.e., 64  on  32-bit  architectures).
              The  range for this parameter is 0 to <u>80*sizeof(size_t)/4</u>.  Setting <b>M_MXFAST</b> to 0 disables the use
              of fastbins.

       <b>M_PERTURB</b> (since glibc 2.4)
              If this parameter is set  to  a  nonzero  value,  then  bytes  of  allocated  memory  (other  than
              allocations via <b><a href="../man3/calloc.3.html">calloc</a></b>(3)) are initialized to the complement of the value in the least significant
              byte of <u>value</u>, and when allocated memory is released using <b><a href="../man3/free.3.html">free</a></b>(3), the freed bytes are set to the
              least  significant  byte  of  <u>value</u>.   This  can  be  useful  for  detecting errors where programs
              incorrectly rely on allocated memory being initialized to zero, or reuse values in memory that has
              already been freed.

              The default value for this parameter is 0.

       <b>M_TOP_PAD</b>
              This parameter defines the amount of padding to employ when calling <b><a href="../man2/sbrk.2.html">sbrk</a></b>(2) to modify the  program
              break.   (The  measurement unit for this parameter is bytes.)  This parameter has an effect in the
              following circumstances:

              •  When the program break is increased, then <b>M_TOP_PAD</b> bytes are added to the <b><a href="../man2/sbrk.2.html">sbrk</a></b>(2) request.

              •  When the heap  is  trimmed  as  a  consequence  of  calling  <b><a href="../man3/free.3.html">free</a></b>(3)  (see  the  discussion  of
                 <b>M_TRIM_THRESHOLD</b>) this much free space is preserved at the top of the heap.

              In either case, the amount of padding is always rounded to a system page boundary.

              Modifying  <b>M_TOP_PAD</b>  is  a  trade-off  between  increasing  the  number of system calls (when the
              parameter is set low) and wasting unused memory at the top of the heap (when the parameter is  set
              high).

              The default value for this parameter is 128*1024.

       <b>M_TRIM_THRESHOLD</b>
              When the amount of contiguous free memory at the top of the heap grows sufficiently large, <b><a href="../man3/free.3.html">free</a></b>(3)
              employs  <b><a href="../man2/sbrk.2.html">sbrk</a></b>(2)  to release this memory back to the system.  (This can be useful in programs that
              continue to execute for a long  period  after  freeing  a  significant  amount  of  memory.)   The
              <b>M_TRIM_THRESHOLD</b>  parameter  specifies  the minimum size (in bytes) that this block of memory must
              reach before <b><a href="../man2/sbrk.2.html">sbrk</a></b>(2) is used to trim the heap.

              The default value for this  parameter  is  128*1024.   Setting  <b>M_TRIM_THRESHOLD</b>  to  -1  disables
              trimming completely.

              Modifying  <b>M_TRIM_THRESHOLD</b> is a trade-off between increasing the number of system calls (when the
              parameter is set low) and wasting unused memory at the top of the heap (when the parameter is  set
              high).

   <b>Environment</b> <b>variables</b>
       A  number of environment variables can be defined to modify some of the same parameters as are controlled
       by <b>mallopt</b>().  Using these variables has the advantage that the source code of the program  need  not  be
       changed.   To  be effective, these variables must be defined before the first call to a memory-allocation
       function.  (If the same  parameters  are  adjusted  via  <b>mallopt</b>(),  then  the  <b>mallopt</b>()  settings  take
       precedence.)  For security reasons, these variables are ignored in set-user-ID and set-group-ID programs.

       The  environment  variables  are  as follows (note the trailing underscore at the end of the name of some
       variables):

       <b>MALLOC_ARENA_MAX</b>
              Controls the same parameter as <b>mallopt</b>() <b>M_ARENA_MAX</b>.

       <b>MALLOC_ARENA_TEST</b>
              Controls the same parameter as <b>mallopt</b>() <b>M_ARENA_TEST</b>.

       <b>MALLOC_CHECK_</b>
              This environment variable controls the  same  parameter  as  <b>mallopt</b>()  <b>M_CHECK_ACTION</b>.   If  this
              variable  is  set  to  a  nonzero  value,  then  a special implementation of the memory-allocation
              functions is used.  (This is accomplished using the <b><a href="../man3/malloc_hook.3.html">malloc_hook</a></b>(3) feature.)  This  implementation
              performs  additional  error  checking,  but  is  slower than the standard set of memory-allocation
              functions.  (This implementation does not detect all  possible  errors;  memory  leaks  can  still
              occur.)

              The  value  assigned  to  this  environment variable should be a single digit, whose meaning is as
              described for <b>M_CHECK_ACTION</b>.  Any characters beyond the initial digit are ignored.

              For security reasons, the effect of <b>MALLOC_CHECK_</b> is disabled by default for set-user-ID and  set-
              group-ID  programs.   However,  if  the  file  <u>/etc/suid-debug</u>  exists (the content of the file is
              irrelevant), then <b>MALLOC_CHECK_</b> also has an effect for set-user-ID and set-group-ID programs.

       <b>MALLOC_MMAP_MAX_</b>
              Controls the same parameter as <b>mallopt</b>() <b>M_MMAP_MAX</b>.

       <b>MALLOC_MMAP_THRESHOLD_</b>
              Controls the same parameter as <b>mallopt</b>() <b>M_MMAP_THRESHOLD</b>.

       <b>MALLOC_PERTURB_</b>
              Controls the same parameter as <b>mallopt</b>() <b>M_PERTURB</b>.

       <b>MALLOC_TRIM_THRESHOLD_</b>
              Controls the same parameter as <b>mallopt</b>() <b>M_TRIM_THRESHOLD</b>.

       <b>MALLOC_TOP_PAD_</b>
              Controls the same parameter as <b>mallopt</b>() <b>M_TOP_PAD</b>.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>mallopt</b>() returns 1.  On error, it returns 0.

</pre><h4><b>ERRORS</b></h4><pre>
       On error, <u>errno</u> is <u>not</u> set.

</pre><h4><b>VERSIONS</b></h4><pre>
       A similar function exists on many System V derivatives, but the range of values for <u>param</u>  varies  across
       systems.   The  SVID defined options <b>M_MXFAST</b>, <b>M_NLBLKS</b>, <b>M_GRAIN</b>, and <b>M_KEEP</b>, but only the first of these
       is implemented in glibc.

</pre><h4><b>STANDARDS</b></h4><pre>
       None.

</pre><h4><b>HISTORY</b></h4><pre>
       glibc 2.0.

</pre><h4><b>BUGS</b></h4><pre>
       Specifying an invalid value for <u>param</u> does not generate an error.

       A calculation error within the glibc implementation means that a call of the form:

           mallopt(M_MXFAST, n)

       does not result in fastbins being employed for all allocations of  size  up  to  <u>n</u>.   To  ensure  desired
       results,  <u>n</u>  should  be  rounded  up to the next multiple greater than or equal to <u>(2k+1)*sizeof(size_t)</u>,
       where <u>k</u> is an integer.

       If <b>mallopt</b>() is used to set <b>M_PERTURB</b>, then, as expected, the bytes of allocated memory  are  initialized
       to  the  complement  of  the  byte  in  <u>value</u>, and when that memory is freed, the bytes of the region are
       initialized to the byte specified in <u>value</u>.  However, there is  an  off-by-<u>sizeof(size_t)</u>  error  in  the
       implementation:  instead  of  initializing precisely the block of memory being freed by the call <u>free(p)</u>,
       the block starting at <u>p+sizeof(size_t)</u> is initialized.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The program below demonstrates the use of <b>M_CHECK_ACTION</b>.  If the program is supplied with  an  (integer)
       command-line  argument, then that argument is used to set the <b>M_CHECK_ACTION</b> parameter.  The program then
       allocates a block of memory, and frees it twice (an error).

       The following shell session shows what happens when we run this program under  glibc,  with  the  default
       value for <b>M_CHECK_ACTION</b>:

           $ <b>./a.out</b>
           main(): returned from first free() call
           *** glibc detected *** ./a.out: double free or corruption (top): 0x09d30008 ***
           ======= Backtrace: =========
           /lib/libc.so.6(+0x6c501)[0x523501]
           /lib/libc.so.6(+0x6dd70)[0x524d70]
           /lib/libc.so.6(cfree+0x6d)[0x527e5d]
           ./a.out[0x80485db]
           /lib/libc.so.6(__libc_start_main+0xe7)[0x4cdce7]
           ./a.out[0x8048471]
           ======= Memory map: ========
           001e4000-001fe000 r-xp 00000000 08:06 1083555    /lib/libgcc_s.so.1
           001fe000-001ff000 r--p 00019000 08:06 1083555    /lib/libgcc_s.so.1
           [some lines omitted]
           b7814000-b7817000 rw-p 00000000 00:00 0
           bff53000-bff74000 rw-p 00000000 00:00 0          [stack]
           Aborted (core dumped)

       The following runs show the results when employing other values for <b>M_CHECK_ACTION</b>:

           $ <b>./a.out</b> <b>1</b>             # Diagnose error and continue
           main(): returned from first free() call
           *** glibc detected *** ./a.out: double free or corruption (top): 0x09cbe008 ***
           main(): returned from second free() call
           $ <b>./a.out</b> <b>2</b>             # Abort without error message
           main(): returned from first free() call
           Aborted (core dumped)
           $ <b>./a.out</b> <b>0</b>             # Ignore error and continue
           main(): returned from first free() call
           main(): returned from second free() call

       The next run shows how to set the same parameter using the <b>MALLOC_CHECK_</b> environment variable:

           $ <b>MALLOC_CHECK_=1</b> <b>./a.out</b>
           main(): returned from first free() call
           *** glibc detected *** ./a.out: free(): invalid pointer: 0x092c2008 ***
           main(): returned from second free() call

   <b>Program</b> <b>source</b>

       #include &lt;<a href="file:/usr/include/malloc.h">malloc.h</a>&gt;
       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
       #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;

       int
       main(int argc, char *argv[])
       {
           char *p;

           if (argc &gt; 1) {
               if (mallopt(M_CHECK_ACTION, atoi(argv[1])) != 1) {
                   fprintf(stderr, "mallopt() failed");
                   exit(EXIT_FAILURE);
               }
           }

           p = <a href="../man1000/malloc.1000.html">malloc</a>(1000);
           if (p == NULL) {
               fprintf(stderr, "malloc() failed");
               exit(EXIT_FAILURE);
           }

           free(p);
           printf("%s(): returned from first free() call\n", __func__);

           free(p);
           printf("%s(): returned from second free() call\n", __func__);

           exit(EXIT_SUCCESS);
       }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/mmap.2.html">mmap</a></b>(2), <b><a href="../man2/sbrk.2.html">sbrk</a></b>(2), <b><a href="../man3/mallinfo.3.html">mallinfo</a></b>(3), <b><a href="../man3/malloc.3.html">malloc</a></b>(3), <b><a href="../man3/malloc_hook.3.html">malloc_hook</a></b>(3), <b><a href="../man3/malloc_info.3.html">malloc_info</a></b>(3), <b><a href="../man3/malloc_stats.3.html">malloc_stats</a></b>(3),
       <b><a href="../man3/malloc_trim.3.html">malloc_trim</a></b>(3), <b><a href="../man3/mcheck.3.html">mcheck</a></b>(3), <b><a href="../man3/mtrace.3.html">mtrace</a></b>(3), <b><a href="../man3/posix_memalign.3.html">posix_memalign</a></b>(3)

Linux man-pages 6.9.1                              2024-06-15                                         <u><a href="../man3/mallopt.3.html">mallopt</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>