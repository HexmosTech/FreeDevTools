<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cookiejar - Implementation of the Tcl http package cookie jar protocol</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/tcl9.0-doc">tcl9.0-doc_9.0.1+dfsg-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       cookiejar - Implementation of the Tcl http package cookie jar protocol

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>package</b> <b>require</b> <b>cookiejar</b> ?<b>0.1</b>?

       <b>::http::cookiejar</b> <b>configure</b> ?<u>optionName</u>? ?<u>optionValue</u>?
       <b>::http::cookiejar</b> <b>create</b> <u>name</u> ?<u>filename</u>?
       <b>::http::cookiejar</b> <b>new</b> ?<u>filename</u>?

       <u>cookiejar</u> <b>destroy</b>
       <u>cookiejar</u> <b>forceLoadDomainData</b>
       <u>cookiejar</u> <b>getCookies</b> <u>protocol</u> <u>host</u> <u>path</u>
       <u>cookiejar</u> <b>storeCookie</b> <u>options</u>
       <u>cookiejar</u> <b>lookup</b> ?<u>host</u>? ?<u>key</u>?

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  cookiejar  package  provides  an  implementation  of the http package's cookie jar protocol using an
       SQLite database. It provides one main command, <b>::http::cookiejar</b>, which is a TclOO class that  should  be
       instantiated to create a cookie jar that manages a particular HTTP session.

       The  database  management  policy  can  be controlled at the package level by the <b>configure</b> method on the
       <b>::http::cookiejar</b> class object:

       <b>::http::cookiejar</b> <b>configure</b> ?<u>optionName</u>? ?<u>optionValue</u>?
              If neither <u>optionName</u> nor <u>optionValue</u> are supplied, this returns a copy of the configuration as  a
              Tcl dictionary. If just <u>optionName</u> is supplied, just the value of the named option is returned. If
              both <u>optionName</u> and <u>optionValue</u> are given, the named option is changed to be the given value.

              Supported options are:

              <b>-domainfile</b> <u>filename</u>
                     A  file (defaulting to within the cookiejar package) with a description of the list of top-
                     level domains (e.g., <b>.com</b> or <b>.co.jp</b>). Such domains <u>must</u> <u>not</u> accept cookies set  upon  them.
                     Note  that  the list of such domains is both security-sensitive and <u>not</u> constant and should
                     be periodically refetched. Cookie jars maintain their own cache of the domain list.

              <b>-domainlist</b> <u>url</u>
                     A URL to fetch the list of top-level domains (e.g., <b>.com</b> or  <b>.co.jp</b>)  from.   Such  domains
                     <u>must</u> <u>not</u> accept cookies set upon them. Note that the list of such domains is both security-
                     sensitive and <u>not</u> constant and should be periodically refetched. Cookie jars maintain their
                     own cache of the domain list.

              <b>-domainrefresh</b> <u>intervalMilliseconds</u>
                     The number of milliseconds between checks of the <b>-domainlist</b> for new domains.

              <b>-loglevel</b> <u>level</u>
                     The  logging  level  of  this  package.  The  logging level must be (in order of decreasing
                     verbosity) one of <b>debug</b>, <b>info</b>, <b>warn</b>, or <b>error</b>.

              <b>-offline</b> <u>flag</u>
                     Allows the cookie management engine to be placed into offline mode. In  offline  mode,  the
                     list of domains is read immediately from the file configured in the <b>-domainfile</b> option, and
                     the  <b>-domainlist</b> option is not used; it also makes the <b>-domainrefresh</b> option be effectively
                     ignored.

              <b>-purgeold</b> <u>intervalMilliseconds</u>
                     The number of milliseconds between checks of the  database  for  expired  cookies;  expired
                     cookies are deleted.

              <b>-retain</b> <u>cookieCount</u>
                     The maximum number of cookies to retain in the database.

              <b>-vacuumtrigger</b> <u>deletionCount</u>
                     A count of the number of persistent cookie deletions to go between vacuuming the database.

       Cookie  jar  instances  may  be  made with any of the standard TclOO instance creation methods (<b>create</b> or
       <b>new</b>).

       <b>::http::cookiejar</b> <b>new</b> ?<u>filename</u>?
              If a <u>filename</u> argument is provided, it is the name of a file containing an  SQLite  database  that
              will  contain the persistent cookies maintained by the cookie jar; the database will be created if
              the file does not already exist.  If <u>filename</u> is not supplied, the database will be held  entirely
              within memory, which effectively forces all cookies within it to be session cookies.

   <b>INSTANCE</b> <b>METHODS</b>
       The following methods are supported on the instances:

       <u>cookiejar</u> <b>destroy</b>
              This  is  the  standard  TclOO destruction method. It does <u>not</u> delete the SQLite database if it is
              written to disk. Callers are responsible for ensuring that the cookie jar is not  in  use  by  the
              http package at the time of destruction.

       <u>cookiejar</u> <b>forceLoadDomainData</b>
              This method causes the cookie jar to immediately load (and cache) the domain list data. The domain
              list  will  be  loaded from the <b>-domainlist</b> configured a the package level if that is enabled, and
              otherwise will be obtained from the <b>-domainfile</b> configured at the package level.

       <u>cookiejar</u> <b>getCookies</b> <u>protocol</u> <u>host</u> <u>path</u>
              This method obtains the cookies for a particular HTTP request. <u>This</u> <u>implements</u> <u>the</u> <u>http</u> <u>cookie</u> <u>jar</u>
              <u>protocol.</u>

       <u>cookiejar</u> <b>policyAllow</b> <u>operation</u> <u>domain</u> <u>path</u>
              This method is called by the <b>storeCookie</b> method to get a decision on whether to allow <u>operation</u> to
              be performed for the <u>domain</u> and <u>path</u>. This is checked immediately before the database  is  updated
              but  after  the built-in security checks are done, and should return a boolean value; if the value
              is false, the operation is rejected and the database is not  modified.  The  supported  <u>operation</u>s
              are:

              <b>delete</b> The <u>domain</u> is seeking to delete a cookie.

              <b>session</b>
                     The <u>domain</u> is seeking to create or update a session cookie.

              <b>set</b>    The <u>domain</u> is seeking to create or update a persistent cookie (with a defined lifetime).

              The  default  implementation  of  this  method just returns true, but subclasses of this class may
              impose their own rules.

       <u>cookiejar</u> <b>storeCookie</b> <u>options</u>
              This method stores a single cookie from a particular HTTP response.  Cookies  that  fail  security
              checks are ignored. <u>This</u> <u>implements</u> <u>the</u> <u>http</u> <u>cookie</u> <u>jar</u> <u>protocol.</u>

       <u>cookiejar</u> <b>lookup</b> ?<u>host</u>? ?<u>key</u>?
              This  method  looks  a  cookie  by  exact  host  (or domain) matching. If neither <u>host</u> nor <u>key</u> are
              supplied, the list of hosts for which a cookie is stored is returned. If just <u>host</u> (which may be a
              hostname or a domain name) is supplied, the list of cookie keys stored for that host is  returned.
              If  both  <u>host</u> and <u>key</u> are supplied, the value for that key is returned; it is an error if no such
              host or key match exactly.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The simplest way of using a cookie jar  is  to  just  permanently  configure  it  at  the  start  of  the
       application.

              package require http
              <b>package</b> <b>require</b> <b>cookiejar</b>

              set cookiedb [file join [file home] cookiejar]
              http::config -cookiejar [<b>http::cookiejar</b> <b>new</b> $cookiedb]

              # No further explicit steps are required to use cookies
              set tok [http::geturl <a href="http://core.tcl-lang.org/">http://core.tcl-lang.org/</a>]

       To  only  allow  a particular domain to use cookies, perhaps because you only want to enable a particular
       host to create and manipulate sessions, create a subclass that imposes that policy.

              package require http
              <b>package</b> <b>require</b> <b>cookiejar</b>

              oo::class create MyCookieJar {
                  superclass <b>http::cookiejar</b>

                  method <b>policyAllow</b> {operation domain path} {
                      return [expr {$domain eq "my.example.com"}]
                  }
              }

              set cookiedb [file join [file home] cookiejar]
              http::configure -cookiejar [MyCookieJar new $cookiedb]

              # No further explicit steps are required to use cookies
              set tok [http::geturl <a href="http://core.tcl-lang.org/">http://core.tcl-lang.org/</a>]

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man3tcl/http.3tcl.html">http</a>(3tcl), oo::<a href="../man3tcl/class.3tcl.html">class</a>(3tcl), <a href="../man3tcl/sqlite3.3tcl.html">sqlite3</a>(3tcl)

</pre><h4><b>KEYWORDS</b></h4><pre>
       cookie, internet, security policy, www

http                                                   0.1                                       <u><a href="../man3tcl/cookiejar.3tcl.html">cookiejar</a></u>(3tcl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>