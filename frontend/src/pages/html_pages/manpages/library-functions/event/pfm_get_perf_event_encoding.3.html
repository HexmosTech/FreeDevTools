<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pfm_get_perf_event_encoding - encode event for perf_event API</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libpfm4-dev">libpfm4-dev_4.13.0+git99-gc5587f9-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pfm_get_perf_event_encoding - encode event for perf_event API

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;perfmon/pfmlib_perf_event.h&gt;</b>

       <b>int</b> <b>pfm_get_perf_event_encoding(const</b> <b>char</b> <b>*</b><u>str</u><b>,</b> <b>int</b> <u>dfl_plm</u><b>,</b> <b>struct</b> <b>perf_event_attr</b> <b>*</b><u>attr</u><b>,</b> <b>char</b> <b>**</b><u>fstr</u><b>,</b> <b>int</b> <b>*</b><u>idx</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  function  can be used in conjunction with the perf_events Linux kernel API which provides access to
       hardware performance counters, kernel software counters and tracepoints.  The  function  takes  an  event
       string  in  <b>str</b>  and  a  default  privilege level mask in <b>dfl_plm</b> and fills out the relevant parts of the
       perf_events specific data structure in <b>attr</b>.

       This function is <b>deprecated</b>. It is superseded by <b>pfm_get_os_event_encoding()</b> with the OS argument set  to
       either  <b>PFM_OS_PERF_EVENT</b>  or  <b>PFM_OS_PERF_EVENT_EXT</b>.   Using this function provides extended support for
       perf_events. Certain perf_event configuration option are only available through this new interface.

       The following examples illustrates the transition:

          struct perf_event_attr attr;
          int i, count = 0;
          uint64_t *codes;

          memset(&amp;attr, 0, sizeof(attr));

          ret = pfm_get_perf_event_encoding("RETIRED_INSTRUCTIONS", PFM_PLM3, &amp;attrs, NULL, NULL);
          if (ret != PFM_SUCCESS)
             err(1, "cannot get encoding %s", pfm_strerror(ret));

       is equivalent to:

          #include &lt;perfmon/pfmlib_perf_event.h&gt;
          struct perf_event_attr attr;
          pfm_perf_encode_arg_t arg;

          memset(&amp;arg, 0, sizeof(arg));
          arg.size = sizeof(arg);
          arg.attr = &amp;attr;

          ret = pfm_get_os_event_encoding("RETIRED_INSTRUCTIONS", PFM_PLM3, PFM_OS_PERF, &amp;arg);
          if (ret != PFM_SUCCESS)
             err(1, "cannot get encoding %s", pfm_strerror(ret));

       The <b>dfl_plm</b> cannot be zero, though it may not necessarily be used by the event.
       Depending on the event, combination of the following privilege levels may be used:

       <b>PFM_PLM3</b>
              Measure at privilege level 3. This usually corresponds to user level. On X86, it corresponds
              to privilege levels 3, 2, 1. Check the PMU specific man page to verify if this level
              is supported by your PMU model.

       <b>PFM_PLM2</b>
              Measure at privilege level 2. Check the PMU specific man page to verify if this level
              is supported by your PMU model.

       <b>PFM_PLM1</b>
              Measure at privilege level 1. Check the PMU specific man page to verify if this level
              is supported by your PMU model.

       <b>PFM_PLM0</b>
              Measure at privilege level 0. This usually corresponds to kernel level. Check the PMU
              specific man page to verify if this level is supported by your PMU model.

       <b>PFM_PLMH</b>
              Measure at hypervisor privilege level. This is used in conjunction with hardware virtualization.
              Check the PMU specific man page to verify if this level is supported by your PMU model.

       If <b>fstr</b> is not NULL, the function will make it point to the fully qualified event string,
       i.e., a string with the event name, all unit masks set, and the value of all modifiers.
       The library will allocate memory to store the event string but it is the responsibility of the
       caller to eventually free that string using free().

       If <b>idx</b> is not NULL, it returns the corresponding unique event identifier.

       Only select fields are modified by the function, the others are untouched.
       The following fields in <b>attr</b> are modified:

       <b>type</b>   The type of the event

       <b>config</b> The encoding of the event

       <b>exclude_user</b>
              Whether or not user level execution should be excluded from monitoring. The definition
              of user is PMU model specific.

       <b>exclude_kernel</b>
              Whether or not kernel level execution should be excluded from monitoring. The definition
              of kernel is PMU model specific.

       <b>exclude_hv</b>
              Whether or not hypervisor level execution should be excluded from monitoring. The definition
              of hypervisor is PMU model specific.

       By default, if no privilege level modifier is specified in the event string, the library clears
       <b>exclude_user</b>, <b>exclude_kernel</b> and <b>exclude_hv</b>, resulting in the event being
       measured at all levels subject to hardware support.

       The function is able to work on only one event at a time. For convenience, it accepts
       event strings with commas. In that case, it will translate the first event up to the
       first comma. This is handy in case tools gets passed events as a comma-separated list.

</pre><h4><b>RETURN</b></h4><pre>
       The function returns in <b>attr</b> the perf_event encoding which corresponds to the event string. If <b>idx</b> is not
       NULL, then it will contain the unique event identifier upon successful return. The value  <b>PFM_SUCCESS</b>  is
       returned if successful, otherwise a negative error code is returned.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>PFM_ERR_TOOSMALL</b>
              The <b>code</b> argument is too small for the encoding.

       <b>PFM_ERR_INVAL</b>
              The <b>attr</b> argument is <b>NULL</b>.

       <b>PFM_ERR_NOMEM</b>
              Not enough memory.

       <b>PFM_ERR_NOTFOUND</b>
              Event not found.

       <b>PFM_ERR_ATTR</b>
              Invalid event attribute (unit mask or modifier)

       <b>PFM_ERR_ATTR_VAL</b>
              Invalid modifier value.

       <b>PFM_ERR_ATTR_SET</b>
              attribute already set, cannot be changed.

       <b>PFM_ERR_ATTR_UMASK</b>
              Missing unit mask.

       <b>PFM_ERR_ATTR_FEATCOMB</b>
              Unit masks or features cannot be combined into a single event.

</pre><h4><b>AUTHOR</b></h4><pre>
       Stephane Eranian &lt;<a href="mailto:eranian@gmail.com">eranian@gmail.com</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man3/pfm_get_os_event_encoding.3.html">pfm_get_os_event_encoding</a>(3)

                                                 September, 2009                                       <u><a href="../man3/LIBPFM.3.html">LIBPFM</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>