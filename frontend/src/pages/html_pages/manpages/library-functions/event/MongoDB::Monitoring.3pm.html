<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB::Monitoring - Internal event monitoring API for instrumentation</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmongodb-perl">libmongodb-perl_2.2.2-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       MongoDB::Monitoring - Internal event monitoring API for instrumentation

</pre><h4><b>VERSION</b></h4><pre>
       version v2.2.2

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The MongoDB::MongoClient takes an optional "monitoring_callback" attribute, which can be used to monitor
       events that occur during the operation of the driver.

       The API is very simple: given a code reference, a hashref for each event is passed to the code reference.
       Here is a simple example that just accumulates events in an array:

           our @events;
           my $cb = sub { push @events, $_[0] };

           MongoDB-&gt;connect( $uri, { monitoring_callback =&gt; $cb } );

</pre><h4><b>EVENT</b> <b>TYPES</b></h4><pre>
       Every event is a hash reference, with a "type" field indicating the type, e.g. "command_started".  Each
       type is described below.

   <b>Command</b> <b>Monitoring</b>
       These events are fired for commands directly to the wire and the response.

       <u>command_started</u>

       This event is sent just before a command is put one the wire.  It will be followed by either a
       "command_succeeded" or "command_failed" event.

       Fields:

       •   type: "command_started"

       •   databaseName: the name of the database to which the command applies

       •   commandName:  the  name of the command being executed; for legacy operations that don't use commands,
           the driver will convert them to appear as if they are in command form.

       •   command: a hash reference representing the full command to be sent

       •   requestId: the request identifier sent to the server

       •   connectionId: address and port of the destination server

       <u>command_succeeded</u>

       This event is sent just after a command reply is received,  but  only  if  the  database  reply  document
       contains a non-false "ok" field.  NOTE: write errors will have "ok:1" even though they have write errors;
       for writes, success indicates that the write attempt was valid, not that the write succeeded.

       Fields:

       •   type: "command_succeeded"

       •   commandName: the name of the command being executed

       •   durationSecs: the elapsed time in seconds since the "command_started" event.

       •   reply: a hash reference representing the full database reply

       •   requestId: the request identifier sent to the server

       •   connectionId: address and port of the destination server

       <u>command_failed</u>

       This  event  is  sent  just  after  a  command reply is received, but only if the database reply document
       contains a false "ok" field or if an exception occurred during send or receive operations.

       Fields:

       •   type: "command_failed"

       •   commandName: the name of the command being executed

       •   durationSecs: the elapsed time in seconds since the "command_started" event.

       •   failure: a string with a error message about the failure

       •   eval_error: if an exception occurs, this contains the value of $@ when the exception was caught

       •   reply: a hash reference representing the full database reply or an empty hashref if  the  failure  is
           due to an exception

       •   requestId: the request identifier sent to the server

       •   connectionId: address and port of the destination server

   <b>Server</b> <b>Discovery</b> <b>and</b> <b>Monitoring</b>
       These events are fired when servers and topology are amended.

       <u>server_opening_event</u>

       This event is sent when a new server is added to the topology.

       Fields:

       •   type: "server_opening_event"

       •   topologyId: The topology refaddr

       •   address: address of the server

       <u>server_closed_event</u>

       This event is sent when a server is removed from the topology.

       Fields:

       •   type: "server_closed_event"

       •   topologyId: The topology refaddr

       •   address: address of the server

       <u>server_description_changed_event</u>

       This event is sent when the server description changes, but does not include changes to the RTT.

       Fields:

       •   type: "server_description_changed_event"

       •   address: address of the server

       •   topologyId: The topology refaddr

       •   previousDescription: Server Description before the change

       •   newDescription: Server Description after the change

       <u>topology_opening_event</u>

       This event is sent when the topology is created.

       Fields:

       •   type: "topology_opening_event"

       •   topologyId: The topology refaddr

       <u>topology_closed_event</u>

       This event is sent when the topology is closed.

       Fields:

       •   type: "topology_closed_event"

       •   topologyId: The topology refaddr

       <u>topology_description_changed_event</u>

       This event is sent when the topology description changes.

       Fields:

       •   type: "topology_description_changed_event"

       •   topologyId: The topology refaddr

       •   previousDescription: Topology Description before the change

       •   newDescription: Topology Description after the change

       <u>server_heartbeat_started_event</u>

       This event is sent before the ismaster command is sent to the server.

       Fields:

       •   type: "server_heartbeat_started_event"

       •   connectionId: address of the link to connect to

       <u>server_heartbeat_succeeded_event</u>

       This event is sent after the reply from the ismaster command arrives from a successful reply.

       Fields:

       •   type: "server_heartbeat_succeeded_event"

       •   duration: time it took to send and receive a reply

       •   reply: the ismaster command reply

       •   connectionId: address of the server

       <u>server_heartbeat_failed_event</u>

       This event is sent if there is a failure from the ismaster command, which returns an error string of some
       sort.

       Fields:

       •   type: "server_heartbeat_failed_event"

       •   duration: time it took to send and receive a reply

       •   failure: Returns an error string of the failure

       •   connectionId: address of the server

</pre><h4><b>REDACTION</b></h4><pre>
       Certain  commands  are  considered sensitive.  When any of the following commands are seen in monitoring,
       the command body and database reply body are replaced with an empty document:

       •   authenticate

       •   saslStart

       •   saslContinue

       •   getnonce

       •   createUser

       •   updateUser

       •   copydbgetnonce

       •   copydbsaslstart

</pre><h4><b>AUTHORS</b></h4><pre>
       •   David Golden &lt;<a href="mailto:david@mongodb.com">david@mongodb.com</a>&gt;

       •   Rassi &lt;<a href="mailto:rassi@mongodb.com">rassi@mongodb.com</a>&gt;

       •   Mike Friedman &lt;<a href="mailto:friedo@friedo.com">friedo@friedo.com</a>&gt;

       •   Kristina Chodorow &lt;<a href="mailto:k.chodorow@gmail.com">k.chodorow@gmail.com</a>&gt;

       •   Florian Ragwitz &lt;<a href="mailto:rafl@debian.org">rafl@debian.org</a>&gt;

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       This software is Copyright (c) 2020 by MongoDB, Inc.

       This is free software, licensed under:

         The Apache License, Version 2.0, January 2004

perl v5.40.1                                       2025-04-03                           <u>MongoDB::<a href="../man3pm/Monitoring.3pm.html">Monitoring</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>