<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sd_event_add_io, sd_event_source_get_io_events, sd_event_source_set_io_events,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libsystemd-dev">libsystemd-dev_257.7-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sd_event_add_io, sd_event_source_get_io_events, sd_event_source_set_io_events,
       sd_event_source_get_io_revents, sd_event_source_get_io_fd, sd_event_source_set_io_fd,
       sd_event_source_get_io_fd_own, sd_event_source_set_io_fd_own, sd_event_source, sd_event_io_handler_t -
       Add an I/O event source to an event loop

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;systemd/sd-event.h&gt;</b>

       <b>typedef</b> <b>struct</b> <b>sd_event_source</b> <b>sd_event_source;</b>

       <b>typedef</b> <b>int</b> <b>(*sd_event_io_handler_t)(sd_event_source</b> <b>*</b><u>s</u><b>,</b> <b>int</b> <u>fd</u><b>,</b> <b>uint32_t</b> <u>revents</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>);</b>

       <b>int</b> <b>sd_event_add_io(sd_event</b> <b>*</b><u>event</u><b>,</b> <b>sd_event_source</b> <b>**</b><u>source</u><b>,</b> <b>int</b> <u>fd</u><b>,</b> <b>uint32_t</b> <u>events</u><b>,</b>
                           <b>sd_event_io_handler_t</b> <u>handler</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>);</b>

       <b>int</b> <b>sd_event_source_get_io_events(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>uint32_t</b> <b>*</b><u>ret</u><b>);</b>

       <b>int</b> <b>sd_event_source_set_io_events(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>uint32_t</b> <u>events</u><b>);</b>

       <b>int</b> <b>sd_event_source_get_io_revents(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>uint32_t</b> <b>*</b><u>ret</u><b>);</b>

       <b>int</b> <b>sd_event_source_get_io_fd(sd_event_source</b> <b>*</b><u>source</u><b>);</b>

       <b>int</b> <b>sd_event_source_set_io_fd(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>int</b> <u>fd</u><b>);</b>

       <b>int</b> <b>sd_event_source_get_io_fd_own(sd_event_source</b> <b>*</b><u>source</u><b>);</b>

       <b>int</b> <b>sd_event_source_set_io_fd_own(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>int</b> <u>b</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>sd_event_add_io()</b> adds a new I/O event source to an event loop. The event loop object is specified in the
       <u>event</u> parameter, the event source object is returned in the <u>source</u> parameter. The <u>fd</u> parameter takes the
       UNIX file descriptor to watch, which may refer to a socket, a FIFO, a message queue, a serial connection,
       a character device, or any other file descriptor compatible with Linux <b><a href="../man7/epoll.7.html">epoll</a></b>(7). The <u>events</u> parameter
       takes a bit mask of events to watch for, a combination of the following event flags: <b>EPOLLIN</b>, <b>EPOLLOUT</b>,
       <b>EPOLLRDHUP</b>, <b>EPOLLPRI</b>, and <b>EPOLLET</b>, see <b><a href="../man2/epoll_ctl.2.html">epoll_ctl</a></b>(2) for details. Note that not all file descriptors are
       compatible with epoll, for example regular file or directories are not. If this function is called with a
       file descriptor that does not support epoll, <b>-EPERM</b> is returned (also see below). In most cases such file
       descriptors may be treated as always-readable or always-writable, so that IO event watching is
       unnecessary.

       The <u>handler</u> is a function to call when the event source is triggered or <b>NULL</b>. The <u>userdata</u> pointer will
       be passed to the handler function, and may be chosen freely by the caller. The handler will also be
       passed the file descriptor the event was seen on, as well as the actual event flags. It's generally a
       subset of the events watched, however may additionally include <b>EPOLLERR</b> and <b>EPOLLHUP</b>. The handler may
       return negative to signal an error (see below), other return values are ignored. If <u>handler</u> is <b>NULL</b>, a
       default handler that calls <b><a href="../man3/sd_event_exit.3.html">sd_event_exit</a></b>(3) will be used.

       By default, an event source will stay enabled continuously (<b>SD_EVENT_ON</b>), but this may be changed with
       <b><a href="../man3/sd_event_source_set_enabled.3.html">sd_event_source_set_enabled</a></b>(3). If the handler function returns a negative error code, it will either be
       disabled after the invocation, even if the <b>SD_EVENT_ON</b> mode was requested before, or it will cause the
       loop to terminate, see <b><a href="../man3/sd_event_source_set_exit_on_failure.3.html">sd_event_source_set_exit_on_failure</a></b>(3). Note that an event source set to
       <b>SD_EVENT_ON</b> will fire continuously unless data is read from or written to the file descriptor to reset
       the mask of events seen.

       Setting the I/O event mask to watch for to 0 does not mean that the event source will not be triggered
       anymore, as <b>EPOLLHUP</b> and <b>EPOLLERR</b> may be triggered even with a zero event mask. To temporarily disable an
       I/O event source use <b><a href="../man3/sd_event_source_set_enabled.3.html">sd_event_source_set_enabled</a></b>(3) with <b>SD_EVENT_OFF</b> instead.

       To destroy an event source object use <b><a href="../man3/sd_event_source_unref.3.html">sd_event_source_unref</a></b>(3), but note that the event source is only
       removed from the event loop when all references to the event source are dropped. To make sure an event
       source does not fire anymore, even if it is still referenced, disable the event source using
       <b><a href="../man3/sd_event_source_set_enabled.3.html">sd_event_source_set_enabled</a></b>(3) with <b>SD_EVENT_OFF</b>.

       If the second parameter of <b>sd_event_add_io()</b> is <b>NULL</b> no reference to the event source object is returned.
       In this case, the event source is considered "floating", and will be destroyed implicitly when the event
       loop itself is destroyed.

       If the <u>handler</u> to <b>sd_event_add_io()</b> is <b>NULL</b>, and the event source fires, this will be considered a
       request to exit the event loop. In this case, the <u>userdata</u> parameter, cast to an integer, is passed as
       the exit code parameter to <b><a href="../man3/sd_event_exit.3.html">sd_event_exit</a></b>(3).

       Note that this call does not take possession of the file descriptor passed in, ownership (and thus the
       duty to close it when it is no longer needed) remains with the caller. However, with the
       <b>sd_event_source_set_io_fd_own()</b> call (see below) the event source may optionally take ownership of the
       file descriptor after the event source has been created. In that case the file descriptor is closed
       automatically as soon as the event source is released.

       It is recommended to use <b>sd_event_add_io()</b> only in conjunction with file descriptors that have <b>O_NONBLOCK</b>
       set, to ensure that all I/O operations from invoked handlers are properly asynchronous and non-blocking.
       Using file descriptors without <b>O_NONBLOCK</b> might result in unexpected starvation of other event sources.
       See <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2) for details on enabling <b>O_NONBLOCK</b> mode.

       <b>sd_event_source_get_io_events()</b> retrieves the configured mask of watched I/O events of an event source
       created previously with <b>sd_event_add_io()</b>. It takes the event source object and a pointer to a variable
       to store the mask in.

       <b>sd_event_source_set_io_events()</b> configures the mask of watched I/O events of an event source created
       previously with <b>sd_event_add_io()</b>. It takes the event source object and the new event mask.

       <b>sd_event_source_get_io_revents()</b> retrieves the I/O event mask of currently seen but undispatched events
       from an event source created previously with <b>sd_event_add_io()</b>. It takes the event source object and a
       pointer to a variable to store the event mask in. When called from a handler function on the handler's
       event source object this will return the same mask as passed to the handler's <u>revents</u> parameter. This
       call is primarily useful to check for undispatched events of an event source from the handler of an
       unrelated (possibly higher priority) event source. Note the relation between
       <b>sd_event_source_get_pending()</b> and <b>sd_event_source_get_io_revents()</b>: both functions will report non-zero
       results when there's an event pending for the event source, but the former applies to all event source
       types, the latter only to I/O event sources.

       <b>sd_event_source_get_io_fd()</b> retrieves the UNIX file descriptor of an event source created previously with
       <b>sd_event_add_io()</b>. It takes the event source object and returns the non-negative file descriptor or a
       negative error number on error (see below).

       <b>sd_event_source_set_io_fd()</b> changes the UNIX file descriptor of an I/O event source created previously
       with <b>sd_event_add_io()</b>. It takes the event source object and the new file descriptor as parameters. If
       the event source owned the previous file descriptor, that is if <b>sd_event_source_set_io_fd_own()</b> had been
       called for the event source with a non-zero value, then the previous file descriptor will be closed and
       the event source will also take the ownership of the new file descriptor on success.

       <b>sd_event_source_set_io_fd_own()</b> controls whether the file descriptor of the event source shall take
       ownership of the file descriptor. Takes a boolean parameter <u>b</u>. When true (nonzero), the file descriptor
       will be closed automatically when the event source is freed or when the file descriptor is replaced by
       <b>sd_event_source_set_io_fd()</b>. By default, the descriptor is not owned by the event source, and the
       application has to do close it on its own if needed.

       <b>sd_event_source_get_io_fd_own()</b> may be used to query the current setting of the file descriptor ownership
       boolean flag as set with <b>sd_event_source_set_io_fd_own()</b>. It returns positive if the file descriptor is
       closed automatically when the event source is destroyed, zero if not, and negative on error.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, these functions return 0 or a positive integer. On failure, they return a negative
       errno-style error code.

   <b>Errors</b>
       Returned values may indicate the following problems:

       <b>-ENOMEM</b>
           Not enough memory to allocate an object.

       <b>-EINVAL</b>
           An invalid argument has been passed.

       <b>-ESTALE</b>
           The event loop is already terminated.

       <b>-ECHILD</b>
           The event loop has been created in a different process, library or module instance.

       <b>-EDOM</b>
           The passed event source is not an I/O event source.

       <b>-EPERM</b>
           The passed file descriptor does not support the <b><a href="../man7/epoll.7.html">epoll</a></b>(7) API, for example because it is a regular
           file or directory. See <b><a href="../man2/epoll_ctl.2.html">epoll_ctl</a></b>(2) for details.

           Added in version 255.

</pre><h4><b>NOTES</b></h4><pre>
       Functions described here are available as a shared library, which can be compiled against and linked to
       with the <b>libsystemd</b> <b><a href="../man1/pkg-config.1.html">pkg-config</a></b>(1) file.

       The code described here uses <b><a href="../man3/getenv.3.html">getenv</a></b>(3), which is declared to be not multi-thread-safe. This means that
       the code calling the functions described here must not call <b><a href="../man3/setenv.3.html">setenv</a></b>(3) from a parallel thread. It is
       recommended to only do calls to <b>setenv()</b> from an early phase of the program when no other threads have
       been started.

</pre><h4><b>HISTORY</b></h4><pre>
       <b>sd_event_io_handler_t()</b>, <b>sd_event_add_io()</b>, <b>sd_event_source_get_io_events()</b>,
       <b>sd_event_source_set_io_events()</b>, <b>sd_event_source_get_io_revents()</b>, <b>sd_event_source_get_io_fd()</b>, and
       <b>sd_event_source_set_io_fd()</b> were added in version 229.

       <b>sd_event_source_get_io_fd_own()</b> and <b>sd_event_source_set_io_fd_own()</b> were added in version 239.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/systemd.1.html">systemd</a></b>(1), <b><a href="../man3/sd-event.3.html">sd-event</a></b>(3), <b><a href="../man3/sd_event_new.3.html">sd_event_new</a></b>(3), <b><a href="../man3/sd_event_now.3.html">sd_event_now</a></b>(3), <b><a href="../man3/sd_event_add_time.3.html">sd_event_add_time</a></b>(3), <b><a href="../man3/sd_event_add_signal.3.html">sd_event_add_signal</a></b>(3),
       <b><a href="../man3/sd_event_add_child.3.html">sd_event_add_child</a></b>(3), <b><a href="../man3/sd_event_add_inotify.3.html">sd_event_add_inotify</a></b>(3), <b><a href="../man3/sd_event_add_defer.3.html">sd_event_add_defer</a></b>(3), <b><a href="../man3/sd_event_source_set_enabled.3.html">sd_event_source_set_enabled</a></b>(3),
       <b><a href="../man3/sd_event_source_set_priority.3.html">sd_event_source_set_priority</a></b>(3), <b><a href="../man3/sd_event_source_set_userdata.3.html">sd_event_source_set_userdata</a></b>(3), <b><a href="../man3/sd_event_source_set_description.3.html">sd_event_source_set_description</a></b>(3),
       <b><a href="../man3/sd_event_source_get_pending.3.html">sd_event_source_get_pending</a></b>(3), <b><a href="../man3/sd_event_source_set_floating.3.html">sd_event_source_set_floating</a></b>(3), <b><a href="../man2/epoll_ctl.2.html">epoll_ctl</a></b>(2), <b><a href="../man7/epoll.7.html">epoll</a></b>(7)

systemd 257.7                                                                                 <u><a href="../man3/SD_EVENT_ADD_IO.3.html">SD_EVENT_ADD_IO</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>