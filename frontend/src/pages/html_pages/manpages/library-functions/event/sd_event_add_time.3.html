<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sd_event_add_time, sd_event_add_time_relative, sd_event_source_get_time, sd_event_source_set_time,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libsystemd-dev">libsystemd-dev_257.7-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sd_event_add_time, sd_event_add_time_relative, sd_event_source_get_time, sd_event_source_set_time,
       sd_event_source_set_time_relative, sd_event_source_get_time_accuracy, sd_event_source_set_time_accuracy,
       sd_event_source_get_time_clock, sd_event_time_handler_t - Add a timer event source to an event loop

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;systemd/sd-event.h&gt;</b>

       <b>typedef</b> <b>struct</b> <b>sd_event_source</b> <b>sd_event_source;</b>

       <b>typedef</b> <b>int</b> <b>(*sd_event_time_handler_t)(sd_event_source</b> <b>*</b><u>s</u><b>,</b> <b>uint64_t</b> <u>usec</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>);</b>

       <b>int</b> <b>sd_event_add_time(sd_event</b> <b>*</b><u>event</u><b>,</b> <b>sd_event_source</b> <b>**</b><u>source</u><b>,</b> <b>clockid_t</b> <u>clock</u><b>,</b> <b>uint64_t</b> <u>usec</u><b>,</b>
                             <b>uint64_t</b> <u>accuracy</u><b>,</b> <b>sd_event_time_handler_t</b> <u>handler</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>);</b>

       <b>int</b> <b>sd_event_add_time_relative(sd_event</b> <b>*</b><u>event</u><b>,</b> <b>sd_event_source</b> <b>**</b><u>source</u><b>,</b> <b>clockid_t</b> <u>clock</u><b>,</b> <b>uint64_t</b> <u>usec</u><b>,</b>
                                      <b>uint64_t</b> <u>accuracy</u><b>,</b> <b>sd_event_time_handler_t</b> <u>handler</u><b>,</b> <b>void</b> <b>*</b><u>userdata</u><b>);</b>

       <b>int</b> <b>sd_event_source_get_time(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>uint64_t</b> <b>*</b><u>ret</u><b>);</b>

       <b>int</b> <b>sd_event_source_set_time(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>uint64_t</b> <u>usec</u><b>);</b>

       <b>int</b> <b>sd_event_source_set_time_relative(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>uint64_t</b> <u>usec</u><b>);</b>

       <b>int</b> <b>sd_event_source_get_time_accuracy(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>uint64_t</b> <b>*</b><u>ret</u><b>);</b>

       <b>int</b> <b>sd_event_source_set_time_accuracy(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>uint64_t</b> <u>usec</u><b>);</b>

       <b>int</b> <b>sd_event_source_get_time_clock(sd_event_source</b> <b>*</b><u>source</u><b>,</b> <b>clockid_t</b> <b>*</b><u>ret</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>sd_event_add_time()</b> adds a new timer event source to an event loop. The event loop object is specified in
       the <u>event</u> parameter, the event source object is returned in the <u>source</u> parameter. The <u>clock</u> parameter
       takes a clock identifier, one of <b>CLOCK_REALTIME</b>, <b>CLOCK_MONOTONIC</b>, <b>CLOCK_BOOTTIME</b>, <b>CLOCK_REALTIME_ALARM</b>,
       or <b>CLOCK_BOOTTIME_ALARM</b>. See <b><a href="../man2/timerfd_create.2.html">timerfd_create</a></b>(2) for details regarding the various types of clocks. The
       <u>usec</u> parameter specifies the earliest time, in microseconds (μs), relative to the clock's epoch, when the
       timer shall be triggered. If a time already in the past is specified (including <b>0</b>), this timer source
       "fires" immediately and is ready to be dispatched. If the parameter is specified as <b>UINT64_MAX</b> the timer
       event will never elapse, which may be used as an alternative to explicitly disabling a timer event source
       with <b><a href="../man3/sd_event_source_set_enabled.3.html">sd_event_source_set_enabled</a></b>(3). The <u>accuracy</u> parameter specifies an additional accuracy value in μs
       specifying how much the timer event may be delayed. Use <b>0</b> to select the default accuracy (250ms). Use 1μs
       for maximum accuracy. Consider specifying 60000000μs (1min) or larger for long-running events that may be
       delayed substantially. Picking higher accuracy values allows the system to coalesce timer events more
       aggressively, improving power efficiency.

       The <u>handler</u> is a function to call when the timer elapses or <b>NULL</b>. The <u>userdata</u> pointer will be passed to
       the handler function, and may be chosen freely by the caller. The configured trigger time is also passed
       to the handler, even if the call actually happens slightly later, subject to the specified accuracy
       value, the kernel timer slack (see <b><a href="../man2/prctl.2.html">prctl</a></b>(2)), and additional scheduling latencies. To query the actual
       time the handler was called use <b><a href="../man3/sd_event_now.3.html">sd_event_now</a></b>(3). The handler may return negative to signal an error (see
       below), other return values are ignored. If <u>handler</u> is <b>NULL</b>, a default handler that calls
       <b><a href="../man3/sd_event_exit.3.html">sd_event_exit</a></b>(3) will be used.

       By default, the timer will elapse once (<b>SD_EVENT_ONESHOT</b>), but this may be changed with
       <b><a href="../man3/sd_event_source_set_enabled.3.html">sd_event_source_set_enabled</a></b>(3). If the handler function returns a negative error code, it will either be
       disabled after the invocation, even if the <b>SD_EVENT_ON</b> mode was requested before, or it will cause the
       loop to terminate, see <b><a href="../man3/sd_event_source_set_exit_on_failure.3.html">sd_event_source_set_exit_on_failure</a></b>(3). Note that a timer event set to <b>SD_EVENT_ON</b>
       will fire continuously unless its configured time is updated using <b>sd_event_source_set_time()</b>.

       <b>sd_event_add_time_relative()</b> is like <b>sd_event_add_time()</b>, but takes a relative time specification. It's
       relative to the current time of the event loop iteration, as returned by <b><a href="../man3/sd_event_now.3.html">sd_event_now</a></b>(3).

       To destroy an event source object use <b><a href="../man3/sd_event_source_unref.3.html">sd_event_source_unref</a></b>(3), but note that the event source is only
       removed from the event loop when all references to the event source are dropped. To make sure an event
       source does not fire anymore, even if it is still referenced, disable the event source using
       <b><a href="../man3/sd_event_source_set_enabled.3.html">sd_event_source_set_enabled</a></b>(3) with <b>SD_EVENT_OFF</b>.

       If the second parameter of <b>sd_event_add_time()</b> is <b>NULL</b> no reference to the event source object is
       returned. In this case, the event source is considered "floating", and will be destroyed implicitly when
       the event loop itself is destroyed.

       If the <u>handler</u> parameter to <b>sd_event_add_time()</b> is <b>NULL</b>, and the event source fires, this will be
       considered a request to exit the event loop. In this case, the <u>userdata</u> parameter, cast to an integer, is
       passed as the exit code parameter to <b><a href="../man3/sd_event_exit.3.html">sd_event_exit</a></b>(3).

       Use <b>CLOCK_BOOTTIME_ALARM</b> and <b>CLOCK_REALTIME_ALARM</b> to define event sources that may wake up the system
       from suspend.

       In order to set up relative timers (that is, relative to the current time), retrieve the current time via
       <b><a href="../man3/sd_event_now.3.html">sd_event_now</a></b>(3), add the desired timespan to it, and use the result as the <u>usec</u> parameter to
       <b>sd_event_add_time()</b>.

       In order to set up repetitive timers (that is, timers that are triggered in regular intervals), set up
       the timer normally, for the first invocation. Each time the event handler is invoked, update the timer's
       trigger time with <b><a href="../man3/sd_event_source_set_time.3.html">sd_event_source_set_time</a></b>(3) for the next timer iteration, and reenable the timer using
       <b>sd_event_source_set_enabled()</b>. To calculate the next point in time to pass to <b>sd_event_source_set_time()</b>,
       either use as base the <u>usec</u> parameter passed to the timer callback, or the timestamp returned by
       <b>sd_event_now()</b>. In the former case timer events will be regular, while in the latter case, the scheduling
       latency will keep accumulating on the timer.

       <b>sd_event_source_get_time()</b> retrieves the configured time value of an event source created previously with
       <b>sd_event_add_time()</b> or <b>sd_event_add_time_relative()</b>. It takes the event source object and a pointer to a
       variable to store the time in, relative to the selected clock's epoch, in μs. The returned value is
       relative to the epoch, even if the event source was created with a relative time via
       <b>sd_event_add_time_relative()</b>.

       <b>sd_event_source_set_time()</b> changes the time of an event source created previously with
       <b>sd_event_add_time()</b> or <b>sd_event_add_time_relative()</b>. It takes the event source object and a time relative
       to the selected clock's epoch, in μs.

       <b>sd_event_source_set_time_relative()</b> is similar to <b>sd_event_source_set_time()</b>, but takes a time relative
       to the current time of the event loop iteration, as returned by <b>sd_event_now()</b>.

       <b>sd_event_source_get_time_accuracy()</b> retrieves the configured accuracy value of an event source created
       previously with <b>sd_event_add_time()</b>. It takes the event source object and a pointer to a variable to
       store the accuracy in. The accuracy is specified in μs.

       <b>sd_event_source_set_time_accuracy()</b> changes the configured accuracy of a timer event source created
       previously with <b>sd_event_add_time()</b>. It takes the event source object and accuracy, in μs.

       <b>sd_event_source_get_time_clock()</b> retrieves the configured clock of an event source created previously
       with <b>sd_event_add_time()</b>. It takes the event source object and a pointer to a variable to store the clock
       identifier in.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, these functions return 0 or a positive integer. On failure, they return a negative
       errno-style error code.

   <b>Errors</b>
       Returned values may indicate the following problems:

       <b>-ENOMEM</b>
           Not enough memory to allocate an object.

       <b>-EINVAL</b>
           An invalid argument has been passed.

       <b>-ESTALE</b>
           The event loop is already terminated.

       <b>-ECHILD</b>
           The event loop has been created in a different process, library or module instance.

       <b>-EOPNOTSUPP</b>
           The selected clock is not supported by the event loop implementation.

       <b>-EDOM</b>
           The passed event source is not a timer event source.

       <b>-EOVERFLOW</b>
           The passed relative time is outside of the allowed range for time values (i.e. the specified value
           added to the current time is outside the 64 bit unsigned integer range).

           Added in version 247.

</pre><h4><b>NOTES</b></h4><pre>
       Functions described here are available as a shared library, which can be compiled against and linked to
       with the <b>libsystemd</b> <b><a href="../man1/pkg-config.1.html">pkg-config</a></b>(1) file.

       The code described here uses <b><a href="../man3/getenv.3.html">getenv</a></b>(3), which is declared to be not multi-thread-safe. This means that
       the code calling the functions described here must not call <b><a href="../man3/setenv.3.html">setenv</a></b>(3) from a parallel thread. It is
       recommended to only do calls to <b>setenv()</b> from an early phase of the program when no other threads have
       been started.

</pre><h4><b>HISTORY</b></h4><pre>
       <b>sd_event_add_time()</b>, <b>sd_event_source_get_time()</b>, <b>sd_event_source_set_time()</b>,
       <b>sd_event_source_get_time_accuracy()</b>, <b>sd_event_source_set_time_accuracy()</b>, and
       <b>sd_event_source_get_time_clock()</b> were added in version 213.

       <b>sd_event_time_handler_t()</b> was added in version 217.

       <b>sd_event_add_time_relative()</b> and <b>sd_event_source_set_time_relative()</b> were added in version 247.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/systemd.1.html">systemd</a></b>(1), <b><a href="../man3/sd-event.3.html">sd-event</a></b>(3), <b><a href="../man3/sd_event_new.3.html">sd_event_new</a></b>(3), <b><a href="../man3/sd_event_now.3.html">sd_event_now</a></b>(3), <b><a href="../man3/sd_event_add_io.3.html">sd_event_add_io</a></b>(3), <b><a href="../man3/sd_event_add_signal.3.html">sd_event_add_signal</a></b>(3),
       <b><a href="../man3/sd_event_add_child.3.html">sd_event_add_child</a></b>(3), <b><a href="../man3/sd_event_add_inotify.3.html">sd_event_add_inotify</a></b>(3), <b><a href="../man3/sd_event_add_defer.3.html">sd_event_add_defer</a></b>(3), <b><a href="../man3/sd_event_source_set_enabled.3.html">sd_event_source_set_enabled</a></b>(3),
       <b><a href="../man3/sd_event_source_set_priority.3.html">sd_event_source_set_priority</a></b>(3), <b><a href="../man3/sd_event_source_set_userdata.3.html">sd_event_source_set_userdata</a></b>(3), <b><a href="../man3/sd_event_source_set_description.3.html">sd_event_source_set_description</a></b>(3),
       <b><a href="../man3/sd_event_source_set_floating.3.html">sd_event_source_set_floating</a></b>(3), <b><a href="../man2/clock_gettime.2.html">clock_gettime</a></b>(2), <b><a href="../man2/timerfd_create.2.html">timerfd_create</a></b>(2), <b><a href="../man2/prctl.2.html">prctl</a></b>(2)

systemd 257.7                                                                               <u><a href="../man3/SD_EVENT_ADD_TIME.3.html">SD_EVENT_ADD_TIME</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>