<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mojo::Transaction::WebSocket - WebSocket transaction</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmojolicious-perl">libmojolicious-perl_9.39+dfsg-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Mojo::Transaction::WebSocket - WebSocket transaction

</pre><h4><b>SYNOPSIS</b></h4><pre>
         use Mojo::Transaction::WebSocket;

         # Send and receive WebSocket messages
         my $ws = Mojo::Transaction::WebSocket-&gt;new;
         $ws-&gt;send('Hello World!');
         $ws-&gt;on(message =&gt; sub ($ws, $msg) { say "Message: $msg" });
         $ws-&gt;on(finish =&gt; sub ($ws, $code, $reason) { say "WebSocket closed with status $code." });

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Mojo::Transaction::WebSocket is a container for WebSocket transactions, based on RFC 6455
       &lt;https://tools.ietf.org/html/rfc6455&gt; and RFC 7692 &lt;https://tools.ietf.org/html/rfc7692&gt;.

</pre><h4><b>EVENTS</b></h4><pre>
       Mojo::Transaction::WebSocket inherits all events from Mojo::Transaction and can emit the following new
       ones.

   <b>binary</b>
         $ws-&gt;on(binary =&gt; sub ($ws, $bytes) {...});

       Emitted when a complete WebSocket binary message has been received.

         $ws-&gt;on(binary =&gt; sub ($ws, $bytes) { say "Binary: $bytes" });

   <b>drain</b>
         $ws-&gt;on(drain =&gt; sub ($ws) {...});

       Emitted once all data has been sent.

         $ws-&gt;on(drain =&gt; sub ($ws) { $ws-&gt;send(time) });

   <b>finish</b>
         $ws-&gt;on(finish =&gt; sub ($ws, $code, $reason) {...});

       Emitted when the WebSocket connection has been closed.

   <b>frame</b>
         $ws-&gt;on(frame =&gt; sub ($ws, $frame) {...});

       Emitted when a WebSocket frame has been received.

         $ws-&gt;on(frame =&gt; sub ($ws, $frame) {
           say "FIN: $frame-&gt;[0]";
           say "RSV1: $frame-&gt;[1]";
           say "RSV2: $frame-&gt;[2]";
           say "RSV3: $frame-&gt;[3]";
           say "Opcode: $frame-&gt;[4]";
           say "Payload: $frame-&gt;[5]";
         });

   <b>json</b>
         $ws-&gt;on(json =&gt; sub ($ws, $json) {...});

       Emitted when a complete WebSocket message has been received, all text and binary messages will be
       automatically JSON decoded. Note that this event only gets emitted when it has at least one subscriber.

         $ws-&gt;on(json =&gt; sub ($ws, $hash) { say "Message: $hash-&gt;{msg}" });

   <b>message</b>
         $ws-&gt;on(message =&gt; sub ($ws, $msg) {...});

       Emitted when a complete WebSocket message has been received, text messages will be automatically decoded.
       Note that this event only gets emitted when it has at least one subscriber.

         $ws-&gt;on(message =&gt; sub ($ws, $msg) { say "Message: $msg" });

   <b>resume</b>
         $tx-&gt;on(resume =&gt; sub ($tx) {...});

       Emitted when transaction is resumed.

   <b>text</b>
         $ws-&gt;on(text =&gt; sub ($ws, $bytes) {...});

       Emitted when a complete WebSocket text message has been received.

         $ws-&gt;on(text =&gt; sub ($ws, $bytes) { say "Text: $bytes" });

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       Mojo::Transaction::WebSocket inherits all attributes from Mojo::Transaction and implements the following
       new ones.

   <b>compressed</b>
         my $bool = $ws-&gt;compressed;
         $ws      = $ws-&gt;compressed($bool);

       Compress messages with "permessage-deflate" extension.

   <b>established</b>
         my $bool = $ws-&gt;established;
         $ws      = $ws-&gt;established($bool);

       WebSocket connection established.

   <b>handshake</b>
         my $handshake = $ws-&gt;handshake;
         $ws           = $ws-&gt;handshake(Mojo::Transaction::HTTP-&gt;new);

       The original handshake transaction, usually a Mojo::Transaction::HTTP object.

   <b>masked</b>
         my $bool = $ws-&gt;masked;
         $ws      = $ws-&gt;masked($bool);

       Mask outgoing frames with XOR cipher and a random 32-bit key.

   <b>max_websocket_size</b>
         my $size = $ws-&gt;max_websocket_size;
         $ws      = $ws-&gt;<a href="../man1024/max_websocket_size.1024.html">max_websocket_size</a>(1024);

       Maximum WebSocket message size in bytes, defaults to the value of the "MOJO_MAX_WEBSOCKET_SIZE"
       environment variable or 262144 (256KiB).

</pre><h4><b>METHODS</b></h4><pre>
       Mojo::Transaction::WebSocket inherits all methods from Mojo::Transaction and implements the following new
       ones.

   <b>build_message</b>
         my $frame = $ws-&gt;build_message({binary =&gt; $bytes});
         my $frame = $ws-&gt;build_message({text   =&gt; $bytes});
         my $frame = $ws-&gt;build_message({json   =&gt; {test =&gt; [1, 2, 3]}});
         my $frame = $ws-&gt;build_message($chars);

       Build WebSocket message.

   <b>client_read</b>
         $ws-&gt;client_read($data);

       Read data client-side, used to implement user agents such as Mojo::UserAgent.

   <b>client_write</b>
         my $bytes = $ws-&gt;client_write;

       Write data client-side, used to implement user agents such as Mojo::UserAgent.

   <b>closed</b>
         $tx = $tx-&gt;closed;

       Same as "completed" in Mojo::Transaction, but also indicates that all transaction data has been sent.

   <b>connection</b>
         my $id = $ws-&gt;connection;

       Connection identifier.

   <b>finish</b>
         $ws = $ws-&gt;finish;
         $ws = $ws-&gt;<a href="../man1000/finish.1000.html">finish</a>(1000);
         $ws = $ws-&gt;finish(1003 =&gt; 'Cannot accept data!');

       Close WebSocket connection gracefully.

   <b>is_websocket</b>
         my $bool = $ws-&gt;is_websocket;

       True, this is a Mojo::Transaction::WebSocket object.

   <b>kept_alive</b>
         my $bool = $ws-&gt;kept_alive;

       Connection has been kept alive.

   <b>local_address</b>
         my $address = $ws-&gt;local_address;

       Local interface address.

   <b>local_port</b>
         my $port = $ws-&gt;local_port;

       Local interface port.

   <b>parse_message</b>
         $ws-&gt;parse_message([$fin, $rsv1, $rsv2, $rsv3, $op, $payload]);

       Parse WebSocket message.

   <b>protocol</b>
         my $proto = $ws-&gt;protocol;

       Return negotiated subprotocol or "undef".

   <b>remote_address</b>
         my $address = $ws-&gt;remote_address;

       Remote interface address.

   <b>remote_port</b>
         my $port = $ws-&gt;remote_port;

       Remote interface port.

   <b>req</b>
         my $req = $ws-&gt;req;

       Handshake request, usually a Mojo::Message::Request object.

   <b>res</b>
         my $res = $ws-&gt;res;

       Handshake response, usually a Mojo::Message::Response object.

   <b>resume</b>
         $ws = $ws-&gt;resume;

       Resume "handshake" transaction.

   <b>send</b>
         $ws = $ws-&gt;send({binary =&gt; $bytes});
         $ws = $ws-&gt;send({text   =&gt; $bytes});
         $ws = $ws-&gt;send({json   =&gt; {test =&gt; [1, 2, 3]}});
         $ws = $ws-&gt;send([$fin, $rsv1, $rsv2, $rsv3, $op, $payload]);
         $ws = $ws-&gt;send($chars);
         $ws = $ws-&gt;send($chars =&gt; sub {...});

       Send message or frame non-blocking via WebSocket, the optional drain callback will be executed once all
       data has been written.

         # Send "Ping" frame
         use Mojo::WebSocket qw(WS_PING);
         $ws-&gt;send([1, 0, 0, 0, WS_PING, 'Hello World!']);

   <b>server_read</b>
         $ws-&gt;server_read($data);

       Read data server-side, used to implement web servers such as Mojo::Server::Daemon.

   <b>server_write</b>
         my $bytes = $ws-&gt;server_write;

       Write data server-side, used to implement web servers such as Mojo::Server::Daemon.

   <b>with_compression</b>
         $ws-&gt;with_compression;

       Negotiate "permessage-deflate" extension for this WebSocket connection.

   <b>with_protocols</b>
         my $proto = $ws-&gt;with_protocols('v2.proto', 'v1.proto');

       Negotiate subprotocol for this WebSocket connection.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Mojolicious, Mojolicious::Guides, &lt;https://mojolicious.org&gt;.

perl v5.40.0                                       2024-12-07                  <u>Mojo::Transaction::<a href="../man3pm/WebSocket.3pm.html">WebSocket</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>