<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nbdkit_error, nbdkit_verror, nbdkit_set_error - return an error from nbdkit plugins</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/nbdkit-plugin-dev">nbdkit-plugin-dev_1.42.4-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nbdkit_error, nbdkit_verror, nbdkit_set_error - return an error from nbdkit plugins

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;nbdkit-plugin.h&gt;

        void nbdkit_error (const char *fs, ...);
        void nbdkit_verror (const char *fs, va_list args);

        void nbdkit_set_error (int err);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       If there is an error in your plugin, the plugin should call "nbdkit_error" to report an error message.
       Then the callback should return the appropriate error indication, eg. "NULL" or -1.

       "nbdkit_error" works like <b><a href="../man3/printf.3.html">printf</a></b>(3).  "nbdkit_verror" works like <b><a href="../man3/vprintf.3.html">vprintf</a></b>(3).

       For convenience, "nbdkit_error" preserves the value of "errno", and also supports the glibc extension of
       a single %m in a format string expanding to strerror(errno), even on platforms that don't support that
       natively.

   <b>Example</b>
        int
        my_pread (void *handle, void *buf, uint32_t count, uint64_t offset,
                  uint32_t flags)
        {
          char *bounce_buffer = malloc (SECTOR_SIZE);
          if (bounce_buffer == NULL) {
            nbdkit_error ("malloc: %m");
            return -1;
          }
          //...
        }

   <b>Setting</b> <b>errno</b>
       For callbacks which serve data to the client, the plugin may call "nbdkit_set_error" to influence the
       errno that will be sent back to the client.

       If the call to "nbdkit_set_error" is omitted while serving data, then the global variable "errno" may be
       used.  For plugins which have ".errno_is_preserved != 0" the server will use "errno".  In plugins written
       in non-C languages, we usually cannot trust that "errno" will be preserved when returning from that
       language to C.  In that case, either the plugin must call "nbdkit_set_error" or hard-coded "EIO" is used.

   <b>Interaction</b> <b>with</b> <u><b>--log</b></u> <b>option</b>
       The nbdkit <u>--log</u> option controls where error messages are sent.  The default is to send error messages to
       stderr, unless nbdkit forks into the background in which case they are sent to syslog.  For more
       information read the description in <b><a href="../man1/nbdkit.1.html">nbdkit</a></b>(1).

</pre><h4><b>LANGUAGE</b> <b>BINDINGS</b></h4><pre>
       Most language bindings do not expose these functions explicitly.  Instead you are expected to throw an
       exception on error which is implicitly turned into a call to "nbdkit_error".  Read the documentation for
       the language binding to find out how errors are handled.

</pre><h4><b>HISTORY</b></h4><pre>
       "nbdkit_error" and "nbdkit_verror" were present in nbdkit 0.1.0.  "nbdkit_set_error" was added in nbdkit
       1.2.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/nbdkit.1.html">nbdkit</a></b>(1), <b><a href="../man3/nbdkit_debug.3.html">nbdkit_debug</a></b>(3), <b><a href="../man3/nbdkit-plugin.3.html">nbdkit-plugin</a></b>(3), <b><a href="../man3/nbdkit-filter.3.html">nbdkit-filter</a></b>(3).

</pre><h4><b>AUTHORS</b></h4><pre>
       Eric Blake

       Richard W.M. Jones

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright Red Hat

</pre><h4><b>LICENSE</b></h4><pre>
       Redistribution and use in source and binary forms, with or without modification, are permitted provided
       that the following conditions are met:

       •   Redistributions  of  source  code must retain the above copyright notice, this list of conditions and
           the following disclaimer.

       •   Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
           the following disclaimer in the documentation and/or other materials provided with the distribution.

       •   Neither the name of Red Hat nor the names of its contributors may  be  used  to  endorse  or  promote
           products derived from this software without specific prior written permission.

       THIS  SOFTWARE  IS  PROVIDED BY RED HAT AND CONTRIBUTORS ''AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
       INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND  FITNESS  FOR  A  PARTICULAR
       PURPOSE  ARE  DISCLAIMED.  IN  NO EVENT SHALL RED HAT OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
       INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,  PROCUREMENT  OF
       SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
       ON  ANY  THEORY  OF  LIABILITY,  WHETHER  IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
       OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
       DAMAGE.

nbdkit-1.42.4                                      2025-06-16                                    <u><a href="../man3/nbdkit_error.3.html">nbdkit_error</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>