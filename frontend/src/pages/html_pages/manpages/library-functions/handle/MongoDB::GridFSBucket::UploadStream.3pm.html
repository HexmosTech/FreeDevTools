<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB::GridFSBucket::UploadStream - File handle abstraction for uploading</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmongodb-perl">libmongodb-perl_2.2.2-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       MongoDB::GridFSBucket::UploadStream - File handle abstraction for uploading

</pre><h4><b>VERSION</b></h4><pre>
       version v2.2.2

</pre><h4><b>SYNOPSIS</b></h4><pre>
           # OO API
           $stream  = $bucket-&gt;open_upload_stream("foo.txt");
           $stream-&gt;print( $data );
           $stream-&gt;close;
           $id = $stream-&gt;id;

           # Tied handle API
           $fh = $stream-&gt;fh
           print {$fh} $data;
           close $fh;

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This class provides a file abstraction for uploading.  You can stream data to an object of this class via
       methods or via a tied-handle interface.

       Writes are buffered and sent in chunk-size units.  When "close" is called, all data will be flushed to
       the GridFS Bucket and the newly created file will be visible.

</pre><h4><b>ATTRIBUTES</b></h4><pre>
   <b>chunk_size_bytes</b>
       The number of bytes per chunk.  Defaults to the "chunk_size_bytes" of the originating bucket object.

       This will be stored in the "chunkSize" field of the file document on a successful upload.

   <b>filename</b>
       The filename to store the file under. Note that filenames are NOT necessarily unique.

       This will be stored in the "filename" field of the file document on a successful upload.

   <b>metadata</b>
       An optional hashref for storing arbitrary metadata about the file.

       If defined, this will be stored in the "metadata" field of the file document on a successful upload.

   <b>content_type</b> <b>(DEPRECATED)</b>
       An optional MIME type. This field should only be used for backwards compatibility with older GridFS
       implementations. New applications should store the content type in the metadata hash if needed.

       If defined, this will be stored in the "contentType" field of the file document on a successful upload.

   <b>aliases</b> <b>(DEPRECATED)</b>
       An optional array of aliases. This field should only be used for backwards compatibility with older
       GridFS implementations. New applications should store aliases in the metadata hash if needed.

       If defined, this will be stored in the "aliases" field of the file document on a successful upload.

</pre><h4><b>METHODS</b></h4><pre>
   <b>id</b>
           $id = $stream-&gt;id;

       The id of the file created by the stream.  It will be stored in the "_id" field of the file document on a
       successful upload.  Some upload methods require specifying an id at upload time.  Defaults to a newly-
       generated BSON::OID or BSON codec specific equivalent.

   <b>fh</b>
           my $fh = $stream-&gt;fh;
           print $fh, 'test data...';
           close $fh

       Returns a new file handle tied to this instance of UploadStream that can be operated on with the built-in
       functions "print", "printf", "syswrite", "fileno" and "close".

       <b>Important</b> <b>notes</b>:

       Allowing one of these tied filehandles to fall out of scope will NOT cause close to be called. This is
       due to the way tied file handles are implemented in Perl.  For close to be called implicitly, all tied
       filehandles and the original object must go out of scope.

       Each file handle retrieved this way is tied back to the same object, so calling close on multiple tied
       file handles and/or the original object will have the same effect as calling close on the original object
       multiple times.

   <b>abort</b>
           $stream-&gt;abort;

       Aborts the upload by deleting any chunks already uploaded to the database and closing the stream.

   <b>close</b>
           $file_doc = $stream-&gt;close;

       Closes the stream and flushes any remaining data to the database. Once this is done a file document is
       created in the GridFS bucket, making the uploaded file visible in subsequent queries or downloads.

       On success, the file document hash reference is returned as a convenience.

       <b>Important</b> <b>notes:</b>

       •   Calling close will also cause any tied file handles created for the stream to also close.

       •   "close"  will  be  automatically  called when a stream object is destroyed. When called this way, any
           errors thrown will not halt execution.

       •   Calling "close" repeatedly will warn.

   <b>fileno</b>
           if ( $stream-&gt;fileno ) { ... }

       Works like the builtin "fileno", but it returns -1 if the stream is open and undef if closed.

   <b>print</b>
           $stream-&gt;print(@data);

       Works like the builtin "print".

   <b>printf</b>
           $stream-&gt;printf($format, @data);

       Works like the builtin "printf".

   <b>syswrite</b>
           $stream-&gt;syswrite($buffer);
           $stream-&gt;syswrite($buffer, $length);
           $stream-&gt;syswrite($buffer, $length, $offset);

       Works like the builtin "syswrite".

</pre><h4><b>CAVEATS</b></h4><pre>
   <b>Character</b> <b>encodings</b>
       All the writer methods (e.g. "print", "printf", etc.) send a binary representation of  the  string  input
       provided  (or generated in the case of "printf").  Unless you explicitly encode it to bytes, this will be
       the <b>internal</b> representation of the string in the Perl interpreter.  If you have ASCII characters, it will
       already be bytes.  If you have any characters above 0xff, it will be UTF-8 encoded  codepoints.   If  you
       have characters between 0x80 and 0xff and not higher, you might have either bytes or UTF-8 internally.

       <b>You</b>  <b>are</b>  <b>strongly</b>  <b>encouraged</b> <b>to</b> <b>do</b> <b>your</b> <b>own</b> <b>character</b> <b>encoding</b> <b>with</b> <b>the</b> <b>Encode</b> <b>module</b> <b>or</b> <b>equivalent</b> <b>and</b>
       <b>upload</b> <b>only</b> <b>bytes</b> <b>to</b> <b>GridFS</b>.

</pre><h4><b>AUTHORS</b></h4><pre>
       •   David Golden &lt;<a href="mailto:david@mongodb.com">david@mongodb.com</a>&gt;

       •   Rassi &lt;<a href="mailto:rassi@mongodb.com">rassi@mongodb.com</a>&gt;

       •   Mike Friedman &lt;<a href="mailto:friedo@friedo.com">friedo@friedo.com</a>&gt;

       •   Kristina Chodorow &lt;<a href="mailto:k.chodorow@gmail.com">k.chodorow@gmail.com</a>&gt;

       •   Florian Ragwitz &lt;<a href="mailto:rafl@debian.org">rafl@debian.org</a>&gt;

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       This software is Copyright (c) 2020 by MongoDB, Inc.

       This is free software, licensed under:

         The Apache License, Version 2.0, January 2004

perl v5.40.1                                       2025-04-03              <u>MongoDB::GridF...t::<a href="../man3pm/UploadStream.3pm.html">UploadStream</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>