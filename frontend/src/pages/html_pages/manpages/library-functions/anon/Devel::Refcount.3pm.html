<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>"Devel::Refcount" - obtain the REFCNT value of a referent</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libdevel-refcount-perl">libdevel-refcount-perl_0.10-3build5_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       "Devel::Refcount" - obtain the REFCNT value of a referent

</pre><h4><b>SYNOPSIS</b></h4><pre>
        use Devel::Refcount qw( refcount );

        my $anon = [];

        print "Anon ARRAY $anon has " . refcount( $anon ) . " reference\n";

        my $otherref = $anon;

        print "Anon ARRAY $anon now has " . refcount( $anon ) . " references\n";

        assert_oneref $otherref; # This will throw an exception at runtime

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This module provides a single function which obtains the reference count of the object being pointed to
       by the passed reference value. It also provides a debugging assertion that asserts a given reference has
       a count of only 1.

</pre><h4><b>FUNCTIONS</b></h4><pre>
   <b>$count</b> <b>=</b> <b>refcount(</b> <b>$ref</b> <b>)</b>
       Returns the reference count of the object being pointed to by $ref.

   <b>assert_oneref(</b> <b>$ref</b> <b>)</b>
       Asserts that the given object reference has a reference count of only 1. If this is true the function
       does nothing. If it has more than 1 reference then an exception is thrown. Additionally, if
       Devel::FindRef is available, it will be used to print a more detailed trace of where the references are
       found.

       Typically this would be useful in debugging to track down cases where objects are still being referenced
       beyond the point at which they are supposed to be dropped. For example, if an element is delete from a
       hash that ought to be the last remaining reference, the return value of the "delete" operator can be
       asserted on

        assert_oneref delete $self-&gt;{some_item};

       If at the time of deleting there are any other references to this object then the assertion will fail;
       and if "Devel::FindRef" is available the other locations will be printed.

</pre><h4><b>COMPARISON</b> <b>WITH</b> <b>SvREFCNT</b></h4><pre>
       This function differs from "Devel::Peek::SvREFCNT" in that <b>SvREFCNT()</b> gives the reference count of the SV
       object itself that it is passed, whereas <b>refcount()</b> gives the count of the object being pointed to. This
       allows it to give the count of any referent (i.e. ARRAY, HASH, CODE, GLOB and Regexp types) as well.

       Consider the following example program:

        use Devel::Peek qw( SvREFCNT );
        use Devel::Refcount qw( refcount );

        sub printcount
        {
           my $name = shift;

           printf "%30s has SvREFCNT=%d, refcount=%d\n",
              $name, SvREFCNT( $_[0] ), refcount( $_[0] );
        }

        my $var = [];

        printcount 'Initially, $var', $var;

        my $othervar = $var;

        printcount 'Before CODE ref, $var', $var;
        printcount '$othervar', $othervar;

        my $code = sub { undef $var };

        printcount 'After CODE ref, $var', $var;
        printcount '$othervar', $othervar;

       This produces the output

                       Initially, $var has SvREFCNT=1, refcount=1
                 Before CODE ref, $var has SvREFCNT=1, refcount=2
                             $othervar has SvREFCNT=1, refcount=2
                  After CODE ref, $var has SvREFCNT=2, refcount=2
                             $othervar has SvREFCNT=1, refcount=2

       Here, we see that <b>SvREFCNT()</b> counts the number of references to the SV object passed in as the scalar
       value - the $var or $othervar respectively, whereas <b>refcount()</b> counts the number of reference values that
       point to the referent object - the anonymous ARRAY in this case.

       Before the CODE reference is constructed, both $var and $othervar have <b>SvREFCNT()</b> of 1, as they exist
       only in the current lexical pad. The anonymous ARRAY has a <b>refcount()</b> of 2, because both $var and
       $othervar store a reference to it.

       After the CODE reference is constructed, the $var variable now has an <b>SvREFCNT()</b> of 2, because it also
       appears in the lexical pad for the new anonymous CODE block.

</pre><h4><b>PURE-PERL</b> <b>FALLBACK</b></h4><pre>
       An XS implementation of this function is provided, and is used by default. If the XS library cannot be
       loaded, a fallback implementation in pure perl using the "B" module is used instead. This will behave
       identically, but is much slower.

               Rate   pp   xs
        pp 225985/s   -- -66%
        xs 669570/s 196%   --

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       â€¢   Test::Refcount - assert reference counts on objects

</pre><h4><b>AUTHOR</b></h4><pre>
       Paul Evans &lt;<a href="mailto:leonerd@leonerd.org.uk">leonerd@leonerd.org.uk</a>&gt;

perl v5.40.0                                       2024-10-20                               <u>Devel::<a href="../man3pm/Refcount.3pm.html">Refcount</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>