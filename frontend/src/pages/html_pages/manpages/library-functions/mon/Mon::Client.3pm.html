<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon::Client - Methods for interaction with Mon client</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/mon-client">mon-client_1.2.0-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Mon::Client - Methods for interaction with Mon client

</pre><h4><b>SYNOPSIS</b></h4><pre>
           use Mon::Client;

</pre><h4><b>DESCRIPTION</b></h4><pre>
           Mon::Client is used to interact with "mon" clients. It supports
           a protocol-independent API for retrieving the status of the mon
           server, and performing certain operations, such as disableing hosts
           and service checks.

</pre><h4><b>METHODS</b></h4><pre>
       new Creates a new object. A hash can be supplied which sets the default values. An example which contains
           all of the variables that you can initialize:

               $c = new Mon::Client (
                   host =&gt; "monhost",
                   port =&gt; 2583,
                   username =&gt; "foo",
                   password =&gt; "bar",
               );

       password (pw)
           If <u>pw</u> is provided, sets the password. Otherwise, returns the currently set password.

       host (host)
           If <u>host</u> is provided, sets the mon host. Otherwise, returns the currently set mon host.

       port (portnum)
           If <u>portnum</u> is provided, sets the mon port number. Otherwise, returns the currently set port number.

       username (user)
           If <u>user</u> is provided, sets the user login. Otherwise, returns the currently set user login.

       prot
           If <u>protocol</u> is provided, sets the protocol, specified by a string which is of the form "1.2.3", where
           "1" is the major revision, "2" is the minor revision, and "3" is the sub-minor revision.  If <u>protocol</u>
           is not provided, the currently set protocol is returned.

       protid ([protocol])
           Returns  true if client and server protocol match, false otherwise.  Implicitly called by <b>connect</b>. If
           protocol is specified as an integer, supplies that protocol version to the server for verification.

       version
           Returns the protocol version of the remote server.

       error
           Returns the error string from set by the last method, or undef if there was no error.

       connected
           Returns 0 (not connected) or 1 (connected).

       connect (%args)
           Connects to the server. If <b>host</b> and <b>port</b> have not been set,  uses  the  defaults.  Returns  <u>undef</u>  on
           error.  If $args{"skip_protid"} is true, skip protocol identification upon connect.

       disconnect
           Disconnects from the server. Return <u>undef</u> on error.

       login ( %hash )
           <b>%hash</b> is optional, but if specified, should contain two keys, <b>username</b> and <b>password</b>.

           Performs  the  "login" command to authenticate the user to the server.  Uses <b>username</b> and <b>password</b> if
           specified, otherwise uses the username and password previously set by those methods, respectively.

       checkauth ( command )
           Checks to see if the specified command, as executed by the current user, is authorized by the server,
           without actually executing the command.  Returns 1 (command is  authorized)  or  0  (command  is  not
           authorized).

       disable_watch ( watch )
           Disables <b>watch</b>.

       disable_service ( watch, service )
           Disables a service, as specified by <b>watch</b> and <b>service</b>.

       disable_host ( host )
           Disables <b>host</b>.

       enable_watch ( watch )
           Enables <b>watch</b>.

       enable_service ( watch, service )
           Enables a service as specified by <b>watch</b> and <b>service</b>.

       enable_host ( host )
           Enables <b>host</b>.

       set ( group, service, var, val )
           Sets <b>var</b> in <b>group,service</b> to <b>val</b>. Returns undef on error.

       get ( group, service, var )
           Gets variable <b>var</b> in <b>group,service</b> and returns it, or undef on error.

       quit
           Logs out of the server. This method should be followed by a call to the <b>disconnect</b> method.

       list_descriptions
           Returns a hash of service descriptions, indexed by watch and service. For example:

               %desc = $mon-&gt;list_descriptions;
               print "$desc{'watchname'}-&gt;{'servicename'}\n";

       list_deps
           Lists  dependency  expressions and their components for all services. If there is no dependency for a
           particular service, then the value will be "NONE".

               %deps = $mon-&gt;list_deps;
               foreach $watch (keys %deps) {
                   foreach $service (keys %{$deps{$watch}}) {
                       my $sref = \%{$deps{$watch}-&gt;{$service}};
                       print "expr ($watch,$service) = $sref-&gt;{expression}\n";
                       print "components ($watch,$service) = @{$sref-&gt;{components}}\n";
                   }
               }

       list_group ( hostgroup )
           Lists members of <b>hostgroup</b>. Returns an array of each member.

       list_watch
           Returns an array of all the defined watch groups and services.

               foreach $w ($mon-&gt;list_watch) {
                   print "group=$w-&gt;[0] service=$w-&gt;[1]\n";
               }

       list_opstatus ( [group1, service1], ... )
           Returns a hash of per-service operational statuses, as indexed by watch  and  service.  The  list  of
           anonymous  arrays is optional, and if is not provided then the status of all groups and services will
           be queried.

               %s = $mon-&gt;list_opstatus;
               foreach $watch (keys %s) {
                   foreach $service (keys %{$s{$watch}}) {
                       foreach $var (keys %{$s{$watch}{$service}}) {
                           print "$watch $service $var=$s{$watch}{$service}{$var}\n";
                       }
                   }
               }

       list_failures
           Returns a hash in the same manner as <b>list_opstatus</b>, but only the services  which  are  in  a  failure
           state.

       list_successes
           Returns  a  hash  in  the  same manner as <b>list_opstatus</b>, but only the services which are in a success
           state.

       list_disabled
           Returns a hash of disabled watches, services, and hosts.

               %d = $mon-&gt;list_disabled;

               foreach $group (keys %{$d{"hosts"}}) {
                   foreach $host (keys %{$d{"hosts"}{$group}}) {
                       print "host $group/$host disabled\n";
                   }
               }

               foreach $watch (keys %{$d{"services"}}) {
                   foreach $service (keys %{$d{"services"}{$watch}}) {
                       print "service $watch/$service disabled\n";
                   }
               }

               for (keys %{$d{"watches"}}) {
                   print "watch $_ disabled\n";
               }

       list_alerthist
           Returns an array of hash references containing the alert history.

               @a = $mon-&gt;list_alerthist;

               for (@a) {
                   print join (" ",
                       $_-&gt;{"type"},
                       $_-&gt;{"watch"},
                       $_-&gt;{"service"},
                       $_-&gt;{"time"},
                       $_-&gt;{"alert"},
                       $_-&gt;{"args"},
                       $_-&gt;{"summary"},
                       "\n",
                   );
               }

       list_dtlog
           Returns an array of hash references containing the downtime log.

           @a = $mon-&gt;list_dtlog

                for (@a) {
                  print join (" ",
                      $_-&gt;{"timeup"},
                      $_-&gt;{"group"},
                      $_-&gt;{"service"},
                      $_-&gt;{"failtime"},
                      $_-&gt;{"downtime"},
                      $_-&gt;{"interval"},
                      $_-&gt;{"summary"},
                      "\n",
                  );
                }

       list_failurehist
           Returns an array of hash references containing the failure history.

               @f = $mon-&gt;list_failurehist;

               for (@f) {
                   print join (" ",
                       $_-&gt;{"watch"},
                       $_-&gt;{"service"},
                       $_-&gt;{"time"},
                       $_-&gt;{"summary"},
                       "\n",
                   );
               }

       list_pids
           Returns an array of hash references containing the list of process IDs of currently  active  monitors
           run by the server.

               @p = $mon-&gt;list_pids;

               $server = shift @p;

               for (@p) {
                   print join (" ",
                       $_-&gt;{"watch"},
                       $_-&gt;{"service"},
                       $_-&gt;{"pid"},
                       "\n",
                   );
               }

       list_state
           Lists the state of the scheduler. Returns a two-element array. The first element of the array is 0 if
           the  scheduler  is  stopped,  and  1 if the scheduler is currently running. The second element of the
           array returned is the string "scheduler running" if the scheduler is currently running,  and  if  the
           scheduler is stopped, the second element is the <b><a href="../man2/time.2.html">time</a></b>(2) that the scheduler was stopped.

               @s = $mon-&gt;list_state;

               if ($s[0] == 0) {
                   print "scheduler stopped since " . localtime ($s[1]) . "\n";
               }

       start
           Starts the scheduler.

       stop
           Stops the scheduler.

       reset
           Resets the server.

       reload ( what )
           Causes  the  server to reload its configuration. <b>what</b> is an optional argument, and currently the only
           supported option is <b>auth</b>, which reloads the authorization file.

       term
           Terminates the server.

       set_maxkeep
           Sets the maximum number of history entries to store in memory.

       get_maxkeep
           Returns the maximum number of history entries to store in memory.

       test ( test, group, service [, exitval, period])
           Schedules a service test to run immediately, or tests an alert for  a  given  period.  <b>test</b>  must  be
           <b>monitor</b>,  <b>alert</b>,  <b>startupalert</b>,  or <b>upalert</b>. To test alerts, the <b>exitval</b> and <b>period</b> must be supplied.
           Periods are identified by their label in the mon config file. If there are no period tags,  then  the
           actual period string must be used, exactly as it is listed in the config file.

       test_config
           Tests  the  syntax  of  the configuration file. Returns a two-element array. The first element of the
           array is 0 if the syntax of the config file is invalid, and 1 if the syntax of the config file is OK.
           The second element of the array returned is the failure message,  if  the  config  file  has  invalid
           syntax, and the result code if the config file syntax is OK. This function returns undef if it cannot
           get a connection or a response from the mon server.

           Config  file  checking  stops as soon as an error is found, so you will need to run this command more
           than once if you have multiple errors in your config file in order to find them all.

               @s = $mon-&gt;test_config;

               if ($s[0] == 0) {
                   print "error in config file:\n" . $s[1] . "\n";
               }

       ack ( group, service, text )
           When <b>group/service</b> is in a failure state, acknowledges this  with  <b>text</b>,  and  disables  all  further
           alerts during this failure period.

       loadstate ( state )
           Loads <b>state</b>.

       savestate ( state )
           Saves <b>state</b>.

       servertime
           Returns the time on the server using the same output as the <b><a href="../man2/time.2.html">time</a></b>(2) system call.

       send_trap ( %vars )
           Sends a trap to a remote mon server. Here is an example:

               $mon-&gt;send_trap (
                   group           =&gt; "remote-group",
                   service         =&gt; "remote-service",
                   retval          =&gt; 1,
                   opstatus        =&gt; "fail",
                   summary         =&gt; "hosta hostb hostc",
                   detail          =&gt; "hosta hostb and hostc are unresponsive",
               );

           <u>retval</u> must be a nonnegative integer.

           <u>opstatus</u> must be one of <u>fail</u>, <u>ok</u>, <u>coldstart</u>, <u>warmstart</u>, <u>linkdown</u>, <u>unknown</u>, <u>timeout</u>,  <u>untested</u>.

           Returns <u>undef</u> on error.

perl v5.40.1                                       2025-03-04                                   <u>Mon::<a href="../man3pm/Client.3pm.html">Client</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>