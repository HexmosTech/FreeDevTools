<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>avc_has_perm,  avc_has_perm_noaudit,  avc_audit,  avc_entry_ref_init  -  obtain  and audit SELinux access</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libselinux1-dev">libselinux1-dev_3.8.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       avc_has_perm,  avc_has_perm_noaudit,  avc_audit,  avc_entry_ref_init  -  obtain  and audit SELinux access
       decisions

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;selinux/selinux.h&gt;</b>
       <b>#include</b> <b>&lt;selinux/avc.h&gt;</b>

       <b>void</b> <b>avc_entry_ref_init(struct</b> <b>avc_entry_ref</b> <b>*</b><u>aeref</u><b>);</b>

       <b>int</b> <b>avc_has_perm(security_id_t</b> <u>ssid</u><b>,</b> <b>security_id_t</b> <u>tsid</u><b>,</b>
                        <b>security_class_t</b> <u>tclass</u><b>,</b> <b>access_vector_t</b> <u>requested</u><b>,</b>
                        <b>struct</b> <b>avc_entry_ref</b> <b>*</b><u>aeref</u><b>,</b> <b>void</b> <b>*</b><u>auditdata</u><b>);</b>

       <b>int</b> <b>avc_has_perm_noaudit(security_id_t</b> <u>ssid</u><b>,</b> <b>security_id_t</b> <u>tsid</u><b>,</b>
                        <b>security_class_t</b> <u>tclass</u><b>,</b> <b>access_vector_t</b> <u>requested</u><b>,</b>
                        <b>struct</b> <b>avc_entry_ref</b> <b>*</b><u>aeref</u><b>,</b> <b>struct</b> <b>av_decision</b> <b>*</b><u>avd</u><b>);</b>

       <b>void</b> <b>avc_audit(security_id_t</b> <u>ssid</u><b>,</b> <b>security_id_t</b> <u>tsid</u><b>,</b>
                      <b>security_class_t</b> <u>tclass</u><b>,</b> <b>access_vector_t</b> <u>requested</u><b>,</b>
                      <b>struct</b> <b>av_decision</b> <b>*</b><u>avd</u><b>,</b> <b>int</b> <u>result</u><b>,</b> <b>void</b> <b>*</b><u>auditdata</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Direct use of  these  functions  is  generally  discouraged  in  favor  of  the  higher  level  interface
       <b><a href="../man3/selinux_check_access.3.html">selinux_check_access</a>(3)</b>  since  the  latter  automatically  handles  the  dynamic  mapping  of  class and
       permission names to their policy values and proper handling of allow_unknown.

       When using any of the functions that take policy integer values for classes or permissions as inputs, use
       <b><a href="../man3/string_to_security_class.3.html">string_to_security_class</a>(3)</b> and <b><a href="../man3/string_to_av_perm.3.html">string_to_av_perm</a>(3)</b> to map the  class  and  permission  names  to  their
       policy  values.   These  values may change across a policy reload, so they should be re-acquired on every
       use or using a <b>SELINUX_CB_POLICYLOAD</b> callback set via <b><a href="../man3/selinux_set_callback.3.html">selinux_set_callback</a>(3).</b>

       An alternative approach is to use <b><a href="../man3/selinux_set_mapping.3.html">selinux_set_mapping</a>(3)</b> to create a mapping from  class  and  permission
       index  values  used by the application to the policy values, thereby allowing the application to pass its
       own fixed constants for the classes and permissions to these functions and  internally  mapping  them  on
       demand.  However, this also requires setting up a callback as above to address policy reloads.

       <b>avc_entry_ref_init</b>()  initializes  an <b>avc_entry_ref</b> structure; see <b>ENTRY</b> <b>REFERENCES</b> below.  This function
       may be implemented as a macro.

       <b>avc_has_perm</b>() checks whether the <u>requested</u> permissions are granted for subject SID <u>ssid</u> and  target  SID
       <u>tsid</u>,  interpreting  the permissions based on <u>tclass</u> and updating <u>aeref</u>, if non-NULL, to refer to a cache
       entry with the resulting decision.  The granting or denial of permissions is audited in  accordance  with
       the policy.  The <u>auditdata</u> parameter is for supplemental auditing; see <b>avc_audit</b>() below.

       <b>avc_has_perm_noaudit</b>() behaves as <b>avc_has_perm</b>() without producing an audit message.  The access decision
       is returned in <u>avd</u> and can be passed to <b>avc_audit</b>() explicitly.

       <b>avc_audit</b>()  produces  an  audit  message  for  the  access  query represented by <u>ssid</u>, <u>tsid</u>, <u>tclass</u>, and
       <u>requested</u>, with a decision represented by <u>avd</u>.  Pass the  value  returned  by  <b>avc_has_perm_noaudit</b>()  as
       <u>result</u>.   The  <u>auditdata</u>  parameter is passed to the user-supplied <b>func_audit</b> callback and can be used to
       add supplemental information to the audit message; see <b><a href="../man3/avc_init.3.html">avc_init</a></b>(3).

</pre><h4><b>ENTRY</b> <b>REFERENCES</b></h4><pre>
       Entry references can be used to speed cache performance for repeated queries  on  the  same  subject  and
       target.   The  userspace  AVC will check the <u>aeref</u> argument, if supplied, before searching the cache on a
       permission query.  After a query is performed, <u>aeref</u> will be updated to reference  the  cache  entry  for
       that  query.   A  subsequent  query  on  the  same subject and target will then have the decision at hand
       without having to walk the cache.

       After declaring an <b>avc_entry_ref</b> structure, use <b>avc_entry_ref_init</b>() to initialize it before  passing  it
       to  <b>avc_has_perm</b>()  or  <b>avc_has_perm_noaudit</b>() for the first time.  Using an uninitialized structure will
       produce undefined behavior.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       If requested permissions are granted, zero is returned.  If requested permissions are denied or an  error
       occurred, -1 is returned and <u>errno</u> is set appropriately.

       In  permissive  mode,  zero  will  be  returned  and  <u>errno</u>  unchanged  even  if permissions were denied.
       <b>avc_has_perm</b>() will still produce an audit message in this case.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EACCES</b> A requested permission was denied.

       <b>EINVAL</b> The <u>tclass</u> and/or the security contexts referenced by <u>ssid</u> and <u>tsid</u>  are  not  recognized  by  the
              currently loaded policy.

       <b>ENOMEM</b> An attempt to allocate memory failed.

</pre><h4><b>NOTES</b></h4><pre>
       Internal  errors  encountered  by  the  userspace  AVC  may  cause certain values of <u>errno</u> to be returned
       unexpectedly.  For example, netlink socket errors may produce <b>EACCES</b> or <b>EINVAL</b>.  Make sure that userspace
       object managers are granted appropriate access to netlink by the policy.

</pre><h4><b>AUTHOR</b></h4><pre>
       Originally Eamon Walsh.  Updated by Stephen Smalley &lt;<a href="mailto:stephen.smalley.work@gmail.com">stephen.smalley.work@gmail.com</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/selinux_check_access.3.html">selinux_check_access</a>(3),</b> <b><a href="../man3/string_to_security_class.3.html">string_to_security_class</a>(3),</b> <b><a href="../man3/string_to_av_perm.3.html">string_to_av_perm</a>(3),</b> <b><a href="../man3/selinux_set_callback.3.html">selinux_set_callback</a>(3),</b>
       <b><a href="../man3/selinux_set_mapping.3.html">selinux_set_mapping</a>(3),</b> <b><a href="../man3/avc_init.3.html">avc_init</a></b>(3), <b><a href="../man3/avc_context_to_sid.3.html">avc_context_to_sid</a></b>(3), <b><a href="../man3/avc_cache_stats.3.html">avc_cache_stats</a></b>(3), <b><a href="../man3/avc_add_callback.3.html">avc_add_callback</a></b>(3),
       <b><a href="../man3/security_compute_av.3.html">security_compute_av</a></b>(3), <b><a href="../man8/selinux.8.html">selinux</a></b>(8)

                                                   27 May 2004                                   <u><a href="../man3/avc_has_perm.3.html">avc_has_perm</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>