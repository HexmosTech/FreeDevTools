<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>avc_add_callback - additional event notification for SELinux userspace object managers</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libselinux1-dev">libselinux1-dev_3.8.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       avc_add_callback - additional event notification for SELinux userspace object managers

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;selinux/selinux.h&gt;</b>
       <b>#include</b> <b>&lt;selinux/avc.h&gt;</b>

       <b>int</b> <b>avc_add_callback(int</b> <b>(*</b><u>callback</u><b>)(uint32_t</b> <u>event</u><b>,</b>
                                            <b>security_id_t</b> <u>ssid</u><b>,</b>
                                            <b>security_id_t</b> <u>tsid</u><b>,</b>
                                            <b>security_class_t</b> <u>tclass</u><b>,</b>
                                            <b>access_vector_t</b> <u>perms</u><b>,</b>
                                            <b>access_vector_t</b> <b>*</b><u>out_retained</u><b>),</b>
                            <b>uint32_t</b> <u>events</u><b>,</b> <b>security_id_t</b> <u>ssid</u><b>,</b>
                            <b>security_id_t</b> <u>tsid</u><b>,</b> <b>security_class_t</b> <u>tclass</u><b>,</b>
                            <b>access_vector_t</b> <u>perms</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>avc_add_callback</b>()  is  used  to  register  callback  functions  on security events.  The purpose of this
       functionality is to allow userspace object managers to take  additional  action  when  a  policy  change,
       usually a policy reload, causes permissions to be granted or revoked.

       <u>events</u> is the bitwise-<u>or</u> of security events on which to register the callback; see <b>SECURITY</b> <b>EVENTS</b> below.

       <u>ssid</u>, <u>tsid</u>, <u>tclass</u>, and <u>perms</u> specify the source and target SID's, target class, and specific permissions
       that  the  callback  wishes  to  monitor.   The special symbol <b>SECSID_WILD</b> may be passed as the <u>source</u> or
       <u>target</u> and will cause any SID to match.

       <u>callback</u> is the callback function provided by the userspace object manager.  The <u>event</u> argument indicates
       the security event which occurred; the remaining arguments are interpreted  according  to  the  event  as
       described  below.  The return value of the callback should be zero on success, -1 on error with <u>errno</u> set
       appropriately (but see <b>RETURN</b> <b>VALUE</b> below).

</pre><h4><b>SECURITY</b> <b>EVENTS</b></h4><pre>
       In all cases below, <u>ssid</u> and/or <u>tsid</u> may be set to <b>SECSID_WILD</b>, indicating that the change applies to all
       source and/or target SID's.  Unless otherwise indicated, the <u>out_retained</u> parameter is unused.

       <b>AVC_CALLBACK_GRANT</b>
              Previously denied permissions are now granted for  <u>ssid</u>,  <u>tsid</u>  with  respect  to  <u>tclass</u>.   <u>perms</u>
              indicates the permissions to grant.

       <b>AVC_CALLBACK_TRY_REVOKE</b>
              Previously  granted  permissions  are  now  conditionally  revoked  for <u>ssid</u>, <u>tsid</u> with respect to
              <u>tclass</u>.  <u>perms</u> indicates the permissions to revoke.  The callback should set <u>out_retained</u>  to  the
              subset  of <u>perms</u> which are retained as migrated permissions.  Note that <u>out_retained</u> is ignored if
              the callback returns -1.

       <b>AVC_CALLBACK_REVOKE</b>
              Previously granted permissions are now unconditionally revoked for  <u>ssid</u>,  <u>tsid</u>  with  respect  to
              <u>tclass</u>.  <u>perms</u> indicates the permissions to revoke.

       <b>AVC_CALLBACK_RESET</b>
              Indicates that the cache was flushed.  The SID, class, and permission arguments are unused and are
              set to NULL.

       <b>AVC_CALLBACK_AUDITALLOW_ENABLE</b>
              The  permissions  given by <u>perms</u> should now be audited when granted for <u>ssid</u>, <u>tsid</u> with respect to
              <u>tclass</u>.

       <b>AVC_CALLBACK_AUDITALLOW_DISABLE</b>
              The permissions given by <u>perms</u> should no longer be  audited  when  granted  for  <u>ssid</u>,  <u>tsid</u>  with
              respect to <u>tclass</u>.

       <b>AVC_CALLBACK_AUDITDENY_ENABLE</b>
              The  permissions  given  by <u>perms</u> should now be audited when denied for <u>ssid</u>, <u>tsid</u> with respect to
              <u>tclass</u>.

       <b>AVC_CALLBACK_AUDITDENY_DISABLE</b>
              The permissions given by <u>perms</u> should no longer be audited when denied for <u>ssid</u>, <u>tsid</u> with respect
              to <u>tclass</u>.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>avc_add_callback</b>() returns zero.  On error, -1 is returned and <u>errno</u> is set appropriately.

       A return value of -1 from a callback is interpreted as a failed policy operation.  If such a return value
       is encountered, all remaining callbacks registered on the  event  are  called.   In  threaded  mode,  the
       netlink  handler  thread  may  then terminate and cause the userspace AVC to return <b>EINVAL</b> on all further
       permission checks until <b><a href="../man3/avc_destroy.3.html">avc_destroy</a></b>(3) is called.  In non-threaded mode, the permission  check  on  which
       the error occurred will return -1 and the value of <u>errno</u> encountered to the caller.  In both cases, a log
       message is produced and the kernel may be notified of the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>ENOMEM</b> An attempt to allocate memory failed.

</pre><h4><b>NOTES</b></h4><pre>
       If  the  userspace  AVC  is  running in threaded mode, callbacks registered via <b>avc_add_callback</b>() may be
       executed in the context of the netlink handler thread.  This will likely introduce synchronization issues
       requiring the use of locks.  See <b><a href="../man3/avc_init.3.html">avc_init</a></b>(3).

       Support for dynamic revocation and retained permissions is mostly unimplemented  in  the  SELinux  kernel
       module.  The only security event that currently gets exercised is <b>AVC_CALLBACK_RESET</b>.

</pre><h4><b>AUTHOR</b></h4><pre>
       Eamon Walsh &lt;<a href="mailto:ewalsh@tycho.nsa.gov">ewalsh@tycho.nsa.gov</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/avc_init.3.html">avc_init</a></b>(3), <b><a href="../man3/avc_has_perm.3.html">avc_has_perm</a></b>(3), <b><a href="../man3/avc_context_to_sid.3.html">avc_context_to_sid</a></b>(3), <b><a href="../man3/avc_cache_stats.3.html">avc_cache_stats</a></b>(3), <b><a href="../man3/security_compute_av.3.html">security_compute_av</a></b>(3)
       <b><a href="../man8/selinux.8.html">selinux</a></b>(8)

                                                   9 June 2004                               <u><a href="../man3/avc_add_callback.3.html">avc_add_callback</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>