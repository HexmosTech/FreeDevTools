<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mtbl_merger - merge multiple MTBL data sources into a single output</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmtbl-dev">libmtbl-dev_1.6.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mtbl_merger - merge multiple MTBL data sources into a single output

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;mtbl.h&gt;</b>

       Merger objects:

       <b>struct</b> <b>mtbl_merger</b> <b>*</b>
       <b>mtbl_merger_init(const</b> <b>struct</b> <b>mtbl_merger_options</b> <b>*</b><u>mopt</u><b>);</b>

       <b>void</b>
       <b>mtbl_merger_destroy(struct</b> <b>mtbl_merger</b> <b>**</b><u>m</u><b>);</b>

       <b>void</b>
       <b>mtbl_merger_add_source(struct</b> <b>mtbl_merger</b> <b>*</b><u>m</u><b>,</b> <b>const</b> <b>struct</b> <b>mtbl_source</b> <b>*</b><u>s</u><b>);</b>

       <b>const</b> <b>struct</b> <b>mtbl_source</b> <b>*</b>
       <b>mtbl_merger_source(struct</b> <b>mtbl_merger</b> <b>*</b><u>m</u><b>);</b>

       Merger options:

       <b>struct</b> <b>mtbl_merger_options</b> <b>*</b>
       <b>mtbl_merger_options_init(void);</b>

       <b>void</b>
       <b>mtbl_merger_options_destroy(struct</b> <b>mtbl_merger_options</b> <b>**</b><u>mopt</u><b>);</b>

       <b>void</b>
       <b>mtbl_merger_options_set_merge_func(</b>
               <b>struct</b> <b>mtbl_merger_options</b> <b>*</b><u>mopt</u><b>,</b>
               <b>mtbl_merge_func</b> <u>fp</u><b>,</b>
               <b>void</b> <b>*</b><u>clos</u><b>);</b>

       <b>void</b>
       <b>mtbl_merger_options_set_dupsort_func(</b>
               <b>struct</b> <b>mtbl_merger_options</b> <b>*</b><u>mopt</u><b>,</b>
               <b>mtbl_dupsort_func</b> <u>fp</u><b>,</b>
               <b>void</b> <b>*</b><u>clos</u><b>);</b>

       <b>typedef</b> <b>void</b>
       <b>(*mtbl_merge_func)(void</b> <b>*</b><u>clos</u><b>,</b>
               <b>const</b> <b>uint8_t</b> <b>*</b><u>key</u><b>,</b> <b>size_t</b> <u>len_key</u><b>,</b>
               <b>const</b> <b>uint8_t</b> <b>*</b><u>val0</u><b>,</b> <b>size_t</b> <u>len_val0</u><b>,</b>
               <b>const</b> <b>uint8_t</b> <b>*</b><u>val1</u><b>,</b> <b>size_t</b> <u>len_val1</u><b>,</b>
               <b>uint8_t</b> <b>**</b><u>merged_val</u><b>,</b> <b>size_t</b> <b>*</b><u>len_merged_val</u><b>);</b>

       <b>typedef</b> <b>int</b>
       <b>(*mtbl_dupsort_func)(void</b> <b>*</b><u>clos</u><b>,</b>
               <b>const</b> <b>uint8_t</b> <b>*</b><u>key</u><b>,</b> <b>size_t</b> <u>len_key</u><b>,</b>
               <b>const</b> <b>uint8_t</b> <b>*</b><u>val0</u><b>,</b> <b>size_t</b> <u>len_val0</u><b>,</b>
               <b>const</b> <b>uint8_t</b> <b>*</b><u>val1</u><b>,</b> <b>size_t</b> <b>'len_val1);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Multiple MTBL data sources may be merged together using the <b>mtbl_merger</b> interface, which reads key-value
       entries from one or more sources and provides these entries in sorted order. The sorted entries may be
       consumed via the <b><a href="../man3/mtbl_source.3.html">mtbl_source</a></b>(3) and <b><a href="../man3/mtbl_iter.3.html">mtbl_iter</a></b>(3) interfaces.

       Because the MTBL format does not allow duplicate keys, the caller must provide a function which will
       accept a key and two conflicting values for that key and return a replacement value. This function may be
       called multiple times for the same key if more than two sources are being merged.

       <b>mtbl_merger</b> objects are created with the <b>mtbl_merger_init</b>() function, which requires a non-NULL <u>mopt</u>
       argument which has been configured with a merge function <u>fp</u>.

       One or more <b>mtbl_reader</b> objects must be provided as input to the <b>mtbl_merger</b> object by calling
       <b>mtbl_merger_add_source</b>(). After the desired sources have been configured, <b>mtbl_merger_source</b>() should be
       called in order to consume the merged output via the <b><a href="../man3/mtbl_source.3.html">mtbl_source</a></b>(3) interface.

   <b>Merger</b> <b>options</b>
       <b>merge_func</b>

           This option specifies a merge function callback, consisting of a function pointer <u>fp</u> and a pointer to
           user data <u>clos</u> which will be passed as the first argument to <u>fp</u>. The merge function callback will be
           used during iteration over the <b>mtbl_merger</b> object to merge entries with duplicate keys in the input
           sources.

           The remaining arguments to the merge function are:

           <u>key</u> — pointer to the key for which there exist duplicate values.

           <u>len_key</u> — length of the key.

           <u>val0</u> — pointer to the first value.

           <u>len_val_0</u> — length of the first value.

           <u>val1</u> — pointer to the second value.

           <u>len_val_1</u> — length of the second value.

           <u>merged_val</u> — pointer to where the callee should place its merged value.

           <u>len_merged_val</u> — pointer to where the callee should place the length of its merged value.

           <u>merged_val</u> must be allocated with the system allocator, and the <b>mtbl_merger</b> interface takes
           responsibility for free()ing the value once it is no longer needed.

           The callee may provide an empty value as the merged value, in which case <u>merged_val</u> must still
           contain an allocated, non-NULL value and <u>len_merged_val</u> must contain the value 0.

           The callee may indicate an error by returning NULL in the <u>merged_val</u> argument, which will abort
           iteration over the <b>mtbl_merger</b> object.

       <b>dupsort_func</b>

           This option provides a comparison function for multiple data with the same key. It will be used to
           sort the data during the merge process. If the <b>merge_func</b> option is set to or left NULL, the
           <b>dupsort_func</b> will order the results returned by the merge process for data with identical keys.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       If the merge function callback is unable to provide a merged value (that is, it fails to return a
       non-NULL value in its <u>merged_val</u> argument), the merge process will be aborted, and any iterators over the
       <b>mtbl_merger</b> object (via the <b><a href="../man3/mtbl_source.3.html">mtbl_source</a></b>(3) interface) will return <b>mtbl_res_failure</b>.

                                                   03/28/2019                                     <u><a href="../man3/MTBL_MERGER.3.html">MTBL_MERGER</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>