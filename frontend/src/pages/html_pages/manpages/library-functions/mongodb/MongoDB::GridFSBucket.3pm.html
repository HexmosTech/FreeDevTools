<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB::GridFSBucket - A file storage abstraction</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmongodb-perl">libmongodb-perl_2.2.2-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       MongoDB::GridFSBucket - A file storage abstraction

</pre><h4><b>VERSION</b></h4><pre>
       version v2.2.2

</pre><h4><b>SYNOPSIS</b></h4><pre>
           $bucket = $database-&gt;gfs;

           # upload a file
           $stream  = $bucket-&gt;open_upload_stream("foo.txt");
           $stream-&gt;print( $data );
           $stream-&gt;close;

           # find and download a file
           $result  = $bucket-&gt;find({filename =&gt; "foo.txt"});
           $file_id = $result-&gt;next-&gt;{_id};
           $stream  = $bucket-&gt;open_download_stream($file_id)
           $data    = do { local $/; $stream-&gt;readline() };

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This class models a GridFS file store in a MongoDB database and provides an API for interacting with it.

       Generally, you never construct one of these directly with "new".  Instead, you call "gfs" (short for
       "get_gridfsbucket") on a MongoDB::Database object.

</pre><h4><b>USAGE</b></h4><pre>
   <b>Data</b> <b>model</b>
       A GridFS file is represented in MongoDB as a "file document" with information like the file's name,
       length, and any user-supplied metadata.  The actual contents are stored as a number of "chunks" of binary
       data.  (Think of the file document as a directory entry and the chunks like blocks on disk.)

       Valid file documents typically include the following fields:

       •   _id – a unique ID for this document, typically a BSON ObjectId.

       •   length – the length of this stored file, in bytes

       •   chunkSize  – the size, in bytes, of each full data chunk of this file. This value is configurable per
           file.

       •   uploadDate – the date and time this file was added to GridFS, stored as a BSON datetime value.

       •   filename – the name of this stored file; the combination  of  filename  and  uploadDate  (millisecond
           resolution) must be unique

       •   metadata – any additional application data the user wishes to store (optional)

       •   md5  – DEPRECATED a hash of the contents of the stored file (store this in "metadata" if you need it)
           (optional)

       •   contentType – DEPRECATED (store this in "metadata" if you need it) (optional)

       •   aliases – DEPRECATED (store this in "metadata" if you need it) (optional)

       The "find" method searches file documents using these fields.  Given the "_id" from a  document,  a  file
       can be downloaded using the download methods.

   <b>API</b> <b>Overview</b>
       In addition to general methods like "find", "delete" and "drop", there are two ways to go about uploading
       and downloading:

       •   filehandle-like:  you  get  an  object that you can read/write from similar to a filehandle.  You can
           even get a tied filehandle that you can hand off to other code that requires an actual Perl handle.

       •   streaming: you provide a file handle to read from  (upload)  or  print  to  (download)  and  data  is
           streamed to (upload) or from (download) GridFS until EOF.

   <b>Error</b> <b>handling</b>
       Unless otherwise explicitly documented, all methods throw exceptions if an error occurs.  The error types
       are documented in MongoDB::Error.

</pre><h4><b>ATTRIBUTES</b></h4><pre>
   <b>database</b>
       The MongoDB::Database containing the GridFS bucket collections.

   <b>bucket_name</b>
       The  name of the GridFS bucket.  Defaults to 'fs'.  The underlying collections that are used to implement
       a GridFS bucket get this string as a prefix (e.g "fs.chunks").

   <b>chunk_size_bytes</b>
       The number of bytes per chunk.  Defaults to 261120 (255kb).

   <b>write_concern</b>
       A MongoDB::WriteConcern object.  It may be initialized with a hash reference that will be coerced into  a
       new MongoDB::WriteConcern object.  By default it will be inherited from a MongoDB::Database object.

   <b>read_concern</b>
       A MongoDB::ReadConcern object.  May be initialized with a hash reference or a string that will be coerced
       into the level of read concern.

       By default it will be inherited from a MongoDB::Database object.

   <b>read_preference</b>
       A  MongoDB::ReadPreference object.  It may be initialized with a string corresponding to one of the valid
       read preference modes or a hash reference that will be coerced into a new MongoDB::ReadPreference object.
       By default it will be inherited from a MongoDB::Database object.

       <b>Note:</b> Because many GridFS operations require multiple independent reads from  separate  collections,  use
       with  secondaries  is  <b>strongly</b> <b>discouraged</b> because reads could go to different secondaries, resulting in
       inconsistent data if all file and chunk documents have not replicated to all secondaries.

   <b>bson_codec</b>
       An object that provides the "encode_one" and  "decode_one"  methods,  such  as  from  BSON.   It  may  be
       initialized  with  a  hash  reference that will be coerced into a new BSON object.  By default it will be
       inherited from a MongoDB::Database object.

   <b>max_time_ms</b>
       Specifies the maximum amount of time in milliseconds that the server should use for working on  a  query.
       By default it will be inherited from a MongoDB::Database object.

       <b>Note</b>:  this  will  only be used for server versions 2.6 or greater, as that was when the $maxTimeMS meta-
       operator was introduced.

   <b>disable_md5</b>
       When true, files will not include the deprecated "md5" field in the file document.  Defaults to false.

</pre><h4><b>METHODS</b></h4><pre>
   <b>find</b>
           $result = $bucket-&gt;find($filter);
           $result = $bucket-&gt;find($filter, $options);

           $file_doc = $result-&gt;next;

       Executes  a  query  on  the  file  documents  collection  with  a  filter  expression   and   returns   a
       MongoDB::QueryResult   object.   It  takes  an  optional  hashref  of  options  identical  to  "find"  in
       MongoDB::Collection.

   <b>find_one</b>
           $file_doc = $bucket-&gt;find_one($filter, $projection);
           $file_doc = $bucket-&gt;find_one($filter, $projection, $options);

       Executes a query on the file documents collection with a filter expression and returns the first document
       found, or "undef" if no document is found.

       See "find_one" in MongoDB::Collection for details about the $projection and optional $options fields.

   <b>find_id</b>
           $file_doc = $bucket-&gt;find_id( $id );
           $file_doc = $bucket-&gt;find_id( $id, $projection );
           $file_doc = $bucket-&gt;find_id( $id, $projection, $options );

       Executes a query with a filter expression of "{ _id =&gt; $id }" and returns a single document or "undef" if
       no document is found.

       See "find_one" in MongoDB::Collection for details about the $projection and optional $options fields.

   <b>open_download_stream</b>
           $stream = $bucket-&gt;open_download_stream($id);
           $line = $stream-&gt;readline;

       Returns a new MongoDB::GridFSBucket::DownloadStream that can be used to download the file with  the  file
       document "_id" matching $id.  This throws a MongoDB::GridFSError if no such file exists.

   <b>open_upload_stream</b>
           $stream = $bucket-&gt;open_upload_stream($filename);
           $stream = $bucket-&gt;open_upload_stream($filename, $options);

           $stream-&gt;print('data');
           $stream-&gt;close;
           $file_id = $stream-&gt;id

       Returns  a  new  MongoDB::GridFSBucket::UploadStream  that  can  be used to upload a new file to a GridFS
       bucket.

       This method requires a filename to store in the  "filename"  field  of  the  file  document.   <b>Note</b>:  the
       filename is an arbitrary string; the method does not read from this filename locally.

       You    can    provide    an   optional   hash   reference   of   options   that   are   passed   to   the
       MongoDB::GridFSBucket::UploadStream constructor:

       •   "chunk_size_bytes" – the number of bytes per chunk.  Defaults to the "chunk_size_bytes" of the bucket
           object.

       •   "metadata" – a hash reference for storing arbitrary metadata about the file.

   <b>open_upload_stream_with_id</b>
           $stream = $bucket-&gt;open_upload_stream_with_id($id, $filename);
           $stream = $bucket-&gt;open_upload_stream_with_id($id, $filename, $options);

           $stream-&gt;print('data');
           $stream-&gt;close;

       Returns a new MongoDB::GridFSBucket::UploadStream that can be used to upload  a  new  file  to  a  GridFS
       bucket.

       This method uses $id as the _id of the file being created, which must be unique.

       This  method  requires  a  filename  to  store  in  the "filename" field of the file document.  <b>Note</b>: the
       filename is an arbitrary string; the method does not read from this filename locally.

       You can provide an optional hash reference of options, just like "open_upload_stream".

   <b>download_to_stream</b>
           $bucket-&gt;download_to_stream($id, $out_fh);

       Downloads  the  file  matching  $id  and  writes  it  to  the  file  handle  $out_fh.   This   throws   a
       MongoDB::GridFSError if no such file exists.

   <b>upload_from_stream</b>
           $file_id = $bucket-&gt;upload_from_stream($filename, $in_fh);
           $file_id = $bucket-&gt;upload_from_stream($filename, $in_fh, $options);

       Reads  from  a  filehandle  and uploads its contents to GridFS.  It returns the "_id" field stored in the
       file document.

       This method requires a filename to store in the  "filename"  field  of  the  file  document.   <b>Note</b>:  the
       filename is an arbitrary string; the method does not read from this filename locally.

       You can provide an optional hash reference of options, just like "open_upload_stream".

   <b>upload_from_stream_with_id</b>
           $bucket-&gt;upload_from_stream_with_id($id, $filename, $in_fh);
           $bucket-&gt;upload_from_stream_with_id($id, $filename, $in_fh, $options);

       Reads from a filehandle and uploads its contents to GridFS.

       This method uses $id as the _id of the file being created, which must be unique.

       This  method  requires  a  filename  to  store  in  the "filename" field of the file document.  <b>Note</b>: the
       filename is an arbitrary string; the method does not read from this filename locally.

       You can provide an optional hash reference of options, just like "open_upload_stream".

       Unlike "open_upload_stream", this method returns nothing.

   <b>delete</b>
           $bucket-&gt;delete($id);

       Deletes the file matching $id from the bucket.  This  throws  a  MongoDB::GridFSError  if  no  such  file
       exists.

   <b>drop</b>
           $bucket-&gt;drop;

       Drops the underlying files documents and chunks collections for this bucket.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Core documentation on GridFS: &lt;<a href="http://dochub.mongodb.org/core/gridfs">http://dochub.mongodb.org/core/gridfs</a>&gt;.

</pre><h4><b>AUTHORS</b></h4><pre>
       •   David Golden &lt;<a href="mailto:david@mongodb.com">david@mongodb.com</a>&gt;

       •   Rassi &lt;<a href="mailto:rassi@mongodb.com">rassi@mongodb.com</a>&gt;

       •   Mike Friedman &lt;<a href="mailto:friedo@friedo.com">friedo@friedo.com</a>&gt;

       •   Kristina Chodorow &lt;<a href="mailto:k.chodorow@gmail.com">k.chodorow@gmail.com</a>&gt;

       •   Florian Ragwitz &lt;<a href="mailto:rafl@debian.org">rafl@debian.org</a>&gt;

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       This software is Copyright (c) 2020 by MongoDB, Inc.

       This is free software, licensed under:

         The Apache License, Version 2.0, January 2004

perl v5.40.1                                       2025-04-03                         <u>MongoDB::<a href="../man3pm/GridFSBucket.3pm.html">GridFSBucket</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>