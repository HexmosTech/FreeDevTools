<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catmandu::Store::MongoDB - A searchable store backed by MongoDB</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcatmandu-store-mongodb-perl">libcatmandu-store-mongodb-perl_0.0806-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Catmandu::Store::MongoDB - A searchable store backed by MongoDB

</pre><h4><b>SYNOPSIS</b></h4><pre>
           # On the command line
           $ catmandu import -v JSON --multiline 1 to MongoDB --database_name bibliography --bag books &lt; books.json
           $ catmandu export MongoDB --database_name bibliography --bag books to YAML
           $ catmandu count MongoDB --database_name bibliography --bag books --query '{"PublicationYear": "1937"}'
           $ catmandu count MongoDB --database_name bibliography --bag books --query '{"Author": "Jones"}' --sort '{"PublicationYear":1}'

           # In perl
           use Catmandu::Store::MongoDB;

           my $store = Catmandu::Store::MongoDB-&gt;new(database_name =&gt; 'test');

           my $obj1 = $store-&gt;bag-&gt;add({ name =&gt; 'Patrick' });

           printf "obj1 stored as %s\n" , $obj1-&gt;{_id};

           # Force an id in the store
           my $obj2 = $store-&gt;bag-&gt;add({ _id =&gt; 'test123' , name =&gt; 'Nicolas' });

           my $obj3 = $store-&gt;bag-&gt;get('test123');

           $store-&gt;bag-&gt;delete('test123');

           $store-&gt;bag-&gt;delete_all;

           # All bags are iterators
           $store-&gt;bag-&gt;each(sub { ... });
           $store-&gt;bag-&gt;<a href="../man10/take.10.html">take</a>(10)-&gt;each(sub { ... });

           # Search
           my $hits = $store-&gt;bag-&gt;search(query =&gt; '{"name":"Patrick"}');
           my $hits = $store-&gt;bag-&gt;search(query =&gt; '{"name":"Patrick"}' , sort =&gt; { age =&gt; -1} );
           my $hits = $store-&gt;bag-&gt;search(query =&gt; {name =&gt; "Patrick"} , start =&gt; 0 , limit =&gt; 100);
           my $hits = $store-&gt;bag-&gt;search(query =&gt; {name =&gt; "Patrick"} , fields =&gt; {_id =&gt; 0, name =&gt; 1});

           my $next_page = $hits-&gt;next_page;
           my $hits = $store-&gt;bag-&gt;search(query =&gt; '{"name":"Patrick"}' , page =&gt; $next_page);

           my $iterator = $store-&gt;bag-&gt;searcher(query =&gt; {name =&gt; "Patrick"});
           my $iterator = $store-&gt;bag-&gt;searcher(query =&gt; {name =&gt; "Patrick"}, fields =&gt; {_id =&gt; 0, name =&gt; 1});

           # Catmandu::Store::MongoDB supports CQL...
           my $hits = $store-&gt;bag-&gt;search(cql_query =&gt; 'name any "Patrick"');

</pre><h4><b>DESCRIPTION</b></h4><pre>
       A Catmandu::Store::MongoDB is a Perl package that can store data into MongoDB databases. The database as
       a whole is called a 'store'.  Databases also have compartments (e.g. tables) called Catmandu::Bag-s.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       database_name
           MongoDB database name.

       estimate_count
           Use a faster estimated collection document count if true.

       All other options are passed on to the MongoDB client.

</pre><h4><b>METHODS</b></h4><pre>
   <b>new(database_name</b> <b>=&gt;</b> <b>$name,</b> <b>%connection_opts)</b>
   <b>new(database_name</b> <b>=&gt;</b> <b>$name</b> <b>,</b> <b>bags</b> <b>=&gt;</b> <b>{</b> <b>data</b> <b>=&gt;</b> <b>{</b> <b>cql_mapping</b> <b>=&gt;</b> <b>$cql_mapping</b> <b>}</b> <b>})</b>
       Create  a  new  Catmandu::Store::MongoDB  store with name $name. Optionally provide connection parameters
       (see MongoDB::MongoClient for possible options).

       The store supports CQL searches when a cql_mapping is provided. This hash contains a translation  of  CQL
       fields into MongoDB searchable fields.

        # Example mapping
        $cql_mapping = {
            indexes =&gt; {
                 title =&gt; {
                   op =&gt; {
                     'any'   =&gt; 1 ,
                     'all'   =&gt; 1 ,
                     '='     =&gt; 1 ,
                     '&lt;&gt;'    =&gt; 1 ,
                     'exact' =&gt; {field =&gt; [qw(mytitle.exact myalttitle.exact)]}
                   } ,
                   sort  =&gt; 1,
                   field =&gt; 'mytitle',
                   cb    =&gt; ['Biblio::Search', 'normalize_title']
                 }
           }
        }

       The CQL mapping above will support for the 'title' field the CQL operators:
        any, all, =, &lt;&gt; and exact.

       The  'title'  field  will be mapped into the MongoDB field 'mytitle', except for the 'exact' operator. In
       case of 'exact' both the 'mytitle.exact' and 'myalttitle.exact' fields will be searched.

       The CQL mapping allows for sorting on the 'title' field. If, for instance, we would like to use a special
       MongoDB field for sorting we could have written "sort =&gt; { field =&gt; 'mytitle.sort' }".

       The CQL has an optional callback field 'cb' which contains a  reference  to  subroutines  to  rewrite  or
       augment  the  search  query.  In  this  case,  in  the  Biblio::Search package contains a normalize_title
       subroutine which returns a string or an ARRAY of string with augmented title(s). E.g.

           package Biblio::Search;

           sub normalize_title {
              my ($self,$title) = @_;
              # delete all bad characters
              my $new_title =~ s{[^A-Z0-9]+}{}g;
              $new_title;
           }

           1;

   <b>bag($name)</b>
       Create or retieve a bag with name $name. Returns a Catmandu::Bag.

   <b>client</b>
       Return the MongoDB::MongoClient instance.

   <b>database</b>
       Return a MongoDB::Database instance.

   <b>drop</b>
       Delete the store and all it's bags.

   <b>transaction(\&amp;sub)</b>
       Execute $sub within a transaction. See Catmandu::Transactional.

       Note that only MongoDB databases with feature compatibility &gt;= 4.0 and in a replica set have support  for
       transactions.                                                                                         See
       &lt;https://docs.mongodb.com/manual/reference/command/setFeatureCompatibilityVersion/#view-fcv&gt;          and
       &lt;https://docs.mongodb.com/manual/tutorial/convert-standalone-to-replica-set/&gt; for more info.

</pre><h4><b>Search</b></h4><pre>
       Search  the  database:  see  Catmandu::Searchable  and   Catmandu::CQLSearchable. This module supports an
       additional search parameter:

           - fields =&gt; { &lt;field&gt; =&gt; &lt;0|1&gt; } : limit fields to return from a query (see L&lt;MongoDB Tutorial|https://docs.mongodb.org/manual/tutorial/project-fields-from-query-results/&gt;)

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Catmandu::Bag,       Catmandu::CQLSearchable,        Catmandu::Droppable,        Catmandu::Transactional,
       MongoDB::MongoClient

</pre><h4><b>AUTHOR</b></h4><pre>
       Nicolas Steenlant, "&lt;nicolas.steenlant at ugent.be&gt;"

</pre><h4><b>CONTRIBUTORS</b></h4><pre>
       Johann Rolschewski, "&lt;jorol at cpan.org&gt;"

</pre><h4><b>LICENSE</b> <b>AND</b> <b>COPYRIGHT</b></h4><pre>
       This  program  is  free software; you can redistribute it and/or modify it under the terms of either: the
       GNU General Public License as published by the Free Software Foundation; or the Artistic License.

       See <a href="http://dev.perl.org/licenses/">http://dev.perl.org/licenses/</a> for more information.

perl v5.32.1                                       2021-09-02                      <u>Catmandu::Store::<a href="../man3pm/MongoDB.3pm.html">MongoDB</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>