<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hwlocality_shmem - Sharing topologies between processes</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libhwloc-doc">libhwloc-doc_2.12.0-4build1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       hwlocality_shmem - Sharing topologies between processes

</pre><h4><b>SYNOPSIS</b></h4><pre>
   <b>Functions</b>
       int <b>hwloc_shmem_topology_get_length</b> (<b>hwloc_topology_t</b> topology, size_t *lengthp, unsigned long flags)
       int <b>hwloc_shmem_topology_write</b> (<b>hwloc_topology_t</b> topology, int fd, hwloc_uint64_t fileoffset, void
           *mmap_address, size_t length, unsigned long flags)
       int <b>hwloc_shmem_topology_adopt</b> (<b>hwloc_topology_t</b> *topologyp, int fd, hwloc_uint64_t fileoffset, void
           *mmap_address, size_t length, unsigned long flags)

</pre><h4><b>Detailed</b> <b>Description</b></h4><pre>
       These functions are used to share a topology between processes by duplicating it into a file-backed
       shared-memory buffer.

       The master process must first get the required shared-memory size for storing this topology with
       <b>hwloc_shmem_topology_get_length()</b>.

       Then it must find a virtual memory area of that size that is available in all processes (identical
       virtual addresses in all processes). On Linux, this can be done by comparing holes found in
       <a href="file:/proc/">/proc/</a>&lt;pid&gt;/maps for each process.

       Once found, it must open a destination file for storing the buffer, and pass it to
       <b>hwloc_shmem_topology_write()</b> together with virtual memory address and length obtained above.

       Other processes may then adopt this shared topology by opening the same file and passing it to
       <b>hwloc_shmem_topology_adopt()</b> with the exact same virtual memory address and length.

</pre><h4><b>Function</b> <b>Documentation</b></h4><pre>
   <b>int</b> <b>hwloc_shmem_topology_adopt</b> <b>(hwloc_topology_t</b> <b>*</b> <b>topologyp,</b> <b>int</b> <b>fd,</b> <b>hwloc_uint64_t</b> <b>fileoffset,</b> <b>void</b> <b>*</b>
       <b>mmap_address,</b> <b>size_t</b> <b>length,</b> <b>unsigned</b> <b>long</b> <b>flags)</b>
       Adopt a shared memory topology stored in a file. Map a file in virtual memory and adopt the topology that
       was previously stored there with <b>hwloc_shmem_topology_write()</b>.

       The returned adopted topology in topologyp can be used just like any topology. And it must be destroyed
       with <b>hwloc_topology_destroy()</b> as usual.

       However the topology is read-only. For instance, it cannot be modified with <b>hwloc_topology_restrict()</b> and
       object userdata pointers cannot be changed.

       The segment of the file pointed by descriptor fd, starting at offset fileoffset, and of length length (in
       bytes), will be mapped at virtual address mmap_address.

       The file pointed by descriptor fd, the offset fileoffset, the requested mapping virtual address
       mmap_address and the length length must be identical to what was given to <b>hwloc_shmem_topology_write()</b>
       earlier.

       <b>Note</b>
           Flags flags are currently unused, must be 0.

           The object userdata pointer should not be used unless the process that created the shared topology
           also placed userdata-pointed buffers in shared memory.

           This function takes care of calling <b>hwloc_topology_abi_check()</b>.

       <b>Returns</b>
           0 on success.

           -1 with errno set to EBUSY if the virtual memory mapping defined by mmap_address and length isn't
           available in the process.

           -1 with errno set to EINVAL if fileoffset, mmap_address or length aren't page-aligned, or do not
           match what was given to <b>hwloc_shmem_topology_write()</b> earlier.

           -1 with errno set to EINVAL if the layout of the topology structure is different between the writer
           process and the adopter process.

   <b>int</b> <b>hwloc_shmem_topology_get_length</b> <b>(hwloc_topology_t</b> <b>topology,</b> <b>size_t</b> <b>*</b> <b>lengthp,</b> <b>unsigned</b> <b>long</b> <b>flags)</b>
       Get the required shared memory length for storing a topology. This length (in bytes) must be used in
       <b>hwloc_shmem_topology_write()</b> and <b>hwloc_shmem_topology_adopt()</b> later.

       <b>Returns</b>
           the length, or -1 on error, for instance if flags are invalid.

       <b>Note</b>
           Flags flags are currently unused, must be 0.

   <b>int</b> <b>hwloc_shmem_topology_write</b> <b>(hwloc_topology_t</b> <b>topology,</b> <b>int</b> <b>fd,</b> <b>hwloc_uint64_t</b> <b>fileoffset,</b> <b>void</b> <b>*</b>
       <b>mmap_address,</b> <b>size_t</b> <b>length,</b> <b>unsigned</b> <b>long</b> <b>flags)</b>
       Duplicate a topology to a shared memory file. Temporarily map a file in virtual memory and duplicate the
       topology topology by allocating duplicates in there.

       The segment of the file pointed by descriptor fd, starting at offset fileoffset, and of length length (in
       bytes), will be temporarily mapped at virtual address mmap_address during the duplication.

       The mapping length length must have been previously obtained with <b>hwloc_shmem_topology_get_length()</b> and
       the topology must not have been modified in the meantime.

       <b>Note</b>
           Flags flags are currently unused, must be 0.

           The object userdata pointer is duplicated but the pointed buffer is not. However the caller may also
           allocate it manually in shared memory to share it as well.

       <b>Returns</b>
           0 on success.

           -1 with errno set to EBUSY if the virtual memory mapping defined by mmap_address and length isn't
           available in the process.

           -1 with errno set to EINVAL if fileoffset, mmap_address or length aren't page-aligned.

</pre><h4><b>Author</b></h4><pre>
       Generated automatically by Doxygen for Hardware Locality (hwloc) from the source code.

Hardware Locality (hwloc)                        Version 2.12.0                              <u><a href="../man3/hwlocality_shmem.3.html">hwlocality_shmem</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>