<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bee - BitTorrent Serialization Format Encoder/Decoder</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/tcllib">tcllib_2.0+dfsg-4_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       bee - BitTorrent Serialization Format Encoder/Decoder

</pre><h4><b>SYNOPSIS</b></h4><pre>
       package require <b>Tcl</b> <b>8.5</b> <b>9</b>

       package require <b>bee</b> <b>?0.3?</b>

       <b>::bee::encodeString</b> <u>string</u>

       <b>::bee::encodeNumber</b> <u>integer</u>

       <b>::bee::encodeListArgs</b> <u>value</u>...

       <b>::bee::encodeList</b> <u>list</u>

       <b>::bee::encodeDictArgs</b> <u>key</u> <u>value</u>...

       <b>::bee::encodeDict</b> <u>dict</u>

       <b>::bee::decode</b> <u>string</u> ?<u>endvar</u>? ?<u>start</u>?

       <b>::bee::decodeIndices</b> <u>string</u> ?<u>endvar</u>? ?<u>start</u>?

       <b>::bee::decodeChannel</b> <u>chan</u> <b>-command</b> <u>cmdprefix</u> ?<b>-exact</b>? ?<b>-prefix</b> <u>data</u>?

       <b>cmdprefix</b> <b>eof</b> <u>token</u>

       <b>cmdprefix</b> <b>error</b> <u>token</u> <u>message</u>

       <b>cmdprefix</b> <b>value</b> <u>token</u> <u>value</u>

       <b>::bee::decodeCancel</b> <u>token</u>

       <b>::bee::decodePush</b> <u>token</u> <u>string</u>

________________________________________________________________________________________________________________

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>bee</b> package provides de- and encoder commands for data in bencoding (speak 'bee'), the serialization
       format for data and messages used by the BitTorrent protocol.

</pre><h4><b>PUBLIC</b> <b>API</b></h4><pre>
   <b>ENCODER</b>
       The package provides one encoder command for each of the basic forms, and two commands per container, one
       taking a proper tcl data structure to encode in the container, the other taking the same  information  as
       several arguments.

       <b>::bee::encodeString</b> <u>string</u>
              Returns the bee-encoding of the <u>string</u>.

       <b>::bee::encodeNumber</b> <u>integer</u>
              Returns the bee-encoding of the <u>integer</u> number.

       <b>::bee::encodeListArgs</b> <u>value</u>...
              Takes zero or more bee-encoded values and returns the bee-encoding of their list.

       <b>::bee::encodeList</b> <u>list</u>
              Takes a list of bee-encoded values and returns the bee-encoding of the list.

       <b>::bee::encodeDictArgs</b> <u>key</u> <u>value</u>...
              Takes  zero  or  more pairs of keys and values and returns the bee-encoding of the dictionary they
              form. The values are expected to be already bee-encoded, but the keys must not be. Their  encoding
              will be done by the command itself.

       <b>::bee::encodeDict</b> <u>dict</u>
              Takes  a dictionary list of string keys and bee-encoded values and returns the bee-encoding of the
              list. Note that the keys in the input must not be bee-encoded already. This will be  done  by  the
              command itself.

   <b>DECODER</b>
       The  package provides two main decoder commands, one for decoding a string expected to contain a complete
       data structure, the other for the incremental decoding of bee-values arriving on a  channel.  The  latter
       command is asynchronous and provides the completed decoded values to the user through a command callback.

       <b>::bee::decode</b> <u>string</u> ?<u>endvar</u>? ?<u>start</u>?
              Takes  the  bee-encoding  in the string and returns one decoded value. In the case of this being a
              container all contained values are decoded recursively as well and the result is a properly nested
              tcl list and/or dictionary.

              If the optional <u>endvar</u> is set then it is the name of a variable to store the index  of  the  first
              character <u>after</u> the decoded value into. In other words, if the string contains more than one value
              then  <u>endvar</u>  can  be  used  to obtain the position of the bee-value after the bee-value currently
              decoded. together with <u>start</u>, see below, it is possible to iterate over the string to extract  all
              contained values.

              The  optional  <u>start</u> index defaults to <b>0</b>, i.e. the beginning of the string. It is the index of the
              first character of the bee-encoded value to extract.

       <b>::bee::decodeIndices</b> <u>string</u> ?<u>endvar</u>? ?<u>start</u>?
              Takes the same arguments as <b>::bee::decode</b> and returns the same information in <u>endvar</u>.  The  result
              however  is  different.  Instead  of  the  tcl  value  contained  in  the <u>string</u> it returns a list
              describing the value with respect to type and location (indices for the first and  last  character
              of the bee-value). In case of a container the structure also contains the same information for all
              the embedded values.

              Formally the results for the various types of bee-values are:

              string A list containing three elements:

                     •      The constant string <b>string</b>, denoting the type of the value.

                     •      An  integer  number  greater  than  or equal to zero. This is the index of the first
                            character of the bee-value in the input <u>string</u>.

                     •      An integer number greater than or equal to zero. This  is  the  index  of  the  last
                            character of the bee-value in the input <u>string</u>.

              <u>Note</u>  that  this information is present in the results for all four types of bee-values, with only
              the first element changing according to the type of the value.

              integer
                     The result is like for strings, except that the type element contains the  constant  string
                     <b>integer</b>.

              list   The result is like before, with two exceptions: One, the type element contains the constant
                     string  <b>list</b>. And two, the result actually contains four elements. The last element is new,
                     and contains the index data as described here for all elements of the bee-list.

              dictionary
                     The result is like for strings, except that the type element contains the  constant  string
                     <b>dict</b>.  A  fourth  element  is present as well, with a slightly different structure than for
                     lists. The element is a dictionary mapping from the strings keys of the bee-dictionary to a
                     list containing two elements. The first of them is the index information for the  key,  and
                     the  second  element is the index information for the value the key maps to. This structure
                     is the only which contains not only index data, but  actual  values  from  the  bee-string.
                     While  the  index  information of the keys is unique enough, i.e. serviceable as keys, they
                     are not easy to navigate when trying to find particular  element.  Using  the  actual  keys
                     makes this much easier.

       <b>::bee::decodeChannel</b> <u>chan</u> <b>-command</b> <u>cmdprefix</u> ?<b>-exact</b>? ?<b>-prefix</b> <u>data</u>?
              The  command creates a decoder for a series of bee-values arriving on the channel <u>chan</u> and returns
              its handle. This handle can be used to remove the decoder again.  Setting up another  bee  decoder
              on <u>chan</u> while a bee decoder is still active will fail with an error message.

              <b>-command</b>
                     The  command  prefix  <u>cmdprefix</u> specified by the <u>required</u> option <b>-command</b> is used to report
                     extracted values and exceptional situations (error, and EOF on the channel).  The  callback
                     will  be  executed at the global level of the interpreter, with two or three arguments. The
                     exact call signatures are

                     <b>cmdprefix</b> <b>eof</b> <u>token</u>
                            The decoder has reached eof on the channel  <u>chan</u>.  No  further  invocations  of  the
                            callback will be made after this. The channel has already been closed at the time of
                            the call, and the <u>token</u> is not valid anymore as well.

                     <b>cmdprefix</b> <b>error</b> <u>token</u> <u>message</u>
                            The  decoder  encountered  an  error, which is not eof. For example a malformed bee-
                            value. The <u>message</u> provides details about the error. The decoder  token  is  in  the
                            same state as for eof, i.e. invalid. The channel however is kept open.

                     <b>cmdprefix</b> <b>value</b> <u>token</u> <u>value</u>
                            The  decoder  received  and  successfully  decoded  a  bee-value.  The format of the
                            equivalent tcl <u>value</u> is the same as returned by <b>::bee::decode</b>. The channel is  still
                            open  and the decoder token is valid. This means that the callback is able to remove
                            the decoder.

              <b>-exact</b> By default the decoder assumes that the remainder of the data in the channel consists  only
                     of  bee-values,  and  reads  as  much  as possible per event, without regard for boundaries
                     between bee-values. This means that if the the input contains non-bee data after  a  series
                     of  bee-value  the  beginning  of  that data may be lost because it was already read by the
                     decoder, but not processed.

                     The <b>-exact</b> was made for this situation. When specified the decoder will take  care  to  not
                     read  any  characters behind the currently processed bee-value, so that any non-bee data is
                     kept in the channel for further processing after removal of the decoder.

              <b>-prefix</b>
                     If this option is specified its value is assumed to be the beginning of the  bee-value  and
                     used  to initialize the internal decoder buffer. This feature is required if the creator of
                     the decoder used data from the channel to determine if it should create the decoder or not.
                     Without the option this data would be lost to the decoding.

       <b>::bee::decodeCancel</b> <u>token</u>
              This command cancels the decoder set up by <b>::bee::decodeChannel</b>  and  represented  by  the  handle
              <u>token</u>.

       <b>::bee::decodePush</b> <u>token</u> <u>string</u>
              This  command  appends  the <u>string</u> to the internal decoder buffer. It is the runtime equivalent of
              the option <b>-prefix</b> of <b>::bee::decodeChannel</b>. Use it to push data back into  the  decoder  when  the
              <b>value</b>  callback  used  data from the channel to determine if it should decode another bee-value or
              not.

</pre><h4><b>FORMAT</b> <b>DEFINITION</b></h4><pre>
       Data in the bee serialization format is constructed from two basic forms, and two  container  forms.  The
       basic forms are strings and integer numbers, and the containers are lists and dictionaries.

       String <u>S</u>
              A  string <u>S</u> of length <u>L</u> is encoded by the string "<u>L</u><b>:</b><u>S</u>", where the length is written out in textual
              form.

       Integer <u>N</u>
              An integer number <u>N</u> is encoded by the string "<b>i</b><u>N</u><b>e</b>".

       List <u>v1</u> ... <u>vn</u>
              A list of the values <u>v1</u> to <u>vn</u> is encoded by the string  "<b>l</b><u>BV1</u>...<u>BVn</u><b>e</b>"  where  "BV<b>i</b>"  is  the  bee-
              encoding of the value "v<b>i</b>".

       Dict <u>k1</u> -&gt; <u>v1</u> ...
              A  dictionary mapping the string key <u>k</u><b>i</b> to the value <u>v</u><b>i</b>, for <b>i</b> in <b>1</b> ... <b>n</b> is encoded by the string
              "<b>d</b><u>BK</u><b>i</b><u>BV</u><b>i</b>...<b>e</b>" for i in <b>1</b> ... <b>n</b>, where "BK<b>i</b>" is the bee-encoding of the key string "k<b>i</b>".  and "BV<b>i</b>"
              is the bee-encoding of the value "v<b>i</b>".

              <u>Note</u>: The bee-encoding does not retain the order of the keys in the input, but stores in a  sorted
              order. The sorting is done for the "raw strings".

       Note  that  the  type  of each encoded item can be determined immediately from the first character of its
       representation:

       i      Integer.

       l      List.

       d      Dictionary.

       [0-9]  String.

       By wrapping an integer number into <b>i</b>...<b>e</b> the format makes sure that  they  are  different  from  strings,
       which all begin with a digit.

</pre><h4><b>EXAMPLES</b></h4><pre>
</pre><h4><b>BUGS,</b> <b>IDEAS,</b> <b>FEEDBACK</b></h4><pre>
       This  document,  and  the package it describes, will undoubtedly contain bugs and other problems.  Please
       report such in the category <u>bee</u> of the <u>Tcllib</u>  <u>Trackers</u>  [<a href="http://core.tcl.tk/tcllib/reportlist">http://core.tcl.tk/tcllib/reportlist</a>].   Please
       also report any ideas for enhancements you may have for either package and/or documentation.

       When proposing code changes, please provide <u>unified</u> <u>diffs</u>, i.e the output of <b>diff</b> <b>-u</b>.

       Note  further  that  <u>attachments</u>  are strongly preferred over inlined patches. Attachments can be made by
       going to the <b>Edit</b> form of the ticket immediately after its creation, and then using the left-most  button
       in the secondary navigation bar.

</pre><h4><b>KEYWORDS</b></h4><pre>
       BitTorrent, bee, bittorrent, serialization, torrent

</pre><h4><b>CATEGORY</b></h4><pre>
       Networking

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright (c) 2004 Andreas Kupries &lt;<a href="mailto:andreas_kupries@users.sourceforge.net">andreas_kupries@users.sourceforge.net</a>&gt;

tcllib                                                 0.3                                             <u><a href="../man3tcl/bee.3tcl.html">bee</a></u>(3tcl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>