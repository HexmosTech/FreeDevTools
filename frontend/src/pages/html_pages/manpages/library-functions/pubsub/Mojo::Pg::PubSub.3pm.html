<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mojo::Pg::PubSub - Publish/Subscribe</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmojo-pg-perl">libmojo-pg-perl_4.27-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Mojo::Pg::PubSub - Publish/Subscribe

</pre><h4><b>SYNOPSIS</b></h4><pre>
         use Mojo::Pg::PubSub;

         my $pubsub = Mojo::Pg::PubSub-&gt;new(pg =&gt; $pg);
         my $cb = $pubsub-&gt;listen(foo =&gt; sub ($pubsub, $payload) {
           say "Received: $payload";
         });
         $pubsub-&gt;notify(foo =&gt; 'I ♥ Mojolicious!');
         $pubsub-&gt;unlisten(foo =&gt; $cb);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Mojo::Pg::PubSub is a scalable implementation of the publish/subscribe pattern used by Mojo::Pg. It is
       based on PostgreSQL notifications and allows many consumers to share the same database connection, to
       avoid many common scalability problems.

</pre><h4><b>EVENTS</b></h4><pre>
       Mojo::Pg::PubSub inherits all events from Mojo::EventEmitter and can emit the following new ones.

   <b>disconnect</b>
         $pubsub-&gt;on(disconnect =&gt; sub ($pubsub, $db) {
           ...
         });

       Emitted after the current database connection is lost.

   <b>reconnect</b>
         $pubsub-&gt;on(reconnect =&gt; sub ($pubsub, $db) {
           ...
         });

       Emitted after switching to a new database connection for sending and receiving notifications.

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       Mojo::Pg::PubSub implements the following attributes.

   <b>pg</b>
         my $pg  = $pubsub-&gt;pg;
         $pubsub = $pubsub-&gt;pg(Mojo::Pg-&gt;new);

       Mojo::Pg object this publish/subscribe container belongs to. Note that this attribute is weakened.

   <b>reconnect_interval</b>
         my $interval = $pubsub-&gt;reconnect_interval;
         $pubsub      = $pubsub-&gt;reconnect_interval(0.1);

       Amount of time in seconds to wait to reconnect after disconnecting, defaults to 1.

</pre><h4><b>METHODS</b></h4><pre>
       Mojo::Pg::PubSub inherits all methods from Mojo::EventEmitter and implements the following new ones.

   <b>db</b>
         my $db = $pubsub-&gt;db;

       Build and cache or get cached Mojo::Pg::Database connection from "pg". Used to reconnect if disconnected.

         # Reconnect immediately
         $pubsub-&gt;unsubscribe('disconnect')-&gt;on(disconnect =&gt; sub ($pubsub, $db) { pubsub-&gt;db });

   <b>json</b>
         $pubsub = $pubsub-&gt;json('foo');

       Activate automatic JSON encoding and decoding with "to_json" in Mojo::JSON and "from_json" in Mojo::JSON
       for a channel.

         # Send and receive data structures
         $pubsub-&gt;json('foo')-&gt;listen(foo =&gt; sub ($pubsub, $payload) {
           say $payload-&gt;{bar};
         });
         $pubsub-&gt;notify(foo =&gt; {bar =&gt; 'I ♥ Mojolicious!'});

   <b>listen</b>
         my $cb = $pubsub-&gt;listen(foo =&gt; sub {...});

       Subscribe to a channel, there is no limit on how many subscribers a channel can have. Automatic decoding
       of JSON text to Perl values can be activated with "json".

         # Subscribe to the same channel twice
         $pubsub-&gt;listen(foo =&gt; sub ($pubsub, $payload) {
           say "One: $payload";
         });
         $pubsub-&gt;listen(foo =&gt; sub ($pubsub, $payload) {
           say "Two: $payload";
         });

   <b>new</b>
         my $pubsub = Mojo::Pg::PubSub-&gt;new;
         my $pubsub = Mojo::Pg::PubSub-&gt;new(pg =&gt; Mojo::Pg-&gt;new);
         my $pubsub = Mojo::Pg::PubSub-&gt;new({pg =&gt; Mojo::Pg-&gt;new});

       Construct a new Mojo::Pg::PubSub object and subscribe to the "disconnect" event with default reconnect
       logic.

   <b>notify</b>
         $pubsub = $pubsub-&gt;notify('foo');
         $pubsub = $pubsub-&gt;notify(foo =&gt; 'I ♥ Mojolicious!');
         $pubsub = $pubsub-&gt;notify(foo =&gt; {bar =&gt; 'baz'});

       Notify a channel. Automatic encoding of Perl values to JSON text can be activated with "json".

   <b>reset</b>
         $pubsub-&gt;reset;

       Reset all subscriptions and the database connection. This is usually done after a new process has been
       forked, to prevent the child process from stealing notifications meant for the parent process.

   <b>unlisten</b>
         $pubsub = $pubsub-&gt;unlisten('foo');
         $pubsub = $pubsub-&gt;unlisten(foo =&gt; $cb);

       Unsubscribe from a channel.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Mojo::Pg, Mojolicious::Guides, &lt;https://mojolicious.org&gt;.

perl v5.34.0                                       2022-03-19                              <u>Mojo::Pg::<a href="../man3pm/PubSub.3pm.html">PubSub</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>