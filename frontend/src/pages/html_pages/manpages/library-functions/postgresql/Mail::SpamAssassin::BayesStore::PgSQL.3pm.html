<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mail::SpamAssassin::BayesStore::PgSQL - PostgreSQL Specific Bayesian Storage Module Implementation</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/spamassassin">spamassassin_4.0.1-5_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       Mail::SpamAssassin::BayesStore::PgSQL - PostgreSQL Specific Bayesian Storage Module Implementation

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This module implements a PostgreSQL specific bayesian storage module.

       It subclasses Mail::SpamAssassin::BayesStore::SQL and overrides any methods which makes SQL calls
       involving the token column.  Since PostgreSQL uses BYTEA for the token column type you must make sure
       that the DBD driver does the proper quoting.  You can accomplish this by binding the token column to a
       specific type.

       In versions 8.3 and up, synchronous_commit is disabled for faster performance.  Data is not guaranteed to
       be stored until (3 * wal_writer_delay) (default: 0.6s) after it is written. This tradeoff works for Bayes
       because we care about aggregate data and a small period of time can be lost without sacrificing accuracy.

</pre><h4><b>METHODS</b></h4><pre>
   <b>token_expiration</b>
       public instance (Integer, Integer,
                        Integer, Integer) token_expiration(\% $opts,
                                                           Integer $newdelta,
                                                           @ @vars)

       Description: This method performs the database specific expiration of tokens based on the passed in
       $newdelta and @vars.

   <b>seen_put</b>
       public (Boolean) seen_put (string $msgid, char $flag)

       Description: This method records $msgid as the type given by $flag.  $flag is one of two values 's' for
       spam and 'h' for ham.

   <b>seen_delete</b>
       public instance (Boolean) seen_delete (string $msgid)

       Description: This method removes $msgid from the database.

   <b>set_last_expire</b>
       public instance (Boolean) set_last_expire (Integer $time)

       Description: This method sets the last expire time.

   <b>set_running_expire_tok</b>
       public instance (String $time) set_running_expire_tok ()

       Description: This method sets the time that an expire starts running.

   <b>remove_running_expire_tok</b>
       public instance (Boolean) remove_running_expire_tok ()

       Description: This method removes the row in the database that indicates that and expire is currently
       running.

   <b>tok_get</b>
       public instance (Integer, Integer, Integer) tok_get (String $token)

       Description: This method retrieves a specified token ($token) from the database and returns it's
       spam_count, ham_count and last access time.

   <b>tok_get_all</b>
       public instance (\@) tok_get (@ $tokens)

       Description: This method retrieves the specified tokens ($tokens) from storage and returns an array ref
       of arrays spam count, ham count and last access time.

   <b>nspam_nham_change</b>
       public instance (Boolean) nspam_nham_change (Integer $num_spam,
                                                    Integer $num_ham)

       Description: This method updates the number of spam and the number of ham in the database.

   <b>tok_touch</b>
       public instance (Boolean) tok_touch (String $token,
                                            String $atime)

       Description: This method updates the given tokens ($token) atime.

       The assumption is that the token already exists in the database.

   <b>tok_touch_all</b>
       public instance (Boolean) tok_touch (\@ $tokens
                                            String $atime)

       Description: This method does a mass update of the given list of tokens $tokens, if the existing token
       atime is &lt; $atime.

       The assumption is that the tokens already exist in the database.

       We should never be touching more than N_SIGNIFICANT_TOKENS, so we can make some assumptions about how to
       handle the data (ie no need to batch like we do in tok_get_all)

   <b>cleanup</b>
       public instance (Boolean) cleanup ()

       Description: This method performs any cleanup necessary before moving onto the next operation.

   <b>clear_database</b>
       public instance (Boolean) clear_database ()

       Description: This method deletes all records for a particular user.

       Callers should be aware that any errors returned by this method could causes the database to be
       inconsistent for the given user.

</pre><h4><b>Private</b> <b>Methods</b></h4><pre>
   <b>_connect_db</b>
       private instance (Boolean) _connect_db ()

       Description: This method connects to the SQL database.

   <b>_put_token</b>
       private instance (Boolean) _put_token (string $token,
                                              integer $spam_count,
                                              integer $ham_count,                            string $atime)

       Description: This method performs the work of either inserting or updating a token in the database.

   <b>_put_tokens</b>
       private instance (Boolean) _put_tokens (\% $token,
                                               integer $spam_count,
                                               integer $ham_count,                             string $atime)

       Description: This method performs the work of either inserting or updating tokens in the database.

   <b>_token_select_string</b>
       private instance (String) _token_select_string

       Description: This method returns the string to be used in SELECT statements to represent the token
       column.

perl v5.40.1                                       2025-06-26              <u>Mail::SpamAssa...yesStore::<a href="../man3pm/PgSQL.3pm.html">PgSQL</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>