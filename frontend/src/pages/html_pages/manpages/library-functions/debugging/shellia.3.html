<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shellia - library for interactive shell scripts</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/shellia">shellia_5.9_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       shellia - library for interactive shell scripts

</pre><h4><b>SYNOPSIS</b></h4><pre>
          <b>.</b> <b>/usr/share/shellia/ia[.interactive|.check|.debug|]</b>

          <b>eval</b> <b>"$ia_init"</b>

          [[<b>ia_nocheck</b> [<b>-f</b>]] | [[<b>ia_stdout|ia_ignore</b> <u>regex</u>] ...]]

          <b>ia_add</b> <u>command-sequence</u>

          <b>dbg</b> [<b>debug-level</b> [<b>debug-topic</b> ...]] <b>debug-output</b>

          <b>ia</b> [<b>-c|-C</b>] [<b>-x</b>]

</pre><h4><b>ENVIRONMENT</b></h4><pre>
          If  <b>ia_logfile</b> contains the path to a writeable file, logfile output as seen by <b>ia</b> is appended to that
          file.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>shellia</b> is a library that allows to run shell scripts silently or interactive and helps to  check  errors
       of commands that are combined in <b>steps</b>.

       Each  function  of  a shell programm (including the main shell programm) can include a group of <b>steps</b>.  A
       group of <b>steps</b> should always be enclosed between an initializing line <b>eval</b> <b>"$ia_init"</b> and the  line  with
       command  <b>ia</b>  which  starts  the  execution of the <b>steps</b>.  Each <b>step</b> is a <u>command-sequence</u> given as string
       argument to <b>ia_add</b> The <u>command-sequence</u> contained in the string has the same requirements as if it  would
       be given to the shell command <u>eval</u>.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>.</b> <b>/usr/share/shellia/ia[.interactive|.check|.debug|]</b>
              To   only   load   the   <b>shellia</b>   interactive  library  for  basic  interactive  features  use  <u>.</u>
              <u>/usr/share/shellia/ia.interactive</u>.  To only load shellia check library to check stderr, stdout and
              exit-value of <b>steps</b> use <u>.</u> <u>/usr/share/shellia/ia.check</u>.  TO only load the shellia debug library, to
              add <b>debug-output</b> to a shell script use  <u>.</u>  <u>/usr/share/shellia/ia.debug</u>.   To  source  all  shellia
              libraries listed above is the suggested method and can be done with <u>.</u> <u>/usr/share/shellia/ia</u>.

       <b>ia_nocheck</b>
              This  command  can be used, if the following <b>ia</b> command has enabled <b>check-mode</b> with option [<b>-c|-C</b>]
              for its group of <b>steps</b>.  This will disable the check of <u>stderr</u>  and  <u>stdout</u>  in  the  next  single
              <b>ia_add</b>  <b>step</b>.   With  opiton  <b>-f</b>  added,  it will also disable checking the exit value of the next
              single step.  Also if a <b>step</b> may exit the script, <b>ia_nocheck</b> can be used to  prevent  the  message
              <u>ERROR:</u> <u>ia</u> <u>premature</u> <u>exit</u> <u>of</u> <u>...</u>.

       <b>ia_stdout</b> <u>regex</u>
              to  use this command, the following <b>ia</b> command has to be used with option <b>-c</b>.  <u>regex</u> is a regualar
              expressions as defined in <a href="../man1/gawk.1.html">gawk</a>(1), to define which output  of  the  following  <b>step</b>  defined  with
              <b>ia_add</b>  will  be  standard  output  of  the  <b>step</b>.   Each  <b>step</b> can be preceded with any number of
              <b>ia_stdout</b> <u>regex</u> commands.  Because the user can not suppress output allowed  with  <b>ia_stodut</b>  with
              the  option  <b>-s</b>,  <b>ia_stdout</b>  should only be used, if the output is intendet to be piped to another
              programm.  <u>regex</u> only needs to handle text without color-control-codes.

       <b>ia_ignore</b> <u>regex</u>
              to use this command, the following <b>ia</b> command has to be used with either option <b>-c</b> or  <b>-C</b>.   <u>regex</u>
              is  a  regualar  expressions  as  defined in <a href="../man1/gawk.1.html">gawk</a>(1), to define which output of the following <b>step</b>
              defined with <b>ia_add</b> will be ignored.  Each <b>step</b> can be preceded with any number of <b>ia_ignore</b> <u>regex</u>
              commands.  <u>regex</u> only needs to handle text without color-control-codes.

       <b>-c</b>     if this option is given to <b>ia</b> all <b>steps</b> previous added with <b>ia_add</b> will be checked with <b>check-mode</b>
              option <b>-c</b> (see <b>check-mode</b> below)

       <b>-C</b>     if this option is given to <b>ia</b> all <b>steps</b> previous added with <b>ia_add</b> will be checked with <b>check-mode</b>
              option <b>-C</b>. (see <b>check-mode</b> below)

       <b>-x</b>     if this option is given to <b>ia</b> all <b>steps</b> previous added  with  <b>ia_add</b>  will  use  <b>trace-mode</b>.  (see
              <b>trace-mode</b> below)

</pre><h4><b>USAGE</b></h4><pre>
       The examples listed below try to show the technical features of <b>shellia</b> in very small examples.

       Be  aware  that  the  <b>step</b>  size  in  the  example listed below is only reasonable to demonstrate shellia
       features.  Please read <a href="../man7/shellia.7.html">shellia</a>(7) <b>NOTES</b>, to learn about a reasonable size of interactive <b>steps</b>.

   <b>Basic</b> <b>features</b>
       A script using the basic features to print <u>hello</u> <u>world</u> may look like:

          01  #!<a href="file:/bin/sh">/bin/sh</a>
          02  . /usr/share/shellia/ia.interactive
          03  eval "$ia_init"
          04  ia_add "echo \"hello\""
          05  ia_add "echo \"world\""
          06  ia

       In line 02 the <b>shellia</b> library <b>ia.interactive</b> is loaded.  Line  03  initializes  <b>shellia</b>  and  is  needed
       before  <b>shellia</b>  functions  can  be  used.   It  also  consumes all shellia standard options, so that the
       remaining options will be <u>script-specific-options</u>.  Line 04 and 05 are  using  <b>ia_add</b>  to  add  the  <u>echo</u>
       commands.  The execution starts in line 06 with the <b>ia</b> command.

       If  the script is called without options, it only prints <u>hello</u> and <u>world</u>.  If it is called with option <b>-i</b>
       it will run in interactive mode, as discussed in <a href="../man1/shellia.1.html">shellia</a>(1) <b>Basic</b> <b>features</b>.

       On <b>debian</b> systems this script may be found at <u>/usr/share/doc/shellia/examples/hello_world</u>.

   <b>Interactive-mode</b>
       A script using a function in <b>interactive-mode</b> may look like:

          01 . /usr/share/shellia/ia.interactive
          02 say_hello()
          03 {
          04   local name
          05   eval "$ia_init"
          06   ia_add "name=\"$1\""
          07   ia_add "echo \"hello \$name\""
          08   ia
          09 }
          10 eval "$ia_init"
          11 ia_add "say_hello &lt;-i&gt; -- \"$1\""
          12 ia

       Line 01, 10, 12 are equivalent as in the previous example.  Line 02, 03, 04, 07 and 09 are  normal  shell
       statements,  with no additional comments.  Line 05 to initialize <b>shellia</b> has to be done in each function.
       Line 06 sets variable name to $1.  Line 08 starts the <b>steps</b> and is needed in all functions.  Line 11 uses
       the special syntax <u>&lt;-i&gt;</u> which allows to switch <b>-i</b> in <b>interactive-mode</b>.

       On <b>debian</b> systems this script may be found at <u>/usr/share/doc/shellia/examples/hello_world_fun</u>.

       See <a href="../man1/shellia.1.html">shellia</a>(1) <b>Interactive-mode</b> to read about using this script.

   <b>check-mode</b>
       Before demonstrating how to use the <b>check-mode</b> option <b>-c</b> or <b>-C</b> we first start with the following  script,
       without any <b>check-mode</b> option:

          01 . /usr/share/shellia/ia
          02 say_hello()
          03 {
          04   echo "hello $1"
          05   echo "end of function say_hello" &gt;&amp;2
          06   return 5
          07 }
          08 eval "$ia_init"
          09 ia_add "say_hello \"$1\""
          10 ia

       If we run this script we get the following output and exit value:

          01 $ ./hello_world_check "shellia user"
          02 hello shellia user
          03 end of function say_hello
          04 $ echo $?
          05 5

       In  the  script lines 02 to 07 the function <u>say_hello</u> is defined.  To call this function <b>shellia</b> specific
       syntax is used in script line 08 to 10.  Let's assume the function <u>say_hello</u> may  represent  an  external
       programm,  that  we  have  to  use,  but  are not allowed to change it.  But we want to change the output
       presented to the user:

          • the output "end of function say_hello" makes no sense for the user.  We know it is harmless, and  we
            just want to suppress it.

          • output starting with "hello" is what we want.  But any other output, that we may not have seen until
            now, should be displayed as error.

          • We  want  to  see  every nonzero exit value as an error.  Only an exit value of 5 seems to be ok and
            should not be displayed as error.

       We can get this with <b>check-mode</b> option <b>-c</b> or <b>-C</b>.  There is a disccussion about which  option  to  use  in
       <a href="../man7/shellia.7.html">shellia</a>(7) <b>When</b> <b>to</b> <b>use</b> <b>check</b> <b>option</b> <b>-c</b> <b>and</b> <b>-C</b>.

   <b>check-mode</b> <b>-c</b>
       To get the wanted behaviour described in previous chapter with <b>check-mode</b> option <b>-c</b> we change script line
       10 to:

          10 ia -c

       and get the following output:

          01 $ ./hello_world_check "shellia user"
          02 --- output with ERROR from &lt;hello_world_check&gt; running &lt;say_hello "shellia user"&gt; ---
          03 e:hello
          04 e:end of function say_hello
          05 e:exit=5
          06 --- (q)uit (r)edo (i)gnore (s)witch interactive ---
          07 ?

       Output  line  01  shows  where errors happended.  The output lines 03 to 05 start with <u>e:</u> to classify the
       output as errors.  Line 03 is also shown as error, because shellia does not know, that it is  the  wanted
       output.  Line 04 is what we want to be suppressed.  And line 05 now shows every nonzero exit as an error.
       To make the program to behave as wanted we can add the folloging lines +a, +b and +c before  script  line
       09:

          +a ia_stdout "^hello "
          +b ia_ignore "end of function say_hello$"
          +c ia_ignore "^exit=5$"
          09 ia_add "say_hello \"$1\""

       Line  +a will display the output we want to see, and line +b and +c will ignore and suppresses what we do
       not want to see.

   <b>check-mode</b> <b>-C</b>
       A file that starts to fix <u>say_hello</u> with <b>check-mode</b> option <b>-C</b> is provided as example  and  the  usage  is
       explaind     in     <a href="../man1/shellia.1.html">shellia</a>(1).     On    <b>debian</b>    systems    this    script    may    be    found    at
       <u>/usr/share/doc/shellia/examples/hello_world_error</u>.  The changed script line from the example  in  chapter
       <b>check-mode</b> is:

          10 ia -C

       and gives the following output:

          01 $ ./hello_world_error "shellia user"
          02 --- output with ERROR from &lt;hello_world_error&gt; running &lt;say_hello "shellia user"&gt; ---
          03 e:end of function say_hello
          04 e:exit=5
          05 s:hello
          --- (q)uit (r)edo (i)gnore (s)witch interactive ---
          ?

       In  line  05  <u>s:</u> already classifies the ouput as <u>stdout</u>.  To make the program behave as wanted we can add
       the folloging lines +a and +b before script line 09:

          +a ia_ignore "end of function say_hello$"
          +b ia_ignore "^exit=5$"
          09 ia_add "say_hello \"$1\""

   <b>debug-mode</b>
       The library <u>ia.debug</u> includes functions to add <b>debug-output</b> to a shell script.  The  <u>script.using.shellia</u>
       can then be called with a <u>debug-runtime-config</u> to define the <b>debug-level</b> and to select <b>debug-topics</b>.  See
       <a href="../man1/shellia.1.html">shellia</a>(1) <b>debug-mode</b> to learn about <u>debug-runtime-config</u>.

       A simple script to add <b>debug-output</b> without <b>debug-level</b> or <b>debug-topics</b> is:

          01 . /usr/share/shellia/ia
          02 say_hello_world()
          03 {
          04   dbg "say_hello function start"
          05   echo "hello world"
          06   dbg "say_hello function end"
          07 }
          08 eval "$ia_init"
          09 ia_add "dbg \"main program\""
          10 ia_add say_hello_world
          11 ia

       Line  01,  08,  10  and  11  are  already  explained  in  a  previous  example.   Line 04, 06 and 09 adds
       <b>debug-output</b>.  Because no <b>debug-level</b> is defined the lowest possible value <u>1</u> is used.

       In this script <b>debug-output</b> can be turned on when the  script  is  started  with  a  runtime  <b>debug-level</b>
       greater or equal to <u>1</u>.

       If you want to use <b>debug-level</b> <u>3</u> in the function, you can change the following lines:

          04   dbg 3 "say_hello function start"
          06   dbg 3 "say_hello function end"

       Now a <b>debug-runtime-level</b> of at least 3 is needed to produce output for the changed lines.

       Sometimes  it  is  not enough to have <b>debug-levels</b> and you need <b>debug-topics</b> to define which <b>debug-output</b>
       has to be shown.  You can give a free defined <b>debug-topic</b> to each  <u>debug-statement</u>  line.   Normally  you
       should only use a limited number of <b>debug-topics</b> to make things not to complicated.

       We change 2 lines to the free invented <b>debug-topics</b> called <u>start</u> and <u>end</u>:

          04   dbg 3 start "say_hello function start"
          06   dbg 3 end "say_hello function end"

       The  script  now  should  look  like the <u>hello_world_debug</u> script, that on <b>debian</b> systems may be found at
       <u>/usr/share/doc/shellia/examples/hello_world_debug</u>.

       See <a href="../man1/shellia.1.html">shellia</a>(1) <b>debug-mode</b> to read about using this script.

   <b>log-mode</b>
       The library <u>ia.log</u> includes functions to add logging to a shell script.

       In the logfile each line starts with a number of bars.  Following lines with the  same  number  of  bars,
       result from the same function, which is used as header.

       A  simple script with logging called <u>hello_world_log</u> is provided as example.  On <b>debian</b> systems it may be
       found at <u>/usr/share/doc/shellia/examples/hello_world_log</u>.  A part of this script is:

          01 ia_logfile="$(mktemp)"
          02 export ia_logfile
          03 . /usr/share/shellia/ia
          04 say_hello()
          05 {
          06   local name
          07   eval "$ia_init"
          08   ia_add "dbg \"function say_hello called with $# arguments\""
          09   ia_add "name=\"$1\""
          10   ia_stdout "^hello"
          11   ia_add "echo \"hello \$name\""
          12   ia -c
          13 }
          14 eval "$ia_init"
          15 ia_add "dbg \"main program begin\""
          16 ia_nocheck # do not check the already checked output of next line
          17 ia_add "say_hello &lt;-i&gt; -- \"$1\""
          18 ia -c

       In line 03 the <b>ia</b> library is loaded, which also loads <b>ia.log</b>.  The logging is simply enabled  by  setting
       variable <b>ia_logfile</b> in line 01 with the path to the logfile and exporting it in line 02.  The new logfile
       output will be appended to the logfile.

       To see 2 levels of logging in the logfile we have a main program and a function in the example.  Both use
       <b>check-mode</b>  with  <u>ia</u>  <u>-c</u>  in  line 07 and 14 which allows to log checked output.  To not double check the
       function <u>say_hello</u> in the main program line 16 <u>ia_nocheck</u> is added to not check the output of line 17.

       The output to the logfile is discussed in <a href="../man1/shellia.1.html">shellia</a>(1).

   <b>trace-mode</b>
       <b>Trace-mode</b> can be enabled with <u>ia</u> <u>-x</u> for a group of <b>steps</b>.  When tracemode is enabled, before  each  <b>step</b>
       <u>set</u>  <u>-x</u>  is  called  and  after  each  stet <u>set</u> <u>+x</u> is called.  This way, no <b>shellia</b> internal commands are
       traced.

       A simple script with <b>trace-mode</b> called <u>hello_world_trace</u> is provided as example.  On  <b>debian</b>  systems  it
       may be found at <u>/usr/share/doc/shellia/examples/hello_world_trace</u>.  A part of this script is:

          01 . /usr/share/shellia/ia
          02 write_file() {
          03   eval "$ia_init"
          04   ia_add "echo \"hello $2\" &gt;$1"
          05   ia -c -x
          06 }
          07 show_file() {
          08   eval "$ia_init"
          09   ia_stdout "^hello"
          10   ia_add "cat $1"
          11   ia -c -x
          12 }
          13 eval "$ia_init"
          14 ia_add "file=\"\$(mktemp)\""
          15 ia_add "write_file &lt;-i&gt; -- \"\$file\" \"$1\""
          16 ia_stdout "."
          17 ia_add "show_file &lt;-i&gt; -- \"\$file\""
          18 ia_add "rm -f \"\$file\""
          19 ia -c -x

       Without  <b>trace-mode</b> (without <b>-x</b> in line 05 11 and 19) this script would just print one line starting with
       <u>hello</u>.  The following output is printed when calling

          $ /usr/share/doc/shellia/examples/hello_world_trace "shellia user"
          + mktemp
          + file=/tmp/tmp.zCDaHg9dFP
          + echo hello shellia user
          + write_file -- /tmp/tmp.zCDaHg9dFP shellia user
          + cat /tmp/tmp.zCDaHg9dFP
          + show_file -- /tmp/tmp.zCDaHg9dFP
          hello shellia user
          + rm -f /tmp/tmp.zCDaHg9dFP

       Because <b>log-mode</b> is enabled the following log is written:

          |hello_world_trace
          |+ mktemp
          |+ file=/tmp/tmp.zCDaHg9dFP
          ||hello_world_trace/write_file
          ||+ echo hello shellia user
          |+ write_file -- /tmp/tmp.zCDaHg9dFP shellia user
          ||hello_world_trace/show_file
          ||+ cat /tmp/tmp.zCDaHg9dFP
          ||s:hello shellia user
          |+ show_file -- /tmp/tmp.zCDaHg9dFP
          |s:hello shellia user
          |+ rm -f /tmp/tmp.zCDaHg9dFP

       The log shows, that <b>trace-mode</b> output is included in the <b>log-mode</b> output hierarchie.  To  get  <b>trace-mode</b>
       output in a logfile, it is important that <b>log-mode</b> and also <b>check-mode</b> is enabled.

       Also if <b>no-check</b> is used for a <b>step</b>, this step will not create <b>trace-mode</b> output in the logfile.

   <b>variable</b> <b>in</b> <b>Interactive-mode</b>
       If  you  want to enable the user to see the value of a variable, before it is used, with key press <b>v</b>, you
       can write <u>$&lt;var&gt;</u> instead of <u>\$var</u> or <u>\${var}</u>.

</pre><h4><b>HIGH</b> <b>LEVEL</b> <b>FUNCTIONS</b></h4><pre>
   <b>ia_ssh</b>
          <b>ia_add</b> "<b>ia_ssh</b> <u>ssh-options</u> [<b>--fd</b> <u>fd</u>] [<b>--vars</b> <u>vars</u>] <u>destination</u> <u>shellia-script</u>"

       Options:

          &lt;ssh-options&gt;     ssh options described in <a href="../man1/ssh.1.html">ssh</a>(1)
          &lt;fd&gt;              the filedescriptors &lt;fd&gt; will be transfered
          &lt;vars&gt;            the variables &lt;vars&gt; will be provided
          &lt;destination&gt;     ssh destination described in <a href="../man1/ssh.1.html">ssh</a>(1)
          &lt;shellia-script&gt;  script that can use the transferred filedescriptors
                            and variables

       <b>ia_ssh</b>  transfers  additional  to  the  filedescriptors  <b>stderr</b>  and  <b>stdout</b>  the  shellia  filescriptors
       <b>$ia_direct_stderr_fd</b> and <b>$ia_log_fd</b> with <b>ssh</b>.  Also the variables listed in <b>$ia_inherit_vars</b> are provided
       to the remote <u>shellia-script</u>.

       With  <b>$ia_log_fd</b> the remote <u>shellia-script</u> does not need to use an own logfile and the log can be written
       to the local logfile.

       Warning: The order of data transferred by filedescriptors may change within a single shellia step.

</pre><h4><b>PREFIX</b></h4><pre>
       Commands or global variables brought by <b>shellia</b> normally start with <b>ia</b>  (see  <b>NAME</b>  in  <a href="../man7/shellia.7.html">shellia</a>(7)).   If
       <b>ia.debug</b>  is  used  there  will  also  be  commands and global variables that start with <u>dbg</u>.  But if you
       already use one or both of this prefixes, you can change them, while loading the library.

       The example changes <b>ia</b> to <u>mycmd</u> and <u>dbg</u> to <u>myprnt</u>:

          ia_prefix=mycmd
          dbg_prefix=myprnt
          . /usr/share/shellia/ia

       Now the new prefixes have to be used, e.g. <u>ia_add</u> is now <u>mycmd_add</u>.

</pre><h4><b>WARNING</b></h4><pre>
       It is not always possible to separate <b>sellia</b>'s internal variables from script variables.  For this reason
       variable names starting with <b>ia_</b> should not be used in scripts.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/shellia.1.html">shellia</a>(1), <a href="../man7/shellia.7.html">shellia</a>(7), <a href="../man1/gawk.1.html">gawk</a>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
       <a href="mailto:bernd.schumacher@hpe.com">bernd.schumacher@hpe.com</a>

       License: GNU General Public License, version 3

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Bernd Schumacher &lt;<a href="mailto:bernd.schumacher@hpe.com">bernd.schumacher@hpe.com</a>&gt; (2007-2020)

0.1                                                2020-08-07                                         <u><a href="../man3/SHELLIA.3.html">SHELLIA</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>