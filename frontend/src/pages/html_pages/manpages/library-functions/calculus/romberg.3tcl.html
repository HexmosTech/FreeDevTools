<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>math::calculus::romberg - Romberg integration</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/tcllib">tcllib_2.0+dfsg-4_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       math::calculus::romberg - Romberg integration

</pre><h4><b>SYNOPSIS</b></h4><pre>
       package require <b>Tcl</b> <b>8.5</b> <b>9</b>

       package require <b>math::calculus</b> <b>0.6</b>

       <b>::math::calculus::romberg</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?

       <b>::math::calculus::romberg_infinity</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?

       <b>::math::calculus::romberg_sqrtSingLower</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?

       <b>::math::calculus::romberg_sqrtSingUpper</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?

       <b>::math::calculus::romberg_powerLawLower</b> <u>gamma</u> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?

       <b>::math::calculus::romberg_powerLawUpper</b> <u>gamma</u> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?

       <b>::math::calculus::romberg_expLower</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?

       <b>::math::calculus::romberg_expUpper</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?

________________________________________________________________________________________________________________

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>romberg</b>  procedures in the <b>math::calculus</b> package perform numerical integration of a function of one
       variable.  They are intended to be of  "production  quality"  in  that  they  are  robust,  precise,  and
       reasonably efficient in terms of the number of function evaluations.

</pre><h4><b>PROCEDURES</b></h4><pre>
       The following procedures are available for Romberg integration:

       <b>::math::calculus::romberg</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?
              Integrates an analytic function over a given interval.

       <b>::math::calculus::romberg_infinity</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?
              Integrates an analytic function over a half-infinite interval.

       <b>::math::calculus::romberg_sqrtSingLower</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?
              Integrates  a function that is expected to be analytic over an interval except for the presence of
              an inverse square root singularity at the lower limit.

       <b>::math::calculus::romberg_sqrtSingUpper</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?
              Integrates a function that is expected to be analytic over an interval except for the presence  of
              an inverse square root singularity at the upper limit.

       <b>::math::calculus::romberg_powerLawLower</b> <u>gamma</u> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?
              Integrates  a function that is expected to be analytic over an interval except for the presence of
              a power law singularity at the lower limit.

       <b>::math::calculus::romberg_powerLawUpper</b> <u>gamma</u> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?
              Integrates a function that is expected to be analytic over an interval except for the presence  of
              a power law singularity at the upper limit.

       <b>::math::calculus::romberg_expLower</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?
              Integrates  an exponentially growing function; the lower limit of the region of integration may be
              arbitrarily large and negative.

       <b>::math::calculus::romberg_expUpper</b> <u>f</u> <u>a</u> <u>b</u> ?<u>-option</u> <u>value</u>...?
              Integrates an exponentially decaying function; the upper limit of the region of integration may be
              arbitrarily large.

</pre><h4><b>PARAMETERS</b></h4><pre>
       <u>f</u>      Function to integrate.  Must be expressed as a single Tcl command, to which  will  be  appended  a
              single  argument,  specifically,  the abscissa at which the function is to be evaluated. The first
              word of the command will be processed with <b>namespace</b> <b>which</b> in the  caller's  scope  prior  to  any
              evaluation.  Given  this  processing,  the  command may local to the calling namespace rather than
              needing to be global.

       <u>a</u>      Lower limit of the region of integration.

       <u>b</u>      Upper limit of the region of integration.  For the  <b>romberg_sqrtSingLower</b>,  <b>romberg_sqrtSingUpper</b>,
              <b>romberg_powerLawLower</b>,  <b>romberg_powerLawUpper</b>,  <b>romberg_expLower</b>, and <b>romberg_expUpper</b> procedures,
              the lower limit must be strictly less than the upper.  For the other procedures,  the  limits  may
              appear in either order.

       <u>gamma</u>  Power to use for a power law singularity; see section <b>IMPROPER</b> <b>INTEGRALS</b> for details.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-abserror</b> <u>epsilon</u>
              Requests  that the integration machinery proceed at most until the estimated absolute error of the
              integral is less than <u>epsilon</u>. The error may be seriously over- or underestimated if the  function
              (or  any  of  its derivatives) contains singularities; see section <b>IMPROPER</b> <b>INTEGRALS</b> for details.
              Default is 1.0e-08.

       <b>-relerror</b> <u>epsilon</u>
              Requests that the integration machinery proceed at most until the estimated relative error of  the
              integral  is less than <u>epsilon</u>. The error may be seriously over- or underestimated if the function
              (or any of its derivatives) contains singularities; see section <b>IMPROPER</b>  <b>INTEGRALS</b>  for  details.
              Default is 1.0e-06.

       <b>-maxiter</b> <u>m</u>
              Requests  that  integration  terminate  after  at  most  <u>n</u>  triplings of the number of evaluations
              performed.  In other words, given <u>n</u> for <b>-maxiter</b>, the integration machinery will make at most 3**<u>n</u>
              evaluations of the function.  Default is 14, corresponding to a limit  approximately  4.8  million
              evaluations. (Well-behaved functions will seldom require more than a few hundred evaluations.)

       <b>-degree</b> <u>d</u>
              Requests  that an extrapolating polynomial of degree <u>d</u> be used in Romberg integration; see section
              <b>DESCRIPTION</b> for details. Default is 4.  Can be at most <u>m</u>-1.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>romberg</b> procedure performs Romberg integration using the modified midpoint rule. Romberg  integration
       is  an  iterative process.  At the first step, the function is evaluated at the midpoint of the region of
       integration, and the value is multiplied by the width of the interval for the coarsest possible estimate.
       At the second step, the interval is divided into three parts,  and  the  function  is  evaluated  at  the
       midpoint  of  each part; the sum of the values is multiplied by three.  At the third step, nine parts are
       used, at the fourth twenty-seven, and so on, tripling the number of subdivisions at each step.

       Once the interval has been divided at least <u>d</u> times, a polynomial is fitted to the integrals estimated in
       the last <u>d</u>+1 divisions.  The integrals are considered to be a function of the square of the width of  the
       subintervals  (any  good  numerical analysis text will discuss this process under "Romberg integration").
       The polynomial is extrapolated to a step size of zero, computing a value for the integral and an estimate
       of the error.

       This process will be well-behaved only if the function is analytic over the region of integration;  there
       may  be  removable singularities at either end of the region provided that the limit of the function (and
       of all its derivatives) exists as the ends are approached.  Thus, <b>romberg</b> may  be  used  to  integrate  a
       function like f(x)=sin(x)/x over an interval beginning or ending at zero.

       Note  that <b>romberg</b> will either fail to converge or else return incorrect error estimates if the function,
       or any of its derivatives, has a singularity anywhere in the region of integration (except for  the  case
       mentioned  above).   Care must be used, therefore, in integrating a function like 1/(1-x**2) to avoid the
       places where the derivative is singular.

</pre><h4><b>IMPROPER</b> <b>INTEGRALS</b></h4><pre>
       Romberg integration is also useful for integrating functions over half-infinite  intervals  or  functions
       that  have singularities.  The trick is to make a change of variable to eliminate the singularity, and to
       put the singularity at one end or the other of the region of  integration.   The  <b>math::calculus</b>  package
       supplies a number of <b>romberg</b> procedures to deal with the commoner cases.

       <b>romberg_infinity</b>
              Integrates  a function over a half-infinite interval; either <u>a</u> or <u>b</u> may be infinite.  <u>a</u> and <u>b</u> must
              be of the same sign; if you need to integrate across the axis,  say,  from  a  negative  value  to
              positive infinity, use <b>romberg</b> to integrate from the negative value to a small positive value, and
              then   <b>romberg_infinity</b>   to  integrate  from  the  positive  value  to  positive  infinity.   The
              <b>romberg_infinity</b> procedure works by making the change of variable u=1/x, so that the integral from
              a to b of f(x) is evaluated as the integral from 1/a to 1/b of f(1/u)/u**2.

       <b>romberg_powerLawLower</b> and <b>romberg_powerLawUpper</b>
              Integrate a function that has an integrable power law singularity at either  the  lower  or  upper
              bound  of  the  region  of  integration  (or has a derivative with a power law singularity there).
              These procedures take a first parameter, <u>gamma</u>, which gives the power law.  The  function  or  its
              first  derivative  are  presumed  to diverge as (x-<u>a</u>)**(-<u>gamma</u>) or (<u>b</u>-x)**(-<u>gamma</u>).  <u>gamma</u> must be
              greater than zero and less than 1.

              These procedures are useful not only in integrating functions that go to infinity at  one  end  of
              the  region  of  integration,  but also functions whose derivatives do not exist at the end of the
              region.  For instance, integrating f(x)=pow(x,0.25) with the origin as one end of the region  will
              result  in  the  <b>romberg</b> procedure greatly underestimating the error in the integral.  The problem
              can be fixed by observing that the first derivative of f(x), f'(x)=x**(-3/4)/4, goes  to  infinity
              at  the  origin.   Integrating  using <b>romberg_powerLawLower</b> with <u>gamma</u> set to 0.75 gives much more
              orderly convergence.

              These   procedures   operate   by   making   the    change    of    variable    u=(x-a)**(1-gamma)
              (<b>romberg_powerLawLower</b>) or u=(b-x)**(1-gamma) (<b>romberg_powerLawUpper</b>).

              To summarize the meaning of gamma:

              •      If f(x) ~ x**(-a) (0 &lt; a &lt; 1), use gamma = a

              •      If f'(x) ~ x**(-b) (0 &lt; b &lt; 1), use gamma = b

       <b>romberg_sqrtSingLower</b> and <b>romberg_sqrtSingUpper</b>
              These  procedures  behave  identically  to <b>romberg_powerLawLower</b> and <b>romberg_powerLawUpper</b> for the
              common case of <u>gamma</u>=0.5; that  is,  they  integrate  a  function  with  an  inverse  square  root
              singularity at one end of the interval.  They have a simpler implementation involving square roots
              rather than arbitrary powers.

       <b>romberg_expLower</b> and <b>romberg_expUpper</b>
              These procedures are for integrating a function that grows or decreases exponentially over a half-
              infinite interval.  <b>romberg_expLower</b> handles exponentially growing functions, and allows the lower
              limit  of  integration  to  be  an  arbitrarily  large  negative number.  <b>romberg_expUpper</b> handles
              exponentially decaying functions and allows the upper limit of  integration  to  be  an  arbitrary
              large  positive  number.   The  functions  make  the  change  of  variable  u=exp(-x) and u=exp(x)
              respectively.

</pre><h4><b>OTHER</b> <b>CHANGES</b> <b>OF</b> <b>VARIABLE</b></h4><pre>
       If you need an improper integral other than the ones listed here, a change of variable can be written  in
       very few lines of Tcl.  Because the Tcl coding that does it is somewhat arcane, we offer a worked example
       here.

       Let's  say  that  the  function  that we want to integrate is f(x)=exp(x)/sqrt(1-x*x) (not a very natural
       function, but a good example), and we want to integrate it over the  interval  (-1,1).   The  denominator
       falls  to  zero  at  both  ends of the interval. We wish to make a change of variable from x to u so that
       dx/sqrt(1-x**2) maps to du.  Choosing x=sin(u), we can find that dx=cos(u)*du,  and  sqrt(1-x**2)=cos(u).
       The integral from a to b of f(x) is the integral from asin(a) to asin(b) of f(sin(u))*cos(u).

       We  can make a function <b>g</b> that accepts an arbitrary function <b>f</b> and the parameter u, and computes this new
       integrand.

              proc g { f u } {
                  set x [expr { sin($u) }]
                  set cmd $f; lappend cmd $x; set y [eval $cmd]
                  return [expr { $y / cos($u) }]
              }

       Now integrating <b>f</b> from <u>a</u> to <u>b</u> is the same as integrating <b>g</b> from <u>asin(a)</u> to <u>asin(b)</u>.  It's a little tricky
       to get <b>f</b> consistently evaluated in the caller's scope; the following procedure does it.

              proc romberg_sine { f a b args } {
                  set f [lreplace $f 0 0 [uplevel 1 [list namespace which [lindex $f 0]]]]
                  set f [list g $f]
                  return [eval [linsert $args 0 romberg $f [expr { asin($a) }] [expr { asin($b) }]]]
              }

       This <b>romberg_sine</b> procedure will do any function with sqrt(1-x*x) in the denominator. Our sample function
       is f(x)=exp(x)/sqrt(1-x*x):

              proc f { x } {
                  expr { exp($x) / sqrt( 1. - $x*$x ) }
              }

       Integrating it is a matter of applying <b>romberg_sine</b> as we would any of the other <b>romberg</b> procedures:

              foreach { value error } [romberg_sine f -1.0 1.0] break
              puts [format "integral is %.6g +/- %.6g" $value $error]

              integral is 3.97746 +/- 2.3557e-010

</pre><h4><b>BUGS,</b> <b>IDEAS,</b> <b>FEEDBACK</b></h4><pre>
       This document, and the package it describes, will undoubtedly contain bugs and  other  problems.   Please
       report     such     in     the     category     <u>math</u>    <u>::</u>    <u>calculus</u>    of    the    <u>Tcllib</u>    <u>Trackers</u>
       [<a href="http://core.tcl.tk/tcllib/reportlist">http://core.tcl.tk/tcllib/reportlist</a>].  Please also report any ideas for enhancements you may  have  for
       either package and/or documentation.

       When proposing code changes, please provide <u>unified</u> <u>diffs</u>, i.e the output of <b>diff</b> <b>-u</b>.

       Note  further  that  <u>attachments</u>  are strongly preferred over inlined patches. Attachments can be made by
       going to the <b>Edit</b> form of the ticket immediately after its creation, and then using the left-most  button
       in the secondary navigation bar.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       math::calculus, math::interpolate

</pre><h4><b>CATEGORY</b></h4><pre>
       Mathematics

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright (c) 2004 Kevin B. Kenny &lt;<a href="mailto:kennykb@acm.org">kennykb@acm.org</a>&gt;. All rights reserved. Redistribution permitted under the terms of the Open Publication License &lt;<a href="http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/</a>&gt;

tcllib                                                 0.6                         <u>math::calculus::<a href="../man3tcl/romberg.3tcl.html">romberg</a></u>(3tcl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>