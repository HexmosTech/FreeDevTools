<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>instrument - Analysis and Utility Functions for Instrumentation</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/erlang-manpages">erlang-manpages_24.2.1+dfsg-1ubuntu0.5_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       instrument - Analysis and Utility Functions for Instrumentation

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  module  <u>instrument</u>  contains  support  for  studying the resource usage in an Erlang runtime system.
       Currently, only the allocation of memory can be studied.

   <b>Note:</b>
       Note that this whole module is experimental, and the representations used as well as the functionality is
       likely to change in the future.

</pre><h4><b>DATA</b> <b>TYPES</b></h4><pre>
       <b>block_histogram()</b> = tuple()

              A histogram of block sizes where each interval's upper bound is twice as high as  the  one  before
              it.

              The upper bound of the first interval is provided by the function that returned the histogram, and
              the last interval has no upper bound.

       <b>allocation_summary()</b> =
           {HistogramStart :: integer() &gt;= 0,
            UnscannedSize :: integer() &gt;= 0,
            Allocations ::
                #{Origin :: atom() =&gt;
                      #{Type :: atom() =&gt; block_histogram()}}}

              A summary of allocated block sizes (including their headers) grouped by their <u>Origin</u> and <u>Type</u>.

              <u>Origin</u>  is generally which NIF or driver that allocated the blocks, or 'system' if it could not be
              determined.

              <u>Type</u> is the allocation category that the blocks belong to, e.g. <u>db_term</u>, <u>message</u> or <u>binary</u>.

              If one or more carriers could not be scanned in full without harming  the  responsiveness  of  the
              system, <u>UnscannedSize</u> is the number of bytes that had to be skipped.

       <b>carrier_info_list()</b> =
           {HistogramStart :: integer() &gt;= 0,
            Carriers ::
                [{AllocatorType :: atom(),
                  InPool :: boolean(),
                  TotalSize :: integer() &gt;= 0,
                  UnscannedSize :: integer() &gt;= 0,
                  Allocations ::
                      {Type :: atom(),
                       Count :: integer() &gt;= 0,
                       Size :: integer() &gt;= 0},
                  FreeBlocks :: block_histogram()}]}

              <u>AllocatorType</u> is the type of the allocator that employs this carrier.

              <u>InPool</u> is whether the carrier is in the migration pool.

              <u>TotalSize</u> is the total size of the carrier, including its header.

              <u>Allocations</u> is a summary of the allocated blocks in the carrier.

              <u>FreeBlocks</u> is a histogram of the free block sizes in the carrier.

              If  the  carrier  could  not  be scanned in full without harming the responsiveness of the system,
              <u>UnscannedSize</u> is the number of bytes that had to be skipped.

</pre><h4><b>EXPORTS</b></h4><pre>
       <b>allocations()</b> <b>-&gt;</b> <b>{ok,</b> <b>Result}</b> <b>|</b> <b>{error,</b> <b>Reason}</b>

              Types:

                 Result = allocation_summary()
                 Reason = not_enabled

              Shorthand for <u>allocations(#{})</u>.

       <b>allocations(Options)</b> <b>-&gt;</b> <b>{ok,</b> <b>Result}</b> <b>|</b> <b>{error,</b> <b>Reason}</b>

              Types:

                 Result = allocation_summary()
                 Reason = not_enabled
                 Options =
                     #{scheduler_ids =&gt; [integer() &gt;= 0],
                       allocator_types =&gt; [atom()],
                       histogram_start =&gt; integer() &gt;= 1,
                       histogram_width =&gt; integer() &gt;= 1}

              Returns a summary of all tagged allocations in the system, optionally filtered by  allocator  type
              and scheduler id.

              Only  binaries  and  allocations  made  by NIFs and drivers are tagged by default, but this can be
              configured an a per-allocator basis with the <u>+M&lt;S&gt;atags</u> emulator option.

              If the specified allocator types are not enabled, the call will fail with <u>{error,</u> <u>not_enabled}</u>.

              The following options can be used:

                <u>allocator_types</u>:
                  The allocator types that will be searched. Note that blocks can move freely between  allocator
                  types,  so  restricting  the  search  to  certain allocators may return unexpected types (e.g.
                  process heaps when searching binary_alloc), or hide blocks that were migrated out.

                  Defaults to all <u>alloc_util</u> allocators.

                <u>scheduler_ids</u>:
                  The scheduler ids whose allocator instances will be searched. A scheduler id of 0  will  refer
                  to  the  global  instance  that  is  not  tied  to  any  particular scheduler. Defaults to all
                  schedulers and the global instance.

                <u>histogram_start</u>:
                  The upper bound of the first interval in the allocated block size histograms. Defaults to 128.

                <u>histogram_width</u>:
                  The number of intervals in the allocated block size histograms. Defaults to 18.

              <u>Example:</u>

              &gt; instrument:allocations(#{ histogram_start =&gt; 128, histogram_width =&gt; 15 }).
              {ok,{128,0,
                   #{udp_inet =&gt;
                         #{driver_event_state =&gt; {0,0,0,0,0,0,0,0,0,1,0,0,0,0,0}},
                     system =&gt;
                         #{heap =&gt; {0,0,0,0,20,4,2,2,2,3,0,1,0,0,1},
                           db_term =&gt; {271,3,1,52,80,1,0,0,0,0,0,0,0,0,0},
                           code =&gt; {0,0,0,5,3,6,11,22,19,20,10,2,1,0,0},
                           binary =&gt; {18,0,0,0,7,0,0,1,0,0,0,0,0,0,0},
                           message =&gt; {0,40,78,2,2,0,0,0,0,0,0,0,0,0,0},
                           ... }
                     spawn_forker =&gt;
                         #{driver_select_data_state =&gt;
                               {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0}},
                     ram_file_drv =&gt; #{drv_binary =&gt; {0,0,0,0,0,0,1,0,0,0,0,0,0,0,0}},
                     prim_file =&gt;
                         #{process_specific_data =&gt; {2,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
                           nif_trap_export_entry =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0},
                           monitor_extended =&gt; {0,1,0,0,0,0,0,0,0,0,0,0,0,0,0},
                           drv_binary =&gt; {0,0,0,0,0,0,1,0,3,5,0,0,0,1,0},
                           binary =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}},
                     prim_buffer =&gt;
                         #{nif_internal =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0},
                           binary =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}}}}}

       <b>carriers()</b> <b>-&gt;</b> <b>{ok,</b> <b>Result}</b> <b>|</b> <b>{error,</b> <b>Reason}</b>

              Types:

                 Result = carrier_info_list()
                 Reason = not_enabled

              Shorthand for <u>carriers(#{})</u>.

       <b>carriers(Options)</b> <b>-&gt;</b> <b>{ok,</b> <b>Result}</b> <b>|</b> <b>{error,</b> <b>Reason}</b>

              Types:

                 Result = carrier_info_list()
                 Reason = not_enabled
                 Options =
                     #{scheduler_ids =&gt; [integer() &gt;= 0],
                       allocator_types =&gt; [atom()],
                       histogram_start =&gt; integer() &gt;= 1,
                       histogram_width =&gt; integer() &gt;= 1}

              Returns a summary of all carriers in  the  system,  optionally  filtered  by  allocator  type  and
              scheduler id.

              If the specified allocator types are not enabled, the call will fail with <u>{error,</u> <u>not_enabled}</u>.

              The following options can be used:

                <u>allocator_types</u>:
                  The allocator types that will be searched. Defaults to all <u>alloc_util</u> allocators.

                <u>scheduler_ids</u>:
                  The  scheduler  ids whose allocator instances will be searched. A scheduler id of 0 will refer
                  to the global instance that  is  not  tied  to  any  particular  scheduler.  Defaults  to  all
                  schedulers and the global instance.

                <u>histogram_start</u>:
                  The upper bound of the first interval in the free block size histograms. Defaults to 512.

                <u>histogram_width</u>:
                  The number of intervals in the free block size histograms. Defaults to 14.

              <u>Example:</u>

              &gt; instrument:carriers(#{ histogram_start =&gt; 512, histogram_width =&gt; 8 }).
              {ok,{512,
                   [{ll_alloc,1048576,0,1048344,71,false,{0,0,0,0,0,0,0,0}},
                    {binary_alloc,1048576,0,324640,13,false,{3,0,0,1,0,0,0,2}},
                    {eheap_alloc,2097152,0,1037200,45,false,{2,1,1,3,4,3,2,2}},
                    {fix_alloc,32768,0,29544,82,false,{22,0,0,0,0,0,0,0}},
                    {...}|...]}}

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man3erl/erts_alloc.3erl.html">erts_alloc</a>(3erl), <a href="../man1/erl.1.html">erl</a>(1)

Ericsson AB                                        tools 3.5.2                                  <u><a href="../man3erl/instrument.3erl.html">instrument</a></u>(3erl)
</pre>
 </div>
</div></section>
</div>
</body>
</html>