<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>malloc_info - export malloc state to a stream</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       malloc_info - export malloc state to a stream

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/malloc.h">malloc.h</a>&gt;</b>

       <b>int</b> <b>malloc_info(int</b> <u>options</u><b>,</b> <b>FILE</b> <b>*</b><u>stream</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>malloc_info</b>()  function  exports  an  XML  string  that  describes  the current state of the memory-
       allocation implementation in the caller.  The string is printed on the file stream <u>stream</u>.  The  exported
       string includes information about all arenas (see <b><a href="../man3/malloc.3.html">malloc</a></b>(3)).

       As currently implemented, <u>options</u> must be zero.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>malloc_info</b>() returns 0.  On failure, it returns -1, and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EINVAL</b> <u>options</u> was nonzero.

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       For an explanation of the terms used in this section, see <b><a href="../man7/attributes.7.html">attributes</a></b>(7).
       ┌─────────────────────────────────────────────────────────────────────────────┬───────────────┬─────────┐
       │ <b>Interface</b>                                                                   │ <b>Attribute</b>     │ <b>Value</b>   │
       ├─────────────────────────────────────────────────────────────────────────────┼───────────────┼─────────┤
       │ <b>malloc_info</b>()                                                               │ Thread safety │ MT-Safe │
       └─────────────────────────────────────────────────────────────────────────────┴───────────────┴─────────┘

</pre><h4><b>STANDARDS</b></h4><pre>
       GNU.

</pre><h4><b>HISTORY</b></h4><pre>
       glibc 2.10.

</pre><h4><b>NOTES</b></h4><pre>
       The  memory-allocation  information  is provided as an XML string (rather than a C structure) because the
       information may change over time (according to changes in the underlying implementation).  The output XML
       string includes a version field.

       The <b><a href="../man3/open_memstream.3.html">open_memstream</a></b>(3) function can be used to send the output of <b>malloc_info</b>() directly into a buffer  in
       memory, rather than to a file.

       The <b>malloc_info</b>() function is designed to address deficiencies in <b><a href="../man3/malloc_stats.3.html">malloc_stats</a></b>(3) and <b><a href="../man3/mallinfo.3.html">mallinfo</a></b>(3).

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  program  below takes up to four command-line arguments, of which the first three are mandatory.  The
       first argument specifies the number of threads that the program  should  create.   All  of  the  threads,
       including the main thread, allocate the number of blocks of memory specified by the second argument.  The
       third  argument  controls the size of the blocks to be allocated.  The main thread creates blocks of this
       size, the second thread created by the program allocates blocks of twice  this  size,  the  third  thread
       allocates blocks of three times this size, and so on.

       The program calls <b>malloc_info</b>() twice to display the memory-allocation state.  The first call takes place
       before  any threads are created or memory allocated.  The second call is performed after all threads have
       allocated memory.

       In the following example, the command-line arguments specify the creation of one additional  thread,  and
       both  the  main  thread  and  the additional thread allocate 10000 blocks of memory.  After the blocks of
       memory have been allocated, <b>malloc_info</b>() shows the state of two allocation arenas.

           $ <b>getconf</b> <b>GNU_LIBC_VERSION</b>
           glibc 2.13
           $ <b>./a.out</b> <b>1</b> <b>10000</b> <b>100</b>
           ============ Before allocating blocks ============
           &lt;malloc version="1"&gt;
           &lt;heap nr="0"&gt;
           &lt;sizes&gt;
           &lt;/sizes&gt;
           &lt;total type="fast" count="0" size="0"/&gt;
           &lt;total type="rest" count="0" size="0"/&gt;
           &lt;system type="current" size="135168"/&gt;
           &lt;system type="max" size="135168"/&gt;
           &lt;aspace type="total" size="135168"/&gt;
           &lt;aspace type="mprotect" size="135168"/&gt;
           &lt;/heap&gt;
           &lt;total type="fast" count="0" size="0"/&gt;
           &lt;total type="rest" count="0" size="0"/&gt;
           &lt;system type="current" size="135168"/&gt;
           &lt;system type="max" size="135168"/&gt;
           &lt;aspace type="total" size="135168"/&gt;
           &lt;aspace type="mprotect" size="135168"/&gt;
           &lt;/malloc&gt;

           ============ After allocating blocks ============
           &lt;malloc version="1"&gt;
           &lt;heap nr="0"&gt;
           &lt;sizes&gt;
           &lt;/sizes&gt;
           &lt;total type="fast" count="0" size="0"/&gt;
           &lt;total type="rest" count="0" size="0"/&gt;
           &lt;system type="current" size="1081344"/&gt;
           &lt;system type="max" size="1081344"/&gt;
           &lt;aspace type="total" size="1081344"/&gt;
           &lt;aspace type="mprotect" size="1081344"/&gt;
           &lt;/heap&gt;
           &lt;heap nr="1"&gt;
           &lt;sizes&gt;
           &lt;/sizes&gt;
           &lt;total type="fast" count="0" size="0"/&gt;
           &lt;total type="rest" count="0" size="0"/&gt;
           &lt;system type="current" size="1032192"/&gt;
           &lt;system type="max" size="1032192"/&gt;
           &lt;aspace type="total" size="1032192"/&gt;
           &lt;aspace type="mprotect" size="1032192"/&gt;
           &lt;/heap&gt;
           &lt;total type="fast" count="0" size="0"/&gt;
           &lt;total type="rest" count="0" size="0"/&gt;
           &lt;system type="current" size="2113536"/&gt;
           &lt;system type="max" size="2113536"/&gt;
           &lt;aspace type="total" size="2113536"/&gt;
           &lt;aspace type="mprotect" size="2113536"/&gt;
           &lt;/malloc&gt;

   <b>Program</b> <b>source</b>
       #include &lt;<a href="file:/usr/include/err.h">err.h</a>&gt;
       #include &lt;<a href="file:/usr/include/errno.h">errno.h</a>&gt;
       #include &lt;<a href="file:/usr/include/malloc.h">malloc.h</a>&gt;
       #include &lt;<a href="file:/usr/include/pthread.h">pthread.h</a>&gt;
       #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
       #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;

       static size_t        blockSize;
       static size_t        numThreads;
       static unsigned int  numBlocks;

       static void *
       thread_func(void *arg)
       {
           int tn = (int) arg;

           /* The multiplier '(2 + tn)' ensures that each thread (including
              the main thread) allocates a different amount of memory. */

           for (unsigned int j = 0; j &lt; numBlocks; j++)
               if (malloc(blockSize * (2 + tn)) == NULL)
                   err(EXIT_FAILURE, "malloc-thread");

           <a href="../man100/sleep.100.html">sleep</a>(100);         /* Sleep until main thread terminates. */
           return NULL;
       }

       int
       main(int argc, char *argv[])
       {
           int        sleepTime;
           pthread_t  *thr;

           if (argc &lt; 4) {
               fprintf(stderr,
                       "%s num-threads num-blocks block-size [sleep-time]\n",
                       argv[0]);
               exit(EXIT_FAILURE);
           }

           numThreads = atoi(argv[1]);
           numBlocks = atoi(argv[2]);
           blockSize = atoi(argv[3]);
           sleepTime = (argc &gt; 4) ? atoi(argv[4]) : 0;

           thr = calloc(numThreads, sizeof(*thr));
           if (thr == NULL)
               err(EXIT_FAILURE, "calloc");

           printf("============ Before allocating blocks ============\n");
           malloc_info(0, stdout);

           /* Create threads that allocate different amounts of memory. */

           for (size_t tn = 0; tn &lt; numThreads; tn++) {
               errno = pthread_create(&amp;thr[tn], NULL, thread_func,
                                      (void *) tn);
               if (errno != 0)
                   err(EXIT_FAILURE, "pthread_create");

               /* If we add a sleep interval after the start-up of each
                  thread, the threads likely won't contend for malloc
                  mutexes, and therefore additional arenas won't be
                  allocated (see <a href="../man3/malloc.3.html">malloc</a>(3)). */

               if (sleepTime &gt; 0)
                   sleep(sleepTime);
           }

           /* The main thread also allocates some memory. */

           for (unsigned int j = 0; j &lt; numBlocks; j++)
               if (malloc(blockSize) == NULL)
                   err(EXIT_FAILURE, "malloc");

           <a href="../man2/sleep.2.html">sleep</a>(2);           /* Give all threads a chance to
                                  complete allocations. */

           printf("\n============ After allocating blocks ============\n");
           malloc_info(0, stdout);

           exit(EXIT_SUCCESS);
       }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/mallinfo.3.html">mallinfo</a></b>(3), <b><a href="../man3/malloc.3.html">malloc</a></b>(3), <b><a href="../man3/malloc_stats.3.html">malloc_stats</a></b>(3), <b><a href="../man3/mallopt.3.html">mallopt</a></b>(3), <b><a href="../man3/open_memstream.3.html">open_memstream</a></b>(3)

Linux man-pages 6.9.1                              2024-06-15                                     <u><a href="../man3/malloc_info.3.html">malloc_info</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>