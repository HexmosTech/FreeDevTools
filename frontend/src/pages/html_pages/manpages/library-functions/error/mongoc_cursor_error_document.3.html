<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bool</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmongoc-doc">libmongoc-doc_1.30.4-1ubuntu1_all</a> <br><br><pre>
</pre><h4><b>SYNOPSIS</b></h4><pre>
          bool
          mongoc_cursor_error_document (mongoc_cursor_t *cursor,
                                        bson_error_t *error,
                                        const bson_t **reply);

</pre><h4><b>PARAMETERS</b></h4><pre>
       • <b>cursor</b>: A <u>mongoc_cursor_t</u>.

       • <b>error</b>: An optional location for a <u>bson_error_t</u> or <b>NULL</b>.

       • <b>reply</b>: A location for a <u>bson_t</u>.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This function checks to see if an error has occurred while iterating the cursor.

       If  an error occurred client-side, for example if there was a network error or timeout, or the cursor was
       created with invalid parameters, then <b>reply</b> is set to an  empty  BSON  document.  If  an  error  occurred
       server-side, <b>reply</b> is set to the server's reply document with information about the error.

</pre><h4><b>ERRORS</b></h4><pre>
       Errors are propagated via the <b>error</b> and <b>reply</b> parameters.

</pre><h4><b>RETURNS</b></h4><pre>
       False if no error has occurred, otherwise true and <b>error</b> is set.

       If  the  function  returns true and <b>reply</b> is not NULL, then <b>reply</b> is set to a pointer to a BSON document,
       which is either empty or the server's error response. The document is invalid after the cursor  is  freed
       with <u>mongoc_cursor_destroy()</u>.

</pre><h4><b>EXAMPLE</b></h4><pre>
       This  example  shows  the  difference  between  a client-side and server-side error. If the client cannot
       connect to the server, for example, the error message includes "No suitable servers found" and  <b>reply</b>  is
       set to an empty BSON document.

       On  the  other hand, if the client connects to the server successfully and attempts to execute an invalid
       query, the error message comes from the server and <b>reply</b> is set to  the  server's  reply  document,  with
       fields <b>errmsg</b> and <b>code</b>.

          void
          run_query (const char *uri_str, const bson_t *query)
          {
             mongoc_client_t *client;
             mongoc_collection_t *collection;
             mongoc_cursor_t *cursor;
             const bson_t *doc;
             bson_error_t error;
             const bson_t *reply;
             char *str;

             client = mongoc_client_new (uri_str);

             mongoc_client_set_error_api (client, 2);

             collection = mongoc_client_get_collection (client, "db", "collection");
             cursor = mongoc_collection_find_with_opts (
                collection,
                query,
                NULL,  /* additional options */
                NULL); /* read prefs, NULL for default */

             /* this loop is never run: mongoc_cursor_next immediately returns false */
             while (mongoc_cursor_next (cursor, &amp;doc)) {
             }

             if (mongoc_cursor_error_document (cursor, &amp;error, &amp;reply)) {
                str = bson_as_relaxed_extended_json (reply, NULL);
                fprintf (stderr, "Cursor Failure: %s\nReply: %s\n", error.message, str);
                bson_free (str);
             }

             mongoc_cursor_destroy (cursor);
             mongoc_collection_destroy (collection);
             mongoc_client_destroy (client);
          }

          int
          main (int argc, char *argv[])
          {
             bson_t *good_query;
             bson_t *bad_query;

             mongoc_init ();

             /* find documents matching the query {"x": 1} */
             good_query = BCON_NEW ("x", BCON_INT64 (1));

             /* Cause a network error. This will print an error and empty reply document:
              *
              * Cursor Failure: No suitable servers found (`serverSelectionTryOnce` set):
              *     [Failed to resolve 'fake-domain']
              *
              * Reply: { }
              *
              */
             run_query ("mongodb://fake-domain/?appname=cursor-example", good_query);

             /* invalid: {"x": {"$badOperator": 1}} */
             bad_query = BCON_NEW ("x", "{", "$badOperator", BCON_INT64 (1), "}");

             /* Cause a server error. This will print an error and server reply document:
              *
              * Cursor Failure: unknown operator: $badOperator
              *
              * Reply:
              * {"ok": 0.0,
              *  "errmsg":"unknown operator: $badOperator",
              *  "code": 2,
              *  "codeName":"BadValue"
              * }
              *
              */
             run_query ("mongodb://localhost/?appname=cursor-example", bad_query);

             bson_destroy (good_query);
             bson_destroy (bad_query);

             mongoc_cleanup ();

             return 0;
          }

</pre><h4><b>AUTHOR</b></h4><pre>
       MongoDB, Inc

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2009-present, MongoDB, Inc.

1.30.4                                            Jun 08, 2025                   <u><a href="../man3/MONGOC_CURSOR_ERROR_DOCUMENT.3.html">MONGOC_CURSOR_ERROR_DOCUMENT</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>