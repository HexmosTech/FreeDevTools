<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebService::ILS - Standardised library discovery/circulation services</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libwebservice-ils-perl">libwebservice-ils-perl_0.18-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       WebService::ILS - Standardised library discovery/circulation services

</pre><h4><b>SYNOPSIS</b></h4><pre>
           use WebService::ILS::&lt;Provider Subclass&gt;;
           my $ils = WebService::ILS::&lt;Provider Subclass&gt;-&gt;new({
               client_id =&gt; $client_id,
               client_secret =&gt; $client_secret
           });
           my %search_params = (
               query =&gt; "Some keyword",
               sort =&gt; "rating",
           );
           my $result = $ils-&gt;search(\%search_params);
           foreach (@{ $result-&gt;{items} }) {
               ...
           }
           foreach (2..$result-&gt;{pages}) {
               $search_params{page} = $_;
               my $next_results = $ils-&gt;search(\%search_params);
               ...
           }

           or

           my $native_result = $ils-&gt;native_search(\%native_search_params);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       WebService::ILS is an attempt to create a standardised interface for online library services providers.

       In addition, native API interface is provided.

       Here we will describe constructor parameters and methods common to all service providers. Diversions and
       native interfaces are documented in corresponding modules.

   <b>Supported</b> <b>service</b> <b>providers</b>
       <b>WebService::ILS::OverDrive::Library</b>
           OverDrive Library API &lt;https://developer.overdrive.com/discovery-apis&gt;

       <b>WebService::ILS::OverDrive::Patron</b>
           OverDrive Circulation API &lt;https://developer.overdrive.com/circulation-apis&gt;

</pre><h4><b>INTERFACE</b></h4><pre>
   <b>Error</b> <b>handling</b>
       Method calls will die on error. $@ will contain a multi-line string.  See "error_message()" below.

   <b>Item</b> <b>record</b>
       Item record is returned by many methods, so we specify it here.

       "id"
       "isbn"
       "title"
       "subtitle"
       "description"
       "author"
       "publisher"
       "publication_date"
       "language"
       "rating"         =&gt; user ratings metrics
       "popularity"     =&gt; checkout metrics
       "subjects"       =&gt; subject categories (tags)
       "facets"         =&gt; a hashref of facet =&gt; [values]
       "media"          =&gt; book, e-book, video, audio etc
       "formats"        =&gt; an arrayref of available formats
       "images"         =&gt; a hashref of size =&gt; url
       "encryption_key" =&gt; for decryption purposes
       "drm"            =&gt; subject to drm

       Not all fields are available for all service providers.  Field values are not standardised.

</pre><h4><b>CONSTRUCTOR</b></h4><pre>
   <b>new</b> <b>(%params_hash</b> <b>or</b> <b>$params_hashref)</b>
       <u>Client</u> <u>(vendor)</u> <u>related</u> <u>constructor</u> <u>params,</u> <u>given</u> <u>by</u> <u>service</u> <u>provider:</u>

       "client_id"     =&gt; client (vendor) identifier
       "client_secret" =&gt; secret key (password)
       "library_id"    =&gt; sometimes service providers provide access to different "libraries"

       <u>General</u> <u>constructor</u> <u>params:</u>

       "user_agent"        =&gt; LWP::UserAgent or a derivative; usually not needed, one is created for you.
       "user_agent_params" =&gt; LWP::UserAgent constructor params so you don't need to create user agent yourself
       "access_token"      =&gt; as returned from the provider authentication system
       "access_token_type" =&gt; as returned from the provider authentication system

       These are also read-only attributes

       Not all of client/library params are required for all service providers.

</pre><h4><b>ATTRIBUTES</b></h4><pre>
   <b>user_agent</b>
       As  provided  to constructor, or auto created. Useful if one wants to change user agent attributes on the
       fly, eg

           $ils-&gt;user_agent-&gt;<a href="../man120/timeout.120.html">timeout</a>(120);

</pre><h4><b>DISCOVERY</b> <b>METHODS</b></h4><pre>
   <b>search</b> <b>($params_hashref)</b>
       <u>Input</u> <u>params:</u>

       "query"     =&gt; query (search) string
       "page_size" =&gt; number of items per results page
       "page"      =&gt; wanted page number
       "sort"      =&gt; resultset sort option (see below)

       Sort  options are either an array or a comma separated string of options:

       "publication_date" =&gt; date title was published
       "available_date"   =&gt; date title became available for users
       "rating"           =&gt; number of items per results page

       Sort order can be added after option with ":", eg "publication_date:desc,rating:desc"

       <u>Returns</u> <u>search</u> <u>results</u> <u>record:</u>

       "items"      =&gt; an array of item records
       "page_size"  =&gt; number of items per results page
       "page"       =&gt; results page number
       "pages"      =&gt; total number of pages
       "total"      =&gt; total number of items found by the search

   <b>item_metadata</b> <b>($item_id)</b>
       <u>Returns</u> <u>item</u> <u>record</u>

   <b>item_availability</b> <b>($item_id)</b>
       <u>Returns</u> <u>item</u> <u>availability</u> <u>record:</u>

       "id"
       "available"        =&gt; boolean
       "copies_available" =&gt; number of copies available
       "copies_owned"     =&gt; number of copies owned
       "type"             =&gt; availability type, provider dependant

       Not  all  fields  are  available  for  all  service  providers.    For   example,   some   will   provide
       "copies_available", making "available" redundant, whereas others will just provide "available".

   <b>is_item_available</b> <b>($item_id)</b>
       <u>Returns</u> <u>boolean</u>

       Simplified version of <b>item_availability()</b>

</pre><h4><b>INDIVIDUAL</b> <b>USER</b> <b>AUTHENTICATION</b> <b>AND</b> <b>METHODS</b></h4><pre>
   <b>user_id</b> <b>/</b> <b>password</b>
       Provider authentication API is used to get an authorized session.

       <u>auth_by_user_id($user_id,</u> <u>$password)</u>

       An example:

           my $ils = WebService::ILS::Provider({
               client_id =&gt; $client_id,
               client_secret =&gt; $client_secret,
           });
           eval { $ils-&gt;auth_by_user_id( $user_id, $password ) };
           if ($@) { some_error_handling(); return; }
           $session{ils_access_token} = $ils-&gt;access_token;
           $session{ils_access_token_type} = $ils-&gt;access_token_type;
           ...
           Somewhere else in your app:
           my $ils = WebService::ILS::Provider({
               client_id =&gt; $client_id,
               client_secret =&gt; $client_secret,
               access_token =&gt; $session{ils_access_token},
               access_token_type =&gt; $session{ils_access_token_type},
           });

           my $checkouts = $ils-&gt;checkouts;

   <b>Authentication</b> <b>at</b> <b>the</b> <b>provider</b>
       User  is  redirected  to  the  provider  authentication  url,  and  after  authenticating at the provider
       redirected back with some kind of auth token.  Requires url to handle return redirect from the provider.

       It can be used as an alternative to FB and Google auth.

       This is just to give an idea, specifics heavily depend on the provider

       <u>auth_url</u> <u>($redirect_back_uri)</u>

       Returns provider authentication url to redirect to

       <u>auth_token_param_name</u> <u>()</u>

       Returns auth code url param name

       <u>auth_by_token</u> <u>($provider_token)</u>

       An example:

           my $ils = WebService::ILS::Provider({
               client_id =&gt; $client_id,
               client_secret =&gt; $client_secret,
           });
           my $redirect_url = $ils-&gt;auth_url("<a href="http://myapp.com/ils-auth">http://myapp.com/ils-auth</a>");
           $response-&gt;redirect($redirect_url);
           ...
           After successful authentication at the provider, provider redirects
           back to specified app url (<a href="http://myapp.com/ils-auth">http://myapp.com/ils-auth</a>)

           /ils-auth handler:
           my $auth_token = $req-&gt;param( $ils-&gt;auth_token_param_name )
               or some_error_handling(), return;
           local $@;
           eval { $ils-&gt;auth_by_token( $auth_token ) };
           if ($@) { some_error_handling(); return; }
           $session{ils_access_token} = $ils-&gt;access_token;
           $session{ils_access_token_type} = $ils-&gt;access_token_type;
           ...
           Somewhere else in your app:
           passing access token to the constructor as above

</pre><h4><b>CIRCULATION</b> <b>METHODS</b></h4><pre>
   <b>patron</b> <b>()</b>
       <u>Returns</u> <u>patron</u> <u>record:</u>

       "id"
       "active"            =&gt; boolean
       "copies_available"  =&gt; number of copies available
       "checkout_limit"    =&gt; number of checkouts allowed
       "hold_limit"        =&gt; number of holds allowed

   <b>holds</b> <b>()</b>
       <u>Returns</u> <u>holds</u> <u>record:</u>

       "total"             =&gt; number of items on hold
       "items"             =&gt; list of individual items

       In addition to Item record fields described above, item records will have:

       "placed_datetime"   =&gt; hold timestamp, with or without timezone
       "queue_position"    =&gt; user's position in the waiting queue, if available

   <b>place_hold</b> <b>($item_id)</b>
       <u>Returns</u> <u>holds</u> <u>item</u> <u>record</u> <u>(as</u> <u>described</u> <u>above)</u>

       In addition, "total" field will be incorported as well.

   <b>remove_hold</b> <b>($item_id)</b>
       <u>Returns</u> <u>true</u> <u>to</u> <u>indicate</u> <u>success</u>

       Returns true in case user does not have a hold on the item.   Throws  exception  in  case  of  any  other
       failure.

   <b>checkouts</b> <b>()</b>
       <u>Returns</u> <u>checkout</u> <u>record:</u>

       "total"             =&gt; number of items on hold
       "items"             =&gt; list of individual items

       In addition to Item record fields described above, item records will have:

       "checkout_datetime" =&gt; checkout timestamp, with or without timezone
       "expires"           =&gt; date (time) checkout expires
       "url"               =&gt; download/stream url
       "files"             =&gt; an arrayref of downloadable file details title, url, size

   <b>checkout</b> <b>($item_id)</b>
       <u>Returns</u> <u>checkout</u> <u>item</u> <u>record</u> <u>(as</u> <u>described</u> <u>above)</u>

       In addition, "total" field will be incorported as well.

   <b>return</b> <b>($item_id)</b>
       <u>Returns</u> <u>true</u> <u>to</u> <u>indicate</u> <u>success</u>

       Returns  true  in  case  user  does not have the item checked out.  Throws exception in case of any other
       failure.

</pre><h4><b>NATIVE</b> <b>METHODS</b></h4><pre>
       All Discovery and Circulation methods (with exception of <b>remove_hold()</b> and <b>return()</b>, where  it  does  not
       make    sense)    have   native_*()   counterparts,   eg   <b>native_search()</b>,   <b>native_item_availability()</b>,
       <b>native_checkout()</b> etc.

       In case of single item methods, <b>native_item_availability()</b>, <b>native_checkout()</b> etc, they take  item_id  as
       parameter. Otherwise, it's a hashref of HTTP request params (GET or POST).

       Return value is a record as returned by API.

       Individual provider subclasses provide additional provider specific native methods.

</pre><h4><b>UTILITY</b> <b>METHODS</b></h4><pre>
   <b>Error</b> <b>constants</b>
       "ERROR_ACCESS_TOKEN"
       "ERROR_NOT_AUTHENTICATED"

   <b>error_message</b> <b>($exception_string)</b>
       <u>Returns</u> <u>error</u> <u>message</u> <u>probably</u> <u>suitable</u> <u>for</u> <u>displaying</u> <u>to</u> <u>the</u> <u>user</u>

       Example:

           my $res = eval { $ils-&gt;checkout($id) };
           if ($@) {
               my $msg = $ils-&gt;error_message($@);
               display($msg);
               log_error($@);
           }

   <b>is_access_token_error</b> <b>($exception_string)</b>
       <u>Returns</u> <u>true</u> <u>if</u> <u>the</u> <u>error</u> <u>is</u> <u>access</u> <u>token</u> <u>related</u>

   <b>is_not_authenticated_error</b> <b>($exception_string)</b>
       <u>Returns</u> <u>true</u> <u>if</u> <u>the</u> <u>error</u> <u>is</u> <u>"Not</u> <u>authenticated"</u>

</pre><h4><b>TODO</b></h4><pre>
       Federated search

</pre><h4><b>LICENSE</b></h4><pre>
       Copyright (C) Catalyst IT NZ Ltd Copyright (C) Bywater Solutions

       This  library  is  free  software;  you can redistribute it and/or modify it under the same terms as Perl
       itself.

</pre><h4><b>AUTHOR</b></h4><pre>
       Srdjan JankoviX &lt;<a href="mailto:srdjan@catalyst.net.nz">srdjan@catalyst.net.nz</a>&gt;

perl v5.36.0                                       2022-11-29                               <u>WebService::<a href="../man3pm/ILS.3pm.html">ILS</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>