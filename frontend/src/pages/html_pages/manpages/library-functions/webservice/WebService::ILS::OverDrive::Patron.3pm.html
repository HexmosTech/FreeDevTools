<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebService::ILS::OverDrive::Patron - WebService::ILS module for OverDrive circulation services</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libwebservice-ils-perl">libwebservice-ils-perl_0.18-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       WebService::ILS::OverDrive::Patron - WebService::ILS module for OverDrive circulation services

</pre><h4><b>SYNOPSIS</b></h4><pre>
           use WebService::ILS::OverDrive::Patron;

</pre><h4><b>DESCRIPTION</b></h4><pre>
       These services require individual user credentials.  See "WebService::ILS INDIVIDUAL USER AUTHENTICATION
       AND METHODS"

       See WebService::ILS::OverDrive

</pre><h4><b>CONSTRUCTOR</b></h4><pre>
   <b>new</b> <b>(%params_hash</b> <b>or</b> <b>$params_hashref)</b>
       <u>Additional</u> <u>constructor</u> <u>params:</u>

       "auth_token" =&gt; auth token as previously obtained

</pre><h4><b>INDIVIDUAL</b> <b>USER</b> <b>AUTHENTICATION</b> <b>METHODS</b></h4><pre>
   <b>auth_by_user_id</b> <b>($user_id,</b> <b>$password,</b> <b>$website_id,</b> <b>$authorization_name)</b>
       "website_id" and "authorization_name" (domain) are provided by OverDrive

       <u>Returns</u> <u>(access_token,</u> <u>access_token_type)</u> <u>or</u> <u>access_token</u>

   <b>Authentication</b> <b>at</b> <b>OverDrive</b> <b>-</b> <b>Granted</b> <b>or</b> <b>"3-Legged"</b> <b>Authorization</b>
       With  OverDrive  there's an extra step - an auth code is returned to the redirect back handler that needs
       to make an API call to convert it into a auth token.

       An example:

           my $overdrive = WebService::ILS::OverDrive::Patron({
               client_id =&gt; $client_id,
               client_secret =&gt; $client_secret,
               library_id =&gt; $library_id,
           });
           my $redirect_url = $overdrive-&gt;auth_url("<a href="http://myapp.com/overdrive-auth">http://myapp.com/overdrive-auth</a>");
           $response-&gt;redirect($redirect_url);
           ...
           /overdrive-auth handler:
           my $auth_code = $req-&gt;param( $overdrive-&gt;auth_code_param_name )
               or some_error_handling(), return;
           # my $state = $req-&gt;param( $overdrive-&gt;state_token_param_name )...
           local $@;
           eval { $overdrive-&gt;auth_by_code( $auth_code ) };
           if ($@) { some_error_handling(); return; }
           $session{overdrive_access_token} = $access_token;
           $session{overdrive_access_token_type} = $access_token_type;
           $session{overdrive_auth_token} = $auth_token;
           ...
           Somewhere else in your app:
           my $ils = WebService::ILS::Provider({
               client_id =&gt; $client_id,
               client_secret =&gt; $client_secret,
               access_token =&gt; $session{overdrive_access_token},
               access_token_type =&gt; $session{overdrive_access_token_type},
               auth_token = $session{overdrive_auth_token}
           });
           my $checkouts = $overdrive-&gt;checkouts;

   <b>auth_url</b> <b>($redirect_uri,</b> <b>$state_token)</b>
       <u>Input</u> <u>params:</u>

       "redirect_uri" =&gt; return url which will handle redirect back after auth
       "state_token"  =&gt; a token that is returned back unchanged;
                         for additional security; not required

   <b>auth_code_param_name</b> <b>()</b>
   <b>state_token_param_name</b> <b>()</b>
   <b>auth_by_code</b> <b>($provider_code,</b> <b>$redirect_uri)</b>
       <u>Returns</u> <u>(access_token,</u> <u>access_token_type,</u> <u>auth_token)</u> <u>or</u> <u>access_token</u>

   <b>auth_by_token</b> <b>($provider_token)</b>
       <u>Returns</u> <u>(access_token,</u> <u>access_token_type,</u> <u>auth_token)</u> <u>or</u> <u>access_token</u>

</pre><h4><b>CIRCULATION</b> <b>METHOD</b> <b>SPECIFICS</b></h4><pre>
       Differences to general WebService::ILS interface

   <b>place_hold</b> <b>($item_id,</b> <b>$notification_email_address,</b> <b>$auto_checkout)</b>
       $notification_email_address and $auto_checkout are optional.  $auto_checkout defaults to false.

       <u>Returns</u> <u>holds</u> <u>item</u> <u>record</u>

       It is preferred that the $notification_email_address is specified.

       If $auto_checkout is set to true, the item will be checked out as soon as it becomes available.

   <b>checkouts</b> <b>()</b>
       For formats see "checkout_formats()" below

   <b>checkout</b> <b>($item_id,</b> <b>$format,</b> <b>$allow_multiple_format_checkouts)</b>
       $format and $allow_multiple_format_checkouts are optional.  $allow_multiple_format_checkouts defaults  to
       false.

       <u>Returns</u> <u>checkout</u> <u>item</u> <u>record</u>

       An item can be available in multiple formats. Checkout is complete only when the format is specified.

       Checkout can be actioned without format being specified. In that case an early return can be actioned. To
       complete  checkout  format  must  be  locked later (see <b>lock_format()</b> below). That would be the case with
       <b>place_hold()</b> with $auto_checkout set to true. Once format is locked, an early return is not possible.

       If $allow_multiple_format_checkouts flag is set to true,  multiple  formats  of  the  same  item  can  be
       acioned.  If it is false (default) and the item was already checked out, the checked out item record will
       be returned regardless of the format.

       Checkout record will have an extra field "format" if format is locked in.

   <b>checkout_formats</b> <b>($item_id)</b>
       <u>Returns</u> <u>a</u> <u>hashref</u> <u>of</u> <u>available</u> <u>title</u> <u>formats</u> <u>and</u> <u>immediate</u> <u>availability</u>

         { format =&gt; available, ... }

       If format is not immediately available it must be locked first

   <b>lock_format</b> <b>($item_id,</b> <b>$format)</b>
       <u>Returns</u> <u>locked</u> <u>format</u> <u>(should</u> <u>be</u> <u>the</u> <u>same</u> <u>as</u> <u>the</u> <u>input</u> <u>value)</u>

   <b>checkout_download_url</b> <b>($item_id,</b> <b>$format,</b> <b>$error_url,</b> <b>$success_url)</b>
       <u>Returns</u> <u>OverDrive</u> <u>download</u> <u>url</u>

       Checked out items must be downloaded by users on the OverDrive site.  This method returns the  url  where
       the  user should be sent to (redirected).  Once the download is complete, user will be redirected back to
       $error_url in case of an error, otherwise to optional $success_url if specified.

       See &lt;https://developer.overdrive.com/apis/download&gt;

</pre><h4><b>NATIVE</b> <b>METHODS</b></h4><pre>
   <b>native_patron</b> <b>()</b>
       See &lt;https://developer.overdrive.com/apis/patron-information&gt;

   <b>native_holds</b> <b>()</b>
   <b>native_place_hold</b> <b>($item_id,</b> <b>$notification_email_address,</b> <b>$auto_checkout)</b>
       See &lt;https://developer.overdrive.com/apis/holds&gt;

   <b>native_checkouts</b> <b>()</b>
   <b>native_checkout_info</b> <b>($item_id)</b>
   <b>native_checkout</b> <b>($item_id,</b> <b>$format,</b> <b>$allow_multiple_format_checkouts)</b>
   <b>native_checkout_formats</b> <b>($item_id)</b>
   <b>native_lock_format</b> <b>($item_id,</b> <b>$format)</b>
       See &lt;https://developer.overdrive.com/apis/checkouts&gt;

</pre><h4><b>LICENSE</b></h4><pre>
       Copyright (C) Catalyst IT NZ Ltd Copyright (C) Bywater Solutions

       This library is free software; you can redistribute it and/or modify it under  the  same  terms  as  Perl
       itself.

</pre><h4><b>AUTHOR</b></h4><pre>
       Srdjan JankoviX &lt;<a href="mailto:srdjan@catalyst.net.nz">srdjan@catalyst.net.nz</a>&gt;

perl v5.36.0                                       2022-11-29             <u>WebService::ILS...erDrive::<a href="../man3pm/Patron.3pm.html">Patron</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>