<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VM::EC2::Dispatch - Create Perl objects from AWS XML requests</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libvm-ec2-perl">libvm-ec2-perl_1.28-5_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       VM::EC2::Dispatch - Create Perl objects from AWS XML requests

</pre><h4><b>SYNOPSIS</b></h4><pre>
         use VM::EC2;

         VM::EC2::Dispatch-&gt;register('DescribeRegions'=&gt;\&amp;mysub);

         VM::EC2::Dispatch-&gt;replace('DescribeRegions'=&gt;'My::Type');

         sub mysub {
             my ($parsed_xml_object,$ec2) = @_;
             my $payload = $parsed_xml_object-&gt;{regionInfo}
             return My::Type-&gt;new($payload,$ec2);
         }

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This class handles turning the XML response to AWS requests into perl objects. Only one method is likely
       to be useful to developers, the <b>replace()</b> class method. This allows you to replace the handlers used to
       map the response onto objects.

   <b>VM::EC2::Dispatch-&gt;replace($request_name</b> <b>=&gt;</b> <b>\&amp;sub)</b>
   <b>VM::EC2::Dispatch-&gt;replace($request_name</b> <b>=&gt;</b> <b>'Class::Name')</b>
   <b>VM::EC2::Dispatch-&gt;replace($request_name</b> <b>=&gt;</b> <b>'method_name,arg1,arg2,...')</b>
       Before invoking a VM::EC2 request you wish to customize, call the <b>replace()</b> method with two arguments.
       The first argument is the name of the request you wish to customize, such as "DescribeVolumes". The
       second argument is either a code reference, a VM::EC2::Dispatch method name and arguments (separated by
       commas), or a class name.

       In the case of a code reference as the second argument, the subroutine you provide will be invoked with
       four arguments consisting of the parsed XML response, the VM::EC2 object, the XML namespace string from
       the request, and the Amazon-assigned request ID. In practice, only the first two arguments are useful.

       In the case of a string containing a classname, the class will be loaded if it needs to be, and then its
       <b>new()</b> method invoked as follows:

         Your::Class-&gt;new($parsed_xml,$ec2,$xmlns,$requestid)

       Your <b>new()</b> method should return one or more objects. It is suggested that you subclass VM::EC2::Generic
       and use the inherited <b>new()</b> method to store the parsed XML and EC2 object. See the code for
       VM::EC2::AvailabilityRegion for a simple template.

       If the second argument is neither a code reference nor a classname, it will be treated as a
       VM::EC2::Dispatch method name and its arguments, separated by commas. The method will be invoked as
       follows:

        $dispatch-&gt;$method_name($raw_xml,$ec2,$arg1,$arg2,$arg3,...)

       There are two methods currently defined for this purpose, <b>boolean()</b>, and <b>fetch_items()</b>, which handle the
       preprocessing of several common XML representations of EC2 data. Note that in this form, the RAW XML is
       passed in, not the parsed data structure.

       The parsed XML response is generated by the XML::Simple module using these options:

         $parser = XML::Simple-&gt;new(ForceArray    =&gt; ['item', 'member'],
                                    KeyAttr       =&gt; ['key'],
                                    SuppressEmpty =&gt; undef);
         $parsed = $parser-&gt;XMLin($raw_xml)

       In general, this will give you a hash of hashes. Any tag named 'item' or 'member' will be forced to point
       to an array reference, and any tag named "key" will be flattened as described in the XML::Simple
       documentation.

       A simple way to examine the raw parsed XML is to invoke any VM::EC2::Object's as_string method:

        my ($i) = $ec2-&gt;describe_instances;
        print $i-&gt;as_string;

       This will give you a Data::Dumper representation of the XML after it has been parsed. Look at the calls
       to VM::EC2::Dispatch-&gt;<b>register()</b> in the various VM/EC2/REST/*.pm modules for many examples of how this
       works.

       Note that the <b>replace()</b> method was called <b>add_override()</b> in previous versions of this module.
       <b>add_override()</b> is recognized as an alias for backward compatibility.

   <b>VM::EC2::Dispatch-&gt;register($request_name1</b> <b>=&gt;</b> <b>\&amp;sub1,$request_name2</b> <b>=&gt;</b> <b>\&amp;sub2,...)</b>
       Similar to <b>replace()</b> but if the request name is already registered does not overwrite it. You may provide
       multiple request=&gt;handler pairs.

</pre><h4><b>OBJECT</b> <b>CREATION</b> <b>METHODS</b></h4><pre>
       The following methods perform simple pre-processing of the parsed XML (a hash of hashes) before passing
       the modified data structure to the designated object class. They are used as the second argument to
       VM::EC2::Dispatch-&gt;<b>register()</b>.

   <b>$bool</b> <b>=</b> <b>$dispatch-&gt;boolean($raw_xml,$ec2,$tag)</b>
       This is used for XML responses like this:

        &lt;DeleteVolumeResponse xmlns="<a href="http://ec2.amazonaws.com/doc/2011-05-15/">http://ec2.amazonaws.com/doc/2011-05-15/</a>"&gt;
           &lt;requestId&gt;59dbff89-35bd-4eac-99ed-be587EXAMPLE&lt;/requestId&gt;
           &lt;return&gt;true&lt;/return&gt;
        &lt;/DeleteVolumeResponse&gt;

       It looks inside the structure for the tag named $tag ("return" if not provided), and returns a true value
       if the contents equals "true".

       Pass it to <b>replace()</b> like this:

         VM::EC2::Dispatch-&gt;replace(DeleteVolume =&gt; 'boolean,return';

       or, since "return" is the default tag:

         VM::EC2::Dispatch-&gt;replace(DeleteVolume =&gt; 'boolean';

   <b>@list</b> <b>=</b> <b>$dispatch-&gt;elb_member_list($raw_xml,$ec2,$tag)</b>
       This is used for XML responses from the ELB API such as this:

        &lt;DisableAvailabilityZonesForLoadBalancerResponse xmlns="<a href="http://elasticloadbalancing.amazonaws.com/doc/2011-11-15/">http://elasticloadbalancing.amazonaws.com/doc/2011-11-15/</a>"&gt;
          &lt;DisableAvailabilityZonesForLoadBalancerResult&gt;
            &lt;AvailabilityZones&gt;
              &lt;member&gt;us-west-2a&lt;/member&gt;
              &lt;member&gt;us-west-2b&lt;/member&gt;
            &lt;/AvailabilityZones&gt;
          &lt;/DisableAvailabilityZonesForLoadBalancerResult&gt;
          &lt;ResponseMetadata&gt;
            &lt;RequestId&gt;02eadcfc-fc38-11e1-a1bf-9de31EXAMPLE&lt;/RequestId&gt;
          &lt;/ResponseMetadata&gt;
        &lt;/DisableAvailabilityZonesForLoadBalancerResponse&gt;

       It looks inside the Result structure for the tag named $tag and returns the list wrapped in member
       elements.  In this case the tag is 'AvailabilityZones' and the return value would be: ( 'us-west-2a',
       'us-west-2b' )

       If $embedded_tag is passed, then it is used for XML responses such as this, where the member list has an
       embedded tag:

        &lt;RegisterInstancesWithLoadBalancerResponse xmlns="<a href="http://elasticloadbalancing.amazonaws.com/doc/2011-11-15/">http://elasticloadbalancing.amazonaws.com/doc/2011-11-15/</a>"&gt;
          &lt;RegisterInstancesWithLoadBalancerResult&gt;
            &lt;Instances&gt;
              &lt;member&gt;
                &lt;InstanceId&gt;i-12345678&lt;/InstanceId&gt;
              &lt;/member&gt;
              &lt;member&gt;
                &lt;InstanceId&gt;i-90abcdef&lt;/InstanceId&gt;
              &lt;/member&gt;
            &lt;/Instances&gt;
          &lt;/RegisterInstancesWithLoadBalancerResult&gt;
          &lt;ResponseMetadata&gt;
            &lt;RequestId&gt;f4f12596-fc3b-11e1-be5a-f71ecEXAMPLE&lt;/RequestId&gt;
          &lt;/ResponseMetadata&gt;
        &lt;/RegisterInstancesWithLoadBalancerResponse&gt;

       It looks inside the Result structure for the tag named $tag and returns the list wrapped in a member
       element plus the embedded tag.  In this case the tag is 'Instances', the embedded tag is 'InstanceId' and
       the return value would be: ( 'i-12345678', 'i-90abcdef' )

   <b>fetch_items($raw_xml,$ec2,$container_tag,$object_class,$nokey)</b>
       @objects = $dispatch-&gt;fetch_items($raw_xml,$ec2,$container_tag,$object_class,$nokey)

       This is used for XML responses like this:

        &lt;DescribeKeyPairsResponse xmlns="<a href="http://ec2.amazonaws.com/doc/2011-05-15/">http://ec2.amazonaws.com/doc/2011-05-15/</a>"&gt;
           &lt;requestId&gt;59dbff89-35bd-4eac-99ed-be587EXAMPLE&lt;/requestId&gt;
           &lt;keySet&gt;
             &lt;item&gt;
                &lt;keyName&gt;gsg-keypair&lt;/keyName&gt;
                &lt;keyFingerprint&gt;
                1f:51:ae:28:bf:89:e9:d8:1f:25:5d:37:2d:7d:b8:ca:9f:f5:f1:6f
                &lt;/keyFingerprint&gt;
             &lt;/item&gt;
             &lt;item&gt;
                &lt;keyName&gt;default-keypair&lt;/keyName&gt;
                &lt;keyFingerprint&gt;
                0a:93:bb:e8:c2:89:e9:d8:1f:42:5d:37:1d:8d:b8:0a:88:f1:f1:1a
                &lt;/keyFingerprint&gt;
             &lt;/item&gt;
          &lt;/keySet&gt;
        &lt;/DescribeKeyPairsResponse&gt;

       It looks inside the structure for the tag named $container_tag, pulls out the items that are stored under
       &lt;item&gt; and then passes the parsed contents to $object_class-&gt;<b>new()</b>. The optional $nokey argument is used
       to suppress XML::Simple's default flattening behavior turning tags named "key" into hash keys.

       Pass it to <b>replace()</b> like this:

         VM::EC2::Dispatch-&gt;replace(DescribeVolumes =&gt; 'fetch_items,volumeSet,VM::EC2::Volume')

   <b>@objects</b> <b>=</b> <b>$dispatch-&gt;fetch_members($raw_xml,$ec2,$container_tag,$object_class,$nokey)</b>
       Used for XML responses from ELB API calls which contain a key that is the name of the API call with
       'Result' appended.  All these XML responses contain 'member' as the item delimiter instead of 'item'

   <b>@objects</b> <b>=</b> <b>$dispatch-&gt;fetch_rds_objects($raw_xml,$ec2,$container_tag,$object_class,$nokey)</b>
       Used for XML responses from RDS API calls which contain a key that is the name of the API call with
       'Result' appended.  In addition, the structure is a list of objects wrapped in a plural version of the
       object's name.

   <b>@objects</b> <b>=</b> <b>$dispatch-&gt;fetch_items_iterator($raw_xml,$ec2,$container_tag,$object_class,$token_name)</b>
       This is used for requests that have a -max_results argument. In this case, the response will have a
       nextToken field, which can be used to fetch the "next page" of results.

       The $token_name is some unique identifying token. It will be turned into two temporary EC2 instance
       variables, one named "${token_name}_token", which contains the nextToken value, and the other
       "${token_name}_stop", which flags the caller that no more results will be forthcoming.

       This must all be coordinated with the request subroutine. See how <b>describe_instance_status()</b> and
       <b>describe_spot_price_history()</b> do it.

</pre><h4><b>EXAMPLE</b> <b>OF</b> <b>USING</b> <b>OVERRIDE</b> <b>TO</b> <b>SUBCLASS</b> <b>VM::EC2::Volume</b></h4><pre>
       The author decided that a volume object should not be able to delete itself; you disagree with that
       decision. Let's subclass VM::EC2::Volume to add a <b>delete()</b> method.

       First subclass the VM::EC2::Volume class:

        package MyVolume;
        use base 'VM::EC2::Volume';

        sub delete {
           my $self = shift;
           $self-&gt;ec2-&gt;delete_volume($self);
        }

       Now subclass VM::EC2 to add the appropriate overrides to the <b>new()</b> method:

        package MyEC2;
        use base 'VM::EC2';

        sub new {
          my $class = shift;
          VM::EC2::Dispatch-&gt;replace(CreateVolume   =&gt;'MyVolume');
          VM::EC2::Dispatch-&gt;replace(DescribeVolumes=&gt;'fetch_items,volumeSet,MyVolume');
          return $class-&gt;SUPER::new(@_);
        }

       Now we can test it out:

        use MyEC2;
        # find all volumes that are "available" and not in-use
        my @vol = $ec2-&gt;describe_volumes({status=&gt;'available'});
        for my $vol (@vol) {
           $vol-&gt;delete &amp;&amp; print "$vol deleted\n"
        }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       VM::EC2 VM::EC2::Object VM::EC2::Generic VM::EC2::BlockDevice VM::EC2::BlockDevice::Attachment
       VM::EC2::BlockDevice::Mapping VM::EC2::BlockDevice::Mapping::EBS VM::EC2::Error VM::EC2::Generic
       VM::EC2::Group VM::EC2::Image VM::EC2::Instance VM::EC2::Instance::ConsoleOutput VM::EC2::Instance::Set
       VM::EC2::Instance::State VM::EC2::Instance::State::Change VM::EC2::Instance::State::Reason
       VM::EC2::Region VM::EC2::ReservationSet VM::EC2::SecurityGroup VM::EC2::Snapshot VM::EC2::Tag
       VM::EC2::Volume

</pre><h4><b>AUTHOR</b></h4><pre>
       Lincoln Stein &lt;<a href="mailto:lincoln.stein@gmail.com">lincoln.stein@gmail.com</a>&gt;.

       Copyright (c) 2011 Ontario Institute for Cancer Research

       This package and its accompanying libraries is free software; you can redistribute it and/or modify it
       under the terms of the GPL (either version 1, or at your option, any later version) or the Artistic
       License 2.0.  Refer to LICENSE for the full license text. In addition, please see DISCLAIMER.txt for
       disclaimers of warranty.

perl v5.38.2                                       2024-08-10                             <u>VM::EC2::<a href="../man3pm/Dispatch.3pm.html">Dispatch</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>