<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IV_WAIT_INTEREST_INIT,             iv_wait_interest_register,            iv_wait_interest_register_spawn,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libivykis-dev">libivykis-dev_0.43.2-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       IV_WAIT_INTEREST_INIT,             iv_wait_interest_register,            iv_wait_interest_register_spawn,
       iv_wait_interest_unregister, iv_wait_interest_kill - ivykis <b><a href="../man2/wait4.2.html">wait4</a></b>(2) wrapper

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;iv_wait.h&gt;</b>

       struct iv_wait_interest {
               pid_t           pid;
               void            *cookie;
               void            (*handler)(void *cookie, int status,
                                          const struct rusage *rusage);
       };

       <b>void</b> <b>IV_WAIT_INTEREST_INIT(struct</b> <b>iv_wait_interest</b> <b>*</b><u>this</u><b>);</b>
       <b>int</b> <b>iv_wait_interest_register(struct</b> <b>iv_wait_interest</b> <b>*</b><u>this</u><b>);</b>
       <b>int</b> <b>iv_wait_interest_register_spawn(struct</b> <b>iv_wait_interest</b> <b>*</b><u>this</u><b>,</b> <b>void</b> <b>(*</b><u>fn</u><b>)(void</b> <b>*),</b> <b>void</b> <b>*</b><u>cookie</u><b>);</b>
       <b>void</b> <b>iv_wait_interest_unregister(struct</b> <b>iv_wait_interest</b> <b>*</b><u>this</u><b>);</b>
       <b>int</b> <b>iv_wait_interest_kill(const</b> <b>struct</b> <b>iv_wait_interest</b> <b>*</b><u>this</u><b>,</b> <b>int</b> <u>sig</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>iv_wait</b> is an <b><a href="../man3/ivykis.3.html">ivykis</a></b>(3) wrapper around <b><a href="../man2/wait4.2.html">wait4</a></b>(2), integrating process state change notification  with  the
       ivykis event loop.

       An  ivykis  application  desiring  process state change notifications registers a <b>struct</b> <b>iv_wait_interest</b>
       object by calling <b>iv_wait_interest_register,</b> after having initialised it with  <b>IV_WAIT_INTEREST_INIT</b>  and
       subsequently having filled in the <b>-&gt;pid,</b> <b>-&gt;cookie</b> and <b>-&gt;handler</b> members.

       Alternatively,  an  ivykis  application  can use <b>iv_wait_interest_register_spawn</b> to atomically fork off a
       child process and register a <b>struct</b> <b>iv_wait_interest</b> for it.  In this context,  'atomically'  means  that
       the  call  to <b>iv_wait_interest_register_spawn</b> will be serialised with respect to invocations of <b><a href="../man2/wait4.2.html">wait4</a></b>(2),
       which closes the race where process state change notifications can occur and be delivered between forking
       off the child process and registering a <b>struct</b> <b>iv_wait_interest</b> for the child's pid.  The  child  process
       will  run  the function given by the <b>iv_wait_interest_register_spawn</b> argument <b>fn,</b> with argument <b>cookie</b> as
       its argument.

       Once a process state change occurs (as indicated by delivery of a SIGCHLD signal to the current process),
       <b>iv_wait</b> calls <b><a href="../man2/wait4.2.html">wait4</a></b>(2) to return information about the  process  state  change,  looks  up  the  returned
       process  ID  in  the  set  of  registered  <b>struct</b>  <b>iv_wait_interest</b> objects, and if there is a registered
       interest with a matching <b>-&gt;pid</b> field, arranges for that object's callback function to be  called  in  the
       thread that the object was registered in.

       Process  state change notifications will continue to be delivered to the object's callback function until
       <b>iv_wait_interest_unregister</b> is called on the object or until a WIFEXITED or WIFSIGNALED status  for  this
       pid is returned by <b><a href="../man2/wait4.2.html">wait4</a></b>(2).

       Delivery  of  a WIFEXITED or WIFSIGNALED status does not automatically unregister the object, this always
       needs to be done explicitly.

       Unregistering a <b>struct</b> <b>iv_wait_interest</b> object can only be done from the  thread  that  that  object  was
       registered  in, but within that thread, can safely be done from (and its underlying memory allocation can
       safely be freed from) its own callback function.

       Registering multiple <b>struct</b> <b>iv_wait_interest</b> objects for the  same  process  ID  will  produce  undefined
       behavior.

       To  send a signal to a child process, use <b>iv_wait_interest_kill.</b>  This function will internally serialise
       with invocations of <b><a href="../man2/wait4.2.html">wait4</a>(2),</b> to avoid the race between sending a signal to a process  and  collecting  a
       termination notification for that process (which makes its pid available for reuse).

       Internally, <b>iv_wait</b> is implemented using <b><a href="../man3/iv_signal.3.html">iv_signal</a></b>(3) and <b><a href="../man3/iv_event.3.html">iv_event</a></b>(3).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/ivykis.3.html">ivykis</a></b>(3), <b><a href="../man3/iv_signal.3.html">iv_signal</a></b>(3), <b><a href="../man3/iv_event.3.html">iv_event</a></b>(3), <b><a href="../man2/wait4.2.html">wait4</a></b>(2)

ivykis                                             2010-09-03                                         <u><a href="../man3/iv_wait.3.html">iv_wait</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>