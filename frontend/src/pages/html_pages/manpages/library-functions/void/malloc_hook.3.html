<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
<b>__</b><u>malloc_hook</u>(3)                            Library Functions Manual                            <b>__</b><u>malloc_hook</u>(3)

</pre><h4><b>NAME</b></h4><pre>
       __malloc_hook,      __malloc_initialize_hook,      __memalign_hook,      __free_hook,     __realloc_hook,
       __after_morecore_hook - malloc debugging variables (DEPRECATED)

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/malloc.h">malloc.h</a>&gt;</b>

       <b>void</b> <b>*(*volatile</b> <b>__malloc_hook)(size_t</b> <u>size</u><b>,</b> <b>const</b> <b>void</b> <b>*</b><u>caller</u><b>);</b>

       <b>void</b> <b>*(*volatile</b> <b>__realloc_hook)(void</b> <b>*</b><u>ptr</u><b>,</b> <b>size_t</b> <u>size</u><b>,</b>
                                <b>const</b> <b>void</b> <b>*</b><u>caller</u><b>);</b>

       <b>void</b> <b>*(*volatile</b> <b>__memalign_hook)(size_t</b> <u>alignment</u><b>,</b> <b>size_t</b> <u>size</u><b>,</b>
                                <b>const</b> <b>void</b> <b>*</b><u>caller</u><b>);</b>

       <b>void</b> <b>(*volatile</b> <b>__free_hook)(void</b> <b>*</b><u>ptr</u><b>,</b> <b>const</b> <b>void</b> <b>*</b><u>caller</u><b>);</b>

       <b>void</b> <b>(*__malloc_initialize_hook)(void);</b>

       <b>void</b> <b>(*volatile</b> <b>__after_morecore_hook)(void);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The GNU C library lets you modify the behavior  of  <b><a href="../man3/malloc.3.html">malloc</a></b>(3),  <b><a href="../man3/realloc.3.html">realloc</a></b>(3),  and  <b><a href="../man3/free.3.html">free</a></b>(3)  by  specifying
       appropriate  hook  functions.  You can use these hooks to help you debug programs that use dynamic memory
       allocation, for example.

       The variable <b>__malloc_initialize_hook</b>  points  at  a  function  that  is  called  once  when  the  malloc
       implementation  is initialized.  This is a weak variable, so it can be overridden in the application with
       a definition like the following:

           void (*__malloc_initialize_hook)(void) = my_init_hook;

       Now the function <u>my_init_hook</u>() can do the initialization of all hooks.

       The four functions pointed to by  <b>__malloc_hook</b>,  <b>__realloc_hook</b>,  <b>__memalign_hook</b>,  <b>__free_hook</b>  have  a
       prototype  like the functions <b><a href="../man3/malloc.3.html">malloc</a></b>(3), <b><a href="../man3/realloc.3.html">realloc</a></b>(3), <b><a href="../man3/memalign.3.html">memalign</a></b>(3), <b><a href="../man3/free.3.html">free</a></b>(3), respectively, except that they
       have a final argument <u>caller</u> that gives the address of the caller of <b><a href="../man3/malloc.3.html">malloc</a></b>(3), etc.

       The variable <b>__after_morecore_hook</b> points at a function that is called each time after <b><a href="../man2/sbrk.2.html">sbrk</a></b>(2) was  asked
       for more memory.

</pre><h4><b>STANDARDS</b></h4><pre>
       GNU.

</pre><h4><b>NOTES</b></h4><pre>
       The use of these hook functions is not safe in multithreaded programs, and they are now deprecated.  From
       glibc  2.24  onwards, the <b>__malloc_initialize_hook</b> variable has been removed from the API, and from glibc
       2.34 onwards, all the hook variables have been removed from the API.  Programmers should instead  preempt
       calls to the relevant functions by defining and exporting <b>malloc</b>(), <b>free</b>(), <b>realloc</b>(), and <b>calloc</b>().

</pre><h4><b>EXAMPLES</b></h4><pre>
       Here is a short example of how to use these variables.

       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
       #include &lt;<a href="file:/usr/include/malloc.h">malloc.h</a>&gt;

       /* Prototypes for our hooks */
       static void my_init_hook(void);
       static void *my_malloc_hook(size_t, const void *);

       /* Variables to save original hooks */
       static void *(*old_malloc_hook)(size_t, const void *);

       /* Override initializing hook from the C library */
       void (*__malloc_initialize_hook)(void) = my_init_hook;

       static void
       my_init_hook(void)
       {
           old_malloc_hook = __malloc_hook;
           __malloc_hook = my_malloc_hook;
       }

       static void *
       my_malloc_hook(size_t size, const void *caller)
       {
           void *result;

           /* Restore all old hooks */
           __malloc_hook = old_malloc_hook;

           /* Call recursively */
           result = malloc(size);

           /* Save underlying hooks */
           old_malloc_hook = __malloc_hook;

           /* printf() might call malloc(), so protect it too */
           printf("malloc(%zu) called from %p returns %p\n",
                   size, caller, result);

           /* Restore our own hooks */
           __malloc_hook = my_malloc_hook;

           return result;
       }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/mallinfo.3.html">mallinfo</a></b>(3), <b><a href="../man3/malloc.3.html">malloc</a></b>(3), <b><a href="../man3/mcheck.3.html">mcheck</a></b>(3), <b><a href="../man3/mtrace.3.html">mtrace</a></b>(3)

Linux man-pages 6.9.1                              2024-06-15                                   <b>__</b><u><a href="../man3/malloc_hook.3.html">malloc_hook</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>