<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmjsonGet, pmjsonPrint, pmjsonInit, pmjsonInitIndom - JSON string helpers and metrics extraction</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libpcp-web1-dev">libpcp-web1-dev_6.3.8-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmjsonGet</b>, <b>pmjsonPrint</b>, <b>pmjsonInit</b>, <b>pmjsonInitIndom</b> - JSON string helpers and metrics extraction

</pre><h4><b>C</b> <b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;pcp/pmapi.h&gt;</b>
       <b>#include</b> <b>&lt;pcp/pmjson.h&gt;</b>

       <b>typedef</b> <b>int</b> <b>(*json_get)(void</b> <b>*</b><u>buffer</u><b>,</b> <b>int</b> <u>length</u><b>,</b> <b>void</b> <b>*</b><u>data</u><b>);</b>
       <b>int</b> <b>pmjsonGet(json_metric_desc</b> <b>*</b><u>json_metrics</u><b>,</b> <b>int</b> <u>nmetrics</u><b>,</b> <b>pmInDom</b> <u>indom</u><b>,</b> <b>json_get</b> <u>callback</u><b>,</b> <b>void</b>
               <b>*</b><u>data</u><b>);</b>
       <b>int</b> <b>pmjsonPrint(FILE</b> <b>*</b><u>fp</u><b>,</b> <b>json_flag</b> <b>*</b><u>output_flags</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>json_pointer</u><b>,</b> <b>json_get</b> <u>callback</u><b>,</b> <b>void</b>
               <b>*</b><u>data</u><b>);</b>

       <b>int</b> <b>pmjsonInit(int</b> <u>fd</u><b>,</b> <b>json_metric_desc</b> <b>*</b><u>json_metrics</u><b>,</b> <b>int</b> <u>nmetrics</u><b>);</b>
       <b>int</b> <b>pmjsonInitIndom(int</b> <u>fd</u><b>,</b> <b>json_metric_desc</b> <b>*</b><u>json_metrics</u><b>,</b> <b>int</b> <u>nmetrics</u><b>,</b> <b>pmInDom</b> <u>indom</u><b>);</b>

       <b>cc</b> <b>...</b> <b>-lpcp_web</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pmjsonGet</b>  performs  metric value extraction from JSON strings for a Performance Metric Domain Agent (<b>PM‐</b>
       <b><a href="../man3/DA.3.html">DA</a></b>(3)).  Metrics and instances are defined by the <u>json_metrics</u> parameter.  The result of parsing  is  the
       extraction  of  values  for  the  requested  metrics (as defined in the <u>json_pointer</u> field) in the values
       field.

       A simple diagnostic utility for reporting JSON strings is provided as a convenience as  well.   Its  <u>out‐</u>
       <u>put_flags</u> argument allows it to support a variety of alternate output formats, including minimal JSON (no
       optional whitespace), pretty-printed, and a simple YAML subset.

       <u>json_metrics</u>  is the array of json_metric_desc struct which contains the json pointer to the metric data,
       possible flags to check the data against, number of values (in the case of an array),  <u>pmAtomValue</u>  where
       the  data  is stored, as well as the instance domain in the event the PMDA has multiple instance domains.
       The number of elements in the <u>json_metrics</u> array is indicated by the <u>nmetrics</u> parameter.

       Interfaces for common cases are provided - <b>pmjsonInit</b> specifies a call to the  JSON  parsing  and  metric
       value  extraction  functionality  where  there are no instance domains (or the PMDA wishes to perform in‐
       stance domain operations itself) and where data can be read directly from an open file descriptor.   <b>pmj‐</b>
       <b>sonInitIndom</b> is similar, but makes use of the <b><a href="../man3/pmdaCacheStore.3.html">pmdaCacheStore</a></b>(3) function where possible.

       The  JSON  string  must be provided by the <u>callback</u> function.  This function is passed a memory <u>buffer</u> of
       <u>length</u> bytes and an opaque user <u>data</u> pointer which is unchanged from the original call  to  <b>pmjsonGet</b>  or
       <b>pmjsonPrint</b>.  The returned result must be the number of bytes written into <u>buffer</u>, zero when no more data
       is available or less than zero on error conditions.

       <u>indom</u> is the instance domain to be passed to <b>pmdaCacheStore</b>.

            typedef struct json_metrics_desc {
                char          *json_pointer;  /* json pointer to metric */
                int           flags;          /* flags to check if set */
                int           num_values;     /* number of values */
                pmAtomValue   values;         /* metric value */
                char          *dom;           /* instance domain */
            } json_metric_desc;

       The  JSON  Pointer  syntax current follows <u>RFC6901</u> in specifying a metrics location within the JSON docu‐
       ment.

</pre><h4><b>EXAMPLE</b></h4><pre>
       For the sample JSON document:

       {
           "Name": "/clever_almeida",
           "State": {
               "Dead": false,
               "Error": "",
               "ExitCode": 0,
               "FinishedAt": "2016-07-18T21:21:20.332488706Z",
               "OOMKilled": false,
               "Paused": false,
               "Pid": 0,
               "Restarting": false,
               "Running": false,
               "StartedAt": "2016-07-18T14:10:58.52487316Z"
           }
       }

       A possible corresponding json_metric array would be as follows for the Pid, Name, and metrics to indicate
       whether the container is Running, Paused, or Restarting.

       static json_metric_desc json_metrics[] = {
           { "State/Pid", 0, 1, {0}, ""},
           { "Name", 0, 1, {0}, ""},
           { "State/Running", CONTAINER_FLAG_RUNNING, 1, {0}, ""},
           { "State/Paused", CONTAINER_FLAG_PAUSED, 1, {0}, ""},
           { "State/Restarting", CONTAINER_FLAG_RESTARTING, 1, {0}, ""},
       };

</pre><h4><b>RETURN</b> <b>CODE</b></h4><pre>
       The functions return zero on success, otherwise an error code suitable for passing  to  <b><a href="../man3/pmErrStr_r.3.html">pmErrStr_r</a></b>(3)  is
       returned.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/PMDA.3.html">PMDA</a></b>(3),  <b><a href="../man3/pmErrStr_r.3.html">pmErrStr_r</a></b>(3),  <b><a href="../man3/pmdaCacheStore.3.html">pmdaCacheStore</a></b>(3),  <b>https://www.json.org/</b>, <b>https://tools.ietf.org/html/rfc7159</b>,
       and <b>https://tools.ietf.org/html/rfc6901</b>.

Performance Co-Pilot                                   PCP                                          <u><a href="../man3/PMJSONGET.3.html">PMJSONGET</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>