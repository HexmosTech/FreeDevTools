<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>libdi - disk information library</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libdi-dev">libdi-dev_6.0.0-1_amd64</a> <br><br><pre>
</pre><h4><b>Name</b></h4><pre>
       <b>libdi</b> - disk information library

</pre><h4><b>Synopsis</b></h4><pre>
   <b>Initialization</b>
       #include &lt;di.h&gt;

       void * <b>di_initialize</b> (void);
       int <b>di_process_options</b> (void *<u>di_data</u>, int <u>targc</u>, const char *<u>targv</u> [], int <u>offset</u>);
       void <b>di_cleanup</b> (void *<u>di_data</u>);
       const char *<b>di_version</b> (void);

   <b>Options</b>
       int <b>di_check_option</b> (void *<u>di_data</u>, int <u>option</u>);
       void <b>di_format_iter_init</b> (void *<u>di_data</u>);
       int <b>di_format_iterate</b> (void *<u>di_data</u>);

   <b>Getting</b> <b>data</b>
       void <b>di_get_all_disk_info</b> (void *<u>di_data</u>);
       int <b>di_iterate_init</b> (void *<u>di_data</u>, int <u>iteroption</u>);
         typedef struct {
           const char   *strdata [DI_DISP_MAX];      /* string data */
           int          index;             /* internal index value */
           int          doPrint;           /* printable flag based on options */
           int          printFlag;         /* print result flag */
           int          isLocal;           /* filesystem is local */
           int          isReadOnly;        /* filesystem is read-only */
           int          isLoopback;        /* filesystme is a loopback filesystem */
         } di_pub_disk_info_t;

       const di_pub_disk_info_t * <b>di_iterate</b> (void *<u>di_data</u>);
       int <b>di_get_scale_max</b> (void *<u>di_data</u>, int <u>index</u>,
           int <u>valueidxA</u>, int <u>valueidxB</u>, int <u>valueidxC</u>);
       double <b>di_get_scaled</b> (void *<u>di_data</u>, int <u>index</u>,
           int <u>scaleidx</u>, int <u>valueidxA</u>, int <u>valueidxB</u>, int <u>valueidxC</u>);
       void <b>di_disp_scaled</b> (void *<u>di_data</u>, char *<u>buff</u>, long <u>buffsz</u>,
           int <u>index</u>, int <u>scaleidx</u>,
           int <u>valueidxA</u>, int <u>valueidxB</u>, int <u>valueidxC</u>);
       double <b>di_get_perc</b> (void *<u>di_data</u>, int <u>index</u>,
           int <u>valueidxA</u>, int <u>valueidxB</u>,
           int <u>valueidxC</u>, int <u>valueidxB</u>, int <u>valueidxE</u>);
       void <b>di_disp_perc</b> (void *<u>di_data</u>, char *<u>buff</u>, long <u>buffsz</u>,
           int <u>index</u>,
           int <u>valueidxA</u>, int <u>valueidxB</u>,
           int <u>valueidxC</u>, int <u>valueidxB</u>, int <u>valueidxE</u>);

</pre><h4><b>Overview</b></h4><pre>
   <b>Initialization</b>
       <b>di_initialize</b>  returns  a  pointer  to  a <u>di_data</u> structure, used in all of the other library calls.  The
       returned pointer must be freed with <b>di_cleanup</b>.

       <b>di_process_options</b> processes the arguments to <u>di</u>.  These are passed as strings via an <u>argv</u>  structure  as
       if  on  the  command  line.   If  no call to <b>di_process_options</b> is made, <u>di</u> will use the defaults and the
       <u>DI_ARGS</u> environment variable will not be processed.

       <b>di_cleanup</b> frees all allocated data.

   <b>Options</b>
       <b>di_check_option</b> returns the value of the specified option. All  options  will  return  a  boolean  value,
       excepting: DI_OPT_DEBUG, DI_OPT_FMT_STR_LEN, DI_OPT_SCALE and DI_OPT_BLOCK_SZ.

       <u>option</u> may be one of:

              DI_OPT_POSIX_COMPAT
              DI_OPT_QUOTA_CHECK
              DI_OPT_DISP_CSV
              DI_OPT_DISP_CSV_TAB
              DI_OPT_EXCL_LOOPBACK
              DI_OPT_DISP_JSON
              DI_OPT_DISP_TOTALS
              DI_OPT_DISP_HEADER
              DI_OPT_DISP_ALL
              DI_OPT_LOCAL_ONLY
              DI_OPT_NO_SYMLINK
              DI_OPT_DEBUG
              DI_OPT_FMT_STR_LEN
              DI_OPT_SCALE
              DI_OPT_BLOCK_SZ

       <b>di_format_iter_init</b> initializes the format string iterator.

       <b>di_format_iterate</b>  iterates  through  each  format  character  in the format string.  Note that <u>di</u> allows
       unrecognized format characters.  In the main <u>di</u> program, these are printed as-is.

   <b>Getting</b> <b>Data</b>
       <b>di_get_all_disk_info</b> retrieves and processes all of the disk information from the operating system.

       <b>di_iterate_init</b> initializes the disk information iterator.  <u>iteroption</u> is  one  of  DI_ITER_PRINTABLE  or
       DI_ITER_ALL.   If  DI_ITER_PRINTABLE  is specified, only the partitions with the <u>doPrint</u> flag set will be
       returned by the iterator.

       <b>di_iterate</b>  iterates  through  the  filesystems,  returning  a  <u>di_pub_disk_info_t</u>  structure  for   each
       filesystem.   If  the <u>--totals</u> flag was specified as an option, the totals will be the last item returned
       by the iterator.

       <b>di_get_scale_max</b> gets the maximum scaling unit for the space value.

       <u>index</u> is the index from the <u>di_pub_disk_info_t</u> structure.

       The <u>valueidx</u> arguments indicate which disk space values to use to calculate the  the  space  value.   The
       formula is: <b>A</b> <b>-</b> <b>(B</b> <b>-</b> <b>C)</b>.  Valid combinations are:

              DI_SPACE_TOTAL, DI_VALUE_NONE, DI_VALUE_NONE    // total
              DI_SPACE_TOTAL, DI_SPACE_FREE, DI_SPACE_AVAIL   // used
              DI_SPACE_TOTAL, DI_SPACE_FREE, DI_VALUE_NONE    // used
              DI_SPACE_TOTAL, DI_SPACE_AVAIL, DI_VALUE_NONE   // used
              DI_SPACE_FREE, DI_VALUE_NONE, DI_VALUE_NONE     // free
              DI_SPACE_AVAIL, DI_VALUE_NONE, DI_VALUE_NONE    // free
              DI_INODE_TOTAL, DI_VALUE_NONE, DI_VALUE_NONE    // inode total
              DI_INODE_TOTAL, DI_INODE_FREE, DI_VALUE_NONE    // inodes used
              DI_INODE_FREE, DI_VALUE_NONE, DI_VALUE_NONE     // inodes free

       <b>di_get_scaled</b> gets a space value scaled according to the scaling unit.

       <u>index</u> is the index from the <u>di_pub_disk_info_t</u> structure.

       <u>scaleidx</u>  is  the scaling index to use.  Use a scaling index returned from <b>di_get_scale_max</b> or use one of
       the following values:

              DI_SCALE_BYTE
              DI_SCALE_KILO
              DI_SCALE_MEGA
              DI_SCALE_GIGA
              DI_SCALE_TERA
              DI_SCALE_PETA
              DI_SCALE_EXA
              DI_SCALE_ZETTA
              DI_SCALE_YOTTA
              DI_SCALE_RONNA
              DI_SCALE_QUETTA

       The <u>valueidx</u> arguments indicate which disk space values to use to calculate the  the  space  value.   The
       formula is: <b>A</b> <b>-</b> <b>(B</b> <b>-</b> <b>C)</b>.  See <b>di_get_scale_max</b> for a list of valid combinations.

       <b>di_disp_scaled</b>  gets a space value scaled according to the scaling unit, and creates a string that can be
       printed.

       <b>buff</b> is the character string where the string will be stored.

       <b>buffsz</b> is the size of the character string.

       <u>index</u> is the index from the <u>di_pub_disk_info_t</u> structure.

       <u>scaleidx</u> is the scaling index to use.  Use a scaling index returned from <b>di_get_scale_max</b> or one  of  the
       values as listed in <b>di_get_scaled</b>.

       The  <u>valueidx</u>  arguments  indicate  which disk space values to use to calculate the the space value.  The
       formula is: <b>A</b> <b>-</b> <b>(B</b> <b>-</b> <b>C)</b>.  See <b>di_get_scale_max</b> for a list of valid combinations.

       <b>di_get_perc</b> retrieves the disk space value as a percentage.

       <u>index</u> is the index from the <u>di_pub_disk_info_t</u> structure.

       The <u>valueidx</u> arguments indicate which disk space values to use to calculate the percentage.  The  formula
       is: <b>(A</b> <b>-</b> <b>B)</b> <b>/</b> <b>(C</b> <b>-</b> <b>(D</b> <b>-</b> <b>E))</b>.

       Valid combinations are:

              /* percent used */
              DI_SPACE_TOTAL, DI_SPACE_AVAIL,
              DI_SPACE_TOTAL, DI_VALUE_NONE, DI_VALUE_NONE
              /* percent used */
              DI_SPACE_TOTAL, DI_SPACE_FREE,
              DI_SPACE_TOTAL, DI_VALUE_NONE, DI_VALUE_NONE
              /* percent used, BSD style */
              DI_SPACE_TOTAL, DI_SPACE_FREE,
              DI_SPACE_TOTAL, DI_VALUE_FREE, DI_VALUE_AVAIL
              /* percent free */
              DI_SPACE_AVAIL, DI_VALUE_NONE,
              DI_SPACE_TOTAL, DI_VALUE_NONE, DI_VALUE_NONE,
              /* percent free */
              DI_SPACE_FREE, DI_VALUE_NONE,
              DI_SPACE_TOTAL, DI_VALUE_NONE, DI_VALUE_NONE,
              /* inodes used */
              DI_INODE_TOTAL, DI_INODE_AVAIL,
              DI_INODE_TOTAL, DI_VALUE_NONE, DI_VALUE_NONE

       <b>di_disp_perc</b> retrieves the disk space value as a percentage and creates a string that can be printed.

       <b>buff</b> is the character string where the string will be stored.

       <b>buffsz</b> is the size of the character string.

       <u>index</u> is the index from the <u>di_pub_disk_info_t</u> structure.

       The  <u>valueidx</u> arguments indicate which disk space values to use to calculate the percentage.  The formula
       is: <b>(A</b> <b>-</b> <b>B)</b> <b>/</b> <b>(C</b> <b>-</b> <b>(D</b> <b>-</b> <b>E))</b>.  See <b>di_get_perc</b> for valid combinations.

</pre><h4><b>Example</b></h4><pre>
           /* this code is in the public domain */
           #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
           #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
           #include &lt;stdbool.h&gt;
           #include &lt;<a href="file:/usr/include/math.h">math.h</a>&gt;

           #include &lt;di.h&gt;

           enum {
             HAVE_SPACE = 0,
             NO_SPACE = 1,
           };

           int
           check_space (const char *fn, double space_wanted) {
             void        *di_data;
             int         targc;
             const char  *targv [10];
             int         exitflag;
             const di_pub_disk_info_t  *pub;
             int         rval = NO_SPACE;
             int         count;

             targc = 1;
             targv [0] = fn;
             targv [1] = NULL;

             di_data = di_initialize ();
             exitflag = di_process_options (di_data, targc, targv, 0);
             if (exitflag != DI_EXIT_NORM) {
               di_cleanup (di_data);
               exit (exitflag);
             }
             di_get_all_disk_info (di_data);
             count = di_iterate_init (di_data, DI_ITER_PRINTABLE);
             while ((pub = di_iterate (di_data)) != NULL) {
               double    dval;

               /* compare terabytes available */
               dval = di_get_scaled (di_data, pub-&gt;index, DI_SCALE_TERA,
                   DI_SPACE_AVAIL, DI_VALUE_NONE, DI_VALUE_NONE);
               if (dval &gt;= space_wanted) {
                 rval = HAVE_SPACE;
               }
             }
             di_cleanup (di_data);

             return rval;
           }

           int
           main (int argc, char *argv []) {
             const char  *fn = "/home/bll/s/di";
             double      spwant = 0.2;   /* terabytes */
             bool        rval;

             if (argc &gt; 1) {
               fn = argv [1];
             }
             if (argc &gt; 2) {
               spwant = atof (argv [2]);
             }

             rval = check_space (fn, spwant);
             if (rval == NO_SPACE) {
               fprintf (stdout, "Not enough disk space0);
             }
             if (rval == HAVE_SPACE) {
               fprintf (stdout, "Enough disk space0);
             }

             return rval;
           }

   <b>Compile</b> <b>and</b> <b>Link</b>
           dilibd=$HOME/local/lib
           diinc=$(pkg-config --with-path ${dilibd}/pkgconfig --cflags di)
           dilibs=$(pkg-config --with-path ${dilibd}/pkgconfig --libs di)
           cc -o tt ${diinc} tt.c -Wl,-R${dilibd} ${dilibs})

   <b>Example</b> <b>Run</b>
           bll-g7:bll$ ./tt /home/bll 0.5
           Not enough disk space
           bll-g7:bll$ ./tt /home/bll 0.1
           Enough disk space

</pre><h4><b>See</b> <b>Also</b></h4><pre>
       <a href="../man1/df.1.html">df</a>(1), <a href="../man1/di.1.html">di</a>(1)

</pre><h4><b>Bugs</b></h4><pre>
       Open a ticket at https://sourceforge.net/p/diskinfo-di/tickets/
       Send bug reports to: brad.lanam.di @ gmail.com

</pre><h4><b>Links</b></h4><pre>
       Home Page: https://diskinfo-di.sourceforge.io/
       Wiki: https://sourceforge.net/p/diskinfo-di/wiki/Home/
       Change Log: https://sourceforge.net/p/diskinfo-di/wiki/ChangeLog/

</pre><h4><b>Author</b></h4><pre>
       Copyright 1994-2025 by Brad Lanam Pleasant Hill, CA

                                                   28 Jan 2025                                          <u><a href="../man3/libdi.3.html">libdi</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>