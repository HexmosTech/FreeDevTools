<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mst_pack - Packing of Mini-SEED records from MSTrace segments.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libmseed-doc">libmseed-doc_2.19.8-1ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mst_pack - Packing of Mini-SEED records from MSTrace segments.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;libmseed.h&gt;</b>

       <b>int</b>  <b>mst_pack</b> <b>(</b> <b>MSTrace</b> <b>*</b><u>mst</u><b>,</b>
                       <b>void</b> <b>(*</b><u>record_handler</u><b>)</b> <b>(char</b> <b>*,</b> <b>int,</b> <b>void</b> <b>*),</b>
                       <b>void</b> <b>*</b><u>handlerdata</u><b>,</b> <b>int</b> <u>reclen</u><b>,</b> <b>flag</b> <u>encoding</u><b>,</b>
                       <b>flag</b> <u>byteorder</u><b>,</b> <b>int64_t</b> <b>*</b><u>packedsamples</u><b>,</b> <b>flag</b> <u>flush</u><b>,</b>
                       <b>flag</b> <u>verbose</u><b>,</b> <b>MSRecord</b> <b>*</b><u>mstemplate</u> <b>);</b>

       <b>int</b>  <b>msr_packgroup</b> <b>(</b> <b>MSTraceGroup</b> <b>*</b><u>mstg</u><b>,</b>
                            <b>void</b> <b>(*</b><u>record_handler</u><b>)</b> <b>(char</b> <b>*,</b> <b>int,</b> <b>void</b> <b>*),</b>
                            <b>void</b> <b>*</b><u>handlerdata</u><b>,</b> <b>int</b> <u>reclen</u><b>,</b> <b>flag</b> <u>encoding</u><b>,</b>
                            <b>flag</b> <u>byteorder</u><b>,</b> <b>int64_t</b> <b>*</b><u>packedsamples</u><b>,</b> <b>flag</b> <u>flush</u><b>,</b>
                            <b>flag</b> <u>verbose</u><b>,</b> <b>MSRecord</b> <b>*</b><u>mstemplate</u> <b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>mst_pack</b>  creates (packs) Mini-SEED data records from a MSTrace segment using the specified record length
       (<u>reclen</u>), Mini-SEED <u>encoding</u> and <u>byteorder</u>.  Using <u>mstemplate</u> as a template, the common header fields and
       blockettes are packed into a record header.  If no template will be used  <u>mstemplate</u>  should  be  set  to
       NULL.   A  Blockette  1000  will be added if one is not present in the template.  The MSTrace.datasamples
       array and MSTrace.numsamples value will be adjusted (reduced) as samples are packed  into  data  records.
       This  routine  will  modify  the  record  length,  encoding format, byte order and sequence number of the
       MSRecord template.  The start time, sample rate, data array, number of samples and  sample  type  of  the
       MSRecord template are preserved.

       Default values will be used for any of the key characteristics of record length, encoding format and byte
       order that are -1.  The default values are: reclen = 4096 bytes, encoding = 11 (Steim2) and byteorder = 1
       (MSBF or big-endian).

       <u>reclen</u>  should be set to the desired data record length in bytes which must be expressible as 2 raised to
       the power of X where X is between (and including) 8 to 20.

       <u>encoding</u> should be set to one of the following supported Mini-SEED data encoding formats:  DE_ASCII  (0),
       DE_INT16  (1),  DE_INT32  (3),  DE_FLOAT32  (4),  DE_FLOAT64 (5), DE_STEIM1 (10) and DE_STEIM2 (11).  The
       encoding aliases are defined in libmseed.h.  MSTrace.sampletype  should  indicated  the  sample  type  as
       either 'a' (ASCII), 'i' (32-bit integers), 'f' (32-bit floats) or 'd' (64-bit doubles).

       The  encoding  format must be appropriate for the sample type of the MSTrace samples.  For example, Steim
       compression and integer encoding formats require integer samples and float encoding formats  require  the
       appropriate  size  floats  as  input.   As  a counter example, float samples cannot be packed using Steim
       compression or integer encoding formats.

       <u>byteorder</u> must be either 0 (LSBF or little-endian) or 1 (MBF or big-endian).

       Each time a complete record is packed it will be passed to the <u>record_handler()</u>  function  which  expects
       three  arguments:  1)  a  char * to the record buffer, 2) the length of the record in bytes and 3) a void
       pointer supplied by the caller.  It is the responsibility of <u>record_handler()</u> to process the record,  the
       memory  will be re-used or freed when <u>record_handler()</u> returns.  This function pointer is required, there
       is no other way to access the packed records.

       The <u>handlerdata</u> pointer will be passed as the 3rd argument to <u>record_handler()</u>.  This allows  the  caller
       to optionally pass data directly to the <u>record_handler()</u>.

       The integer pointed to by <u>packedsamples</u> will be set to the total number of samples packed.

       If the <u>flush</u> flag is not zero all of the data will be packed into records, otherwise records will only be
       packed while there are enough data samples to completely fill a record.

       The <u>verbose</u> flag controls verbosity, a value of zero will result in no diagnostic output.

       <b>mst_packgroup</b>  simply calls <b>mst_pack</b> for each MSTrace in the specified MSTraceGroup.  The integer pointed
       to by <u>packedsamples</u> will be set to the total number of samples packed.

</pre><h4><b>COMPRESSION</b> <b>HISTORY</b></h4><pre>
       When the encoding format is Steim 1 or  2  compression  contiguous  records  will  be  created  including
       compression  history.  Put simply, this means that the first difference in the compression series will be
       the difference between the first sample of the current record and the last sample of the previous record.
       For the first record in a series (no previous record), a so-called cold start, the first difference  will
       be zero.

       The  compression  history  can be seeded by allocating the StreamState struct for the MSTrace and setting
       the <b>lastintsample</b> member to the integer sample value that preceded the first sample in the current series
       and setting the <b>comphistory</b> flag to true (1).

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>mst_pack</b> returns the number records created on success and -1 on error.

       <b>mst_packgroup</b> returns the total (for all MSTraces) number of record created on success and -1 on error.

</pre><h4><b>CAVEATS</b></h4><pre>
       When using a MSRecord template (<u>mstemplate</u>) the dataquality member must be set to a valid value.   It  is
       also  advisable  to  set  the  network,  station,  location and channel indicators to appropriate values.
       Unless these source indicators need to change they  can  simply  be  copied  from  the  matching  MSTrace
       members.

</pre><h4><b>EXAMPLE</b></h4><pre>
       Skeleton code for creating (packing) Mini-SEED records with <a href="../man3/mst_pack.3.html">mst_pack</a>(3):

       static void record_handler (char *record, int reclen, void *srcname) {
         if ( fwrite(record, reclen, 1, outfile) != 1 )
           {
             ms_log (2, "Error writing %s to output file0, (char *)srcname);
           }
       }

       main() {
         int64_t psamples;
         int precords;
         MSTrace *mst;
         char srcname[50];

         mst = mst_init (NULL);

         /* Populate MSTrace values */
         strcpy (mst-&gt;network, "XX");
         strcpy (mst-&gt;station, "TEST");
         strcpy (mst-&gt;channel, "BHE");
         mst-&gt;starttime = ms_seedtimestr2hptime ("2004,350,00:00:00.000000");
         mst-&gt;samprate = 40.0;

         /* The datasamples pointer and numsamples counter will be adjusted by
            the packing routine, the datasamples array must be dynamic memory
            allocated by the malloc() family of routines. */
         mst-&gt;datasamples = dataptr; /* pointer to 32-bit integer data samples */
         mst-&gt;numsamples = 1234;
         mst-&gt;sampletype = 'i';      /* declare type to be 32-bit integers */

         mst_srcname (mst, srcname, 0);

         /* Pack 4096 byte, big-endian records, using Steim-2 compression */
         precords = mst_pack (mst, &amp;record_handler, srcname, 4096, DE_STEIM2,
                              1, &amp;psamples, 1, verbose, NULL);

         ms_log (0, "Packed %"PRId64" samples into %d records0,
                    psamples, precords);

         mst_free (&amp;mst);
       }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/ms_intro.3.html">ms_intro</a>(3)</b> and <b><a href="../man3/msr_pack.3.html">msr_pack</a>(3)</b>.

</pre><h4><b>AUTHOR</b></h4><pre>
       Chad Trabant
       IRIS Data Management Center

Libmseed API                                       2013/05/17                                        <u><a href="../man3/MST_PACK.3.html">MST_PACK</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>