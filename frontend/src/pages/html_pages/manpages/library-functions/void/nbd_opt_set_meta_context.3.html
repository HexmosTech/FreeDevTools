<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nbd_opt_set_meta_context - select specific meta contexts, using implicit query list</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libnbd-dev">libnbd-dev_1.22.2-1build2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nbd_opt_set_meta_context - select specific meta contexts, using implicit query list

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;libnbd.h&gt;

        typedef struct {
          int (*callback) (void *user_data, const char *name);
          void *user_data;
          void (*free) (void *user_data);
        } nbd_context_callback;

        int nbd_opt_set_meta_context (
              struct nbd_handle *h,
              nbd_context_callback context_callback
            );

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Request that the server supply all recognized meta contexts registered through prior calls to
       <b><a href="../man3/nbd_add_meta_context.3.html">nbd_add_meta_context</a></b>(3), in conjunction with the export previously specified by the most recent
       <b><a href="../man3/nbd_set_export_name.3.html">nbd_set_export_name</a></b>(3) or <b><a href="../man3/nbd_connect_uri.3.html">nbd_connect_uri</a></b>(3).  This can only be used if <b><a href="../man3/nbd_set_opt_mode.3.html">nbd_set_opt_mode</a></b>(3) enabled
       option mode.  Normally, this function is redundant, as <b><a href="../man3/nbd_opt_go.3.html">nbd_opt_go</a></b>(3) automatically does the same task if
       structured replies or extended headers have already been negotiated.  But manual control over meta
       context requests can be useful for fine-grained testing of how a server handles unusual negotiation
       sequences.  Often, use of this function is coupled with <b><a href="../man3/nbd_set_request_meta_context.3.html">nbd_set_request_meta_context</a></b>(3) to bypass the
       automatic context request normally performed by <b><a href="../man3/nbd_opt_go.3.html">nbd_opt_go</a></b>(3).

       The NBD protocol allows a client to decide how many queries to ask the server.  Rather than taking that
       list of queries as a parameter to this function, libnbd reuses the current list of requested meta
       contexts as set by <b><a href="../man3/nbd_add_meta_context.3.html">nbd_add_meta_context</a></b>(3); you can use <b><a href="../man3/nbd_clear_meta_contexts.3.html">nbd_clear_meta_contexts</a></b>(3) to set up a different
       list of queries (see <b><a href="../man3/nbd_opt_set_meta_context_queries.3.html">nbd_opt_set_meta_context_queries</a></b>(3) to pass an explicit list of contexts instead).
       Since this function is primarily designed for testing servers, libnbd does not prevent the use of this
       function on an empty list or when <b><a href="../man3/nbd_set_request_structured_replies.3.html">nbd_set_request_structured_replies</a></b>(3) has disabled structured replies,
       in order to see how a server behaves.

       The "context" function is called once per server reply, with any "user_data" passed to this function, and
       with "name" supplied by the server.  Additionally, each server name will remain visible through
       <b><a href="../man3/nbd_can_meta_context.3.html">nbd_can_meta_context</a></b>(3) until the next attempt at <b><a href="../man3/nbd_set_export_name.3.html">nbd_set_export_name</a></b>(3) or <b><a href="../man3/nbd_opt_set_meta_context.3.html">nbd_opt_set_meta_context</a></b>(3),
       as well as <b><a href="../man3/nbd_opt_go.3.html">nbd_opt_go</a></b>(3) or <b><a href="../man3/nbd_opt_info.3.html">nbd_opt_info</a></b>(3) that trigger an automatic meta context request.  Remember
       that it is not safe to call any "nbd_*" APIs from within the context of the callback function.  At
       present, the return value of the callback is ignored, although a return of -1 should be avoided.

       For convenience, when this function succeeds, it returns the number of replies returned by the server.

       Not all servers understand this request, and even when it is understood, the server might intentionally
       send an empty list because it does not support the requested context, or may encounter a failure after
       delivering partial results.  Thus, this function may succeed even when no contexts are reported, or may
       fail but have a non-empty list.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       This call returns an integer ≥ 0.

</pre><h4><b>ERRORS</b></h4><pre>
       On error -1 is returned.

       Refer to "ERROR HANDLING" in <b><a href="../man3/libnbd.3.html">libnbd</a></b>(3) for how to get further details of the error.

       The following parameters must not be NULL: "h".  For more information see "Non-NULL parameters" in
       <b><a href="../man3/libnbd.3.html">libnbd</a></b>(3).

</pre><h4><b>HANDLE</b> <b>STATE</b></h4><pre>
       nbd_opt_set_meta_context can be called when the handle is in the following state:

        ┌─────────────────────────────────────┬─────────────────────────┐
        │ Handle created, before connecting   │ ❌ error                │
        │ Connecting                          │ ❌ error                │
        │ Connecting &amp; handshaking (opt_mode) │ ✅ allowed              │
        │ Connected to the server             │ ❌ error                │
        │ Connection shut down                │ ❌ error                │
        │ Handle dead                         │ ❌ error                │
        └─────────────────────────────────────┴─────────────────────────┘

</pre><h4><b>VERSION</b></h4><pre>
       This function first appeared in libnbd 1.16.

       If you need to test if this function is available at compile time check if the following macro is
       defined:

        #define LIBNBD_HAVE_NBD_OPT_SET_META_CONTEXT 1

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/nbd_add_meta_context.3.html">nbd_add_meta_context</a></b>(3), <b><a href="../man3/nbd_aio_opt_set_meta_context.3.html">nbd_aio_opt_set_meta_context</a></b>(3), <b><a href="../man3/nbd_can_meta_context.3.html">nbd_can_meta_context</a></b>(3),
       <b><a href="../man3/nbd_clear_meta_contexts.3.html">nbd_clear_meta_contexts</a></b>(3), <b><a href="../man3/nbd_connect_uri.3.html">nbd_connect_uri</a></b>(3), <b><a href="../man3/nbd_create.3.html">nbd_create</a></b>(3), <b><a href="../man3/nbd_opt_go.3.html">nbd_opt_go</a></b>(3), <b><a href="../man3/nbd_opt_info.3.html">nbd_opt_info</a></b>(3),
       <b><a href="../man3/nbd_opt_list_meta_context.3.html">nbd_opt_list_meta_context</a></b>(3), <b><a href="../man3/nbd_opt_set_meta_context.3.html">nbd_opt_set_meta_context</a></b>(3), <b><a href="../man3/nbd_opt_set_meta_context_queries.3.html">nbd_opt_set_meta_context_queries</a></b>(3),
       <b><a href="../man3/nbd_set_export_name.3.html">nbd_set_export_name</a></b>(3), <b><a href="../man3/nbd_set_opt_mode.3.html">nbd_set_opt_mode</a></b>(3), <b><a href="../man3/nbd_set_request_meta_context.3.html">nbd_set_request_meta_context</a></b>(3),
       <b><a href="../man3/nbd_set_request_structured_replies.3.html">nbd_set_request_structured_replies</a></b>(3), <b><a href="../man3/libnbd.3.html">libnbd</a></b>(3).

</pre><h4><b>AUTHORS</b></h4><pre>
       Eric Blake

       Richard W.M. Jones

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright Red Hat

</pre><h4><b>LICENSE</b></h4><pre>
       This library is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser
       General Public License as published by the Free Software Foundation; either version 2 of the License, or
       (at your option) any later version.

       This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even
       the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General
       Public License for more details.

       You should have received a copy of the GNU Lesser General Public License along with this library; if not,
       write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA

libnbd-1.22.2                                      2025-06-16                        <u><a href="../man3/nbd_opt_set_meta_context.3.html">nbd_opt_set_meta_context</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>