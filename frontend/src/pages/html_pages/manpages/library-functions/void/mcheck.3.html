<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mcheck, mcheck_check_all, mcheck_pedantic, mprobe - heap consistency checking</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mcheck, mcheck_check_all, mcheck_pedantic, mprobe - heap consistency checking

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/mcheck.h">mcheck.h</a>&gt;</b>

       <b>int</b> <b>mcheck(void</b> <b>(*</b><u>abortfunc</u><b>)(enum</b> <b>mcheck_status</b> <u>mstatus</u><b>));</b>
       <b>int</b> <b>mcheck_pedantic(void</b> <b>(*</b><u>abortfunc</u><b>)(enum</b> <b>mcheck_status</b> <u>mstatus</u><b>));</b>
       <b>void</b> <b>mcheck_check_all(void);</b>

       <b>enum</b> <b>mcheck_status</b> <b>mprobe(void</b> <b>*</b><u>ptr</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>mcheck</b>()  function  installs  a set of debugging hooks for the <b><a href="../man3/malloc.3.html">malloc</a></b>(3) family of memory-allocation
       functions.  These hooks cause certain consistency checks to be performed on the state of the  heap.   The
       checks  can  detect application errors such as freeing a block of memory more than once or corrupting the
       bookkeeping data structures that immediately precede a block of allocated memory.

       To be effective, the <b>mcheck</b>() function must be called before the first call to  <b><a href="../man3/malloc.3.html">malloc</a></b>(3)  or  a  related
       function.   In  cases  where  this  is  difficult to ensure, linking the program with <u>-lmcheck</u> inserts an
       implicit call to <b>mcheck</b>() (with a NULL argument) before the first call to a memory-allocation function.

       The <b>mcheck_pedantic</b>() function is similar to <b>mcheck</b>(),  but  performs  checks  on  all  allocated  blocks
       whenever one of the memory-allocation functions is called.  This can be very slow!

       The  <b>mcheck_check_all</b>()  function  causes  an  immediate  check  on  all  allocated blocks.  This call is
       effective only if <b>mcheck</b>() is called beforehand.

       If the system detects an inconsistency in the heap, the caller-supplied function pointed to by  <u>abortfunc</u>
       is  invoked  with a single argument, <u>mstatus</u>, that indicates what type of inconsistency was detected.  If
       <u>abortfunc</u> is NULL, a default function prints an error message on <u>stderr</u> and calls <b><a href="../man3/abort.3.html">abort</a></b>(3).

       The <b>mprobe</b>() function performs a consistency check on the block of allocated memory pointed  to  by  <u>ptr</u>.
       The <b>mcheck</b>() function should be called beforehand (otherwise <b>mprobe</b>() returns <b>MCHECK_DISABLED</b>).

       The  following  list  describes  the  values  returned by <b>mprobe</b>() or passed as the <u>mstatus</u> argument when
       <u>abortfunc</u> is invoked:

       <b>MCHECK_DISABLED</b> (<b>mprobe</b>() only)
              <b>mcheck</b>() was not called before the first  memory  allocation  function  was  called.   Consistency
              checking is not possible.

       <b>MCHECK_OK</b> (<b>mprobe</b>() only)
              No inconsistency detected.

       <b>MCHECK_HEAD</b>
              Memory preceding an allocated block was clobbered.

       <b>MCHECK_TAIL</b>
              Memory following an allocated block was clobbered.

       <b>MCHECK_FREE</b>
              A block of memory was freed twice.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       <b>mcheck</b>() and <b>mcheck_pedantic</b>() return 0 on success, or -1 on error.

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       For an explanation of the terms used in this section, see <b><a href="../man7/attributes.7.html">attributes</a></b>(7).
       ┌───────────────────────────────────────────────────────────────┬───────────────┬───────────────────────┐
       │ <b>Interface</b>                                                     │ <b>Attribute</b>     │ <b>Value</b>                 │
       ├───────────────────────────────────────────────────────────────┼───────────────┼───────────────────────┤
       │ <b>mcheck</b>(), <b>mcheck_pedantic</b>(), <b>mcheck_check_all</b>(), <b>mprobe</b>()     │ Thread safety │ MT-Unsafe race:mcheck │
       │                                                               │               │ const:malloc_hooks    │
       └───────────────────────────────────────────────────────────────┴───────────────┴───────────────────────┘

</pre><h4><b>STANDARDS</b></h4><pre>
       GNU.

</pre><h4><b>HISTORY</b></h4><pre>
       <b>mcheck_pedantic</b>()
       <b>mcheck_check_all</b>()
              glibc 2.2.

       <b>mcheck</b>()
       <b>mprobe</b>()
              glibc 2.0.

</pre><h4><b>NOTES</b></h4><pre>
       Linking  a  program  with  <u>-lmcheck</u>  and  using  the  <b>MALLOC_CHECK_</b>  environment  variable  (described in
       <b><a href="../man3/mallopt.3.html">mallopt</a></b>(3)) cause the same kinds of errors to be detected.  But, using <b>MALLOC_CHECK_</b> does not require the
       application to be relinked.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The program below calls <b>mcheck</b>() with a NULL argument and then frees the same block of memory twice.  The
       following shell session demonstrates what happens when running the program:

           $ <b>./a.out</b>
           About to free

           About to free a second time
           block freed twice
           Aborted (core dumped)

   <b>Program</b> <b>source</b>

       #include &lt;<a href="file:/usr/include/mcheck.h">mcheck.h</a>&gt;
       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
       #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;

       int
       main(void)
       {
           char *p;

           if (mcheck(NULL) != 0) {
               fprintf(stderr, "mcheck() failed\n");

               exit(EXIT_FAILURE);
           }

           p = <a href="../man1000/malloc.1000.html">malloc</a>(1000);

           fprintf(stderr, "About to free\n");
           free(p);
           fprintf(stderr, "\nAbout to free a second time\n");
           free(p);

           exit(EXIT_SUCCESS);
       }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/malloc.3.html">malloc</a></b>(3), <b><a href="../man3/mallopt.3.html">mallopt</a></b>(3), <b><a href="../man3/mtrace.3.html">mtrace</a></b>(3)

Linux man-pages 6.9.1                              2024-06-15                                          <u><a href="../man3/mcheck.3.html">mcheck</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>