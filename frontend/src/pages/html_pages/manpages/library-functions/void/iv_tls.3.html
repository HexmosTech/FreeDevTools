<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iv_tls_user_register, iv_tls_user_ptr - thread-local storage handling for ivykis modules</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libivykis-dev">libivykis-dev_0.43.2-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       iv_tls_user_register, iv_tls_user_ptr - thread-local storage handling for ivykis modules

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;iv_tls.h&gt;</b>

       struct iv_tls_user {
               size_t          sizeof_state;
               void            (*init_thread)(void *st);
               void            (*deinit_thread)(void *st);
       };

       <b>void</b> <b>iv_tls_user_register(struct</b> <b>iv_tls_user</b> <b>*</b><u>tu</u><b>);</b>
       <b>void</b> <b>*iv_tls_user_ptr(const</b> <b>struct</b> <b>iv_tls_user</b> <b>*</b><u>tu</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>iv_tls</b> interface provides thread-local storage handling to <b>ivykis</b> modules.

       An ivykis module can arrange for an amount of memory to be allocated for its use in each ivykis thread by
       calling  <b>iv_tls_user_register.</b>   This  must  be  done  before any calls to <b>iv_init</b> have been made in this
       process, and is typically done from a module initialization function marked as a constructor function.

       The <b>-&gt;sizeof_state</b> member of the passed-in structure indicates how many bytes of memory the module  wants
       allocated for its use in every ivykis thread.

       When  a  thread calls <b>iv_init,</b> <b>-&gt;sizeof_state</b> bytes of memory will be allocated for use by this module in
       that thread, and initialised to zero.  A  pointer  to  this  memory  area  can  be  obtained  by  calling
       <b>iv_tls_user_ptr</b> (which returns NULL in non-ivykis threads).

       If  the  specified  <b>-&gt;init_thread</b> function pointer is not NULL, it will be invoked at the end of <b>iv_init,</b>
       with its argument pointing to this thread's memory area allocation for this module.

       If <b>-&gt;deinit_thread</b> is not NULL, it will be invoked at the start of <b>iv_deinit,</b> or if the thread  fails  to
       call  <b>iv_deinit</b> before terminating, at thread termination time.  The argument passed into <b>-&gt;deinit_thread</b>
       is the same as for <b>-&gt;init_thread.</b>

       It is permitted to call any ivykis API functions from the <b>-&gt;init_thread</b> and <b>-&gt;deinit_thread</b> callbacks.

       There is no explicit serialization on calls to <b>-&gt;init_thread</b> and <b>-&gt;deinit_thread.</b>

       Care must be taken when calling <b>iv_tls_user_ptr</b> from a signal handler, as there is a time window where it
       will return a non-NULL value before <b>-&gt;init_thread</b> or after <b>-&gt;deinit_thread</b> have been called.

       Use of <b>iv_tls</b> for managing thread-local state is preferred over direct use of the  <b>__thread</b>  keyword,  as
       not all platforms that ivykis runs on provide the <b>__thread</b> keyword.

       Use  of <b>iv_tls</b> for managing thread-local state is preferred over direct use of the <b>pthread_key_create</b> and
       <b>pthread_setspecific</b> APIs, as <b>iv_tls</b> provides a thread init  hook  as  well  as  a  destructor  hook,  and
       properly sequences <b>-&gt;init_thread</b> and <b>-&gt;deinit_thread</b> calls with core ivykis initialization and cleanup.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/iv_init.3.html">iv_init</a></b>(3)

ivykis                                             2012-03-30                                          <u><a href="../man3/iv_tls.3.html">iv_tls</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>