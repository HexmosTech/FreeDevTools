<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nbdkit_shutdown, nbdkit_disconnect - request shutdown or client disconnection</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/nbdkit-plugin-dev">nbdkit-plugin-dev_1.42.4-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nbdkit_shutdown, nbdkit_disconnect - request shutdown or client disconnection

</pre><h4><b>SYNOPSIS</b></h4><pre>
        #include &lt;nbdkit-plugin.h&gt;

        void nbdkit_shutdown (void);
        void nbdkit_disconnect (int force);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Plugins and filters can call <b><a href="../man3/exit.3.html">exit</a></b>(3) in the configuration phase (before and including ".get_ready", but
       not in connected callbacks).

       Once nbdkit has started serving connections, plugins and filters should not call <b><a href="../man3/exit.3.html">exit</a></b>(3).  However they
       may instruct nbdkit to shut down by calling "nbdkit_shutdown", or to disconnect a single client by
       calling "nbdkit_disconnect".

   <b>nbdkit_shutdown</b>
       "nbdkit_shutdown" requests nbdkit to shut down asynchronously and returns (<b>note</b> that it does <b>not</b> exit the
       process immediately).

       It ensures that the plugin and all filters are unloaded cleanly which may take some time.  Further
       callbacks from nbdkit into the plugin or filter may occur after you have called this.

   <b>nbdkit_disconnect</b>
       "nbdkit_disconnect" requests that the current client connection be disconnected.  It does not affect
       other connections, and it does not stop the same client from trying to reconnect.

       It is only useful from connected callbacks — that is, after (but not including) ".open", and before
       ".close".  To reject a client in ".preconnect", ".open" or ".list_exports" you should return an error
       instead.

       If "force" is true, nbdkit will disconnect the client immediately, and the client will not receive any
       response to the current command or any other commands in flight in parallel threads.  If "force" is
       false, nbdkit will not accept any new commands from the client (failing all commands other than
       "NBD_CMD_DISC" with "ESHUTDOWN"), but will allow existing commands to complete gracefully.  Either way,
       the next callback for the current connection should be ".close".

</pre><h4><b>LANGUAGE</b> <b>BINDINGS</b></h4><pre>
       In <b><a href="../man3/nbdkit-ocaml-plugin.3.html">nbdkit-ocaml-plugin</a></b>(3):

        NBDKit.shutdown : unit -&gt; unit
        NBDKit.disconnect : bool -&gt; unit

       In <b><a href="../man3/nbdkit-python-plugin.3.html">nbdkit-python-plugin</a></b>(3):

        import nbdkit
        nbdkit.shutdown()
        nbdkit.disconnect(force)

       In <b><a href="../man3/nbdkit-rust-plugin.3.html">nbdkit-rust-plugin</a></b>(3):

        use nbdkit::*;
        pub fn shutdown()
        pub fn disconnect(force: bool)

       In <b><a href="../man3/nbdkit-sh-plugin.3.html">nbdkit-sh-plugin</a></b>(3), there are various magic error codes that can be returned to indicate that
       shutdown or disconnection is needed.  See that documentation for a full description.

</pre><h4><b>HISTORY</b></h4><pre>
       "nbdkit_shutdown" was added in nbdkit 1.20.  "nbdkit_disconnect" was added in nbdkit 1.34.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/nbdkit.1.html">nbdkit</a></b>(1), <b><a href="../man3/nbdkit-plugin.3.html">nbdkit-plugin</a></b>(3), <b><a href="../man3/nbdkit-filter.3.html">nbdkit-filter</a></b>(3).

</pre><h4><b>AUTHORS</b></h4><pre>
       Eric Blake

       Richard W.M. Jones

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright Red Hat

</pre><h4><b>LICENSE</b></h4><pre>
       Redistribution and use in source and binary forms, with or without modification, are permitted provided
       that the following conditions are met:

       •   Redistributions  of  source  code must retain the above copyright notice, this list of conditions and
           the following disclaimer.

       •   Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
           the following disclaimer in the documentation and/or other materials provided with the distribution.

       •   Neither the name of Red Hat nor the names of its contributors may  be  used  to  endorse  or  promote
           products derived from this software without specific prior written permission.

       THIS  SOFTWARE  IS  PROVIDED BY RED HAT AND CONTRIBUTORS ''AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
       INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND  FITNESS  FOR  A  PARTICULAR
       PURPOSE  ARE  DISCLAIMED.  IN  NO EVENT SHALL RED HAT OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
       INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,  PROCUREMENT  OF
       SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
       ON  ANY  THEORY  OF  LIABILITY,  WHETHER  IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
       OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
       DAMAGE.

nbdkit-1.42.4                                      2025-06-16                                 <u><a href="../man3/nbdkit_shutdown.3.html">nbdkit_shutdown</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>