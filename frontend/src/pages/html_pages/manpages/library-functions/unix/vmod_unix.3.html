<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vmod_unix - Utilities for Unix domain sockets</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/varnish">varnish_7.7.0-3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       vmod_unix - Utilities for Unix domain sockets

</pre><h4><b>SYNOPSIS</b></h4><pre>
          import unix [as name] [from "path"]

          STRING user()

          STRING group()

          INT uid()

          INT gid()

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  VMOD  provides information about the credentials of the peer process (user and group of the process
       owner) that is connected to a Varnish listener via a Unix domain socket, if the platform supports it.

       Examples:

          import unix;

          sub vcl_recv {
                # Return "403 Forbidden" if the connected peer is
                # not running as the user "trusteduser".
                if (unix.user() != "trusteduser") {
                        return( <a href="../man403/synth.403.html">synth</a>(403) );
                }

                # Require the connected peer to run in the group
                # "trustedgroup".
                if (unix.group() != "trustedgroup") {
                        return( <a href="../man403/synth.403.html">synth</a>(403) );
                }

                # Require the connected peer to run under a specific numeric
                # user id.
                if (unix.uid() != 4711) {
                        return( <a href="../man403/synth.403.html">synth</a>(403) );
                }

                # Require the connected peer to run under a numeric group id.
                if (unix.gid() != 815) {
                        return( <a href="../man403/synth.403.html">synth</a>(403) );
                }
          }

       Obtaining the peer credentials is possible on a platform that supports one of the following:

       • <u><a href="../man3/getpeereid.3.html">getpeereid</a>(3)</u> (such as FreeBSD and other BSD-derived systems)

       • the socket option <b>SO_PEERCRED</b> for <u><a href="../man2/getsockopt.2.html">getsockopt</a>(2)</u> (Linux)

       • <u><a href="../man3C/getpeerucred.3C.html">getpeerucred</a>(3C)</u> (SunOS and descendants)

       On SunOS and friends, the <b>PRIV_PROC_INFO</b> privilege set is added to the Varnish child  process  while  the
       VMOD is loaded, see <u><a href="../man2/setppriv.2.html">setppriv</a>(2)</u>.

       On most platforms, the value returned is the effective user or group that was valid when the peer process
       initiated the connection.

   <b>STRING</b> <b>user()</b>
       Return the user name of the peer process owner.

       Restricted to: <b>client</b>, <b>backend</b>.

   <b>STRING</b> <b>group()</b>
       Return the group name of the peer process owner.

       Restricted to: <b>client</b>, <b>backend</b>.

   <b>INT</b> <b>uid()</b>
       Return the numeric user id of the peer process owner.

       Restricted to: <b>client</b>, <b>backend</b>.

   <b>INT</b> <b>gid()</b>
       Return the numeric group id of the peer process owner.

       Restricted to: <b>client</b>, <b>backend</b>.

</pre><h4><b>ERRORS</b></h4><pre>
       All functions in this VMOD are subject to the following constraints:

       • None  of  them  may be called in <b>vcl_init{}</b> or <b>vcl_fini{}</b>. If one of them is called in <b>vcl_init{}</b>, then
         the VCL program will fail to load, with an error message from the VMOD.

       • If called on a platform that is not supported, then VCL failure is invoked. An error message is written
         to the log (with the <b>VCL_Error</b> tag), and for all VCL subroutines except  for  <b>vcl_synth{}</b>,  control  is
         directed  immediately  to <b>vcl_synth{}</b>, with the response status set to 503 and the reason string set to
         "VCL failed".

         If the failure occurs during <b>vcl_synth{}</b>, then <b>vcl_synth{}</b> is aborted, and the response line  "503  VCL
         failed" is sent.

       • If  the current listener is not a Unix domain socket, or if the attempt to read credentials fails, then
         a <b>VCL_Error</b> message is written to the log. The STRING functions (unix.user() and  unix.group())  return
         <b>NULL</b>, while the INT functions (unix.uid() and unix.gid()) return -1.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       • <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>

       • <u><a href="../man7/vcl.7.html">vcl</a>(7)</u>

       • <u><a href="../man3/getpeereid.3.html">getpeereid</a>(3)</u>

       • <u><a href="../man2/getsockopt.2.html">getsockopt</a>(2)</u>

       • <u><a href="../man3C/getpeerucred.3C.html">getpeerucred</a>(3C)</u>

       • <u><a href="../man2/setppriv.2.html">setppriv</a>(2)</u>

</pre><h4><b>COPYRIGHT</b></h4><pre>
          This document is licensed under the same conditions as Varnish itself.
          See LICENSE for details.

          SPDX-License-Identifier: BSD-2-Clause

          Authors: Geoffrey Simmons &lt;<a href="mailto:geoffrey.simmons@uplex.de">geoffrey.simmons@uplex.de</a>&gt;

                                                                                                    <u><a href="../man3/VMOD_UNIX.3.html">VMOD_UNIX</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>