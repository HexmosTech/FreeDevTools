<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vmod_tcp - TCP vmod</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/varnish-modules">varnish-modules_0.25.0-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       vmod_tcp - TCP vmod

</pre><h4><b>SYNOPSIS</b></h4><pre>
          import tcp [as name] [from "path"]

          INT congestion_algorithm(STRING algorithm)

          VOID dump_info()

          REAL get_estimated_rtt()

          VOID set_socket_pace(INT)

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The TCP vmod opens for access and modification of client TCP connection attributes from VCL.

       Primary use is for rate limiting (pacing) using the fq network scheduler on recent Linux systems.

       Example:

          vcl 4.0;

          import tcp;

          backend default { .host = "192.0.2.11"; .port = "8080"; }

          sub vcl_recv {
              # Shape (pace) the data rate to avoid filling router buffers for a
              # single client.
              if (req.url ~ ".mp4$") {
                      <a href="../man1000/tcp.set_socket_pace.1000.html">tcp.set_socket_pace</a>(1000);   # KB/s.
              }

              # We want to change the congestion control algorithm.
              if (tcp.get_estimated_rtt() &gt; 300) {
                  set req.http.x-tcp = tcp.congestion_algorithm("hybla");
              }
          }

   <b>INT</b> <b>congestion_algorithm(STRING</b> <b>algorithm)</b>
       Set the client socket congestion control algorithm to S. Returns 0 on success, and -1 on error.

       Example:

          sub vcl_recv {
              set req.http.x-tcp = tcp.congestion_algorithm("cubic");
          }

   <b>VOID</b> <b>dump_info()</b>
       Write the contents of the TCP_INFO data structure into varnishlog.

       Example:

          tcp.dump_info();

       Example varnishlog output:

          -   VCL_Log        tcpi: snd_mss=1448 rcv_mss=536 lost=0 retrans=0
          -   VCL_Log        tcpi2: pmtu=1500 rtt=152000 rttvar=76000 snd_cwnd=10 advmss=1448 reordering=3
          -   VCL_Log        getsockopt() returned: cubic

   <b>REAL</b> <b>get_estimated_rtt()</b>
       Get the estimated round-trip-time for the client socket. Unit: milliseconds.

       Example:

          if (tcp.get_estimated_rtt() &gt; 300) {
              std.log("client is far away.");
          }

   <b>VOID</b> <b>set_socket_pace(INT)</b>
       Set  socket  pacing  on  client-side  TCP connection to PACE KB/s. Network interface used must be using a
       supported scheduler. (fq)

       Example:

          <a href="../man1000/tcp.set_socket_pace.1000.html">tcp.set_socket_pace</a>(1000);

                                                                                                     <u><a href="../man3/VMOD_TCP.3.html">VMOD_TCP</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>