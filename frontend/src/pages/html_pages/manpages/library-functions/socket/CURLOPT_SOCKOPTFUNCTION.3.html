<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CURLOPT_SOCKOPTFUNCTION - callback for setting socket options</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcurl4-doc">libcurl4-doc_8.14.1-1ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       CURLOPT_SOCKOPTFUNCTION - callback for setting socket options

</pre><h4><b>SYNOPSIS</b></h4><pre>
       #include &lt;curl/curl.h&gt;

       typedef enum  {
         CURLSOCKTYPE_IPCXN,  /* socket created for a specific IP connection */
         CURLSOCKTYPE_ACCEPT, /* socket created by accept() call */
         CURLSOCKTYPE_LAST    /* never use */
       } curlsocktype;

       #define CURL_SOCKOPT_OK 0
       #define CURL_SOCKOPT_ERROR 1 /* causes libcurl to abort and return
                                       CURLE_ABORTED_BY_CALLBACK */
       #define CURL_SOCKOPT_ALREADY_CONNECTED 2

       int sockopt_callback(void *clientp,
                            curl_socket_t curlfd,
                            curlsocktype purpose);

       CURLcode curl_easy_setopt(CURL *handle, CURLOPT_SOCKOPTFUNCTION, sockopt_callback);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Pass a pointer to your callback function, which should match the prototype shown above.

       When  set, this callback function gets called by libcurl when the socket has been created, but before the
       connect call to allow applications to change specific socket options.  The  callback's  <u>purpose</u>  argument
       identifies the exact purpose for this particular socket:

       <u>CURLSOCKTYPE_IPCXN</u>  for actively created connections or since 7.28.0 <u>CURLSOCKTYPE_ACCEPT</u> for FTP when the
       connection was setup with PORT/EPSV (in earlier versions these sockets were not passed to this callback).

       Future versions of libcurl may support more purposes. libcurl passes the newly created socket  descriptor
       to  the  callback  in  the  <u>curlfd</u>  parameter  so additional setsockopt() calls can be done at the user's
       discretion.

       The <u>clientp</u> pointer contains whatever user-defined value set using the <u><a href="../man3/CURLOPT_SOCKOPTDATA.3.html">CURLOPT_SOCKOPTDATA</a>(3)</u> function.

       Return <u>CURL_SOCKOPT_OK</u> from the callback on success. Return <u>CURL_SOCKOPT_ERROR</u> from the callback function
       to  signal  an  unrecoverable  error  to  the  library   and   it   closes   the   socket   and   returns
       <u>CURLE_COULDNT_CONNECT</u>. Alternatively, the callback function can return <u>CURL_SOCKOPT_ALREADY_CONNECTED</u>, to
       tell  libcurl  that  the  socket  is  already connected and then libcurl does no attempt to connect. This
       allows an application to pass in an already connected socket with <u><a href="../man3/CURLOPT_OPENSOCKETFUNCTION.3.html">CURLOPT_OPENSOCKETFUNCTION</a>(3)</u> and  then
       have this function make libcurl not attempt to connect (again).

</pre><h4><b>DEFAULT</b></h4><pre>
       NULL

</pre><h4><b>PROTOCOLS</b></h4><pre>
       This functionality affects all supported protocols

</pre><h4><b>EXAMPLE</b></h4><pre>
       /* make libcurl use the already established socket 'sockfd' */

       static curl_socket_t opensocket(void *clientp,
                                       curlsocktype purpose,
                                       struct curl_sockaddr *address)
       {
         curl_socket_t sockfd;
         sockfd = *(curl_socket_t *)clientp;
         /* the actual externally set socket is passed in via the OPENSOCKETDATA
            option */
         return sockfd;
       }

       static int sockopt_callback(void *clientp, curl_socket_t curlfd,
                                   curlsocktype purpose)
       {
         /* This return code was added in libcurl 7.21.5 */
         return CURL_SOCKOPT_ALREADY_CONNECTED;
       }

       int main(void)
       {
         CURL *curl = curl_easy_init();
         if(curl) {
           CURLcode res;
           int sockfd; /* our custom file descriptor */
           /* libcurl thinks that you connect to the host
            * and port that you specify in the URL option. */
           curl_easy_setopt(curl, CURLOPT_URL, "<a href="http://99.99.99.99">http://99.99.99.99</a>:9999");
           /* call this function to get a socket */
           curl_easy_setopt(curl, CURLOPT_OPENSOCKETFUNCTION, opensocket);
           curl_easy_setopt(curl, CURLOPT_OPENSOCKETDATA, &amp;sockfd);

           /* call this function to set options for the socket */
           curl_easy_setopt(curl, CURLOPT_SOCKOPTFUNCTION, sockopt_callback);

           res = curl_easy_perform(curl);

           curl_easy_cleanup(curl);
         }
       }

</pre><h4><b>AVAILABILITY</b></h4><pre>
       Added in curl 7.16.0

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       <u><a href="../man3/curl_easy_setopt.3.html">curl_easy_setopt</a>(3)</u> returns a CURLcode indicating success or error.

       CURLE_OK (0) means everything was OK, non-zero means an error occurred, see <u><a href="../man3/libcurl-errors.3.html">libcurl-errors</a>(3)</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/CURLOPT_OPENSOCKETFUNCTION.3.html">CURLOPT_OPENSOCKETFUNCTION</a></b>(3), <b><a href="../man3/CURLOPT_SEEKFUNCTION.3.html">CURLOPT_SEEKFUNCTION</a></b>(3), <b><a href="../man3/CURLOPT_SOCKOPTDATA.3.html">CURLOPT_SOCKOPTDATA</a></b>(3)

libcurl                                            2025-06-16                         <u><a href="../man3/CURLOPT_SOCKOPTFUNCTION.3.html">CURLOPT_SOCKOPTFUNCTION</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>