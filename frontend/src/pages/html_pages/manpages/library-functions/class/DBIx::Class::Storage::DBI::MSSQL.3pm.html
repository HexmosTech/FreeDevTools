<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBIx::Class::Storage::DBI::MSSQL - Base Class for Microsoft SQL Server support in DBIx::Class</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libdbix-class-perl">libdbix-class-perl_0.082844-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       DBIx::Class::Storage::DBI::MSSQL - Base Class for Microsoft SQL Server support in DBIx::Class

</pre><h4><b>SYNOPSIS</b></h4><pre>
       This is the base class for Microsoft SQL Server support, used by
       DBIx::Class::Storage::DBI::ODBC::Microsoft_SQL_Server and
       DBIx::Class::Storage::DBI::Sybase::Microsoft_SQL_Server.

</pre><h4><b>IMPLEMENTATION</b> <b>NOTES</b></h4><pre>
   <b>IDENTITY</b> <b>information</b>
       Microsoft SQL Server supports three methods of retrieving the IDENTITY value for inserted row:
       IDENT_CURRENT, @@IDENTITY, and <b>SCOPE_IDENTITY()</b>.  SCOPE_IDENTITY is used here because it is the safest.
       However, it must be called is the same execute statement, not just the same connection.

       So, this implementation appends a SELECT <b>SCOPE_IDENTITY()</b> statement onto each INSERT to accommodate that
       requirement.

       "SELECT @@IDENTITY" can also be used by issuing:

         $self-&gt;_identity_method('@@identity');

       it will only be used if <b>SCOPE_IDENTITY()</b> fails.

       This is more dangerous, as inserting into a table with an on insert trigger that inserts into another
       table with an identity will give erroneous results on recent versions of SQL Server.

   <b>identity</b> <b>insert</b>
       Be aware that we have tried to make things as simple as possible for our users.  For MSSQL that means
       that when a user tries to create a row, while supplying an explicit value for an autoincrementing column,
       we will try to issue the appropriate database call to make this possible, namely "SET IDENTITY_INSERT
       $table_name ON". Unfortunately this operation in MSSQL requires the "db_ddladmin" privilege, which is
       normally not included in the standard write-permissions.

   <b>Ordered</b> <b>Subselects</b>
       If you attempted the following query (among many others) in Microsoft SQL Server

        $rs-&gt;search ({}, {
         prefetch =&gt; 'relation',
         rows =&gt; 2,
         offset =&gt; 3,
        });

       You may be surprised to receive an exception. The reason for this is a quirk in the MSSQL engine itself,
       and sadly doesn't have a sensible workaround due to the way DBIC is built. DBIC can do truly wonderful
       things with the aid of subselects, and does so automatically when necessary. The list of situations when
       a subselect is necessary is long and still changes often, so it can not be exhaustively enumerated here.
       The general rule of thumb is a joined has_many relationship with limit/group applied to the left part of
       the join.

       In its "pursuit of standards" Microsft SQL Server goes to great lengths to forbid the use of ordered
       subselects. This breaks a very useful group of searches like "Give me things number 4 to 6 (ordered by
       name), and prefetch all their relations, no matter how many". While there is a hack which fools the
       syntax checker, the optimizer may <b>still</b> <b>elect</b> <b>to</b> <b>break</b> <b>the</b> <b>subselect</b>.  Testing has determined that while
       such breakage does occur (the test suite contains an explicit test which demonstrates the problem), it is
       relative rare. The benefits of ordered subselects are on the other hand too great to be outright disabled
       for MSSQL.

       Thus compromise between usability and perfection is the MSSQL-specific resultset attribute
       "unsafe_subselect_ok".  It is deliberately not possible to set this on the Storage level, as the user
       should inspect (and preferably regression-test) the return of every such ResultSet individually. The
       example above would work if written like:

        $rs-&gt;search ({}, {
         unsafe_subselect_ok =&gt; 1,
         prefetch =&gt; 'relation',
         rows =&gt; 2,
         offset =&gt; 3,
        });

       If it is possible to rewrite the <b>search()</b> in a way that will avoid the need for this flag - you are urged
       to do so. If DBIC internals insist that an ordered subselect is necessary for an operation, and you
       believe there is a different/better way to get the same result - please file a bugreport.

</pre><h4><b>FURTHER</b> <b>QUESTIONS?</b></h4><pre>
       Check the list of additional DBIC resources.

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       This module is free software copyright by the DBIx::Class (DBIC) authors. You can redistribute it and/or
       modify it under the same terms as the DBIx::Class library.

perl v5.40.0                                       2025-02-01              <u>DBIx::Class::Storage::DBI::<a href="../man3pm/MSSQL.3pm.html">MSSQL</a></u>(3pm)
</pre>
 </div>
</div></section>
</div>
</body>
</html>