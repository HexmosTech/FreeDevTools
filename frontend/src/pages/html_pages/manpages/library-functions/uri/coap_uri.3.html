<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>coap_uri, coap_split_uri, coap_split_proxy_uri, coap_new_uri, coap_clone_uri, coap_delete_uri,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libcoap3t64">libcoap3t64_4.3.4-1.1build4_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       coap_uri, coap_split_uri, coap_split_proxy_uri, coap_new_uri, coap_clone_uri, coap_delete_uri,
       coap_uri_into_options - Work with CoAP URIs

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;coap3/coap.h&gt;</b>

       <b>int</b> <b>coap_split_uri(const</b> <b>uint8_t</b> <b>*</b><u>uri_def</u><b>,</b> <b>size_t</b> <u>length</u><b>,</b> <b>coap_uri_t</b> <b>*</b><u>uri</u><b>);</b>

       <b>int</b> <b>coap_split_proxy_uri(const</b> <b>uint8_t</b> <b>*</b><u>uri_def</u><b>,</b> <b>size_t</b> <u>length</u><b>,</b> <b>coap_uri_t</b> <b>*</b><u>uri</u><b>);</b>

       <b>coap_uri_t</b> <b>*coap_new_uri(const</b> <b>uint8_t</b> <b>*</b><u>uri_def</u><b>,</b> <b>unsigned</b> <b>int</b> <u>length</u><b>);</b>

       <b>coap_uri_t</b> <b>*coap_clone_uri(const</b> <b>coap_uri_t</b> <b>*</b><u>uri</u><b>);</b>

       <b>void</b> <b>coap_delete_uri(coap_uri_t</b> <b>*</b><u>uri</u><b>);</b>

       <b>int</b> <b>coap_uri_into_options(const</b> <b>coap_uri_t</b> <b>*</b><u>uri</u><b>,</b> <b>const</b> <b>coap_address_t</b> <b>*</b><u>dst</u><b>,</b> <b>coap_optlist_t</b>
       <b>**</b><u>optlist_chain</u><b>,</b> <b>int</b> <u>create_port_host_opt</u><b>,</b> <b>uint8_t</b> <b>*</b><u>buf</u><b>,</b> <b>size_t</b> <u>buflen</u><b>);</b>

       For specific (D)TLS library support, link with <b>-lcoap-3-notls</b>, <b>-lcoap-3-gnutls</b>, <b>-lcoap-3-openssl</b>,
       <b>-lcoap-3-mbedtls</b> or <b>-lcoap-3-tinydtls</b>. Otherwise, link with <b>-lcoap-3</b> to get the default (D)TLS library
       support.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This man page describes the functionality available to work with CoAP URIs and break them down into the
       component parts.

       A CoAP URI is of the form

       &lt;scheme&gt;&lt;host&gt;&lt;(optional):port&gt;&lt;(optional)path&gt;&lt;(optional)?query&gt;

       where <u>scheme</u> can be one of coap://, coaps://, coap+tcp:// and coaps+tcp:/<a href="file:/.">/.</a>

       <u>host</u> can be an IPv4 or IPv6 (enclosed in []) address, a DNS resolvable name or a Unix domain socket name
       which is encoded as a unix file name with %2F replacing each / of the file name so that the start of the
       <u>path</u> can easily be determined.

       <u>(optional):port</u> is ignored for Unix domain socketâ€™s <u>host</u> definitions.

       The parsed uri structure is of the form

           typedef struct {
             coap_str_const_t host;  /* The host part of the URI */
             uint16_t port;          /* The port in host byte order */
             coap_str_const_t path;  /* The complete path if present or {0, NULL}.
                                        Needs to be split using coap_split_path()
                                        or coap_uri_into_options(). */
             coap_str_const_t query; /* The complete query if present or {0, NULL}.
                                        Needs to be split using coap_split_query()
                                        or coap_uri_into_options(). */
             enum coap_uri_scheme_t scheme; /* The parsed scheme specifier. */
           } coap_uri_t;

</pre><h4><b>FUNCTIONS</b></h4><pre>
       <b>Function:</b> <b>coap_split_uri()</b>

       The <b>coap_split_uri</b>() function is used to parse the provided <u>uri_def</u> of length <u>length</u> into the component
       parts held in the <u>uri</u> structure. These component parts are the host, port, path, query and the CoAP URI
       scheme.

       <b>Function:</b> <b>coap_split_proxy_uri()</b>

       The <b>coap_split_proxy_uri</b>() function is used to parse the provided <u>uri_def</u> of length <u>length</u> into the
       component parts held in the <u>uri</u> structure. These component parts are the host, port, path, query and the
       URI scheme. The schemes also includes support for http:// and https:// as the proxy may need to be a
       coap-to-http proxy.

       <b>Function:</b> <b>coap_new_uri()</b>

       The <b>coap_new_uri</b>() function creates a new coap_uri_t structure and populates it using <b>coap_split_uri</b>()
       with <u>uri_def</u> and <u>length</u> as input. The returned coap_uri_t structure needs to be freed off using
       <b>coap_delete_uri</b>().

       <b>Function:</b> <b>coap_clone_uri()</b>

       The <b>coap_clone_uri</b>() function duplicates a <u>uri</u> coap_uri_t structure. The returned coap_uri_t structure
       needs to be freed off using <b>coap_delete_uri</b>().

       <b>Function:</b> <b>coap_delete_uri()</b>

       The <b>coap_delete_uri</b>() function frees off a previously created <u>uri</u> coap_uri_t structure.

       <b>Function:</b> <b>coap_uri_into_options()</b>

       The <b>coap_uri_into_options</b>() function takes the <u>uri</u> structure and then takes CoAP options derived from
       this information and adds them to <u>optlist_chain</u>. The initial <u>optlist_chain</u> entry should be set to NULL
       before this function is called (unless <b><a href="../man3/coap_insert_optlist.3.html">coap_insert_optlist</a></b>(3) has been previously used).

       If <u>dst</u> is not NULL and <u>create_port_host_opt</u> is not 0, then the Uri-Host option is added in if the <u>uri</u>
       host definition is not an exact match with the ascii readable version of _dst.

       If the port is not the default port and <u>create_port_host_opt</u> is not 0, then the Port option is added to
       <u>optlist_chain</u>.

       If there is a path, then this is broken down into individual Path options for each segment which are then
       added to <u>optlist_chain</u>.

       Likewise, if there is a query, individual Query options for each segment are then added to <u>optlist_chain</u>.

       <u>buf</u> provides a scratch buffer to use, of size <u>buflen</u> bytes. <u>buf</u> needs to be as big as the path or query
       lengths.

       <b>NOTE:</b> It is the responsibility of the application to free off the entries added to <u>optlist_chain</u> using
       <b><a href="../man3/coap_delete_optlist.3.html">coap_delete_optlist</a></b>(3).

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>coap_split_uri</b>(), <b>coap_split_proxy_uri</b>(), and <b>coap_uri_into_options</b>() return 0 on success, else &lt; 0 on
       failure.

       <b>coap_new_uri</b>() and <b>coap_clone_uri</b>() return a newly allocated coap_uri_t structure or NULL on failure.

</pre><h4><b>EXAMPLES</b></h4><pre>
       <b>Setup</b> <b>PDU</b> <b>and</b> <b>Transmit</b>

           #include &lt;coap3/coap.h&gt;

           /*
            * Returns 0 failure, 1 success
            */
           static int
           parse_and_send_uri(coap_session_t *session, const char *do_uri) {
             coap_uri_t uri;
             coap_optlist_t *optlist = NULL;
             coap_pdu_t *pdu;
             coap_proto_t proto = coap_session_get_proto(session);
             const coap_address_t *dst = coap_session_get_addr_remote(session);
             int res;
             coap_mid_t mid;
           #define BUFSIZE 100
             unsigned char buf[BUFSIZE];

             /* Parse the URI */
             res = coap_split_uri((const uint8_t*)do_uri, strlen(do_uri), &amp;uri);
             if (res != 0)
               return 0;

             /* Check the scheme matches the session type */
             switch (uri.scheme) {
             case COAP_URI_SCHEME_COAP:
               if (proto != COAP_PROTO_UDP)
                 return 0;
               break;
             case COAP_URI_SCHEME_COAPS:
               if (proto != COAP_PROTO_DTLS)
                 return 0;
               break;
             case COAP_URI_SCHEME_COAP_TCP:
               if (proto != COAP_PROTO_TCP)
                 return 0;
               break;
             case COAP_URI_SCHEME_COAPS_TCP:
               if (proto != COAP_PROTO_TLS)
                 return 0;
               break;
             case COAP_URI_SCHEME_COAP_WS:
               if (proto != COAP_PROTO_WS)
                 return 0;
               break;
             case COAP_URI_SCHEME_COAPS_WS:
               if (proto != COAP_PROTO_WSS)
                 return 0;
               break;
             /* Proxy support only */
             case COAP_URI_SCHEME_HTTP:
             case COAP_URI_SCHEME_HTTPS:
             case COAP_URI_SCHEME_LAST:
             default:
               return 0;
             }

             /* construct CoAP message */
             pdu = coap_pdu_init(COAP_MESSAGE_CON,
                                 COAP_REQUEST_CODE_GET,
                                 coap_new_message_id(session),
                                 coap_session_max_pdu_size(session));
             if (pdu == NULL)
               return 0;

             /* Create all the necessary options from the URI */
             res = coap_uri_into_options(&amp;uri, dst, &amp;optlist, 1, buf, sizeof(buf));
             if (res != 0)
               return 0;

             /* Add option list (which will get sorted) to the PDU */
             if (optlist) {
               res = coap_add_optlist_pdu(pdu, &amp;optlist);
               coap_delete_optlist(optlist);
               if (res != 1)
                 return 0;
             }

             /* and send the PDU */
             mid = coap_send(session, pdu);
             if (mid == COAP_INVALID_MID)
               return 0;
             return 1;
           }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/coap_endpoint_client.3.html">coap_endpoint_client</a></b>(3) and <b><a href="../man3/coap_pdu_setup.3.html">coap_pdu_setup</a></b>(3).

</pre><h4><b>FURTHER</b> <b>INFORMATION</b></h4><pre>
       See

       "RFC7252: The Constrained Application Protocol (CoAP)"

       for further information.

</pre><h4><b>BUGS</b></h4><pre>
       Please report bugs on the mailing list for libcoap: <a href="mailto:libcoap-developers@lists.sourceforge.net">libcoap-developers@lists.sourceforge.net</a> or raise an
       issue on GitHub at https://github.com/obgm/libcoap/issues

</pre><h4><b>AUTHORS</b></h4><pre>
       The libcoap project &lt;<a href="mailto:libcoap-developers@lists.sourceforge.net">libcoap-developers@lists.sourceforge.net</a>&gt;

coap_uri 4.3.4                                     04/15/2024                                        <u><a href="../man3/COAP_URI.3.html">COAP_URI</a></u>(3)
</pre>
 </div>
</div></section>
</div>
</body>
</html>