<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCL-Variables - The complete album</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/varnish">varnish_7.7.0-3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       VCL-Variables - The complete album

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This is a list of all variables in the VCL language.

       Variable names take the form <b>scope.variable[.index]</b>, for instance:

          req.url
          beresp.http.date
          client.ip

       Which  operations  are  possible  on each variable is described below, often with the shorthand "backend"
       which covers the <b>vcl_backend_*</b> <b>{}</b> subroutines and "client" which covers the rest, except <b>vcl_init</b> <b>{}</b>  and
       <b>vcl_fini</b> <b>{}</b>.

   <b>local,</b> <b>server,</b> <b>remote</b> <b>and</b> <b>client</b>
       These variables describe the network connection between the client and varnishd.

       Without PROXY protocol:

               client    server
               remote    local
                 v          v
          CLIENT ------------ VARNISHD

       With PROXY protocol:

               client    server   remote     local
                 v          v       v          v
          CLIENT ------------ PROXY ------------ VARNISHD

       client.identity
          Type: STRING

          Readable from: client, backend

          Writable from: client

          Identification of the client, used to load balance in the client director.  Defaults to <b>client.ip</b>

          This  variable can be overwritten with more precise information, for instance extracted from a <b>Cookie:</b>
          header.

       client.ip
          Type: IP

          Readable from: client, backend

          The client's IP address, either the same as <b>remote.ip</b> or what the PROXY protocol told us.

       server.hostname
          Type: STRING

          Readable from: all

          The host name of the server, as returned by the <u><a href="../man3/gethostname.3.html">gethostname</a>(3)</u> system function.

       server.identity
          Type: STRING

          Readable from: all

          The identity of the server, as set by the <b>-i</b> parameter.

          If an <b>-i</b> parameter is not passed to varnishd, the return value  from  <u><a href="../man3/gethostname.3.html">gethostname</a>(3)</u>  system  function
          will be used.

       server.ip
          Type: IP

          Readable from: client, backend

          The  IP address of the socket on which the client connection was received, either the same as <b>local.ip</b>
          or what the PROXY protocol told us.

       remote.ip
          Type: IP

          Readable from: client, backend

          The IP address of the other end of the TCP connection.  This can either be  the  clients  IP,  or  the
          outgoing IP of a proxy server.

          If the connection is a UNIX domain socket, the value will be <b>0.0.0.0:0</b>

       local.endpoint  <b>VCL</b> <b>&gt;=</b> <b>4.1</b>
          Type: STRING

          Readable from: client, backend

          The address of the '-a' socket the session was accepted on.

          If the argument was <b>-a</b> <b>foo=:81</b> this would be ":81"

       local.ip
          Type: IP

          Readable from: client, backend

          The IP address (and port number) of the local end of the TCP connection, for instance <b>192.168.1.1:81</b>

          If the connection is a UNIX domain socket, the value will be <b>0.0.0.0:0</b>

       local.socket    <b>VCL</b> <b>&gt;=</b> <b>4.1</b>
          Type: STRING

          Readable from: client, backend

          The name of the '-a' socket the session was accepted on.

          If the argument was <b>-a</b> <b>foo=:81</b> this would be "foo".

          Note that all '-a' gets a default name on the form <b>a%d</b> if no name is provided.

   <b>req</b> <b>and</b> <b>req_top</b>
       These  variables describe the present request, and when ESI:include requests are being processed, req_top
       points to the request received from the client.

       req
          Type: HTTP

          Readable from: client

          The entire request HTTP data structure.  Mostly useful for passing to VMODs.

       req.backend_hint
          Type: BACKEND

          Readable from: client

          Writable from: client

          Set bereq.backend to this if we attempt to fetch.  When set  to  a  director,  reading  this  variable
          returns  an  actual backend if the director has resolved immediately, or the director otherwise.  When
          used in string context, returns the name of the director or backend, respectively.

       req.can_gzip
          Type: BOOL

          Readable from: client

          True if the client provided <b>gzip</b> or <b>x-gzip</b> in the <b>Accept-Encoding</b> header.

       req.esi <b>VCL</b> <b>&lt;=</b> <b>4.0</b>
          Type: BOOL

          Readable from: client

          Writable from: client

          Set to <b>false</b> to disable ESI processing regardless of any value in  beresp.do_esi.  Defaults  to  <b>true</b>.
          This variable is replaced by <b>resp.do_esi</b> in VCL 4.1.

       req.esi_level
          Type: INT

          Readable from: client

          A count of how many levels of ESI requests we're currently at.

       req.filters
          Type: STRING

          Readable from: vcl_recv

          Writable from: vcl_recv

          List  of  Varnish Fetch Processor (VFP) filters the req.body will be pulled through. The order left to
          right signifies processing from client to cache, iow the leftmost filter is run first on the  body  as
          received from the client after decoding of any transfer encodings.

          VFP  Filters  change the body before potentially being cached (e.g. using <b>std.cache_req.body()</b>) and/or
          being handled by the backend side, where it may get processed again by bereq.filters.

          Trying  to  set  req.filters  after  processing  the   request   body   (again,   for   example   with
          <b>std.cache_req.body()</b>) triggers a VCL error.

       req.grace
          Type: DURATION

          Readable from: client

          Writable from: client

          Unsettable from: client

          Upper limit on the object grace.

          During  lookup  the  minimum  of  req.grace  and  the  object's stored grace value will be used as the
          object's grace.

          When reading the unset value, it is returned as -1.

       req.hash
          Type: BLOB

          Readable from: vcl_hit, vcl_miss, vcl_pass, vcl_purge, vcl_deliver, vcl_synth, vcl_pipe

          The hash key of this request.  Mostly useful for  passing  to  VMODs,  but  can  also  be  useful  for
          debugging hit/miss status.

       req.hash_always_miss
          Type: BOOL

          Readable from: client

          Writable from: client

          Default: <b>false</b>.

          Force a cache miss for this request, even if perfectly good matching objects are in the cache.

          This  is  useful  to  force-update  the  cache without invalidating existing entries in case the fetch
          fails.

       req.hash_ignore_busy
          Type: BOOL

          Readable from: client

          Writable from: client

          Default: <b>false</b>.

          Ignore any busy object during cache lookup.

          You only want to do this when you have two server looking up content sideways from each other to avoid
          deadlocks.

       req.hash_ignore_vary
          Type: BOOL

          Readable from: client

          Writable from: client

          Default: <b>false</b>.

          Ignore objects vary headers during cache lookup.

          This returns the very first match regardless of the object compatibility with the client request. This
          is useful when variants are irrelevant to certain clients, and differences in the way the resource  is
          presented don't change how the client will interpret it.

          Use with caution.

       req.http.*
          Type: HEADER

          Readable from: client

          Writable from: client

          Unsettable from: client

          The headers of request, things like <b>req.http.date</b>.

          The  RFCs  allow  multiple  headers with the same name, and both <b>set</b> and <b>unset</b> will remove <u>all</u> headers
          with the name given.

          The header name <b>*</b> is a VCL symbol and as such cannot, for example, start with a numeral. To work  with
          valid  header  that  can't  be  represented  as  VCL  symbols  it  is possible to quote the name, like
          <b>req.http."grammatically.valid"</b>. None of the HTTP headers present in IANA registries need to be quoted,
          so the quoted syntax is discouraged but available for interoperability.

          Some headers that cannot be tampered with for proper HTTP fetch or delivery are read-only.

       req.http.content-length
          Type: HEADER

          Readable from: client

          The content-length header field is protected, see protected_headers.

       req.http.transfer-encoding
          Type: HEADER

          Readable from: client

          The transfer-encoding header field is protected, see protected_headers.

       req.is_hitmiss
          Type: BOOL

          Readable from: vcl_miss, vcl_deliver, vcl_pass, vcl_synth

          If this request resulted in a hitmiss

       req.is_hitpass
          Type: BOOL

          Readable from: vcl_pass, vcl_deliver, vcl_synth

          If this request resulted in a hitpass

       req.method
          Type: STRING

          Readable from: client

          Writable from: client

          The request method (e.g. "GET", "HEAD", ...)

       req.proto       <b>VCL</b> <b>&lt;=</b> <b>4.0</b>
          Type: STRING

          Readable from: client

          Writable from: client

          The HTTP protocol version used by the client, usually "HTTP/1.1" or "HTTP/2.0".

       req.proto       <b>VCL</b> <b>&gt;=</b> <b>4.1</b>
          Type: STRING

          Readable from: client

          The HTTP protocol version used by the client, usually "HTTP/1.1" or "HTTP/2.0".

       req.restarts
          Type: INT

          Readable from: client

          A count of how many times this request has been restarted.

       req.storage
          Type: STEVEDORE

          Readable from: client

          Writable from: client

          The storage backend to use to save this request body.

       req.time
          Type: TIME

          Readable from: client

          The time when the request was fully received, remains constant across restarts.

       req.trace
          Type: BOOL

          Readable from: client

          Writable from: client

          Controls if <b>VCL_trace</b> VSL records are emitted for the current request, see <u><a href="../man7/vsl.7.html">vsl</a>(7)</u>.

          Defaults to the setting of the <b>feature</b> <b>trace</b> parameter, see <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>.  Does  not  get  reset  by  a
          rollback.

       req.transport
          Type: STRING

          Readable from: client

          The transport protocol which brought this request.

       req.ttl
          Type: DURATION

          Readable from: client

          Writable from: client

          Unsettable from: client

          Upper limit on the object age for cache lookups to return hit.

          When reading the unset value, it is returned as -1.

       req.url
          Type: STRING

          Readable from: client

          Writable from: client

          The requested URL, for instance "/robots.txt".

       req.xid
          Type: INT

          Readable from: client

          Unique ID of this request.

       req_top.http.*
          Type: HEADER

          Readable from: client

          HTTP  headers  of  the top-level request in a tree of ESI requests.  Identical to req.http. in non-ESI
          requests.

          See req.http for general notes.

       req_top.method
          Type: STRING

          Readable from: client

          The request method of the top-level  request  in  a  tree  of  ESI  requests.  (e.g.  "GET",  "HEAD").
          Identical to req.method in non-ESI requests.

       req_top.proto
          Type: STRING

          Readable from: client

          HTTP  protocol  version of the top-level request in a tree of ESI requests.  Identical to req.proto in
          non-ESI requests.

       req_top.time
          Type: TIME

          Readable from: client

          The time when the top-level request was fully received, remains constant across restarts.

       req_top.url
          Type: STRING

          Readable from: client

          The requested URL of the top-level request in a tree of ESI requests.  Identical to req.url in non-ESI
          requests.

   <b>bereq</b>
       This is the request we send to the backend, it is built from the clients <b>req.*</b> fields  by  filtering  out
       "per-hop" fields which should not be passed along (<b>Connection:</b>, <b>Range:</b> and similar).

       Slightly more fields are allowed through for <b>pass`</b> <b>fetches</b> <b>than</b> <b>for</b> <b>`miss`</b> <b>fetches,</b> <b>for</b> <b>instance</b> <b>``Range</b>.

       bereq
          Type: HTTP

          Readable from: backend

          The entire backend request HTTP data structure.  Mostly useful as argument to VMODs.

       bereq.backend
          Type: BACKEND

          Readable from: vcl_pipe, backend

          Writable from: vcl_pipe, backend

          This  is  the  backend  or  director  we  attempt to fetch from.  When set to a director, reading this
          variable returns an actual  backend  if  the  director  has  resolved  immediately,  or  the  director
          otherwise.  When used in string context, returns the name of the director or backend, respectively.

       bereq.between_bytes_timeout
          Type: DURATION

          Readable from: backend

          Writable from: backend

          Unsettable from: vcl_pipe, backend

          Default:   <b>.between_bytes_timeout</b>  attribute  from  the  <u>backend_definition</u>,  which  defaults  to  the
          <b>between_bytes_timeout</b> parameter, see <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>.

          The time in seconds to wait between each received byte from the backend.  Not available in pipe mode.

       bereq.body
          Type: BODY

          Unsettable from: vcl_backend_fetch

          The request body.

          Unset will also remove bereq.http.content-length.

       bereq.connect_timeout
          Type: DURATION

          Readable from: vcl_pipe, backend

          Writable from: vcl_pipe, backend

          Unsettable from: vcl_pipe, backend

          Default: <b>.connect_timeout</b> attribute from the <u>backend_definition</u>, which defaults to the <b>connect_timeout</b>
          parameter, see <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>.

          The time in seconds to wait for a backend connection to be established.

       bereq.filters
          Type: STRING

          Readable from: vcl_backend_fetch

          Writable from: vcl_backend_fetch

          List of VDP filters the bereq.body will be pushed through when sending the body to the backend.

       bereq.first_byte_timeout
          Type: DURATION

          Readable from: backend

          Writable from: backend

          Unsettable from: vcl_pipe, backend

          Default:  <b>.first_byte_timeout</b>  attribute  from  the  <u>backend_definition</u>,   which   defaults   to   the
          <b>first_byte_timeout</b> parameter, see <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>.

          The time in seconds to wait getting the first byte back from the backend.  Not available in pipe mode.

       bereq.hash
          Type: BLOB

          Readable from: vcl_pipe, backend

          The hash key of this request, a copy of <b>req.hash</b>.

       bereq.http.*
          Type: HEADER

          Readable from: vcl_pipe, backend

          Writable from: vcl_pipe, backend

          Unsettable from: vcl_pipe, backend

          The headers to be sent to the backend.

          See req.http for general notes.

       bereq.http.content-length
          Type: HEADER

          Readable from: backend

          The content-length header field is protected, see protected_headers.

       bereq.http.transfer-encoding
          Type: HEADER

          Readable from: backend

          The transfer-encoding header field is protected, see protected_headers.

       bereq.is_bgfetch
          Type: BOOL

          Readable from: backend

          True for fetches where the client got a hit on an object in grace, and this fetch was kicked of in the
          background to get a fresh copy.

       bereq.is_hitmiss
          Type: BOOL

          Readable from: backend

          If this backend request was caused by a hitmiss.

       bereq.is_hitpass
          Type: BOOL

          Readable from: backend

          If this backend request was caused by a hitpass.

       bereq.method
          Type: STRING

          Readable from: vcl_pipe, backend

          Writable from: vcl_pipe, backend

          The request type (e.g. "GET", "HEAD").

          Regular (non-pipe, non-pass) fetches are always "GET"

       bereq.proto     <b>VCL</b> <b>&lt;=</b> <b>4.0</b>
          Type: STRING

          Readable from: vcl_pipe, backend

          Writable from: vcl_pipe, backend

          The HTTP protocol version, "HTTP/1.1" unless a pass or pipe request has "HTTP/1.0" in <b>req.proto</b>

       bereq.proto     <b>VCL</b> <b>&gt;=</b> <b>4.1</b>
          Type: STRING

          Readable from: vcl_pipe, backend

          The HTTP protocol version, "HTTP/1.1" unless a pass or pipe request has "HTTP/1.0" in <b>req.proto</b>

       bereq.retries
          Type: INT

          Readable from: backend

          A count of how many times this request has been retried.

       bereq.task_deadline
          Type: DURATION

          Readable from: vcl_pipe

          Writable from: vcl_pipe

          Unsettable from: vcl_pipe

          Deadline  for  pipe  sessions,  defaults <b>0s</b>, which falls back to the <b>pipe_task_deadline</b> parameter, see
          <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>

       bereq.time
          Type: TIME

          Readable from: vcl_pipe, backend

          The time when we started preparing the first backend request, remains constant across retries.

       bereq.trace
          Type: BOOL

          Readable from: backend

          Writable from: backend

          Controls if <b>VCL_trace</b> VSL records are emitted for the current request, see <u><a href="../man7/vsl.7.html">vsl</a>(7)</u>.

          Inherits the value of <b>req.trace</b> when the backend request is created. Does not get reset by a rollback.

       bereq.uncacheable
          Type: BOOL

          Readable from: backend

          Indicates whether this request is uncacheable due to a <u>pass</u>  in  the  client  side  or  a  hit  on  an
          hit-for-pass object.

       bereq.url
          Type: STRING

          Readable from: vcl_pipe, backend

          Writable from: vcl_pipe, backend

          The requested URL, copied from <b>req.url</b>

       bereq.xid
          Type: INT

          Readable from: vcl_pipe, backend

          Unique ID of this request.

   <b>beresp</b>
       The response received from the backend, one cache misses, the store object is built from <b>beresp</b>.

       beresp
          Type: HTTP

          Readable from: vcl_backend_response, vcl_backend_error

          The entire backend response HTTP data structure, useful as argument to VMOD functions.

       beresp.age
          Type: DURATION

          Readable from: vcl_backend_response, vcl_backend_error

          Default: Age header, or zero.

          The age of the object.

       beresp.backend
          Type: BACKEND

          Readable from: vcl_backend_response, vcl_backend_error

          This is the backend we fetched from.  If bereq.backend was set to a director, this will be the backend
          selected by the director.  When used in string context, returns its name.

       beresp.backend.ip       <b>VCL</b> <b>&lt;=</b> <b>4.0</b>
          Type: IP

          Readable from: vcl_backend_response

          IP of the backend this response was fetched from.

       beresp.backend.name
          Type: STRING

          Readable from: vcl_backend_response, vcl_backend_error

          Name of the backend this response was fetched from.  Same as beresp.backend.

       beresp.body
          Type: BODY

          Writable from: vcl_backend_error

          For producing a synthetic body.

       beresp.do_esi
          Type: BOOL

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          Default: <b>false</b>.

          Set  it  to true to parse the object for ESI directives. This is necessary for later ESI processing on
          the client side. If beresp.do_esi is false when an object enters the cache, client side ESI processing
          will not be possible (obj.can_esi will be false).

          It is a VCL error to use beresp.do_esi after setting beresp.filters.

       beresp.do_gunzip
          Type: BOOL

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          Default: <b>false</b>.

          Set to <b>true</b> to gunzip the object while storing it in the cache.

          If <b>http_gzip_support</b> is disabled, setting this variable has no effect.

          It is a VCL error to use beresp.do_gunzip after setting beresp.filters.

       beresp.do_gzip
          Type: BOOL

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          Default: <b>false</b>.

          Set to <b>true</b> to gzip the object while storing it.

          If <b>http_gzip_support</b> is disabled, setting this variable has no effect.

          It is a VCL error to use beresp.do_gzip after setting beresp.filters.

       beresp.do_stream
          Type: BOOL

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          Default: <b>true</b>.

          Deliver the object to the client while fetching the whole object into varnish.

          For uncacheable objects, storage for parts of the body which have been sent  to  the  client  may  get
          freed early, depending on the storage engine used.

          This variable has no effect if beresp.do_esi is true or when the response body is empty.

       beresp.filters
          Type: STRING

          Readable from: vcl_backend_response

          Writable from: vcl_backend_response

          List  of  Varnish Fetch Processor (VFP) filters the beresp.body will be pulled through. The order left
          to right signifies processing from backend to cache, iow the leftmost filter is run first on the  body
          as received from the backend after decoding of any transfer encodings.

          VFP  Filters change the body before going into the cache and/or being handed to the client side, where
          it may get processed again by resp.filters.

          The following VFP filters exist in varnish-cache:

          • <b>gzip</b>: compress a body using gzip

          • <b>testgunzip</b>: Test if a body is valid gzip and refuse it otherwise

          • <b>gunzip</b>: Uncompress gzip content

          • <b>esi</b>: ESI-process plain text content

          • <b>esi_gzip</b>: Save gzipped snippets for efficient ESI-processing

            This filter enables stitching together ESI from individually gzipped  fragments,  saving  processing
            power for re-compression on the client side at the expense of some compression efficiency.

          Additional VFP filters are available from VMODs.

          By default, beresp.filters is constructed as follows:

          • <b>gunzip</b> gets added for gzipped content if <b>beresp.do_gunzip</b> or <b>beresp.do_esi</b> are true.

          • <b>esi_gzip</b>  gets  added  if  <b>beresp.do_esi</b>  is true together with <b>beresp.do_gzip</b> or content is already
            compressed.

          • <b>esi</b> gets added if <b>beresp.do_esi</b> is true

          • <b>gzip</b> gets added for uncompressed content if <b>beresp.do_gzip</b> is true

          • <b>testgunzip</b> gets added for compressed content if <b>beresp.do_gunzip</b> is false.

          After beresp.filters is set, using any of the beforementioned <b>beresp.do_*</b> switches is a VCL error.

       beresp.grace
          Type: DURATION

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          Default: Cache-Control <b>stale-while-revalidate</b> directive, or <b>default_grace</b> parameter.

          Set to a period to enable grace.

       beresp.http.*
          Type: HEADER

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          Unsettable from: vcl_backend_response, vcl_backend_error

          The HTTP headers returned from the server.

          See req.http for general notes.

       beresp.http.content-length
          Type: HEADER

          Readable from: vcl_backend_response, vcl_backend_error

          The content-length header field is protected, see protected_headers.

       beresp.http.transfer-encoding
          Type: HEADER

          Readable from: vcl_backend_response, vcl_backend_error

          The transfer-encoding header field is protected, see protected_headers.

       beresp.keep
          Type: DURATION

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          Default: <b>default_keep</b> parameter.

          Set to a period to enable conditional backend requests.

          The keep time is cache lifetime in addition to the ttl.

          Objects with ttl expired but with keep time left may be used to issue conditional (If-Modified-Since /
          If-None-Match) requests to the backend to refresh them.

       beresp.proto    <b>VCL</b> <b>&lt;=</b> <b>4.0</b>
          Type: STRING

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          The HTTP protocol version the backend replied with.

       beresp.proto    <b>VCL</b> <b>&gt;=</b> <b>4.1</b>
          Type: STRING

          Readable from: vcl_backend_response, vcl_backend_error

          The HTTP protocol version the backend replied with.

       beresp.reason
          Type: STRING

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          The HTTP status message returned by the server.

       beresp.status
          Type: INT

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          The HTTP status code returned by the server.

          More information in the HTTP response status section.

       beresp.storage
          Type: STEVEDORE

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          The storage backend to use to save this object. If none is set, Varnish will pick a storage backend in
          a round-robin fashion, or the <u>Transient</u> backend if the object is short-lived.

       beresp.storage_hint     <b>VCL</b> <b>&lt;=</b> <b>4.0</b>
          Type: STRING

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          Deprecated since varnish 5.1 and discontinued since VCL 4.1 (varnish 6.0). Use beresp.storage instead.

          Hint to Varnish that you want to save this object to a particular storage backend.

       beresp.time
          Type: TIME

          Readable from: vcl_backend_response, vcl_backend_error

          When the backend headers were fully received just before <b>vcl_backend_response</b> <b>{}</b> was entered, or  when
          <b>vcl_backend_error</b> <b>{}</b> was entered.

       beresp.transit_buffer
          Type: BYTES

          Readable from: vcl_backend_response

          Writable from: vcl_backend_response

          Default: <b>transit_buffer</b> parameter, see <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>.

          The  maximum  number of bytes the client can be ahead of the backend during a streaming pass if <b>beresp</b>
          is uncacheable. See also <b>transit_buffer</b> parameter documentation in <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>.

       beresp.ttl
          Type: DURATION

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          Default: Cache-Control <b>s-maxage</b> or <b>max-age</b> directives, or a value computed from the  Expires  header's
          deadline, or the <b>default_ttl</b> parameter.

          The object's remaining time to live, in seconds.

       beresp.uncacheable
          Type: BOOL

          Readable from: vcl_backend_response, vcl_backend_error

          Writable from: vcl_backend_response, vcl_backend_error

          Inherited from bereq.uncacheable, see there.

          Setting this variable makes the object uncacheable.

          This may produce a hit-for-miss object in the cache.

          Clearing   the  variable  has  no  effect  and  will  log  the  warning  "Ignoring  attempt  to  reset
          beresp.uncacheable".

       beresp.was_304
          Type: BOOL

          Readable from: vcl_backend_response, vcl_backend_error

          When <b>true</b> this indicates that we got a 304 response to our conditional  fetch  from  the  backend  and
          turned that into <b>beresp.status</b> <b>=</b> <b>200</b>

   <b>obj</b>
       This is the object we found in cache.  It cannot be modified.

       obj.age
          Type: DURATION

          Readable from: vcl_hit, vcl_deliver

          The age of the object.

       obj.can_esi
          Type: BOOL

          Readable from: vcl_hit, vcl_deliver

          If  the  object  can be ESI processed, that is if setting <b>resp.do_esi</b> or adding <b>esi</b> to <b>resp.filters</b> in
          <b>vcl_deliver</b> <b>{}</b> would cause the response body to be ESI processed.

       obj.grace
          Type: DURATION

          Readable from: vcl_hit, vcl_deliver

          The object's grace period in seconds.

       obj.hits
          Type: INT

          Readable from: vcl_hit, vcl_deliver

          The count of cache-hits on this object.

          In <u>vcl_deliver</u> a value of 0 indicates a cache miss.

       obj.http.*
          Type: HEADER

          Readable from: vcl_hit

          The HTTP headers stored in the object.

          See req.http for general notes.

       obj.keep
          Type: DURATION

          Readable from: vcl_hit, vcl_deliver

          The object's keep period in seconds.

       obj.proto
          Type: STRING

          Readable from: vcl_hit

          The HTTP protocol version stored in the object.

       obj.reason
          Type: STRING

          Readable from: vcl_hit

          The HTTP reason phrase stored in the object.

       obj.status
          Type: INT

          Readable from: vcl_hit

          The HTTP status code stored in the object.

          More information in the HTTP response status section.

       obj.storage
          Type: STEVEDORE

          Readable from: vcl_hit, vcl_deliver

          The storage backend where this object is stored.

       obj.time
          Type: TIME

          Readable from: vcl_hit, vcl_deliver

          The time the object was created from the perspective of the  server  which  generated  it.  This  will
          roughly be equivalent to <b>now</b> - <b>obj.age</b>.

       obj.ttl
          Type: DURATION

          Readable from: vcl_hit, vcl_deliver

          The object's remaining time to live, in seconds.

       obj.uncacheable
          Type: BOOL

          Readable from: vcl_deliver

          Whether the object is uncacheable (pass, hit-for-pass or hit-for-miss).

   <b>resp</b>
       This  is  the  response  we send to the client, it is built from either <b>beresp</b> (pass/miss), <b>obj</b> (hits) or
       created from whole cloth (synth).

       With the exception of <b>resp.body</b> all <b>resp.*</b> variables available in both <b>vcl_deliver{}</b> and <b>vcl_synth{}</b> as a
       matter of symmetry.

       resp
          Type: HTTP

          Readable from: vcl_deliver, vcl_synth

          The entire response HTTP data structure, useful as argument to VMODs.

       resp.body
          Type: BODY

          Writable from: vcl_synth

          To produce a synthetic response body, for instance for errors.

       resp.do_esi     <b>VCL</b> <b>&gt;=</b> <b>4.1</b>
          Type: BOOL

          Readable from: vcl_deliver, vcl_synth

          Writable from: vcl_deliver, vcl_synth

          Default: obj.can_esi

          This can be used to selectively disable ESI processing, even though ESI parsing happened during  fetch
          (see beresp.do_esi).  This is useful when Varnish caches peer with each other.

          It is a VCL error to use resp.do_esi after setting resp.filters.

       resp.filters
          Type: STRING

          Readable from: vcl_deliver, vcl_synth

          Writable from: vcl_deliver, vcl_synth

          List of VDP filters the resp.body will be pushed through.

          Before  resp.filters  is  set, the value read will be the default filter list as determined by varnish
          based on resp.do_esi and request headers.

          After resp.filters is set, changing any  of  the  conditions  which  otherwise  determine  the  filter
          selection will have no effect. Using resp.do_esi is an error once resp.filters is set.

       resp.http.*
          Type: HEADER

          Readable from: vcl_deliver, vcl_synth

          Writable from: vcl_deliver, vcl_synth

          Unsettable from: vcl_deliver, vcl_synth

          The HTTP headers that will be returned.

          See req.http for general notes.

       resp.http.content-length
          Type: HEADER

          Readable from: vcl_deliver, vcl_synth

          The content-length header field is protected, see protected_headers.

       resp.http.transfer-encoding
          Type: HEADER

          Readable from: vcl_deliver, vcl_synth

          The transfer-encoding header field is protected, see protected_headers.

       resp.is_streaming
          Type: BOOL

          Readable from: vcl_deliver, vcl_synth

          Returns true when the response will be streamed while being fetched from the backend.

       resp.proto      <b>VCL</b> <b>&lt;=</b> <b>4.0</b>
          Type: STRING

          Readable from: vcl_deliver, vcl_synth

          Writable from: vcl_deliver, vcl_synth

          The HTTP protocol version to use for the response.

       resp.proto      <b>VCL</b> <b>&gt;=</b> <b>4.1</b>
          Type: STRING

          Readable from: vcl_deliver, vcl_synth

          The HTTP protocol version to use for the response.

       resp.reason
          Type: STRING

          Readable from: vcl_deliver, vcl_synth

          Writable from: vcl_deliver, vcl_synth

          The HTTP status message that will be returned.

       resp.status
          Type: INT

          Readable from: vcl_deliver, vcl_synth

          Writable from: vcl_deliver, vcl_synth

          The HTTP status code that will be returned.

          More information in the HTTP response status section.

          resp.status  200  will  get changed into 304 by core code after a return(deliver) from vcl_deliver for
          conditional requests to cached content if validation succeeds.

          For the validation, first <b>req.http.If-None-Match</b> is compared against <b>resp.http.Etag</b>. If  they  compare
          equal according to the rules for weak validation (see RFC7232), a 304 is sent.

          Secondly, <b>req.http.If-Modified-Since</b> is compared against <b>resp.http.Last-Modified</b> or, if it is unset or
          weak,  against  the  point in time when the object was last modified based on the <b>Date</b> and <b>Age</b> headers
          received with the backend response which created the object. If the object has not been modified based
          on that comparison, a 304 is sent.

       resp.time
          Type: TIME

          Readable from: vcl_deliver, vcl_synth

          The time when we started preparing the response, just before entering <b>vcl_synth</b> <b>{}</b> or <b>vcl_deliver</b> <b>{}</b>.

   <b>Special</b> <b>variables</b>
       now
          Type: TIME

          Readable from: all

          The current time, in seconds since the UNIX epoch.

          When converted to STRING in expressions it returns  a  formatted  timestamp  like  <b>Tue,</b>  <b>20</b>  <b>Feb</b>  <b>2018</b>
          <b>09:30:31</b> <b>GMT</b>

          <b>now</b>  remains  stable  for  the duration of any built-in VCL subroutine to make time-based calculations
          predictable and avoid edge cases.

          In other words, even if considerable amounts of time are spent in VCL, <b>now</b> will always  represent  the
          point  in  time  when the respective built-in VCL subroutine was entered. <b>now</b> is thus not suitable for
          any kind of time measurements. See <u>std.timestamp()</u>, <u>std.now()</u> and <u>std.timed_call()</u> in <u><a href="../man3/vmod_std.3.html">vmod_std</a>(3)</u>.

   <b>sess</b>
       A session corresponds to the "conversation" that Varnish has with a single client connection, over  which
       one  or  more  request/response  transactions  may take place. It may comprise the traffic over an HTTP/1
       keep-alive connection, or the multiplexed traffic over an HTTP/2 connection.

       sess.idle_send_timeout
          Type: DURATION

          Readable from: client

          Writable from: client

          Unsettable from: client

          Send timeout for individual pieces of data on client connections, defaults  to  the  <b>idle_send_timeout</b>
          parameter, see <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>

       sess.send_timeout
          Type: DURATION

          Readable from: client

          Writable from: client

          Unsettable from: client

          Total timeout for ordinary HTTP1 responses, defaults to the <b>send_timeout</b> parameter, see <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>

       sess.timeout_idle
          Type: DURATION

          Readable from: client

          Writable from: client

          Unsettable from: client

          Idle timeout for this session, defaults to the <b>timeout_idle</b> parameter, see <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>

       sess.timeout_linger
          Type: DURATION

          Readable from: client

          Writable from: client

          Unsettable from: client

          Linger timeout for this session, defaults to the <b>timeout_linger</b> parameter, see <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>

       sess.xid        <b>VCL</b> <b>&gt;=</b> <b>4.1</b>
          Type: INT

          Readable from: client, backend

          Unique ID of this session.

   <b>storage</b>
       storage.&lt;name&gt;.free_space
          Type: BYTES

          Readable from: client, backend

          Default: 0

          Free space available in the named stevedore. Only available for the malloc stevedore.

       storage.&lt;name&gt;.happy
          Type: BOOL

          Readable from: client, backend

          Default: true

          Health status for the named stevedore. Not available in any of the current stevedores.

       storage.&lt;name&gt;.used_space
          Type: BYTES

          Readable from: client, backend

          Default: 0

          Used space in the named stevedore. Only available for the malloc stevedore.

   <b>Protected</b> <b>header</b> <b>fields</b>
       The  <b>content-length</b>  and <b>transfer-encoding</b> headers are read-only. They must be preserved to ensure HTTP/1
       framing remains consistent and maintain a proper request and response synchronization with  both  clients
       and backends.

       VMODs  can  still  update  these  headers,  when  there  is  a  reason  to  change the framing, such as a
       transformation of a request or response body.

   <b>HTTP</b> <b>response</b> <b>status</b>
       A HTTP status code has 3 digits XYZ where X must be between 1 and 5 included.  Since it is  not  uncommon
       to  see  HTTP  clients  or servers relying on non-standard or even invalid status codes, Varnish can work
       with any status between 100 and 999.

       Within VCL code it is even possible to use status codes in the form VWXYZ as long as the overall value is
       lower than 65536, but only the XYZ part will be sent to the client, by which time the X  must  also  have
       become non-zero.

       The  VWXYZ  form of status codes can be communicate extra information in <b>resp.status</b> and <b>beresp.status</b> to
       <b>return(synth(...))</b> and <b>return(error(...))</b>, to indicate which synthetic content to produce:

          sub vcl_recv {
              if ([...]) {
                  return <a href="../man12404/synth.12404.html">synth</a>(12404);
              }
          }

          sub vcl_synth {
              if (resp.status == 12404) {
                  [...]       // this specific 404
              } else if (resp.status % 1000 == 404) {
                  [...]       // all other 404's
              }
          }

       The <b>obj.status</b> variable will inherit the VWXYZ form, but in a ban expression only the XYZ  part  will  be
       available. The VWXYZ form is strictly limited to VCL execution.

       Assigning  an  HTTP  standardized  code  to  <b>resp.status</b>  or  <b>beresp.status</b>  will also set <b>resp.reason</b> or
       <b>beresp.reason</b>  to the corresponding status message.

   <b>304</b> <b>handling</b>
       For a 304 response, Varnish core code amends <b>beresp</b> before calling <u>vcl_backend_response</u>:

       • If the gzip status changed, <b>Content-Encoding</b> is unset and any <b>Etag</b> is weakened

       • Any headers not present in the 304 response are copied from the existing cache  object.  <b>Content-Length</b>
         is copied if present in the existing cache object and discarded otherwise.

       • The status gets set to 200.

       <u>beresp.was_304</u> marks that this conditional response processing has happened.

       Note: Backend conditional requests are independent of client conditional requests, so clients may receive
       304 responses no matter if a backend request was conditional.

   <b>beresp.ttl</b> <b>/</b> <b>beresp.grace</b> <b>/</b> <b>beresp.keep</b>
       Before  calling  <u>vcl_backend_response</u>,  core  code  sets  <b>beresp.ttl</b> based on the response status and the
       response headers <b>Age</b>, <b>Cache-Control</b> or <b>Expires</b> and <b>Date</b> as follows:

       • If present and valid, the value of the <b>Age</b> header is effectively deduced from all ttl calculations.

       • For status codes 200, 203, 204, 300, 301, 304, 404, 410 and 414:

         • If <b>Cache-Control</b> contains an <b>s-maxage</b> or <b>max-age</b> field (in that order of preference), the ttl is  set
           to the respective non-negative value or 0 if negative.

         • Otherwise, if no <b>Expires</b> header exists, the default ttl is used.

         • Otherwise, if <b>Expires</b> contains a time stamp before <b>Date</b>, the ttl is set to 0.

         • Otherwise,  if no <b>Date</b> header is present or the <b>Date</b> header timestamp differs from the local clock by
           no more than the <u>clock_skew</u> parameter, the ttl is set to

           • 0 if <b>Expires</b> denotes a past timestamp or

           • the difference between the local clock and the <b>Expires</b> header otherwise.

         • Otherwise, the ttl is set to the difference between <b>Expires</b> and <b>Date</b>

       • For status codes 302 and 307, the calculation is identical except that the default ttl is not used  and
         -1 is returned if neither <b>Cache-Control</b> nor <b>Expires</b> exists.

       • For all other status codes, ttl -1 is returned.

       <b>beresp.grace</b> defaults to the <u>default_grace</u> parameter.

       For  a  non-negative ttl, if <b>Cache-Control</b> contains a <b>stale-while-revalidate</b> field value, <b>beresp.grace</b> is
       set to that value if non-negative or 0 otherwise.

       <b>beresp.keep</b> defaults to the <u>default_keep</u> parameter.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       • <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>

       • <u><a href="../man7/vcl.7.html">vcl</a>(7)</u>

</pre><h4><b>HISTORY</b></h4><pre>
       VCL was developed by Poul-Henning Kamp in cooperation with Verdens Gang AS, Redpill  Linpro  and  Varnish
       Software.   This  manual  page is written by Per Buer, Poul-Henning Kamp, Martin Blix Grydeland, Kristian
       Lyngstøl, Lasse Karstensen and others.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       This document is licensed under the same license as Varnish itself. See LICENSE for details.

       • Copyright (c) 2006 Verdens Gang AS

       • Copyright (c) 2006-2021 Varnish Software AS

                                                                                                <u><a href="../man7/VCL-VARIABLES.7.html">VCL-VARIABLES</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>