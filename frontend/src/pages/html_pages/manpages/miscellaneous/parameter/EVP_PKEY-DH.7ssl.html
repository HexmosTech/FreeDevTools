<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVP_PKEY-DH, EVP_PKEY-DHX, EVP_KEYMGMT-DH, EVP_KEYMGMT-DHX - EVP_PKEY DH and DHX keytype and algorithm</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/openssl">openssl_3.5.0-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       EVP_PKEY-DH, EVP_PKEY-DHX, EVP_KEYMGMT-DH, EVP_KEYMGMT-DHX - EVP_PKEY DH and DHX keytype and algorithm
       support

</pre><h4><b>DESCRIPTION</b></h4><pre>
       For finite field Diffie-Hellman key agreement, two classes of domain parameters can be used: "safe"
       domain parameters that are associated with approved named safe-prime groups, and a class of
       "FIPS186-type" domain parameters. FIPS186-type domain parameters should only be used for backward
       compatibility with existing applications that cannot be upgraded to use the approved safe-prime groups.

       See <b><a href="../man7/EVP_PKEY-FFC.7.html">EVP_PKEY-FFC</a></b>(7) for more information about FFC keys.

       The <b>DH</b> key type uses PKCS#3 format which saves <u>p</u> and <u>g</u>, but not the <u>q</u> value.  The <b>DHX</b> key type uses X9.42
       format which saves the value of <u>q</u> and this must be used for FIPS186-4. If key validation is required,
       users should be aware of the nuances associated with FIPS186-4 style parameters as discussed in "DH and
       DHX key validation".

   <b>DH</b> <b>and</b> <b>DHX</b> <b>domain</b> <b>parameters</b>
       In addition to the common FFC parameters that all FFC keytypes should support (see "FFC parameters" in
       <b><a href="../man7/EVP_PKEY-FFC.7.html">EVP_PKEY-FFC</a></b>(7)) the <b>DHX</b> and <b>DH</b> keytype implementations support the following:

       "group" (<b>OSSL_PKEY_PARAM_GROUP_NAME</b>) &lt;UTF8 string&gt;
           Sets  or  gets a string that associates a <b>DH</b> or <b>DHX</b> named safe prime group with known values for <u>p</u>, <u>q</u>
           and <u>g</u>.

           The following values  can  be  used  by  the  OpenSSL's  default  and  FIPS  providers:  "ffdhe2048",
           "ffdhe3072",   "ffdhe4096",   "ffdhe6144",   "ffdhe8192",   "modp_2048",   "modp_3072",  "modp_4096",
           "modp_6144", "modp_8192".

           The following additional values  can  also  be  used  by  OpenSSL's  default  provider:  "modp_1536",
           "dh_1024_160", "dh_2048_224", "dh_2048_256".

           DH/DHX  named groups can be easily validated since the parameters are well known.  For protocols that
           only transfer <u>p</u> and <u>g</u> the value of <u>q</u> can also be retrieved.

   <b>DH</b> <b>and</b> <b>DHX</b> <b>additional</b> <b>parameters</b>
       "encoded-pub-key" (<b>OSSL_PKEY_PARAM_ENCODED_PUBLIC_KEY</b>) &lt;octet string&gt;
           Used for getting and setting the encoding of the DH public key used in a key exchange message for the
           TLS protocol.  See <b>EVP_PKEY_set1_encoded_public_key()</b> and <b>EVP_PKEY_get1_encoded_public_key()</b>.

   <b>DH</b> <b>additional</b> <b>domain</b> <b>parameters</b>
       "safeprime-generator" (<b>OSSL_PKEY_PARAM_DH_GENERATOR</b>) &lt;integer&gt;
           Used for DH generation of safe primes using the old safe prime generator code.  The default value  is
           2.   It  is  recommended  to  use a named safe prime group instead, if domain parameter validation is
           required.

           Randomly generated safe primes are not allowed by FIPS, so setting this value for  the  OpenSSL  FIPS
           provider will instead choose a named safe prime group based on the size of <u>p</u>.

   <b>DH</b> <b>and</b> <b>DHX</b> <b>domain</b> <b>parameter</b> <b>/</b> <b>key</b> <b>generation</b> <b>parameters</b>
       In  addition  to the common FFC key generation parameters that all FFC key types should support (see "FFC
       key generation parameters" in <b><a href="../man7/EVP_PKEY-FFC.7.html">EVP_PKEY-FFC</a></b>(7))  the  <b>DH</b>  and  <b>DHX</b>  keytype  implementation  supports  the
       following:

       "type" (<b>OSSL_PKEY_PARAM_FFC_TYPE</b>) &lt;UTF8 string&gt;
           Sets the type of parameter generation. For <b>DH</b> valid values are:

           "fips186_4"
           "default"
           "fips186_2"
               These are described in "FFC key generation parameters" in <b><a href="../man7/EVP_PKEY-FFC.7.html">EVP_PKEY-FFC</a></b>(7)

           "group"
               This specifies that a named safe prime name will be chosen using the "pbits" type.

           "generator"
               A  safe  prime  generator.  See  the "safeprime-generator" type above.  This is only valid for <b>DH</b>
               keys.

       "pbits" (<b>OSSL_PKEY_PARAM_FFC_PBITS</b>) &lt;unsigned integer&gt;
           Sets the size (in bits) of the prime 'p'.

           For "fips186_4" this must be 2048.  For "fips186_2" this must be 1024.  For "group" this can  be  any
           one of 2048, 3072, 4096, 6144 or 8192.

       "priv_len" (<b>OSSL_PKEY_PARAM_DH_PRIV_LEN</b>) &lt;integer&gt;
           An  optional value to set the maximum length of the generated private key.  The default value used if
           this is not set is the maximum value of BN_num_bits(<u>q</u>)). The minimum value that this can be set to is
           2 * s.  Where s is the security strength of the key which has values of 112, 128, 152,  176  and  200
           for key sizes of 2048, 3072, 4096, 6144 and 8192.

   <b>DH</b> <b>and</b> <b>DHX</b> <b>key</b> <b>validation</b>
       For  keys  that  are  not  a  named  group  the FIPS186-4 standard specifies that the values used for FFC
       parameter generation are also required for parameter validation. This  means  that  optional  FFC  domain
       parameter  values  for <u>seed</u>, <u>pcounter</u> and <u>gindex</u> or <u>hindex</u> may need to be stored for validation purposes.
       For <b>DHX</b> the <u>seed</u> and <u>pcounter</u> can be stored in ASN1 data (but the <u>gindex</u> or <u>hindex</u> cannot be stored).  It
       is recommended to use a <b>DH</b> parameters with named safe prime group instead.

       With  the  OpenSSL FIPS provider, <b><a href="../man3/EVP_PKEY_param_check.3.html">EVP_PKEY_param_check</a></b>(3) and <b><a href="../man3/EVP_PKEY_param_check_quick.3.html">EVP_PKEY_param_check_quick</a></b>(3) behave in the
       following way: the parameters are tested if they are either an approved safe prime group OR that the  FFC
       parameters conform to FIPS186-4 as defined in SP800-56Ar3 <u>Assurances</u> <u>of</u> <u>Domain-Parameter</u> <u>Validity</u>.

       The  OpenSSL  default  provider  uses  simpler  checks  that  allows there to be no <u>q</u> value for backwards
       compatibility, however the <b><a href="../man3/EVP_PKEY_param_check.3.html">EVP_PKEY_param_check</a></b>(3) will test the <u>p</u> value for being a prime  (and  a  safe
       prime  if  <u>q</u>  is  missing)  which can take significant time. The <b><a href="../man3/EVP_PKEY_param_check_quick.3.html">EVP_PKEY_param_check_quick</a></b>(3) avoids the
       prime tests.

       <b><a href="../man3/EVP_PKEY_public_check.3.html">EVP_PKEY_public_check</a></b>(3) conforms to SP800-56Ar3 <u>FFC</u> <u>Full</u> <u>Public-Key</u> <u>Validation</u>.

       <b><a href="../man3/EVP_PKEY_public_check_quick.3.html">EVP_PKEY_public_check_quick</a></b>(3) conforms to SP800-56Ar3 <u>FFC</u> <u>Partial</u> <u>Public-Key</u> <u>Validation</u> when the key  is
       an approved named safe prime group, otherwise it is the same as <b><a href="../man3/EVP_PKEY_public_check.3.html">EVP_PKEY_public_check</a></b>(3).

       <b><a href="../man3/EVP_PKEY_private_check.3.html">EVP_PKEY_private_check</a></b>(3)  tests  that  the private key is in the correct range according to SP800-56Ar3.
       The OpenSSL FIPS provider requires the value of <u>q</u> to be set (note that this is implicitly set  for  named
       safe prime groups).  For backwards compatibility the OpenSSL default provider only requires <u>p</u> to be set.

       <b><a href="../man3/EVP_PKEY_pairwise_check.3.html">EVP_PKEY_pairwise_check</a></b>(3) conforms to SP800-56Ar3 <u>Owner</u> <u>Assurance</u> <u>of</u> <u>Pair-wise</u> <u>Consistency</u>.

</pre><h4><b>EXAMPLES</b></h4><pre>
       An <b>EVP_PKEY</b> context can be obtained by calling:

           EVP_PKEY_CTX *pctx = EVP_PKEY_CTX_new_from_name(NULL, "DH", NULL);

       A <b>DH</b> key can be generated with a named safe prime group by calling:

           int priv_len = 2 * 112;
           OSSL_PARAM params[3];
           EVP_PKEY *pkey = NULL;
           EVP_PKEY_CTX *pctx = EVP_PKEY_CTX_new_from_name(NULL, "DH", NULL);

           params[0] = OSSL_PARAM_construct_utf8_string("group", "ffdhe2048", 0);
           /* "priv_len" is optional */
           params[1] = OSSL_PARAM_construct_int("priv_len", &amp;priv_len);
           params[2] = OSSL_PARAM_construct_end();

           EVP_PKEY_keygen_init(pctx);
           EVP_PKEY_CTX_set_params(pctx, params);
           EVP_PKEY_generate(pctx, &amp;pkey);
           ...
           EVP_PKEY_free(pkey);
           EVP_PKEY_CTX_free(pctx);

       <b>DHX</b> domain parameters can be generated according to <b>FIPS186-4</b> by calling:

           int gindex = 2;
           unsigned int pbits = 2048;
           unsigned int qbits = 256;
           OSSL_PARAM params[6];
           EVP_PKEY *param_key = NULL;
           EVP_PKEY_CTX *pctx = NULL;

           pctx = EVP_PKEY_CTX_new_from_name(NULL, "DHX", NULL);
           EVP_PKEY_paramgen_init(pctx);

           params[0] = OSSL_PARAM_construct_uint("pbits", &amp;pbits);
           params[1] = OSSL_PARAM_construct_uint("qbits", &amp;qbits);
           params[2] = OSSL_PARAM_construct_int("gindex", &amp;gindex);
           params[3] = OSSL_PARAM_construct_utf8_string("type", "fips186_4", 0);
           params[4] = OSSL_PARAM_construct_utf8_string("digest", "SHA256", 0);
           params[5] = OSSL_PARAM_construct_end();
           EVP_PKEY_CTX_set_params(pctx, params);

           EVP_PKEY_generate(pctx, &amp;param_key);

           EVP_PKEY_print_params(bio_out, param_key, 0, NULL);
           ...
           EVP_PKEY_free(param_key);
           EVP_PKEY_CTX_free(pctx);

       A <b>DH</b> key can be generated using domain parameters by calling:

           EVP_PKEY *key = NULL;
           EVP_PKEY_CTX *gctx = EVP_PKEY_CTX_new_from_pkey(NULL, param_key, NULL);

           EVP_PKEY_keygen_init(gctx);
           EVP_PKEY_generate(gctx, &amp;key);
           EVP_PKEY_print_private(bio_out, key, 0, NULL);
           ...
           EVP_PKEY_free(key);
           EVP_PKEY_CTX_free(gctx);

       To  validate  <b>FIPS186-4</b> <b>DHX</b> domain parameters decoded from <b>PEM</b> or <b>DER</b> data, additional values used during
       generation may be required to be set into the key.

       <b>EVP_PKEY_todata()</b>, <b>OSSL_PARAM_merge()</b>, and <b>EVP_PKEY_fromdata()</b> are useful to add these parameters to  the
       original  key  or  domain  parameters  before the actual validation. In production code the return values
       should be checked.

           EVP_PKEY *received_domp = ...; /* parameters received and decoded */
           unsigned char *seed = ...;     /* and additional parameters received */
           size_t seedlen = ...;          /* by other means, required */
           int gindex = ...;              /* for the validation */
           int pcounter = ...;
           int hindex = ...;
           OSSL_PARAM extra_params[4];
           OSSL_PARAM *domain_params = NULL;
           OSSL_PARAM *merged_params = NULL;
           EVP_PKEY_CTX *ctx = NULL, *validate_ctx = NULL;
           EVP_PKEY *complete_domp = NULL;

           EVP_PKEY_todata(received_domp, OSSL_KEYMGMT_SELECT_DOMAIN_PARAMETERS,
                           &amp;domain_params);
           extra_params[0] = OSSL_PARAM_construct_octet_string("seed", seed, seedlen);
           /*
            * NOTE: For unverifiable g use "hindex" instead of "gindex"
            * extra_params[1] = OSSL_PARAM_construct_int("hindex", &amp;hindex);
            */
           extra_params[1] = OSSL_PARAM_construct_int("gindex", &amp;gindex);
           extra_params[2] = OSSL_PARAM_construct_int("pcounter", &amp;pcounter);
           extra_params[3] = OSSL_PARAM_construct_end();
           merged_params = OSSL_PARAM_merge(domain_params, extra_params);

           ctx = EVP_PKEY_CTX_new_from_name(NULL, "DHX", NULL);
           EVP_PKEY_fromdata_init(ctx);
           EVP_PKEY_fromdata(ctx, &amp;complete_domp, OSSL_KEYMGMT_SELECT_ALL,
                             merged_params);

           validate_ctx = EVP_PKEY_CTX_new_from_pkey(NULL, complete_domp, NULL);
           if (EVP_PKEY_param_check(validate_ctx) &gt; 0)
               /* validation_passed(); */
           else
               /* validation_failed(); */

           OSSL_PARAM_free(domain_params);
           <a href="../manmerged_params/OSSL_PARAM_free.merged_params.html">OSSL_PARAM_free</a>(merged_params);
           EVP_PKEY_CTX_free(ctx);
           EVP_PKEY_CTX_free(validate_ctx);
           EVP_PKEY_free(complete_domp);

</pre><h4><b>CONFORMING</b> <b>TO</b></h4><pre>
       RFC 7919 (TLS ffdhe named safe prime groups)
       RFC 3526 (IKE modp named safe prime groups)
       RFC 5114 (Additional DH named groups for dh_1024_160", "dh_2048_224" and "dh_2048_256").

       The following sections of SP800-56Ar3:

       5.5.1.1 FFC Domain Parameter Selection/Generation
       Appendix D: FFC Safe-prime Groups

       The following sections of FIPS186-4:

       A.1.1.2 Generation of Probable Primes p and q Using an Approved Hash Function.
       A.2.3 Generation of canonical generator g.
       A.2.1 Unverifiable Generation of the Generator g.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/EVP_PKEY-FFC.7.html">EVP_PKEY-FFC</a></b>(7),      <b><a href="../man7/EVP_KEYEXCH-DH.7.html">EVP_KEYEXCH-DH</a></b>(7)      <b><a href="../man3/EVP_PKEY.3.html">EVP_PKEY</a></b>(3),      <b><a href="../man7/provider-keymgmt.7.html">provider-keymgmt</a></b>(7),       <b><a href="../man3/EVP_KEYMGMT.3.html">EVP_KEYMGMT</a></b>(3),
       <b><a href="../man7/OSSL_PROVIDER-default.7.html">OSSL_PROVIDER-default</a></b>(7), <b><a href="../man7/OSSL_PROVIDER-FIPS.7.html">OSSL_PROVIDER-FIPS</a></b>(7)

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2020-2024 The OpenSSL Project Authors. All Rights Reserved.

       Licensed  under  the  Apache License 2.0 (the "License").  You may not use this file except in compliance
       with the License.  You can obtain  a  copy  in  the  file  LICENSE  in  the  source  distribution  or  at
       &lt;https://www.openssl.org/source/license.html&gt;.

3.5.0                                              2025-06-04                                  <u><a href="../man7SSL/EVP_PKEY-DH.7SSL.html">EVP_PKEY-DH</a></u>(7SSL)
</pre>
 </div>
</div></section>
</div>
</body>
</html>