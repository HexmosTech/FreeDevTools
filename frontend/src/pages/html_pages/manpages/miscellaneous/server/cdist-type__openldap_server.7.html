<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cdist-type__openldap_server - Setup an openldap(4) server instance</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/cdist">cdist_7.0.0-5_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       cdist-type__openldap_server - Setup an <a href="../man4/openldap.4.html">openldap</a>(4) server instance

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This type can be used to bootstrap an LDAP environment using openldap as slapd.

       It bootstraps the LDAP server with sane defaults and creates and manages the base DN defined by <u>suffix</u>.

</pre><h4><b>REQUIRED</b> <b>PARAMETERS</b></h4><pre>
       <b>manager-dn</b>
              The rootdn to set up in the directory.  E.g. <u>cn=manager,dc=ungleich,dc=ch</u>. See <u><a href="../man5/slapd.conf.5.html">slapd.conf</a>(5)</u>.

       <b>manager-password</b>
              The  password for <u>manager-dn</u> in the directory.  This will be used to connect to the LDAP server on
              the first <u>slapd-url</u> with the given <u>manager-dn</u>.

       <b>manager-password-hash</b>
              The password for  <u>manager-dn</u>  in  the  directory.   This  should  be  valid  for  <u>slapd.conf</u>  like
              <u>{SSHA}qV+mCs3u8Q2sCmUXT4Ybw7MebHTASMyr</u>.   Generate  e.g.  with:  <u>slappasswd</u> <u>-s</u> <u>weneedgoodsecurity</u>.
              See       <u><a href="../man8C/slappasswd.8C.html">slappasswd</a>(8C)</u>,       <u><a href="../man5/slapd.conf.5.html">slapd.conf</a>(5)</u>.        TODO:        implement        this:        ‚Äê
              <u><a href="http://blog.adamsbros.org/2015/06/09/openldap-ssha-salted-hashes-by-hand/">http://blog.adamsbros.org/2015/06/09/openldap-ssha-salted-hashes-by-hand/</a></u>   to   derive  from  the
              manager-password  parameter  and  ensure  idempotency  (care  with   salts).    At   that   point,
              manager-password-hash should be deprecated and ignored.

       <b>serverid</b>
              The server for the directory.  E.g. <u>dc=ungleich,dc=ch</u>. See <u><a href="../man5/slapd.conf.5.html">slapd.conf</a>(5)</u>.

       <b>suffix</b> The suffix for the directory.  E.g. <u>dc=ungleich,dc=ch</u>. See <u><a href="../man5/slapd.conf.5.html">slapd.conf</a>(5)</u>.

</pre><h4><b>REQUIRED</b> <b>MULTIPLE</b> <b>PARAMETERS</b></h4><pre>
       <b>slapd-url</b>
              A  URL  for  slapd  to  listen  on.  Pass once for each URL you want to support, e.g.: <u>--slapd-url</u>
              <u>ldaps://my.fqdn/</u> <u>--slapd-url</u> <u>ldap://my.fqdn/</u>.  The first instance that is passed will be  used  as
              the main URL to connect to this LDAP server See the <u>-h</u> flag in <u><a href="../man8C/slapd.8C.html">slapd</a>(8C)</u>.

</pre><h4><b>OPTIONAL</b> <b>PARAMETERS</b></h4><pre>
       <b>syncrepl-credentials</b>
              Only  has an effect if <u>replicate</u> is set; required in that case.  This secret is shared amongst the
              hosts that will replicate the directory.  Note that each replication server needs this secret  and
              it is saved in plain text in the directory.

       <b>syncrepl-searchbase</b>
              Only  has  an  effect  if  <u>replicate</u>  is  set;  required  in that case.  The searchbase to use for
              replication.  E.g. <u>dc=ungleich,dc=ch</u>. See <u><a href="../man5/slapd.conf.5.html">slapd.conf</a>(5)</u>.

       <b>admin-email</b>
              Passed   to   <u>cdist-type</u><b>__</b><u>letsencrypt_cert</u>;   has   otherwise   no   use.    Required   if   using
              <b>__</b><u>letsencrypt_cert</u>.  Where to send Let's Encrypt emails like "certificate needs renewal".

       <b>tls-cipher-suite</b>
              Setting  for  TLSCipherSuite.   Defaults  to  <u>NORMAL</u> in a Debian-like OS and <u>HIGH:MEDIUM:+SSLv2</u> on
              FreeBSD.  See <u><a href="../man5/slapd.conf.5.html">slapd.conf</a>(5)</u>.

       <b>tls-cert</b>
              If defined, <b>__</b><u>letsencrypt_cert</u> is not used and this must be the path in the remote  hosts  to  the
              PEM-encoded  TLS  certificate.   Requires:  <u>tls-privkey</u>  and  <u>tls-ca</u>.   Permissions, existence and
              renewal of these files are left up to the type's user.

       <b>tls-privkey</b>
              Required if <u>tls-cert</u> is defined.  Path in the remote hosts to the PEM-encoded private key file.

       <b>tls-ca</b> Required if <u>tls-cert</u> is defined.  Path in the remote hosts to the PEM-encoded CA certificate file.

       <b>extra-config</b>
              Custom settings to be added in <u><a href="../man5/slapd.conf.5.html">slapd.conf</a>(5)</u>.

</pre><h4><b>OPTIONAL</b> <b>MULTIPLE</b> <b>PARAMETERS</b></h4><pre>
       <b>syncrepl-host</b>
              Only has an effect if <u>replicate</u> is set; required in that  case.   Set  once  per  host  that  will
              replicate the directory.

       <b>module</b> LDAP  module  to load. See <u><a href="../man5/slapd.conf.5.html">slapd.conf</a>(5)</u>. Some dependencies might have to be installed beforehand.
              Default value is OS-dependent, see manifest.

       <b>schema</b> Name of LDAP schema to load. Must be the name without extension  of  a  <u>.schema</u>  file  in  slapd's
              schema  directory  (usually  <u>/etc/slapd/schema</u> or <u>/usr/local/etc/openldap/schema</u>).  Example value:
              <u>inetorgperson</u> The type user must ensure that the schema file is  deployed.   This  defaults  to  a
              sensible subset, for details see the type definition.

       <b>description</b>
              The  description  of the base DN passed in the <u>suffix</u> parameter.  Defaults to <u>Managed</u> <u>by</u> <u>cdist,</u> <u>do</u>
              <u>not</u> <u>edit</u> <u>manually.</u>

</pre><h4><b>BOOLEAN</b> <b>PARAMETERS</b></h4><pre>
       <b>staging</b>
              Passed to <u>cdist-type</u><b>__</b><u>letsencrypt_cert</u>; has otherwise no use.  Obtain a test  certificate  from  a
              staging server.

       <b>replicate</b>
              Whether  to  setup replication or not.  If present <u>syncrepl-credentials</u> and <u>syncrepl-host</u> are also
              required.

</pre><h4><b>EXAMPLES</b></h4><pre>
          # Example of a simple server with manual certificate management.
          pki_prefix="/usr/local/etc/pki/realms/ldap.camilion.cloud"
          __openldap_server \
              --manager-dn 'cn=manager,dc=camilion,dc=cloud' \
              --manager-password "foo" \
              --manager-password-hash '{SSHA}foo' \
              --serverid 0 \
              --suffix 'dc=camilion,dc=cloud' \
              --slapd-url 'ldaps://ldap.camilion.cloud' \
              --tls-cert "${pki_prefix}/default.crt" \
              --tls-privkey "${pki_prefix}/default.key" \
              --tls-ca "${pki_prefix}/CA.crt"

          # The created basedn looks as follows:
          #
          # dn: dc=camilion,dc=cloud
          # objectClass: top
          # objectClass: dcObject
          # objectClass: organization
          # o: Managed by cdist, do not edit manually.
          # dc: camilion
          #
          # Do not change it manually, the type will overwrite your changes.

          #
          # Changing to a replicated setup is a simple change to something like:
          #
          # Example for multiple servers with replication and automatic
          # Let's Encrypt certificate management through certbot.
          id=1
          for host in ldap-test1.ungleich.ch ldap-test2.ungleich.ch; do
              echo "__ungleich_ldap \
                  --manager-dn 'cn=manager,dc=ungleich,dc=ch' \
                  --manager-psasword 'foo' \
                  --manager-password-hash '{SSHA}fooo' \
                  --serverid '${id}' \
                  --suffix 'dc=ungleich,dc=ch' \
                  --slapd-url ldap://${host} \
                  --searchbase 'dc=ungleich,dc=ch' \
                  --syncrepl-credentials 'fooo' \
                  --syncrepl-host 'ldap-test1.ungleich.ch' \
                  --syncrepl-host 'ldap-test2.ungleich.ch' \
                  --description 'Ungleich LDAP server'" \
                  --staging \
                  | cdist config -i - -v ${host}
              id=$((id + 1))
          done

          # The created basedn looks as follows:
          #
          # dn: dc=ungleich,dc=ch
          # objectClass: top
          # objectClass: dcObject
          # objectClass: organization
          # o: Ungleich LDAP server
          # dc: ungleich
          #
          # Do not change it manually, the type will overwrite your changes.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/cdist-type__letsencrypt_cert.7.html">cdist-type__letsencrypt_cert</a></b>(7)

</pre><h4><b>AUTHORS</b></h4><pre>
       ungleich &lt;<u>foss--@--ungleich.ch</u>&gt; Evilham &lt;<u>contact--@--evilham.com</u>&gt;

</pre><h4><b>COPYING</b></h4><pre>
       Copyright (C) 2020 ungleich glarus ag. You can redistribute it and/or modify it under the  terms  of  the
       GNU General Public License as published by the Free Software Foundation, either version 3 of the License,
       or (at your option) any later version.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       ungleich GmbH 2021

7.0.0                                             Sep 11, 2024                    <u>CDIST-TYPE</u><b>__</b><u><a href="../man7/OPENLDAP_SERVER.7.html">OPENLDAP_SERVER</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>