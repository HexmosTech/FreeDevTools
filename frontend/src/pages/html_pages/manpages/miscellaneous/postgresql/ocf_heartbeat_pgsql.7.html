<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ocf_heartbeat_pgsql - Manages a PostgreSQL database instance</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/resource-agents-base">resource-agents-base_4.16.0-3ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ocf_heartbeat_pgsql - Manages a PostgreSQL database instance

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>pgsql</b> [start | stop | status | monitor | promote | demote | meta-data | validate-all]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Resource script for PostgreSQL. It manages a PostgreSQL as an HA resource.

</pre><h4><b>SUPPORTED</b> <b>PARAMETERS</b></h4><pre>
       <b>pgctl</b>
           Path to pg_ctl command.

           (optional, string, default "/usr/bin/pg_ctl")

       <b>start_opt</b>
           Start options (-o start_opt in pg_ctl). "-i -p 5432" for example.

           (optional, string, no default)

       <b>ctl_opt</b>
           Additional pg_ctl options (-w, -W etc..).

           (optional, string, no default)

       <b>psql</b>
           Path to psql command.

           (optional, string, default "/usr/bin/psql")

       <b>pgdata</b>
           Path to PostgreSQL data directory.

           (optional, string, default "/var/lib/pgsql/data")

       <b>pgdba</b>
           User that owns PostgreSQL.

           (optional, string, default "postgres")

       <b>pghost</b>
           Hostname/IP address where PostgreSQL is listening

           (optional, string, no default)

       <b>pgport</b>
           Port where PostgreSQL is listening

           (optional, integer, default 5432)

       <b>pglibs</b>
           Custom location of the Postgres libraries. If not set, the standard location will be used.

           (optional, string, default "<a href="file:/usr/lib">/usr/lib</a>")

       <b>monitor_user</b>
           PostgreSQL user that pgsql RA will user for monitor operations. If it's not set pgdba user will be
           used.

           (optional, string, no default)

       <b>monitor_password</b>
           Password for monitor user.

           (optional, string, no default)

       <b>monitor_sql</b>
           SQL script that will be used for monitor operations.

           (optional, string, default "select now();")

       <b>config</b>
           Path to the PostgreSQL configuration file for the instance.

           (optional, string, default "/var/lib/pgsql/data/postgresql.conf")

       <b>pgdb</b>
           Database that will be used for monitoring.

           (optional, string, default "template1")

       <b>logfile</b>
           Path to PostgreSQL server log output file.

           (optional, string, default "/dev/null")

       <b>socketdir</b>
           Unix socket directory for PostgreSQL.

           If you use PostgreSQL 9.3 or higher and define unix_socket_directories in the postgresql.conf, then
           you must set socketdir to determine which directory is used for psql command.

           (optional, string, no default)

       <b>stop_escalate</b>
           Number of seconds to wait for stop (using -m fast) before resorting to -m immediate

           (optional, integer, default 90)

       <b>rep_mode</b>
           Replication mode may be set to "async" or "sync" or "slave". They require PostgreSQL 9.1 or later.
           Once set, "async" and "sync" require node_list, master_ip, and restore_command parameters,as well as
           configuring PostgreSQL for replication (in postgresql.conf and pg_hba.conf).

           "slave" means that RA only makes recovery.conf before starting to connect to primary which is running
           somewhere. It doesn't need master/slave setting. It requires master_ip restore_command parameters.

           (optional, string, default "none")

       <b>node_list</b>
           All node names. Please separate each node name with a space. This is optional for replication.
           Defaults to all nodes in the cluster

           (optional, string, no default)

       <b>restore_command</b>
           restore_command for recovery.conf. This is required for replication.

           (optional, string, no default)

       <b>archive_cleanup_command</b>
           archive_cleanup_command for recovery.conf. This is used for replication and is optional.

           (optional, string, no default)

       <b>recovery_end_command</b>
           recovery_end_command for recovery.conf. This is used for replication and is optional.

           (optional, string, no default)

       <b>master_ip</b>
           Master's floating IP address to be connected from hot standby. This parameter is used for
           "primary_conninfo" in recovery.conf. This is required for replication.

           (optional, string, no default)

       <b>repuser</b>
           User used to connect to the master server. This parameter is used for "primary_conninfo" in
           recovery.conf. This is required for replication.

           (optional, string, default "postgres")

       <b>primary_conninfo_opt</b>
           primary_conninfo options of recovery.conf except host, port, user and application_name. This is
           optional for replication.

           (optional, string, no default)

       <b>restart_on_promote</b>
           If this is true, RA deletes recovery.conf and restarts PostgreSQL on promote to keep Timeline ID. It
           probably makes fail-over slower. It's recommended to set on-fail of promote up as fence. This is
           optional for replication.

           (optional, boolean, default false)

       <b>replication_slot_name</b>
           Set this option when using replication slots. Can only use lower case letters, numbers and underscore
           for replication_slot_name.

           The replication slots would be created for each node, with the name adding the node name as postfix.
           For example, replication_slot_name is "sample" and 2 slaves which are "node1" and "node2" connect to
           their slots, the slots names are "sample_node1" and "sample_node2". If the node name contains a upper
           case letter, hyphen and dot, those characters will be converted to a lower case letter or an
           underscore. For example, Node-1.example.com to node_1_example_com.

           pgsql RA doesn't monitor and delete the replication slot. When the slave node has been disconnected
           in failure or the like, execute one of the following manually. Otherwise it may eventually cause a
           disk full because the master node will continue to accumulate the unsent WAL. 1. recover and
           reconnect the slave node to the master node as soon as possible. 2. delete the slot on the master
           node by following psql command. $ select pg_drop_replication_slot('replication_slot_name');

           (optional, string, no default)

       <b>tmpdir</b>
           Path to temporary directory. This is optional for replication.

           (optional, string, default "/var/lib/pgsql/tmp")

       <b>xlog_check_count</b>
           Number of checks of xlog on monitor before promote. This is optional for replication.

           Note: For backward compatibility, the terms are unified with PostgreSQL 9. If you are using
           PostgreSQL 10 or later, replace "xlog" with "wal". Likewise, replacing "location" with "lsn".

           (optional, integer, default 3)

       <b>crm_attr_timeout</b>
           The timeout of crm_attribute forever update command. Default value is 5 seconds. This is optional for
           replication.

           (optional, integer, default 5)

       <b>stop_escalate_in_slave</b>
           Number of seconds to wait for stop (using -m fast) before resorting to -m immediate in slave state.
           This is optional for replication.

           (optional, integer, default 90)

       <b>check_wal_receiver</b>
           If this is true, RA checks wal_receiver process on monitor and notifies its status using "(resource
           name)-receiver-status" attribute. It's useful for checking whether PostgreSQL (hot standby) connects
           to primary. The attribute shows status as "normal" or "normal (master)" or "ERROR". Note that if you
           configure PostgreSQL as master/slave resource, then wal receiver is not running in the master and the
           attribute shows status as "normal (master)" consistently because it is normal status.

           (optional, boolean, default false)

</pre><h4><b>SUPPORTED</b> <b>ACTIONS</b></h4><pre>
       This resource agent supports the following actions (operations):

       <b>start</b>
           Starts the resource. Suggested minimum timeout: 120s.

       <b>stop</b>
           Stops the resource. Suggested minimum timeout: 120s.

       <b>status</b>
           Performs a status check. Suggested minimum timeout: 60s.

       <b>monitor</b>
           Performs a detailed status check. Suggested minimum timeout: 30s. Suggested interval: 30s.

       <b>monitor</b> <b>(Promoted</b> <b>role)</b>
           Performs a detailed status check. Suggested minimum timeout: 30s. Suggested interval: 29s.

       <b>promote</b>
           Promotes the resource to the Master role. Suggested minimum timeout: 120s.

       <b>demote</b>
           Demotes the resource to the Slave role. Suggested minimum timeout: 120s.

       <b>notify</b>
           Suggested minimum timeout: 90s.

       <b>meta-data</b>
           Retrieves resource agent metadata (internal use only). Suggested minimum timeout: 5s.

       <b>validate-all</b>
           Performs a validation of the resource configuration. Suggested minimum timeout: 5s.

       <b>methods</b>
           Suggested minimum timeout: 5s.

</pre><h4><b>EXAMPLE</b> <b>CRM</b> <b>SHELL</b></h4><pre>
       The following is an example configuration for a pgsql resource using the <b><a href="../man8/crm.8.html">crm</a></b>(8) shell:

           primitive p_pgsql ocf:heartbeat:pgsql \
             op monitor depth="0" timeout="30s" interval="30s" \
             op monitor depth="0" timeout="30s" interval="29s" role="Promoted"

           ms ms_pgsql p_pgsql \
             meta notify="true" interleave="true"

</pre><h4><b>EXAMPLE</b> <b>PCS</b></h4><pre>
       The following is an example configuration for a pgsql resource using <b><a href="../man8/pcs.8.html">pcs</a></b>(8)

           pcs resource create p_pgsql ocf:heartbeat:pgsql \
             op monitor OCF_CHECK_LEVEL="0" timeout="30s" interval="30s" \
             op monitor OCF_CHECK_LEVEL="0" timeout="30s" interval="29s" role="Promoted" promotable

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="http://clusterlabs.org/">http://clusterlabs.org/</a></b>

</pre><h4><b>AUTHOR</b></h4><pre>
       <b>ClusterLabs</b> <b>contributors</b> <b>(see</b> <b>the</b> <b>resource</b> <b>agent</b> <b>source</b> <b>for</b> <b>information</b> <b>about</b> <b>individual</b> <b>authors)</b>

resource-agents 4.16.0-3ubuntu                     06/25/2025                             <u><a href="../man7/OCF_HEARTBEAT_PGSQL.7.html">OCF_HEARTBEAT_PGSQL</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>