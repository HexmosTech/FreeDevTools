<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sbuild-setup - sbuild setup procedure</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/sbuild">sbuild_0.88.3ubuntu3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sbuild-setup - sbuild setup procedure

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>sbuild</b>  uses  chroots  to  build  packages within, to provide a minimal and consistent build environment.
       This man page describes the procedure to create a chroot by  hand  using  debootstrap.   These  are  only
       guidelines; depending upon the setup required, several of the steps may be omitted entirely.

</pre><h4><b>QUICK</b> <b>START</b></h4><pre>
       Simply  running  <b>sbuild-createchroot</b> will perform all the setup steps described in detail below.  See the
       section “<u>sbuild-createchroot</u>” below, as well as <b><a href="../man8/sbuild-createchroot.8.html">sbuild-createchroot</a></b>(8).

</pre><h4><b>CHROOT</b> <b>SETUP</b></h4><pre>
       This guide sets up a lenny chroot  on  a  powerpc  machine.   Adjust  the  names  for  other  suites  and
       architectures.

   <b>1.</b> <b>Run</b> <b>debootstrap</b> <b>to</b> <b>create</b> <b>the</b> <b>chroot</b>
       # <b>mkdir</b> <b>-p</b> <b>/srv/chroot/lenny</b>

       The  author  has  each  chroot  as  a  separate  LVM logical volume (LV).  Create and mount an LV here if
       required:

       # <b>lvcreate</b> <b>-L</b> <b>4G</b> <b>-n</b> <b>lenny_chroot</b> <b>-Z</b> <b>y</b> <b>volume-group</b>

       Add to <a href="file:/etc/fstab">/etc/fstab</a> and mount (see next section for full  fstab  example).   Finally,  run  debootstrap  to
       create the chroot:

       # <b>debootstrap</b> <b>--variant=buildd</b> <b>lenny</b> <b>/srv/chroot/lenny</b> <b><a href="http://deb.debian.org/debian/">http://deb.debian.org/debian/</a></b>

   <b>2.</b> <b>Set</b> <b>up</b> <b>additional</b> <b>mounts</b>
       An example <u><a href="file:/etc/fstab">/etc/fstab</a></u>:

       /dev/volume-group/lenny_chroot \
                      /srv/chroot/lenny               ext3    defaults   0   2
       <a href="file:/dev/pts">/dev/pts</a>       /srv/chroot/lenny/dev/pts       none    rw,bind    0   0
       tmpfs          /srv/chroot/lenny/dev/shm       tmpfs   defaults   0   0
       proc           /srv/chroot/lenny/proc          proc    defaults   0   0
       /dev/volume-group/home \
                      /srv/chroot/lenny/home          ext3    quota      0   0
       <a href="file:/tmp">/tmp</a>           /srv/chroot/lenny/tmp           none    rw,bind    0   0
       <a href="file:/etc/passwd">/etc/passwd</a>    /srv/chroot/lenny/etc/passwd    none    ro,bind    0   0
       <a href="file:/etc/shadow">/etc/shadow</a>    /srv/chroot/lenny/etc/shadow    none    ro,bind    0   0
       <a href="file:/etc/group">/etc/group</a>     /srv/chroot/lenny/etc/group     none    ro,bind    0   0
       <a href="file:/etc/gshadow">/etc/gshadow</a>   /srv/chroot/lenny/etc/gshadow   none    ro,bind    0   0
       <a href="file:/etc/resolv.conf">/etc/resolv.conf</a> \
                      /srv/chroot/lenny/etc/resolv.conf \
                                                      none    ro,bind    0   0

       If the bind mountpoints don't exist in the chroot, touch them:

       # <b>touch</b> <b>/srv/chroot/lenny/etc/resolv.conf</b>

       Next, mount them all.

       Depending  on  your  kernel  version  and  security considerations, you may wish to do this part slightly
       differently.  With a Linux kernel, at  least  version  2.6  is  required  for  bind  mounts,  and  devpts
       (CONFIG_UNIX98_PTYS)  for <u><a href="file:/dev/pts">/dev/pts</a></u>.  Other guides recommend copying the files, but this method keeps them
       up-to-date at no cost.

       If using sbuild with schroot, <u>passwd</u>, <u>shadow</u>, <u>group</u>, <u>gshadow</u> and <u>resolv.conf</u> can be updated automatically
       at the start of each build, so no action is required here.  schroot can also automatically mount  all  of
       the extra filesystems, so all the other mounts may be omitted.

       To  disable networking, don't bind mount <u><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></u>.  This will prevent APT from working inside the
       chroot, but prevents package building from having working network access (no nameservers).

   <b>3.</b> <b>Edit</b> <u><b>sources.list</b></u>
       Create or edit <u>/srv/chroot/lenny/etc/apt/sources.list</u>, and add all the APT  sources  required  to  obtain
       binary and source packages for your chosen distribution:

       deb <a href="http://security.debian.org/">http://security.debian.org/</a> lenny/updates main
       deb-src <a href="http://security.debian.org/">http://security.debian.org/</a> lenny/updates main

       deb <a href="http://deb.debian.org/debian/">http://deb.debian.org/debian/</a> lenny main
       deb-src <a href="http://deb.debian.org/debian/">http://deb.debian.org/debian/</a> lenny main

   <b>4.</b> <b>Configure</b> <b>dchroot</b> <b>or</b> <b>schroot</b>
       This is entirely optional, but will make the chroot environment easier to access and administer.

       For dchroot, add the following line to <u>/etc/dchroot.conf</u>:

       lenny /srv/chroot/lenny

       For  schroot,  add  a group to <u>/etc/schroot/schroot.conf</u> (or a new file <u>/etc/schroot/chroot.d/lenny</u>), for
       example:

       [lenny]
       type=directory
       description=Debian lenny (stable)
       location=/srv/chroot/lenny
       priority=2
       groups=root,sbuild
       root-groups=sbuild
       aliases=stable
       run-setup-scripts=true
       run-session-scripts=true

       For sudo, add a symbolic link to the directory <u>/etc/sbuild/chroot</u>, for example:

       # <b>mkdir</b> <b>-p</b> <b>/etc/sbuild/chroot</b>
       # <b>ln</b> <b>-s</b> <b>/srv/chroot/lenny</b> <b>/etc/sbuild/chroot/lenny</b>

   <b>5.</b> <b>Log</b> <b>into</b> <b>chroot</b>
       # <b>dchroot</b> <b>-c</b> <b>lenny</b>

       or

       $ <b>schroot</b> <b>-c</b> <b>lenny</b> <b>-u</b> <b>root</b>

   <b>6.</b> <b>Set</b> <b>up</b> <b>packages</b> <b>for</b> <b>sbuild</b>
       While running as root inside the chroot:

       # <b>apt-get</b> <b>update</b>
       # <b>apt-get</b> <b>dist-upgrade</b>
       # <b>apt-get</b> <b>install</b> <b>debconf</b>
       # <b>dpkg-reconfigure</b> <b>-plow</b> <b>debconf</b>

       Answer the debconf questions as follows:

       <b>interface</b>
              choose <u>6/Noninteractive</u>

       <b>priority</b>
              choose <u>1/Critical</u>

       You only need to run dpkg-reconfigure if you weren't asked the  questions  during  the  debconf  install.
       Next, install the packages required for building packages:

       # <b>apt-get</b> <b>install</b> <b>fakeroot</b> <b>build-essential</b>
       # <b>apt-get</b> <b>install</b> <b>makedev</b>
       # <b>cd</b> <b><a href="file:/dev/">/dev/</a></b>
       # <b>/sbin/MAKEDEV</b> <b>generic</b>
       # <b>touch</b> <b><a href="file:/etc/mtab">/etc/mtab</a></b>

       For some security, we don't bind mount <a href="file:/dev">/dev</a>, so it can't access e.g. USB devices

   <b>7.</b> <b>sbuild</b> <b>setup</b>
       While running as root inside the chroot:

       # <b>mkdir</b> <b>/build</b>
       # <b>chown</b> <b>root:sbuild</b> <b>/build</b>
       # <b>chmod</b> <b>02775</b> <b>/build</b>
       # <b>mkdir</b> <b>-p</b> <b>/var/lib/sbuild/srcdep-lock</b>
       # <b>chown</b> <b>-R</b> <b>root:sbuild</b> <b>/var/lib/sbuild</b>
       # <b>chmod</b> <b>-R</b> <b>02775</b> <b>/var/lib/sbuild</b>

       Note  that  when  using  sbuild  with  schroot,  this setup is done at the start of each build, so is not
       required here.

   <b>8.</b> <b>Finished</b>
       Congratulations!  You should now have a fully configured and operational chroot.

</pre><h4><b>SBUILD-CREATECHROOT</b></h4><pre>
       This script will automatically perform a number of the steps described above, including:

       •      Running debootstrap.

       •      Setting up APT sources in <u><a href="file:/etc/apt/sources.list">/etc/apt/sources.list</a></u>.

       •      Setting up a minimal <u><a href="file:/etc/passwd">/etc/passwd</a></u>

       •      Setting up /build and /var/lib/sbuild with appropriate ownership and permissions.

       After it has done this, you do still need to do some manual setup, completing the  steps  it  missed  out
       above, for example.

</pre><h4><b>USER</b> <b>SETUP</b></h4><pre>
   <b>1.</b> <b>Group</b> <b>membership</b>
       As root, run:

       # <b>sbuild-adduser</b> <u><b>user</b></u>

       Alternatively, add the user to the <u>sbuild</u> group by hand:

       # <b>adduser</b> <u><b>user</b></u> <b>sbuild</b>

   <b>2.</b> <u><b><a href="file:~/.sbuildrc">~/.sbuildrc</a></b></u>
       Configure the user's <u><a href="file:~/.sbuildrc">~/.sbuildrc</a></u>:

       $ <b>cp</b> <b>/usr/share/doc/sbuild/examples/example.sbuildrc</b> <b>~</b><u><b>user</b></u><b>/.sbuildrc</b>

       Edit  to  set  the  correct  mail  address  to  send log files to, and the correct maintainer name and/or
       uploader name.

   <b>3.</b> <b>Build</b> <b>directories</b>
       Create directories to  contain  packages  and  log  files.   (.sbuildrc  may  have  configured  different
       locations; the default build directory is the current directory, and the default $log_dir is <a href="file:~/logs">~/logs</a>):

       $ <b>mkdir</b> <b><a href="file:~/logs">~/logs</a></b>

   <b>4.</b> <b>sudo</b> <b>setup</b>
       This  step  not  required if schroot is used (which is the default, set in <u>sbuild.conf</u>).  If using sbuild
       with sudo (chroot_mode “split”), sudo needs configuring to give the user permission to install and remove
       packages in the chroot, which requires root privileges.  Add the following lines to <u><a href="file:/etc/sudoers">/etc/sudoers</a></u>:

       <u>username</u>  ALL=NOPASSWD: ALL
       Defaults:<u>username</u> env_keep+="APT_CONFIG DEBIAN_FRONTEND SHELL"

       where <u>username</u> is the name of the user who will run sbuild.

   <b>5.</b> <b>Finished</b>
       The user should now be able to run sbuild.

       $ <b>sbuild</b> <b>...</b>

</pre><h4><b>AUTHORS</b></h4><pre>
       Roger Leigh.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright © 2005-2008  Roger Leigh &lt;<a href="mailto:rleigh@debian.org">rleigh@debian.org</a>&gt;

       This program is free software; you can redistribute it and/or modify  it  under  the  terms  of  the  GNU
       General  Public License as published by the Free Software Foundation; either version 2 of the License, or
       (at your option) any later version.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/debootstrap.1.html">debootstrap</a></b>(1), <b><a href="../man1/sbuild.1.html">sbuild</a></b>(1), <b><a href="../man8/sbuild-adduser.8.html">sbuild-adduser</a></b>(8), <b><a href="../man8/sbuild-createchroot.8.html">sbuild-createchroot</a></b>(8).

Version 0.88.3ubuntu3                              02 May 2025                                   <u><a href="../man7/SBUILD-SETUP.7.html">SBUILD-SETUP</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>