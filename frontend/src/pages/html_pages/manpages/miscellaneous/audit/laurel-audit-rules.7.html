<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>laurel-audit-rules - Advice for writing Audit rulesets for use with laurel(8)</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/laurel">laurel_0.7.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       laurel-audit-rules - Advice for writing Audit rulesets for use with <a href="../man8/laurel.8.html">laurel</a>(8)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       This  page  contains  suggestions  for  Linux  Audit  rulesets that are useful to aid in detecting common
       attacker’s tactics.

</pre><h4><b>Note</b> <b>about</b> <b><a href="../man8/auditctl.8.html">auditctl</a>(8)</b> <b>error</b> <b>messages</b></h4><pre>
       It is not possible for /<a href="../man8/auditctl.8.html">auditctl</a>(8)/ ro load file watches for files or directories that are not  present.
       Depending  on the rule set, it will spam possibly lots of error messages to standard error.  The specific
       file watches are not installed, but those error messages can be ignored otherwise.

</pre><h4><b>File</b> <b>watches</b></h4><pre>
   <b>Authentication/authorization</b>
              -w <a href="file:/etc/group">/etc/group</a>           -p wa -k wr_group
              -w <a href="file:/etc/passwd">/etc/passwd</a>          -p wa -k wr_passwd
              -w <a href="file:/etc/shadow">/etc/shadow</a>          -p wa -k wr_passwd
              -w <a href="file:/etc/pam.conf">/etc/pam.conf</a>        -p wa -k wr_pam
              -w <a href="file:/etc/pam.d/">/etc/pam.d/</a>          -p wa -k wr_pam
              -w <a href="file:/etc/ssh/sshd_config">/etc/ssh/sshd_config</a> -p wa -k wr_sshd
              -w <a href="file:/etc/sudoers">/etc/sudoers</a>         -p wa -k wr_sudo
              -w <a href="file:/etc/sudoers.d">/etc/sudoers.d</a>       -p wa -k wr_sudo

   <b>cron,</b> <b>at</b>
              -w <a href="file:/etc/crontab">/etc/crontab</a>              -p wa -k wr_cron
              -w <a href="file:/etc/cron.d/">/etc/cron.d/</a>              -p wa -k wr_cron
              -w <a href="file:/etc/cron.daily/">/etc/cron.daily/</a>          -p wa -k wr_cron
              -w <a href="file:/etc/cron.hourly/">/etc/cron.hourly/</a>         -p wa -k wr_cron
              -w <a href="file:/etc/cron.monthly/">/etc/cron.monthly/</a>        -p wa -k wr_cron
              -w <a href="file:/etc/cron.weekly/">/etc/cron.weekly/</a>         -p wa -k wr_cron
              -w <a href="file:/etc/cron.yearly/">/etc/cron.yearly/</a>         -p wa -k wr_cron
              -w /etc/cron.allow           -p wa -k wr_cron
              -w /etc/cron.deny            -p wa -k wr_cron
              -w <a href="file:/var/spool/cron/crontabs/">/var/spool/cron/crontabs/</a> -p wa -k wr_cron
              -w /etc/at.allow             -p wa -k wr_cron
              -w /etc/at.deny              -p wa -k wr_cron
              -w /var/spool/cron/atjobs/   -p wa -k wr_cron

   <b>systemd</b>
       Systemd also has cron-like timer mechanism.  udev triggers have also been abused for  persistence.   Note
       that watching the files in <a href="file:/etc">/etc</a> is not sufficient.

              -w <a href="file:/etc/systemd">/etc/systemd</a>     -p wa -k wr_systemd
              -w <a href="file:/lib/systemd">/lib/systemd</a>     -p wa -k wr_systemd
              -w <a href="file:/usr/lib/systemd">/usr/lib/systemd</a> -p wa -k wr_systemd
              -w <a href="file:/etc/udev">/etc/udev</a>        -p wa -k wr_systemd
              -w <a href="file:/lib/udev">/lib/udev</a>        -p wa -k wr_systemd
              -w <a href="file:/usr/lib/udev">/usr/lib/udev</a>    -p wa -k wr_systemd

   <b>Dynamic</b> <b>linkers</b>
              -w /lib/ld-linux.so.2          -p wa -k wr_ldso
              -w <a href="file:/lib64/ld-linux-x86-64.so.2">/lib64/ld-linux-x86-64.so.2</a> -p wa -k wr_ldso
              -w /lib/ld-musl-x86_64.so.1    -p wa -k wr_ldso
              -w /lib/ld-musl-i386.so.1      -p wa -k wr_ldso
              -w <a href="file:/etc/ld.so.conf">/etc/ld.so.conf</a>             -p wa -k wr_ldso
              -w <a href="file:/etc/ld.so.conf.d">/etc/ld.so.conf.d</a>           -p wa -k wr_ldso
              -w /etc/ld.so.preload          -p wa -k wr_ldso

   <b>Mandatory</b> <b>access</b> <b>control</b> <b>(SELinux,</b> <b>AppArmor)</b> <b>manipulation</b>
              -w <a href="file:/etc/selinux">/etc/selinux</a>         -p wa -k wr_selinux
              -w /usr/share/selinux   -p wa -k wr_selinux
              -w /usr/libexec/selinux -p wa -k wr_selinux

              -w <a href="file:/etc/apparmor.d">/etc/apparmor.d</a>              -p wa -k wr_apparmor
              -w <a href="file:/usr/lib/apparmor">/usr/lib/apparmor</a>            -p wa -k wr_apparmor
              -w /usr/share/apparmor          -p wa -k wr_apparmor
              -w /usr/share/apparmor-features -p wa -k wr_apparmor

   <b>Kernel</b> <b>modules</b>
              -w /etc/modprobe.conf -p wa -k wr_modules
              -w <a href="file:/etc/modprobe.d/">/etc/modprobe.d/</a>   -p wa -k wr_modules
              -w <a href="file:/lib/modules/">/lib/modules/</a>      -p wa -k wr_modules

   <b>Auditd</b> <b>+</b> <b>Laurel</b>
              -w /etc/audit/        -p wa -k wr_audit_config
              -w <a href="file:/etc/libaudit.conf">/etc/libaudit.conf</a> -p wa -k wr_audit_config
              -w /etc/audisp/       -p wa -k wr_audit_config
              -w /etc/laurel/       -p wa -k wr_laurel_confg

</pre><h4><b>Log</b> <b>specific</b> <b>program</b> <b>executions</b></h4><pre>
   <b>Possible</b> <b>tampering</b> <b>with</b> <b>auditd,</b> <b>laurel</b>
              -w /sbin/auditctl   -p x -k wr_audit_tools
              -w /sbin/auditd     -p x -k wr_audit_tools
              -w /usr/sbin/laurel -p x -k wr_audit_tools

</pre><h4><b>Log</b> <b>specific</b> <b>“harmless”</b> <b>programs</b> <b>executions</b></h4><pre>
       Adding  context  to  system  service  activities  is useful because together with Laurel’s process labels
       (label-process.label-keys, label-process.propagate-labels), it enables more accurate detection rules that
       can help recognize benign system management activity.

              -w <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?sshd">/usr/sbin/sshd</a> -p x -k sshd

              -w /usr/bin/yum                -p x -k pkg_mgmt
              -w /usr/bin/rpm                -p x -k pkg_mgmt
              -w /usr/bin/dnf                -p x -k pkg_mgmt
              -w <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?dpkg">/usr/bin/dpkg</a>               -p x -k pkg_mgmt
              -w <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?apt">/usr/bin/apt</a>                -p x -k pkg_mgmt
              -w <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?apt-get">/usr/bin/apt-get</a>            -p x -k pkg_mgmt
              -w <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?apt-key">/usr/bin/apt-key</a>            -p x -k pkg_mgmt
              -w <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?apt-add-repository">/usr/bin/apt-add-repository</a> -p x -k pkg_mgmt
              -w /usr/bin/aptitude           -p x -k pkg_mgmt
              -w /usr/bin/aptitude-curses    -p x -k pkg_mgmt
              -w /usr/bin/wajig              -p x -k pkg_mgmt
              -w <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?snap">/usr/bin/snap</a>               -p x -k pkg_mgmt
              -w /usr/sbin/yast2             -p x -k pkg_mgmt
              -w /usr/bin/zypper             -p x -k pkg_mgmt

              -w /usr/bin/containerd        -p x -k container
              -w /usr/bin/podman            -p x -k container
              -w /usr/bin/runc              -p x -k container
              -w /usr/bin/dockerd           -p x -k container
              -w /usr/bin/docker            -p x -k container
              -w /usr/bin/docker-containerd -p x -k container
              -w /usr/bin/docker-runc       -p x -k container

              -w <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?cron">/usr/sbin/cron</a> -p x -k sched_task
              -w /usr/sbin/atd  -p x -k sched_task

              -w /usr/sbin/httpd              -p x -k apache-httpd
              -w /usr/local/apache2/bin/httpd -p x -k apache-httpd

              -w <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?nginx">/usr/sbin/nginx</a>                         -p x -k nginx
              -w /usr/local/nginx/sbin/nginx             -p x -k nginx
              -w /usr/local/openresty/nginx/sbin/nginx   -p x -k nginx

</pre><h4><b>Syscalls</b></h4><pre>
   <b>Log</b> <b>all</b> <b>fork</b> <b>and</b> <b>exec</b> <b>calls</b> <b>for</b> <b>reliable</b> <b>process</b> <b>tracking</b>
       For reliable process tracking that is required for assigning and propagating process labels, it is useful
       to have the Linux Audit subsystem produce events for all fork/exec style syscalls.

              ## Ignore clone( flags=CLONE_VM|... ), log other process-creating calls
              -a never,exit  -F arch=b32 -S clone -F a2&amp;0x100
              -a never,exit  -F arch=b64 -S clone -F a2&amp;0x100
              -a always,exit -F arch=b32 -S fork,vfork,clone,clone3 -k fork
              -a always,exit -F arch=b64 -S fork,vfork,clone,clone3 -k fork
              -a always,exit -F arch=b32 -S execve,execveat
              -a always,exit -F arch=b64 -S execve,execveat

       It is only important that Laurel gets to observe these events.  To reduce log volume, Laurel’s  filtering
       settings should be used, e.g.:

              [filter]
              filter-keys = ["fork"]
              filter-action = drop
              keep-first-per-process = true

   <b>Log</b> <b>usage</b> <b>of</b> <b>ptrace</b>
       We are interested in ptrce usage, but not in every transaction (PEEK, POKE, CONT)

              -a never,exit -F arch=b32 -S ptrace -F a0&gt;=1 -F a0&lt;=7
              -a never,exit -F arch=b64 -S ptrace -F a0&gt;=1 -F a0&lt;=7
              -a always,exit -F arch=b32 -S ptrace
              -a always,exit -F arch=b64 -S ptrace

   <b>Log</b> <b>BPF</b> <b>usage</b>
       Usage  of  BPF  should  be  restricted  to  few processes; log everything except data transfer operations
       because they would put too much load on the system.

              -a never,exit -F arch=b32 -S bpf -F a0&gt;=1 -F a0&lt;=4
              -a never,exit -F arch=b64 -S bpf -F a0&gt;=1 -F a0&lt;=4
              -a never,exit -F arch=b32 -S bpf -F a0&gt;=0xb -F a0&lt;=0xf
              -a never,exit -F arch=b64 -S bpf -F a0&gt;=0xb -F a0&lt;=0xf
              -a never,exit -F arch=b32 -S bpf -F a0=0x13
              -a never,exit -F arch=b64 -S bpf -F a0=0x13
              -a always,exit -F arch=b32 -S bpf -F success=1
              -a always,exit -F arch=b64 -S bpf -F success=1

   <b>Log</b> <b>kernel</b> <b>module</b> <b>loading,</b> <b>unloading</b>
              -a always,exit -F arch=b32 -S init_module,finit_module,delete_module -k module
              -a always,exit -F arch=b64 -S init_module,finit_module,delete_module -k module

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man7/audit.rules.7.html">audit.rules</a>(7), <a href="../man8/laurel.8.html">laurel</a>(8)

</pre><h4><b>AUTHOR</b></h4><pre>
       • Hilko Bengen &lt;<a href="mailto:bengen@hilluzination.de">bengen@hilluzination.de</a>&gt;

laurel 0.7.1                                                             <u>laurel</u> <u>-</u> <u>Advice</u> <u>for</u> <u>wr...h</u> <a href="../man8/laurel.8.html">laurel</a>(8)(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>