<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ocf_heartbeat_VirtualDomain - Manages virtual domains through the libvirt virtualization framework</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/resource-agents-extra">resource-agents-extra_4.16.0-3ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ocf_heartbeat_VirtualDomain - Manages virtual domains through the libvirt virtualization framework

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>VirtualDomain</b> [start | stop | status | monitor | migrate_to | migrate_from | meta-data | validate-all]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Resource agent for a virtual domain (a.k.a. domU, virtual machine, virtual environment etc., depending on
       context) managed by libvirtd.

       This resource agent may be configured for <u>native</u> <u>migration</u> if available in the cluster manager. For
       Pacemaker, the <u>allow-migrate="true"</u> meta attribute enables native migration.

</pre><h4><b>SUPPORTED</b> <b>PARAMETERS</b></h4><pre>
       <b>config</b>
           Absolute path to the libvirt configuration file, for this virtual domain.

           (unique, required, string, no default)

       <b>hypervisor</b>
           Hypervisor URI to connect to. See the libvirt documentation for details on supported URI formats. The
           default is system dependent. Determine the system's default uri by running 'virsh --quiet uri'.

           (optional, string, no default)

       <b>force_stop</b>
           Always forcefully shut down ("destroy") the domain on stop. The default behavior is to resort to a
           forceful shutdown only after a graceful shutdown attempt has failed. You should only set this to true
           if your virtual domain (or your virtualization backend) does not support graceful shutdown.

           (optional, boolean, default 0)

       <b>migration_transport</b>
           Transport used to connect to the remote hypervisor while migrating. Please refer to the libvirt
           documentation for details on transports available. If this parameter is omitted, the resource will
           use libvirt's default transport to connect to the remote hypervisor.

           (optional, string, no default)

       <b>migration_user</b>
           The username will be used in the remote libvirt remoteuri/migrateuri. No user will be given (which
           means root) in the username if omitted

           If remoteuri is set, migration_user will be ignored.

           (optional, string, no default)

       <b>migration_downtime</b>
           Define max downtime during live migration in milliseconds

           (optional, integer, default 0)

       <b>migration_speed</b>
           Define live migration speed per resource in MiB/s

           (optional, integer, default 0)

       <b>migration_network_suffix</b>
           Use a dedicated migration network. The migration URI is composed by adding this parameters value to
           the end of the node name. If the node name happens to be an FQDN (as opposed to an unqualified host
           name), insert the suffix immediately prior to the first period (.) in the FQDN. At the moment
           Qemu/KVM and Xen migration via a dedicated network is supported.

           Note: Be sure this composed host name is locally resolvable and the associated IP is reachable
           through the favored network. This suffix will be added to the remoteuri and migrateuri parameters.

           See also the migrate_options parameter below.

           (optional, string, no default)

       <b>migrateuri</b>
           You can also specify here if the calculated migrate URI is unsuitable for your environment.

           If migrateuri is set then migration_network_suffix, migrateport and

           --migrateuri in migrate_options are effectively ignored. Use "%n" as the placeholder for the target
           node name.

           Please refer to the libvirt documentation for details on guest migration.

           (optional, string, no default)

       <b>migrate_options</b>
           Extra virsh options for the guest live migration. You can also specify here --migrateuri if the
           calculated migrate URI is unsuitable for your environment. If --migrateuri is set then
           migration_network_suffix and migrateport are effectively ignored. Use "%n" as the placeholder for the
           target node name.

           Please refer to the libvirt documentation for details on guest migration.

           (optional, string, no default)

       <b>monitor_scripts</b>
           To additionally monitor services within the virtual domain, add this parameter with a list of scripts
           to monitor.

           Note: when monitor scripts are used, the start and migrate_from operations will complete only when
           all monitor scripts have completed successfully. Be sure to set the timeout of these operations to
           accommodate this delay.

           (optional, string, no default)

       <b>autoset_utilization_cpu</b>
           If set true, the agent will detect the number of domainU's vCPUs from virsh, and put it into the CPU
           utilization of the resource when the monitor is executed.

           (optional, boolean, default true)

       <b>autoset_utilization_host_memory</b>
           If set true, the agent will detect the number of *Max memory* from virsh, and put it into the
           host_memory utilization of the resource when the monitor is executed.

           (optional, boolean, default true)

       <b>autoset_utilization_hv_memory</b>
           If set true, the agent will detect the number of *Max memory* from virsh, and put it into the
           hv_memory utilization of the resource when the monitor is executed.

           (optional, boolean, default true)

       <b>unset_utilization_cpu</b>
           If set true then the agent will remove the cpu utilization resource when the monitor is executed.

           (optional, boolean, default false)

       <b>unset_utilization_host_memory</b>
           If set true then the agent will remove the host_memory utilization resource when the monitor is
           executed.

           (optional, boolean, default false)

       <b>unset_utilization_hv_memory</b>
           If set true then the agent will remove the hv_memory utilization resource when the monitor is
           executed.

           (optional, boolean, default false)

       <b>migrateport</b>
           This port will be used in the qemu migrateuri. If unset, the port will be a random highport.

           (optional, integer, no default)

       <b>remoteuri</b>
           Use this URI as virsh connection URI to commuicate with a remote hypervisor.

           If remoteuri is set then migration_user and migration_network_suffix are effectively ignored. Use
           "%n" as the placeholder for the target node name.

           Please refer to the libvirt documentation for details on guest migration.

           (optional, string, no default)

       <b>save_config_on_stop</b>
           Changes to a running VM's config are normally lost on stop. This parameter instructs the RA to save
           the configuration back to the xml file provided in the "config" parameter.

           (optional, boolean, no default)

       <b>sync_config_on_stop</b>
           Setting this automatically enables save_config_on_stop. When enabled this parameter instructs the RA
           to call csync2 -x to synchronize the file to all nodes. csync2 must be properly set up for this to
           work.

           (optional, boolean, no default)

       <b>snapshot</b>
           Path to the snapshot directory where the virtual machine image will be stored. When this parameter is
           set, the virtual machine's RAM state will be saved to a file in the snapshot directory when stopped.
           If on start a state file is present for the domain, the domain will be restored to the same state it
           was in right before it stopped last. This option is incompatible with the 'force_stop' option.

           (optional, string, no default)

       <b>backingfile</b>
           When the VM is used in Copy-On-Write mode, this is the backing file to use (with its full path). The
           VMs image will be created based on this backing file. This backing file will never be changed during
           the life of the VM.

           (optional, string, no default)

       <b>stateless</b>
           If set to true and backingfile is defined, the start of the VM will systematically create a new qcow2
           based on the backing file, therefore the VM will always be stateless. If set to false, the start of
           the VM will use the COW (&lt;vmname&gt;.qcow2) file if it exists, otherwise the first start will create a
           new qcow2 based on the backing file given as backingfile.

           (optional, boolean, default false)

       <b>copyindirs</b>
           List of directories for the virt-copy-in before booting the VM. Used only in stateless mode.

           (optional, string, no default)

       <b>shutdown_mode</b>
           virsh shutdown method to use. Please verify that it is supported by your virsh toolsed with 'virsh
           help shutdown' When this parameter is set --mode shutdown_mode is passed as an additional argument to
           the 'virsh shutdown' command. One can use this option in case default acpi method does not work.
           Verify that this mode is supported by your VM. By default --mode is not passed.

           (optional, string, no default)

       <b>start_resources</b>
           Start the virtual storage pools and networks used by the virtual machine before starting it or before
           live migrating it.

           (optional, boolean, default false)

</pre><h4><b>SUPPORTED</b> <b>ACTIONS</b></h4><pre>
       This resource agent supports the following actions (operations):

       <b>start</b>
           Starts the resource. Suggested minimum timeout: 90s.

       <b>stop</b>
           Stops the resource. Suggested minimum timeout: 90s.

       <b>status</b>
           Performs a status check. Suggested minimum timeout: 30s. Suggested interval: 10s.

       <b>monitor</b>
           Performs a detailed status check. Suggested minimum timeout: 30s. Suggested interval: 10s.

       <b>migrate_from</b>
           Executes steps necessary for migrating the resource <u>away</u> <u>from</u> the node. Suggested minimum timeout:
           60s.

       <b>migrate_to</b>
           Executes steps necessary for migrating the resource <u>to</u> the node. Suggested minimum timeout: 120s.

       <b>meta-data</b>
           Retrieves resource agent metadata (internal use only). Suggested minimum timeout: 5s.

       <b>validate-all</b>
           Performs a validation of the resource configuration. Suggested minimum timeout: 5s.

</pre><h4><b>EXAMPLE</b> <b>CRM</b> <b>SHELL</b></h4><pre>
       The following is an example configuration for a VirtualDomain resource using the <b><a href="../man8/crm.8.html">crm</a></b>(8) shell:

           primitive p_VirtualDomain ocf:heartbeat:VirtualDomain \
             params \
               config=<u>string</u> \
             meta allow-migrate="true" \
             op monitor depth="0" timeout="30s" interval="10s"

</pre><h4><b>EXAMPLE</b> <b>PCS</b></h4><pre>
       The following is an example configuration for a VirtualDomain resource using <b><a href="../man8/pcs.8.html">pcs</a></b>(8)

           pcs resource create p_VirtualDomain ocf:heartbeat:VirtualDomain \
             config=<u>string</u> \
             op monitor OCF_CHECK_LEVEL="0" timeout="30s" interval="10s"

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="http://clusterlabs.org/">http://clusterlabs.org/</a></b>

</pre><h4><b>AUTHOR</b></h4><pre>
       <b>ClusterLabs</b> <b>contributors</b> <b>(see</b> <b>the</b> <b>resource</b> <b>agent</b> <b>source</b> <b>for</b> <b>information</b> <b>about</b> <b>individual</b> <b>authors)</b>

resource-agents 4.16.0-3ubuntu                     06/25/2025                            <u><a href="../man7/OCF_HEARTBEAT_VIRTUA.7.html">OCF_HEARTBEAT_VIRTUA</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>