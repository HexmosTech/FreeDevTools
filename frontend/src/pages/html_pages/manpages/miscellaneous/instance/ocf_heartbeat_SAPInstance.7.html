<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ocf_heartbeat_SAPInstance - Manages a SAP instance as an HA resource.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/resource-agents-extra">resource-agents-extra_4.16.0-3ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ocf_heartbeat_SAPInstance - Manages a SAP instance as an HA resource.

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>SAPInstance</b> [start | stop | status | monitor | promote | demote | meta-data | validate-all]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Usually a SAP system consists of one database and at least one or more SAP instances (sometimes called
       application servers). One SAP Instance is defined by having exactly one instance profile. The instance
       profiles can usually be found in the directory /sapmnt/SID/profile. Each instance must be configured as
       it's own resource in the cluster configuration. The resource agent supports the following SAP versions:

       - SAP WebAS ABAP Release 6.20 - 7.40

       - SAP WebAS Java Release 6.40 - 7.40

       - SAP WebAS ABAP + Java Add-In Release 6.20 - 7.40 (Java is not monitored by the cluster in that case)
       When using a SAP Kernel 6.40 please check and implement the actions from the section "Manual
       postprocessing" from SAP note 995116 (<a href="http://sdn.sap.com">http://sdn.sap.com</a>). Other versions may also work with this agent,
       but have not been verified.

       All operations of the SAPInstance resource agent are done by using the startup framework called SAP
       Management Console or sapstartsrv that was introduced with SAP kernel release 6.40. Find more information
       about the SAP Management Console in SAP note 1014480. Using this framework defines a clear interface for
       the Heartbeat cluster, how it sees the SAP system. The options for monitoring the SAP system are also
       much better than other methods like just watching the ps command for running processes or doing some
       pings to the application. sapstartsrv uses SOAP messages to request the status of running SAP processes.
       Therefore it can actually ask a process itself what it's status is, independent from other problems that
       might exist at the same time.

       sapstartsrv knows 4 status colours:

       - GREEN = everything is fine

       - YELLOW = something is wrong, but the service is still working

       - RED = the service does not work

       - GRAY = the service has not been started

       The SAPInstance resource agent will interpret GREEN and YELLOW as OK. That means that minor problems will
       not be reported to the Heartbeat cluster. This prevents the cluster from doing an unwanted failover. The
       statuses RED and GRAY are reported as NOT_RUNNING to the cluster. Depending on the status the cluster
       expects from the resource, it will do a restart, failover or just nothing.

</pre><h4><b>SUPPORTED</b> <b>PARAMETERS</b></h4><pre>
       <b>InstanceName</b>
           The full qualified SAP instance name. e.g. P01_DVEBMGS00_sapp01ci. Usually this is the name of the
           SAP instance profile.

           (unique, required, string, no default)

       <b>DIR_EXECUTABLE</b>
           The full qualified path where to find sapstartsrv and sapcontrol. Specify this parameter, if you have
           changed the SAP kernel directory location after the default SAP installation.

           (optional, string, no default)

       <b>DIR_PROFILE</b>
           The full qualified path where to find the SAP START profile. Specify this parameter, if you have
           changed the SAP profile directory location after the default SAP installation.

           (optional, string, no default)

       <b>START_PROFILE</b>
           The name of the SAP START profile. Specify this parameter, if you have changed the name of the SAP
           START profile after the default SAP installation. As SAP release 7.10 does not have a START profile
           anymore, you need to specify the Instance Profile than.

           (unique, optional, string, no default)

       <b>START_WAITTIME</b>
           After that time in seconds a monitor operation is executed by the resource agent. Does the monitor
           return SUCCESS, the start ishandled as SUCCESS. This is useful to resolve timing problems with e.g.
           the J2EE-Addin instance.Usually the resource agent waits until all services are started and the SAP
           Management Console reports a GREEN status. A double stack installation (ABAP + Java AddIn) consists
           of an ABAP dispatcher and a JAVA instance. Normally the start of the JAVA instance takes much longer
           than the start of the ABAP instance. For a JAVA Instance you may need to configure a much higher
           timeout for the start operation of the resource in Heartbeat. The disadvantage here is, that the
           discovery of a failed start by the cluster takes longer. Somebody might say: For me it is important,
           that the ABAP instance is up and running. A failure of the JAVA instance shall not cause a failover
           of the SAP instance. Actually the SAP MC reports a YELLOW status, if the JAVA instance of a double
           stack system fails. From the resource agent point of view YELLOW means:everything is OK. Setting
           START_WAITTIME to a lower value determines the resource agent to check the status of the instance
           during a start operation after that time. As it would wait normally for a GREEN status, now it
           reports SUCCESS to the cluster in case of a YELLOW status already after the specified time.

           That is only useful for double stack systems.

           (optional, string, default "3600")

       <b>AUTOMATIC_RECOVER</b>
           The SAPInstance resource agent tries to recover a failed start attempt automatically one time. This
           is done by killing running instance processes, removing the kill.sap file and executing cleanipc.
           Sometimes a crashed SAP instance leaves some processes and/or shared memory segments behind. Setting
           this option to true will try to remove those leftovers during a start operation. That is to reduce
           manual work for the administrator.

           (optional, boolean, default false)

       <b>MONITOR_SERVICES</b>
           Within a SAP instance there can be several services. Usually you will find the defined services in
           the START profile of the related instance (Attention: with SAP Release 7.10 the START profile content
           was moved to the instance profile). Not all of those services are worth to monitor by the cluster.
           For example you properly do not like to failover your SAP instance, if the central syslog collector
           daemon fails. Those services are monitored within the SAPInstance resource agent:

           - disp+work

           - msg_server

           - enserver (ENSA1)

           - enq_server (ENSA2)

           - enrepserver (ENSA1)

           - enq_replicator (ENSA2)

           - jcontrol

           - jstart

           Some other services could be monitored as well. They have to be given with the parameter
           MONITOR_SERVICES, e.g.:

           - sapwebdisp - TREXDaemon.x

           That names match the strings used in the output of the command 'sapcontrol -nr [Instance-Nr]
           -function GetProcessList'. The default should fit most cases where you want to manage a SAP Instance
           from the cluster. You may change this with this parameter, if you like to monitor more/less or other
           services that sapstartsrv supports. You may specify multiple services separated by a | (pipe) sign in
           this parameter: disp+work|msg_server|enserver

           (optional, string, default
           "disp+work|msg_server|enserver|enrepserver|jcontrol|jstart|enq_server|enq_replicator")

       <b>SHUTDOWN_METHOD</b>
           Usually a SAP Instance is stopped by the command 'sapcontrol -nr InstanceNr -function Stop'.
           SHUTDOWN_METHOD=KILL means to kill the SAP Instance using OS commands. SAP processes of the instance
           are terminated with 'kill -9', shared memory is deleted with 'cleanipc' and the 'kill.sap' file will
           be deleted. That method is much faster than the graceful stop, but the instance does not have the
           chance to say goodbye to other SAPinstances in the same system. USE AT YOUR OWN RISK !!

           (optional, string, default "normal")

       <b>ERS_InstanceName</b>
           Only used in a Promotable resource configuration: The full qualified SAP enqueue replication instance
           name. e.g. P01_ERS02_sapp01ers. Usually this is the name of the SAP instance profile. The enqueue
           replication instance must be installed, before you want to configure a promotable cluster resource.

           The promotable configuration in the cluster must use this properties: clone_max = 2 clone_node_max =
           1 master_node_max = 1 master_max = 1

           (unique, optional, string, no default)

       <b>ERS_START_PROFILE</b>
           Only used in a Promotable resource configuration: The parameter ERS_InstanceName must also be set in
           this configuration. The name of the SAP START profile. Specify this parameter, if you have changed
           the name of the SAP START profile after the default SAP installation. As SAP release 7.10 does not
           have a START profile anymore, you need to specify the Instance Profile than.

           (unique, optional, string, no default)

       <b>PRE_START_USEREXIT</b>
           The full qualified path where to find a script or program which should be executed before this
           resource gets started.

           (optional, string, no default)

       <b>POST_START_USEREXIT</b>
           The full qualified path where to find a script or program which should be executed after this
           resource got started.

           (optional, string, no default)

       <b>PRE_STOP_USEREXIT</b>
           The full qualified path where to find a script or program which should be executed before this
           resource gets stopped.

           (optional, string, no default)

       <b>POST_STOP_USEREXIT</b>
           The full qualified path where to find a script or program which should be executed after this
           resource got stopped.

           (optional, string, no default)

       <b>IS_ERS</b>
           Only used for ASCS/ERS SAP Netweaver installations without implementing a promotable resource to
           allow the ASCS to 'find' the ERS running on another cluster node after a resource failure. This
           parameter should be set to true 'only' for the ERS instance for implementations following the SAP
           NetWeaver 7.40 HA certification (NW-HA-CLU-740). This includes also systems for NetWeaver less than
           7.40, if you like to implement the NW-HA-CLU-740 scenario.

           (optional, boolean, default false)

       <b>MINIMAL_PROBE</b>
           Setting MINIMAL_PROBE=true forces the resource agent to do only minimal check during a probe. This is
           needed for special file system setups. The MINIMAL_PROBE=true is only supported, if requested either
           by your vendor's support or if described in an architecture document from your HA vendor.

           (optional, boolean, default false)

</pre><h4><b>SUPPORTED</b> <b>ACTIONS</b></h4><pre>
       This resource agent supports the following actions (operations):

       <b>start</b>
           Starts the resource. Suggested minimum timeout: 180s.

       <b>stop</b>
           Stops the resource. Suggested minimum timeout: 240s.

       <b>status</b>
           Performs a status check. Suggested minimum timeout: 60s.

       <b>monitor</b>
           Performs a detailed status check. Suggested minimum timeout: 60s. Suggested interval: 120s.

       <b>monitor</b> <b>(Unpromoted</b> <b>role)</b>
           Performs a detailed status check. Suggested minimum timeout: 60s. Suggested interval: 121s.

       <b>monitor</b> <b>(Promoted</b> <b>role)</b>
           Performs a detailed status check. Suggested minimum timeout: 60s. Suggested interval: 119s.

       <b>promote</b>
           Promotes the resource to the Master role. Suggested minimum timeout: 320s.

       <b>demote</b>
           Demotes the resource to the Slave role. Suggested minimum timeout: 320s.

       <b>reload</b>
           Suggested minimum timeout: 320s.

       <b>validate-all</b>
           Performs a validation of the resource configuration. Suggested minimum timeout: 5s.

       <b>meta-data</b>
           Retrieves resource agent metadata (internal use only). Suggested minimum timeout: 5s.

       <b>methods</b>
           Suggested minimum timeout: 5s.

</pre><h4><b>EXAMPLE</b> <b>CRM</b> <b>SHELL</b></h4><pre>
       The following is an example configuration for a SAPInstance resource using the <b><a href="../man8/crm.8.html">crm</a></b>(8) shell:

           primitive p_SAPInstance ocf:heartbeat:SAPInstance \
             params \
               InstanceName=<u>string</u> \
             op monitor depth="0" timeout="60s" interval="120s" \
             op monitor depth="0" timeout="60s" interval="121s" role="Unpromoted" \
             op monitor depth="0" timeout="60s" interval="119s" role="Promoted"

           ms ms_SAPInstance p_SAPInstance \
             meta notify="true" interleave="true"

</pre><h4><b>EXAMPLE</b> <b>PCS</b></h4><pre>
       The following is an example configuration for a SAPInstance resource using <b><a href="../man8/pcs.8.html">pcs</a></b>(8)

           pcs resource create p_SAPInstance ocf:heartbeat:SAPInstance \
             InstanceName=<u>string</u> \
             op monitor OCF_CHECK_LEVEL="0" timeout="60s" interval="120s" \
             op monitor OCF_CHECK_LEVEL="0" timeout="60s" interval="121s" role="Unpromoted" \
             op monitor OCF_CHECK_LEVEL="0" timeout="60s" interval="119s" role="Promoted" promotable

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="http://clusterlabs.org/">http://clusterlabs.org/</a></b>

</pre><h4><b>AUTHOR</b></h4><pre>
       <b>ClusterLabs</b> <b>contributors</b> <b>(see</b> <b>the</b> <b>resource</b> <b>agent</b> <b>source</b> <b>for</b> <b>information</b> <b>about</b> <b>individual</b> <b>authors)</b>

resource-agents 4.16.0-3ubuntu                     06/25/2025                            <u><a href="../man7/OCF_HEARTBEAT_SAPINS.7.html">OCF_HEARTBEAT_SAPINS</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>