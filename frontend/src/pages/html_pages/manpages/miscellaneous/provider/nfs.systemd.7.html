<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nfs.systemd - managing NFS services through systemd.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/nfs-common">nfs-common_2.8.3-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nfs.systemd - managing NFS services through systemd.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       nfs-utils.service
       nfs-server.service
       nfs-client.target
       <u>etc</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <u>nfs-utils</u>  package  provides  a  suite  of <u>systemd</u> unit files which allow the various services to be
       started and managed.  These unit files ensure that the services are started in the correct order, and the
       prerequisites are active before dependant services start.  As there are quite  few unit files, it is  not
       immediately  obvious how best to achieve certain results.  The following subsections attempt to cover the
       issues that are most likely to come up.

   <b>Configuration</b>
       The standard systemd unit files do not provide any easy way to pass any command line arguments to daemons
       so as to configure their behavior.  In many case such configuration can be performed by making changes to
       <u>/etc/nfs.conf</u>  or  other  configuration  files  (see  <b><a href="../man5/nfs.conf.5.html">nfs.conf</a></b>(5)).   When  that  is  not  convenient,  a
       distribution  might  provide  systemd  "drop-in"  files which replace the <b>ExecStart=</b> setting to start the
       program   with   different   arguments.     For    example    a    drop-in    file    <b>systemd/system/nfs-</b>
       <b>mountd.service.d/local.conf</b> containing
              [Service]
              EnvironmentFile=/etc/sysconfig/nfs
              ExecStart=
              ExecStart= /usr/sbin/rpc.mountd $RPCMOUNTDOPTS
       would  cause  the  <b>nfs-mountd.service</b>  unit to run the <u>rpc.mountd</u> program using, for arguments, the value
       given for <b>RPCMOUNTDOPTS</b> in <u>/etc/sysconfig/nfs</u>.   This  allows  for  seamless  integration  with  existing
       configuration tools.

   <b>Enabling</b> <b>unit</b> <b>files</b>
       There  are  three unit files which are designed to be manually enabled.  All others are automatically run
       as required.  The three are:

       <b>nfs-client.target</b>
              This should be enabled on any host which ever serves as an NFS client.  There is  little  cost  in
              transparently enabling it whenever NFS client software is installed.

       <b>nfs-server.service</b>
              This  must  be  enabled  to provide NFS service to clients.  It starts and configures the required
              daemons in the required order.

       <b>nfs-blkmap.service</b>
              The <b>blkmapd</b> daemon is only required on NFS clients  which  are  using  pNFS  (parallel  NFS),  and
              particularly using the <b>blocklayout</b> layout protocol.  If you might use this particular extension to
              NFS, the <b>nfs-blkmap.service</b> unit should be enabled.

       Several  other  units  which  might be considered to be optional, such as <u>rpc-gssd.service</u> are careful to
       only start if the required configuration file exists.  <u>rpc-gssd.service</u> will not start if the <u>krb5.keytab</u>
       file does not exist (typically in <u><a href="file:/etc">/etc</a></u>).

   <b>Restarting</b> <b>NFS</b> <b>services</b>
       Most NFS daemons can be restarted at any time.  They will reload any state that they need,  and  continue
       servicing requests.  This is rarely necessary though.

       When  configuration  changes are made, it can be hard to know exactly which services need to be restarted
       to ensure that the configuration takes effect.  The simplest approach, which is often  the  best,  is  to
       restart  everything.  To help with this, the <b>nfs-utils.service</b> unit is provided.  It declares appropriate
       dependencies with other unit files so that
              <b>systemctl</b> <b>restart</b> <b>nfs-utils</b>
       will restart all NFS daemons that are running.  This will cause all configuration changes to take  effect
       <u>except</u> for changes to mount options lists in <u><a href="file:/etc/fstab">/etc/fstab</a></u> or <u>/etc/nfsmount.conf</u>.  Mount options can only be
       changed by unmounting and remounting filesystem.  This can be a disruptive operation so it should only be
       done when the value justifies the cost.  The command
              <b>umount</b> <b>-a</b> <b>-t</b> <b>nfs;</b> <b>mount</b> <b>-a</b> <b>-t</b> <b>nfs</b>
       should unmount and remount all NFS filesystems.

   <b>Masking</b> <b>unwanted</b> <b>services</b>
       Rarely  there  may be a desire to prohibit some services from running even though there are normally part
       of a working NFS system.  This may be needed to reduce system load to an absolute minimum, or  to  reduce
       attack surface by not running daemons that are not absolutely required.

       Three particular services which this can apply to are <u>rpcbind</u>, <u>idmapd</u>, and <u>rpc-gssd</u>.  <u>rpcbind</u> is not part
       of  the <u>nfs-utils</u> package, but it used by several NFS services.  However it is <b>not</b> needed when only NFSv4
       is in use.  If a site will never use NFSv3 (or NFSv2) and does  not  want  <u>rpcbind</u>  to  be  running,  the
       correct approach is to run
              <b>systemctl</b> <b>mask</b> <b>rpcbind</b>
       This  will  disable  <u>rpcbind</u>,  and  the  various NFS services which depend on it (and are only needed for
       NFSv3) will refuse to start, without interfering with the operation of NFSv4  services.   In  particular,
       <u>rpc.statd</u> will not run when <u>rpcbind</u> is masked.

       <u>idmapd</u>  is  only  needed  for  NFSv4, and even then is not needed when the client and server agree to use
       user-ids rather than user-names to identify the owners of files.  If <u>idmapd</u> is not needed and not wanted,
       it can be masked with
              <b>systemctl</b> <b>mask</b> <b>idmapd</b>
       <u>rpc-gssd</u> is assumed to be needed if the <u>krb5.keytab</u> file is present.  If a site needs this  file  present
       but does not want <u>rpc-gssd</u> running, it can be masked with
              <b>systemctl</b> <b>mask</b> <b>rpc-gssd</b>

</pre><h4><b>FILES</b></h4><pre>
       /etc/nfs.conf
       /etc/nfsmount.conf
       /etc/idmapd.conf

       Also similar files in <b>/usr/etc</b> and in related <u>conf.d</u> drop-in directories.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/systemd.unit.5.html">systemd.unit</a></b>(5), <b><a href="../man5/nfs.conf.5.html">nfs.conf</a></b>(5), <b><a href="../man5/nfsmount.conf.5.html">nfsmount.conf</a></b>(5).

                                                                                                  <u><a href="../man7/NFS.SYSTEMD.7.html">NFS.SYSTEMD</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>