<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cdist-type__haproxy_dualstack - Proxy services from a dual-stack server</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/cdist">cdist_7.0.0-5_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       cdist-type__haproxy_dualstack - Proxy services from a dual-stack server

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  (singleton)  type  installs  and  configures  haproxy to act as a dual-stack proxy for single-stack
       services.

       This can be useful to add IPv4 support to IPv6-only services while only using  one  IPv4  for  many  such
       services.

       By default this type uses the plain TCP proxy mode, which means that there is no need for TLS termination
       on  this host when SNI is supported.  This also means that proxied services will not receive the client's
       IP address, but will see the proxy's IP address instead (that of <u>$</u><b>__</b><u>target_host</u>).

       This can be solved by using the PROXY protocol, but do take into account that, e.g.  nginx  cannot  serve
       both regular HTTP(S) and PROXY protocols on the same port, so you will need to use other ports for that.

       As  a  recommendation in this type: use TCP ports 8080 and 591 respectively to serve HTTP and HTTPS using
       the PROXY protocol.

       See the EXAMPLES for more details.

</pre><h4><b>OPTIONAL</b> <b>PARAMETERS</b></h4><pre>
       <b>v4proxy</b>
              Proxy incoming IPv4 connections to the equivalent IPv6 endpoint.  In its simplest use, it must  be
              a  NAME  with  an <u>AAAA</u> DNS entry, which is the IP address actually providing the proxied services.
              The full format of  this  argument  is:  <u>[proxy:]NAME[[:PROTOCOL_1=PORT_1]...[:PROTOCOL_N=PORT_N]]</u>
              Where starting with <u>proxy:</u> determines that the PROXY protocol must be used and each <u>:PROTOCOL=PORT</u>
              (e.g. <u>:http=8080</u> or <u>:https=591</u>) is a PORT override for the given PROTOCOL (see <u>--protocol</u>), if not
              present the PROTOCOL's default port will be used.

       <b>v6proxy</b>
              Proxy  incoming IPv6 connections to the equivalent IPv4 endpoint.  In its simplest use, it must be
              a NAME with an <u>A</u> DNS entry, which is the IP address actually providing the proxied services.   See
              <u>--v4proxy</u> for more options and details.

       <b>protocol</b>
              Can  be  passed  multiple  times  or  as a space-separated list of protocols.  Currently supported
              protocols are: <u>http</u>, <u>https</u>, <u>imaps</u>, <u>smtps</u>.  This defaults to: <u>http</u> <u>https</u> <u>imaps</u> <u>smtps</u>.

</pre><h4><b>EXAMPLES</b></h4><pre>
          # Proxy the IPv6-only services so IPv4-only clients can access them
          # This uses HAProxy's TCP mode for http, https, imaps and smtps
          __haproxy_dualstack \
              --v4proxy ipv6.chat \
              --v4proxy matrix.ungleich.ch

          # Proxy the IPv6-only HTTP(S) services so IPv4-only clients can access them
          # Note this means that the backend IPv6-only server will only see
          # the IPv6 address of the haproxy host managed by cdist, which can be
          # troublesome if this information is relevant for analytics/security/...
          # See the PROXY example below
          __haproxy_dualstack \
              --protocol http --protocol https \
              --v4proxy ipv6.chat \
              --v4proxy matrix.ungleich.ch

          # Use the PROXY protocol to proxy the IPv6-only HTTP(S) services enabling
          # IPv4-only clients to access them while maintaining the client's IP address
          __haproxy_dualstack \
              --protocol http --protocol https \
              --v4proxy proxy:ipv6.chat:http=8080:https=591 \
              --v4proxy proxy:matrix.ungleich.ch:http=8080:https=591
          # Note however that the PROXY protocol is not compatible with regular
          # HTTP(S) protocols, so your nginx will have to listen on different ports
          # with the PROXY settings.
          # Note that you will need to restrict access to the 8080 port to prevent
          # Client IP spoofing.
          # This can be something like:
          # server {
          #     # listen for regular HTTP connections
          #     listen [::]:80 default_server;
          #     listen 80 default_server;
          #     # listen for PROXY HTTP connections
          #     listen [::]:8080 proxy_protocol;
          #     # Accept the Client's IP from the PROXY protocol
          #     real_ip_header proxy_protocol;
          # }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       • <u>https://www.haproxy.com/blog/enhanced-ssl-load-balancing-with-server-name-indication-sni-tls-extension/</u>

       • <u>https://www.haproxy.com/blog/haproxy/proxy-protocol/</u>

       • <u>https://docs.nginx.com/nginx/admin-guide/load-balancer/using-proxy-protocol/</u>

</pre><h4><b>AUTHORS</b></h4><pre>
       ungleich &lt;<u>foss--@--ungleich.ch</u>&gt; Evilham &lt;<u>cvs--@--evilham.com</u>&gt;

</pre><h4><b>COPYING</b></h4><pre>
       Copyright (C) 2021 ungleich glarus ag. You can redistribute it and/or modify it under the  terms  of  the
       GNU General Public License as published by the Free Software Foundation, either version 3 of the License,
       or (at your option) any later version.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       ungleich GmbH 2021

7.0.0                                             Sep 11, 2024                  <u>CDIST-TYPE</u><b>__</b><u><a href="../man7/HAPROXY_DUALSTACK.7.html">HAPROXY_DUALSTACK</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>