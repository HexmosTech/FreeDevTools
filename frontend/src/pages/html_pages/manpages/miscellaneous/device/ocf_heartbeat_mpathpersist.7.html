<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ocf_heartbeat_mpathpersist - Manages SCSI persistent reservations on multipath devices</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/resource-agents-extra">resource-agents-extra_4.16.0-3ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ocf_heartbeat_mpathpersist - Manages SCSI persistent reservations on multipath devices

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>mpathpersist</b> [start | stop | monitor | promote | demote | meta-data | validate-all]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This resource agent manages SCSI persistent reservations on multipath devices. "mpathpersist" from
       multipath-tools is used, please see its documentation. Should be used as multistate (Promotable) resource
       Unpromoted registers its node id ("crm_node -i") as reservation key ( --param-sark ) on each device in
       the params "devs" list. Promoted reserves all devices from params "devs" list with reservation
       "--prout-type" value from "reservation_type" parameter. Please see man <a href="../man8/sg_persist.8.html">sg_persist</a>(8) and <a href="../man8/mpathpersist.8.html">mpathpersist</a>(8)
       for reservation_type details.

</pre><h4><b>SUPPORTED</b> <b>PARAMETERS</b></h4><pre>
       <b>binary</b>
           The name of the binary that manages the resource.

           (optional, string, default "mpathpersist")

       <b>devs</b>
           Device list. Multiple devices can be listed with blank space as separator. Shell wildcards are
           allowed.

           (required, string, no default)

       <b>required_devs_no</b>
           Minimum number of "working" devices from device list 1) existing 2) "mpathpersist --in --read-keys
           &lt;device&gt;" works (Return code 0) resource actions "start","monitor","promote" and "validate-all"
           return "OCF_ERR_INSTALLED" if the actual number of "working" devices is less than "required_devs_no".
           resource actions "stop" and "demote" tries to remove reservations and registration keys from all
           working devices, but always return "OCF_SUCCESS"

           (optional, string, default "1")

       <b>reservation_type</b>
           reservation type

           (optional, string, default "1")

       <b>master_score_base</b>
           master_score_base value "master_score_base" value is used in "master_score" calculation: master_score
           = master_score_base + master_score_dev_factor * working_devs if set to bigger value in mpathpersist
           resource configuration on some node, this node will be "preferred" for promoted role.

           (optional, string, default "0")

       <b>master_score_dev_factor</b>
           Working device factor in promoted calculation each "working" device provides additional value to
           "master_score", so the node that sees more devices will be preferred for the "Promoted"-role Setting
           it to 0 will disable this behavior.

           (optional, string, default "100")

       <b>master_score_delay</b>
           promoted/unpromoted decreases/increases its master_score after delay of "master_score_delay" seconds
           so if some device gets inaccessible, the unpromoted decreases its promoted first and the resource
           will no be watched and after this device reappears again the promoted increases its master_score
           first this can work only if the master_score_delay is bigger then monitor interval on both promoted
           and unpromoted Setting it to 0 will disable this behavior.

           (optional, string, default "30")

</pre><h4><b>SUPPORTED</b> <b>ACTIONS</b></h4><pre>
       This resource agent supports the following actions (operations):

       <b>start</b>
           Starts the resource. Suggested minimum timeout: 30s.

       <b>promote</b>
           Promotes the resource to the Master role. Suggested minimum timeout: 30s.

       <b>demote</b>
           Demotes the resource to the Slave role. Suggested minimum timeout: 30s.

       <b>notify</b>
           Suggested minimum timeout: 30s.

       <b>stop</b>
           Stops the resource. Suggested minimum timeout: 30s.

       <b>monitor</b> <b>(Unpromoted</b> <b>role)</b>
           Performs a detailed status check. Suggested minimum timeout: 20s. Suggested interval: 29s.

       <b>monitor</b> <b>(Promoted</b> <b>role)</b>
           Performs a detailed status check. Suggested minimum timeout: 20s. Suggested interval: 60s.

       <b>meta-data</b>
           Retrieves resource agent metadata (internal use only). Suggested minimum timeout: 5s.

       <b>validate-all</b>
           Performs a validation of the resource configuration. Suggested minimum timeout: 30s.

</pre><h4><b>EXAMPLE</b> <b>CRM</b> <b>SHELL</b></h4><pre>
       The following is an example configuration for a mpathpersist resource using the <b><a href="../man8/crm.8.html">crm</a></b>(8) shell:

           primitive p_mpathpersist ocf:heartbeat:mpathpersist \
             params \
               devs=<u>string</u> \
             op monitor depth="0" timeout="20s" interval="29s" role="Unpromoted" \
             op monitor depth="0" timeout="20s" interval="60s" role="Promoted"

           ms ms_mpathpersist p_mpathpersist \
             meta notify="true" interleave="true"

</pre><h4><b>EXAMPLE</b> <b>PCS</b></h4><pre>
       The following is an example configuration for a mpathpersist resource using <b><a href="../man8/pcs.8.html">pcs</a></b>(8)

           pcs resource create p_mpathpersist ocf:heartbeat:mpathpersist \
             devs=<u>string</u> \
             op monitor OCF_CHECK_LEVEL="0" timeout="20s" interval="29s" role="Unpromoted" \
             op monitor OCF_CHECK_LEVEL="0" timeout="20s" interval="60s" role="Promoted" promotable

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="http://clusterlabs.org/">http://clusterlabs.org/</a></b>

</pre><h4><b>AUTHOR</b></h4><pre>
       <b>ClusterLabs</b> <b>contributors</b> <b>(see</b> <b>the</b> <b>resource</b> <b>agent</b> <b>source</b> <b>for</b> <b>information</b> <b>about</b> <b>individual</b> <b>authors)</b>

resource-agents 4.16.0-3ubuntu                     06/25/2025                            <u><a href="../man7/OCF_HEARTBEAT_MPATHP.7.html">OCF_HEARTBEAT_MPATHP</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>