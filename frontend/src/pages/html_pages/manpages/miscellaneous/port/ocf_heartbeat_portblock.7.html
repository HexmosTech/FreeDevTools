<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ocf_heartbeat_portblock - Block and unblocks access to TCP and UDP ports</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/resource-agents-extra">resource-agents-extra_4.16.0-3ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ocf_heartbeat_portblock - Block and unblocks access to TCP and UDP ports

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>portblock</b> [start | stop | status | monitor | meta-data | validate-all]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Resource script for portblock. It is used to temporarily block ports using iptables. In addition, it may
       allow for faster TCP reconnects for clients on failover. Use that if there are long lived TCP connections
       to an HA service. This feature is enabled by setting the tickle_dir parameter and only in concert with
       action set to unblock. Note that the tickle ACK function is new as of version 3.0.2 and hasn't yet seen
       widespread use.

</pre><h4><b>SUPPORTED</b> <b>PARAMETERS</b></h4><pre>
       <b>protocol</b>
           The protocol used to be blocked/unblocked.

           (required, string, no default)

       <b>portno</b>
           The port number used to be blocked/unblocked.

           (required, string, no default)

       <b>action</b>
           The action (block/unblock) to be done on the protocol::portno.

           (required, string, no default)

       <b>reset_local_on_unblock_stop</b>
           If for some reason the long lived server side TCP sessions won't be cleaned up by a
           reconfiguration/flush/stop of whatever services this portblock protects, they would linger in the
           connection table, even after the IP is gone and services have been switched over to another node.

           An example would be the default NFS kernel server.

           These "known" connections may seriously confuse and delay a later switchback.

           Enabling this option will cause this agent to try to get rid of these connections by injecting a
           temporary iptables rule to TCP-reset outgoing packets from the blocked ports, and additionally tickle
           them locally, just before it starts to DROP incoming packets on "unblock stop".

           (optional, boolean, default false)

       <b>ip</b>
           The IP address used to be blocked/unblocked.

           (optional, string, default "0.0.0.0/0")

       <b>tickle_dir</b>
           The shared or local directory (_must_ be absolute path) which stores the established TCP connections.

           (optional, string, no default)

       <b>sync_script</b>
           If the tickle_dir is a local directory, then the TCP connection state file has to be replicated to
           other nodes in the cluster. It can be csync2 (default), some wrapper of rsync, or whatever. It takes
           the file name as a single argument. For csync2, set it to "csync2 -xv".

           (optional, string, no default)

       <b>direction</b>
           Whether to block incoming or outgoing traffic. Can be either "in", "out", or "both". If "in" is used,
           the incoming ports are blocked on the INPUT chain. If "out" is used, the outgoing ports are blocked
           on the OUTPUT chain. If "both" is used, both the incoming and outgoing ports are blocked.

           (optional, string, default "in")

</pre><h4><b>SUPPORTED</b> <b>ACTIONS</b></h4><pre>
       This resource agent supports the following actions (operations):

       <b>start</b>
           Starts the resource. Suggested minimum timeout: 20s.

       <b>stop</b>
           Stops the resource. Suggested minimum timeout: 20s.

       <b>status</b>
           Performs a status check. Suggested minimum timeout: 10s. Suggested interval: 10s.

       <b>monitor</b>
           Performs a detailed status check. Suggested minimum timeout: 10s. Suggested interval: 10s.

       <b>meta-data</b>
           Retrieves resource agent metadata (internal use only). Suggested minimum timeout: 5s.

       <b>validate-all</b>
           Performs a validation of the resource configuration. Suggested minimum timeout: 5s.

</pre><h4><b>EXAMPLE</b> <b>CRM</b> <b>SHELL</b></h4><pre>
       The following is an example configuration for a portblock resource using the <b><a href="../man8/crm.8.html">crm</a></b>(8) shell:

           primitive p_portblock ocf:heartbeat:portblock \
             params \
               protocol=<u>string</u> \
               portno=<u>string</u> \
               action=<u>string</u> \
             op monitor depth="0" timeout="10s" interval="10s"

</pre><h4><b>EXAMPLE</b> <b>PCS</b></h4><pre>
       The following is an example configuration for a portblock resource using <b><a href="../man8/pcs.8.html">pcs</a></b>(8)

           pcs resource create p_portblock ocf:heartbeat:portblock \
             protocol=<u>string</u> \
             portno=<u>string</u> \
             action=<u>string</u> \
             op monitor OCF_CHECK_LEVEL="0" timeout="10s" interval="10s"

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="http://clusterlabs.org/">http://clusterlabs.org/</a></b>

</pre><h4><b>AUTHOR</b></h4><pre>
       <b>ClusterLabs</b> <b>contributors</b> <b>(see</b> <b>the</b> <b>resource</b> <b>agent</b> <b>source</b> <b>for</b> <b>information</b> <b>about</b> <b>individual</b> <b>authors)</b>

resource-agents 4.16.0-3ubuntu                     06/25/2025                            <u><a href="../man7/OCF_HEARTBEAT_PORTBL.7.html">OCF_HEARTBEAT_PORTBL</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>