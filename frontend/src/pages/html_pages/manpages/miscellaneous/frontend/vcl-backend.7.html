<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCL-backends - Configuring Backends</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/varnish">varnish_7.7.0-3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       VCL-backends - Configuring Backends

</pre><h4><b>BACKEND</b> <b>DEFINITION</b></h4><pre>
       A  backend  declaration  creates  and  initialises  a named backend object.  A declaration start with the
       keyword <b>backend</b> followed by the name of the backend. The actual declaration is in curly  brackets,  in  a
       key/value fashion.:

          backend name {
              .attribute1 = value;
              .attribute2 = value;
              [...]
          }

       If  there  is  a  backend  named <b>default</b> it will be used unless another backend is explicitly set.  If no
       backend is named <b>default</b> the first backend in the VCL program becomes the default.

       If you only use dynamic backends created by  VMODs,  an  empty,  always  failing  (503)  backend  can  be
       specified:

          backend default none;

       A backend must be specified with either a <b>.host</b> or a <b>.path</b> attribute, but not both.  All other attributes
       have default values.

</pre><h4><b>ATTRIBUTE</b> <b>.HOST</b></h4><pre>
       To  specify  a  networked  backend  <b>.host</b> takes either a numeric IPv4/IPv6 address or a domain name which
       resolves to <u>at</u> <u>most</u> one IPv4 and one IPv6 address:

          .host = "127.0.0.1";

          .host = "[::1]:8080";

          .host = "example.com:8081";

          .host = "example.com:http";

</pre><h4><b>ATTRIBUTE</b> <b>.PORT</b></h4><pre>
       The TCP port number or service name can be specified as part of <b>.host</b> as above or  separately  using  the
       <b>.port</b> attribute:

          .port = "8081";

          .port = "http";

</pre><h4><b>ATTRIBUTE</b> <b>.PATH</b></h4><pre>
       The absolute path to a <a href="../man4/Unix.4.html">Unix</a>(4) domain socket of a local backend:

          .path = "/var/run/http.sock";

       or, where available, <b>@</b> followed by the name of an abstract socket of a local backend:

          .path = "@mybackend";

       A warning will be issued if the uds-socket does not exist when the VCL is loaded.  This makes it possible
       to start the UDS-listening peer, or set the socket file's permissions afterwards.

       If the uds-socket socket does not exist or permissions deny access, connection attempts will fail.

</pre><h4><b>ATTRIBUTE</b> <b>.HOST_HEADER</b></h4><pre>
       A host header to add to probes and regular backend requests if they have no such header:

          .host_header = "example.com";

</pre><h4><b>TIMEOUT</b> <b>ATTRIBUTES</b></h4><pre>
       These attributes control how patient <u>varnishd</u> is during backend fetches:

          .connect_timeout = 1.4s;
          .first_byte_timeout = 20s;
          .between_bytes_timeout = 10s;

       The default values comes parameters with the same names, see <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>.

</pre><h4><b>ATTRIBUTE</b> <b>.MAX_CONNECTIONS</b></h4><pre>
       Limit how many simultaneous connections varnish can open to the backend:

          .max_connections = 1000;

</pre><h4><b>ATTRIBUTE</b> <b>.WAIT_LIMIT</b></h4><pre>
       Maximum  number  of  transactions that can queue waiting for a backend connection to become available:

          .wait_limit = 1000;

       Note  that  this  feature  must  be  used  with  caution, as it can cause threads to pile up and increase
       response times.

       Defaults to the <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u> <u>backend_wait_limit</u> parameter.

</pre><h4><b>ATTRIBUTE</b> <b>.WAIT_TIMEOUT</b></h4><pre>
       When a transaction is queued waiting for a backend connection to become available (see <u>.wait_limit</u>), this
       is the time that the transaction will wait before giving up:

          .wait_timeout = 1s;

       It is strongly advised to never set this higher than a couple of seconds.

       Defaults to the <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u> <u>backend_wait_timeout</u> parameter.

</pre><h4><b>ATTRIBUTE</b> <b>.PROXY_HEADER</b></h4><pre>
       Send a PROXY protocol header to the backend with the <b>client.ip</b> and <b>server.ip</b> values:

          .proxy_header = 2;

       Legal values are one and two, depending which version of the PROXY protocol you want.

       <u>Notice</u> this setting will lead to backend connections being used for a single  request  only  (subject  to
       future  improvements). Thus, extra care should be taken to avoid running into failing backend connections
       with EADDRNOTAVAIL due to no local ports being available. Possible options are:

          • Use additional backend connections to extra IP addresses or TCP ports

          • Increase the number of available ports (Linux sysctl <b>net.ipv4.ip_local_port_range</b>)

          • Reuse backend connection ports early (Linux sysctl <b>net.ipv4.tcp_tw_reuse</b>)

</pre><h4><b>ATTRIBUTE</b> <b>.PREAMBLE</b></h4><pre>
       Send a BLOB on all newly opened connections to the backend:

          .preamble = :SGVsbG8gV29ybGRcbgo=:;

</pre><h4><b>ATTRIBUTE</b> <b>.VIA</b></h4><pre>
       Name of another <u>proxy</u> backend through which to make the connection to the <u>destination</u> backend  using  the
       PROXY2 &lt;https://raw.githubusercontent.com/haproxy/haproxy/master/doc/proxy-protocol.txt&gt;
        protocol, for example:

          backend proxy {
            .path = "/path/to/proxy2_endpoint";
          }
          backend destination {
            .host = "1.2.3.4";
            .via = proxy;
          }

       The <u>proxy</u> backend can also use a <b>.host</b>/<b>.port</b> definition rather than <b>.path</b>.

       Use of the <b>.path</b> attribute for the <u>destination</u> backend is not supported.

       The  <b>.via</b>  attribute  is  unrelated  to  <b>.proxy_header</b>.  If both are used, a second header is sent as per
       <b>.proxy_header</b> specification.

       Unless specified for  <u>destination</u>,  the  <b>connect_timeout</b>,  <b>first_byte_timeout</b>  and  <b>between_bytes_timeout</b>
       attributes are copied from <u>proxy</u> to <u>destination</u>.

       As  of  this  release,  the  <u>proxy</u> backend used with <b>.via</b> cannot be a director, it cannot itself use <b>.via</b>
       (error:    <u>Cannot</u>    <u>stack</u>    <u>.via</u>    <u>backends</u>)    and    the    protocol    is    fixed    to     PROXY2
       &lt;https://raw.githubusercontent.com/haproxy/haproxy/master/doc/proxy-protocol.txt&gt; .

       Implementation detail:

       If  <b>.via</b> <b>=</b> <b>&lt;proxy&gt;</b> is used, a PROXY2 &lt;https://raw.githubusercontent.com/haproxy/haproxy/master/doc/proxy-
       protocol.txt&gt;
        preamble is created with  the  <u>destination</u>  backend's  address  information  as  <b>dst_addr</b>/<b>dst_port</b>  and,
       optionally,  other  TLV  attributes. The connection is then made to the <u>proxy</u> backend's endpoint (<b>path</b> or
       <b>host</b>/<b>port</b>). This is technically equivalent to specifying a <b>backend</b> <b>destination_via_proxy</b> with a <b>.preamble</b>
       attribute                containing                the                 appropriate                 PROXY2
       &lt;https://raw.githubusercontent.com/haproxy/haproxy/master/doc/proxy-protocol.txt&gt;
        preamble for the <u>destination</u> backend.

</pre><h4><b>ATTRIBUTE</b> <b>.AUTHORITY</b></h4><pre>
       The HTTP authority to use when connecting to this backend. If unset, <b>.host_header</b> or <b>.host</b> are used.

       <b>.authority</b> <b>=</b> <b>""</b> disables sending an authority.

       <b>.authority</b> can not be an IP address.

       A colon and anything following (signifying a port) is removed from the authority.

       As   of  this  release,  the  attribute  is  only  used  by  <b>.via</b>  connections  as  a  <b>PP2_TYPE_AUTHORITY</b>
       Type-Length-Value                  (TLV)                  in                  the                  PROXY2
       &lt;https://raw.githubusercontent.com/haproxy/haproxy/master/doc/proxy-protocol.txt&gt;

       preamble.

</pre><h4><b>ATTRIBUTE</b> <b>.PROBE</b></h4><pre>
       Please see <u><a href="../man7/vcl-probe.7.html">vcl-probe</a>(7)</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       • <u><a href="../man1/varnishd.1.html">varnishd</a>(1)</u>

       • <u><a href="../man7/vcl.7.html">vcl</a>(7)</u>

       • <u><a href="../man7/vcl-probe.7.html">vcl-probe</a>(7)</u>

       • <u><a href="../man3/vmod_directors.3.html">vmod_directors</a>(3)</u>

       • <u><a href="../man3/vmod_std.3.html">vmod_std</a>(3)</u>

</pre><h4><b>HISTORY</b></h4><pre>
       VCL  was  developed  by Poul-Henning Kamp in cooperation with Verdens Gang AS, Redpill Linpro and Varnish
       Software.  This manual page is written by Per Buer, Poul-Henning Kamp, Martin  Blix  Grydeland,  Kristian
       Lyngstøl, Lasse Karstensen and others.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       This document is licensed under the same license as Varnish itself. See LICENSE for details.

       • Copyright (c) 2006 Verdens Gang AS

       • Copyright (c) 2006-2021 Varnish Software AS

                                                                                                 <u><a href="../man7/VCL-BACKENDS.7.html">VCL-BACKENDS</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>