<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>error::dwarf - dwarf debuginfo quality problems</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/systemtap-doc">systemtap-doc_5.1-5_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       error::dwarf - dwarf debuginfo quality problems

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Systemtap  sometimes  relies  on  ELF/DWARF debuginfo for programs being instrumented to locate places to
       probe, or context variables to read/write, just like a symbolic debugger does.  Even  though  examination
       of  the  program's source code may show variables or lines where probes may be desired, the compiler must
       preserve information about them for systemtap (or a debugger such as gdb) to get pinpoint access  to  the
       desired  information.   If  a  script requires such data, but the compiler did not preserve enough of it,
       pass-2 errors may result.

       Common conditions that trigger these problems include:

       debuginfo missing or mismatching
              Sometimes debuginfo is installed,  but  does  not  match  the  binaries  being  probed.   See  the
              <u>warning::debuginfo</u> man page for more help for locating correct debuginfo.

       compiler version
              Prior  to GCC version 4.5, debuginfo quality was fairly limited.  Often developers were advised to
              build their programs with <u>-O0</u> <u>-g</u> flags to disable optimization.   GCC  version  4.5  introduced  a
              facility  called "variable-tracking assignments" that allows it to generate high-quality debuginfo
              under full <u>-O2</u> <u>-g</u> optimization.  It is not perfect, but much better than before.  Note  that,  due
              to  another  gcc bug (PR51358) <u>-O0</u> <u>-g</u> can actually sometimes make debuginfo quality worse than for
              <u>-O2</u> <u>-g</u>.

              Another related problem involves debuginfo quality for the prologue area of a function  (PR15123),
              wherein  a  program  compiled  with  CFLAGS=-mfentry  (especially the kernel, for ftrace) may lack
              accurate debuginfo for the entry instructions for gcc prior to version 4.8.  If able,  arrange  to
              compile  your  programs  with  <u>-grecord-gcc-switches</u>  CFLAGS,  and/or try rerunning systemtap with
              <u>$PR15123_ASSUME_MFENTRY=1</u>.

       linux kbuild damaging debuginfo quality
              An upstream kernel commit #2062afb4f804a put -fno-var-tracking-assignments into KCFLAGS,  dramati‐
              cally  reducing  debuginfo  quality,  which  can  cause debuginfo failures. The simplest fix is to
              <b>erase,</b> <b>excise,</b> <b>nay,</b> <b>eradicate</b> this line from the top level linux Makefile:

              KBUILD_CFLAGS += [...] -fno-var-tracking-assignments [...]

       function inlining
              Even modern gcc sometimes has problems with parameters for inlined functions.  It may be necessary
              to change the script to probe at a slightly different place.  Try a <u>.statement()</u> probe, instead of
              a <u>.function()</u> probe, somewhere a few source lines into the body of the inlined function.   Or  try
              putting  a  probe  at the call site of the inlined function.  Or use the <u>if</u> <u>@defined($var)</u> <u>{</u> <u>...</u> <u>}</u>
              script language construct to test for the resolvability of the context variable before using it.

       instruction reordering
              Heavily optimized code often smears the instructions from  multiple  source  statements  together.
              This  can  leave  systemtap with no place to choose to place a probe, especially a statement probe
              specified by line number.  Systemtap may advise to try a nearby line number,  but  these  may  not
              work well either.  Consider placing a probe by a statement wildcard or line number range.

       elfutils configuration
              It  is possible that the DWARF debuginfo being sought is available, but not in a format acceptable
              to the copy of elfutils used by systemtap.  For example, your copy of gcc might produce compressed
              debuginfo (<u>.zdebug_*</u> ELF sections or <u>.xz</u> files) while your copy of elfutils might lack appropriate
              decompression capabilities.  Unfortunately, there is no easy way to tell if this is  the  problem.
              If  you're  building your own copy of elfutils, ensure all decompression library headers/libraries
              are available at build time.

       debuginfo configuration
              Some tools may generate debuginfo that is unsupported by systemtap, such as the linux kernel  CON‐
              FIG_DEBUG_INFO_SPLIT  (<u>.dwo</u>  files)  option.  Stick with plain ELF/DWARF (optinally split, Fedora-
              style), if possible.

</pre><h4><b>ALTERNATIVES</b></h4><pre>
       In order to reduce reliance on ELF/DWARF debuginfo, consider the use of statically compiled-in instrumen‐
       tation, such as kernel tracepoints, or <u>&lt;sys/sdt.h&gt;</u> userspace markers.  Such  instrumentation  hook  sites
       are  relatively  low  cost (just one NOP instruction for sdt.h), and nearly guarantee the availability of
       parameter data and a reliable probe site, all without reliance on debuginfo.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/stap.1.html">stap</a></u>(1),
       <u><a href="http://dwarfstd.org/">http://dwarfstd.org/</a></u>,
       <u><a href="http://sourceware.org/systemtap/wiki/TipContextVariables">http://sourceware.org/systemtap/wiki/TipContextVariables</a></u>,
       <u><a href="http://gcc.gnu.org/wiki/Var_Tracking_Assignments">http://gcc.gnu.org/wiki/Var_Tracking_Assignments</a></u>,
       <u>warning::<a href="../man7stap/debuginfo.7stap.html">debuginfo</a></u>(7stap),
       <u>warning::<a href="../man7stap/buildid.7stap.html">buildid</a></u>(7stap),
       <u>error::<a href="../man7stap/reporting.7stap.html">reporting</a></u>(7stap)

                                                                                             <u>ERROR::<a href="../man7stap/DWARF.7stap.html">DWARF</a></u>(7stap)
</pre>
 </div>
</div></section>
</div>
</body>
</html>