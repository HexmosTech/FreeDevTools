<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAIT FOR EVENT - Have Slonik script wait for previous event to complete</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/slony1-2-doc">slony1-2-doc_2.2.11-6_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       WAIT FOR EVENT - Have Slonik script wait for previous event to complete

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>WAIT</b> <b>FOR</b> <b>EVENT</b> <b>(options);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Waits for event Confirmation.

       Slonik remembers the last event generated on every node during script execution (events generated by ear‐
       lier calls are currently not checked). In certain situations it is necessary that events generated on one
       node  (such  as  <b>CREATE</b>  <b>SET</b>)  are  processed on another node before issuing more commands (for instance,
       <b>SLONIK</b> <b>SUBSCRIBE</b> <b><a href="../man7/SET.7.html">SET</a></b>(7)). <b>WAIT</b> <b>FOR</b> <b>EVENT</b> may be used to cause the slonik script to wait for  confirmation
       of an event, which hopefully means that the subscriber node is ready for the next action.

       <b>WAIT</b> <b>FOR</b> <b>EVENT</b> must be called outside of any <b>try</b> block in order to work, since new confirm messages don't
       become visible within a transaction.

       ORIGIN = ival | ALL
              The origin of the event(s) to wait for.

       CONFIRMED = ival | ALL
              The node ID of the receiver that must confirm the event(s).

       WAIT ON = ival
              The ID of the node where the “sl_confirm” [not available as a man page] table is to be checked.

       TIMEOUT = ival
              The  number of seconds to wait. Default is 600 (10 minutes). <b>TIMEOUT</b> <b>=</b> <b>0</b> causes the script to wait
              indefinitely.

</pre><h4><b>EXAMPLE</b></h4><pre>
       WAIT FOR EVENT (
         ORIGIN = ALL,
         CONFIRMED = ALL,
         WAIT ON = 1
       );

</pre><h4><b>LOCKING</b> <b>BEHAVIOUR</b></h4><pre>
       No application-visible locking should take place.

</pre><h4><b>VERSION</b> <b>INFORMATION</b></h4><pre>
       This command was introduced in Slony-I 1.0

       In version 2.0, the default value for <b>WAIT</b> <b>ON</b> was removed, so a node must be specified.

</pre><h4><b>ODDITIES</b></h4><pre>
       Not all events return interesting results. For instance, many people have  run  afoul  of  problems  with
       <b>SLONIK</b>  <b>SUBSCRIBE</b>  <b><a href="../man7/SET.7.html">SET</a></b>(7),  when  subscribing  a  new set. Be aware (and beware!) that a <b>SLONIK</b> <b>SUBSCRIBE</b>
       <b><a href="../man7/SET.7.html">SET</a></b>(7) request will return the event confirmation almost immediately, even though there might be  several
       hours of work to do before the subscription is ready. The trouble with <b>SLONIK</b> <b>SUBSCRIBE</b> <b><a href="../man7/SET.7.html">SET</a></b>(7) is that it
       is  processed  as <u>two</u> events, one on the origin node, with a second event, to enable the subscription, on
       the subscriber.

       In order to more reliably monitor from within a <b><a href="../man1/slonik.1.html">slonik</a></b>(1) script that <b>SLONIK</b>  <b>SUBSCRIBE</b>  <b><a href="../man7/SET.7.html">SET</a></b>(7)  is  com‐
       plete,  you  may  submit a <b>SLONIK</b> <b><a href="../man7/SYNC.7.html">SYNC</a></b>(7) event after the subscription, and have the WAIT request wait on
       the <b>SYNC</b> event, as follows.

            # Assuming that node 1 is the origin for set 999 that has direct subscribers 2 and 3
            SUBSCRIBE SET (ID = 999, PROVIDER = 1, RECEIVER = 2);
            WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON=1);
            SUBSCRIBE SET (ID = 999, PROVIDER = 1, RECEIVER = 3);
            WAIT FOR EVENT (ORIGIN = 1, CONFIRMED = ALL, WAIT ON=1);
            MERGE SET ( ID = 1, ADD ID = 999, ORIGIN = 1 );

                                                19 September 2024                       <u>SLONIK</u> <u>WAIT</u> <u>FOR</u> <u><a href="../man7/EVENT.7.html">EVENT</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>