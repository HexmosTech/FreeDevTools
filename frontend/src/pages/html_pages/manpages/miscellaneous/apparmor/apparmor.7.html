<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppArmor - kernel enhancement to confine programs to a limited set of resources.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/apparmor">apparmor_5.0.0~alpha1-0ubuntu4_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       AppArmor - kernel enhancement to confine programs to a limited set of resources.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       AppArmor is a kernel enhancement to confine programs to a limited set of resources. AppArmor's unique
       security model is to bind access control attributes to programs rather than to users.

       AppArmor confinement is provided via <u>profiles</u> loaded into the kernel via <b><a href="../man8/apparmor_parser.8.html">apparmor_parser</a></b>(8), typically
       through the <u>apparmor.service</u> systemd unit, which is used like this:

               # systemctl start apparmor
               # systemctl reload apparmor

       AppArmor can operate in two modes: <u>enforcement</u>, and <u>complain</u> <u>or</u> <u>learning</u>:

       •   <u>enforcement</u>  -   Profiles loaded in enforcement mode will result in enforcement of the policy defined
           in the profile as well as reporting policy violation attempts to syslogd.

       •   <u>complain</u> - Profiles loaded in  "complain" mode will not enforce  policy.   Instead,  it  will  report
           policy  violation  attempts. This mode is convenient for developing profiles. To manage complain mode
           for individual profiles the utilities <b><a href="../man8/aa-complain.8.html">aa-complain</a></b>(8) and <b><a href="../man8/aa-enforce.8.html">aa-enforce</a></b>(8) can be used.  These  utilities
           take a program name as an argument.

       Profiles  are  traditionally  stored  in files in <u><a href="file:/etc/apparmor.d/">/etc/apparmor.d/</a></u> under filenames with the convention of
       replacing the <b>/</b> in pathnames with <b>.</b> (except for the root <b>/</b>) so profiles are easier to  manage  (e.g.  the
       <u>/usr/sbin/nscd</u> profile would be named <u>usr.sbin.nscd</u>).

       Profiles  are  applied  to  a process at <b><a href="../man3/exec.3.html">exec</a></b>(3) time (as seen through the <b><a href="../man2/execve.2.html">execve</a></b>(2) system call): once a
       profile is loaded for a program, that program will be confined on the  next  <b><a href="../man3/exec.3.html">exec</a></b>(3).  If  a  process  is
       already  running  under  a  profile, when one replaces that profile in the kernel, the updated profile is
       applied immediately to that process.  On the other hand, a process that  is  already  running  unconfined
       cannot be confined.

       AppArmor  supports the Linux kernel's securityfs filesystem, and makes available the list of the profiles
       currently loaded; to mount the filesystem:

               # mount -tsecurityfs securityfs <a href="file:/sys/kernel/security">/sys/kernel/security</a>
               $ cat <a href="file:/sys/kernel/security/apparmor/profiles">/sys/kernel/security/apparmor/profiles</a>
               /usr/bin/mutt
               <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?gpg">/usr/bin/gpg</a>
                  ...

       Normally, the initscript will mount securityfs if it has not already been done.

       AppArmor also restricts what privileged operations a confined process may execute, even if the process is
       running as root. A confined process cannot call the following system calls:

               <a href="../man2/create_module.2.html">create_module</a>(2) <a href="../man2/delete_module.2.html">delete_module</a>(2) <a href="../man2/init_module.2.html">init_module</a>(2) <a href="../man2/ioperm.2.html">ioperm</a>(2)
               <a href="../man2/iopl.2.html">iopl</a>(2) <a href="../man2/ptrace.2.html">ptrace</a>(2) <a href="../man2/reboot.2.html">reboot</a>(2) <a href="../man2/setdomainname.2.html">setdomainname</a>(2)
               <a href="../man2/sethostname.2.html">sethostname</a>(2) <a href="../man2/swapoff.2.html">swapoff</a>(2) <a href="../man2/swapon.2.html">swapon</a>(2) <a href="../man2/sysctl.2.html">sysctl</a>(2)

   <b>Complain</b> <b>mode</b>
       Instead of denying access to resources the profile does not have a rule  for  AppArmor  can  "allow"  the
       access  and  log  a  message  for  the  operation  that  triggers it. This is called <u>complain</u> <u>mode</u>. It is
       important to note that rules that are present in the profile are still applied, so allow rules will still
       quiet or force audit messages, and deny rules will  still  result  in  denials  and  quieting  of  denial
       messages (see <u>Turn</u> <u>off</u> <u>deny</u> <u>audit</u> <u>quieting</u> if this is a problem).

       Complain  mode  can  be used to develop profiles incrementally as an application is exercised. The logged
       accesses can be added to the profile and then can the application further exercised to  discover  further
       additions  that  are needed. Because AppArmor allows the accesses the application will behave as it would
       if AppArmor was not confining it.

       <b>Warning</b> complain mode does not provide any security, only auditing, while it is enabled. It should not be
       used in a hostile environment or bad behaviors may be logged and added to the  profile  as  if  they  are
       resource accesses that should be used by the application.

       <b>Note</b>  complain  mode  can be very noisy with new or empty profiles, but with developed profiles might not
       log anything if the profile covers the application behavior well. See <u>Audit</u>  <u>Rate</u>  <u>Limiting</u>  if  complain
       mode is generating too many log messages.

       To set a profile and any children or hat profiles the profile may contain into complain mode use

               aa-complain <a href="file:/etc/apparmor.d/">/etc/apparmor.d/</a>&lt;the-application&gt;

       To  manually  set  a specific profile in complain mode, add the "complain" flag, and then manually reload
       the profile:

               profile foo flags=(complain) { ... }

       Note that the "complain" flag must also be added manually to any hats or children profiles of the profile
       or they will continue to use the previous mode.

       To enable complain mode globally, run:

               echo -n complain &gt; <a href="file:/sys/module/apparmor/parameters/mode">/sys/module/apparmor/parameters/mode</a>

       or to set it on boot add:

               apparmor.mode=complain

       as a kernel boot parameter.

       <b>Warning</b> Setting complain mode globally disables all apparmor  security  protections.  It  can  be  useful
       during debugging or profile development, but setting it selectively on a per profile basis is safer.

</pre><h4><b>ERRORS</b></h4><pre>
       When  a  confined  process  tries to access a file it does not have permission to access, the kernel will
       report a message through audit, similar to:

               audit(1386511672.612:238): apparmor="DENIED" operation="exec"
                 parent=7589 profile="/tmp/sh" name="<a href="file:/bin/uname">/bin/uname</a>" pid=7605
                 comm="sh" requested_mask="x" denied_mask="x" fsuid=0 ouid=0

               audit(1386511672.613:239): apparmor="DENIED" operation="open"
                 parent=7589 profile="/tmp/sh" name="<a href="file:/bin/uname">/bin/uname</a>" pid=7605
                 comm="sh" requested_mask="r" denied_mask="r" fsuid=0 ouid=0

               audit(1386511772.804:246): apparmor="DENIED" operation="capable"
                 parent=7246 profile="/tmp/sh" pid=7589 comm="sh" pid=7589
                 comm="sh" capability=2  capname="dac_override"

       The permissions requested by the process are described in the operation= and denied_mask=  (for  files  -
       capabilities etc. use a slightly different log format).  The "name" and process id of the running program
       are  reported,  as  well  as  the profile name including any "hat" that may be active, separated by "//".
       ("Name" is in quotes, because the process name is limited to 15 bytes; it is the same as reported through
       the Berkeley process accounting.)

       For confined processes running under a profile that has been loaded in complain  mode,  enforcement  will
       not take place and the log messages reported to audit will be of the form:

               audit(1386512577.017:275): apparmor="ALLOWED" operation="open"
                 parent=8012 profile="<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?du">/usr/bin/du</a>" name="<a href="file:/etc/apparmor.d/tunables/">/etc/apparmor.d/tunables/</a>"
                 pid=8049 comm="du" requested_mask="r" denied_mask="r" fsuid=1000 ouid=0

               audit(1386512577.017:276): apparmor="ALLOWED" operation="open"
                 parent=8012 profile="<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?du">/usr/bin/du</a>" name="<a href="file:/etc/apparmor.d/tunables/">/etc/apparmor.d/tunables/</a>"
                 pid=8049 comm="du" requested_mask="r" denied_mask="r" fsuid=1000 ouid=0

       If  the  userland  auditd is not running, the kernel will send audit events to klogd; klogd will send the
       messages to syslog, which will log the messages with the KERN facility. Thus,  REJECTING  and  PERMITTING
       messages   may   go  to  either  <u>/var/log/audit/audit.log</u>  or  <u>/var/log/messages</u>,  depending  upon  local
       configuration.

</pre><h4><b>DEBUGGING</b></h4><pre>
       AppArmor provides a few facilities to log more information, which can help debugging profiles.

   <b>Enable</b> <b>debug</b> <b>mode</b>
       When debug mode is enabled, AppArmor will  log  a  few  extra  messages  to  dmesg  (not  via  the  audit
       subsystem).  For  example,  the logs will state when <b><a href="../man8/ld.so.8.html">ld.so</a></b>(8) secure-execution mode has been applied in a
       profile transition.

       To enable debug mode, run:

               echo 1 &gt; <a href="file:/sys/module/apparmor/parameters/debug">/sys/module/apparmor/parameters/debug</a>

       or to set it on boot add:

               apparmor.debug=1

       as a kernel boot parameter.

   <b>Turn</b> <b>off</b> <b>deny</b> <b>audit</b> <b>quieting</b>
       By default, operations that trigger "deny" rules are not logged.  This is called <u>deny</u> <u>audit</u> <u>quieting</u>.

       To turn off deny audit quieting, run:

               echo -n noquiet &gt;<a href="file:/sys/module/apparmor/parameters/audit">/sys/module/apparmor/parameters/audit</a>

       or to set it on boot add:

               apparmor.audit=noquiet

       as a kernel boot parameter.

   <b>Force</b> <b>audit</b> <b>mode</b>
       AppArmor can log a message for every operation that triggers a rule configured in  the  policy.  This  is
       called <u>force</u> <u>audit</u> <u>mode</u>.

       <b>Warning!</b>  Force  audit  mode  can  be  extremely  noisy even for a single profile, let alone when enabled
       globally.

       To set a specific profile in force audit mode, add the "audit" flag:

               profile foo flags=(audit) { ... }

       To enable force audit mode globally, run:

               echo -n all &gt; <a href="file:/sys/module/apparmor/parameters/audit">/sys/module/apparmor/parameters/audit</a>

       or to set it on boot add:

               apparmor.audit=all

       as a kernel boot parameter.

       <b>Audit</b> <b>Rate</b> <b>Limiting</b>

       If auditd is not running, to avoid losing too many of the extra log messages, you  will  likely  have  to
       turn off rate limiting by doing:

               echo 0 &gt; <a href="file:/proc/sys/kernel/printk_ratelimit">/proc/sys/kernel/printk_ratelimit</a>

       But even then the kernel ring buffer may overflow and you might lose messages.

       Else, if auditd is running, see <b><a href="../man8/auditd.8.html">auditd</a></b>(8) and <b><a href="../man5/auditd.conf.5.html">auditd.conf</a></b>(5).

</pre><h4><b>FILES</b></h4><pre>
       <u><a href="file:/etc/apparmor.d/">/etc/apparmor.d/</a></u>
       <u><a href="file:/var/cache/apparmor/">/var/cache/apparmor/</a></u>
       <u>/var/log/audit/audit.log</u>
       <u>/var/log/messages</u>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/apparmor_parser.8.html">apparmor_parser</a></b>(8),     <b><a href="../man2/aa_change_hat.2.html">aa_change_hat</a></b>(2),     <b><a href="../man5/apparmor.d.5.html">apparmor.d</a></b>(5),    <b><a href="../man1/aa-autodep.1.html">aa-autodep</a></b>(1),    <b><a href="../man1/clean.1.html">clean</a></b>(1),    <b><a href="../man8/auditd.8.html">auditd</a></b>(8),
       <b><a href="../man8/aa-unconfined.8.html">aa-unconfined</a></b>(8), <b><a href="../man1/aa-enforce.1.html">aa-enforce</a></b>(1), <b><a href="../man1/aa-complain.1.html">aa-complain</a></b>(1), and &lt;https://wiki.apparmor.net&gt;.

AppArmor 5.0.0~alpha1                              2025-08-19                                        <u><a href="../man7/APPARMOR.7.html">APPARMOR</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>