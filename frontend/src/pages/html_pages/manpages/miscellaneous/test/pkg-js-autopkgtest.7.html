<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pkg-js-autopkgtest - autopkgtest runner to automatically test Node.js packages</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/pkg-js-autopkgtest">pkg-js-autopkgtest_0.15.23_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pkg-js-autopkgtest</b> - autopkgtest runner to automatically test Node.js packages

</pre><h4><b>SYNOPSIS</b></h4><pre>
        • in debian/control, insert "Testsuite: autopkgtest-pkg-nodejs"

        • write upstream test in debian/tests/pkg-js/test (will be launched by
          <b>sh</b> <b>-e</b>)

        • if some other files than "test*" and "debian/tests/test_modules/*"
          and installed files are needed, write a "debian/tests/pkg-js/files" with
          all needed directories/files

       That's all, other debian/tests files will be written on-the-fly by
       autodep8 during autopkgtest

       If you want to launch the same test during build, simply add
       <b>dh-sequence-nodejs</b> in build dependencies

</pre><h4><b>HOW</b> <b>IT</b> <b>WORKS</b></h4><pre>
        • if directory <b>debian/tests/test_modules</b> exists, <b>NODE_PATH</b> will be set
          to <b>NODE_PATH=debian/tests/test_modules:node_modules</b>

        • if additional modules were linked during build, they will be linked into
          <b>node_module</b> <u>(</u><b>debian/nodejs/extlinks</b><u>)</u>

        • if additional modules were copies during build, they will be copied into
          <b>node_module</b> <u>(</u><b>debian/nodejs/extcopies</b><u>)</u>

        • if package contains some other components, they will be linked into
          <b>node_module</b>

        • autopkgtest will launch 2 tests:

         • a "require" test <u>(see</u> <u>below)</u>

         • the test defined in debian/tests/pkg-js/test in a temporary dir (it
           links installed files)

        • if <b>dh-sequence-nodejs</b> is a build dependency, <b>dh_auto_test</b> will
          launch the same test <u>(debian/tests/pkg-js/test)</u> if exists, else just a
          <b>node</b> <b>-e</b> <b>&amp;quot;require(&amp;#39;.&amp;#39;)&amp;quot;</b>. Note that you can override test during build
          using <b>debian/nodejs/test</b>

        • if file <b>debian/tests/pkg-js/require-name</b> exists, its content will be used
          as module name in "require" test <u>(instead</u> <u>of</u> <u>using</u> <u>package.json</u> <u>value)</u>

</pre><h4><b>FULL</b> <b>EXAMPLE</b></h4><pre>
        • debian/control

         ...
         Testsuite: autopkgtest-pkg-nodejs
         Build-Depends: dh-sequence-nodejs
         ...

        • debian/tests/pkg-js/test

         mocha -R spec

</pre><h4><b>ADDITIONAL</b> <b>TEST</b> <b>PACKAGES</b> <b>OR</b> <b>TEST</b> <b>RESTRICTIONS</b></h4><pre>
       autodep8 allows one to add additional packages during autopkgtest (and/or
       additional restrictions) by using a <b>debian/tests/autopkgtest-pkg-nodejs.conf</b>
       file:
         extra_depends=mocha, npm
         extra-restrictions=needs-internet

</pre><h4><b>ENABLE</b> <b>proto</b></h4><pre>
       Since version 0.15.0, pkg-js-autopkgtest launches Node.js with
       <b>--disable-proto=throw</b>. This causes tests to fail if
       <b>Object.prototype.__proto__</b> property is used.

       If a package can use this feature without security hole (for test for example),
       it is possible to disable this nodejs option by creating an empty
       <b>debian/tests/pkg-js/enable_proto</b> file, until Debian's Node.js enables this
       feature by default.

</pre><h4><b>THE</b> <b>REQUIRE</b> <b>TEST</b></h4><pre>
   <b>How</b> <b>it</b> <b>works</b>
       First, <b>pkg-js-autopkgtest</b> searches the module name.

        • if <b>debian/tests/pkg-js/require-name</b> exists, its content will be used as
          module name

        • else if looks at <b>package.json</b> "name" field:

         • if <b>debian/nodejs/main</b> exists, like <b>dh-sequence-nodejs</b>, it uses the
           <b>package.json</b> from this directory

         • else it uses <b>./package.json</b>

       Then <b>pkg-js-autopkgtest</b> looks at package.json fields, not using the file
       mentioned above, but using the file installed by the Debian package to test
       <u>(ie</u> <b>/usr/share/nodejs/&lt;module-name&gt;/package.json</b><u>)</u>:

        • if <b>type</b> equals <b>module</b>, then:

         • it builds a <b>node_modules</b> directory with all available dependencies of
           the module

         • it builds a test.mjs file that tries to import the module to test and
           launch it

        • if <b>main</b> isn't defined and <b>index.js</b> doesn't exist, it skip the test
          <u>(this</u> <u>avoids</u> <u>to</u> <u>try</u> <u>to</u> <u>test</u> <b>@types/&lt;foo&gt;</b> <u>modules)</u>

        • else it simply launches a <b>nodejs</b> <b>-e</b> <b>&amp;quot;require(&amp;#39;$moduleName&amp;#39;)&amp;quot;</b>

       Since version 0.10.0, <b>pkg-js-autopkgtest</b> does the same test for all other
       modules installed in nodejs root directories <u>(components</u> <u>installed</u> <u>by</u>
       <u>dh-sequence-nodejs</u> <u>using</u> <b>debian/nodejs/root_modules</b> <u>file)</u>. If one fail, the
       whole test is marked as failed.

       Returned values:

        • 0 if all tests succeed <u>(even</u> <u>if</u> <u>some</u> <u>secondary</u> <u>modules</u> <u>are</u> <u>skipped)</u>

        • 77 if all tests succeed but the main module test was skipped. This value
          is used by autopkgtest to report a <b>SKIP</b> instead of a failure.

        • else, the number of failure. Then autopkgtest considers the test as <b>FAIL</b>

   <b>Customize</b> <b>require</b> <b>test</b>
       If you want to skip some secondary module tests, simply list them in
       <b>debian/tests/pkg-js/require-SKIP</b> <u>(one</u> <u>module</u> <u>per</u> <u>line)</u>.

       If you want to skip the whole "require" test, use this:
         echo require &gt; debian/tests/pkg-js/SKIP

</pre><h4><b>THE</b> <b>MAIN</b> <b>TEST</b></h4><pre>
       <b>pkg-js-autopkgtest</b> uses the same test than <b>dh-sequence-nodejs</b>: it
       launches <b>sh</b> <b>-ex</b> <b>debian/tests/pkg-js/test</b> but using the files installed by
       the Debian package.

   <b>How</b> <b>main</b> <b>test</b> <b>works</b>
       <b>pkg-js-autopkgtest</b> search for module name using the same way than "require"
       test. Then it prepares the test environment:

        • it creates a temporary directory

        • it links all files installed in the directory corresponding to module name
          <b>/usr/share/nodejs/&lt;module-name&gt;</b>

        • it creates a <b>node_modules</b> directory and links into it:

         • all modules listed in <b>debian/nodejs/extlinks</b>

         • all modules present in <b>debian/build_modules</b> and <b>debian/tests/test_modules</b>

         • all other modules installed by the Debian package in nodejs root directories
           <b>debian/nodejs/root_modules</b>

        • it copies in <b>node_modules</b> directory all modules listed in
          <b>debian/nodejs/extcopies</b>

        • if looks at <b>debian/tests/pkg-js/files</b>

         • if it exists, it copies all files/directories listed in it from source
           directory to temporary one

         • else it copies from source directory to temporary one:

          • all <b>test*</b> files

          • all <b>Makefile</b> like files <u>(rollup.config.js,</u> <u>gulpfile.js,...</u> <u>)</u>

       Then it changes its directory to the temporary one launches the test using
       <b>sh</b> <b>-ex</b> <b>debian/tests/pkg-js/test</b>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man7/pkg-js-tools.7.html">pkg-js-tools</a>(7), <a href="../man1/autodep8.1.html">autodep8</a>(1)

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       Copyright Yadd &lt;<a href="mailto:yadd@debian.org">yadd@debian.org</a>&gt;

       This library is free software; you can redistribute it and/or modify
       it under the terms of the GNU General Public License as published by
       the Free Software Foundation; either version 2, or (at your option)
       any later version.

       This program is distributed in the hope that it will be useful,
       but WITHOUT ANY WARRANTY; without even the implied warranty of
       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
       GNU General Public License for more details.

       On Debian systems, the complete text of version 2 of the GNU General
       Public License can be found in `<a href="file:/usr/share/common-licenses/GPL-2">/usr/share/common-licenses/GPL-2</a>'.
       If not, see <u>GNU</u> <u>licenses</u>;

                                                    June 2024                              <u><a href="../man7/PKG-JS-AUTOPKGTEST.7.html">PKG-JS-AUTOPKGTEST</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>