<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>raw - Linux IPv4 raw sockets</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages">manpages_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       raw - Linux IPv4 raw sockets

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/socket.h&gt;</b>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/netinet/in.h">netinet/in.h</a>&gt;</b>
       <b>raw_socket</b> <b>=</b> <b>socket(AF_INET,</b> <b>SOCK_RAW,</b> <b>int</b> <u>protocol</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Raw sockets allow new IPv4 protocols to be implemented in user space.  A raw socket receives or sends the
       raw datagram not including link level headers.

       The  IPv4  layer  generates  an  IP  header  when sending a packet unless the <b>IP_HDRINCL</b> socket option is
       enabled on the socket.  When it is enabled, the packet must contain an IP header.  For receiving, the  IP
       header is always included in the packet.

       In  order  to  create  a raw socket, a process must have the <b>CAP_NET_RAW</b> capability in the user namespace
       that governs its network namespace.

       All packets or errors matching the <u>protocol</u> number specified for  the  raw  socket  are  passed  to  this
       socket.   For  a  list  of  the  allowed  protocols,  see  the  IANA list of assigned protocol numbers at
       <a href="http://www.iana.org/assignments/protocol-numbers/">http://www.iana.org/assignments/protocol-numbers/</a> and <b><a href="../man3/getprotobyname.3.html">getprotobyname</a></b>(3).

       A protocol of <b>IPPROTO_RAW</b> implies enabled <b>IP_HDRINCL</b> and  is  able  to  send  any  IP  protocol  that  is
       specified  in the passed header.  Receiving of all IP protocols via <b>IPPROTO_RAW</b> is not possible using raw
       sockets.
              ┌────────────────────────────────────────────────────┐
              │ IP Header fields modified on sending by <b>IP_HDRINCL</b> │
              ├───────────────────────┬────────────────────────────┤
              │ IP Checksum           │ Always filled in           │
              ├───────────────────────┼────────────────────────────┤
              │ Source Address        │ Filled in when zero        │
              ├───────────────────────┼────────────────────────────┤
              │ Packet ID             │ Filled in when zero        │
              ├───────────────────────┼────────────────────────────┤
              │ Total Length          │ Always filled in           │
              └───────────────────────┴────────────────────────────┘

       If <b>IP_HDRINCL</b> is specified and the IP header has a nonzero  destination  address,  then  the  destination
       address  of  the  socket  is  used to route the packet.  When <b>MSG_DONTROUTE</b> is specified, the destination
       address should refer to a local interface, otherwise a routing table lookup is done anyway but  gatewayed
       routes are ignored.

       If  <b>IP_HDRINCL</b>  isn't set, then IP header options can be set on raw sockets with <b><a href="../man2/setsockopt.2.html">setsockopt</a></b>(2); see <b><a href="../man7/ip.7.html">ip</a></b>(7)
       for more information.

       Starting with Linux 2.2, all IP header fields and options can be set using IP socket options.  This means
       raw sockets are usually needed only for new protocols or protocols with no user interface (like ICMP).

       When a packet is received, it is passed to any raw sockets which have been bound to its  protocol  before
       it is passed to other protocol handlers (e.g., kernel protocol modules).

   <b>Address</b> <b>format</b>
       For  sending  and receiving datagrams (<b><a href="../man2/sendto.2.html">sendto</a></b>(2), <b><a href="../man2/recvfrom.2.html">recvfrom</a></b>(2), and similar), raw sockets use the standard
       <u>sockaddr_in</u> address structure defined in <b><a href="../man7/ip.7.html">ip</a></b>(7).  The <u>sin_port</u> field could  be  used  to  specify  the  IP
       protocol number, but it is ignored for sending in Linux 2.2 and later, and should be always set to 0 (see
       BUGS).  For incoming packets, <u>sin_port</u> is set to zero.

   <b>Socket</b> <b>options</b>
       Raw  socket  options can be set with <b><a href="../man2/setsockopt.2.html">setsockopt</a></b>(2) and read with <b><a href="../man2/getsockopt.2.html">getsockopt</a></b>(2) by passing the <b>IPPROTO_RAW</b>
       family flag.

       <b>ICMP_FILTER</b>
              Enable a special filter for raw sockets bound to the <b>IPPROTO_ICMP</b> protocol.  The value has  a  bit
              set  for  each  ICMP  message type which should be filtered out.  The default is to filter no ICMP
              messages.

       In addition, all <b><a href="../man7/ip.7.html">ip</a></b>(7) <b>IPPROTO_IP</b> socket options valid for datagram sockets are supported.

   <b>Error</b> <b>handling</b>
       Errors originating from the network are passed to the user only when  the  socket  is  connected  or  the
       <b>IP_RECVERR</b>   flag  is  enabled.   For  connected  sockets,  only  <b>EMSGSIZE</b>  and  <b>EPROTO</b>  are  passed  for
       compatibility.  With <b>IP_RECVERR</b>, all network errors are saved in the error queue.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EACCES</b> User tried to send to a broadcast address without having the broadcast flag set on the socket.

       <b>EFAULT</b> An invalid memory address was supplied.

       <b>EINVAL</b> Invalid argument.

       <b>EMSGSIZE</b>
              Packet too big.  Either Path MTU Discovery is enabled (the <b>IP_MTU_DISCOVER</b>  socket  flag)  or  the
              packet size exceeds the maximum allowed IPv4 packet size of 64 kB.

       <b>EOPNOTSUPP</b>
              Invalid flag has been passed to a socket call (like <b>MSG_OOB</b>).

       <b>EPERM</b>  The user doesn't have permission to open raw sockets.  Only processes with an effective user ID of
              0 or the <b>CAP_NET_RAW</b> attribute may do that.

       <b>EPROTO</b> An ICMP error has arrived reporting a parameter problem.

</pre><h4><b>VERSIONS</b></h4><pre>
       <b>IP_RECVERR</b>  and  <b>ICMP_FILTER</b>  are  new in Linux 2.2.  They are Linux extensions and should not be used in
       portable programs.

       Linux 2.0 enabled some bug-to-bug compatibility with BSD in the raw socket  code  when  the  <b>SO_BSDCOMPAT</b>
       socket option was set; since Linux 2.2, this option no longer has that effect.

</pre><h4><b>NOTES</b></h4><pre>
       By  default,  raw  sockets do path MTU (Maximum Transmission Unit) discovery.  This means the kernel will
       keep track of the MTU to a specific target IP address and return <b>EMSGSIZE</b> when a raw packet write exceeds
       it.  When this happens, the application should decrease the packet size.  Path MTU discovery can be  also
       turned  off  using  the <b>IP_MTU_DISCOVER</b> socket option or the <u><a href="file:/proc/sys/net/ipv4/ip_no_pmtu_disc">/proc/sys/net/ipv4/ip_no_pmtu_disc</a></u> file, see
       <b><a href="../man7/ip.7.html">ip</a></b>(7) for details.  When turned off, raw sockets will fragment outgoing packets that exceed the interface
       MTU.  However, disabling it is not recommended for performance and reliability reasons.

       A raw socket can be bound to a specific local address using the <b><a href="../man2/bind.2.html">bind</a></b>(2) call.  If  it  isn't  bound,  all
       packets  with  the  specified  IP  protocol  are  received.   In addition, a raw socket can be bound to a
       specific network device using <b>SO_BINDTODEVICE</b>; see <b><a href="../man7/socket.7.html">socket</a></b>(7).

       An <b>IPPROTO_RAW</b> socket is send only.  If you really want to receive all IP packets, use a <b><a href="../man7/packet.7.html">packet</a></b>(7) socket
       with the <b>ETH_P_IP</b> protocol.  Note that packet sockets don't reassemble IP fragments, unlike raw sockets.

       If you want to receive all ICMP packets for a datagram socket, it is often better to  use  <b>IP_RECVERR</b>  on
       that particular socket; see <b><a href="../man7/ip.7.html">ip</a></b>(7).

       Raw  sockets  may  tap  all  IP protocols in Linux, even protocols like ICMP or TCP which have a protocol
       module in the kernel.  In this case, the packets are passed  to  both  the  kernel  module  and  the  raw
       socket(s).   This  should  not  be relied upon in portable programs, many other BSD socket implementation
       have limitations here.

       Linux never changes headers passed from the user (except for filling in some zeroed fields  as  described
       for <b>IP_HDRINCL</b>).  This differs from many other implementations of raw sockets.

       Raw sockets are generally rather unportable and should be avoided in programs intended to be portable.

       Sending  on  raw  sockets  should take the IP protocol from <u>sin_port</u>; this ability was lost in Linux 2.2.
       The workaround is to use <b>IP_HDRINCL</b>.

</pre><h4><b>BUGS</b></h4><pre>
       Transparent proxy extensions are not described.

       When the <b>IP_HDRINCL</b> option is set, datagrams will not be fragmented and are limited to the interface MTU.

       Setting the IP protocol for sending in <u>sin_port</u> got lost in Linux 2.2.  The protocol that the socket  was
       bound to or that was specified in the initial <b><a href="../man2/socket.2.html">socket</a></b>(2) call is always used.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/recvmsg.2.html">recvmsg</a></b>(2), <b><a href="../man2/sendmsg.2.html">sendmsg</a></b>(2), <b><a href="../man7/capabilities.7.html">capabilities</a></b>(7), <b><a href="../man7/ip.7.html">ip</a></b>(7), <b><a href="../man7/socket.7.html">socket</a></b>(7)

       <b>RFC</b> <b>1191</b> for path MTU discovery.  <b>RFC</b> <b>791</b> and the <u>&lt;linux/ip.h&gt;</u> header file for the IP protocol.

Linux man-pages 6.9.1                              2024-05-02                                             <u><a href="../man7/raw.7.html">raw</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>