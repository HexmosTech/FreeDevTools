<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>secure-logging - Forward integrity and confidentiality for system logs</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/syslog-ng-mod-slog">syslog-ng-mod-slog_4.8.1-5_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       secure-logging - Forward integrity and confidentiality for system logs

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>$(slog</b> <b>--key-file</b>  <b>&lt;host</b> <b>key</b> <b>file&gt;</b> <b>--mac-file</b> <b>&lt;MAC</b> <b>file&gt;</b> <b>$RAWMSG)</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Secure logging is an extension to <b>syslog-ng</b> providing forward integrity and confidentiality of system
       logs. It is implemented in form of a module and is configured as a template in the <b>syslog-ng</b>
       configuration file.

       The main objective of the secure logging module is to provide tamper evident logging, i.e. to adequately
       protect log records of an information system and to provide a sensor indicating attack attempts. The
       secure logging module achieves this by authentically encrypting each log record with an individual
       cryptographic key used only once and protecting the integrity of the whole log archive by a cryptographic
       authentication code. Each attempt to tamper with either an individual log record or the log archive
       itself will be immediately detected during log archive verification. Therefore, an attacker can no longer
       tamper with log records without being detected.

       In order to use the log file created by the secure logging module for analysis, the log file must first
       be decrypted and its integrity verified. This is achieved with a command line utility that is part of the
       secure logging module and is installed as part of the <b>syslog-ng</b> package. This utility can easily be
       integrated into the import module of existing analysis environments.

       The secure logging environment uses a cryptographic key for encrypting log entries. Each individual log
       entry is encrypted with its own key which is immediately discarded after successful encryption in order
       to provide forward integrity. An efficient algorithm generates the key for the next log entry based the
       key used for encrypting the previous log entry. The resulting chain of keys preserves forward integrity,
       i.e. a potential attacker cannot deduce the previous key from the current key.

       In order to ease log verification and analysis, a sequence number is added to each log entry. This
       sequence number is also added to the encryption key creating a one-to-one correspondence of the
       encryption key with the log entry. In order to prevent truncation attacks or deletion of individual log
       entries, a message authentication code (MAC) is iteratively applied to the complete log archive and
       stored in a separate file. It is used upon verification to check the integrity of the whole log archive.

       Here is an example of three short original log messages that will be sent to a destination with secure
       logging enabled:

           This is a log message
           And here comes another log message
           This is a log message with a longer text that is processed without any problems

       In order to inspect the status of the secure logging environment, one can check the sequence counter by
       querying the key file with the <b>slogkey</b> utility like this:

           user@host:~&gt; slogkey --counter /etc/syslog-ng/host.key
           counter=3

       Counting starts at zero. This is why the counter is set to three after processing three messages.

       The output of the secure logging template for the three example messages is shown below. One clearly sees
       the sequence number that was prepended to each message. The colon indicates the end of the sequence
       number and the start of the original message. As three message were processed, the sequence counter of
       the key will be three.

           AAAAAAAAAAA=:k3/dYpLsgO2tUJKSauo6dycIBzW6OTC3pyA9TP+7AnqFgEojBzgC2rcK4OPfRtr8yg==
           AQAAAAAAAAA=:smw0ATISVgN+BYEu5d7OLBE7aQhHpK9Ro4MndmNgSVrqhcmRCBCj6DUnD6ku0Z29CKJ0N6LAJUgByX4Ev+g=
           AgAAAAAAAAA=:5UVybnKL1EAbgC4CLfd8HpgurjREf4LEN61/yWHSD2hbXjRD4QmQdtbwguT1chzdItKSQASps9QRIvR5Jd4AHzHfqxI4aRgdUBcNbAq26nwUCg5vPWygjmbtQaxZgCJYkry8slxCigmbTVs=

       The output of a successful verification run is shown below.

           0000000000000000: This is a log message
           0000000000000001: And here comes another log message
           0000000000000002: This is a log message with a longer text that is processed without any problems

       The original log messages have been successfully restored. Additionally, the sequence counter is also
       prepended to the clear text messages. This helps when in analyzing problems with a particular log entry.
       As real log files will contain thousands of entries. the sequence counter eases identification of
       erroneous entries.

       Before the secure logging module can be used as part of an existing <b>syslog-ng</b> installation, several
       preparatory activities need to be performed.

</pre><h4><b>KEY</b> <b>GENERATION</b></h4><pre>
       In order to bootstrap the system, an initial key k0 must be created and installed on the log host before
       secure logging environment is started for the first time.

       The newly created host key k0 has its counter set to 0 indicating that it represents the initial host key
       k0. This host key k0 must be kept secret and not be disclosed to third parties. It will be required to
       successfully decrypt and verify log archives processed by the secure logging environment. As each log
       entry will be encrypted with its own key, a new host key will be created after successful processing of a
       log entry and will replace the previous key. Therefore, the initial host key needs to be stored in a safe
       place before starting the secure logging environment, as it will be deleted from the log host after
       processing of the first log entry. The following steps must be done before starting the secure logging
       environment. Steps 1 and 2 are performed with the <b>slogkey</b> utility. See <b><a href="../man1/slogkey.1.html">slogkey</a></b>(1) for details on how to
       generate a master key and to derive a host key from it. Step 3 and 4 depend on the actual deployment in a
       target environment.

        1. Create a master key

        2. Derive an initial host key k0 from a previously created master key

        3. Store the initial host key k0 in a safe location outside of the log host

        4. Deploy the key k0 on the log host where the secure logging module will be used

</pre><h4><b>CONFIGURATION</b></h4><pre>
       Secure logging is configured by adding the corresponding statements to the syslog-ng.conf file. See
       <b><a href="../man5/syslog-ng.conf.5.html">syslog-ng.conf</a></b>(5) for information on how to configure <b>syslog-ng</b> using the configuration file. Details can
       be found in the <b>The</b> <b>syslog-ng</b> <b>Administrator</b> <b>Guide</b>[1].

       Secure logging is implemented as a template and is configured accordingly. Apart from the actual template
       configuration, no other settings are required in order to activate secure logging. The secure logging is
       activated by placing the following statement in the configuration file

       <b>template("$(slog</b> <b>--key-file</b> <b>&lt;host</b> <b>key</b> <b>file&gt;</b> <b>--mac-file</b> <b>&lt;MAC</b> <b>file&gt;</b> <b>$RAWMSG)\n");</b>

       where

       <b>slog</b>
           The name of the secure logging template function. This name can be also be found by calling <b>syslog-ng</b>
           with the <b>--module-registry</b> arguments and checking the <b>template-func</b> property of the secure logging
           module in the corresponding output.

       <b>--key-file</b> or <b>-k</b>
           The host key. &lt;host key file&gt; is the full path of the file storing the host key on the log host. If
           this arguments is not supplied or does not point to a valid regular key file, <b>syslog-ng</b> will not
           start and a display a corresponding error message.

       <b>--mac-file</b> or <b>-m</b>
           The MAC file. &lt;MAC file&gt; is the full path of the MAC file on the log host. The file does not need to
           exist, as it will be automatically created upon the initial start. If the path is not correct,
           <b>syslog-ng</b> will not start and a display a corresponding error message.

       <b>$RAWMSG</b>
           $RAWMSG provides access to the original log message received at the source. This macro is only
           available if the <b>store-raw-message</b> flag was set for the source. Otherwise, an empty string will be
           passed to the secure logging template. If access to the original message is not available, e.g. if
           the source does not support the <b>store-raw-message</b> flag, then the $MSG macro can also be used. In this
           case, however, the integrity guarantee provided by secure logging is limited to the content that this
           macro provides and does not protect the complete original message.

       <b>\n</b>
           \n is the line separator. This is important, as the secure logging template expects log entries to be
           separated by a line separator. When detecting a line separator, the log entry is regarded as complete
           and is encrypted with the current host key. Therefore, only a single line separator is allowed.

       The secure logging template can be combined with any source or destination within the following
       limitations:

       •   Sources must be line-oriented. Secure logging uses a line separator in order to distinguish between
           individual log entries. Sources which provide data in a different format, e.g. in the form of raw
           data obtained directly from a database system, cannot currently be used with the secure logging
           template, as the separation of log entries is not clearly defined for this type of data.

       •   Only sources for which the <b>store-raw-message</b> flag is implemented and set do benefit from the
           integrity guarantee provided by the secure logging template. Secure logging aims at protecting the
           integrity of complete log messages including all associated meta-data, such as timestamps and host
           names.  <b>syslog-ng</b> parses the log message into its internal format and provide easy access to parts of
           a message through macros. While this is convenient when rewriting log messages, it is not helpful for
           secure logging.  <b>syslog-ng</b> provides the <b>store-raw-message</b> flag which provides access to a copy of the
           original log message after parsing. This is the log message processed and protected by the secure
           logging template. If the source does not support the <b>store-raw-message</b> flag, then the $MSG macro can
           also be used. However, in this case the integrity guarantee provided by secure logging is limited to
           the content that this macro provides.

       •   Log rotation of any kind cannot be used with destinations using secure logging. The reason is that
           log rotate will overwrite, i.e. delete previous log files. This destroys the cryptographic chain of
           trust of the log entries making recovery impossible. In order to allow for a an efficient handling of
           log files, the secure logging environment features iterative verification. Using iterative
           verification, a log file can be verified in steps. For this to work, the log file must first be
           downloaded from the log host, together with the corresponding host key and MAC file to a verification
           host. After this download the log file can be safely deleted from the log host. Verification is then
           performed on the verification host using the iterative mode of the <b>slogverify</b> utility. See
           <b><a href="../man1/slogverify.1.html">slogverify</a></b>(1) for details.

       The following example configuration shows the use of the secure logging template on a file destination.

           #############################################################################
           # Minimal syslog-ng.conf file with secure logging enabled. Encrypted log
           # entries will be logged to a single file called /var/log/messages.slog
           #

           @version: 4.8
           @include "scl.conf"

           source s_local {
               system();
               internal();
           };

           source s_network {
               network(
                   transport("udp")
                   <a href="../man514/port.514.html">port</a>(514)
                   flags(store-raw-message)
               );
           };

           # Secure logging template definition
           template secure_logging {
               template("$(slog --key-file /etc/syslog-ng/host.key --mac-file /etc/syslog-ng/mac.dat $RAWMSG)\n");
           };

           # This configures a secure logging destination
           destination d_local {
                file("/var/log/messages.slog" template(secure_logging));
           };

           log {
               source(s_local);

               # This source has the raw message flag set
               source(s_network);

               # This statement activates secure logging for this destination
               destination(d_local);
           };

</pre><h4><b>LOG</b> <b>VERIFICATION</b></h4><pre>
       In order to analyze the log file created in a secure logging environment, the log files must be decrypted
       and their integrity be verified. Verification requires both the initial host key k0 and the corresponding
       MAC file and is performed with the <b>slogverify</b> utility. It is not normally performed on the log host where
       the secure logging environment is producing log data. In a typical deployment, log files would be
       retrieved from the log host and transferred to a central log collector where verification it performed.
       As verification requires the use of the initial host key k0, it should only be performed in a trusted
       environment.

   <b>Normal</b> <b>mode</b>
       In normal mode, a complete log archive is verified at once. In a typical environment, this would mean
       retrieving a log file together with is MAC file from a log host and retrieving the corresponding initial
       key k0 form a safe location and supplying them to the <b>slogverify</b> utility. A typical call sequence for
       verification in normal mode would look like this

       <b>slogverify</b> <b>--key-file</b> <b>host0.key</b> <b>--mac-file</b> <b>mac.dat</b> <b>/var/log/messages.slog</b> <b>/var/log/verified/messages</b>

       with

       <b>host0.key</b>
           The initial host key k0. Supplying the initial key k0 is enough for decrypting all log entries, as
           the key derivation algorithm is able to generate the necessary keys for all subsequent log entries
           based on the initial key k0.

       <b>mac.dat</b>
           The MAC file from the log host.

       <b>/var/log/messages.slog</b>
           The file containing the encrypted log entries as retrieved from a log host.

       <b>/var/log/verified/messages</b>
           The file receiving the plain text log after decryption.

       Log files may become large and not fit into system memory. Verification is therefore performed in chunks.
       Each part of the log file is transferred to an internal buffer on which verification is performed. After
       the buffer has been processed, the next chunk is fetched. An optional buffer argument can be supplied to
       the <b>slogverify</b> utility in order to change the default buffer size of 1000 log entries to a number
       suitable for the system on which the verification is performed, for example

       <b>slogverify</b> <b>--key-file</b> <b>host.key</b> <b>--mac-file</b> <b>mac.dat</b> <b>/var/log/messages.slog</b> <b>/var/log/verified/messages</b> <b>8000</b>

       See <b><a href="../man1/slogverify.1.html">slogverify</a></b>(1) for details on verification in normal mode.

   <b>Iterative</b> <b>mode</b>
       Verification in normal mode may not be suitable for some application scenarios. Many log hosts use log
       rotation in order to preserve storage space. In log rotation, a threshold for the maximum amount of
       storage space and the number of generations is defined for different type of log files. When either
       storage space is exhausted or the number of generations is reached, the oldest log file will be
       overwritten by new incoming log data. This procedure is not possible in secure logging environment, as
       overwriting, i.e. deleting a log file would break the cryptographic chain that is established between the
       log entries. This comes as no surprise, as one of the main objectives of secure logging is to protect
       against deletion of log entries by a potential attacker.

       In order allow for a procedure similar to log rotation, the secure logging environment features an
       iterative mode. In iterative mode, log files can be split into different files and each of these files
       can be verified separately. Care must be taken when performing verification in iterative mode, as each of
       the different log files needs to be accompanied by a copy of the host key and the MAC files present on
       the system at the time of retrieval. A typical usage scenario for the iterative mode would look like
       this:

        1. Define a storage threshold for the secure logging file destination. In this example we assume 500MB.

        2. Let the secure logging environment produce log data that is written to the destination until 500MB
           are reached.

        3. Stop the secure logging environment and retrieve the log file, the host key and the MAC files from
           the log host.

        4. Delete the log file on the log host but leave host key and MAC file untouched.

        5. Restart the secure logging environment.

        6. Perform verification in iterative mode with the log file, the host key and the MAC just retrieved.

       Steps 2-6 have to repeated each time the log file reaches a size of 50 MB. Assuming that the log file
       parts will be named after the iteration, e.g. log.1, log.2, log.3, etc. and a similar convention is
       applied to the host keys and MAC files, a typical call sequence for the validation of a log file part in
       iterative mode after three iterations will look like this:

       <b>slogverify</b> <b>--iterative</b> <b>--prev-key-file</b> <b>host.key.2</b> <b>--prev-mac-file</b> <b>mac.dat.2</b> <b>--mac-file</b> <b>mac.dat</b>
       <b>/var/log/messages.slog.3</b> <b>/var/log/verified/messages.3</b>

       with

       <b>host.key.2</b>
           The host key from the previous iteration. In this example, this is the second iteration.

       <b>mac.dat.2</b>
           The MAC file from the previous iteration. In the example, verification is performed during the third
           iteration, so the MAC file from the second iteration is required.

       <b>mac.dat</b>
           The current MAC file from the log host.

       <b>/var/log/messages.slog.3</b>
           The file part containing the encrypted log entries as retrieved from the log host during the third
           iteration.

       <b>/var/log/verified/messages.3</b>
           The file receiving the plain text log after decryption during the third iteration.

       In a real deployment, the above steps would typically be automated using a scripting engine.

       See <b><a href="../man1/slogverify.1.html">slogverify</a></b>(1) for details on verification in iterative mode.

</pre><h4><b>FILES</b></h4><pre>
       /usr/bin/slogkey

       /usr/bin/slogencrypt

       /usr/bin/slogverify

       /etc/syslog-ng.conf

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/syslog-ng.conf.5.html">syslog-ng.conf</a></b>(5)

       <b><a href="../man1/slogkey.1.html">slogkey</a></b>(1)

       <b><a href="../man1/slogencrypt.1.html">slogencrypt</a></b>(1)

       <b><a href="../man1/slogverify.1.html">slogverify</a></b>(1)

           <b>Note</b>

           For the detailed documentation of see <b>The</b> <b>syslog-ng</b> <b>Administrator</b> <b>Guide</b>[1]

           If you experience any problems or need help with syslog-ng, visit the <b>syslog-ng</b> <b>mailing</b> <b>list</b>[2].

           For news and notifications about of syslog-ng, visit the <b>syslog-ng</b> <b>blogs</b>[3].

           For specific information requests related to secure logging send a mail to the Airbus Secure Logging
           Team &lt;<a href="mailto:secure-logging@airbus.com">secure-logging@airbus.com</a>&gt;.

</pre><h4><b>AUTHOR</b></h4><pre>
       This manual page was written by the Airbus Secure Logging Team &lt;<a href="mailto:secure-logging@airbus.com">secure-logging@airbus.com</a>&gt;.

</pre><h4><b>COPYRIGHT</b></h4><pre>
</pre><h4><b>NOTES</b></h4><pre>
        1. <b>The</b> <b>syslog-ng</b> <b>Administrator</b> <b>Guide</b>
           https://www.balabit.com/documents/syslog-ng-ose-latest-guides/en/syslog-ng-ose-guide-admin/html/index.html

        2. <b>syslog-ng</b> <b>mailing</b> <b>list</b>
           https://lists.balabit.hu/mailman/listinfo/syslog-ng

        3. <b>syslog-ng</b> <b>blogs</b>
           https://syslog-ng.org/blogs/

4.8                                                05/10/2025                                  <u><a href="../man7/SECURE-LOGGING.7.html">SECURE-LOGGING</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>