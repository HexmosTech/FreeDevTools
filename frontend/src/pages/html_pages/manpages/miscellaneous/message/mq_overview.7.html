<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mq_overview - overview of POSIX message queues</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages">manpages_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mq_overview - overview of POSIX message queues

</pre><h4><b>DESCRIPTION</b></h4><pre>
       POSIX message queues allow processes to exchange data in the form of messages.  This API is distinct from
       that  provided  by  System V message queues (<b><a href="../man2/msgget.2.html">msgget</a></b>(2), <b><a href="../man2/msgsnd.2.html">msgsnd</a></b>(2), <b><a href="../man2/msgrcv.2.html">msgrcv</a></b>(2), etc.), but provides similar
       functionality.

       Message queues are created and opened using <b><a href="../man3/mq_open.3.html">mq_open</a></b>(3); this function returns a <u>message</u> <u>queue</u>  <u>descriptor</u>
       (<u>mqd_t</u>),  which  is  used  to  refer  to  the  open  message queue in later calls.  Each message queue is
       identified by a name of the form <u>/somename</u>; that is, a null-terminated string of up  to  <b>NAME_MAX</b>  (i.e.,
       255)  characters  consisting  of  an initial slash, followed by one or more characters, none of which are
       slashes.  Two processes can operate on the same queue by passing the same name to <b><a href="../man3/mq_open.3.html">mq_open</a></b>(3).

       Messages are transferred to and from a queue using <b><a href="../man3/mq_send.3.html">mq_send</a></b>(3) and  <b><a href="../man3/mq_receive.3.html">mq_receive</a></b>(3).   When  a  process  has
       finished  using  the  queue, it closes it using <b><a href="../man3/mq_close.3.html">mq_close</a></b>(3), and when the queue is no longer required, it
       can be deleted using <b><a href="../man3/mq_unlink.3.html">mq_unlink</a></b>(3).  Queue attributes can be retrieved and (in some cases) modified  using
       <b><a href="../man3/mq_getattr.3.html">mq_getattr</a></b>(3)  and  <b><a href="../man3/mq_setattr.3.html">mq_setattr</a></b>(3).   A  process can request asynchronous notification of the arrival of a
       message on a previously empty queue using <b><a href="../man3/mq_notify.3.html">mq_notify</a></b>(3).

       A message queue descriptor is a reference to an <u>open</u> <u>message</u> <u>queue</u> <u>description</u> (see  <b><a href="../man2/open.2.html">open</a></b>(2)).   After  a
       <b><a href="../man2/fork.2.html">fork</a></b>(2),  a  child inherits copies of its parent's message queue descriptors, and these descriptors refer
       to the same open message queue descriptions as the corresponding message queue descriptors in the parent.
       Corresponding message queue descriptors in  the  two  processes  share  the  flags  (<u>mq_flags</u>)  that  are
       associated with the open message queue description.

       Each  message  has  an  associated  <u>priority</u>,  and messages are always delivered to the receiving process
       highest priority first.  Message priorities range from 0 (low)  to  <u>sysconf(_SC_MQ_PRIO_MAX)</u> <u>-</u> <u>1</u>  (high).
       On  Linux,  <u>sysconf(_SC_MQ_PRIO_MAX)</u>  returns  32768,  but  POSIX.1  requires only that an implementation
       support at least priorities in the range 0 to 31; some implementations provide only this range.

       The remainder of this section describes some specific  details  of  the  Linux  implementation  of  POSIX
       message queues.

   <b>Library</b> <b>interfaces</b> <b>and</b> <b>system</b> <b>calls</b>
       In  most  cases  the  <b>mq_*</b>()  library interfaces listed above are implemented on top of underlying system
       calls of the same name.  Deviations from this scheme are indicated in the following table:
              <b>Library</b> <b>interface</b>    <b>System</b> <b>call</b>
              <a href="../man3/mq_close.3.html">mq_close</a>(3)          <a href="../man2/close.2.html">close</a>(2)
              <a href="../man3/mq_getattr.3.html">mq_getattr</a>(3)        <a href="../man2/mq_getsetattr.2.html">mq_getsetattr</a>(2)
              <a href="../man3/mq_notify.3.html">mq_notify</a>(3)         <a href="../man2/mq_notify.2.html">mq_notify</a>(2)
              <a href="../man3/mq_open.3.html">mq_open</a>(3)           <a href="../man2/mq_open.2.html">mq_open</a>(2)
              <a href="../man3/mq_receive.3.html">mq_receive</a>(3)        <a href="../man2/mq_timedreceive.2.html">mq_timedreceive</a>(2)
              <a href="../man3/mq_send.3.html">mq_send</a>(3)           <a href="../man2/mq_timedsend.2.html">mq_timedsend</a>(2)
              <a href="../man3/mq_setattr.3.html">mq_setattr</a>(3)        <a href="../man2/mq_getsetattr.2.html">mq_getsetattr</a>(2)
              <a href="../man3/mq_timedreceive.3.html">mq_timedreceive</a>(3)   <a href="../man2/mq_timedreceive.2.html">mq_timedreceive</a>(2)
              <a href="../man3/mq_timedsend.3.html">mq_timedsend</a>(3)      <a href="../man2/mq_timedsend.2.html">mq_timedsend</a>(2)
              <a href="../man3/mq_unlink.3.html">mq_unlink</a>(3)         <a href="../man2/mq_unlink.2.html">mq_unlink</a>(2)

   <b>Versions</b>
       POSIX message queues have been supported since Linux 2.6.6.  glibc support has been provided since  glibc
       2.3.4.

   <b>Kernel</b> <b>configuration</b>
       Support for POSIX message queues is configurable via the <b>CONFIG_POSIX_MQUEUE</b> kernel configuration option.
       This option is enabled by default.

   <b>Persistence</b>
       POSIX  message queues have kernel persistence: if not removed by <b><a href="../man3/mq_unlink.3.html">mq_unlink</a></b>(3), a message queue will exist
       until the system is shut down.

   <b>Linking</b>
       Programs using the POSIX message queue API must be compiled with <u>cc</u> <u>-lrt</u> to link  against  the  real-time
       library, <u>librt</u>.

   <b><a href="file:/proc">/proc</a></b> <b>interfaces</b>
       The  following  interfaces  can  be  used  to limit the amount of kernel memory consumed by POSIX message
       queues and to set the default attributes for new message queues:

       <u><a href="file:/proc/sys/fs/mqueue/msg_default">/proc/sys/fs/mqueue/msg_default</a></u> (since Linux 3.5)
              This file defines the value used for a new queue's <u>mq_maxmsg</u> setting when  the  queue  is  created
              with a call to <b><a href="../man3/mq_open.3.html">mq_open</a></b>(3) where <u>attr</u> is specified as NULL.  The default value for this file is 10.
              The  minimum  and maximum are as for <u><a href="file:/proc/sys/fs/mqueue/msg_max">/proc/sys/fs/mqueue/msg_max</a></u>.  A new queue's default <u>mq_maxmsg</u>
              value will be the smaller of <u>msg_default</u> and <u>msg_max</u>.  Before Linux 2.6.28, the default  <u>mq_maxmsg</u>
              was 10; from Linux 2.6.28 to Linux 3.4, the default was the value defined for the <u>msg_max</u> limit.

       <u><a href="file:/proc/sys/fs/mqueue/msg_max">/proc/sys/fs/mqueue/msg_max</a></u>
              This file can be used to view and change the ceiling value for the maximum number of messages in a
              queue.   This  value  acts  as a ceiling on the <u>attr-&gt;mq_maxmsg</u> argument given to <b><a href="../man3/mq_open.3.html">mq_open</a></b>(3).  The
              default value for <u>msg_max</u> is 10.  The minimum value is 1 (10  before  Linux  2.6.28).   The  upper
              limit  is  <b>HARD_MSGMAX</b>.  The <u>msg_max</u> limit is ignored for privileged processes (<b>CAP_SYS_RESOURCE</b>),
              but the <b>HARD_MSGMAX</b> ceiling is nevertheless imposed.

              The definition of <b>HARD_MSGMAX</b> has changed across kernel versions:

              •  Up to Linux 2.6.32: <u>131072</u> <u>/</u> <u>sizeof(void</u> <u>*)</u>

              •  Linux 2.6.33 to Linux 3.4: <u>(32768</u> <u>*</u> <u>sizeof(void</u> <u>*)</u> <u>/</u> <u>4)</u>

              •  Since Linux 3.5: 65,536

       <u><a href="file:/proc/sys/fs/mqueue/msgsize_default">/proc/sys/fs/mqueue/msgsize_default</a></u> (since Linux 3.5)
              This file defines the value used for a new queue's <u>mq_msgsize</u> setting when the  queue  is  created
              with  a  call  to  <b><a href="../man3/mq_open.3.html">mq_open</a></b>(3) where <u>attr</u> is specified as NULL.  The default value for this file is
              8192  (bytes).   The  minimum  and  maximum  are  as  for   <u><a href="file:/proc/sys/fs/mqueue/msgsize_max">/proc/sys/fs/mqueue/msgsize_max</a></u>.    If
              <u>msgsize_default</u>  exceeds  <u>msgsize_max</u>,  a  new  queue's  default <u>mq_msgsize</u> value is capped to the
              <u>msgsize_max</u> limit.  Before Linux 2.6.28, the default <u>mq_msgsize</u> was 8192;  from  Linux  2.6.28  to
              Linux 3.4, the default was the value defined for the <u>msgsize_max</u> limit.

       <u><a href="file:/proc/sys/fs/mqueue/msgsize_max">/proc/sys/fs/mqueue/msgsize_max</a></u>
              This file can be used to view and change the ceiling on the maximum message size.  This value acts
              as  a  ceiling  on  the  <u>attr-&gt;mq_msgsize</u>  argument  given  to  <b><a href="../man3/mq_open.3.html">mq_open</a></b>(3).  The default value for
              <u>msgsize_max</u> is 8192 bytes.  The minimum value is 128 (8192 before Linux 2.6.28).  The upper  limit
              for <u>msgsize_max</u> has varied across kernel versions:

              •  Before Linux 2.6.28, the upper limit is <b>INT_MAX</b>.

              •  From Linux 2.6.28 to Linux 3.4, the limit is 1,048,576.

              •  Since Linux 3.5, the limit is 16,777,216 (<b>HARD_MSGSIZEMAX</b>).

              The  <u>msgsize_max</u> limit is ignored for privileged process (<b>CAP_SYS_RESOURCE</b>), but, since Linux 3.5,
              the <b>HARD_MSGSIZEMAX</b> ceiling is enforced for privileged processes.

       <u><a href="file:/proc/sys/fs/mqueue/queues_max">/proc/sys/fs/mqueue/queues_max</a></u>
              This file can be used to view and change the system-wide limit on the  number  of  message  queues
              that  can  be  created.   The  default  value for <u>queues_max</u> is 256.  No ceiling is imposed on the
              <u>queues_max</u> limit; privileged processes (<b>CAP_SYS_RESOURCE</b>) can exceed the limit (but see BUGS).

   <b>Resource</b> <b>limit</b>
       The <b>RLIMIT_MSGQUEUE</b> resource limit, which places a limit on the amount of space that can be  consumed  by
       all of the message queues belonging to a process's real user ID, is described in <b><a href="../man2/getrlimit.2.html">getrlimit</a></b>(2).

   <b>Mounting</b> <b>the</b> <b>message</b> <b>queue</b> <b>filesystem</b>
       On  Linux,  message  queues are created in a virtual filesystem.  (Other implementations may also provide
       such a feature, but the details are likely to differ.)  This filesystem can be mounted (by the superuser)
       using the following commands:

           # <b>mkdir</b> <b><a href="file:/dev/mqueue">/dev/mqueue</a></b>
           # <b>mount</b> <b>-t</b> <b>mqueue</b> <b>none</b> <b><a href="file:/dev/mqueue">/dev/mqueue</a></b>

       The sticky bit is automatically enabled on the mount directory.

       After the filesystem has been mounted, the message queues on the system can  be  viewed  and  manipulated
       using the commands usually used for files (e.g., <b><a href="../man1/ls.1.html">ls</a></b>(1) and <b><a href="../man1/rm.1.html">rm</a></b>(1)).

       The  contents  of  each  file  in the directory consist of a single line containing information about the
       queue:

           $ <b>cat</b> <b>/dev/mqueue/mymq</b>
           QSIZE:129     NOTIFY:2    SIGNO:0    NOTIFY_PID:8260

       These fields are as follows:

       <b>QSIZE</b>  Number of bytes of data in all messages in the queue (but see BUGS).

       <b>NOTIFY_PID</b>
              If this is nonzero, then the  process  with  this  PID  has  used  <b><a href="../man3/mq_notify.3.html">mq_notify</a></b>(3)  to  register  for
              asynchronous message notification, and the remaining fields describe how notification occurs.

       <b>NOTIFY</b> Notification method: 0 is <b>SIGEV_SIGNAL</b>; 1 is <b>SIGEV_NONE</b>; and 2 is <b>SIGEV_THREAD</b>.

       <b>SIGNO</b>  Signal number to be used for <b>SIGEV_SIGNAL</b>.

   <b>Linux</b> <b>implementation</b> <b>of</b> <b>message</b> <b>queue</b> <b>descriptors</b>
       On  Linux,  a  message  queue  descriptor is actually a file descriptor.  (POSIX does not require such an
       implementation.)  This means that a message queue descriptor can be monitored using  <b><a href="../man2/select.2.html">select</a></b>(2),  <b><a href="../man2/poll.2.html">poll</a></b>(2),
       or <b><a href="../man7/epoll.7.html">epoll</a></b>(7).  This is not portable.

       The close-on-exec flag (see <b><a href="../man2/open.2.html">open</a></b>(2)) is automatically set on the file descriptor returned by <b><a href="../man2/mq_open.2.html">mq_open</a></b>(2).

   <b>IPC</b> <b>namespaces</b>
       For   a  discussion  of  the  interaction  of  POSIX  message  queue  objects  and  IPC  namespaces,  see
       <b><a href="../man7/ipc_namespaces.7.html">ipc_namespaces</a></b>(7).

</pre><h4><b>NOTES</b></h4><pre>
       System V message queues (<b><a href="../man2/msgget.2.html">msgget</a></b>(2), <b><a href="../man2/msgsnd.2.html">msgsnd</a></b>(2), <b><a href="../man2/msgrcv.2.html">msgrcv</a></b>(2), etc.) are an older API for exchanging  messages
       between  processes.   POSIX  message  queues  provide  a  better designed interface than System V message
       queues; on the other hand POSIX message queues are less widely available (especially  on  older  systems)
       than System V message queues.

       Linux  does not currently (Linux 2.6.26) support the use of access control lists (ACLs) for POSIX message
       queues.

</pre><h4><b>BUGS</b></h4><pre>
       Since Linux 3.5 to Linux 3.14, the kernel imposed a ceiling of 1024  (<b>HARD_QUEUESMAX</b>)  on  the  value  to
       which  the  <u>queues_max</u> limit could be raised, and the ceiling was enforced even for privileged processes.
       This ceiling value was removed in Linux 3.14, and patches to stable Linux  3.5.x  to  Linux  3.13.x  also
       removed the ceiling.

       As originally implemented (and documented), the QSIZE field displayed the total number of (user-supplied)
       bytes  in  all  messages  in  the  message  queue.   Some  changes in Linux 3.5 inadvertently changed the
       behavior, so that this field also included a count of kernel overhead bytes used to store the messages in
       the queue.  This behavioral regression was rectified in Linux 4.2 (and earlier stable kernel series),  so
       that the count once more included just the bytes of user data in messages in the queue.

</pre><h4><b>EXAMPLES</b></h4><pre>
       An example of the use of various message queue functions is shown in <b><a href="../man3/mq_notify.3.html">mq_notify</a></b>(3).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/getrlimit.2.html">getrlimit</a></b>(2), <b><a href="../man2/mq_getsetattr.2.html">mq_getsetattr</a></b>(2), <b><a href="../man2/poll.2.html">poll</a></b>(2), <b><a href="../man2/select.2.html">select</a></b>(2), <b><a href="../man3/mq_close.3.html">mq_close</a></b>(3), <b><a href="../man3/mq_getattr.3.html">mq_getattr</a></b>(3), <b><a href="../man3/mq_notify.3.html">mq_notify</a></b>(3), <b><a href="../man3/mq_open.3.html">mq_open</a></b>(3),
       <b><a href="../man3/mq_receive.3.html">mq_receive</a></b>(3), <b><a href="../man3/mq_send.3.html">mq_send</a></b>(3), <b><a href="../man3/mq_unlink.3.html">mq_unlink</a></b>(3), <b><a href="../man7/epoll.7.html">epoll</a></b>(7), <b><a href="../man7/namespaces.7.html">namespaces</a></b>(7)

Linux man-pages 6.9.1                              2024-05-02                                     <u><a href="../man7/mq_overview.7.html">mq_overview</a></u>(7)
</pre>
 </div>
</div></section>
</div>
</body>
</html>