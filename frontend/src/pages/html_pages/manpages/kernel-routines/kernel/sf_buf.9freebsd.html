<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sf_buf — manage temporary kernel address space mapping for memory pages</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sf_buf — manage temporary kernel address space mapping for memory pages

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/sf_buf.h&gt;</b>

       <u>struct</u> <u>sf_buf</u> <u>*</u>
       <b>sf_buf_alloc</b>(<u>struct</u> <u>vm_page</u> <u>*m</u>, <u>int</u> <u>flags</u>);

       <u>void</u>
       <b>sf_buf_free</b>(<u>struct</u> <u>sf_buf</u> <u>*sf</u>);

       <u>vm_offset_t</u>
       <b>sf_buf_kva</b>(<u>struct</u> <u>sf_buf</u> <u>*sf</u>);

       <u>struct</u> <u>vm_page</u> <u>*</u>
       <b>sf_buf_page</b>(<u>struct</u> <u>sf_buf</u> <u>*sf</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>sf_buf</b>  interface, historically the <u><a href="../man2/sendfile.2.html">sendfile</a></u>(2) buffer interface, allows kernel subsystems to manage
       temporary kernel address space mappings for physical memory pages.  On systems with a direct  memory  map
       region  (allowing  all physical pages to be visible in the kernel address space at all times), the <u>struct</u>
       <u>sf_buf</u> will point to an address in the direct map region; on systems without a direct memory map  region,
       the  <u>struct</u>  <u>sf_buf</u>  will  manage  a temporary kernel address space mapping valid for the lifetime of the
       <u>struct</u> <u>sf_buf</u>.

       Call <b>sf_buf_alloc</b>() to allocate a <u>struct</u> <u>sf_buf</u> for  a  physical  memory  page.   <b>sf_buf_alloc</b>()  is  not
       responsible  for  arranging for the page to be present in physical memory; the caller should already have
       arranged for the page to be wired, i.e., by calling <u><a href="../man9/vm_page_wire.9.html">vm_page_wire</a></u>(9).  Several  flags  may  be  passed  to
       <b>sf_buf_alloc</b>():

       SFB_CATCH       Cause  <b>sf_buf_alloc</b>()  to  abort  and  return  NULL if a signal is received waiting for a
                       <u>struct</u> <u>sf_buf</u> to become available.

       SFB_NOWAIT      Cause <b>sf_buf_alloc</b>() to return NULL rather than  sleeping  if  a  <u>struct</u>  <u>sf_buf</u>  is  not
                       immediately available.

       SFB_CPUPRIVATE  Cause  <b>sf_buf_alloc</b>()  to only arrange that the temporary mapping be valid on the current
                       CPU, avoiding unnecessary TLB shootdowns for mappings that will only  be  accessed  on  a
                       single  CPU at a time.  The caller must ensure that accesses to the virtual address occur
                       only on the CPU from which <b>sf_buf_alloc</b>() was invoked, perhaps by using <b>sched_pin</b>().

       Call <b>sf_buf_kva</b>() to return a kernel mapped address for the page.

       Call <b>sf_buf_page</b>() to return a pointer to the page originally passed into <b>sf_buf_alloc</b>().

       Call <b>sf_buf_free</b>() to release the <u>struct</u> <u>sf_buf</u> reference.  The caller is responsible for  releasing  any
       wiring  they  have  previously  acquired  on the physical page; <b>sf_buf_free</b>() releases only the temporary
       kernel address space mapping, not the page itself.

       Uses of this interface include managing mappings of borrowed pages from user memory, such as in zero-copy
       socket I/O, or pages of memory from the buffer cache referenced by mbuf external storage for <u><a href="../man2/sendfile.2.html">sendfile</a></u>(2).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man2/sendfile.2.html">sendfile</a></u>(2), <u><a href="../man9/vm_page_wire.9.html">vm_page_wire</a></u>(9)

</pre><h4><b>AUTHORS</b></h4><pre>
       The <u>struct</u> <u>sf_buf</u> API was designed and implemented by Alan L. Cox.   This  manual  page  was  written  by
       Robert N. M. Watson.

Debian                                          January 28, 2007                                       <u><a href="../man9/SF_BUF.9.html">SF_BUF</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>