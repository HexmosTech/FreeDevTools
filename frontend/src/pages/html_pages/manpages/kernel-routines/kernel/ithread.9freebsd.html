<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ithread_add_handler,    ithread_create,    ithread_destroy,   ithread_priority,   ithread_remove_handler,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ithread_add_handler,    ithread_create,    ithread_destroy,   ithread_priority,   ithread_remove_handler,
       ithread_schedule â€” kernel interrupt threads

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/param.h&gt;</b>
       <b>#include</b> <b>&lt;sys/bus.h&gt;</b>
       <b>#include</b> <b>&lt;sys/interrupt.h&gt;</b>

       <u>int</u>
       <b>ithread_add_handler</b>(<u>struct</u> <u>ithd</u> <u>*ithread</u>, <u>const</u> <u>char</u> <u>*name</u>, <u>driver_intr_t</u> <u>handler</u>, <u>void</u> <u>*arg</u>, <u>u_char</u> <u>pri</u>,
           <u>enum</u> <u>intr_type</u> <u>flags</u>, <u>void</u> <u>**cookiep</u>);

       <u>int</u>
       <b>ithread_create</b>(<u>struct</u> <u>ithd</u> <u>**ithread</u>, <u>int</u> <u>vector</u>, <u>int</u> <u>flags</u>,  <u>void</u> <u>(*disable)(int)</u>,  <u>void</u> <u>(*enable)(int)</u>,
           <u>const</u> <u>char</u> <u>*fmt</u>, <u>...</u>);

       <u>int</u>
       <b>ithread_destroy</b>(<u>struct</u> <u>ithd</u> <u>*ithread</u>);

       <u>u_char</u>
       <b>ithread_priority</b>(<u>enum</u> <u>intr_type</u> <u>flags</u>);

       <u>int</u>
       <b>ithread_remove_handler</b>(<u>void</u> <u>*cookie</u>);

       <u>int</u>
       <b>ithread_schedule</b>(<u>struct</u> <u>ithd</u> <u>*ithread</u>, <u>int</u> <u>do_switch</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Interrupt  threads  are kernel threads that run a list of handlers when triggered by either a hardware or
       software interrupt.  Each interrupt handler has a name, handler function, handler argument, priority, and
       various flags.  Each interrupt thread maintains a list of handlers sorted by priority.  This  results  in
       higher  priority  handlers  being  executed  prior  to  lower priority handlers.  Each thread assumes the
       priority of its highest priority handler for its process priority, or PRIO_MAX if  it  has  no  handlers.
       Interrupt threads are also associated with a single interrupt source, represented as a vector number.

       The  <b>ithread_create</b>()  function creates a new interrupt thread.  The <u>ithread</u> argument points to an <u>struct</u>
       <u>ithd</u> pointer that will point to the newly created thread upon success.  The <u>vector</u> argument specifies the
       interrupt source to associate this thread with.  The <u>flags</u> argument is  a  mask  of  properties  of  this
       thread.   The  only  valid  flag currently for <b>ithread_create</b>() is IT_SOFT to specify that this interrupt
       thread is a software interrupt.  The <u>enable</u> and <u>disable</u> arguments  specify  optional  functions  used  to
       enable  and  disable  this  interrupt  thread's  interrupt  source.   The  functions  receive  the vector
       corresponding to the thread's interrupt source as their only argument.  The remaining  arguments  form  a
       <u><a href="../man9/printf.9.html">printf</a></u>(9)  argument  list  that  is  used to build the base name of the new ithread.  The full name of an
       interrupt thread is formed by concatenating the base name of an interrupt thread with the names of all of
       its interrupt handlers.

       The <b>ithread_destroy</b>() function destroys a previously created interrupt thread by releasing its  resources
       and  arranging  for the backing kernel thread to terminate.  An interrupt thread can only be destroyed if
       it has no handlers remaining.

       The <b>ithread_add_handler</b>() function adds a new handler  to  an  existing  interrupt  thread  specified  by
       <u>ithread</u>.  The <u>name</u> argument specifies a name for this handler.  The <u>handler</u> and <u>arg</u> arguments provide the
       function  to  execute  for  this  handler  and an argument to pass to it.  The <u>pri</u> argument specifies the
       priority of this handler and is used both in sorting it in relation to the other handlers for this thread
       and to specify the priority of the backing kernel thread.  The <u>flags</u> argument  can  be  used  to  specify
       properties of this handler as defined in &lt;<u>sys/bus.h</u>&gt;.  If <u>cookiep</u> is not NULL, then it will be assigned a
       cookie that can be used later to remove this handler.

       The  <b>ithread_remove_handler</b>()  removes a handler from an interrupt thread.  The <u>cookie</u> argument specifies
       the handler to remove from its thread.

       The <b>ithread_schedule</b>() function schedules an interrupt thread to run.  If the <u>do_switch</u> argument is  non-
       zero  and  the interrupt thread is idle, then a context switch will be forced after putting the interrupt
       thread on the run queue.

       The <b>ithread_priority</b>() function  translates  the  INTR_TYPE_*  interrupt  flags  into  interrupt  handler
       priorities.

       The  interrupt  flags  not  related  to  the  type of a particular interrupt (INTR_TYPE_*) can be used to
       specify additional properties of both hardware and  software  interrupt  handlers.   The  INTR_EXCL  flag
       specifies  that this handler cannot share an interrupt thread with another handler.  The INTR_MPSAFE flag
       specifies that this handler is MP safe in that it does not need the Giant mutex to be held  while  it  is
       executed.   The  INTR_ENTROPY  flag specifies that the interrupt source this handler is tied to is a good
       source of entropy, and thus that entropy should be gathered when an interrupt from the  handler's  source
       triggers.  Presently, the INTR_ENTROPY flag is not valid for software interrupt handlers.

       It  is  not  permitted  to  sleep  in  an  interrupt  thread; hence, any memory or zone allocations in an
       interrupt thread should be specified with the M_NOWAIT flag set.  Any allocation errors must  be  handled
       thereafter.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       The    <b>ithread_add_handler</b>(),    <b>ithread_create</b>(),   <b>ithread_destroy</b>(),   <b>ithread_remove_handler</b>(),   and
       <b>ithread_schedule</b>() functions return zero on success and  non-zero  on  failure.   The  <b>ithread_priority</b>()
       function returns a process priority corresponding to the passed in interrupt flags.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The <b>swi_add</b>() function demonstrates the use of <b>ithread_create</b>() and <b>ithread_add_handler</b>().

             int
             swi_add(struct ithd **ithdp, const char *name, driver_intr_t handler,
                         void *arg, int pri, enum intr_type flags, void **cookiep)
             {
                     struct proc *p;
                     struct ithd *ithd;
                     int error;

                     if (flags &amp; INTR_ENTROPY)
                             return (EINVAL);

                     ithd = (ithdp != NULL) ? *ithdp : NULL;

                     if (ithd != NULL) {
                             if ((ithd-&gt;it_flags &amp; IT_SOFT) == 0)
                                     return(EINVAL);
                     } else {
                             error = ithread_create(&amp;ithd, pri, IT_SOFT, NULL, NULL,
                                 "swi%d:", pri);
                             if (error)
                                     return (error);

                             if (ithdp != NULL)
                                     *ithdp = ithd;
                     }
                     return (ithread_add_handler(ithd, name, handler, arg, pri + PI_SOFT,
                                 flags, cookiep));
             }

</pre><h4><b>ERRORS</b></h4><pre>
       The <b>ithread_add_handler</b>() function will fail if:

       [EINVAL]           Any of the <u>ithread</u>, <u>handler</u>, or <u>name</u> arguments are NULL.

       [EINVAL]           The  INTR_EXCL flag is specified and the interrupt thread <u>ithread</u> already has at least
                          one handler, or the interrupt thread <u>ithread</u> already has an exclusive handler.

       [ENOMEM]           Could not allocate needed memory for this handler.

       The <b>ithread_create</b>() function will fail if:

       [EAGAIN]           The system-imposed limit on the total number of processes  under  execution  would  be
                          exceeded.  The limit is given by the <u><a href="../man3/sysctl.3.html">sysctl</a></u>(3) MIB variable KERN_MAXPROC.

       [EINVAL]           A flag other than IT_SOFT was specified in the <u>flags</u> parameter.

       [ENOMEM]           Could not allocate needed memory for this interrupt thread.

       The <b>ithread_destroy</b>() function will fail if:

       [EINVAL]           The <u>ithread</u> argument is NULL.

       [EINVAL]           The interrupt thread pointed to by <u>ithread</u> has at least one handler.

       The <b>ithread_remove_handler</b>() function will fail if:

       [EINVAL]           The <u>cookie</u> argument is NULL.

       The <b>ithread_schedule</b>() function will fail if:

       [EINVAL]           The <u>ithread</u> argument is NULL.

       [EINVAL]           The interrupt thread pointed to by <u>ithread</u> has no interrupt handlers.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man9/kthread.9.html">kthread</a></u>(9), <u><a href="../man9/malloc.9.html">malloc</a></u>(9), <u><a href="../man9/swi.9.html">swi</a></u>(9), <u><a href="../man9/uma.9.html">uma</a></u>(9)

</pre><h4><b>HISTORY</b></h4><pre>
       Interrupt threads and their corresponding API first appeared in FreeBSD 5.0.

</pre><h4><b>BUGS</b></h4><pre>
       Currently  <u>struct</u>  <u>ithd</u>  represents  both an interrupt source and an interrupt thread.  There should be a
       separate <u>struct</u> <u>isrc</u> that contains a vector number, enable and disable functions, etc.  that  an  ithread
       holds a reference to.

Debian                                           August 25, 2006                                      <u><a href="../man9/ITHREAD.9.html">ITHREAD</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>