<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bhnd_erom,       bhnd_erom_alloc,       bhnd_erom_dump,       bhnd_erom_fini_static,      bhnd_erom_free,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       bhnd_erom,       bhnd_erom_alloc,       bhnd_erom_dump,       bhnd_erom_fini_static,      bhnd_erom_free,
       bhnd_erom_free_core_table,      bhnd_erom_get_core_table,      bhnd_erom_init_static,       bhnd_erom_io,
       bhnd_erom_io_fini,   bhnd_erom_io_map,   bhnd_erom_io_read,   bhnd_erom_iobus_init,  bhnd_erom_iores_new,
       bhnd_erom_lookup_core, bhnd_erom_lookup_core_addr, bhnd_erom_probe, bhnd_erom_probe_driver_classes â€” BHND
       device enumeration table parsing

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;dev/bhnd/bhnd.h&gt;</b>
       <b>#include</b> <b>&lt;dev/bhnd/bhnd_erom.h&gt;</b>

       <u>typedef</u> <u>struct</u> <u>bhnd_erom</u> <u>bhnd_erom_t</u>;
       <u>typedef</u> <u>struct</u> <u>kobj_class</u> <u>bhnd_erom_class_t</u>;
       <u>typedef</u> <u>struct</u> <u>bhnd_erom_static</u> <u>bhnd_erom_static_t</u>;

       <u>int</u>
       <b>bhnd_erom_probe</b>(<u>bhnd_erom_class_t</u> <u>*cls</u>,     <u>struct</u> <u>bhnd_erom_io</u> <u>*eio</u>,     <u>const</u> <u>struct</u> <u>bhnd_chipid</u> <u>*hint</u>,
           <u>struct</u> <u>bhnd_chipid</u> <u>*cid</u>);

       <u>bhnd_erom_class_t</u> <u>*</u>
       <b>bhnd_erom_probe_driver_classes</b>(<u>devclass_t</u> <u>bus_devclass</u>,                         <u>struct</u> <u>bhnd_erom_io</u> <u>*eio</u>,
           <u>const</u> <u>struct</u> <u>bhnd_chipid</u> <u>*hint</u>, <u>struct</u> <u>bhnd_chipid</u> <u>*cid</u>);

       <u>bhnd_erom_t</u> <u>*</u>
       <b>bhnd_erom_alloc</b>(<u>bhnd_erom_class_t</u> <u>*cls</u>, <u>const</u> <u>struct</u> <u>bhnd_chipid</u> <u>*cid</u>, <u>struct</u> <u>bhnd_erom_io</u> <u>*eio</u>);

       <u>void</u>
       <b>bhnd_erom_free</b>(<u>bhnd_erom_t</u> <u>*erom</u>);

       <u>int</u>
       <b>bhnd_erom_init_static</b>(<u>bhnd_erom_class_t</u> <u>*cls</u>,              <u>bhnd_erom_t</u> <u>*erom</u>,               <u>size_t</u> <u>esize</u>,
           <u>const</u> <u>struct</u> <u>bhnd_chipid</u> <u>*cid</u>, <u>struct</u> <u>bhnd_erom_io</u> <u>*eio</u>);

       <u>void</u>
       <b>bhnd_erom_fini_static</b>(<u>bhnd_erom_t</u> <u>*erom</u>);

       <u>int</u>
       <b>bhnd_erom_dump</b>(<u>bhnd_erom_t</u> <u>*erom</u>);

       <u>int</u>
       <b>bhnd_erom_get_core_table</b>(<u>bhnd_erom_t</u> <u>*erom</u>, <u>struct</u> <u>bhnd_core_info</u> <u>**cores</u>, <u>u_int</u> <u>*num_cores</u>);

       <u>void</u>
       <b>bhnd_erom_free_core_table</b>(<u>bhnd_erom_t</u> <u>*erom</u>, <u>struct</u> <u>bhnd_core_info</u> <u>*cores</u>);

       <u>int</u>
       <b>bhnd_erom_lookup_core</b>(<u>bhnd_erom_t</u> <u>*erom</u>,                              <u>const</u> <u>struct</u> <u>bhnd_core_match</u> <u>*desc</u>,
           <u>struct</u> <u>bhnd_core_info</u> <u>*core</u>);

       <u>int</u>
       <b>bhnd_erom_lookup_core_addr</b>(<u>bhnd_erom_t</u> <u>*erom</u>,  <u>const</u> <u>struct</u> <u>bhnd_core_match</u> <u>*desc</u>,   <u>bhnd_port_type</u> <u>type</u>,
           <u>u_int</u> <u>port</u>, <u>u_int</u> <u>region</u>, <u>struct</u> <u>bhnd_core_info</u> <u>*core</u>, <u>bhnd_addr_t</u> <u>*addr</u>, <u>bhnd_size_t</u> <u>*size</u>);

   <b>Bus</b> <b>Space</b> <b>I/O</b>
       <u>struct</u> <u>bhnd_erom_io</u> <u>*</u>
       <b>bhnd_erom_iores_new</b>(<u>device_t</u> <u>dev</u>, <u>int</u> <u>rid</u>);

       <u>int</u>
       <b>bhnd_erom_iobus_init</b>(<u>struct</u> <u>bhnd_erom_iobus</u> <u>*iobus</u>,          <u>bhnd_addr_t</u> <u>addr</u>,          <u>bhnd_size_t</u> <u>size</u>,
           <u>bus_space_tag_t</u> <u>bst</u>, <u>bus_space_handle_t</u> <u>bsh</u>);

       <u>void</u>
       <b>bhnd_erom_io_fini</b>(<u>struct</u> <u>bhnd_erom_io</u> <u>*eio</u>);

       <u>int</u>
       <b>bhnd_erom_io_map</b>(<u>struct</u> <u>bhnd_erom_io</u> <u>*eio</u>, <u>bhnd_addr_t</u> <u>addr</u>, <u>bhnd_size_t</u> <u>size</u>);

       <u>uint32_t</u>
       <b>bhnd_erom_io_read</b>(<u>struct</u> <u>bhnd_erom_io</u> <u>*eio</u>, <u>bhnd_size_t</u> <u>offset</u>, <u>u_int</u> <u>width</u>);

       <b>#include</b> <b>&lt;dev/bhnd/bhnd_eromvar.h&gt;</b>

       struct bhnd_erom_io {
               bhnd_erom_io_map_t      *map;
               bhnd_erom_io_read_t     *read;
               bhnd_erom_io_fini_t     *fini;
       };

       <u>typedef</u> <u>int</u>
       (<b>bhnd_erom_io_map_t</b>)(<u>struct</u> <u>bhnd_erom_io</u> <u>*eio</u>, <u>bhnd_addr_t</u> <u>addr</u>, <u>bhnd_size_t</u> <u>size</u>);

       <u>typedef</u> <u>uint32_t</u>
       (<b>bhnd_erom_io_read_t</b>)(<u>struct</u> <u>bhnd_erom_io</u> <u>*eio</u>, <u>bhnd_size_t</u> <u>offset</u>, <u>u_int</u> <u>width</u>);

       <u>typedef</u> <u>void</u>
       (<b>bhnd_erom_io_fini_t</b>)(<u>struct</u> <u>bhnd_erom_io</u> <u>*eio</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>bhnd_erom</b> framework provides a common parser interface to the BHND device enumeration  table  formats
       supported by <u><a href="../man4/bhnd.4.html">bhnd</a></u>(4) bus drivers.

       The  <b>bhnd_erom_probe</b>()  function  is used to identify a <u><a href="../man4/bhnd.4.html">bhnd</a></u>(4) bus device and determine whether the erom
       class <u>cls</u> is  capable  of  parsing  its  device  enumeration  table.   If  successful,  the  probed  chip
       identification is written to the location pointed to by <u>cid</u>.

       A  pointer to a bus I/O instance mapping the device registers of the first hardware core must be provided
       using the <u>eio</u> argument.  The registers can be mapped using <u><a href="../man9/bhnd_erom_io_map.9.html">bhnd_erom_io_map</a></u>(9).

       On devices that do not provide  standard  <u><a href="../man4/bhnd_chipc.4.html">bhnd_chipc</a></u>(4)  chip  identification  registers  via  the  first
       hardware  core,  a  pointer to chip information for the device must be specified using the <u>hint</u> argument.
       Otherwise, the <u>hint</u> argument should be NULL.

       The <b>bhnd_erom_probe_driver_classes</b>() function is  a  convenience  wrapper  for  <b>bhnd_erom_probe</b>().   This
       function   will   iterate   over   all   drivers  instances  in  the  device  class  <u>bus_devclass</u>,  using
       <u><a href="../man9/bhnd_driver_get_erom_class.9.html">bhnd_driver_get_erom_class</a></u>(9) to fetch each driver's erom class and probe the  hardware  core  mapped  by
       <u>eio</u>.   A  pointer to the erom class with the highest probe priority is returned on success.  If there are
       no successful probe results from the erom classes, NULL is returned.

       The <b>bhnd_erom_alloc</b>() function allocates and returns a new parser  instance  of  the  device  enumeration
       class  <u>cls</u>  for  the  chip  identified  by <u>cid</u>, using the bus I/O instance <u>eio</u> to map and read the device
       table.  On success, the returned <u>bhnd_erom_t</u> assumes ownership of <u>eio</u>.

       The <b>bhnd_erom_free</b>() function releases all resources held by an erom parser successfully allocated  using
       <b>bhnd_erom_alloc</b>().

       Clients  can  manage the allocation of memory themselves with <b>bhnd_erom_init_static</b>().  This is useful in
       cases like performing device enumeration before  <u><a href="../man9/malloc.9.html">malloc</a></u>(9)  initialization.   <b>bhnd_erom_init_static</b>()  is
       called with <u>erom</u> set to a pointer to the memory for the instance, and the total available bytes in <u>esize</u>.

       The <u>bhnd_erom_static</u> structure is large enough to statically allocate any supported parser class instance
       state.  Pointers to a <u>bhnd_erom_static</u> structure can be cast to <u>bhnd_erom_t</u>.

       The  <b>bhnd_erom_fini_static</b>()  function  releases  all  resources  held  by  an  erom  parser successfully
       initialized using <b>bhnd_erom_init_static</b>().

       The <b>bhnd_erom_dump</b>() function enumerates and prints all device table entries in <u>erom</u>.

       The <b>bhnd_erom_get_core_table</b>() function enumerates all device table entries in <u>erom</u>, returning a table of
       core information structures in <u>cores</u> and the count in <u>num_cores</u>.  The memory allocated for the table must
       be freed using <b>bhnd_erom_free_core_table</b>().

       The  <b>bhnd_erom_free_core_table</b>()  function  frees  any  memory  allocated   in   a   previous   call   to
       <b>bhnd_erom_get_core_table</b>().

       The <b>bhnd_erom_lookup_core</b>() function locates the first device table entry in <u>erom</u> that matches core match
       descriptor <u>desc</u>, writing the core information of the matching entry to <u>core</u>.

       The  <b>bhnd_erom_lookup_core_addr</b>() function locates the first device table entry in <u>erom</u> that matches core
       match descriptor <u>desc</u>, fetching the base address and size of the memory region <u>region</u> mapped to the  port
       <u>port</u>  of  type <u>type</u>.  On success, the core information of the matching entry is written to <u>core</u>, the base
       address of the port region is written to <u>addr</u>, and the total size of the port region is written to  <u>size</u>.
       If the core information is not desired, set <u>core</u> to NULL.

   <b>Bus</b> <b>Space</b> <b>I/O</b>
       The  <u>bhnd_erom_io</u>  structure provides a set of I/O callbacks used by <b>bhnd_erom</b> to map and read the device
       enumeration table.  Clients may either use the existing <b>bhnd_erom_iores_new</b>()  or  <b>bhnd_erom_iobus_init</b>()
       functions to allocate a bus I/O instance, or implement the <u>bhnd_erom_io</u> callbacks directly.

       The <u>bhnd_erom_io</u> structure contains these required fields:

             <u>map</u>   A function implementing <b>bhnd_erom_io_map</b>().

             <u>read</u>  A function implementing <b>bhnd_erom_io_read</b>().

             <u>fini</u>  A function implementing <b>bhnd_erom_io_fini</b>().

       The <b>bhnd_erom_iores_new</b>() function allocates and returns a new bus I/O instance that will perform mapping
       by  using  <u><a href="../man9/bhnd_alloc_resource.9.html">bhnd_alloc_resource</a></u>(9)  to allocate SYS_RES_MEMORY bus resources on demand from the device <u>dev</u>
       using a resource ID of <u>rid</u>.

       The <b>bhnd_erom_iobus_init</b>() function initializes a caller-allocated  bus  I/O  instance  <u>iobus</u>  that  will
       perform  bus  I/O  using the bus space tag <u>bst</u> and handle <u>bsh</u>.  The base address and total size mapped by
       <u>bsh</u> should be specified using the <u>addr</u> and <u>size</u> arguments.

       The <b>bhnd_erom_io_fini</b>() function frees all resources held by the bus I/O instance <u>eio</u>.

       The <b>bhnd_erom_io_map</b>() function is used to request that the bus I/O instance <u>eio</u> map <u><a href="../man4/bhnd.4.html">bhnd</a></u>(4) bus space at
       bus address <u>addr</u> with a mapping of size <u>size</u>.

       The <b>bhnd_erom_io_read</b>() function is used to read a data item of <u>width</u> bytes from the bus I/O instance <u>eio</u>
       at <u>offset</u>, relative to the bus address previously mapped using <b>bhnd_erom_io_map</b>().

       The <u>width</u> must be one of 1, 2, or 4 bytes.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       The <b>bhnd_erom_probe</b>() function returns a standard <u><a href="../man9/DEVICE_PROBE.9.html">DEVICE_PROBE</a></u>(9) result.

       A return value equal to or less than zero indicates success.   Values  greater  than  zero  indicates  an
       error,  and  will  be  an  appropriate error code.  For values less than or equal to zero, the erom class
       returning the highest value should be used to parse the erom table.  ENXIO is returned if the  device  is
       not supported by the parser.

       The  <b>bhnd_erom_probe_driver_classes</b>() function returns a pointer to the probed <u>bhnd_erom_class_t</u> instance
       on success, a null pointer otherwise.

       The <b>bhnd_erom_alloc</b>() function returns a pointer to <u>bhnd_erom_t</u> on success, or NULL if an error  occurred
       allocating or initializing the EROM parser.

       The  <b>bhnd_erom_init_static</b>() function returns 0 on success, ENOMEM if the allocation size is smaller than
       required by the erom class, or an appropriate error code if initialization otherwise fails.

       The <b>bhnd_erom_lookup_core</b>() function returns 0 on success, ENOENT if no matching core  is  found,  or  an
       appropriate error code if parsing the device table otherwise fails.

       The  <b>bhnd_erom_dump</b>(),  <b>bhnd_erom_get_core_table</b>(), <b>bhnd_erom_iobus_init</b>(), <b>bhnd_erom_io_map</b>(), functions
       return 0 on success, otherwise an appropriate error code is returned.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man4/bhnd.4.html">bhnd</a></u>(4), <u><a href="../man9/bhnd.9.html">bhnd</a></u>(9), <u><a href="../man9/bhnd_alloc_resource.9.html">bhnd_alloc_resource</a></u>(9) <u><a href="../man9/bhnd_driver_get_erom_class.9.html">bhnd_driver_get_erom_class</a></u>(9) <u><a href="../man9/bus_space.9.html">bus_space</a></u>(9)

</pre><h4><b>AUTHORS</b></h4><pre>
       The <b>bhnd_erom</b> framework and this manual page were written by Landon Fuller &lt;<u><a href="mailto:landonf@FreeBSD.org">landonf@FreeBSD.org</a></u>&gt;.

Debian                                          November 9, 2017                                    <u><a href="../man9/BHND_EROM.9.html">BHND_EROM</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>