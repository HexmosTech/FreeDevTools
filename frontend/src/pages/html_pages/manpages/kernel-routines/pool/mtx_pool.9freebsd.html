<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mtx_pool,    mtx_pool_alloc,    mtx_pool_find,    mtx_pool_lock,   mtx_pool_lock_spin,   mtx_pool_unlock,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mtx_pool,    mtx_pool_alloc,    mtx_pool_find,    mtx_pool_lock,   mtx_pool_lock_spin,   mtx_pool_unlock,
       mtx_pool_unlock_spin, mtx_pool_create, mtx_pool_destroy â€” mutex pool routines

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/param.h&gt;</b>
       <b>#include</b> <b>&lt;sys/lock.h&gt;</b>
       <b>#include</b> <b>&lt;sys/mutex.h&gt;</b>

       <u>struct</u> <u>mtx</u> <u>*</u>
       <b>mtx_pool_alloc</b>(<u>struct</u> <u>mtx_pool</u> <u>*pool</u>);

       <u>struct</u> <u>mtx</u> <u>*</u>
       <b>mtx_pool_find</b>(<u>struct</u> <u>mtx_pool</u> <u>*pool</u>, <u>void</u> <u>*ptr</u>);

       <u>void</u>
       <b>mtx_pool_lock</b>(<u>struct</u> <u>mtx_pool</u> <u>*pool</u>, <u>void</u> <u>*ptr</u>);

       <u>void</u>
       <b>mtx_pool_lock_spin</b>(<u>struct</u> <u>mtx_pool</u> <u>*pool</u>, <u>void</u> <u>*ptr</u>);

       <u>void</u>
       <b>mtx_pool_unlock</b>(<u>struct</u> <u>mtx_pool</u> <u>*pool</u>, <u>void</u> <u>*ptr</u>);

       <u>void</u>
       <b>mtx_pool_unlock_spin</b>(<u>struct</u> <u>mtx_pool</u> <u>*pool</u>, <u>void</u> <u>*ptr</u>);

       <u>struct</u> <u>mtx_pool</u> <u>*</u>
       <b>mtx_pool_create</b>(<u>const</u> <u>char</u> <u>*mtx_name</u>, <u>int</u> <u>pool_size</u>, <u>int</u> <u>opts</u>);

       <u>void</u>
       <b>mtx_pool_destroy</b>(<u>struct</u> <u>mtx_pool</u> <u>**poolp</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Mutex pools are designed to be used as short term leaf mutexes; i.e., the last mutex  one  might  acquire
       before  calling  <u><a href="../man9/mtx_sleep.9.html">mtx_sleep</a></u>(9).   They operate using a shared pool of mutexes.  A mutex may be chosen from
       the pool based on a supplied pointer, which may or may not point to anything valid,  or  the  caller  may
       allocate an arbitrary shared mutex from the pool and save the returned mutex pointer for later use.

       The  shared  mutexes  in  the  <u>mtxpool_sleep</u>  mutex pool, which is created by default, are standard, non-
       recursive, blockable mutexes, and should only be used in appropriate  situations.   The  mutexes  in  the
       <u>mtxpool_lockbuilder</u>  mutex pool are similar, except that they are initialized with the MTX_NOWITNESS flag
       so that they may be used to build higher-level locks.  Other mutex pools  may  be  created  that  contain
       mutexes with different properties, such as spin mutexes.

       The  caller  can lock and unlock mutexes returned by the pool routines, but since the mutexes are shared,
       the caller should not attempt to destroy them or modify their characteristics.  While  pool  mutexes  are
       normally  leaf  mutexes  (meaning that one cannot depend on any ordering guarantees after obtaining one),
       one can still obtain other mutexes under carefully controlled circumstances.  Specifically, if one has  a
       private mutex (one that was allocated and initialized by the caller), one can obtain it after obtaining a
       pool  mutex  if  ordering  issues are carefully accounted for.  In these cases the private mutex winds up
       being the true leaf mutex.

       Pool mutexes have the following advantages:

             1.   No structural overhead; i.e., they can be associated with a structure without adding bloat  to
                  it.
             2.   Mutexes  can  be  obtained  for  invalid  pointers,  which  is useful when one uses mutexes to
                  interlock destructor operations.
             3.   No initialization or destruction overhead.
             4.   Can be used with <u><a href="../man9/mtx_sleep.9.html">mtx_sleep</a></u>(9).

       And the following disadvantages:

             1.   Should generally only be used as leaf mutexes.
             2.   Pool/pool dependency ordering cannot be guaranteed.
             3.   Possible L1 cache mastership contention between CPUs.

       <b>mtx_pool_alloc</b>() obtains a shared mutex from the specified pool.  This routine uses  a  simple  rover  to
       choose one of the shared mutexes managed by the <b>mtx_pool</b> subsystem.

       <b>mtx_pool_find</b>() returns the shared mutex associated with the specified address.  This routine will create
       a  hash out of the pointer passed into it and will choose a shared mutex from the specified pool based on
       that hash.  The pointer does not need to point to anything real.

       <b>mtx_pool_lock</b>(), <b>mtx_pool_lock_spin</b>(), <b>mtx_pool_unlock</b>(), and <b>mtx_pool_unlock_spin</b>() lock and unlock  the
       shared  mutex  from  the  specified pool associated with the specified address; they are a combination of
       <b>mtx_pool_find</b>() and <u><a href="../man9/mtx_lock.9.html">mtx_lock</a></u>(9), <u><a href="../man9/mtx_lock_spin.9.html">mtx_lock_spin</a></u>(9), <u><a href="../man9/mtx_unlock.9.html">mtx_unlock</a></u>(9), and  <u><a href="../man9/mtx_unlock_spin.9.html">mtx_unlock_spin</a></u>(9),  respectively.
       Since  these routines must first find the mutex to operate on, they are not as fast as directly using the
       mutex pointer returned by a previous invocation of <b>mtx_pool_find</b>() or <b>mtx_pool_alloc</b>().

       <b>mtx_pool_create</b>() allocates and initializes a new mutex pool of the specified size.  The pool  size  must
       be  a  power of two.  The <u>opts</u> argument is passed to <u><a href="../man9/mtx_init.9.html">mtx_init</a></u>(9) to set the options for each mutex in the
       pool.

       <b>mtx_pool_destroy</b>() calls <u><a href="../man9/mtx_destroy.9.html">mtx_destroy</a></u>(9) on each mutex in  the  specified  pool,  deallocates  the  memory
       associated with the pool, and assigns NULL to the pool pointer.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man9/locking.9.html">locking</a></u>(9), <u><a href="../man9/mutex.9.html">mutex</a></u>(9)

</pre><h4><b>HISTORY</b></h4><pre>
       These routines first appeared in FreeBSD 5.0.

Debian                                          February 6, 2010                                     <u><a href="../man9/MTX_POOL.9.html">MTX_POOL</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>