<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>moveoff - Component for HAL-only offsets</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/linuxcnc-uspace">linuxcnc-uspace_2.9.4-2ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       moveoff - Component for HAL-only offsets

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>loadrt</b> <b>moveoff</b> <b>[count=</b><u>N</u><b>|names=</b><u>name1</u><b>[,</b><u>name2...</u><b>]]</b> <b>[personality=</b><u>P1,P2,...</u><b>]</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  moveoff  component  is used to offset joint positions using custom HAL connections.  Implementing an
       offset-while-program-is-paused functionality is supported with  appropriate  connections  for  the  input
       pins.  Nine joints are supported.

       The  axis offset pin values (offset-in-M) are continuously applied (respecting limits on value, velocity,
       and acceleration) to the output pins (offset-current-M,  pos-plusoffset-M,  fb-minusoffset-M)  when  both
       enabling  input  pins  (apply-offsets  and  move-enable)  are  TRUE.   The  two enabling inputs are anded
       internally.  A <b>warning</b> pin is set and a message issued if  the  apply-offsets  pin  is  deasserted  while
       offsets are applied.  The warning pin remains TRUE until the offsets are removed or the apply-offsets pin
       is set.

       Typically,  the  move-enable pin is connected to external controls and the apply-offsets pin is connected
       to halui.program.is-paused (for offsets only while paused) or  set  to  TRUE  (for  continuously  applied
       offsets).

       Applied offsets are <b>automatically</b> <b>returned</b> to zero (respecting limits) when either of the enabling inputs
       is deactivated.  The zero value tolerance is specified by the epsilon input pin value.

       Waypoints  are  recorded when the moveoff component is enabled.  Waypoints are managed with the waypoint-
       sample-secs and waypoint-threshold pins.  When the backtrack-enable pin is  TRUE,  the  auto-return  path
       follows the recorded waypoints.  When the memory available for waypoints is exhausted, offsets are frozen
       and  the  waypoint-limit  pin  is  asserted.   This  restriction  applies  regardless of the state of the
       backtrack-enable pin.  An enabling pin must be deasserted to allow a return to the  original  (non-offset
       position).

       Backtracking  through  waypoints  results  in  <b>slower</b>  movement  rates  as  the  moves are point-to-point
       respecting velocity and acceleration settings.  The velocity and acceleration limit pins can  be  managed
       dynamically to control offsets at all times.

       When backtrack-enable is FALSE, the auto-return move is <b>NOT</b> coordinated, each axis returns to zero at its
       own  rate.   If  a  controlled path is wanted in this condition, each axis should be manually returned to
       zero before deasserting an enabling pin.

       The waypoint-sample-secs, waypoint-threshold, and epsilon pins are evaluated only when the  component  is
       idle.

       The  offsets-applied  output  pin  is  provided  to  indicate  the current state to a GUI so that program
       resumption can be managed.  If the offset(s) are non-zero when the apply-offsets pin is  deasserted  (for
       example when resuming a program when offsetting during a pause), offsets are returned to zero (respecting
       limits) and an <b>Error</b> message is issued.

       <b>Caution:</b>  If  offsets  are enabled and applied and the machine is turned off for any reason, any <b>external</b>
       HAL logic that manages the enabling pins and the offset-in-M inputs is responsible for their  state  when
       the machine is subsequently turned on again.

       This  HAL-only  means  of  offsetting  is  typically  not  known to LinuxCNC nor available in GUI preview
       displays.  <b>No</b> <b>protection</b> <b>is</b> <b>provided</b> for offset moves that exceed soft limits managed by LinuxCNC.  Since
       soft limits are not honored, an offset move may encounter hard limits (or <b>CRASH</b> if  there  are  no  limit
       switches).  Use of the offset-min-M and offset-max-M inputs to limit travel is recommended.  Triggering a
       hard limit will turn off the machine -- see <b>Caution</b> above.

       The  offset-in-M  values  may  be set with inifile settings, controlled by a GUI, or managed by other HAL
       components and connections.  Fixed values may be appropriate in simple  cases  where  the  direction  and
       amount  of offset is well-defined but a control method is required to deactivate an enabling pin in order
       to return offsets to zero.  GUIs may provide means for users to set, increment, decrement, and accumulate
       offset values for each axis and may set offset-in-M values to zero before deasserting an enabling pin.

       The default values for accel, vel, min, max, epsilon, waypoint-sample-secs,  and  waypoint-threshold  may
       not  be  suitable  for  any  particular  application.   This  HAL component is unaware of limits enforced
       elsewhere by LinuxCNC.  Users should test usage in a simulator application  and  understand  all  hazards
       <b>before</b> use on hardware.

       The module personality item sets the number of joints supported (default==3, maximum is 9).

       Use  of  the  names=  option  for  naming  is  <b>required</b>  for  compatibility  with  the  gui  provided  as
       scripts/moveoff_gui:
         loadrt moveoff names=<b>mv</b> personality=number_of_joints

</pre><h4><b>FUNCTIONS</b></h4><pre>
       <b>moveoff.</b><u>N</u><b>.read-inputs</b> (requires a floating-point thread)
              Read all inputs

       <b>moveoff.</b><u>N</u><b>.write-outputs</b> (requires a floating-point thread)
              Write computed offset outputs (offset-current-M, pos-plusoffset-M, fb-minusoffset-M).   All  other
              outputs are updated by read-inputs().

</pre><h4><b>PINS</b></h4><pre>
       <b>moveoff.</b><u>N</u><b>.power-on</b> bit in
              Connect to motion.motion-enabled

       <b>moveoff.</b><u>N</u><b>.move-enable</b> bit in
              Enable offsets (Enabling requires apply-offset TRUE also)

       <b>moveoff.</b><u>N</u><b>.apply-offsets</b> bit in
              Enable offsets (Enabling requires move-enable TRUE also)

       <b>moveoff.</b><u>N</u><b>.backtrack-enable</b> bit in (default: <u>1</u>)
              Enable backtrack on auto-return

       <b>moveoff.</b><u>N</u><b>.epsilon</b> float in (default: <u>0.0005</u>)
              When  enabling  pins  are  deactivated,  return  to  un-offsetted  position  within epsilon units.
              Warning: values that are too small in value may cause overshoot.  A minimum  value  of  0.0001  is
              <b>silently</b> <b>enforced</b>.

       <b>moveoff.</b><u>N</u><b>.waypoint-threshold</b> float in (default: <u>0.02</u>)
              Minimum distance (in a single axis) for a new waypoint

       <b>moveoff.</b><u>N</u><b>.waypoint-sample-secs</b> float in (default: <u>0.02</u>)
              Minimum sample interval (in seconds) for a new waypoint

       <b>moveoff.</b><u>N</u><b>.warning</b> bit out
              Set TRUE if apply-offsets is deasserted while offset-applied is TRUE.

       <b>moveoff.</b><u>N</u><b>.offset-applied</b> bit out
              TRUE if one or more offsets are applied.

       <b>moveoff.</b><u>N</u><b>.waypoint-limit</b> bit out (default: <u>0</u>)
              Indicates  waypoint  limit reached (motion ceases), an enabling pin must be deasserted to initiate
              return to original position.

       <b>moveoff.</b><u>N</u><b>.waypoint-ct</b> s32 out
              Waypoint count (for debugging)

       <b>moveoff.</b><u>N</u><b>.waypoint-percent-used</b> s32 out
              Percent of available waypoints used

       <b>moveoff.</b><u>N</u><b>.offset-in-</b><u>M</u> float in (M=0..personality)
              Joint offset input value

       <b>moveoff.</b><u>N</u><b>.pos-</b><u>M</u> float in (M=0..personality)
              Joint position (typ: axis.0.motor-pos-cmd)

       <b>moveoff.</b><u>N</u><b>.fb-</b><u>M</u> float in (M=0..personality)
              Joint feedback (typ from encoder and input to pid controller (pid.feedback))

       <b>moveoff.</b><u>N</u><b>.offset-current-</b><u>M</u> float out (M=0..personality)
              Joint offset current value

       <b>moveoff.</b><u>N</u><b>.pos-plusoffset-</b><u>M</u> float out (M=0..personality)
              Computed joint position plus offset (typically connect to pid command input)

       <b>moveoff.</b><u>N</u><b>.fb-minusoffset-</b><u>M</u> float out (M=0..personality)
              Computed Joint feedback minus offset (typically connected to axis.0.motor-pos-fb)

       <b>moveoff.</b><u>N</u><b>.offset-vel-</b><u>M</u> float in (M=0..personality) (default: <u>10</u>)
              Joint offset velocity limit

       <b>moveoff.</b><u>N</u><b>.offset-accel-</b><u>M</u> float in (M=0..personality) (default: <u>100</u>)
              Joint offset acceleration limit

       <b>moveoff.</b><u>N</u><b>.offset-min-</b><u>M</u> float in (M=0..personality) (default: <u>-1e20</u>)
              Minimum limit for applied joint offset (typ negative)

       <b>moveoff.</b><u>N</u><b>.offset-max-</b><u>M</u> float in (M=0..personality) (default: <u>1e20</u>)
              Maximum limit for applied offset (typ positive)

       <b>moveoff.</b><u>N</u><b>.dbg-waypoint-limit-test</b> bit in
              Debug input to test with limited number of waypoints

       <b>moveoff.</b><u>N</u><b>.dbg-state</b> s32 out
              Debug output for current state of state machine

</pre><h4><b>EXAMPLES</b></h4><pre>
       Example simulator configs that demonstrate the moveoff component and a simple  gui  (scripts/moveoff_gui)
       are  located in configs/sim/axis/moveoff. The AXIS GUI is used for the demonstrations and the configs can
       be adapted for other GUIs like Touchy and Gscreen.  An  example  with  the  Touchy  GUI  is  provided  in
       configs/sim/touchy/ngcgui/.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/moveoff_gui.1.html">moveoff_gui</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
       Dewey Garrett and Andy Pugh

</pre><h4><b>LICENSE</b></h4><pre>
       GPL

LinuxCNC Documentation                             2025-08-07                                         <u><a href="../man9/MOVEOFF.9.html">MOVEOFF</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>