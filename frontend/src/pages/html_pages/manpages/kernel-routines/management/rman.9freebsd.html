<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rman,   rman_activate_resource,  rman_adjust_resource,  rman_deactivate_resource,  rman_fini,  rman_init,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       rman,   rman_activate_resource,  rman_adjust_resource,  rman_deactivate_resource,  rman_fini,  rman_init,
       rman_init_from_resource,     rman_is_region_manager,     rman_manage_region,      rman_first_free_region,
       rman_last_free_region,    rman_release_resource,    rman_reserve_resource,   rman_reserve_resource_bound,
       rman_make_alignment_flags, rman_get_start, rman_get_end, rman_get_device, rman_get_size,  rman_get_flags,
       rman_set_mapping, rman_get_mapping, rman_set_virtual, rman_get_virtual, rman_set_bustag, rman_get_bustag,
       rman_set_bushandle, rman_get_bushandle, rman_set_rid, rman_get_rid — resource management functions

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/types.h&gt;</b>
       <b>#include</b> <b>&lt;sys/rman.h&gt;</b>

       <u>int</u>
       <b>rman_activate_resource</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>int</u>
       <b>rman_adjust_resource</b>(<u>struct</u> <u>resource</u> <u>*r</u>, <u>rman_res_t</u> <u>start</u>, <u>rman_res_t</u> <u>end</u>);

       <u>int</u>
       <b>rman_deactivate_resource</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>int</u>
       <b>rman_fini</b>(<u>struct</u> <u>rman</u> <u>*rm</u>);

       <u>int</u>
       <b>rman_init</b>(<u>struct</u> <u>rman</u> <u>*rm</u>);

       <u>int</u>
       <b>rman_init_from_resource</b>(<u>struct</u> <u>rman</u> <u>*rm</u>, <u>struct</u> <u>resource</u> <u>*r</u>);

       <u>int</u>
       <b>rman_is_region_manager</b>(<u>struct</u> <u>resource</u> <u>*r</u>, <u>struct</u> <u>rman</u> <u>*rm</u>);

       <u>int</u>
       <b>rman_manage_region</b>(<u>struct</u> <u>rman</u> <u>*rm</u>, <u>rman_res_t</u> <u>start</u>, <u>rman_res_t</u> <u>end</u>);

       <u>int</u>
       <b>rman_first_free_region</b>(<u>struct</u> <u>rman</u> <u>*rm</u>, <u>rman_res_t</u> <u>*start</u>, <u>rman_res_t</u> <u>*end</u>);

       <u>int</u>
       <b>rman_last_free_region</b>(<u>struct</u> <u>rman</u> <u>*rm</u>, <u>rman_res_t</u> <u>*start</u>, <u>rman_res_t</u> <u>*end</u>);

       <u>int</u>
       <b>rman_release_resource</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>struct</u> <u>resource</u> <u>*</u>
       <b>rman_reserve_resource</b>(<u>struct</u> <u>rman</u> <u>*rm</u>,  <u>rman_res_t</u> <u>start</u>,  <u>rman_res_t</u> <u>end</u>, <u>rman_res_t</u> <u>count</u>, <u>u_int</u> <u>flags</u>,
           <u>struct</u> <u>device</u> <u>*dev</u>);

       <u>struct</u> <u>resource</u> <u>*</u>
       <b>rman_reserve_resource_bound</b>(<u>struct</u> <u>rman</u> <u>*rm</u>,    <u>rman_res_t</u> <u>start</u>,    <u>rman_res_t</u> <u>end</u>,    <u>rman_res_t</u> <u>count</u>,
           <u>rman_res_t</u> <u>bound</u>, <u>u_int</u> <u>flags</u>, <u>struct</u> <u>device</u> <u>*dev</u>);

       <u>uint32_t</u>
       <b>rman_make_alignment_flags</b>(<u>uint32_t</u> <u>size</u>);

       <u>rman_res_t</u>
       <b>rman_get_start</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>rman_res_t</u>
       <b>rman_get_end</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>struct</u> <u>device</u> <u>*</u>
       <b>rman_get_device</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>rman_res_t</u>
       <b>rman_get_size</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>u_int</u>
       <b>rman_get_flags</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>void</u>
       <b>rman_set_mapping</b>(<u>struct</u> <u>resource</u> <u>*r</u>, <u>struct</u> <u>resource_map</u> <u>*map</u>);

       <u>void</u>
       <b>rman_get_mapping</b>(<u>struct</u> <u>resource</u> <u>*r</u>, <u>struct</u> <u>resource_map</u> <u>*map</u>);

       <u>void</u>
       <b>rman_set_virtual</b>(<u>struct</u> <u>resource</u> <u>*r</u>, <u>void</u> <u>*v</u>);

       <u>void</u> <u>*</u>
       <b>rman_get_virtual</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>void</u>
       <b>rman_set_bustag</b>(<u>struct</u> <u>resource</u> <u>*r</u>, <u>bus_space_tag_t</u> <u>t</u>);

       <u>bus_space_tag_t</u>
       <b>rman_get_bustag</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>void</u>
       <b>rman_set_bushandle</b>(<u>struct</u> <u>resource</u> <u>*r</u>, <u>bus_space_handle_t</u> <u>h</u>);

       <u>bus_space_handle_t</u>
       <b>rman_get_bushandle</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

       <u>void</u>
       <b>rman_set_rid</b>(<u>struct</u> <u>resource</u> <u>*r</u>, <u>int</u> <u>rid</u>);

       <u>int</u>
       <b>rman_get_rid</b>(<u>struct</u> <u>resource</u> <u>*r</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>rman</b> set of functions provides a flexible resource management abstraction.  It is used extensively by
       the  bus management code.  It implements the abstractions of region and resource.  A region descriptor is
       used to manage a region; this could be memory or some other form of bus space.

       Each region has a set of bounds.  Within these bounds, allocated  segments  may  reside.   Each  segment,
       termed a resource, has several properties which are represented by a 16-bit flag register, as follows.

       #define RF_ALLOCATED    0x0001 /* resource has been reserved */
       #define RF_ACTIVE       0x0002 /* resource allocation has been activated */
       #define RF_SHAREABLE    0x0004 /* resource permits contemporaneous sharing */
       #define RF_FIRSTSHARE   0x0020 /* first in sharing list */
       #define RF_PREFETCHABLE 0x0040 /* resource is prefetchable */
       #define RF_UNMAPPED     0x0100 /* don't map resource when activating */

       Bits  15:10   of the flag register are used to represent the desired alignment of the resource within the
       region.

       The <b>rman_init</b>() function initializes the region descriptor, pointed to by the <u>rm</u> argument, for  use  with
       the resource management functions.  It is required that the fields <u>rm_type</u> and <u>rm_descr</u> of <u>struct</u> <u>rman</u> be
       set  before calling <b>rman_init</b>().  The field <u>rm_type</u> shall be set to RMAN_ARRAY.  The field <u>rm_descr</u> shall
       be set to a string that describes the resource to be managed.  The <u>rm_start</u> and <u>rm_end</u> fields may be  set
       to  limit  the  range  of  acceptable  resource addresses.  If these fields are not set, <b>rman_init</b>() will
       initialize them to allow the entire range  of  resource  addresses.   It  also  initializes  any  mutexes
       associated  with  the  structure.   If  <b>rman_init</b>() fails to initialize the mutex, it will return ENOMEM;
       otherwise it will return 0 and <u>rm</u> will be initialized.

       The <b>rman_fini</b>() function frees any structures  associated  with  the  structure  pointed  to  by  the  <u>rm</u>
       argument.   If  any  of  the  resources within the managed region have the RF_ALLOCATED flag set, it will
       return EBUSY; otherwise, any mutexes associated with the structure will be released  and  destroyed,  and
       the function will return 0.

       The  <b>rman_manage_region</b>()  function establishes the concept of a region which is under <b>rman</b> control.  The
       <u>rman</u> argument points to the region descriptor.  The <u>start</u> and <u>end</u> arguments specify  the  bounds  of  the
       region.   If  successful,  <b>rman_manage_region</b>()  will  return 0.  If the region overlaps with an existing
       region, it will return EBUSY.  If any part of the region falls outside of the valid address range for <u>rm</u>,
       it will return EINVAL.  ENOMEM will be returned when <b>rman_manage_region</b>() failed to allocate  memory  for
       the region.

       The  <b>rman_init_from_resource</b>()  function  is  a wrapper routine to create a resource manager backed by an
       existing resource.  It initializes <u>rm</u> using <b>rman_init</b>() and then adds a region to <u>rm</u> corresponding to the
       address range allocated to <u>r</u> via <b>rman_manage_region</b>().

       The <b>rman_first_free_region</b>() and <b>rman_last_free_region</b>() functions  can  be  used  to  query  a  resource
       manager  for its first (or last) unallocated region.  If <u>rm</u> contains no free region, these functions will
       return ENOENT.  Otherwise, <u>*start</u> and <u>*end</u> are set to the bounds of the free region and zero is returned.

       The <b>rman_reserve_resource_bound</b>() function is where the bulk of the <b>rman</b> logic is located.   It  attempts
       to  reserve  a contiguous range in the specified region <u>rm</u> for the use of the device <u>dev</u>.  The caller can
       specify the <u>start</u> and <u>end</u> of an acceptable  range,  as  well  as  a  boundary  restriction  and  required
       aligment,  and the code will attempt to find a free segment which fits.  The <u>start</u> argument is the lowest
       acceptable starting value of the resource.  The <u>end</u> argument is the highest acceptable  ending  value  of
       the  resource.   Therefore,  <u>start</u>  + <u>count</u> - 1 must be ≤ <u>end</u> for any allocation to happen.  The aligment
       requirement (if any) is specified in <u>flags</u>.  The  <u>bound</u>  argument  may  be  set  to  specify  a  boundary
       restriction  such  that an allocated region may cross an address that is a multiple of the boundary.  The
       <u>bound</u> argument must be a power of two.  It may be set to zero to  specify  no  boundary  restriction.   A
       shared  segment will be allocated if the RF_SHAREABLE flag is set, otherwise an exclusive segment will be
       allocated.  If this shared segment already exists, the caller  has  its  device  added  to  the  list  of
       consumers.

       The <b>rman_reserve_resource</b>() function is used to reserve resources within a previously established region.
       It is a simplified interface to <b>rman_reserve_resource_bound</b>() which passes 0 for the <u>bound</u> argument.

       The  <b>rman_make_alignment_flags</b>()  function  returns  the flag mask corresponding to the desired alignment
       <u>size</u>.  This should be used when calling <b>rman_reserve_resource_bound</b>().

       The <b>rman_is_region_manager</b>() function returns true if the allocated resource <u>r</u>  was  allocated  from  <u>rm</u>.
       Otherwise, it returns false.

       The <b>rman_adjust_resource</b>() function is used to adjust the reserved address range of an allocated resource
       to  reserve  <u>start</u> through <u>end</u>.  It can be used to grow or shrink one or both ends of the resource range.
       The current implementation does not support entirely relocating the resource and will fail with EINVAL if
       the new resource range does not overlap the old resource range.  If either  end  of  the  resource  range
       grows  and  the new resource range would conflict with another allocated resource, the function will fail
       with EBUSY.  The <b>rman_adjust_resource</b>() function does not support adjusting the resource range for shared
       resources and will fail such attempts with EINVAL.  Upon success,  the  resource  <u>r</u>  will  have  a  start
       address  of  <u>start</u>  and  an  end address of <u>end</u> and the function will return zero.  Note that none of the
       constraints of the original allocation request such as alignment or boundary restrictions are checked  by
       <b>rman_adjust_resource</b>().  It is the caller's responsibility to enforce any such requirements.

       The  <b>rman_release_resource</b>() function releases the reserved resource <u>r</u>.  It may attempt to merge adjacent
       free resources.

       The <b>rman_activate_resource</b>() function marks a resource as active, by setting the RF_ACTIVE flag.  If this
       is a time shared resource, and the caller has not yet acquired the resource, the function returns EBUSY.

       The <b>rman_deactivate_resource</b>() function marks a resource <u>r</u> as inactive, by clearing the  RF_ACTIVE  flag.
       If other consumers are waiting for this range, it will wakeup their threads.

       The  <b>rman_get_start</b>(), <b>rman_get_end</b>(), <b>rman_get_size</b>(), and <b>rman_get_flags</b>() functions return the bounds,
       size and flags of the previously reserved resource <u>r</u>.

       The <b>rman_set_bustag</b>() function associates a <u>bus_space_tag_t</u> <u>t</u> with the resource <u>r</u>.  The <b>rman_get_bustag</b>()
       function is used to retrieve this tag once set.

       The  <b>rman_set_bushandle</b>()  function  associates  a  <u>bus_space_handle_t</u>  <u>h</u>  with  the  resource  <u>r</u>.    The
       <b>rman_get_bushandle</b>() function is used to retrieve this handle once set.

       The  <b>rman_set_virtual</b>()  function  is  used to associate a kernel virtual address with a resource <u>r</u>.  The
       <b>rman_get_virtual</b>() function can be used to retrieve the KVA once set.

       The <b>rman_set_mapping</b>() function is used to associate a resource mapping with a resource <u>r</u>.   The  mapping
       must  cover the entire resource.  Setting a mapping sets the associated <u><a href="../man9/bus_space.9.html">bus_space</a></u>(9) handle and tag for <u>r</u>
       as well as the kernel virtual address if the mapping  contains  one.   These  individual  values  can  be
       retrieved via <b>rman_get_bushandle</b>(), <b>rman_get_bustag</b>(), and <b>rman_get_virtual</b>().

       The <b>rman_get_mapping</b>() function can be used to retrieve the associated resource mapping once set.

       The  <b>rman_set_rid</b>()  function  associates  a  resource  identifier with a resource <u>r</u>.  The <b>rman_get_rid</b>()
       function retrieves this RID.

       The <b>rman_get_device</b>() function returns a pointer to the device which reserved the resource <u>r</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man9/bus_activate_resource.9.html">bus_activate_resource</a></u>(9),     <u><a href="../man9/bus_adjust_resource.9.html">bus_adjust_resource</a></u>(9),     <u><a href="../man9/bus_alloc_resource.9.html">bus_alloc_resource</a></u>(9),     <u><a href="../man9/bus_map_resource.9.html">bus_map_resource</a></u>(9),
       <u><a href="../man9/bus_release_resource.9.html">bus_release_resource</a></u>(9), <u><a href="../man9/bus_set_resource.9.html">bus_set_resource</a></u>(9), <u><a href="../man9/bus_space.9.html">bus_space</a></u>(9), <u><a href="../man9/mutex.9.html">mutex</a></u>(9)

</pre><h4><b>AUTHORS</b></h4><pre>
       This manual page was written by Bruce M Simpson &lt;<u><a href="mailto:bms@spc.org">bms@spc.org</a></u>&gt;.

Debian                                            May 20, 2016                                           <u><a href="../man9/RMAN.9.html">RMAN</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>