<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MemGuard — memory allocator for debugging purposes</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       MemGuard — memory allocator for debugging purposes

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>options</b> <b>DEBUG_MEMGUARD</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>MemGuard</b>  is  a  simple  and small replacement memory allocator designed to help detect tamper-after-free
       scenarios.  These problems are more and more common and likely  with  multithreaded  kernels  where  race
       conditions are more prevalent.

       <b>MemGuard</b>  can  take over <b>malloc</b>(), <b>realloc</b>() and <b>free</b>() for a single malloc type.  Alternatively <b>MemGuard</b>
       can take over <b>uma_zalloc</b>(), <b>uma_zalloc_arg</b>() and <b>uma_free</b>() for a single <u><a href="../man9/uma.9.html">uma</a></u>(9) zone.  Also <b>MemGuard</b>  can
       guard  all  allocations larger than PAGE_SIZE, and can guard a random fraction of all allocations.  There
       is also a knob to prevent allocations smaller than a specified size from being guarded, to  limit  memory
       waste.

</pre><h4><b>EXAMPLES</b></h4><pre>
       To use <b>MemGuard</b> for a memory type, either add an entry to <u>/boot/loader.conf</u>:

             vm.memguard.desc=&lt;memory_type&gt;

       Or set the <u>vm.memguard.desc</u> <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8) variable at run-time:

             sysctl vm.memguard.desc=&lt;memory_type&gt;

       Where  <u>memory_type</u> can be either a short description of the memory type to monitor, either name of <u><a href="../man9/uma.9.html">uma</a></u>(9)
       zone.  Only allocations from that <u>memory_type</u> made after <u>vm.memguard.desc</u>  is  set  will  potentially  be
       guarded.   If  <u>vm.memguard.desc</u> is modified at run-time then only allocations of the new <u>memory_type</u> will
       potentially be guarded once the <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8) is set.  Existing guarded allocations will  still  be  properly
       released by either <u><a href="../man9/free.9.html">free</a></u>(9) or <u><a href="../man9/uma_zfree.9.html">uma_zfree</a></u>(9), depending on what kind of allocation was taken over.

       To  determine  short  description  of  a  <u><a href="../man9/malloc.9.html">malloc</a></u>(9)  type one can either take it from the first column of
       <u><a href="../man8/vmstat.8.html">vmstat</a></u>(8) <b>-m</b> output, or to find it in the kernel source.  It is the second argument  to  <u><a href="../man9/MALLOC_DEFINE.9.html">MALLOC_DEFINE</a></u>(9)
       macro.   To  determine  name  of <u><a href="../man9/uma.9.html">uma</a></u>(9) zone one can either take it from the first column of <u><a href="../man8/vmstat.8.html">vmstat</a></u>(8) <b>-z</b>
       output, or to find it in the kernel source.  It is the first argument to the <u><a href="../man9/uma_zcreate.9.html">uma_zcreate</a></u>(9) function.

       The <u>vm.memguard.divisor</u> boot-time tunable is used to scale how  much  of  the  system's  physical  memory
       <b>MemGuard</b>  is  allowed  to consume.  The default is 10, so up to <u>vm_cnt.v_page_count</u>/10 pages can be used.
       <b>MemGuard</b> will reserve <u>vm_kmem_max</u> / <u>vm.memguard.divisor</u> bytes of virtual address space, limited by  twice
       the physical memory size.  The physical limit is reported as <u>vm.memguard.phys_limit</u> and the virtual space
       reserved for <b>MemGuard</b> is reported as <u>vm.memguard.mapsize</u>.

       <b>MemGuard</b>  will  not  do  page  promotions for any allocation smaller than <u>vm.memguard.minsize</u> bytes.  The
       default is 0, meaning all allocations can potentially be guarded.  <b>MemGuard</b> can guard sufficiently  large
       allocations  randomly, with average frequency of every one in 100000 / <u>vm.memguard.frequency</u> allocations.
       The default is 0, meaning no allocations are randomly guarded.

       <b>MemGuard</b> can optionally add unmapped guard pages around each allocation to detect overflow and underflow,
       if <u>vm.memguard.options</u> has the 1 bit set.  This option is enabled by default.  <b>MemGuard</b>  will  optionally
       guard  all  allocations  of PAGE_SIZE or larger if <u>vm.memguard.options</u> has the 2 bit set.  This option is
       off by default.  By default <b>MemGuard</b> does not guard <u><a href="../man9/uma.9.html">uma</a></u>(9) zones that  have  been  initialized  with  the
       UMA_ZONE_NOFREE flag set, since it can produce false positives on them.  However, this safety measure can
       be turned off by setting bit 3 of the <u>vm.memguard.options</u> tunable.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8), <u><a href="../man8/vmstat.8.html">vmstat</a></u>(8), <u><a href="../man9/contigmalloc.9.html">contigmalloc</a></u>(9), <u><a href="../man9/malloc.9.html">malloc</a></u>(9), <u><a href="../man9/redzone.9.html">redzone</a></u>(9), <u><a href="../man9/uma.9.html">uma</a></u>(9)

</pre><h4><b>HISTORY</b></h4><pre>
       <b>MemGuard</b> first appeared in FreeBSD 6.0.

</pre><h4><b>AUTHORS</b></h4><pre>
       <b>MemGuard</b> was originally written by Bosko Milekic &lt;<u><a href="mailto:bmilekic@FreeBSD.org">bmilekic@FreeBSD.org</a></u>&gt;.  This manual page was originally
       written  by  Christian  Brueffer  &lt;<u><a href="mailto:brueffer@FreeBSD.org">brueffer@FreeBSD.org</a></u>&gt;.   Additions  have  been made by Matthew Fleming
       &lt;<u><a href="mailto:mdf@FreeBSD.org">mdf@FreeBSD.org</a></u>&gt;  and  Gleb  Smirnoff  &lt;<u><a href="mailto:glebius@FreeBSD.org">glebius@FreeBSD.org</a></u>&gt;  to  both  the   implementation   and   the
       documentation.

Debian                                           March 22, 2017                                      <u><a href="../man9/MEMGUARD.9.html">MEMGUARD</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>