<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>config_intrhook  —  schedule  a function to be run after interrupts have been enabled, but before root is</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       config_intrhook  —  schedule  a function to be run after interrupts have been enabled, but before root is
       mounted

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/kernel.h&gt;</b>

       <u>typedef</u> <u>void</u> <u>(*ich_func_t)(void</u> <u>*arg);</u>

       <u>int</u>
       <b>config_intrhook_establish</b>(<u>struct</u> <u>intr_config_hook</u> <u>*hook</u>);

       <u>void</u>
       <b>config_intrhook_disestablish</b>(<u>struct</u> <u>intr_config_hook</u> <u>*hook</u>);

       <u>void</u>
       <b>config_intrhook_oneshot</b>(<u>ich_func_t</u> <u>func</u>, <u>void</u> <u>*arg</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>config_intrhook_establish</b>() function schedules a function  to  be  run  after  interrupts  have  been
       enabled,  but before root is mounted.  If the system has already passed this point in its initialization,
       the function is called immediately.

       The <b>config_intrhook_disestablish</b>() function removes the entry from the hook queue.

       The  <b>config_intrhook_oneshot</b>()  function  schedules   a   function   to   be   run   as   described   for
       <b>config_intrhook_establish</b>();  the  entry is automatically removed from the hook queue after that function
       runs.  This is appropriate when additional  device  configuration  must  be  done  after  interrupts  are
       enabled, but there is no need to stall the boot process after that.  This function allocates memory using
       M_WAITOK; do not call this while holding any non-sleepable locks.

       Before  root  is mounted, all the previously established hooks are run.  The boot process is then stalled
       until all handlers remove their hook from the hook queue with <b>config_intrhook_disestablish</b>().   The  boot
       process  then proceeds to attempt to mount the root file system.  Any driver that can potentially provide
       devices they wish to be mounted as root must use either this hook, or probe  all  these  devices  in  the
       initial  probe.   Since  interrupts  are disabled during the probe process, many drivers need a method to
       probe for devices with interrupts enabled.

       The requests are made with the <u>intr_config_hook</u> structure.  This structure is defined as follows:

       struct intr_config_hook {
               TAILQ_ENTRY(intr_config_hook) ich_links;/* Private */
               ich_func_t      ich_func;               /* function to call */
               void            *ich_arg;               /* Argument to call */
       };

       Storage for the <u>intr_config_hook</u> structure must be provided by the driver.  It must be stable  from  just
       before the hook is established until after the hook is disestablished.

       Specifically,  hooks  are  run  at <b>SI_SUB_INT_CONFIG_HOOKS</b>(), which is immediately after the scheduler is
       started, and just before the root file system device is discovered.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       A zero return value means the hook was successfully added to the queue (with either deferred or immediate
       execution).  A non-zero return value means the hook could not be  added  to  the  queue  because  it  was
       already on the queue.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man9/DEVICE_ATTACH.9.html">DEVICE_ATTACH</a></u>(9)

</pre><h4><b>HISTORY</b></h4><pre>
       These  functions  were introduced in FreeBSD 3.0 with the CAM subsystem, but are available for any driver
       to use.

</pre><h4><b>AUTHORS</b></h4><pre>
       The functions were written by Justin Gibbs &lt;<u><a href="mailto:gibbs@FreeBSD.org">gibbs@FreeBSD.org</a></u>&gt;.  This  manual  page  was  written  by  M.
       Warner Losh &lt;<u><a href="mailto:imp@FreeBSD.org">imp@FreeBSD.org</a></u>&gt;.

Debian                                           August 10, 2017                              <u><a href="../man9/CONFIG_INTRHOOK.9.html">CONFIG_INTRHOOK</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>