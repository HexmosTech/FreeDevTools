<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVENTHANDLER — kernel event handling functions</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       EVENTHANDLER — kernel event handling functions

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/eventhandler.h&gt;</b>

       <b>EVENTHANDLER_DECLARE</b>(<u>name</u>, <u>type</u>);

       <b>EVENTHANDLER_DEFINE</b>(<u>name</u>, <u>func</u>, <u>arg</u>, <u>priority</u>);

       <b>EVENTHANDLER_INVOKE</b>(<u>name</u>, <u>...</u>);

       <u>eventhandler_tag</u>
       <b>EVENTHANDLER_REGISTER</b>(<u>name</u>, <u>func</u>, <u>arg</u>, <u>priority</u>);

       <b>EVENTHANDLER_DEREGISTER</b>(<u>name</u>, <u>tag</u>);

       <b>EVENTHANDLER_DEREGISTER_NOWAIT</b>(<u>name</u>, <u>tag</u>);

       <b>EVENTHANDLER_LIST_DECLARE</b>(<u>name</u>);

       <b>EVENTHANDLER_LIST_DEFINE</b>(<u>name</u>);

       <b>EVENTHANDLER_DIRECT_INVOKE</b>(<u>name</u>);

       <u>eventhandler_tag</u>
       <b>eventhandler_register</b>(<u>struct</u> <u>eventhandler_list</u> <u>*list</u>,     <u>const</u> <u>char</u> <u>*name</u>,     <u>void</u> <u>*func</u>,    <u>void</u> <u>*arg</u>,
           <u>int</u> <u>priority</u>);

       <u>void</u>
       <b>eventhandler_deregister</b>(<u>struct</u> <u>eventhandler_list</u> <u>*list</u>, <u>eventhandler_tag</u> <u>tag</u>);

       <u>void</u>
       <b>eventhandler_deregister_nowait</b>(<u>struct</u> <u>eventhandler_list</u> <u>*list</u>, <u>eventhandler_tag</u> <u>tag</u>);

       <u>struct</u> <u>eventhandler_list</u> <u>*</u>
       <b>eventhandler_find_list</b>(<u>const</u> <u>char</u> <u>*name</u>);

       <u>void</u>
       <b>eventhandler_prune_list</b>(<u>struct</u> <u>eventhandler_list</u> <u>*list</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>EVENTHANDLER</b> mechanism provides a way for kernel subsystems to register interest in kernel events and
       have their callback functions invoked when these events occur.

       Callback functions are invoked in order of priority.  The relative priority of each callback among  other
       callbacks  associated  with  an  event  is  given  by argument <u>priority</u>, which is an integer ranging from
       EVENTHANDLER_PRI_FIRST (highest  priority),  to  EVENTHANDLER_PRI_LAST  (lowest  priority).   The  symbol
       EVENTHANDLER_PRI_ANY may be used if the handler does not have a specific priority associated with it.

       The  normal  way to use this subsystem is via the macro interface.  For events that are high frequency it
       is suggested that you additionally use <b>EVENTHANDLER_LIST_DEFINE</b>() so  that  the  event  handlers  can  be
       invoked  directly  using <b>EVENTHANDLER_DIRECT_INVOKE</b>() (see below).  This saves the invoker from having to
       do a locked traversal of a global list of event handler lists.

       <b>EVENTHANDLER_DECLARE</b>()
               This macro declares an event handler named by argument <u>name</u> with callback functions of type <u>type</u>.

       <b>EVENTHANDLER_DEFINE</b>()
               This macro uses <u><a href="../man9/SYSINIT.9.html">SYSINIT</a></u>(9) to register a callback function <u>func</u> with event  handler  <u>name</u>.   When
               invoked,  function  <u>func</u>  will be invoked with argument <u>arg</u> as its first parameter along with any
               additional parameters passed in via macro <b>EVENTHANDLER_INVOKE</b>() (see below).

       <b>EVENTHANDLER_REGISTER</b>()
               This macro registers a callback function <u>func</u> with event handler <u>name</u>.   When  invoked,  function
               <u>func</u>  will  be  invoked  with  argument  <u>arg</u>  as  its  first  parameter along with any additional
               parameters passed in via macro <b>EVENTHANDLER_INVOKE</b>() (see below).  If registration is successful,
               <b>EVENTHANDLER_REGISTER</b>() returns a cookie of type <u>eventhandler_tag</u>.

       <b>EVENTHANDLER_DEREGISTER</b>()
               This macro removes a previously registered callback  associated  with  tag  <u>tag</u>  from  the  event
               handler  named  by  argument <u>name</u>.  It waits until no threads are running handlers for this event
               before returning, making it safe to unload a module immediately upon return from this function.

       <b>EVENTHANDLER_DEREGISTER_NOWAIT</b>()
               This macro removes a previously registered callback  associated  with  tag  <u>tag</u>  from  the  event
               handler  named  by  argument  <u>name</u>.   Upon return, one or more threads could still be running the
               removed function(s), but no new calls will be made.  To remove a  handler  function  from  within
               that function, use this version of deregister, to avoid a deadlock.

       <b>EVENTHANDLER_INVOKE</b>()
               This macro is used to invoke all the callbacks associated with event handler <u>name</u>.  This macro is
               a  variadic  one.   Additional  arguments to the macro after the <u>name</u> parameter are passed as the
               second and subsequent arguments to each registered callback function.

       <b>EVENTHANDLER_LIST_DEFINE</b>()
               This macro defines a reference to an  event  handler  list  named  by  argument  <u>name</u>.   It  uses
               <u><a href="../man9/SYSINIT.9.html">SYSINIT</a></u>(9) to initialize the reference and the eventhandler list.

       <b>EVENTHANDLER_LIST_DECLARE</b>()
               This  macro declares an event handler list named by argument <u>name</u>.  This is only needed for users
               of <b>EVENTHANDLER_DIRECT_INVOKE</b>() which are not  in  the  same  compilation  unit  of  that  list's
               definition.

       <b>EVENTHANDLER_DIRECT_INVOKE</b>()
               This macro invokes the event handlers registered for the list named by argument <u>name</u>.  This macro
               can  only be used if the list was defined with <b>EVENTHANDLER_LIST_DEFINE</b>().  The macro is variadic
               with the same semantics as <b>EVENTHANDLER_INVOKE</b>().

       The macros are implemented using the following functions:

       <b>eventhandler_register</b>()
               The <b>eventhandler_register</b>() function is used to register a callback  with  a  given  event.   The
               arguments expected by this function are:

               <u>list</u>      A  pointer  to  an  existing  event  handler list, or NULL.  If <u>list</u> is NULL, the event
                         handler list corresponding to argument <u>name</u> is used.

               <u>name</u>      The name of the event handler list.

               <u>func</u>      A pointer to a callback function.  Argument <u>arg</u> is passed to the callback function <u>func</u>
                         as its first argument when it is invoked.

               <u>priority</u>  The relative priority of this callback among all  the  callbacks  registered  for  this
                         event.    Valid   values   are   those   in   the   range   EVENTHANDLER_PRI_FIRST   to
                         EVENTHANDLER_PRI_LAST.

               The  <b>eventhandler_register</b>()  function  returns   a   <u>tag</u>   that   can   later   be   used   with
               <b>eventhandler_deregister</b>() to remove the particular callback function.

       <b>eventhandler_deregister</b>()
               The  <b>eventhandler_deregister</b>()  function  removes  the  callback associated with tag <u>tag</u> from the
               event handler list pointed to by <u>list</u>.  If <u>tag</u> is <u>NULL</u>, all callback functions for the event  are
               removed.   This  function  will not return until all threads have exited from the removed handler
               callback function(s).  This function is not safe to call from inside an event handler callback.

       <b>eventhandler_deregister_nowait</b>()
               The <b>eventhandler_deregister</b>() function removes the callback associated  with  tag  <u>tag</u>  from  the
               event  handler  list  pointed  to  by  <u>list</u>.   This function is safe to call from inside an event
               handler callback.

       <b>eventhandler_find_list</b>()
               The  <b>eventhandler_find_list</b>()  function  returns  a  pointer  to  event  handler  list  structure
               corresponding to event <u>name</u>.

       <b>eventhandler_prune_list</b>()
               The  <b>eventhandler_prune_list</b>()  function  removes  all deregistered callbacks from the event list
               <u>list</u>.

   <b>Kernel</b> <b>Event</b> <b>Handlers</b>
       The following event handlers are present in the kernel:

       <u>acpi_sleep_event</u>
               Callbacks invoked when the system is being sent to sleep.

       <u>acpi_wakeup_event</u>
               Callbacks invoked when the system is being woken up.

       <u>app_coredump_start</u>
               Callbacks invoked at start of application core dump.

       <u>app_coredump_progress</u>
               Callbacks invoked during progress of application core dump.

       <u>app_coredump_finish</u>
               Callbacks invoked at finish of application core dump.

       <u>app_coredump_error</u>
               Callbacks invoked on error of application core dump.

       <u>bpf_track</u>
               Callbacks invoked when a BPF listener attaches to/detaches from network interface.

       <u>cpufreq_levels_changed</u>
               Callback invoked when cpu frequency levels have changed.

       <u>cpufreq_post_change</u>
               Callback invoked after cpu frequency has changed.

       <u>cpufreq_pre_change</u>
               Callback invoked before cpu frequency has changed.

       <u>dcons_poll</u>
               Callback invoked to poll for dcons changes.

       <u>device_attach</u>
               Callback invoked after a device has attached.

       <u>device_detach</u>
               Callbacks invoked before and after a device has detached.

       <u>dev_clone</u>
               Callbacks invoked when a new entry is created under <u><a href="file:/dev">/dev</a></u>.

       <u>group_attach_event</u>
               Callback invoked when an interfance has been added to an interface group.

       <u>group_change_event</u>
               Callback invoked when an change has been made to an interface group.

       <u>group_detach_event</u>
               Callback invoked when an interfance has been removed from an interface group.

       <u>ifaddr_event</u>
               Callbacks invoked when an address is set up on a network interface.

       <u>ifaddr_event_ext</u>
               Callback invoked when an address has been added or removed from an interface.

       <u>if_clone_event</u>
               Callbacks invoked when an interface is cloned.

       <u>iflladdr_event</u>
               Callback invoked when an if link layer address event has happened.

       <u>ifnet_arrival_event</u>
               Callbacks invoked when a new network interface appears.

       <u>ifnet_departure_event</u>
               Callbacks invoked when a network interface is taken down.

       <u>ifnet_link_event</u>
               Callback invoked when an interfance link event has happened.

       <u>kld_load</u>
               Callbacks invoked after a linker file has been loaded.

       <u>kld_unload</u>
               Callbacks invoked after a linker file has been successfully unloaded.

       <u>kld_unload_try</u>
               Callbacks invoked before a linker file is about to be unloaded.  These callbacks may be  used  to
               return an error and prevent the unload from proceeding.

       <u>lle_event</u>
               Callback invoked when an link layer event has happened.

       <u>nmbclusters_change</u>
               Callback invoked when the number of mbuf clusters has changed.

       <u>nmbufs_change</u>
               Callback invoked when the number of mbufs has changed.

       <u>maxsockets_change</u>
               Callback invoked when the maximum number of sockets has changed.

       <u>mountroot</u>
               Callback invoked when root has been mounted.

       <u>power_profile_change</u>
               Callbacks invoked when the power profile of the system changes.

       <u>power_resume</u>
               Callback invoked when the system has resumed.

       <u>power_suspend</u>
               Callback invoked just before the system is suspended.

       <u>process_ctor</u>
               Callback invoked when a process is created.

       <u>process_dtor</u>
               Callback invoked when a process is destroyed.

       <u>process_exec</u>
               Callbacks invoked when a process performs an <b>exec</b>() operation.

       <u>process_exit</u>
               Callbacks invoked when a process exits.

       <u>process_fini</u>
               Callback invoked when a process memory is destroyed.  This is never called.

       <u>process_fork</u>
               Callbacks invoked when a process forks a child.

       <u>process_init</u>
               Callback invoked when a process is initialized.

       <u>random_adaptor_attach</u>
               Callback invoked when a new random module has been loaded.

       <u>register_framebuffer</u>
               Callback invoked when a new frame buffer is registered.

       <u>route_redirect_event</u>
               Callback invoked when a route gets redirected to a new location.

       <u>shutdown_pre_sync</u>
               Callbacks invoked at shutdown time, before file systems are synchronized.

       <u>shutdown_post_sync</u>
               Callbacks invoked at shutdown time, after all file systems are synchronized.

       <u>shutdown_final</u>
               Callbacks invoked just before halting the system.

       <u>tcp_offload_listen_start</u>
               Callback invoked for TCP Offload to start listening for new connections.

       <u>tcp_offload_listen_stop</u>
               Callback invoked ror TCP Offload to stop listening for new connections.

       <u>thread_ctor</u>
               Callback invoked when a thread object is created.

       <u>thread_dtor</u>
               Callback invoked when a thread object is destroyed.

       <u>thread_init</u>
               Callback invoked when a thread object is initialized.

       <u>thread_fini</u>
               Callback invoked when a thread object is deinitalized.

       <u>usb_dev_configured</u>
               Callback invoked when a USB device is configured

       <u>unregister_framebuffer</u>
               Callback invoked when a frame buffer is deregistered.

       <u>vfs_mounted</u>
               Callback invoked when a file system is mounted.

       <u>vfs_unmounted</u>
               Callback invoked when a file system is unmounted.

       <u>vlan_config</u>
               Callback invoked when the vlan configuration has changed.

       <u>vlan_unconfig</u>
               Callback invoked when a vlan is destroyed.

       <u>vm_lowmem</u>
               Callbacks invoked when virtual memory is low.

       <u>watchdog_list</u>
               Callbacks invoked when the system watchdog timer is reinitialized.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       The   macro  <b>EVENTHANDLER_REGISTER</b>()  and  function  <b>eventhandler_register</b>()  return  a  cookie  of  type
       <u>eventhandler_tag</u>,  which  may  be  used  in   a   subsequent   call   to   <b>EVENTHANDLER_DEREGISTER</b>()   or
       <b>eventhandler_deregister</b>().

       The  <b>eventhandler_find_list</b>()  function  returns  a  pointer  to  an  event handler list corresponding to
       parameter <u>name</u>, or NULL if no such list was found.

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>EVENTHANDLER</b> facility first appeared in FreeBSD 4.0.

</pre><h4><b>AUTHORS</b></h4><pre>
       This manual page was written by Joseph Koshy &lt;<u><a href="mailto:jkoshy@FreeBSD.org">jkoshy@FreeBSD.org</a></u>&gt; and
       Matt Joras &lt;<u><a href="mailto:mjoras@FreeBSD.org">mjoras@FreeBSD.org</a></u>&gt;.

Debian                                          October 21, 2018                                 <u><a href="../man9/EVENTHANDLER.9.html">EVENTHANDLER</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>