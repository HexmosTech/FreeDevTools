<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>carousel - Orient a toolchanger carousel using various encoding schemes</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/linuxcnc-uspace">linuxcnc-uspace_2.9.4-2ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       carousel - Orient a toolchanger carousel using various encoding schemes

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>loadrt</b> <b>carousel</b> <b>pockets=</b><u>N</u>[,<u>N</u>] <b>encoding=</b><u>ssss</u>[,<u>sss</u>] <b>num_sense=</b><u>N</u>[,<u>N</u>] <b>dir=</b><u>N</u>[,<u>N]</u>

           <b>pockets</b> The number of pockets in each toolchanger.
                  Use up to 8 numbers separated by commas to create multiple carousel components.

           <b>encoding</b> The position encoding.
                  gray, binary, bcd, index, edge, counts or single. Default = 'gray'

           <b>num_sense</b> The number of position sense pins.
                  Default = 4.

           <b>dir</b> Set to 1 for unidirectional or  2 for bidirectional operation.
                  Default = bidirectional

           <b>parity</b> Set to 1 for odd parity, 0 for even parity checking.
                  Default = 0 (even)

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This component is intended to help operate various types of carousel-type toolchangers.

       The component can be configured to operate with binary, binary-coded decimal (BCD) or gray-coded position
       feedback  ('binary;, 'bcd' and 'gray' modes) It can alternatively work with an individual sensor for each
       tool position ('single' mode) or with a sensor at each tool position and a separate index ('index' mode).
       Systems using a stepper motor or quadrature encoder are  also  supported  ('counts'  mode).   <b>edge</b>  is  a
       special  case  of  index  mode for tool changers with pockets on both the rising and falling edges of the
       position sensor.  (Seen on at least one Denford Orac.)

       Both unidirectional and bidirectional systems are supported and those that reverse against a stop when in
       position.

       The number of carousel component instances created depends on the number  of  entries  in  the  'pockets'
       modparam. For example

       <b>loadrt</b> <b>carousel</b> <b>pockets=10,10,8</b>

       Would create 3 carousel instances with 10, 10 and 8 pockets. The other parameters are optional. If absent
       then defaults will be used. Any missing entry will assume the previous value.

       When  the  enable pin is set to true the component will immediately set the "active" pin to true and then
       (for a bidirectional  instance)  calculate  the  shortest  path  to  the  requested  pocket  number.  The
       appropriate  motor  direction  output  pins  will  then  be  set. Bit outputs for forward and reverse are
       provided as well as a three-state velocity output for driving a DC motor PWM or a velocity-mode stepgen.

       The component will monitor the carousel position and, when the  correct  position  is  reached,  set  the
       motor-control pins to 0, set "active" to 0 and set "ready" to 1.

       In  'index',  'edge'  or  'counts'mode there is a need to find the initial home position of the carousel.
       The first time that the "enable" pin is set; the carousel will  rotate  forwards  searching  for  a  home
       signal.  In  'index'  and  'edge' mode this is when both the index and pulse inputs are true. In 'counts'
       mode only the index input needs to be set to set home. Additionally in 'counts'  mode  the  usual  index-
       enable logic of the encoder counters is supported.

       With some carousel designs the carousel will not stop immediately. To allow for this set the <b>align-dc</b> pin
       to a low velocity to be used for a final latching move, and set the <b>decel-time</b> to a suitable value.  Once
       the  decel-time has expired the carousel will, if it was moving forwards, reverse back on to the position
       marker, off of the marker and then back on to the FWD edge. If moving in reverse it will continue off the
       marker and then reverse slowly on to the FWD edge.  This alignment is  only  possible  with  a  motor-vel
       controlled  bidirectional  carousel,  Other  combinations  will be acepted but probably will not have the
       desired behaviour.  Some tuning will be needed of align-dc and decel-time to achieve reliable operation.

       In the unusual case that the index and pulse signals do not align it is possible  to  use  HAL  logic  to
       achieve the desired pin switching during homing.

       Setting  "enable" low does not halt the homing move, so if homing on first tool change is not needed then
       the enable pin can be toggled by an axis homing pin or a script and the homing process will continue even
       if that driving signal resets during the carousel homing move.

       To operate the component with an encoder or stepgen use mode "C". The <b>scale</b> pin should be the  number  of
       steps or encoder counts between pocket centres. The <b>width</b> pin can be used to stop the motor some distance
       before the centre of the pocket to allow the motor time to decelerate.  In mode "C" it is possible to use
       either  the  speed/direction control used in other modes or to use direct position mode using the counts-
       target pin. The internal scaling of the encoder or stepgen should be set to 1.0. A PID hal component will
       be needed for encoder applications whereas stepgen configurations can use a stepgen in  position  control
       mode or in velocity control mode with a PID.

       For  tool  changers  which  lock  the  carousel against a stop the <b>rev-pulse</b> pin can be set to a non-zero
       value. The motor-rev pin will then be set for this many seconds at the completion of the tool search  and
       at the same time the reverse duty/cycle velocity value will be sent to the motor-vel pin.

</pre><h4><b>FUNCTIONS</b></h4><pre>
       <b>carousel.</b><u>N</u> (requires a floating-point thread)

</pre><h4><b>PINS</b></h4><pre>
       <b>carousel.</b><u>N</u><b>.pocket-number</b> s32 in
              The  pocket  to  move  to  when  the .enable pin goes high. If the value passed is higher than the
              number of pockets specified in the "pockets" modparam then modulo  arithmetic  is  used.  This  is
              intended  to  allow  the  use  of  multiple  tools in the same holder, as is sometimes useful with
              lathes.

       <b>carousel.</b><u>N</u><b>.enable</b> bit in
              Set this pin high to start movement. Setting it low will stop movement

       <b>carousel.</b><u>N</u><b>.active</b> bit out
              indicates that the component is active

       <b>carousel.</b><u>N</u><b>.ready</b> bit out
              This pin goes high when the carousel is in-position

       <b>carousel.</b><u>N</u><b>.strobe</b> bit in (default: <u>1</u>)
              Use this pin to indicate that the position feedback is valid. Often provided by binary encoders

       <b>carousel.</b><u>N</u><b>.parity</b> bit in
              Some encoders supply a parity bit, if this is connected then  the  parity-error  output  bit  will
              indicate parity errors

       <b>carousel.</b><u>N</u><b>.sense-</b><u>M</u> bit in (M=0..personality)
              Carousel  position  feedback pins. In 'index' mode there will be only 2 pins. sense-0 is the index
              and sense-1 is the pocket sensor.

       <b>carousel.</b><u>N</u><b>.rev-pulse</b> float in
              The duration in seconds for which a ratchet changer (Boxford, Emco) should pulse the  reverse  pin
              to lock the holder

       <b>carousel.</b><u>N</u><b>.fwd-dc</b> float in
              Velocity or duty cycle when forwards rotation is desired

       <b>carousel.</b><u>N</u><b>.rev-dc</b> float in
              Velocity or duty cycle when reverse rotation is desired

       <b>carousel.</b><u>N</u><b>.hold-dc</b> float in
              Duty cycle when carousel is in-position (to hold against stop)

       <b>carousel.</b><u>N</u><b>.align-dc</b> float in
              Use  this  pin to set the speed of a slower alignment move once the changer is in position. Such a
              system almost certainly needs decel-time setting too

       <b>carousel.</b><u>N</u><b>.decel-time</b> float in
              Time to wait for carousel to stop before final alignment and position check

       <b>carousel.</b><u>N</u><b>.counts</b> s32 in
              Connect to the rawcounts of an encoder or a stepgen in 'counts' mode

       <b>carousel.</b><u>N</u><b>.scale</b> s32 in (default: <u>100</u>)
              The number of stepgen or encoder counts between successive pockets

       <b>carousel.</b><u>N</u><b>.width</b> s32 in (default: <u>10</u>)
              How far each side of the exact scale to signal a new pocket

       <b>carousel.</b><u>N</u><b>.home-offset</b> s32 in (default: <u>0</u>)
              The offset (in counts) between the index and pocket 1

       <b>carousel.</b><u>N</u><b>.index-enable</b> bit io
              Used to home to an encoder index

       <b>carousel.</b><u>N</u><b>.jog-fwd</b> bit in
              Jog the carousel forwards one tool position

       <b>carousel.</b><u>N</u><b>.jog-rev</b> bit in
              Jog the carousel in reverse (only if dir = 2).  It is very important that  these  pins  should  be
              debounced and should probably also be interlocked to only operate when the machine is idle.

       <b>carousel.</b><u>N</u><b>.motor-fwd</b> bit out
              Indicates the motor should run forwards (bigger numbers)

       <b>carousel.</b><u>N</u><b>.motor-rev</b> bit out
              Indicates the motor should run reverse.

       <b>carousel.</b><u>N</u><b>.parity-error</b> bit out
              Indicates a parity error

       <b>carousel.</b><u>N</u><b>.current-position</b> s32 out
              This pin indicates the current position feedback

       <b>carousel.</b><u>N</u><b>.motor-vel</b> float out
              The duty-cycle or velocity to drive a DC motor or stepgen

       <b>carousel.</b><u>N</u><b>.homed</b> bit out (default: <u>0</u>)
              Shows that homing is complete. Only used in index and edge modes

       <b>carousel.</b><u>N</u><b>.unhome</b> bit in (default: <u>0</u>)
              Should only really be necessary for testing

       <b>carousel.</b><u>N</u><b>.counts-target</b> float out
              Target position for a stepgen or external PID controller

</pre><h4><b>PARAMETERS</b></h4><pre>
       <b>carousel.</b><u>N</u><b>.state</b> s32 r (default: <u>0</u>)
              Current component state

       <b>carousel.</b><u>N</u><b>.homing</b> bit r (default: <u>0</u>)
              Shows that homing is in progress. Only used for index mode

       <b>carousel.</b><u>N</u><b>.timer</b> float r
              Shows the value of the internal timer

       <b>carousel.</b><u>N</u><b>.motor-dir</b> s32 r
              Internal tag for search direction

       <b>carousel.</b><u>N</u><b>.counts-offset</b> s32 r
              Internal offset of index pin

       <b>carousel.</b><u>N</u><b>.debounce</b> u32 rw
              How many thread cycles to wait for the position to stabilise

       <b>carousel.</b><u>N</u><b>.target</b> s32 r
              Current target pocket, debug

       <b>carousel.</b><u>N</u><b>.base-counts</b> s32 r (default: <u>0</u>)

</pre><h4><b>AUTHOR</b></h4><pre>
       Andy Pugh

</pre><h4><b>LICENSE</b></h4><pre>
       GPL

LinuxCNC Documentation                             2025-08-07                                        <u><a href="../man9/CAROUSEL.9.html">CAROUSEL</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>