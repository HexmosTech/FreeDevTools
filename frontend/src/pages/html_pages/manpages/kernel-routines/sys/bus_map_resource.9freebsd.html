<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bus_map_resource, bus_unmap_resource, resource_init_map_request — map or unmap an active resource</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       bus_map_resource, bus_unmap_resource, resource_init_map_request — map or unmap an active resource

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/param.h&gt;</b>
       <b>#include</b> <b>&lt;sys/bus.h&gt;</b>

       <b>#include</b> <b>&lt;machine/bus.h&gt;</b>
       <b>#include</b> <b>&lt;sys/rman.h&gt;</b>
       <b>#include</b> <b>&lt;machine/resource.h&gt;</b>

       <u>int</u>
       <b>bus_map_resource</b>(<u>device_t</u> <u>dev</u>,     <u>int</u> <u>type</u>,    <u>struct</u> <u>resource</u> <u>*r</u>,    <u>struct</u> <u>resource_map_request</u> <u>*args</u>,
           <u>struct</u> <u>resource_map</u> <u>*map</u>);

       <u>int</u>
       <b>bus_unmap_resource</b>(<u>device_t</u> <u>dev</u>, <u>int</u> <u>type</u>, <u>struct</u> <u>resource</u> <u>*r</u>, <u>struct</u> <u>resource_map</u> <u>*map</u>);

       <u>void</u>
       <b>resource_init_map_request</b>(<u>struct</u> <u>resource_map_request</u> <u>*args</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       These functions create or destroy a mapping of a previously  activated  resource.   Mappings  permit  CPU
       access to the resource via the <u><a href="../man9/bus_space.9.html">bus_space</a></u>(9) API.

       The arguments are as follows:

       <u>dev</u>     The device that owns the resource.

       <u>type</u>    The type of resource to map.  It is one of:

               SYS_RES_IOPORT  for I/O ports
               SYS_RES_MEMORY  for I/O memory

       <u>r</u>       A pointer to the <u>struct</u> <u>resource</u> returned by <u><a href="../man9/bus_alloc_resource.9.html">bus_alloc_resource</a></u>(9).

       <u>args</u>    A  set of optional properties to apply when creating a mapping.  This argument can be set to NULL
               to request a mapping of the entire resource with the default properties.

       <u>map</u>     The resource mapping to create or destroy.

   <b>Resource</b> <b>Mappings</b>
       Resource mappings are described by a <u>struct</u> <u>resource_map</u> object.  This structure contains a  <u><a href="../man9/bus_space.9.html">bus_space</a></u>(9)
       tag  and  handle  in the <u>r_bustag</u> and <u>r_bushandle</u> members that can be used for CPU access to the mapping.
       The structure also contains a <u>r_vaddr</u> member which contains the virtual address of  the  mapping  if  one
       exists.

       The  wrapper  API for <u>struct</u> <u>resource</u> objects described in <u><a href="../man9/bus_activate_resource.9.html">bus_activate_resource</a></u>(9) can also be used with
       <u>struct</u> <u>resource_map</u>.  For example, a pointer to a mapping object can be passed as the first  argument  to
       <b>bus_read_4</b>().  This wrapper API is preferred over using the <u>r_bustag</u> and <u>r_bushandle</u> members directly.

   <b>Optional</b> <b>Mapping</b> <b>Properties</b>
       The  <u>struct</u>  <u>resource_map_request</u>  object  passed in <u>args</u> can be used to specify optional properties of a
       mapping.  The structure must be initialized by invoking <b>resource_init_map_request</b>().  Properties are then
       specified by setting one or more of these members:

       <u>offset</u>, <u>length</u>
               These two members specify a region of the resource to map.  By default a mapping is  created  for
               the entire resource.  The <u>offset</u> is relative to the start of the resource.

       <u>memattr</u>
               Specifies  a  memory  attribute to use when mapping the resource.  By default memory mappings use
               the VM_MEMATTR_UNCACHEABLE attribute.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       Zero is returned on success, otherwise an error is returned.

</pre><h4><b>EXAMPLES</b></h4><pre>
       This maps a PCI memory BAR with the write-combining memory attribute and reads the first 32-bit word:

               struct resource *r;
               struct resource_map map;
               struct resource_map_request req;
               uint32_t val;
               int rid;

               rid = <a href="../man0/PCIR_BAR.0.html">PCIR_BAR</a>(0);
               r = bus_alloc_resource_any(dev, SYS_RES_MEMORY, &amp;rid, RF_ACTIVE |
                   RF_UNMAPPED);
               resource_init_map_request(&amp;req);
               req.memattr = VM_MEMATTR_WRITE_COMBINING;
               bus_map_resource(dev, SYS_RES_MEMORY, r, &amp;req, &amp;map);
               val = bus_read_4(&amp;map, 0);

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man9/bus_activate_resource.9.html">bus_activate_resource</a></u>(9), <u><a href="../man9/bus_alloc_resource.9.html">bus_alloc_resource</a></u>(9), <u><a href="../man9/bus_space.9.html">bus_space</a></u>(9), <u><a href="../man9/device.9.html">device</a></u>(9), <u><a href="../man9/driver.9.html">driver</a></u>(9)

</pre><h4><b>AUTHORS</b></h4><pre>
       This manual page was written by John Baldwin &lt;<u><a href="mailto:jhb@FreeBSD.org">jhb@FreeBSD.org</a></u>&gt;.

Debian                                          February 5, 2018                             <u><a href="../man9/BUS_MAP_RESOURCE.9.html">BUS_MAP_RESOURCE</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>