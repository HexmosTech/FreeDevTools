<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>domain_add,  pfctlinput,  pfctlinput2, pffinddomain, pffindproto, pffindtype, DOMAIN_SET — network domain</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       domain_add,  pfctlinput,  pfctlinput2, pffinddomain, pffindproto, pffindtype, DOMAIN_SET — network domain
       management

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/param.h&gt;</b>
       <b>#include</b> <b>&lt;sys/kernel.h&gt;</b>
       <b>#include</b> <b>&lt;sys/protosw.h&gt;</b>
       <b>#include</b> <b>&lt;sys/domain.h&gt;</b>

       <u>void</u>
       <b>domain_add</b>(<u>void</u> <u>*data</u>);

       <u>void</u>
       <b>pfctlinput</b>(<u>int</u> <u>cmd</u>, <u>struct</u> <u>sockaddr</u> <u>*sa</u>);

       <u>void</u>
       <b>pfctlinput2</b>(<u>int</u> <u>cmd</u>, <u>struct</u> <u>sockaddr</u> <u>*sa</u>, <u>void</u> <u>*ctlparam</u>);

       <u>struct</u> <u>domain</u> <u>*</u>
       <b>pffinddomain</b>(<u>int</u> <u>family</u>);

       <u>struct</u> <u>protosw</u> <u>*</u>
       <b>pffindproto</b>(<u>int</u> <u>family</u>, <u>int</u> <u>protocol</u>, <u>int</u> <u>type</u>);

       <u>struct</u> <u>protosw</u> <u>*</u>
       <b>pffindtype</b>(<u>int</u> <u>family</u>, <u>int</u> <u>type</u>);

       <u>void</u>
       <b>DOMAIN_SET</b>(<u>name</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Network protocols installed in the system are maintained within what are called domains (for example  the
       <u>inetdomain</u> and <u>localdomain</u>).

       struct domain {
               int     dom_family;             /* AF_xxx */
               char    *dom_name;
               void    (*dom_init)             /* initialize domain data structures */
                       (void);
               void    (*dom_destroy)          /* cleanup structures / state */
                       (void);
               int     (*dom_externalize)      /* externalize access rights */
                       (struct mbuf *, struct mbuf **);
               void    (*dom_dispose)          /* dispose of internalized rights */
                       (struct mbuf *);
               struct  protosw *dom_protosw, *dom_protoswNPROTOSW;
               struct  domain *dom_next;
               int     (*dom_rtattach)         /* initialize routing table */
                       (void **, int);
               int     (*dom_rtdetach)         /* clean up routing table */
                       (void **, int);
               void    *(*dom_ifattach)(struct ifnet *);
               void    (*dom_ifdetach)(struct ifnet *, void *);
               int     (*dom_ifmtu)(struct ifnet *);
                                               /* af-dependent data on ifnet */
       };

       Each  domain contains an array of protocol switch structures (<u>struct</u> <u>protosw</u> <u>*</u>), one for each socket type
       supported.

       struct protosw {
               short   pr_type;                /* socket type used for */
               struct  domain *pr_domain;      /* domain protocol a member of */
               short   pr_protocol;            /* protocol number */
               short   pr_flags;               /* see below */
       /* protocol-protocol hooks */
               pr_input_t *pr_input;           /* input to protocol (from below) */
               pr_output_t *pr_output;         /* output to protocol (from above) */
               pr_ctlinput_t *pr_ctlinput;     /* control input (from below) */
               pr_ctloutput_t *pr_ctloutput;   /* control output (from above) */
       /* utility hooks */
               pr_init_t *pr_init;
               pr_fasttimo_t *pr_fasttimo;     /* fast timeout (200ms) */
               pr_slowtimo_t *pr_slowtimo;     /* slow timeout (500ms) */
               pr_drain_t *pr_drain;           /* flush any excess space possible */

               struct  pr_usrreqs *pr_usrreqs; /* user-protocol hook */
       };

       The following functions handle the registration of a  new  domain,  lookups  of  specific  protocols  and
       protocol types within those domains, and handle control messages from the system.

       <b>pfctlinput</b>()  is  called by the system whenever an event occurs that could affect every domain.  Examples
       of those types of events are routing table changes, interface shutdowns or certain  ICMP  message  types.
       When  called,  <b>pfctlinput</b>()  calls the protocol specific <b>pr_ctlinput</b>() function for each protocol in that
       has defined one, in every domain.

       <b>pfctlinput2</b>() provides that same functionality of <b>pfctlinput</b>(), but with a few additional  checks  and  a
       new  <u>void</u>  <u>*</u>  argument  that  is  passed  directly  to  the  protocol's  <b>pr_ctlinput</b>()  function.  Unlike
       <b>pfctlinput</b>(), <b>pfctlinput2</b>() verifies that <u>sa</u> is not NULL, and that only the protocol  families  that  are
       the same as <u>sa</u> have their <b>pr_ctlinput</b>() function called.

       <b>domain_add</b>()  adds  a  new  protocol  domain to the system.  The argument <u>data</u> is cast directly to <u>struct</u>
       <u>domain</u> <u>*</u> within the function, but is declared <u>void</u> <u>*</u> in order  to  prevent  compiler  warnings  when  new
       domains  are  registered  with  <b>SYSINIT</b>().   In  most  cases <b>domain_add</b>() is not called directly, instead
       <b>DOMAIN_SET</b>() is used.

       If the new domain has defined an initialization routine, it is called by <b>domain_add</b>(); as well,  each  of
       the protocols within the domain that have defined an initialization routine will have theirs called.

       Once  a  domain is added it cannot be unloaded.  This is because there is no reference counting system in
       place to determine if there are any active references from sockets within that domain.

       <b>pffinddomain</b>() finds a domain by family.  If the domain cannot be found, NULL is returned.

       <b>pffindtype</b>() and <b>pffindproto</b>() look up a protocol by its number or by its type.  In most  cases,  if  the
       protocol  or  type  cannot  be  found,  NULL is returned, but <b>pffindproto</b>() may return the default if the
       requested type is SOCK_RAW, a protocol switch type of SOCK_RAW is found, and the domain has a default raw
       protocol.

       Both functions are called by <b>socreate</b>() in order to resolve the protocol for the socket  currently  being
       created.

       <b>DOMAIN_SET</b>()  is  a macro that simplifies the registration of a domain via <b>SYSINIT</b>().  The code resulting
       from the macro expects there to be a domain structure named “<u>name</u><b>domain</b>” where <u>name</u> is  the  argument  to
       <b>DOMAIN_SET</b>():

       struct domain localdomain =
       { AF_LOCAL, "local", unp_init, unp_externalize, unp_dispose,
         localsw, &amp;localsw[sizeof(localsw)/sizeof(localsw[0])] };

       DOMAIN_SET(local);

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       Both  <b>pffindtype</b>()  and  <b>pffindproto</b>()  return  a  <u>struct</u>  <u>protosw</u>  <u>*</u> for the protocol requested.  If the
       protocol or socket type is not found, NULL is returned.   In  the  case  of  <b>pffindproto</b>(),  the  default
       protocol may be returned for SOCK_RAW types if the domain has a default raw protocol.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man2/socket.2.html">socket</a></u>(2)

</pre><h4><b>HISTORY</b></h4><pre>
       The  functions <b>domain_add</b>(), <b>pfctlinput</b>(), <b>pfctlinput2</b>(), <b>pffinddomain</b>(), <b>pffindproto</b>(), <b>pffindtype</b>() and
       <b>DOMAIN_SET</b>() first appeared in FreeBSD 4.4.

</pre><h4><b>AUTHORS</b></h4><pre>
       This manual page was written by Chad David &lt;<u><a href="mailto:davidc@acns.ab.ca">davidc@acns.ab.ca</a></u>&gt;.

Debian                                           April 29, 2020                                        <u><a href="../man9/DOMAIN.9.html">DOMAIN</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>