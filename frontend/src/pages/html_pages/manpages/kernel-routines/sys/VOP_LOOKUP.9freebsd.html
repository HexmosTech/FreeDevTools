<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOP_LOOKUP — lookup a component of a pathname</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       VOP_LOOKUP — lookup a component of a pathname

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/param.h&gt;</b>
       <b>#include</b> <b>&lt;sys/vnode.h&gt;</b>
       <b>#include</b> <b>&lt;sys/namei.h&gt;</b>

       <u>int</u>
       <b>VOP_LOOKUP</b>(<u>struct</u> <u>vnode</u> <u>*dvp</u>, <u>struct</u> <u>vnode</u> <u>**vpp</u>, <u>struct</u> <u>componentname</u> <u>*cnp</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This entry point looks up a single pathname component in a given directory.

       Its arguments are:

       <u>dvp</u>  The locked vnode of the directory to search.

       <u>vpp</u>  The address of a variable where the resulting locked vnode should be stored.

       <u>cnp</u>  The  pathname component to be searched for.  It is a pointer to a componentname structure defined as
            follows:

            struct componentname {
                    /*
                     * Arguments to lookup.
                     */
                    u_long  cn_nameiop;     /* namei operation */
                    u_long  cn_flags;       /* flags to namei */
                    struct  thread *cn_thread;      /* thread requesting lookup */
                    struct  ucred *cn_cred; /* credentials */
                    int     cn_lkflags;     /* Lock flags LK_EXCLUSIVE or LK_SHARED */
                    /*
                     * Shared between lookup and commit routines.
                     */
                    char    *cn_pnbuf;      /* pathname buffer */
                    char    *cn_nameptr;    /* pointer to looked up name */
                    long    cn_namelen;     /* length of looked up component */
            };

            Convert a component of a pathname into a pointer to a locked vnode.  This  is  a  very  central  and
            rather  complicated  routine.  If the file system is not maintained in a strict tree hierarchy, this
            can result in a deadlock situation.

            The <u>cnp-&gt;cn_nameiop</u> argument is LOOKUP, CREATE, RENAME, or DELETE depending on the intended  use  of
            the  object.  When CREATE, RENAME, or DELETE is specified, information usable in creating, renaming,
            or deleting a directory entry may be calculated.

            Overall outline of VOP_LOOKUP:

                  Check accessibility of directory.  Look for name in cache, if found, then return name.  Search
                  for name in directory, goto to found or notfound as appropriate.

            notfound:

                  If creating or renaming and at end of pathname, return EJUSTRETURN, leaving info on available
                  slots else return ENOENT.

            found:

                  If at end of path and deleting, return information to allow delete.  If at end of path and
                  renaming, lock target inode and return info to allow rename.  If not at end, add name to
                  cache; if at end and neither creating nor deleting, add name to cache.

</pre><h4><b>LOCKS</b></h4><pre>
       The directory <u>dvp</u> should be locked on entry and exit, regardless of error  condition.   If  an  entry  is
       found in the directory, it will be returned locked.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       Zero  is  returned  with  <u>*vpp</u>  set  to  the  locked vnode of the file if the component is found.  If the
       component being searched for is ".", then the vnode just has an extra reference added to it with <u><a href="../man9/vref.9.html">vref</a></u>(9).
       The caller must take care to release the locks appropriately in this case.

       If the component is not found and the operation is CREATE or RENAME, the flag ISLASTCN is  specified  and
       the operation would succeed, the special return value EJUSTRETURN is returned.  Otherwise, an appropriate
       error code is returned.

</pre><h4><b>ERRORS</b></h4><pre>
       [ENOTDIR]          The vnode <u>dvp</u> does not represent a directory.

       [ENOENT]           The component <u>dvp</u> was not found in this directory.

       [EACCES]           Access for the specified operation is denied.

       [EJUSTRETURN]      A CREATE or RENAME operation would be successful.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man9/vnode.9.html">vnode</a></u>(9), <u><a href="../man9/VOP_ACCESS.9.html">VOP_ACCESS</a></u>(9), <u><a href="../man9/VOP_CREATE.9.html">VOP_CREATE</a></u>(9), <u><a href="../man9/VOP_MKDIR.9.html">VOP_MKDIR</a></u>(9), <u><a href="../man9/VOP_MKNOD.9.html">VOP_MKNOD</a></u>(9), <u><a href="../man9/VOP_RENAME.9.html">VOP_RENAME</a></u>(9), <u><a href="../man9/VOP_SYMLINK.9.html">VOP_SYMLINK</a></u>(9)

</pre><h4><b>HISTORY</b></h4><pre>
       The function <b>VOP_LOOKUP</b> appeared in 4.3BSD.

</pre><h4><b>AUTHORS</b></h4><pre>
       This manual page was written by Doug Rabson, with some text from comments in <u>ufs_lookup.c</u>.

Debian                                           August 8, 2018                                    <u><a href="../man9/VOP_LOOKUP.9.html">VOP_LOOKUP</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>