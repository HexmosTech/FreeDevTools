<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>swi_add, swi_remove, swi_sched — register and schedule software interrupt handlers</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       swi_add, swi_remove, swi_sched — register and schedule software interrupt handlers

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/param.h&gt;</b>
       <b>#include</b> <b>&lt;sys/bus.h&gt;</b>
       <b>#include</b> <b>&lt;sys/interrupt.h&gt;</b>

       <u>extern</u> <u>struct</u> <u>intr_event</u> <u>*tty_intr_event</u>;
       <u>extern</u> <u>struct</u> <u>intr_event</u> <u>*clk_intr_event</u>;
       <u>extern</u> <u>void</u> <u>*vm_ih</u>;

       <u>int</u>
       <b>swi_add</b>(<u>struct</u> <u>intr_event</u> <u>**eventp</u>,    <u>const</u> <u>char</u> <u>*name</u>,   <u>driver_intr_t</u> <u>handler</u>,   <u>void</u> <u>*arg</u>,   <u>int</u> <u>pri</u>,
           <u>enum</u> <u>intr_type</u> <u>flags</u>, <u>void</u> <u>**cookiep</u>);

       <u>int</u>
       <b>swi_remove</b>(<u>void</u> <u>*cookie</u>);

       <u>void</u>
       <b>swi_sched</b>(<u>void</u> <u>*cookie</u>, <u>int</u> <u>flags</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       These functions are used to register  and  schedule  software  interrupt  handlers.   Software  interrupt
       handlers are attached to a software interrupt thread, just as hardware interrupt handlers are attached to
       a  hardware  interrupt thread.  Multiple handlers can be attached to the same thread.  Software interrupt
       handlers can be used to queue up less critical processing inside of hardware interrupt handlers  so  that
       the work can be done at a later time.  Software interrupt threads are different from other kernel threads
       in  that  they are treated as an interrupt thread.  This means that time spent executing these threads is
       counted as interrupt time, and that they can be run via a lightweight context switch.

       The <b>swi_add</b>() function is used to add a new software interrupt handler to a  specified  interrupt  event.
       The <u>eventp</u> argument is an optional pointer to a <u>struct</u> <u>intr_event</u> pointer.  If this argument points to an
       existing event that holds a list of interrupt handlers, then this handler will be attached to that event.
       Otherwise  a  new  event  will be created, and if <u>eventp</u> is not NULL, then the pointer at that address to
       will be modified to point to the newly created event.  The <u>name</u> argument is used to associate a name with
       a specific handler.  This name is appended to the name of the software interrupt thread that this handler
       is attached to.  The <u>handler</u> argument is the function that will be executed when the handler is scheduled
       to run.  The <u>arg</u> parameter will be passed in as the only  parameter  to  <u>handler</u>  when  the  function  is
       executed.   The  <u>pri</u>  value  specifies  the priority of this interrupt handler relative to other software
       interrupt handlers.  If an interrupt event is created, then this value is used as  the  vector,  and  the
       <u>flags</u>  argument is used to specify the attributes of a handler such as INTR_MPSAFE.  The <u>cookiep</u> argument
       points to a <u>void</u> <u>*</u> cookie.  This cookie will be set to a value that uniquely identifies this handler, and
       is used to schedule the handler for execution later on.

       The <b>swi_remove</b>() function is used to teardown an interrupt handler pointed to by the <u>cookie</u> argument.  It
       detaches the interrupt handler from the associated interrupt event and frees its memory.

       The <b>swi_sched</b>() function is used to schedule an interrupt handler and its associated thread to run.   The
       <u>cookie</u>  argument  specifies  which  software  interrupt  handler  should  be scheduled to run.  The <u>flags</u>
       argument specifies how and when the handler should be run and is a mask of one or more of  the  following
       flags:

       SWI_DELAY    Specifies  that  the  kernel  should  mark  the specified handler as needing to run, but the
                    kernel should not schedule the software interrupt thread to run.  Instead, <u>handler</u>  will  be
                    executed  the  next  time  that  the software interrupt thread runs after being scheduled by
                    another event.  Attaching a handler to the clock software interrupt thread  and  using  this
                    flag when scheduling a software interrupt handler can be used to implement the functionality
                    performed by <b>setdelayed</b>() in earlier versions of FreeBSD.

       SWI_FROMNMI  Specifies that <b>swi_sched</b>() is called from NMI context and should be careful about used KPIs.
                    On  platforms  allowing IPI sending from NMI context it immediately wakes <u>clk_intr_event</u> via
                    the IPI, otherwise it works just like SWI_DELAY.

       The <u>tty_intr_event</u> and <u>clk_intr_event</u> variables contain pointers to the software interrupt  handlers  for
       the  tty  and  clock  software  interrupts,  respectively.   <u>tty_intr_event</u>  is used to hang tty software
       interrupt handlers off of the same thread.  <u>clk_intr_event</u> is used to hang delayed handlers  off  of  the
       clock  software interrupt thread so that the functionality of <b>setdelayed</b>() can be obtained in conjunction
       with SWI_DELAY.  The <u>vm_ih</u> handler cookie is used to schedule software interrupt threads to run  for  the
       VM subsystem.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       The <b>swi_add</b>() and <b>swi_remove</b>() functions return zero on success and non-zero on failure.

</pre><h4><b>ERRORS</b></h4><pre>
       The <b>swi_add</b>() function will fail if:

       [EAGAIN]           The  system-imposed  limit  on  the total number of processes under execution would be
                          exceeded.  The limit is given by the <u><a href="../man3/sysctl.3.html">sysctl</a></u>(3) MIB variable KERN_MAXPROC.

       [EINVAL]           The <u>flags</u> argument specifies INTR_ENTROPY.

       [EINVAL]           The <u>eventp</u> argument points to a hardware interrupt thread.

       [EINVAL]           Either of the <u>name</u> or <u>handler</u> arguments are NULL.

       [EINVAL]           The INTR_EXCL flag is specified and the interrupt event pointed to by  <u>eventp</u>  already
                          has at least one handler, or the interrupt event already has an exclusive handler.

       The <b>swi_remove</b>() function will fail if:

       [EINVAL]           A software interrupt handler pointed to by <u>cookie</u> is NULL.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man9/ithread.9.html">ithread</a></u>(9), <u><a href="../man9/taskqueue.9.html">taskqueue</a></u>(9)

</pre><h4><b>HISTORY</b></h4><pre>
       The  <b>swi_add</b>() and <b>swi_sched</b>() functions first appeared in FreeBSD 5.0.  They replaced the <b>register_swi</b>()
       function which appeared in FreeBSD 3.0 and the <b>setsoft*</b>(), and <b>schedsoft*</b>() functions which date back  to
       at least 4.4BSD.  The <b>swi_remove</b>() function first appeared in FreeBSD 6.1.

</pre><h4><b>BUGS</b></h4><pre>
       Most  of  the  global  variables described in this manual page should not be global, or at the very least
       should not be declared in &lt;<u>sys/interrupt.h</u>&gt;.

Debian                                            July 25, 2020                                           <u><a href="../man9/SWI.9.html">SWI</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>