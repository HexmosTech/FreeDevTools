<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pbuf, getpbuf, trypbuf, relpbuf — functions for managing physical buffers</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pbuf, getpbuf, trypbuf, relpbuf — functions for managing physical buffers

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/param.h&gt;</b>
       <b>#include</b> <b>&lt;sys/systm.h&gt;</b>
       <b>#include</b> <b>&lt;sys/bio.h&gt;</b>
       <b>#include</b> <b>&lt;sys/buf.h&gt;</b>

       <u>struct</u> <u>buf</u> <u>*</u>
       <b>getpbuf</b>(<u>int</u> <u>*pfreecnt</u>);

       <u>struct</u> <u>buf</u> <u>*</u>
       <b>trypbuf</b>(<u>int</u> <u>*pfreecnt</u>);

       <u>void</u>
       <b>relpbuf</b>(<u>struct</u> <u>buf</u> <u>*bp</u>, <u>int</u> <u>*pfreecnt</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       These functions are used to allocate and release physical buffers.

       The  physical buffers are allocated at system startup and are maintained in a separate pool from the main
       system buffers.  They are intended for use by subsystems that cannot or should not be reliant on the main
       pool of buffers (for example the swap pager).  The system allocates between 16 and 256  physical  buffers
       depending on the amount of memory in the system.

       Each  subsystem  that  allocates  buffers  via  these calls is expected to manage its own percentage free
       counter.  If the value is initialized to -1 the number of buffers available to the subsystem  is  limited
       only  by  the  number  of physical buffers available.  The number of buffers is stored in <u>nswbuf</u> which is
       defined in &lt;<u>sys/buf.h</u>&gt; and initialized in <b>cpu_startup</b>().   A  recommended  initialization  value  is  1/2
       <u>nswbuf</u>.

       The  <b>getpbuf</b>()  function  returns  the  first  available  buffer  to  the  user.  If there are no buffers
       available, <b>getpbuf</b>() will sleep waiting for one to become available.  If <u>pfreecnt</u> is zero, <b>getpbuf</b>() will
       sleep until it increases.  <u>pfreecnt</u> is decremented prior to returning.

       The <b>trypbuf</b>() function returns the first available buffer.  If there are no buffers  available,  NULL  is
       returned.   As well, if <u>pfreecnt</u> is zero, NULL is returned.  <u>pfreecnt</u> is decremented prior to returning a
       valid buffer.  If NULL is returned, <u>pfreecnt</u> is not modified.

       The <b>relpbuf</b>() function releases the buffer back to the free list.  If  the  buffers  <u>b_rcred</u>  or  <u>b_wcred</u>
       structures are not NULL, they are freed.  See <u><a href="../man9/crfree.9.html">crfree</a></u>(9).

       <u>pfreecnt</u> is incremented prior to returning.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>getpbuf</b>()  and  <b>trypbuf</b>()  return  a  pointer  to the buffer.  In the case of <b>trypbuf</b>(), NULL can also be
       returned indicating that there are no buffers available.

</pre><h4><b>AUTHORS</b></h4><pre>
       This manual page was written by Chad David &lt;<u><a href="mailto:davidc@acns.ab.ca">davidc@acns.ab.ca</a></u>&gt;.

Debian                                            July 9, 2001                                           <u><a href="../man9/PBUF.9.html">PBUF</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>