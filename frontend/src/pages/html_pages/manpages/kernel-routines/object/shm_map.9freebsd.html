<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shm_map, shm_unmap — map shared memory objects into the kernel's address space</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       shm_map, shm_unmap — map shared memory objects into the kernel's address space

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/types.h&gt;</b>
       <b>#include</b> <b>&lt;sys/mman.h&gt;</b>

       <u>int</u>
       <b>shm_map</b>(<u>struct</u> <u>file</u> <u>*fp</u>, <u>size_t</u> <u>size</u>, <u>off_t</u> <u>offset</u>, <u>void</u> <u>**memp</u>);

       <u>int</u>
       <b>shm_unmap</b>(<u>struct</u> <u>file</u> <u>*fp</u>, <u>void</u> <u>*mem</u>, <u>size_t</u> <u>size</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>shm_map</b>() and <b>shm_unmap</b>() functions provide an API for mapping shared memory objects into the kernel.
       Shared  memory  objects are created by <u><a href="../man2/shm_open.2.html">shm_open</a></u>(2).  These objects can then be passed into the kernel via
       file descriptors.

       A shared memory object cannot be  shrunk  while  it  is  mapped  into  the  kernel.   This  is  to  avoid
       invalidating  any  pages  that  may  be wired into the kernel's address space.  Shared memory objects can
       still be grown while mapped into the kernel.

       To simplify the accounting needed to enforce the above requirement, callers of this API are  required  to
       unmap  the  entire  region mapped by <b>shm_map</b>() when calling <b>shm_unmap</b>().  Unmapping only a portion of the
       region is not permitted.

       The <b>shm_map</b>() function locates the shared memory object associated with the open file <u>fp</u>.   It  maps  the
       region  of  that  object  described  by <u>offset</u> and <u>size</u> into the kernel's address space.  If it succeeds,
       <u>*memp</u> will be set to the start of the mapping.  All pages for the range will be wired  into  memory  upon
       successful return.

       The  <b>shm_unmap</b>()  function unmaps a region previously mapped by <b>shm_map</b>().  The <u>mem</u> argument should match
       the value previously returned in <u>*memp</u>, and the <u>size</u> argument should match the value passed to <b>shm_map</b>().

       Note that <b>shm_map</b>() will not hold an extra reference on the open file <u>fp</u> for the lifetime of the mapping.
       Instead, the calling code is required to do this if it wishes to use <b>shm_unmap</b>() on  the  region  in  the
       future.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       The <b>shm_map</b>() and <b>shm_unmap</b>() functions return zero on success or an error on failure.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  following  function accepts a file descriptor for a shared memory object.  It maps the first sixteen
       kilobytes of the object into the kernel, performs some work on that address, and then unmaps the  address
       before returning.

             int
             shm_example(int fd)
             {
                     struct file *fp;
                     void *mem;
                     int error;

                     error = fget(curthread, fd, CAP_MMAP, &amp;fp);
                     if (error)
                             return (error);
                     error = shm_map(fp, 16384, 0, &amp;mem);
                     if (error) {
                             fdrop(fp, curthread);
                             return (error);
                     }

                     /* Do something with 'mem'. */

                     error = shm_unmap(fp, mem, 16384);
                     fdrop(fp, curthread);
                     return (error);
             }

</pre><h4><b>ERRORS</b></h4><pre>
       The <b>shm_map</b>() function returns the following errors on failure:

       [EINVAL]           The open file <u>fp</u> is not a shared memory object.

       [EINVAL]           The requested region described by <u>offset</u> and <u>size</u> extends beyond the end of the shared
                          memory object.

       [ENOMEM]           Insufficient address space was available.

       [EACCES]           The shared memory object could not be mapped due to a protection error.

       [EINVAL]           The shared memory object could not be mapped due to some other VM error.

       The <b>shm_unmap</b>() function returns the following errors on failure:

       [EINVAL]           The open file <u>fp</u> is not a shared memory object.

       [EINVAL]           The address range described by <u>mem</u> and <u>size</u> is not a valid address range.

       [EINVAL]           The  address range described by <u>mem</u> and <u>size</u> is not backed by the shared memory object
                          associated with the open file <u>fp</u>, or the address  range  does  not  cover  the  entire
                          mapping of the object.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man2/shm_open.2.html">shm_open</a></u>(2)

</pre><h4><b>HISTORY</b></h4><pre>
       This API was first introduced in FreeBSD 10.0.

Debian                                          December 14, 2011                                     <u><a href="../man9/SHM_MAP.9.html">SHM_MAP</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>