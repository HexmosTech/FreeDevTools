<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stepgen - software step pulse generation</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/linuxcnc-uspace">linuxcnc-uspace_2.9.4-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       stepgen - software step pulse generation

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>loadrt</b> <b>stepgen</b> <b>step_type=</b><u>type0</u>[,<u>type1</u>...] [<b>ctrl_type=</b><u>type0</u>[,<u>type1</u>...]] [<b>user_step_type=#,#</b>...]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>stepgen</b>  is  used to control stepper motors.  The maximum step rate depends on the CPU and other factors,
       and is usually in the range of 5 kHz to 25 kHz.  If higher rates are needed, a hardware step generator is
       a better choice.

       <b>stepgen</b> has two control modes, which can be selected on a  channel  by  channel  basis  using  <b>ctrl_type</b>.
       Possible  values  are  "<b>p</b>"  for  position  control, and "<b>v</b>" for velocity control. The default is position
       control, which drives the motor to a commanded position, subject to  acceleration  and  velocity  limits.
       Velocity  control  drives  the  motor  at  a commanded speed, again subject to accel and velocity limits.
       Usually, position mode is used for machine axes.  Velocity mode  is  reserved  for  unusual  applications
       where  continuous  movement  at some speed is desired, instead of movement to a specific position.  (Note
       that velocity mode replaces the former component <b>freqgen</b>.)

       <b>stepgen</b> can control a maximum of 16 motors.  The number of motors/channels actually loaded depends on the
       number of <u>type</u> values given.  The value of each <u>type</u> determines the outputs for that  channel.   Position
       or  velocity  mode can be individually selected for each channel.  Both control modes support the same 16
       possible step types.

       By far the most common  step  type  is  '0',  standard  step  and  direction.   Others  include  up/down,
       quadrature,  and  a  wide  variety  of  three, four, and five phase patterns that can be used to directly
       control some types of motor windings.  (When used with appropriate buffers of course.)

       Some of the stepping types are described below, but for more details (including timing diagrams) see  the
       <b>stepgen</b> section of the HAL reference manual.

       type 0: step/dir
              Two  pins,  one for step and one for direction.  <b>make-pulses</b> must run at least twice for each step
              (once to set the step pin true, once to clear it).  This limits the maximum step rate to half  (or
              less)  of  the  rate  that can be reached by types 2-14.  The parameters <b>steplen</b> and <b>stepspace</b> can
              further lower the maximum step rate.  Parameters <b>dirsetup</b> and <b>dirhold</b>  also  apply  to  this  step
              type.

       type 1: up/down
              Two  pins, one for 'step up' and one for 'step down'.  Like type 0, <b>make-pulses</b> must run twice per
              step, which limits the maximum speed.

       type 2: quadrature
              Two pins, phase-A and phase-B.  For forward motion, A leads B.  Can advance by one step every time
              <b>make-pulses</b> runs.

       type 3: three phase, full step
              Three pins, phase-A, phase-B, and phase-C.  Three steps per full cycle, then  repeats.   Only  one
              phase is high at a time - for forward motion the pattern is A, then B, then C, then A again.

       type 4: three phase, half step
              Three  pins,  phases  A through C.  Six steps per full cycle.  First A is high alone, then A and B
              together, then B alone, then B and C together, etc.

       types 5 through 8: four phase, full step
              Four pins, phases A through D.  Four steps per full cycle.  Types 5 and 6  are  suitable  for  use
              with  unipolar  steppers, where power is applied to the center tap of each winding, and four open-
              collector transistors drive the ends.  Types 7 and 8 are suitable for bipolar steppers, driven  by
              two H-bridges.

       types 9 and 10: four phase, half step
              Four  pins,  phases  A  through  D.   Eight steps per full cycle.  Type 9 is suitable for unipolar
              drive, and type 10 for bipolar drive.

       types 11 and 12: five phase, full step
              Five pins, phases A through E.  Five steps per full cycle.   See  HAL  reference  manual  for  the
              patterns.

       types 13 and 14: five phase, half step
              Five  pins,  phases  A  through  E.   Ten  steps per full cycle.  See HAL reference manual for the
              patterns.

       type 15: user-specified
              This uses the waveform specified by the <b>user_step_type</b> module parameter, which may have up  to  10
              steps and 5 phases.

</pre><h4><b>FUNCTIONS</b></h4><pre>
       <b>stepgen.make-pulses</b> (no floating-point)
              Generates  the  step  pulses,  using  information  computed  by  <b>update-freq</b>.   Must  be called as
              frequently as possible, to maximize the attainable step rate and minimize jitter.  Operates on all
              channels at once.

       <b>stepgen.capture-position</b> (uses floating point)
              Captures position feedback value from the high speed code and makes it available on a pin for  use
              elsewhere in the system.  Operates on all channels at once.

       <b>stepgen.update-freq</b> (uses floating point)
              Accepts  a velocity or position command and converts it into a form usable by <b>make-pulses</b> for step
              generation.  Operates on all channels at once.

</pre><h4><b>PINS</b></h4><pre>
       <b>stepgen.</b><u>N</u><b>.counts</b> s32 out
              The current position, in counts, for channel <u>N</u>.  Updated by <b>capture-position</b>.

       <b>stepgen.</b><u>N</u><b>.position-fb</b> float out
              The  current  position,  in   length   units   (see   parameter   <b>position-scale</b>).    Updated   by
              <b>capture-position</b>.  The resolution of <b>position-fb</b> is much finer than a single step.  If you need to
              see individual steps, use <b>counts</b>.

       <b>stepgen.</b><u>N</u><b>.enable</b> bit in
              Enables output steps - when false, no steps are generated.

       <b>stepgen.</b><u>N</u><b>.velocity-cmd</b> float in (velocity mode only)
              Commanded velocity, in length units per second (see parameter <b>position-scale</b>).

       <b>stepgen.</b><u>N</u><b>.position-cmd</b> float in (position mode only)
              Commanded position, in length units (see parameter <b>position-scale).</b>

       <b>stepgen.</b><u>N</u><b>.step</b> bit out (step type 0 only)
              Step pulse output.

       <b>stepgen.</b><u>N</u><b>.dir</b> bit out (step type 0 only)
              Direction output: low for forward, high for reverse.

       <b>stepgen.</b><u>N</u><b>.up</b> bit out (step type 1 only)
              Count up output, pulses for forward steps.

       <b>stepgen.</b><u>N</u><b>.down</b> bit out (step type 1 only)
              Count down output, pulses for reverse steps.

       <b>stepgen.</b><u>N</u><b>.phase-A</b> thru <b>phase-E</b> bit out (step types 2-14 only)
              Output bits.  <b>phase-A</b> and <b>phase-B</b> are present for step types 2-14, <b>phase-C</b> for types 3-14, <b>phase-D</b>
              for types 5-14, and <b>phase-E</b> for types 11-14.  Behavior depends on selected stepping type.

</pre><h4><b>PARAMETERS</b></h4><pre>
       <b>stepgen.</b><u>N</u><b>.frequency</b> float ro
              The current step rate, in steps per second, for channel <u>N</u>.

       <b>stepgen.</b><u>N</u><b>.maxaccel</b> float rw
              The acceleration/deceleration limit, in length units per second squared.

       <b>stepgen.</b><u>N</u><b>.maxvel</b> float rw
              The maximum allowable velocity, in length units per second.  If  the  requested  maximum  velocity
              cannot  be  reached with the current combination of scaling and <b>make-pulses</b> thread period, it will
              be reset to the highest attainable value.

       <b>stepgen.</b><u>N</u><b>.position-scale</b> float rw
              The scaling for position feedback, position command, and velocity command,  in  steps  per  length
              unit.

       <b>stepgen.</b><u>N</u><b>.rawcounts</b> s32 ro
              The  position  in  counts, as updated by <b>make-pulses</b>.  (Note: this is updated more frequently than
              the <b>counts</b> pin.)

       <b>stepgen.</b><u>N</u><b>.steplen</b> u32 rw
              The length of the step pulses, in nanoseconds.  Measured from rising edge to falling edge.

       <b>stepgen.</b><u>N</u><b>.stepspace</b> u32 rw (step types 0 and 1 only)
              The minimum space between step pulses, in nanoseconds.  Measured from falling edge to rising edge.
              The actual time depends on the step rate and can be much longer.  If <b>stepspace</b> is 0, then <b>step</b> can
              be asserted every period.    This can be used in  conjunction  with  <b>hal_parport</b>'s  auto-resetting
              pins  to  output  one  step pulse per period.  In this mode, <b>steplen</b> must be set for one period or
              less.

       <b>stepgen.</b><u>N</u><b>.dirsetup</b> u32 rw (step type 0 only)
              The minimum setup time from direction to step, in nanoseconds periods.  Measured  from  change  of
              direction to rising edge of step.

       <b>stepgen.</b><u>N</u><b>.dirhold</b> u32 rw (step type 0 only)
              The minimum hold time of direction after step, in nanoseconds.  Measured from falling edge of step
              to change of direction.

       <b>stepgen.</b><u>N</u><b>.dirdelay</b> u32 rw (step types 1 and higher only)
              The minimum time between a forward step and a reverse step, in nanoseconds.

</pre><h4><b>TIMING</b></h4><pre>
       There are five timing parameters which control the output waveform.  No step type uses all five, and only
       those  which will be used are exported to HAL.  The values of these parameters are in nano-seconds, so no
       recalculation is needed when changing thread periods.  In the  timing  diagrams  that  follow,  they  are
       identified by the following numbers:

       (1) <b>stepgen.n.steplen</b>

       (2) <b>stepgen.n.stepspace</b>

       (3) <b>stepgen.n.dirhold</b>

       (4) <b>stepgen.n.dirsetup</b>

       (5) <b>stepgen.n.dirdelay</b>

       For  step  type  0,  timing  parameters 1 thru 4 are used.  The following timing diagram shows the output
       waveforms, and what each parameter adjusts.

                      _____         _____               _____
           STEP  ____/     \_______/     \_____________/     \______
                     |     |       |     |             |     |
           Time      |-(1)-|--(2)--|-(1)-|--(3)--|-(4)-|-(1)-|
                                                 |__________________
           DIR   ________________________________/

       For step type 1, timing parameters 1, 2, and 5 are used.  The following timing diagram shows  the  output
       waveforms, and what each parameter adjusts.

                    _____       _____
           UP    __/     \_____/     \________________________________
                   |     |     |     |         |
           Time    |-(1)-|-(2)-|-(1)-|---(5)---|-(1)-|-(2)-|-(1)-|
                                               |_____|     |_____|
           DOWN  ______________________________/     \_____/     \____

       For  step  types  2  and  higher,  the exact pattern of the outputs depends on the step type (see the HAL
       manual for a full listing).  The outputs change from one state  to  another  at  a  minimum  interval  of
       <b>steplen</b>.  When a direction change occurs, the minimum time between the last step in one direction and the
       first in the other direction is the sum of <b>steplen</b> and <b>dirdelay</b>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       The HAL User Manual.

LinuxCNC Documentation                             2007-01-16                                         <u><a href="../man9/STEPGEN.9.html">STEPGEN</a></u>(9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>