<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>build-openstack-debian-image - build a Debian image to be used with OpenStack</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/openstack-debian-images">openstack-debian-images_1.86_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       build-openstack-debian-image - build a Debian image to be used with OpenStack

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>build-openstack-debian-image</b> <b>--release|-r</b> <b>&lt;wheezy|jessie|stretch|buster|bullseye&gt;</b> [ OPTIONS ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <u>build-openstack-debian-image</u> shell script will build a Debian image which can be used in an OpenStack
       IaaS  cloud.  The resulting (Qcow2 and raw images) contains initramfs-growroot so that the root partition
       will be resized (during the initramfs phase, before mouting anything) to match the flavor  selected  when
       using "nova boot". Later on during the boot process, cloud-init will resize the root partition on the fly
       (resize is performed when the partition is already mounted read-write, since recent kernel allow that for
       ext3).

       Cloud-init is setup to use an Ec2 metadata server, which is what OpenStack is compatible with. A "debian"
       (configurable  with the use of the <b>--login</b> option) user will be used to receive the ssh key from the user
       data blob.  This user is setup without a password (eg: adduser --disabled-password).  Once logged as this
       "debian" user in your new virtual machine, you can "sudo" to root  from  that  user,  without  needing  a
       password.  The  root  password  is "password" by default, and ssh into the root user without using an ssh
       keypair is disabled by default (PermitRootLogin without-password is set in <a href="file:/etc/ssh/sshd_config">/etc/ssh/sshd_config</a>).

</pre><h4><b>PARAMETERS</b></h4><pre>
       <b>--release|-r</b> <u>wheezy|jessie|stretch|buster|bullseye</u>

              Sets the <u>release</u> name to be installed. Currently only 5 values a possible:  <u>wheezy</u>  or  <u>jessie</u>  or
              <u>stretch</u> or <u>buster</u> or <u>bullseye.</u>

              At  the  time  of writing, bullseye is only here to prepare the future, and will not work until it
              effectively becomes the new testing.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--extra-packages|-e</b> <u>PACKAGE,PACKAGE,...</u>

              Select   the   <u>PACKAGE</u>   you    want    to    add    to    the    image    <u>default</u>    <u>is:</u>    <u>bash-</u>
              <u>completion,joe,most,screen,less,vim,bzip2</u>  Note that this list of extra packages isn't used if you
              use the <b>--minimal</b> option.

       <b>--debootstrap-url|-u</b> <u>&lt;debootstrap-debian-mirror&gt;</u>

              Select  the  <u>URL</u>  of  the  Debian  mirror  to  use  to  perform  the  debootstrap.  For   example:
              <u><a href="http://ftp.fr.debian.org/debian">http://ftp.fr.debian.org/debian</a></u>

       <b>--debootstrap-keyring-file|-k</b> <u>&lt;path-to-keyring&gt;</u>

              Use  the  specified  keyring  file,  and  not  the official debian archive keyring, when verifying
              packages. This is useful when using an unofficial package repository (e.g. a self-hosted aptly)

       <b>--copy-debootstrap-keyring-file</b>

              Copy the keyring file specified  by  --debootstrap-keyring-file  into  <a href="file:/etc/apt/trusted.gpg.d">/etc/apt/trusted.gpg.d</a>  and
              <a href="file:/usr/share/keyrings">/usr/share/keyrings</a>  in  the  generated image.  Note that the prefered way to install and manage a
              keyring is to install it as a package using --extra-packages.

       <b>--boot-manager|-bm</b> <u>&lt;grub|syslinux&gt;</u>

              Select what type of boot manager to use inside the image. The default is Grub, but you can as well
              decide to use syslinux if you prefer.

       <b>--boot-type|-bt</b> <u>&lt;mbr|uefi&gt;</u>

              Select how to boot the image: using legacy MBR-style (aka BIOS or CSM) boot, or UEFI. The  default
              is  mbr. Selecting uefi requires the use of Grub as the boot manager, and will set up an extra EFI
              System Partition inside the image to support UEFI boot.

       <b>--architecture|-</b> <u>&lt;amd64|arm64&gt;</u>

              Select the architecture to target for the output  image.  This  will  not  cross  build  for  that
              architecture,  but  will  pick  the  right architecture-specific components. Supported options are
              "amd64" and "arm64"; "amd64" is default.

       <b>--sources.list-mirror|-s</b> <u>&lt;source-list-mirror&gt;</u>

              URL to use when building the sources.list inside the chroot. If this option is omitted,  then  the
              global    httpredir.debian.org    redirector    is    used.     For    example,   you   can   use:
              <u><a href="http://ftp.fr.debian.org/debian">http://ftp.fr.debian.org/debian</a></u>

       <b>--minimal</b>

              Without this  option,  the  following  packages  will  also  be  installed:  bash-completion  (and
              <a href="file:/etc/bash.bashrc">/etc/bash.bashrc</a>  will  be setup to use bash-completion), joe (the text editor), most, GNU screen,
              less and vim. If you  believe  that  more  things  should  be  added  in  the  non-minimal  image,
              suggestions are welcome.

       <b>--azure|-az</b>

              Build  an  image  for  the  Microsoft  Azure cloud. Note that this option is incompatible with the
              --automatic-resize|-ar option, which will be ignored.

       <b>--image-size|-is</b> <u>&lt;image-size&gt;</u>

              Select the image size (default to 2 GBytes if this option is omitted). Only useful if you need  to
              use a custom script hook (see below).

       <b>--automatic-resize|-ar</b>

              Reduce  the  image  to  the  minimum  HDD  size possible. The partition of the image will be first
              shrinked with resize2fs -M, then the space it takes will be used to do a 2nd  resize2fs  adding  a
              bit  of  extra space for the operating system to write runtime data (see below). Since this option
              takes a lot of time, it is disabled by default.

       <b>--automatic-resize-space|-ars</b> <u>&lt;supplementary-space&gt;</u>

              Size of the supplementary space added to the partition after it is resized to the minimum. If this
              option is omitted, then 50G is used. If <b>--automatic-resize</b> isn't used, then it is useless  to  set
              this option, which will be ignored.

       <b>--login|-l</b> <u>&lt;user-login&gt;</u>

              Change the login name (default to debian) for the user created by Cloud-Init.

       <b>--password|-p</b> <u>&lt;root-password&gt;</u>

              Defines  a  default  root password for your image. This option is dangerous, first because it will
              show the root password to the user of the computer building the image if  using  "ps",  then  also
              because  it is best to not set a default root password at all if possible. However, this option is
              still there, because sometimes, you need to be able to debug your image, and login through the web
              console of horizon. In a production environment, do not use this option.

       <b>--octavia-agent</b>

              Install the Octavia agent in order to build an Octavia Amphorae image, that will be  used  for  HA
              proxy based Load Balancer as a Service.

       <b>--manila-agent</b>

              Install the Manila agent in order to build OpenStack Manila share image.

       <b>--trove-agent</b>

              Install the Trove agent in order to build the OpenStack Trove image.

       <b>--extrepo</b> <u>&lt;openstack-release&gt;</u>

              Setup  the  OpenStack extrepo repository. This is mainly useful when the <b>--octavia-agent</b> option is
              use, so the unofficial OpenStack backports repositories can be used to setup the agent.

       <b>--kernel-from-backports</b> <u>&lt;yes/no&gt;</u>

              If set to yes, install the kernel from official Debian backports.

       <b>--editor</b> <u>&lt;nano,vim&gt;</u>

              List of editors to install in image.

       <b>--default-editor</b> <u>&lt;<a href="file:/bin/nano">/bin/nano</a>,</u> <u>/usr/bin/joe,</u> <u><a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?vi">/usr/bin/vi</a>&gt;</u>

              Set default alternative editor

       <b>--hook-script|-hs</b> <u>&lt;hook-script&gt;</u>

              If you wish to further customize the generated cloud image,  you  can  use  a  hook  script.  When
              called,  build-openstack-debian-image  will  fill up some BODI_* environment variable for the hook
              script to use as per below:

              <b>BODI_CHROOT_PATH</b> path where the image is mounted

              <b>BODI_RELEASE</b> name of the Debian release that is being bootstraped

       <b>--newer-qemu</b>

              Do not use the -o compat=0.10 option when converting to raw, and also, use -p -W -m 8 (ie:  multi-
              thread + progress indicator convert).

</pre><h4><b>EXAMPLE</b></h4><pre>
              Here is an example with the short parameter names:

       <u>build-openstack-debian-image</u>  <u>-u</u> <u><a href="http://ftp.fr.debian.org/debian">http://ftp.fr.debian.org/debian</a></u> <u>-s</u> <u><a href="http://ftp.fr.debian.org/debian">http://ftp.fr.debian.org/debian</a></u> <u>-is</u> <u>5</u>
       <u>-e</u> <u>libapache2-mod-php5</u> <u>-hs</u> <u><a href="file:~/customize-my-image">~/customize-my-image</a></u> <u>-ar</u> <u>-ars</u> <u>100</u>

              And the same but with long names for options:

       <u>build-openstack-debian-image</u>  <u>--debootstrap-url</u>   <u><a href="http://ftp.fr.debian.org/debian">http://ftp.fr.debian.org/debian</a></u>   <u>--sources.list-mirror</u>
       <u><a href="http://ftp.fr.debian.org/debian">http://ftp.fr.debian.org/debian</a></u>   <u>--image-size</u>   <u>5</u>   <u>--extra-packages</u>  <u>libapache2-mod-php5</u>  <u>--hook-script</u>
       <u><a href="file:~/customize-my-image">~/customize-my-image</a></u> <u>--automatic-resize</u> <u>--automatic-resize-space</u> <u>100</u>

</pre><h4><b>AUTHORS</b></h4><pre>
       build-openstack-debian-image has been written by Thomas  Goirand  &lt;<a href="mailto:zigo@debian.org">zigo@debian.org</a>&gt;,  with  contributions
       from Mehdi Abaakouk &lt;<a href="mailto:sileht@sileht.net">sileht@sileht.net</a>&gt;.

                                                                                 <u><a href="../man1/build-openstack-debian-image.1.html">build-openstack-debian-image</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>