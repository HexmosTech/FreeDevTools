<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nsdiff - create "nsupdate" script from DNS zone file differences</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/nsdiff">nsdiff_1.85-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nsdiff - create "nsupdate" script from DNS zone file differences

</pre><h4><b>SYNOPSIS</b></h4><pre>
       nsdiff [<b>-hV</b>] [<b>-b</b> <u>address</u>] [<b>-k</b> <u>keyfile</u>] [<b>-y</b> [<u>hmac</u>:]<u>name</u>:<u>key</u>]
              [<b>-0</b>|<b>-1</b>] [<b>-q</b>|<b>-v</b> [q][r]] [<b>-cCdD</b>] [<b>-i</b> <u>regex</u>] [<b>-S</b> <u>mode</u>|<u>num</u>]
              [<b>-u</b>] [<b>-s</b> <u>server</u>] [<b>-m</b> <u>server</u>] &lt;<u>zone</u>&gt; [<u>old</u>] [<u>new</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>nsdiff</b> program examines the <u>old</u> and <u>new</u> versions of a DNS zone, and outputs the differences as a
       script for use by BIND's <b>nsupdate</b> program. It ignores DNSSEC-related differences, assuming that the name
       server has sole control over zone keys and signatures.

       The input files are typically in standard DNS zone file format. They are passed through BIND's <b>named-</b>
       <b>compilezone</b> program to convert them to canonical form, so they may also be in BIND's "raw" format and may
       have <u>.jnl</u> update journals.

       If the <u>old</u> file is not specified, <b>nsdiff</b> will use <b>dig</b> to transfer the zone from the server given by the
       <b>-s</b> option, or if the <b>-s</b> option is missing it will get the server from the zone's SOA MNAME field. If both
       <u>old</u> and <u>new</u> files are not specified, <b>nsdiff</b> will transfer the new version of the zone from the server
       given by the <b>-m</b> option.

       The SOA serial number has special handling: any difference between the <u>old</u> and <u>new</u> serial numbers is
       ignored (except in <b>-S</b> <b>file</b> mode), because background DNSSEC signing activity can increment the serial
       number unpredictably. When the zones differ, <b>nsdiff</b> sets the serial number according to the <b>-S</b> option,
       and it uses the <u>old</u> serial number to protect against conflicting updates.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-h</b>  Display this documentation.

       <b>-V</b>  Display version information.

       <b>-0</b>  Allow very large updates affecting one domain name to be split across multiple requests.

       <b>-1</b>  Abort if update does not fit in one request packet.

       <b>-C</b>  Do  not ignore CDS or CDNSKEY records. They are normally managed by <b>dnssec-settime</b> with the "-P sync"
           and "-D sync" options, but you can use this option if you are managing them some other way.  In  that
           case,  your  un-signed  zone  file  should  include the complete CDS and/or CDNSKEY RRset(s); if not,
           <b>nsdiff</b> will delete the records.

       <b>-c</b>  Compare records case-insensitively. Can be helpful if the <b>nsupdate</b> target server  does  not  preserve
           the  case  of  domain  names. However with this option, <b>nsdiff</b> does not correctly handle records that
           only differ in case.

       <b>-D</b>  Do not ignore DNSKEY records. It is sometimes necessary to take manual control over a  zone's  DNSKEY
           RRset,  for  instance to include a foreign DNSKEY records during migration to or from another hosting
           provider.  If you use this option your un-signed zone file should include the complete DNSKEY  RRset;
           if  not,  nsdiff will try to delete the DNSKEY records. Normally <b>named</b> will reject the update, unless
           the zone is configured with the <u>dnssec-secure-to-insecure</u> option.

       <b>-d</b>  Ignore DS records. This option is useful if you are managing secure delegations on the signing server
           (via nsupdate) rather than in the source zone.

       <b>-i</b> <u>regex</u>
           Ignore more DNS records. By default, <b>nsdiff</b> strips out DNSSEC RRs (except for  DS)  before  comparing
           zones.  You  can  exclude  irrelevant  changes  from  the  diff by supplying a <u>regex</u> that matches the
           unwanted RRs.

       <b>-m</b> <u>server</u>[#<u>port</u>]
           Transfer the new version of the zone from the server given in this option, for  example,  a  back-end
           hidden  primary  server. You can specify the server host name or IP address, optionally followed by a
           "#" and the port number.

       <b>-s</b> <u>server</u>[#<u>port</u>]
           Transfer the old version of the zone from the server given in this option, using the same  syntax  as
           the <b>-m</b> option.

       <b>-S</b> <b>date</b>|<b>file</b>|<b>serial</b>|<b>unix</b>|<u>num</u>
           Choose the SOA serial number update mode: the default <u>file</u> takes the serial number from the <u>new</u> input
           zone; <u>date</u> uses a number of the form YYYYMMDDnn and allows for up to 100 updates per day; <u>serial</u> just
           increments  the  serial  number  in  the <u>old</u> input zone; <u>unix</u> uses the UNIX "seconds since the epoch"
           value. You can also specify an explicit serial number value. In all cases,  if  the  <u>old</u>  input  zone
           serial  number  is  larger than the target value it is just incremented. Serial number wrap-around is
           not supported.

       <b>-q</b>  Quiet / quick check. Output is suppressed unless the zones differ, in which  case  a  short  note  is
           printed instead of an <b>nsupdate</b> script.

       <b>-u</b>  Tell <b>nsupdate</b> to send the update message to the server specified in the <b>-s</b> option.

       <b>-v</b> [q][r]
           Control  verbosity.   The  <b>q</b>  flag  causes  queries to be printed.  The <b>r</b> flag causes responses to be
           printed.  To make <b>nsdiff</b> quiet, use <b>-v</b> <b>''</b>.

       The following options are passed to <b>dig</b> to modify its SOA and AXFR queries:

       <b>-b</b> <u>address</u>
           Source address for <b>dig</b> queries

       <b>-k</b> <u>keyfile</u>
           TSIG key file for <b>dig</b> queries.

       <b>-y</b> [<u>hmac</u>:]<u>name</u>:<u>key</u>
           Literal TSIG key for <b>dig</b> queries.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       The <b>nsdiff</b> utility returns 0 if the zones are the same, 1 if they differ, and 2 if there was an error.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       "usage: ..."
       "not a domain name: <u>&lt;zone&gt;</u>"
           Errors in the command line.

       "could not get SOA record for <u>&lt;zone&gt;</u>"
           Failed to retreive the zone's SOA using <b>dig</b> when trying to obtain the server MNAME from which to AXFR
           the zone.

       "missing SOA record"
           The output of <b>named-compilezone</b> is incomplete, usually because the input file is erroneous.

       "<u>&lt;zone&gt;</u> has changes"
           Printed instead of an <b>nsupdate</b> script when the <b>-q</b> option is used.

       "update does not fit in packet"
           The changes for one domain name did not fit in 64 KiB, or the <b>-1</b> option was  specified  and  all  the
           changes did not fit in 64 KiB.

       "ignoring dig options when loading zones from files"
           Warning emitted when the command line includes options for <b>dig</b> as well as zone source files.

       "ignoring -m option when loading new zone from file"
       "need -m option when there are no input files"
           The <b>-m</b> <u>server</u> option is required when there are no file arguments, and ignored otherwise.

       "loading zone <u>&lt;zone&gt;</u> via AXFR from <u>server</u>"
       "loading zone <u>&lt;zone&gt;</u> from file <u>file</u>"
           Normal  progress  messages  emitted  before <b>nsdiff</b> invokes <b>named-compilezone</b>, to explain the latter's
           diagnostics.

</pre><h4><b>EXAMPLE</b> <b>-</b> <b>DNSSEC</b></h4><pre>
       It is easiest to deploy DNSSEC if you allow <b>named</b> to manage zone keys and signatures  automatically,  and
       feed  in  changes to zones using DNS update requests. However this is very different from the traditional
       way of manually maintaining zones in standard DNS zone file format. The <b>nsdiff</b> program  bridges  the  gap
       between the two operational styles.

       To  support  this  workflow  you  need  BIND-9.7  or  newer. You will continue maintaining your zone file
       $sourcefile as before, but it is no longer the same as the $workingfile used by <b>named</b>. After you  make  a
       change, instead of using "rndc reload $zone", run "nsdiff $zone $sourcefile | nsupdate -l".

       Configure your zone as follows, to support DNSSEC and local dynamic updates:

         zone $zone {
           type primary;
           file "$workingfile";
           auto-dnssec maintain;
           update-policy local;
         };

       To create DNSSEC keys for your zone, change to named's working directory and run these commands:

         dnssec-keygen -f KSK $zone
         dnssec-keygen $zone

</pre><h4><b>EXAMPLE</b> <b>-</b> <b>bump-in-the-wire</b> <b>signing</b></h4><pre>
       A common arrangement for DNSSEC is to have a primary server that is oblivious to DNSSEC, a signing server
       which  transfers the zone from the primary and adds the DNSSEC records, and a number of secondary servers
       which transfer the zone from the signer and which are the public authoritative servers.

       You can implement this with <b>nsdiff</b>, which handles the transfer of  the  zone  from  the  primary  to  the
       signer.  No modifications to the primary are necessary. You set up the signer as in the previous section.
       To transfer changes from the primary to the signer, run the following on the signer:

         nsdiff -m $primary -s $signer $zone | nsupdate -l

</pre><h4><b>EXAMPLE</b> <b>-</b> <b>dynamic</b> <b>reverse</b> <b>DNS</b></h4><pre>
       You have a reverse zone such as "2.0.192.in-addr.arpa" which is mostly  managed  dynamically  by  a  DHCP
       server,  but which also has some static records (for network equipment, say). You can maintain the static
       part in a DNS zone file and feed any changes into the live dynamic zone by telling <b>nsdiff</b> to  ignore  the
       dynamic  entries. Say all the static equipment has IP addresses between 192.0.2.250 and 192.0.2.255, then
       you can run the command pipeline:

         nsdiff -i '^(?!25\d\.)' 2.0.192.in-addr.arpa 2.0.192.static |
           nsupdate -l

</pre><h4><b>CAVEATS</b></h4><pre>
       By default <b>nsdiff</b> does not maintain the transactional semantics of native DNS update  requests  when  the
       diff  is  big:  it  applies  large changes in multiple update requests. To minimise the problems this may
       cause, <b>nsdiff</b> ensures each domain name's changes are all in the same update request.  There  is  still  a
       small  risk  of clients not seeing a change applied atomically when that matters (e.g. altering an MX and
       creating the new target in the same transaction). You can avoid the  risk  by  using  the  <b>-1</b>  option  to
       prevent multi-packet updates, or by being careful about changes that depend on multiple domain names.

       The  update  requests  emitted by <b>nsdiff</b> include SOA serial number prerequisite checks to ensure that the
       zone has not changed while it is running. This can happen even in simple setups if <b>named</b>  happens  to  be
       re-signing  the zone at the time you make an update. Unfortunately the DNS update protocol does not allow
       for good error reporting when a prerequisite check fails. You can use <b>nspatch</b> to cope with this problem.

</pre><h4><b>BUGS</b></h4><pre>
       When updating a name's DNS records, <b>nsdiff</b> first deletes the old  ones  then  adds  the  new  ones.  This
       ensures  that  CNAME  replacements and TTL changes work correctly. However, this update strategy prevents
       you from replacing every record in a zone's apex NS RRset in one update, because  it  isn't  possible  to
       delete all a zone's name servers.

</pre><h4><b>VERSION</b></h4><pre>
         This is nsdiff-1.85 &lt;https://dotat.at/prog/nsdiff/&gt;

         Written by Tony Finch &lt;<a href="mailto:fanf2@cam.ac.uk">fanf2@cam.ac.uk</a>&gt; &lt;<a href="mailto:dot@dotat.at">dot@dotat.at</a>&gt;
         at Cambridge University Information Services.
         You may do anything with this. It has no warranty.

</pre><h4><b>ACKNOWLEDGMENTS</b></h4><pre>
       Thanks  to  Athanasius,  Mike  Bristow, Piete Brooks (University of Cambridge Computer Laboratory), Terry
       Burton (University of Leicester), Owen Dunn (University of  Cambridge  Faculty  of  Mathematics),  Martin
       Hartl (Barracuda), JP Mens, Mohamad Shidiq Purnama (PANDI), and Jordan Rieger (webnames.ca) for providing
       useful feedback.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/nspatch.1.html">nspatch</a></b>(1), <b><a href="../man1/nsupdate.1.html">nsupdate</a></b>(1), <b><a href="../man1/nsvi.1.html">nsvi</a></b>(1), <b><a href="../man1/dig.1.html">dig</a></b>(1), <b><a href="../man8/named.8.html">named</a></b>(8), <b><a href="../man8/named-compilezone.8.html">named-compilezone</a></b>(8), <b><a href="../man1/perlre.1.html">perlre</a></b>(1)

perl v5.38.2                                       2024-04-21                                         <u><a href="../man1p/NSDIFF.1p.html">NSDIFF</a></u>(1p)
</pre>
 </div>
</div></section>
</div>
</body>
</html>