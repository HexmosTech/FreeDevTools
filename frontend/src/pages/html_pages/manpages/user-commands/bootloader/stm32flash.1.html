<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stm32flash - flashing utility for STM32 through UART or I2C</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/stm32flash">stm32flash_0.7-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       stm32flash - flashing utility for STM32 through UART or I2C

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>stm32flash</b> [<b>-cfhjkouvCR</b>] [<b>-a</b> <u>bus_address</u>] [<b>-b</b> <u>baud_rate</u>] [<b>-m</b> <u>serial_mode</u>] [<b>-r</b> <u>filename</u>] [<b>-w</b> <u>filename</u>] [<b>-e</b>
       <u>num</u>]  [<b>-n</b>  <u>count</u>]  [<b>-g</b>  <u>address</u>]  [<b>-s</b>  <u>start_page</u>]  [<b>-S</b>  <u>address</u>[:<u>length</u>]] [<b>-F</b> <u>RX_length</u>[:<u>TX_length</u>]] [<b>-i</b>
       <u>GPIO_string</u>] [<u>tty_device</u> | <u>i2c_device</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>stm32flash</b> reads or writes the flash memory of STM32.

       It requires the STM32 to embed a  bootloader  compliant  with  ST  application  note  AN3155  or  AN4221.
       <b>stm32flash</b>  uses the serial port <u>tty_device</u> or the i2c port <u>i2c_device</u> to interact with the bootloader of
       STM32.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-a</b> <u>bus_address</u>
              Specify address on bus for <u>i2c_device</u>.  This option is mandatory for I2C interface.

       <b>-b</b> <u>baud_rate</u>
              Specify baud rate speed of <u>tty_device</u>.  Please notice that the  ST  bootloader  can  automatically
              detect the baud rate, as explained in chapter 2 of AN3155.  This option could be required together
              with option <b>-c</b> or if following interaction with bootloader is expected.  Default is <u>57600</u>.

       <b>-m</b> <u>mode</u>
              Specify  the  format  of  UART  data.  <u>mode</u> is a three characters long string where each character
              specifies, in this strict order, character size, parity and stop bits.  The only values  currently
              used  are  <u>8e1</u>  for  standard STM32 bootloader and <u>8n1</u> for standard STM32W bootloader.  Default is
              <u>8e1</u>.

       <b>-r</b> <u>filename</u>
              Specify to read the STM32 flash and write its content in <u>filename</u> in raw binary format (see  below
              <b>FORMAT</b> <b>CONVERSION</b>).

       <b>-w</b> <u>filename</u>
              Specify  to  write  the  STM32  flash with the content of <u>filename</u>.  File format can be either raw
              binary or intel hex (see below <b>FORMAT</b> <b>CONVERSION</b>).  The file format is automatically detected.  To
              by-pass format detection and force binary mode (e.g. to  write  an  intel  hex  content  in  STM32
              flash), use <b>-f</b> option.

       <b>-u</b>     Specify  to  disable  write-protection  from  STM32  flash.   The  STM32  will be reset after this
              operation.

       <b>-j</b>     Enable the flash read-protection.

       <b>-k</b>     Disable the flash read-protection.

       <b>-o</b>     Erase only.

       <b>-e</b> <u>num</u> Specify to erase <u>num</u> pages before writing the flash. Default is to erase the necessary pages based
              on the file content size and/or parameters provided with the -S option, or the whole flash if this
              cannot be determined. With <b>-e</b> <b>0</b> the flash would not be erased.

       <b>-v</b>     Specify to verify flash content after write operation.

       <b>-n</b> <u>count</u>
              Specify to retry failed writes up to <u>count</u> times. Default is 10 times.

       <b>-g</b> <u>address</u>
              Specify address to start execution from (0 = flash start).

       <b>-s</b> <u>start_page</u>
              Specify flash page offset (0 = flash start).

       <b>-S</b> <u>address</u><b>[:</b><u>length</u><b>]</b>
              Specify start address and optionally length for read/write/erase/crc operations.

       <b>-F</b> <u>RX_length</u><b>[:</b><u>TX_length</u><b>]</b>
              Specify the maximum frame size for the current interface.  Due to STM32 bootloader protocol,  host
              will  never  handle  frames  bigger  than  256 byte in RX or 258 byte in TX.  Due to current code,
              lowest limit in RX is 20 byte (to read a complete reply of command GET). Minimum limit in TX is  5
              byte, required by protocol.

       <b>-f</b>     Force binary parser while reading file with <b>-w</b>.

       <b>-h</b>     Show help.

       <b>-c</b>     Specify to resume the existing UART connection and don't send initial INIT sequence to detect baud
              rate.  Baud  rate  must  be  kept the same as the existing connection. This is useful if the reset
              fails.

       <b>-i</b> <u>GPIO_string</u>
              Specify the GPIO sequences on the host to force STM32 to enter and exit bootloader mode. GPIO  can
              either  be  real  GPIO  connected  from  host to STM32 beside the UART connection, or UART's modem
              signals used as GPIO. (See below <b>BOOTLOADER</b> <b>GPIO</b>  <b>SEQUENCE</b>  for  the  format  of  <u>GPIO_string</u>  and
              further explanation).

       <b>-C</b>     Specify  to  compute  CRC  on  memory  content.  By default the CRC is computed on the whole flash
              content.  Use <b>-S</b> to provide different memory address range.

       <b>-R</b>     Specify to reset the device at exit.  This option is ignored if either <b>-g</b>, <b>-j</b>, <b>-k</b> or  <b>-u</b>  is  also
              specified.

</pre><h4><b>BOOTLOADER</b> <b>GPIO</b> <b>SEQUENCE</b></h4><pre>
       This feature is currently available on Linux host only.

       As  explained  in  ST  application note AN2606, after reset the STM32 will execute either the application
       program in user flash or the bootloader, depending on the level applied at specific pins of STM32  during
       reset.

       STM32 bootloader is automatically activated by configuring the pins BOOT0="high" and BOOT1="low" and then
       by  applying  a reset.  Application program in user flash is activated by configuring the pin BOOT0="low"
       (the level on BOOT1 is ignored) and then by applying a reset.

       When GPIO from host computer are connected to either configuration and reset pins  of  STM32,  <b>stm32flash</b>
       can control the host GPIO to reset STM32 and to force execution of bootloader or execution of application
       program.

       The  sequence  of  GPIO  values  to  entry to and exit from bootloader mode is provided with command line
       option <b>-i</b> <u>GPIO_string</u>.

       The format of <u>GPIO_string</u> is:
              GPIO_string = [entry sequence][:[exit sequence]]
              sequence = [[-]signal]&amp;|,[sequence]

       In the above sequences, negative numbers  correspond  to  GPIO  at  "low"  level;  numbers  without  sign
       correspond  to  GPIO  at "high" level.  The value "n" can either be the GPIO number on the host system or
       the string "rts", "dtr" or "brk". The strings "rts" and "dtr" drive the corresponding UART's modem  lines
       RTS  and  DTR as GPIO.  The string "brk" forces the UART to send a BREAK sequence on TX line; after BREAK
       the UART is returned in normal "non-break" mode.  Note: the string "-brk" has no effect and is ignored.

       The ',' delimiter adds 100 ms of delay between signal toggles, whereas the '&amp;' delimiter adds  no  delay.
       An  empty  signal,  thus repeated ',' delimiters, can be used to insert larger delays in multiples of 100
       ms.  E.g. "rts,,,,-dtr" will set RTS, then wait 400 ms, then reset DTR.   "rts&amp;-dtr"  will  set  RTS  and
       reset  DTR without delay. You can use ',' delimiters alone to simply add a delay between opening port and
       starting to flash.

       Note that since version 0.6, an exit sequence will always be executed if specified, regardless of the  -R
       option,  to ensure the signals are reset.  If -R is specified, but no exit sequence, a software-triggered
       reset will be performed.

       As an example, let's suppose the following connection between host and STM32:
       • host GPIO_3 connected to reset pin of STM32;
       • host GPIO_4 connected to STM32 pin BOOT0;
       • host GPIO_5 connected to STM32 pin BOOT1.

       In this case, the sequence to enter in bootloader mode is: first put GPIO_4="high" and GPIO_5="low"; then
       send reset pulse by GPIO_3="low" followed by GPIO_3="high".  The corresponding string for <u>GPIO_string</u>  is
       "4,-5,-3,3".

       To  exit  from  bootloader  and run the application program, the sequence is: put GPIO_4="low"; then send
       reset pulse.  The corresponding string for <u>GPIO_string</u> is "-4,-3,3".

       The complete command line flag is "-i 4,-5,-3,3:-4,-3,3".

       STM32W uses pad PA5 to select boot mode; if  during  reset  PA5  is  "low"  then  STM32W  will  enter  in
       bootloader mode; if PA5 is "high" it will execute the program in flash.

       As an example, suppose GPIO_3 is connected to PA5 and GPIO_2 to STM32W's reset.  The command:
              stm32flash -i '-3&amp;-2,2:3&amp;-2,,,2' /dev/ttyS0
       provides:
       • entry sequence: GPIO_3=low, GPIO_2=low, 100 ms delay, GPIO_2=high
       • exit sequence: GPIO_3=high, GPIO_2=low, 300 ms delay, GPIO_2=high

       Another example, introducing a delay after port opening.  The command:
              stm32flash -i ',,,,,:rts&amp;-dtr,,,2' /dev/ttyS00,
       provides:
       • entry sequence: delay 500 ms
       • exit sequence: RTS=high, DTR=low, 300 ms delay, GPIO_2=high

</pre><h4><b>EXAMPLES</b></h4><pre>
       Get device information:
              stm32flash /dev/ttyS0

       Write with verify and then start execution:
              stm32flash -w filename -v -g 0x0 /dev/ttyS0

       Read flash to file:
              stm32flash -r filename /dev/ttyS0

       Start execution:
              stm32flash -g 0x0 /dev/ttyS0

       Specify:
       • entry sequence: RTS=low, DTR=low, DTR=high
       • exit sequence: RTS=high, DTR=low, DTR=high
              stm32flash -i -rts,-dtr,dtr:rts,-dtr,dtr /dev/ttyS0

</pre><h4><b>FORMAT</b> <b>CONVERSION</b></h4><pre>
       Flash  images  provided  by  ST  or  created  with  ST  tools are often in file format Motorola S-Record.
       Conversion between raw binary, intel hex and Motorola S-Record  can  be  done  through  software  package
       SRecord.

</pre><h4><b>AUTHORS</b></h4><pre>
       The  original  software  package  <b>stm32flash</b> is written by <u>Geoffrey</u> <u>McRae</u> and is since 2012 maintained by
       <u>Tormod</u> <u>Volden.</u>  See AUTHORS file in source code for more contributors.

       Man page and extension to STM32W and I2C are written by <u>Antonio</u> <u>Borneo.</u>

       Please report any bugs at the project homepage <a href="http://stm32flash.sourceforge.net">http://stm32flash.sourceforge.net</a> .

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/srec_cat.1.html">srec_cat</a></b>(1), <b><a href="../man5/srec_intel.5.html">srec_intel</a></b>(5), <b><a href="../man5/srec_motorola.5.html">srec_motorola</a></b>(5).

       The communication protocol used by ST  bootloader  is  documented  in  following  ST  application  notes,
       depending on communication port.  The current version of <b>stm32flash</b> only supports <u>UART</u> and <u>I2C</u> ports.
       • AN3154: CAN protocol used in the STM32 bootloader
              <a href="http://www.st.com/web/en/resource/technical/document/application_note/CD00264321.pdf">http://www.st.com/web/en/resource/technical/document/application_note/CD00264321.pdf</a>

       • AN3155: USART protocol used in the STM32(TM) bootloader
              <a href="http://www.st.com/web/en/resource/technical/document/application_note/CD00264342.pdf">http://www.st.com/web/en/resource/technical/document/application_note/CD00264342.pdf</a>

       • AN4221: I2C protocol used in the STM32 bootloader
              <a href="http://www.st.com/web/en/resource/technical/document/application_note/DM00072315.pdf">http://www.st.com/web/en/resource/technical/document/application_note/DM00072315.pdf</a>

       • AN4286: SPI protocol used in the STM32 bootloader
              <a href="http://www.st.com/web/en/resource/technical/document/application_note/DM00081379.pdf">http://www.st.com/web/en/resource/technical/document/application_note/DM00081379.pdf</a>

       Boot mode selection for STM32 is documented in ST application note AN2606, available from the ST website:
       <a href="http://www.st.com/web/en/resource/technical/document/application_note/CD00167594.pdf">http://www.st.com/web/en/resource/technical/document/application_note/CD00167594.pdf</a>

</pre><h4><b>LICENSE</b></h4><pre>
       <b>stm32flash</b>  is  distributed under GNU GENERAL PUBLIC LICENSE Version 2.  Copy of the license is available
       within the source code in the file <u>gpl-2.0.txt</u>.

stm32flash                                         March 2022                                      <u><a href="../man1/STM32FLASH.1.html">STM32FLASH</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>