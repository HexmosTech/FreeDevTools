<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>trace-cmd-attach - attach a guest trace.dat file to a host trace.dat file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/trace-cmd">trace-cmd_3.2-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       trace-cmd-attach - attach a guest trace.dat file to a host trace.dat file

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>trace-cmd</b> <b>attach</b> [<u>OPTIONS</u>] host-trace-file guest-trace-file guest-pid [guest-pid ...]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <a href="../man1/trace-cmd.1.html">trace-cmd</a>(1) attach is used to take a trace.dat file created on a guest and attach it to a trace.dat
       file that was created on the host. In most cases, <a href="../man1/trace-cmd-agent.1.html">trace-cmd-agent</a>(1) can be used to automate this, but if
       for some reason, the agent isnâ€™t appropriate, it may be required to start trace-cmd recording on the
       guest with <a href="../man1/trace-cmd-record.1.html">trace-cmd-record</a>(1). If the host recording is activated at the same time, one can use
       trace-cmd <a href="../man1/attach.1.html">attach</a>(1) to connect the guest and host files as if they were created by the trace-cmd agent.

       <b>host-trace-file</b>
           The trace.dat file created by the host. Must have kvm_exit and kvm_entry events, and use the
           "tsc2nsec" clock.

       <b>guest-trace-file</b>
           The trace.dat file created by the guest. Must use the "x86-tsc" clock. For now, this is only
           supported on x86, it may support other achitectures later.

       <b>guest-pid</b>
           The process ID of the host thread that represents the guests threads. Each process ID that represents
           all of the guest vCPUs should be listed. Note, you can add more than just the threads that represent
           the guest vCPUs, as the tool will search the <b>host-trace-file</b> for kvm_exit and kvm_entry events to
           match these PIDs with the vCPUs that they represent.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-c</b> <u>cpus</u>
           Specify a the number of CPUS the guest has.

       <b>-s</b> <u>timeshift</u>
           A comma separated list of the format <u>offset</u>,<u>scale</u>,<u>frac</u>,<u>timestamp</u> These values map to what are given
           in /sys/kernel/kvm/&lt;pid&gt;/vcpu/*

               *offset*: Is the offset of the guest. "tsc-offest" in the directory. Note
                         that the value listed here is the negative of what is listed in
                         the directory.

               *scale*:  The scaling factor. "tsc-scaling-ratio"

               *frac*:   The fraction bits. "tsc-scaling-ratio-frac-bits"

               *timestamp*: The timestamp to start using the above. In some cases, the
                         values may change over time. By adding a timestamp, it will
                         take effect after the timestamp has been hit. Normally
                         this would be zero.

               Currently, only one timeshift is given per CPU. One *-s* option should be
               given for each CPU. If there are less options than CPUs, then the last option
               given will be used for the rest of the CPUs. If only one option is given, then
               the values for that option will be used for all CPUs.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Enable all events for tracing:

             $ # find the process for a given guest
             $ ps aux |grep qemu
            libvirt+   63170  5.6  1.6 13994848 4257540 ?    Sl   May02 2884:49 /usr/bin/qemu-system-x86_64...

             $ # Use 63170 to find all the PIDs for the give guest
             $ ls /proc/63170/task
            1541591  63170  63198  63209  63211  63213  63214  63215  63216  63217  63218  63219  63234

             $ # Find the tsc offset
             $ su
             # cat /sys/kernel/debug/kvm/63170-15/vcpu0/tsc-offset
            -27950965013436847

             # trace-cmd record -C tsc2nesc -e kvm -e sched -e irq -e timer

           # on guest:

             # trace-cmd record -C x86-tsc -e sched -e irq -e timer sleep 10

           # back on host, hit Ctrl^C to stop tracing after the guest is done

             # # Make the trace.dat user owned by your user account.
             # chown user.user trace.dat
             # exit

             $ scp root@guest:trace.dat trace-guest.dat

             $ # now attach the two files (guest has 8 CPUs)
             $ trace-cmd attach -c 8 -s 27950965013436847 trace.dat trace-guest.dat 1541591  63170  63198  63209  63211  63213  63214  63215  63216  63217  63218  63219  63234

             $ trace-cmd report -i trace.dat -i trace-guest.dat
             $ # now you should see the guest trace interleaved within the host trace.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/trace-cmd.1.html">trace-cmd</a>(1), <a href="../man1/trace-cmd-report.1.html">trace-cmd-report</a>(1), <a href="../man1/trace-cmd-start.1.html">trace-cmd-start</a>(1), <a href="../man1/trace-cmd-stop.1.html">trace-cmd-stop</a>(1), <a href="../man1/trace-cmd-extract.1.html">trace-cmd-extract</a>(1),
       <a href="../man1/trace-cmd-reset.1.html">trace-cmd-reset</a>(1), <a href="../man1/trace-cmd-split.1.html">trace-cmd-split</a>(1), <a href="../man1/trace-cmd-list.1.html">trace-cmd-list</a>(1), <a href="../man1/trace-cmd-listen.1.html">trace-cmd-listen</a>(1), <a href="../man1/trace-cmd-profile.1.html">trace-cmd-profile</a>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
       Written by Steven Rostedt (Google) &lt;<b><a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a></b>[1]&gt;

</pre><h4><b>RESOURCES</b></h4><pre>
       <b>https://git.kernel.org/pub/scm/utils/trace-cmd/trace-cmd.git/</b>

</pre><h4><b>COPYING</b></h4><pre>
       Copyright (C) 2010 Red Hat, Inc. Free use of this software is granted under the terms of the GNU Public
       License (GPL).

</pre><h4><b>NOTES</b></h4><pre>
        1. <a href="mailto:rostedt@goodmis.org">rostedt@goodmis.org</a>
           <a href="mailto:rostedt@goodmis.org">mailto:rostedt@goodmis.org</a>

libtracefs                                         04/08/2024                                <u><a href="../man1/TRACE-CMD-ATTACH.1.html">TRACE-CMD-ATTACH</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>