<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gpshell - command line tool for the management of GlobalPlatform compliant smart cards</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/gpshell">gpshell_2.4.0+dfsg-3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>gpshell</b> - command line tool for the management of GlobalPlatform compliant smart cards

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>gpshell</b> <u>scriptfile</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       gpshell  can  manage  applications  on  smart  cards  supporting  the GlobalPlatform.  This comprises the
       installation and deletion of  applications,  getting  the  applications  status  and  card  data.   These
       applications are practical always Java Card applets.  Additional key management commands are provided.

       The  most  common way to use gpshell is a script file.  But it is also possible to read the commands from
       stdin if no script file is provided.

       Within a script environment variables can be accessed with the syntax ${ENV_VAR_NAME}.

       Reading the commands from stdin allows one to feed in the commands dynamically and use conditionals  when
       using  the Expect pattern.  Tools are available for a variety of script languages, shells and programming
       languages.  Example are to support environment variables and handle results and output conditionally.

       There are several txt example scripts provided which gets installed into /usr/share/doc/gpshell/examples/
       that can also be found online.

</pre><h4><b>COMMANDS</b></h4><pre>
       <b>mode_201</b>
              Set protocol mode to OpenPlatform 2.0.1.  This is the default.

       <b>mode_211</b>
              Set protocol mode to GlobalPlatform 2.1.1 and later

       <b>visa_key_derivation</b>
              For cards which use the VISA key derivation scheme for the key calculation, like  GemXpresso  Pro,
              Palmera Protect or some JCOP cards this must be set.

       <b>emv_cps11_key_derivation</b>
              For  cards  which  uses  the  EMV  CPS  1.1  key derivation scheme for the key calculation, like a
              Sm@rtCafe Expert 3.0 this must be set.

       <b>enable_trace</b>
              Enable APDU trace

       You will see the sent APDUs in clear text.  The last two bytes of the response are the response code.   A
       response code of 9000 means success, otherwise the response code indicates an error.  This may be OK when
       deleting a non existing applet or package.

       <b>enable_timer</b>
              Enable the logging of the execution times of commands.

       <b>establish_context</b>
              Establish context.  This must always be executed before connecting to a card.

       <b>card_connect</b> -reader <u>readerName</u> -protocol <u>protocol</u>
              Connect to card in the reader with <u>readerName</u>.  By default protocol is 0 = T0.

       <b>card_connect</b> -readerNumber <u>x</u> -protocol <u>protocol</u>
              Connect to card in the <u>x</u> th reader in the system.  By default protocol is 0 = T0.

       <b>open_sc</b> -keyind <u>x</u> -keyver <u>x</u> -key <u>key</u> -mac_key <u>mac-key</u> -enc_key <u>enc-key</u> -kek_key <u>kek-key</u> -security
       <u>securityLevel</u> -scp <u>protocol</u> -scpimpl <u>impl</u> -keyDerivation <u>derivation</u>
              Open a secure channel

       For OpenPlatform 2.0.1’ cards only -keyind -keyver -mac_key and -enc_key are necessary.

       For  GlobalPlatform  2.1.1 and later cards -scp and -scpimpl should not be necessary to supply.  You must
       also specify -kek_key.

       If the card supports a Secure Channel Protocol Implementation with only one base key,  specify  this  key
       with -key and omit the others.

       If  the  card uses a key derivation mechanism you must enable the derivation mode with the -keyDerivation
       option and you must specify with -key the master (mother) key.  -kek_key, -mac_key and -enc_key  are  not
       relevant is this case.  See the section Options and Key Derivation.  <b>NOTE:</b> If the secure channel is going
       to  be  opened  when  no security domain is selected then the command get_secure_channel_protocol_details
       must be executed before to be able to get the Secure Channel Protocol Implementation.

       <b>select</b> -AID <u>AID</u>
              Select AID instance

       <b>install</b> -file <u>appletFile</u> -priv <u>privilege</u> -sdAID <u>sdAID</u> -AID <u>AIDInPkg</u> -pkgAID <u>packageAID</u> -instAID
       <u>instanceAID</u> -nvCodeLimit <u>x</u> -nvDataLimit <u>y</u> -instParam <u>installationParams</u> -uiccSystemSpecParam
       <u>uiccSystemSpecParams</u> -simSpecParam <u>simSpecParams</u>
              Load and installs an applet in one step

       The parameters -AID -instAID -pkgAID -nvCodeLimit can be detected automatically and the -AID and -instAID
       is set to the first applet in <u>appletfile</u>.

       For the <u>sdAID</u> the AID selected with the select command is chosen if not  given.   Otherwise  the  default
       Card Manager / Security Issuer Domain AID is chosen.  Usually you do not have to pass it.

       -instParam  specifies  applet  installation  parameters  for  the  install()  method -uiccSystemSpecParam
       specifies parameters according to ETSI TS 102 226, sect.  8.2.1.3.2.2 to use the Card Application Toolkit
       (CAT) functionality or to access the UICC file system.  The parameters have to be already encoded without
       the outer tag `EA'.  -simSpecParam specifies parameters according to ETSI TS 102 226, sect.   8.2.1.3.2.1
       to  use the SIM Application Toolkit (STK) functionality or to access the SIM file system.  The parameters
       have to be already encoded without the outer tag `CA'.

       <b>install_for_load</b> -pkgAID <u>packageAID</u> -sdAID <u>sdAID</u> -nvCodeLimit <u>y</u>
              Applet load preparation

       For the <u>sdAID</u> the AID selected with the select command is chosen if not  given.   Otherwise  the  default
       Card Manager / Security Issuer Domain AID is chosen.  Usually you do not have to pass it.

       This command may be needed if the combined install command does not work.

       <b>load</b> -file <u>appletFile</u>
              Load applet

       This command may be needed if the combined install command does not work.

       <b>install_for_install</b> -priv <u>privilege</u> -AID <u>AIDInPkg</u> -pkgAID <u>pkgAID</u> -instAID <u>instanceAID</u> -nvDataLimit <u>x</u>
       -instParam <u>installationParams</u> -uiccSystemSpecParam <u>uiccSystemSpecParams</u> -simSpecParam <u>simSpecParams</u>
              Instantiate applet

       This  command  may  be  needed  if  the combined install command does not work.  Or you want to install a
       pre-installed Security Domain.

       <b>install_for_make_selectable</b> -priv <u>privilege</u> -instAID <u>instanceAID</u>
              Makes an installed applet instance selectable

       This command may be needed if the combined install command does not work.  Typically this is  used  after
       an <u>install_for_install</u> followed by personalization.

       <b>card_disconnect</b>
              Disconnect card

       <b>get_status</b> -element <u>e0</u>
              List applets and packages and security domains

       <b>get_status</b> -element <u>20</u>
              List packages

       <b>get_status</b> -element <u>40</u>
              List applets or security domains

       <b>get_status</b> -element <u>80</u>
              List Card Manager / Security Issuer Domain

       <b>release_context</b>
              Release context

       <b>put_sc_key</b> -keyver <u>keyver</u> -newkeyver <u>newkeyver</u> -mac_key <u>new_MAC_key</u> -enc_key <u>new_ENC_key</u> -kek_key
       <u>new_KEK_key</u>
              Add or replace a key set version

       If  a new key set version is to be added <u>keyver</u> must be set to 0.  If <u>keyver</u> equals <u>newkeyver</u> an existing
       key version is replaced.  An existing key set version cannot be replaced with a key set version  using  a
       different key size.

       <b>put_sc_key</b> -keyver <u>keyver</u> -newkeyver <u>newkeyver</u> -key <u>key</u> -keyDerivation “derivation”
              Replace key set version <u>keyver</u> using key derivation <u>derivation</u> using the master (mother) key <u>y</u>

       <b>put_dm_keys</b> -keyver <u>keyver</u> -newkeyver <u>newkeyver</u> -file <u>public_rsa_key_file</u> -pass <u>password</u> -key
       <u>new_receipt_generation_key</u>
              Add a RSA delegated management key in version <u>newkeyver</u>

       <b>send_apdu</b> -sc 0 -APDU <u>apdu</u>
              Send APDU <u>apdu</u> without secure channel

       The APDU is given as hex without spaces and without leading 0x.

       <b>get_data</b> -identifier <u>identifier</u>
              A  GET  DATA  command returning the data for the given identifier.  See the identifier options for
              details.

       <b>get_key_information_templates</b> -keyTemplate <u>index</u>
              A GET DATA command returning the key information templates in the selected security domain.  <b>NOTE:</b>
              The security domain must be selected and this only works outside of a secure channel.

       <b>get_extended_card_resources_information</b>
              A GET DATA command returning the extended  card  resources  information  in  the  issuer  security
              domain.   <b>NOTE:</b>  The  security  domain  must  be  selected and this only works outside of a secure
              channel.

       <b>get_secure_channel_protocol_details</b>
              A GET DATA command returning the secure channel protocol details and remembering them for a  later
              open_sc.   <b>NOTE:</b>  The  security  domain  must  be selected and this only works outside of a secure
              channel.

       <b>print</b>  Prints a line of text.  Prints an empty line if no text is given.

       <b>install_for_personalization</b> -aid <u>AID</u>
              Prepare a security domain for the personalization of an applet with following store_data commands.
              <b>NOTE:</b> The security domain must be selected and this only works outside of a secure channel.

       <b>store_data</b> -dataFormat <u>format</u> -dataEncryption <u>encryption</u> -data <u>data</u>
              Executes a STORE DATA command passing the <u>data</u> to the selected applet.

       <b>get_card_recognition_data</b>
              A GET DATA command returning the card  recognition  data.   <b>NOTE:</b>  The  security  domain  must  be
              selected.

       <b>delete_key</b> -keyver <u>keyver</u> -keyind <u>keyind</u>
              Deletes  a  key  set version with a DELETE command.  If only the keyver is passed the complete key
              set version is deleted.  By default keyind is 0xFF to delete the complete  key  set  version.   If
              keyver is 0 all key set with the passed keyind are deleted.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-keyind</b> <u>x</u>
              Key index <u>x</u>

       <b>-keyver</b> <u>x</u> Key set version x

       <b>-newkeyver</b> <u>x</u>
              New key set version x

       <b>-key</b> <u>key</u>
              Key value in hex

       <b>-mac_key</b> <u>key</u>
              MAC key value in hex

       <b>-enc_key</b> <u>key</u>
              ENC key value in hex

       <b>-kek_key</b> <u>key</u>
              KEK key value in hex

       <b>-security</b> <u>x</u>
              0: clear, 1: MAC, 3: MAC+ENC, 51: MAC+ENC+R-MAC+E-ENC (SCP03 only), 19: MAC+ENC-R-MAC (SCP02+SCP03
              only), 17: MAC+R-MAC (SCP02+SCP03 only)

       <b>-reader</b> <u>readerName</u>
              Smart card reader name

       <b>-readerNumber</b> <u>x</u>
              Number of the reader in the system to connect to.  If -reader is given this is ignored.

       <b>-protocol</b> <u>x</u>
              Protocol, 0:T=0, 1:T=1 Should not be necessary to be stated explicitly.

       <b>-AID</b> <u>aid</u>
              Applet ID

       <b>-sdAID</b> <u>aid</u>
              Security Domain AID

       <b>-pkgAID</b> <u>aid</u>
              Package AID

       <b>-instAID</b> <u>aid</u>
              Instance AID

       <b>-nvCodeLimit</b> <u>x</u>
              Non-volatile code size limit

       <b>-nvDataLimit</b> <u>x</u>
              Non-volatile data size limit

       <b>-vDataLimit</b> <u>x</u>
              Volatile data size limit

       <b>-file</b> <u>name</u>
              File name

       <b>-instParam</b> <u>param</u>
              Installation parameter

       <b>-uiccSystemSpecParam</b> <u>param</u>
              UICC System Specific Parameters according to ETSI TS 102 226, sect.  8.2.1.3.2.2.

       <b>-simSpecParam</b> <u>param</u>
              SIM  File  Access  and Toolkit Application Specific Parameters according to ETSI TS 102 226, sect.
              8.2.1.3.2.1.

       <b>-element</b> <u>x</u>
              Element type to be listed in hex

       • 80 - Card Manager / Card Issuer Security Domain only.

       • 40 - Applications (and Security Domains only in GP211 and later).

       • 20 - Executable Load Files only.

       • 10 - Executable Load Files and their Executable Modules only (Only GP211 and later)

       <b>-format</b> <u>x</u>
         Sets the format of the response of the get_status command.  This is only used for GlobalPlatform  cards
         and required and only needed if the default is not supported by the smart card.

       <b>-dataFormat</b> <u>x</u>
         Sets the data format flag for store_data command.  Default 0.

       • 0 - No general encryption information or non - encrypted data

       • 0x20 - Application dependent encryption of the data

       • 0x40 - RFU(encryption indicator)

       • 0x60 - Encrypted data.  Must be encrypted with data encryption key.

       <b>-dataEncryption</b> <u>x</u>
         Sets  the  encryption  format  flag for store_data command.  Note that this is just a flag and the data
         must be passed already in the correct encryption.  Default 0.

       • 0 - No general data structure information

       • 0x08 - DGI format of the command data field

       • 0x10 - BER-TLV format of the command data field

       • 0x18 - RFU (data structure information)

       <b>-responseDataExpected</b> <u>x</u>
         Sets if response data is expected for store_data command.  1 for expecting response data.  Default 0.

       <b>-keyTemplate</b> <u>x</u>
         Sets the key template index to return for the get_key_templates command.  Default 0.

       • 0 - Deprecated format

       • 2 - New format (default)

       <b>-sc</b> <u>x</u>
         Secure Channel mode (0 off, 1 on)

       <b>-APDU</b> <u>apdu</u>
         APDU to be sent.  Must be in hex format, e.g. 80CA00CF00.

       <b>-priv</b> <u>x</u>
         Privilege.  E.g.  0x04 Default Selected

       <b>-scp</b> <u>x</u>
         Secure Channel Protocol (1 SCP01, 2 SCP02, 3 SCP03, default no set).  Should not  be  necessary  to  be
         stated explicitly.

       <b>-scpimpl</b> <u>x</u>
         Secure  Channel  Implementation (default not set) Should not be necessary to be stated explicitly.  See
         the get_secure_channel_protocol_details command to detect the Secure Channel  Protocol  Implementation.
         <b>NOTE:</b>  The  value  can  be  passed  as  decimal value or hexadecimal prefixed by “0x”.  The hexadecimal
         version is the common one.

       <b>-pass</b> <u>password</u>
         Password for key decryption

       <b>-identifier</b> <u>identifier</u>
         Identifier for the tag for the get_data command.  Must be in hex format, e.g. 9F7F.

       There are several identifiers  available  but  in  general  not  all  cards  are  supporting  them.   The
       GlobalPlatform  specification  v2.3.1  lists  a  few in section 11.3.3.1.  It is useful to use some ASN.1
       parser to interpret these data, like asn1js

       Some useful identifier are:

       • 9F7F - CPLC (Card Production Life Cycle) Data

       • 00E0 - Key Information Templates.  Instead of the first byte 00 also 01, ...  can be used to  get  more
         key   information   templates   if   available.   There  is  a  dedicated  command  for  getting  this:
         get_key_information_templates

       • 2F00 - List of applications

       • FF21   -   Extended   card   resources.    There   is   a   dedicated   command   for   getting   this:
         get_extended_card_resources_information

       • 0066    -   Card   Recogniti0on   Data.    There   is   a   dedicated   command   for   getting   this:
         get_card_recognition_data

       <b>-data</b> <u>data</u>
         Data in hex format for the store_data command.

       <b>-noStop</b>
         Does not stop in case of an error

       <b>-keyType</b> <u>keyType</u>
         Type of the key for the put_sc_key command.  Must be in hex format, e.g. 88.

   <b>Format</b> <b>of</b> <b>CPLC</b> <b>data</b>
       You see the command trace of a GET DATA command and the interpreted result.

              =&gt; 80 CA 9F 7F 00 .....
              (12102 usec)
              &lt;= 9F 7F 2A 47 90 50 40 47 91 81 02 31 00 83 58 00 ..*<a href="mailto:G.P@G...1..X">G.P@G...1..X</a>.
              11 68 91 45 81 48 12 83 65 00 00 00 00 01 2F 31 .h.E.H..e...../1
              30 31 31 36 38 00 00 00 00 00 00 00 00 90 00 01168..........
              Status: No Error
              IC Fabricator : 4790
              IC Type : 5040
              Operating System ID : 4791
              Operating System release date : 8102 (11.4.2008)
              Operating System release level : 3100
              IC Fabrication Date : 8358 (23.12.2008)
              IC Serial Number : 00116891
              IC Batch Identifier : 4581
              IC Module Fabricator : 4812
              IC Module Packaging Date : 8365 (30.12.2008)
              ICC Manufacturer : 0000
              IC Embedding Date : 0000
              IC Pre-Personalizer : 012F
              IC Pre-Perso. Equipment Date : 3130 (10.5.2003)
              IC Pre-Perso. Equipment ID : 31313638
              IC Personalizer : 0000
              IC Personalization Date : 0000
              IC Perso. Equipment ID : 00000000

       Dates are stored as 2 bytes, the first specifying the year in the decade and the last  3  bytes  the  day
       within the year.

       <b>-keyDerivation</b> <u>derivation</u> <u>method</u>
              Possible values are <u>none</u>, <u>visa2</u> or <u>emvcps11</u>

       Choose  <u>visa2</u>  if you have a card which uses the VISA key derivation scheme for the key calculation, like
       GemXpresso Pro or some JCOP cards you must set this.

       Choose <u>emvcps11</u> If you have a card which uses  the  EMV  CPS  1.1  key  derivation  scheme  for  the  key
       calculation,  like  a  Sm@rtCafe  Expert  3.0  and  later you must set this.  Also for put_sc_key this is
       necessary for Sm@rtcafe 5.0 (and earlier(?)) cards

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       <b>GLOBALPLATFORM_DEBUG</b>
              Enables debugging output from the underlying GlobalPlatform library.

       <b>GLOBALPLATFORM_LOGFILE</b>
              Sets the log file name for the debugging output.

</pre><h4><b>Key</b> <b>Derivation</b></h4><pre>
       <b>visa2</b>  For the VISA2 key derivation scheme, like used in a GemXpresso Pro or some JCOP cards.

       <b>emvcps11</b>
              For the key derivation according to EMV CPS 1.1 (CDK (CPG 2.04)), like Sm@rtCafe  Expert  3.0  and
              later.

       Known unsupported key derivation schemes are:

       • CDK (CPG 2.02)

       • ISK(D)

</pre><h4><b>Supported</b> <b>Cards</b></h4><pre>
       • Gemalto IDCore 3010

       • Oberthur CosmopoliC 32K (OP201)

       • CosmopoliC 64K V5.2 (GP211, SCP01, Impl05)

       • Axalto Cyberflex e-gate 32k (OP201)

       • GemXpresso R3.2 E64

       • IBM JCOP v2.2 41 (GP211)

       • IBM JCOP 31 (36k)

       • Palmera Protect V5

       • JTopV15

       • Nokia 6131 NFC Phone (GP211)

       • Axalto Cyberflex Access 64k

       • Gemalto Generations Flexible

       • Sm@rtCafe Expert 3.0

       • Tongfang420

       • Infineon SECORA™ ID S

       • JCOP4 P71

       • JCPO3 P60 EMV

       • JCOP3 P60 SecID CS

       • JCOP3 P40 EMV

       • JCOP3 P40 SecID

       • JCOP2.4.x

</pre><h4><b>Misc</b></h4><pre>
   <b>About</b> <b>install_for_load</b> <b>and</b> <b>install</b>
       For CosmopoliC 64K (tested on V5.2), you need to specify the Security Domain AID.  For example,

              install -file helloworld.cap -sdAID A000000003000000 -nvCodeLimit 4000

       For GemXpresso R3.2 E64, you need to specify the Security Domain AID (Card Manager AID).  For example,

              install -file helloworld.cap -sdAID A000000018434D00 -nvCodeLimit 4000

   <b>JCOP</b> <b>cards</b>
       If  you  cannot authenticate to your card it might be not fused.  In this case you need the transport key
       from the vendor.  Execute the JCOP IDENTIFY command.

       select -aid A000000167413000FF Offset 14 (decimal) of the response has the pre-personalized  state.   00h
       means not fused (not personalized), 01h means fused.

   <b>CyberFlex</b> <b>cards</b>
       For  the  Cyberflex  you also need the CAP transformer (I believe this is a kind of obfuscator) which you
       must apply to the CAP file.  Download it from <a href="http://www.trusted-logic.fr/down.php">http://www.trusted-logic.fr/down.php</a> and use it.

</pre><h4><b>BUGS</b></h4><pre>
       JCOP 10
              install_for_load fails for unknown reason, so nothing can be installed.

       Some cards are not supporting the GET DATA command.  This command is used by GPShell for  retrieving  the
       secure channel parameters.  So you have to pass -scp 2 -scpimpl 0x15 to open_sc command.

</pre><h4><b>AUTHOR</b></h4><pre>
       Karsten Ohme <u><a href="mailto:k_o_@users.sourceforge.net">k_o_@users.sourceforge.net</a></u> Snit Mo <u><a href="mailto:snitmo@gmail.com">snitmo@gmail.com</a></u>

       See the file AUTHORS for a complete list.

2.2.0                                                                                                 <u><a href="../man1/GPSHELL.1.html">GPSHELL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>