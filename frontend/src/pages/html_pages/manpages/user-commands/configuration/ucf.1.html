<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ucf - Update Configuration File:  preserve user changes in configuration files</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/ucf">ucf_3.0050_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ucf - Update Configuration File:  preserve user changes in configuration files

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>ucf</b> [<u>options</u>] <u>&lt;New</u> <u>File&gt;</u> <u>&lt;Destination&gt;</u>

       <b>ucf</b> [<u>options</u>] <u>--purge</u> <u>&lt;Destination&gt;</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  utility  provides a means of asking the user whether or not to accept new versions of configuration
       files provided by the package maintainer, with various heuristics designed to minimize interaction  time.
       It  uses debconf to interact with the user, as per Debian policy.  In the SYNOPSIS above, <u>New</u> <u>file</u> is the
       configuration file as provided by the package (either shipped with  the  package,  or  generated  by  the
       maintainer  scripts  on  the  fly),  and  <u>Destination</u> is the location (usually under <a href="file:/etc">/etc</a>) where the real
       configuration file lives, and is potentially modified by the end user.  Since the files edited  would  be
       real  files,  and  not  symbolic links, <b>ucf</b> follows and resolves symbolic links before acting.  As far as
       possible, ucf attempts to preserve the ownership and permission of the <u>New</u> <u>file</u> as it is  copied  to  the
       new location.

       This  script  attempts  to provide conffile like handling for files installed under <u><a href="file:/etc">/etc</a></u> not shipped in a
       <b>Debian</b> package, but handled by the postinst instead.  <b>Debian</b> policy states that files  under  <u><a href="file:/etc">/etc</a></u>  which
       are  configuration  files  <b>must</b>  preserve  user  changes, and this applies to files handled by maintainer
       scripts as well.  Using <b>ucf</b>, one may ship a bunch of default configuration  files  somewhere  in  <u><a href="file:/usr">/usr</a></u>  (
       <u><a href="file:/usr/share/">/usr/share/</a>&lt;pkg&gt;</u>  is a good location), and maintain files in <u><a href="file:/etc">/etc</a></u>, preserving user changes and in general
       offering the same facilities while upgrading that <b>dpkg</b> normally provides for <u>“conffiles”</u>.

       Additionally, this script provides facilities for  transitioning  a  file  that  had  not  been  provided
       <u>conffile</u>  like  protection to come under this schema, and attempts to minimize questions asked at install
       time.  Indeed, the transitioning facility is better than the one offered by <b>dpkg</b>  while  transitioning  a
       file  from  a  <u>non-conffile</u>  to  <u>conffile</u>  status.   The second form in the SYNOPSIS above is for purging
       information about the configuration file when the package is purged; and is critical for allowing  smooth
       reinstallations.

       During  the course of operations, when working with configuration files, <b>ucf</b> optionally creates copies of
       versions of the configuration file in question.  For example, a file with the suffix  <u>ucf-old</u>  holds  the
       old  version  of  a  configuration file replaced by <b>ucf</b>.  Also, copies of the configuration file with the
       suffixes <u>ucf-new</u> and <u>ucf-dist</u> may be created; and the maintainer scripts should consider  purging  copies
       of the configuration file with these extensions during purge.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-h,</b> <b>--help</b>
              Print a short usage message

       <b>-n,</b> <b>--no-action</b>
              Dry run.  Print the actions that would be taken if the script is invoked, but take no action.

       <b>-d[n],</b> <b>--debug=[n]</b>
              Set  the  debug  level  to the (optional) level <u>n</u> (n defaults to 1).  Please note there must be no
              spaces before the optional digit n.  This turns on copious debugging information.

       <b>-p,</b> <b>--purge</b>
              Removes all vestiges of the file from the state hashfile.  This is required to allow a package  to
              be reinstalled after it is purged; since otherwise, the real configuration file is removed, but it
              remains  in  the  hash file; and on reinstall no action is taken, since the md5sum of the new file
              matches that in the hashfile.  In short, remember to use this  option  in  the  postrm  for  every
              configuration  file  managed by ucf when the package is being purged (assuming ucf itself exists).
              <u>Note:</u> ucf does not actually touch the file on disk in this operation, so  any  file  removals  are
              still the responsibility of the calling package.

       <b>-v,</b> <b>--verbose</b>
              Make the script be very verbose about setting internal variables.

       <b>-P</b> <b>foo,</b> <b>--package</b> <b>foo</b>
              Don't follow dpkg-divert diversions by package foo when updating configuration files.

       <b>-s</b> <b>foo,</b> <b>--src-dir</b>  <b>foo</b>
              Set  the source directory (historical md5sums are expected to live in files and sub directories of
              this directory) to foo.  By default, the directory the new_file lives in  is  assumed  to  be  the
              source   directory.    Setting   this  option  overrides  settings  in  the  environment  variable
              <b>UCF_SOURCE_DIR</b>, and in the  configuration  file variable <b>conf_source_dir</b>.

       <b>--sum-file</b>  <b>foo</b>
              Force the historical md5sums to be read from this file, rather than defaulting to  living  in  the
              source   directory.    Setting   this  option  overrides  settings  in  the  environment  variable
              <b>UCF_OLD_MDSUM_FILE</b>, and in the  configuration  file variable <b>conf_old_mdsum_file</b>.

       <b>--three-way</b>
              This turns on the option, during installation, for the user to be offered a chance to see a  merge
              of  the  changes between old maintainer version and the new maintainer version into the local copy
              of the configuration file.  If the user likes what they see, they can ask to  have  these  changes
              merged  in.   This  allows  one  to  get new upstream changes merged in even while retaining local
              modifications to the configuration file.  This is accomplished by taking  the  configuration  file
              and  stashing  it  in  a  cache  area during registration, and using diff3 during the install (the
              stashed file name is a munged version of the full path of the configuration  file  to  avoid  name
              space clashes).

       <b>--debconf-ok</b>
              Indicate  that  it  is ok for <u>ucf</u> to use an already running debconf instance for prompting (it has
              always been ok to use ucf when debconf is not running – it shall invoke debconf as needed).

       <b>--debconf-template</b>  <b>foo</b>
              Instruct ucf to use the named multiselect debconf template  instead  of  the  normal  ucf-provided
              debconf template.  The caller is responsible for ensuring that the named template exists and has a
              list  of choices matching those for the default ucf template, and should set Choices-C: ${CHOICES}
              to ensure the returned values match those from the default template.  Note that the  choices  must
              be different according to whether the <b>--three-way</b> option is also set.

       <b>--state-dir</b> <b>/path/to/dir</b>
              Set  the  state  directory  to  /path/to/dir instead of the default <u><a href="file:/var/lib/ucf">/var/lib/ucf</a></u>.  Used mostly for
              testing.

       <b>-Z</b>     Set SELinux security context of destination file to default type.

</pre><h4><b>USAGE</b></h4><pre>
       The most common case usage is pretty simple: a single line invocation in the postinst on  configure,  and
       another  single line in the postrm to tell <b>ucf</b> to forget about the configuration file on purge (using the
       --purge option) is all that is needed (assuming ucf is still on the system).

       It is recommended that you also register any file being managed  by  <b>ucf</b>  with  the  ucf  registry;  this
       associates  the  configuration  file  with the package it belongs to.  This is done with a simple call to
       <b>ucfr</b>.  Users may then query the association between a configuration file and the package using  the  tool
       <b>ucfq</b>.  Please see the appropriate manual pages for details.

       Packages which employ <b>debhelper</b> can simplify creating of the necessary maintscript fragments by using the
       <b>dh_ucf</b> helper.

       If  a  file  maintained  by  maintainer  scripts  is being transitioned from an unprotected status to the
       protection afforded by the script, the maintainer can help ease the transition by reducing the  questions
       that  may  be  asked  at  installation  time.  Specifically, questions should not be asked if the file in
       question is an unmodified version that was one shipped in a previous version of  this  package;  and  the
       maintainer  can  help  by telling the script about the historical md5sums that published versions of this
       file contained.

       The way to do this is to either create a file called <b>&lt;New</b> <b>file&gt;.md5sum</b>, with one  md5sum  on  each  line,
       (the  file  names you use are ignored, except for the entry named default), or create a directory, called
       <b>&lt;New</b> <b>file&gt;.md5sum.d</b>, which should contain any number of files, each containing a single line, namely, the
       md5sum of a previous version of <b>&lt;New</b> <b>file&gt;</b>.  The names  of  these  files  are  not  important,  with  one
       exception:  The file called default is treated specially.  For example, the author personally uses either
       package version numbers or release code names, like <u>7.6.3</u>, or <u>potato</u>.  If none of the historical  md5sums
       match,  we  are  almost certain that either the historical record of md5sums is not complete, or the user
       has changed the configuration file.

   <b>The</b> <b>default</b> <b>historical</b> <b>md5sum</b>
       The exception to the rule about names mentioned earlier is that if no md5sums match, and if the file <b>&lt;New</b>
       <b>file&gt;.md5sum.d/default</b> exists,  or  if  there  is  a  line  corresponding  to  a  <u>default</u>  file  in  <b>&lt;New</b>
       <b>file&gt;.md5sum</b>,  it  shall  be used as the default md5sum of the <u>previous</u> version of the package assumed to
       have been installed on this machine.  As you can see, unless  there  are  limited  number  of  previously
       released  packages  (like  just  one), the maintainer is also making an informed guess, but the option is
       provided to the maintainer.

       If the file <b>&lt;New</b> <b>file&gt;.md5sum</b>, or the directory <b>&lt;New</b> <b>file&gt;.md5sum.d</b>  does  not  exist,  or  none  of  the
       md5sums  match, we test the installed <u>&lt;Destination&gt;</u> file to see whether it is the same as the <u>&lt;New</u> <u>file&gt;</u>.
       If not, we ask the user whether they want us to replace the file.

       An additional facility is also offered: optionally, ucf can store one old version of the maintainers copy
       of the configuration file, and, on upgrade, calculate the changes made in the maintainers version of  the
       configuration  file,  and apply that patch to the local version of the file (on user request, of course).
       There is also a preview facility where the user can inspect the results of such a  merge,  before  asking
       the action to be taken.

</pre><h4><b>ENVIRONMENT</b> <b>VARIABLES</b></h4><pre>
       The  variable  <b>UCF_FORCE_CONFFNEW</b>,  if  set,  forces  the  new  file  to  always  overwrite the installed
       destination file, while the variable <b>UCF_FORCE_CONFFOLD</b>, if set  silently  retains  the  installed  file.
       <b>UCF_FORCE_CONFFMISS</b> is only applicable when the installed destination file does not exist (perhaps due to
       user  removal),and  forces  ucf to recreate the missing file (the default behaviour is to honor the users
       wishes and not recreate the locally deleted file).  Additionally, when ucf creates an inferior shell,  it
       populates  the  variables  <b>UCF_CONFFILE_NEW</b>  and  <b>UCF_CONFFILE_OLD</b>  which  are  useful for inspecting the
       changes.

       The confmiss, confnew, confold, confdef and confask flags of the <b>DPKG_FORCE</b> variable are also  supported.
       See <b><a href="../man1/dpkg.1.html">dpkg</a></b>(1) for further information.

</pre><h4><b>FILES</b></h4><pre>
       This  script  creates  the  file  <u>new_file.md5sum</u>,  and it may copy the file (presumably shipped with the
       package) <u>&lt;New</u> <u>file&gt;</u> to its destination, <u>&lt;Destination&gt;</u>.

       <u><a href="file:/var/lib/ucf/hashfile">/var/lib/ucf/hashfile</a></u>, and <u>/var/lib/ucf/hashfile.X</u>, where <u>X</u> is a small integer, where  previous  versions
       of the hashfile are stored.

       <u><a href="file:/etc/ucf.conf">/etc/ucf.conf</a></u>

</pre><h4><b>EXAMPLES</b></h4><pre>
       If the package <u>foo</u> wants to use ucf to handle user interaction for configuration file <u>foo.conf</u>, a version
       of  which  is  provided in the package as <u>/usr/share/foo/configuration</u>, a simple invocation of ucf in the
       post inst file is all that is needed:

       <b>ucf</b> <u>/usr/share/foo/configuration</u> <u>/etc/foo.conf</u>

       On  purge,  one  should   tell   ucf   to   forget   about   the   file   (see   detailed   examples   in
       <a href="file:/usr/share/doc/ucf/examples">/usr/share/doc/ucf/examples</a>):

       <b>ucf</b>  <u>--purge</u>  <u>/etc/foo.conf</u> Please note that purge can also be used to make ucf forget the previous state
       of the files, and when the package is next installed or updated, ucf will ask the  user  to  replace  the
       current  configuration  file.   Do this if you want to change your decision to not update to a maintainer
       provided version of the configuration file.

       The motivation for this script was to provide conffile like handling  for  start  files  for  emacs  lisp
       packages (for example, <u>/etc/emacs21/site-start.d/50psgml-init.el</u> ) These start files are not shipped with
       the  package,  instead, they are installed during the post installation configuration phase by the script
       <u>/usr/lib/emacsen-common/emacs-package-install</u> <u>$package_name</u>.

       This    script    is    meant    to    be    invoked    by    the    packages    install    script     at
       <u>/usr/lib/emacsen-common/packages/install/$package_name</u>  for  each flavour of installed emacsen by calling
       it with the proper values of new file ( <u>/usr/share/emacs/site-lisp/&lt;pkg&gt;/&lt;pkg-init.el</u> ), and dest file  (
       <u>/etc/emacs21/site-start.d/50&lt;pkg-init.el</u> ), and it should do the rest.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/ucf.conf.5.html">ucf.conf</a></b>(5), ucfr<b>(1),</b> <b><a href="../man1/ucfq.1.html">ucfq</a></b>(1), dpkg<b>(1),</b> <b><a href="../man1/dh_ucf.1.html">dh_ucf</a></b>(1), diff3<b>(1).</b>

       The <b>Debian</b> Emacs policy, shipped with the package <u>emacsen-common</u>.

</pre><h4><b>AUTHOR</b></h4><pre>
       This manual page was written Manoj Srivastava &lt;<a href="mailto:srivasta@debian.org">srivasta@debian.org</a>&gt;, for the Debian GNU/Linux system.

Debian                                             May 30 2008                                            <u><a href="../man1/UCF.1.html">UCF</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>