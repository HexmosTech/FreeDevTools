<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmlogrewrite - rewrite Performance Co-Pilot archives</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/pcp">pcp_6.3.3-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmlogrewrite</b> - rewrite Performance Co-Pilot archives

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pmlogrewrite</b> [<b>-Cdiqsvw?</b>]  [<b>-c</b> <u>config</u>] [<b>-V</b> <u>version</u>] <u>inlog</u> [<u>outlog</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pmlogrewrite</b>  reads  a  set  of Performance Co-Pilot (PCP) archives identified by <u>inlog</u> and creates a PCP
       archive in <u>outlog</u>.  Under normal usage, the <b>-c</b> option will be used to nominate a  configuration  file  or
       files  that  contains specifications (see the <b>REWRITING</b> <b>RULES</b> <b>SYNTAX</b> section below) that describe how the
       data and metadata from <u>inlog</u> should be transformed to produce <u>outlog</u>.

       The typical uses for <b>pmlogrewrite</b> would be to accommodate the  evolution  of  Performance  Metric  Domain
       Agents  (PMDAs)  where the names, metadata and semantics of metrics and their associated instance domains
       may change over time, e.g. promoting the type of a metric from a 32-bit to a 64-bit integer, or  renaming
       a group of metrics.  Refer to the <b>EXAMPLES</b> section for some additional use cases.

       <b>pmlogrewrite</b>  may  also be used to redact sensitive information from PCP archives in situations where the
       archives need to be  shipped  to  another  organization  or  to  meet  privacy  policies  or  legislative
       requirements.  See <b><a href="../man1/pmlogredact.1.html">pmlogredact</a></b>(1) for an example use of <b>pmlogrewrite</b> in this context.

       <b>pmlogrewrite</b>  is  most  useful  where  PMDA  changes,  or errors in the production environment, result in
       archives that cannot be combined with <b><a href="../man1/pmlogextract.1.html">pmlogextract</a></b>(1).  By pre-processing the archives with  <b>pmlogrewrite</b>
       the resulting archives may be able to be merged with <b><a href="../man1/pmlogextract.1.html">pmlogextract</a></b>(1).

       The  input  <u>inlog</u> must be a set of PCP archives created by <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1), or possibly one of the tools that
       read and create PCP archives, e.g.  <b><a href="../man1/pmlogextract.1.html">pmlogextract</a></b>(1) and <b><a href="../man1/pmlogreduce.1.html">pmlogreduce</a></b>(1).  <u>inlog</u> is a comma-separated  list
       of  names,  each of which may be the base name of an archive or the name of a directory containing one or
       more archives.

       If no <b>-c</b> option is specified, then the default behavior simply creates <u>outlog</u> as a copy of  <u>inlog</u>.   This
       is a little more complicated than <b><a href="../man1/cat.1.html">cat</a></b>(1), as each PCP archive is made up of several physical files.

       While  <b>pmlogrewrite</b>  may  be used to repair some data consistency issues in PCP archives, there is also a
       class of repair tasks that cannot be handled by <b>pmlogrewrite</b> and <b><a href="../man1/pmloglabel.1.html">pmloglabel</a></b>(1) may be a  useful  tool  in
       these cases.

</pre><h4><b>OPTIONS</b></h4><pre>
       The available command line options are:

       <b>-c</b> <u>config</u>, <b>--config</b>=<u>config</u>
            If  <u>config</u>  is  a  file or symbolic link, read and parse rewriting rules from there.  If <u>config</u> is a
            directory, then all of the files or symbolic links in that directory (excluding those beginning with
            a period ``.'') will be used to provide the rewriting rules.  Multiple <b>-c</b> options are allowed.

       <b>-C</b>, <b>--check</b>
            Parse the rewriting rules and quit.  <u>outlog</u> is  not  created,  so  this  command  line  argument  is
            optional  with  <b>-C</b>.  When <b>-C</b> is specified, this also sets <b>-v</b> and <b>-w</b> so that all warnings and verbose
            messages are displayed as <u>config</u> is parsed.

       <b>-d</b>, <b>--desperate</b>
            Desperate mode.  Normally if a fatal error occurs, all trace of the partially  written  PCP  archive
            <u>outlog</u> is removed.  With the <b>-d</b> option, the partially created <u>outlog</u> archive is not removed.

       <b>-i</b>   Rather  than creating <u>outlog</u>, <u>inlog</u> is rewritten in place when the <b>-i</b> option is used.  A new archive
            is created using temporary file names and then renamed to <u>inlog</u> in such a way  that  if  any  errors
            (not warnings) are encountered, <u>inlog</u> remains unaltered.

       <b>-q</b>, <b>--quick</b>
            Quick  mode,  where  if  there  are  no  rewriting actions to be performed (none of the global data,
            instance domains or metrics from <u>inlog</u> will be changed), then <b>pmlogrewrite</b> will exit (with status 0,
            so success) immediately after parsing the configuration file(s) and <u>outlog</u> is not created.

       <b>-s</b>, <b>--scale</b>
            When the ``units'' of a metric are changed, if the dimension in terms of space, time  and  count  is
            unaltered, then the scaling factor is being changed, e.g. BYTE to KBYTE, or MSEC-1 to USEC-1, or the
            composite  MBYTE.SEC-1  to  KBYTE.USEC-1.   The motivation may be (a) that the original metadata was
            wrong but the values in <u>inlog</u> are correct, or (b) the metadata is changing so  the  values  need  to
            change as well.  The default <b>pmlogrewrite</b> behaviour matches case (a).  If case (b) applies, then use
            the  <b>-s</b>  option  and the values of all the metrics with a scale factor change in each result will be
            rescaled.  For finer control over value rescaling refer to the <u><b>RESCALE</b></u> option for the  <u><b>UNITS</b></u>  clause
            of the metric rewriting rule described below.

       <b>-v</b>, <b>--verbose</b>
            Enable verbose mode.

       <b>-V</b> <u>version</u>, <b>--version</b>=<u>version</u>
            Specifies  the  version of the output PCP archive being produced.  Currently versions 2 and 3 of the
            archive format is supported.  The version of <u>inlog</u> must be at least <u>version</u> (so version  upgrade  is
            allowed, but version downgrade is not).  By default, in the absence of the <u>-V</u> option, the version of
            <u>outlog</u> is the same as the version of <u>inlog</u>.

       <b>-w</b>, <b>--warnings</b>
            Emit  warnings.   Normally  <b>pmlogrewrite</b>  remains silent for any warning that is not fatal and it is
            expected that for a particular archive, some (or indeed, all) of the  rewriting  specifications  may
            not apply.  For example, changes to a PMDA may be captured in a set of rewriting rules, but a single
            archive  may not contain all of the modified metrics nor all of the modified instance domains and/or
            instances.  Because these cases are expected, they do not prevent <b>pmlogrewrite</b> executing, and  rules
            that  do  not  apply  to <u>inlog</u> are silently ignored by default.  Similarly, some rewriting rules may
            involve no change because the metadata in <u>inlog</u> already matches the intent of the rewriting rule  to
            correct  data  from a previous version of a PMDA.  The <b>-w</b> flag forces warnings to be emitted for all
            of these cases.

       <b>-?</b>, <b>--help</b>
            Display usage message and exit.

       The argument <u>outlog</u> is required in all cases, except when <b>-i</b> is specified.

</pre><h4><b>REWRITING</b> <b>RULES</b> <b>SYNTAX</b></h4><pre>
       A configuration file contains zero or more rewriting rules as defined below.

       Keywords and special punctuation characters are shown below in <u><b>bolditalic</b></u> font and are  case-insensitive,
       so <u><b>METRIC</b></u>, <u><b>metric</b></u> and <u><b>Metric</b></u> are all equivalent in rewriting rules.

       The  character  ``#'' introduces a comment and the remainder of the line is ignored.  Otherwise the input
       is relatively free format with optional white space (spaces, tabs or newlines) between lexical  items  in
       the rules.

       A <b>global</b> rewriting rule has the form:

       <u><b>GLOBAL</b></u> <u><b>{</b></u> <u>globalspec</u> ...  <u><b>}</b></u>

       where <u>globalspec</u> is zero or more of the following clauses:

           <u><b>HOSTNAME</b></u> <u><b>-&gt;</b></u> <u>hostname</u>

               Modifies  the  label  records  in the <u>outlog</u> PCP archive, so that the metrics will appear to have
               been collected from the host <u>hostname</u>.

           <u><b>TIME</b></u> <u><b>-&gt;</b></u> <u>delta</u>

               Both metric values and the instance domain metadata in a  PCP  archive  carry  timestamps.   This
               clause  forces  all the timestamps to be adjusted by <u>delta</u>, where <u>delta</u> is an optional sign ``+''
               (the default) or ``-'', an optional number of hours followed by a colon ``:'', an optional number
               of minutes followed by a colon ``:'', a number  of  seconds,  an  optional  fraction  of  seconds
               following  a period ``.''.  The simplest example would be ``30'' to increase the timestamps by 30
               seconds.  A more complex example would be ``-23:59:59.999'' to move the timestamps  backwards  by
               one millisecond less than one day.

           <u><b>TIMEZONE</b></u> <u><b>-&gt;</b></u> <u><b>"</b>timezone<b>"</b></u>
           <u><b>TZ</b></u> <u><b>-&gt;</b></u> <u><b>"</b>timezone<b>"</b></u>

               Modifies  the  label  records  in the <u>outlog</u> PCP archive, so that the metrics will appear to have
               been collected from a host with a local timezone of  <u>timezone</u>.   <u>timezone</u>  must  be  enclosed  in
               double  quotes,  and  should  conform  to the valid timezone syntax rules for the local platform,
               usually a Posix TZ format, e.g. <b>AEST-10</b>.  See <b><a href="../man3/tzset.3.html">tzset</a></b>(3) for more information.

               <u><b>TZ</b></u> is an alias for <u><b>TIMEZONE</b></u>.

           <u><b>ZONEINFO</b></u> <u><b>-&gt;</b></u> <u><b>"</b>zoneinfo<b>"</b></u>

               Modifies the label records in the <u>outlog</u> PCP archive, so that the metrics  will  appear  to  have
               been  collected  from  a  host  with  a local timezone of <u>zoneinfo</u>.  <u>zoneinfo</u> must be enclosed in
               double quotes, and should conform to the valid zoneinfo  timezone  syntax  rules  for  the  local
               platform,   usually   a   colon   followed   by   a   pathname  below  <u><a href="file:/usr/share/zoneinfo">/usr/share/zoneinfo</a></u>,  e.g.
               <b>:Africa/Timbuktu</b>.  See <b><a href="../man3/tzset.3.html">tzset</a></b>(3) for more information.

               The <u><b>zoneinfo</b></u> clause is only allowed if the output archive version is at least 3.

           <u><b>FEATURES</b></u> <u><b>-&gt;</b></u> <u>feature-bits</u>

               Modifies the label records in the <u>outlog</u> PCP archive, so that the metrics  will  appear  to  have
               been  collected  from  system  with  a  <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) that supports the ``features'' defined by the
               integer value <u>feature-bits</u>, which is formed by ``or''ing the desired feature flags as defined  in
               <b><a href="../man5/LOGARCHIVE.5.html">LOGARCHIVE</a></b>(5).   Alternatively,  <u>feature-bits</u>  can  be  specified using the ``macro'' <u><b>BITS()</b></u> that
               takes a comma separated argument list of integers (in the inclusive range 0 to 31) and  sets  the
               corresponding bits.  For example
                   features -&gt; bits(31,7,1)

               The <u><b>features</b></u> clause is only allowed if the output archive version is at least 3.

       An <b>indom</b> rewriting rule modifies an instance domain and has the form:

       <u><b>INDOM</b></u> <u>domain<b>.</b>serial</u> <u><b>{</b></u> <u>indomspec</u> ...  <u><b>}</b></u>

       where  <u>domain</u>  and  <u>serial</u>  identify  one or more existing instance domains from <u>inlog</u> - typically <u>domain</u>
       would be an integer in the range 1 to 510 and <u>serial</u> would be an integer in the range 0 to 4194304.

       As a special case <u>serial</u> could be an asterisk ``*'' which means the rule applies to every instance domain
       with a domain number of <u>domain</u>.

       If a designated instance domain is not in <u>inlog</u> the rule has no effect.

       The <u>indomspec</u> is zero or more of the following clauses:

           <u><b>INAME</b></u> "<u>oldname</u>" <u><b>-&gt;</b></u> "<u>newname</u>"

               The instance identified by the external instance  name  <u>oldname</u>  is  renamed  to  <u>newname</u>.   Both
               <u>oldname</u> and <u>newname</u> must be enclosed in double quotes.

               As  a  special case, the new name may be the keyword <u><b>DELETE</b></u> (with no double quotes), and then the
               instance <u>oldname</u> will be expunged from <u>outlog</u> which removes it from the instance domain  metadata
               and removes all values of this instance for all the associated metrics.

               If  the instance names contain any embedded spaces then special care needs to be taken in respect
               of the PCP instance naming rule that treats the leading non-space part of the  instance  name  as
               the  unique  portion  of  the name for the purposes of matching and ensuring uniqueness within an
               instance domain, refer to <b><a href="../man3/pmdaInstance.3.html">pmdaInstance</a></b>(3) for a discussion of this issue.

               As an illustration, consider the hypothetical instance domain  for  a  metric  which  contains  2
               instances with the following names:
                   red
                   eek urk

               Then some possible <u><b>INAME</b></u> clauses might be:

               "eek" -&gt; "yellow like a flower"
                         Acceptable, <u>oldname</u> "eek" matches the "eek urk" instance.

               "red" -&gt; "eek"
                         Error, <u>newname</u> "eek" matches the existing "eek urk" instance.

               "eek urk" -&gt; "red of another hue"
                         Error, <u>newname</u> "red of another hue" matches the existing "red" instance.

           <u><b>INAME</b></u> <u><b>REPLACE</b></u> /<u>pattern</u>/ <u><b>-&gt;</b></u> "<u>replacement</u>"

               Every  external  instance  name  in the instance domain is matched against the regular expression
               <u>pattern</u> and when a match is found, the name is changed based on the parts of the name matched  by
               <u>pattern</u>  and  the  <u>replacement</u>  recipe.   <u>pattern</u>  follows the syntax of a Posix Extended Regular
               Expression (see <b><a href="../man7/regex.7.html">regex</a></b>(7)) and <u>replacement</u> follows the syntax of the <b>s</b> command of <b><a href="../man1/sed.1.html">sed</a></b>(1), so <b>&amp;</b> and
               <b>\1</b> through <b>\9</b> may be used to select all or substrings of the instance name that matches <u>pattern.</u>

               Note that the match-and-replace is done at most once per external instance name, so if there  are
               repeated  sequences  of  the  name  that  match  <u>pattern</u>  only  the <b>first</b> one will be matched and
               <u>replacement</u> applied.

               <u>pattern</u> is normally enclosed in slashes (/) or double quotes (").  An  escape  (\)  may  be  used
               before any of the metacharacters described in <b><a href="../man3/regex.3.html">regex</a></b>(3) to specify a literal character, e.g. \( or
               \[ or \+ ...  The enclosing delimiters cannot be escaped, so to embed a literal slash, use double
               quotes as the delimiter, or vice versa.

               <u>replacement</u>  is normally enclosed by double quotes (") or slashes (/).  An escape (\) may be used
               before <b>&amp;</b> or <b>\</b> to specify these characters literally.  The enclosing delimiters cannot be escaped,
               so to embed a double quote, use slashes as the delimiter, or vice versa.

               If the instance names after replacement contain any embedded spaces then special care needs to be
               taken in respect of the PCP instance naming rule that treats the leading non-space  part  of  the
               instance  name  as  the  unique  portion  of  the  name for the purposes of matching and ensuring
               uniqueness within an instance domain.  Refer to <b><a href="../man3/pmdaInstance.3.html">pmdaInstance</a></b>(3) for a discussion of this issue.

               Here are some examples:

               { iname replace /[a-z]*foo[a-z]*/ -&gt; "FOO" }
                         replace any word containing "foo" with "FOO"

               { iname replace "([0-9]+) <a href="file:/.">/.</a>*/(.*)" -&gt; "\1 \2" }
                         removes a directory path, so the instance name (for one of  the  proc  PMDA's  metrics)
                         "2981799  /home/kenj/bin/foobar"  would become "2981799 foobar", hiding the user's home
                         directory and implicitly the user's login name

           <u><b>INAME</b></u> <u><b>REDACT</b></u>

               Replace every external instance name in the instance domain by the string "<u>inst</u> <b>[redacted]</b>" where
               <u>inst</u> is the internal instance identifier in ASCII format.

           <u><b>INDOM</b></u> <u><b>-&gt;</b></u> <u>newdomain<b>.</b>newserial</u>

               Modifies the metadata for the instance domain and  every  metric  associated  with  the  instance
               domain.   As a special case, <u>newserial</u> could be an asterisk ``*'' which means use <u>serial</u> from the
               <b>indom</b> rewriting rule, although this is most useful when <u>serial</u>  is  also  an  asterisk.   So  for
               example:
                   indom 29.* { indom -&gt; 109.* }
               will move all instance domains from domain 29 to domain 109.

           <u><b>INDOM</b></u> <u><b>-&gt;</b></u> <u><b>DUPLICATE</b></u> <u>newdomain<b>.</b>newserial</u>

               A  special case of the previous <u><b>INDOM</b></u> clause where the instance domain is a duplicate copy of the
               <u>domain<b>.</b>serial</u> instance domain from the <u>indom</u> rewriting rule,  and  then  any  mapping  rules  are
               applied  to  the copied <u>newdomain<b>.</b>newserial</u> instance domain.  This is useful when a PMDA is split
               and the same instance domain needs to be replicated for domain <u>domain</u> and domain  <u>newdomain</u>.   So
               for  example  if the metrics <u>foo.one</u> and <u>foo.two</u> are both defined over instance domain 12.34, and
               <u>foo.two</u> is moved to another PMDA using domain 27, then the following  rewriting  rules  could  be
               used:
                   indom 12.34 { indom -&gt; duplicate 27.34 }
                   metric foo.two { indom -&gt; 27.34 pmid -&gt; 27.*.*  }

           <u><b>INST</b></u> <u>oldid</u> <u><b>-&gt;</b></u> <u>newid</u>

               The  instance  identified by the internal instance identifier <u>oldid</u> is renumbered to <u>newid</u>.  Both
               <u>oldid</u> and <u>newid</u> are integers in the range 0 to 231-1.

               As a special case, <u>newid</u> may be the keyword <u><b>DELETE</b></u> and then the instance <u>oldid</u> will  be  expunged
               from  <u>outlog</u>  which  removes  it from the instance domain metadata and removes all values of this
               instance for all the associated metrics.

       A <b>metric</b> rewriting rule has the form:

       <u><b>METRIC</b></u> <u>metricid</u> <u><b>{</b></u> <u>metricspec</u> ...  <u><b>}</b></u>

       where <u>metricid</u> identifies one or more existing metrics from <u>inlog</u> using either  a  metric  name,  or  the
       internal encoding for a metric's PMID as <u>domain<b>.</b>cluster<b>.</b>item</u>.  In the latter case, typically <u>domain</u> would
       be  an  integer in the range 1 to 510, <u>cluster</u> would be an integer in the range 0 to 4095, and <u>item</u> would
       be an integer in the range 0 to 1023.

       As special cases <u>item</u> could be an asterisk ``*'' which means the rule applies  to  every  metric  with  a
       domain  number of <u>domain</u> and a cluster number of <u>cluster</u>, or <u>cluster</u> could be an asterisk which means the
       rule applies to every metric with a domain number of <u>domain</u> and an item number of <u>item</u>, or  both  <u>cluster</u>
       and <u>item</u> could be asterisks, and rule applies to every metric with a domain number of <u>domain</u>.

       If a designated metric is not in <u>inlog</u> the rule has no effect.

       The <u>metricspec</u> is zero or more of the following clauses:

           <u><b>DELETE</b></u>

               The  metric  is  completely  removed from <u>outlog</u>, both the metadata and all values in results are
               expunged.

           <u><b>INDOM</b></u> <u><b>-&gt;</b></u> <u>newdomain<b>.</b>newserial</u> [ <u>pick</u> ]

               Modifies the metadata to change the instance domain for this metric.   The  new  instance  domain
               must exist in <u>outlog</u>.

               The  optional  <u>pick</u>  clause  may be used to select one input value, or compute an aggregate value
               from the instances in an input result, or assign an internal  instance  identifier  to  a  single
               output  value.  If no <u>pick</u> clause is specified, the default behaviour is to copy all input values
               from each input result to an output result, however if the  input  instance  domain  is  singular
               (indom <b>PM_INDOM_NULL</b>) then the one output value must be assigned an internal instance identifier,
               which is 0 by default, unless over-ridden by a <u><b>INST</b></u> or <u><b>INAME</b></u> clause as defined below.

               The choices for <u>pick</u> are as follows:

               <u><b>OUTPUT</b></u> <u><b>FIRST</b></u>
                           choose the value of the first instance from each input result

               <u><b>OUTPUT</b></u> <u><b>LAST</b></u> choose the value of the last instance from each input result

               <u><b>OUTPUT</b></u> <u><b>INST</b></u> <u>instid</u>
                           choose  the  value of the instance with internal instance identifier <u>instid</u> from each
                           result; the sequence of rewriting rules ensures the <u><b>OUTPUT</b></u> processing happens  before
                           instance  identifier  renumbering from any associated <b>indom</b> rule, so <u>instid</u> should be
                           one of the internal instance identifiers that appears in <u>inlog</u>

               <u><b>OUTPUT</b></u> <u><b>INAME</b></u> "<u>name</u>"
                           choose the value of the instance with <u>name</u> for its external instance name  from  each
                           result;  the sequence of rewriting rules ensures the <u><b>OUTPUT</b></u> processing happens before
                           instance renaming from any associated <b>indom</b> rule,  so  <u>name</u>  should  be  one  of  the
                           external instance names that appears in <u>inlog</u>

               <u><b>OUTPUT</b></u> <u><b>MIN</b></u>  choose  the  smallest  value  in  each result (metric type must be numeric and output
                           instance will be 0 for a non-singular instance domain)

               <u><b>OUTPUT</b></u> <u><b>MAX</b></u>  choose the largest value in each result (metric  type  must  be  numeric  and  output
                           instance will be 0 for a non-singular instance domain)

               <u><b>OUTPUT</b></u> <u><b>SUM</b></u>  choose  the  sum of all values in each result (metric type must be numeric and output
                           instance will be 0 for a non-singular instance domain)

               <u><b>OUTPUT</b></u> <u><b>AVG</b></u>  choose the average of all values in each result (metric  type  must  be  numeric  and
                           output instance will be 0 for a non-singular instance domain)

               If  the  input  instance  domain  is  singular (indom <b>PM_INDOM_NULL</b>) then independent of any <u>pick</u>
               specifications, there is at most one value in each input result and so <u><b>FIRST</b></u>, <u><b>LAST</b></u>, <u><b>MIN</b></u>, <u><b>MAX</b></u>, <u><b>SUM</b></u>
               and <u><b>AVG</b></u> are all equivalent and the output instance identifier will be 0.

               In general it is an error to specify a rewriting action for the same metadata  or  result  values
               more  than once, e.g. more than one <u><b>INDOM</b></u> clause for the same instance domain.  The one exception
               is the possible interaction between the <u><b>INDOM</b></u> clauses in the <b>indom</b> and <b>metric</b> rules.  For example
               the metric <u>sample.bin</u> is defined over the instance domain 29.2 in  <u>inlog</u>  and  the  following  is
               acceptable (albeit redundant):
                   indom 29.* { indom -&gt; 109.* }
                   metric sample.bin { indom -&gt; 109.2 }
               However the following is an error, because the instance domain for <u>sample.bin</u> has two conflicting
               definitions:
                   indom 29.* { indom -&gt; 109.* }
                   metric sample.bin { indom -&gt; 123.2 }

           <u><b>INDOM</b></u> <u><b>-&gt;</b></u> <u><b>NULL</b></u>[ <u>pick</u> ]

               The metric (which must have been previously defined over an instance domain) is being modified to
               be a singular metric.  This involves a metadata change and collapsing all results for this metric
               so that multiple values become one value.

               The  optional  <u>pick</u>  part  of  the  clause  defines  how  the one value for each result should be
               calculated and follows the same rules as described for the non-NULL <u><b>INDOM</b></u> case above.

               In the absence of <u>pick</u>, the default is <u><b>OUTPUT</b></u> <u><b>FIRST</b></u>.

           <u><b>NAME</b></u> <u><b>-&gt;</b></u> <u>newname</u>

               Renames the metric in the PCP archive's metadata that supports the Performance Metrics Name Space
               (PMNS).  <u>newname</u> should not match any existing name in the archive's PMNS  and  must  follow  the
               syntactic rules for valid metric names as outlined in <b><a href="../man5/PMNS.5.html">PMNS</a></b>(5).

           <u><b>PMID</b></u> <u><b>-&gt;</b></u> <u>newdomain<b>.</b>newcluster<b>.</b>newitem</u>

               Modifies  the  metadata  and results to renumber the metric's PMID.  As special cases, <u>newcluster</u>
               could be an asterisk ``*'' which means use <u>cluster</u> from the <b>metric</b>  rewriting  rule  and/or  <u>item</u>
               could  be  an  asterisk which means use <u>item</u> from the <b>metric</b> rewriting rule.  This is most useful
               when <u>cluster</u> and/or <u>item</u> is also an asterisk.  So for example:
                   metric 30.*.* { pmid -&gt; 123.*.* }
               will move all metrics from domain 30 to domain 123.

           <u><b>SEM</b></u> <u><b>-&gt;</b></u> <u>newsem</u>

               Change the semantics of the metric.  <u>newsem</u> should be the XXX part of the  name  of  one  of  the
               <b>PM_SEM_XXX</b> macros defined in &lt;pcp/pmapi.h&gt; or <b><a href="../man3/pmLookupDesc.3.html">pmLookupDesc</a></b>(3), e.g.  <u><b>COUNTER</b></u> for <b>PM_TYPE_COUNTER</b>.

               No  data value rewriting is performed as a result of the <u><b>SEM</b></u> clause, so the usefulness is limited
               to cases where a version of the associated PMDA was exporting incorrect semantics for the metric.
               <b><a href="../man1/pmlogreduce.1.html">pmlogreduce</a></b>(1) may provide an alternative in cases  where  re-computation  of  result  values  is
               desired.

           <u><b>TYPE</b></u> <u><b>-&gt;</b></u> <u>newtype</u>

               Change  the type of the metric which alters the metadata and may change the encoding of values in
               results.  <u>newtype</u> should be the XXX part of the name of one of the <b>PM_TYPE_XXX</b> macros defined  in
               &lt;pcp/pmapi.h&gt; or <b><a href="../man3/pmLookupDesc.3.html">pmLookupDesc</a></b>(3), e.g.  <u><b>FLOAT</b></u> for <b>PM_TYPE_FLOAT</b>.

               Type  conversion  is  only  supported  for cases where the old and new metric type is numeric, so
               <b>PM_TYPE_STRING</b>, <b>PM_TYPE_AGGREGATE</b> and <b>PM_TYPE_EVENT</b> are not allowed.  Even for the numeric cases,
               some conversions may produce run-time errors, e.g. integer overflow, or attempting to  rewrite  a
               negative value into an unsigned type.

           <u><b>TYPE</b></u> <u><b>IF</b></u> <u>oldtype</u> <u><b>-&gt;</b></u> <u>newtype</u>

               The  same  as the preceding <u><b>TYPE</b></u> clause, except the type of the metric is only changed to <u>newtype</u>
               if the type of the metric in <u>inlog</u> is <u>oldtype.</u>

               This useful in cases where the type of <u>metricid</u> in <u>inlog</u> may be platform dependent  and  so  more
               than one type rewriting rule is required.

           <u><b>UNITS</b></u> <u><b>-&gt;</b></u> <u>newunits</u> [ <u><b>RESCALE</b></u> ]

               <u>newunits</u>  is  six  values  separated by commas.  The first 3 values describe the dimension of the
               metric along the dimensions of space, time and count; these are integer values, usually 0,  1  or
               -1.  The remaining 3 values describe the scale of the metric's values in the dimensions of space,
               time  and count.  Space scale values should be 0 (if the space dimension is 0), else the XXX part
               of the name of one of the <b>PM_SPACE_XXX</b> macros, e.g.  <u><b>KBYTE</b></u> for <b>PM_TYPE_KBYTE</b>.  Time scale  values
               should be 0 (if the time dimension is 0), else the XXX part of the name of one of the <b>PM_TIME_XXX</b>
               macros,  e.g.  <u><b>SEC</b></u> for <b>PM_TIME_SEC</b>.  Count scale values should be 0 (if the time dimension is 0),
               else <u><b>ONE</b></u> for <b>PM_COUNT_ONE</b>.

               The  <b>PM_SPACE_XXX</b>,  <b>PM_TIME_XXX</b>  and  <b>PM_COUNT_XXX</b>  macros  are  defined  in   &lt;pcp/pmapi.h&gt;   or
               <b><a href="../man3/pmLookupDesc.3.html">pmLookupDesc</a></b>(3).

               When  the  scale  is changed (but the dimension is unaltered) the optional keyword <u><b>RESCALE</b></u> may be
               used to chose value rescaling as per the <b>-s</b> command line option, but applied to just this metric.

           <u><b>VALUE</b></u> <u><b>REPLACE</b></u> /<u>pattern</u>/ <u><b>-&gt;</b></u> "<u>replacement</u>"

               The value for every instance of the metric is matched against the regular expression <u>pattern</u>  and
               when  a  match  is found, the value is changed based on the parts of the value matched by <u>pattern</u>
               and the <u>replacement</u> recipe.  <u>pattern</u> follows the syntax of a Posix  Extended  Regular  Expression
               (see <b><a href="../man7/regex.7.html">regex</a></b>(7)) and <u>replacement</u> follows the syntax of the <b>s</b> command of <b><a href="../man1/sed.1.html">sed</a></b>(1), so <b>&amp;</b> and <b>\1</b> through
               <b>\9</b> may be used to select all or substrings of the value that matches <u>pattern.</u>

               Note  that  the match-and-replace is done at most once per metric value, so if there are repeated
               sequences of the metric value that  match  <u>pattern</u>  only  the  <b>first</b>  one  will  be  matched  and
               <u>replacement</u> applied.

               <u>pattern</u>  is  normally  enclosed  in  slashes (/) or double quotes (").  An escape (\) may be used
               before any of the metacharacters described in <b><a href="../man3/regex.3.html">regex</a></b>(3) to specify a literal character, e.g. \( or
               \[ or \+ ...  The enclosing delimiters cannot be escaped, so to embed a literal slash, use double
               quotes as the delimiter, or vice versa.

               <u>replacement</u> is normally enclosed by double quotes (") or slashes (/).  An escape (\) may be  used
               before <b>&amp;</b> or <b>\</b> to specify these characters literally.  The enclosing delimiters cannot be escaped,
               so to embed a double quote, use slashes as the delimiter, or vice versa.

               The <u><b>REPLACE</b></u> keyword is optional.

               This clause can only be applied to metrics with values of type <b>PM_TYPE_STRING</b>.

               Here are some examples:

               { value <a href="file:/.">/.</a>*/ -&gt; "" }
                         remove the value everywhere

               value "<a href="file:/.">/.</a>*/(.*)" -&gt; "\1" }
                         removes  a  directory  path,  so the metric value "mumble /home/kenj/bin/foobar fumble"
                         would become "mumble foobar fumble", hiding the user's home  directory  and  implicitly
                         the user's login name

           When  changing  the domain number for a metric or instance domain, the new domain number will usually
           match an existing PMDA's domain number.  If this is not the case, then the new domain  number  should
           not  be  randomly  chosen;  consult  <b>$PCP_VAR_DIR/pmns/stdpmid</b>  for  domain  numbers that are already
           assigned to PMDAs.

       A <b>text</b> rewriting rule modifies a help text record and has the form:

       <u><b>TEXT</b></u> <u>textid</u> [ <u>texttype</u> ] [ "<u>textcontent</u>" ] <u><b>{</b></u> <u>textspec</u> ...  <u><b>}</b></u>

       where <u>textid</u> identifies the metric or instance domain with which the text is currently associated, and is
       either <u><b>METRIC</b></u> <u>metricid</u> or <u><b>INDOM</b></u> <u>domain<b>.</b>serial</u>.

       <u>metricid</u> has the same form and meaning as for a <u><b>METRIC</b></u> rewriting rule (see above) and  <u>domain<b>.</b>serial</u>  has
       the same form and meaning as for an <u><b>INDOM</b></u> rewriting rule (see above).

       The  optional  <u>texttype</u> identifies the type of text and may be one of <u><b>ONELINE</b></u> to select the one line help
       text, <u><b>HELP</b></u> to select the full help text, or <u><b>ALL</b></u> or an asterisk ``*'' to select both types of  help  text.
       If <u>texttype</u> is not specified, then the default is <u><b>ONELINE</b></u>.

       The  optional  <u>textcontent</u>  further restricts the selected text records to those containing the specified
       content.  Characters such as double quotes may be escaped by preceding them with a backslash ``\''.

       If a designated help text record is not in <u>inlog</u> the rule has no effect.

       The <u>textspec</u> is zero or more of the following clauses:

           <u><b>DELETE</b></u>

               The selected text is completely removed from <u>outlog</u>.

           <u><b>INDOM</b></u> <u><b>-&gt;</b></u> <u>newdomain<b>.</b>newserial</u>

               Re-associates the text with the specified instance domain.  As a special case, <u>newserial</u> could be
               an asterisk ``*'' which means use <u>serial</u> from the <b>text</b> rewriting  rule,  although  this  is  most
               useful when <u>serial</u> is also an asterisk.  So for example:
                   text indom 29.* all { indom -&gt; 109.* }
               will re-associate all text associated with instance domains from domain 29 to domain 109.

           <u><b>METRIC</b></u> <u><b>-&gt;</b></u> <u>newdomain<b>.</b>newcluster<b>.</b>newitem</u>

               Re-associates  the  text  with  the  specified  metric.  As special cases, <u>newcluster</u> could be an
               asterisk ``*'' which means use <u>cluster</u> from the <b>text</b> rewriting  rule  and/or  <u>item</u>  could  be  an
               asterisk  which  means  use  <u>item</u> from the <b>text</b> rewriting rule.  This is most useful when <u>cluster</u>
               and/or <u>item</u> is also an asterisk.  So for example:
                   text metric 30.*.* all { metric -&gt; 123.*.* }
               will re-associate all text associated with metrics from domain 30 to domain 123.

           <u><b>TEXT</b></u> <u><b>-&gt;</b></u> <u><b>"</b>new-text<b>"</b></u>

               Replaces the content of the selected text with <u>new-text</u>.

       A <b>label</b> rewriting rule modifies a label record and has the form:

       <u><b>LABEL</b></u> <u>labelid</u> [ <u>instance</u> ] [ <u><b>"</b>label-name<b>"</b></u> ] [ <u><b>"</b>label-value<b>"</b></u> ] <u><b>{</b></u> <u>labelspec</u> ...  <u><b>}</b></u>

       where <u>labelid</u> refers to the global context or identifies the metric domain, metric cluster, metric  item,
       instance domain, or instance domain instances with which the label is currently associated, and is either
       <u><b>CONTEXT</b></u>  or  <u><b>DOMAIN</b></u>  <u>domainid</u>  or  <u><b>CLUSTER</b></u>  <u>domainid<b>.</b>clusterid</u> or <u><b>ITEM</b></u> <u>metricid</u> or <u><b>INDOM</b></u> <u>domain<b>.</b>serial</u> or
       <u><b>INSTANCES</b></u> <u>domain<b>.</b>serial</u>.

       <u>metricid</u> has the same form and meaning as for a <u><b>METRIC</b></u> rewriting rule (see above).  <u>clusterid</u> may  be  an
       asterisk  ``*'' which means the rule applies to every metric with a domain number of <u>domainid</u> in the same
       way as an asterisk may be used for the cluster within <u>metricid</u>.

       <u>domain<b>.</b>serial</u> has the same form and meaning as for an <u><b>INDOM</b></u> rewriting rule (see above).

       In the case of an <u><b>INSTANCES</b></u> <u>labelid</u>, the name  or  number  of  a  specific  instance  may  be  optionally
       specified  as  <u>instance</u>.   This name or number number may be omitted or specified as an asterisk ``*'' to
       indicate that labels for all instances of the specified instance domain are  selected.   If  an  instance
       name  is  specified,  it must be within double quotes.  If the instance name contains any embedded spaces
       then special care needs to be taken in respect of the PCP instance naming rule that  treats  the  leading
       non-space  part  of  the instance name as the unique portion of the name for the purposes of matching and
       ensuring uniqueness within an instance domain, refer to <b><a href="../man3/pmdaInstance.3.html">pmdaInstance</a></b>(3) for a discussion of this issue.

       In all cases, a <u><b>"</b>label-name<b>"</b></u> and/or a <u><b>"</b>label-value<b>"</b></u> may be optionally specified in double quotes in order
       to select labels with the given name and/or given value.  These may individually be omitted or  specified
       as asterisks ``*'' to indicate that labels with all names and/or values are selected.

       If a designated label record is not in <u>inlog</u> the rule has no effect.

       The <u>labelspec</u> is zero or more of the following clauses:

           <u><b>DELETE</b></u>

               The selected labels are completely removed from <u>outlog</u>.

           <u><b>NEW</b></u> <u><b>"</b>new-label-name<b>"</b></u> <u><b>"</b>new-label-value<b>"</b></u>

               A  new  label  with  the  name  <u><b>"</b>new-label-name<b>"</b></u>  and  the value <u><b>"</b>new-label-value<b>"</b></u> is created and
               associated with the specified <u>labelid</u> and optional <u>instance</u> (in the case of a <u><b>INSTANCES</b></u> <u>labelid</u>).
               If <u><b>"</b>label-name<b>"</b></u> or <u><b>"</b>label-value<b>"</b></u> were specified, then  they  are  ignored  with  a  warning.   If
               <u>instance</u>  is  not  specified  for an <u><b>INSTANCES</b></u> <u>labelid</u>, then a new label will be created for each
               instance in the specified instance domain.

           <u><b>LABEL</b></u> <u><b>-&gt;</b></u> <u><b>"</b>new-label-name<b>"</b></u>

               The name of the selected label(s) is changed to <u><b>"</b>new-label-name<b>"</b></u>.

           <u><b>VALUE</b></u> <u><b>-&gt;</b></u> <u><b>"</b>new-label-value<b>"</b></u>

               The value of the selected label(s) is changed to <u><b>"</b>new-label-value<b>"</b></u>.

           <u><b>DOMAIN</b></u> <u><b>-&gt;</b></u> <u>newdomain</u>

               Re-associates the selected label(s) with the specified metric domain.  For example:
                   label domain 30 { domain -&gt; 123 }
               will re-associate all labels associated with domains from domain 30 to domain 123.

           <u><b>CLUSTER</b></u> <u><b>-&gt;</b></u> <u>newdomain<b>.</b>newcluster</u>

               Re-associates the selected label(s) with the  specified  metric  cluster.   As  a  special  case,
               <u>newcluster</u>  could  be  an  asterisk  ``*'' which means use <u>cluster</u> from the <b>label</b> rewriting rule.
               This is most useful when <u>cluster</u> is also an asterisk.  So for example:
                   label cluster 30.* { cluster -&gt; 123.* }
               will re-associate all labels associated with clusters from domain 30 to domain 123.

           <u><b>ITEM</b></u> <u><b>-&gt;</b></u> <u>newdomain<b>.</b>newcluster<b>.</b>newitem</u>

               Re-associates the selected label(s) with the specified metric item.  As special cases, <u>newcluster</u>
               could be an asterisk ``*'' which means use <u>cluster</u> from the  <b>label</b>  rewriting  rule  and/or  <u>item</u>
               could  be  an  asterisk  which means use <u>item</u> from the <b>label</b> rewriting rule.  This is most useful
               when <u>cluster</u> and/or <u>item</u> is also an asterisk.  So for example:
                   label item 30.*.* { item -&gt; 123.*.* }
               will re-associate all labels associated with metrics from domain 30 to domain 123.

           <u><b>INDOM</b></u> <u><b>-&gt;</b></u> <u>newdomain<b>.</b>newserial</u>

               Re-associates the selected label(s) with the specified  instance  domain.   As  a  special  case,
               <u>newserial</u>  could  be  an  asterisk  ``*''  which  means use <u>serial</u> from the <b>label</b> rewriting rule,
               although this is most useful when <u>serial</u> is also an asterisk.  So for example:
                   label indom 29.* { indom -&gt; 109.* }
               will re-associate all labels associated with instance domains from domain 29 to domain 109.

           <u><b>INSTANCES</b></u> <u><b>-&gt;</b></u> <u>newdomain<b>.</b>newserial</u>

               This is the same as <u><b>INDOM</b></u> except that it re-associates the selected label(s) with  the  instances
               of the specified instance domain.

</pre><h4><b>EXAMPLES</b></h4><pre>
       To promote the values of the per-disk IOPS metrics to 64-bit to allow aggregation over a long time period
       for  capacity  planning, or because the PMDA has changed to export 64-bit counters and we want to convert
       old archives so they can be processed alongside new archives.
           metric disk.dev.read { type -&gt; U64 }
           metric disk.dev.write { type -&gt; U64 }
           metric disk.dev.total { type -&gt; U64 }

       The instances associated with the load average metric <b>kernel.all.load</b> could be renamed and renumbered  by
       the rules below.
           # for the Linux PMDA, the kernel.all.load metric is defined
           # over instance domain 60.2
           indom 60.2 {
               inst 1 -&gt; 60 iname "1 minute" -&gt; "60 second"
               inst 5 -&gt; 300 iname "5 minute" -&gt; "300 second"
               inst 15 -&gt; 900 iname "15 minute" -&gt; "900 second"
           }

       If  we  decide to split the ``proc'' metrics out of the Linux PMDA, this will involve changing the domain
       number for the PMID of these metrics and the associated instance domains.  The rules below would  rewrite
       an old archive to match the changes after the PMDA split.
           # all Linux proc metrics are in 7 clusters
           metric 60.8.* { pmid -&gt; 123.*.* }
           metric 60.9.* { pmid -&gt; 123.*.* }
           metric 60.13.* { pmid -&gt; 123.*.* }
           metric 60.24.* { pmid -&gt; 123.*.* }
           metric 60.31.* { pmid -&gt; 123.*.* }
           metric 60.32.* { pmid -&gt; 123.*.* }
           metric 60.51.* { pmid -&gt; 123.*.* }
           # only one instance domain for Linux proc metrics
           indom 60.9 { indom -&gt; 123.0 }

       If  the  metric  foo.count_em was exported as a native ``long'' then it could be a 32-bit integer on some
       platforms and a 64-bit integer on other platforms.  Subsequent investigations show the value is  in  fact
       unsigned, so the following rules could be used.
           metric foo.count_em {
                type if 32 -&gt; U32
                type if 64 -&gt; U64
           }

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       All  error  conditions  detected by <b>pmlogrewrite</b> are reported on <u>stderr</u> with textual (if sometimes terse)
       explanation.

       Should the input archive be corrupted (this can happen if  the  <b>pmlogger</b>  instance  writing  the  archive
       suddenly  dies), then <b>pmlogrewrite</b> will detect and report the position of the corruption in the file, and
       any subsequent information from that archive will not be processed.

       If the input archive contains no archive records then an ``empty  archive''  warning  is  issued  and  no
       processing is performed.

       If any error is detected, <b>pmlogrewrite</b> will exit with a non-zero status.

</pre><h4><b>FILES</b></h4><pre>
       For each of the <u>inlog</u> and <u>outlog</u> archives, several physical files are used.

       <u>archive</u><b>.meta</b>
            metadata (metric descriptions, instance domains, etc.) for the archive

       <u>archive</u><b>.0</b>
            initial volume of metrics values (subsequent volumes have suffixes <b>1</b>, <b>2</b>, ...).

       <u>archive</u><b>.index</b>
            temporal index to support rapid random access to the other files in the archive.

</pre><h4><b>PCP</b> <b>ENVIRONMENT</b></h4><pre>
       Environment  variables with the prefix <b>PCP_</b> are used to parameterize the file and directory names used by
       PCP.  On each installation, the file <u>/etc/pcp.conf</u> contains the local values for  these  variables.   The
       <b>$PCP_CONF</b> variable may be used to specify an alternative configuration file, as described in <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5).

       For environment variables affecting PCP tools, see <b><a href="../man3/pmGetOptions.3.html">pmGetOptions</a></b>(3).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1),  <b><a href="../man1/pmlogdump.1.html">pmlogdump</a></b>(1),  <b><a href="../man1/pmlogextract.1.html">pmlogextract</a></b>(1), <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1), <b><a href="../man1/pmloglabel.1.html">pmloglabel</a></b>(1), <b><a href="../man1/pmlogredact.1.html">pmlogredact</a></b>(1), <b><a href="../man1/pmlogreduce.1.html">pmlogreduce</a></b>(1),
       <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3), <b><a href="../man3/pmdaInstance.3.html">pmdaInstance</a></b>(3), <b><a href="../man3/pmLookupDesc.3.html">pmLookupDesc</a></b>(3), <b><a href="../man3/tzset.3.html">tzset</a></b>(3), <b><a href="../man5/LOGARCHIVE.5.html">LOGARCHIVE</a></b>(5), <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5), <b><a href="../man5/pcp.env.5.html">pcp.env</a></b>(5), <b><a href="../man5/PMNS.5.html">PMNS</a></b>(5) and
       <b><a href="../man7/regex.7.html">regex</a></b>(7).

Performance Co-Pilot                                                                             <u><a href="../man1/PMLOGREWRITE.1.html">PMLOGREWRITE</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>