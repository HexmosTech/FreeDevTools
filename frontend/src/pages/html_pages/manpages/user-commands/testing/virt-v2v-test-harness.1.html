<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>virt-v2v-test-harness - Used to test virt-v2v against real test cases</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/virt-v2v">virt-v2v_1.44.2-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       virt-v2v-test-harness - Used to test virt-v2v against real test cases

</pre><h4><b>SYNOPSIS</b></h4><pre>
        open V2v_test_harness

        let test = "rhel_45_i386_fv"
        let test_plan = {
          default_plan with
            boot_plan = Boot_to_screenshot (test ^ "-login.ppm")
        }

        let () = run ~test ~test_plan ()

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b><a href="../man1/virt-v2v.1.html">virt-v2v</a></b>(1) converts guests from a foreign hypervisor to run on KVM, managed by libvirt, OpenStack,
       oVirt, Red Hat Virtualisation (RHV) or several other targets.

       Virt-v2v-test-harness is a small library (module name: "V2v_test_harness") used to run virt-v2v against a
       set of test cases consisting of real virtual machines.

       It acts as a test harness, taking a test case, running virt-v2v on it (non-destructively), then test-
       booting the result.  It can ensure that the test case converts successfully, boots successfully, and
       reaches a milestone (such as a particular screenshot).  It can also test that the conversion created,
       modified or deleted the expected files from within the guest.

   <b>GETTING</b> <b>THE</b> <b>TEST</b> <b>CASES</b>
       Because the test cases are actual virtual machines, we split them into two groups: test cases which are
       freely redistributable and those which are proprietary.  The former are things like Fedora or CentOS
       images, which are free software.  The latter are things like Windows or Red Hat Enterprise Linux.

       The freely redistributable test cases can be downloaded from:
       <a href="http://git.annexia.org/">http://git.annexia.org/</a>?p=virt-v2v-test-cases-free.git <u><b>not</b></u> <u><b>available</b></u> <u><b>yet</b></u>

       The proprietary test cases are available at <a href="http://git.annexia.org/">http://git.annexia.org/</a>?p=virt-v2v-test-cases-nonfree.git
       This <u>does</u> <u>not</u> contain the proprietary images themselves, which are not made available to the public for
       licensing reasons.

       The test cases consist of disk images which are very large, from 250 MB through to tens of gigabytes
       <u>each</u>.  This means that distributing test cases can be very time-consuming and expensive.  We use
       <b><a href="../man1/git-annex.1.html">git-annex</a></b>(1) to distribute the test images.

   <b>REQUIREMENTS</b>
       It’s recommended to use an idle machine for testing.  You will need <b>a</b> <b>lot</b> <b>of</b> <b>disk</b> <b>space</b> to run the tests,
       in excess of 100 GB.  You should also ensure the test machine has plenty of RAM, at least 16 GB.

   <b>GETTING</b> <b>THE</b> <b>TEST</b> <b>HARNESS</b>
       To run the test cases you must have the virt-v2v test harness.

       The OCaml module is "V2v_test_harness".

       The easiest way is to compile libguestfs from source (<u>note</u> do not install it).  The test harness will be
       in "virt-v2v.git/test-harness"

       It is also possible to install test harness as an OCaml module.

   <b>RUNNING</b> <b>THE</b> <b>TEST</b> <b>CASES</b>
       Once you have checked out the freely redistributed test cases from the repository, do:

        ./configure [--with-test-harness=/path/to/virt-v2v/test-harness]
        make
        make check -k

       Using the <u>-k</u> option is recommended so the test doesn't stop at the first failure.

   <b>PARALLEL</b> <b>TESTS</b>
       You can run test cases in parallel by doing:

        make check -k -j&lt;N&gt;

       (eg. <u>-j2</u> for running up to 2 tests in parallel).  Be careful about running too many parallel tests, as it
       can slow down each test enough to cause false failures.

   <b>RUNNING</b> <b>TEST</b> <b>CASES</b> <b>AGAINST</b> <b>UPSTREAM</b> <b>VIRT-V2V</b>
       Using "make check" picks up whatever "virt-v2v" binary is on your $PATH.

       If you have compiled libguestfs from source and want to test that version of virt-v2v, use the libguestfs
       "run" script (in the top-level build directory of the libguestfs sources).  eg:

        ../libguestfs/run make check -k

</pre><h4><b>WRITING</b> <b>NEW</b> <b>TEST</b> <b>CASES</b></h4><pre>
       If you are interested in writing test cases, it is suggested that you start by downloading the freely
       redistributable test cases, or at least look at them online.

       Also you must have the virt-v2v test harness - see "GETTING THE TEST HARNESS" above.

   <b>FILES</b> <b>IN</b> <b>EACH</b> <b>TEST</b> <b>CASE</b>
       Each test case consists of:

       <u>test</u>.img.xz
           The  disk  image  of  the virtual machine before conversion.  Usually this should be converted to raw
           format and xz-compressed.

       <u>test</u>.ova
           Alternatively, an OVA, exported from VMware, may be used.

       <u>test</u>.xml
           The libvirt XML used as input to virt-v2v.  See the discussion of <u>-i</u> <u>libvirtxml</u> in <b><a href="../man1/virt-v2v.1.html">virt-v2v</a></b>(1).

       <u>test</u>.ppm
           An optional screenshot or screenshots.

           You can supply zero or more "known good" screenshots which represent  intermediate  steps  where  the
           guest is booting.  This is useful where a guest sits for some time doing something, and lets the test
           harness know that it should allow the guest to continue to boot.

           You  can  supply  zero or one "final" screenshot.  This is often a screenshot of the login page which
           indicates that the guest booted successfully.

           The screenshots are captured using <b><a href="../man1/virsh.1.html">virsh</a></b>(1).  Comparison of screenshots against the  test  images  is
           done using the ImageMagick <b><a href="../man1/compare.1.html">compare</a></b>(1) program.

       <u>test</u>.ml
           The test itself - see below.

   <b>WRITING</b> <b>THE</b> <b>TEST</b>
       The  test  file  (<u>*.ml</u>)  is  used to control the test harness, and minimally it would look something like
       this:

        open V2v_test_harness

        let test = "short_name"

        let () = run ~test ()

       That would instruct the test harness to:

       •   Uncompress <u>short_name.img.xz</u>

       •   Run "virt-v2v -i libvirtxml <u>short_name</u>.xml [...]"

       •   Boot the resulting guest and check that it writes to its disk and then the disk becomes idle.

       The above is a rather simplistic test.  A more realistic test is to ensure  the  guest  reaches  a  final
       milestone (screenshot), eg. a login page.  To do that you have to supply a "~test_plan" parameter:

        open V2v_test_harness

        let test = "short_name"
        let test_plan = {
          default_plan with
            boot_plan = Boot_to_screenshot (test ^ ".ppm")
        }

        let () = run ~test ~test_plan ()

       For  an  even better test, you can supply post-conversion and post-boot test cases which examine the disk
       image (using libguestfs) to verify that files have been created, modified or deleted as  expected  within
       the disk image.  See <u>V2v_test_harness.mli</u> for more information on how to do that.

   <b>FILES</b> <b>GENERATED</b> <b>BY</b> <b>RUNNING</b> <b>THE</b> <b>TEST</b>
       When you run each test, the following files can be created:

       <u>test</u>-<u>yyyymmdd-hhmmss</u>.scrn
           Screenshot(s)  of  the  guest’s graphical console.  These are helpful when writing tests or debugging
           test failures.

           The screenshot format is Portable Pixmap (PPM).

       <u>test</u>.img
           The uncompressed original disk image (before conversion).

       <u>test</u>-converted-sda
       <u>test</u>-converted.xml
           The result of conversion, ie. after running virt-v2v but before  test-booting  the  guest.   See  the
           <b><a href="../man1/virt-v2v.1.html">virt-v2v</a></b>(1) manual page description of <u>-o</u> <u>local</u>.

           The disk image format is qcow2.

       <u>test</u>-booted-sda
           The  disk image after test-booting.  This is a qcow2 file which uses the <u>test</u>-converted-sda file as a
           backing disk, in order to save disk space.

</pre><h4><b>FILES</b></h4><pre>
       <u>$ocamllibdir/v2v_test_harness/v2v_test_harness.mli</u>
           The test library interface.  Read this for detailed programming documentation.

       "$ocamllibdir/v2v_test_harness/META"
           The findlib META file allowing you to use the library from <b><a href="../man1/ocamlfind.1.html">ocamlfind</a></b>(1).

       NB: To find the value of $ocamllibdir, run "ocamlc -where"

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/virt-v2v.1.html">virt-v2v</a></b>(1), <b><a href="../man1/virt-p2v.1.html">virt-p2v</a></b>(1), <b><a href="../man3/guestfs.3.html">guestfs</a></b>(3), <b><a href="../man1/virsh.1.html">virsh</a></b>(1), <b><a href="../man1/compare.1.html">compare</a></b>(1), <b><a href="../man1/git-annex.1.html">git-annex</a></b>(1), <a href="http://libguestfs.org/">http://libguestfs.org/</a>.

</pre><h4><b>AUTHORS</b></h4><pre>
       Richard W.M. Jones <a href="http://people.redhat.com/~rjones/">http://people.redhat.com/~rjones/</a>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright (C) 2014-2020 Red Hat Inc.

</pre><h4><b>LICENSE</b></h4><pre>
       This library is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser
       General Public License as published by the Free Software Foundation; either version 2 of the License,  or
       (at your option) any later version.

       This  library  is  distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even
       the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser  General
       Public License for more details.

       You should have received a copy of the GNU Lesser General Public License along with this library; if not,
       write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA

</pre><h4><b>BUGS</b></h4><pre>
       To      get      a      list      of      bugs      against      libguestfs,      use      this     link:
       https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools

       To      report      a      new       bug       against       libguestfs,       use       this       link:
       https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools

       When reporting a bug, please supply:

       •   The version of libguestfs.

       •   Where you got libguestfs (eg. which Linux distro, compiled from source, etc)

       •   Describe the bug accurately and give a way to reproduce it.

       •   Run <b><a href="../man1/libguestfs-test-tool.1.html">libguestfs-test-tool</a></b>(1) and paste the <b>complete,</b> <b>unedited</b> output into the bug report.

virt-v2v-1.44.2                                    2021-12-25                           <u><a href="../man1/virt-v2v-test-harness.1.html">virt-v2v-test-harness</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>