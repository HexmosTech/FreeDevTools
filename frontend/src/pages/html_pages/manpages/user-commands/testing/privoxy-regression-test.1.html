<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>privoxy-regression-test - A regression test "framework" for Privoxy.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/privoxy">privoxy_4.0.0-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       privoxy-regression-test - A regression test "framework" for Privoxy.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>privoxy-regression-test</b> [<b>--check-bad-ssl</b>] [<b>--curl</b> <b>curl</b>] [<b>--debug</b> <b>bitmask</b>] [<b>--forks</b> forks]
       [<b>--fuzzer-feeding</b>] [<b>--fuzzer-feeding</b>] [<b>--help</b>] [<b>--level</b> <b>level</b>] [<b>--local-test-file</b> <b>testfile</b>] [<b>--loops</b>
       <b>count</b>] [<b>--max-level</b> <b>max-level</b>] [<b>--max-time</b> <b>max-time</b>] [<b>--min-level</b> <b>min-level</b>] <b>--privoxy-address</b> <b>proxy-</b>
       <b>address</b> <b>--privoxy-cgi-prefix</b> <b>cgi-prefix</b> [<b>--retries</b> <b>retries</b>] [<b>--test-number</b> <b>test-number</b>]
       [<b>--show-skipped-tests</b>] [<b>--sleep-time</b> seconds] [<b>--verbose</b>] [<b>--version</b>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Privoxy-Regression-Test is supposed to one day become a regression test suite for Privoxy. It's not quite
       there yet, however, and can currently only test header actions, check the returned status code for
       requests to arbitrary URLs and verify which actions are applied to them.

       Client header actions are tested by requesting <b><a href="http://p.p/show-request">http://p.p/show-request</a></b> and checking whether or not
       Privoxy modified the original request as expected.

       The original request contains both the header the action-to-be-tested acts upon and an additional tagger-
       triggering header that enables the action to test.

       Applied actions are checked through <b><a href="http://p.p/show-url-info">http://p.p/show-url-info</a></b>.

</pre><h4><b>CONFIGURATION</b> <b>FILE</b> <b>SYNTAX</b></h4><pre>
       Privoxy-Regression-Test's configuration is embedded in Privoxy action files and loaded through Privoxy's
       web interface.

       It makes testing a Privoxy version running on a remote system easier and should prevent you from updating
       your tests without updating Privoxy's configuration accordingly.

       A client-header-action test section looks like this:

           # Set Header    = Referer: <a href="http://www.example.org.zwiebelsuppe.exit/">http://www.example.org.zwiebelsuppe.exit/</a>
           # Expect Header = Referer: <a href="http://www.example.org/">http://www.example.org/</a>
           {+client-header-filter{hide-tor-exit-notation} -hide-referer}
           TAG:^client-header-filter\{hide-tor-exit-notation\}$

       The example above causes Privoxy-Regression-Test to set the header <b>Referer:</b>
       <b><a href="http://www.example.org.zwiebelsuppe.exit/">http://www.example.org.zwiebelsuppe.exit/</a></b> and to expect it to be modified to <b>Referer:</b>
       <b><a href="http://www.example.org/">http://www.example.org/</a></b>.

       When testing this section, Privoxy-Regression-Test will set the header <b>X-Privoxy-Control:</b>
       <b>client-header-filter{hide-tor-exit-notation}</b> causing the <b>privoxy-control</b> tagger to create the tag
       <b>client-header-filter{hide-tor-exit-notation}</b> which will finally cause Privoxy to enable the action
       section.

       Note that the actions itself are only used by Privoxy, Privoxy-Regression-Test ignores them and will be
       happy as long as the expectations are satisfied.

       A fetch test looks like this:

           # Fetch Test = <a href="http://p.p/user-manual">http://p.p/user-manual</a>
           # Expect Status Code = 302

       It tells Privoxy-Regression-Test to request <b><a href="http://p.p/user-manual">http://p.p/user-manual</a></b> and to expect a response with the HTTP
       status code <b>302</b>. Obviously that's not a very thorough test and mainly useful to get some code coverage
       for Valgrind or to verify that the templates are installed correctly.

       If you want to test CGI pages that require a trusted referer, you can use:

           # Trusted CGI Request = <a href="http://p.p/edit-actions">http://p.p/edit-actions</a>

       It works like ordinary fetch tests, but sets the referer header to a trusted value.

       If no explicit status code expectation is set, <b>200</b> is used.

       To verify that a URL is blocked, use:

           # Blocked URL = <a href="http://www.example.com/blocked">http://www.example.com/blocked</a>

       To verify that a specific set of actions is applied to an URL, use:

           # Sticky Actions = +block{foo} +handle-as-empty-document -handle-as-image
           # URL = <a href="http://www.example.org/my-first-url">http://www.example.org/my-first-url</a>

       The sticky actions will be checked for all URLs below it until the next sticky actions directive.

       To verify that requests for a URL get redirected, use:

           # Redirected URL = <a href="http://www.example.com/redirect-me">http://www.example.com/redirect-me</a>
           # Redirect Destination = <a href="http://www.example.org/redirected">http://www.example.org/redirected</a>

       To skip a test, add the following line:

           # Ignore = Yes

       The difference between a skipped test and a removed one is that removing a test affects the numbers of
       the following tests, while a skipped test is still loaded and thus keeps the test numbers unchanged.

       Sometimes user modifications intentionally conflict with tests in the default configuration and thus
       cause test failures. Adding the Ignore directive to the failing tests works but is inconvenient as the
       directive is likely to get lost with the next update.

       Overwrite conditions are an alternative and can be added in any action file as long as the come after the
       test that is expected to fail.  They cause all previous tests that match the condition to be skipped.

       It is recommended to put the overwrite condition below the custom Privoxy section that causes the
       expected test failure and before the custom test that verifies that tests the now expected behaviour.
       Example:

           # The following section is expected to overwrite a section in
           # default.action, whose effect is being tested. Thus also disable
           # the test that is now expected to fail and add a new one.
           #
           {+block{Facebook makes Firefox even more unstable. Do not want.}}
           # Overwrite condition = <a href="http://apps.facebook.com/onthefarm/track.php">http://apps.facebook.com/onthefarm/track.php</a>?creative=&amp;cat=friendvisit&amp;subcat=weeds&amp;key=a789a971dc687bee4c20c044834fabdd&amp;next=index.php%3Fref%3Dnotif%26visitId%3D898835505
           # Blocked URL = <a href="http://apps.facebook.com/">http://apps.facebook.com/</a>
           .facebook./

</pre><h4><b>TEST</b> <b>LEVELS</b></h4><pre>
       All tests have test levels to let the user control which ones to execute (see <u>OPTIONS</u> below).  Test
       levels are either set with the <b>Level</b> directive, or implicitly through the test type.

       Redirect tests default to level 108, block tests to level 7, fetch tests to level 6, "Sticky Actions"
       tests default to level 5, tests for trusted CGI requests to level 3 and client-header-action tests to
       level 1.

       The current redirect test level is above the default max-level value as failed tests will result in
       outgoing connections. Use the <b>--max-level</b> option to run them as well.

       The "Default level offset" directive can be used to change the default level by a given value. This
       directive affects all tests located after it until the end of the file or a another "Default level
       offset" directive is reached. The purpose of this directive is to make it more convenient to skip similar
       tests in a given file without having to remove or disable the tests completely.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--check-bad-ssl</b> Instead of running the regression tests as described above, request pages from badssl.com
       with bad certificates to verify that Privoxy is detecting the certificate issues. Only works if Privoxy
       has been compiled with FEATURE_HTTPS_INSPECTION, has been configured properly and can reach the Internet.

       <b>--curl</b> <b>curl</b> Use a non-default curl binary.

       <b>--debug</b> <b>bitmask</b> Add the bitmask provided as integer to the debug settings.

       <b>--forks</b> <b>forks</b> Number of forks to start before executing the regression tests. This is mainly useful for
       stress-testing.

       <b>--fuzzer-address</b> Listening address used when executing the regression tests. Useful to make sure that the
       requests to load the regression tests don't fail due to fuzzing.

       <b>--fuzzer-feeding</b> Ignore some errors that would otherwise cause Privoxy-Regression-Test to abort the test
       because they shouldn't happen in normal operation. This option is intended to be used if Privoxy-
       Regression-Test is only used to feed a fuzzer in which case there's a high chance that Privoxy gets an
       invalid request and returns an error message.

       <b>--help</b> Shows available command line options.

       <b>--header-fuzzing</b> Modifies linear white space in headers in a way that should not affect the test result.

       <b>--level</b> <b>level</b> Only execute tests with the specified <b>level</b>.

       <b>--local-test-file</b> <b>test-file</b> Do not get the tests through Privoxy's web interface, but use a single local
       file. Not recommended for testing Privoxy, but can be useful to "misappropriate" Privoxy-Regression-Test
       to test other stuff, like webserver configurations.

       <b>--loop</b> <b>count</b> Loop through the regression tests <b>count</b> times.  Useful to feed a fuzzer, or when doing
       stress tests with several Privoxy-Regression-Test instances running at the same time.

       <b>--max-level</b> <b>max-level</b> Only execute tests with a <b>level</b> below or equal to the numerical <b>max-level</b>.

       <b>--max-time</b> <b>max-time</b> Give Privoxy <b>max-time</b> seconds to return data. Increasing the default may make sense
       when Privoxy is run through Valgrind, decreasing the default may make sense when Privoxy-Regression-Test
       is used to feed a fuzzer.

       <b>--min-level</b> <b>min-level</b> Only execute tests with a <b>level</b> above or equal to the numerical <b>min-level</b>.  If the
       <b>min-level</b> is larger than the <b>max-level</b>, the <b>max-level</b> is set to the <b>min-level</b>.

       <b>--privoxy-address</b> <b>proxy-address</b> Privoxy's listening address.  If it's not set, the value of the
       environment variable http_proxy will be used unless the variable isn't set in which case
       <a href="http://127.0.0.1">http://127.0.0.1</a>:8118/ will be used. <b>proxy-address</b> has to be specified in http_proxy syntax.

       <b>--privoxy-cgi-prefix</b> <b>privoxy-cgi-prefix</b> The prefix to use when building URLs that are supposed to reach
       Privoxy's CGI interface.  If it's not set, <b><a href="http://p.p/">http://p.p/</a></b> is used, which is supposed to work with the
       default Privoxy configuration.  If Privoxy has been built with <b>FEATURE_HTTPS_INSPECTION</b> enabled, and if
       https inspection is activated with the <b>+https-inspection</b> action, this option can be used with
       <b>https://p.p/</b> provided the system running Privoxy-Regression-Test has been configured to trust the
       certificate used by Privoxy.  Note that there are currently two tests in the official
       <b>regression-tests.action</b> file that are expected to fail when using a <b>privoxy-cgi-prefix</b> with <b>https://</b> and
       aren't automatically skipped.

       <b>--retries</b> <b>retries</b> Retry <b>retries</b> times.

       <b>--test-number</b> <b>test-number</b> Only run the test with the specified number.

       <b>--show-skipped-tests</b> Log skipped tests even if verbose mode is off.

       <b>--shuffle-tests</b> Shuffle test sections and their tests before executing them. When combined with <b>--forks</b>,
       this can increase the chances of detecting race conditions. Of course some problems are easier to detect
       without this option.

       <b>--sleep-time</b> <b>seconds</b> Wait <b>seconds</b> between tests. Useful when debugging issues with systems that don't log
       with millisecond precision.

       <b>--verbose</b> Log successful tests as well. By default only the failures are logged.

       <b>--version</b> Print version and exit.

       The second dash is optional, options can be shortened, as long as there are no ambiguities.

</pre><h4><b>PRIVOXY</b> <b>CONFIGURATION</b></h4><pre>
       Privoxy-Regression-Test is shipped with <b>regression-tests.action</b> which aims to test all official client-
       header modifying actions and can be used to verify that the templates and the user manual files are
       installed correctly.

       To use it, it has to be copied in Privoxy's configuration directory, and afterwards referenced in
       Privoxy's configuration file with the line:

           actionsfile regression-tests.action

       In general, its tests are supposed to work without changing any other action files, unless you already
       added lots of taggers yourself. If you are using taggers that cause problems, you might have to temporary
       disable them for Privoxy's CGI pages.

       Some of the regression tests rely on Privoxy features that may be disabled in your configuration. Tests
       with a level below 7 are supposed to work with all Privoxy configurations (provided you didn't build with
       FEATURE_GRACEFUL_TERMINATION).

       Tests with level 9 require Privoxy to deliver the User Manual, tests with level 12 require the CGI editor
       to be enabled.

</pre><h4><b>CAVEATS</b></h4><pre>
       Expect the configuration file syntax to change with future releases.

</pre><h4><b>LIMITATIONS</b></h4><pre>
       As Privoxy's <b>show-request</b> page only shows client headers, Privoxy-Regression-Test can't use it to test
       Privoxy actions that modify server headers.

       As Privoxy-Regression-Test relies on Privoxy's tag feature to control the actions to test, it currently
       only works with Privoxy 3.0.7 or later.

       At the moment Privoxy-Regression-Test fetches Privoxy's configuration page through <u><a href="../man1/curl.1.html">curl</a></u>(1), therefore you
       have to have <u>curl</u> installed, otherwise you won't be able to run Privoxy-Regression-Test in a meaningful
       way.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/privoxy.8.html">privoxy</a></b>(8) <b><a href="../man1/curl.1.html">curl</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
       Fabian Keil &lt;<a href="mailto:fk@fabiankeil.de">fk@fabiankeil.de</a>&gt;

perl v5.40.0                                       2025-02-05                         <u><a href="../man1/PRIVOXY-REGRESSION-TEST.1.html">PRIVOXY-REGRESSION-TEST</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>