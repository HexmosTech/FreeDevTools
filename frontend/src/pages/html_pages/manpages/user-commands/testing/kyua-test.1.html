<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kyua test — Runs tests</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/kyua">kyua_0.13+git20240311+0a43bb8d89e3-3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       kyua test — Runs tests

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>kyua</b> <b>test</b> [<b>--build-root</b> <u>path</u>] [<b>--kyuafile</b> <u>file</u>] [<b>--results-file</b> <u>file</u>] [<u>test_filter1</u> <u>..</u> <u>test_filterN</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>kyua</b> <b>test</b> command loads a test suite definition from a <u><a href="../man5/kyuafile.5.html">kyuafile</a></u>(5), runs the tests defined in it, and
       records  the  results  into a new results file.  By default, all tests in the test suite are executed but
       the optional arguments to <b>kyua</b> <b>test</b> can be used to select which test  programs  or  test  cases  to  run.
       These are filters and are described below in “Test filters”.

       Every test executed by <b>kyua</b> <b>test</b> is run under a controlled environment as described in “Test isolation”.

       The following subcommand options are recognized:

       <b>--build-root</b> <u>path</u>
           Specifies  the build root in which to find the test programs referenced by the Kyuafile, if different
           from the Kyuafile's directory.  See “Build directories” below for more information.

       <b>--kyuafile</b> <u>path</u>, <b>-k</b> <u>path</u>
           Specifies the Kyuafile to process.  Defaults to a <u>Kyuafile</u> file in the current directory.

       <b>--results-file</b> <u>path</u>, <b>-s</b> <u>path</u>
           Specifies the results file to create.  Defaults to ‘LATEST’, which causes <b>kyua</b> <b>test</b> to  automatically
           generate a new results file for the test run.

           The following values are accepted:

           ‘NEW’
               Requests the automatic generation of a new results filename based on the test suite being run and
               the current time.

           Explicit filename (aka everything else)
               Store the results file where indicated.

           See “Results files” for more details.

       You  can  later  inspect  the  results  of the test run in more detail by using <u><a href="../man1/kyua-report.1.html">kyua-report</a></u>(1) or you can
       execute a single test case with debugging functionality by using <u><a href="../man1/kyua-debug.1.html">kyua-debug</a></u>(1).

   <b>Build</b> <b>directories</b>
       <u>Build</u> <u>directories</u> (or object directories, target directories, product directories, etc.) is  the  concept
       that  allows  a developer to keep the source tree clean from build products by asking the build system to
       place such build products under a separate subtree.

       Most build systems today support build directories.  For example, the GNU Automake/Autoconf build  system
       exposes such concept when invoked as follows:

             $ cd my-project-1.0
             $ mkdir build
             $ cd build
             $ ../configure
             $ make

       Under  such  invocation,  all the results of the build are left in the <u>my-project-1.0/build/</u> subdirectory
       while maintaining the contents of <u>my-project-1.0/</u> intact.

       Because build directories are an integral part of most build systems, and because they are  a  tool  that
       developers  use frequently, <b>kyua</b> <b>test</b> supports build directories too.  This manifests in the form of <b>kyua</b>
       <b>test</b> being able to run tests from build directories  while  reading  the  (often  immutable)  test  suite
       definition from the source tree.

       One important property of build directories is that they follow (or need to follow) the exact same layout
       as the source tree.  For example, consider the following directory listings:

             src/Kyuafile
             src/bin/ls/
             src/bin/ls/Kyuafile
             src/bin/ls/ls.c
             src/bin/ls/ls_test.c
             src/sbin/su/
             src/sbin/su/Kyuafile
             src/sbin/su/su.c
             src/sbin/su/su_test.c

             obj/bin/ls/
             obj/bin/ls/ls*
             obj/bin/ls/ls_test*
             obj/sbin/su/
             obj/sbin/su/su*
             obj/sbin/su/su_test*

       Note  how the directory layout within <u>src/</u> matches that of <u>obj/</u>.  The <u>src/</u> directory contains only source
       files and the definition of the test suite (the Kyuafiles), while the <u>obj/</u> directory  contains  only  the
       binaries generated during a build.

       All  commands  that  deal  with  the workspace support the <b>--build-root</b> <u>path</u> option.  When this option is
       provided, the directory specified by the option is considered to be the root of the build directory.  For
       example, considering our previous fake tree layout, we could invoke <b>kyua</b> <b>test</b> as any of the following:

             $ kyua test --kyuafile=src/Kyuafile --build-root=obj
             $ cd src &amp;&amp; kyua test --build-root=../obj

   <b>Results</b> <b>files</b>
       Results files contain, as their name implies, the results of the execution of a test  suite.   Each  test
       suite  executed  by <u><a href="../man1/kyua-test.1.html">kyua-test</a></u>(1) generates a new results file, and such results files can be loaded later
       on by inspection commands such as <u><a href="../man1/kyua-report.1.html">kyua-report</a></u>(1) to analyze their contents.

       Results files support identifier-based lookups and also path name lookups.  The differences  between  the
       two are described below.

       The  default naming scheme for the results files provides simple support for identifier-based lookups and
       historical recording of test suite runs.  Each results file is given an identifier derived from the  test
       suite  that  generated  it  and the time the test suite was run.  Kyua can later look up results files by
       these fields.

       The identifier follows this pattern:

             &lt;test_suite&gt;.&lt;YYYYMMDD&gt;-&lt;HHMMSS&gt;-&lt;uuuuuu&gt;

       where ‘test_suite’ is the path to the root of the test suite that was run with all  slashes  replaced  by
       underscores and ‘YYYYMMDD-HHMMSS-uuuuuu’ is a timestamp with microsecond resolution.

       When  using  the  default  naming scheme, results files are stored in the <u><a href="file:~/.kyua/store/">~/.kyua/store/</a></u> subdirectory and
       each file holds a name of the form:

             <a href="file:~/.kyua/store/results.">~/.kyua/store/results.</a>&lt;identifier&gt;.db

       Results   files   are    simple    SQLite    databases    with    the    schema    described    in    the
       <u>/usr/share/kyua/store/schema_v?.sql</u>  files.   For  details  on  the  schema,  please refer to the heavily
       commented SQL file.

   <b>Test</b> <b>filters</b>
       A <u>test</u> <u>filter</u> is a string that is used to match test cases or test programs in  a  test  suite.   Filters
       have the following form:

             test_program_name[:test_case_name]

       Where  ‘test_program_name’  is  the  name  of  a  test  program  or a subdirectory in the test suite, and
       ‘test_case_name’ is the name of a test case.

   <b>Test</b> <b>isolation</b>
       The test programs and test cases run by <b>kyua</b> <b>test</b> are all executed in a deterministic environment.   This
       known,  clean  environment  serves  to  make  the  test execution as reproducible as possible and also to
       prevent clashes between tests that may, for example, create auxiliary files with overlapping names.

       For plain test programs and for TAP test programs, the whole test program is run under a single  instance
       of the environment described in this page.  For ATF test programs (see <u><a href="../man7/atf.7.html">atf</a></u>(7)), each individual test case
       <u>and</u> test cleanup routine are executed in separate environments.

       Process space
           Each  test  is executed in an independent processes.  Corollary: the test can do whatever it wants to
           the current process (such as modify global variables) without having to undo such changes.

       Session and process group
           The test is executed in its own session and its own process group.  There is no controlling  terminal
           attached to the session.

           Should  the test spawn any children, the children should maintain the same session and process group.
           Modifying any of these settings prevents <b>kyua</b> <b>test</b> from being able to kill any  stray  subprocess  as
           part of the cleanup phase.  If modifying these settings is necessary, or if any subprocess started by
           the test decides to use a different process group or session, it is the responsibility of the test to
           ensure those subprocesses are forcibly terminated during cleanup.

       Work directory
           The  test  is  executed  in  a  temporary  directory  automatically  created  by  the runtime engine.
           Corollary: the test can write to its current directory without needing  to  clean  any  files  and/or
           directories  it  creates.   The  runtime  engine  takes  care  to  recursively  delete  the temporary
           directories after the execution of a test case.   Any  file  systems  mounted  within  the  temporary
           directory are also unmounted.

       Home directory
           The <u>HOME</u> environment variable is set to the absolute path of the work directory.

       Umask
           The value of the umask is set to 0022.

       Environment
           The  <u>LANG</u>,  <u>LC_ALL</u>,  <u>LC_COLLATE</u>, <u>LC_CTYPE</u>, <u>LC_MESSAGES</u>, <u>LC_MONETARY</u>, <u>LC_NUMERIC</u> and <u>LC_TIME</u> variables
           are unset.

           The <u>TZ</u> variable is set to ‘UTC’.

           The <u>TMPDIR</u> variable is set to the absolute path of the work directory.  This is to prevent  the  test
           from  mistakenly  using  a  temporary  directory outside of the automatically-managed work directory,
           should the test use the <u><a href="../man3/mktemp.3.html">mktemp</a></u>(3) familiy of functions.

       Process limits
           The maximum soft core size limit is raised to its corresponding hard limit.  This is a simple,  best-
           effort attempt at allowing tests to dump core for further diagnostic purposes.

       Configuration varibles
           The  test  engine  may pass run-time configuration variables to the test program via the environment.
           The name of the configuration variable is prefixed with ‘TEST_ENV_’ so that a configuration  variable
           of the form ‘foo=bar’ becomes accessible in the environment as ‘TEST_ENV_foo=bar’.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       The  <b>kyua</b>  <b>test</b>  command returns 0 if all executed test cases pass or 1 if any of the executed test cases
       fails or if any of the given test case filters does not match any test case.

       Additional exit codes may be returned as described in <u><a href="../man1/kyua.1.html">kyua</a></u>(1).

</pre><h4><b>EXAMPLES</b></h4><pre>
   <b>Workflow</b> <b>with</b> <b>results</b> <b>files</b>
       If one runs the following command twice in a row:

             kyua test -k /usr/tests/Kyuafile

       the two executions will generate two different files with names like:

             <a href="file:~/.kyua/store/results.usr_tests.20140731-150500-196784.db">~/.kyua/store/results.usr_tests.20140731-150500-196784.db</a>
             <a href="file:~/.kyua/store/results.usr_tests.20140731-151730-997451.db">~/.kyua/store/results.usr_tests.20140731-151730-997451.db</a>

       Taking advantage of the default naming scheme, the following commands would all generate a report for the
       results of the <u>latest</u> execution of the test suite:

             cd /usr/tests &amp;&amp; kyua report
             cd /usr/tests &amp;&amp; kyua report --results-file=LATEST
             kyua report --results-file=/usr/tests
             kyua report --results-file=usr_tests
             kyua report --results-file=usr_tests.20140731-151730-997451

       But it is also possible to explicitly load data for older runs or from explicitly-named files:

             kyua report \
                 --results-file=usr_tests.20140731-150500-196784
             kyua report \
                 --results-file=<a href="file:~/.kyua/store/results.usr_tests.20140731-150500-196784.db">~/.kyua/store/results.usr_tests.20140731-150500-196784.db</a>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/kyua.1.html">kyua</a></u>(1), <u><a href="../man1/kyua-report.1.html">kyua-report</a></u>(1), <u><a href="../man5/kyuafile.5.html">kyuafile</a></u>(5)

Debian                                          October 13, 2014                                    <u><a href="../man1/KYUA-TEST.1.html">KYUA-TEST</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>