<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>virt-rescue - Run a rescue shell on a virtual machine</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/guestfish">guestfish_1.54.1-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       virt-rescue - Run a rescue shell on a virtual machine

</pre><h4><b>SYNOPSIS</b></h4><pre>
        virt-rescue [--options] -d domname

        virt-rescue [--options] -a disk.img [-a disk.img ...] [-i]

       Old style:

        virt-rescue [--options] domname

        virt-rescue [--options] disk.img [disk.img ...]

</pre><h4><b>WARNING</b></h4><pre>
       Using "virt-rescue" in write mode on live virtual machines, or concurrently with other disk editing
       tools, can be dangerous, potentially causing disk corruption.  The virtual machine must be shut down
       before you use this command, and disk images must not be edited concurrently.

       Use the <u>--ro</u> (read-only) option to use "virt-rescue" safely if the disk image or virtual machine might be
       live.  You may see strange or inconsistent results if running concurrently with other changes, but with
       this option you won't risk disk corruption.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       virt-rescue is like a Rescue CD, but for virtual machines, and without the need for a CD.  virt-rescue
       gives you a rescue shell and some simple recovery tools which you can use to examine or rescue a virtual
       machine or disk image.

       You can run virt-rescue on any virtual machine known to libvirt, or directly on disk image(s):

        virt-rescue -d GuestName -i

        virt-rescue --ro -a /path/to/disk.img -i

        virt-rescue -a /dev/sdc

       For live VMs you <u>must</u> use the <u>--ro</u> option.

       When you run virt-rescue on a virtual machine or disk image, you are placed in an interactive bash shell
       where you can use many ordinary Linux commands.  What you see in <u>/</u> (<u><a href="file:/bin">/bin</a></u>, <u><a href="file:/lib">/lib</a></u> etc) is the rescue
       appliance.  You must mount the virtual machine’s filesystems.  There is an empty directory called
       <u>/sysroot</u> where you can mount filesystems.

       To automatically mount the virtual machine’s filesystems under <u>/sysroot</u> use the <u>-i</u> option.  This uses
       libguestfs inspection to find the filesystems and mount them in the right place.  You can also mount
       filesystems individually using the <u>-m</u> option.

       Another way is to list the logical volumes (with <b><a href="../man8/lvs.8.html">lvs</a></b>(8)) and partitions (with <b><a href="../man8/parted.8.html">parted</a></b>(8)) and mount them
       by hand:

        &gt;&lt;rescue&gt; lvs
        LV      VG        Attr   LSize   Origin Snap%  Move Log Copy%  Convert
        lv_root vg_f15x32 -wi-a-   8.83G
        lv_swap vg_f15x32 -wi-a- 992.00M
        &gt;&lt;rescue&gt; mount /dev/vg_f15x32/lv_root /sysroot
        &gt;&lt;rescue&gt; mount /dev/vda1 /sysroot/boot
        &gt;&lt;rescue&gt; ls /sysroot

       Another command to list available filesystems is <b><a href="../man1/virt-filesystems.1.html">virt-filesystems</a></b>(1).

       To run commands in a Linux guest (for example, grub), you should chroot into the /sysroot directory
       first:

        &gt;&lt;rescue&gt; chroot /sysroot

   <b>NOTES</b>
       Virt-rescue can be used on <u>any</u> disk image file or device, not just a virtual machine.  For example you
       can use it on a blank file if you want to partition that file (although we would recommend using
       <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) instead as it is more suitable for this purpose).  You can even use virt-rescue on things
       like USB drives, SD cards and hard disks.

       You can get virt-rescue to give you scratch disk(s) to play with.  This is useful for testing out Linux
       utilities (see <u>--scratch</u>).

       Virt-rescue does not require root.  You only need to run it as root if you need root to open the disk
       image.

       This tool is just designed for quick interactive hacking on a virtual machine.  For more structured
       access to a virtual machine disk image, you should use <b><a href="../man3/guestfs.3.html">guestfs</a></b>(3).  To get a structured shell that you
       can use to make scripted changes to guests, use <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1).

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--help</b>
           Display brief help.

       <b>-a</b> FILE
       <b>--add</b> FILE
           Add  "FILE" which should be a disk image from a virtual machine.  If the virtual machine has multiple
           block devices, you must supply all of them with separate <u>-a</u> options.

           The format of the disk image is auto-detected.  To override this and force a  particular  format  use
           the <u>--format=..</u> option.

       <b>-a</b> URI
       <b>--add</b> URI
           Add a remote disk.  See "ADDING REMOTE STORAGE" in <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1).

       <b>--append</b> KERNELOPTS
           Pass additional options to the rescue kernel.

       <b>--blocksize=512</b>
       <b>--blocksize=4096</b>
       <b>--blocksize</b>
           This  parameter  sets  the sector size of the disk image.  It affects all explicitly added subsequent
           disks after this parameter.  Using <u>--blocksize</u> with no argument switches the disk sector size to  the
           default value which is usually 512 bytes.  See also "guestfs_add_drive_opts" in <b><a href="../man3/guestfs.3.html">guestfs</a></b>(3).

       <b>-c</b> URI
       <b>--connect</b> URI
           If  using  libvirt,  connect  to  the  given <u>URI</u>.  If omitted, then we connect to the default libvirt
           hypervisor.

           If you specify guest block devices directly (<u>-a</u>), then libvirt is not used at all.

       <b>-d</b> guest
       <b>--domain</b> guest
           Add all the disks from the named libvirt guest.  Domain UUIDs can be used instead of names.

       <b>-e</b> <b>none</b>
           Disable the escape key.

       <b>-e</b> KEY
           Set the escape key to the given key sequence.  The default is "^]".  To specify the  escape  key  you
           can use:

           "^x"
               Control key + "x" key.

           "none"
               <u>-e</u> <u>none</u> means there is no escape key, escapes are disabled.

           See "ESCAPE KEY" below for further information.

       <b>--format=raw|qcow2|..</b>
       <b>--format</b>
           The  default for the <u>-a</u> option is to auto-detect the format of the disk image.  Using this forces the
           disk format for <u>-a</u> options which follow on  the  command  line.   Using  <u>--format</u>  with  no  argument
           switches back to auto-detection for subsequent <u>-a</u> options.

           For example:

            virt-rescue --format=raw -a disk.img

           forces raw format (no auto-detection) for <u>disk.img</u>.

            virt-rescue --format=raw -a disk.img --format -a another.img

           forces raw format (no auto-detection) for <u>disk.img</u> and reverts to auto-detection for <u>another.img</u>.

           If  you  have  untrusted raw-format guest disk images, you should use this option to specify the disk
           format.  This avoids a possible security problem with malicious guests (CVE-2010-3851).

       <b>-i</b>
       <b>--inspector</b>
           Using <b><a href="../man1/virt-inspector.1.html">virt-inspector</a></b>(1) code, inspect the disks looking for an operating system and mount filesystems
           as they would be mounted on the real virtual machine.

           The filesystems are mounted on <u>/sysroot</u> in the rescue environment.

       <b>--memsize</b> MB
           Change the amount of memory allocated to the rescue system.  The default is set by libguestfs and  is
           small  but  adequate  for  running system tools.  The occasional program might need more memory.  The
           parameter is specified in megabytes.

       <b>-m</b> dev[:mountpoint[:options[:fstype]]]
       <b>--mount</b> dev[:mountpoint[:options[:fstype]]]
           Mount the named partition or logical volume on the given mountpoint <b>in</b> <b>the</b> <b>guest</b> (this has nothing to
           do with mountpoints in the host).

           If the mountpoint is omitted, it defaults to <u>/</u>.  You have to mount something on <u>/</u>.

           The filesystems are mounted under <u>/sysroot</u> in the rescue environment.

           The third (and rarely used) part of the mount parameter is the list of mount options  used  to  mount
           the  underlying filesystem.  If this is not given, then the mount options are either the empty string
           or "ro" (the latter if the <u>--ro</u> flag is used).  By specifying the mount options,  you  override  this
           default  choice.   Probably  the  only  time  you  would  use  this is to enable ACLs and/or extended
           attributes if the filesystem can support them:

            -m /dev/sda1:/:acl,user_xattr

           The fourth part of the parameter is the filesystem driver to use, such as "ext3" or "ntfs".  This  is
           rarely  needed,  but  can  be  useful  if multiple drivers are valid for a filesystem (eg: "ext2" and
           "ext3"), or if libguestfs misidentifies a filesystem.

       <b>--network</b>
           Enable QEMU user networking in the guest.  See "NETWORK".

       <b>-r</b>
       <b>--ro</b>
           Open the image read-only.

           The option must always be used if the disk  image  or  virtual  machine  might  be  running,  and  is
           generally recommended in cases where you don't need write access to the disk.

           See also "OPENING DISKS FOR READ AND WRITE" in <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1).

       <b>--scratch</b>
       <b>--scratch=N</b>
           The <u>--scratch</u> option adds a large scratch disk to the rescue appliance.  <u>--scratch=N</u> adds "N" scratch
           disks.  The scratch disk(s) are deleted automatically when virt-rescue exits.

           You can also mix <u>-a</u>, <u>-d</u> and <u>--scratch</u> options.  The scratch disk(s) are added to the appliance in the
           order they appear on the command line.

       <b>--selinux</b>
           This option is provided for backwards compatibility and does nothing.

       <b>--smp</b> N
           Enable N ≥ 2 virtual CPUs in the rescue appliance.

       <b>--suggest</b>
           This option was used in older versions of virt-rescue to suggest what commands you could use to mount
           filesystems  under  <u>/sysroot</u>.   For  the  current  version of virt-rescue, it is easier to use the <u>-i</u>
           option instead.

           This option implies <u>--ro</u> and is safe to use even if the guest is up  or  if  another  virt-rescue  is
           running.

       <b>-v</b>
       <b>--verbose</b>
           Enable verbose messages for debugging.

       <b>-V</b>
       <b>--version</b>
           Display version number and exit.

       <b>-w</b>
       <b>--rw</b>
           This changes the <u>-a</u>, <u>-d</u> and <u>-m</u> options so that disks are added and mounts are done read-write.

           See "OPENING DISKS FOR READ AND WRITE" in <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1).

       <b>-x</b>  Enable tracing of libguestfs API calls.

</pre><h4><b>OLD-STYLE</b> <b>COMMAND</b> <b>LINE</b> <b>ARGUMENTS</b></h4><pre>
       Previous versions of virt-rescue allowed you to write either:

        virt-rescue disk.img [disk.img ...]

       or

        virt-rescue guestname

       whereas  in  this  version  you should use <u>-a</u> or <u>-d</u> respectively to avoid the confusing case where a disk
       image might have the same name as a guest.

       For compatibility the old style is still supported.

</pre><h4><b>NETWORK</b></h4><pre>
       Adding the <u>--network</u> option enables QEMU user  networking  in  the  rescue  appliance.   There  are  some
       differences between user networking and ordinary networking:

       ping does not work
           Because the ICMP ECHO_REQUEST protocol generally requires root in order to send the ping packets, and
           because  virt-rescue must be able to run as non-root, QEMU user networking is not able to emulate the
           <b><a href="../man8/ping.8.html">ping</a></b>(8) command.  The ping command will appear to resolve addresses but will not be able to  send  or
           receive any packets.  This does not mean that the network is not working.

       cannot receive connections
           QEMU user networking cannot receive incoming connections.

       making TCP connections
           The  virt-rescue  appliance  needs  to  be  small  and  so  does  not include many network tools.  In
           particular there is no <b><a href="../man1/telnet.1.html">telnet</a></b>(1) command.  You can make TCP connections  from  the  shell  using  the
           magical <u>/dev/tcp/&lt;hostname&gt;/&lt;port&gt;</u> syntax:

            exec 3&lt;&gt;/dev/tcp/redhat.com/80
            echo "GET /" &gt;&amp;3
            cat &lt;&amp;3

           See <b><a href="../man1/bash.1.html">bash</a></b>(1) for more details.

</pre><h4><b>ESCAPE</b> <b>KEY</b></h4><pre>
       Virt-rescue  supports various keyboard escape sequences which are entered by pressing "^]" (Control key +
       "]" key).

       You can change the escape key using the <u>-e</u> option on the command line (see above), and  you  can  disable
       escapes completely using <u>-e</u> <u>none</u>.  The rest of this section assumes the default escape key.

       The following escapes can be used:

       "^] ?"
       "^] h"
           Prints a brief help text about escape sequences.

       "^] i"
           Prints  brief libguestfs inspection information for the guest.  This only works if you used <u>-i</u> on the
           virt-rescue command line.

       "^] q"
       "^] x"
           Quits virt-rescue immediately.

       "^] s"
           Synchronize the filesystems (sync).

       "^] u"
           Unmounts all the filesystems, except for the root (appliance) filesystems.

       "^] z"
           Suspend virt-rescue (like pressing "^Z" except that it affects virt-rescue rather  than  the  program
           inside the rescue shell).

       "^] ^]"
           Sends the literal character "^]" (ASCII 0x1d) through to the rescue shell.

</pre><h4><b>CAPTURING</b> <b>CORE</b> <b>DUMPS</b></h4><pre>
       If  you  are testing a tool inside virt-rescue and the tool (<b>not</b> virt-rescue) segfaults, it can be tricky
       to capture the core dump outside virt-rescue for later analysis.  This section describes one  way  to  do
       this.

       1.  Create a scratch disk for core dumps:

            truncate -s 4G /tmp/corefiles
            virt-format --partition=mbr --filesystem=ext2 -a /tmp/corefiles
            virt-filesystems -a /tmp/corefiles --all --long -h

       2.  When starting virt-rescue, attach the core files disk last:

            virt-rescue --rw [-a ...] -a /tmp/corefiles

           <b>NB.</b>  If  you  use  the  <u>--ro</u>  option,  then  virt-rescue  will  silently  not write any core files to
           <u>/tmp/corefiles</u>.

       3.  Inside virt-rescue, mount the core files disk.  Note replace <u>/dev/sdb1</u> with the last disk index.  For
           example if the core files disk is the last of four disks, you would use <u>/dev/sdd1</u>.

            &gt;&lt;rescue&gt; mkdir /tmp/mnt
            &gt;&lt;rescue&gt; mount /dev/sdb1 /tmp/mnt

       4.  Enable core dumps in the rescue kernel:

            &gt;&lt;rescue&gt; echo '/tmp/mnt/core.%p' &gt; <a href="file:/proc/sys/kernel/core_pattern">/proc/sys/kernel/core_pattern</a>
            &gt;&lt;rescue&gt; ulimit -Hc unlimited
            &gt;&lt;rescue&gt; ulimit -Sc unlimited

       5.  Run the tool that caused the core dump.  The core dump will be written to <u>/tmp/mnt/core.PID</u>.

            &gt;&lt;rescue&gt; ls -l /tmp/mnt
            total 1628
            -rw------- 1 root root 1941504 Dec  7 13:13 core.130
            drwx------ 2 root root   16384 Dec  7 13:00 lost+found

       6.  Before exiting virt-rescue, unmount (or at least sync) the disks:

            &gt;&lt;rescue&gt; umount /tmp/mnt
            &gt;&lt;rescue&gt; exit

       7.  Outside virt-rescue, the core dump(s) can be removed from the disk using <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1).  For example:

            guestfish --ro -a /tmp/corefiles -m /dev/sda1
            &gt;&lt;fs&gt; ll /
            &gt;&lt;fs&gt; download /core.NNN /tmp/core.NNN

</pre><h4><b>ENVIRONMENT</b> <b>VARIABLES</b></h4><pre>
       Several environment variables affect virt-rescue.  See "ENVIRONMENT  VARIABLES"  in  <b><a href="../man3/guestfs.3.html">guestfs</a></b>(3)  for  the
       complete list.

</pre><h4><b>FILES</b></h4><pre>
       $XDG_CONFIG_HOME/libguestfs/libguestfs-tools.conf
       $HOME/.libguestfs-tools.rc
       $XDG_CONFIG_DIRS/libguestfs/libguestfs-tools.conf
       /etc/libguestfs-tools.conf
           This configuration file controls the default read-only or read-write mode (<u>--ro</u> or <u>--rw</u>).

           See <b><a href="../man5/libguestfs-tools.conf.5.html">libguestfs-tools.conf</a></b>(5).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/guestfs.3.html">guestfs</a></b>(3),   <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1),  <b><a href="../man1/virt-cat.1.html">virt-cat</a></b>(1),  <b><a href="../man1/virt-edit.1.html">virt-edit</a></b>(1),  <b><a href="../man1/virt-filesystems.1.html">virt-filesystems</a></b>(1),  <b><a href="../man5/libguestfs-tools.conf.5.html">libguestfs-tools.conf</a></b>(5),
       <a href="http://libguestfs.org/">http://libguestfs.org/</a>.

</pre><h4><b>AUTHOR</b></h4><pre>
       Richard W.M. Jones <a href="http://people.redhat.com/~rjones/">http://people.redhat.com/~rjones/</a>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright (C) 2009-2023 Red Hat Inc.

</pre><h4><b>LICENSE</b></h4><pre>
       This program is free software; you can redistribute it and/or modify  it  under  the  terms  of  the  GNU
       General  Public License as published by the Free Software Foundation; either version 2 of the License, or
       (at your option) any later version.

       This program is distributed in the hope that it will be useful, but WITHOUT ANY  WARRANTY;  without  even
       the  implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
       License for more details.

       You should have received a copy of the GNU General Public License along with this program; if not,  write
       to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

</pre><h4><b>BUGS</b></h4><pre>
       To      get      a      list      of      bugs      against      libguestfs,      use      this     link:
       https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools

       To      report      a      new       bug       against       libguestfs,       use       this       link:
       https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools

       When reporting a bug, please supply:

       •   The version of libguestfs.

       •   Where you got libguestfs (eg. which Linux distro, compiled from source, etc)

       •   Describe the bug accurately and give a way to reproduce it.

       •   Run <b><a href="../man1/libguestfs-test-tool.1.html">libguestfs-test-tool</a></b>(1) and paste the <b>complete,</b> <b>unedited</b> output into the bug report.

libguestfs-1.54.1                                  2025-02-18                                     <u><a href="../man1/virt-rescue.1.html">virt-rescue</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>