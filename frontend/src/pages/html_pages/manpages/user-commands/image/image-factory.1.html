<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>image-factory - build golden Linux images</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/image-factory">image-factory_1.0.2-1.1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       image-factory - build golden Linux images

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>image-factory</b>  [<b>-h</b>|<b>--help</b>] [<b>-c</b>|<b>--cache-dir</b> <u>CACHE_DIR</u>] [<b>-f</b>|<b>--format</b> {<u>qcow2</u>,<u>raw</u>}] [<b>--image-size</b> <u>IMAGE_SIZE</u>]
       [<b>--mac</b>  <u>MAC</u>]  [<b>--installer-logs</b>]  [<b>--no-installer-logs</b>]  [<b>--log-file</b>]   [<b>--no-log-file</b>]   [<b>--log-filename</b>
       <u>LOG_FILENAME</u>] <u>image</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>image-factory</b>  is  a  command line tool for building golden Linux images.  It uses <b>virt-install</b> to do in‐
       stallations via the network.  The installation  and  configuration  of  the  images  is  done  using  the
       netinstall support from the distributions, i.e.

       • preseed for Debian/Ubuntu

       • Kickstart for CentOS/Fedora

       • AutoYaST for openSUSE

       <b>image-factory</b>  is used by IONOS Cloud to build the golden public Linux images for their Enterprise Cloud.
       The configuration files are shipped with this project to allow anyone to rebuild their images.

       <b>image-factory</b> runs following steps:

       • Create a virtual RAW image using qemu-img.

       • Cache <b>linux</b> kernel and <b>initrd</b>.

       • Run installation using <b>virt-install</b>.  <u>qemu:///session</u> is used as  session  for  normal  users  and  <u>qe‐</u>
         <u>mu:///system</u> when run as root.

       • The installation partition is mounted and the installer logs are removed.

       • <b>zerofree</b> is run on the partition.

       • If <b>format</b> is set to <u>qcow2</u>, the virtual raw images will be converted to qcow2 using <b>qemu-img</b>.

       • The SHA 256 sum is calculated for the image.

       • The image will be uploaded to all locations configured in <b>upload_destinations</b>.

       • If <b>post-build-command</b> is configured, the specified command will be executed.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-h</b>, <b>--help</b>
              Show a help message and exit

       <b>-c</b> <u>CACHE_DIR</u>, <b>--cache-dir</b> <u>CACHE_DIR</u>
              Cache directory (default: <u><a href="file:~/.cache/image-factory">~/.cache/image-factory</a></u> or <u>var/cache/image-factory</u> for root)

       <b>-f</b> {<u>qcow2</u>,<u>raw</u>}, <b>--format</b> {<u>qcow2</u>,<u>raw</u>}
              Image format to use (default: <u>raw</u>)

       <b>--image-size</b> <u>IMAGE_SIZE</u>
              Size of the raw image (default: <u>2G</u>)

       <b>--mac</b> <u>MAC</u>
              MAC address used in the installation machine

       <b>--installer-logs</b>
              Print installer logs into logging output

       <b>--no-installer-logs</b>
              Do not print installer logs into logging output

       <b>--log-file</b>
              Store logs into a file (in addition to stdout/stderr)

       <b>--no-log-file</b>
              Do not store logs into a file (in addition to stdout/stderr)

       <b>--log-filename</b> <u>LOG_FILENAME</u>
              log into specified file

       <u>image</u>  Image  to  build.   The date in form of <u>YYYY-MM-DD</u> and the file format suffix will be added to the
              generated image filename.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       Each image needs to be also configured in <u>/etc/image-factory.conf</u> or <u><a href="file:~/.config/image-factory.conf">~/.config/image-factory.conf</a></u>.  These
       configuration files use the INI file format.  The image name will be used as section and  following  keys
       are used:

       <b>append</b> Extra kernel parameter for the netboot image to use

       <b>cache_dir</b>
              Cache  directory  (default:  <u><a href="file:~/.cache/image-factory">~/.cache/image-factory</a></u>  or <u>var/cache/image-factory</u> for root).  Can be
              overridden by <b>--cache-dir</b>.

       <b>cores</b>  Number of CPU cores to use during installation.  Default: <u>1</u>

       <b>format</b> Image format to use.  Can be <u>qcow2</u> or <u>raw</u> (default).  Can be overridden by <b>--format</b>.

       <b>image-size</b>
              Size of the raw image (default: <u>2G</u>).  Can be overridden by <b>--image-size</b>.

       <b>initrd</b> URI of the netboot installer initrd.  Supported schemes are <u>file:</u>, <u>http:</u>, <u>https:</u>, and <u>rsync:</u>.  Un‐
              less using <u>file:</u>, the specified initrd will be cached locally.

       <b>installer-logs</b>
              Boolean whether to print installer logs into logging output.  Can be  overridden  by  <b>--installer-</b>
              <b>logs</b> or <b>--no-installer-logs</b>.

       <b>keep-raw</b>
              Boolean whether to keep raw image (in case format is not raw).  Default is <u>False</u>.

       <b>kickstart</b>
              Filename of the Kickstart file.  Needed when using Kickstart on CentOS/Fedora.

       <b>linux</b>  URI  of  the  netboot  installer  Linux  kernel.   Supported schemes are <u>file:</u>, <u>http:</u>, <u>https:</u>, and
              <u>rsync:</u>.  Unless using <u>file:</u>, the specified kernel will be cached locally.

       <b>log-file</b>
              Boolean whether to store logs into a file (in addition to stdout/stderr).  Can  be  overridden  by
              <b>--log-file</b> or <b>--no-log-file</b>.

       <b>log-filename</b>
              Filename to log into (if enabled).  Can be overridden by <b>--log-filename</b>.

       <b>mac</b>    MAC address used in the installation machine.  Can be overridden by <b>--mac</b>.

       <b>post-build-command</b>
              Optional  command  to  run  after the image was successfully built.  The name of the image will be
              passed as first argument.

       <b>preseed</b>
              Filename of the preseed file.  Needed when using preseed on Debian/Ubuntu.

       <b>ram</b>    Memory for virtual machine to use during installation.

       <b>upload_destinations</b>
              Comma-separated list of upload destinations.  Each upload destination needs a section in the  con‐
              figuration  file  (see  UPLOAD  DESTINATION  CONFIGURATION below).  To disable the upload, let <b>up‐</b>
              <b>load_destinations</b> undefined or set to an empty string.

       <b>vnc</b>    VNC port for the installation virtual machine.  It is recommended to bind the VNC port  to  local‐
              host only.

       <b>yast</b>   Filename of the AutoYaST file.  Needed when using AutoYaST on openSUSE.

</pre><h4><b>UPLOAD</b> <b>DESTINATION</b> <b>CONFIGURATION</b></h4><pre>
       Each upload destination configured in <b>upload_destinations</b> needs a section in the INI configuration, where
       at least <b>upload_type</b> and <b>upload_target</b> are set.  Following keys are accepted:

       <b>post-upload-command</b>
              Additional  command  to run after a successful upload.  <u>${image}</u> can be used as parameter in post-
              upload-command.  If multiple commands are needed, suffix the key with a number (counting  up  from
              1), e.g.  <b>post-upload-command1</b>.

       <b>upload_args</b>
              Additional arguments for the upload command to use, e.g. <u>--progress</u> for uploads with rsync.

       <b>upload_target</b>
              Upload target in the format the upload type supports it.

       <b>upload_type</b>
              Type of upload.  Currently only <u>rsync</u> is supported.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/qemu-img.1.html">qemu-img</a>(1), <a href="../man1/virt-install.1.html">virt-install</a>(1), <a href="../man8/zerofree.8.html">zerofree</a>(8)

</pre><h4><b>AUTHOR</b></h4><pre>
       Benjamin Drung &lt;<a href="mailto:benjamin.drung@ionos.com">benjamin.drung@ionos.com</a>&gt;

image-factory                                      2020-08-05                                   <u><a href="../man1/IMAGE-FACTORY.1.html">IMAGE-FACTORY</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>