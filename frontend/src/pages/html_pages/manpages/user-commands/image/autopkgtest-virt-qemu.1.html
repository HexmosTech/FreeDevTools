<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>autopkgtest-virt-qemu - autopkgtest virtualisation server using QEMU</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/autopkgtest">autopkgtest_5.47_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       autopkgtest-virt-qemu - autopkgtest virtualisation server using QEMU

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>autopkgtest</b> <u>[...]</u> <b>--</b> <b>qemu</b> [<u>options</u>] <u>image</u> [<u>ro-image</u> ...]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>autopkgtest-virt-qemu</b> provides an autopkgtest virtualisation server using QEMU.

       Normally <b>autopkgtest-virt-qemu</b> will be invoked by <b>autopkgtest</b>.

       You  always  need  to  specify  at  least one QEMU VM image. If your VM needs more disks, you can specify
       arbitrarily many additional images which will be added in order.

       <b>autopkgtest-virt-qemu</b> does <b>not</b> <b>modify</b> the given images, but will instead create a temporary  overlay  for
       the primary image, and add all other images as read-only.

</pre><h4><b>REQUIREMENTS</b></h4><pre>
       <b>autopkgtest-virt-qemu</b>  assumes  that  you  have  already prepared a suitable Debian based QEMU image (see
       <b>BUILDING</b> <b>IMAGES</b> below for how to create them). But you can  use  any  VM  which  has  <b>python3</b>  or  <b>python</b>
       installed and either

       *   opens a root shell on hvc1, or

       *   opens a root shell on ttyS1 (x86 only), or

       *   has  a serial console on the first serial port where you can log in (getty or similar) with specified
           user and password. This will then be used to start a root shell on hvc1 or ttyS1, to reduce  this  to
           the  first  case  and to not assume that the first serial port stays operational throughout the whole
           test.

           Depending on the CPU architecture, the first serial port might be ttyS0, ttyAMA0, hvc0  or  something
           else.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-u</b> <u>user</u> <b>|</b> <b>--user=</b><u>user</u>

              User name for running tests that don't require root privileges.

              If  the  VM  is not already prepared to start a root shell on hvc1 or ttyS1 this will be also used
              for logging in on the first serial port. If this is not root, it must be able to run sudo  without
              a password to become root for that purpose.

       <b>-p</b> <u>password</u> <b>|</b> <b>--password=</b><u>password</u>
              Password for above user for logging into the VM on the first serial port. This is necessary if the
              VM is not already prepared to start a root shell on hvc1 or ttyS1.

       <b>--qemu-architecture=</b>ARCHITECTURE

              Set the architecture according to qemu's vocabulary, for example x86_64 or ppc64le. The default is
              the <b>--dpkg-architecture</b> if specified, or guessed from the <b>--qemu-command</b> if specified, or the host
              system's architecture.

       <b>--dpkg-architecture=</b>ARCHITECTURE

              Set  the  architecture  according  to  dpkg's  vocabulary,  for  example amd64 or ppc64el. If both
              <b>--qemu-architecture</b>  and  <b>--dpkg-architecture</b>  are  specified,   the   <b>--qemu-architecture</b>   takes
              precedence.

       <b>-q</b> <u>command</u> <b>|</b> <b>--qemu-command=</b><u>command</u>
              QEMU  command  to  run.  If  not  specified,  this  defaults  to  <b>qemu-system-</b><u>ARCHITECTURE</u> for the
              architecture  chosen  by  <b>--qemu-architecture</b>  or  <b>--dpkg-architecture</b>,  or  the   host   system's
              architecture.

       <b>-o</b> <u>dir</u> <b>|</b> <b>--overlay-dir=</b><u>dir</u>
              Directory where the temporary image overlay for the primary image is created. By default this will
              happen  in  a  work  directory in <u><a href="file:/tmp">/tmp</a></u> (or <u>$TMPDIR</u>), but you can use this to e. g. ensure that the
              overlay is placed on a tmpfs if your <u><a href="file:/tmp">/tmp</a></u> directory is not on tmpfs. This  will  greatly  increase
              the speed.

       <b>-c</b> <u>num</u> <b>|</b> <b>--cpus=</b><u>num"</u>
              Number of (virtual) CPUs in the VM. Default is 1.

       <b>--ram-size=</b><u>MiB</u>
              VM RAM size in MiB. Default is 2048, i. e. 2 GiB.

       <b>--timeout-reboot=</b><u>SECONDS</u>
              Timeout for waiting for reboot. Default is 60 seconds.

       <b>--show-boot</b>
              Show boot messages from serial console.

       <b>--timeout-poweroff</b>
              Rather  than  terminating the VM process, initiate poweroff from within the VM, and terminate only
              when timeout occurs. This can be useful where host devices are shared with the  VM,  and  a  clean
              poweroff is necessary for the host device to be re-initialized by the next test.

       <b>-d</b> | <b>--debug</b>
              Enable debugging output.

       <b>--baseimage</b>
              Add a read-only copy of the first image without the overlay as an additional read-only hard drive,
              which will be available for tests as <u>/dev/baseimage</u>.  This allows tests that require nested VMs to
              reuse  the  same  image.  Be  aware  that  <u>/dev/baseimage</u>  will  not be accessible between calling
              <b>autopkgtest-reboot-prepare</b> and the next boot, thus make sure to stop accessing it before.

       <b>--boot=auto</b>|<b>bios</b>|<b>efi</b>|<b>ieee1275</b>|<b>none</b>

              Select how the qemu virtual machine will boot the image.

              <b>auto</b> chooses a suitable boot mode for the architecture, and is the default.

              <b>bios</b>, <b>ieee1275</b> and <b>none</b> do not do anything special, and assume the image is bootable by a  default
              qemu  configuration.   <b>auto</b>  is  equivalent  to  one  of these options on amd64, i386, ppc64el and
              unknown architectures.

              <b>efi</b> loads EFI firmware on supported architectures, currently meaning amd64, arm64, armhf or  i386.
              The  <b>--efi</b>  option  is  an  alias  for this mode.  <b>auto</b> selects this mode on arm64 or armhf.  This
              requires the ovmf, qemu-efi-arm or qemu-efi-aarch64 package, as appropriate for the architecture.

       <b>--qemu-options=</b><u>arguments</u>
              Pass through arguments to QEMU command; e. g. --qemu-options='-readconfig qemu.cfg'

</pre><h4><b>CONFIGURATION</b> <b>FILES</b></h4><pre>
       If you use lots of options or images, you can put parts of, or the whole command line into a  text  file,
       with one line per option. E. g. you can create a file <u>sid-desktop.cfg</u> with contents like

              -utestuser
              -ps3kr1t
              --ram-size=4096
              /home/bob/autopkgtest/sid-desktop.img

       and then run

              autopkgtest [...] -- qemu @sid-desktop.cfg

       The  contents of the configuration file will be expanded in-place as if you would have given its contents
       on the command line. Please ensure that you <b>don't</b> <b>place</b> <b>spaces</b> between short options  and  their  values,
       they would become a part of the argument value.

</pre><h4><b>INPUT,</b> <b>OUTPUT</b> <b>AND</b> <b>EXIT</b> <b>STATUS</b></h4><pre>
       The  behaviour  of  <b>autopkgtest-virt-qemu</b>  is  as described by the AutomatedTesting virtualisation regime
       specification.

</pre><h4><b>NOTES</b></h4><pre>
       <b>autopkgtest</b> does not run <b>apt-get</b> <b>update</b> at the start of a package build, which can cause a build  failure
       if  you  are  using  a  development  series template. You will need to run <b>apt-get</b> <b>update</b> in the template
       yourself (e. g. using <b>--setup-commands</b>).

       If  the  <b>--qemu-command</b>  option  has  not  been  specified  and  no  custom  CPU  type  was  selected  in
       <b>--qemu-options</b>,  <b>autopkgtest-virt-qemu</b>  will  try  to  enable  nested  KVM  support  by default on x86_64
       platforms if the hardware supports this. To fully enable this, one needs to additionally set some  module
       parameters on the host, by creating a file <u>/etc/modprobe.d/nested_kvm.conf</u> with the contents

       options kvm_intel nested=1
       options kvm_amd   nested=1

       and  rebooting  or  reloading  the  KVM  modules. It is still possible to use QEMU in tests without this,
       albeit without hardware acceleration. On Ubuntu systems these module options are typically already set.

</pre><h4><b>BUILDING</b> <b>IMAGES</b></h4><pre>
   <b>Debian</b>
       For Debian you can use <b><a href="../man1/autopkgtest-build-qemu.1.html">autopkgtest-build-qemu</a>(1)</b> to build a suitable image. E. g. for unstable:

              autopkgtest-build-qemu unstable autopkgtest-unstable.img

       See <b><a href="../man1/autopkgtest-build-qemu.1.html">autopkgtest-build-qemu</a></b>(1) for more information.

   <b>Ubuntu</b>
       For Ubuntu, autopkgtest provides <b><a href="../man1/autopkgtest-buildvm-ubuntu-cloud.1.html">autopkgtest-buildvm-ubuntu-cloud</a></b>(1) to build a VM based  on  the  Ubuntu
       cloud images. To create an image for the current development series and the i386 architecture:

              autopkgtest-buildvm-ubuntu-cloud -v -a i386

       This will produce e. g.  <b>autopkgtest-trusty-i386-cloud.img</b>.

</pre><h4><b>EXAMPLE</b></h4><pre>
       Run the tests of the gdk-pixbuf source package, using an Ubuntu cloud image:

              autopkgtest gdk-pixbuf -- qemu autopkgtest-trusty-i386-cloud.img

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/autopkgtest.1.html">autopkgtest</a></b>(1),      <b><a href="../man1/autopkgtest-schroot.1.html">autopkgtest-schroot</a></b>(1),      <b><a href="../man1/autopkgtest-virt-lxc.1.html">autopkgtest-virt-lxc</a></b>(1),     <b><a href="../man1/autopkgtest-build-qemu.1.html">autopkgtest-build-qemu</a></b>(1),
       <b><a href="../man1/autopkgtest-buildvm-ubuntu-cloud.1.html">autopkgtest-buildvm-ubuntu-cloud</a></b>(1), <b>/usr/share/doc/autopkgtest/</b>.

</pre><h4><b>AUTHORS</b> <b>AND</b> <b>COPYRIGHT</b></h4><pre>
       <b>autopkgtest-virt-qemu</b> was written by Martin Pitt &lt;<a href="mailto:martin.pitt@ubuntu.com">martin.pitt@ubuntu.com</a>&gt;

       This manpage is part of autopkgtest, a tool for testing Debian binary packages.  autopkgtest is Copyright
       (C) 2006-2014 Canonical Ltd and others.

       See <b>/usr/share/doc/autopkgtest/CREDITS</b> for the list of contributors and full copying conditions.

Linux Programmer's Manual                             2014                              <u><a href="../man1/autopkgtest-virt-qemu.1.html">autopkgtest-virt-qemu</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>