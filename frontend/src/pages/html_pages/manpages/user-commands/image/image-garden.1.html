<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>image-garden — construct and operate test virtual machines</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/image-garden">image-garden_0.1.1-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       image-garden — construct and operate test virtual machines

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>image-garden</b> <b>make</b> [<b>-n</b>] [<u>GOAL</u>]
       <b>image-garden</b> <b>allocate</b> [<b>--premade</b>] [<b>--nice</b>] <u>SYSTEM.ARCH</u>
       <b>image-garden</b> <b>discard</b> <u>ADDRESS</u>
       <b>image-garden</b> <b>version</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>image-garden</b>  downloads, initializes and optionally operates virtual machine images for popular operating
       systems. All the systems are designed for <u>testing</u>  and  come  configured  with  <u>well-known</u>  <u>username</u>  <u>and</u>
       <u>password</u>, usually matching the name of the system.

       Options recognized by <b>image-garden</b> <b>make</b>

       <b>-n</b>      Display  commands  instead  of  executing  them.  This  option is useful for learning how to make
               individual disk images.

       Options recognized by <b>image-garden</b> <b>allocate</b>

       <b>--premade</b>
               Assume presence of pre-made disk images and do not re-generate them even if they are out-of-date.
               This option is useful for ensuring that CI/CD jobs do not re-build disk images even if timestamps
               would suggest they should.

       <b>--nice</b>  Wrap execution of virtual machines with <b>nice</b>, so that it does not  compete  for  CPU  with  other
               applications.

   <b>Make</b> <b>Goals</b>
       The  <b>image-garden</b>  <b>make</b>  sub-command  allows  building one or more <u>goals</u> corresponding to virtual machine
       images and their support files.

       The following goals are documented. Note that <u>ARCH</u> and <u>SYSTEM</u> are placeholders for  CPU  architecture  as
       named  by  the  Linux kernel and standardized distribution name, respectively. Please see the table for a
       complete list of valid SYSTEM-ARCH combinations.

       help                     Display help message  specific  to  the  set  of  make  rules  contained  within
                                <b>image-garden</b>

       all                      Build all of the images for the native CPU architecture.

       fetch                    Fetch  all the base cloud images or installers, so that further work can be done
                                <u>mostly</u> offline. The only exception is installation if packages described by per-
                                project <u>cloud-init</u> profiles.

       clean                    Remove all the generated disk images from the current directory.

       distclean                Remove all the base cloud images and installer images from  the  per-user  cache
                                directory.

       <u>$SYSTEM.$ARCH.qcow2</u>      <u>qemu</u>  disk  image of operating system <u>$SYSTEM</u> for CPU architecture <u>$ARCH</u>.  Cloud
                                disks contain  internal  reference  to  base  image  stored  in  per-user  cache
                                directory. Both files are required at runtime.

       <u>$SYSTEM.$ARCH.qcow2.log</u>  Serial console output collected during first boot of the machine.

       <u>$SYSTEM.$ARCH.run</u>        Shell  script  for  running  the virtual machine. This script supports extensive
                                customization through environment variables and command line arguments.  Command
                                line   arguments   are  passed  directly  to  <b>image-garden</b>  qemu-system-$ARCH  .
                                Recognized environment variables are described in a dedicated section below.

       <u>$SYSTEM.$ARCH.efi-code.img</u>
                                Symbolic link to efi-code.$ARCH.img.

       <u>$SYSTEM.$ARCH.efi-vars.img</u>
                                Disk  image  with  current  state  of  the  boot   firmware   corresponding   to
                                <u>$SYSTEM.$ARCH.qcow2</u>.

       <u>$SYSTEM.seed.iso</u>         ISO 9660 disk image with cloud-init files used during first boot.

       <u>$SYSTEM.user-data</u>        Text  of  the  cloud-init user data.  This file exists briefly as a prerequisite
                                for <u>$SYSTEM.seed.iso</u>.

       <u>$SYSTEM.meta-data</u>        Text of the cloud-init meta data.  This file exists briefly  as  a  prerequisite
                                for <u>$SYSTEM.seed.iso</u>.

       <u>efi-code.aarch64.img</u>     Disk image of EFI firmware for <u>aarch64</u> CPU architecture.

       <u>efi-vars.aarch64.img</u>     Disk  image  of  with  the  unmodified state of EFI firmware for the <u>aarch64</u> CPU
                                architecture.

       <u>efi-code.x86_64.img</u>      Disk image of EFI firmware for the <u>x86_64</u> CPU architecture.

       <u>efi-vars.x86_64.img</u>      Disk image of with the unmodified state of  EFI  firmware  for  the  <u>x86_64</u>  CPU
                                architecture.

   <b>System</b> <b>Names</b>
       Systems  are  identifiers  for  a particular operating system, variant, release and CPU architecture. The
       following list contains all the systems recognized by <b>image-garden</b>.

       almalinux-cloud-{8,9}
               Alma Linux cloud images.

       alpine-cloud-3
               Alpine Linux cloud image.

       archlinux-cloud
               Arch Linux cloud image.  This system is only supported on the <u>x86_64</u> CPU architecture.

       centos-cloud-{9,10}
               CentOS cloud images (usually CentOS stream).

       debian-cloud-{10,11,12,13}
               Debian cloud images.

       fedora-cloud-{38,39,40,41}
               Fedora cloud images.

       opensuse-cloud-{15.4,15.5,15.16,tumbleweed}
               openSUSE cloud images.

       oracle-cloud-{8,9}
               Oracle Linux cloud images.

       rocky-cloud-{8,9}
               Rocky Linux cloud images.

       ubuntu-cloud-14.04
               This system fails to boot correctly.

       ubuntu-cloud-{16,18,20,22,24}.04
               Ubuntu Long Term Support (LTS) cloud images.

       ubuntu-cloud-{24.10,25.04}
               Ubuntu development releases cloud images.

</pre><h4><b>FILES</b></h4><pre>
       <u>.image-garden.mk</u>              Makefile implicitly included by <b>image-garden</b> <b>make</b>.  This file  is  designed
                                     for defining <u>cloud-init</u> user-data templates with project-specific build and
                                     test dependencies.

       <u>$HOME/.cache/image-garden/dl</u>  Directory with downloaded, unmodified virtual machine images. The files are
                                     organized  into  sub-directories  specific  to  each  distribution.  Inside
                                     symbolic links provide an unified naming scheme regardless  of  the  naming
                                     scheme used by a particular distributor.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       Environment variables are split into sections to indicate which of the sub-commands uses them.

   <b>Environment</b> <b>for</b> <b>image-garden</b> <b>make</b>
       XDG_CACHE_HOME       Directory  with  per-user  cache  files that may be safely deleted. According to the
                            specification the default value is "<u>$HOME/.cache</u>".

       GARDEN_CACHE_DIR     Directory with non-essential files that can be reused across projects.  The  default
                            value is "<u>$XDG_CACHE_HOME/image-garden</u>".

       GARDEN_DL_DIR        Directory  where  downloaded operating system images are stored. Those images may be
                            sizable so care needs to be taken to avoid using excessive amount of disk space. All
                            the images stored here are used in read-only mode and are  automatically  shared  by
                            different   project   developed   by   the   same   user.    The  default  value  is
                            "<u>$GARDEN_CACHE_DIR/dl</u>".

       QEMU_MEM_SIZE        Amount of memory, in megabytes, to provide to each virtual machine.  This  value  is
                            copied  into the generated <u>$SYSTEM.run</u> scripts. The default value is "2048", for 2GB
                            of runtime memory. Not to be confused with similarly-named QEMU_MEM_OPTION.

       QEMU_IMG_SIZE        Size  of  the  virtual  disk  image  created  by  <u><a href="../man1/qemu-img.1.html">qemu-img</a></u>(1)  when   invoked   from
                            <b>image-garden</b>.   The  default  value  is  "64G".   Note that images use a format with
                            internal representation of sparse areas.  The required disk space  is  much  smaller
                            than this size.

       QEMU_SMP_X86_64      The  number  of  virtual  CPU  cores  for  virtual machines emulating the <u>x86_64</u> CPU
                            architecture. The default value is "4" when the CPU architecture of the host and the
                            guest are the same or "1"  otherwise.   Not  to  be  confused  with  similarly-named
                            QEMU_SMP_OPTION.

       QEMU_SMP_AARCH64     The  number  of  virtual  CPU  cores  for virtual machines emulating the <u>aarch64</u> CPU
                            architecture. The default value is "4" when the CPU architecture of the host and the
                            guest are the same or "1"  otherwise.   Not  to  be  confused  with  similarly-named
                            QEMU_SMP_OPTION.

       QEMU_SYSTEM_X86_64   Full path of the <b>qemu-system-x86_64</b> program to use instead of the one found on PATH.

       QEMU_SYSTEM_AARCH64  Full  path  of  the  <b>qemu-system-aarch64</b>  program to use instead of the one found on
                            PATH.

       QEMU_IMG             Full path of the <b>qemu-img</b> program to use instead of the one found on PATH.

       MKPASSWD             Full path of the <b>mkpasswd</b> program to use instead of the one found on PATH.

       GENISOIMAGE          Full path of the <b>genisoimage</b> program to use instead of the one found on PATH.

       WGET                 Full path of the <b>wget</b> program to use instead of the one found on PATH.

   <b>Environment</b> <b>for</b> <b>image-garden</b> <b>allocate</b>
       XDG_RUNTIME_DIR  Directory with per-user runtime files that do not persist across reboots.  According  to
                        the specification the default value is "<u><a href="file:/run/user/">/run/user/</a>$UID</u>".  The <b>image-garden</b> program, when
                        used  as  a  back-end for the <u><a href="../man1/spread.1.html">spread</a></u>(1) test system uses this directory to keep track of
                        running virtual machines and their TCP port numbers.

   <b>Environment</b> <b>for</b> <b>.run</b> <b>scripts.</b>
       The following environment variables are used by generated .run scripts.

       QEMU_MEM_OPTION            Memory configuration options to pass to qemu.  Example value is "-m 1024".

       QEMU_SMP_OPTION            CPU topology options to pass to qemu.  When unset the default value  is  "-smp
                                  $QEMU_SMP_$(uname -m)".  Example value is "-smp $(nproc)".

       QEMU_DISPLAY_OPTION        Graphical  display  options  to pass to qemu.  When unset the default value is
                                  "-nographic".  Example value is "-display gtk".

       QEMU_BOOT_FIRMWARE_OPTION  Boot firmware options to pass to  qemu.  The  default  value  depends  on  the
                                  requirement  of  the  booted  system.  For  systems booting with EFI a pair of
                                  "-drive pflash" arguments is used for representing EFI code and EFI variables.
                                  For systems booting with legacy BIOS no options are provided.

       QEMU_RNG_OPTION            Random-number configuration options to pass to qemu.  When unset  the  default
                                  value is "-device virtio-rng-pci"

       QEMU_NET_OPTION            Network  configuration  options to pass to qemu.  When unset the default value
                                  is      "-netdev      user,id=netdev0${QEMU_NETDEV_USER_EXTRA:-}       -device
                                  virtio-net-pci,netdev=netdev0,id=net0                                  -smbios
                                  type=41,designation=Virtual-LAN,instance=1,kind=ethernet,pcidev=net0"

</pre><h4><b>EXAMPLES</b></h4><pre>
       To create a bootable image of cloud variant of Debian 13 (trixie) for x86_64 architecture run:

       image-garden make debian-cloud-13.x86_64.run

       To use <b>image-garden</b> together with <u><a href="../man1/spread.1.html">spread</a></u>(1) put the following snippet into your  <u>spread.yaml</u>  file.  Note
       that  using  <u>exec</u>  allows  image-garden  to  automatically perform the equivalent of calling spread shell
       functions <u>ADDRESS</u>, <u>FATAL</u> or <u>ERROR</u>.

       backends:
         garden:
           type: adhoc
           allocate: exec image-garden allocate "$SPREAD_SYSTEM"."$(uname -m)"
           discard: exec image-garden discard "$SPREAD_SYSTEM_ADDRESS"
           systems:
             - debian-cloud-13:
                 username: debian
                 password: debian

       To customize the virtual machine to a particular project create a <u>.image-garden.mk</u> file in  the  root  of
       the  project  and  define  one  or  more <u>cloud-init</u> user-data templates which contain list of packages to
       install or commands to run. Make sure to include the default template that is essential for  <b>image-garden</b>
       operation.  You  can  assume that the default template ends with a section that runs one or more commands
       and append your commands as a YAML list. Other cloud-init features must be used explicitly.

       # Cloud-init template for Debian 13 (Trixie).
       define DEBIAN_13_CLOUD_INIT_USER_DATA_TEMPLATE
       $(CLOUD_INIT_USER_DATA_TEMPLATE)
       packages:
       - build-essential
       - libfoo-dev
       endef
       # Cloud-init user-data template for all versions of Ubuntu.
       define UBUNTU_CLOUD_INIT_USER_DATA_TEMPLATE
       $(CLOUD_INIT_USER_DATA_TEMPLATE)
       packages:
       - build-essential
       - libfoo-dev
       endef

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/qemu.1.html">qemu</a></u>(1)

</pre><h4><b>HISTORY</b></h4><pre>
       Image garden was developed in stages throughout late 2023, with first commits appearing in early 2024.

</pre><h4><b>BUGS</b></h4><pre>
       Known bugs can be listed by looking at <u>GitLab</u> <u>issues</u>: https://gitlab.com/zygoon/image-garden/-/issues.

</pre><h4><b>AUTHORS</b></h4><pre>
       Zygmunt Krynicki &lt;<u><a href="mailto:me@zygoon.pl">me@zygoon.pl</a></u>&gt;

image-garden 0.1.1                                Jan 23, 2025                                   <u><a href="../man1/image-garden.1.html">image-garden</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>