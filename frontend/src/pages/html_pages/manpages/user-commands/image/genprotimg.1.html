<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>genprotimg - Create an IBM Secure Execution image</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/s390-tools">s390-tools_2.37.0-0ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       genprotimg - Create an IBM Secure Execution image

</pre><h4><b>SYNOPSIS</b></h4><pre>
       genprotimg [OPTIONS] --kernel &lt;FILE&gt; --output &lt;FILE&gt; --host-key-document &lt;FILE&gt; &lt;--no-verify|--cert &lt;FILE&gt;&gt;

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Use <b>genprotimg</b> to generate a single bootable image file with encrypted and integrity-protected parts. The
       command requires a kernel image, a host-key document, certificates for the host-key document
       verification, and an output file name. Optionally, specify an initial RAM filesystem, and a file
       containing the kernel parameters. If the command should be run offline, use the <b>--offline</b> option and
       specify the certificate revocation lists (CRLs) by using the <b>--crl</b> option. Should special circumstances
       require it, you can optionally specify your own keys for the encryption by using the experimental
       options. For all certificates, CRLs, and host-key documents, both the PEM and DER input formats are
       supported. In the resulting image file, a plain text boot loader, the encrypted components for kernel,
       initial RAM disk, kernel parameters, and the encrypted and integrity-protected header are concatenated.
       The header contains metadata necessary for running the guest in protected mode.

       Use this image file as a kernel image for zipl or for a direct kernel boot using QEMU.

</pre><h4><b>OPTIONS</b></h4><pre>
       -i, --kernel, --image &lt;FILE&gt;
           Use the content of FILE as a raw binary Linux kernel. The Linux kernel must be a raw binary s390x
           Linux kernel. The ELF format is not supported.

       -r, --ramdisk &lt;FILE&gt;
           Use the content of FILE as the Linux initial RAM disk.

       -p, --parmfile &lt;FILE&gt;
           Use the content of FILE as the Linux kernel command line. The Linux kernel command line must be
           shorter than the maximum kernel command line size supported by the given Linux kernel.

       -o, --output &lt;FILE&gt;
           Write the generated Secure Execution boot image to FILE.

       -k, --host-key-document &lt;FILE&gt;
           Use FILE as a host-key document. Can be specified multiple times and must be specified at least once.

       --no-verify
           Disable the host-key document verification. Does not require the host-key documents to be valid. Do
           not use for a production request unless you verified the host-key document beforehand.

       -C, --cert &lt;FILE&gt;
           Use FILE as a certificate to verify the host-key or keys. The certificates are used to establish a
           chain of trust for the verification of the host-key documents. Specify this option twice to specify
           the IBM Z signing key and the intermediate CA certificate (signed by the root CA).

       --crl &lt;FILE&gt;
           Use FILE as a certificate revocation list (CRL). The list is used to check whether a certificate of
           the chain of trust is revoked. Specify this option multiple times to use multiple CRLs.

       --offline
           Make no attempt to download CRLs.

       --root-ca &lt;ROOT_CA&gt;
           Use FILE as the root-CA certificate for the verification. If omitted, the system wide-root CAs
           installed on the system are used. Use this only if you trust the specified certificate.

       --no-component-check
           Disable all input component checks. For example, for the Linux kernel, it tests if the given kernel
           looks like a raw binary s390x kernel.

       --overwrite
           Overwrite an existing Secure Execution boot image.

       --cck, --comm-key &lt;FILE&gt;
           Use the content of FILE as the customer-communication key (CCK). The file must contain exactly 32
           bytes of data.

       --hdr-key &lt;FILE&gt;
           Use the content of FILE as the Secure Execution header protection key. The file must contain exactly
           32 bytes of data. If the option is not specified, the Secure Execution header protection key is a
           randomly generated key.

       --enable-dump
           Enable Secure Execution guest dump support. This option requires the <b>--cck</b> option.

       --disable-dump
           Disable Secure Execution guest dump support (default).

       --enable-cck-extension-secret
           Add-secret requests must provide an extension secret that matches the CCK-derived extension secret.
           This option requires the <b>--cck</b> option.

       --disable-cck-extension-secret
           Add-secret requests don't have to provide the CCK-derived extension secret (default).

       --enable-pckmo
           Enable the support for the DEA, TDEA, AES, and ECC PCKMO key encryption functions (default).

       --disable-pckmo
           Disable the support for the DEA, TDEA, AES, and ECC PCKMO key encryption functions.

       --enable-pckmo-hmac
           Enable the support for the HMAC PCKMO key encryption function.

       --disable-pckmo-hmac
           Disable the support for the HMAC PCKMO key encryption function (default).

       --enable-backup-keys
           Enable the support for backup target keys.

       --disable-backup-keys
           Disable the support for backup target keys (default).

       --enable-image-encryption
           Enable encryption of the image components (default). The image components are: the kernel, ramdisk,
           and kernel command line.

       --disable-image-encryption
           Disable encryption of the image components. The image components are: the kernel, ramdisk, and kernel
           command line. Use only if the components used do not contain any confidential content (for example,
           secrets like non-public cryptographic keys).

       -v, --verbose
           Provide more detailed output.

       -q, --quiet
           Provide less output.

       --version
           Print version information and exit.

       -h, --help
           Print help (see a summary with <b>-h</b>).

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       <b>0</b> <b>-</b> <b>Program</b> <b>finished</b> <b>successfully</b>
               The command was executed successfully.

       <b>1</b> <b>-</b> <b>Generic</b> <b>error</b>
               Something went wrong during the operation. Refer to the error message.

       <b>2</b> <b>-</b> <b>Usage</b> <b>error</b>
               The  command was used incorrectly, for example: unsupported command line flag, or wrong number of
               arguments.

</pre><h4><b>EXAMPLES</b></h4><pre>
       These are examples of how to generate an IBM Secure Execution  image  in  <u>/boot/secure-linux</u>,  using  the
       kernel  file  <u><a href="file:/boot/vmlinuz">/boot/vmlinuz</a></u>, the initrd in <u><a href="file:/boot/initrd.img">/boot/initrd.img</a></u>, the kernel parameters contained in <u>parmfile</u>,
       the intermediate CA in <u>DigiCertCA.crt</u>, the IBM Z signing key in <u>ibm-z-host-key-signing.crt</u>, and the host-
       key document in <u>host_key.crt</u>. An AES-256 GCM key is stored in <u>comm-key</u>, which is  used  when  creating  a
       Secure Execution image with guest dump support enabled in the second example.

       Generate an IBM Secure Execution image:

       <b>genprotimg</b> <b>-i</b> <u><a href="file:/boot/vmlinuz">/boot/vmlinuz</a></u> -r <u><a href="file:/boot/initrd.img">/boot/initrd.img</a></u> -p <u>parmfile</u> -k <u>host_key.crt</u> -C <u>ibm-z-host-key-signing.crt</u>
       -C <u>DigiCertCA.crt</u> -o <u>/boot/secure-linux</u>

       Generate an IBM Secure Execution image with Secure Execution guest dump support:

       <b>genprotimg</b> <b>-i</b> <u><a href="file:/boot/vmlinuz">/boot/vmlinuz</a></u> -r <u><a href="file:/boot/initrd.img">/boot/initrd.img</a></u> -p <u>parmfile</u> -k <u>host_key.crt</u> -C <u>ibm-z-host-key-signing.crt</u>
       -C <u>DigiCertCA.crt</u> -o <u>/boot/secure-linux</u> --enable-dump --cck <u>comm-key</u>

</pre><h4><b>NOTES</b></h4><pre>
       1.  The <b><a href="../man1/genprotimg.1.html">genprotimg</a></b>(1) command is a symbolic link to the <b><a href="../man1/pvimg-create.1.html">pvimg-create</a></b>(1) command.

       2.  An ELF file cannot be used as a Linux kernel image.

       3.  Remember to re-run <b>zipl</b> after updating an IBM Secure Execution image.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/pvimg-create.1.html">pvimg-create</a></b>(1) <b><a href="../man8/zipl.8.html">zipl</a></b>(8) <b><a href="../man1/qemu.1.html">qemu</a></b>(1)

s390-tools                                         2024-12-19                                      <u><a href="../man1/GENPROTIMG.1.html">GENPROTIMG</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>