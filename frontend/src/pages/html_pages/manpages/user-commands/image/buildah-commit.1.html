<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>buildah-commit - Create an image from a working container.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/buildah">buildah_1.39.3+ds1-1syncable1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       buildah-commit - Create an image from a working container.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>buildah</b> <b>commit</b> [<u>options</u>] <u>container</u> [<u>image</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Writes  a  new image using the specified container's read-write layer and if it is based on an image, the
       layers of that image.  If <u>image</u> does not begin with a registry name component, <b>localhost</b> will be added to
       the name.  If <u>image</u> is not provided, the image will have no name.  When an image has no name, the <b>buildah</b>
       <b>images</b> command will display <b>&lt;none&gt;</b> in the <b>REPOSITORY</b> and <b>TAG</b> columns.

       The <u>image</u> value supports all transports from <b><a href="../man5/containers-transports.5.html">containers-transports</a>(5)</b>. If no transport is specified,  the
       <b>containers-storage</b> (i.e., local storage) transport is used.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       The image ID of the image that was created.  On error, 1 is returned and errno is returned.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--add-file</b> <u>source[:destination]</u>

       Read  the  contents  of  the  file <b>source</b> and add it to the committed image as a file at <b>destination</b>.  If
       <b>destination</b> is not specified, the path of <b>source</b> will be used.  The new file will be owned by UID 0,  GID
       0,  have  0644  permissions,  and  be  given  a  current  timestamp unless the <b>--timestamp</b> option is also
       specified.  This option can be specified multiple times.

       <b>--authfile</b> <u>path</u>

       Path of the authentication file.  Default  is  ${XDG_RUNTIME_DIR}/containers/auth.json.  See  <a href="../man5/containersauth.json.5.html">containers-</a>
       <a href="../man5/containersauth.json.5.html">auth.json</a>(5) for more information. This file is created using <b>buildah</b> <b>login</b>.

       If  the  authorization state is not found there, $HOME/.docker/config.json is checked, which is set using
       <b>docker</b> <b>login</b>.

       Note: You can also override the default path of the authentication file by setting the REGISTRY_AUTH_FILE
       environment variable. <b>export</b> <b>REGISTRY_AUTH_FILE=path</b>

       <b>--cert-dir</b> <u>path</u>

       Use certificates at <u>path</u> (*.crt, *.cert, *.key) to connect to the  registry.   The  default  certificates
       directory is <u>/etc/containers/certs.d</u>.

       <b>--change</b>, <b>-c</b> <u>"INSTRUCTION"</u>

       Apply  the  change  to  the  committed  image  that  would  have  been  made if it had been built using a
       Containerfile which included the specified instruction.  This option can be specified multiple times.

       <b>--config</b> <u>filename</u>

       Read a JSON-encoded version of an image configuration object from  the  specified  file,  and  merge  the
       values from it with the configuration of the image being committed.

       <b>--creds</b> <u>creds</u>

       The  [username[:password]]  to  use to authenticate with the registry if required.  If one or both values
       are not supplied, a command line prompt will appear and the  value  can  be  entered.   The  password  is
       entered without echo.

       <b>--cw</b> <u>options</u>

       Produce  an  image suitable for use as a confidential workload running in a trusted execution environment
       (TEE) using krun (i.e., <u>crun</u> built with the libkrun feature enabled and invoked as <u>krun</u>).  Instead of the
       conventional contents, the root filesystem of  the  image  will  contain  an  encrypted  disk  image  and
       configuration information for krun.

       The  value  for <u>options</u> is a comma-separated list of key=value pairs, supplying configuration information
       which is needed for producing the additional data which will be included in the container image.

       Recognized <u>keys</u> are:

       <u>attestation_url</u>: The location of a key broker / attestation server.  If a value  is  specified,  the  new
       image's  workload  ID,  along with the passphrase used to encrypt the disk image, will be registered with
       the server, and the server's location will be stored in  the  container  image.   At  run-time,  krun  is
       expected  to contact the server to retrieve the passphrase using the workload ID, which is also stored in
       the container image.  If no value is specified, a <u>passphrase</u> value <u>must</u> be specified.

       <u>cpus</u>: The number of virtual CPUs which the image expects to be run with at run-time.  If not specified, a
       default value will be supplied.

       <u>firmware_library</u>: The location of the libkrunfw-sev shared library.  If not specified, <b>buildah</b> checks for
       its presence in a number of hard-coded locations.

       <u>memory</u>: The amount of memory which the image expects  to  be  run  with  at  run-time,  as  a  number  of
       megabytes.  If not specified, a default value will be supplied.

       <u>passphrase</u>:  The  passphrase  to  use  to  encrypt the disk image which will be included in the container
       image.  If no value is specified,  but  an  <u>attestation_url</u>  value  is  specified,  a  randomly-generated
       passphrase will be used.  The authors recommend setting an <u>attestation_url</u> but not a <u>passphrase</u>.

       <u>slop</u>:  Extra space to allocate for the disk image compared to the size of the container image's contents,
       expressed either as a percentage (..%) or a size value (bytes, or larger units if suffixes like KB or  MB
       are  present),  or  a sum of two or more such specifications separated by "+".  If not specified, <b>buildah</b>
       guesses that 25% more space than the contents will be enough, but this option is  provided  in  case  its
       guess  is wrong.  If the specified or computed size is less than 10 megabytes, it will be increased to 10
       megabytes.

       <u>type</u>: The type of trusted execution environment (TEE) which the image should  be  marked  for  use  with.
       Accepted  values  are "SEV" (AMD Secure Encrypted Virtualization - Encrypted State) and "SNP" (AMD Secure
       Encrypted Virtualization - Secure Nested Paging).  If not specified, defaults to "SNP".

       <u>workload_id</u>: A workload identifier which will be recorded in the container image, to be used at  run-time
       for  retrieving the passphrase which was used to encrypt the disk image.  If not specified, a semi-random
       value will be derived from the base image's image ID.

       <b>--disable-compression</b>, <b>-D</b>

       Don't compress filesystem layers when building the image unless it is required by the location where  the
       image  is  being written.  This is the default setting, because image layers are compressed automatically
       when they are pushed to registries, and images being written to local  storage  would  only  need  to  be
       decompressed  again  to  be  stored.   Compression  can  be  forced in all cases by specifying <b>--disable-</b>
       <b>compression=false</b>.

       <b>--encrypt-layer</b> <u>layer(s)</u>

       Layer(s) to encrypt: 0-indexed layer indices with support for negative indexing  (e.g.  0  is  the  first
       layer,  -1  is  the  last  layer).  If  not  defined,  will  encrypt all layers if encryption-key flag is
       specified.

       <b>--encryption-key</b> <u>key</u>

       The [protocol:keyfile] specifies the encryption protocol, which can be JWE (RFC7516), PGP (RFC4880),  and
       PKCS7 (RFC2315) and the key material required for image encryption. For instance, jwe:/path/to/key.pem or
       pgp:<a href="mailto:admin@example.com">admin@example.com</a> or pkcs7:/path/to/x509-file.

       <b>--format</b>, <b>-f</b> <u>[oci</u> <u>|</u> <u>docker]</u>

       Control  the  format  for the image manifest and configuration data.  Recognized formats include <u>oci</u> (OCI
       image-spec v1.0, the default) and <u>docker</u> (version 2, using schema format 2 for the manifest).

       Note: You can also override the default  format  by  setting  the  BUILDAH_FORMAT  environment  variable.
       <b>export</b> <b>BUILDAH_FORMAT=docker</b>

       <b>--identity-label</b> <u>bool-value</u>

       Adds default identity label <b>io.buildah.version</b> if set. (default true).

       <b>--iidfile</b> <u>ImageIDfile</u>

       Write the image ID to the file.

       <b>--manifest</b> "listName"

       Name  of  the  manifest list to which the built image will be added. Creates the manifest list if it does
       not exist. This option is useful for building multi architecture images.

       <b>--omit-history</b> <u>bool-value</u>

       Omit build history information in the built image. (default false).

       This option is useful for the cases where end users explicitly want to set  <b>--omit-history</b>  to  omit  the
       optional  <b>History</b>  from  built  images  or  when  working with images built using build tools that do not
       include <b>History</b> information in their images.

       <b>--pull</b>

       When the <u>--pull</u> flag is enabled or set explicitly to <b>true</b> (with <u>--pull=true</u>), attempt to pull the  latest
       versions  of  SBOM  scanner  images from the registries listed in registries.conf if a local SBOM scanner
       image does not exist or the image in the registry is newer than the one in local storage.  Raise an error
       if the SBOM scanner image is not in any listed registry and is not present locally.

       If the flag is disabled (with <u>--pull=false</u>), do not pull SBOM scanner images from  registries,  use  only
       local versions. Raise an error if a SBOM scanner image is not present locally.

       If  the  pull  flag  is  set to <b>always</b> (with <u>--pull=always</u>), pull SBOM scanner images from the registries
       listed in registries.conf.  Raise an error if a SBOM scanner image is not found in the  registries,  even
       if an image with the same name is present locally.

       If the pull flag is set to <b>missing</b> (with <u>--pull=missing</u>), pull SBOM scanner images only if they could not
       be found in the local containers storage.  Raise an error if no image could be found and the pull fails.

       If  the  pull  flag is set to <b>never</b> (with <u>--pull=never</u>), do not pull SBOM scanner images from registries,
       use only the local versions.  Raise an error if the image is not present locally.

       <b>--quiet</b>, <b>-q</b>

       When writing the output image, suppress progress output.

       <b>--rm</b> Remove the working container and  its  contents  after  creating  the  image.   Default  leaves  the
       container and its content in place.

       <b>--sbom</b> <u>preset</u>

       Generate  SBOMs  (Software Bills Of Materials) for the output image by scanning the working container and
       build contexts using the named combination of scanner image, scanner commands, and merge strategy.   Must
       be  specified  with  one  or  more  of  <b>--sbom-image-output</b>, <b>--sbom-image-purl-output</b>, <b>--sbom-output</b>, and
       <b>--sbom-purl-output</b>.  Recognized presets, and the set of options which they equate to:

              • "syft", "syft-cyclonedx":
                 --sbom-scanner-image=ghcr.io/anchore/syft
                 --sbom-scanner-command="/syft scan -q dir:{ROOTFS} --output cyclonedx-json={OUTPUT}"
                 --sbom-scanner-command="/syft scan -q dir:{CONTEXT} --output cyclonedx-json={OUTPUT}"
                 --sbom-merge-strategy=merge-cyclonedx-by-component-name-and-version

              • "syft-spdx":
                 --sbom-scanner-image=ghcr.io/anchore/syft
                 --sbom-scanner-command="/syft scan -q dir:{ROOTFS} --output spdx-json={OUTPUT}"
                 --sbom-scanner-command="/syft scan -q dir:{CONTEXT} --output spdx-json={OUTPUT}"
                 --sbom-merge-strategy=merge-spdx-by-package-name-and-versioninfo

              • "trivy", "trivy-cyclonedx":
                 --sbom-scanner-image=ghcr.io/aquasecurity/trivy
                 --sbom-scanner-command="trivy filesystem -q {ROOTFS} --format cyclonedx --output {OUTPUT}"
                 --sbom-scanner-command="trivy filesystem -q {CONTEXT} --format cyclonedx --output {OUTPUT}"
                 --sbom-merge-strategy=merge-cyclonedx-by-component-name-and-version

              • "trivy-spdx":
                 --sbom-scanner-image=ghcr.io/aquasecurity/trivy
                 --sbom-scanner-command="trivy filesystem -q {ROOTFS} --format spdx-json --output {OUTPUT}"
                 --sbom-scanner-command="trivy filesystem -q {CONTEXT} --format spdx-json --output {OUTPUT}"
                 --sbom-merge-strategy=merge-spdx-by-package-name-and-versioninfo

       <b>--sbom-image-output</b> <u>path</u>

       When generating SBOMs, store the generated SBOM in the specified path in the output image.  There  is  no
       default.

       <b>--sbom-image-purl-output</b> <u>path</u>

       When        generating        SBOMs,        scan       them       for       PURL       (package       URL
       ⟨https://github.com/package-url/purl-spec/blob/master/PURL-SPECIFICATION.rst⟩) information,  and  save  a
       list of found PURLs to the named file in the local filesystem.  There is no default.

       <b>--sbom-merge-strategy</b> <u>method</u>

       If more than one <b>--sbom-scanner-command</b> value is being used, use the specified method to merge the output
       from later commands with output from earlier commands.  Recognized values include:

              • cat
                 Concatenate the files.

              • merge-cyclonedx-by-component-name-and-version
                 Merge the "component" fields of JSON documents, ignoring values from
                 documents when the combination of their "name" and "version" values is
                 already present.  Documents are processed in the order in which they are
                 generated, which is the order in which the commands that generate them
                 were specified.

              • merge-spdx-by-package-name-and-versioninfo
                 Merge the "package" fields of JSON documents, ignoring values from
                 documents when the combination of their "name" and "versionInfo" values is
                 already present.  Documents are processed in the order in which they are
                 generated, which is the order in which the commands that generate them
                 were specified.

       <b>--sbom-output</b> <u>file</u>

       When  generating  SBOMs, store the generated SBOM in the named file on the local filesystem.  There is no
       default.

       <b>--sbom-purl-output</b> <u>file</u>

       When       generating       SBOMs,       scan       them       for        PURL        (package        URL
       ⟨https://github.com/package-url/purl-spec/blob/master/PURL-SPECIFICATION.rst⟩)  information,  and  save a
       list of found PURLs to the named file in the local filesystem.  There is no default.

       <b>--sbom-scanner-command</b> <u>image</u>

       Generate SBOMs by running the specified command  from  the  scanner  image.   If  multiple  commands  are
       specified,  they  are  run  in  the  order  in  which  they  are specified.  These text substitutions are
       performed:
         - {ROOTFS}
             The root of the built image's filesystem, bind mounted.
         - {CONTEXT}
             The build context and additional build contexts, bind mounted.
         - {OUTPUT}
             The name of a temporary output file, to be read and merged with others or copied elsewhere.

       <b>--sbom-scanner-image</b> <u>image</u>

       Generate SBOMs using the specified scanner image.

       <b>--sign-by</b> <u>fingerprint</u>

       Sign the new image using the GPG key that matches the specified fingerprint.

       <b>--squash</b>

       Squash all of the new image's layers (including those inherited from a base  image)  into  a  single  new
       layer.

       <b>--timestamp</b> <u>seconds</u>

       Set  the  create  timestamp to seconds since epoch to allow for deterministic builds (defaults to current
       time).  By default, the created timestamp is changed and written  into  the  image  manifest  with  every
       commit,  causing  the  image's  sha256  hash  to  be  different  even if the sources are exactly the same
       otherwise.  When --timestamp is set, the created timestamp is  always  set  to  the  time  specified  and
       therefore  not changed, allowing the image's sha256 to remain the same. All files committed to the layers
       of the image will be created with the timestamp.

       <b>--tls-verify</b> <u>bool-value</u>

       Require HTTPS and verification of certificates when talking to container registries (defaults  to  true).
       TLS verification cannot be used when talking to an insecure registry.

       <b>--unsetenv</b> <u>env</u>

       Unset environment variables from the final image.

</pre><h4><b>EXAMPLE</b></h4><pre>
       This example saves an image based on the container.
        <b>buildah</b> <b>commit</b> <b>containerID</b> <b>newImageName</b>

       This example saves an image named newImageName based on the container and removes the working container.
        <b>buildah</b> <b>commit</b> <b>--rm</b> <b>containerID</b> <b>newImageName</b>

       This example commits to an OCI archive file named /tmp/newImageName based on the container.
        <b>buildah</b> <b>commit</b> <b>containerID</b> <b>oci-archive:/tmp/newImageName</b>

       This  example  saves  an  image  with no name, removes the working container, and creates a new container
       using the image's ID.
        <b>buildah</b> <b>from</b> <b>$(buildah</b> <b>commit</b> <b>--rm</b> <b>containerID)</b>

       This example saves an image based on the container disabling compression.
        <b>buildah</b> <b>commit</b> <b>--disable-compression</b> <b>containerID</b>

       This example saves an image named newImageName based on the container disabling compression.
        <b>buildah</b> <b>commit</b> <b>--disable-compression</b> <b>containerID</b> <b>newImageName</b>

       This example commits the container to the image on the local registry while turning off tls verification.
        <b>buildah</b> <b>commit</b> <b>--tls-verify=false</b> <b>containerID</b> <b>docker://localhost:5000/imageId</b>

       This example commits the container to the image on the local registry using credentials and  certificates
       for authentication.
        <b>buildah</b>    <b>commit</b>    <b>--cert-dir</b>    <b><a href="file:~/auth">~/auth</a></b>    <b>--tls-verify=true</b>   <b>--creds=username:password</b>   <b>containerID</b>
       <b>docker://localhost:5000/imageId</b>

       This example commits the container to the  image  on  the  local  registry  using  credentials  from  the
       /tmp/auths/myauths.json file and certificates for authentication.
        <b>buildah</b>    <b>commit</b>    <b>--authfile</b>    <b>/tmp/auths/myauths.json</b>    <b>--cert-dir</b>    <b><a href="file:~/auth">~/auth</a></b>     <b>--tls-verify=true</b>
       <b>--creds=username:password</b> <b>containerID</b> <b>docker://localhost:5000/imageName</b>

       This example saves an image based on the container, but stores dates based on epoch time.  <b>buildah</b> <b>commit</b>
       <b>--timestamp=0</b> <b>containerID</b> <b>newImageName</b>

   <b>Building</b> <b>an</b> <b>multi-architecture</b> <b>image</b> <b>using</b> <b>the</b> <b>--manifest</b> <b>option</b> <b>(requires</b> <b>emulation</b> <b>software)</b>
       #!<a href="file:/bin/sh">/bin/sh</a>
       build() {
            ctr=$(./bin/buildah from --arch $1 ubi8)
            ./bin/buildah run $ctr dnf install -y iputils
            ./bin/buildah commit --manifest ubi8ping $ctr
       }
       build arm
       build amd64
       build s390x

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       <b>BUILD_REGISTRY_SOURCES</b>

       BUILD_REGISTRY_SOURCES, if set, is treated as a JSON object which contains lists of registry names  under
       the keys <b>insecureRegistries</b>, <b>blockedRegistries</b>, and <b>allowedRegistries</b>.

       When committing an image, if the image is to be given a name, the portion of the name that corresponds to
       a  registry  is  compared  to the items in the <b>blockedRegistries</b> list, and if it matches any of them, the
       commit attempt is denied.  If there are registries in the <b>allowedRegistries</b> list, and the portion of  the
       name that corresponds to the registry is not in the list, the commit attempt is denied.

       <b>TMPDIR</b>  The TMPDIR environment variable allows the user to specify where temporary files are stored while
       pulling and pushing images.  Defaults to '<a href="file:/var/tmp">/var/tmp</a>'.

</pre><h4><b>FILES</b></h4><pre>
       <b>registries.conf</b> (<b>/etc/containers/registries.conf</b>)

       registries.conf is the configuration file which specifies which container registries should be  consulted
       when completing image names which do not include a registry or domain portion.

       <b>policy.json</b> (<b>/etc/containers/policy.json</b>)

       Signature  policy  file.   This  defines the trust policy for container images.  Controls which container
       registries can be used for image, and whether or not the tool should trust the images.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/buildah.1.html">buildah</a>(1),  <a href="../man1/buildah-images.1.html">buildah-images</a>(1),  <a href="../man5/containers-policy.json.5.html">containers-policy.json</a>(5),  <a href="../man5/containers-registries.conf.5.html">containers-registries.conf</a>(5),   <a href="../man5/containerstransports.5.html">containers-</a>
       <a href="../man5/containerstransports.5.html">transports</a>(5), <a href="../man5/containers-auth.json.5.html">containers-auth.json</a>(5)

buildah                                            March 2017                                  <u><a href="../man1/buildah-commit.1.html">buildah-commit</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>