<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mk - maintain (make) related files</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/9base">9base_6-14_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mk - maintain (make) related files

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>mk</b> [ <b>-f</b> <u>mkfile</u> ] ...  [ <u>option</u> <u>...</u>  ] [ <u>target</u> <u>...</u>  ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>Mk</u>  uses  the  dependency  rules  specified  in  <u>mkfile</u> to control the update (usually by compilation) of
       <u>targets</u> (usually files) from the source files upon which they depend.  The  <u>mkfile</u>  (default  contains  a
       <u>rule</u>  for  each  target  that  identifies  the files and other targets upon which it depends and an <u><a href="../man1/sh.1.html">sh</a></u>(1)
       script, a <u>recipe</u>, to update the target.  The script is run if the target does not exist or if it is older
       than any of the files it depends on.  <u>Mkfile</u> may also contain <u>meta-rules</u> that define actions for updating
       implicit targets.  If no <u>target</u> is specified, the target of the first rule (not meta-rule) in  <u>mkfile</u>  is
       updated.

       The environment variable <b>$NPROC</b> determines how many targets may be updated simultaneously; Some operating
       systems, e.g., Plan 9, set <b>$NPROC</b> automatically to the number of CPUs on the current machine.

       Options are:

       <b>-a</b>      Assume all targets to be out of date.  Thus, everything is updated.
       <b>-d</b>[<b>egp</b>] Produce debugging output (<b>p</b> is for parsing, <b>g</b> for graph building, <b>e</b> for execution).
       <b>-e</b>      Explain why each target is made.
       <b>-i</b>      Force any missing intermediate targets to be made.
       <b>-k</b>      Do as much work as possible in the face of errors.
       <b>-n</b>      Print, but do not execute, the commands needed to update the targets.
       <b>-s</b>      Make the command line arguments sequentially rather than in parallel.
       <b>-t</b>      Touch (update the modified date of) file targets, without executing any recipes.
       <b>-w</b><u>target1</u><b>,</b><u>target2,...</u>
               Pretend  the  modify  time  for each <u>target</u> is the current time; useful in conjunction with <b>-n</b> to
               learn what updates would be triggered by modifying the <u>targets</u>.

   <b>The</b> <b>mkfile</b>
       A <u>mkfile</u> consists of <u>assignments</u> (described under `Environment') and <u>rules</u>.  A rule contains <u>targets</u>  and
       a  <u>tail</u>.   A  target  is  a  literal  string and is normally a file name.  The tail contains zero or more
       <u>prerequisites</u> and an optional <u>recipe</u>, which is an <b>shell</b> script.  Each line of the recipe must begin  with
       white space.  A rule takes the form

              target: prereq1 prereq2
                      <u>recipe</u> <u>using</u> prereq1, prereq2 <u>to</u> <u>build</u> target

       When the recipe is executed, the first character on every line is elided.

       After the colon on the target line, a rule may specify <u>attributes</u>, described below.

       A <u>meta-rule</u> has a target of the form <u>A</u><b>%</b><u>B</u> where <u>A</u> and <u>B</u> are (possibly empty) strings.  A meta-rule acts as
       a rule for any potential target whose name matches <u>A</u><b>%</b><u>B</u> with <b>%</b> replaced by an arbitrary string, called the
       <u>stem</u>.   In interpreting a meta-rule, the stem is substituted for all occurrences of <b>%</b> in the prerequisite
       names.  In the recipe of a meta-rule, the environment variable <b>$stem</b> contains the string matched  by  the
       <b>%</b>.  For example, a meta-rule to compile a C program using <u><a href="../man1/9c.1.html">9c</a></u>(1) might be:

              %:    %.c
                      9c -c $stem.c
                      9l -o $stem $stem.o

       Meta-rules  may contain an ampersand <b>&amp;</b> rather than a percent sign <b>%</b>.  A <b>%</b> matches a maximal length string
       of any characters; an <b>&amp;</b> matches a maximal length string of any characters except period or slash.

       The text of the <u>mkfile</u> is processed as follows.  Lines beginning with <b>&lt;</b>  followed  by  a  file  name  are
       replaced by the contents of the named file.  Lines beginning with <b>&lt;|</b> followed by a file name are replaced
       by  the  output  of the execution of the named file.  Blank lines and comments, which run from unquoted <b>#</b>
       characters to the following newline, are deleted.  The character sequence backslash-newline  is  deleted,
       so long lines in <u>mkfile</u> may be folded.  Non-recipe lines are processed by substituting for <b>`{</b><u>command</u><b>}</b> the
       output  of  the  <u>command</u>  when run by <u>sh</u>.  References to variables are replaced by the variables' values.
       Special characters may be quoted using single quotes <b>''</b> as in <u><a href="../man1/sh.1.html">sh</a></u>(1).

       Assignments and rules are distinguished by the first unquoted occurrence of <b>:</b> (rule) or <b>=</b> (assignment).

       A later rule may modify or override an existing rule under the following conditions:

       -      If the targets of the rules exactly match and one rule contains only a prerequisite clause and  no
              recipe, the clause is added to the prerequisites of the other rule.  If either or both targets are
              virtual, the recipe is always executed.

       -      If  the  targets  of  the  rules  match  exactly and the prerequisites do not match and both rules
              contain recipes, <u>mk</u> reports an ``ambiguous recipe'' error.

       -      If the target and prerequisites of both rules match exactly, the second rule overrides the first.

   <b>Environment</b>
       Rules may make use of shell environment variables.  A legal reference of the  form  <b>$OBJ</b>  or  <b>${name}</b>  is
       expanded  as  in  <u><a href="../man1/sh.1.html">sh</a></u>(1).   A reference of the form <b>${name:</b><u>A</u><b>%</b><u>B</u><b>=</b><u>C%D}</u>, where <u>A,</u> <u>B,</u> <u>C,</u> <u>D</u> are (possibly empty)
       strings, has the value formed by expanding <b>$name</b> and substituting <u>C</u> for <u>A</u> and <u>D</u> for <u>B</u>  in  each  word  in
       <b>$name</b> that matches pattern <u>A</u><b>%</b><u>B</u>.

       Variables can be set by assignments of the form
               var=[<u>attr=</u>]<u>value</u>
       Blanks  in  the  <u>value</u> break it into words.  Such variables are exported to the environment of recipes as
       they are executed, unless <b>U</b>, the only legal attribute <u>attr</u>, is present.  The initial value of a  variable
       is  taken  from  (in  increasing  order  of  precedence)  the default values below, <u>mk's</u> environment, the
       <u>mkfiles</u>, and any command line assignment as an argument to <u>mk</u>.  A variable assignment argument  overrides
       the first (but not any subsequent) assignment to that variable.

       The  variable <b>MKFLAGS</b> contains all the option arguments (arguments starting with or containing and <b>MKARGS</b>
       contains all the targets in the call to <u>mk</u>.

       The variable <b>MKSHELL</b> contains the shell command line <u>mk</u> uses to run recipes.  If the first  word  of  the
       command  ends  in  <b>rc</b>  or  <b>rcsh</b>,  <u>mk</u>  uses <u><a href="../man1/rc.1.html">rc</a></u>(1)'s quoting rules; otherwise it uses <u><a href="../man1/sh.1.html">sh</a></u>(1)'s.  The <b>MKSHELL</b>
       variable is consulted when the mkfile is read, not when it is executed, so that different shells  can  be
       used within a single mkfile:

              MKSHELL=$PLAN9/bin/rc
              use-rc:V:
                   for(i in a b c) echo $i

              MKSHELL=sh
              use-sh:V:
                   for i in a b c; do echo $i; done

       Mkfiles included via <b>&lt;</b> or <b>&lt;|</b> (<u>q.v.</u>)  see their own private copy of <b>MKSHELL</b>, which always starts set to <b>sh</b>
       <b>.</b>

       Dynamic information may be included in the mkfile by using a line of the form

              &lt;|<u>command</u> <u>args</u>

       This  runs  the  command  <u>command</u> with the given arguments <u>args</u> and pipes its standard output to <u>mk</u> to be
       included as part of the mkfile. For instance, the Inferno kernels use  this  technique  to  run  a  shell
       command  with  an awk script and a configuration file as arguments in order for the <u>awk</u> script to process
       the file and output a set of variables and their values.

   <b>Execution</b>
       During execution, <u>mk</u> determines which targets must be updated, and in what  order,  to  build  the  <u>names</u>
       specified on the command line.  It then runs the associated recipes.

       A  target  is considered up to date if it has no prerequisites or if all its prerequisites are up to date
       and it is newer than all its prerequisites.  Once the recipe for a target has  executed,  the  target  is
       considered up to date.

       The date stamp used to determine if a target is up to date is computed differently for different types of
       targets.  If a target is <u>virtual</u> (the target of a rule with the <b>V</b> attribute), its date stamp is initially
       zero;  when  the  target  is  updated  the  date  stamp  is  set  to  the  most  recent date stamp of its
       prerequisites.  Otherwise, if a target does not exist as a file, its date stamp is set to the most recent
       date stamp of its prerequisites, or zero if it has no prerequisites.  Otherwise, the target is  the  name
       of  a  file  and  the  target's  date  stamp  is always that file's modification date.  The date stamp is
       computed when the target is needed in the execution of a rule; it is not a static value.

       Nonexistent targets that have prerequisites and are themselves prerequisites are treated specially.  Such
       a target <u>t</u> is given the date stamp of its most recent prerequisite and if this  causes  all  the  targets
       which have <u>t</u> as a prerequisite to be up to date, <u>t</u> is considered up to date.  Otherwise, <u>t</u> is made in the
       normal fashion.  The <b>-i</b> flag overrides this special treatment.

       Files may be made in any order that respects the preceding restrictions.

       A recipe is executed by supplying the recipe as standard input to the command <b><a href="file:/bin/sh">/bin/sh</a></b>.  (Note that unlike
       <u>make</u>,  <u>mk</u>  feeds  the entire recipe to the shell rather than running each line of the recipe separately.)
       The environment is augmented by the following variables:

       <b>$alltarget</b>    all the targets of this rule.

       <b>$newprereq</b>    the prerequisites that caused this rule to execute.

       <b>$newmember</b>    the prerequisites that are members of an aggregate that caused this rule to execute.   When
                     the  prerequisites  of  a rule are members of an aggregate, <b>$newprereq</b> contains the name of
                     the aggregate and out of date members, while <b>$newmember</b>  contains  only  the  name  of  the
                     members.

       <b>$nproc</b>        the process slot for this recipe.  It satisfies 0≤<b>$nproc</b>&lt;<b>$NPROC</b>.

       <b>$pid</b>          the process id for the <u>mk</u> executing the recipe.

       <b>$prereq</b>       all the prerequisites for this rule.

       <b>$stem</b>         if  this  is a meta-rule, <b>$stem</b> is the string that matched <b>%</b> or <b>&amp;</b>.  Otherwise, it is empty.
                     For regular expression meta-rules (see below), the variables are set to  the  corresponding
                     subexpressions.

       <b>$target</b>       the targets for this rule that need to be remade.

       These variables are available only during the execution of a recipe, not while evaluating the <u>mkfile</u>.

       Unless  the  rule  has  the  <b>Q</b>  attribute,  the  recipe  is  printed prior to execution with recognizable
       environment variables expanded.  Commands returning error status cause <u>mk</u> to terminate.

       Recipes and backquoted <b>rc</b> commands in places such as assignments execute in a copy of  <u>mk's</u>  environment;
       changes they make to environment variables are not visible from <u>mk</u>.

       Variable  substitution  in  a  rule is done when the rule is read; variable substitution in the recipe is
       done when the recipe is executed.  For example:

              bar=a.c
              foo: $bar
                      $CC -o foo $bar
              bar=b.c

       will compile <b>b.c</b> into <b>foo</b>, if <b>a.c</b> is newer than <b>foo</b>.

   <b>Aggregates</b>
       Names of the form <u>a</u>(<u>b</u>) refer to member <u>b</u> of the aggregate <u>a</u>.  Currently, the  only  aggregates  supported
       are <u>9ar</u> (see <u><a href="../man1/9c.1.html">9c</a></u>(1)) archives.

   <b>Attributes</b>
       The  colon  separating  the  target  from the prerequisites may be immediately followed by <u>attributes</u> and
       another colon.  The attributes are:

       <b>D</b>      If the recipe exits with a non-null status, the target is deleted.

       <b>E</b>      Continue execution if the recipe draws errors.

       <b>N</b>      If there is no recipe, the target has its time updated.

       <b>n</b>      The rule is a meta-rule that cannot be a target of a virtual rule.  Only files match  the  pattern
              in the target.

       <b>P</b>      The  characters  after  the  <b>P</b>  until  the  terminating <b>:</b> are taken as a program name.  It will be
              invoked as <b>sh</b> <b>-c</b> <b>prog</b> <b>'arg1'</b> <b>'arg2'</b> and should return a zero exit status if and only if arg1 is up
              to date with respect to arg2.  Date stamps are still propagated in the normal way.

       <b>Q</b>      The recipe is not printed prior to execution.

       <b>R</b>      The rule is a meta-rule using regular expressions.  In the rule, <b>%</b> has no  special  meaning.   The
              target  is  interpreted  as  a  regular expression as defined in <u><a href="../man7/regexp.7.html">regexp</a></u>(7).  The prerequisites may
              contain references to subexpressions in form <b>\</b><u>n</u>, as in the substitute command of <u><a href="../man1/sed.1.html">sed</a></u>(1).

       <b>U</b>      The targets are considered to have been updated even if the recipe did not do so.

       <b>V</b>      The targets of this rule are marked as virtual.  They are distinct from files of the same name.

</pre><h4><b>EXAMPLES</b></h4><pre>
       A simple mkfile to compile a program:

              &lt;/$objtype/mkfile

              prog:   a.$O b.$O c.$O
                      $LD $LDFLAGS -o $target $prereq

              %.$O:   %.c
                      $CC $CFLAGS $stem.c

       Override flag settings in the mkfile:

              % mk target 'CFLAGS=-S -w'

       Maintain a library:

              libc.a(%.$O):N: %.$O
              libc.a: libc.a(abs.$O) libc.a(access.$O) libc.a(alarm.$O) ...
                      ar r libc.a $newmember

       String expression variables to derive names from a master list:

              NAMES=alloc arc bquote builtins expand main match mk var word
              OBJ=${NAMES:%=%.$O}

       Regular expression meta-rules:

              ([^/]*)/(.*)\.$O:R:  \1/\2.c
                      cd $stem1; $CC $CFLAGS $stem2.c

       A correct way to deal with <u><a href="../man1/yacc.1.html">yacc</a></u>(1) grammars.  The file  <b>lex.c</b>  includes  the  file  <b>x.tab.h</b>  rather  than
       <b>y.tab.h</b> in order to reflect changes in content, not just modification time.

              lex.$O: x.tab.h
              x.tab.h:        y.tab.h
                      cmp -s x.tab.h y.tab.h || cp y.tab.h x.tab.h
              y.tab.c y.tab.h:        gram.y
                      $YACC -d gram.y

       The above example could also use the <b>P</b> attribute for the <b>x.tab.h</b> rule:

              x.tab.h:Pcmp -s:        y.tab.h
                      cp y.tab.h x.tab.h

</pre><h4><b>SOURCE</b></h4><pre>
       <b>/src/cmd/mk</b>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/sh.1.html">sh</a></u>(1), <u><a href="../man7/regexp.7.html">regexp</a></u>(7)

       A. Hume, ``Mk: a Successor to Make'' (Tenth Edition Research Unix Manuals).

       Andrew G. Hume and Bob Flandrena, ``Maintaining Files on Plan 9 with Mk''.  DOCPREFIX/doc/mk.pdf

</pre><h4><b>HISTORY</b></h4><pre>
       Andrew Hume wrote <u>mk</u> for Tenth Edition Research Unix.  It was later ported to Plan 9.  This software is a
       port of the Plan 9 version back to Unix.

</pre><h4><b>BUGS</b></h4><pre>
       Identical recipes for regular expression meta-rules only have one target.

       Seemingly  appropriate  input  like  <b>CFLAGS=-DHZ=60</b>  is  parsed  as an erroneous attribute; correct it by
       inserting a space after the first

       The recipes printed by <u>mk</u> before being passed to  the  shell  for  execution  are  sometimes  erroneously
       expanded for printing.  Don't trust what's printed; rely on what the shell does.

                                                                                                      <u><a href="../man1plan9/MK.1plan9.html">MK</a></u>(1plan9)
</pre>
 </div>
</div></section>
</div>
</body>
</html>