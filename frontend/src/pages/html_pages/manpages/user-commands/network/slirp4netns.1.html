<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>slirp4netns - User-mode networking for unprivileged network namespaces</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/slirp4netns">slirp4netns_1.2.1-1build2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       slirp4netns - User-mode networking for unprivileged network namespaces

</pre><h4><b>SYNOPSIS</b></h4><pre>
       slirp4netns [OPTION]... PID|PATH [TAPNAME]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       slirp4netns provides user-mode networking ("slirp") for network namespaces.

       Unlike <b><a href="../man4/veth.4.html">veth</a>(4)</b>, slirp4netns does not require the root privileges on the host.

       Default configuration:

              • MTU:               1500

              • CIDR:              10.0.2.0/24

              • Gateway/Host:      10.0.2.2    (network address + 2)

              • DNS:               10.0.2.3    (network address + 3)

              • DHCP begin:        10.0.2.15   (network address + 15)

              • DHCP end:          10.0.2.30   (network address + 30)

              • IPv6 CIDR:         fd00::/64

              • IPv6 Gateway/Host: fd00::2

              • IPv6 DNS:          fd00::3

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-c</b>,  <b>--configure</b>  bring  up  the  TAP  interface. IP will be set to 10.0.2.100 (network address + 100) by
       default. IPv6 will be set to a random address.  Starting with v0.4.0,  the  loopback  interface  (<b>lo</b>)  is
       brought up as well.

       <b>-e</b>, <b>--exit-fd=FD</b> specify the FD for terminating slirp4netns.  When the FD is specified, slirp4netns exits
       when a <b><a href="../man2/poll.2.html">poll</a>(2)</b> event happens on the FD.

       <b>-r</b>,  <b>--ready-fd=FD</b> specify the FD to write to when the initialization steps are finished.  When the FD is
       specified, slirp4netns writes <b>"1"</b> to the FD and close the FD.  Prior to v0.4.0, the FD was written  after
       the network configuration (<b>-c</b>) but before the API socket configuration (<b>-a</b>).

       <b>-m</b>, <b>--mtu=MTU</b> (since v0.2.0) specify MTU (max=65521).

       <b>-6</b>, <b>--enable-ipv6</b> (since v0.2.0, EXPERIMENTAL) enable IPv6

       <b>-a</b>, <b>--api-socket</b> (since v0.3.0) API socket path

       <b>--cidr</b> (since v0.3.0) specify CIDR, e.g. 10.0.2.0/24

       <b>--disable-host-loopback</b> (since v0.3.0) prohibit connecting to 127.0.0.1:* on the host namespace

       <b>--netns-type=TYPE</b> (since v0.4.0) specify network namespace type ([path|pid], default=pid)

       <b>--userns-path=PATH</b> (since v0.4.0) specify user namespace path

       <b>--enable-sandbox</b> (since v0.4.0) enter the user namespace and create a new mount namespace where only <a href="file:/etc">/etc</a>
       and <a href="file:/run">/run</a> are mounted from the host.

       Requires <b><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></b> not to be a symlink to a file outside <a href="file:/etc">/etc</a> and /run.

       When  running  as the root, the process does not enter the user namespace but all the capabilities except
       <b>CAP_NET_BIND_SERVICE</b> are dropped.

       <b>--enable-seccomp</b> (since v0.4.0, EXPERIMENTAL) enable <b><a href="../man2/seccomp.2.html">seccomp</a>(2)</b> to limit  syscalls.   Typically  used  in
       conjunction with <b>--enable-sandbox</b>.

       <b>--outbound-addr=IPv4</b> (since v1.1.0, EXPERIMENTAL) specify outbound ipv4 address slirp should bind to

       <b>--outbound-addr=INTERFACE</b>  (since  v1.1.0,  EXPERIMENTAL) specify outbound interface slirp should bind to
       (ipv4 traffic only)

       <b>--outbound-addr=IPv6</b> (since v1.1.0, EXPERIMENTAL) specify outbound ipv6 address slirp should bind to

       <b>--outbound-addr6=INTERFACE</b> (since v1.1.0, EXPERIMENTAL) specify outbound interface slirp should  bind  to
       (ipv6 traffic only)

       <b>--disable-dns</b> (since v1.1.0) disable built-in DNS (10.0.2.3 by default)

       <b>--macaddress</b> (since v1.1.9) specify MAC address of the TAP interface (only valid with -c)

       <b>--target-type=TYPE</b> (since v1.2.0) specify the target type ([netns|bess], default=netns).

       The  <b>bess</b>  mode  (since v1.2.0, EXPERIMENTAL) is expected to be used with User Mode Linux.  The <b>bess</b> mode
       conflicts with <b>--configure</b>, <b>--netns-type</b>, and <b>--userns-path</b>.

       <b>-h</b>, <b>--help</b> (since v0.2.0) show help and exit

       <b>-v</b>, <b>--version</b> (since v0.2.0) show version and exit

</pre><h4><b>EXAMPLE</b></h4><pre>
       <b>Terminal</b> <b>1</b>: Create user/network/mount namespaces

              (host)$ unshare --user --map-root-user --net --mount
              (namespace)$ echo $$ &gt; /tmp/pid

       In this documentation, we use <b>(host)$</b> as the prompt of the host shell, <b>(namespace)$</b> as the prompt of  the
       shell running in the namespaces.

       If <b>unshare</b> fails, try the following commands (known to be needed on Debian, Arch, and old CentOS 7.X):

              (host)$ sudo sh -c 'echo "user.max_user_namespaces=28633" &gt;&gt; /etc/sysctl.d/userns.conf'
              (host)$ if [ -f <a href="file:/proc/sys/kernel/unprivileged_userns_clone">/proc/sys/kernel/unprivileged_userns_clone</a> ]; then sudo sh -c 'echo "kernel.unprivileged_userns_clone=1" &gt;&gt; /etc/sysctl.d/userns.conf'; fi
              (host)$ sudo sysctl --system

       <b>Terminal</b> <b>2</b>: Start slirp4netns

              (host)$ slirp4netns --configure --mtu=65520 $(cat /tmp/pid) tap0
              starting slirp, MTU=65520

       <b>Terminal</b> <b>1</b>: Make sure <b>tap0</b> is configured and connected to the Internet

              (namespace)$ ip a
              1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000
                  link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
              3: tap0: &lt;BROADCAST,UP,LOWER_UP&gt; mtu 65520 qdisc fq_codel state UNKNOWN group default qlen 1000
                  link/ether c2:28:0c:0e:29:06 brd ff:ff:ff:ff:ff:ff
                  inet 10.0.2.100/24 brd 10.0.2.255 scope global tap0
                     valid_lft forever preferred_lft forever
                  inet6 fe80::c028:cff:fe0e:2906/64 scope link
                     valid_lft forever preferred_lft forever
              (namespace)$ echo "nameserver 10.0.2.3" &gt; /tmp/resolv.conf
              (namespace)$ mount --bind /tmp/resolv.conf <a href="file:/etc/resolv.conf">/etc/resolv.conf</a>
              (namespace)$ curl https://example.com

       Bind-mounting  <b><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></b>  is  only  needed  when  <b><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></b>  on the host refers to loopback
       addresses (<b>127.0.0.X</b>, typically <b><a href="../man8/dnsmasq.8.html">dnsmasq</a>(8)</b> or <b><a href="../man8/systemd-resolved.service.8.html">systemd-resolved.service</a>(8)</b>) that cannot be  accessed  from
       the namespace.

       If  your <b><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></b> on the host is managed by <b><a href="../man8/networkmanager.8.html">networkmanager</a>(8)</b> or <b><a href="../man8/systemd-resolved.service.8.html">systemd-resolved.service</a>(8)</b>, you
       might need to mount a new filesystem on <b><a href="file:/etc">/etc</a></b> instead, so as to  prevent  the  new  <b><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></b>  from
       being unmounted unexpectedly when <b><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></b> on the host is regenerated.

              (namespace)$ mkdir /tmp/a /tmp/b
              (namespace)$ mount --rbind <a href="file:/etc">/etc</a> /tmp/a
              (namespace)$ mount --rbind /tmp/b <a href="file:/etc">/etc</a>
              (namespace)$ mkdir /etc/.ro
              (namespace)$ mount --move /tmp/a /etc/.ro
              (namespace)$ cd <a href="file:/etc">/etc</a>
              (namespace)$ for f in .ro/*; do ln -s $f $(basename $f); done
              (namespace)$ rm resolv.conf
              (namespace)$ echo "nameserver 10.0.2.3" &gt; resolv.conf
              (namespace)$ curl https://example.com

       These steps can be simplified with <b>rootlesskit</b> <b>--copy-up=<a href="file:/etc">/etc</a></b> if <b>rootlesskit</b> is installed:

              (host)$ rootlesskit --net=slirp4netns --copy-up=<a href="file:/etc">/etc</a> bash
              (namespace)$ cat <a href="file:/etc/resolv.conf">/etc/resolv.conf</a>
              nameserver 10.0.2.3

</pre><h4><b>ROUTING</b> <b>PING</b> <b>PACKETS</b></h4><pre>
       To route ping packets, you may need to set up <b>net.ipv4.ping_group_range</b> properly as the root.

       e.g.

              (host)$ sudo sh -c 'echo "net.ipv4.ping_group_range=0   2147483647" &gt; /etc/sysctl.d/ping_group_range.conf'
              (host)$ sudo sysctl --system

</pre><h4><b>FILTERING</b> <b>CONNECTIONS</b></h4><pre>
       By  default,  ports  listening  on  <b>INADDR_LOOPBACK</b> (<b>127.0.0.1</b>) on the host are accessible from the child
       namespace via  the  gateway  (default:  <b>10.0.2.2</b>).   <b>--disable-host-loopback</b>  can  be  used  to  prohibit
       connecting to <b>INADDR_LOOPBACK</b> on the host.

       However,  a  host  loopback address might be still accessible via the built-in DNS (default: <b>10.0.2.3</b>) if
       <b><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></b> on the host refers to a loopback address.  You may want to set up iptables for  limiting
       access to the built-in DNS in such a case.

              (host)$ nsenter -t $(cat /tmp/pid) -U --preserve-credentials -n
              (namespace)$ iptables -A OUTPUT -d 10.0.2.3 -p udp --dport 53 -j ACCEPT
              (namespace)$ iptables -A OUTPUT -d 10.0.2.3 -j DROP

</pre><h4><b>API</b> <b>SOCKET</b></h4><pre>
       slirp4netns can provide QMP-like API server over an UNIX socket file:

              (host)$ slirp4netns --api-socket /tmp/slirp4netns.sock ...

       <b>add_hostfwd</b>: Expose a port (IPv4 only)

              (namespace)$ json='{"execute": "add_hostfwd", "arguments": {"proto": "tcp", "host_addr": "0.0.0.0", "host_port": 8080, "guest_addr": "10.0.2.100", "guest_port": 80}}'
              (namespace)$ echo -n $json | nc -U /tmp/slirp4netns.sock
              {"return": {"id": 42}}

       If <b>host_addr</b> is not specified, then it defaults to "0.0.0.0".

       If  <b>guest_addr</b>  is  not  specified,  then  it  will  be  set  to  the default address that corresponds to
       <b>--configure</b>.

       <b>list_hostfwd</b>: List exposed ports

              (namespace)$ json='{"execute": "list_hostfwd"}'
              (namespace)$ echo -n $json | nc -U /tmp/slirp4netns.sock
              {"return": {"entries": [{"id": 42, "proto": "tcp", "host_addr": "0.0.0.0", "host_port": 8080, "guest_addr": "10.0.2.100", "guest_port": 80}]}}

       <b>remove_hostfwd</b>: Remove an exposed port

              (namespace)$ json='{"execute": "remove_hostfwd", "arguments": {"id": 42}}'
              (namespace)$ echo -n $json | nc -U /tmp/slirp4netns.sock
              {"return": {}}

       Remarks:

              • Client needs to <b><a href="../man2/shutdown.2.html">shutdown</a>(2)</b> the socket with  <b>SHUT_WR</b>  after  sending  every  request.   i.e.  No
                support for keep-alive and timeout.

              • slirp4netns "stops the world" during processing API requests.

              • A request must be less than 4096 bytes.

              • JSON responses may contain <b>error</b> instead of <b>return</b>.

</pre><h4><b>DEFINED</b> <b>NAMESPACE</b> <b>PATHS</b></h4><pre>
       A user can define a network namespace path as opposed to the default process ID:

              (host)$ slirp4netns --netns-type=path ... /path/to/netns tap0

       Currently, the <b>netns-type=TYPE</b> argument supports <b>path</b> or <b>pid</b> args with the default being <b>pid</b>.

       Additionally, a <b>--userns-path=PATH</b> argument can be included to override any user namespace path defaults

              (host)$ slirp4netns --netns-type=path --userns-path=/path/to/userns /path/to/netns tap0

</pre><h4><b>OUTBOUND</b> <b>ADDRESSES</b></h4><pre>
       A user can defined preferred outbound ipv4 and ipv6 address in multi IP scenarios.

              (host)$ slirp4netns --outbound-addr=10.2.2.10 --outbound-addr6=fe80::10 ...

       Optionally you can use interface names instead of ip addresses.

              (host)$ slirp4netns --outbound-addr=eth0 --outbound-addr6=eth0 ...

</pre><h4><b>INTER-NAMESPACE</b> <b>COMMUNICATION</b></h4><pre>
       The  easiest  way  to  allow  inter-namespace  communication  is  to  nest  network namespaces inside the
       slirp4netns's network namespace.

              (host)$ nsenter -t $(cat /tmp/pid) -U --preserve-credentials -n -m
              (namespace)$ mount -t tmpfs none <a href="file:/run">/run</a>
              (namespace)$ ip netns add foo
              (namespace)$ ip netns add bar
              (namespace)$ ip link add veth-foo type veth peer name veth-bar
              (namespace)$ ip link set veth-foo netns foo
              (namespace)$ ip link set veth-bar netns bar
              (namespace)$ ip netns exec foo ip link set veth-foo name eth0
              (namespace)$ ip netns exec bar ip link set veth-bar name eth0
              (namespace)$ ip netns exec foo ip link set lo up
              (namespace)$ ip netns exec bar ip link set lo up
              (namespace)$ ip netns exec foo ip link set eth0 up
              (namespace)$ ip netns exec bar ip link set eth0 up
              (namespace)$ ip netns exec foo ip addr add 192.168.42.100/24 dev eth0
              (namespace)$ ip netns exec bar ip addr add 192.168.42.101/24 dev eth0
              (namespace)$ ip netns exec bar ping 192.168.42.100

       However, this method does not work when you want  to  allow  communication  across  multiple  slirp4netns
       instances.   To  allow  communication  across multiple slirp4netns instances, you need to combine another
       network stack such as <b><a href="../man1/vde_plug.1.html">vde_plug</a>(1)</b> with slirp4netns.

              (host)$ vde_plug --daemon switch:///tmp/switch null://
              (host)$ nsenter -t $(cat /tmp/pid-instance0) -U --preserve-credentials -n
              (namespace-instance0)$ vde_plug --daemon vde:///tmp/switch tap://vde
              (namespace-instance0)$ ip link set vde up
              (namespace-instance0)$ ip addr add 192.168.42.100/24 dev vde
              (namespace-instance0)$ exit
              (host)$ nsenter -t $(cat /tmp/pid-instance1) -U --preserve-credentials -n
              (namespace-instance1)$ vde_plug --daemon vde:///tmp/switch tap://vde
              (namespace-instance1)$ ip link set vde up
              (namespace-instance1)$ ip addr add 192.168.42.101/24 dev vde
              (namespace-instance1)$ ping 192.168.42.100

</pre><h4><b>INTER-HOST</b> <b>COMMUNICATION</b></h4><pre>
       VXLAN is known to work.  See Usernetes project for the example of multi-node rootless Kubernetes  cluster
       with VXLAN: <b>https://github.com/rootless-containers/usernetes</b>

</pre><h4><b>BESS</b> <b>MODE</b> <b>(FOR</b> <b>USER</b> <b>MODE</b> <b>LINUX)</b></h4><pre>
       slirp4netns  (since  v1.2.0) can be also used as a BESS-compatible server to provide network connectivity
       to User Mode Linux.

       <b>Terminal</b> <b>1</b>: Start slirp4netns

              (host)$ slirp4netns --target-type=bess /tmp/bess.sock

       <b>Terminal</b> <b>2</b>: Start User Mode Linux

              (host)$ linux.uml vec0:transport=bess,dst=/tmp/bess.sock,depth=128,gro=1 root=/dev/root rootfstype=hostfs init=<a href="file:/bin/bash">/bin/bash</a> mem=2G
              (UML)$ ip addr add 10.0.2.100/24 dev vec0
              (UML)$ ip link set vec0 up
              (UML)$ ip route add default via 10.0.2.2

       Currently, only a single instance of User Mode Linux can be connected to the slirp4netns BESS server.

       See              also              User              Mode              Linux               documentation:
       <b>https://www.kernel.org/doc/html/latest/virt/uml/user_mode_linux_howto_v2.html#bess-socket-transport</b>

</pre><h4><b>BUGS</b></h4><pre>
       Kernel  4.20  bumped  up  the default value of <b><a href="file:/proc/sys/net/ipv4/tcp_rmem">/proc/sys/net/ipv4/tcp_rmem</a></b> from 87380 to 131072.  This is
       known          to          slow           down           slirp4netns           port           forwarding:
       <b>https://github.com/rootless-containers/slirp4netns/issues/128</b>.

       As  a  workaround, you can adjust the value of <b><a href="file:/proc/sys/net/ipv4/tcp_rmem">/proc/sys/net/ipv4/tcp_rmem</a></b> inside the namespace.  No real
       root privilege is needed to modify the file since kernel 4.15.

              (host)$ nsenter -t $(cat /tmp/pid) -U --preserve-credentials -n -m
              (namespace)$ c=$(cat <a href="file:/proc/sys/net/ipv4/tcp_rmem">/proc/sys/net/ipv4/tcp_rmem</a>); echo $c | sed -e s/131072/87380/g &gt; <a href="file:/proc/sys/net/ipv4/tcp_rmem">/proc/sys/net/ipv4/tcp_rmem</a>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/network_namespaces.7.html">network_namespaces</a>(7)</b>, <b><a href="../man7/user_namespaces.7.html">user_namespaces</a>(7)</b>, <b><a href="../man4/veth.4.html">veth</a>(4)</b>

</pre><h4><b>AVAILABILITY</b></h4><pre>
       The slirp4netns command is available from  <b>https://github.com/rootless-containers/slirp4netns</b>  under  GNU
       GENERAL PUBLIC LICENSE Version 2 (or later).

Rootless Containers                               January 2022                                    <u><a href="../man1/SLIRP4NETNS.1.html">SLIRP4NETNS</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>