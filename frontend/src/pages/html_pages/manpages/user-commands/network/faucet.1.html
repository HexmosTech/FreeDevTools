<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>faucet - a fixture for a BSD network pipe</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/netpipes">netpipes_4.2-8build1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       faucet - a fixture for a BSD network pipe

       netpipes 4.2

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>faucet</b>  <u>port</u>  (<b>--in</b>|<b>--out</b>|<b>--err</b>|<b>--fd</b>  <u>n</u>)+  [<b>--once</b>]  [<b>--verbose</b>]  [<b>--quiet</b>] [<b>--unix</b>] [<b>--foreignhost</b> <u>addr</u>]
       [<b>--foreignport</b> <u>port</u>] [<b>--localhost</b> <u>addr</u>] [<b>--serial</b>] [<b>--daemon</b>] [<b>--shutdown</b> (r|w)  ]  [<b>--pidfile</b>  <u>filename</u>]
       [<b>--noreuseaddr</b>]   [<b>--backlog</b>   <u>n</u>]  [<b>-</b>[<b>i</b>][<b>o</b>][<b>e</b>][<b>#</b><u>3</u>[,<u>4</u>[,<u>5</u>...]]][<b>v</b>][<b>1</b>][<b>q</b>][<b>u</b>][<b>d</b>][<b>s</b>]]  [<b>-p</b>  <u>foreign-port</u>]  [<b>-h</b>
       <u>foreign-host</u>] [<b>-H</b> <u>local-host</u>] <u>command</u> <u>args</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>faucet</b> attempts to provide the functionality of pipes over the network.  It behaves as the server end  of
       a server-client connection.  When used with <b><a href="../man1/hose.1.html">hose</a>(1)</b> it can function as a replacement for

       tar -cf - . | rsh other "cd destdir; tar -xf -"

       <b>faucet</b>  and <b>hose</b> are especially useful when you don't have easy non-interactive access to the destination
       account (such as a root account where .rhosts are a bad idea).

       <b>faucet</b> creates a BSD socket, binds it to the  <u>port</u>  specified  on  the  command  line,  and  listens  for
       connections.

       Every  time  <b>faucet</b> gets a connection it <a href="../man2/exec.2.html">exec</a>(2)s <u>command</u> and its <u>args</u> with stdin, stdout, stderr, and/or
       arbitrary file descriptors redirected according to the <b>--in</b>  <b>--out</b>  <b>--err</b>  <b>--fd</b>  <u>n</u>  flags.   <b>faucet</b>  also
       automagically  shuts  down  the  unused half of the connection if only <b>--in</b> is specified or if only <b>--out</b>
       and/or <b>--err</b> are specified.  See the <b>--shutdown</b> option for more information.

</pre><h4><b>OPTIONS</b></h4><pre>
       If the <b>--once</b> flag is specified, <b>faucet</b> will <a href="../man2/exec.2.html">exec</a>(2) the <u>command</u> instead of  <a href="../man2/fork.2.html">fork</a>(2)ing  and  <a href="../man2/exec.2.html">exec</a>(2)ing.
       <b>--once</b> means that the network pipe is only good for one shot.

       The  <b>--verbose</b>  flag  specifies  that  <b>faucet</b>  should  print  information  about  connecting hosts.  This
       information includes the numeric host address, host names, and foreign port numbers.   The  <b>--quiet</b>  flag
       specifies that <b>faucet</b> should NOT print such info.  <b>--quiet</b> is the default.

       The <b>--unix</b> flag specifies that the <u>port</u> is not an internet port number or service name, but instead it is
       a file name for a UNIX domain socket.

       The  <b>--foreignhost</b>  option  specifies that faucet should reject all connections that do not come from the
       <u>host</u> machine.  Similarly <b>--foreignport</b> specifies that faucet should reject all connections that  are  not
       bound  on  their  local  machine  to  the  <u>port</u>  argument.   The  above two options allow a crude form of
       authentication.  Note that on UNIX systems only root can bind a socket to a port number below 1024.

       <b>Please</b> do not be fooled into thinking this makes faucet secure.  There are ways to spoof IP numbers  that
       have  been  known for years (but only publicized recently).  I do think that this method is safe from DNS
       spoofs, but you probably should have  <b>nospoof</b> <b>on</b> in <a href="file:/etc/host.conf">/etc/host.conf</a> anyway.

       <b>--localhost</b> specifies that the listening socket should be bound to a specific internet  address  on  this
       host.  This is only useful on hosts with several internet numbers.

       <b>--daemon</b>  specifies that the faucet should disassociate from the controlling terminal once it has started
       listening on the socket.  This is done using the setsid() system call.  If you don't have setsid on  your
       system,  it  uses  the  standard  ``close all file descriptors, ioctl TIOCNOTTY, fork() and parent exit''
       sequence.

       <b>--shutdown</b> is used to turn the (normally) bi-directional socket into a uni-directional one If the `r'  is
       present,  then  <b>faucet</b> will close half the connection to make it a read-only socket.  If we try to write,
       it will fail.  If the remote connection tries to read, it will percieve the socket as closed.  If instead
       the `w' is present, then <b>faucet</b> will close the other half of the  connection  to  make  it  a  write-only
       socket.   If  we  try  to read, we will percieve the socket as closed.  If the remote connection tries to
       write, it will fail.  The default behavior is to leave both halves open, however the shutdown of half  of
       the  connection  is  automagically  done by certain combinations of the <b>--in</b>, <b>--out</b>, and <b>--err</b> flags.  To
       suppress their automagic behavior you can use (respectively) --fd 0, --fd 1, and --fd 2.

       <b>--shutdown</b> may not be used with some internet servers (such as certain httpds) because they interpret the
       closing of one half of the connection as a close on the entire connection.  This warning applies to <b>--in</b>,
       <b>--out</b>, and <b>--err</b>.

       <b>--serial</b> causes faucet  to  wait  for  one  child  to  finish  before  accepting  any  more  connections.
       Serialization is a very crude form of critical-section management.

       <b>--pidfile</b>  <u>filename</u> commands <b>faucet</b> to write its process id into <u>filename</u>.  This is useful when faucet is
       part of a larger system and a controlling process might want to kill  the  faucet.   <b>--pidfile</b>  functions
       properly when using the <b>--daemon</b>  option.

       By default, <b>faucet</b> performs a

       setsockopt(fd, SOL_SOCKET, SO_REUSEADDR...)

       which  prevents  the  ``Address  in  use''  problem  that  ``plagued'' netpipes versions 4.0 and earlier.
       <b>--noreuseaddr</b> tells faucet to skip that system call, and revert to pre-4.1 behavior.  Without this  call,
       the socket is not always available for immediate reuse after the faucet exits.

       <b>--backlog</b> <u>n</u> allows you to specify the second parameter to the <a href="../man2/listen.2.html">listen</a>(2) system call.  The default is 5.

</pre><h4><b>SHORT</b> <b>FLAGS</b></h4><pre>
       To  reduce  the  typing  requirements  for  arguments (and to pay homage to the age-old tradition of UNIX
       cryptotaxonomy) I have added some short forms of the flags.  Here is a correspondence chart:

       ┌───────┬──────────────┐
       │ Short │ Long         │
       │   <b>i</b>   │ <b>in</b>           │
       │   <b>o</b>   │ <b>out</b>          │
       │   <b>e</b>   │ <b>err</b>          │
       │  <b>#</b><u>n</u>   │ <b>fd</b><u>n</u>          │
       │   <b>v</b>   │ <b>verbose</b>      │
       │   <b>1</b>   │ <b>once</b>         │
       │   <b>q</b>   │ <b>quiet</b>        │
       │   <b>u</b>   │ <b>unix</b>         │
       │   <b>d</b>   │ <b>daemon</b>       │
       │   <b>s</b>   │ <b>serial</b>       │
       │   <b>p</b>   │ <b>foreignport</b>  │
       │   <b>h</b>   │ <b>foreignhost</b>  │
       │   <b>H</b>   │ <b>localhost</b>    │
       └───────┴──────────────┘

       For example, the following command

       example$ faucet 3000 --out --verbose --once --foreignhost client echo blah

       could be written

       example$ faucet 3000 -ov1h client echo blah

       The <b>-p</b>, <b>-h</b>, and <b>-H</b> flags take an argument, but the flags may be grouped into  one  argument.   They  then
       grab the arguments they need from the command line in the order the flags appear.

       example$ faucet 3000 -hpHov1 client 2999 example-le2 echo blah

       Whereas  each  <b>--fd</b>  word flag required an individual descriptor, the <b>-#</b> character flag can take multiple
       descriptors.  The following are equivalent:

       example$ faucet 3000 --fd 0 --fd 1 --verbose --once echo blah
       example$ faucet 3000 -#0,1v --once echo blah
       example$ faucet 3000 -v1#0,1 echo blah
       example$ faucet 3000 -#0,1v1 echo blah

       Note that you have to pay attention when using the <b>-#</b> character flag and the <b>-1</b>  character  flag  in  the
       same argument.  Also, remember the special <a href="../man2/shutdown.2.html">shutdown</a>(2) semantics of <b>-in</b> and <b>-out</b>.

</pre><h4><b>EXAMPLES</b></h4><pre>
       This creates a TCP-IP socket on the local machine bound to port 3000.

       example$ faucet 3000 --out --verbose tar -cf - .

       Every  time  some  process (from any machine) attempts to connect to port 3000 on this machine the <b>faucet</b>
       program will <a href="../man2/fork.2.html">fork</a>(2) a process and the child will <a href="../man2/exec.2.html">exec</a>(2) a

       tar -cf - .

       The <b>--out</b> option means that the output of the child process will have been redirected into the new socket
       retrieved by the <a href="../man2/accept.2.html">accept</a>(2) call.  <b>--verbose</b> means that faucet  will  print  information  about  each  new
       connection.

       This creates a UNIX domain socket in the current directory

       example$ faucet u-socket --out --err --once --unix csh -c \
            "dd if=angio.pgm | funky.perl.script"

       The  <b>--out</b> <b>--err</b> option means that stdout and stderr will be redirected in the child process.  The <b>--once</b>
       option means that the faucet will not <a href="../man2/fork.2.html">fork</a>(2), but <a href="../man2/exec.2.html">exec</a>(2) the process so that only the first process can
       connect to the u-socket before the faucet becomes unavailable.

       This example listens  on  a  socket  until  the  first  connection  comes  through.   It  then  spawns  a
       bidirectional copy that is similar to hose -slave.

       faucet 3000 -1v --fd 3 sh -c 'cat &lt;&amp;3 &amp; cat &gt;&amp;3 ; sockdown 3'

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       netpipes  (1),  hose  (1),  sockdown  (1), getpeername (1), socket (2), bind (2), listen (2), accept (2),
       shutdown (2), services (5), gethostbyaddr (3)

</pre><h4><b>BUGS</b></h4><pre>
       There is a problem with almost every OS I have used faucet on.  Ports are sometimes not recycled  swiftly
       enough.   If  you kill one faucet and try to start another that wants to listen on the same port you will
       often see pre-4.1 faucets print the following warning over and over again:

       faucet: Address 3000 in use, sleeping 10.
       faucet: Trying again . . .

       but you won't actually be able to <a href="../man2/connect.2.html">connect</a>(2) to that port (with <b><a href="../man1/hose.1.html">hose</a></b>(1), for example) because you'll  get
       a ``connection refused''.

       There  was also an experimental Linux kernel that NEVER recycled ports (I quickly switched back to my old
       kernel).

       I have been informed that this is a side-effect of the TCP  specification  and  that  I  should  use  the
       SO_REUSEADDR option to work around it, so I do.

</pre><h4><b>NOTES</b></h4><pre>
       Doubtless  there  are  bugs  in  this  program, especially in the unix domain socket portions.  I welcome
       problem reports and would like to make  these  programs  as  "clean"  (no  leftover  files,  sockets)  as
       possible.

       4.1  added  <b>--backlog</b>  and  <b>--noreuseaddr</b>.   <b>--noreuseaddr</b>  reflects  the  fact  that  4.1 also added the
       SO_REUSEADDR socket option as the default.

       4.0 made the full-word arguments use -- like many GNU programs.  They are still available with a single -
       for backward-compatibility.

       3.1 added the single-character flags and the -pidfile option.  It also switched to the  <a href="../man2/setsid.2.html">setsid</a>(2)  system
       call  to detach itself from the process group for the -daemon flag.  I've been hacking at UNIX for years,
       but there are still some things that I never really learned, and others that have been changing.  I  need
       to buy a book.

       Release 2.3 added support for multi-homed hosts: hosts with multiple internet numbers (such as gateways).
       Before  this  faucet assumed that the first internet number that gethostbyname returned was the only one.
       <b>--foreignhost</b>  authentication  was  weakened  by  this  inadequacy  so  I  beefed  up   the   algorithms.
       <b>--foreignhost</b> will accept a connection from any of the internet numbers associated with the host name.

</pre><h4><b>CREDITS</b></h4><pre>
       Thanks to Steve Clift &lt;<a href="mailto:clift@ml.csiro.au">clift@ml.csiro.au</a>&gt; for SGI (SysV) patches.

       Many  people  complained  about  the  old  way  of specifying the command.  Thanks to whoever gave me the
       alternative which is now implemented.  It is much better.

       Randy Fischer &lt;<a href="mailto:fischer@ucet.ufl.edu">fischer@ucet.ufl.edu</a>&gt; finally  prodded  me  into  fixing  the  old  lame  non-handling  of
       multi-homed host.

       Thanks to all who suggested I use setsid() for -daemon mode.

       Thanks  to  the  Spring  1996  UF  CIS  consulting  staff  &lt;<a href="mailto:consult@cis.ufl.edu">consult@cis.ufl.edu</a>&gt;  for  pointing  out  the
       sys_errlist[] declaration conflict on FreeBSD.  Sometimes I hate Sun Microsystems.

       Thanks to Daniel O'Connor &lt;<a href="mailto:doconnor@adam.ist.flinders.edu.au">doconnor@adam.ist.flinders.edu.au</a>&gt; for suggesting the -pidfile flag.

       Big thanks to Joe Traister &lt;<a href="mailto:traister@gate.net">traister@gate.net</a>&gt; for his signal handling patches, strerror  surrogate,  and
       other assorted hacks.

       Thanks  to  Thomas  A. Endo &lt;<a href="mailto:tendo@netcom.com">tendo@netcom.com</a>&gt; for dropping an SO_REUSEADDR patch in my lap.  Otherwise I
       wouldn't have gotten to it till 2001.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright (C) 1992-98 Robert Forsman

       This program is free software; you can redistribute it and/or modify  it  under  the  terms  of  the  GNU
       General  Public License as published by the Free Software Foundation; either version 2 of the License, or
       (at your option) any later version.

       This program is distributed in the hope that it will be useful, but WITHOUT ANY  WARRANTY;  without  even
       the  implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
       License for more details.

       You should have received a copy of the GNU General Public License along with this program; if not,  write
       to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

</pre><h4><b>AUTHOR</b></h4><pre>
       Robert Forsman
        <a href="mailto:thoth@purplefrog.com">thoth@purplefrog.com</a>
        Purple Frog Software
        <a href="http://web.purplefrog.com/~thoth/">http://web.purplefrog.com/~thoth/</a>

                                                October 28, 1998                                       <u><a href="../man1/FAUCET.1.html">FAUCET</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>