<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sortmail - classify incoming mail</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/sortmail">sortmail_2.4-5build2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sortmail - classify incoming mail

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>sortmail</b> [ <b>-v</b> ] [ <b>-terse</b> ] [ <b>-home</b> <u>path</u> ] [ <b>-mailbox</b> <u>path</u> ] [ <b>-mailrc</b> <u>initfile</u> ] [ <b>-sortmailrc</b> <u>initfile</u> ]
       [  <b>-inbox</b> <u>filename</u> ] [ <b>-mbox</b> ] [ <b>-pop|pop3|pop2</b> <u>user:password@host</u> ] [ <b>-pop|pop3|pop2</b> <u>/path</u> ] [ <b>-keep</b> ] [
       <b>-noapop</b> ] [ <u>var=value</u> ] [ <b>-dumpCrcs</b> <u>dbmname</u> ] [ <b>-verify</b> ] [ <b>-version</b> ] <u>username</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>Sortmail</b> reads and classifies email according to patterns  you  specify.   It  can  be  used  to  process
       incoming mail, filter mailing lists, process mail folders or download mail from POP servers.

       For processing incoming mail, create this <b>.forward</b> file in your home directory:

            "| /<u>path</u>/sortmail <u>user</u>"

       Where  "/<u>path</u>/sortmail"  is the full path where you installed sortmail, and <u>user</u> is your own userid.  The
       userid must be specified because when mail arrives, <b>sortmail</b> could be run as root, daemon, or any  number
       of other uid's.

       Once  your  <b>.forward</b>  file  is  set up, <b>sortmail</b> will classify incoming mail according to the patterns in
       $HOME/.sortmailrc.  Your <b>.sortmailrc</b> file is similar to a news KILL file,  but  somewhat  more  powerful.
       You  can  discard  mail,  have  it  delivered to your mailbox, have it filed into a folder, forward it to
       another address or even pipe it through a shell command.

       Don't let the long list of options and command below frighten you.  New users might do well  to  skip  to
       the EXAMPLES section below, and/or read the README and sample files in /usr/share/doc/sortmail.

       When   <b>sortmail</b>   starts   up,   it   first   reads  the  following  config  files:  /usr/lib/sortmailrc,
       /usr/local/lib/sortmailrc,     /etc/sortmailrc,     /usr/local/etc/sortmailrc,     $HOME/.mailrc      and
       $HOME/.sortmailrc.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-v</b>             Verbose.   A  message  is  printed  stderr  or  a log file of your choosing for every mail
                      message.  A second <b>-v</b> causes a lot more information to be printed.

       <b>-terse</b>         Set verbosity to 1, omit timestamps.

       <b>-home</b> <u>path</u>     Set user's home directory, overriding the default taken from the user's passwd entry.

       <b>-mailbox</b> <u>path</u>  Set the user's system mailbox, overriding the default for your system (<b><a href="file:/var/mail/">/var/mail/</a></b><u>user</u>).

       <b>-mailrc</b> <u>path</u>   Set the .mailrc file, overriding the default of  <b><a href="file:~/.mailrc">~/.mailrc</a></b>.   <u>Path</u>  may  be  specified  as
                      <b>/</b><u>fullpath</u>, <b>~/</b><u>path</u>, <b>~</b><u>user</u>/<u>path</u>, or <u>path</u>.  The last form is the same as ~/<u>path</u>.

       <b>-sortmailrc</b> <u>path</u>
                      Set  the .sortmailrc file, overriding the default of <b><a href="file:~/.sortmailrc">~/.sortmailrc</a></b>.  <u>Path</u> may be specified
                      as with -mailrc, above.

       <b>-inbox</b> <u>filename</u>
                      Take input from  named  file  instead  of  stdin.   Filename  may  be  /<u>abspath</u>  "~/<u>path</u>",
                      "~user/<u>path</u>"  or  "+<u>foldername</u>".   When  POP2 protocol is used, this option can be used to
                      select the inbox instead of the default mailbox.

       <b>-mbox</b>          Indicates that input is a standard Berkeley mailbox containing multiple  messages,  rather
                      than a single message.  Used to process an entire mailbox at once.

       <b>-pop</b> <u>user:password@host</u>
                      Sortmail  connects  to the specified server, downloads mail and processes it.  If password
                      is not specified, the user is prompted interactively.  <b>Note:</b> it is <b>highly</b> recommended that
                      you do <u>not</u> specify the password on the command line on a multi-user system, see below.

                      <b>Sortmail</b> attempts to use pop3 and pop2 protocols in that order.  For obvious reasons,  the
                      user id may not contain ':'.

                      Many  providers  assign  usernames that contain '@', e.g. <a href="mailto:user@foo.com">user@foo.com</a>.  In this case, the
                      argument to -pop will look something like <a href="mailto:user@foo.com">user@foo.com</a>@pop.foo.com.

                      For security reasons, <b>sortmail</b> attempts to hide this information from  the  "ps"  command,
                      but  this  does  not  work  under  all  operating  systems (e.g. Solaris).  It is strongly
                      discouraged to specify the password on the command line for this reason.

       <b>-pop</b> <u>/path</u>     This variant of the -pop command reads a single line from the specified  file,  containing
                      <u>user:password@host</u>.  This is more secure than specifying the password on the command line.
                      File must be specified as a full pathname, starting with '/'.

       <b>-pop3</b> <u>user:password@host</u>

       <b>-pop3</b> <u>/path</u>    Sortmail connects to the specified pop3 server, downloads mail and processes it.

       <b>-pop2</b> <u>user:password@host</u>

       <b>-pop2</b> <u>/path</u>    Sortmail connects to the specified pop2 server, downloads mail and processes it.

       <b>-keep</b>          For POP use or when -inbox and -mbox are specified.  Indicates that all messages are to be
                      left in the source input box instead of being deleted.

       <b>-noapop</b>        For  POP3,  do  not  attempt to use APOP authentication.  This option is used when dealing
                      with broken servers which do not handle APOP correctly.

       <u>variable=value</u> Set a variable on the command line.  Spaces are not permitted in the string.

       <b>-dumpCrcs</b> <u>dbmname</u>
                      Dump the bounce-check database in <u>dbmname</u>.{dir,pag} for debugging purposes.

       <b>-verify</b>        Verify only.  Examine the mailrc and sortmailrc files for errors and exit.

       <b>-version</b>       Print version and exit.  If this option fails, you have version 1.something.

</pre><h4><b>SORTMAILRC</b> <b>FORMAT</b></h4><pre>
       Your .sortmailrc file is a series of lines in the form

            <b>set</b> <u>variable=value</u>

            /<u>regular-expression</u>/<u>modifiers</u>:<u>command</u>[:<u>command</u>...]

            [<u>ip-address</u>]<u>modifiers</u>:<u>commands..</u>

            [<u>ip-address/mask</u>]<u>modifiers</u>:<u>commands..</u>

            [<u>ip-address</u> <u>-</u> <u>ip-address</u>]<u>modifiers</u>:<u>commands..</u>

            (<u>logical-expression</u>):<u>command</u>[:<u>command</u>...]

            <b>includerc</b> <u>filename</u>

            <b>listinclude</b> <u>filename</u>

            <b>listexclude</b> <u>filename</u>

            <b>header</b> <u>headerline</u>

            <b>replace</b> <u>headerline</u>

            <b>bouncecheck</b> <u>dbmname</u>

       where <u>regular-expression</u> is any <b><a href="../man1/ed.1.html">ed</a>(1)</b>-style regular expression, <u>modifier</u> is any of <b>i,</b> <b>t,</b> <b>f,</b> <b>s,</b> <b>h,</b>  <b>a,</b>  <b>o</b>,
       and  <u>command</u>  is  one  of <b>m,</b> <b>j,</b> <b>v,</b> <b>f</b> <u>file</u>, <b>a</b> <u>file</u>, <b>d</b> <u>file</u>, <b>+</b><u>file</u>, or <b>|</b> <u>command</u>.  Multiple commands may be
       placed on a line, separated by ':'s.  If you need to place a ':' within a command for any reason,  escape
       it with '\\'.

       Users of rn-style KILLfiles will be familiar with this format.

       The  [<u>ip-address</u>]  form  specifies  a literal IP address to be matched (e.g. 192.168.3.4) or a partial IP
       address (e.g. 192.168.3).  This differs from a regular expression in that the '.'  character  must  match
       literally,  and the pattern must match at the start (e.g. 129.192.168.3 would not match the pattern given
       above.)  (Note that the '[]' characters are literal here, and do not denote an optional argument.)

       IP addresses may also be specified as a range, e.g.  "[192.168.0.0/16]"  would  match  all  IP  addresses
       containing  192.168  in  the  first  16  bits.   Finally,  IP  addresses  may  also  be specified as e.g.
       "[192.168.0.0 - "192.168.255.255]".

</pre><h4><b>SEARCH</b> <b>MODIFIERS</b></h4><pre>
       These modifiers affect how the regular expression is applied to the incoming mail.  The default is 's'.

       <b>i</b>     Ignore case.

       <b>o</b>     Evaluate variables in pattern only once, when  sortmailrc  file  is  read.   Without  this  option,
             variables  are  evaluated  every time the pattern is tested.  If the pattern contains no variables,
             this modifier has no effect.

       <b>s</b>     Test the "Subject: " line of the mail against the regular expression.

       <b>t</b>     Test the "To: ", "Cc: " and "Apparently-To: " lines of the mail against the regular expression.

       <b>f</b>     Test the "From: " line of the mail against the regular expression.

       <b>r</b>     Test the Received: lines of the incoming mail against the regular expression.

       <b>h</b>     Test the entire header of the incoming mail against the regular expression.

       <b>a</b>     Test the entire incoming mail message against the regular expression.

       Any combination of s,t,f,h,a may be used.  If none are specified, 's' is assumed.

</pre><h4><b>SEARCH</b> <b>COMMANDS</b></h4><pre>
       These commands are executed for any message which matches a search pattern.

       <b>:m</b>        Send the message to the user's mailbox.

       <b>:m</b> <u>address</u>
                 Forward the mail to the specified address.

       <b>:j</b>        Delete the message ("junk" it.)

       <b>:e</b> <u>n</u>      Set the exit code to <u>n</u>.  When processing is complete, sortmail will exit with  the  given  exit
                 code instead of zero.

       <b>:E</b> <u>n</u>      Exit immediately with exit code <u>n.</u>

       <b>:k</b>        Keep  the  message.   When downloading messages from a POP server, or when -inbox and -mbox are
                 specified, messages are normally deleted from the mailbox once transfer  is  successful.   This
                 option causes the message to be left behind.

       <b>:f</b> <u>folder</u> Append  the  message  to the given mail folder.  <u>folder</u> may be in the formats ~/<u>path</u>, /<u>abspath</u>,
                 ~<u>user/path</u>, or +<u>name</u>.  The latter form expands to  ~/<u>folder/name</u>  where  <u>folder</u>  is  the  value
                 specified for the <b>$folder</b> variable (default is "<b>folders</b>".)

       <b>:+</b><u>folder</u>  Shorthand for "<b>f</b> <b>+</b><u>folder</u>".

       <b>:d</b> <u>file</u>   Append  the  message  to  the  given  file  in digest form.  <u>file</u> may be in the formats ~/<u>path</u>,
                 /<u>abspath</u>, ~<u>user/path</u>, or +<u>name</u>.

                 "Digest" form is a stripped form where each message contains only the "From:",  "Subject:"  and
                 "Date:" headers, and messages are separated by a line of dashes.

       <b>:a</b> <u>file</u>   "Archive".  Identical to digest.

       <b>:|</b> <u>command</u>
                 Pipe the mail message through the given <u>shell-command</u>.  <a href="../man1/sh.1.html">sh</a>(1) is used.

       <b>:c</b>        Continue  processing.   Normally,  <b>sortmail</b> applies search expressions to mail messages until a
                 match is found.  At this point, the message is  dispatched  and  <b>sortmail</b>  is  finished.   This
                 command causes <b>sortmail</b> to continue comparing the message to more patterns.  This option may be
                 considered  "continue",  "Cc" or "copy" at your whim.  Thus, a message may be sent to more than
                 one destination.

</pre><h4><b>COMMANDS</b></h4><pre>
       The following is a list of commands which may be contained within a .mailrc or .sortmailrc file.

       <b>set</b> <u>variable</u> <u>=</u> <u>value</u>
             Set an environment variable.  Variables used by sortmail  are  listed  below.   Quotes  around  the
             string  are not needed.  Special characters such as '$' or '\\' may be quoted with '\\'.  Variables
             may be included within the value string in the form $<u>name</u> or ${<u>name</u>}.

             Note that the <b>set</b> command is processed immediately when the initfile is read.  Other  commands  are
             processed  as  mail  messages  are  read.   Thus,  all  <b>set</b> commands are processed before any other
             commands, regardless of their order in the init files.

       <b>listinclude</b> <u>filename</u>
             Used for mailing list administration (see below).  Ignore this command if you're not using sortmail
             to administer a mailing list.

             This command specifies a file containing a list of addresses which are permitted  to  post  to  the
             list.  Each line of the file contains one regular expression, which represents the email address of
             a list member.  Lines in the format

                  User Name &lt;address&gt;

             will  only use the <u>address</u> part of the line.  This allows the mailing list itself to be used as the
             include list.

             Multiple include lists may be specified with multiple <b>listinclude</b>  commands.   If  the  listinclude
             command  is  used,  posters  to the list must be found in at least one of the lists.  If no include
             files are specified, anybody may post.

             Messages which are rejected are handled according to the <b>$reject</b> variable,  which  must  exist  and
             which contains either a filename or a search command (see below.)

             For more on include and exclude files, see <b>MAILING</b> <b>LISTS</b>, below.

       <b>listexclude</b> <u>filename</u>
             Specify  a  list  of  addresses  which  are  not  permitted  to  post  to the list.  Same format as
             <b>listinclude</b>.  In order to post to the list, a user must be in the <b>listinclude</b> file(s) (if any)  and
             <u>not</u> in the <b>listexclude</b> file(s).

       <b>replace</b> <u>Header:</u> <u>value</u>
             Used  for  mailing  list processing.  Headers lines matching the specified header are replaced with
             the new value.  If no match is found, the line is appended to the message header.   Typically  used
             to change the "From: " header to specify the list address rather than the originator, and to set an
             "Errors-To: " header.

             If the <u>value</u> field is empty, the specified header line is deleted.

       <b>header</b> <u>Header:</u> <u>value</u>
             Same  format  as <b>replace</b>, except that header lines are always appended to the header, not replaced.
             Typically used to add comments.

       <b>bouncecheck</b> <u>dbmname</u>
             Last resort mechanism for detecting mail loops.  A crc-32 hash of the text portion of  the  message
             is  computed  and  stored  in  <u>dbmname</u>.{dir,pag}.   If  another  message with the same hash code is
             encountered in the next 60 days, the message is rejected and disposed of as described in <b>$reject</b>

             This is not a perfect mechanism, however, as broken mailers may choose to add some comments to  the
             message before bouncing it back.

       <b>includerc</b> <u>filename</u>
             Process commands from named file.  Include files may be nested.

</pre><h4><b>VARIABLES</b></h4><pre>
       Variables are used in the form $<u>name</u> or ${<u>name</u>}.  Variables may appear anywhere in the init file.

       <b>Sortmail</b>  uses  the  following  variables,  which  may  be  changed in your <b>.mailrc</b> or <b>.sortmailrc</b> files.
       Variables may also be set on the command line.

       <b>default</b>   Command(s) used to handle unclassifiable mail.  The default behavior is to  put  unclassifiable
                 mail into <u>mailbox</u>.  Another reasonable value might be "<b>+other</b>".

       <b>delay</b>     Used  to  prevent  runaway  mail  loops;  especially  useful  for  mailing list administration.
                 Specifies a delay in seconds to be imposed before mail is forwarded to another address or piped
                 through a command.  For example, a 600-second delay (ten minutes) would limit a  mail  loop  to
                 one message every ten minutes.

       <b>folder</b>    The  user's  mail  folders directory.  Mail folders are denoted by a leading '+' in their name,
                 and are stored in ~<u>user/$folder</u><a href="file:/.">/.</a>  Default is "<b>folders</b>".  Many people choose  to  set  this  to
                 "Mail" instead.

       <b>from</b>      Used  for  mailing  list  administration.  Specifies the value of the "From " line when mail is
                 forwarded to the list.  Not all versions of sendmail will honor this.  You  may  need  to  make
                 sortmail suid-uucp or add your username to the "trusted users" entry in /etc/sendmail.cf.

       <b>HOME</b>      The user's home directory.  Used to find initialization files and the user's <u>folders</u> directory.
                 Default is ~<u>user</u>.

       <b>lines</b>     Count of lines of text in the message.  Set by sortmail and updated for every message.

       <b>logfile</b>   Debugging  messages  are  sent  to  the  specified  log file.  If sortmail is executed from the
                 command line, the default is stderr.  Otherwise the default is /tmp/sortmail.log.

                 If logfile cannot be opened, stderr is used.   Note  that  when  sortmail  is  used  from  your
                 .forward  file  to  filter  incoming messages, messages sent to stderr will be sent back to the
                 sender as bounces.

       <b>mailbox</b>   The user's mail box.  Default is <b><a href="file:/var/mail/">/var/mail/</a></b><u>user</u>.

       <b>mailrc</b>    Full path of the user's <b>.mailrc</b> file.  There's no real point in changing this.

       <b>maxlines</b>  Maximum number of message lines which will be searched during  pattern  matching.   Restricting
                 this  value  can  make  searches  quicker and prevent the <a href="file:/tmp">/tmp</a> directory from filling.  Default
                 value is 5000.

       <b>reject</b>    Used for mailing list administration.  Specifies the file or command to which rejected mail  is
                 sent.

       <b>sendmail</b>  The  command  used  to  deliver  mail.   Default value is "/usr/lib/sendmail -om -oi".  If '%f'
                 occurs in the string, it will be expanded to the temporary file name  containing  the  message.
                 Otherwise, the message will be delivered to the command's standard input.

                 Special values "SMTP" and "SMTP hostname" cause the message to be delivered directly to an SMTP
                 port.

       <b>size</b>      Size of message in bytes.  Set by sortmail and updated for every message.

       <b>sortmailrc</b>
                 Full path of the user's <b>.sortmailrc</b> file.  There's no real point in changing this.

       <b>timeout</b>   Timeout in seconds for POP connections.

       <b>user</b>      The  user  on  behalf of whom <b>sortmail</b> is running.  This value must be specified on the command
                 line when sortmail is executed from a .forward file, but may be changed later.  It is  used  to
                 determine the user's home directory, among other things.

       <b>vacation</b>  If set, mail to <u>user</u> will also be piped through <a href="../man1/vacation.1.html">vacation</a>(1).

       <b>TMPDIR</b>    Directory used for temporary files.  Default is "<a href="file:/tmp">/tmp</a>".

       In  addition,  <b>sortmail</b>  defines  the following environment variables before passing a message to another
       program.

       <b>FROM</b>      The sender of the message

       <b>SUBJECT</b>   The subject line from the incoming message

</pre><h4><b>EXAMPLES</b></h4><pre>
       Here is a sample <b>.sortmailrc</b> file:

              set default=+other
              /MAILER-DAEMON/f:+bounces
              /falk/t:m
              /bldg8/t:m
              /joe/f:m:c
              /for brenda/s:k
              /scubaclub/t:+scuba
              /scuba/s:+scuba
              /marko/f:j
              /testing/t:m falk@lab
              /jym@apple/f:| /home/falk/bin/fixjim
              /^Precedence: junk/h:+other
              (/bill/f &amp;&amp; /dive/s):+scuba
              [211.114.0.0/16]r:j

       In this example, the folder directory and other variables have whatever values were specified in <b>.mailrc</b>.
       Unclassifiable mail will be sent to the folder "+other".  Mail from "MAILER-DAEMON" is sent to the folder
       "+bounces".  Mail to "falk" or "bldg8" is sent directly to my mailbox.

       Mail from my friend joe is sent directly to my mailbox, and processing  continues  in  order  to  see  if
       there's somewhere else it should go as well.

       Mail  labeled  "for  brenda" is left at the POP server untouched.  (This only works if the email is being
       downloaded from a POP server; it would be lost otherwise.)

       Mail to the scuba club or with "scuba" in the subject line is sent to the  "+scuba"  folder.   Mail  from
       marko is thrown away unread.  Mail to the "testing" alias is forwarded to my account on another machine.

       Mail  from  my  friend  jym,  who  formats his mail in a funny way is passed through a shell script which
       cleans up his messages and appends them to my mailbox.  Mail messages with  "^Precedence: junk"  anywhere
       in the header are filed in +other.

       The  next-to-last  line  shows  a feature new to sortmail version 2:  logical expressions.  In this case,
       mail from bill with the subject "dive" is added to the scuba folder.  Logical expressions  are  described
       in detail below.

       Finally,  the  last  line shows another feature new to sortmail version 2:  IP ranges.  In this case, all
       email with an IP address in the "211.114.0.0/16" range in a "Received:" line will be junked unread.

       Note that the patterns are applied in the order given; it is important, for example,  that  the  "MAILER-
       DAEMON"  pattern  precede the "falk" pattern so that mail from MAILER-DAEMON is filed in +bounces even if
       directed to me personally.  Similarly, mail from marko will not be junked if addressed to me personally.

</pre><h4><b>LOGICAL</b> <b>EXPRESSIONS</b></h4><pre>
       Logical expressions allow you to specify more complicated rules for processing mail.   For  example,  you
       could  specify  that  all mail from a certain domain with a size greater than a certain amount be deleted
       unread unless a specific keyword were to be found in the header.

       Logical expressions consist of the following operators, grouped in order of precedence:
                              ┌───────────┬───────────────────────────────────────────┐
                              │     <u>n</u>     │ integer constant                          │
                              │   $<u>var</u>    │ variable.                                 │
                              │ /<u>pattern</u>/ │ regular expression.  Evaluates as 0 or 1. │
                              ├───────────┼───────────────────────────────────────────┤
                              │     !     │ logical not                               │
                              ├───────────┼───────────────────────────────────────────┤
                              │     *     │ multiply                                  │
                              │     /     │ divide                                    │
                              ├───────────┼───────────────────────────────────────────┤
                              │     +     │ add                                       │
                              │     -     │ subtract                                  │
                              ├───────────┼───────────────────────────────────────────┤
                              │     &lt;     │ less than                                 │
                              │    &lt;=     │ less than or equal                        │
                              │     &gt;     │ greater than                              │
                              │    &gt;=     │ greater than or equal                     │
                              ├───────────┼───────────────────────────────────────────┤
                              │    ==     │ equal                                     │
                              │    !=     │ not equal                                 │
                              ├───────────┼───────────────────────────────────────────┤
                              │     &amp;     │ logical AND                               │
                              │    &amp;&amp;     │ logical AND                               │
                              ├───────────┼───────────────────────────────────────────┤
                              │     |     │ logical OR                                │
                              │    ||     │ logical OR                                │
                              ├───────────┼───────────────────────────────────────────┤
                              │     ,     │ comma                                     │
                              └───────────┴───────────────────────────────────────────┘

       Order of precedence in expression evaluation may be modified by use of parenthesis.

       \':' commands may follow any close-parenthesis or regular expression.  See examples below.

       The second form of logical AND and OR operations ("&amp;&amp;" and "||") are optimized in this way:  If the  left
       half  of an AND is false, or the left half of an OR is true, then the right hand is not evaluated.  Thus,
       you should place a simple expression (such as a subject match) to the left and a complex expression (such
       as a message body  search)  to  the  right.   If  the  simple  expression  evaluates  to  false  or  true
       respectively, the complex expression is not tested.

       The first form of logical AND and OR operations ("&amp;" and "|") always test both sides of the expression.

       The  comma  operator deserves a bit of explanation for those not familiar with the C language.  The comma
       operator evaluates the expressions on both sides and returns the expression on the right -- ignoring  the
       one  on  the  left.  Thus, the expression "3 , 4" evaluates as 4.  The comma operator is useful only when
       the expression on the left has some sort of side effect when evaluated -- i.e. it contains ':' commands.

       Here are some sample expressions:

              (/joe/f):m

       mail from joe comes directly to me.  This is the same as /joe/f:m

              (/joe/f &amp;&amp; /dive/s):+scuba

       mail from joe with "dive" in the subject line goes to the scuba folder.

              (/joe/f &amp;&amp; !/dive/s):m
              /joe/f:+scuba

       mail from joe <u>without</u> "dive" in the subject line goes directly to me.  Else, mail from joe  goes  to  the
       scuba folder.

              (/joe/f &amp;&amp; $lines &gt; 1000):j

       Looks like joe posted another long boring vacation report to the scuba list.  Junk it.

              (/earthlink/r &amp;&amp; $size &gt; 32768 &amp;&amp;
                   !(/key west/ia || /caymans/ia) ):j

       Junk  it  if  it came from or passed through earthlink (as shown by the Received: lines), <u>and</u> the size is
       greater than 32k <u>and</u> it does not contain the phrase "key west" or "caymans" anywhere in the message body.
       Case is ignored in the body search.  Note that we examine the message body last to avoid downloading  the
       message unnecessarily.

       Note also that logical expressions may be continued across multiple lines as needed.

              (1):+maillog:c

       An extremely simple expression.  (1) is always true, so all mail that reaches this expression is filed to
       the folder "maillog".  The ":c" command causes processing to continue.

       This  expression  is  a  very  good  one  to  have  at  the  top  of  your .sortmailrc when testing a new
       configuration.  All incoming mail is copied to a backup log before more complex expressions are tested.

              (/joe/f:+joemail &amp;&amp; /scuba/:+scuba)

       This example shows the use of ':' commands within an expression.  Mail from joe  goes  to  the  "joemail"
       folder.  If it also contains the subject "scuba", it goes to the scuba folder as well.

              (/joe/f:+joemail , /scuba/:+scuba)

       This  example  shows  the use of the ',' operator.  Mail from joe goes to the joemail folder.  Whether or
       not this matches, the mail is tested again to see if it  belongs  in  the  scuba  folder.   If  so,  then
       processing is finished.

              (/sex/:+sex &amp;&amp; /drugs/:+drugs &amp;&amp; /rock-n-roll/:+rock):+bacchanalia

       This  pattern does not do what it looks like it was intended to do.  That is, at first glance it looks as
       if the pattern is intended to place all messages containing "sex" in the subject into the sex folder, all
       "drugs" messages into the drugs folder, all  "rock-n-roll"  messages  into  the  rock  folder  <u>and</u>  place
       messages  into  the bacchanalia folder if they match on all three keys.  However, logical expressions are
       only evaluated as far as necessary.  If the "sex" pattern is not matched, the next two will not be tested
       at all.  A "rock-n-roll" message would be missed by this pattern.

       In this case, the '&amp;' operator should be used instead of '&amp;&amp;'.

</pre><h4><b>MAILING</b> <b>LISTS</b></h4><pre>
       Skip this section unless you're using sortmail to administer a mailing list.

       In a homogeneous environment, it is usually not necessary to use sortmail or any other mail filter.   You
       would simply create the alias in /etc/aliases and let <a href="../man8/sendmail.8.html">sendmail</a>(8) handle everything.

       However,  in  a heterogeneous environment, there can be problems.  The internet document Rfc822 specifies
       the handling of internet mail, but there are many mailers out there which do not honor Rfc822  and  cause
       trouble.  Not surprisingly, many of the major service providers are among the worst troublemakers.

       What  typically happens is that for some reason, some member of your mailing list suddenly cannot receive
       mail.  The service provider at the user's end bounces an error message back to  the  list  itself  rather
       than  to  the  original  sender  or  the  administrator.   The  error  message is then resent to the list
       subscribers -- including the the one who cannot receive mail, causing another  bounce.   This  creates  a
       loop,  sending  and  resending  bounce messages to everybody on the loop every few minutes.  Murphy's Law
       states that this will happen while you are on vacation.

       Here is how to administer a mailing list:

       First, (as root) edit /etc/aliases and add the following lines:

            scubaclub: "| /usr/yourname/sortmail -sortmailrc scubaclubrc yourname"
            scubaclub-real: :include:/usr/yourname/scubalist
            scubaclub-request: yourname
            owner-scubaclub: yourname

       The first entry indicates that mail to the scuba club goes through sortmail, using a specific  sortmailrc
       file.   The  second  entry  is  the actual scuba club alias to which sortmail will forward the mail.  The
       third entry is a standard list address which will be used by users to contact you directly;  this  should
       always  exist  for  any  mailing  list.   The final entry is used by the sendmail system to send internal
       errors back to you.

       (Most unix systems require you to run <a href="../man8/newaliases.8.html">newaliases</a>(8) after editing /etc/aliases.)

       Second, create /usr/yourname/scubalist, containing the names and addresses of everybody in the list.
            yourname  &lt;youraddress&gt;
            Joe Shmoe &lt;<a href="mailto:joe@foo.com">joe@foo.com</a>&gt;
            Jane Doe  &lt;<a href="mailto:jane@bar.com">jane@bar.com</a>&gt;
            (etc.)

       Third, create a sortmailrc file which will be used to filter incoming mail.

              # general variables

              set alias = scubaclub
              set owner = yourname
              set site = yourhost.com
              set digestDir = <a href="file:~/Maillists/Scubaclub">~/Maillists/Scubaclub</a>

              # mail that makes it through the filter gets mailed to
              # the list and archived.
              set default = m $alias-real@$site:a $digestDir/archive

              # mail that gets rejected is mailed to me
              set reject = m $owner

              # catch anything that looks like a bounce or a loop

              /Mailer-Daemon/f:m $owner
              /MAILER-DAEMON/f:m $owner
              /Postmaster/f:m $owner
              /scubaclub/f:m $owner
              /X-List-Name: scubaclub/h:m $owner
              bouncecheck $digestDir/bounceDb

              # (For some reason, we can't set Errors-To to $owner@$site,
              # because if we do, sendmail will expand $owner into an
              # invalid value before connecting to SMTP.  It would probably
              # be ok if I didn't have a personal .forward file.  By adding
              # a '\\' to the address, we avoid the problem.)

              replace Reply-To: $alias@$site
              replace Errors-To: \\$owner@$site
              header Comment: send add/delete requests to $alias-request@$site
              header X-List-Name: $alias

       In this example, the variables $alias, $owner, $site and $digestDir are not used internally by  sortmail,
       but are created for convenience and generality.

       The  search  patterns are used to detect possible mail loops, and as such, always send mail to the owner.
       Mail that makes it without matching any of the patterns is sent to the list.

       As a last resort, the mail is processed  by  the  bouncecheck  command  which  maintains  a  database  of
       previously-seen messages and will reject any message that seems to be a repeat.

       If  mail  passes  through  all the patterns unmatched, it is probably a valid message.  In this case, the
       message is processed by the commands in <b>$other</b>, which mail the message to the actual alias, and append  a
       digest version of the message to <a href="file:~/Maillists/Scubaclub/archive.">~/Maillists/Scubaclub/archive.</a>

       Finally,  the  headers of outgoing mail are modified.  The "Reply-To:" header is added so that replies to
       mail from the list are sent to the list at large, and not just to the sender  of  the  original  message.
       The "Errors-To:" header is added so that bounces will be sent to the administrator instead of to the list
       in general.  (Not all mail transfer agents honor the "Errors-To:" header.)

       The  "X-List-Name:"  header  line  serves  two  purposes.   First,  it  lets recipients know what they're
       receiving.  Secondly, it is a trick used to help detect bounces.  It is added so that it may be  searched
       for  in  incoming mail.  If an incoming message contains this header, it is likely that this is a bounce,
       and is sent to the administrator for inspection.

       If some of your list members wish to receive messages in "digest" form, you can split the list  into  two
       sections, one normal and one for the members who want digests.  Add the following line to /etc/aliases:

            scubaclub-digest: :include:/usr/yourname/scubadigest

       and change $default in /usr/yourname/scubaclubrc:

        set default = m $alias-real@foo:a $digestDir/archive:d $digestDir/digest

       Now,   incoming   messages   will   be   copied   to   <a href="file:~/Maillists/Scubaclub/digest">~/Maillists/Scubaclub/digest</a>   as   well   as   to
       <a href="file:~/Maillists/Scubaclub/archive.">~/Maillists/Scubaclub/archive.</a>  On a  nightly  basis,  execute  a  program  that  will  test  to  see  if
       <a href="file:~/Maillists/Scubaclub/digest">~/Maillists/Scubaclub/digest</a> is non-empty, and if so, mail it to scubaclub-digest@yourhost and empty it.

              #! <a href="file:/bin/sh">/bin/sh</a>
              #
              # collect the digest file, prepend some header info and transmit

              digest=/usr/yourname/Maillists/Scubaclub/digest
              alias=scubaclub
              host=yourhost.com

              if [ ! -s $digest ] ; then
                exit 0
              fi

              cat $digest | awk "
              BEGIN {
                print \"Return-Path: $alias@$host\"
                print \"Date: `date`\"
                print \"From: $alias@$host\"
                print \"To: $alias@$host\"
                print \"Subject: $alias digest\"
                print \"X-List-Name: $alias\"
                print \"\"
                print \"\"
              }
              {print}" | \
              /usr/lib/sendmail -om -oi -f$alias@$host $alias-digest

              rm $digest
              touch $digest
              chmod a+w $digest

</pre><h4><b>NOTES</b></h4><pre>
       Remember  that  sortmail  can  be executed under any userid (e.g. root, daemon or the sender of the mail)
       depending on who sent the mail, and whether or not it came from the local machine.  Because of this,  you
       cannot  depend  on  any user environment to be available, especially environment variables and path.  All
       filenames and program names should be specified as full paths, except that  "~",  "~user"  and  "+folder"
       forms are understood.  The permissions of sortmail and every directory along its path should be such that
       any user can execute it.

       If  you  pipe  incoming  mail through a program, that program should not generate any output to stdout or
       stderr whatsoever.  If it does, that output will be sent back to the originator of the  mail  as  if  the
       mail had bounced.

       Always  test your setup thoroughly, especially when administering mail lists.  Mistakes usually result in
       bounce messages being sent to the originator of mail.  This can be catastrophic with a mail  list.   When
       testing  a  mail  list,  start with a test list containing only your name and a known bad address to test
       bounce handling.  Use of a logfile and <b>-v</b> is recommended for the first few days after installing.

       The bounce detection mechanism tries to be robust, but as the saying goes, you can never  make  a  system
       that's  foolproof  because  some fools are ingenious.  No matter how thorough the detection mechanism is,
       there is a broken mailer out there somewhere that can defeat it.

       Never leave a mailing list unattended; that's when bounce loops always seem  to  start.   If  you  go  on
       vacation,  either  temporarily  shut  the  list  down,  or  designate  someone  who can turn it off in an
       emergency.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       The following exit values are returned:

       <b>0</b>    Normal exit, mail delivered successfully.

       <b>1</b>    Normal exit, but no messages waiting (-mbox and -pop options)

       <b>2</b>    User error in command line options.

       <b>3</b>    Error in .mailrc or .sortmailrc file.

       <b>4</b>    Out of memory

       <b>5</b>    Cannot determine user name

       <b>6</b>    Cannot determine user directory

       <b>7</b>    Cannot open a temporary file.  In this case, <b>sortmail</b> attempts to recover by  writing  the  incoming
            mail to the user's inbox.

       <b>8</b>    Cannot open bounce-check database (-dumpCrcs command)

       <b>9</b>    Cannot open input file (-inbox option).

</pre><h4><b>BUGS</b></h4><pre>
       If  multiple  instances  of  sortmail are executing and printing status messages to the same logfile, the
       output may become jumbled.

       The <b>maxlines</b> variable is not yet implemented.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/Mail.1.html">Mail</a>(1), <a href="../man1/procmail.1.html">procmail</a>(1), <a href="../man1/fetchmail.1.html">fetchmail</a>(1).

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 1990, 1999 by Edward A. Falk (<a href="mailto:falk@efalk.org">falk@efalk.org</a>)

       Permission is hereby granted, free of charge, to any  person  obtaining  a  copy  of  this  software  and
       associated  documentation  files (the "Software"), to deal in the Software without restriction, including
       without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,  and/or  sell
       copies  of the Software, and to permit persons to whom the Software is furnished to do so, subject to the
       following conditions:

       The above copyright notice and this permission notice shall be included  in  all  copies  or  substantial
       portions of the Software.

       THE  SOFTWARE  IS  PROVIDED  "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT
       LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO
       EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
       IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE  SOFTWARE  OR
       THE USE OR OTHER DEALINGS IN THE SOFTWARE.

       regex.[ch] is covered by the GNU copyleft.

                                                   21 Apr 1991                                       <u><a href="../man1/SORTMAIL.1.html">SORTMAIL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>