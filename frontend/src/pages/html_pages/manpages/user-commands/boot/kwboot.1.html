<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kwboot - Boot Marvell Kirkwood (and others 32-bit) SoCs over a serial link.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/u-boot-tools">u-boot-tools_2025.01-1~0ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       kwboot - Boot Marvell Kirkwood (and others 32-bit) SoCs over a serial link.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>kwboot</b> [<b>-b</b> <u>image</u>] [<b>-t</b>] [<b>-B</b> <u>baudrate</u>] <u>TTY</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>kwboot</b>  program  boots  boards based on Marvell's 32-bit platforms including Kirkwood, Dove, Avanta,
       A370, AXP, A375, A38x and A39x over their integrated UART. Boot image  files  will  typically  contain  a
       second stage boot loader, such as U-Boot. The image file must conform to Marvell's BootROM firmware image
       format (<u>kwbimage</u> <u>v0</u> or <u>v1</u>), created using a tool such as <b>mkimage</b>.

       Following  power-up  or  a  system  reset, system BootROM code polls the UART for a brief period of time,
       sensing a handshake message which initiates an image upload. This program sends this boot  message  until
       it receives a positive acknowledgement. The image is transferred using Xmodem.

       Additionally,  this  program  implements a minimal terminal mode, which can be used either standalone, or
       entered immediately following boot image transfer completion. This is often useful to  catch  early  boot
       messages, or to manually interrupt a default boot procedure performed by the second-stage loader.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-b</b> <u>image</u>
              Handshake; then upload file <u>image</u> over <u>TTY</u>.

              Note that for the encapsulated boot code to be executed, <u>image</u> must be of type "UART boot" (0x69).
              The  <b>kwboot</b>  program changes this type automatically, unless the <u>image</u> is signed, in which case it
              cannot be changed.

              This mode writes handshake status and upload progress indication to stdout. It  is  possible  that
              <u>image</u>  contains  an  optional binary code in it's header which may also print some output via UART
              (for example U-Boot SPL does this). In such a case, this output is also written  to  stdout  after
              the header is sent.

       <b>-b</b>     Do only handshake on <u>TTY</u> without uploading any file. File upload could be done later via option <b>-D</b>
              or via any other Xmodem application, like <b><a href="../man1/sx.1.html">sx</a></b>(1).

       <b>-d</b>     Do special handshake on <u>TTY</u> for console debug mode.

              This  will  instruct  BootROM to enter builtin simple console debug mode.  Should be combined with
              option <b>-t</b>.

              To get a BootROM help, type this command followed by ENTER key:

                   <b>?</b>

              Armada 38x BootROM has a bug which cause that BootROM's standard output is turned off on UART when
              default boot source location contains valid boot image. Nevertheless BootROM's standard input  and
              BootROM's  terminal echo are active and working fine. To workaround this BootROM bug with standard
              output, it is possible to manually overwrite BootROM variables stored in SRAM  which  BootROM  use
              for checking if standard output is enabled or not. To enable BootROM standard output on UART, type
              this command followed by ENTER key:

                   <b>w</b> <b>0x40034100</b> <b>1</b>

       <b>-D</b> <u>image</u>
              Upload file <u>image</u> over <u>TTY</u> without initial handshake.

              This  method  is  used primary on Dove platforms, where BootROM does not support initial handshake
              for entering UART upload mode and strapping pins (exported via e.g. buttons) are used instead.

       <b>-p</b>     Obsolete. Does nothing.

              In the past, when this option was used, the program patched the header in the image prior  upload,
              to "UART boot" type. This is now done by default.

       <b>-q</b>     Obsolete. Does nothing.

              It is unknown whether it did something in the past.

       <b>-s</b> <u>response-timeout</u>
              Specify  custom  response timeout when doing handshake. Default value is 50 ms.  It is the timeout
              between sending two consecutive handshake patterns, meaning how long to  wait  for  response  from
              BootROM. Affects only option <b>-b</b> with image file and option <b>-d</b>.

              Option <b>-a</b> specify response timeout suitable for Armada XP BootROM and currently it is 1000 ms.

              Some  testing  showed  that  specifying  24  ms as response timeout make handshake with Armada 385
              BootROM more stable.

       <b>-t</b>     Run a terminal program, connecting standard input and output to <u>TTY</u>.

              If used in combination with <b>-b</b>, <b>-D</b> or <b>-d</b> option, terminal mode is entered immediately following  a
              successful image upload or successful handshake (if not doing image upload).

              If  standard  I/O  streams  connect  to a console, this mode will terminate after receiving <b>ctrl-\</b>
              followed by <b>c</b> from console input.

       <b>-B</b> <u>baudrate</u>
              If used in combination with <b>-b</b>, inject into the image  header  code  that  changes  baud  rate  to
              <u>baudrate</u>  after  uploading  image  header, and code that changes the baud rate back to the default
              (115200 Bd) before executing payload, and also adjust the baud rate on <u>TTY</u>  correspondingly.  This
              can make the upload significantly faster.

              If used in combination with <b>-t</b>, adjust the baud rate to <u>baudrate</u> on <u>TTY</u> before starting terminal.

              If both <b>-b</b> and <b>-t</b> are used, the baud rate is changed back to 115200 after the upload.

              Tested values for <u>baudrate</u> for Armada 38x include: 115200, 230400, 460800, 500000, 576000, 921600,
              1000000, 1152000, 1500000, 2000000, 2500000, 3125000, 4000000 and 5200000.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Instruct  BootROM  to  enter  boot Xmodem boot mode, send <u>u-boot-with-spl.kwb</u> kwbimage file via Xmodem on
       <u>/dev/ttyUSB0</u> at 115200 Bd and run terminal program:

              <b>kwboot</b> <b>-b</b> <b>u-boot-with-spl.kwb</b> <b>-t</b> <b>/dev/ttyUSB0</b>

       Instruct BootROM to enter boot Xmodem boot mode, send header of  <u>u-boot-with-spl.kwb</u>  kwbimage  file  via
       Xmodem  at  115200  Bd,  then  instruct  BootROM  to change baudrate to 5200000 Bd, send data part of the
       kwbimage file via Xmodem at high speed, then change baudrate back to 115200 Bd, and finally run  terminal
       program:

              <b>kwboot</b> <b>-b</b> <b>u-boot-with-spl.kwb</b> <b>-B</b> <b>5200000</b> <b>-t</b> <b>/dev/ttyUSB0</b>

       Only send <u>u-boot-with-spl.kwb</u> kwbimage file via Xmodem on <u>/dev/ttyUSB0</u> at 115200 Bd:

              <b>kwboot</b> <b>-D</b> <b>u-boot-with-spl.kwb</b> <b>/dev/ttyUSB0</b>

       Instruct BootROM to enter console debug mode and run terminal program on <u>/dev/ttyUSB0</u> at 115200 Bd:

              <b>kwboot</b> <b>-d</b> <b>-t</b> <b>/dev/ttyUSB0</b>

       Only run terminal program on <u>/dev/ttyUSB0</u> at 115200 Bd:

              <b>kwboot</b> <b>-t</b> <b>/dev/ttyUSB0</b>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/mkimage.1.html">mkimage</a></b>(1), <b><a href="../man1/sx.1.html">sx</a></b>(1)

</pre><h4><b>AUTHORS</b></h4><pre>
       Daniel Stodden &lt;<a href="mailto:daniel.stodden@gmail.com">daniel.stodden@gmail.com</a>&gt;
       Luka Perkov &lt;<a href="mailto:luka@openwrt.org">luka@openwrt.org</a>&gt;
       David Purdy &lt;<a href="mailto:david.c.purdy@gmail.com">david.c.purdy@gmail.com</a>&gt;
       Pali Rohár &lt;<a href="mailto:pali@kernel.org">pali@kernel.org</a>&gt;
       Marek Behún &lt;<a href="mailto:kabel@kernel.org">kabel@kernel.org</a>&gt;

                                                   2022-03-02                                          <u><a href="../man1/KWBOOT.1.html">KWBOOT</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>