<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pg_upgradecluster - upgrade an existing PostgreSQL cluster to a new major version.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/postgresql-common">postgresql-common_274_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pg_upgradecluster - upgrade an existing PostgreSQL cluster to a new major version.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pg_upgradecluster</b> [<b>-v</b> <u>newversion</u>] <u>oldversion</u> <u>name</u> [<u>newdatadir</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pg_upgradecluster</b> upgrades an existing PostgreSQL server cluster (i. e. a collection of databases served
       by a <b>postgres</b> instance) to a new version specified by <u>newversion</u> (default: latest available version).
       The configuration files of the old version are copied to the new cluster and adjusted for the new
       version.

       By default, <b><a href="../man1/pg_dump.1.html">pg_dump</a></b>(1) is used to migrate data and indexes to the new cluster. This is slow, but safe.
       Upgrade variants based on <b><a href="../man1/pg_upgrade.1.html">pg_upgrade</a></b>(1) can be selected using the <b>--method=upgrade</b> parameter. This is
       faster, but care must be taken when using it in the context of an operating system upgrade. The sorting
       order ("collation") used in indexes is determined by <b>libc</b> and <b>libicu</b>, and new versions of these libraries
       might have a differ ordering, <b>requiring</b> <b>index</b> <b>rebuilds</b> <b>after</b> <b>the</b> <b>upgrade</b>, or acknowledging that the
       ordering did not change using the <b>ALTER</b> <b>COLLATION</b> <b>REFRESH</b> <b>VERSION</b> command.  This step is not automated by
       <b>pg_upgradecluster</b>.

       The cluster of the old version will be configured to use a previously unused port since the upgraded one
       will use the original port. The old cluster is not automatically removed. After upgrading, please verify
       that the new cluster indeed works as expected; if so, you should remove the old cluster with
       <b><a href="../man8/pg_dropcluster.8.html">pg_dropcluster</a></b>(8). Please note that the old cluster is set to "manual" startup mode, in order to avoid
       inadvertently changing it; this means that it will not be started automatically on system boot, and you
       have to use <b><a href="../man8/pg_ctlcluster.8.html">pg_ctlcluster</a></b>(8) to start/stop it. See section "STARTUP CONTROL" in <b><a href="../man8/pg_createcluster.8.html">pg_createcluster</a></b>(8) for
       details.

       The <u>newdatadir</u> argument can be used to specify a non-default data directory of the upgraded cluster. It
       is passed to <b>pg_createcluster</b>. If not specified, this defaults to /var/lib/postgresql/<u>newversion</u>/<u>name</u>.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-v</b> <u>newversion</u>
           Set the version to upgrade to (default: latest available).

       <b>--check</b>
           Check if all packages required for the upgrade are installed.

       <b>--force-packages</b>
           Proceed  with  upgrading even when not all packages from the old PostgreSQL version are installed for
           the new version as well.

       <b>--logfile</b> <u>filel</u>
           Set a custom log file path for the upgraded database cluster.

       <b>--locale=</b><u>locale</u>
           Set the default locale for the upgraded database cluster. If this option is not specified, the locale
           is inherited from the old cluster.

           When upgrading to PostgreSQL 11 or newer, this option no longer  allows  switching  the  encoding  of
           individual databases. (<b><a href="../man1/pg_dumpall.1.html">pg_dumpall</a></b>(1) was changed to retain database encodings.)

       <b>--lc-collate=</b><u>locale</u>
       <b>--lc-ctype=</b><u>locale</u>
       <b>--lc-messages=</b><u>locale</u>
       <b>--lc-monetary=</b><u>locale</u>
       <b>--lc-numeric=</b><u>locale</u>
       <b>--lc-time=</b><u>locale</u>
           Like <b>--locale</b>, but only sets the locale in the specified category.

       <b>-m</b>, <b>--method=dump</b>|<b>upgrade</b>|<b>link</b>|<b>clone</b>
           Specify the upgrade method.  <b>dump</b> uses <b><a href="../man1/pg_dump.1.html">pg_dump</a></b>(1) and <b><a href="../man1/pg_restore.1.html">pg_restore</a></b>(1), <b>upgrade</b> uses <b><a href="../man1/pg_upgrade.1.html">pg_upgrade</a></b>(1).  The
           default is <b>dump</b>.

           <b>link</b> and <b>clone</b> are shorthands for <b>-m</b> <b>upgrade</b> <b>--link</b> and <b>-m</b> <b>upgrade</b> <b>--clone</b>, respectively.

       <b>-k</b>, <b>--link</b>
           In  pg_upgrade  mode,  use  hard  links  instead of copying files to the new cluster.  This option is
           merely passed on to pg_upgrade.  See <b><a href="../man1/pg_upgrade.1.html">pg_upgrade</a></b>(1) for details.

       <b>--clone</b>
           In pg_upgrade mode, use efficient file cloning (also known as "reflinks" on some systems) instead  of
           copying  files  to the new cluster. This option is merely passed on to pg_upgrade.  See <b><a href="../man1/pg_upgrade.1.html">pg_upgrade</a></b>(1)
           for details.

       <b>--data-checksums</b>, <b>--no-data-checksums</b>
           By default, the new cluster is set up to use data page checksums if  the  old  cluster  already  uses
           them.  Additionally, when using the <b>dump</b> upgrade method, the new cluster will use data page checksums
           when upgrading to PostgreSQL 18 or later (which enables data page checksums by default).

           The  <b>--method=dump</b>   behavior   can   explictly   be   controlled   by   the   <b>--data-checksums</b>   and
           <b>--no-data-checksums</b> options.

       <b>-j</b>, <b>--jobs</b>
           In  pg_upgrade mode, number of simultaneous processes to use. This option is passed on to pg_upgrade.
           See <b><a href="../man1/pg_upgrade.1.html">pg_upgrade</a></b>(1) for details.  It is  also  used  by  the  <b>analyze</b>  upgrade  hook  (via  the  <b>PGJOBS</b>
           environment variable).

       <b>--keep-port</b>
           By default, the old cluster is moved to a new port, and the new cluster is moved to the original port
           so clients will see the upgraded cluster. This option disables that.

       <b>--rename=</b><u>new</u> <u>cluster</u> <u>name</u>
           Use a different name for the upgraded cluster.

       <b>--old-bindir=</b><u>directory</u>
           Passed to <b>pg_upgrade</b>.

       <b>--maintenance-db=</b><u>database</u>
           Database to connect to for maintenance queries.  The default is <b>template1</b>.

       <b>--[no-]start</b>
           Start  the  new  database cluster after upgrading. The default is to start the new cluster if the old
           cluster was running, or if upgrade hook scripts are present.

       <b>--keep-on-error</b>
           If upgrading fails, the newly created cluster is removed. This option disables that.

</pre><h4><b>HOOK</b> <b>SCRIPTS</b></h4><pre>
       Some PostgreSQL extensions like PostGIS need metadata in auxiliary tables which must not be upgraded from
       the old version, but rather initialized for the new version before  copying  the  table  data.  For  this
       purpose,  extensions  (as  well  as  administrators,  of  course)  can  drop  upgrade  hook  scripts into
       /etc/postgresql-common/pg_upgradecluster.d/. Script file names must consist entirely of upper  and  lower
       case  letters,  digits,  underscores,  and  hyphens;  in particular, dots (i. e. file extensions) are not
       allowed.

       Scripts in that directory will be called with the following arguments:

       &lt;old version&gt; &lt;cluster name&gt; &lt;new version&gt; &lt;phase&gt;

       Phases:

       <b>init</b>
           A virgin cluster of version <u>new</u> <u>version</u> has been created, i. e.  this new cluster will  already  have
           <b>template1</b>  and <b>postgres</b>, but no user databases. Please note that you should not create tables in this
           phase, since they will be overwritten by the dump/restore or <b>pg_upgrade</b> operation.

       <b>finish</b>
           All data from the old version cluster has been dumped/reloaded into the  new  one.  The  old  cluster
           still exists, but is not running.

       Failing scripts will abort the upgrade.  The scripts are called as the user who owns the database.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/pg_createcluster.8.html">pg_createcluster</a></b>(8), <b><a href="../man8/pg_dropcluster.8.html">pg_dropcluster</a></b>(8), <b><a href="../man1/pg_lsclusters.1.html">pg_lsclusters</a></b>(1), <b><a href="../man1/pg_wrapper.1.html">pg_wrapper</a></b>(1), <b><a href="../man1/pg_dump.1.html">pg_dump</a></b>(1), <b><a href="../man1/pg_upgrade.1.html">pg_upgrade</a></b>(1)

</pre><h4><b>AUTHORS</b></h4><pre>
       Martin Pitt &lt;<a href="mailto:mpitt@debian.org">mpitt@debian.org</a>&gt;, Christoph Berg &lt;<a href="mailto:myon@debian.org">myon@debian.org</a>&gt;

Debian                                             2025-02-20                               <u><a href="../man1/PG_UPGRADECLUSTER.1.html">PG_UPGRADECLUSTER</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>