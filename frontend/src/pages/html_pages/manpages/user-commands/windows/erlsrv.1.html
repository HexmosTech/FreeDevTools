<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>erlsrv - Run the Erlang emulator as a service on Windows</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/erlang-doc">erlang-doc_27.3+dfsg-1ubuntu1.2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       erlsrv - Run the Erlang emulator as a service on Windows

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  utility  is  specific  to  Windows  NT/2000/XP  (and  later  versions of Windows). It allows Erlang
       emulators to run as services on the Windows system, allowing embedded systems to start without  any  user
       needing  to  log  on.  The  emulator  started in this way can be manipulated through the Windows services
       applet in a manner similar to other services.

       Note that <u>erlsrv</u> is not a general service utility for Windows, but designed for embedded Erlang systems.

       <u>erlsrv</u> also provides a command-line interface for registering, changing, starting, and stopping services.

       To manipulate services, the logged on user is to have administrator privileges on the machine. The Erlang
       machine itself is (default) run as the local administrator. This can be changed with the Services  applet
       in Windows.

       The  processes  created  by  the  service  can,  as opposed to normal services, be "killed" with the task
       manager. Killing an emulator that is started by a service triggers the "OnFail" action specified for that
       service, which can be a reboot.

       The following parameters can be specified for each Erlang service:

       StopAction
         Tells <u>erlsrv</u> how to stop the Erlang emulator. Default is to kill it (Win32 TerminateProcess), but  this
         action  can specify any Erlang shell command that will be executed in the emulator to make it stop. The
         emulator is expected to stop within 30 seconds after the  command  is  issued  in  the  shell.  If  the
         emulator is not stopped, it reports a running state to the service manager.

       OnFail
         Can be one of the following:

         reboot
           The Windows system is rebooted whenever the emulator stops (a more simple form of watchdog). This can
           be useful for less critical systems, otherwise use the heart functionality to accomplish this.

         restart
           Makes  the  Erlang  emulator be restarted (with whatever parameters are registered for the service at
           the occasion) when it stops. If the emulator stops again within 10 seconds, it is  not  restarted  to
           avoid an infinite loop, which could hang the Windows system.

         restart_always
           Similar  to  <u>restart</u>,  but  does  not  try  to detect cyclic restarts; it is expected that some other
           mechanism is present to avoid the problem.

         ignore (the default)
           Reports the service as stopped to the  service  manager  whenever  it  fails;  it  must  be  manually
           restarted.

         On  a  system  where release handling is used, this is always to be set to <u>ignore</u>. Use <u>heart</u> to restart
         the service on failure instead.

       Machine
         The location of the Erlang emulator. The default is the  <u>erl.exe</u>  located  in  the  same  directory  as
         <u>erlsrv.exe</u>.

         If the system uses release handling, this is to be set to a program similar to <u>start_erl.exe</u>.

       Env
         Specifies  an <u>extra</u> environment for the emulator. The environment variables specified here are added to
         the system-wide environment block that is normally present when a service starts up. Variables  present
         in  both  the  system-wide  environment and in the service environment specification will be set to the
         value specified in the service.

       WorkDir
         The working directory for the Erlang emulator. Must be on a local drive (no network drives are  mounted
         when  a service starts). Default working directory for services is <u>%SystemDrive%%SystemPath%</u>. Debug log
         files will be placed in this directory.

       Priority
         The process priority of the emulator. Can be one of the following:

         realtime
           Not recommended, as the machine will possibly be inaccessible to interactive users.

         high
           Can be used if two Erlang nodes are to reside on one dedicated system and one is to  have  precedence
           over the other.

         low
           Can be used if interactive performance is not to be affected by the emulator process.

         default
           The default priority.

       SName or Name
         Specifies  the  short  or  long  node  name  of  the  Erlang  emulator.  The Erlang services are always
         distributed. Default is to use the service name as (short) nodename.

       DebugType
         Specifies that output from the Erlang shell is to be sent to a "debug  log".  The  log  file  is  named
         &lt;servicename&gt;  <u>.debug</u>  or  &lt;servicename&gt;<u>.debug.</u>&lt;N&gt;,  where &lt;N&gt; is an integer from 1 through 99. The log
         file is placed in the working directory of the service (as specified in <u>WorkDir</u>).

         Can be one of the following:

         new
           Uses a separate log file for every invocation of the service (&lt;servicename&gt; <u>.debug.</u>&lt;N&gt;).

         reuse
           Reuses the same log file (&lt;servicename&gt; <u>.debug</u>).

         console
           Opens an interactive Windows console window for  the  Erlang  shell  of  the  service.  Automatically
           disables  the  <u>StopAction</u>.  A  service  started  with  an interactive console window does not survive
           logouts. <u>OnFail</u> actions do not work with debug consoles either.

         none (the default)
           The output of the Erlang shell is discarded.

         <b>NOTE:</b> The <u>console</u> option is <u>not</u> intended for production. It is <u>only</u> a convenient way  to  debug  Erlang
         services  during  development.  The <u>new</u> and <u>reuse</u> options might seem convenient in a production system,
         but consider that the logs grow indefinitely during the system lifetime and cannot be truncated, except
         if the service is restarted. In short, the <u>DebugType</u>  is  intended  for  debugging  only.  Logs  during
         production are better produced with the standard Erlang logging facilities.

       Args
         Passes  extra  arguments  to  the  emulator  startup program <u>erl.exe</u> (or <u>start_erl.exe</u>). Arguments that
         cannot be specified here are <u>-noinput</u> (<u>StopActions</u>  would  not  work),  <u>-name</u>,  and  <u>-sname</u>  (they  are
         specified  in  any  way).  The most common use is for specifying cookies and flags to be passed to <u>init</u>
         (<u>-s</u>).

       InternalServiceName
         Specifies the Windows-internal service name (not the display name, which is  the  one  <u>erlsrv</u>  uses  to
         identify the service).

         This  internal  name  cannot be changed, it is fixed even if the service is renamed. <u>erlsrv</u> generates a
         unique internal name when a service is created. It is recommended to keep to  the  default  if  release
         handling is to be used for the application.

         The  internal  service  name  can  be  seen in the Windows service manager if viewing <u>Properties</u> for an
         Erlang service.

       Comment
         A textual comment describing the service. Not mandatory, but shows up as the service description in the
         Windows service manager.

       The naming  of  the  service  in  a  system  that  uses  release  handling  must  follow  the  convention
       <u>NodeName_Release</u>,  where <u>NodeName</u> is the first part of the Erlang node name (up to, but not including the
       "@") and <u>Release</u> is the current release of the application.

   <b>erlsrv</b> <b>{set</b> <b>|</b> <b>add}</b> <b>&lt;service-name&gt;</b> <b>[&lt;service</b> <b>options&gt;]</b>
       The <u>set</u> and <u>add</u> commands modifies or adds an Erlang service, respectively. The simplest form  of  an  <u>add</u>
       command is without any options in which case all default values (described above) apply. The service name
       is mandatory.

       Every  option  can  be  specified  without  parameters,  the default value is then applied. Values to the
       options are supplied <u>only</u> when the default is not to be used. For example,  <u>erlsrv</u>  <u>set</u>  <u>myservice</u>  <u>-prio</u>
       <u>-arg</u> sets the default priority and removes all arguments.

       Service options:

       -st[opaction] [&lt;erlang shell command&gt;]
         Defines  the  <u>StopAction</u>, the command given to the Erlang shell when the service is stopped. Default is
         none.

       -on[fail] [{reboot | restart | restart_always}]
         The action to take when the Erlang emulator stops unexpectedly. Default is to ignore.

       -m[achine] [&lt;erl-command&gt;]
         The complete path to the Erlang emulator. Never use the <u>werl</u> program for this. Defaults to the  <u>erl.exe</u>
         in  the  same  directory  as  <u>erlsrv.exe</u>. When release handling is used, this is to be set to a program
         similar to <u>start_erl.exe</u>.

       -e[nv] [&lt;variable&gt;[=&lt;value&gt;]] ...
         Edits the environment block for the service. Every environment  variable  specified  is  added  to  the
         system  environment  block. If a variable specified here has the same name as a system-wide environment
         variable, the specified value overrides the system-wide. Environment variables are added to  this  list
         by  specifying  &lt;variable&gt;=&lt;value&gt;  and  deleted  from  the  list  by  specifying &lt;variable&gt; alone. The
         environment block is automatically sorted. Any number of <u>-env</u> options can be specified in one  command.
         Default  is  to  use  the  system  environment  block unmodified (except for two additions, see section
         Environment below).

       -w[orkdir] [&lt;directory&gt;]
         The initial working directory of the Erlang emulator. Defaults to the system directory.

       -p[riority] [{low|high|realtime}]
         The priority of the Erlang emulator. Default to the Windows default priority.

       {-sn[ame] | -n[ame]} [&lt;node-name&gt;]
         The node name of the Erlang machine. Distribution is mandatory. Defaults to <u>-sname</u> <u>&lt;service</u> <u>name&gt;</u>.

       -d[ebugtype] [{new|reuse|console}]
         Specifies where shell output is to be sent. Default is that shell output is discarded. To be used  only
         for debugging.

       -ar[gs] [&lt;limited erl arguments&gt;]
         Extra arguments to the Erlang emulator. Avoid <u>-noinput</u>, <u>-noshell</u>, and <u>-sname</u>/<u>-name</u>. Default is no extra
         arguments. Remember that the services cookie file is not necessarily the same as the interactive users.
         The  service  runs as the local administrator. Specify all arguments together in one string, use double
         quotes (") to specify an argument string containing spaces, and use quoted quotes  (\")  to  specify  a
         quote within the argument string if necessary.

       -i[nternalservicename] [&lt;internal name&gt;]

         <u>Only</u>  allowed  for  <u>add</u>. Specifies a Windows-internal service name for the service, which by default is
         set to something unique (prefixed with the original service name) by <u>erlsrv</u> when adding a new  service.
         Specifying  this  is  a  purely  cosmethic  action  and is <u>not</u> recommended if release handling is to be
         performed. The internal service name cannot be changed once the service is created. The  internal  name
         is  <u>not</u>  to be confused with the ordinary service name, which is the name used to identify a service to
         <u>erlsrv</u>.

       -c[omment] [&lt;short description&gt;]
         Specifies a textual comment describing the service. This comment shows up as the service description in
         the Windows service manager.

   <b>erlsrv</b> <b>{start</b> <b>|</b> <b>start_disabled</b> <b>|</b> <b>stop</b> <b>|</b> <b>disable</b> <b>|</b> <b>enable}</b> <b>&lt;service-name&gt;</b>
       These commands are only added for convenience, the normal way to manipulate the state  of  a  service  is
       through the control panels services applet.

       The  <u>start</u>  and  <u>stop</u> commands communicates with the service manager for starting and stopping a service.
       The commands wait until the service is started or stopped. When disabling a service, it is  not  stopped,
       the  disabled  state  does  not  take  effect until the service is stopped. Enabling a service sets it in
       automatic mode, which is started at boot. This command cannot set the service to manual.

       The  <u>start_disabled</u>  command  operates  on  a  service  regardless  of  if  it  is  enabled/disabled   or
       started/stopped. It does this by first enabling it (regardless of if it is enabled or not), then starting
       it  (if  not  already  started),  and  then  disabling  it. The result is a disabled but started service,
       regardless of its earlier state. This is useful  for  starting  services  temporarily  during  a  release
       upgrade.  The difference between using <u>start_disabled</u> and the sequence <u>enable</u>, <u>start</u>, and <u>disable</u> is that
       all other <u>erlsrv</u> commands are locked out during the sequence of operations in <u>start_disable</u>,  making  the
       operation atomic from an <u>erlsrv</u> user's point of view.

   <b>erlsrv</b> <b>remove</b> <b>&lt;service-name&gt;</b>
       Removes the service completely with all its registered options. It is stopped before it is removed.

   <b>erlsrv</b> <b>list</b> <b>[&lt;service-name&gt;]</b>
       If  no  service name is specified, a brief listing of all Erlang services is presented. If a service name
       is supplied, all options for that service are presented.

   <b>erlsrv</b> <b>help</b>
       Displays a brief help text.

   <b>Environment</b>
       The environment of an Erlang machine started as a service contains two special variables:

       ERLSRV_SERVICE_NAME
         The name of the service that started the machine.

       ERLSRV_EXECUTABLE
         The full path to the <u>erlsrv.exe</u>, which can be used to manipulate the service. This comes in handy  when
         defining a heart command for your service.

       A command file for restarting a service looks as follows:

              @echo off
              %ERLSRV_EXECUTABLE% stop %ERLSRV_SERVICE_NAME%
              %ERLSRV_EXECUTABLE% start %ERLSRV_SERVICE_NAME%

       This command file is then set as heart command.

       The  environment  variables  can  also  be  used to detect that we are running as a service and make port
       programs react correctly to the control events generated on logout (see the next section).

   <b>Port</b> <b>Programs</b>
       When a program runs in the service context, it must handle the control events  that  are  sent  to  every
       program  in  the  system  when the interactive user logs off. This is done in different ways for programs
       running in the console subsystem and programs running as window applications. An application  running  in
       the  console  subsystem  (normal  for  port  programs)  uses  the win32 function <u>SetConsoleCtrlHandler</u> to
       register a control handler that returns <u>true</u> in answer to the <u>CTRL_LOGOFF_EVENT</u>  and  <u>CTRL_SHUTDOWN_EVENT</u>
       events.  Other  applications  only  forward  <u>WM_ENDSESSION</u>  and  <u>WM_QUERYENDSESSION</u> to the default window
       procedure.

       A brief example in C of how to set the console control handler:

              #include &lt;windows.h&gt;
              /*
              ** A Console control handler that ignores the log off events,
              ** and lets the default handler take care of other events.
              */
              BOOL WINAPI service_aware_handler(DWORD ctrl){
                  if(ctrl == CTRL_LOGOFF_EVENT)
                      return TRUE;
                  if(ctrl == CTRL_SHUTDOWN_EVENT)
                      return TRUE;
                  return FALSE;
              }

              void initialize_handler(void){
                  char buffer[2];
                  /*
                   * We assume we are running as a service if this
                   * environment variable is defined.
                   */
                  if(GetEnvironmentVariable("ERLSRV_SERVICE_NAME",buffer,
                                            (DWORD) 2)){
                      /*
                      ** Actually set the control handler
                      */
                      SetConsoleCtrlHandler(&amp;service_aware_handler, TRUE);
                  }
              }

   <b>Notes</b>
       Although the options are described in a Unix-like format, the case of the  options  or  commands  is  not
       relevant, and both character "/" and "-" can be used for options.

       Note  that  the  program resides in the emulator's <u>bin</u> directory, not in the <u>bin</u> directory directly under
       the Erlang root. The reasons for this are the subtle problem of  upgrading  the  emulator  on  a  running
       system,  where  a  new  version of the runtime system should not need to overwrite existing (and probably
       used) executables.

       To manipulate the Erlang services easily, put the <u>&lt;erlang_root&gt;\erts-&lt;version&gt;\bin</u> directory in the  path
       instead  of  <u>&lt;erlang_root&gt;\bin</u>.  The  <u>erlsrv</u>  program  can  be  found  from  inside  Erlang  by using the
       <u>os:find_executable/1</u> Erlang function.

       For release handling to work, use <u>start_erl</u> as the Erlang machine. As stated above, the service  name  is
       significant.

   <b>See</b> <b>Also</b>
       <u><a href="../man1/start_erl.1.html">start_erl</a>(1)</u>, <u>release_handler</u>

Ericsson AB                                        erts 15.2.3                                         <u><a href="../man1/erlsrv.1.html">erlsrv</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>