<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fsverity - userspace utility for fs-verity</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/fsverity">fsverity_1.6-1.2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       fsverity - userspace utility for fs-verity

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>fsverity</b> <b>digest</b> [<u>OPTION</u>...]  <u>FILE</u>...
       <b>fsverity</b> <b>dump_metadata</b> [<u>OPTION</u>...]  <u>TYPE</u> <u>FILE</u>
       <b>fsverity</b> <b>enable</b> [<u>OPTION</u>...]  <u>FILE</u>
       <b>fsverity</b> <b>measure</b> <u>FILE</u>...
       <b>fsverity</b> <b>sign</b> [<u>OPTION</u>...]  <u>FILE</u> <u>OUT_SIGFILE</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>fsverity</b>  is a userspace utility for fs-verity.  fs-verity is a Linux kernel filesystem feature that does
       transparent on-demand verification of the contents of read-only files using Merkle trees.

       <b>fsverity</b> can enable fs-verity on files, retrieve the digests of fs-verity files, and sign files  for  use
       with fs-verity (among other things).  <b>fsverity</b>’s functionality is divided among various subcommands.

       This  manual page focuses on documenting all <b>fsverity</b> subcommands and options.  For examples and more in‐
       formation about the fs-verity kernel feature, see the references at the end of this page.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>fsverity</b> always accepts the following options:

       <b>--help</b> Show the help, for either one subcommand or for all subcommands.

       <b>--version</b>
              Show the version of fsverity-utils.

</pre><h4><b>SUBCOMMANDS</b></h4><pre>
   <b>fsverity</b> <b>digest</b> [<u><b>OPTION</b></u>...] <u><b>FILE</b></u>...
       Compute the fs-verity digest of the given file(s).  This is mainly intended to used  in  preparation  for
       signing  the  digest.  In some cases <b>fsverity</b> <b>sign</b> can be used instead to digest and sign the file in one
       step.

       Options accepted by <b>fsverity</b> <b>digest</b>:

       <b>--block-size</b>=<u>BLOCK_SIZE</u>
              The Merkle tree block size (in bytes) to use.  This must be a power of 2 and at  least  twice  the
              size of the hash values.

              Note  that  the Linux kernel implementations of fs-verity place further restrictions on the Merkle
              tree block size.  Linux v6.2 and earlier require that the Merkle tree block size be equal to  both
              the  system page size and the filesystem block size.  These values are often 4096.  Linux v6.3 and
              later are more flexible; they require that the Merkle tree block size be a  power  of  2  that  is
              greater  than  or  equal to 1024 and less than or equal to the system page size and the filesystem
              block size.  The default value of this option is 4096.

       <b>--compact</b>
              When printing the file digest, only print the actual digest hex string; don’t print the  algorithm
              name and filename.

       <b>--for-builtin-sig</b>
              Format the file digest in a way that is compatible with the Linux kernel’s fs-verity built-in sig‐
              nature verification support.  This means formatting it as a <b>struct</b> <b>fsverity_formatted_digest</b>.  Use
              this  option  if you are using built-in signatures but are not using <b>fsverity</b> <b>sign</b> to do the sign‐
              ing.

       <b>--hash-alg</b>=<u>HASH_ALG</u>
              The hash algorithm to use to build the Merkle tree.  Valid options are sha256 and sha512.  Default
              is sha256.

       <b>--out-merkle-tree</b>=<u>FILE</u>
              Write the computed Merkle tree to the given file.  The Merkle tree layout will be the same as that
              used by the Linux kernel’s <b>FS_IOC_READ_VERITY_METADATA</b> ioctl.

              Normally this option isn’t useful, but it can be needed in  cases  where  the  fs-verity  metadata
              needs to be consumed by something other than one of the native Linux kernel implementations of fs-
              verity.  This is not needed for file signing.

       <b>--out-descriptor</b>=<u>FILE</u>
              Write the computed fs-verity descriptor to the given file.

              Normally  this  option  isn’t  useful,  but it can be needed in cases where the fs-verity metadata
              needs to be consumed by something other than one of the native Linux kernel implementations of fs-
              verity.  This is not needed for file signing.

       <b>--salt</b>=<u>SALT</u>
              The salt to use in the Merkle tree, as a hex string.  The salt is a value  that  is  prepended  to
              every  hashed  block;  it  can be used to personalize the hashing for a particular file or device.
              The default is no salt.

   <b>fsverity</b> <b>dump_metadata</b> [<u><b>OPTION</b></u>...] <u><b>TYPE</b></u> <u><b>FILE</b></u>
       Dump the fs-verity metadata of the given file.  The file must have fs-verity enabled, and the  filesystem
       must  support  the <b>FS_IOC_READ_VERITY_METADATA</b> ioctl (it was added in Linux v5.12).  This subcommand nor‐
       mally isn’t useful, but it can be useful in cases where a userspace server program is  serving  a  verity
       file to a client which implements fs-verity compatible verification.

       <u>TYPE</u>  may be “merkle_tree”, “descriptor”, or “signature”, indicating the type of metadata to dump.  “sig‐
       nature” refers to the built-in signature, if present; userspace-managed signatures will not be included.

       Options accepted by <b>fsverity</b> <b>dump_metadata</b>:

       <b>--length</b>=<u>LENGTH</u>
              Length in bytes to dump from the specified metadata  item.   Only  accepted  in  combination  with
              <b>--offset</b>.

       <b>--offset</b>=<u>offset</u>
              Offset in bytes into the specified metadata item at which to start dumping.  Only accepted in com‐
              bination with <b>--length</b>.

   <b>fsverity</b> <b>enable</b> [<u><b>OPTION</b></u>...] <u><b>FILE</b></u>
       Enable fs-verity on the specified file.  This will only work if the filesystem supports fs-verity.

       Options accepted by <b>fsverity</b> <b>enable</b>:

       <b>--block-size</b>=<u>BLOCK_SIZE</u>
              Same as for <b>fsverity</b> <b>digest</b>.

       <b>--hash-alg</b>=<u>HASH_ALG</u>
              Same as for <b>fsverity</b> <b>digest</b>.

       <b>--salt</b>=<u>SALT</u>
              Same as for <b>fsverity</b> <b>digest</b>.

       <b>--signature</b>=<u>SIGFILE</u>
              Specifies  the  built-in signature to apply to the file.  <u>SIGFILE</u> must be a file that contains the
              signature in PKCS#7 DER format, e.g. as produced by the <b>fsverity</b> <b>sign</b> command.

              Note that this option is only needed if the Linux kernel’s fs-verity built-in signature  verifica‐
              tion  support is being used.  It is not needed if the signatures will be verified in userspace, as
              in that case the signatures should be stored separately.

   <b>fsverity</b> <b>measure</b> <u><b>FILE</b></u>...
       Display the fs-verity digest of the given file(s).  The files must have fs-verity  enabled.   The  output
       will  be the same as <b>fsverity</b> <b>digest</b> with the appropriate parameters, but <b>fsverity</b> <b>measure</b> will take con‐
       stant time for each file regardless of the size of the file.

       <b>fsverity</b> <b>measure</b> does not accept any options.

   <b>fsverity</b> <b>sign</b> [<u><b>OPTION</b></u>...] <u><b>FILE</b></u> <u><b>OUT_SIGFILE</b></u>
       Sign the given file for fs-verity, in a way that is compatible with the Linux kernel’s fs-verity built-in
       signature verification support.  The signature will be written to <u>OUT_SIGFILE</u> in PKCS#7 DER format.

       The private key can be specified either by key file or by PKCS#11 token.  To  use  a  key  file,  provide
       <b>--key</b>  and  optionally <b>--cert</b>.  To use a PKCS#11 token, provide <b>--pkcs11-engine</b>, <b>--pkcs11-module</b>, <b>--cert</b>,
       and optionally <b>--pkcs11-keyid</b>.  PKCS#11 token support is unavailable when fsverity-utils was  built  with
       BoringSSL rather than OpenSSL.

       <b>fsverity</b>  <b>sign</b>  should  only be used if you need compatibility with fs-verity built-in signatures.  It is
       not the only way to do signatures with fs-verity.  For more information, see the fsverity-utils README.

       Options accepted by <b>fsverity</b> <b>sign</b>:

       <b>--block-size</b>=<u>BLOCK_SIZE</u>
              Same as for <b>fsverity</b> <b>digest</b>.

       <b>--cert</b>=<u>CERTFILE</u>
              Specifies the file that contains the certificate, in PEM format.  This option is required if  <u>KEY‐</u>
              <u>FILE</u> contains only the private key and not also the certificate, or if a PKCS#11 token is used.

       <b>--hash-alg</b>=<u>HASH_ALG</u>
              Same as for <b>fsverity</b> <b>digest</b>.

       <b>--key</b>=<u>KEYFILE</u>
              Specifies the file that contains the private key, in PEM format.  This option is required when not
              using a PKCS#11 token.

       <b>--out-descriptor</b>=<u>FILE</u>
              Same as for <b>fsverity</b> <b>digest</b>.

       <b>--out-merkle-tree</b>=<u>FILE</u>
              Same as for <b>fsverity</b> <b>digest</b>.

       <b>--pkcs11-engine</b>=<u>SOFILE</u>
              Specifies  the  path  to  the  OpenSSL  PKCS#11 engine file.  This typically will be a path to the
              libp11 .so file.  This option is required when using a PKCS#11 token.

       <b>--pkcs11-keyid</b>=<u>KEYID</u>
              Specifies the key identifier in the form of a PKCS#11 URI.  If not provided, the default key asso‐
              ciated with the token is used.  This option is only applicable when using a PKCS#11 token.

       <b>--pkcs11-module</b>=<u>SOFILE</u>
              Specifies the path to the PKCS#11 token-specific module library.  This option is required when us‐
              ing a PKCS#11 token.

       <b>--salt</b>=<u>SALT</u>
              Same as for <b>fsverity</b> <b>digest</b>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       For example commands and more information, see  the  README  file  for  fsverity-utils  (https://git.ker‐
       nel.org/pub/scm/fs/fsverity/fsverity-utils.git/tree/README.md).

       Also   see   the  kernel  documentation  for  fs-verity  (https://www.kernel.org/doc/html/latest/filesys‐
       tems/fsverity.html).

fsverity-utils v1.6                                March 2024                                        <u><a href="../man1/FSVERITY.1.html">FSVERITY</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>