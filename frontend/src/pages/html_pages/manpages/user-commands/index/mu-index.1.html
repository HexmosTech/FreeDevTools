<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mu-index - index e-mail messages stored in Maildirs</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/maildir-utils">maildir-utils_1.12.9-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mu-index - index e-mail messages stored in Maildirs

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>mu</b> [<u>COMMON-OPTIONS</u>] <b>index</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>mu</b>  <b>index</b> is the <b>mu</b> command for scanning the contents of Maildir directories and storing the results in a
       Xapian database. The data can then be queried using <b><a href="../man1/mu-find.1.html">mu-find</a></b>(1).

       Before the first time you run <b>mu</b> <b>index</b>, you must run <b>mu</b> <b>init</b> to initialize the database.

       <b>index</b> understands Maildirs as defined by Daniel Bernstein  for  <b><a href="../man7/qmail.7.html">qmail</a></b>(7).  In  addition,  it  understands
       recursive  Maildirs (Maildirs within Maildirs), Maildir++. It also supports VFAT-based Maildirs which use
       <b>!</b> or <b>;</b> as the separators instead of <b>:</b>.

       E-mail messages which are not stored in something resembling a maildir leaf-directory (<u>cur</u> and  <u>new</u>)  are
       ignored, as are the cache directories for <u>notmuch</u> and <u>gnus</u>, and any dot-directory.

       Symlinks  are  followed,  and  the directories can be spread over multiple filesystems; however note that
       moving files around is much faster when multiple filesystems are not involved. Be careful to avoid  self-
       referential symlinks!

       If  there  is  a  file  called  <u>.noindex</u>  in  a  directory, the contents of that directory and all of its
       subdirectories will be ignored. This can be useful to  exclude  certain  directories  from  the  indexing
       process, for example directories with spam-messages.

       If  there  is  a  file  called  <u>.noupdate</u>  in  a directory, the contents of that directory and all of its
       subdirectories will be ignored. This can be useful to speed up things you have some maildirs  that  never
       change.

       <u>.noupdate</u>  does  not affect already-indexed messages: you can still search for them. <u>.noupdate</u> is ignored
       when you start indexing with an empty database (such as directly after <b>mu</b> <b>init</b>).

       There also the option <b>--lazy-check</b> which can greatly speed up indexing; see below for details.

       The first run of <b>mu</b> <b>index</b> may take a few minutes if you  have  a  lot  of  mail  (tens  of  thousands  of
       messages).  Fortunately, such a full scan needs to be done only once; after that it suffices to index the
       changes, which goes much faster. See the `PERFORMANCE (i,ii,iii)' below for more information.

       The optional `phase two' of the indexing-process is the removal of messages from the database  for  which
       there  is  no  longer  a  corresponding  file  in  the Maildir.  If you do not want this, you can use <b>-n</b>,
       <b>--nocleanup</b>.

       When <b>mu</b> <b>index</b> catches one of the signals <b>SIGINT</b>, <b>SIGHUP</b> or <b>SIGTERM</b> (e.g., when you  press  <b>Ctrl-C</b>  during
       the  indexing  process),  it attempts to shutdown gracefully; it tries to save and commit data, and close
       the database etc. If it receives another signal (e.g., when pressing Ctrl-C once  more),  <b>mu</b>  <b>index</b>  will
       terminate immediately.

</pre><h4><b>INDEX</b> <b>OPTIONS</b></h4><pre>
   <b>--lazy-check</b>
       In  lazy-check  mode,  <b>mu</b> does not consider messages for which the time-stamp (<b>ctime</b>) of the directory in
       which they reside, has not changed since the previous time this directory was checked.

       This is much faster than the non-lazy check, but won't update messages that  have  changed  (rather  than
       having  been  added or removed), since merely editing a message does not update the directory time-stamp.
       Of course, you can run <b>mu-index</b> occasionally without <b>--lazy-check</b>, to pick up such messages.

       Furthermore, in lazy-check mode, files which have a <b>ctime</b> smaller than the  time  the  previous  indexing
       operation  was  completed,  are ignored. This helps for the use-case where new messages can appear in big
       maildirs.

   <b>--nocleanup</b>
       Disable the database cleanup that <b>mu</b> does by default after indexing.

   <b>--reindex</b>
       Perform a complete reindexing of all the messages in the maildir.

   <b>--muhome</b>
       Use a non-default directory to store and read the database, write the logs, etc.  By default, <b>mu</b> uses the
       XDG Base Directory Specification (e.g. on GNU/Linux  this  defaults  to  <u><a href="file:~/.cache/mu">~/.cache/mu</a></u>  and  <u><a href="file:~/.config/mu">~/.config/mu</a></u>).
       Earlier versions of <b>mu</b> defaulted to <u><a href="file:~/.mu">~/.mu</a></u>, which now requires <b>--muhome=<a href="file:~/.mu">~/.mu</a></b>.

       The environment variable <b>MUHOME</b> can be used as an alternative to <b>--muhome</b>. The latter has precedence.

</pre><h4><b>COMMON</b> <b>OPTIONS</b></h4><pre>
   <b>-d,</b> <b>--debug</b>
       Makes  <b>mu</b>  generate  extra  debug information, useful for debugging the program itself. Debug information
       goes to the standard logging location; see <b><a href="../man1/mu.1.html">mu</a></b>(1).

   <b>-q,</b> <b>--quiet</b>
       Causes <b>mu</b> not to output informational messages and progress information to standard output, but  only  to
       the log file. Error messages will still be sent to standard error. Note that <b>mu</b> <b>index</b> is much faster with
       <b>--quiet</b>, so it is recommended you use this option when using <b>mu</b> from scripts etc.

   <b>--log-stderr</b>
       Causes  <b>mu</b>  to  not  output  log  messages to standard error, in addition to sending them to the standard
       logging location.

   <b>--nocolor</b>
       Do not use ANSI colors. The environment variable <b>NO_COLOR</b> can be used as an alternative to <b>--nocolor</b>.

   <b>-V,</b> <b>--version</b>
       Prints <b>mu</b> version and copyright information.

   <b>-h,</b> <b>--help</b>
       Lists the various command line options.

</pre><h4><b>ENCRYPTION</b></h4><pre>
       <b>mu</b> <b>index</b> does <u>not</u> decrypt messages, and only the metadata (such as headers) of encrypted  messages  makes
       it  to  the database. <b>mu</b> <b>view</b> and <b>mu4e</b> can decrypt messages, but those work with the message directly and
       the information is not added to the database.

</pre><h4><b>PERFORMANCE</b></h4><pre>
   <b>indexing</b> <b>in</b> <b>ancient</b> <b>times</b> <b>(2009?)</b>
       As a non-scientific benchmark, a simple test on the author's machine (a Thinkpad X61s laptop using  Linux
       2.6.35 and an ext3 file system) with no existing database, and a maildir with 27273 messages:

              $ sudo sh -c 'sync &amp;&amp; echo 3 &gt; <a href="file:/proc/sys/vm/drop_caches">/proc/sys/vm/drop_caches</a>'
              $ time mu index --quiet
              66,65s user 6,05s system 27% cpu 4:24,20 total

       (about 103 messages per second)

       A second run, which is the more typical use case when there is a database already, goes much faster:

              $ sudo sh -c 'sync &amp;&amp; echo 3 &gt; <a href="file:/proc/sys/vm/drop_caches">/proc/sys/vm/drop_caches</a>'
              $ time mu index --quiet
              0,48s user 0,76s system 10% cpu 11,796 total

       (more than 56818 messages per second)

       Note  that  each  test flushes the caches first; a more common use case might be to run <b>mu</b> <b>index</b> when new
       mail has arrived; the cache may stay quite `warm' in that case:

              $ time mu index --quiet
              0,33s user 0,40s system 80% cpu 0,905 total

       which is more than 30000 messages per second.

   <b>indexing</b> <b>in</b> <b>2012</b>
       As per June 2012, we did the same non-scientific benchmark,  this  time  with  an  Intel  i5-2500  CPU  @
       3.30GHz, an ext4 file system and a maildir with 22589 messages. We start without an existing database.

              $ sudo sh -c 'sync &amp;&amp; echo 3 &gt; <a href="file:/proc/sys/vm/drop_caches">/proc/sys/vm/drop_caches</a>'
              $ time mu index --quiet
              27,79s user 2,17s system 48% cpu 1:01,47 total

       (about 813 messages per second)

       A second run, which is the more typical use case when there is a database already, goes much faster:

              $ sudo sh -c 'sync &amp;&amp; echo 3 &gt; <a href="file:/proc/sys/vm/drop_caches">/proc/sys/vm/drop_caches</a>'
              $ time mu index --quiet
              0,13s user 0,30s system 19% cpu 2,162 total

       (more than 173000 messages per second)

   <b>indexing</b> <b>in</b> <b>2016</b>
       As  per  July 2016, we did the same non-scientific benchmark, again with the Intel i5-2500 CPU @ 3.30GHz,
       an ext4 file system. This time, the maildir contains 72525 messages.

              $ sudo sh -c 'sync &amp;&amp; echo 3 &gt; <a href="file:/proc/sys/vm/drop_caches">/proc/sys/vm/drop_caches</a>'
              $ time mu index --quiet
              40,34s user 2,56s system 64% cpu 1:06,17 total

       (about 1099 messages per second).

   <b>indexing</b> <b>in</b> <b>2022</b>
       A few years later and it is June 2022. There's a lot more happening during indexing, but indexing  became
       multi-threaded  and  machines  are faster; e.g. this is with an AMD Ryzen Threadripper 1950X (16 cores) @
       3.399GHz.

       The instructions are a little different since we have a proper repeatable benchmark now. After building,

              $ sudo sh -c 'sync &amp;&amp; echo 3 &gt; <a href="file:/proc/sys/vm/drop_caches">/proc/sys/vm/drop_caches</a>'
              % THREAD_NUM=4 build/lib/tests/bench-indexer -m perf
              # random seed: R02Sf5c50e4851ec51adaf301e0e054bd52b
              1..1
              # Start of bench tests
              # Start of indexer tests
              indexed 5000 messages in 20 maildirs in 3763ms; 752 μs/message; 1328 messages/s (4 thread(s))
              ok 1 /bench/indexer/4-cores
              # End of indexer tests
              # End of bench tests

       Things are again a little faster, even though the index does a lot more now (text-normalization, and pre-
       generating message-sexps). A faster machine helps, too!

   <b>recent</b> <b>releases</b>
       Indexing the the same 93000-message mail corpus with the last few releases:

                      ┌───────────────────────────────────────────────────────────────────────┐
                      │       release   time (sec)   notes                                    │
                      ├───────────────────────────────────────────────────────────────────────┤
                      │           1.4   160s                                                  │
                      │           1.6   178s                                                  │
                      │           1.8   97s                                                   │
                      │          1.10   120s         adds html indexing, sexp-caching         │
                      │ 1.11 (master)   96s          adds language-guessing, batch-size=50000 │
                      └───────────────────────────────────────────────────────────────────────┘

       Quite some variation!

       Over time new features / refactoring can change the timings quite a bit. At least  for  now,  the  latest
       code is both the fastest and the most featureful!

</pre><h4><b>EXIT</b> <b>CODE</b></h4><pre>
       This command returns 0 upon successful completion, or a non-zero exit code otherwise.

       0.  success

       2.  no matches found. Try a different query

       11. database schema mismatch. You need to re-initialize <b>mu</b>, see <b><a href="../man1/mu-init.1.html">mu-init</a></b>(1)

       19. failed to acquire lock. Some other program has exclusive access to the <b>mu</b> database

       99. caught an exception

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Please report bugs at <u>https://github.com/djcb/mu/issues</u>.

</pre><h4><b>AUTHOR</b></h4><pre>
       Dirk-Jan C. Binnema &lt;<a href="mailto:djcb@djcbsoftware.nl">djcb@djcbsoftware.nl</a>&gt;

</pre><h4><b>COPYRIGHT</b></h4><pre>
       This manpage is part of <b>mu</b> 1.12.9.

       Copyright   ©   2008-2025   Dirk-Jan   C.   Binnema.   License   GPLv3+:  GNU  GPL  version  3  or  later
       <u>https://gnu.org/licenses/gpl.html</u>. This is free software: you are free to  change  and  redistribute  it.
       There is NO WARRANTY, to the extent permitted by law.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/maildir.5.html">maildir</a></b>(5), <b><a href="../man1/mu.1.html">mu</a></b>(1), <b><a href="../man1/mu-init.1.html">mu-init</a></b>(1), <b><a href="../man1/mu-find.1.html">mu-find</a></b>(1), <b><a href="../man1/mu-cfind.1.html">mu-cfind</a></b>(1)

                                                                                                     <u>MU</u> <u><a href="../man1/INDEX.1.html">INDEX</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>