<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>r.terraflow  - Performs flow computation for massive grids.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/grass-doc">grass-doc_8.4.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>r.terraflow</b>  - Performs flow computation for massive grids.

</pre><h4><b>KEYWORDS</b></h4><pre>
       raster, hydrology, flow, accumulation, sink

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>r.terraflow</b>
       <b>r.terraflow</b> <b>--help</b>
       <b>r.terraflow</b>     [-<b>s</b>]     <b>elevation</b>=<u>name</u>      [<b>filled</b>=<u>name</u>]       [<b>direction</b>=<u>name</u>]       [<b>swatershed</b>=<u>name</u>]
       [<b>accumulation</b>=<u>name</u>]     [<b>tci</b>=<u>name</u>]     [<b>d8cut</b>=<u>float</u>]     [<b>memory</b>=<u>memory</u>   <u>in</u>   <u>MB</u>]     [<b>directory</b>=<u>string</u>]
       [<b>stats</b>=<u>string</u>]   [--<b>overwrite</b>]  [--<b>help</b>]  [--<b>verbose</b>]  [--<b>quiet</b>]  [--<b>ui</b>]

   <b>Flags:</b>
       <b>-s</b>
           SFD (D8) flow (default is MFD)
           SFD: single flow direction, MFD: multiple flow direction

       <b>--overwrite</b>
           Allow output files to overwrite existing files

       <b>--help</b>
           Print usage summary

       <b>--verbose</b>
           Verbose module output

       <b>--quiet</b>
           Quiet module output

       <b>--ui</b>
           Force launching GUI dialog

   <b>Parameters:</b>
       <b>elevation</b>=<u>name</u> <b>[required]</b>
           Name of input elevation raster map

       <b>filled</b>=<u>name</u>
           Name for output filled (flooded) elevation raster map

       <b>direction</b>=<u>name</u>
           Name for output flow direction raster map

       <b>swatershed</b>=<u>name</u>
           Name for output sink-watershed raster map

       <b>accumulation</b>=<u>name</u>
           Name for output flow accumulation raster map

       <b>tci</b>=<u>name</u>
           Name for output topographic convergence index (tci) raster map

       <b>d8cut</b>=<u>float</u>
           Routing using SFD (D8) direction
           If flow accumulation is larger than this value it is routed using SFD (D8) direction (meaningful only
           for MFD flow). If no answer is given it defaults to infinity.

       <b>memory</b>=<u>memory</u> <u>in</u> <u>MB</u>
           Maximum memory to be used (in MB)
           Cache size for raster rows
           Default: <u>300</u>

       <b>directory</b>=<u>string</u>
           Directory to hold temporary files (they can be large)

       <b>stats</b>=<u>string</u>
           Name for output file containing runtime statistics

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>r.terraflow</u>  takes as input a raster digital elevation model (DEM) and computes the flow direction raster
       and the flow accumulation raster,  as  well  as  the  flooded  elevation  raster,  sink-watershed  raster
       (partition into watersheds around sinks) and TCI (topographic convergence index) raster maps.

       <u>r.terraflow</u>  computes these rasters using well-known approaches, with the difference that its emphasis is
       on the computational complexity of the algorithms, rather than on modeling realistic  flow.   <u>r.terraflow</u>
       emerged  from  the necessity of having scalable software able to process efficiently very large terrains.
       It is based on theoretically optimal algorithms developed in the framework of  I/O-efficient  algorithms.
       <u>r.terraflow</u> was designed and optimized especially for massive grids and is able to process terrains which
       were impractical with similar functions existing in other GIS systems.

       Flow directions are computed using either the MFD (Multiple Flow Direction) model or the SFD (Single Flow
       Direction,  or D8) model, illustrated below. Both methods compute downslope flow directions by inspecting
       the 3-by-3 window around the current cell. The SFD method assigns a unique  flow  direction  towards  the
       steepest  downslope  neighbor.  The  MFD  method  assigns  multiple flow directions towards all downslope
       neighbors.

       Flow direction to steepest downslope neighbor (SFD).         Flow direction to all downslope neighbors (MFD).

       The SFD and the MFD method cannot compute flow directions for cells which have the  same  height  as  all
       their neighbors (flat areas) or cells which do not have downslope neighbors (one-cell pits).

           •   On  plateaus  (flat  areas that spill out) <u>r.terraflow</u> routes flow so that globally the flow goes
               towards the spill cells of the plateaus.

           •   On sinks (flat areas that do not spill out, including one-cell pits) <u>r.terraflow</u> assigns flow  by
               flooding  the  terrain until all the sinks are filled and assigning flow directions on the filled
               terrain.

       In order to flood the  terrain,  <u>r.terraflow</u>  identifies  all  sinks  and  partitions  the  terrain  into
       sink-watersheds  (a  sink-watershed  contains  all  the  cells  that flow into that sink), builds a graph
       representing the adjacency information of the sink-watersheds, and  uses  this  sink-watershed  graph  to
       merge watersheds into each other along their lowest common boundary until all watersheds have a flow path
       outside  the terrain. Flooding produces a sink-less terrain in which every cell has a downslope flow path
       leading outside the terrain and therefore every  cell  in  the  terrain  can  be  assigned  SFD/MFD  flow
       directions as above.  Flow directions are encoded using powers of two clockwise starting from 20 for east
       to 27 for north-east.
       Flow  direction  encoding  clockwise  starting  from 20 for east to 27 for north-east; 0 for undetermined
       (sinks) and 1 for undefined (null cells) (source)

       Once flow directions are computed for every cell in the terrain, <u>r.terraflow</u> computes  flow  accumulation
       by routing water using the flow directions and keeping track of how much water flows through each cell.

       If  flow accumulation of a cell is larger than the value given by the <b>d8cut</b> option, then the flow of this
       cell is routed to its neighbors using the SFD (D8) model. This option affects only the flow  accumulation
       raster  and is meaningful only for MFD flow (i.e. if the <b>-s</b> flag is not used); If this option is used for
       SFD flow it is ignored. The default value of <b>d8cut</b> is <u>infinity</u>.

       <u>r.terraflow</u> also computes the <b>tci</b> raster (topographic convergence index, defined as the logarithm of  the
       ratio of flow accumulation and local slope).

       For more details on the algorithms see [1,2,3] below.

</pre><h4><b>NOTES</b></h4><pre>
       One  of  the techniques used by <u>r.terraflow</u> is the space-time trade-off. In particular, in order to avoid
       searches, which are I/O-expensive, <u>r.terraflow</u> computes and works with an augmented elevation  raster  in
       which  each  cell  stores  relevant information about its 8 neighbors, in total up to 80B per cell.  As a
       result <u>r.terraflow</u> works with intermediate temporary files that may be up to 80N bytes, where  N  is  the
       number  of  cells  (rows  x  columns)  in the elevation raster (more precisely, 80K bytes, where K is the
       number of valid (not no-data) cells in the input elevation raster).

       All these intermediate temporary files are stored in the path specified by the  <b>directory</b>  option.  Note:
       <b>directory</b> must contain enough free disk space in order to store up to 2 x 80N bytes.

       The  <b>memory</b>  option can be used to set the maximum amount of main memory (RAM) the module will use during
       processing. In practice its <u>value</u> should be an underestimate of  the  amount  of  available  (free)  main
       memory on the machine. <u>r.terraflow</u> will use at all times at most this much memory, and the virtual memory
       system (swap space) will never be used. The default value is 300 MB.

       The <b>stats</b> option defines the name of the file that contains the statistics (stats) of the run.

       <u>r.terraflow</u> has a limit on the number of rows and columns (max 32,767 each).

       The  internal  type  used  by <u>r.terraflow</u> to store elevations can be defined at compile-time. By default,
       <u>r.terraflow</u> is compiled to store elevations internally as floats. Other versions can be  created  by  the
       user if needed.

       Hints  concerning  compilation  with storage of elevations internally as shorts: such a version uses less
       space (up to 60B per cell, up to 60N intermediate file) and therefore is more space and  time  efficient.
       <u>r.terraflow</u>  is  intended  for  use with floating point raster data (FCELL), and <u>r.terraflow</u> <u>(short)</u> with
       integer raster data (CELL) in which  the  maximum  elevation  does  not  exceed  the  value  of  a  short
       SHRT_MAX=32767  (this  is  not  a constraint for any terrain data of the Earth, if elevation is stored in
       meters).  Both <u>r.terraflow</u> and <u>r.terraflow</u> <u>(short)</u> work with input elevation rasters which can be  either
       integer, floating point or double (CELL, FCELL, DCELL). If the input raster contains a value that exceeds
       the allowed internal range (short for <u>r.terraflow</u> <u>(short)</u>, float for <u>r.terraflow</u>), the program exits with
       a  warning  message.  Otherwise,  if  all values in the input elevation raster are in range, they will be
       converted (truncated)  to  the  internal  elevation  type  (short  for  <u>r.terraflow</u>  <u>(short)</u>,  float  for
       <u>r.terraflow</u>). In this case precision may be lost and artificial flat areas may be created.  For instance,
       if  <u>r.terraflow</u>  <u>(short)</u>  is  used  with  floating  point raster data (FCELL or DCELL), the values of the
       elevation will be truncated as shorts.  This  may  create  artificial  flat  areas,  and  the  output  of
       <u>r.terraflow</u>  <u>(short)</u>  may be less realistic than those of <u>r.terraflow</u> on floating point raster data.  The
       outputs of <u>r.terraflow</u> <u>(short)</u> and <u>r.terraflow</u> are identical for integer raster data (CELL maps).

</pre><h4><b>EXAMPLES</b></h4><pre>
       Example for small area in North Carolina sample dataset to calculate flow accumulation:
       g.region raster=elev_lid792_1m
       r.terraflow elevation=elev_lid792_1m accumulation=elev_lid792_1m_accumulation
       <u>Flow</u> <u>accumulation</u>

       Spearfish sample data set:
       g.region raster=elevation.10m -p
       r.terraflow elev=elevation.10m filled=elevation10m.filled \
           dir=elevation10m.mfdir swatershed=elevation10m.watershed \
           accumulation=elevation10m.accu tci=elevation10m.tci
       g.region raster=elevation.10m -p
       r.terraflow elev=elevation.10m filled=elevation10m.filled \
           dir=elevation10m.mfdir swatershed=elevation10m.watershed \
           accumulation=elevation10m.accu tci=elevation10m.tci d8cut=500 memory=800 \
           stats=elevation10mstats.txt

</pre><h4><b>REFERENCES</b></h4><pre>
       <b>1</b>      The TerraFlow project at Duke University

       <b>2</b>      I/O-efficient algorithms for problems on grid-based terrains.  Lars Arge, Laura Toma, and  Jeffrey
              S.  Vitter.  In  <u>Proc.</u>  <u>Workshop</u>  <u>on</u> <u>Algorithm</u> <u>Engineering</u> <u>and</u> <u>Experimentation</u>, 2000. To appear in
              <u>Journal</u> <u>of</u> <u>Experimental</u> <u>Algorithms</u>.

       <b>3</b>      Flow computation on massive grids.  Lars Arge, Jeffrey S. Chase, Patrick N.  Halpin,  Laura  Toma,
              Jeffrey  S.  Vitter,  Dean  Urban  and Rajiv Wickremesinghe. In <u>Proc.</u> <u>ACM</u> <u>Symposium</u> <u>on</u> <u>Advances</u> <u>in</u>
              <u>Geographic</u> <u>Information</u> <u>Systems</u>, 2001.

       <b>4</b>      Flow computation on massive grid terrains.  Lars Arge, Jeffrey S. Chase, Patrick N. Halpin,  Laura
              Toma,  Jeffrey  S.  Vitter, Dean Urban and Rajiv Wickremesinghe.  In <u>GeoInformatica,</u> <u>International</u>
              <u>Journal</u> <u>on</u> <u>Advances</u> <u>of</u> <u>Computer</u> <u>Science</u> <u>for</u> <u>Geographic</u> <u>Information</u> <u>Systems</u>, <a href="../man4/7.4.html">7</a>(4):283-313, December
              2003.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
        <u>r.flow,</u> <u>r.basins.fill,</u> <u>r.drain,</u> <u>r.topidx,</u> <u>r.topmodel,</u> <u>r.water.outlet,</u> <u>r.watershed</u>

</pre><h4><b>AUTHORS</b></h4><pre>
       Original version of program: The     TerraFlow project,     1999, Duke University.
           Lars Arge, Jeff Chase, Pat Halpin, Laura Toma, Dean Urban, Jeff Vitter, Rajiv Wickremesinghe.

       Porting to GRASS GIS, 2002:
           Lars Arge, Helena Mitasova, Laura Toma.

       Contact:  Laura Toma

</pre><h4><b>SOURCE</b> <b>CODE</b></h4><pre>
       Available at: r.terraflow source code (history)

       Accessed: Friday Apr 04 01:20:02 2025

       Main index | Raster index | Topics index | Keywords index | Graphical index | Full index

       © 2003-2025 GRASS Development Team, GRASS GIS 8.4.1 Reference Manual

GRASS 8.4.1                                                                                  <u><a href="../man1grass/r.terraflow.1grass.html">r.terraflow</a></u>(1grass)
</pre>
 </div>
</div></section>
</div>
</body>
</html>