<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>autopkgtest-virt-ssh - autopkgtest virtualisation server using SSH</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/autopkgtest">autopkgtest_5.47_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       autopkgtest-virt-ssh - autopkgtest virtualisation server using SSH

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>autopkgtest</b> <u>[...]</u> <b>--</b> <b>ssh</b> [<u>options</u>] <u>[--</u> <u>setup</u> <u>script</u> <u>options</u> ...]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>autopkgtest-virt-ssh</b> provides an autopkgtest virtualisation server using SSH.

       Normally <b>autopkgtest-virt-ssh</b> will be invoked by <b>autopkgtest</b>.

       <b>autopkgtest-virt-ssh</b>  can  use  an already existing ssh target, or call a setup script to create/set up a
       test bed and the ssh server.

       <b>WARNING!</b>  autopkgtest-virt-ssh will modify the target system by installing packages and running arbitrary
       test code, so <b>you</b> <b>are</b> <b>responsible</b> <b>for</b> <b>resetting</b> <b>the</b> <b>testbed</b> <b>yourself</b> especially without a  setup  script.
       So use this with care.

</pre><h4><b>REQUIREMENTS</b></h4><pre>
       <b>autopkgtest-virt-ssh</b>  doesn't  assume  anything  regarding  the target host other than that the given ssh
       connection (and networking) stay available all the time. You can provide credententials  on  the  command
       line  for  already  working  SSH  hosts or use a setup script to prepare the host for the connection (see
       <b>SETUP</b> <b>SCRIPT</b> below for more information), for example to create a forwarding rule to access an  adb  host
       over ssh or start a cloud instance.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-h</b>|<b>--help</b>
              Show the help message and exit

       <b>-d</b>|<b>--debug</b>
              Enable debugging output

       <b>-H</b> <u>hostname</u> <b>|</b> <b>--hostname=</b><u>hostname</u>
              Connects and logs into the specified hostname or IP address

       <b>-l</b> <u>user</u> <b>|</b> <b>--login=</b><u>user</u>
              Specifies the user to log in as on the remote machine.

       <b>-i</b> <u>identity</u> <b>|</b> <b>--identity=</b><u>identity</u>
              Selects a file from which the identity (private key) for public key authentication is read. Should
              usually be <b><a href="file:~/.ssh/id_rsa">~/.ssh/id_rsa</a></b>, but you might consider using a different key for tests.

       <b>-P</b> <u>password</u> <b>|</b> <b>--password=</b><u>password</u>
              Specifies the sudo password on the remote host.

              It can be the password in clear text or a file containing the password. This password will be used
              to setup $SUDO_ASKPASS in the case sudo requires a password. The runner will check if the user has
              sudo access with and without a password. If the check fails, the capability "root-on-testbed" will
              not  be  available.  If  sudo  works, then tests that run as user will have $SUDO_ASKPASS in their
              environment so that they can run <b>sudo</b> <b>-A</b> if needed.

       <b>-p</b> <u>port</u> <b>|</b> <b>--port=</b><u>port</u>
              ssh port to use to connect to the host

       <b>-o</b> <u>options</u> <b>|</b> <b>--options=</b><u>options</u>
              Passed verbatim to ssh; see man ssh_config

       <b>-r</b>|<b>--reboot</b>
              Indicate that <b>reboot</b> can be used in the testbed. This  is  useful  when  running  rebooting  tests
              without a setup script (which can already declare capabilities).

       <b>--capability</b><u>CAPABILITY</u>
              Indicate that the testbed has the given capability (see README.virtualisation-server). This option
              can be specified multiple times.

              This  is  useful  when  running  rebooting tests without a setup script (which can already declare
              capabilities).

              WARNING:  Never  use  this  on  precious  testbeds,  as  specifying   options   like   <b>revert</b>   or
              <b>isolation-machine</b> can irrecoverably destroy the testbed!

       <b>-s</b> <u>setup_script</u> <b>|</b> <b>--setup-script=</b><u>setup_script</u>
              Setup  script to prepare testbed and ssh connection (See <b>SETUP</b> <b>SCRIPT</b> below for more information).
              File names will be searched in both the current directory and in <b>/usr/share/autopkgtest/ssh-setup/</b>
              so you do not need to give the full path for setup scripts shipped with autopkgtest.

       <b>--timeout-ssh=</b><u>secs</u>
              Timeout for waiting for ssh connection, in seconds. Default is 300.

       <b>--</b> <u>[setup</u> <u>script</u> <u>arguments]</u>
              All the remaining arguments following <b>--</b> will be passed verbatim to the setup script to  configure
              the host.

</pre><h4><b>CONFIGURATION</b> <b>FILES</b></h4><pre>
       If  you  use  lots of options or hosts, you can put parts of, or the whole command line into a text file,
       with one line per option. E. g. you can create a file <u>testhost.cfg</u> with contents like

              -Htest.example.com
              -ltestuser
              -Ps3kr1t

       and then run

              autopkgtest [...] -- ssh @testhost.cfg

       The contents of the configuration file will be expanded in-place as if you would have given its  contents
       on  the  command  line. Please ensure that you <b>don't</b> <b>place</b> <b>spaces</b> between short options and their values,
       they would become a part of the argument value.

</pre><h4><b>INPUT,</b> <b>OUTPUT</b> <b>AND</b> <b>EXIT</b> <b>STATUS</b></h4><pre>
       The behaviour of <b>autopkgtest-virt-ssh</b> is as  described  by  the  AutomatedTesting  virtualisation  regime
       specification.

</pre><h4><b>NOTES</b></h4><pre>
       <b>autopkgtest</b>  does not run <b>apt-get</b> <b>update</b> at the start of a package build, which can cause a build failure
       if you are using a development series template. You will need to  run  <b>apt-get</b>  <b>update</b>  in  the  template
       yourself (e. g. using <b>--setup-commands</b>).

</pre><h4><b>SETUP</b> <b>SCRIPT</b></h4><pre>
       <b>autopkgtest-virt-ssh</b>  accepts a setup script in argument to prepare the testbed and the ssh connection. A
       setup script is an executable that gets called with a command as first argument, and  additional  options
       for that command.

   <b>command:</b> <b>open</b>
       When  called  with "open", the script has to create a testbed (if necessary), configure ssh, copy ssh key
       into it, configure sudo, etc.

       It then returns the following information on standard output with the form <b>key=value</b>, one line per  pair.
       These mostly mirror the command line options when not using a script.

       Required fields:

       *   login: User name

       *   hostname: hostname or IP address

       Optional fields:

       *   identity: Path to the private key

       *   password:  sudo password for the user name to acquire root privileges. If not given, and passwordless
           sudo does not work, the testbed will not have root privileges.

       *   port: SSH port on hostname, if different than 22

       *   capabilities:  extra  testbed   capabilities   such   as   "isolation-machine"   or   "revert",   see
           README.virtualisation-server.rst

           If the testbed can be rebooted with keeping state, the script should advertise "reboot".

       *   options: passed verbatim to ssh, see man ssh_config

       *   extraopts:  passed  verbatim  to other commands; this allows extra state (such as temporary directory
           names, VM identifiers, etc.) to be passed to cleanup

   <b>command:</b> <b>cleanup</b>
       Called when closing the testbed; should revert/remove things installed in open as much as possible if the
       testbed is not ephemeral. This gets called  with  all  the  options  that  open  got  called  with,  plus
       <b>extraopts</b>.

   <b>command:</b> <b>revert</b>
       If  there  is  a way to reset the testbed to its pristine state (such as using VM snapshots or rebuilding
       ephemeral testbeds), the script should put "revert" (and if appropriate, "revert-full-system")  into  the
       capabilities  and  implement  this command. This can optionally output some or all of the ssh config keys
       from open() to update the configuration, in case the hostname/IP changes.

   <b>command:</b> <b>wait-reboot</b>
       This can be implemented if capabilities advertise "reboot" and you need to do  something  more  elaborate
       than just waiting for the ssh port to go down and come back up after calling "reboot". This needs to wait
       for testbed to shut down, boot, and re-prepare the testbed for ssh login.

   <b>command:</b> <b>debug-failure</b>
       This  is  called  when  the  setup script fails with nonzero or on timeouts waiting for ssh or reboot. If
       available, this should output some debugging information, such as the boot log from the  serial  console.
       Implementing this is optional.

   <b>Included</b> <b>scripts</b>
       autopkgtest  provides  setup  scripts  for common types of testbeds in <b>/usr/share/autopkgtest/ssh-setup/</b>.
       Please  see  the  comments  in  these  scripts  for  how  to  use  them.  Also,  please  consider   using
       <b>/usr/share/autopkgtest/ssh-setup/SKELETON</b> as a basis for writing your own.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Run the tests of the gdk-pixbuf source package on an existing "mytesthost":

              autopkgtest gdk-pixbuf -- ssh -H mytesthost -l joe -P /tmp/joe_password

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/autopkgtest.1.html">autopkgtest</a></b>(1), <b>/usr/share/doc/autopkgtest/</b>, <b>/usr/share/autopkgtest/ssh-setup/SKELETON</b>.

</pre><h4><b>AUTHORS</b> <b>AND</b> <b>COPYRIGHT</b></h4><pre>
       <b>autopkgtest-virt-ssh</b>  was  written  by  Martin  Pitt &lt;<a href="mailto:martin.pitt@ubuntu.com">martin.pitt@ubuntu.com</a>&gt; and Jean-Baptiste Lallement
       &lt;<a href="mailto:jean.baptiste.lallement@ubuntu.com">jean.baptiste.lallement@ubuntu.com</a>&gt;.

       This manpage is part of autopkgtest, a tool for testing Debian binary packages.  autopkgtest is Copyright
       (C) 2006-2014 Canonical Ltd and others.

       See <b>/usr/share/doc/autopkgtest/CREDITS</b> for the list of contributors and full copying conditions.

Linux Programmer's Manual                             2014                               <u><a href="../man1/autopkgtest-virt-ssh.1.html">autopkgtest-virt-ssh</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>