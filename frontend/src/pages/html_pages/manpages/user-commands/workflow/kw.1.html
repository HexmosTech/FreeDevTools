<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kw - Inglorious kernel developer workflow scripts</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/kworkflow">kworkflow_20191112-1.2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       kw - Inglorious kernel developer workflow scripts

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>kw</b> <u>COMMAND</u> [<u>OPTION</u> ...]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>kw</b>  is  a  set  of  scripts  that  have a single mission: reduce the overhead related with infrastructure
       project setup in projects that have a similar workflow to the  Linux  Kernel.  It  can  (and  should)  be
       customized by editing the <u>kworkflow.config</u> file, as discussed in section "ABOUT kworflow.config".

</pre><h4><b>COMMANDS</b></h4><pre>
       <b>kw</b>  offers  several  subcommands  catering  to  different audiences and targeting different functionality
       groups. Most subcommands have sane defaults.

   <b>COMMANDS</b> <b>FOR</b> <b>USING</b> <b>QEMU</b>
       Projects that use a QEMU VM in the development cycle to host the development environment usually  require
       that  developers use some specific commands to manage this VM. In this section, you can find all commands
       available in <b>kw</b> to manage many daily tasks related to QEMU VM operation.   Notice  that  some  rules  are
       specific for the Linux Kernel project.

   <b>mo,</b> <b>mount</b>
       Mount the QEMU image in a specific directory, based on the data available in the <b>kworkflow.config</b>. Notice
       that the configuration file has the information about the source image and destiny mount point.

       <b>NOTE:</b>
          <b>Only</b> <b>run</b> <b>this</b> <b>command</b> <b>after</b> <b>you</b> <b>turn</b> <b>off</b> <b>your</b> <b>VM</b>.

   <b>um,</b> <b>umount</b>
       Umount the previously mounted QEMU image.

   <b>u,</b> <b>up</b>
       Start the QEMU VM based on parameters in the <b>kworkflow.config</b> file.

   <b>s,</b> <b>ssh</b> <b>[--script|-s="PATH"]|[--command|-c="COMMAND"]</b>
       Ssh  into  the QEMU VM. The <u>--script</u> parameter expects a bash script as a parameter to evaluate it in the
       VM. The <u>--command</u> parameter expects a command to be executed inside the QEMU VM.

   <b>i,</b> <b>install</b>
       Installs or updates the Linux kernel modules on the QEMU VM.  Under  the  hood,  it  executes  the  mount
       operation, followed by <b>make</b> <b>modules_install</b> with a specific target, and finally umounts the QEMU image.

       <b>NOTE:</b>
          <b>Only</b> <b>run</b> <b>this</b> <b>command</b> <b>after</b> <b>you</b> <b>turn</b> <b>off</b> <b>your</b> <b>VM</b>.

   <b>p,</b> <b>prepare</b>
       <b>(EXPERIMENTAL)</b>  Starting from a generic image, <u>prepare</u> sets up the necessary packages, files, etc. inside
       the QEMU image so that it is ready for development work. For this to work, you have to:

       1. Add your public key in the VM in the authorized_keys file.

       2. Remove the requirement for password in the VM to become root.

       This command (currently) uses Ansible playbooks.

   <b>COMMANDS</b> <b>FOR</b> <b>WORKING</b> <b>WITH</b> <b>CODE</b>
       Projects that have a similar workflow to the Linux Kernel usually have a set of tools that simplify  part
       of  the  tasks  related with the code. This section describes some of the key features supported by <b>kw</b> to
       help with code.

   <b>b,</b> <b>build</b>
       This command calls make on a local Makefile to build the project. It tries  to  take  advantage  of  your
       hardware by using the <u>-j</u> option with the appropriate parameter.

   <b>c,</b> <b>codestyle</b> <b>[</b><u><b>DIRECTORY|FILE</b></u><b>]</b>
       The  <b>checkpatch</b>  tool is one of the most fabulous scripts provided by the Linux Kernel to help developers
       follow the code style adopted by the project.  This command is a wrapper for <b>checkpatch</b>, with the goal of
       simplifying the use of this tool; notice that you can specify a single file or an entire directory.

   <b>e,</b> <b>explore</b> <b>[log]</b> <b>[</b><u><b>EXPRESSION</b></u><b>]</b> <b>[-p]</b> <b>[</b><u><b>DIRECTORY|FILE</b></u><b>]</b>
       The <u>explore</u> command is based on git grep. It can search for string matches in either the  git  repository
       contents  or  in the git log messages. For example, you can use <b>kw</b> <b>e</b> <b>functionName</b> to find <u>functionName</u> in
       the source directory.  You can also search the git log history by using <u>log</u> after the <u>e</u>; for instance, <b>kw</b>
       <b>e</b> <b>log</b> <b>STRING_MATCH</b>.  Additionally, you can use <u>-p</u> to see the diff in the search.

   <b>m,</b> <b>maintainers</b> <b>[</b><u><b>-a|--authors</b></u><b>]</b> <b>[</b><u><b>DIRECTORY|FILE</b></u><b>]</b>
       Based on the Linux Kernel get_maintainers script, this command shows the maintainers of  a  given  Kernel
       module  (a  given  file  or  directory).   The  <u>[-a|--authors]</u>  option will also print the authors of the
       top-level target files (non-recursively). Files with more than one author will have their names separated
       by ",". This output should not be used by scripts because some authors include "," in their  names  (e.g.
       "Company X, Inc.").

   <b>OTHER</b> <b>COMMANDS</b>
       This  section  describes  a tool available in <b>kw</b> to help developers keep track of configuration files and
       other features provided by <b>kw</b> that do not fit in the previous sections.

   <b>g,</b> <b>configm</b> <b>[--save</b> <u><b>NAME</b></u> <b>[-d</b> <u><b>DESCRIPTION</b></u><b>][-f]]|[--ls]|[--get</b> <u><b>NAME</b></u> <b>[-f]]|[--rm</b> <u><b>NAME</b></u> <b>[-f]]</b>
       The 'configm' command manages different versions of the project's '.config' file.  It provides the  save,
       load, remove, and list operations of such files.

       1.   --save  NAME  [-d  DESCRIPTION] [-f]: The save option searches the current directory for a '.config'
       file to be kept under the management of kw. The save option expects a name to identify  this  version  of
       the  file.  Additionally, users can add a description by using <u>-d</u> flag. Finally, if the user tries to add
       the same name twice, <b>kw</b> will issue a warning; the '-f' will suppress this message.

       2. --ls lists all the .config file versions available.

       3. --get <u>NAME</u> [-f]: Get a config file based on the <u>NAME</u> and paste it in the current directory. It  pop-up
       a  warning  message  because this operation override the current .config file. The user can suppress this
       warning by using -f flag.

       4. --rm <u>NAME</u> [-f]: Remove config labeled with <u>NAME</u>. It pop-up a warning message because  it  will  remove
       the config file from kw management. The user can suppress this warning by using -f.

   <b>v,</b> <b>vars</b>
       Shows  configurations  being  used  by  <b>kw</b> in the current working directory. To do that, it examines both
       global and local <u>kworkflow.config</u> files.

   <b>bi</b>
       Build and install a new module version. It is a combination of the <b>build</b> and <b>install</b> commands.

   <b>alert=[</b><u><b>vs|sv,v,s,n</b></u><b>]</b>
       Some commands take considerable time to execute. <b>kw</b> gives you an option to be notified when they  finish.
       The commands <u>prepare</u>, <u>build</u>, <u>install</u>, <u>mount</u>, <u>umount</u>, new and <u>bi</u> offer this feature.

       1. <u>v</u> enables visual notification.

       2. <u>s</u> enables sound notification.

       3. <u>vs</u> or <u>sv</u> enables both.

       4. <u>n</u> (or any other option) disables notifications (this is the default).

   <b>h,</b> <b>help</b>
       Show basic help.

</pre><h4><b>ABOUT</b> <b>KWORFLOW.CONFIG</b></h4><pre>
       <b>kw</b>  reads  its  configuration  from  two  files:  the global <u>PATH/etc/kworkflow.config</u> file and the local
       <u>kworkflow.config</u> file present at the current working directory. The global <b>kworkflow.config</b> is a part  of
       the  <b>kw</b>  code  and  provides the overall behavior for <b>kw</b>. Local <b>kworkflow.config</b> settings override global
       ones; you may have one <b>kworkflow.config</b> per project. In this section, we describe the possible fields you
       can specify in the configuration files.

   <b>ssh_ip=IP</b>
       Sets the IP address to be used by ssh. By default <b>kw</b> uses <b>localhost</b>.

   <b>ssh_port=PORT</b>
       Sets the ssh port. By default <b>kw</b> uses 2222.

   <b>arch=ARCHITECTURE</b>
       Allows you to specify the default architecture used by <b>kw</b>. By default, <b>kw</b> uses x86_64.

   <b>virtualizer=VIRTUALIZER</b>
       Defines the virtualization tool that should be used by kw. Currently, we only  support  QEMU  and,  as  a
       result, the default is <b>qemu-system-x86_64</b>

   <b>mount_point=PATH</b>
       Defines  the  kw mount point, which will be used by libguestfs during the mount/umount operation of a VM.
       By default, <b>kw</b> uses <a href="file:/home/">/home/</a>$USER/p/mount.

   <b>qemu_hw_options=OPTIONS</b>
       Sets QEMU options. By default, <b>kw</b> uses <b>-enable-kvm</b> <b>-daemonize</b> <b>-smp</b> <b>2</b> <b>-m</b> <b>1024</b>

   <b>qemu_net_options=OPTIONS</b>
       Defines    the    network    configuration.     By     default,     <b>kw</b>     uses     <b>-net</b>     <b>nic</b>     <b>-net</b>
       <b>user,hostfwd=tcp::2222-:22,smb=/home/USER</b>

   <b>qemu_path_image=PATH</b>
       Specify the VM image path. By default, <b>kw</b> uses <b>/home/USERKW/p/virty.qcow2</b>

   <b>alert=[vs|s|v|n]</b>
       Default alert options, you have:

       1. v: enables visual notification.

       2. s enables sound notification.

       3. vs or sv enables both.

       4. n (or any other option) disables notifications.

   <b>sound_alert_command=COMMAND</b>
       Command to run for sound completion alert. By default, <b>kw</b> uses <b>paplay</b> <b>INSTALLPATH/sounds/complete.wav</b> <b>&amp;</b>

   <b>visual_alert_command=COMMAND</b>
       Command  to  run  for  visual completion alert. By default, <b>kw</b> uses notify-send -i checkbox -t 10000 "kw"
       "Command: \"$COMMAND\" completed!" (Note: You may use COMMAND, which will be replaced by the  kw  command
       whose conclusion the user wished to be alerted.)

</pre><h4><b>EXAMPLE</b></h4><pre>
       For these examples, we suppose the fields in your <u>kworkflow.config</u> file is already configured.

       First,  if you are working in a specific kernel module, and if you want to install your recent changes in
       your VM you can use:

          cd /KERNEL/PATH
          kw i

       <b>NOTE:</b>
          Turn off your VM before use the <u>intall</u> command.

       For building and installing a new module version based on the current kernel version, you can use:

          cd /KERNEL/PATH
          kw bi

       For checking the code style:

          cd /KERNEL/PATH
          kw c drivers/iio/dummy/
          kw c drivers/iio/dummy/iio_simple_dummy.c

       If you want to check the maintainers:

          cd /KERNEL/PATH
          kw m drivers/iio/dummy/iio_simple_dummy.c

       In case you want that kw saves your current .config file, you can use:

          cd /KERNEL/PATH
          kw g --save my_current_config

       You can see the config's file maintained by kw with:

          kw g --ls

       You can turn on your VM with:

          kw u

       After you start your VM you can ssh into it with:

          kw s -c="dmesg -wH"
          kw s

       <b>NOTE:</b>
          You have to wait for the sshd become ready.

</pre><h4><b>AUTHOR</b></h4><pre>
       Rodrigo Siqueira &lt;<a href="mailto:rodrigosiqueiramelo@gmail.com">rodrigosiqueiramelo@gmail.com</a>&gt;, Matheus Tavares &lt;<a href="mailto:matheus.bernardino@usp.br">matheus.bernardino@usp.br</a>&gt;

</pre><h4><b>COPYRIGHT</b></h4><pre>
       GPLv2+

                                                   2018-05-18                                              <u><a href="../man1/KW.1.html">KW</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>