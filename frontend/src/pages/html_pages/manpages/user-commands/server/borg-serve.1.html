<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>borg-serve - Start in server mode. This command is usually not used manually.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/borgbackup">borgbackup_1.2.0-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       borg-serve - Start in server mode. This command is usually not used manually.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       borg [common options] serve [options]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This command starts a repository server process. This command is usually not used manually.

</pre><h4><b>OPTIONS</b></h4><pre>
       See <u><a href="../man1/borg-common.1.html">borg-common</a>(1)</u> for common options of Borg commands.

   <b>optional</b> <b>arguments</b>
       <b>--restrict-to-path</b> <u>PATH</u>
              restrict  repository access to PATH. Can be specified multiple times to allow the client access to
              several directories. Access to all sub-directories is granted implicitly;  PATH  doesn't  need  to
              directly point to a repository.

       <b>--restrict-to-repository</b> <u>PATH</u>
              restrict  repository  access.  Only  the  repository  located  at  PATH  (no  sub-directories  are
              considered) is accessible. Can be specified multiple times to allow the client access  to  several
              repositories. Unlike <b>--restrict-to-path</b> sub-directories are not accessible; PATH needs to directly
              point at a repository location. PATH may be an empty directory or the last element of PATH may not
              exist, in which case the client may initialize a repository there.

       <b>--append-only</b>
              only  allow  appending  to  repository  segment  files.  Note that this only affects the low level
              structure  of  the  repository,  and  running  <u>delete</u>  or  <u>prune</u>  will  still  be   allowed.   See
              <u>append_only_mode</u> in Additional Notes for more details.

       <b>--storage-quota</b> <u>QUOTA</u>
              Override  storage  quota  of the repository (e.g. 5G, 1.5T). When a new repository is initialized,
              sets the storage quota on the new repository as well. Default: no quota.

</pre><h4><b>EXAMPLES</b></h4><pre>
       <b>borg</b> <b>serve</b> has special support for ssh forced  commands  (see  <b>authorized_keys</b>  example  below):  if  the
       environment  variable  SSH_ORIGINAL_COMMAND  is set it will ignore some options given on the command line
       and use the values from the variable instead. This only applies to a carefully  controlled  allowlist  of
       safe options. This list currently contains:

       • Options  that  control  the  log  level  and  debug  topics printed such as <b>--verbose</b>, <b>--info</b>, <b>--debug</b>,
         <b>--debug-topic</b>, etc.

       • <b>--lock-wait</b> to allow the client to control how long to wait before giving up and aborting the operation
         when another process is holding a lock.

       Environment variables (such as BORG_XXX) contained in the original command sent by  the  client  are  <u>not</u>
       interpreted,  but  ignored.  If BORG_XXX environment variables should be set on the <b>borg</b> <b>serve</b> side, then
       these must be set in system-specific locations like <b><a href="file:/etc/environment">/etc/environment</a></b> or  in  the  forced  command  itself
       (example below).

          # Allow an SSH keypair to only run borg, and only have access to /path/to/repo.
          # Use key options to disable unneeded and potentially dangerous SSH functionality.
          # This will help to secure an automated remote backup system.
          $ cat <a href="file:~/.ssh/authorized_keys">~/.ssh/authorized_keys</a>
          command="borg serve --restrict-to-path /path/to/repo",restrict ssh-rsa AAAAB3[...]

          # Set a BORG_XXX environment variable on the "borg serve" side
          $ cat <a href="file:~/.ssh/authorized_keys">~/.ssh/authorized_keys</a>
          command="export BORG_XXX=value; borg serve [...]",restrict ssh-rsa [...]

       <b>NOTE:</b>
          The  examples  above use the <b>restrict</b> directive. This does automatically block potential dangerous ssh
          features, even when they are added in a future update. Thus, this option should be preferred.

          If you're using openssh-server &lt; 7.2, however, you have to explicitly  specify  the  ssh  features  to
          restrict  and cannot simply use the restrict option as it has been introduced in v7.2. We recommend to
          use <b>no-port-forwarding,no-X11-forwarding,no-pty,no-agent-forwarding,no-user-rc</b> in this case.

       Details about sshd usage: <u><a href="../man8/sshd.8.html">sshd</a>(8)</u>

   <b>SSH</b> <b>Configuration</b>
       <b>borg</b> <b>serve</b>'s pipes (<b>stdin</b>/<b>stdout</b>/<b>stderr</b>) are connected to the <b>sshd</b> process on the  server  side.  In  the
       event  that the SSH connection between <b>borg</b> <b>serve</b> and the client is disconnected or stuck abnormally (for
       example, due to a network outage), it can take a long time for <b>sshd</b> to notice the client is disconnected.
       In the meantime, <b>sshd</b> continues running, and as a result so does the <b>borg</b> <b>serve</b> process holding the  lock
       on  the  repository.  This can cause subsequent <b>borg</b> operations on the remote repository to fail with the
       error: <b>Failed</b> <b>to</b> <b>create/acquire</b> <b>the</b> <b>lock</b>.

       In order to avoid this, it is recommended to perform the following additional SSH configuration:

       Either in the client side's <b><a href="file:~/.ssh/config">~/.ssh/config</a></b> file, or in the client's <b><a href="file:/etc/ssh/ssh_config">/etc/ssh/ssh_config</a></b> file:

          Host backupserver
                  ServerAliveInterval 10
                  ServerAliveCountMax 30

       Replacing <b>backupserver</b> with the hostname, FQDN or IP address of the borg server.

       This will cause the client to send a keepalive  to  the  server  every  10  seconds.  If  30  consecutive
       keepalives  are  sent  without  a  response  (a  time  of  300  seconds),  the ssh client process will be
       terminated, causing the borg process to terminate gracefully.

       On the server side's <b>sshd</b> configuration file (typically <b><a href="file:/etc/ssh/sshd_config">/etc/ssh/sshd_config</a></b>):

          ClientAliveInterval 10
          ClientAliveCountMax 30

       This will cause the server to send a keep alive to  the  client  every  10  seconds.  If  30  consecutive
       keepalives  are  sent  without  a  response  (a  time  of 300 seconds), the server's sshd process will be
       terminated, causing the <b>borg</b>  <b>serve</b>  process  to  terminate  gracefully  and  release  the  lock  on  the
       repository.

       If  you  then  run  borg  commands  with  <b>--lock-wait</b>  <b>600</b>, this gives sufficient time for the borg serve
       processes to terminate after the SSH connection is torn down after the 300 second wait for the keepalives
       to fail.

       You may, of course, modify the timeout values demonstrated above to values that suit your environment and
       use case.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/borg-common.1.html">borg-common</a>(1)</u>

</pre><h4><b>AUTHOR</b></h4><pre>
       The Borg Collective

                                                   2022-02-19                                      <u><a href="../man1/BORG-SERVE.1.html">BORG-SERVE</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>