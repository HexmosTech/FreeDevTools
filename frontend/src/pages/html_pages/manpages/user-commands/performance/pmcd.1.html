<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmcd - performance metrics collector daemon</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/pcp">pcp_6.3.3-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmcd</b> - performance metrics collector daemon

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pmcd</b>  [<b>-AfQSv?</b>]   [<b>-c</b> <u>config</u>] [<b>-C</b> <u>nctx</u>] [<b>-H</b> <u>hostname</u>] [<b>-i</b> <u>ipaddress</u>] [<b>-l</b> <u>logfile</u>] [<b>-L</b> <u>bytes</u>] [<b>-M</b> <u>nmetric</u>]
       [<b>-</b>[<b>n</b>|<b>N</b>] <u>pmnsfile</u>] [<b>-p</b> <u>port</u>[,<u>port</u> ...]]  [<b>-q</b> <u>timeout</u>]  [<b>-s</b>  <u>sockname</u>]  [<b>-t</b>  <u>timeout</u>]  [<b>-T</b>  <u>traceflag</u>]  [<b>-U</b>
       <u>username</u>] [<b>-x</b> <u>file</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pmcd</b> is the collector used by the Performance Co-Pilot (see <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1)) to gather performance metrics on
       a  system.   As a rule, there must be an instance of <b>pmcd</b> running on a system for any performance metrics
       to be available to the PCP.

       <b>pmcd</b> accepts connections from client applications running either on the  same  machine  or  remotely  and
       provides  them  with  metrics  and  other related information from the machine that <b>pmcd</b> is executing on.
       <b>pmcd</b> delegates most of this request servicing to a collection of Performance Metrics  Domain  Agents  (or
       just  agents),  where each agent is responsible for a particular group of metrics, known as the domain of
       the agent.  For instance, the <b>postgresql</b> agent is responsible for reporting information relating  to  the
       PostgreSQL  database,  such as the transaction and query counts, indexing and replication statistics, and
       so on.

       The agents may be processes started by <b>pmcd</b>, independent processes or Dynamic Shared Objects  (DSOs,  see
       <b><a href="../man3/dlopen.3.html">dlopen</a></b>(3))  attached  to <b>pmcd</b>'s address space.  The configuration section below describes how connections
       to agents are specified.

       Note that if a PDU exchange with an agent times out, the agent  has  violated  the  requirement  that  it
       delivers  metrics  with  little  or  no  delay.   This  is  deemed  a  protocol  failure and the agent is
       disconnected from <b>pmcd</b>.  Any subsequent requests for information from the agent will fail with  a  status
       indicating that there is no agent to provide it.

       It  is  possible  to specify access control to <b>pmcd</b> based on users, groups and hosts.  This allows one to
       prevent users, groups of users, and certain hosts from accessing the metrics  provided  by  <b>pmcd</b>  and  is
       described in more detail in the access control section below.

</pre><h4><b>OPTIONS</b></h4><pre>
       The available command line options are:

       <b>-A</b>   Disable  service  advertisement.   By default, <b>pmcd</b> will advertise its presence on the network using
            any available mechanisms (such as Avahi/DNS-SD), assisting remote monitoring tools with finding  it.
            These mechanisms are disabled with this option.

       <b>-c</b> <u>config</u>, <b>--config</b>=<u>config</u>
            On startup <b>pmcd</b> uses a configuration file from either the <u>$PCP_PMCDCONF_PATH</u>, configuration variable
            in  <u>/etc/pcp.conf</u>,  or  an  environment  variable  of  the  same name.  However, these values may be
            overridden with <u>config</u> using this option.  The format of this configuration file is described below.

       <b>-C</b> <u>nctx</u>, <b>--maxctx</b>=<u>nctx</u>
            Each client of <b>pmcd</b> may create one  or  more  contexts.   The  number  of  contexts  per  client  is
            restricted  to a maximum of 64 by default to defend against Denial of Service attacks through memory
            and file descriptor depletion.  The <b>-C</b> option may be used to change the maximum to <u>nctx</u> contexts.

       <b>-f</b>, <b>--foreground</b>
            By default <b>pmcd</b> is started as a daemon.   The  <b>-f</b>  option  indicates  that  it  should  run  in  the
            foreground.  This is most useful when trying to diagnose problems with misbehaving agents.

       <b>-H</b> <u>hostname</u>, <b>--hostname</b>=<u>hostname</u>
            This option can be used to set the hostname that <b>pmcd</b> will use to represent this instance of itself.
            This is used by client tools like <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) when reporting on the (possibly remote) host.  If this
            option is not set, the pmcd.hostname metric will match that returned by <b><a href="../man1/pmhostname.1.html">pmhostname</a></b>(1).  Refer to the
            manual page for that tool for full details on how the hostname is evaluated.

       <b>-i</b> <u>ipaddress</u>, <b>--interface</b>=<u>ipaddress</u>
            This  option  is  usually only used on hosts with more than one network interface.  If no <b>-i</b> options
            are specified <b>pmcd</b> accepts connections made to any of its host's IP (Internet  Protocol)  addresses.
            The  <b>-i</b>  option  is used to specify explicitly an IP address that connections should be accepted on.
            <u>ipaddress</u> should be in the standard dotted form (e.g. 100.23.45.6).   The  <b>-i</b>  option  may  be  used
            multiple  times  to  define  a list of IP addresses.  Connections made to any other IP addresses the
            host has will be refused.  This can be used to limit connections to one  network  interface  if  the
            host  is a network gateway.  It is also useful if the host takes over the IP address of another host
            that has failed.  In such a situation only the standard IP addresses of the  host  should  be  given
            (not  the  ones  inherited  from the failed host).  This allows PCP applications to determine that a
            host has failed, rather than connecting to the host that has assumed  the  identity  of  the  failed
            host.

       <b>-l</b> <u>logfile</u>, <b>--log</b>=<u>logfile</u>
            By  default  a log file named <u>pmcd.log</u> is written in the directory <b>$PCP_LOG_DIR/pmcd</b>.  The <b>-l</b> option
            causes the log file to be written to <u>logfile</u> instead of the default.  If  the  log  file  cannot  be
            created or is not writable, output is written to the standard error instead.

       <b>-L</b> <u>bytes</u>, <b>--maxbytes</b>=<u>bytes</u>
            <u>PDU</u>s  received  by  <b>pmcd</b>  from monitoring clients are restricted to a maximum size of 65536 bytes by
            default to defend against Denial of Service attacks.  The <b>-L</b>  option  may  be  used  to  change  the
            maximum incoming <u>PDU</u> size.

       <b>-M</b> <u>nmetric</u>, <b>--maxmetric</b>=<u>nmetric</u>
            Each  <b>fetch</b>  received by <b>pmcd</b> from monitoring clients is restricted to a maximum of 32768 metrics by
            default to defend against Denial of Service attacks through memory depletion.  The <b>-M</b> option may  be
            used to change the maximum to <u>nmetric</u> metrics.

       <b>-n</b> <u>pmnsfile</u>, <b>--namespace</b>=<u>pmnsfile</u>
            Normally  <b>pmcd</b>  loads the default Performance Metrics Name Space (PMNS) from <b>$PCP_VAR_DIR/pmns/root</b>,
            however if the <b>-n</b> option is specified an alternative namespace is loaded from the file <u>pmnsfile</u>.

       <b>-N</b> <u>pmnsfile</u>, <b>--uniqnames</b>=<u>pmnsfile</u>
            Same function as <b>-n</b>, except for the handling of duplicate Performance Metric Identifiers (PMIDs)  in
            <u>pmnsfile</u> - duplicate names are allowed with <b>-n</b> but they are not allowed with <b>-N</b>.

       <b>-p</b> <u>port</u>, <b>--port</b>=<u>port</u>
            Specify port to listen on.  By default port <b>44321</b> is used.

       <b>-q</b> <u>timeout</u>
            The  pmcd  to  agent  version  exchange  protocol  (new  in PCP 2.0 - introduced to provide backward
            compatibility) uses this timeout to specify how long  pmcd  should  wait  before  assuming  that  no
            version response is coming from an agent.  If this timeout is reached, the agent is assumed to be an
            agent  which  does  not  understand  the  PCP  2.0  protocol.  The default timeout interval is three
            seconds, but the <b>-q</b> option allows an alternative timeout interval (which must be greater than  zero)
            to  be  specified.   The  unit  of  <u>timeout</u>  is  seconds.   Alternatively,  if  <b>-q</b>  is not used, the
            <b>PMCD_CREDS_TIMEOUT</b> environment variable may be used to define the timeout interval.

       <b>-Q</b>, <b>--remotecert</b>
            Require that all remote client connections provide a certificate.

       <b>-s</b> <u>sockname</u>, <b>--socket</b>=<u>sockname</u>
            Specify the path to a local unix domain socket (for platforms supporting this socket  family  only).
            The default value is <u>$PCP_RUN_DIR/pmcd.socket</u>.

       <b>-S</b>, <b>--reqauth</b>
            Require  that  all  client  connections  provide user credentials.  This means that only unix domain
            sockets, or authenticated connections are permitted (requires secure sockets support).  If any  user
            or group access control requirements are specified in the pmcd configuration file, then this mode of
            operation is automatically entered, whether the <b>-S</b> flag is specified or not.

       <b>-t</b> <u>timeout</u>
            To  prevent  misbehaving  clients  or  agents from hanging the entire Performance Metrics Collection
            System (PMCS), <b>pmcd</b> uses timeouts on PDU exchanges with clients and agents running as processes.  By
            default the timeout interval is five seconds.  The <b>-t</b> option allows an alternative timeout  interval
            in  seconds  to be specified.  If <u>timeout</u> is zero, timeouts are turned off.  It is almost impossible
            to use the debugger interactively on an agent unless timeouts have been turned off for its  "parent"
            <b>pmcd</b>.

            Once  <b>pmcd</b>  is  running,  the  timeout  may be dynamically modified by storing an integer value (the
            timeout in seconds) into the metric <b>pmcd.control.timeout</b> via <b><a href="../man1/pmstore.1.html">pmstore</a></b>(1).

       <b>-T</b> <u>traceflag</u>, <b>--trace</b>=<u>traceflag</u>
            To assist with error diagnosis for agents and/or clients of <b>pmcd</b> that are not behaving correctly, an
            internal event tracing mechanism is supported within <b>pmcd</b>.  The value of <u>traceflag</u> is interpreted as
            a bit field with the following control functions:

            <b>1</b>   enable client connection tracing
            <b>2</b>   enable PDU tracing
            <b>256</b> unbuffered event tracing

            By default, event tracing is buffered using a circular buffer that is over-written as new events are
            recorded.  The default buffer size holds the last 20 events, although this number may be over-ridden
            by using <b><a href="../man1/pmstore.1.html">pmstore</a></b>(1) to modify the metric <b>pmcd.control.tracebufs</b>.

            Similarly once <b>pmcd</b> is running, the event tracing control may be dynamically modified by  storing  1
            (enable)   or  0  (disable)  into  the  metrics  <b>pmcd.control.traceconn</b>,  <b>pmcd.control.tracepdu</b>  and
            <b>pmcd.control.tracenobuf</b>.  These metrics map to the bit fields associated with the <u>traceflag</u> argument
            for the <b>-T</b> option.

            When operating in buffered mode, the event trace buffer will be dumped whenever an agent  connection
            is  terminated  by  <b>pmcd</b>,  or  when  any  value is stored into the metric <b>pmcd.control.dumptrace</b> via
            <b><a href="../man1/pmstore.1.html">pmstore</a></b>(1).

            In unbuffered mode, <b>every</b> event will be reported when it occurs.

       <b>-U</b> <u>username</u>, <b>--username</b>=<u>USER</u>
            User account under which to run <b>pmcd</b>.  The default is the  unprivileged  "pcp"  account  in  current
            versions of PCP, but in older versions the superuser account ("root") was used by default.

       <b>-v</b>, <b>--verify</b>
            Verify  the  <b>pmcd</b>  configuration file, reporting on any errors then exiting with a status indicating
            verification success or failure.

       <b>-x</b> <u>file</u>
            Before the <b>pmcd</b> <u>logfile</u> can be opened, <b>pmcd</b> may encounter a  fatal  error  which  prevents  it  from
            starting.  By default, the output describing this error is sent to <b>/dev/tty</b> but it may redirected to
            <u>file</u>.

       <b>-?</b>, <b>--help</b>
            Display usage message and exit.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       On  startup  <b>pmcd</b>  looks  for  a  configuration file named <u>$PCP_PMCDCONF_PATH</u>.  This file specifies which
       agents cover which performance metrics domains and how <b>pmcd</b> should make  contact  with  the  agents.   An
       optional section specifying access controls may follow the agent configuration data.

       <b>Warning</b>:  <b>pmcd</b>  is  usually  started  as  part  of  the  boot  sequence  and runs initially as root.  The
       configuration file may contain shell commands to create agents, which  will  be  executed  by  root.   To
       prevent  security  breaches  the configuration file should be writable only by root.  The use of absolute
       path names is also recommended.

       The case of the reserved words in the configuration file is  unimportant,  but  elsewhere,  the  case  is
       preserved.

       Blank  lines  and  comments  are permitted (even encouraged) in the configuration file.  A comment begins
       with a ``#'' character and finishes at the end of the line.  A line may be continued by ensuring that the
       last character on the line is a ``\'' (backslash).  A comment on a continued line ends at the end of  the
       continued  line.   Spaces  may  be included in lexical elements by enclosing the entire element in double
       quotes.  A double quote preceded by a backslash is always a literal double  quote.   A  ``#''  in  double
       quotes  or  preceded  by  a  backslash  is treated literally rather than as a comment delimiter.  Lexical
       elements and separators are described further in the following sections.

</pre><h4><b>AGENT</b> <b>CONFIGURATION</b></h4><pre>
       Each line of the agent configuration section of the configuration file contains details of how to connect
       <b>pmcd</b> to one of its agents and specifies which metrics domain the agent  deals  with.   An  agent  may  be
       attached as a DSO, or via a socket, or a pair of pipes.

       Each  line  of  the  agent  configuration  section  of  the  configuration  file  must be either an agent
       specification, a comment, or a blank line.  Lexical elements  are  separated  by  whitespace  characters,
       however  a  single  agent  specification  may  not  be  broken across lines unless a backslash is used to
       continue the line.

       Each agent specification must start with a textual label (string) followed by an integer in the  range  1
       to 510.  The label is a tag used to refer to the agent and the integer specifies the domain for which the
       agent  supplies  data.   This domain identifier corresponds to the domain portion of the PMIDs handled by
       the agent.  Each agent must have a unique label and domain identifier.

       For DSO agents a line of the form:

              <u>label</u> <u>domain-no</u> <b>dso</b> <u>entry-point</u> <u>path</u>

       should appear.  Where,

       <u>label</u>         is a string identifying the agent
       <u>domain-no</u>     is an unsigned integer specifying the agent's domain in the range 1 to 510
       <u>entry-point</u>   is the name of an initialization function which will be called when the DSO is loaded
       <u>path</u>          designates the location of the DSO and this is expected to be an absolute  pathname.   <b>pmcd</b>
                     is  only able to load DSO agents that have the same <u>simabi</u> (Subprogram Interface Model ABI,
                     or calling conventions) as  it  does  (i.e.  only  one  of  the  <u>simabi</u>  versions  will  be
                     applicable).   The  <u>simabi</u>  version  of  a  running  <b>pmcd</b>  may  be  determined  by fetching
                     <b>pmcd.simabi</b>.  Alternatively, the <b><a href="../man1/file.1.html">file</a></b>(1) command  may  be  used  to  determine  the  <u>simabi</u>
                     version from the <b>pmcd</b> executable.

                     For  a  relative <u>path</u> the environment variable <b>PMCD_PATH</b> defines a colon (:) separated list
                     of directories to search when trying to locate the agent DSO.  The default search  path  is
                     <b>$PCP_SHARE_DIR/lib:/usr/pcp/lib</b>.

       For agents providing socket connections, a line of the form

              <u>label</u> <u>domain-no</u> <b>socket</b> <u>addr_family</u> <u>address</u> [ <u>command</u> ]

       should appear.  Where,

       <u>label</u>         is a string identifying the agent
       <u>domain-no</u>     is an unsigned integer specifying the agent's domain in the range 1 to 510
       <u>addr_family</u>   designates  whether  the  socket  is  in  the  <b>AF_INET,</b> <b>AF_INET6</b> or <b>AF_UNIX</b> domain, and the
                     corresponding values for this parameter are <b>inet,</b> <b>ipv6</b> and <b>unix</b> respectively.
       <u>address</u>       specifies the address of the socket within the previously specified <u>addr_family.</u>  For  <b>unix</b>
                     sockets,  the  address  should  be the name of an agent's socket on the local host (a valid
                     address for the UNIX domain).  For <b>inet</b> and <b>ipv6</b> sockets, the address may be either a  port
                     number or a port name which may be used to connect to an agent on the local host.  There is
                     no  syntax for specifying an agent on a remote host as a <b>pmcd</b> deals only with agents on the
                     same machine.
       <u>command</u>       is an optional parameter used to specify a command  line  to  start  the  agent  when  <b>pmcd</b>
                     initializes.   If <u>command</u> is not present, <b>pmcd</b> assumes that the specified agent has already
                     been created.  The <u>command</u> is considered to start from the first non-white character  after
                     the  socket  address  and  finish  at  the next newline that isn't preceded by a backslash.
                     After a <b><a href="../man2/fork.2.html">fork</a></b>(2) the <u>command</u> is passed unmodified to <b><a href="../man2/execve.2.html">execve</a></b>(2) to instantiate the agent.

       For agents interacting with the <b>pmcd</b> via stdin/stdout, a line of the form:

              <u>label</u> <u>domain-no</u> <b>pipe</b> <u>protocol</u> <u>command</u>

       should appear.  Where,

       <u>label</u>         is a string identifying the agent
       <u>domain-no</u>     is an unsigned integer specifying the agent's domain
       <u>protocol</u>      The value for this parameter should be <b>binary</b>.

                     Additionally, the <u>protocol</u> can include the <b>notready</b> keyword to indicate that the agent must
                     be marked as not being ready to process requests from  <b>pmcd</b>.   The  agent  will  explicitly
                     notify the <b>pmcd</b> when it is ready to process the requests by sending a <b>PM_ERR_PMDAREADY</b> PDU.
                     For  further  details  of this protocol, including a description of the IPC parameters that
                     can be specified in a PMDA <b>Install</b> script with the <b>ipc_prot</b>  parameter,  see  the  relevant
                     section in <b><a href="../man3/PMDA.3.html">PMDA</a></b>(3).

       <u>command</u>       specifies  a  command  line to start the agent when <b>pmcd</b> initializes.  Note that <u>command</u> is
                     mandatory for pipe-based agents.  The <u>command</u> is considered to start from  the  first  non-
                     white  character  after  the  <u>protocol</u>  parameter and finish at the next newline that isn't
                     preceded by a backslash.  After a <b><a href="../man2/fork.2.html">fork</a></b>(2) the <u>command</u> is passed unmodified to <b><a href="../man2/execve.2.html">execve</a></b>(2)  to
                     instantiate the agent.

</pre><h4><b>ACCESS</b> <b>CONTROL</b> <b>CONFIGURATION</b></h4><pre>
       The access control section of the configuration file is optional, but if present it must follow the agent
       configuration  data.   The  case  of reserved words is ignored, but elsewhere case is preserved.  Lexical
       elements in the access control section are separated by whitespace or the special  delimiter  characters:
       square  brackets  (``['' and ``]''), braces (``{'' and ``}''), colon (``:''), semicolon (``;'') and comma
       (``,'').  The special characters are not treated as special in the agent configuration section.   Lexical
       elements may be quoted (double quotes) as necessary.

       The access control section of the file must start with a line of the form:

       <b>[access]</b>

       In  addition  to  (or  instead  of)  the  access  section  in the <b>pmcd</b> configuration file, access control
       specifications are also read from a file having the same name as the <b>pmcd</b> configuration  file,  but  with
       '.access' appended to the name.  This optional file must not contain the <b>[access]</b> keyword.

       Leading  and  trailing  whitespace  may  appear around and within the brackets and the case of the <b>access</b>
       keyword is ignored.  No other text may appear on the line except a trailing comment.

       Following this line, the remainder of the configuration file should contain lines that allow or  disallow
       operations from particular hosts or groups of hosts.

       There are two kinds of operations that occur via <b>pmcd</b>:

       <b>fetch</b>          allows  retrieval  of information from <b>pmcd</b>.  This may be information about a metric (e.g.
                      its description, instance domain, labels or help text) or  a  value  for  a  metric.   See
                      <b><a href="../man1/pminfo.1.html">pminfo</a></b>(1) for further information.

       <b>store</b>          allows  <b>pmcd</b>  to  be  used  to store metric values in agents that permit store operations.
                      This may be  the  actual  value  of  the  metric  (e.g.  resetting  a  counter  to  zero).
                      Alternatively,  it may be a value used by the PMDA to introduce a change to some aspect of
                      monitoring of that metric (e.g. server side event filtering) - possibly even only for  the
                      active  client  tool  performing  the store operation, and not others.  See <b><a href="../man1/pmstore.1.html">pmstore</a></b>(1) for
                      further information.

       Access to <b>pmcd</b> can be granted in three ways - by user, group of users,  or  at  a  host  level.   In  the
       latter, all users on a host are granted the same level of access, unless the user or group access control
       mechanism is also in use.

       User  names  and  group  names  will be verified using the local <b><a href="file:/etc/passwd">/etc/passwd</a></b> and <b>/etc/groups</b> files (or an
       alternative directory service), using the <b><a href="../man3/getpwent.3.html">getpwent</a></b>(3) and <b><a href="../man3/getgrent.3.html">getgrent</a></b>(3) routines.

       Hosts may be identified by name,  IP  address,  IPv6  address  or  by  the  special  host  specifications
       ``"unix:"''  or  ``"local:"''.   ``"unix:"'' refers to <b>pmcd's</b> unix domain socket, on supported platforms.
       ``"local:"'' is equivalent to specifying ``"unix:"'' and ``localhost``.

       Wildcards may also be specified by ending the host identifier with the single wildcard character ``*'' as
       the last-given component of an address.  The wildcard ``".*"'' refers to all inet (IPv4) addresses.   The
       wildcard  ``":*"''  refers  to all IPv6 addresses.  If an IPv6 wildcard contains a ``::'' component, then
       the final ``*'' refers to the final 16 bits of the address only, otherwise it  refers  to  the  remaining
       unspecified bits of the address.

       The wildcard ``*'' refers to all users, groups or host addresses, including ``"unix:"''.  Names of users,
       groups or hosts may not be wildcarded.

       The following are all valid host identifiers:

            boing
            localhost
            giggle.melbourne.sgi.com
            129.127.112.2
            129.127.114.*
            129.*
            .*
            fe80::223:14ff:feaf:b62c
            fe80::223:14ff:feaf:*
            fe80:*
            :*
            "unix:"
            "local:"
            *

       The following are not valid host identifiers:

            *.melbourne
            129.127.*.*
            129.*.114.9
            129.127*
            fe80::223:14ff:*:*
            fe80::223:14ff:*:b62c
            fe80*

       The  first example is not allowed because only (numeric) IP addresses may contain a wildcard.  The second
       and fifth examples are not valid because there is more than one wildcard character.  The third and  sixth
       contain  an  embedded  wildcard,  the  fourth  and seventh have a wildcard character that is not the last
       component of the address (the last components are 127* and fe80* respectively).

       The name <b>localhost</b> is given special treatment to  make  the  behavior  of  host  wildcarding  consistent.
       Rather  than being 127.0.0.1 and ::1, it is mapped to the primary inet and IPv6 addresses associated with
       the name of the host on which <b>pmcd</b> is running.  Beware of this when running <b>pmcd</b> on multi-homed hosts.

       Access for users, groups or hosts are allowed or disallowed by specifying statements of the form:

              <b>allow</b> <b>users</b> <u>userlist</u> <b>:</b> <u>operations</u> <b>;</b>
              <b>disallow</b> <b>users</b> <u>userlist</u> <b>:</b> <u>operations</u> <b>;</b>
              <b>allow</b> <b>groups</b> <u>grouplist</u> <b>:</b> <u>operations</u> <b>;</b>
              <b>disallow</b> <b>groups</b> <u>grouplist</u> <b>:</b> <u>operations</u> <b>;</b>
              <b>allow</b> <b>hosts</b> <u>hostlist</u> <b>:</b> <u>operations</u> <b>;</b>
              <b>disallow</b> <b>hosts</b> <u>hostlist</u> <b>:</b> <u>operations</u> <b>;</b>

       <u>list</u>          <u>userlist</u>, <u>grouplist</u> and <u>hostlist</u> are comma separated lists of one or more users, groups  or
                     host identifiers.

       <u>operations</u>    is   a   comma   separated  list  of  the  operation  types  described  above,  <b>all</b>  (which
                     allows/disallows all operations), or <b>all</b>  <b>except</b>  <u>operations</u>  (which  allows/disallows  all
                     operations except those listed).

       Either  plural  or  singular  forms of <b>users</b>, <b>groups</b>, and <b>hosts</b> keywords are allowed.  If this keyword is
       omitted, a default of <b>hosts</b> will be used.  This behaviour  is  for  backward-compatibility  only,  it  is
       preferable to be explicit.

       Where  no  specific  <b>allow</b>  or  <b>disallow</b>  statement  applies to an operation, the default is to allow the
       operation from all users, groups and hosts.  In the trivial case when there is no access control  section
       in the configuration file, all operations from all users, groups, and hosts are permitted.

       If  a  new  connection to <b>pmcd</b> is attempted by a user, group or host that is not permitted to perform any
       operations, the connection will be closed immediately after an error response <b>PM_ERR_PERMISSION</b> has  been
       sent to the client attempting the connection.

       Statements  with  the same level of wildcarding specifying identical hosts may not contradict each other.
       For example if a host named <b>clank</b> had an IP address of 129.127.112.2, specifying the following two  rules
       would be erroneous:

            allow host clank : fetch, store;
            disallow host 129.127.112.2 : all except fetch;

       because  they  both  refer  to the same host, but disagree as to whether the <b>fetch</b> operation is permitted
       from that host.

       Statements containing more specific host specifications override less  specific  ones  according  to  the
       level of wildcarding.  For example a rule of the form

            allow host clank : all;

       overrides

            disallow host 129.127.112.* : all except fetch;

       because  the  former  contains a specific host name (equivalent to a fully specified IP address), whereas
       the latter has a wildcard.  In turn, the latter would override

            disallow host * : all;

       It is possible to limit the number of connections from a user, group or host to <b>pmcd</b>.  This may  be  done
       by adding a clause of the form

              <b>maximum</b> <u>n</u> <b>connections</b>

       to  the  <u>operations</u>  list  of an <b>allow</b> statement.  Such a clause may not be used in a <b>disallow</b> statement.
       Here, <u>n</u> is the maximum number of connections that will be accepted from the user, group or host  matching
       the identifier(s) used in the statement.

       An  access  control  statement  with  a list of user, group or host identifiers is equivalent to a set of
       access control statements, with each specifying one of the identifiers in the list and all with the  same
       access  controls  (both  permissions and connection limits).  A group should be used if you want users to
       contribute to a shared connection limit.  A wildcard should be used if you want hosts to contribute to  a
       shared connection limit.

       When  a  new  client  requests  a  connection,  and <b>pmcd</b> has determined that the client has permission to
       connect, it searches the matching  list  of  access  control  statements  for  the  most  specific  match
       containing  a connection limit.  For brevity, this will be called the limiting statement.  If there is no
       limiting statement, the client is granted a connection.  If there is a limiting statement and the  number
       of  <b>pmcd</b>  clients  with  user  ID,  group  ID,  or IP addresses that match the identifier in the limiting
       statement is less than the connection limit in the statement, the connection is allowed.   Otherwise  the
       connection limit has been reached and the client is refused a connection.

       Group  access  controls  and  the wildcarding in host identifiers means that once <b>pmcd</b> actually accepts a
       connection from a client, the connection may contribute to the current connection count of more than  one
       access  control  statement  -  the  client's  host  may match more than one access control statement, and
       similarly the user ID may be in more than one group.  This may be significant for  subsequent  connection
       requests.

       Note  that <b>pmcd</b> enters a mode where it runs effectively with a higher-level of security as soon as a user
       or group access control section  is  added  to  the  configuration.   In  this  mode  only  authenticated
       connections  are  allowed  -  either from a SASL authenticated connection, or a Unix domain socket (which
       implicitly passes client credentials).  This is the same mode that is entered  explicitly  using  the  <b>-S</b>
       option.   Assuming  permission  is  allowed,  one  can  determine whether <b>pmcd</b> is running in this mode by
       querying the value of the <u>pmcd.feature.creds_required</u> metric.

       Note also that because most specific match semantics are used when checking the connection limit, for the
       host-based access control case, priority is given to clients with more specific host identifiers.  It  is
       also possible to exceed connection limits in some situations.  Consider the following:

              allow host clank : all, maximum 5 connections;
              allow host * : all except store, maximum 2 connections;

       This  says that only 2 client connections at a time are permitted for all hosts other than "clank", which
       is permitted 5.  If a client from host "boing" is the first to connect to <b>pmcd</b>, its connection is checked
       against the second statement (that is the most specific match with a connection limit).  As there are  no
       other clients, the connection is accepted and contributes towards the limit for only the second statement
       above.   If  the  next  client connects from "clank", its connection is checked against the limit for the
       first statement.  There are no other connections from "clank", so the connection is accepted.  Once  this
       connection  is  accepted,  it  counts  towards  <b>both</b>  statements' limits because "clank" matches the host
       identifier in both statements.  Remember that the decision to accept a new connection is made using  only
       the  most  specific matching access control statement with a connection limit.  Now, the connection limit
       for the second statement has been reached.  Any  connections  from  hosts  other  than  "clank"  will  be
       refused.

       If  instead,  <b>pmcd</b>  with  no clients saw three successive connections arrived from "boing", the first two
       would be accepted and the third refused.  After that, if a connection was requested from "clank" it would
       be accepted.  It matches the first statement, which is more specific than the second, so  the  connection
       limit  in  the  first  is  used  to  determine that the client has the right to connect.  Now there are 3
       connections contributing to the second statement's connection limit.  Even though  the  connection  limit
       for  the  second  statement  has been exceeded, the earlier connections from "boing" are maintained.  The
       connection limit is only checked at the time a  client  attempts  a  connection  rather  than  being  re-
       evaluated every time a new client connects to <b>pmcd</b>.

       This  gentle  scheme  is  designed  to allow reasonable limits to be imposed on a first come first served
       basis, with specific exceptions.

       As illustrated by the example above, a  client's  connection  is  honored  once  it  has  been  accepted.
       However,  <b>pmcd</b>  reconfiguration  (see  the  next section) re-evaluates all the connection counts and will
       cause client connections to be dropped where connection limits have been exceeded.

</pre><h4><b>AGENT</b> <b>FENCING</b></h4><pre>
       Preventing sampling during the life of a PMDA is  sometimes  desirable,  for  example  if  that  sampling
       impacts  on  sensitive phases of a scheduled job.  A temporary ``fence'' can be raised to block all PMAPI
       client access to one or more agents in this situation.  This functionality is provided  by  the  built-in
       PMCD PMDA and the <b><a href="../man1/pmstore.1.html">pmstore</a></b>(1) command, as in

            # pmstore -i nfsclient,kvm pmcd.agent.fenced 1

       If  the  optional  comma-separated  list of agent names is omitted, all agents will be fenced.  To resume
       normal operation, the ``fence'' can be lowered as follows

            # pmstore -i nfsclient,kvm pmcd.agent.fenced 0

       Lowering the fence for all PMDAs at once is performed using

            # pmstore pmcd.agent.fenced 0

       Elevated privileges are required to store to the <u>pmcd.agent.fenced</u> metric.  For  additional  information,
       see  the  help text associated with this metric, which can be accessed using the <u>-T</u><b>,</b> <b>--helptext</b> option to
       <b><a href="../man1/pminfo.1.html">pminfo</a></b>(1).

</pre><h4><b>RECONFIGURING</b> <b>PMCD</b></h4><pre>
       If the configuration file has been changed or if an agent is not responding because it has terminated  or
       the PMNS has been changed, <b>pmcd</b> may be reconfigured by sending it a SIGHUP, as in

            # pmsignal -a -s HUP pmcd

       When  <b>pmcd</b>  receives  a  SIGHUP,  it  checks  the  configuration  file for changes.  If the file has been
       modified, it is re-parsed and the contents become the new configuration.  If  there  are  errors  in  the
       configuration  file,  the  existing  configuration  is retained and the contents of the file are ignored.
       Errors are reported in the <b>pmcd</b> log file.

       It also checks the PMNS file and any labels files for changes.  If any of these files have been modified,
       then the PMNS and/or context labels are reloaded.  Use of <b><a href="../man1/tail.1.html">tail</a></b>(1) on the log file  is  recommended  while
       reconfiguring <b>pmcd</b>.

       If  the configuration for an agent has changed (any parameter except the agent's label is different), the
       agent is restarted.  Agents whose configurations do not change are not restarted.   Any  existing  agents
       not  present  in the new configuration are terminated.  Any deceased agents are that are still listed are
       restarted.

       Sometimes it is necessary to restart an agent that is still running, but malfunctioning.  Simply stop the
       agent (e.g. using SIGTERM from <b><a href="../man1/pmsignal.1.html">pmsignal</a></b>(1)), then send <b>pmcd</b> a SIGHUP, which will cause the  agent  to  be
       restarted.

</pre><h4><b>STARTING</b> <b>AND</b> <b>STOPPING</b> <b>PMCD</b></h4><pre>
       Normally,  <b>pmcd</b>  is started automatically at boot time and stopped when the system is being brought down.
       Under certain circumstances it is necessary to start or stop <b>pmcd</b> manually.  To do this one  must  become
       superuser and type

            # $PCP_RC_DIR/pmcd start

       to start <b>pmcd</b>, or

            # $PCP_RC_DIR/pmcd stop

       to  stop  <b>pmcd</b>.  Starting <b>pmcd</b> when it is already running is the same as stopping it and then starting it
       again.

       Sometimes it may be necessary to restart <b>pmcd</b> during another phase of the boot  process.   Time-consuming
       parts  of  the  boot  process  are  often put into the background to allow the system to become available
       sooner (e.g. mounting huge databases).  If an agent run by <b>pmcd</b> requires such a task to  complete  before
       it  can run properly, it is necessary to restart or reconfigure <b>pmcd</b> after the task completes.  Consider,
       for example, the case of mounting a database in the background while booting.  If the PMDA which provides
       the metrics about the database cannot function until the database is mounted and available  but  <b>pmcd</b>  is
       started  before  the  database is ready, the PMDA will fail (however <b>pmcd</b> will still service requests for
       metrics from other domains).  If the database is initialized by running a shell script, adding a line  to
       the  end  of  the script to reconfigure <b>pmcd</b> (by sending it a SIGHUP) will restart the PMDA (if it exited
       because it couldn't connect to the database).  If the PMDA didn't exit in such a situation  it  would  be
       necessary to restart <b>pmcd</b> because if the PMDA was still running <b>pmcd</b> would not restart it.

       Normally   <b>pmcd</b>   listens   for   client   connections   on  TCP/IP  port  number  44321  (registered  at
       <b><a href="http://www.iana.org/">http://www.iana.org/</a></b>).  Either the environment variable <b>PMCD_PORT</b> or the <b>-p</b> command line  option  may  be
       used  to  specify  alternative  port number(s) when <b>pmcd</b> is started; in each case, the specification is a
       comma-separated list of one or more numerical port numbers.  Should both methods be used or  multiple  <b>-p</b>
       options  appear  on the command line, <b>pmcd</b> will listen on the union of the set of ports specified via all
       <b>-p</b> options and the <b>PMCD_PORT</b> environment variable.  If non-default ports are used with <b>pmcd</b>  care  should
       be  taken  to  ensure  that  <b>PMCD_PORT</b> is also set in the environment of any client application that will
       connect to <b>pmcd</b>, or that the extended host specification syntax is used (see <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1) for details).

</pre><h4><b>CAVEATS</b></h4><pre>
       <b>pmcd</b> does not explicitly terminate its children (agents), it only closes their pipes.  If an agent  never
       checks for a closed pipe it may not terminate.

       The  configuration  file  parser  will only read lines of less than 1200 characters.  This is intended to
       prevent accidents with binary files.

       The timeouts controlled by the <b>-t</b> option apply to IPC between <b>pmcd</b> and the  PMDAs  it  spawns.   This  is
       independent  of  settings of the environment variables <b>PMCD_CONNECT_TIMEOUT</b> and <b>PMCD_REQUEST_TIMEOUT</b> (see
       <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1)) which may be used respectively to control timeouts for client applications trying to connect
       to <b>pmcd</b> and trying to receive information from <b>pmcd</b>.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       If <b>pmcd</b> is already running the message "Error: OpenRequestSocket bind: Address may  already  be  in  use"
       will  appear.   This  may also appear if <b>pmcd</b> was shutdown with an outstanding request from a client.  In
       this case, a request socket has been left in the TIME_WAIT state and until  the  system  closes  it  down
       (after some timeout period) it will not be possible to run <b>pmcd</b>.

       In addition to the standard <b>PCP</b> debugging flags, see <b><a href="../man1/pmdbg.1.html">pmdbg</a></b>(1), <b>pmcd</b> currently uses the options: <b>appl0</b> for
       tracing  I/O  and  termination  of  agents,  <b>appl1</b>  for  tracing access control and <b>appl2</b> for tracing the
       configuration file scanner and parser.

</pre><h4><b>FILES</b></h4><pre>
       <u>$PCP_PMCDCONF_PATH</u>
            default configuration file

       <u>$PCP_PMCDCONF_PATH.access</u>
            optional access control specification file

       <u>$PCP_PMCDOPTIONS_PATH</u>
            command line options to <b>pmcd</b> when launched from <u>$PCP_RC_DIR/pmcd</u> All the command line  option  lines
            should start with a hyphen as the first character.

       <u>$PCP_SYSCONFIG_DIR/pmcd</u>
            Environment   variables   that  will  be  set  when  <b>pmcd</b>  executes.   Only  settings  of  the  form
            "PMCD_VARIABLE=value" or "PCP_VARIABLE=value" are honoured.

       <u>$PCP_SYSCONF_DIR/labels.conf</u>
            settings related to labels used globally throughout the PMCS.

       <u>$PCP_SYSCONF_DIR/labels</u>
            directory of files containing the global metric labels that will be set  for  every  client  context
            created  by  <b>pmcd</b>.   File names starting with a ``.'' are ignored, and files ending in ``.json'' are
            ``JSONB'' formatted name:value pairs.  The merged set can be queried  via  the  <b>pmcd.labels</b>  metric.
            Context labels are applied universally to all metrics.

       <u>$PCP_SYSCONF_DIR/labels/optional</u>
            directory  of  files  containing  the global metric labels that will be set for every client context
            created by <b>pmcd</b>, but which are flagged as optional.  These labels are  exactly  the  same  as  other
            context labels except that they are not used in time series identifier calculations.

       <u>./pmcd.log</u>
            (or <u>$PCP_LOG_DIR/pmcd/pmcd.log</u> when started automatically)
            All messages and diagnostics are directed here.

       <u>$PCP_RUN_DIR/pmcd.pid</u>
            contains an ascii decimal representation of the process ID of <b>pmcd</b>, when it's running.

       <u>/etc/pcp/tls.conf</u>
            OpenSSL   certificate  configuration  information  file,  used  for  optional  Secure  Socket  Layer
            connections.

       <u><a href="file:/etc/passwd">/etc/passwd</a></u>
            user names, user identifiers and primary group identifiers, used for access control specifications

       <u>/etc/groups</u>
            group names, group identifiers and group members, used for access control specifications

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       The following variables are set in <b>$PCP_SYSCONFIG_DIR/pmcd</b>.

       In addition to the PCP environment  variables  described  in  the  <b>PCP</b>  <b>ENVIRONMENT</b>  section  below,  the
       <b>PMCD_PORT</b>  variable  is  also recognised as the TCP/IP port for incoming connections (default <u>44321</u>), and
       the <b>PMCD_SOCKET</b> variable is also recognised as the path to be used for the Unix domain socket.

       If set to the value 1, the <b>PMCD_LOCAL</b> environment variable will cause <b>pmcd</b> to  run  in  a  localhost-only
       mode  of  operation, where it binds only to the loopback interface.  The <u>pmcd.feature.local</u> metric can be
       queried to determine if <b>pmcd</b> is running in this mode.

       The <b>PMCD_MAXPENDING</b> variable can be set to indicate the maximum length to  which  the  queue  of  pending
       client connections may grow.

       The  <b>PMCD_ROOT_AGENT</b> variable controls whether or not <b>pmcd</b> or <b>pmdaroot</b> (when available), start subsequent
       PMDAs.  When set to a non-zero value, <b>pmcd</b> will opt to have <b>pmdaroot</b> start, and stop, PMDAs.

       The <b>PMCD_RESTART_AGENTS</b> variable determines the behaviour of <b>pmcd</b> in the presence  of  child  PMDAs  that
       have  been  observed  to  exit (this is a typical response in the presence of very large, usually domain-
       induced, PDU latencies).  When set to a non-zero value, <b>pmcd</b> will attempt  to  restart  such  PMDAs  once
       every minute.  When set to zero, it uses the original behaviour of just logging the failure.

</pre><h4><b>PCP</b> <b>ENVIRONMENT</b></h4><pre>
       Environment  variables with the prefix <b>PCP_</b> are used to parameterize the file and directory names used by
       PCP.  On each installation, the file <u>/etc/pcp.conf</u> contains the local values for  these  variables.   The
       <b>$PCP_CONF</b> variable may be used to specify an alternative configuration file, as described in <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5).

       For environment variables affecting PCP tools, see <b><a href="../man3/pmGetOptions.3.html">pmGetOptions</a></b>(3).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1),  <b><a href="../man1/pmdbg.1.html">pmdbg</a></b>(1),  <b><a href="../man1/pmerr.1.html">pmerr</a></b>(1),  <b><a href="../man1/pmgenmap.1.html">pmgenmap</a></b>(1),  <b><a href="../man1/pminfo.1.html">pminfo</a></b>(1),  <b><a href="../man1/pmrep.1.html">pmrep</a></b>(1),  <b><a href="../man1/pmstat.1.html">pmstat</a></b>(1), <b><a href="../man1/pmstore.1.html">pmstore</a></b>(1), <b><a href="../man1/pmval.1.html">pmval</a></b>(1),
       <b><a href="../man3/getpwent.3.html">getpwent</a></b>(3), <b><a href="../man3/getgrent.3.html">getgrent</a></b>(3), <b><a href="../man5/labels.conf.5.html">labels.conf</a></b>(5), <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5), <b><a href="../man5/pcp.env.5.html">pcp.env</a></b>(5) and <b><a href="../man5/PMNS.5.html">PMNS</a></b>(5).

Performance Co-Pilot                                   PCP                                               <u><a href="../man1/PMCD.1.html">PMCD</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>