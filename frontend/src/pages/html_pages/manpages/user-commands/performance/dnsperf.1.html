<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dnsperf - test the performance of a DNS server</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/dnsperf">dnsperf_2.14.0-4_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       dnsperf - test the performance of a DNS server

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>dnsperf</b> [<b>-a</b> <u>local_addr</u>] [<b>-b</b> <u>bufsize</u>] [<b>-B</b>] [<b>-c</b> <u>clients</u>] [<b>-d</b> <u>datafile</u>] [<b>-D</b>] [<b>-e</b>] [<b>-E</b> <u>code:secret</u>]
       [<b>-f</b> <u>family</u>] [<b>-h</b>] [<b>-l</b> <u>limit</u>] [<b>-m</b> <u>mode</u>] [<b>-n</b> <u>runs_through_file</u>] [<b>-p</b> <u>port</u>] [<b>-q</b> <u>num_queries</u>] [<b>-Q</b> <u>max_qps</u>]
       [<b>-s</b> <u>server_addr</u>] [<b>-S</b> <u>stats_interval</u>] [<b>-t</b> <u>timeout</u>] [<b>-T</b> <u>threads</u>] [<b>-u</b>] [<b>-v</b>] [<b>-W</b>] [<b>-x</b> <u>local_port</u>]
       [<b>-y</b> <u>[alg:]name:secret</u>] [<b>-O</b> <u>option=value</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>dnsperf</b> is a DNS server performance testing tool.  It is primarily intended for measuring the performance
       of  authoritative  DNS  servers,  but  it  can also be used for measuring caching server performance in a
       closed laboratory environment.  For testing caching servers resolving against the live Internet, the <b>res‐</b>
       <b>perf</b> program is preferred.

       It is recommended that <b>dnsperf</b> and the name server under test be run on separate machines,  so  that  the
       CPU  usage  of  <b>dnsperf</b>  itself does not slow down the name server.  The two machines should be connected
       with a fast network, preferably a dedicated Gigabit Ethernet segment.  Testing through a router or  fire‐
       wall is not advisable.

   <b>Configuring</b> <b>the</b> <b>name</b> <b>server</b>
       If  using  <b>dnsperf</b>  to test an authoritative server, the name server under test should be set up to serve
       one or more zones similar in size and number to what the server is expected to serve in production.

       Also, be sure to turn off recursion in the server's configuration (in BIND 8/9, specify  "recursion  no;"
       in the options block).  In BIND 8, you should also specify "fetch-glue no;"; otherwise the server may at‐
       tempt to retrieve glue information from the Internet during the test, slowing it down by an unpredictable
       factor.

   <b>Constructing</b> <b>a</b> <b>query</b> <b>input</b> <b>file</b>
       A <b>dnsperf</b> input file should contain a large and realistic set of queries, on the order of ten thousand to
       a  million.   The input file contains one line per query, consisting of a domain name and an RR type name
       separated by a space.  The class of the query is implicitly IN.

       When measuring the performance serving non-terminal zones such as the root zone or TLDs, note  that  such
       servers  spend  most of their time providing referral responses, not authoritative answers.  Therefore, a
       realistic input file might consist mostly of queries for type A for names *below*, not  at,  the  delega‐
       tions  present  in  the zone.  For example, when testing the performance of a server configured to be au‐
       thoritative for the top-level domain "fi.", which contains delegations for domains like "helsinki.fi" and
       "turku.fi", the input file could contain lines like

              www.turku.fi A
              www.helsinki.fi A

       where the "www" prefix ensures that the server will respond with a referral.  Ideally, a  realistic  pro‐
       portion of queries for nonexistent domains should be mixed in with those for existing ones, and the lines
       of the input file should be in a random order.

   <b>Constructing</b> <b>a</b> <b>dynamic</b> <b>update</b> <b>input</b> <b>file</b>
       To  test dynamic update performance, <b>dnsperf</b> is run with the <b>-u</b> option, and the input file is constructed
       of blocks of lines describing dynamic update messages.  The first line in a block contains the zone name:

              example.com

       Subsequent lines contain prerequisites, if there are any.  Prerequisites can specify that a name  may  or
       may not exist, an rrset may or may not exist, or an rrset exists and its rdata matches all specified rda‐
       ta  for that name and type.  The keywords "require" and "prohibit" are followed by the appropriate infor‐
       mation.  All relative names are considered to be relative to the zone name.  The following lines show the
       5 types of prerequisites.

              require a
              require a A
              require a A 1.2.3.4
              prohibit x
              prohibit x A

       Subsequent lines contain records to be added, records to be deleted, rrsets to be deleted, or names to be
       deleted.  The keywords "add" or "delete" are followed by the appropriate information.  All relative names
       are considered to be relative to the zone name.  The following lines show the 4 types of updates.

              add x 3600 A 10.1.2.3
              delete y A 10.1.2.3
              delete z A
              delete w

       Each update message is terminated by a line containing the command:

              send

   <b>Running</b> <b>the</b> <b>tests</b>
       When running <b>dnsperf</b>, a data file (the <b>-d</b> option) and server (the <b>-s</b> option) will normally be  specified.
       The output of dnsperf is mostly self-explanatory.  Pay attention to the number of dropped packets report‐
       ed  -  when running the test over a local Ethernet connection, it should be zero.  If one or more packets
       has been dropped, there may be a problem with the network connection.  In that case, the  results  should
       be considered suspect and the test repeated.

   <b>Using</b> <b>DNS-over-HTTPS</b>
       When  using DNS-over-HTTPS you must set the <b>-O</b> <b>doh-uri=...</b> to something that works with the server you're
       sending to.  Also note that the value for maximum outstanding queries will be used to control the maximum
       concurrent streams within the HTTP/2 connection.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-a</b> <u>local_addr</u>
              Specifies the local address from which to send requests.  The default is the wildcard address.

       <b>-b</b> <u>bufsize</u>
              Sets the size of the socket's send and receive buffers, in kilobytes.  If not specified, the oper‐
              ating system's default is used.

       <b>-B</b>
              Instructs <b>dnsperf</b> to read datafile in TCP-stream binary format as specified by  RFC  1035  section
              "4.2.2.  TCP  usage".   Each  packet is preceded by 2-byte preambule which specifies length of the
              following DNS packet in network byte order, immediatelly followed by  raw  bytes  of  the  packet.
              First two bytes of any packet should contain message ID and are overwritten by <b>dnsperf</b> on the fly.
              All  other  bytes  are  left  intact.  Packets shorter than two bytes are sent intact.  Packets in
              datafile can contain arbitrary bytes and are not checked for validity.  Malformed packets probably
              will not be responded to by servers and will cause timeouts.  This option  is  mutually  exclusive
              with <b>-D</b>, <b>-e</b>, <b>-E</b>, <b>-u</b> and <b>-y</b>.

              These  binary  datafiles  can  be  generated using arbitrary TCP listeners such as <b>netcat</b> (nc) and
              <b>sockat</b>.  TCP must be used so that the length is prepended.  Following example shows how to  gener‐
              ate a datafile with two query and then using it, you need two terminals.

              (terminal 1) $ nc -l 127.0.0.1 5300 &gt; dns.blob
              (terminal 2) $ echo "example.com A" | dnsperf -s 127.0.0.1 -p 5300 -m tcp
              (terminal 1) $ nc -l 127.0.0.1 5300 &gt;&gt; dns.blob
              (terminal 2) $ echo "example.com AAAA" | dnsperf -s 127.0.0.1 -p 5300 -m tcp
              (terminal 1) $ dnsperf -B -d dns.blob -s $IP

       <b>-c</b> <u>clients</u>
              Act  as  multiple  clients.   Requests are sent from multiple sockets.  The default is to act as 1
              client.

       <b>-d</b> <u>datafile</u>
              Specifies the input data file.  If not specified, <b>dnsperf</b> will read from standard input.

       <b>-D</b>
              Sets the DO (DNSSEC OK) bit [RFC3225] in all packets sent.  This also enables EDNS0, which is  re‐
              quired for DNSSEC.  This option is mutually exclusive with <b>-B</b>.

       <b>-e</b>
              Enables EDNS0 [RFC2671], by adding an OPT record to all packets sent.  This option is mutually ex‐
              clusive with <b>-B</b>.

       <b>-E</b> <u>code:value</u>
              Add an EDNS [RFC2671] option to all packets sent, using the specified numeric option code and val‐
              ue  expressed as a a hex-encoded string.  This also enables EDNS0.  This option is mutually exclu‐
              sive with <b>-B</b>.

       <b>-f</b> <u>family</u>
              Specifies the address family used for sending DNS packets.  The possible values are  "inet",  "in‐
              et6",  or  "any".   If  "any" (the default value) is specified, <b>dnsperf</b> will use whichever address
              family is appropriate for the server it is sending packets to.

       <b>-h</b>
              Print a usage statement and exit.

       <b>-l</b> <u>limit</u>
              Specifies a time limit for the run, in seconds.  This may cause the  input  to  be  read  multiple
              times,  or only some of the input to be read.  The default behavior is to read the input once, and
              have no specific time limit.

       <b>-n</b> <u>runs_through_file</u>
              Run through the input file at most this many times.  If no time limit is set,  the  file  will  be
              read exactly this number of times; if a time limit is set, the file may be read fewer times.

       <b>-p</b> <u>port</u>
              Sets the port on which the DNS packets are sent.  If not specified, the standard DNS port (udp/tcp
              53, DoT 853, DoH 443) is used.

       <b>-q</b> <u>num_queries</u>
              Sets  the  maximum  number  of outstanding requests.  When this value is reached, <b>dnsperf</b> will not
              send any more requests until either responses are received or requests time out.  The default val‐
              ue is 100.

       <b>-Q</b> <u>max_qps</u>
              Limits the number of requests per second.  There is no default limit.

       <b>-m</b> <u>mode</u>
              Specifies the transport mode to use, "udp", "tcp", "dot" or "doh".  Default is "udp".

       <b>-s</b> <u>server_addr</u>
              Specifies the name or address of the server to which requests will be sent.  The  default  is  the
              loopback address, 127.0.0.1.

       <b>-S</b> <u>stats_interval</u>
              If  this  parameter  is specified, a count of the number of answers received per second during the
              interval will be printed out every <u>stats_interval</u> seconds.

       <b>-t</b> <u>timeout</u>
              Specifies the request timeout value, in seconds.  <b>dnsperf</b> will no longer wait for a response to  a
              particular request after this many seconds have elapsed.  The default is 5 seconds.

       <b>-T</b> <u>threads</u>
              Run  multiple  client  threads.   By default, <b>dnsperf</b> uses one thread for sending requests and one
              thread for receiving responses.  If this option is specified, <b>dnsperf</b> will instead use N pairs  of
              send/receive threads.

       <b>-u</b>
              Instructs <b>dnsperf</b> to send DNS dynamic update messages, rather than queries.  The format of the in‐
              put file is different in this case; see the "Constructing a dynamic update input file" section for
              more details.  This option is mutually exclusive with <b>-B</b>.

       <b>-v</b>
              Enables verbose mode.  The DNS RCODE of each response will be reported to standard output when the
              response  is  received,  as  will the latency.  If a query times out, it will be reported with the
              special string "T" instead of a normal DNS RCODE.  If a query is interrupted, it will be  reported
              with  the  special  string "I".  Additional information regarding network readiness and congestion
              will also be reported.

       <b>-W</b>
              Log warnings and errors to standard output instead of standard error making it easier for  script,
              test and automation to capture all output.

       <b>-x</b> <u>local_port</u>
              Specifies the local port from which to send requests.  The default is the wildcard port (0).

              If acting as multiple clients and the wildcard port is used, each client will use a different ran‐
              dom  port.  If a port is specified, the clients will use a range of ports starting with the speci‐
              fied one.

       <b>-y</b> <u>[alg:]name:secret</u>
              Add a TSIG record [RFC2845] to all packets sent, using the specified TSIG key algorithm, name  and
              secret,  where the algorithm defaults to hmac-md5 and the secret is expressed as a base-64 encoded
              string.  Available algorithms are: hmac-md5, hmac-sha1, hmac-sha224, hmac-sha256, hmac-sha384  and
              hmac-sha512.  This option is mutually exclusive with <b>-B</b>.

       <b>-O</b> <u>option=value</u>
              Set an extended long option for various things to control different aspects of testing or protocol
              modules, see EXTENDED OPTIONS for list of available options.

</pre><h4><b>EXTENDED</b> <b>OPTIONS</b></h4><pre>
       <b>doh-uri=</b><u>URI</u>
              The URI to use for DNS-over-HTTPS, default value is "https://localhost/dns-query".

       <b>doh-method=</b><u>HTTP_METHOD</u>
              The  HTTP method to use when querying with DNS-over-HTTPS, default is GET.  Available methods are:
              GET, POST.

       <b>tls-sni=</b><u>SERVER_NAME</u>
              The Server Name Indication (SNI) to use for TLS connections (such  as  DNS-over-TLS  or  DNS-over-
              HTTPS), defaults to leaving out the SNI extension in the client hello.

       <b>suppress=</b><u>MESSAGE[,MESSAGE,...]</u>
              Suppress  various  messages and warnings that may be shown excessively in some situations, such as
              socket readiness when connecting to a slow service.  Can suppress multiple types by  listing  them
              as a comma separated list.  Following type are available.

              <b>timeouts</b>: Suppress messages about queries being timed out
              <b>congestion</b>: Suppress messages about network congestion
              <b>sendfailed</b>:  Suppress  messages  about failure to send packets or if only parts of the packet were
              sent
              <b>sockready</b>: Suppress messages about socket readiness
              <b>unexpected</b>: Suppress messages about answers with an unexpected message ID
       <b>num-queries-per-conn=</b><u>NUMBER</u>
              This will limit the number of queries sent over a connection before  triggering  a  re-connection.
              Once  re-connected  it  will  reset  the  counter  and continue sending queries until the limit is
              reached again, triggering another re-connection and so on.  Using this  option  will  also  enable
              counting  number of responses received for each connection and once the limit is reached for send‐
              ing queries it will wait until the same amount of responses has been received  before  re-connect‐
              ing.   Waiting for responses may timeout and the timeout used for this is the same as specified by
              <b>-t</b>.  Note that this option is only useful for connection oriented protocols.

       <b>verbose-interval-stats</b>
              Change the statistics format of <b>-S</b> to that shown at end of run.

              <u>Please</u> <u>note</u>: Min/max values for latency and connections are not available in interval  statistics.
              Number  of  answers received within <u>stats_interval</u> can legitimately exceed number of queries sent,
              depending on answer latency, configured <u>timeout</u>, and <u>stats_interval</u>.

              Only available in <b>dnsperf</b>.

       <b>latency-histogram</b>
              Print detailed latency histograms for DNS answers and connections.  Latency is quantized into bins
              with roughly 3 % resolution, and latency range  for  individual  bins  increases  logarithmically.
              This is done to to limit amount of memory required for histograms and also allows to visualize la‐
              tency using logarithmic percentile histograms with minimal postprocessing.

              Only available in <b>dnsperf</b> and if compile time support was detected.

       <b>qps-threshold-wait=&lt;microseconds&gt;</b>
              When  using  <b>-Q</b> to rate limit queries sent, this option control the minimum time (in microseconds)
              there should be between queries to use <u>nanosleep()</u> to wait until sending the next query.   Setting
              to zero (0) will disable any call to <u>nanosleep()</u> between sending queries.

              If  the  time  between queries is lower then this, then no wait is performed in order to have more
              precision on when to send the next query.  This is because during high QPS rate  limiting  it  can
              take more time just calling the functions to wait for when to send the next query then the actual‐
              ly time between queries.

              If not set, the average call-time to <u>nanosleep()</u> will be measured during startup.

              Only available in <b>dnsperf</b>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/resperf.1.html">resperf</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
       Nominum, Inc.

       Maintained by DNS-OARC

              <u>https://www.dns-oarc.net/</u>

</pre><h4><b>BUGS</b></h4><pre>
       For issues and feature requests please use:

              <u>https://github.com/DNS-OARC/dnsperf/issues</u>

       For question and help please use:

              <u><a href="mailto:admin@dns-oarc.net">admin@dns-oarc.net</a></u>

dnsperf                                              2.14.0                                           <u><a href="../man1/dnsperf.1.html">dnsperf</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>