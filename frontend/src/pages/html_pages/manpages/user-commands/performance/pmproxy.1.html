<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmproxy - proxy for performance metrics collector and querying</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/pcp">pcp_6.3.3-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmproxy</b> - proxy for performance metrics collector and querying

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pmproxy</b>  [<b>-AdfFt?</b>]   [<b>-c</b>  <u>conffile</u>]  [<b>-h</b>  <u>host</u>[,<u>host</u>  ...]   [<b>-i</b>  <u>ipaddress</u>]  [<b>-l</b> <u>logfile</u>] [<b>-L</b> <u>bytes</u>] [<b>-p</b>
       <u>port</u>[,<u>port</u> ...]  [<b>-r</b> <u>port</u>[,<u>port</u> ...]  [<b>-s</b> <u>sockname</u>] [<b>-U</b> <u>username</u>] [<b>-x</b> <u>outfile</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pmproxy</b> acts as a protocol proxy, allowing Performance Co-Pilot (PCP) monitoring clients  to  connect  to
       one or more <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) and/or key-value servers (such as <b>https://valkey.io/</b>) indirectly.

       In  its  default  mode  of  operation <b>pmproxy</b> provides the REST API for PCP services (see <b><a href="../man3/PMWEBAPI.3.html">PMWEBAPI</a></b>(3) for
       details).  This includes provision of an Open Metrics - <u>https://openmetrics.io</u> - text interface  for  PCP
       metrics  at  <u>/metrics</u>,  real-time  access to PCP metrics through the <u>/pmapi</u> interfaces, and access to the
       fast, scalable PCP time series query capabilities offered in conjunction with  a  key-value  server  (see
       <b><a href="../man1/pmseries.1.html">pmseries</a></b>(1) for details) via the <u>/query</u> REST interfaces.

       <b>pmproxy</b>  can  be  deployed  in  a  firewall  domain, or on a cluster ``head'' node where the IP (Internet
       Protocol) address of the hosts where <b>pmcd</b> and/or a key-value  server  (such  as  <b>https://valkey.io/</b>)  are
       running  may  be  unknown  to  the  PCP  monitoring clients, but where the IP address of the host running
       <b>pmproxy</b> is known to these clients.  Similarly, the clients may have network connectivity only to the host
       where <b>pmproxy</b> is running, while there is network connectivity from that host to  the  hosts  of  interest
       where <b>pmcd</b> and/or a key-value server are running.

       The behaviour of the PCP monitoring clients is controlled by either the <b>PMPROXY_HOST</b> environment variable
       or  through  the  extended  hostname  specification  (see  <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1) for details).  If neither of these
       mechanisms is used, clients will make their <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3) connections directly to <b>pmcd</b>.  If the proxy hostname
       syntax is used or <b>PMPROXY_HOST</b> is set, then this should be the hostname or IP address of the system where
       <b>pmproxy</b> is running, and the clients will connect to <b>pmcd</b> or a key-value  server  indirectly  through  the
       protocol proxy services of <b>pmproxy.</b>

</pre><h4><b>OPTIONS</b></h4><pre>
       The available command line options are:

       <b>-A</b>   Disable service advertisement.  By default, <b>pmproxy</b> will advertise its presence on the network using
            any  available mechanisms (such as Avahi/DNS-SD), assisting remote monitoring tools with finding it.
            These mechanisms are disabled with this option.

       <b>-c</b> <u>conffile</u>, <b>--config</b>=<u>conffile</u>
            Specify  the  path  to  an  optional  configuration  <u>conffile</u>,  with  format  as  described  in  the
            ``CONFIGURATION'' section.  This option implies <b>pmproxy</b> is running in <b>timeseries</b> mode.

       <b>-d</b>, <b>--deprecated</b>
            By  default  <b>pmproxy</b>  prefers  to  run in the new <b>timeseries</b> mode, providing REST APIs, asynchronous
            network  I/O,  scalable  time  series,  and  secure  connections  using  OpenSSL.   However,  legacy
            deployments may wish to use the original synchronous <b>pmproxy</b> implementation using libpcp networking;
            this can be achieved using this option.  Note that the <b>-d</b> and <b>-t</b> options are mutually exclusive.

       <b>-f</b>, <b>--foreground</b>
            By  default  <b>pmproxy</b>  is  started  as  a  daemon.  The <b>-f</b> option indicates that it should run in the
            foreground.  This is most useful when trying to diagnose problems with establishing connections.

       <b>-F</b>, <b>--systemd</b>
            Like <b>-f</b>, the <b>-F</b> option runs <b>pmproxy</b> in the foreground, but also does some housekeeping (like  create
            a  ``pid''  file  and  change  user  id).   This  is  intended for use when <b>pmproxy</b> is launched from
            <b><a href="../man1/systemd.1.html">systemd</a></b>(1) and the daemonising has already been done by <b><a href="../man1/systemd.1.html">systemd</a></b>(1) and does  not  need  to  be  done
            again by <b>pmproxy</b>, which is the case when neither <b>-f</b> nor <b>-F</b> is specified.

            At most one of <b>-f</b> and <b>-F</b> may be specified.

       <b>-h</b> <u>host</u>, <b>--keyhost</b>=<u>host</u>
            Specify  an  alternate  key-value server <u>host</u> to connect to for time series querying, overriding any
            configuration file settings.  This option implies <b>pmproxy</b> is running in <b>timeseries</b> mode.

       <b>-i</b> <u>ipaddress</u>, <b>--interface</b>=<u>ipaddress</u>
            This option is usually only used on hosts with more than one  network  interface  (very  common  for
            firewall  and  ``head''  node hosts where <b>pmproxy</b> is likely to be deployed to arbitrate access to an
            internal network).  If no <b>-i</b> options are specified <b>pmproxy</b> accepts PCP client connections on any  of
            its  host's IP addresses.  The <b>-i</b> option is used to specify explicitly an IP address that PCP client
            connections should be  accepted  on.   <u>ipaddress</u>  should  be  in  the  standard  dotted  form  (e.g.
            100.23.45.6).   The <b>-i</b> option may be used multiple times to define a list of IP addresses.  When one
            or more <b>-i</b> options is specified, attempted connections made  on  any  other  IP  addresses  will  be
            refused.

       <b>-l</b> <u>logfile</u>, <b>--log</b>=<u>logfile</u>
            By  default  a log file named <u>pmproxy.log</u> is written in the current directory.  The <b>-l</b> option causes
            the log file to be written to a given <u>logfile</u> instead of the default.  If  this  <u>logfile</u>  cannot  be
            created or is not writable, output is written to the standard error instead.

       <b>-L</b> <u>bytes</u>
            <u>PDU</u>s received by <b>pmproxy</b> from PCP monitoring clients are restricted to a maximum size of 65536 bytes
            by  default  to  defend  against Denial of Service attacks.  The <b>-L</b> option may be used to change the
            maximum incoming <u>PDU</u> size.

       <b>-p</b> <u>port</u>, <b>--port</b>=<u>port</u>
            Specify an alternate <u>port</u> number to listen on for client connections.  The default value is 44322.

       <b>-r</b> <u>port</u>, <b>--keyport</b>=<u>port</u>
            Specify an alternate key-value server <u>port</u> number to connect to for time series querying, overriding
            any configuration file settings.  This option implies <b>pmproxy</b> is running in <b>timeseries</b> mode.

       <b>-s</b> <u>sockname</u>, <b>--socket</b>=<u>sockname</u>
            Specify the path to a local unix domain socket (for platforms supporting this socket  family  only).
            The  default  value  is  <u>$PCP_RUN_DIR/pmproxy.socket</u>.   This  option  implies  <b>pmproxy</b> is running in
            <b>timeseries</b> mode.

       <b>-t</b>, <b>--timeseries</b>
            Operate in automatic archive timeseries discovery mode.  This mode  of  operation  will  enable  the
            <b><a href="../man3/PMWEBAPI.3.html">PMWEBAPI</a></b>(3)  REST APIs, dynamically and automatically detect active system archives being written by
            <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) and import them into a key-value server (such as <b>https://valkey.io/</b>), for fast, scalable
            time series querying described in <b><a href="../man1/pmseries.1.html">pmseries</a></b>(1).  Note that in this mode of  operation,  <b>pmproxy</b>  only
            "log-tails"  and  ingests  actively  growing  archives,  e.g.  as written by one or more <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1)
            instances.  When an archive is first discovered (usually but not limited to  <b>pmproxy</b>  startup),  all
            metadata  is  loaded  and sent to the configured key-value server however note that only <b>new</b> archive
            metric value data from the tail end of each archive is ingested.  Compressed archives never grow and
            so are ignored.  See the <b>--load</b> option to <b><a href="../man1/pmseries.1.html">pmseries</a></b>(1) for a supported mechanism for manually loading
            all of the metric value data from previously collected (inactive) archives,  whether  compressed  or
            not.   It would be normal, though not mandated, for a set of archives being manually loaded to cover
            the same time period, e.g. archive data for a particular week for one or  more  hosts  in  the  same
            data-centre.

       <b>-U</b> <u>username</u>, <b>--username</b>=<u>username</u>
            Assume  the  identity  of  the  given  <u>username</u>  before starting to accept incoming packets from PCP
            monitoring clients.

       <b>-x</b> <u>outfile</u>
            Before the <b>pmproxy</b> <u>logfile</u> can be opened, <b>pmproxy</b> may encounter a fatal error which prevents it from
            starting.  By default the output describing this error is sent to <b>/dev/tty</b> but it may redirected  to
            <u>outfile</u>.

       <b>-?</b>, <b>--help</b>
            Display usage message and exit.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       When  running  in  the  <b>timeseries</b>  mode  of  operation,  runtime configuration is relatively complex and
       typically handled via the <u>$PCP_SYSCONF_DIR/pmproxy/pmproxy.conf</u> file.  This file is in the common ``ini''
       format, with section headers and individual variables and values with each  section.   The  configuration
       file installed as part of PCP documents every available section and option.

       At  a high level, the <u>[pmproxy]</u> section can be used to explicitly enable or disable each of the different
       protocols.

       The <u>[keys]</u> section allows connection information for one or more backing key-value server processes to be
       configured (hostnames and ports).  Note to access multiple  (scalable)  key-value  servers,  the  <u>servers</u>
       variable  in this section can be a comma-separated list of hostname:port pairs.  Alternatively, it can be
       a single key-value server host that will be queried using the "CLUSTER  INFO"  command  to  automatically
       configure multiple backing hosts.

       In  earlier  versions  of  PCP  (before 6) an alternative configuration setting section was used for this
       purpose - key-value <u>servers</u> were specified in the <u>[pmseries]</u> section and this  is  still  accepted  as  a
       fallback for backwards compatibility.

</pre><h4><b>STARTING</b> <b>AND</b> <b>STOPPING</b> <b>PMPROXY</b></h4><pre>
       Normally,  <b>pmproxy</b>  is  started  automatically  at boot time and stopped when the system is being brought
       down.  Under certain circumstances it is necessary to start or stop <b>pmproxy</b> manually.   To  do  this  one
       must become superuser and type

       # $PCP_RC_DIR/pmproxy start

       to start <b>pmproxy</b>, or

       # $PCP_RC_DIR/pmproxy stop

       to  stop  <b>pmproxy</b>.   Starting  <b>pmproxy</b>  when  it  is  already running is the same as stopping it and then
       starting it again.

       Normally <b>pmproxy</b> listens for PCP client connections on TCP/IP port number 44322 (as well  as  44323  with
       <b>timeseries</b> enabled) registered at <b>https://www.iana.org/</b>.  Either the environment variable <b>PMPROXY_PORT</b> or
       the  <b>-p</b> command line option may be used to specify alternative port number(s) when <b>pmproxy</b> is started; in
       each case, the specification is a comma-separated list of one or more  numerical  port  numbers.   Should
       both  methods be used or multiple <b>-p</b> options appear on the command line, <b>pmproxy</b> will listen on the union
       of the set of ports specified via all <b>-p</b> options and the  <b>PMPROXY_PORT</b>  environment  variable.   If  non-
       default  ports  are used with <b>pmproxy</b> care should be taken to ensure that <b>PMPROXY_PORT</b> is also set in the
       environment of any  client  application  that  will  connect  to  <b>pmproxy</b>,  or  that  the  extended  host
       specification syntax is used (see <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1) for details).

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       If  <b>pmproxy</b>  is  already running the message "Error: OpenRequestSocket bind: Address already in use" will
       appear.  This may also appear if <b>pmproxy</b> was shutdown with an outstanding request from a client.  In this
       case, a request socket has been left in the TIME_WAIT state and until the system closes  it  down  (after
       some timeout period) it will not be possible to run <b>pmproxy</b>.

       In addition to the standard <b>PCP</b> debugging options, see <b><a href="../man1/pmdbg.1.html">pmdbg</a></b>(1), <b>pmproxy</b> currently supports the debugging
       option <b>context</b> for tracing client connections and disconnections.

</pre><h4><b>FILES</b></h4><pre>
       <u>$PCP_PMPROXYOPTIONS_PATH</u>
            command  line options for <b>pmproxy</b> when launched from <b>$PCP_RC_DIR/pmproxy</b> All the command line option
            lines should start with a hyphen as the first character.

       <u>$PCP_SYSCONFIG_DIR/pmproxy</u>
            Environment variables  that  will  be  set  when  <b>pmproxy</b>  executes.   Only  settings  of  the  form
            "PMPROXY_VARIABLE=value" will be honoured.

       <u>./pmproxy.log</u>
            (or <b>$PCP_LOG_DIR/pmproxy/pmproxy.log</b> when started automatically)
            All messages and diagnostics are directed here

       <u>/etc/pki/tls</u>
            default  OpenSSL  certificate database directory, optionally used for Secure Socket Layer connection
            in <b>timeseries</b> mode of operation.  These certificates can be created and queried  using  the  <b>openssl</b>
            tool, amongst others.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       In  addition  to  the PCP environment variables described in the <b>PCP</b> <b>ENVIRONMENT</b> section below, there are
       several environment variables that influence the interactions between a PCP  monitoring  client,  <b>pmproxy</b>
       and <b>pmcd</b>.

       <b>PMCD_PORT</b>
              For  the  PCP monitoring client this (or the default port number) is passed to <b>pmproxy</b> and used to
              connect to <b>pmcd</b>.  In the environment of <b>pmproxy</b> <b>PMCD_PORT</b> <b>is</b> <b>not</b> <b>used.</b>

       <b>PMPROXY_HOST</b>
              For the PCP monitoring client this is the hostname or IP address of  the  host  where  <b>pmproxy</b>  is
              running.   In  recent  versions  of PCP (since version 3) this has been superseded by the extended
              hostname syntax (see <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1) for details).

       <b>PMPROXY_PORT</b>
              For the PCP monitoring client this is the port on which  <b>pmproxy</b>  will  accept  connections.   The
              default is 44322, as well as 44323 with <b>timeseries</b> enabled.

       <b>PMCD_CONNECT_TIMEOUT</b>, <b>PMCD_RECONNECT_TIMEOUT</b> and <b>PMCD_REQUEST_TIMEOUT</b>
              (see  <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1))  For the PCP monitoring client, setting these environment variables will modify
              the timeouts used for interactions between the client and <b>pmproxy</b> (independent of  which  <b>pmcd</b>  is
              being  used).   For  <b>pmproxy</b> these same environment variables control the timeouts between <b>pmproxy</b>
              and all <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) instances (independent of which monitoring client is involved).

       If set to the value 1, the <b>PMPROXY_LOCAL</b> environment variable will cause <b>pmproxy</b> to run in  a  localhost-
       only mode of operation, where it binds only to the loopback interface.

       The  <b>PMPROXY_MAXPENDING</b>  variable can be set to indicate the maximum length to which the queue of pending
       client connections may grow.

</pre><h4><b>PCP</b> <b>ENVIRONMENT</b></h4><pre>
       Environment variables with the prefix <b>PCP_</b> are used to parameterize the file and directory names used  by
       PCP.   On  each  installation, the file <u>/etc/pcp.conf</u> contains the local values for these variables.  The
       <b>$PCP_CONF</b> variable may be used to specify an alternative configuration file, as described in <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5).

       For environment variables affecting PCP tools, see <b><a href="../man3/pmGetOptions.3.html">pmGetOptions</a></b>(3).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1),  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1),  <b><a href="../man1/pmdbg.1.html">pmdbg</a></b>(1),  <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1),  <b><a href="../man1/pmseries.1.html">pmseries</a></b>(1),  <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3),  <b><a href="../man3/PMWEBAPI.3.html">PMWEBAPI</a></b>(3),   <b><a href="../man3/pmGetOptions.3.html">pmGetOptions</a></b>(3),
       <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5) and <b><a href="../man5/pcp.env.5.html">pcp.env</a></b>(5).

Performance Co-Pilot                                   PCP                                            <u><a href="../man1/PMPROXY.1.html">PMPROXY</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>