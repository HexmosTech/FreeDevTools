<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmdapipe - command output capture performance metrics domain agent (PMDA)</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/pcp">pcp_6.3.3-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmdapipe</b> - command output capture performance metrics domain agent (PMDA)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>$PCP_PMDAS_DIR/pipe/pmdapipe</b> [<b>-c</b> <u>configfile</u>] [<b>-d</b> <u>domain</u>] [<b>-l</b> <u>logfile</u>] [<b>-m</b> <u>memory</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pmdapipe</b>  is a configurable command output monitoring Performance Metrics Domain Agent (PMDA).  It can be
       seen as analogous to a restricted shell, where options can be passed to preset commands, and each line of
       their output is converted into a performance event.  These events can be consumed by  client  tools  like
       <b><a href="../man1/pmval.1.html">pmval</a></b>(1).

       The  <b>pipe</b>  PMDA  exports  both event-style metrics reflecting timestamped event records for text-oriented
       command output, as well as the more orthodox sample-style metrics such as  event  counts  and  throughput
       size values.

       The PMDA is configured via a <u>configfile</u> which contains one line for each process from which output can be
       captured, as described in the ``CONFIGURATION'' section below.

       A brief description of the <b>pmdapipe</b> command line options follows:

       <b>-c</b>   specifies   an   alternate   configuration   file   for   the   PMDA.   By  default,  a  file  named
            <u>$PCP_PMDAS_DIR/pipe/pipe.conf</u> and any files below the  <u>$PCP_SYSCONF_DIR/pipe.conf.d/</u>  directory  are
            used.

       <b>-d</b>   It  is  absolutely  crucial  that the performance metrics <u>domain</u> number specified here is unique and
            consistent.  That is, <u>domain</u> should be different for every PMDA on the one host, and the same <u>domain</u>
            number should be used for the same PMDA on all hosts.

       <b>-l</b>   Location of the log file.  By default, a log file named <u>pipe.log</u> is written in the current directory
            of <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) when <b>pmdapipe</b> is started, i.e.  <b>$PCP_LOG_DIR/pmcd</b>.  If the log file cannot be created  or
            is not writable, output is written to the standard error instead.

       <b>-m</b>   Limit  the physical memory used by the PMDA to buffer event records to <u>maxsize</u> bytes.  As log events
            arrive at the PMDA, they must be buffered until individual client tools request the next batch since
            their previous batch of events.  The default maximum is 2 megabytes.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       The set of allowed pipe commands is configured by simple text file(s).  The format is a single  line  for
       each command followed by an optional access control section.

       Blank  lines  and  comments  are permitted (even encouraged) in the configuration file.  A comment begins
       with a ``#'' character and finishes at the end of the line.

       Each command configuration line is of the form:

              <u>instance</u> <u>username</u> <u>command</u> <u>options</u>

       Where,

       <u>instance</u>      is a string identifying the pipe command, also exported as the metric instance identifier.
       <u>username</u>      is the name of the user account under which the command should run (e.g. "root")
       <u>command</u>       is the path to the binary which will be run to generate piped output
       <u>options</u>       is an optional space-separated list of parameters to pass to the <u>command</u>

                     This <u>options</u> list may contain numeric parameters prefixed by  the  dollar-sign,  and  these
                     will  be  substituted  with user-supplied values at the time the <u>command</u> is run (similar to
                     shell parameter substitution).

       Parameters are passed as a single space-separated or comma-separated string to the <u>pipe.firehose</u>  metric,
       using  the  <b>pmStore</b>  <b>(3)</b>  interface.   The  <b>pmval</b> command provides store access via its <b>-x</b> option.  User-
       supplied parameters are restricted to containing alphanumeric characters.

       The access control section of the file must start with a line of the form:

       <b>[access]</b>

       Leading and trailing whitespace may appear around and within the brackets and  the  case  of  the  <b>access</b>
       keyword is ignored.  No other text may appear on the line except a trailing comment.

       Following  this line, the remainder of the configuration file should contain lines that allow or disallow
       use of <u>commands</u> from particular users or groups.

       User names and group names will be verified using the local <b><a href="file:/etc/passwd">/etc/passwd</a></b>  and  <b>/etc/groups</b>  files  (or  an
       alternative directory service), using the <b><a href="../man3/getpwent.3.html">getpwent</a></b>(3) and <b><a href="../man3/getgrent.3.html">getgrent</a></b>(3) routines.

       Access for users or groups are allowed or disallowed by specifying statements of the form:

              <b>allow</b> <b>user</b> <u>username</u> <b>:</b> <u>instance</u>
              <b>disallow</b> <b>user</b> <u>username</u> <b>:</b> <u>instance</u>
              <b>allow</b> <b>group</b> <u>groupname</u> <b>:</b> <u>instance</u>
              <b>disallow</b> <b>group</b> <u>groupname</u> <b>:</b> <u>instance</u>

       The  <u>username</u>  and <u>groupname</u> names will be verified using the local <b><a href="file:/etc/passwd">/etc/passwd</a></b> and <b>/etc/groups</b> files (or
       an alternative directory service), using the <b><a href="../man3/getpwent.3.html">getpwent</a></b>(3) and <b><a href="../man3/getgrent.3.html">getgrent</a></b>(3) routines.

       The wildcard ``*'' can be used to refer to all <u>instance</u> names.

</pre><h4><b>INSTALLATION</b></h4><pre>
       If you want access to the names, help text and values for the pipe performance metrics, do the  following
       as root:

            # cd $PCP_PMDAS_DIR/pipe
            # ./Install

       This  is  an  interactive  installation  process which prompts for each log file path to be monitored (or
       command to be run), a metric instance name to identify it, and whether access should be restricted (refer
       to the <b>-x</b> option to <b><a href="../man1/pmval.1.html">pmval</a></b>(1) for further details).

       If you want to undo the installation, do the following as root:

            # cd $PCP_PMDAS_DIR/pipe
            # ./Remove

       <b>pmdapipe</b> is launched by <b>pmcd</b> and should never be executed  directly.   The  Install  and  Remove  scripts
       notify <b>pmcd</b> when the agent is installed or removed.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Following  is  a  simple  example of <b>pmdapipe</b> configuration and use of the pipe metrics to run the <b>btrace</b>
       command, by user <b>bob</b>:

            bob&gt; cat $PCP_PMDAS_DIR/pipe/pipe.conf
            # instance      user      command
            rw_syscalls     root      perf script rw-by-file $1
            bdev_trace      root      btrace -w $1 <a href="file:/dev/">/dev/</a>$2

            [access]
            allow user bob : *;
            allow user jane : bdev_trace;
            allow group perf : rw_syscalls;

            bob&gt; pmval -i bdev_trace -x '5 sda' pipe.firehose
             8,2  5  1  0.000000000 25227  A  WS 734332384 + 24 &lt;- (253,2) 734330336
             8,0  5  2  0.000000414 25227  A  WS 735358432 + 24 &lt;- (8,2) 734332384
             8,0  5  3  0.000000756 25227  Q  WS 735358432 + 24 [qemu-kvm]
             [...5 seconds worth]
            bob&gt;

</pre><h4><b>FILES</b></h4><pre>
       <b>$PCP_PMCDCONF_PATH</b>
                 command line options used to launch <b>pmdapipe</b>
       <b>$PCP_PMDAS_DIR/pipe/pipe.conf</b>
                 default configuration file for the pipe metrics
       <b>$PCP_PMDAS_DIR/pipe/help</b>
                 default help text file for the pipe metrics
       <b>$PCP_PMDAS_DIR/pipe/Install</b>
                 installation script for the <b>pmdapipe</b> agent
       <b>$PCP_PMDAS_DIR/pipe/Remove</b>
                 undo installation script for the <b>pmdapipe</b> agent
       <b>$PCP_LOG_DIR/pmcd/pipe.log</b>
                 default log file for error messages and other information from <b>pmdapipe</b>
       <b>$PCP_SYSCONF_DIR/pipe.conf.d</b>
                 directory containing additional configuration files for the pipe metrics

</pre><h4><b>PCP</b> <b>ENVIRONMENT</b></h4><pre>
       Environment variables with the prefix <b>PCP_</b> are used to parameterize the file and directory names used  by
       PCP.   On  each  installation, the file <u>/etc/pcp.conf</u> contains the local values for these variables.  The
       <b>$PCP_CONF</b> variable may be used to specify an alternative configuration file, as described in <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1), <b><a href="../man1/pmval.1.html">pmval</a></b>(1), <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1), <b><a href="../man3/getpwent.3.html">getpwent</a></b>(3), <b><a href="../man3/getgrent.3.html">getgrent</a></b>(3), <b><a href="../man3/pmStore.3.html">pmStore</a></b>(3), <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5) and <b><a href="../man5/pcp.env.5.html">pcp.env</a></b>(5).

Performance Co-Pilot                                   PCP                                           <u><a href="../man1/PMDAPIPE.1.html">PMDAPIPE</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>