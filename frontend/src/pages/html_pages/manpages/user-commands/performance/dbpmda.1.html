<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dbpmda - debugger for Performance Co-Pilot PMDAs</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/pcp">pcp_6.3.3-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>dbpmda</b> - debugger for Performance Co-Pilot PMDAs

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>dbpmda</b> [<b>-efiv?</b>]  [<b>-n</b> <u>pmnsfile</u>] [<b>-q</b> <u>timeout</u>] [<b>-U</b> <u>username</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>dbpmda</b>  is  an  interactive  interface  to  the  interactions  between  a Performance Metric Domain Agent
       (<b><a href="../man3/PMDA.3.html">PMDA</a></b>(3)) and the Performance Metric Collector Daemon (<b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)).   This  allows  PMDAs  to  be  attached,
       initialized and exercised to test for correctness.

       <b>dbpmda</b>  interactively prompts the user for commands, many of which emulate the Protocol Data Units (PDUs)
       that may be sent by a <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) process.  After running <b>dbpmda</b>, enter the command <b>help</b> to get a list of the
       available commands.  The example section below illustrates a session using <b>dbpmda</b> to test a PMDA.

       To simplify repetitive testing of a PMDA, the file <u>.dbpmdarc</u> in the current working directory can contain
       a list of commands that will be executed by <b>dbpmda</b> on startup, before  the  user  is  prompted  to  enter
       further  commands  interactively.   While  processing  the  <u>.dbpmdarc</u>  file, interactive mode and command
       echoing are enabled and then reset at the end of the <u>.dbpmdarc</u> file (see  the  <b>-i</b>  and  <b>-e</b>  command  line
       options below).

       The <b>-f</b> command line option prevents startup processing of a <u>.dbpmdarc</u> file (if it exists).

       If  the  system  supports  <b><a href="../man3/readline.3.html">readline</a></b>(3)  then  this will be used to read commands when input is from a tty
       device, so history and command line editing are available.

       As there are no timeout constraints on a PMDA while  using  <b>dbpmda</b>  (as  compared  to  <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1)),  another
       debugger like <b><a href="../man1/gdb.1.html">gdb</a></b>(1) can be used on the PMDA process once it has been attached to <b>dbpmda</b>.

</pre><h4><b>OPTIONS</b></h4><pre>
       The available command line options are:

       <b>-e</b>, <b>--echo-input</b>
            Echo the input to <b>stdout</b>.  This is useful when the input is redirected from a file.

       <b>-f</b>, <b>--norc</b>
            Do not process the <b>.dbpmdarc</b> file.

       <b>-i</b>, <b>--interactive</b>
            Emulate  interactive  behavior  and  prompt  for  new  commands, even if standard input is not a tty
            device.

       <b>-n</b> <u>pmnsfile</u>, <b>--namespace</b>=<u>pmnsfile</u>
            Load an alternative Performance Metrics Name Space (<b><a href="../man5/PMNS.5.html">PMNS</a></b>(5)) from the file <u>pmnsfile</u>.

       <b>-q</b> <u>timeout</u>, <b>--creds-timeout</b>=<u>timeout</u>
            The pmcd to agent version exchange protocol (new  in  PCP  2.0  -  introduced  to  provide  backward
            compatibility)  uses  this  timeout  to  specify how long <b>dbpmda</b> should wait before assuming that no
            version response is coming from an agent.  If this timeout is reached, the agent is assumed to be an
            agent which does not understand the PCP  2.0  protocol.   The  default  timeout  interval  is  three
            seconds,  but the <b>-q</b> option allows an alternative timeout interval (which must be greater than zero)
            to be specified.  The unit of time is seconds.

       <b>-U</b> <u>username</u>, <b>--username</b>=<u>username</u>
            User account under which to run <b>dbpmda</b>.

       <b>-v</b>, <b>--valgrind</b>
            Useful when running <b>dbpmda</b> under the control of <b><a href="../man1/valgrind.1.html">valgrind</a></b>(1) to triage problems in a  DSO  PMDA.   If
            the  <b>-v</b>  option  is  used  then  <b>dbpmda</b>  will  do  not  call  <b><a href="../man3/dlclose.3.html">dlclose</a></b>(3) before exiting, this allows
            <b><a href="../man1/valgrind.1.html">valgrind</a></b>(1) to access the symbol table of the DSO PMDA when reporting  which  makes  debugging  much
            easier.

       <b>-?</b>, <b>--help</b>
            Display usage message and exit.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Below  is  a <b>dbpmda</b> session using the <u>simple</u> PMDA.  A <b>.dbpmdarc</b> file is used to set the debugging option,
       open the PMDA and display the current status of the debugger:

            $ cat .dbpmdarc
            debug libpmda
            open dso pmda_simple.so simple_init 253
            status

       When <b>dbpmda</b> is run, the commands in the <b>.dbpmdarc</b> file are executed first:

            $ dbpmda
            .dbpmdarc&gt; debug libpmda
            .dbpmdarc&gt; open dso pmda_simple.so simple_init 253
            [Fri Sep 19 10:19:55] <a href="../man11651/dbpmda.11651.html">dbpmda</a>(11651) Debug: pmdaInit: PMDA simple DSO: Metric <a href="../man1/0.0.1.1.html">0.0.1</a>(1) matched to indom <a href="../man0/253.0.0.html">253.0</a>(0)
            [Fri Sep 19 10:19:55] <a href="../man11651/dbpmda.11651.html">dbpmda</a>(11651) Debug: pmdaInit: PMDA simple DSO: help file $PCP_PMDAS_DIR/simple/help opened
            [Fri Sep 19 10:19:55] <a href="../man11651/dbpmda.11651.html">dbpmda</a>(11651) Info: name        = simple DSO
            [Fri Sep 19 10:19:55] <a href="../man11651/dbpmda.11651.html">dbpmda</a>(11651) Info: domain      = 253
            [Fri Sep 19 10:19:55] <a href="../man11651/dbpmda.11651.html">dbpmda</a>(11651) Info: num metrics = 4
            [Fri Sep 19 10:19:55] <a href="../man11651/dbpmda.11651.html">dbpmda</a>(11651) Info: num indom   = 1
            [Fri Sep 19 10:19:55] <a href="../man11651/dbpmda.11651.html">dbpmda</a>(11651) Info: direct map  = 1
            .dbpmdarc&gt; status

            Namespace:              (default)
            PMDA:                   ./pmda_simple.so
            Connection:             dso
            DSO Interface Version:  7
            PMDA PMAPI Version:     2
            Debug options:          libpmda
            Timer:                  off
            Getdesc:                off
            Getiname:               off

            Dump Instance Profile state=INCLUDE, 0 profiles

            .dbpmdarc&gt;

       To examine the metric and instance domain metadata, the <b>desc</b> and <b>instance</b> commands can be used.   Metrics
       may be identified either by name, or using the numeric ``dotted'' notation to specify the domain, cluster
       and  item  fields  of a PMID.  Instance domains must be identified using a numeric ``dotted'' notation to
       specify the domain and serial fields.  The syntax for most commands will be displayed if the  command  is
       given without any arguments:

            dbpmda&gt; desc 253.0.0
            PMID: 253.0.0
                Data Type: 32-bit unsigned int  InDom: PM_INDOM_NULL 0xffffffff
                Semantics: instant  Units: none
            dbpmda&gt; instance
            instance indom# [ number | name | "name" ]
            dbpmda&gt; instance 253.0
            pmInDom: 253.0
            [  0] inst: 0 name: "red"
            [  1] inst: 1 name: "green"
            [  2] inst: 2 name: "blue"

       To  test  the  most important component of a PMDA, the <b>fetch</b>, it is often useful to determine the time it
       takes the PMDA to respond.  The <b>timer</b> may be turned on before giving a <b>fetch</b>:

            dbpmda&gt; timer on
            dbpmda&gt; fetch simple.numfetch 253.0.1
            PMID(s): 253.0.0 253.0.1
            pmResult dump from 0x100078e0 timestamp: 0.000000 11:00:00.000 numpmid: 2
              253.0.0 (simple.numfetch): numval: 1 valfmt: 0 vlist[]:
               value 1 1.4012985e-45 0x1
              253.0.1 (simple.color): numval: 3 valfmt: 0 vlist[]:
                inst [0 or ???] value 1 1 1.4012985e-45 0x1
                inst [1 or ???] value 101 1.4153114e-43 0x65
                inst [2 or ???] value 201 2.8166099e-43 0xc9
            Timer: 0.003921 seconds
            dbpmda&gt; timer off

       The integer, floating point and hex translations of the values in the <u>pmResult</u> structure  are  dumped  if
       <b>getdesc</b>  is set to <b>off</b> (the default).  Setting <b>getdesc</b> to <b>on</b> also fetches the metric metadata (or <b>pmDesc</b>)
       and this would result in only integer values being dumped in the  above  fetch  as  the  metric  metadata
       describes the metric type to be 32-bit unsigned integers.

       Similarly,  the  <b>getiname</b>  setting  controls  the  lookup  of external instance names for metrics with an
       associated instance domain.  When <b>off</b> (the default) the  output  is  as  above.   When  <b>on</b>  the  instance
       ``names'' ??? are translated into their external instance names by the PMDA and reported as below:

            dbpmda&gt; getiname on
            dbpmda&gt; fetch simple.color
            PMID(s): 253.0.1
            pmResult dump from 0x100078e0 timestamp: 0.000000 11:00:00.000 numpmid: 1
              253.0.1 (simple.color): numval: 3 valfmt: 0 vlist[]:
                inst [0 or "red"] value 4
                inst [1 or "green"] value 104
                inst [2 or "blue"] value 204

       Because the metric metadata is required to do the instance name lookup, setting <b>getiname</b> to <b>on</b> implicitly
       sets <b>getdesc</b> to <b>on</b>.

       Note that if either <b>getdesc</b> or <b>getiname</b> are set <b>on</b> then each <b>fetch</b> involves additional calls on the PMDA.
       For a PMDA under development this may not be a good idea, which is why both settings default to <b>off</b>.

       The simple PMDA also supports the <b>store</b> operation which can be tested with subsequent <b>fetch</b> commands:

            dbpmda&gt; store simple.numfetch "42"
            PMID: 253.0.0
            Getting description...
            Getting Result Structure...
            253.0.0: 2 -&gt; 42
            dbpmda&gt; fetch simple.numfetch
            PMID(s): 253.0.0
            pmResult dump from 0x100078e0 timestamp: 0.000000 11:00:00.000 numpmid: 1
              253.0.0 (simple.numfetch): numval: 1 valfmt: 0 vlist[]:
               value 43

       The  value  argument in the <b>store</b> command must be a string, which is enclosed in either single quotes (')
       or double quotes (").

       A <b>profile</b> can be specified for each instance domain which includes all, some or no instances:

            dbpmda&gt; help profile

            profile indom# [ all | none ]
            profile indom# [ add | delete ] number

            For the instance domain specified, the profile may be changed to
            include 'all' instances, no instances, add an instance or delete
            an instance.

            dbpmda&gt; profile 253.0 none
            dbpmda&gt; getdesc on
            dbpmda&gt; fetch 253.0.1
            PMID(s): 253.0.1
            pmResult dump from 0x100078e0 timestamp: 0.000000 11:00:00.000 numpmid: 1
              253.0.1 (simple.color): No values returned!
            dbpmda&gt; profile 253.0 add 2
            dbpmda&gt; fetch 253.0.1
            PMID(s): 253.0.1
            pmResult dump from 0x100078e0 timestamp: 0.000000 11:00:00.000 numpmid: 1
              253.0.1 (simple.color): numval: 1 valfmt: 0 vlist[]:
               value 202
            dbpmda&gt; profile 253.0 add 0
            dbpmda&gt; fetch 253.0.1
            PMID(s): 253.0.1
            pmResult dump from 0x100078e0 timestamp: 0.000000 11:00:00.000 numpmid: 1
              253.0.1 (simple.color): numval: 2 valfmt: 0 vlist[]:
                inst [0 or ???] value 2
                inst [2 or ???] value 203
            dbpmda&gt; status

            Namespace:              (default)
            PMDA:                   ./pmda_simple.so
            Connection:             dso
            DSO Interface Version:  7
            PMDA PMAPI Version:     2
            Debug options:          (none)
            Timer:                  off
            Getdesc:                off
            Getiname:               off

            Dump Instance Profile state=INCLUDE, 1 profiles
                    Profile [0] indom=1061158913 [253.0] state=EXCLUDE 2 instances
                            Instances: [2] [0]
            dbpmda&gt; quit

       The <b>watch</b> command (usage: <b>watch</b> <u>filename</u> ) opens an xterm window which  tails  the  specified  log  file.
       This window must be closed by the user when no longer required.

       The <b>wait</b> command is equivalent to <b><a href="../man1/sleep.1.html">sleep</a></b>(1) and takes a single integer argument (wait time in seconds).

       The  introduction  of  dynamic  subtrees  in  the  PMNS  and  PMDA_INTERFACE_4  in <u>libpcp_pmda</u> has led to
       additional commands being supported in <b>dbpmda</b> to exercise the  associated  dynamic  PMNS  services.   The
       examples below are based on the <u>sample</u> PMDA.

            $ dbpmda
            dbpmda&gt; open pipe /var/lib/pcp/pmdas/sample/pmdasample -d 29
            Start pmdasample PMDA: /var/lib/pcp/pmdas/sample/pmdasample -d 29
            dbpmda&gt; children sample.secret
            Metric: sample.secret
               non-leaf foo
                   leaf bar
            dbpmda&gt; traverse sample.secret.foo
            Metric: sample.secret.foo
               sample.secret.foo.bar.max.redirect
               sample.secret.foo.one
               sample.secret.foo.two
               sample.secret.foo.bar.three
               sample.secret.foo.bar.four
               sample.secret.foo.bar.grunt.five
               sample.secret.foo.bar.grunt.snort.six
               sample.secret.foo.bar.grunt.snort.huff.puff.seven
            dbpmda&gt; pmid sample.secret.foo.bar.four
            Metric: sample.secret.foo.bar.four
               29.0.1004
            dbpmda&gt; name 29.0.1006
            PMID: 29.0.1006
               sample.secret.foo.bar.grunt.snort.six

       The  <b>children</b>  command  returns the next name component for all the direct descendants of a node within a
       dynamic subtree of the PMNS.  The related <b>traverse</b> command returns the full metric  names  for  all  leaf
       nodes in the PMNS below the specified non-leaf node in a dynamic subtree of the PMNS.

       The <b>name</b> and <b>pmid</b> commands exercise the translation of metric names to PMIDs (and vice versa) for metrics
       within a dynamic subtree of the PMNS.

       If  the commands <b>children</b>, <b>traverse</b>, <b>pmid</b> or <b>name</b> are used with a PMDA that is <b>not</b> using PMDA_INTERFACE_4
       or with performance metric names that are not part of a dynamic subtree of the PMNS, then the PMDA  would
       be  expected  to  return errors (PM_ERR_NAME or PM_ERR_PMID) to reflect the fact that the operation is in
       error (outside a dynamic subtree of the PMNS it is <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) and not  the  PMDA  that  is  responsible  for
       implementing these functions).

       Client  authentication  mechanisms  have  been  incorporated  into the PMCS, providing per-user (and per-
       connection) information that  is  available  to  PMDAs.   A  PMDA  using  PMDA_INTERFACE_6  or  later  in
       <u>libpcp_pmda</u>  is  able  to  make use of the "attribute" method to gain visibility into these authenticated
       connections, with access to information including user and group identifiers, user name, and so on.   The
       need  to  exercise  and  debug  this interface has led to a new <b>dbpmda</b> command.  The following example is
       based on the <u>sample</u> PMDA.

            $ dbpmda
            dbpmda&gt; open pipe pmdasample -D AUTH -l logfile
            Start pmdasample PMDA: pmdasample -D AUTH -l logfile
            dbpmda&gt; attr "username" "tanya"
            Attribute: username=tanya
            Success
            dbpmda&gt; attr 11 "0"
            Attribute: userid=0
            Success
            dbpmda&gt;

       The <b>attr</b> command passes connection attributes (PCP_ATTR_XXXX keys) and their values into a PMDA  in  much
       the  same  way that PMCD would for a client connection.  <b>dbpmda</b> always passes a client context identifier
       of zero, and while no validity checking on values is performed only recognised attributes can be set.

       In the example above the <u>AUTH</u> debugging option is set for the PMDA, which  uses  this  in  its  attribute
       callback and records each attribute and value pair sent to it in its <u>logfile</u>.

       Note  that authentication checks have already been performed by PMCD by the time a PMDA is presented with
       these attributes, so no further verification is necessary by the PMDA.

       The <b>debug</b> command takes one or more debug options separated by whitespace or a comma.  This can  be  used
       to  selectively  enable  debugging output from various modules of the PCP libraries that the PMDA will be
       linked with.  If the option is prefixed by a minus ``-'' the corresponding debugging option is  disabled.
       The  options  are  the  same debug names as reported by the <b>-l</b> option to <b><a href="../man1/pmdbg.1.html">pmdbg</a></b>(1) and/or their deprecated
       equivalent numeric values as reported by the <b>-ol</b> options to <b><a href="../man1/pmdbg.1.html">pmdbg</a></b>(1).  The special ``option'' <b>none</b>  turns
       all debugging off and the special ``option'' <b>all</b> enables all the debugging options.

</pre><h4><b>CAVEATS</b></h4><pre>
       A value cannot be stored into metrics of type <b>PM_TYPE_AGGREGATE</b> or <b>PM_TYPE_EVENT</b>.

       <b>dbpmda</b>  uses  <b><a href="../man2/fork.2.html">fork</a></b>(2)  and  <b><a href="../man2/exec.2.html">exec</a></b>(2)  to  attach  to  daemon PMDAs.  <b>dbpmda</b> makes no attempt to detect the
       termination of the daemon PMDA process, so it is possible for a PMDA to  exit  unexpectedly  without  any
       notification.  However, any further communication attempts with the PMDA will result in errors which will
       indicate that the PMDA is no longer responding.

</pre><h4><b>FILES</b></h4><pre>
       <u>./.dbpmdarc</u>
            List of commands to do on startup.

</pre><h4><b>PCP</b> <b>ENVIRONMENT</b></h4><pre>
       Environment  variables with the prefix <b>PCP_</b> are used to parameterize the file and directory names used by
       PCP.  On each installation, the file <u>/etc/pcp.conf</u> contains the local values for  these  variables.   The
       <b>$PCP_CONF</b> variable may be used to specify an alternative configuration file, as described in <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5).

       For environment variables affecting PCP tools, see <b><a href="../man3/pmGetOptions.3.html">pmGetOptions</a></b>(3).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/gdb.1.html">gdb</a></b>(1), <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1), <b><a href="../man1/pmdbg.1.html">pmdbg</a></b>(1), <b><a href="../man2/exec.2.html">exec</a></b>(2), <b><a href="../man2/fork.2.html">fork</a></b>(2), <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3), <b><a href="../man3/PMDA.3.html">PMDA</a></b>(3), <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5), <b><a href="../man5/pcp.env.5.html">pcp.env</a></b>(5) and <b><a href="../man5/PMNS.5.html">PMNS</a></b>(5).

Performance Co-Pilot                                   PCP                                             <u><a href="../man1/DBPMDA.1.html">DBPMDA</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>