<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ib_write_bw, ib_read_bw, ib_send_bw, ib_atomic_bw, ib_write_lat, ib_read_lat, ib_send_lat, ib_atomic_lat,</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/perftest">perftest_24.01.0+0.38-1build2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ib_write_bw, ib_read_bw, ib_send_bw, ib_atomic_bw, ib_write_lat, ib_read_lat, ib_send_lat, ib_atomic_lat,
       raw_ethernet_bw,  raw_ethernet_lat, raw_ethernet_burst_lat, raw_ethernet_fs_rate - benchmarks for various
       types of infinabnd performance

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Perftest is a package that includes various benchmarks that measures
              different metrics &amp; verbs performance which include many different options and modes.

   <b>RUNNING</b> <b>TESTS</b>
       <b>Server:</b>
               ./&lt;test name&gt; &lt;options&gt;

       <b>Client:</b>
               ./&lt;test name&gt; &lt;options&gt; &lt;server IP address&gt;

       <b>Examples:</b>
               1- Running bidirectional bandwidth test using Write verb for 5 seconds with 8388608 as a  message
              size and 3 qps:
                  Server: ./ib_write_bw -s 8388608 -b -D 5 -q 3
                  Client: ./ib_write_bw -s 8388608 -b -D 5 -q 3 1.1.1.2

               2- Running latency test using Read verb for 5000 iterations with 32 as a message size:
                  Server: ./ib_read_lat -s 32 -n 5000
                  Client: ./ib_read_lat -s 32 -n 5000 192.168.0.1

   <b>IMPORTANT</b> <b>NOTES</b>
               1- The options that specific to modes in perftest must be the same for both server and client.
               2- Perftest applications may need to be ran with sudo when running from non root.
               3- Perftest applications usually installed to the <a href="file:/usr/bin/.">/usr/bin/.</a>
               4-  Perftest  may print some failures with syndroms to the stderr, perftest get those errors from
              rdma-core.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-h,</b> <b>--help</b>
               Lists the available options to the screen.

       <b>-a,</b> <b>--all</b>
               Run sizes from 2 till 2^23.
               Not relevant for Atomic and RawEth.

       <b>-A,</b> <b>--atomic_type=&lt;type&gt;</b>
               Type of atomic operation from {CMP_AND_SWAP,FETCH_AND_ADD} (default FETCH_AND_ADD).
               Relevant only for Atomic.

       <b>-b,</b> <b>--bidirectional</b>
               Measure bidirectional bandwidth (default unidirectional).
               Relevant only for BW.

       <b>-c,</b> <b>--connection=&lt;RC/XRC/UC/UD/DC/SRD&gt;</b>
               Connection type RC/XRC/UC/UD/DC/SRD (default RC).
               UD relevant only for Send verb.
               SRD relevant only for Read, Write and Send verbs.
               UC relevant only for Write and Send verbs.
               Not relevant for RawEth.

       <b>--log_dci_streams=&lt;log_num_dci_stream_channels&gt;</b> <b>(default</b> <b>0)</b>
               Run DC initiator as DCS instead of DCI with &lt;log_num dci_stream_channels&gt;.
               Not relevant for RawEth.
               System support required.

       <b>--log_active_dci_streams=&lt;log_num_active_dci_stream_channels&gt;</b> <b>(default</b> <b>log_num_dci_stream_channels)</b>
               Not relevant for RawEth.
               System support required.

       <b>--aes_xts</b>
               Runs traffic with AES_XTS feature (encryption).
               Not relevant for RawEth and Write latency.
               System support required.

       <b>--encrypt_on_tx</b>
               Runs traffic with encryption on tx (default decryption on tx).
               Not relevant for RawEth and Write latency.
               System support required.

       <b>--sig_before</b>
               Puts signature on data before encrypting it (default after).
               Not relevant for RawEth and Write latency.
               System support required.

       <b>--aes_block_size=&lt;512,520,4048,4096,4160&gt;</b> <b>(default</b> <b>512)</b>
               Not relevant for RawEth and Write latency.
               System support required.

       <b>--data_enc_keys_number=&lt;number</b> <b>of</b> <b>data</b> <b>encryption</b> <b>keys&gt;</b> <b>(default</b> <b>1)</b>
               Not relevant for RawEth and Write latency.
               System support required.

       <b>--kek_path</b> <b>&lt;path</b> <b>to</b> <b>the</b> <b>key</b> <b>encryption</b> <b>key</b> <b>file&gt;</b>
               Not relevant for RawEth and Write latency.
               System support required.

       <b>--credentials_path</b> <b>&lt;path</b> <b>to</b> <b>the</b> <b>credentials</b> <b>file&gt;</b>
               Not relevant for RawEth and Write latency.
               System support required.

       <b>--data_enc_key_app_path</b> <b>&lt;path</b> <b>to</b> <b>the</b> <b>data</b> <b>encryption</b> <b>key</b> <b>app&gt;</b>
               Not relevant for RawEth and Write latency.
               System support required.

       <b>-C,</b> <b>--report-cycles</b>
               Report times in cpu cycle units (default microseconds).
               Relevant only for latency.

       <b>-d,</b> <b>--ib-dev=&lt;dev&gt;</b>
               Use IB device &lt;dev&gt; (default first device found).

       <b>-D,</b> <b>--duration</b>
               Run test for a customized period of seconds.

       <b>-e,</b> <b>--events</b>
               Sleep on CQ events (default poll).
               Not relevant for Write and RawEth.

       <b>-X,</b> <b>--vector=&lt;completion</b> <b>vector&gt;</b>
               Set &lt;completion vector&gt; used for events.
               Not relevant for Write and RawEth.

       <b>-f,</b> <b>--margin</b>
               measure results within margins. (default=2sec).

       <b>-F,</b> <b>--CPU-freq</b>
               Do not show a warning even if cpufreq_ondemand module is loaded, and cpu-freq is not on max.

       <b>-g,</b> <b>--mcg</b>
               Send messages to multicast group with 1 QP attached to it.
               When   there   is    no    multicast    gid    specified,    a    default    IPv6    typed    gid
              '255:1:0:0:0:2:201:133:0:0:0:0:0:0:0:0' will be used.
               Relevant only for send non fsRate.

       <b>-H,</b> <b>--report-histogram</b>
               Print out all results (default print summary only).
               Relevant only for latency and raw_ethernet_fs_rate.

       <b>-i,</b> <b>--ib-port=&lt;port&gt;</b>
               Use port &lt;port&gt; of IB device (default 1).

       <b>-I,</b> <b>--inline_size=&lt;size&gt;</b>
               Max size of message to be sent in inline.
               Not relevant for Read and Atomic.

       <b>-l,</b> <b>--post_list=&lt;list</b> <b>size&gt;</b>
               Post list of send WQEs of &lt;list size&gt; size (instead of single post).
               Relevant only for BW and raw_ethernet_burst_lat.

       <b>--recv_post_list=&lt;list</b> <b>size&gt;</b>
               Post list of receive WQEs of &lt;list size&gt; size (instead of single post).
               Relevant only for BW and raw_ethernet_burst_lat.

       <b>-L,</b> <b>--hop_limit=&lt;hop_limit&gt;</b>
               Set hop limit value (ttl for IPv4 RawEth QP). Values 0-255 (default 64).
               Relevant only for RawEth
               Not relevant for raw_ethernet_fs_rate.

       <b>-m,</b> <b>--mtu=&lt;mtu&gt;</b>
               MTU size : 64 - 9600  (default port mtu) for RawEth else 256 - 4096.
               Not relevant for raw_ethernet_fs_rate.

       <b>-M,</b> <b>--MGID=&lt;multicast_gid&gt;</b>
               In multicast, uses &lt;multicast_gid&gt; as the group MGID.
               &lt;multicast_gid&gt; can be either decimal or hexadecimal, e.g. regarding the IPv4 224.0.0.30 :
               Decimal:             0:0:0:0:0:0:0:0:0:0:255:255:224:0:0:30             ,            Hexadecimal:
              0:0:0:0:0:0:0:0:0:0:0xff:0xff:0xe0:0:0:0x1e
               Relevant only for send non fsRate.

       <b>-n,</b> <b>--iters=&lt;iters&gt;</b>
               Number of exchanges (at least 5, default for write 5000 else 1000 ).

       <b>-N,</b> <b>--noPeak</b>
               Cancel peak-bw calculation (default with peak up to iters=20000).
               Relevant only for bandwidth.

       <b>-o,</b> <b>--outs=&lt;num&gt;</b>
               Relevant only for Read and Atomic.

       <b>-O,</b> <b>--dualport</b>
               Run test in dual-port mode.
               Not relevant for RawEth.
               Relevant only for bandwidth.
               System support required.

       <b>-p,</b> <b>--port=&lt;port&gt;</b>
               Listen on/connect to port &lt;port&gt; (default 18515).

       <b>-q,</b> <b>--qp=&lt;num</b> <b>of</b> <b>qp's&gt;</b>
               Num of qp's(default 1).
               Relevant only for bandwidth.

       <b>-Q,</b> <b>--cq-mod</b>
               Generate Cqe only after &lt;--cq-mod&gt; completion.
               Relevant only for bandwidth.

       <b>-r,</b> <b>--rx-depth=&lt;dep&gt;</b>
               Rx queue size (default 512), if using srq, rx-depth controls max-wr size of the srq.
               Relevant only for send non fsRate.

       <b>-R,</b> <b>--rdma_cm</b>
               Connect QPs with rdma_cm and run test on those QPs.
               Not relevant for RawEth.

       <b>-s,</b> <b>--size=&lt;size&gt;</b>
               Size of message to exchange (default 65536 for bw, for lat 2).
               Not relevant for Atomic.

       <b>-S,</b> <b>--sl=&lt;sl&gt;</b>
               SL (default 0).
               Not relevant for raw_ethernet_fs_rate.

       <b>-t,</b> <b>--tx-depth=&lt;dep&gt;</b>
               Size of tx queue (default 128 for bw else 1).
               Relevant only for bw and raw_ethernet_burst_lat.

       <b>-T,</b> <b>--tos=&lt;tos</b> <b>value&gt;</b>
               Set &lt;tos_value&gt; to RDMA-CM QPs. available only with -R flag. values 0-256 (default off).
               Not relevant for RawEth

       <b>-u,</b> <b>--qp-timeout=&lt;timeout&gt;</b>
               QP timeout, timeout value is 4 usec * 2 ^(timeout), default 14.

       <b>-U,</b> <b>--report-unsorted</b>
               (implies -H) print out unsorted results (default sorted).
               Relevant only for latency and raw_ethernet_burst_lat and raw_ethernet_fs_rate.

       <b>-V,</b> <b>--version</b>
               Display perftest version number.

       <b>-W,</b> <b>--report-counters=&lt;list</b> <b>of</b> <b>counter</b> <b>names&gt;</b>
               Report performance counter change (example: counters/port_xmit_data,hw_counters/out_of_buffer).

       <b>-x,</b> <b>--gid-index=&lt;index&gt;</b>
               Test uses GID with GID index.
               Not relevant for RawEth.

       <b>-z,</b> <b>--comm_rdma_cm</b>
               Communicate with rdma_cm module to exchange data - use regular QPs.
               Not relevant for RawEth.

       <b>--out_json</b>
               Save the report in a json file.

       <b>--out_json_file=&lt;file&gt;</b>
               Name of the report json file. (Default: "perftest_out.json" in the working directory).

       <b>--cpu_util</b>
               Show CPU Utilization in report, valid only in Duration mode.

       <b>--dlid</b>
               Set a Destination LID instead of getting it from the other side.
               Not relevant for raw_ethernet_fs_rate.

       <b>--dont_xchg_versions</b>
               Do not exchange versions and MTU with other side.
               Not relevant for RawEth.

       <b>--force-link=&lt;value&gt;</b>
               Force the link(s) to a specific type: IB or Ethernet.
               Not relevant for raw_ethernet_fs_rate.

       <b>--use-srq</b>
               Use a Shared Receive Queue. --rx-depth controls max-wr size of the SRQ.
               Relevant only for Send.

       <b>--ipv6</b>
               Use IPv6 GID. Default is IPv4.
               Not relevant for RawEth.

       <b>--ipv6-addr=&lt;IPv6&gt;</b>
               Use IPv6 address for parameters negotiation. Default is IPv4.
               Not relevant for RawEth.

       <b>--bind_source_ip</b>
               Source IP of the interface used for connection  establishment.  By  default  taken  from  routing
              table.
               Not relevant for RawEth.

       <b>--latency_gap=&lt;delay_time&gt;</b>
               delay time between each post send.
               Relevant only for latency.

       <b>--mmap=file</b>
               Use an mmap'd file as the buffer for testing P2P transfers.
               Not relevant for RawEth.

       <b>--mmap-offset=&lt;offset&gt;</b>
               The mmap offset.
               Not relevant for RawEth.

       <b>--mr_per_qp</b>
               Create memory region for each qp.
               Relevant only for bandwidth.

       <b>--odp</b>
               Use On Demand Paging instead of Memory Registration.
               System support required.

       <b>--output=&lt;units&gt;</b>
               Set verbosity output level: bandwidth , message_rate, latency.
               Latency measurement is Average calculation.
               bw (bandwidth / message_rate), latency (latency).

       <b>--payload_file_path=&lt;payload_txt_file_path&gt;</b>
               Set  the  payload  by  passing  a  txt file containing a pattern in the next form(little endian):
              '0xaaaaaaaa, 0xbbbbbbbb, ...
               Not relevant for RawEth and Write latency.

       <b>--use_old_post_send</b>
               Use old post send flow (ibv_post_send).

       <b>--perform_warm_up</b>
               Perform some iterations before start measuring in order to warming-up memory cache.
               Not relevant for raw_ethernet_fs_rate.

       <b>--pkey_index=&lt;pkey</b> <b>index&gt;</b>
               PKey index to use for QP.
               Not relevant for raw_ethernet_fs_rate.

       <b>--report-both</b>
               Report RX &amp; TX results separately on Bidirectional BW tests.
               Relevant only for bidirectional bandwidth.

       <b>--report_gbits</b>
               Report Max/Average BW of test in Gbit/sec (instead of MiB/sec).
               Relevant only for bandwidth.

       <b>--report-per-port</b>
               Report BW data on both ports when running Dualport and Duration mode.
               Not relevant for RawEth.
               System support required.

       <b>--reversed</b>
               Reverse traffic direction - Server send to client.

       <b>--run_infinitely</b>
               Run test forever, print results every &lt;duration&gt; seconds.

       <b>--retry_count=&lt;value&gt;</b>
               Set retry count value in rdma_cm mode.
               Relevant only for rdma_cm mode.
               Not relevant for RawEth.

       <b>--tclass=&lt;value&gt;</b>
               Set the Traffic Class in GRH (if GRH is in use).
               Not relevant for raw_ethernet_fs_rate.

       <b>--use-null-mr</b>
               Allocate a null memory region for the client with <b><a href="../man3/ibv_alloc_null_mr.3.html">ibv_alloc_null_mr</a></b>(3)

       <b>--use_cuda=&lt;cuda</b> <b>device</b> <b>id&gt;</b>
               Use CUDA specific device for GPUDirect RDMA testing.
               Not relevant for raw_ethernet_fs_rate.
               System support required.

       <b>--use_cuda_bus_id=&lt;cuda</b> <b>full</b> <b>BUS</b> <b>id&gt;</b>
               Use CUDA specific device, based on its full PCIe address, for GPUDirect RDMA testing.
               Not relevant for raw_ethernet_fs_rate.
               System support required.

       <b>--use_cuda_dmabuf</b>
               Use CUDA DMA-BUF for GPUDirect RDMA testing.
               Not relevant for raw_ethernet_fs_rate.
               System support required.

       <b>--use_hl=&lt;hl</b> <b>device</b> <b>id&gt;</b>
               Use HabanaLabs specific device for HW accelerator direct RDMA testing.
               System support required.

       <b>--use_neuron=&lt;logical</b> <b>neuron</b> <b>core</b> <b>id&gt;</b>
               Use Neuron specific device for HW accelerator direct RDMA testing.
               System support required.

       <b>--use_neuron_dmabuf</b>
               Use Neuron DMA-BUF for HW accelerator direct RDMA testing.
               System support required.

       <b>--use_rocm=&lt;rocm</b> <b>device</b> <b>id&gt;</b>
               Use selected ROCm device for GPUDirect RDMA testing.
               Not relevant for raw_ethernet_fs_rate.
               System support required.

       <b>--use_hugepages</b>
               Use Hugepages instead of contig, memalign allocations.
               Not relevant for raw_ethernet_fs_rate.

       <b>--wait_destroy=&lt;seconds&gt;</b>
               Wait &lt;seconds&gt; before destroying allocated resources (QP/CQ/PD/MR..).
               Relevant only for bandwidth and raw_ethernet_burst_lat.

       <b>--disable_pcie_relaxed</b>
               Disable PCIe relaxed ordering.
               Relevant only for bandwidth and raw_ethernet_burst_lat.
               System support required.

       <b>--burst_size=&lt;size&gt;</b>
               Set the amount of messages to send in a burst when using rate limiter.
               Relevant only for bandwidth and raw_ethernet_burst_lat.

       <b>--typical_pkt_size=&lt;bytes&gt;</b>
               Set the size of packet to send in a burst. Only supports PP rate limiter.
               Relevant only for bandwidth and raw_ethernet_burst_lat.

       <b>--rate_limit=&lt;rate&gt;</b>
               Set the maximum rate of sent packages. default unit is [Gbps]. use --rate_units to change that.
               Relevant only for bandwidth and raw_ethernet_burst_lat.

       <b>--rate_units=&lt;units&gt;</b>
               [Mgp] Set the units for rate limit to MiBps (M), Gbps (g) or pps (p). default is Gbps (g).
               Relevant only for bandwidth and raw_ethernet_burst_lat.

       <b>--rate_limit_type=&lt;type&gt;</b>
               [HW/SW/PP] Limit the QP's by HW, PP or by  SW.  Disabled  by  default.  When  rate_limit  is  not
              specified HW limit is Default.
               Relevant only for bandwidth and raw_ethernet_burst_lat.

       <b>--use_ooo</b>
               Use out of order data placement.
               System support required.

       <b>--write_with_imm</b>
               Use write-with-immediate verb instead of write.
               Write tests only.

   <b>RawEth</b> <b>only</b> <b>options</b>
       <b>-B,</b> <b>--source_mac</b>
               Source MAC address by this format XX:XX:XX:XX:XX:XX **MUST** be entered.

       <b>-E,</b> <b>--dest_mac</b>
               Destination MAC address by this format XX:XX:XX:XX:XX:XX **MUST** be entered.

       <b>-G,</b> <b>--use_rss</b>
               Use  RSS  on server side. need to open 2^x qps (using -q flag. default is -q 2). open 2^x clients
              that transmit to this server.

       <b>-J,</b> <b>--dest_ip</b>
               Destination ip address by this format X.X.X.X for IPv4 or X:X:X:X:X:X for  IPv6  (using  to  send
              packets with IP header).
               System support required for IPv6.

       <b>-j,</b> <b>--source_ip</b>
               Source  ip address by this format X.X.X.X for IPv4 or X:X:X:X:X:X for IPv6 (using to send packets
              with IP header).
               System support required for IPv6.

       <b>-K,</b> <b>--dest_port</b>
               Destination port number (using to send packets with UDP header as default, or you can  use  --tcp
              flag to send TCP Header).

       <b>-k,</b> <b>--source_port</b>
               Source  port  number (using to send packets with UDP header as default, or you can use --tcp flag
              to send TCP Header).

       <b>-Y,</b> <b>--ethertype</b>
               Ethertype value in the ethernet frame by this format 0xXXXX.

       <b>-Z,</b> <b>--server</b>
               Choose server side for the current machine (--server/--client must be selected ).

       <b>--vlan_en</b>
               Insert vlan tag in ethernet header.

       <b>--vlan_pcp</b>
               Specify vlan_pcp value for vlan tag, 0~7. 8 means different vlan_pcp for each packet.

       <b>-P,</b> <b>--client</b>
               Choose client side for the current machine (--server/--client must be selected).
               Not relevant for raw_ethernet_fs_rate.

       <b>-v,</b> <b>--mac_fwd</b>
               Run mac forwarding test.
               Not relevant for raw_ethernet_fs_rate.

       <b>--flows</b>
               Set number of TCP/UDP flows, starting from &lt;src_port, dst_port&gt;.
               Not relevant for raw_ethernet_fs_rate.

       <b>--flows_burst</b>
               Set number of burst size per TCP/UDP flow.
               Not relevant for raw_ethernet_fs_rate.

       <b>--promiscuous</b>
               Run promiscuous mode.
               Not relevant for raw_ethernet_fs_rate.

       <b>--reply_every</b>
               In latency test, receiver pong after number of received pings.
               Not relevant for raw_ethernet_fs_rate.

       <b>--sniffer</b>
               Run sniffer mode.
               Not relevant for raw_ethernet_fs_rate.
               System support required.

       <b>--flow_label</b>
               IPv6 flow label.
               Not relevant for raw_ethernet_fs_rate.

       <b>--tcp</b>
               Send TCP Packets. must include IP and Ports information.

       <b>--raw_ipv6</b>
               Send IPv6 Packets.
               System support required.

       <b>--raw_mcast.</b>
               Relevant only for bandwidth.

</pre><h4><b>AUTHORS</b></h4><pre>
       <b>Hassan</b> <b>Khadour</b> <b>&lt;<a href="mailto:hkhadour@nvidia.com">hkhadour@nvidia.com</a>&gt;</b>

       <b>Talat</b> <b>Batheesh</b> <b>&lt;<a href="mailto:talatb@nvidia.com">talatb@nvidia.com</a>&gt;</b>

                                                                                                     <u><a href="../man1/perftest.1.html">perftest</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>