<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmlogctl - manage and control Performance Co-Pilot archivers</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/pcp">pcp_6.3.3-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>pmlogctl</b> - manage and control Performance Co-Pilot archivers

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pmlogctl</b> [<b>-afmNV?</b>]  [<b>-C</b> <u>check_args</u>] [<b>-c</b> <u>class</u>] [<b>-i</b> <u>ident</u>] [<b>-p</b> <u>policy</u>] <u>command</u> [<u>host</u> <u>...</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pmlogctl</b>  may  be  used  to  manage  <u>non-primary</u>  instances  of  the  Performance Co-Pilot (PCP) archiver
       <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1).  This would be most relevant in a PCP archiver ``farm''  where  many  <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1)  instances
       would be creating archives of performance data collected from <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) on many remote hosts.

       The  <u>primary</u>  <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1)  instance  is  closely linked to the local <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) process and as a consequence
       shares the same control infrastructure, namely <b><a href="../man1/systemd.1.html">systemd</a></b>(1) or the PCP <b><a href="../man1/init.1.html">init</a></b>(1) ``rc scripts''.  This is why
       the <u>primary</u> <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) instance <u>cannot</u> be managed with <b>pmlogctl</b>.

       For brevity in the description below, the term ``instance'' means a <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) instance.

       All instances managed by <b>pmlogctl</b>, <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1) and <b><a href="../man1/pmlogger_daily.1.html">pmlogger_daily</a></b>(1) abide by the following rules:

       1. Each instance is fetching performance data from a single <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) (i.e. one host), but each <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) may
          be providing performance data to zero, one or more <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) processes running on one or more hosts.

       2. On the local host, each <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) instance must be specified once  in  a  <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1)  control
          file  and  <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1)  creates  archives  in  a  unique  directory, named in the 4th parameter of the
          associated control file entry (see the CONFIGURATION section of <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1)).

       3. Each instance belongs to exactly one <b>class</b>, optionally named using a  <b>$class=...</b>   assignment  in  the
          associated  control file.  The special <b>default</b> class is reserved for all instances that do not have an
          associated <b>$class=...</b>  assignment.  For reporting purposes (refer to the <b>summary</b> command  below),  the
          <u>primary</u> <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) instance is automatically assigned to the special <b>primary</b> class.

       Each  <b>pmlogctl</b>  execution  manages  one  or more instances updating the associated control files and then
       running <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1) to effect the desired change.

       The <u>host</u> arguments are usually valid  host  names.   For  all  commands  <u>except</u>  <b>create</b>  and  <b>cond-create</b>
       (described  below)  the <u>host</u> arguments may also be <b><a href="../man1/egrep.1.html">egrep</a></b>(1) regular expressions that match the <u>whole</u> of a
       valid host name, so the pattern used is actually <b>^</b><u>host</u><b>$</b>.  For example  <b>foo.*</b>   (matches  all  host  names
       beginning  with  ``foo'')  or  <b>.*foo</b>  (matches  all  host  names ending with ``foo'') or <b>.*[fF][oO][oO].*</b>
       (matches all host names containing ``foo'' in upper, lower or mixed case).

       The combination of a <u>class</u> from the optional <b>-c</b> option (or  <b>default</b>)  and  the  <u>host</u>  arguments  to  each
       <u>command</u> identifies a <u>target</u> <u>of</u> <u>set</u> instances to which the <u>command</u> operation should be applied.

       The  <b>-i</b> option may be used with the <b>create</b> or <b>cond-create</b> commands to override the instance identity that
       is specified in the ident section of the class policy file (see the CLASS  POLICY  FILE  section  below).
       Since the identifier must be unique across all instances and all classes, it only makes sense to use this
       option when there is a single <u>host</u> argument.

       Given the tasks that <b>pmlogctl</b> is undertaking it usually must be run as ``root'', the exceptions being the
       <b>status</b> command or when the <b>-N</b> option is specified.

</pre><h4><b>COMMANDS</b></h4><pre>
       <u>command</u> is one of the following:

       <b>check</b>
           Check the status of all currently configured pmlogger instances and restart any that have failed.  If
           the  <b>-m</b>  flag  is  given  on  <a href="../man1/systemd.1.html">systemd</a>(1)  platforms, also migrate matching (and new) processes to the
           <b>pmlogger_farm</b> service.

       <b>create</b>
           Create new instances in the class <u>classname</u> (<b>default</b> by default) for the <u>host</u> hosts.  The name of the
           class is used to identify a class policy file  (see  the  CLASS  POLICY  FILE  section  below)  which
           provides  a  template  for  each  new  control  file  with <b>%h</b> replaced by <u>host</u> and <b>%i</b> replaced by the
           instance's (unique) identifier from the ident section of the class policy file or <u>ident</u> from  the  <b>-i</b>
           option.

           The  <b>-p</b>  option  may be used to identify a class policy file other than the one found in the standard
           place, i.e. <u>$PCP_SYSCONF_DIR/pmlogger/class.d/classname</u>.

           At least one <u>host</u> must be specified for the <b>create</b> command.

       <b>cond-create</b>
           Similar to <b>create</b> but the instance will only be created if  one  of  the  conditions  in  the  create
           section of associated class policy file(s) evaluates to true.

           If  a <b>-c</b> option is specified, then only the class <u>classname</u> will be considered, otherwise <b>all</b> classes
           will be considered.  In the latter case, if none of the conditions in any of the classes evaluates to
           true, the the special <b>pmfind</b> class is used (this is the ``default'' class for the <b>cond-create</b> command
           when all else fails).

           If more than one class evaluates to true then a composite <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) configuration file  is  created
           and  the instance is also assigned to the special <b>pmfind</b> class.  The composite configuration file may
           contain a mix of explicit configuration  clauses  and  the  more  general  conditional  configuration
           clauses as understood by the <b><a href="../man1/pmlogconf.1.html">pmlogconf</a></b>(1) tool.

       <b>start</b>
           Start the target set of instances.

           If  the  target  set intentionally contains more than one instance, then the <b>-a</b> option should be used
           (this is designed to reduce  the  risk  of  accidentally  starting  a  potentially  large  number  of
           <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) processes).

           If  an  instance  in the target set is already started, no change is made (see the <b>restart</b> command to
           force new instances to be launched).

       <b>stop</b>
           Stop the target set of instances.

           If the target set intentionally contains more than one instance, then the <b>-a</b> option  should  be  used
           (this  is  designed  to  reduce  the  risk  of  accidentally  stopping  a potentially large number of
           <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) processes).

           If an instance in the target set is already stopped, no change is made but a warning is issued.

       <b>restart</b>
           Stop and then start the target set of instances.

           If the target set intentionally contains more than one instance, then the <b>-a</b> option  should  be  used
           (this is designed to reduce the risk of accidentally stopping and starting a potentially large number
           of <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) processes).

           If  an  instance  in  the  target  set is already stopped, a warning is issued before the instance is
           started.

       <b>status</b>
           Report the status of the target set of instances.  If there is no <b>-c</b> option  specified  and  no  <u>host</u>
           arguments, i.e. the target set is empty, then <u>all</u> instances will be reported.

       <b>destroy</b>
           Destroy  the  target  set  of  instances.   At  the  end of this operation the associated <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1)
           processes will have been stopped and the relevant control file information removed.

           If the target set intentionally contains more than one instance, then the <b>-a</b> option  should  be  used
           (this  is  designed  to  reduce  the  risk  of accidentally terminating a potentially large number of
           <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) processes and removing their <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1) configurations).

           The policy file linked to the class of an instance to be destroyed may contain a <b>destroy</b> section that
           may influence if and how the destroy operation should be performed.  This may require a <b>-p</b> option  to
           find the associated class policy file.

           The class policy checking can be by-passed using the <b>-f</b> (force) command line option.

</pre><h4><b>CLASS</b> <b>POLICY</b> <b>FILE</b></h4><pre>
       A  class  policy  file  contains a number of sections, each section begins with a line that simply starts
       with the name of the section followed enclosed by ``['' and ``]''.

       Lines beginning with a hash (#) are treated as comments and ignored.   Blank  or  empty  lines  are  also
       ignored.

       The typical location of the policy file for the class <u>foo</u> is <u>$PCP_SYSCONF_DIR/pmlogger/class.d/foo</u>.

       <b>[class]</b>
           The  optional  class  name  section  names  the class.  If it is missing, the name of the policy file
           (stripped of any directory prefix) is used as the name of the class.

       <b>[ident]</b>
           The ident section specifies the template to be used for the instance identifier to be given  to  each
           member of the class.  This identifier needs to be unique across all instances and all classes, and it
           needs  to  be a valid file name in the local filesystem, so would normally contain the class name and
           the macro <b>%h</b>, e.g. <b>foo-%h</b>.  The macro is replaced by the <u>host</u> when each instance is created.

       <b>[control]</b>
           The control section consists of one or more lines of template text that will be used  to  create  the
           control  file  for  each  instance.  This must at least include the <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1) control line to
           specify how to start the associated <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) process; this line contains fields separated by white
           space as follows:
           1.  the hostname, usually the macro <b>%h</b>
           2.  <b>n</b> to indicate this is a non-primary instance
           3.  the ``socks'' flag, typically <b>n</b>
           4.  the directory in which the <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) archives will be created; this needs to be unique  and  is
               usually  specified  using  the  <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1) macro <b>PCP_ARCHIVE_DIR</b> as the start of the path,
               followed by the instance identifier, usually the macro <b>%i</b>, e.g. <b>PCP_ARCHIVE_DIR/%i</b>
           5.  additional parameters to <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) which probably include at least a <b>-c</b>  option  to  provide  a
               configuration  file  that  describes  which metrics should be logged for instances of this class,
               which may be the same for all instances in this class, or it may include the <b>%i</b> macro  to  use  a
               different  configuration  file  for each instance.  Note that if this configuration file does not
               exist, it will be created using <b><a href="../man1/pmlogconf.1.html">pmlogconf</a></b>(1) the first time <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1) is run.

           <u>Before</u> the control line there should be a line that defines the version  of  the  control  line  that
           follows, i.e.
           <b>$version=1.1</b>
           If  this is missing, <b>pmlogctl</b> will assume the version is 1.1 and insert the line when the instance is
           created.

           <b>pmlogctl</b> will also add the class name during creation. e.g.
           <b>$class=foo</b>

       <b>[create]</b>
           The create section defines the conditions that must be met before an instance will  be  created  with
           the  <b>cond-create</b>  command.   The  intent  is  to allow different decisions to be made when a new host
           running <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1) is discovered, e.g. by <b><a href="../man1/pmfind.1.html">pmfind</a></b>(1).

           Each non-blank line in the create section is a condition of the form <u>function</u>(<u>arg</u>), where <u>function</u> is
           one of the following:

           <u>exists</u>
               <u>arg</u> is the name of a performance metric and <u>exits</u> evaluates to true if that metric exists in  the
               Performance Metrics Name Space (PMNS) on the remote host

           <u>values</u>
               <u>arg</u>  is  the name of a performance metric in the remote PMNS and <u>values</u> evaluates to true if some
               instance of that metric has a value on the remote host

           <u>condition</u>
               <u>arg</u> is a derived metric expression in the format supported by <b><a href="../man3/pmRegisterDerived.3.html">pmRegisterDerived</a></b>(3), and <u>condition</u>
               evaluates to true if the value of that expression on the remote host is greater than zero

           <u>hostname</u>
               <u>arg</u> is a regular expression in the style of <b><a href="../man1/egrep.1.html">egrep</a></b>(1) and <u>hostname</u> evaluates to true if the remote
               host name matches <u>arg</u>

       <b>[destroy]</b>
           The destroy section defines the policy to be applied when an instance is destroyed.

           The intent is to allow different decisions to  be  made  when  discovery  service,  e.g.   <b><a href="../man1/pmfind.1.html">pmfind</a></b>(1),
           notices  that  a  host  associated with an instance is no longer present.  But in the current version
           this is not implemented and the destroy section syntax and semantics is not yet defined.

       A sample class policy file is as follows:

           # policy file for the foo class
           [class]
           foo
           [ident]
           foo-%h

           [control]
           $version=1.1
           %h n n PCP_ARCHIVE_DIR/%i -c foo-metrics.config

           [create]
           # matches all hosts
           hostname(.*)

           [destroy]
           # still to be defined

</pre><h4><b>OPTIONS</b></h4><pre>
       The available command line options are:

       <b>-a</b>, <b>--all</b>
            Apply action to all matching instances.  By default only one instance  definition  is  expected  and
            acted upon.

       <b>-c</b> <u>class</u>, <b>--class</b>=<u>class</u>
            Set the name of the class for which <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1) instances belong to as <u>class</u>.

       <b>-C</b> <u>check_args</u>, <b>--checkargs</b>=<u>check_args</u>
            <u>check_args</u>  are  additional command line arguments for <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1) when it is called.  This is
            most useful for options like <b>-V</b>.  Multiple <b>-C</b> options may be used and the various <u>check_args</u> options
            will be accumulated and all passed to <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1).

       <b>-f</b>, <b>--force</b>
            Force action if possible.

       <b>-i</b> <u>ident</u>, <b>--ident</b>=<u>ident</u>
            Override instance identifier with <u>ident</u>.  This option applies  only  for  the  commands  <b>create</b>  and
            <b>cond-create</b>.

       <b>-N</b>, <b>--showme</b>
            Runs  <b>pmlogctl</b> in a ``show me'' or ``dry run'' mode where the intent of the command is shown, but no
            changes are made.

       <b>-m</b>, <b>--migrate</b>
            When used with the <b>create</b> or <b>check</b> commands on <b><a href="../man1/systemd.1.html">systemd</a></b>(1) platforms, also migrate  new  or  existing
            non-primary <b>pmlogger</b> processes to the <b>pmlogger_farm</b> service.  This is normally done automatically by
            the  <b>pmlogger_farm_check</b>  service, which is timer driven (so there may be a few minutes delay before
            automatic migration is initiated).

       <b>-p</b> <u>policy</u>, <b>--policy</b>=<u>policy</u>
            Use <u>policy</u> as the class policy file.  Defaults to <u>$PCP_SYSCONF_DIR/pmlogger/class.d/&lt;class&gt;</u>.

       <b>-V</b>, <b>--verbose</b>
            Enable verbose mode.  Using this option twice increases verbosity.  Verbose  output  is  written  to
            <u>stderr</u>.

       <b>-?</b>, <b>--help</b>
            Display usage message and exit.

</pre><h4><b>PCP</b> <b>ENVIRONMENT</b></h4><pre>
       Environment  variables with the prefix <b>PCP_</b> are used to parameterize the file and directory names used by
       PCP.  On each installation, the file <u>/etc/pcp.conf</u> contains the local values for  these  variables.   The
       <b>$PCP_CONF</b> variable may be used to specify an alternative configuration file, as described in <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/egrep.1.html">egrep</a></b>(1),   <b><a href="../man1/init.1.html">init</a></b>(1),   <b><a href="../man1/PCPIntro.1.html">PCPIntro</a></b>(1),   <b><a href="../man1/pmcd.1.html">pmcd</a></b>(1),  <b><a href="../man1/pmlc.1.html">pmlc</a></b>(1),  <b><a href="../man1/pmlogconf.1.html">pmlogconf</a></b>(1),  <b><a href="../man1/pmlogger.1.html">pmlogger</a></b>(1),  <b><a href="../man1/pmlogger_check.1.html">pmlogger_check</a></b>(1),
       <b><a href="../man1/pmlogger_daily.1.html">pmlogger_daily</a></b>(1), <b><a href="../man1/systemd.1.html">systemd</a></b>(1), <b><a href="../man3/PMAPI.3.html">PMAPI</a></b>(3), <b><a href="../man3/pmDerivedRegister.3.html">pmDerivedRegister</a></b>(3) and <b><a href="../man5/pcp.conf.5.html">pcp.conf</a></b>(5).

Performance Co-Pilot                                   PCP                                           <u><a href="../man1/PMLOGCTL.1.html">PMLOGCTL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>