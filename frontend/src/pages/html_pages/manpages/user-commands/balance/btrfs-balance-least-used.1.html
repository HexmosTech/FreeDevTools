<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>btrfs-balance-least-used - Feed least used data block groups to btrfs balance first.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/python3-btrfs">python3-btrfs_14.1-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       btrfs-balance-least-used - Feed least used data block groups to btrfs balance first.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>btrfs-balance-least-used</b> [<u>args</u>] <u>mountpoint</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>btrfs-balance-least-used</b> program is an example of a user space defined way to implement btrfs balance
       filters. It looks at the data block groups present in the file system and asks btrfs to empty them in
       order of actual usage, lowest usage first.

       In most cases (when not being in the process of conversion between block group profiles) this will result
       in the most optimal and quickest way to reclaim physical disk space because data will be rewritten into
       empty space into already existing block groups.

       What btrfs balance effectively does is just taking the data and feeding it back to the allocator of the
       filesystem as new writes, blacklisting their current location. Implementing user space balance filters
       can result in a higly optimized workflow to reclaim physical space, or to minimize the amount of data
       that has to be rewritten to rebalance complex filesystems with multiple devices.

       Usage of <b>btrfs-balance-least-used</b> can replace repeated invocations of <b>btrfs</b> <b>balance</b> with increased usage
       values. Additionally, the program will show live progress of the balance operation.

       Because the needed information is retrieved using the btrfs kernel API, and because btrfs balance is a
       privileged operation, it has to be run as root.

       Example output:

           -# balance_least_used.py -u 40 /
           Loading block group objects with used_pct &lt;= 40 ... found 20
           Balance block group vaddr 603497431040 used_pct 19 ... duration 2 sec total 212
           Balance block group vaddr 488607055872 used_pct 21 ... duration 2 sec total 211
           Balance block group vaddr 576653885440 used_pct 21 ... duration 3 sec total 210
           [...]
           Postponing block group vaddr 659332005888 used_pct changed 24 -&gt; 36
           Balance block group vaddr 560547758080 used_pct 25 ... duration 3 sec total 206
           [...]
           Ignoring block group vaddr 606718656512 used_pct changed 34 -&gt; 63
           Balance block group vaddr 714126393344 used_pct 35 ... duration 3 sec total 196

       This clearly shows that balance packs data into existing other block groups, since the total amount of
       block groups is going down all the time.

       Also, along the way we see that usage of block groups we found when starting has gone up, so if they're
       still in the usage range, we just postpone them again, throwing them back into the work queue. If their
       usage has gone up above the usage limit, ignore them.

       When there's nothing to do, the output reports the lowest used_pct found:

           -# balance_least_used.py -u 10 /
           Loading block group objects with used_pct &lt;= 10 ... found 0
           Nothing to do, least used block group has used_pct 12

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-h</b>, <b>--help</b>
              Show the built-in help message and exit.

       <b>-u</b>, <b>--usage</b> <u>USAGE</u>
              Only consider block groups with usage less than or equal to this percentage.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       This program is an example of what can be done using the python-btrfs library.

       Source and documentation on github: https://github.com/knorrie/python-btrfs

                                                      2017                           <u><a href="../man1/BTRFS-BALANCE-LEAST-USED.1.html">BTRFS-BALANCE-LEAST-USED</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>