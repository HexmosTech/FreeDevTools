<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jabber-querybot - a modular perl jabber bot</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/jabber-querybot">jabber-querybot_0.1.0-1.1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       jabber-querybot - a modular perl jabber bot

</pre><h4><b>DESCRIPTION</b></h4><pre>
       jabber-querybot connects a jabber account and wait for messages. If a message comes in, it forward it to
       your self programmend modul. The return string of your module, jabber-querybot send it back to the jabber
       sender.

       It is designed to be re-usable and to make it easy to write small Jabber bots that do one thing and do it
       well. A simple concept with a lot of examples and experiences are implemented.

       1. Create a jabber account on a jabber-server around

       2. Create a bot application:

        cd examples
        cp Querymodule.pm /etc/jabber-querybot/Mybot.pm
        cd /etc/jabber-querybot
        ln -s Mybot.pm Querymodule.pm

       Modify login parameters to your jabber-bot-account

       vim Mybot.pm

         our $hostname        = "swissjabber.ch";
         our $user            = "";
         our $password        = "";
         our $ident           = "Testbot";
         our $bot_admin       = "\@swissjabber.ch";
         our $port            = "5222";
         our $timeout         = "5";
         our $service_name    = "$user\@$hostname";
         our $bot_description = "Bot help title
         Bot description";

       For each jabber message, jabber-querybot will execute sub run_query, that you can write here your
       application.

       You can control how your jabber response will be:

       •   error = error message stanza

       •   presence = error as presence stanza

       •   ignore = ignore message

</pre><h4><b>OPTIONS</b></h4><pre>
       jabber-querybot has a lot of variables which you can easy modify for what you need:

   <b>querystatus</b>
       $querystatus = [ 0 | 1 ]

       •   0 = Bot will not proceed any incoming jabber messages.

       •   1 = Bot will proceed incoming messages.

   <b>penalty_status</b>
       If  the  bot  has too much workload, it goes to penalty status and wait some time until his status change
       back to normal.

       $timer_reconnect_default = 21600

       Every 21600 seconds (6 hours) the bot will shutdown automatically, wait 10 seconds and starting up again.

       $timer_auto_query = 0

       If you set in your module this variable  to  60,  the  bot  will  every  60  seconds  call  the  function
       <b>run_auto_query()</b> which you may use for several things.

   <b>System</b> <b>load</b>
       If  your  systems  load  is  &gt;=6, this bot will shutdown the jabber connection and check every 10 seconds
       systems load. If load &lt;=2, bot will start over.

</pre><h4><b>EXAMPLES</b></h4><pre>
       /usr/share/doc/jabber-querybot/examples/Testbot.pm

</pre><h4><b>FILES</b></h4><pre>
       /etc/jabber-querybot/Querymodule.pm

       /usr/bin/jabber-querybot

</pre><h4><b>RESOURCES</b></h4><pre>
       <a href="http://github.com/micressor/jabber-querybot/">http://github.com/micressor/jabber-querybot/</a>

</pre><h4><b>METHODS</b></h4><pre>
   <b>InMessage()</b>
       An incoming jabber message to the bot will hook this function.

       • Read parameters of incoming stanza

       • Decode utf8 string

       • increment timer overload and do not process message if bot is overloaded.

       • Ignore message if it is from myself

       • Be sure, that it is not a message from another transport

       • Check any systemcommands for the bot

       • If the bot has sleeping status, change it to work

       • We process only normal text or chat type jabber messages

       • And now we give the real text string which was incoming to the bot via <b>run_query()</b>.

       • If <b>run_query()</b> say us 'ignore` we do a log entry and do not answer via jabber to the user.

       • If <b>run_query()</b> says 'error` we send a jabber error stanza wiht the status message from <b>run_query()</b> back
         to the user.

       • If there was no error, we update the statistic vars and send the answer from <b>run_query()</b>  back  to  the
         jabber user.

   <b>connect_server()</b>
       This function connects to the jabber server with the given credentials from Querymodule.pm.

       Set  the  call back functions. This functions will be executed if a message of the types &lt;message/&gt; &lt;iq/&gt;
       or &lt;presence/&gt; are incoming.

   <b>Stop()</b>
       Shutdown jabber connection and exit main program

   <b>disconnect_server()</b>
       Only disconnect from the jabber-server.

   <b>reconnect_server()</b>
       Reconnect and create a log entry.

   <b>InIQ()</b>
       We do not proceed any iq (information query), this is only for statisic.

   <b>InPresence()</b>
       • Increment timer overload

       • Do not process message if we are overloaded <b>penalty_handler()</b>.

       We have a problem in Net::Jabber. An incoming message with a ` in resource blocks the bot. We will hotfix
       that for the moment.

       A subscription type `subscribe` is incoming. Send `subscribed` tho the user and say hello ;)

       • Send presence to user

       • Remove subscription if a user remove this bot from his roster

   <b>sendPresence()</b>
       Send presence information to user

   <b>systemcommands()</b>
       • If user type '!help` send a help instruction to the user

       • Send statistic information to the user if he types '!status`

       • Is it a bot command?

       • Is the bot command from the bot admin? If not, send "not allowed"

       • '!shutdown` will shutdown your bot via jabber invoke.

       • '!query off` turn off queries

       • '!query on` turn on queries

   <b>get_barejid()</b>
       Remove resource id from a jabber id.

   <b>calcualte_stats()</b>
       Calculate message statistics

   <b>jabber_set_presence()</b>
       Set new presence if we have another presence status  or  we  have  set  the  force  flag  (for  transport
       presence).

   <b>jabber_send_message()</b>
       This function send all jabber messages which are outgoing from the jabber-querybot.

   <b>set_wakeup_mode()</b>
       Set jabber presence via <b>jabber_set_presence()</b>

   <b>penalty_handler()</b>
       This function checks if the bot is overloaded with incoming mesages and reject if it is. Two times that's
       ok so 2:1 because while in main.

       Bot admin got everytime an answer.

   <b>jabber_add_footer()</b>
       Add footer to the processed message.

   <b>calcualte_elapsed_time()</b>
       Calculate elapsed worktime for a query

   <b>sendError()</b>
       sendError($message, $from, $to, 404, "text");

   <b>system_load_check()</b>
       • Calculate system load

       • If load is too high shutdown bot.

       • If load is ok, starting up bot

   <b>connect_bot()</b>
       Connect bot and initialize all timers.

   <b>check_before_start()</b>
       Check  configuration  variables  in  Querybotmodule.pm  and  give answer if anything does not match or is
       missing.

</pre><h4><b>COPYRIGHT</b> <b>AND</b> <b>LICENSE</b></h4><pre>
       Copyright (C) 2009-2012 Marco Balmer &lt;<a href="mailto:marco@balmer.name">marco@balmer.name</a>&gt;

       The Debian packaging is licensed under the GPL, see `<a href="file:/usr/share/common-licenses/GPL-3">/usr/share/common-licenses/GPL-3</a>'.

perl v5.32.0                                       2021-01-09                                <u><a href="../man1p/JABBER-QUERYBOT.1p.html">JABBER-QUERYBOT</a></u>(1p)
</pre>
 </div>
</div></section>
</div>
</body>
</html>