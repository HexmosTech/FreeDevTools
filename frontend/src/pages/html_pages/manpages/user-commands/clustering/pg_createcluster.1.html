<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pg_createcluster - create a new PostgreSQL cluster</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/postgresql-common">postgresql-common_274_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pg_createcluster - create a new PostgreSQL cluster

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pg_createcluster</b> [<u>options</u>] <u>version</u> <u>name</u> [<b>--</b> <u>initdb</u> <u>options</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pg_createcluster</b> creates a new PostgreSQL server cluster (i. e. a collection of databases served by a
       <b><a href="../man1/postgres.1.html">postgres</a></b>(1) instance) and integrates it into the multi-version/multi-cluster architecture of the
       <b>postgresql-common</b> package.

       Every cluster is uniquely identified by its version and name. The name can be arbitrary. The default
       cluster that is created on installation of a server package is main. However, you might wish to create
       other clusters for testing, with other superusers, a cluster for each user on a shared server, etc.
       pg_createcluster will abort with an error if you try to create a cluster with a name that already exists
       for that version.

       For compatibility with <b>systemd</b> service units, the cluster name should not contain any dashes (<b>-</b>).
       <b>pg_ctlcluster</b> will warn about the problem, but succeed with the operation.

       Given a major PostgreSQL <u>version</u> (like "8.2" or "8.3") and a cluster <u>name</u>, it creates the necessary
       configuration files in /etc/postgresql/<u>version</u>/<u>name</u>/; in particular these are postgresql.conf,
       pg_ident.conf, pg_hba.conf, a postgresql-common specific configuration file start.conf (see <b>STARTUP</b>
       <b>CONTROL</b> below), pg_ctl.conf, and a symbolic link log which points to the log file (by default,
       /var/log/postgresql/postgresql-<u>version</u>-<u>name</u>.log).

       postgresql.conf is automatically adapted to use the next available port, i.  e. the first port (starting
       from 5432) which is not yet used by an already existing cluster.

       If the data directory does not yet exist, PostgreSQL's <b><a href="../man1/initdb.1.html">initdb</a></b>(1) command is used to generate a new
       cluster structure. If the data directory already exists, it is integrated into the <b>postgresql-common</b>
       structure by moving the configuration file and setting the data_directory option. Please note that this
       <u>only</u> works for data directories which were created directly with <b>initdb</b>, i.  e. all the configuration
       files (postgresql.conf etc.) must be present in the data directory.

       If a custom socket directory is given and it does not exist, it is created.

       If the log file does not exist, it is created. In any case the permissions are adjusted to allow write
       access to the cluster owner. Please note that postgresql.conf can be customized to specify log_directory
       and/or log_filename; if at least one of these options is present, then the symbolic link log in the
       cluster configuration directory is ignored.

       If the default snakeoil SSL certificate exists (/etc/ssl/certs/ssl-cert-snakeoil.pem and
       /etc/ssl/private/ssl-cert-snakeoil.key), and the postgres user is in the ssl-cert Unix group,
       <b>pg_createcluster</b> configures the cluster to use this certificate, and enables SSL. Therefore all clusters
       will use the same SSL certificate by default. For versions up to 9.1, symlinks in the data directory will
       be created (server.crt and server.key); for 9.2 and later, the appropriate postgresql.conf options will
       be set (ssl_cert_file and ssl_key_file). Of course you can replace this with a cluster specific
       certificate. Similarly for /etc/postgresql-common/root.crt and /etc/postgresql-common/root.crl, these
       files will be configured as client certificate CA and revocation list, when present. (root.crt is
       initially a placeholder that will only be used if real certificates are added to the file.)

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-u</b> <u>user</u>, <b>--user=</b><u>user</u>
           Set  the  user  who owns the cluster and becomes the database superuser to the given name or uid.  By
           default, this is the user <b>postgres</b>.  A cluster must not be owned by root.

       <b>-g</b> <u>group</u>, <b>--group=</b><u>group</u>
           Change the group of the cluster related data files. By default this will be the primary group of  the
           database owner.

       <b>-d</b> <u>dir</u>, <b>--datadir=</b><u>dir</u>
           Explicitly  set  the data directory path, which is used to store all the actual databases and tables.
           This will become quite big (easily in the order of five times the amount of actual data stored in the
           cluster). Defaults to /var/lib/postgresql/<u>version</u>/<u>cluster</u>.

       <b>-s</b> <u>dir</u>, <b>--socketdir=</b><u>dir</u>
           Explicitly set the  directory  where  the  <b><a href="../man1/postgres.1.html">postgres</a></b>(1)  server  stores  the  Unix  socket  for  local
           connections.  Defaults  to /var/run/postgresql/ for clusters owned by the user <b>postgres</b>, and <a href="file:/tmp">/tmp</a> for
           clusters owned by other users.  Please be aware that <a href="file:/tmp">/tmp</a> is an unsafe directory since everybody  can
           create  a socket there and impersonate the database server. If the given directory does not exist, it
           is created with appropriate permissions.

       <b>-l</b> <u>path</u>, <b>--logfile=</b><u>path</u>
           Explicitly   set   the   path   for    the    <b><a href="../man1/postgres.1.html">postgres</a></b>(1)    server    log    file.    Defaults    to
           /var/log/postgresql/postgresql-<u>version</u>-<u>cluster</u>.log.

       <b>--locale=</b><u>locale</u>
           Set  the  default  locale  for  the  database cluster. If this option is not specified, the locale is
           inherited from the environment that <b>pg_createcluster</b> runs in.

       <b>--lc-collate=</b><u>locale</u>
       <b>--lc-ctype=</b><u>locale</u>
       <b>--lc-messages=</b><u>locale</u>
       <b>--lc-monetary=</b><u>locale</u>
       <b>--lc-numeric=</b><u>locale</u>
       <b>--lc-time=</b><u>locale</u>
           Like <b>--locale</b>, but only sets the locale in the specified category.

       <b>-e</b> <u>encoding</u>, <b>--encoding=</b><u>encoding</u>
           Select the encoding of the template database. This will also be the default encoding of any  database
           you  create later, unless you override it there. The default is derived from the locale, or SQL_ASCII
           if that does not work.  The character sets supported by the PostgreSQL server are  described  in  the
           documentation.

           <b>Note</b>: It is not recommended to set this option directly! Set the locale instead.

       <b>-p</b> <u>port</u>, <b>--port=</b><u>port</u>
           Select  the  port  the  new cluster listens on (for the Unix socket and the TCP port); this must be a
           number between 1024 and 65535, since PostgreSQL does not run as root and thus needs  an  unprivileged
           port number. By default the next free port starting from 5432 is assigned.

       <b>-q</b> <b>--quiet</b> <b>--no-status</b>
           Suppress output from <b>initdb</b> and (or only) the cluster status message at the end of the output.

       <b>--start</b>
           Immediately  start  a  server  for  the  cluster  after creating it (i. e. call pg_ctlcluster <u>version</u>
           <u>cluster</u> start on it). By default, the cluster is not started.

       <b>--start-conf=auto</b>|<b>manual</b>|<b>disabled</b>
           Set the initial value in the start.conf configuration file. See <b>STARTUP</b> <b>CONTROL</b>  below.  By  default,
           <b>auto</b>  is  used,  which  means that the cluster is handled by /etc/init.d/postgresql, i. e. starts and
           stops automatically on system boot.

       <b>-o</b> <u>guc</u><b>=</b><u>value</u>, <b>--pgoption</b> <u>guc</u><b>=</b><u>value</u>
           Configuration option to set in the new postgresql.conf file.

       <b>--createclusterconf=</b><u>file</u>
           Alternative <b>createcluster.conf</b> file to use. Default is /etc/postgresql-common/createcluster.conf  (or
           $PGSYSCONFDIR/createcluster.conf).

       <b>--environment=</b><u>file</u>
           Alternative  default  <b>environment</b>  file  to  use.  Default  is /etc/postgresql-common/environment (or
           $PGSYSCONFDIR/environment).  If the file is missing, a placeholder string is used.   %v  and  %c  are
           replaced; see DEFAULT VALUES below.

       <b>--</b> <u>initdb</u> <u>options</u>
           Options passed directly to <b><a href="../man1/initdb.1.html">initdb</a></b>(1).

           Per  default,  <b>pg_createcluster</b>  will  update  the  pg_hba.conf  file generated by initdb to use peer
           authentication on  local  (unix)  connections,  and  md5  on  TCP  (host)  connections.  If  explicit
           authentication  config is included here (<b>-A</b>, <b>--auth</b>, <b>--auth-host</b>, <b>--auth-local</b>), the pg_hba.conf file
           will be left untouched.

           <u>Note:</u> If only one of <b>--auth-host</b> and <b>--auth-local</b> is provided, the  other  setting  will  default  to
           <b>trust</b> as per <b>initdb</b>'s defaults, opening a potential security risk.

</pre><h4><b>STARTUP</b> <b>CONTROL</b></h4><pre>
       The  start.conf  file  in  the  cluster  configuration directory controls the start/stop behavior of that
       cluster's postgres process. The file can contain comment lines (started with '#'), empty lines, and  must
       have exactly one line with one of the following keywords:

       <b>auto</b>
           The postgres process is started/stopped automatically in the init script.

           When running from <b>systemd</b>, the cluster is started/stopped when <b>postgresql.service</b> is started/stopped.
           This is also the default if the file is missing.

       <b>manual</b>
           The  postgres  process  is  not handled by the init script, but manually controlling the cluster with
           <b><a href="../man1/pg_ctlcluster.1.html">pg_ctlcluster</a></b>(1) is permitted.

           When running from <b>systemd</b>, the cluster  is  not  started  automatically  when  <b>postgresql.service</b>  is
           started.  However,  stopping/restarting <b>postgresql.service</b> will stop/restart the cluster. The cluster
           can be started using <b>systemctl</b> <b>start</b> <b>postgresql@</b><u>version</u><b>-</b><u>cluster</u>.

       <b>disabled</b>
           Neither the init script, <b><a href="../man1/pg_ctlcluster.1.html">pg_ctlcluster</a></b>(1), nor <b>postgresql@.service</b> are permitted  to  start/stop  the
           cluster.  Please be aware that this will not stop the cluster owner from calling lower level tools to
           control the postgres process; this option is only meant to prevent accidents during maintenance,  not
           more.

       When running from <b>systemd</b>, invoke <b>systemctl</b> <b>daemon-reload</b> after editing start.conf.

       The  pg_ctl.conf  file  in  the  cluster configuration directory can contain additional options passed to
       <b>pg_ctl</b> of that cluster.

</pre><h4><b>DEFAULT</b> <b>VALUES</b></h4><pre>
       Some     default     values     used      by      <b>pg_createcluster</b>      can      be      modified      in
       /etc/postgresql-common/createcluster.conf.  Occurrences  of  <b>%v</b> are replaced by the major version number,
       and <b>%c</b> by the cluster name. Use <b>%%</b> for a literal <b>%</b>.

       <b>create_main_cluster</b> (Default: <b>true</b>)
           Create a <b>main</b> cluster when a new postgresql-NN server package is installed and no clusters exist yet.

       <b>start_conf</b> (Default: <b>auto</b>)
           Default start.conf value to use.

       <b>data_directory</b> (Default: <b>/var/lib/postgresql/%v/%c</b>)
           Default data directory.

       <b>waldir|xlogdir</b> (Default: unset)
           Default directory for transaction  logs.  When  used,  <b>initdb</b>  will  create  a  symlink  from  pg_wal
           (PostgreSQL  9.6 and earlier: pg_xlog) in the data directory to this location. Unset by default, i.e.
           transaction logs remain in the data directory. Both  spellings  of  this  option  are  accepted,  and
           translated to the correct initdb invocation depending on the cluster version.

       <b>initdb_options</b> (Default: unset)
           Other options to pass to <b>initdb</b>.

       Other options
           All other options listed are copied into the new cluster's postgresql.conf, e.g.:

               listen_addresses = '*'
               log_line_prefix = '%%t '

           Some postgresql.conf options are treated specially:

           <b>ssl</b> Only added to postgresql.conf if the default snakeoil certificates exist and are readable for the
               cluster owner as detailed above.

           <b>stats_temp_directory</b>
               Only  added  to  postgresql.conf  if existing, and writable for the cluster owner, or else if the
               parent directory is writable. Not used on PostgreSQL 15 or later.

       Include files
           <b>include</b>
           <b>include_if_exists</b>
           <b>include_dir</b>
               <b>createcluster.conf</b> supports the same include directives as <b>postgresql.conf</b>.

           <b>add_include</b>
           <b>add_include_if_exists</b>
           <b>add_include_dir</b>
               To add include directives to the new postgresql.conf file, use the  <b>add_*</b>  directives.  The  <b>add_</b>
               prefix is removed.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/initdb.1.html">initdb</a></b>(1), <b><a href="../man8/pg_ctlcluster.8.html">pg_ctlcluster</a></b>(8), <b><a href="../man1/pg_lsclusters.1.html">pg_lsclusters</a></b>(1), <b><a href="../man1/pg_wrapper.1.html">pg_wrapper</a></b>(1)

</pre><h4><b>AUTHORS</b></h4><pre>
       Martin Pitt &lt;<a href="mailto:mpitt@debian.org">mpitt@debian.org</a>&gt;, Christoph Berg &lt;<a href="mailto:myon@debian.org">myon@debian.org</a>&gt;

Debian                                             2025-02-20                                <u><a href="../man1/PG_CREATECLUSTER.1.html">PG_CREATECLUSTER</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>