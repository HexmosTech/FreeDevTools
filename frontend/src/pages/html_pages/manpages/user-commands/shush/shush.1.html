<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shush - Run a command and optionally report its output by mail</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/shush">shush_1.2.3-5.1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       shush - Run a command and optionally report its output by mail

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>shush</b> [ <b>-h</b> | <b>-V</b> ]

       <b>shush</b> [ <b>-c</b> <u>dir</u> ] [ <b>-S</b> | <b>-s</b> <u>facility</u> ] [ <b>-vfmk</b> ] <u>name</u> [ <u>ID</u> ]

       <b>shush</b> [ <b>-c</b> <u>dir</u> ] [ <b>-H</b> <u>to</u> ] [ <b>-R</b> <u>to</u> ] [ <b>-T</b> <u>to</u> ] -C <u>name</u> [ <u>stdout</u> [ <u>stderr</u> ] ]

       <b>shush</b> [ <b>-i</b> | <b>-u</b> | <b>-r</b> ] [ <b>-c</b> <u>dir</u> ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>shush</b> runs a command and optionally reports its output by mail.  It is a useful wrapper around cron jobs.
       By  default,  <b>shush</b>  will  not produce any output when running as everything (if anything) is reported by
       mail.  However, configuration as well as critical errors will be  reported  on  the  standard  error  and
       (optionally)  syslog.   Because interrupting <b>shush</b> has dire consequences including the likely loss of any
       output from the command, the following commonly used  signals  are  ignored  by  <b>shush</b>:  SIGHUP,  SIGINT,
       SIGQUIT  and  SIGTERM.   If  one really wants to kill a running instance of <b>shush</b> rather than killing the
       running managed command, SIGKILL may be used and shall serve as a  reminder  of  how  inappropriate  such
       action typically is.

       For  a command to be run using <b>shush</b>, a configuration file <u>name</u> must exist in the configuration directory
       (<u>$HOME/.shush</u> by default). This file defines how the command should be run as well when to  send  reports
       by mail.  For details on available configuration parameters, see the <u>CONFIGURATION</u> section below.

       Two  additional configuration files may exist: <u>name.stdout</u> and <u>name.stderr</u> (by default).  These files are
       used to look at the standard output and standard error  (respectively)  produced  by  the  command.   For
       details on how to use these, see the <u>COMMAND</u> <u>OUTPUT</u> section below.

       When  the <u>-C</u> option is specified, <b>shush</b> will only load the configuration, optionally analyze the standard
       output and standard error from the specified files and finally produce sample reports if  desired.   This
       may  also  be used to produce reports if <b>shush</b> failed to properly terminate when running a command.  (The
       standard output and error from the command are normally found in files located under /tmp.)

       <b>shush</b> is able to manage <u><a href="../man5/crontab.5.html">crontab</a>(5)</u> entries based on configurations defined by the user.  This may be done
       in one of two ways.  If a file named "<u>schedule</u>" exists in the configuration directory, then  it  is  read
       for scheduling information.  Each line should contain a single entry containing three fields separated by
       whitespace(s).   The  fields are (in order) the hostname for which the entry applies or the character "*"
       to include all hosts, the configuration <u>name</u>,  and finally, the scheduling information in the same format
       as is used by the <u>schedule</u> parameter (see below).  To specify an <u>ID</u>, use <u>name</u>:<u>ID</u> as the second field.  If
       there is no file named "<u>schedule</u>", then <b>shush</b> checks the configuration directory for configuration  files
       and  adds them to the current user's <u><a href="../man5/crontab.5.html">crontab</a>(5)</u> file as specified by the included <u>schedule</u> parameter (see
       below).  Files whose names start with the character "#" or end with the character "~" are ignored.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-h</b>     Display a brief help message.

       <b>-V</b>     Display the version information.  Prefix with <b>-v</b> to display compile time defaults.

       <b>-c</b> <u>dir</u> Specify the directory where configurations are stored.

       <b>-s</b> <u>facility</u>
              Defines the syslog facility to use for logging.

       <b>-S</b>     Disable syslog logging.

       <b>-v</b>     Copy information log messages to the standard output.

       <b>-f</b>     Fast mode:  Any configured <u>randomdelay</u> is ignored.

       <b>-m</b>     Monitor and display the command's standard output and error in real time.

       <b>-k</b>     Keep the command's output log files instead of deleting them upon completion.

       <b>-C</b>     Check the configuration without running any command.

       <b>-H</b> <u>to</u>  Send a sample HTML report to the specified recipient(s).

       <b>-R</b> <u>to</u>  Send a sample enriched report to the specified recipient(s).

       <b>-T</b> <u>to</u>  Send a sample text report to the specified recipient(s).

       <b>-i</b>     Use <u><a href="../man1/crontab.1.html">crontab</a>(1)</u> to install a new <u><a href="../man5/crontab.5.html">crontab</a>(5)</u> file for the current user.  The user must  not  already
              have a <u><a href="../man5/crontab.5.html">crontab</a>(5)</u> file.

       <b>-u</b>     Use <u><a href="../man1/crontab.1.html">crontab</a>(1)</u> to update the current user's <u><a href="../man5/crontab.5.html">crontab</a>(5)</u> file, which must already exist.

       <b>-r</b>     Remove any entry added by the <b>-u</b> option from the current user's <u><a href="../man5/crontab.5.html">crontab</a>(5)</u>.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       <b>shush</b>  configuration files consist of a main section, report section(s) and parameters.  The main section
       defines global parameters as well as defaults for reports.  Each report section begins with the  name  of
       the  report  between brackets.  Lines beginning with the character "#" are ignored.  Parameters should be
       specified only once.  If specified multiple times, all but the last occurrence will  be  ignored,  unless
       noted otherwise.  Parameters are defined using the following syntax:

              <u>name</u>=<u>value</u>

       or:

              <u>name</u>@<u>hostname</u>=<u>value</u>

       or:

              <u>name</u>%<u>ID</u>=<u>value</u>

       or finally:

              <u>name</u>@<u>hostname</u>%<u>ID</u>=<u>value</u>

       The  second  and  fourth  formats will be ignored unless <b>shush</b> is running on the specified hostname.  The
       third and fourth formats allow  defining  multiple  instances  of  a  single  configuration  file.   Such
       configuration files require an instance <u>ID</u> to be specified in order to run.  Any configuration line using
       the  third  or fourth formats will be ignored if the <u>ID</u> found on that line does not match the instance <u>ID</u>
       used to run <b>shush</b>.

       The following parameters may appear in the main section:

       <b>command</b>
              The actual command to run.  <b>shush</b> sets two  environment  variables  before  running  the  command:
              <u>SHUSH_NAME</u> is set to <u>name</u>, and <u>SHUSH_ID</u> is set to <u>ID</u>.

       <b>config</b> This  defaults  to the full path of the main configuration file.  The other two configuration file
              names are obtained by appending the  ".stdout"  and  ".stderr"  suffixes  to  the  value  of  this
              parameter.

       <b>lock</b>   If  set,  this  parameter  instructs  <b>shush</b>  to obtain a lock file before running the <u>command</u>, and
              defines the actions to take in case the <u>lockfile</u> is held by another  process.   The  format  is  a
              comma  separated  list  of actions.  Valid actions are: a time duration (during which <b>shush</b> should
              simply wait and keep trying to obtain the <u>lockfile</u>), the string  "abort"  (indicating  that  <b>shush</b>
              should terminate immediately if the <u>lockfile</u> already exists), the string "ignore" (indicating that
              <b>shush</b>  should  ignore  an existing <u>lockfile</u>), the string "loop" (to mark where to start again from
              when all actions have been executed) and the string "notify=" followed by mail addresses to  which
              a  notification  mail  should  be  sent.  Actions are executed in the order they are provided, and
              <b>shush</b> will wait forever trying to obtain the <u>lockfile</u> once all the  actions  have  been  executed,
              unless  the  string "loop" is one of defined actions.  Time durations may be specified in units of
              w(eeks), d(ays), h(ours), m(inutes) or s(econds).  If no unit is specified, it is  assumed  to  be
              minutes.

       <b>lockfile</b>
              By  default,  <b>shush</b>  will  use a file located in the same directory as the configuration file, and
              named after the configuration and host names.  An alternate filename may be specified  using  this
              parameter.

       <b>lockmsg</b>
              If  set,  this string will be used as subject for lock notification(s) mail messages.  The default
              is "[%u@%h] **PENDING** %N [%t]".  See the <u>MAIL</u> <u>SUBJECT</u> section for details on the format.

       <b>path</b>   <b>shush</b> does not modify the environment, except to set the <b>PATH</b> variable if the  <u>path</u>  parameter  is
              set.

       <b>randomdelay</b>
              If  this  parameter is set, <b>shush</b> will wait up to the specified amount of time before starting the
              command unless invoked with the <b>-f</b>.  Valid time units are: s(econds), m(inutes), h(ours),  d(ays),
              w(eeks).  If no unit is specified, it is assumed to be minutes.

       <b>schedule</b>
              This  defines when to run this command as a cron job, in a <u><a href="../man5/crontab.5.html">crontab</a></u>(5) compatible format.  Multiple
              entries may be specified using the character ";" as separator.  Entries prefixed by the  character
              "#" will be skipped.  This parameter is not directly used by <b>shush</b> to run the command, but used by
              the <b>-i</b> and <b>-u</b> options.

       <b>sendmail</b>
              This may be used to override the command used to send mail.

       <b>shell</b>  By  default,  the  Bourne  shell <u><a href="../man1/sh.1.html">sh</a>(1)</u> is used to run the <u>command</u>, allowing any shell syntax to be
              used.  An alternate shell may be defined using this parameter.

       <b>statedir</b>
              This defines the directory where the status of  <b>shush</b>  is  saved  and  defaults  to  the  ".state"
              directory  under  where the configuration is located.  An error is generated if the directory does
              not exist unless this option was not set.  Setting this option to an  empty  string  will  prevent
              <b>shush</b>  from saving its status.  <u><a href="../man1/shlast.1.html">shlast</a>(1)</u> uses these state files to report on running instances of
              <b>shush</b> as well as previous runs.

       <b>syslog</b> This parameter is <b>only</b> used by the <b>-i</b> and <b>-u</b> options and has no other effect on <b>shush</b>.  It  allows
              overriding  the  default  syslog  facility  used for logging and defined at compile time.  If left
              blank, this suppresses the use of syslog.

       <b>timeout</b>
              This parameter allows one to control how long the <u>command</u> may run.  It should be a comma separated
              list of actions.  Valid actions are: a time duration (during which <b>shush</b> should  simply  wait  for
              the  <u>command</u> to terminate), a signal (either "SIGNAME" or "-SIGNUMBER") that should be sent to the
              <u>command</u>'s process group, a signal (either "=SIGNAME" or "=SIGNUMBER") that should be sent  to  the
              <u>shell</u>  used  to  spawn  the <u>command</u>, the string "loop" (to mark where to start again from when all
              actions have been executed) and the string  "notify="  followed  by  mail  addresses  to  which  a
              notification  mail should be sent.  Actions are executed in the order they are provided, and <b>shush</b>
              will wait forever if the <u>command</u> is still running once all the actions have been  executed  unless
              the string "loop" is one of defined actions.  Time durations may be specified in units of w(eeks),
              d(ays), h(ours), m(inutes) or s(econds).  If no unit is specified, it is assumed to be minutes.

       <b>timeoutmsg</b>
              If  set,  this  string  will  be  used  as subject for timeout notification(s) mail messages.  The
              default is "[%u@%h] **TIMEOUT** %N [%t]".  See the <u>MAIL</u> <u>SUBJECT</u> section for details on the format.

       The following parameters may appear anywhere in the configuration.  If specified  in  the  main  section,
       they  define  defaults  settings  that will apply to any report for which the same parameter has not been
       defined.

       <b>to</b>, <b>cc</b>, <b>bcc</b>
              Where to send the mail report.

       <b>subject</b>
              Subject of the mail report.  See the <u>MAIL</u> <u>SUBJECT</u> section for details on the format.

       <b>header</b> Additional mail header(s).  Note that this parameter may be repeated to specify multiple  headers.
              However,  only  headers from the report (if specified) or from the main section will be used for a
              given report.

       <b>hostprefix</b>
              By default, specified subjects are prefixed with the host name between brackets.   This  parameter
              allows  one  to  customize  this  prefix.  A positive integer indicates how many components of the
              fully qualified hostname should  be  shown.   A  negative  integer  indicates  how  many  trailing
              components of the fully qualified hostname should be trimmed.  The integer zero indicates that the
              prefix should be omitted.  This parameter is ignored if the "<b>subject</b>" contains any "%" character.

       <b>userprefix</b>
              By  default,  specified  subjects are prefixed with the username between brackets.  This parameter
              allows one to disable this prefix.  Any non zero value indicates that the username should be shown
              while zero causes the prefix to be omitted.  This parameter is ignored if the  "<b>subject</b>"  contains
              any "%" character.

       <b>output</b> (previously "<b>stderr")</b>

              <b>This</b> <b>defines</b> <b>how</b> <b>the</b> <b>command's</b> <b>standard</b> <b>output</b> <b>and</b> <b>standard</b> <b>error</b> <b>are</b> <b>captured</b> <b>and</b> <b>reported</b> <b>to</b> <b>the</b>
              <b>user:</b>  <b>"errfirst",</b> <b>"mixed",</b> <b>"outfirst".</b>  <b>When</b> <b>using</b> <b>"mixed",</b> <b>the</b> <u>name.stderr</u> <b>configuration</b> <b>file</b> <b>is</b>
              <b>ignored.</b>  <b>When</b> <b>using</b> <b>"errfirst"</b> <b>or</b> <b>"outfirst",</b> <b>individual</b> <b>reports</b> <b>may</b> <b>use</b> <b>one</b> <b>of</b> <b>the</b> <b>following</b> <b>two</b>
              <b>additional</b> <b>options</b> <b>"outonly"</b> <b>and</b> <b>"erronly".</b>

       <b>format</b> Mail  messages  sending  the  output of the <u>command</u> may be sent in three different formats: "text"
              (the default), "enriched" text or "html".

       <b>sizelimit</b>
              By default, the entire output of the <u>command</u> is sent in mail reports.  This parameter may be  used
              to  limit the size of the output included in a report.  Note that the total size of mail sent will
              be greater as this limit has no effect upon mail headers.  The size can be specified in  units  of
              m,  k,  b,  c  (MB, KB, Bytes).  If no unit is specified, it is assumed to be KB.  A limit of zero
              indicates that the output should not be truncated.

       <b>if</b>     A report is only sent if no <u>if</u> condition is specified or if the specified <u>if</u>  condition  is  true.
              The  condition  syntax  allows  for  the  usual  logical  operators  ("||", "&amp;&amp;", "!"), comparison
              operators ("==", "!=", "&lt;", "&lt;=", "&gt;", "&gt;=") and basic arithmetic  operators  ("+",  "-").   Aside
              from  counters  defined by the configuration (see the <u>COMMAND</u> <u>OUTPUT</u> section below), the following
              variables may be used:

              <b>$exit</b>  If the command terminated normally, this is its exit code.  Otherwise, it is  negative  and
                     indicates  the  signal  number  having  caused  the command to terminate (e.g. -1 indicates
                     signal number 1 caused the command to terminate).

              <b>$size</b>  output size (in bytes), same as "$outsize + $errsize"

              <b>$outsize</b>
                     size (in bytes) of standard output

              <b>$errsize</b>
                     size (in bytes) of standard error

              <b>$lines</b> number of lines output

              <b>$outlines</b>
                     number of standard output lines

              <b>$errlines</b>
                     number of standard error lines

              <b>$runtime</b>
                     <u>command</u> run time (in seconds)

              <b>$utime</b> user time used by the <u>command</u>

              <b>$stime</b> system time used by the <u>command</u>

              <b>$tty</b>   1 if <b>shush</b> is run from a terminal (e.g. interactively), 0 otherwise.

</pre><h4><b>MAIL</b> <b>SUBJECTS</b></h4><pre>
       The "<b>lockmsg</b>", "<b>timeoutmsg</b>" and "<b>subject</b>" parameters may contain the following tokens which are  expanded
       as described below:

              <b>%%</b>     The "%" character

              <b>%h</b>     The hostname

              <b>%&lt;digit&gt;</b>
                     or "<b>%-&lt;digit&gt;"</b>

                     <b>A</b>  <b>partial</b>  <b>hostname:</b> <b>A</b> <b>positive</b> <b>digit</b> <b>indicates</b> <b>how</b> <b>many</b> <b>components</b> <b>of</b> <b>the</b> <b>fully</b> <b>qualified</b>
                     <b>hostname</b> <b>to</b> <b>keep;</b> <b>a</b> <b>negative</b> <b>digit</b> <b>indicates</b> <b>how</b> <b>many</b>  <b>trailing</b>  <b>components</b>  <b>of</b>  <b>the</b>  <b>fully</b>
                     <b>qualified</b> <b>hostname</b> <b>to</b> <b>trim.</b>

              <b>%i</b>     The instance <u>ID</u>

              <b>%n</b>     The configuration <u>name</u>

              <b>%N</b>     The configuration <u>name</u> and instance <u>ID</u>

              <b>%r</b>     The report name

              <b>%t</b>     The elapsed time.

              <b>%u</b>     The username.

              <b>%U</b>     The userid.

                     If  the  "%"  character  is  found  in  the  "<b>subject</b>" parameter, then the "<b>hostprefix</b>" and
                     "<b>userprefix</b>" parameters are ignored.

</pre><h4><b>COMMAND</b> <b>OUTPUT</b></h4><pre>
       After the <u>command</u> terminates, <b>shush</b> will use the contents of the <u>name.stdout</u> and  <u>name.stderr</u>  files  (if
       they exist) to look at the output produced by the <u>command</u>.

       These  files  follow  a  simple  format.   Each line is composed of a single character (the counter name)
       followed by a regular expression.

       All counters are initialized to 0  (zero).   Each  line  of  output  is  matched  against  these  regular
       expressions  until  a match is found.  If a match is found, the associated counter is incremented by one.
       These counters may then be used as part of the main configuration, in an  "<b>if</b>"  configuration  parameter,
       allowing  the  decision  to  send a mail report to be based on how many times certain regular expressions
       have been matched.

       Finally, regular expressions may define sub-expressions which will be rendered in bold in mail reports.

       Lines starting with the character "#" are considered  to  be  comments  and  are  ignored.   By  default,
       standard  regular  expressions  are  used, unless the first line is "#pcre" in which case Perl compatible
       regular expressions are used.

</pre><h4><b>ENVIRONMENT</b> <b>VARIABLES</b></h4><pre>
       HOME   If the <b>-c</b> option is not used, <b>shush</b> will look for configuration files in <u>$HOME/.shush</u>.

       SHUSH_SENDMAIL
              If defined, this should point to the <u><a href="../man1/sendmail.1.html">sendmail</a></u>(1) binary.  This variable overrides  the  "<b>sendmail</b>"
              configuration setting and should be used with care.

       TMPDIR Directory where temporary files are created.

</pre><h4><b>EXAMPLE</b></h4><pre>
       The  following  configuration  runs  "shush  -c  /etc/shush  -u"  daily at 9:00, updating the user (root)
       crontab:

              command=shush -c /etc/shush -u
              schedule=0 9 * * *
              lock=notify=root root-logs,abort
              timeout=5m,loop,notify=root root-logs,15m
              stderr=first
              format=text
              Subject=Crontab Daily Update
              [logs]
              to=root-logs
              [readers]
              if=$exit != 0 || $outlines != 1 || $errsize &gt; 0 || U
              to=root
              format=rich

       The associated configuration for standard output is:
              Oshush: crontab updated\.$
              U^.+$

       and for standard error:
              U^(.+)$

       A lock will be set while running the command, and mail sent to "root" and "root-logs" if the lock is held
       by another process when <b>shush</b> starts, in which case <b>shush</b> will abort.  A mail will also be sent to "root"
       and "root-logs" if "shush -c /etc/shush -u" runs for more than  5  minutes,  and  for  every  15  minutes
       following the first 5 minutes.

       Upon completion, the output will always be sent to "root-logs".  Additionally, the output will be sent to
       "root"  if the condition "$exit != 0 || $outlines != 1 || $errsize &gt; 0 || U" is true.  For this condition
       to be true, one of the following must be true: the exit code is non zero, the command standard output was
       not a single line, there was output on standard error or finally, the counter "U" is non zero.   For  the
       counter  "U"  to be non zero, there must be output on standard output other than the line "shush: crontab
       updated.".  Finally, any line of output produced on the standard error will be displayed in bold in mails
       sent to "root".

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/crontab.1.html">crontab</a></u>(1), <u><a href="../man3/pcre.3.html">pcre</a></u>(3), <u><a href="../man3/regex.3.html">regex</a></u>(3), <u><a href="../man1/sendmail.1.html">sendmail</a></u>(1), <u><a href="../man1/sh.1.html">sh</a></u>(1).

</pre><h4><b>AVAILABILITY</b></h4><pre>
       The  latest  official   release   of   <b>shush</b>   is   available   on   the   web.    The   home   page   is
       <a href="http://web.taranis.org/shush/">http://web.taranis.org/shush/</a>

</pre><h4><b>AUTHOR</b></h4><pre>
       Christophe Kalt &lt;<a href="mailto:kalt@taranis.org">kalt@taranis.org</a>&gt;

</pre><h4><b>BUGS</b></h4><pre>
       The <b>-C</b> option does not allow specifying an <u>ID</u>.

       For other bugs, send reports to `<a href="mailto:shush-bugs@taranis.org">shush-bugs@taranis.org</a>'.

                                          $Date: 2007-09-30 23:38:23 $                                  <u><a href="../man1/SHUSH.1.html">SHUSH</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>