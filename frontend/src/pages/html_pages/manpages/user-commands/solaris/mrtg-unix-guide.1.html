<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mrtg-unix-guide - The MRTG 2.17.10 Linux/Unix Installation Guide</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/mrtg">mrtg_2.17.10-12_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mrtg-unix-guide - The MRTG 2.17.10 Linux/Unix Installation Guide

</pre><h4><b>DESCRIPTION</b></h4><pre>
       MRTG comes to you in Source Code. This means that you have to compile parts of it before you can use it
       on a Unix machine. These instructions help you to do so.

</pre><h4><b>PREPARATION</b></h4><pre>
       In order to compile and use mrtg you need a C compiler and a copy of perl installed on your machine. In
       most cases this will already be available.  In case it is not, here are some starting points. Below I'll
       give you a detailed run through the whole compilation process.

       GCC The  GNU  C  compiler  comes  preinstalled  on  most  of  the  free Unices out there.  For commercial
           derivatives you may have to download and compile it first. If you have no compiler at all there is  a
           chicken  and egg problem, but there are also precompiled versions of gcc available for most operating
           systems.

            <a href="http://gcc.gnu.org/">http://gcc.gnu.org/</a>

       Perl
           Large parts of the MRTG system are written in the Perl scripting language.   Make  sure  there  is  a
           recent  copy  of  perl  on your machine (try perl -v). At least version 5.005 is required for mrtg to
           work well. If you use SNMPV3 and other new features you should use at least 5.8.

           You can get the latest perl from

            <a href="http://www.perl.com/">http://www.perl.com/</a>

       MRTG generates traffic graphs in the PNG format. To be able  to  do  this  it  needs  several  3rd  party
       libraries.  When  compiling these libraries I urge you to make sure you compile them as <b>static</b> libraries.
       There is just much less trouble ahead if you are doing it like this. See the  Instructions  in  the  next
       section  for  inspiration. Note that many free unices have all the required libraries already in place so
       there is no need to install another copy. To check it is best to skip all the library instructions  below
       and go straight into the mrtg compile.

       If  the first attempt fails and you do not get a working version of mrtg, try compiling new copies of all
       libraries as explained below. Do this <b>BEFORE</b> you send email to me about problems compiling mrtg.

       gd  This is a basic graph drawing library created by  Thomas  Boutell.   Note  that  all  releases  after
           Version 1.3 only create PNG images. This is because a) Thomas got into trouble because the GIF format
           which  it  used to produce uses a compression technology patented by Unisys. b) PNG is more efficient
           and patent free. MRTG can work with old and new version of the GD library. You can get a recent  copy
           of GD from:

            <a href="http://www.boutell.com/gd/">http://www.boutell.com/gd/</a>

       libpng
           Is required by gd in order to produce PNG graphics files. Get it from:

            <a href="http://www.libpng.org/pub/png/libpng.html">http://www.libpng.org/pub/png/libpng.html</a>

       zlib
           Is needed by libpng to compress the graphics files you create.  Get a copy from

            <a href="http://www.gzip.org/zlib">http://www.gzip.org/zlib</a>

       And  last but not least you also need mrtg itself. In case you have not yet downloaded it, you can find a
       copy on my website:

        <a href="http://oss.oetiker.ch/mrtg/pub">http://oss.oetiker.ch/mrtg/pub</a>

</pre><h4><b>LIBRARY</b> <b>COMPILATION</b></h4><pre>
       In this section I will give you step by step  instructions  on  how  to  compile  the  various  libraries
       required  for  the  compilation of mrtg. Note that these libraries may already be installed if you have a
       <u>*BSD</u> or <u>Linux</u> system so you can skip recompiling them. The <b>wget</b>  program  used  below  is  a  simple  web
       downloader. You can also enter the address into your <b>netscape</b> if you don't have <b>wget</b> available.

       First  let's  create a directory for the compilation. Note that this may already exist on your system. No
       problem, just use it.

        mkdir -p <a href="file:/usr/local/src">/usr/local/src</a>
        cd <a href="file:/usr/local/src">/usr/local/src</a>

       If you do not have zlib installed:

        wget <a href="http://www.zlib.net/zlib-1.2.3.tar.gz">http://www.zlib.net/zlib-1.2.3.tar.gz</a>
        gunzip -c zlib-*.tar.gz | tar xf -
        rm zlib-*.tar.gz
        mv zlib-* zlib
        cd zlib
        ./configure
        make
        cd ..

       If you don't have libpng installed

        wget <a href="ftp://ftp.simplesystems.org/pub/libpng/png/src/libpng-1.2.40.tar.gz">ftp://ftp.simplesystems.org/pub/libpng/png/src/libpng-1.2.40.tar.gz</a>
        gunzip -c libpng-1.2.34.tar.gz | tar xf -
        mv libpng-* libpng
        cd libpng
        env CFLAGS="-O3 -fPIC" ./configure --prefix=$INSTALL_DIR
        make
        rm *.so.* *.so
        cd ..

       And now you can compile gd

       For versions up to 1.8.4, try:

        wget <a href="http://www.boutell.com/gd/http/gd-1.8.4.tar.gz">http://www.boutell.com/gd/http/gd-1.8.4.tar.gz</a>
        gunzip -c gd-*.tar.gz |tar xf -
        rm gd-*.tar.gz
        mv gd-* gd
        cd gd

       The \ characters at the end of the following lines mean that all the following material  should  actually
       be written on a single line.

        perl -i~ -p -e s/gd_jpeg.o//g Makefile
        make INCLUDEDIRS="-I. -I../zlib -I../libpng" \
             LIBDIRS="-L../zlib -L. -L../libpng" \
             LIBS="-lgd -lpng -lz -lm" \
             CFLAGS="-O -DHAVE_LIBPNG"
        cd ..

       For versions starting around 2.0.11, try:

        wget <a href="http://www.boutell.com/gd/http/gd-2.0.33.tar.gz">http://www.boutell.com/gd/http/gd-2.0.33.tar.gz</a>
        gunzip -c gd-2.0.33.tar.gz |tar xf -
        mv gd-2.0.33 gd
        cd gd
        env CPPFLAGS="-I../zlib -I../libpng" LDFLAGS="-L../zlib -L../libpng" \
            ./configure --disable-shared --without-freetype --without-jpeg
        make
        cp .libs/* .

</pre><h4><b>MRTG</b> <b>COMPILATION</b></h4><pre>
       Ok, now everything is ready for the mrtg compilation.

        cd <a href="file:/usr/local/src">/usr/local/src</a>
        gunzip -c mrtg-2.17.10.tar.gz | tar xvf -
        cd mrtg-2.17.10

       If all the libraries have been preinstalled on your system you can configure mrtg by doing a simple:

        ./configure --prefix=/usr/local/mrtg-2

       Otherwise  you  may  have  to  give some hints on where to find the various libraries required to compile
       mrtg:

        ./configure --prefix=/usr/local/mrtg-2       \
                    --with-gd=/usr/local/src/gd      \
                    --with-z=/usr/local/src/zlib     \
                    --with-png=/usr/local/src/libpng

       If you have RRDtool available you might want to tell mrtg about it so that you can  opt  to  use  rrdtool
       with mrtg. Check mrtg-rrd.

       Configure  will make sure your environment is fit for building mrtg.  If it finds a problem, it will tell
       you so and it will also tell you what to do about it. If everything is OK, you will end up with a  custom
       Makefile for your system. Now type:

        make

       This  builds  the rateup binary and edits all the perl pathnames in the scripts. You can now install mrtg
       by typing

        make install   (requires gnu install)

       All the software required by MRTG is now installed under the <u>/usr/local/mrtg-2</u> subdirectory.

       You can now safely delete the libraries we compiled above. Then again, you might want to keep them around
       so that you have them available when compiling the next version of mrtg.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       The next step is to configure mrtg for monitoring a network device.  This is done by creating an <u>mrtg.cfg</u>
       file which defines what you want to monitor. Luckily, you don't  have  to  dive  straight  in  and  start
       writing  your own configuration file all by yourself. Together with mrtg you also got a copy of <b>cfgmaker</b>.
       This is a script you can point at a router of your choice; it will create a mrtg configuration  file  for
       you. You can find the script in the <u>bin</u> subdirectory.

        cfgmaker --global 'WorkDir: /home/httpd/mrtg'  \
                 --global 'Options[_]: bits,growright' \
                 --output /home/mrtg/cfg/mrtg.cfg    \
                  <a href="mailto:community@router.abc.xyz">community@router.abc.xyz</a>

       This example above will create an mrtg config file in <u>/home/mrtg/cfg</u> assuming this is a directory visible
       on your webserver. You can read all about cfgmaker in cfgmaker. One area you might want to look at is the
       possibility of using <b>--ifref=ip</b> to prevent interface renumbering troubles from catching you.

       If  you  want  to  start  rolling your own mrtg configuration files, make sure you read mrtg-reference to
       learn all about the possible configuration options.

</pre><h4><b>RUNNING</b> <b>MRTG</b></h4><pre>
       Once you have created a configuration file, try the following:

        /usr/local/mrtg-2/bin/mrtg /home/mrtg/cfg/mrtg.cfg

       This will query your router and also create your first mrtg traffic graphs and  webpages.  When  you  run
       mrtg  for  the first time there will be a lot of complaints about missing log files. Don't worry, this is
       normal for the first 2 times you start mrtg. If it keeps complaining after this time you  might  want  to
       look into the problem.

       Starting  mrtg  by  hand is not ideal in the long run. So when you are satisfied with the results you can
       automate the process of running mrtg in regular intervals (this means every 5 minutes by default).

       You can either add mrtg to your crontab with a line like this:

        0,5,10,15,20,25,30,35,40,45,50,55 * * * * \
              &lt;mrtg-bin&gt;/mrtg &lt;path to mrtg-cfg&gt;/mrtg.cfg \
                       --logging /var/log/mrtg.log

       or if you live in Linux Land the line may look like this if you are using "crontab -e"

        */5 * * * *  &lt;mrtg-bin&gt;/mrtg &lt;path to mrtg-cfg&gt;/mrtg.cfg \
                              --logging /var/log/mrtg.log

       or like this if you use <u><a href="file:/etc/crontab">/etc/crontab</a></u>

        */5 * * * *  mrtg-user  &lt;mrtg-bin&gt;/mrtg &lt;path to mrtg-cfg&gt;/mrtg.cfg \
                                        --logging /var/log/mrtg.log

       You can also run mrtg as a daemon process by adding the line

        RunAsDaemon: Yes

       to your mrtg configuration file and then creating a startup  script  in  your  system  startup  sequence.
       Unfortunately,  adding  startup  scripts  differs  widely amongst different unix systems. The modern ones
       normally have a directory called <u><a href="file:/etc/init.d">/etc/init.d</a></u> or <u>/etc/rc.d/init.d</u> where you put scripts which  starts  the
       process  you  want to run when the system boots. Further you must create a symbolic link in <u><a href="file:/etc/rc3.d">/etc/rc3.d</a></u> or
       <u>/etc/rc.d/rc?.d</u> called <u>S65mrtg</u> (this is just a sample name ... it is just important that it starts with S
       followed by a two digit number). If you are not sure about this, make sure you consult the  documentation
       of your system to make sure you get this right.

       A <b>minimal</b> script to put into <u>init.d</u> might look like this:

        #! <a href="file:/bin/sh">/bin/sh</a>
        cd /usr/local/mrtg-2.17.10/bin &amp;&amp; ./mrtg --user=mrtg-user \
              /home/httpd/mrtg/mrtg.cfg  --logging /var/log/mrtg.log

       Note that this will only work with <b>RunAsDaemon:</b> <b>Yes</b> in your mrtg.cfg file.

</pre><h4><b>AUTHOR</b></h4><pre>
       Tobias Oetiker &lt;<a href="mailto:tobi@oetiker.ch">tobi@oetiker.ch</a>&gt;

2.17.10                                            2022-01-19                                 <u><a href="../man1/MRTG-UNIX-GUIDE.1.html">MRTG-UNIX-GUIDE</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>