<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mbuffer - measuring buffer</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/mbuffer">mbuffer_20241007+ds1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mbuffer - measuring buffer

</pre><h4><b>SYNTAX</b></h4><pre>
       mbuffer [<u>options</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       mbuffer  buffers  I/O operations and displays the throughput rate. It is multi-threaded, supports network
       connections, multiple output targets, and many more options than the standard buffer command.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-b</b> &lt;<u>num</u>&gt;
              Use <u>num</u> blocks for buffer (default is determined on startup).

       <b>-s</b> &lt;<u>size</u>&gt;
              Use blocks of <u>size</u> bytes for buffer (default is determined on startup).

       <b>-m</b> &lt;<u>size</u>&gt;
              Use a total of <u>size</u> bytes for buffer (default 2% of available memory) - size can  be  set  with  a
              trailing  character  (b and B for Byte, k for kByte, M for MByte, G for Gigabyte, and with % for a
              percentage of total physical memory).

       <b>-L</b>     Lock buffer in memory - this option is not available for file-based buffers and  requires  mbuffer
              to be set-UID root (use with care).

       <b>-d</b>     Use block-size of device for output (needed for some devices, slows output down).

       <b>-D</b> &lt;<u>size</u>&gt;
              Assume  an  output  volume  of  <u>size</u>  bytes (default infinite) after which a volume change will be
              initiated. Small values are useful for the timely testing of multi-volume runs; accurate values if
              your device doesn't properly signal end of media. Size can be set with a trailing character (b and
              B for Byte, k for kByte, M for MByte, or G for Gigabyte).

       <b>-P</b> &lt;<u>num</u>&gt;
              Start writing after the buffer has been filled to <u>num</u>% (default 0 - start at once).

       <b>-p</b> &lt;<u>num</u>&gt;
              Start reading after the buffer has dropped below fill-ratio of <u>num</u>% (default 100 - start at once).

       <b>-i</b> &lt;<u>filename</u>&gt;
              Use <u>filename</u> as input instead of the standard input (needs to be given for multi volume  support).
              If <u>filename</u> is -, input is read from standard input.

       <b>-o</b> &lt;<u>filename</u>&gt;
              Use <u>filename</u> as output instead of the standard output (needs to be given for multi volume support,
              will enable use of sendfile if available). If <u>filename</u> is -, output is written to standard output.
              The option -o can be passed multiple times to specify multiple outputs.

       <b>--append</b>
              Open next output file given via option -o in append mode.

       <b>--truncate</b>
              Truncate next output file given via option -o when opening it.

       <b>-I</b> &lt;<u>port</u>&gt;
              Use  network  port  <u>port</u> as input instead of the standard input. If given a hostname and a port in
              the form <u>hostname:port</u>, only the given host is allowed to connect.

       <b>-O</b> &lt;<u>hostname:port</u>&gt;
              Write output to <u>hostname:port</u> instead of the standard output  (will  enable  use  of  sendfile  if
              available). This option can be used multiple times to send data to multiple machines.

       <b>-n</b> &lt;<u>num</u>&gt;
              <u>num</u>  volumes  in input device (requires use of option -i for input device specification, pass 0 as
              argument if mbuffer should prompt for every new volume).

       <b>-t</b>     Use a memory-mapped temporary file as buffer (use with huge buffers).

       <b>-T</b> &lt;<u>file</u>&gt;
              As -t but use <u>file</u> as buffer.

       <b>-l</b> &lt;<u>file</u>&gt;
              Log messages to <u>file</u> instead of standard error output.

       <b>-u</b> &lt;<u>num</u>&gt;
              Pause <u>num</u> microseconds after each write - might increase performance on some drives with very  low
              performance (&lt; 1 MB/sec).

       <b>-r</b> &lt;<u>rate</u>&gt;
              Set  the  maximum  read rate to <u>rate</u>. <u>rate</u> can be given in either Bytes, kBytes, MBytes, or GBytes
              per second. To do so, use an appropriate suffix (i.e. k,M,G). This option is useful if you have  a
              tape that is capable of transferring data faster than the host can handle it. In this case you can
              use  this  option to limit the transfer rate and keep the tape running. Be aware that this is both
              good for your tape drive, and enhances overall performance, by avoiding tape screwing.

       <b>-R</b> &lt;<u>rate</u>&gt;
              Same as above only for setting the transfer limit for the writer.

       <b>-f</b>     Overwrite output file if it exists already.

       <b>-a</b> &lt;<u>time</u>&gt;
              The device used is an autoloader which takes <u>time</u> seconds to load a new tape.

       <b>-A</b> &lt;<u>cmd</u>&gt;
              The device used is an autoloader which uses <u>cmd</u> to load the next volume. Pass &lt;<u><a href="file:/bin/false">/bin/false</a></u>&gt;  as  an
              autoload  command  to  suppress  the  warning  message  that  appears when run without controlling
              terminal (e.g.  via cron). Like this the autoload will fail and mbuffer  will  terminate  with  an
              error message when reaching the end of the tape.

       <b>-v</b> &lt;<u>level</u>&gt;
              Set  verbose  level  to  <u>num</u>.  Valid  values  are  0..6  (0  = none, 1 = errors, 2 = warnings, 4 =
              information messages, 5 = debugging messages, 6 = I/O  debugging).  Higher  values  include  lower
              values messages.

       <b>-q</b>     Quiet - do not display the status on the standard error output.

       <b>-Q</b>     Quiet - do not log the status in the log file.

       <b>-c</b>     Write  with  synchronous data integrity support - This option forces all writes to complete before
              continuing. This enables errors to be reported earlier and  more  precisely,  but  might  decrease
              performance.  Especially  systems  with  high  level  of  data  integrity  support  suffer  a huge
              performance hit. Others might seem to be unaffected, but just neglect support for full synchronous
              data integrity.

       <b>-e</b>     Stop processing on any kind of error.

       <b>-H,</b> <b>--md5</b>
              Generate a MD5 hash of transferred data.

       <b>--hash</b> &lt;<u>alg</u>&gt;
              Use algorithm <u>alg</u>, if <u>alg</u> is 'list' possible algorithms are listed.

       <b>--pid</b>  Print PID of this instance. This option can help you to figure out which instance  of  mbuffer  to
              kill,  if  multiple are running and one is hanging due to a network issue. Printing of the PID can
              also be triggered by adding "printpid = 1" to your .mbuffer.rc file.

       <b>-W</b> &lt;<u>timeout</u>&gt;
              Activates a watchdog that gets triggered every <u>timeout</u> seconds and checks whether I/O activity has
              stalled. If either channel has stalled for a complete period, the watchdog writes an error message
              and terminates mbuffer  via  SIGINT.  Be  aware  that  the  watchdog  is  unaware  of  tape-change
              activities.  So  choose  the  watchdog  timeout  greater that the worst-case tape-change time. The
              watchdog is activated with parsing option -W or after parsing  all  options.  To  avoid  that  the
              watchdog will trigger during network initialization, put the option -W after -I and -O.

       <b>-4</b>     Force IPv4 mode for the following network I/O options on command line.

       <b>-6</b>     Force IPv6 mode for the following network I/O options on command line.

       <b>-0</b>     Choose IPv4/IPv6 mode on demand.

       <b>--no-direct</b>
              Omit use of O_DIRECT - e.g. to enable compression on btrfs.

       <b>--tcpbuffer</b>
              Size  for  TCP buffer in bytes. Size can be set with a trailing character (b and B for Byte, k for
              kByte, M for MByte, or G for Gigabyte).

       <b>--tcptimeo</b> &lt;<u>time</u>&gt;
              Set the TCP timeout  threshold.  The  default  value  is  10s.  Arguments  without  dimension  are
              interpreted as usec. Argument dimensions can be us, ms, s or sec, m or min, h.

       <b>--tapeaware</b>
              Keep  writing to the very end of the tape.  LTO drives tell the OS as they approach the end of the
              tape, which Linux passes on to userspace by returning a 'no space  left'  error  on  every  second
              write  operation.   Normally  the  first of these errors is treated as the end of the tape and the
              next volume will be called for, however with this option, writes will continue until two in a  row
              fail  with  'no  space left', indicating the real end of the tape.  This will allow a little extra
              data to fit on each tape.

       <b>--direct</b>
              Use direct I/O for temporary file buffer.

       <b>-h,</b> <b>--help</b>
              Output help information and exit.

       <b>-V,</b> <b>--version</b>
              Output version information and exit.

</pre><h4><b>DEFAULT</b> <b>VALUES</b></h4><pre>
       The default values for most options can be set as <u>key</u> <u>=</u> <u>value</u> pairs in one or more  configuration  files.
       See  the  sample <u>mbuffer.rc</u> files for available options and their default values. Configuration files are
       read in following sequence listed below:

       - <u>/etc/mbuffer.rc</u>
       - <b>$PREFIX</b><u>/etc/mbuffer.rc</u>
       - <b>$HOME</b><u>/.mbuffer.rc</u>
       - <b>$MBUFFERRC</b>

       The default values given in the files above are overridden by options passed on the command-line.

</pre><h4><b>ENVIRONMENT</b> <b>VARIABLES</b></h4><pre>
       If <b>TMPDIR</b> is set, mbuffer allocates storage for file-based buffers in this directory. If TMPDIR is unset,
       <u><a href="file:/var/tmp">/var/tmp</a></u> will be used.
       <b>MBUFFERRC</b> can be used to set a custom mbuffer.rc config file.
       <b>MBUFFER_VOL</b> volume id info (set for autoloader command).
       <b>MBUFFER_NUMIN</b> number of bytes read (set for autoloader command).
       <b>MBUFFER_NUMOUT</b> number of bytes written (set for autoloader command).

</pre><h4><b>FILES</b></h4><pre>
       <u>$PREFIX/bin/mbuffer</u>
       <u>/var/tmp/mbuffer-*</u>
       <u><a href="file:~/.mbuffer.rc">~/.mbuffer.rc</a></u>

</pre><h4><b>EXAMPLES</b></h4><pre>
       To run this program with the default options just type:

       mbuffer

       Using mbuffer to do a backup with tar to the default tape device. Options for this example: memory-mapped
       temporary file with a size of 10 Megabytes, start after 80% of the buffer have been filled.

       tar cf - mydirectory | gzip | mbuffer -t -m 10M -P 80 -f -o $TAPE

       Using mbuffer with 3 tapes for input and extracting the contents in the current work directory:

       mbuffer -n 3 -i $TAPE | gzip -dc | tar xf -

       Using mbuffer to write to multiple tape volumes:

       tar cf - <a href="file:/usr">/usr</a> | mbuffer -f -o $TAPE

       Write to multiple tapes and erase every tape before writing:

       tar cf - <a href="file:/usr">/usr</a> | mbuffer -A "echo next tape; read a &lt; /dev/tty; mt erase $TAPE" -f -o $TAPE

       Making a backup via network:

       <u>tape</u> <u>server:</u> mbuffer -I 8000 -f -o $TAPE

       <u>backup</u> <u>client:</u> tar zcf - <a href="file:/home">/home</a> | mbuffer -O tapeserver:8000

       Distributing a directory tree to multiple machines:

       <u>master:</u> tar cf - /tree_to_clone | mbuffer -O clone0:8000 -O clone1:8000

       <u>clones:</u> mbuffer -I master:8000 | tar xf -

</pre><h4><b>EXITCODE</b></h4><pre>
       mbuffer returns 0 upon success. Any kind of failure will yield a non-zero exit code.

</pre><h4><b>AUTHORS</b></h4><pre>
       Thomas Maier-Komor &lt;<a href="mailto:thomas@maier-komor.de">thomas@maier-komor.de</a>&gt;

</pre><h4><b>DONATIONS</b></h4><pre>
       If you like this software, and use it for production purposes in your company, please consider  making  a
       donation  to  support  this  work.   You  can  donate  directly via PayPal to the author's e-mail address
       (<a href="mailto:thomas@maier-komor.de">thomas@maier-komor.de</a>).

</pre><h4><b>HOMEPAGE</b></h4><pre>
       <a href="http://www.maier-komor.de/mbuffer.html">http://www.maier-komor.de/mbuffer.html</a>

</pre><h4><b>LICENSE</b></h4><pre>
       This software is published under GNU General Public License V3. See file LICENSE for details.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/buffer.1.html">buffer</a>(1)

Thomas Maier-Komor                                  R20241007                                         <u><a href="../man1/mbuffer.1.html">mbuffer</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>