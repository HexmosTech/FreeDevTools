<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hail - Ganeti IAllocator plugin</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/ganeti-htools-3.1">ganeti-htools-3.1_3.1.0~rc2-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       hail - Ganeti IAllocator plugin

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>hail</b> [ <b>-t</b> <u>file</u> | <b>--simulate</b> <u>spec</u> ] [options...]  <u>input-file</u>

       <b>hail</b> --version

</pre><h4><b>DESCRIPTION</b></h4><pre>
       hail  is  a  Ganeti  IAllocator plugin that implements the instance placement and movement using the same
       algorithm as <b><a href="../man1/hbal.1.html">hbal</a></b>(1).

       The program takes input via a JSON-file containing current cluster state and  the  request  details,  and
       output (on stdout) a JSON-formatted response.  In case of critical failures, the error message is printed
       on stderr and the exit code is changed to show failure.

       If the input file name is - (a single minus sign), then the request data will be read from <u>stdin</u>.

       Apart  from  input  data,  hail  collects  data  over  the network from all MonDs with the --mond option.
       Currently it uses only data produced by the CPUload collector.

   <b>ALGORITHM</b>
       On regular node groups, the program uses a simplified version of the hbal algorithm;  for  allocation  on
       node groups with exclusive storage see below.

       For  single-node allocations (non-mirrored instances), again we select the node which, when chosen as the
       primary node, gives the best score.

       For dual-node allocations (mirrored instances), we chose the best pair; this is the only choice where the
       algorithm is non-trivial with regard to cluster size.

       For relocations, we try to change the secondary node of the instance to all the valid  other  nodes;  the
       node which results in the best cluster score is chosen.

       For  node  changes  (<u>change-node</u>  mode),  we  currently  support DRBD instances only, and all three modes
       (primary changes, secondary changes and all node changes).

       For group moves (<u>change-group</u> mode), again only DRBD is supported, and we compute  the  correct  sequence
       that  will  result in a group change; job failure mid-way will result in a split instance.  The choice of
       node(s) on the target group is based on the group score, and the choice of group is  based  on  the  same
       algorithm as allocations (group with lowest score after placement).

       The deprecated <u>multi-evacuate</u> modes is no longer supported.

       In all cases, the cluster (or group) scoring is identical to the hbal algorithm.

       For  allocation  on  node  groups with exclusive storage, the lost-allocations metrics is used instead to
       determine which node to allocate an instance on.  For a node the allocation vector is the vector of,  for
       each  instance policy interval in decreasing order, the number of instances minimally compliant with that
       interval that still can be placed on that node.  The lost-allocations vector for an instance on a node is
       the difference of the allocation vectors for that node before and after  placing  the  instance  on  that
       node.  The lost-allocations metrics is the lost allocation vector followed by the remaining disk space on
       the chosen node, all compared lexicographically.

</pre><h4><b>OPTIONS</b></h4><pre>
       The options that can be passed to the program are as follows:

       -p, --print-nodes
              Prints  the before and after node status, in a format designed to allow the user to understand the
              node's most important parameters.  See the man page <b><a href="../man1/htools.1.html">htools</a></b>(1) for more details about this option.

       -t <u>datafile</u>, --text-data=*datafile*
              The name of the file holding cluster information, to override the data in the JSON request itself.
              This is mostly used for debugging.  The format of the file is described in the man page <b><a href="../man1/htools.1.html">htools</a></b>(1).

       --mond=*yes|no*
              If given the program will query all MonDs to fetch data from the supported  data  collectors  over
              the network.

       --mond-data <u>datafile</u>
              The  name  of  the  file  holding  the  data provided by MonD, to override querying MonDs over the
              network.  This is mostly used for debugging.  The file must be in JSON format and present an array
              of JSON objects , one for every node, with two members.  The first member named node is  the  name
              of the node and the second member named reports is an array of report objects.  The report objects
              must be in the same format as produced by the monitoring agent.

       --ignore-dynu
              If given, all dynamic utilisation information will be ignored by assuming it to be 0.  This option
              will take precedence over any data passed by the MonDs with the --mond and the --mond-data option.

       --ignore-soft-errors
              If  given, all checks for soft errors will be omitted when searching for possible allocations.  In
              this way a useful decision can be made even in overloaded clusters.

       --no-capacity-checks
              Normally, hail will only consider those allocations where all instances of a node can  immediately
              restarted  should that node fail.  With this option given, hail will check only N+1 redundancy for
              DRBD instances.

       --restrict-allocation-to
              Only consider alloctions on the specified nodes.  This overrides any  restrictions  given  in  the
              allocation request.

       --simulate <u>description</u>
              Backend  specification:  similar  to the <b>-t</b> option, this allows overriding the cluster data with a
              simulated cluster.  For details about the description, see the man page <b><a href="../man1/htools.1.html">htools</a></b>(1).

       -S <u>filename</u>, --save-cluster=*filename*
              If given, the state of the cluster before and  the  iallocator  run  is  saved  to  a  file  named
              <u>filename.pre-ialloc</u>,  respectively <u>filename.post-ialloc</u>.  This allows re-feeding the cluster state
              to any of the htools utilities via the -t option.

       -v     This option increases verbosity and can be used for debugging  in  order  to  understand  how  the
              IAllocator request is parsed; it can be passed multiple times for successively more information.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       For  the  tag-exclusion  configuration  (see  the  manpage  of  hbal for more details), the list of which
       instance tags to consider as exclusion tags will be read from the cluster tags, configured as follows:

       • get all cluster tags starting with <b>htools:iextags:</b>

       • use their suffix as the prefix for exclusion tags

       For example, given a cluster tag like <b>htools:iextags:service</b>, all instance tags  of  the  form  <b>service:X</b>
       will  be  considered  as  exclusion  tags,  meaning  that  (e.g.)   two  instances  which both have a tag
       <b>service:foo</b> will not be placed on the same primary node.

</pre><h4><b>OPTIONS</b></h4><pre>
       The options that can be passed to the program are as follows:

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       The exist status of the command will be zero, unless for some reason the algorithm fatally  failed  (e.g.
       wrong node or instance data).

</pre><h4><b>BUGS</b></h4><pre>
       Networks  (as  configured  by  <b><a href="../man8/gnt-network.8.html">gnt-network</a></b>(8)) are not taken into account in Ganeti 2.7.  The only way to
       guarantee that they work correctly is having your networks connected to all  nodegroups.   This  will  be
       fixed in a future version.

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to the project's issue tracker or contact the developers using the Ganeti mailing list.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       Ganeti  overview  and  specifications:  <b><a href="../man7/ganeti.7.html">ganeti</a></b>(7)  (general  overview),  <b><a href="../man7/ganeti-os-interface.7.html">ganeti-os-interface</a></b>(7) (guest OS
       definitions), <b><a href="../man7/ganeti-extstorage-interface.7.html">ganeti-extstorage-interface</a></b>(7) (external storage providers).

       Ganeti commands: <b><a href="../man8/gnt-cluster.8.html">gnt-cluster</a></b>(8) (cluster-wide commands), <b><a href="../man8/gnt-job.8.html">gnt-job</a></b>(8) (job-related  commands),  <b><a href="../man8/gnt-node.8.html">gnt-node</a></b>(8)
       (node-related   commands),   <b><a href="../man8/gnt-instance.8.html">gnt-instance</a></b>(8)   (instance   commands),   <b><a href="../man8/gnt-os.8.html">gnt-os</a></b>(8)  (guest  OS  commands),
       <b><a href="../man8/gnt-storage.8.html">gnt-storage</a></b>(8)  (storage  commands),  <b><a href="../man8/gnt-group.8.html">gnt-group</a></b>(8)  (node  group   commands),   <b><a href="../man8/gnt-backup.8.html">gnt-backup</a></b>(8)   (instance
       import/export commands), <b><a href="../man8/gnt-debug.8.html">gnt-debug</a></b>(8) (debug commands).

       Ganeti  daemons: <b><a href="../man8/ganeti-watcher.8.html">ganeti-watcher</a></b>(8) (automatic instance restarter), <b><a href="../man8/ganeti-cleaner.8.html">ganeti-cleaner</a></b>(8) (job queue cleaner),
       <b><a href="../man8/ganeti-noded.8.html">ganeti-noded</a></b>(8) (node daemon), <b><a href="../man8/ganeti-rapi.8.html">ganeti-rapi</a></b>(8) (remote API daemon).

       Ganeti htools: <b><a href="../man1/htools.1.html">htools</a></b>(1) (generic binary), <b><a href="../man1/hbal.1.html">hbal</a></b>(1) (cluster balancer), <b><a href="../man1/hspace.1.html">hspace</a></b>(1) (capacity  calculation),
       <b><a href="../man1/hail.1.html">hail</a></b>(1) (IAllocator plugin), <b><a href="../man1/hscan.1.html">hscan</a></b>(1) (data gatherer from remote clusters), <b><a href="../man1/hinfo.1.html">hinfo</a></b>(1) (cluster information
       printer), <b><a href="../man7/mon-collector.7.html">mon-collector</a></b>(7) (data collectors interface).

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright (C) 2006-2015 Google Inc.  All rights reserved.

       Redistribution  and  use in source and binary forms, with or without modification, are permitted provided
       that the following conditions are met:

       1.  Redistributions of source code must retain the above copyright notice, this list  of  conditions  and
       the following disclaimer.

       2.  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
       the following disclaimer in the documentation and/or other materials provided with the distribution.

       THIS  SOFTWARE  IS  PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED
       WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND  FITNESS  FOR  A
       PARTICULAR  PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
       ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,  EXEMPLARY,  OR  CONSEQUENTIAL  DAMAGES  (INCLUDING,  BUT  NOT
       LIMITED  TO,  PROCUREMENT  OF  SUBSTITUTE  GOODS  OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
       INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,  STRICT  LIABILITY,  OR
       TORT  (INCLUDING  NEGLIGENCE  OR  OTHERWISE)  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
       ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

Ganeti                                                                                                   <u><a href="../man1/HAIL.1.html">HAIL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>