<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rrdgraph_libdbi - fetching data for graphing in rrdtool graph via libdbi</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/rrdtool">rrdtool_1.7.2-4.2ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       rrdgraph_libdbi - fetching data for graphing in rrdtool graph via libdbi

</pre><h4><b>SYNOPSIS</b></h4><pre>
       &lt;rrdfile&gt; = <b>sql//&lt;libdbi</b> <b>driver&gt;/&lt;driver-option-name&gt;=&lt;driver-option-value&gt;/...</b>
       <b>[/rrdminstepsize=&lt;stepsize&gt;][/rrdfillmissing=&lt;fill</b> <b>missing</b> <b>n</b> <b>seconds&gt;]//&lt;table&gt;/&lt;unixtimestamp</b> <b>column&gt;</b>
       <b>/&lt;data</b> <b>value</b> <b>column&gt;[/derive]/&lt;where</b> <b>clause</b> <b>1&gt;/.../&lt;where</b> <b>clause</b> <b>n&gt;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This pseudo-rrd-filename defines a sql datasource:

       <b>sql//</b>
                 magic cookie-prefix for a libdbi type datasource

       <b>&lt;libdbi</b> <b>driver&gt;</b>
                 which libdbi driver to use (e.g.: mysql)

       <b>&lt;driver-option-name&gt;</b>=<b>&lt;driver-option-value&gt;</b>
                 defines the parameters that are required to connect to the database with the given libdbi driver
                 (These drivers are libdbi dependent - for details please look at the driver documentation of libdbi!)

       <b>/rrdminstepsize</b>=<b>&lt;minimum</b> <b>step</b> <b>size&gt;</b>
                 defines the minimum number of the step-length used for graphing (default: 300 seconds)

       <b>/rrdfillmissing</b>=<b>&lt;fill</b> <b>missing</b> <b>seconds&gt;</b>
                 defines the number of seconds to fill with the last value to avoid NaN boxes due to data-insertation jitter (default: 0 seconds)

       <b>&lt;table&gt;</b>
                 defines the table from which to fetch the resultset.

                 If there is a need to fetch data from several tables, these tables can be defined by separating the tablenames with a "+"

                 hex-type-encoding via %xx are translated to the actual value, use %% to use %

       <b>&lt;[*]unixtimestamp</b> <b>column&gt;</b>
                 defines the column of &lt;table&gt; which contains the unix-timestamp
                 - if this is a DATETIME field in the database, then prefix with leading '*'

                 hex-type-encoding via %xx are translated to the actual value, use %% to use %

       <b>&lt;data</b> <b>value</b> <b>column&gt;</b>
                 defines the column of &lt;table&gt; which contains the value column, which should be graphed

                 hex-type-encoding via %xx are translated to the actual value, use %% to use %

       <b>/derive</b>
                 defines that the data value used should be the delta of the 2 consecutive values (to simulate COUNTER or DERIVE type datasources)

       <b>/&lt;where</b> <b>clause(s)&gt;</b>
                 defines one (ore more) where clauses that are joined with AND to filter the entries in the &lt;table&gt;

                 hex-type-encoding via %xx are translated to the actual value, use %% to use %

       the returned value column-names, which can be used as ds-names, are:

       <b>min</b>, <b>avg</b>, <b>max</b>, <b>count</b> and <b>sigma</b>
                 are returned to be used as ds-names in your DS definition.
                 The reason for using this is that if the consolidation function is used for min/avg and max, then the engine is used several times.
                 And this results in the same SQL Statements used several times

</pre><h4><b>EXAMPLES</b></h4><pre>
       Here an example of a table in a MySQL database:

         DB connect information
           dbhost=127.0.0.1
           user=rrd
           password=secret
           dbname=rrd

         here the table:
           CREATE TABLE RRDValue (
             RRDKeyID      <a href="../man20/bigint.20.html">bigint</a>(20) NOT NULL,
             UnixTimeStamp <a href="../man11/int.11.html">int</a>(11) NOT NULL,
             value         double default NOT NULL,
             PRIMARY KEY  (RRDKeyID,UnixTimeStamp)
           );

       and the RRDKeyID we want to graph for is: 1141942900757789274

       The            pseudo            rrd-filename            to           access           this           is:
       "sql//mysql/host=127.0.0.1/dbname=rrd/username=rrd/password=secret//RRDValue/UnixTimeStamp/value
       /RRDKeyID=1141464142203608274"

       To illustrate this here a command to create a graph that contains the actual values.

         DS_BASE="sql//mysql/host=127.0.0.1/dbname=rrd/username=rrd/password=passwd//RRDValue/UnixTimeStamp/value/RRDKeyID=1141942900757789274"
         rrdtool graph test.png --imgformat=PNG --start=-1day --end=+3hours --width=1000 --height=600 \
           "DEF:min=$DS_BASE:min:AVERAGE" \
           "LINE1:min#FF0000:value" \
           "DEF:avg=$DS_BASE:avg:AVERAGE" \
           "LINE1:avg#00FF00:average" \
           "DEF:max=$DS_BASE:max:AVERAGE" \
           "LINE1:max#FF0000:max" \
           "DEF:sigma=$DS_BASE:sigma:AVERAGE" \
           "CDEF:upper=avg,4,sigma,*,+" \
           "LINE1:upper#0000FF:+4 sigma" \
           "CDEF:lower=avg,4,sigma,*,-" \
           "LINE1:lower#0000FF:-4 sigma"

</pre><h4><b>NOTES</b></h4><pre>
       * Naturally you can also use any other kind of driver that libdbi supports - e.g. postgres, ...

       * From the way the data source is joined, it should also be possible to do joins over different tables
         (separate tables with "," in table and add in the WHERE Clauses the table equal joins.
         This has not been tested!!!)

       * It should also be relatively simple to add to the database using the same data source string.
         This has not been implemented...

       * The aggregation functions are ignored and several data columns are used instead
         to avoid querying the same SQL  several  times  when  minimum,  average  and  maximum  are  needed  for
       graphing...

       *  for  DB  efficiency  you should think of having 2 tables, one containing historic values and the other
       containing the latest data.
         This second table should be kept small to allow for the least amount of blocking SQL statements.
         With mysql you can even use myisam table-type for the first and InnoDB for the second.
         This is especially interesting as with tables with +100M rows myisam is much smaller then InnoDB.

       * To debug the SQL statements set the environment variable RRDDEBUGSQL and the actual SQL statements  and
       the timing is printed to stderr.

</pre><h4><b>Performance</b> <b>issues</b> <b>with</b> <b>MySQL</b> <b>backend</b></h4><pre>
       Previous  versions  of  LibDBI  have  a  big  performance issue when retrieving data from a MySQL server.
       Performance impact is exponentially based on the number of values you retrieve from  the  database.   For
       example,  it  would  take  more  than  2  seconds to graph 5DS on 150 hours of data with a precision of 5
       minutes (against 100ms when data comes from a RRD file). This bug has been  fixed  in  version  0.9.0  of
       LibDBI.     You    can    find   more   information   on   this   libdbi-users   mailing   list   thread:
       <a href="http://sourceforge.net/mailarchive/message.php">http://sourceforge.net/mailarchive/message.php</a>?msg_id=30320894

</pre><h4><b>BUGS</b></h4><pre>
       * at least on Linux please make sure that the libdbi driver is explicitly linked against libdbi.so.0
         check via ldd /usr/lib/dbd/libmysql.so, that there is a line with libdbi.so.0.
         otherwise at least the perl module RRDs will fail because the dynamic linker cannot find  some  symbols
       from libdbi.so.
         (this only happens when the libdbi driver is actually used the first time!)
         This  is  KNOWN to be the case with RHEL4 and FC4 and FC5! (But actually this is a bug with libdbi make
       files!)

       * at least version 0.8.1 of libdbi exhibits a bug with BINARY fields
         (shorttext,text,mediumtext,longtext and possibly also BINARY and BLOB fields),
         that can result in coredumps of rrdtool.
         The tool will tell you on stderr if this occurs, so that you know what may be the reason.
         If   you   are   not   experiencing   these   coredumps,   then   set    the    environment    variable
       RRD_NO_LIBDBI_BUG_WARNING,
         and then the message will not get shown.

</pre><h4><b>AUTHOR</b></h4><pre>
       Martin Sperl &lt;<a href="mailto:rrdtool@martin.sperl.org">rrdtool@martin.sperl.org</a>&gt;

1.7.2                                              2025-03-04                                 <u><a href="../man1/RRDGRAPH_LIBDBI.1.html">RRDGRAPH_LIBDBI</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>