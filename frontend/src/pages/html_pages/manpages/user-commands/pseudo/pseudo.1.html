<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pseudo - run a command in a virtual root environment</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/pseudo">pseudo_1.9.0+git20230301+ec6151a2b057-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pseudo - run a command in a virtual root environment

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pseudo</b> [<b>-dflv</b>] [ <b>-x</b> <u>flags</u> ] [ <b>-P</b> <u>prefix</u> ] [ <b>-rR</b> <u>root</u> ] [ <b>-t</b> <u>timeout</u> ] [<u>command</u>]

       <b>pseudo</b> <b>-h</b>

       <b>pseudo</b> [<b>-dflv</b>] [ <b>-x</b> <u>flags</u> ] [ <b>-P</b> <u>prefix</u> ] [<b>-BC</b>] <b>-i</b> path

       <b>pseudo</b> [<b>-dflv</b>] [ <b>-x</b> <u>flags</u> ] [ <b>-P</b> <u>prefix</u> ] [<b>-BC</b>] <b>-m</b> from <b>-M</b> to

       <b>pseudo</b> [<b>-dflv</b>] [ <b>-x</b> <u>flags</u> ] [ <b>-P</b> <u>prefix</u> ] <b>-S</b>

       <b>pseudo</b> [<b>-dflv</b>] [ <b>-x</b> <u>flags</u> ] [ <b>-P</b> <u>prefix</u> ] <b>-V</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <u>pseudo</u> utility provides a virtual root environment, hereafter referred to as the <u>pseudo</u> <u>environment</u>,
       allowing the creation of file system images and packages by users without root  privileges.   The  pseudo
       environment  is  implemented  by pushing a special library (<u>libpseudo.so</u>) into the <b>LD_PRELOAD</b> environment
       variable.  This library intercepts a large number  of  common  filesystem  operations  and  some  user-id
       related  operations,  and  returns values that look as though the operations had been performed by a root
       user.  This is in turn managed by a daemon program which keeps a list of virtualized file  ownership  and
       permissions; this daemon program itself is <u>pseudo</u>.

       The  <u>pseudo</u> program itself can also be used as a program launcher.  The launcher is used to automatically
       configure a working environment, then execute processes within that environment.  Alternatively, you  can
       bypass  this by setting up certain environment variables (see the <b>ENVIRONMENT</b> section below).  The <u>pseudo</u>
       client library (<u>libpseudo.so</u>) can then start the server automatically.

       The <u>pseudo</u> command can be invoked in one of several possible modes:

       <b>-B</b>      The <b>-B</b> option causes <u>pseudo</u> to scan its database, as with the <b>-C</b> option, but instead of reporting
               mismatches, <u>pseudo</u> attempts to repair them.  Specifically, device and inode number mismatches are
               corrected, and symlink or directory mismatches result in deletion of database entries.

       <b>-C</b>      The <b>-C</b> option causes <u>pseudo</u> to scan its database, comparing against the filesystem, and reporting
               likely errors.  This may be unreliable when the server is actively running.

       <b>-h</b>      The <b>-h</b> option causes <u>pseudo</u> to print a usage message and exit.

       <b>-i</b>      The <b>-i</b> option causes <u>pseudo</u> to attempt to correct device number mismatches by checking inodes; if
               <u>path</u> has the same inode number as recorded in the database, but a different  device  number,  all
               instances  of  the device number recorded in the database are updated to the device number in the
               live filesystem for <u>path</u>.  This is  intended  to  handle  the  mismatches  that  can  occur  when
               remounting  an NFS filesystem.  The <b>-i</b> option implies the <b>-C</b> option.  You can also specify the <b>-B</b>
               option to request that the database be rebuilt.

       <b>-m</b>      The <b>-m</b> and <b>-M</b> options cause <u>pseudo</u> to rename files, replacing the string <u>from</u> with the string <u>to.</u>
               The <b>-m</b> option pair implies the <b>-C</b> option.  You can also specify the <b>-B</b> option to request that the
               database be rebuilt.

       <b>-V</b>      The <b>-V</b> option causes <u>pseudo</u> to print configuration information and exit immediately.

       <b>-S</b>      The <b>-S</b> option causes <u>pseudo</u> to try to find an existing server, and if  it  finds  one,  instructs
               that  server to shut down as soon as all clients are detached from it.  Note that the server will
               not shut down while clients are connected to it; in this case, <u>pseudo</u> will print a  list  of  the
               remaining client PIDs.

       <b>-d</b>      The <b>-d</b> option causes pseudo to immediately detach and run in the background as a daemon.  This is
               rarely useful except for debugging.

       Finally,  invoked without any of these options, <u>pseudo</u> sets up an emulated root environment, then invokes
       <u>command</u> if it was provided, otherwise a shell (using the <b>SHELL</b> environment variable  if  it  is  set,  or
       <u><a href="file:/bin/sh">/bin/sh</a></u> otherwise).

       The following options modify the behavior of <u>pseudo</u>:

       <b>-d</b> <u>(daemonize)</u>
               Run  as a daemon; <u>pseudo</u> detaches from the calling environment and runs as a daemon.  The command
               returns successfully if this appears to have succeeded, otherwise it produces  an  error  message
               and returns a failure status.

       <b>-f</b> <u>(foreground)</u>
               Run  in  the foreground; <u>pseudo</u> runs as a server, and does not try to start other commands.  This
               mode is useful for debugging.

       <b>-l</b> <u>(log)</u>
               Enable logging.  The <u>pseudo</u> daemon will log every filesystem transaction in the log database.

       <b>-r</b> <u>root</u>

       <b>-R</b> <u>root</u> Set the <b>PSEUDO_CHROOT</b> environment variable, running as though the program had called <u><a href="../man2/chroot.2.html">chroot</a>(2)</u> on
               the specified path.  With <b>-r</b>, this implies  changing  the  working  directory  to  the  specified
               directory; with <b>-R</b>, it does not.

       <b>-t</b> <b>timeout</b>
               Set  the  timeout  of the <u>pseudo</u> daemon, in seconds.  The default is currently 30 seconds.  After
               this long with no attached clients, the <u>pseudo</u> daemon shuts down automatically.  The server never
               shuts down while it has attached clients.  Note that this does not  prevent  continued  use;  new
               clients can restart the daemon if they need it.

       <b>-v</b> <u>(verbose)</u>
               Increase  the  verbosity of the <u>pseudo</u> daemon, and the client library for any programs started by
               this invocation of  <u>pseudo</u>.   This  is  equivalent  to  the  numeric  form  of  the  <b>PSEUDO_DEBUG</b>
               environment variable; multiple <b>-v</b> options increase the debugging level.

       <b>-x</b> <u>(debug)</u>
               Set specific deugging flags (the <u>pseudo</u> utility's help message lists them). This is equivalent to
               the string form of the <b>PSEUDO_DEBUG</b> environment variable.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The two most common usages of <u>pseudo</u> are using it to run specific commands, and setting up an environment
       manually for running various other commands.

       For the first case, the usage is reasonably simple:

       $ <u>/path/to/pseudo</u>
       # <u>commands</u> <u>which</u> <u>require</u> <u>root</u> <u>privileges</u>

       You may have to use the <b>-P</b><u>prefix</u> option to tell <u>pseudo</u> where to look for its database and server.  If you
       specify a full path, <u>pseudo</u> assumes that <b>PSEUDO_PREFIX</b> should be the path to the directory containing the
       <u>pseudo</u> program, or to the <u><a href="file:/bin">/bin</a></u> directory containing the <u>pseudo</u> program.

       The  other  way  to use <u>pseudo</u> is by setting up an environment.  This is suitable for use in <u>Makefiles</u> or
       similar environments, where you want to run a series of commands in the <u>pseudo</u> environment,  but  not  to
       keep  invoking the <u>pseudo</u> command.  To do this, set up the <b>PSEUDO_PREFIX</b>, <b>LD_PRELOAD</b>, and LD_LIBRARY_PATH
       environment variables, then run programs normally.  You do not  need  to  separately  invoke  the  <u>pseudo</u>
       daemon; the client library starts it as needed.

       If  you  have moved a directory which <u>pseudo</u> was tracking, you may be able to get the database reattached
       using the <b>-m</b> option.  A typical usage might be:

       $ <u>/path/to/pseudo</u> <b>-B</b> <b>-m</b> <u>oldpath</u> <b>-M</b> <u>newpath</u>

       This requests that <u>pseudo</u> replace the string <u>oldpath</u>  with  the  string  <u>newpath</u>  at  the  beginnings  of
       filenames, then regenerate the database, correcting any device/inode numbers.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       Depending  on  invocation,  diagnostic  messages  usually  go  either  to  standard  error or to the file
       <b>PSEUDO_PREFIX</b> <u>/var/pseudo/pseudo.log</u>.  By default, <u>pseudo</u> daemon messages  go  into  the  log  file,  but
       messages  generated  by  the  client  code  go  to  standard  error.   These  can  be  changed  using the
       <b>PSEUDO_DEBUG_FILE</b> environment variable, documented in <b>ENVIRONMENT</b>.  At the default  logging  level,  only
       critical  messages  are  displayed.   If  you  have  raised the logging level (using the <u>-v</u> option or the
       <b>PSEUDO_DEBUG</b> environment variable), additional messages are displayed.  Levels higher  than  2  are  very
       unlikely to be useful outside of <u>pseudo</u> development.

       Diagnostic  messages  seen  by default are those which are believed to indicate either a serious internal
       flaw in <u>pseudo</u> or a completely unexpected failure from the underlying operating system.  In  normal  use,
       you should see no diagnostic messages.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       The most significant environment variables for <u>pseudo</u> are <b>LD_PRELOAD</b> and <b>LD_LIBRARY_PATH</b>.  However, these
       variables  have no special meaning to <u>pseudo</u>; rather, they are used in the standard way to manipulate the
       dynamic linker into loading the <u>libpseudo</u> library so that it can intercept calls into  the  underlying  C
       library.

       The following environment variables are used directly by <u>pseudo</u>:

       <b>PSEUDO_BINDIR</b>
               This  directory  holds  the  path to the <u>pseudo</u> binary; by default, it is the <u>bin</u> directory under
               <b>PSEUDO_PREFIX.</b>

       <b>PSEUDO_CHROOT</b>
               This variable holds the current emulated <u><a href="../man2/chroot.2.html">chroot</a>(2)</u> path.  Paths that are  relative  to  this  are
               treated as though they were instead relative to the filesystem root.

       <b>PSEUDO_DEBUG</b>
               This  variable  holds  either  a numeric "debug level" for <u>pseudo</u> to run at, or a set of specific
               debugging flags, generally letters.  Use <b>pseudo</b> <b>-h</b> to see the available flags. In  general,  this
               is useful only for debugging <u>pseudo</u> itself.

       <b>PSEUDO_DEBUG_FILE</b>
               The name of a file to use for debugging messages from the pseudo client; the default is to log to
               standard  error.   If  the  string  contains  a single <b>%s</b>, that string is replaced with the short
               program name, and if it contains a single <b>%d</b>, that string is replaced with the process ID.  Other
               format specifiers (other than '%%') are not allowed.  By default, the <u>pseudo</u> server logs  to  the
               file <u>pseudo.log</u> in the <u>var/pseudo</u> directory, while clients log to standard error.

       <b>PSEUDO_DISABLED</b>
               If  this  variable  is set to a value that doesn't look like f, F, n, N, s, S, or a numeric zero,
               the <u>pseudo</u> client library does not modify the behavior of called functions, though  it  continues
               to intercept them and block signals while processing them.  This variable is reevaluated on every
               call to <u><a href="../man2/fork.2.html">fork</a>(2)</u>, <u><a href="../man2/clone.2.html">clone</a>(2)</u> or related functions. If the value starts with a lowercase or uppercase
               <u>s</u>  ,  the  pseudo  client  disables  all  server  spawning and communications, but still operates
               locally. This means that no filesystem mode or  permissions  changes  are  actually  recorded  or
               reported, but functions like <u>chown()</u> will still report success, even though nothing happens. This
               function is intended for debugging of issues which are complicated by the server's involvement.

       <b>PSEUDO_ALLOW_FSYNC</b>
               If  this  variable  is  set,  pseudo  will  allow  <u>fsync()</u>  and related system calls, even it was
               configured with the <u>--enable-force-async</u> option. Otherwise, that option results in all such calls
               being discarded silently, even when <b>PSEUDO_DISABLED</b> is set. The value specified doesn't matter.

       <b>PSEUDO_ENOSYS_ABORT</b>
               If this variable is set, the <u>pseudo</u> client library calls <u>abort()</u> rather  than  setting  <u>errno</u>  to
               <b>ENOSYS</b>  in  the  event of a call to a missing underlying function.  This variable has no function
               outside of debugging <u>pseudo</u> itself.

       <b>PSEUDO_LIBDIR</b>
               This directory holds the path to the <u>pseudo</u> shared libraries; by default, it is the <u>lib</u> directory
               under <b>PSEUDO_PREFIX</b>.  (On 64-bit hosts, <u>lib64</u> is also used.)

       <b>PSEUDO_LOCALSTATEDIR</b>
               This directory holds the <u>pseudo</u> database files and log files; by default, it  is  the  <u>var/pseudo</u>
               directory under <b>PSEUDO_PREFIX</b>.

       <b>PSEUDO_NOSYMLINKEXP</b>
               By  default,  when  chrooted, <u>pseudo</u> prepends the chroot directory to the paths used for absolute
               symlinks; this behavior ensures that opening symlinks produces expected results  in  most  cases.
               In  some  cases  you  may  want to suppress this.  If this variable is unset, or set to any value
               other than 0, <u>pseudo</u> expands symlink paths like this.  If this variable is set to 0, the behavior
               is disabled.

       <b>PSEUDO_OPTS</b>
               This variable holds options to be passed to any new  <u>pseudo</u>  servers  started.   Typically,  when
               <u>pseudo</u>  is  used  as  a launcher, this will be set automatically; however, you can also use it to
               pass options when using <b>LD_PRELOAD</b> to manually run things in the <u>pseudo</u> environment.

       <b>PSEUDO_PASSWD</b>
               This variable holds the path to a directory containing  password  and  group  files  to  use  for
               emulation  of  various  password  and  group  routines.   It  should  be  the path to a directory
               containing the <u>etc</u> directory containing files named <u>passwd</u> and <u>group</u>.  When <u>pseudo</u> is emulating a
               <u>chroot</u> environment, the chroot directory is used by preference.  The  parallelism  between  these
               cases  is  why  this  variable  points  at  the parent directory of <u>etc</u> rather than the directory
               containing the files. If there is no <u>chroot</u> environment, and this variable is also unset,  <u>pseudo</u>
               falls back to a directory specified at configure time, with the default being the root directory.
               This is controlled by the <b>PSEUDO_PASSWD_FALLBACK</b> definition.

       <b>PSEUDO_PREFIX</b>
               If  set,  the  variable  <b>PSEUDO_PREFIX</b>  is  used  to determine the path to use to find the <u>pseudo</u>
               server, in <b>PSEUDO_PREFIX</b><a href="file:/bin">/bin</a>, and the  <u>pseudo</u>  data  files,  in  <b>PSEUDO_PREFIX</b>/var/pseudo.   This
               variable is automatically set by the <u>pseudo</u> program when it is used as a launcher.

       <b>PSEUDO_PROFILE_PATH</b>
               If  <u>pseudo</u>  was  configured  with  profiling  enabled,  specifies a path in which to write client
               profiling information for use with the <u>pseudo_profile</u> utility (not built by default).

       <b>PSEUDO_TAG</b>
               If this variable is set in a client's environment, its value is communicated to the server at the
               beginning of each client session, and recorded in the log database if any logging occurs  related
               to  a specific client.  Note that different clients may have different tags associated with them;
               the tag value is per-client, not per-server.

       <b>PSEUDO_UIDS</b>, <b>PSEUDO_GIDS</b>
               These variables are used internally to pass information about the current emulated user and group
               identity from one process to another.

       <b>PSEUDO_UNLOAD</b>
               This variable is reevaluated on every call to <u><a href="../man2/fork.2.html">fork</a>(2)</u>, <a href="../man3/exec.3.html">exec</a>(3)  or  related  functions.   If  the
               variable  exists  libpseudo.so  will be removed from <b>LD_PRELOAD</b> and <b>PSEUDO_DISABLED</b> behavior will
               also be triggered.  For processes that simply <u><a href="../man2/fork.2.html">fork</a>(2),</u> the  behavior  will  be  the  same  as  if
               <b>PSEUDO_DISABLED</b> was set.  For new processes, after a call to <u><a href="../man3/exec.3.html">exec</a>(3)</u> <u>or</u> <u><a href="../man3/system.3.html">system</a>(3)</u> pseudo will not
               be loaded in the new process.

       <b>SHELL</b>   If  set,  this will be used when <u>pseudo</u> is invoked without either a command or one of the options
               which directs it to do something other than run a command.  Otherwise, <u>pseudo</u> defaults to <u><a href="file:/bin/sh">/bin/sh</a></u>
               <u>.</u>

</pre><h4><b>BUGS</b></h4><pre>
       The <u>pseudo</u> database is not particularly robust in the face of  whole  directory  trees  being  moved,  or
       changes in the underlying device and inode numbers.  It has a reasonable chance of recovering if only the
       path  or  the device numbers have changed, but it is not particularly designed to address this.  A future
       release is expected to have improved resilience in these cases.

       The filesystem on which <u>pseudo</u> keeps its database and files must at a minimum support UNIX domain sockets
       and reasonable file locking semantics.  Note that <u>pseudo</u> relies on <u><a href="../man2/flock.2.html">flock</a>(2)</u> locking semantics; a lock has
       to persist into a child process.  This should probably eventually be fixed.

       The <u>pseudo</u> client library is probably thread-safe, but has not been adequately tested or debugged in that
       context.

       Filesystem performance is noticably worse under <u>pseudo</u> than it is otherwise.  This  is  probably  because
       nearly  every  operation  (other  than  reads  and  writes)  involves  at  least  one  round-trip network
       communication with the server, and probably some kind of database activity.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/fakeroot.1.html">fakeroot</a>(1), <a href="../man8/ld.so.8.html">ld.so</a>(8), <a href="../man1/pseudolog.1.html">pseudolog</a>(1), <a href="../man1/sqlite3.1.html">sqlite3</a>(1)

</pre><h4><b>FURTHER</b> <b>READING</b></h4><pre>
       Documentation of the internals of <u>pseudo</u> may be found in the <u>doc</u> subdirectory of the pseudo source tree.

                                         pseudo - pretending to be root                                <u><a href="../man1/pseudo.1.html">pseudo</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>