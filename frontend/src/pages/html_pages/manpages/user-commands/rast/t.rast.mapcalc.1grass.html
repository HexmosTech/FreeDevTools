<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>t.rast.mapcalc   -  Performs spatio-temporal mapcalc expressions on temporally sampled maps of space time</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/grass-doc">grass-doc_8.4.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>t.rast.mapcalc</b>   -  Performs spatio-temporal mapcalc expressions on temporally sampled maps of space time
       raster datasets.

</pre><h4><b>KEYWORDS</b></h4><pre>
       temporal, algebra, raster, time

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>t.rast.mapcalc</b>
       <b>t.rast.mapcalc</b> <b>--help</b>
       <b>t.rast.mapcalc</b>  [-<b>ns</b>]  <b>inputs</b>=<u>name</u>[,<u>name</u>,...]  <b>expression</b>=<u>string</u>   [<b>method</b>=<u>name</u>[,<u>name</u>,...]]   <b>output</b>=<u>name</u>
       <b>basename</b>=<u>basename</u>  [<b>nprocs</b>=<u>integer</u>]   [--<b>overwrite</b>]  [--<b>help</b>]  [--<b>verbose</b>]  [--<b>quiet</b>]  [--<b>ui</b>]

   <b>Flags:</b>
       <b>-n</b>
           Register Null maps

       <b>-s</b>
           Check the spatial topology of temporally related maps and process only spatially related maps

       <b>--overwrite</b>
           Allow output files to overwrite existing files

       <b>--help</b>
           Print usage summary

       <b>--verbose</b>
           Verbose module output

       <b>--quiet</b>
           Quiet module output

       <b>--ui</b>
           Force launching GUI dialog

   <b>Parameters:</b>
       <b>inputs</b>=<u>name[,name</u>,...] <b>[required]</b>
           Name of the input space time raster datasets

       <b>expression</b>=<u>string</u> <b>[required]</b>
           Spatio-temporal mapcalc expression

       <b>method</b>=<u>name[,name</u>,...]
           The method to be used for sampling the input dataset
           Options: <u>start,</u> <u>during,</u> <u>overlap,</u> <u>contain,</u> <u>equal,</u> <u>follows,</u> <u>precedes</u>
           Default: <u>equal</u>

       <b>output</b>=<u>name</u> <b>[required]</b>
           Name of the output space time raster dataset

       <b>basename</b>=<u>basename</u> <b>[required]</b>
           Basename for output raster maps
           A numerical suffix separated by an underscore will be attached to create a unique identifier

       <b>nprocs</b>=<u>integer</u>
           Number of r.mapcalc processes to run in parallel
           Default: <u>1</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>t.rast.mapcalc</u>  performs  spatio-temporal  <u>mapcalc</u>  expressions  on maps of temporally sampled space time
       raster datasets (STRDS). Spatial and temporal operators and  internal  variables  are  available  in  the
       expression  string.  The  description  of  the  spatial  operators,  functions  and internal variables is
       available in the <u>r.mapcalc</u> manual page. The temporal functions are described in detail below.

       This module expects several parameters. All space time raster datasets that are referenced in the <u>mapcalc</u>
       <u>expression</u> must be listed in the <b>inputs</b> option. The <u>first</u> space time raster dataset  that  is  listed  as
       input  will  be  used  to  temporally  sample all other space time raster datasets. The temporal sampling
       method can be chosen using the <b>method</b> option. The order of the STRDS’s in the mapcalc expression  can  be
       different  to  the order of the STRDS’s in the input option. The resulting space time raster dataset must
       be specified in the <b>output</b> option together with the <b>basename</b> of generated raster maps that are registered
       in the resulting STRDS. Empty maps resulting from map-calculation are not  registered  by  default.  This
       behavior  can  be changed with the <b>-n</b> flag. The flag <b>-s</b> can be used to assure that only spatially related
       maps in the STRDS’s are processed. Spatially related means that temporally related maps overlap in  their
       spatial extent.

       The  module  <u>t.rast.mapcalc</u>  supports  parallel  processing.  The  option  <b>nprocs</b> specifies the number of
       processes that can be started in parallel.

       A mapcalc expression must be provided to process the temporal sampled maps. Temporal  internal  variables
       are available in addition to the <u>r.mapcalc</u> spatial operators and functions:

       The supported internal variables for relative and absolute time are:

           •   <u>td()</u> - This internal variable represents the size of the current sample time interval in days and
               fraction of days for absolute time, and in relative units in case of relative time.

           •   <u>start_time()</u>  -  This  internal variable represents the time difference between the start time of
               the sample space time raster dataset and the  start  time  of  the  current  sample  interval  or
               instance.   The  time is measured in days and fraction of days for absolute time, and in relative
               units in case of relative time.

           •   <u>end_time()</u> - This internal variable represents the time difference between the start time of  the
               sample  space  time  raster  dataset and the end time of the current sample interval. The time is
               measured in days and fraction of days for absolute  time,  and  in  relative  units  in  case  of
               relative time.  The end_time() will be represented by null() in case of a time instance.

       The supported internal variables for the current sample interval or instance for absolute time are:

           •   <u>start_doy()</u> - Day of year (doy) from the start time [1 - 366]

           •   <u>start_dow()</u> - Day of week (dow) from the start time [1 - 7], the start of the week is Monday == 1

           •   <u>start_year()</u> - The year of the start time [0 - 9999]

           •   <u>start_month()</u> - The month of the start time [1 - 12]

           •   <u>start_week()</u> - Week of year of the start time [1 - 54]

           •   <u>start_day()</u> - Day of month from the start time [1 - 31]

           •   <u>start_hour()</u> - The hour of the start time [0 - 23]

           •   <u>start_minute()</u> - The minute of the start time [0 - 59]

           •   <u>start_second()</u> - The second of the start time [0 - 59]

           •   <u>end_doy()</u> - Day of year (doy) from the end time [1 - 366]

           •   <u>end_dow()</u> - Day of week (dow) from the end time [1 - 7], the start of the week is Monday == 1

           •   <u>end_year()</u> - The year of the end time [0 - 9999]

           •   <u>end_month()</u> - The month of the end time [1 - 12]

           •   <u>end_woy()</u> - Week of year (woy) of the end time [1 - 54]

           •   <u>end_day()</u> - Day of month from the start time [1 - 31]

           •   <u>end_hour()</u> - The hour of the end time [0 - 23]

           •   <u>end_minute()</u> - The minute of the end time [0 - 59]

           •   <u>end_second()</u> - The second of the end time [0 - 59].
       The <u>end_*</u> functions are represented by the null() internal variable in case of time instances.

</pre><h4><b>NOTES</b></h4><pre>
       We  will discuss the internal work of <u>t.rast.mapcalc</u> with an example. Imagine we have two STRDS as input,
       each one of monthly granularity. The first one <u>A</u> has 6 raster maps (a3 ... a8) with a temporal range from
       March to August. The second STRDS <u>B</u> has 12 raster maps (b1 ... b12) ranging from January to December. The
       value of the raster maps is the number of the month from their interval start time.  Dataset  <u>A</u>  will  be
       used  to  sample  dataset  <u>B</u> to create a dataset <u>C</u>. We want to add all maps with equal time stamps if the
       month of the start time is May or June, otherwise we multiply the maps. The command will look as follows:

       t.rast.mapcalc input=A,B output=C basename=c method=equal \
           expression="if(start_month() == 5 || start_month() == 6, (A + B), (A * B))"

       The resulting raster maps in dataset C can be listed with <u>t.rast.list</u>:

       name    start_time              min     max
       c_1     2001-03-01 00:00:00     9.0     9.0
       c_2     2001-04-01 00:00:00     16.0    16.0
       c_3     2001-05-01 00:00:00     10.0    10.0
       c_4     2001-06-01 00:00:00     12.0    12.0
       c_5     2001-07-01 00:00:00     49.0    49.0
       c_6     2001-08-01 00:00:00     64.0    64.0

       Internally the spatio-temporal expression will be analyzed for each time interval of the  sample  dataset
       A,  the  temporal  functions  will  be  replaced  by numerical values, the names of the space time raster
       datasets will be replaced by the corresponding raster maps.  The  final  expression  will  be  passed  to
       <u>r.mapcalc</u>, resulting in 6 runs:

       r.mapcalc expression="c_1 = if(3 == 5 || 3 == 6, (a3 + b3), (a3 * b3))"
       r.mapcalc expression="c_2 = if(4 == 5 || 4 == 6, (a4 + b4), (a4 * b4))"
       r.mapcalc expression="c_3 = if(5 == 5 || 5 == 6, (a5 + b5), (a5 * b5))"
       r.mapcalc expression="c_4 = if(6 == 5 || 6 == 6, (a6 + b6), (a6 * b6))"
       r.mapcalc expression="c_5 = if(7 == 5 || 7 == 6, (a7 + b7), (a7 * b7))"
       r.mapcalc expression="c_6 = if(8 == 5 || 8 == 6, (a8 + b8), (a8 * b8))"

       Semantic labels present in the sample dataset A will be transferred to the output dataset.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  following  command creates a new space time raster dataset january_under_0 that will set to null all
       cells with temperature above zero in the January maps while keeping all the rest as in the original  time
       series.  This  will  change  the  maximum  values of all January maps in the new STRDS as compared to the
       original one, tempmean_monthly.
       t.rast.mapcalc input=tempmean_monthly output=january_under_0 basename=january_under_0 \
           expression="if(start_month() == 1 &amp;&amp; tempmean_monthly &gt; 0, null(), tempmean_monthly)"
       # print minimum and maximum only for January in the new strds
       t.rast.list january_under_0 columns=name,start_time,min,max | grep 01-01
       name|start_time|min|max
       january_under_0_01|2009-01-01 00:00:00|-3.380823|-7e-06
       january_under_0_13|2010-01-01 00:00:00|-5.266929|-0.000154
       january_under_0_25|2011-01-01 00:00:00|-4.968747|-6.1e-05
       january_under_0_37|2012-01-01 00:00:00|-0.534994|-0.014581
       # print minimum and maximum only for January in the original strds,
       # note that the maximum is different
       t.rast.list tempmean_monthly columns=name,start_time,min,max | grep 01-01
       2009_01_tempmean|2009-01-01 00:00:00|-3.380823|7.426054
       2010_01_tempmean|2010-01-01 00:00:00|-5.266929|5.71131
       2011_01_tempmean|2011-01-01 00:00:00|-4.968747|4.967295
       2012_01_tempmean|2012-01-01 00:00:00|-0.534994|9.69511

   <b>Semantic</b> <b>label</b> <b>filtering</b>
       <u>t.rast.mapcalc</u> supports semantic label filtering similarly to <u>t.rast.list</u>. In example below a  new  STRDS
       will be created and filled by NDVI products.
       t.rast.mapcalc inputs=test.S2_8,test.S2_4 output=ndvi basename=ndvi \
            expression="float(test.S2_8 - test.S2_4) / (test.S2_8 + test.S2_4)"
       For more information about semantic label concept see <u>i.band.library</u> module.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
        <u>r.mapcalc,</u> <u>t.register,</u> <u>t.rast.list,</u> <u>t.info</u>

       Temporal data processing Wiki

</pre><h4><b>AUTHOR</b></h4><pre>
       Sören Gebbert, Thünen Institute of Climate-Smart Agriculture

</pre><h4><b>SOURCE</b> <b>CODE</b></h4><pre>
       Available at: t.rast.mapcalc source code (history)

       Accessed: Friday Apr 04 01:21:14 2025

       Main index | Temporal index | Topics index | Keywords index | Graphical index | Full index

       © 2003-2025 GRASS Development Team, GRASS GIS 8.4.1 Reference Manual

GRASS 8.4.1                                                                               <u><a href="../man1grass/t.rast.mapcalc.1grass.html">t.rast.mapcalc</a></u>(1grass)
</pre>
 </div>
</div></section>
</div>
</body>
</html>