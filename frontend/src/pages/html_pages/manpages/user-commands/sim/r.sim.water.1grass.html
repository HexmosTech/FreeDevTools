<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>r.sim.water  - Overland flow hydrologic simulation using path sampling method (SIMWE).</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/grass-doc">grass-doc_8.4.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>r.sim.water</b>  - Overland flow hydrologic simulation using path sampling method (SIMWE).

</pre><h4><b>KEYWORDS</b></h4><pre>
       raster, hydrology, soil, flow, overland flow, model, parallel

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>r.sim.water</b>
       <b>r.sim.water</b> <b>--help</b>
       <b>r.sim.water</b>   [-<b>ts</b>]  <b>elevation</b>=<u>name</u>  <b>dx</b>=<u>name</u>  <b>dy</b>=<u>name</u>   [<b>rain</b>=<u>name</u>]    [<b>rain_value</b>=<u>float</u>]    [<b>infil</b>=<u>name</u>]
       [<b>infil_value</b>=<u>float</u>]     [<b>man</b>=<u>name</u>]     [<b>man_value</b>=<u>float</u>]      [<b>flow_control</b>=<u>name</u>]      [<b>observation</b>=<u>name</u>]
       [<b>depth</b>=<u>name</u>]        [<b>discharge</b>=<u>name</u>]        [<b>error</b>=<u>name</u>]       [<b>walkers_output</b>=<u>name</u>]       [<b>logfile</b>=<u>name</u>]
       [<b>nwalkers</b>=<u>integer</u>]        [<b>niterations</b>=<u>integer</u>]         [<b>mintimestep</b>=<u>float</u>]         [<b>output_step</b>=<u>integer</u>]
       [<b>diffusion_coeff</b>=<u>float</u>]      [<b>hmax</b>=<u>float</u>]      [<b>halpha</b>=<u>float</u>]     [<b>hbeta</b>=<u>float</u>]     [<b>random_seed</b>=<u>integer</u>]
       [<b>nprocs</b>=<u>integer</u>]   [--<b>overwrite</b>]  [--<b>help</b>]  [--<b>verbose</b>]  [--<b>quiet</b>]  [--<b>ui</b>]

   <b>Flags:</b>
       <b>-t</b>
           Time-series output

       <b>-s</b>
           Generate random seed
           Automatically generates random seed for random number generator (use when you don’t want  to  provide
           the seed option)

       <b>--overwrite</b>
           Allow output files to overwrite existing files

       <b>--help</b>
           Print usage summary

       <b>--verbose</b>
           Verbose module output

       <b>--quiet</b>
           Quiet module output

       <b>--ui</b>
           Force launching GUI dialog

   <b>Parameters:</b>
       <b>elevation</b>=<u>name</u> <b>[required]</b>
           Name of input elevation raster map

       <b>dx</b>=<u>name</u> <b>[required]</b>
           Name of x-derivatives raster map [m/m]

       <b>dy</b>=<u>name</u> <b>[required]</b>
           Name of y-derivatives raster map [m/m]

       <b>rain</b>=<u>name</u>
           Name of rainfall excess rate (rain-infilt) raster map [mm/hr]

       <b>rain_value</b>=<u>float</u>
           Rainfall excess rate unique value [mm/hr]
           Default: <u>50</u>

       <b>infil</b>=<u>name</u>
           Name of runoff infiltration rate raster map [mm/hr]

       <b>infil_value</b>=<u>float</u>
           Runoff infiltration rate unique value [mm/hr]
           Default: <u>0.0</u>

       <b>man</b>=<u>name</u>
           Name of Manning’s n raster map

       <b>man_value</b>=<u>float</u>
           Manning’s n unique value
           Default: <u>0.1</u>

       <b>flow_control</b>=<u>name</u>
           Name of flow controls raster map (permeability ratio 0-1)

       <b>observation</b>=<u>name</u>
           Name of sampling locations vector points map
           Or data source for direct OGR access

       <b>depth</b>=<u>name</u>
           Name for output water depth raster map [m]

       <b>discharge</b>=<u>name</u>
           Name for output water discharge raster map [m3/s]

       <b>error</b>=<u>name</u>
           Name for output simulation error raster map [m]

       <b>walkers_output</b>=<u>name</u>
           Base name of the output walkers vector points map
           Name for output vector map

       <b>logfile</b>=<u>name</u>
           Name for sampling points output text file. For each observation vector point the time series of water
           discharge is stored.

       <b>nwalkers</b>=<u>integer</u>
           Number of walkers, default is twice the number of cells

       <b>niterations</b>=<u>integer</u>
           Time used for iterations [minutes]
           Default: <u>10</u>

       <b>mintimestep</b>=<u>float</u>
           Minimum time step for the simulation [seconds]
           A larger minimum time step substantially reduces processing time, but at the cost of accuracy
           Default: <u>0.0</u>

       <b>output_step</b>=<u>integer</u>
           Time interval for creating output maps [minutes]
           Default: <u>2</u>

       <b>diffusion_coeff</b>=<u>float</u>
           Water diffusion constant
           Default: <u>0.8</u>

       <b>hmax</b>=<u>float</u>
           Threshold water depth [m]
           Diffusion increases after this water depth is reached
           Default: <u>0.3</u>

       <b>halpha</b>=<u>float</u>
           Diffusion increase constant
           Default: <u>4.0</u>

       <b>hbeta</b>=<u>float</u>
           Weighting factor for water flow velocity vector
           Default: <u>0.5</u>

       <b>random_seed</b>=<u>integer</u>
           Seed for random number generator
           The same seed can be used to obtain same results or random seed can be generated by other means.

       <b>nprocs</b>=<u>integer</u>
           Number of threads which will be used for parallel computation.
           Default: <u>1</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>r.sim.water</u>  is  a  landscape  scale  simulation  model  of overland flow designed for spatially variable
       terrain, soil, cover and rainfall excess conditions.  A  2D  shallow  water  flow  is  described  by  the
       bivariate  form  of  Saint  Venant  equations.  The numerical solution is based on the concept of duality
       between the field and particle representation of the  modeled  quantity.  Green’s  function  Monte  Carlo
       method,  used  to solve the equation, provides robustness necessary for spatially variable conditions and
       high resolutions (Mitas and Mitasova 1998). The key inputs of  the  model  include  elevation  (<b>elevation</b>
       raster  map), flow gradient vector given by first-order partial derivatives of elevation field (<b>dx</b> and <b>dy</b>
       raster maps), rainfall excess rate (<b>rain</b> raster map or <b>rain_value</b> single value) and a  surface  roughness
       coefficient  given  by Manning’s n (<b>man</b> raster map or <b>man_value</b> single value). Partial derivatives raster
       maps can be computed along with interpolation of a DEM using the  -d  option  in  <u>v.surf.rst</u>  module.  If
       elevation  raster  map  is  already  provided,  partial  derivatives can be computed using <u>r.slope.aspect</u>
       module. Partial derivatives are used to determine the direction and magnitude of water flow velocity.  To
       include  a  predefined  direction  of  flow,  map  algebra can be used to replace terrain-derived partial
       derivatives with pre-defined partial derivatives in  selected  grid  cells  such  as  man-made  channels,
       ditches  or  culverts. Equations (2) and (3) from this report can be used to compute partial derivates of
       the predefined flow using its direction given by aspect and slope.

       The equations are
       dx = tan(slope) * cos(aspect)
       and
       dy = tan(slope) * sin(aspect)

        <u>Figure:</u> <u>Simulated</u> <u>water</u> <u>flow</u> <u>in</u> <u>a</u> <u>rural</u> <u>area</u> <u>showing</u> <u>the</u> <u>areas</u> <u>with</u>  <u>highest</u>  <u>water</u>  <u>depth</u>  <u>highlighting</u>
       <u>streams,</u> <u>pooling,</u> <u>and</u> <u>wet</u> <u>areas</u> <u>during</u> <u>a</u> <u>rainfall</u> <u>event.</u>

       The   module   automatically   converts   horizontal   distances   from   feet  to  metric  system  using
       database/projection information. Rainfall excess is defined as rainfall intensity - infiltration rate and
       should be provided in [mm/hr].  Rainfall intensities are usually available from meteorological  stations.
       Infiltration  rate depends on soil properties and land cover. It varies in space and time.  For saturated
       soil and steady-state water flow it can be estimated using saturated hydraulic conductivity  rates  based
       on  field  measurements or using reference values which can be found in literature.  Optionally, user can
       provide an overland flow infiltration rate map <b>infil</b> or  a  single  value  <b>infil_value</b>  in  [mm/hr]  that
       control  the  rate of infiltration for the already flowing water, effectively reducing the flow depth and
       discharge.  Overland flow can  be  further  controlled  by  permeable  check  dams  or  similar  type  of
       structures,  the  user  can  provide  a  map  of these structures and their permeability ratio in the map
       <b>flow_control</b> that defines the probability of particles to pass through the structure (the values will  be
       0-1).

       Output  includes  a  water  depth  raster map <b>depth</b> in [m], and a water discharge raster map <b>discharge</b> in
       [m3/s]. Error of the numerical solution can be analyzed using the <b>error</b> raster map (the  resulting  water
       depth  is  an  average, and err is its RMSE).  The output vector points map <b>output_walkers</b> can be used to
       analyze and visualize spatial distribution of walkers  at  different  simulation  times  (note  that  the
       resulting  water  depth is based on the density of these walkers).  The spatial distribution of numerical
       error associated with path sampling solution can be analysed using the output error raster file [m]. This
       error is a function of the number of particles used in the simulation and can be  reduced  by  increasing
       the  number  of  walkers  given  by  parameter  <b>nwalkers</b>.   Duration  of  simulation is controlled by the
       <b>niterations</b> parameter. The default value is 10 minutes, reaching the steady-state may require much longer
       time, depending on the time step, complexity of terrain, land cover and size of the area.  Output walker,
       water depth and discharge maps can be  saved  during  simulation  using  the  time  series  flag  <b>-t</b>  and
       <b>output_step</b> parameter defining the time step in minutes for writing output files.  Files are saved with a
       suffix  representing  time  since  the  start  of  simulation  in  minutes  (e.g.  wdepth.05, wdepth.10).
       Monitoring of water depth at specific points is supported. A vector map with  observation  points  and  a
       path  to  a  logfile  must  be  provided.  For  each  point  in  the  vector  map which is located in the
       computational region the water depth is logged each time step in the logfile. The logfile is organized as
       a table. A single header identifies the category number of the logged vector points.  In case of  invalid
       water depth data the value -1 is used.

       Overland  flow  is  routed  based  on  partial derivatives of elevation field or other landscape features
       influencing water flow. Simulation equations include a diffusion term (<b>diffusion_coeff</b>  parameter)  which
       enables  water  flow  to overcome elevation depressions or obstacles when water depth exceeds a threshold
       water depth value (<b>hmax)</b>, given in [m]. When it is reached, diffusion term increases as given  by  <b>halpha</b>
       and  advection term (direction of flow) is given as "prevailing" direction of flow computed as average of
       flow directions from the previous <b>hbeta</b> number of grid cells.  The model tries to  keep  water  "shallow"
       with  maximum  shallow  water depth defined by <b>hmax</b> default 0.3 meters. However, water depths much higher
       than <b>hmax</b> can be observed if water accumulates in natural sinks or river beds. Depending on the  area  of
       interest  and the used digital elevation model, <b>hmax</b>, <b>halpha</b> and <b>hbeta</b> might need to be adjusted in order
       to deal realistically with elevation depressions or obstacles.

</pre><h4><b>NOTES</b></h4><pre>
       A 2D shallow water flow is described by the bivariate form of Saint Venant  equations  (e.g.,  Julien  et
       al.,  1995). The continuity of water flow relation is coupled with the momentum conservation equation and
       for a shallow water overland flow, the hydraulic radius is approximated by the  normal  flow  depth.  The
       system  of  equations is closed using the Manning’s relation. Model assumes that the flow is close to the
       kinematic wave approximation, but we include a diffusion-like term to incorporate the impact of diffusive
       wave effects. Such an incorporation of diffusion in the water flow simulation is not new  and  a  similar
       term  has  been  obtained  in  derivations  of  diffusion-advection equations for overland flow, e.g., by
       Lettenmeier and Wood, (1992). In our reformulation, we simplify the diffusion coefficient to  a  constant
       and  we  use  a  modified  diffusion  term.   The  diffusion  constant which we have used is rather small
       (approximately one order of magnitude smaller than the reciprocal Manning’s  coefficient)  and  therefore
       the  resulting  flow is close to the kinematic regime. However, the diffusion term improves the kinematic
       solution, by overcoming small shallow pits common in digital elevation models (DEM) and by smoothing  out
       the  flow  over slope discontinuities or abrupt changes in Manning’s coefficient (e.g., due to a road, or
       other anthropogenic changes in elevations or cover).

       <b>Green’s</b> <b>function</b> <b>stochastic</b> <b>method</b> <b>of</b> <b>solution.</b>
       The Saint Venant equations are solved by a stochastic method called Monte Carlo (very  similar  to  Monte
       Carlo  methods  in  computational  fluid  dynamics  or  to quantum Monte Carlo approaches for solving the
       Schrodinger equation (Schmidt and Ceperley, 1992, Hammond et al., 1994; Mitas, 1996)). It is assumed that
       these equations are a  representation  of  stochastic  processes  with  diffusion  and  drift  components
       (Fokker-Planck equations).

       The Monte Carlo technique has several unique advantages which are becoming even more important due to new
       developments  in  computer  technology.   Perhaps  one  of the most significant Monte Carlo properties is
       robustness which enables us to solve the equations for complex cases,  such  as  discontinuities  in  the
       coefficients  of  differential  operators  (in our case, abrupt slope or cover changes, etc). Also, rough
       solutions can be estimated rather quickly, which allows us to carry out preliminary quantitative  studies
       or  to  rapidly  extract  qualitative  trends by parameter scans. In addition, the stochastic methods are
       tailored to the new generation of computers as they provide scalability  from  a  single  workstation  to
       large  parallel  machines  due  to the independence of sampling points. Therefore, the methods are useful
       both for everyday exploratory work using a desktop computer  and  for  large,  cutting-edge  applications
       using high performance computing.

       <b>Suggested</b> <b>Manning’s</b> <b>n</b> <b>for</b> <b>surface</b> <b>roughness</b>
       from https://baharmon.github.io/hydrology-in-grass

       NLCD Landcover Category                                      Manning’s n value

       Open Water                                                   0.001

       Developed, Open Space                                        0.0404

       Developed, Low Intensity                                     0.0678

       Developed, Medium Intensity                                  0.0678

       Developed, High Intensity                                    0.0404

       Barren Land                                                  0.0113

       Deciduous Forest                                             0.36

       Evergreen Forest                                             0.32

       Mixed Forest                                                 0.4

       Shrub/Scrub                                                  0.4

       Grassland/Herbaceuous                                        0.368

       Pasture/Hay                                                  0.325

       Cultivated Crops                                             0.325

       Woody Wetlands                                               0.086

       Emergent Herbaceuous Wetlands                                0.1825

       The NLCD user guide provides more information about the different NLCD classes.

       Increasing the number of threads with <b>nprocs</b> does not really speed up the simulation.

</pre><h4><b>EXAMPLE</b></h4><pre>
       Using the North Carolina full sample dataset:
       # set computational region
       g.region raster=elev_lid792_1m -p
       # compute dx, dy
       r.slope.aspect elevation=elev_lid792_1m dx=elev_lid792_dx dy=elev_lid792_dy
       # simulate (this may take a minute or two)
       r.sim.water elevation=elev_lid792_1m dx=elev_lid792_dx dy=elev_lid792_dy depth=water_depth disch=water_discharge nwalk=10000 rain_value=100 niter=5
       Now,  let’s  visualize the result using rendering to a file (note the further management of computational
       region and usage of d.mon module which are not needed when working in GUI):
       # increase the computational region by 350 meters
       g.region e=e+350
       # initiate the rendering
       d.mon start=cairo output=r_sim_water_water_depth.png
       # render raster, legend, etc.
       d.rast map=water_depth_1m
       d.legend raster=water_depth_1m title="Water depth [m]" label_step=0.10 font=sans at=20,80,70,75
       d.barscale at=67,10 length=250 segment=5 font=sans
       d.northarrow at=90,25
       # finish the rendering
       d.mon stop=cairo

        <u>Figure:</u> <u>Simulated</u> <u>water</u> <u>depth</u> <u>map</u> <u>in</u> <u>the</u> <u>rural</u> <u>area</u> <u>of</u> <u>the</u> <u>North</u> <u>Carolina</u> <u>sample</u> <u>dataset.</u>

</pre><h4><b>ERROR</b> <b>MESSAGES</b></h4><pre>
       If the module fails with
       ERROR: nwalk (7000001) &gt; maxw (7000000)!
       then a lower <b>nwalkers</b> parameter value has to be selected.

</pre><h4><b>REFERENCES</b></h4><pre>
           •   Mitasova, H., Thaxton, C., Hofierka, J., McLaughlin, R., Moore, A., Mitas L., 2004, Path sampling
               method for modeling overland water flow, sediment transport and short term terrain  evolution  in
               Open Source GIS.  In: C.T. Miller, M.W. Farthing, V.G. Gray, G.F. Pinder eds., Proceedings of the
               XVth  International  Conference on Computational Methods in Water Resources (CMWR XV), June 13-17
               2004, Chapel Hill, NC, USA, Elsevier, pp. 1479-1490.

           •   Mitasova H, Mitas, L., 2000,  Modeling  spatial  processes  in  multiscale  framework:  exploring
               duality between particles and fields, plenary talk at GIScience2000 conference, Savannah, GA.

           •   Mitas,  L.,  and  Mitasova,  H.,  1998, Distributed soil erosion simulation for effective erosion
               prevention. Water Resources Research, <a href="../man3/34.3.html">34</a>(3), 505-516.

           •   Mitasova, H., Mitas, L., 2001, Multiscale soil erosion simulations for land use  management,  In:
               Landscape  erosion  and  landscape  evolution  modeling,  Harmon  R.  and  Doe  W.  eds.,  Kluwer
               Academic/Plenum Publishers, pp. 321-347.

           •   Hofierka, J, Mitasova, H., Mitas, L., 2002. GRASS and modeling landscape processes using  duality
               between  particles and fields. Proceedings of the Open source GIS - GRASS users conference 2002 -
               Trento, Italy, 11-13 September 2002.  PDF

           •   Hofierka, J., Knutova, M., 2015, Simulating aspects of a flash flood using the Monte Carlo method
               and GRASS GIS: a case study of the Malá Svinka Basin  (Slovakia),  Open  Geosciences.  Volume  7,
               Issue 1, ISSN (Online) 2391-5447, DOI: 10.1515/geo-2015-0013, April 2015

           •   Neteler,  M.  and  Mitasova, H., 2008, Open Source GIS: A GRASS GIS Approach. Third Edition.  The
               International Series in Engineering and Computer Science: Volume 773. Springer New York  Inc,  p.
               406.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
        <u>v.surf.rst,</u> <u>r.slope.aspect,</u> <u>r.sim.sediment</u>

</pre><h4><b>AUTHORS</b></h4><pre>
       Helena Mitasova, Lubos Mitas
       North Carolina State University
       <u><a href="mailto:hmitaso@unity.ncsu.edu">hmitaso@unity.ncsu.edu</a></u>

       Jaroslav Hofierka
       GeoModel, s.r.o. Bratislava, Slovakia
       <u><a href="mailto:hofierka@geomodel.sk">hofierka@geomodel.sk</a></u>

       Chris Thaxton
       North Carolina State University
       <u><a href="mailto:csthaxto@unity.ncsu.edu">csthaxto@unity.ncsu.edu</a></u>

</pre><h4><b>SOURCE</b> <b>CODE</b></h4><pre>
       Available at: r.sim.water source code (history)

       Accessed: Friday Apr 04 01:19:34 2025

       Main index | Raster index | Topics index | Keywords index | Graphical index | Full index

       © 2003-2025 GRASS Development Team, GRASS GIS 8.4.1 Reference Manual

GRASS 8.4.1                                                                                  <u><a href="../man1grass/r.sim.water.1grass.html">r.sim.water</a></u>(1grass)
</pre>
 </div>
</div></section>
</div>
</body>
</html>