<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>virt-win-reg - Export and merge Windows Registry entries from a Windows guest</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/guestfs-tools">guestfs-tools_1.52.2-4ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       virt-win-reg - Export and merge Windows Registry entries from a Windows guest

</pre><h4><b>SYNOPSIS</b></h4><pre>
        virt-win-reg domname 'HKLM\Path\To\Subkey'

        virt-win-reg domname 'HKLM\Path\To\Subkey' name

        virt-win-reg domname 'HKLM\Path\To\Subkey' @

        virt-win-reg --merge domname [input.reg ...]

        virt-win-reg [--options] disk.img ... # instead of domname

</pre><h4><b>WARNING</b></h4><pre>
       You must <u>not</u> use "virt-win-reg" with the <u>--merge</u> option on live virtual machines.  If you do this, you
       <u>will</u> get irreversible disk corruption in the VM.  "virt-win-reg" tries to stop you from doing this, but
       doesn't catch all cases.

       Modifying the Windows Registry is an inherently risky operation.  The format is deliberately obscure and
       undocumented, and Registry changes can leave the system unbootable.  Therefore when using the <u>--merge</u>
       option, make sure you have a reliable backup first.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This program can export and merge Windows Registry entries from a Windows guest.

       The first parameter is the libvirt guest name or the raw disk image of a Windows guest.

       If <u>--merge</u> is <u>not</u> specified, then the chosen registry key is displayed/exported (recursively).  For
       example:

        $ virt-win-reg Windows7 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft'

       You can also display single values from within registry keys, for example:

        $ cvkey='HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion'
        $ virt-win-reg Windows7 $cvkey ProductName
        Windows 7 Enterprise

       With <u>--merge</u>, you can merge a textual regedit file into the Windows Registry:

        $ virt-win-reg --merge Windows7 changes.reg

   <b>NOTE</b>
       This program is only meant for simple access to the registry.  If you want to do complicated things with
       the registry, we suggest you download the Registry hive files from the guest using <b><a href="../man3/libguestfs.3.html">libguestfs</a></b>(3) or
       <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) and access them locally, eg. using <b><a href="../man3/hivex.3.html">hivex</a></b>(3), <b><a href="../man1/hivexsh.1.html">hivexsh</a></b>(1) or <b><a href="../man1/hivexregedit.1.html">hivexregedit</a></b>(1).

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--help</b>
           Display brief help.

       <b>--version</b>
           Display version number and exit.

       <b>--debug</b>
           Enable debugging messages.

       <b>-c</b> <b>URI</b>
       <b>--connect</b> <b>URI</b>
           If  using  libvirt,  connect  to  the  given <u>URI</u>.  If omitted, then we connect to the default libvirt
           hypervisor.

           If you specify guest block devices directly, then libvirt is not used at all.

       <b>--format</b> raw
           Specify the format of disk images given on the command line.  If this is omitted then the  format  is
           autodetected from the content of the disk image.

           If  disk  images are requested from libvirt, then this program asks libvirt for this information.  In
           this case, the value of the format parameter is ignored.

           If working with untrusted raw-format guest disk images,  you  should  ensure  the  format  is  always
           specified.

       <b>--merge</b>
           In  merge  mode, this merges a textual regedit file into the Windows Registry of the virtual machine.
           If this flag is <u>not</u> given then virt-win-reg displays or exports Registry entries instead.

           Note that <u>--merge</u> is <u>unsafe</u> to use on live virtual machines, and  will  result  in  disk  corruption.
           However exporting (without this flag) is always safe.

       <b>--encoding</b> UTF-16LE|ASCII
           When  merging  (only),  you may need to specify the encoding for strings to be used in the hive file.
           This is explained in detail in "ENCODING STRINGS" in <b>Win::Hivex::<a href="../man3/Regedit.3.html">Regedit</a></b>(3).

           The default is to use UTF-16LE, which should work with recent versions of Windows.

       <b>--unsafe-printable-strings</b>
           When exporting (only), assume strings  are  UTF-16LE  and  print  them  as  strings  instead  of  hex
           sequences.  Remove the final zero codepoint from strings if present.

           This  is  unsafe  and  does not preserve the fidelity of strings in the original Registry for various
           reasons:

           •   Assumes the original encoding is UTF-16LE.  ASCII strings and strings in other encodings will  be
               corrupted by this transformation.

           •   Assumes  that everything which has type 1 or 2 is really a string and that everything else is not
               a string, but the type field in real Registries is not reliable.

           •   Loses information about whether a zero codepoint followed the string in the Registry or not.

           This all happens because the Registry itself contains no information about how  strings  are  encoded
           (see "ENCODING STRINGS" in <b>Win::Hivex::<a href="../man3/Regedit.3.html">Regedit</a></b>(3)).

           You  should  only use this option for quick hacking and debugging of the Registry contents, and <u>never</u>
           use it if the output is going to be passed into another program or stored in another Registry.

</pre><h4><b>SUPPORTED</b> <b>SYSTEMS</b></h4><pre>
       The program currently supports Windows NT-derived guests starting with Windows XP  through  to  at  least
       Windows 8.

       The following Registry keys are supported:

       "HKEY_LOCAL_MACHINE\SAM"
       "HKEY_LOCAL_MACHINE\SECURITY"
       "HKEY_LOCAL_MACHINE\SOFTWARE"
       "HKEY_LOCAL_MACHINE\SYSTEM"
       "HKEY_USERS\.DEFAULT"
       "HKEY_USERS\<u>SID</u>"
           where <u>SID</u> is a Windows User SID (eg. "S-1-5-18").

       "HKEY_USERS\<u>username</u>"
           where <u>username</u> is a local user name (this is a libguestfs extension).

       You can use "HKLM" as a shorthand for "HKEY_LOCAL_MACHINE", and "HKU" for "HKEY_USERS".

       The  literal  keys  "HKEY_USERS\$SID"  and  "HKEY_CURRENT_USER"  are  not supported (there is no "current
       user").

   <b>WINDOWS</b> <b>8</b>
       Windows 8 "fast startup" can prevent virt-win-reg from being able to edit  the  Registry.   See  "WINDOWS
       HIBERNATION AND WINDOWS 8 FAST STARTUP" in <b><a href="../man3/guestfs.3.html">guestfs</a></b>(3).

</pre><h4><b>ENCODING</b></h4><pre>
       "virt-win-reg"  expects that regedit files have already been reencoded in the local encoding.  Usually on
       Linux hosts, this means UTF-8 with Unix-style line endings.  Since Windows regedit  files  are  often  in
       UTF-16LE  with  Windows-style  line  endings,  you  may  need  to reencode the whole file before or after
       processing.

       To reencode a file from Windows format to Linux (before processing it with the <u>--merge</u> option), you would
       do something like this:

        iconv -f utf-16le -t utf-8 &lt; win.reg | dos2unix &gt; linux.reg

       To go in the opposite direction, after exporting and before sending  the  file  to  a  Windows  user,  do
       something like this:

        unix2dos linux.reg | iconv -f utf-8 -t utf-16le &gt; win.reg

       For more information about encoding, see <b>Win::Hivex::<a href="../man3/Regedit.3.html">Regedit</a></b>(3).

       If  you  are  unsure  about  the  current  encoding, use the <b><a href="../man1/file.1.html">file</a></b>(1) command.  Recent versions of Windows
       regedit.exe produce a UTF-16LE file with Windows-style (CRLF) line endings, like this:

        $ file software.reg
        software.reg: Little-endian UTF-16 Unicode text, with very long lines,
        with CRLF line terminators

       This file would need conversion before you could <u>--merge</u> it.

</pre><h4><b>CurrentControlSet</b> <b>etc.</b></h4><pre>
       Registry keys like "CurrentControlSet" don’t really exist in the Windows Registry at  the  level  of  the
       hive file, and therefore you cannot modify these.

       "CurrentControlSet"  is  usually  an  alias for "ControlSet001".  In some circumstances it might refer to
       another control set.  The way to find out is to look at the "HKLM\SYSTEM\Select" key:

        # virt-win-reg WindowsGuest 'HKLM\SYSTEM\Select'
        [HKEY_LOCAL_MACHINE\SYSTEM\Select]
        "Current"=dword:00000001
        "Default"=dword:00000001
        "Failed"=dword:00000000
        "LastKnownGood"=dword:00000002

       "Current" is the one which Windows will choose when it boots.

       Similarly, other "Current..." keys in the path may need to be replaced.

</pre><h4><b>DELETING</b> <b>REGISTRY</b> <b>KEYS</b> <b>AND</b> <b>VALUES</b></h4><pre>
       To delete a whole registry key, use the syntax:

        [-HKEY_LOCAL_MACHINE\Foo]

       To delete a single value within a key, use the syntax:

        [HKEY_LOCAL_MACHINE\Foo]
        "Value"=-

</pre><h4><b>WINDOWS</b> <b>TIPS</b></h4><pre>
       Note that some of these tips modify the guest disk image.  The guest <u>must</u> be shut off, else you will  get
       disk corruption.

   <b>RUNNING</b> <b>A</b> <b>BATCH</b> <b>SCRIPT</b> <b>WHEN</b> <b>A</b> <b>USER</b> <b>LOGS</b> <b>IN</b>
       Prepare  a  DOS  batch script, VBScript or executable.  Upload this using <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1).  For this example
       the script is called "test.bat" and it is uploaded into "C:\":

        guestfish -i -d WindowsGuest upload test.bat /test.bat

       Prepare a regedit file containing the registry change:

        cat &gt; test.reg &lt;&lt;'EOF'
        [HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce]
        "Test"="c:\\test.bat"
        EOF

       In this example we use the key "RunOnce" which means that the script will run  precisely  once  when  the
       first user logs in.  If you want it to run every time a user logs in, replace "RunOnce" with "Run".

       Now update the registry:

        virt-win-reg --merge WindowsGuest test.reg

   <b>INSTALLING</b> <b>A</b> <b>SERVICE</b>
       This  section assumes you are familiar with Windows services, and you either have a program which handles
       the Windows Service Control Protocol directly or you want to run any program using a service wrapper like
       SrvAny or the free RHSrvAny.

       First upload the program and optionally the service wrapper.  In this case the  test  program  is  called
       "test.exe" and we are using the RHSrvAny wrapper:

        guestfish -i -d WindowsGuest &lt;&lt;EOF
          upload rhsrvany.exe /rhsrvany.exe
          upload test.exe /test.exe
        EOF

       Prepare  a  regedit  file containing the registry changes.  In this example, the first registry change is
       needed for the service itself or the service wrapper (if used).   The  second  registry  change  is  only
       needed because I am using the RHSrvAny service wrapper.

        cat &gt; service.reg &lt;&lt;'EOF'
        [HKLM\SYSTEM\ControlSet001\services\RHSrvAny]
        "Type"=dword:00000010
        "Start"=dword:00000002
        "ErrorControl"=dword:00000001
        "ImagePath"="c:\\rhsrvany.exe"
        "DisplayName"="RHSrvAny"
        "ObjectName"="NetworkService"

        [HKLM\SYSTEM\ControlSet001\services\RHSrvAny\Parameters]
        "CommandLine"="c:\\test.exe"
        "PWD"="c:\\Temp"
        EOF

       Notes:

       •   For  use  of  "ControlSet001" see the section above in this manual page.  You may need to adjust this
           according to the control set that is in use by the guest.

       •   "ObjectName"  controls  the  privileges  that   the   service   will   have.    An   alternative   is
           "ObjectName"="LocalSystem" which would be the most privileged account.

       •   For    the    meaning    of    the    magic    numbers,    see    this    Microsoft    KB    article:
           <a href="http://support.microsoft.com/kb/103000">http://support.microsoft.com/kb/103000</a>.

       Update the registry:

        virt-win-reg --merge WindowsGuest service.reg

</pre><h4><b>SHELL</b> <b>QUOTING</b></h4><pre>
       Be careful when passing parameters containing "\" (backslash) in the shell.  Usually you will have to use
       'single quotes' or double backslashes (but not both) to protect them from the shell.

       Paths and value names are case-insensitive.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/hivex.3.html">hivex</a></b>(3),   <b><a href="../man1/hivexsh.1.html">hivexsh</a></b>(1),   <b><a href="../man1/hivexregedit.1.html">hivexregedit</a></b>(1),   <b><a href="../man3/guestfs.3.html">guestfs</a></b>(3),   <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1),    <b><a href="../man1/virt-cat.1.html">virt-cat</a></b>(1),    <b><a href="../man1/virt-tail.1.html">virt-tail</a></b>(1),
       <b>Sys::<a href="../man3/Guestfs.3.html">Guestfs</a></b>(3), <b>Win::<a href="../man3/Hivex.3.html">Hivex</a></b>(3), <b>Win::Hivex::<a href="../man3/Regedit.3.html">Regedit</a></b>(3), <b>Sys::<a href="../man3/Virt.3.html">Virt</a></b>(3), <a href="http://libguestfs.org/">http://libguestfs.org/</a>.

</pre><h4><b>AUTHOR</b></h4><pre>
       Richard W.M. Jones <a href="http://people.redhat.com/~rjones/">http://people.redhat.com/~rjones/</a>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright (C) 2010 Red Hat Inc.

</pre><h4><b>LICENSE</b></h4><pre>
       This  program  is  free  software;  you  can  redistribute it and/or modify it under the terms of the GNU
       General Public License as published by the Free Software Foundation; either version 2 of the License,  or
       (at your option) any later version.

       This  program  is  distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even
       the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General  Public
       License for more details.

       You  should have received a copy of the GNU General Public License along with this program; if not, write
       to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

</pre><h4><b>BUGS</b></h4><pre>
       To     get      a      list      of      bugs      against      libguestfs,      use      this      link:
       https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools

       To       report       a       new       bug       against       libguestfs,      use      this      link:
       https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools

       When reporting a bug, please supply:

       •   The version of libguestfs.

       •   Where you got libguestfs (eg. which Linux distro, compiled from source, etc)

       •   Describe the bug accurately and give a way to reproduce it.

       •   Run <b><a href="../man1/libguestfs-test-tool.1.html">libguestfs-test-tool</a></b>(1) and paste the <b>complete,</b> <b>unedited</b> output into the bug report.

guestfs-tools-1.52.2                               2025-02-04                                    <u><a href="../man1/virt-win-reg.1.html">virt-win-reg</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>