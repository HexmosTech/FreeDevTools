<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ssh_filter_btrbk - ssh command filter script for btrbk</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/btrbk">btrbk_0.32.5-1.1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ssh_filter_btrbk - ssh command filter script for btrbk

</pre><h4><b>SYNOPSIS</b></h4><pre>
       ssh_filter_btrbk.sh [-s|--source] [-t|--target] [-d|--delete]
           [-i|--info] [--snapshot] [--send] [--receive]
           [-p|--restrict-path &lt;path&gt;] [-l|--log] [--sudo]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>ssh_filter_btrbk.sh</b> restricts SSH commands to commands used by <u>btrbk</u>. It examines the
       SSH_ORIGINAL_COMMAND environment variable (set by sshd) and executes it only if it contains commands used
       by <u>btrbk</u>.

       The accepted commands are specified by the "--source", "--target", "--delete" and "--info" options.

       The following commands are always allowed:

       •   "btrfs subvolume show" (not affected by "--restrict-path")

       •   "btrfs subvolume list" (not affected by "--restrict-path")

       •   "readlink"

       •   "test -d" (only if "compat busybox" configuration option is set)

       •   "cat <a href="file:/proc/self/mountinfo">/proc/self/mountinfo</a>"

       •   pipes through "gzip", "pigz", "bzip2", "pbzip2", "xz", "lzop", "lz4", "zstd" (stream_compress)

       •   pipes through "mbuffer" (stream_buffer, rate_limit)

       Example line in /root/.ssh/authorized_keys on a backup target host:

           command="ssh_filter_btrbk.sh --target --delete --restrict-path /mnt/btr_backup" ssh-rsa AAAAB3NzaC1...hwumXFRQBL <a href="mailto:btrbk@mydomain.com">btrbk@mydomain.com</a>

</pre><h4><b>OPTIONS</b></h4><pre>
       -s, --source
           Allow commands for backup source: "btrfs subvolume snapshot", "btrfs send". Equivalent to "--snapshot
           --send".

       -t, --target
           Allow commands for backup and archive target: "btrfs receive", "mkdir".

       -d, --delete
           Allow commands for subvolume deletion: "btrfs subvolume delete". This is used for backup source if
           <u>snapshot_preserve_daily</u> is not set to “all”, and for backup targets if <u>target_preserve_daily</u> is not
           set to “all”.

       -i, --info
           Allow informative commands: "btrfs subvolume find-new", "btrfs filesystem usage". This is used by
           btrbk <u>info</u> and <u>diff</u> commands.

       --snapshot
           Allow btrfs snapshot command: "btrfs subvolume snapshot".

       --send
           Allow btrfs send command: "btrfs send".

       --receive
           Allow btrfs receive command: "btrfs receive".

       -p, --restrict-path &lt;path&gt;
           Restrict commands to &lt;path&gt;. Note that "btrfs subvolume show", "btrfs subvolume list" are NOT
           affected by this option.

       -l, --log
           Log ACCEPT and REJECT messages to the system log.

       --sudo
           Allow btrfs commands to be called via sudo. Enable this if you have "backend btrfs-progs-sudo" in
           your btrbk configuration file.

</pre><h4><b>AVAILABILITY</b></h4><pre>
       Please refer to the btrbk project page https://digint.ch/btrbk/ for further details.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/btrbk.1.html">btrbk</a></b>(1), <b><a href="../man5/btrbk.conf.5.html">btrbk.conf</a></b>(5), <b><a href="../man8/btrfs.8.html">btrfs</a></b>(8)

</pre><h4><b>AUTHOR</b></h4><pre>
       Axel Burri <a href="mailto:axel@tty0.ch">axel@tty0.ch</a>

Btrbk 0.32.5                                       2022-10-23                                <u><a href="../man1/SSH_FILTER_BTRBK.1.html">SSH_FILTER_BTRBK</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>