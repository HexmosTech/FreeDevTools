<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pg_buildext - Build and install a PostgreSQL extension</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/postgresql-common">postgresql-common_274_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pg_buildext - Build and install a PostgreSQL extension

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pg_buildext</b> [<u>options</u>] <u>action</u> [<u>src-dir</u>] [<u>arguments</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pg_buildext</b> is a script that will build a PostgreSQL extension in a VPATH way, for potentially several
       PostgreSQL server versions in parallel.  It builds for the intersection of versions known in
       debian/pgversions (versions supported by the package) and in
       /usr/share/postgresql-common/supported-versions (versions supported in this release).

       Many PostgreSQL extension packages require no special handling at build time and can use <b>dh</b> <b>$@</b> <b>--with</b>
       <b>pgxs</b> or <b>dh</b> <b>$@</b> <b>--with</b> <b>pgxs_loop</b> to automatically execute the steps outlined below.

</pre><h4><b>USAGE</b></h4><pre>
       Packages using <b>pg_buildext</b> should be prepared to build binaries for PostgreSQL versions that are not
       present in Debian unstable, e.g. for older releases when building backports for Debian (old)stable
       (possibly including backports of newer PostgreSQL releases), or for all PostgreSQL releases when the
       package is built for <b>apt.postgresql.org</b>.

       As the set of binary packages depends on the target PostgreSQL versions, debian/control is generated from
       a template in debian/control.in when <b>pg_buildext</b> <b>updatecontrol</b> is run.  Package sections that contain
       <b>PGVERSION</b> in the package name are replaced by a list of sections, filling in the supported PostgreSQL
       versions.  Package sections that contain <b>PGVERSION</b> outside the package name have the newest supported
       PostgreSQL version filled in (useful for meta packages); words containing <b>PGVERSIONS</b> be replaced by a
       list of words with the supported versions filled in, this is most useful in <b>Build-Depends</b>.  Include
       /usr/share/postgresql-common/pgxs_debian_control.mk in debian/rules to run a check at build time if
       updating debian/control is required.

       As <b>pg_buildext</b> invokes <b>make</b> for the <b>build</b>, <b>install</b>, and <b>clean</b> actions, invocations from debian/rules
       (which is a makefile) should be prefixed with <b>+</b> so the sub-makes can talk with the make jobserver.
       Additional makefile variables can be passed to <b>make</b> via the <b>-m</b> option.

       Many extensions support <b>make</b> <b>installcheck</b> testing using <b>pg_regress</b>. As this needs the package to be
       installed, it cannot be run at build time.  Instead, the tests should be run using <b>autopkgtest</b> from
       debian/tests/*.

       If debian/tests/control.in exists, occurrences of package names containing <b>PGVERSION</b> are replaced by
       lists of package names with the target PostgreSQL versions filled in. (If no replacing is needed in
       debian/tests/control, it is fine to provide the tests control file directly.)

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-cio</b> <u>arg</u>
       <b>-s</b>  Passed to <b>pg_virtualenv</b> when running <b>installcheck</b>.

           These arguments can also be set via the <b>PG_VIRTUALENV_ARGS</b> environment variable.

       <b>-m</b> <u>arg</u>
           Passed to <b>make</b>.

</pre><h4><b>ACTIONS</b></h4><pre>
       Most  actions  expect a directory name where to build the sources. It will get created for you if it does
       not exist. If the <u>build-dir</u> contains a %v  sign,  it  will  get  replaced  by  the  specific  version  of
       PostgreSQL being built against. (Usually this parameter is build-%v.)

       <b>supported-versions</b>
           Print  effective  list of supported versions, i.e. the intersection of the sets of versions supported
           by  the  system  (from  /usr/share/postgresql-common/supported-versions)  and   the   package   (from
           debian/pgversions).

           Use this when building packages.

       <b>installed-versions</b>
           In  the  list  of installed packages, look for packages matching the <b>PGVERSION</b> package name templates
           from debian/control.in, and print the PostgreSQL major version number part.

           Use this when testing packages.

       <b>checkcontrol</b>
           Check  if  debian/control   needs   updating   from   debian/control.in.   This   is   invoked   from
           /usr/share/postgresql-common/pgxs_debian_control.mk.  When  building for a <b>backports</b> or <b>pgdg</b> suite as
           determined by debian/changelog, this action also updates the control file.  Otherwise,  <b>updatecontrol</b>
           needs to be run manually.

       <b>updatecontrol</b>
           Update  debian/control  from debian/control.in, and debian/tests/control from debian/tests/control.in
           if the latter exists.

       <b>configure</b> [<u>src-dir</u>] <u>build-dir</u> [<u>extra-configure-options</u>]
           For every supported version,  call  <b>../configure</b>  from  the  <u>build-dir</u>  directory.  (Most  PostgreSQL
           extensions do not have a configure script.)

       <b>build</b> [<u>src-dir</u>] <u>build-dir</u> [<u>extra-cflags</u>]
           Build the extension in the <u>build-dir</u> directory.

       <b>install</b> [<u>src-dir</u>] <u>build-dir</u> <u>package-pattern</u>
           Invoke  <b>make</b> <b>install</b> from the <u>build-dir</u> directory.  The third parameter specifies the package name to
           use.    Most    packages    use    <b>postgresql-%v-pkgname</b>.    Make     will     be     called     with
           DESTDIR="$(CURDIR)/debian/<u>package</u>".

           The  <b>dpkg</b> substitution variable <b>postgresql:Depends</b> is set to depend on the required PostgreSQL server
           package. For compatibility with previous  packaging  standards,  the  dependency  is  also  added  to
           <b>misc:Depends</b> if postgresql:Depends is not used.

       <b>clean</b> [<u>src-dir</u>] [<u>build-dir</u>] [<u>package-pattern</u>]
           Clean the build directories.

       <b>loop</b> [<u>src-dir</u>] <u>package-pattern</u>
           As  a  variant  to  calling  <b>build</b>  and  <b>install</b> separately for VPATH builds, loop over the supported
           PostgreSQL versions in the top source directory. This should be used if the package does not  support
           VPATH  builds.  As  it  also  invokes  <b>make</b> <b>install</b>, it should be placed were installation happens in
           debian/rules, rather than where build would normally be called.

       <b>installcheck</b> [<u>src-dir</u>] [<u>build-dir</u>] [<u>package-pattern</u>]
           Use <b>pg_virtualenv</b> <b>make</b> <b>installcheck</b> to run the extension regression tests.  This is meant to  be  run
           from  debian/tests/control  using  <b>autopkgtest</b>.  If <u>build-dir</u> is omitted, the top source directory is
           used.

           If <u>package-pattern</u> is given, options are passed to <b>pg_virtualenv</b> to set up the  temporary  PostgreSQL
           instance to find extension files in debian/package-directory/.

           Other than the other actions which run on the "supported" versions, if debian/control.in exists, this
           one  runs  on  the  "installed" versions as reported by <b>installed-versions</b> (unless <u>package-pattern</u> is
           provided, which means we are called during a build).

       <b>psql</b> [<u>src-dir</u>] [<u>build-dir</u>] [<u>package-pattern</u>]
       <b>virtualenv</b> [<u>src-dir</u>] [<u>build-dir</u>] [<u>package-pattern</u>]
           Like <b>installcheck</b>, but invokes <b>psql</b>, or a shell, both wrapped in <b>pg_virtualenv</b>. Input  is  read  from
           stdin.

       <b>run</b> [<u>src-dir</u>] <u>command</u>
       <b>run_installed</b> [<u>src-dir</u>] <u>command</u>
           Runs  <u>command</u>,  with  <b>%v</b>  placeholder  replaced on all supported versions, or all installed versions,
           respectively.

       Sometimes it is desirable to run extra code per version before invoking the action, in that case the loop
       over supported versions needs to be in the calling script. To facilitate this mode, actions can  also  be
       called as <u>action</u><b>-</b><u>version</u>. See the installcheck example below.

</pre><h4><b>SUPPORTED</b> <b>VERSIONS</b></h4><pre>
       <b>pg_buildext</b> reads debian/pgversions to decide which PostgreSQL to build modules/extensions for. This file
       contains one PostgreSQL version number per line, in the following formats:

       <b>all</b> Support all versions. This is recommended unless there are known incompatibilities.

       <u>NN</u>  Support this version.

       <u>NN</u><b>+</b> Support this and all greater versions.

       <b>#</b><u>...</u>
           Comment.

       For    a    version    to    be    used,    it    must    also    be    listed    in    the   output   of
       /usr/share/postgresql-common/supported-versions. See this file for how to configure the list of supported
       versions on your system.

</pre><h4><b>EXAMPLE</b></h4><pre>
       <b>debian/control.in:</b>
             Source: postgresql-foobar
             Rules-Requires-Root: no
             Build-Depends:
              architecture-is-64-bit &lt;!pkg.postgresql.32-bit&gt;,
              debhelper-compat (= 13),
              postgresql-all &lt;!nocheck&gt;,
              postgresql-server-dev-all (&gt;= 217~),

             Package: postgresql-PGVERSION-foobar
             Architecture: any
             Depends:
              ${misc:Depends},
              ${postgresql:Depends},
              ${shlibs:Depends},

       <b>debian/pgversions:</b>
             all

             # alternatives:
             #9.6
             #11+

       <b>debian/rules</b> using <b>dh</b> <b>$@</b> <b>--with</b> <b>pgxs</b>:
             #!/usr/bin/make -f

             override_dh_installdocs:
                     dh_installdocs --all README.*

             %:
                     dh $@ --with pgxs

       If the package does no support building from subdirectories, use <b>dh</b> <b>$@</b> <b>--with</b> <b>pgxs_loop</b>:
             #!/usr/bin/make -f

             %:
                     dh $@ --with pgxs_loop

       If the package does not use PGXS's "make installcheck" for testing:
             override_dh_pgxs_test:

       <b>debian/rules</b> using <b>pg_buildext</b> directly:
             #!/usr/bin/make -f

             include /usr/share/postgresql-common/pgxs_debian_control.mk

             # omit this if the package does not use autoconf
             override_dh_auto_configure:
                     +pg_buildext configure build-%v "--libdir=/usr/lib/postgresql/%v/lib --datadir=/usr/share/postgresql-%v-foobar"

             override_dh_auto_build:
                     +pg_buildext build build-%v

             override_dh_auto_test:
                     # nothing to do here, see debian/tests/* instead

             override_dh_auto_install:
                     +pg_buildext install build-%v postgresql-%v-foobar

             override_dh_installdocs:
                     dh_installdocs --all README.*

             override_dh_pgxs_test:
                     +pg_buildext installcheck . build-%v postgresql-%v-foobar

             override_dh_auto_clean:
                     +pg_buildext clean build-%v

             %:
                     dh $@

       <b>debian/tests/control:</b>
             Depends: @, postgresql-common-dev
             Tests: installcheck
             Restrictions: allow-stderr

       <b>debian/tests/control.in:</b> (optional)
             Depends: @, postgresql-common-dev, postgresql-PGVERSION-bar
             Tests: installcheck
             Restrictions: allow-stderr

       <b>debian/tests/installcheck:</b>
             #!<a href="file:/bin/sh">/bin/sh</a>
             pg_buildext installcheck
             # alternatively: pg_buildext installcheck build-%v

             # Running extra code before invoking the actual action:
             set -e
             for v in $(pg_buildext installed-versions); do
                     test -L build-$v/sql || ln -s ../sql build-$v/
                     test -L build-$v/expected || ln -s ../expected build-$v/
                     pg_buildext installcheck-$v build-$v
             done

</pre><h4><b>SOURCE</b> <b>DIRECTORY</b></h4><pre>
       If the package source code is not in the top level directory (i.e. the directory  which  has  debian/  as
       subdirectory), use the <u>src-dir</u> argument, where <u>src-dir</u> must be an absolute path. Example:

         override_dh_auto_build:
                 +pg_buildext build $(CURDIR)/postgresql-module build-%v

</pre><h4><b>COMPATIBILITY</b></h4><pre>
       <b>pg_buildext</b> <b>loop</b> was introduced in postgresql-server-dev-all (&gt;= 141~).

       The usage of "all" or "NN+" in debian/pgversions was introduced in postgresql-server-dev-all (&gt;= 148~).

       <b>pg_buildext</b> <b>installcheck</b> was introduced in postgresql-server-dev-all (&gt;= 153~).

       <b>PG_VIRTUALENV_UNSHARE=-n</b> was introduced in postgresql-common (&gt;= 170~).

       Handling  of  debian/tests/control.in  with <b>PGVERSION</b> replacement was introduced in postgresql-common (&gt;=
       171~).

       The action <b>installed-versions</b> was introduced in postgresql-common (&gt;= 208~).  <b>installcheck</b>  was  switched
       to use it in the same version.

       <b>dh</b>  <b>$@</b>  <b>--with</b>  <b>pgxs</b>  and <b>pgxs_loop</b>, the corresponding <b>--buildsystem</b>, and the <b>psql</b> and <b>virtualenv</b> actions
       were introduced in postgresql-server-dev-all (&gt;= 217~).

       The replacement of <b>PGVERSIONS</b> (plural) in debian/control.in and <b>pg_buildext</b> <b>run</b>  and  <b>run_installed</b>  were
       introduced in postgresql-common (&gt;= 256~).

       Setting <b>pg_virtualenv</b> arguments from <b>PG_VIRTUALENV_ARGS</b> was introduced in postgresql-common (&gt;= 259~).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       /usr/share/postgresql-common/supported-versions, <b><a href="../man1/autopkgtest.1.html">autopkgtest</a></b>(1), <b><a href="../man1/pg_virtualenv.1.html">pg_virtualenv</a></b>(1).

</pre><h4><b>AUTHORS</b></h4><pre>
       Dimitri Fontaine &lt;<a href="mailto:dim@tapoueh.org">dim@tapoueh.org</a>&gt;, with extensions by Christoph Berg &lt;<a href="mailto:myon@debian.org">myon@debian.org</a>&gt;.

Debian                                             2025-02-20                                     <u><a href="../man1/PG_BUILDEXT.1.html">PG_BUILDEXT</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>