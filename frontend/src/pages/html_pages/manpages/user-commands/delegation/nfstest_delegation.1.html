<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nfstest_delegation - Delegation tests</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/nfstest">nfstest_3.2-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nfstest_delegation - Delegation tests

</pre><h4><b>SYNOPSIS</b></h4><pre>
       nfstest_delegation --server &lt;server&gt; [--client &lt;client&gt;] [options]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Basic  delegation  tests  verify  that a correct delegation is granted when opening a file for reading or
       writing. Also, another OPEN should not be sent for the same file when the client is holding a delegation.
       Verify that the stateid of all I/O operations should be the delegation stateid.  Reads from  a  different
       process  on  the same file should not cause the client to send additional READ packets when the client is
       holding a read delegation.  Furthermore, a LOCK packet should not be sent to the server when  the  client
       is holding a delegation.

       Recall  delegation  tests  verify  the delegation is recalled when a conflicting operation is sent to the
       server from a different client. Conflicting operations  are  reading,  writing,  removing,  renaming  and
       changing  the  permissions  on  the  same file. Note that reading a file from a different client can only
       recall a write delegation. Removing the delegated file from a different client recalls the delegation and
       the server may or may not allow any more writes from the client after the delegation has  been  returned.
       Renaming  either  the  delegated  file  (as  source)  or  into the delegated file (as target) recalls the
       delegation. In the case where the delegated file is the target of rename, the existing target is  removed
       before the rename occurs, therefore the server may or may not allow nay more writes from the client after
       the delegation has been removed just like in the case when removing the delegated file.

       Also, verify that a read delegation is not recalled when a different client is granted a read delegation.
       After  a delegation is recalled, the client may send an OPEN with CLAIM_DELEGATE_CUR before returning the
       delegation specially when there is a open pending on the client. In addition, the stateid returned by the
       new open should be the same as the original OPEN stateid. Also, a delegation should not be  granted  when
       re-opening  the  file  before  returning  the  delegation.   The client may flush all written data before
       returning the WRITE delegation.  The LOCK should be sent as well before returning a delegation which  has
       been  recalled. Finally, a delegation should not be granted on the second client who cause the delegation
       recall on the first client.

</pre><h4><b>OPTIONS</b></h4><pre>
       --version
              show program's version number and exit

       -h, --help
              show this help message and exit

       -f FILE, --file=FILE
              File where options are specified besides  the  system  wide  file  /etc/nfstest,  user  wide  file
              $HOME/.nfstest or in the current directory .nfstest file

   <b>NFS</b> <b>specific</b> <b>options:</b>
       -s SERVER, --server=SERVER
              Server name or IP address

       -e EXPORT, --export=EXPORT
              Exported file system to mount [default: '/']

       --nfsversion=NFSVERSION
              NFS version, e.g., 3, 4, 4.1, etc. [default: 4.1]

       -m MTPOINT, --mtpoint=MTPOINT
              Mount point [default: '/mnt/t']

       -p PORT, --port=PORT
              NFS server port [default: 2049]

       --proto=PROTO
              NFS protocol name [default: 'tcp']

       --sec=SEC
              Security flavor [default: 'sys']

       --nconnect=NCONNECT
              Multiple TCP connections option [default: '1']

       -o MTOPTS, --mtopts=MTOPTS
              Mount options [default: 'hard,rsize=4096,wsize=4096']

       --datadir=DATADIR
              Data directory where files are created, directory is created on the mount point [default: '']

   <b>Logging</b> <b>options:</b>
       -v VERBOSE, --verbose=VERBOSE
              Verbose level for debug messages [default: 'opts|info|dbg1|dbg2|dbg3']

       --tverbose=TVERBOSE
              Verbose level for test messages [default: '1']

       --createlog
              Create log file

       --rexeclog
              Create rexec log files

       --warnings
              Display warnings

       --tag=TAG
              Informational tag, it is displayed as an INFO message [default: '']

       --notty
              Do not use terminal colors on output

       --isatty
              Use terminal colors on output -- useful when running with nohup

   <b>Packet</b> <b>trace</b> <b>options:</b>
       --createtraces
              Create a packet trace for each test

       --tbsize=TBSIZE
              Capture buffer size for tcpdump [default: 192k]

       --trcdelay=TRCDELAY
              Seconds to delay before stopping packet trace [default: 2.0]

       --keeptraces
              Do not remove any trace files [default: remove trace files if no errors]

       --rmtraces
              Remove trace files [default: remove trace files if no errors]

       -i INTERFACE, --interface=INTERFACE
              Device interface [default: automatically selected]

   <b>File</b> <b>options:</b>
       --nfiles=NFILES
              Number of files to create [default: 2]

       --filesize=FILESIZE
              File size to use for test files [default: 64k]

       --rsize=RSIZE
              Read size to use when reading files [default: 4k]

       --wsize=WSIZE
              Write size to use when writing files [default: 4k]

       --iodelay=IODELAY
              Seconds to delay I/O operations [default: 0.1]

       --offset-delta=OFFSET_DELTA
              Read/Write offset delta [default: 4k]

   <b>Path</b> <b>options:</b>
       --sudo=SUDO
              Full path of binary for sudo [default: '<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?sudo">/usr/bin/sudo</a>']

       --kill=KILL
              Full path of binary for kill [default: '<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?kill">/usr/bin/kill</a>']

       --nfsstat=NFSSTAT
              Full path of binary for nfsstat [default: '/usr/sbin/nfsstat']

       --tcpdump=TCPDUMP
              Full path of binary for tcpdump [default: '/usr/sbin/tcpdump']

       --iptables=IPTABLES
              Full path of binary for iptables [default: '<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?iptables">/usr/sbin/iptables</a>']

       --messages=MESSAGES
              Full path of log messages file [default: '/var/log/messages']

       --trcevents=TRCEVENTS
              Full path of tracing events directory [default: '/sys/kernel/debug/tracing/events']

       --trcpipe=TRCPIPE
              Full path of trace pipe file [default: '/sys/kernel/debug/tracing/trace_pipe']

       --tmpdir=TMPDIR
              Temporary directory [default: '<a href="file:/tmp">/tmp</a>']

   <b>Debug</b> <b>options:</b>
       --nocleanup
              Do not cleanup created files

       --notimestamps
              Do not display timestamps in debug messages

       --bugmsgs=BUGMSGS
              File containing test messages to mark as bugs if they failed

       --nomount
              Do not mount server and run the tests on local disk space

       --basename=BASENAME
              Base name for all files and logs [default: automatically generated]

       --nfsdebug=NFSDEBUG
              Set NFS kernel debug flags and save log messages [default: '']

       --rpcdebug=RPCDEBUG
              Set RPC kernel debug flags and save log messages [default: '']

       --tracepoints=TRACEPOINTS
              List of trace points modules to enable [default: '']

       --nfsstats
              Get NFS stats [default: 'False']

       --pktdisp
              Display main packets related to the given test

       --nfserrors
              Fail every NFS error found in the packet trace

       --client-ipaddr=CLIENT_IPADDR
              IP address of localhost

   <b>Reporting</b> <b>options:</b>
       --xunit-report
              Generate xUnit compatible test report

       --xunit-report-file=XUNIT_REPORT_FILE
              Path to xout report file

   <b>Test</b> <b>options:</b>
       --runtest=RUNTEST
              Comma  separated list of tests to run, if list starts with a '^' then all tests are run except the
              ones listed [default: 'all']

       --client=CLIENT
              Remote NFS client and options used for recall delegation tests.  Clients are separated  by  a  ','
              and  each client definition is a list of arguments separated by a ':' given in the following order
              if         positional         arguments         is          used          (see          examples):
              clientname:server:export:nfsversion:port:proto:sec:mtpoint                               [default:
              'nfsversion=3:proto=tcp:port=2049']

       --client-nfsvers=CLIENT_NFSVERS
              Comma separated list of valid NFS versions to use in the --client option. An NFS version from this
              list, which is different than that given by --nfsversion, is selected and included in the --client
              option [default: 4.0,4.1]

       --lock-offset=LOCK_OFFSET
              Starting offset for lock [default: 0]

       --lock-poffset=LOCK_POFFSET
              Starting offset for lock on pending open [default: 8192]

       --lock-len=LOCK_LEN
              Number of bytes to lock [default: 4096]

       --truncate
              Truncate file when writing from the second file for the recall tests

       --setup-delay=SETUP_DELAY
              Seconds to delay after setup so all opens are released [default: 4.0]

</pre><h4><b>TESTS</b></h4><pre>
   <b>basic</b>
       Run all basic delegation tests: basic01, basic02, basic03, basic04,
       basic05, basic06, basic07, basic08, basic09, basic10, basic11, basic12

   <b>stat</b>
       Run all basic delegation tests with file stat: basic03, basic04,
       basic09, basic10

   <b>lock</b>
       Run all basic delegation tests with file lock: basic05, basic06,
       basic11, basic12

   <b>basic01</b>
       Basic read delegation test

   <b>basic02</b>
       Basic write delegation test

   <b>basic03</b>
       Basic read delegation test with file stat

   <b>basic04</b>
       Basic write delegation test with file stat

   <b>basic05</b>
       Basic read delegation test with file lock

   <b>basic06</b>
       Basic write delegation test with file lock

   <b>basic07</b>
       Basic write delegation test using RDWR open while reading

   <b>basic08</b>
       Basic write delegation test using RDWR open while writing

   <b>basic09</b>
       Basic write delegation test using RDWR open while reading with file stat

   <b>basic10</b>
       Basic write delegation test using RDWR open while writing with file stat

   <b>basic11</b>
       Basic write delegation test using RDWR open while reading with file lock

   <b>basic12</b>
       Basic write delegation test using RDWR open while writing with file lock

   <b>recall</b>
       Run all recall delegation tests: recall01, recall02, recall03, recall04,
       recall05, recall06, recall07, recall08, recall09, recall10, recall11,
       recall12, recall13, recall14, recall15, recall16, recall17, recall18,
       recall19, recall20, recall21, recall22, recall23, recall24, recall25,
       recall26, recall27, recall28, recall29, recall30, recall31, recall32,
       recall33, recall34, recall35, recall36, recall37, recall38, recall39,
       recall40, recall41, recall42, recall43, recall44, recall45, recall46,
       recall47, recall48, recall49, recall50, recall51, recall52, recall53,
       recall54

   <b>setattr</b>
       Run all tests using SETATTR to recall the delegation: recall07,
       recall08, recall09, recall10, recall35, recall36, recall37, recall38

   <b>remove</b>
       Run all tests recalling the delegation by removing the delegated file:
       recall11, recall12, recall13, recall14, recall39, recall40, recall41,
       recall42

   <b>rename</b>
       Run all tests recalling the delegation by renaming the delegated file:
       recall15, recall16, recall17, recall18, recall19, recall20, recall21,
       recall22, recall43, recall44, recall45, recall46, recall47, recall48,
       recall49, recall50

   <b>pending</b>
       Run all recall delegation tests having a pending open: recall23,
       recall24, recall25, recall26, recall51, recall52, recall53, recall54

   <b>recall01</b>
       Recall read delegation by writing from a second client

   <b>recall02</b>
       Recall write delegation by writing from a second client

   <b>recall03</b>
       Recall read delegation by writing from a second client with file lock

   <b>recall04</b>
       Recall write delegation by writing from a second client with file lock

   <b>recall05</b>
       Recall write delegation by reading from a second client

   <b>recall06</b>
       Recall write delegation by reading from a second client with file lock

   <b>recall07</b>
       Recall read delegation by changing the permissions to the file

   <b>recall08</b>
       Recall write delegation by changing the permissions to the file

   <b>recall09</b>
       Recall read delegation by changing the permissions to the file with file lock

   <b>recall10</b>
       Recall write delegation by changing the permissions to the file with file lock

   <b>recall11</b>
       Recall read delegation by removing the file

   <b>recall12</b>
       Recall write delegation by removing the file

   <b>recall13</b>
       Recall read delegation by removing the file with file lock

   <b>recall14</b>
       Recall write delegation by removing the file with file lock

   <b>recall15</b>
       Recall read delegation by renaming the file

   <b>recall16</b>
       Recall write delegation by renaming the file

   <b>recall17</b>
       Recall read delegation by renaming the file with file lock

   <b>recall18</b>
       Recall write delegation by renaming the file with file lock

   <b>recall19</b>
       Recall read delegation by renaming into the file

   <b>recall20</b>
       Recall write delegation by renaming into the file

   <b>recall21</b>
       Recall read delegation by renaming into the file with file lock

   <b>recall22</b>
       Recall write delegation by renaming into the file with file lock

   <b>recall23</b>
       Recall read delegation by writing from a second client with file lock,
       having a pending read open

   <b>recall24</b>
       Recall read delegation by writing from a second client with file lock,
       having a pending write open.
       Delegation is returned by the client when the second open is done so
       there is no delegation recall

   <b>recall25</b>
       Recall write delegation by writing from a second client with file lock,
       having a pending read open

   <b>recall26</b>
       Recall write delegation by writing from a second client with file lock,
       having a pending write open

   <b>recall27</b>
       Recall write delegation by reading from a second client using RDWR
       open while reading

   <b>recall28</b>
       Recall write delegation by reading from a second client using RDWR
       open while writing

   <b>recall29</b>
       Recall write delegation by writing from a second client using RDWR
       open while reading

   <b>recall30</b>
       Recall write delegation by writing from a second client using RDWR
       open while writing

   <b>recall31</b>
       Recall write delegation by reading from a second client using RDWR
       open while reading with file lock

   <b>recall32</b>
       Recall write delegation by reading from a second client using RDWR
       open while writing with file lock

   <b>recall33</b>
       Recall write delegation by writing from a second client using RDWR
       open while reading with file lock

   <b>recall34</b>
       Recall write delegation by writing from a second client using RDWR
       open while writing with file lock

   <b>recall35</b>
       Recall write delegation by changing the permissions to the file
       from a second client using RDWR open while reading

   <b>recall36</b>
       Recall write delegation by changing the permissions to the file
       from a second client using RDWR open while writing

   <b>recall37</b>
       Recall write delegation by changing the permissions to the file
       from a second client using RDWR open while reading with file lock

   <b>recall38</b>
       Recall write delegation by changing the permissions to the file
       from a second client using RDWR open while writing with file lock

   <b>recall39</b>
       Recall write delegation by removing the file from a second client
       using RDWR open while reading

   <b>recall40</b>
       Recall write delegation by removing the file from a second client
       using RDWR open while writing

   <b>recall41</b>
       Recall write delegation by removing the file from a second client
       using RDWR open while reading with file lock

   <b>recall42</b>
       Recall write delegation by removing the file from a second client
       using RDWR open while writing with file lock

   <b>recall43</b>
       Recall write delegation by renaming the file from a second client
       using RDWR open while reading

   <b>recall44</b>
       Recall write delegation by renaming the file from a second client
       using RDWR open while writing

   <b>recall45</b>
       Recall write delegation by renaming the file from a second client
       using RDWR open while reading with file lock

   <b>recall46</b>
       Recall write delegation by renaming the file from a second client
       using RDWR open while writing with file lock

   <b>recall47</b>
       Recall write delegation by renaming the file from a second client
       using RDWR open while reading

   <b>recall48</b>
       Recall write delegation by renaming the file from a second client
       using RDWR open while writing

   <b>recall49</b>
       Recall write delegation by renaming the file from a second client
       using RDWR open while reading with file lock

   <b>recall50</b>
       Recall write delegation by renaming the file from a second client
       using RDWR open while writing with file lock

   <b>recall51</b>
       Recall write delegation by writing from a second client using RDWR
       open while reading with file lock, having a pending read open

   <b>recall52</b>
       Recall write delegation by writing from a second client using RDWR
       open while reading with file lock, having a pending write open

   <b>recall53</b>
       Recall write delegation by writing from a second client using RDWR
       open while writing with file lock, having a pending read open

   <b>recall54</b>
       Recall write delegation by writing from a second client using RDWR
       open while writing with file lock, having a pending write open

   <b>read_deleg</b>
       Run all read delegation tests: basic01, basic03, basic05, recall01,
       recall03, recall07, recall09, recall11, recall13, recall15, recall17,
       recall19, recall21, recall23, recall24

   <b>write_deleg</b>
       Run all write delegation tests: basic02, basic04, basic06, basic07,
       basic08, basic09, basic10, basic11, basic12, recall02, recall04,
       recall05, recall06, recall08, recall10, recall12, recall14, recall16,
       recall18, recall20, recall22, recall25, recall26, recall27, recall28,
       recall29, recall30, recall31, recall32, recall33, recall34, recall35,
       recall36, recall37, recall38, recall39, recall40, recall41, recall42,
       recall43, recall44, recall45, recall46, recall47, recall48, recall49,
       recall50, recall51, recall52, recall53, recall54

   <b>all</b>
       Run all tests: basic01, basic02, basic03, basic04, basic05, basic06,
       basic07, basic08, basic09, basic10, basic11, basic12, recall01,
       recall02, recall03, recall04, recall05, recall06, recall07, recall08,
       recall09, recall10, recall11, recall12, recall13, recall14, recall15,
       recall16, recall17, recall18, recall19, recall20, recall21, recall22,
       recall23, recall24, recall25, recall26, recall27, recall28, recall29,
       recall30, recall31, recall32, recall33, recall34, recall35, recall36,
       recall37, recall38, recall39, recall40, recall41, recall42, recall43,
       recall44, recall45, recall46, recall47, recall48, recall49, recall50,
       recall51, recall52, recall53, recall54

</pre><h4><b>EXAMPLES</b></h4><pre>
       Run the basic delegation tests (no client option):
           nfstest_delegation --server 192.168.0.2 --export /exports

       Use short options instead:
           nfstest_delegation -s 192.168.0.2 -e /exports

       Run both the basic and recall tests using positional arguments with nfsversion=3 for the second client:
           nfstest_delegation -s 192.168.0.2 -e /exports --client 192.168.0.10:::3

       Use named arguments instead:
           nfstest_delegation -s 192.168.0.2 -e /exports --client 192.168.0.10:nfsversion=3

</pre><h4><b>NOTES</b></h4><pre>
       The user id in the local host and the host specified by --client must have access to run commands as root
       using the 'sudo' command without the need for a password.

       The user id must be able to 'ssh' to remote host without the need for a password.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/nfstest.test_util.3.html">nfstest.test_util</a>(3),</b>    <b><a href="../man1/nfstest_alloc.1.html">nfstest_alloc</a>(1),</b>     <b><a href="../man1/nfstest_cache.1.html">nfstest_cache</a>(1),</b>     <b><a href="../man1/nfstest_dio.1.html">nfstest_dio</a>(1),</b>     <b><a href="../man1/nfstest_fcmp.1.html">nfstest_fcmp</a>(1),</b>
       <b><a href="../man1/nfstest_file.1.html">nfstest_file</a>(1),</b>  <b><a href="../man1/nfstest_interop.1.html">nfstest_interop</a>(1),</b>  <b><a href="../man1/nfstest_io.1.html">nfstest_io</a>(1),</b>  <b><a href="../man1/nfstest_lock.1.html">nfstest_lock</a>(1),</b>  <b><a href="../man1/nfstest_pkt.1.html">nfstest_pkt</a>(1),</b> <b><a href="../man1/nfstest_pnfs.1.html">nfstest_pnfs</a>(1),</b>
       <b><a href="../man1/nfstest_posix.1.html">nfstest_posix</a>(1),</b> <b><a href="../man1/nfstest_rdma.1.html">nfstest_rdma</a>(1),</b> <b><a href="../man1/nfstest_sparse.1.html">nfstest_sparse</a>(1),</b> <b><a href="../man1/nfstest_ssc.1.html">nfstest_ssc</a>(1),</b>  <b><a href="../man1/nfstest_xattr.1.html">nfstest_xattr</a>(1),</b>  <b><a href="../man1/nfstest_xid.1.html">nfstest_xid</a>(1),</b>
       <b><a href="../man3/packet.nfs.nfs3_const.3.html">packet.nfs.nfs3_const</a>(3),</b> <b><a href="../man3/packet.nfs.nfs4_const.3.html">packet.nfs.nfs4_const</a>(3)</b>

</pre><h4><b>BUGS</b></h4><pre>
       No known bugs.

</pre><h4><b>AUTHOR</b></h4><pre>
       Jorge Mora (<a href="mailto:mora@netapp.com">mora@netapp.com</a>)

NFStest 3.2                                       21 March 2023                            <u><a href="../man1/NFSTEST_DELEGATION.1.html">NFSTEST_DELEGATION</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>