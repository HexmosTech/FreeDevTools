<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mkgmap-splitter - tile splitter for mkgmap</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/mkgmap-splitter">mkgmap-splitter_0.0.0+svn654-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mkgmap-splitter - tile splitter for mkgmap

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>mkgmap-splitter</b> [<u>options</u>] <u>file.osm</u> &gt; <u>splitter.log</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>mkgmap-splitter</b>  splits  an  .osm  file  that contains large well mapped regions into a number of smaller
       tiles, to fit within the maximum size used for the Garmin maps format.  There are at least two stages  of
       processing required.  The first stage is to calculate what area each tile should cover, based on the dis‐
       tribution  of  nodes.   The  second stage writes out the nodes, ways and relations from the original .osm
       file into separate smaller .osm files, one for each area that was calculated in stage one.   With  option
       <b>--keep-complete=true</b>, two additional stages are used to avoid broken ways and polygons.

       The two most important features are:

       • Variable sized tiles to prevent a large number of tiny files.

       • Tiles join exactly with no overlap or gaps.

       You  will need a lot of memory on your computer if you intend to split a large area.  A few options allow
       configuring how much memory you need.  With the default parameters, you need about 4-5  bytes  for  every
       node  and  way.  This doesn't sound a lot but there are about 1700 million nodes in the whole planet file
       and so you cannot process the whole planet in one pass file on a 32 bit machine using this utility as the
       maximum java heap space is 2G.  It is possible with 64 bit java and about 7GB of heap  or  with  multiple
       passes.

       The  Europe  extract  from Cloudmade or Geofabrik can be processed within the 2G limit if you have suffi‐
       cient memory.  With the default options europe is split into about 750  tiles.   The  Europe  extract  is
       about half of the size of the complete planet file.

       On the other hand a single country, even a well mapped one such as Germany or the UK, will be possible on
       a modest machine, even a netbook.

</pre><h4><b>USAGE</b></h4><pre>
       Splitter requires java 1.6 or higher.  Basic usage is as follows.

       <b>mkgmap-splitter</b> <u>file.osm</u> &gt; <u>splitter.log</u>

       If  you  have  less than 2 GB of memory on your computer you should reduce the <b>-Xmx</b> option by setting the
       JAVA_OPTS environment variable.

       JAVA_OPTS="<u>-Xmx512m</u>" <b>mkgmap-splitter</b> <u>file.osm</u> &gt; <u>splitter.log</u>

       This will produce a number of .osm.pbf files that can be read by <b><a href="../man1/mkgmap.1.html">mkgmap</a></b>(1).  There are also  other  files
       produced:

       The  <u>template.args</u> file is a file that can be used with the <b>-c</b> option of <b>mkgmap</b> that will compile all the
       files.  You can use it as is or you can copy it and edit it to include your own options.  For example in‐
       stead of each description being "OSM Map" it could be "NW Scotland" as appropriate.

       The <u>areas.list</u> file is the list of bounding boxes that were calculated.  If you want you can use this  on
       a  subsequent  call  the the splitter using the <b>--split-file</b> option to use exactly the same areas as last
       time.  This might be useful if you produce a map regularly and want to keep the tile areas the same  from
       month to month.  It is also useful to avoid the time it takes to regenerate the file each time (currently
       about  a  third  of the overall time taken to perform the split).  Of course if the map grows enough that
       one of the tiles overflows you will have to re-calculate the areas again.

       The <u>areas.poly</u> file contains the bounding polygon of the calculated areas.  See option <b>--polygon-file</b> how
       this can be used.

       The <u>densities-out.txt</u> file is written when no split-file is given and contains debugging information  on‐
       ly.

       You  can  also  use  a gzip'ed or bz2'ed compressed .osm file as the input file.  Note that this can slow
       down the splitter considerably (particularly true for bz2) because decompressing the .osm file  can  take
       quite a lot of CPU power.  If you are likely to be processing a file several times you're probably better
       off  converting  the file to one of the binary formats pbf or o5m.  The o5m format is faster to read, but
       requires more space on the disk.

</pre><h4><b>OPTIONS</b></h4><pre>
       There are a number of options to fine tune things that you might want to try.

       <b>--boundary-tags=</b><u>string</u>
              A comma separated list of tag values for relations.  Used to filter multipolygon and boundary  re‐
              lations for problem-list processing.  See also option <b>--wanted-admin-level</b>.  Default: use-exclude-
              list

       <b>--cache=</b><u>string</u>
              Deprecated, now does nothing

       <b>--description=</b><u>string</u>
              Sets the desciption to be written in to the <u>template.args</u> file.

       <b>--geonames-file=</b><u>string</u>
              The name of a GeoNames file to use for determining tile names.  Typically <u>cities15000.zip</u> from
              geonames ⟨<a href="http://download.geonames.org/export/dump">http://download.geonames.org/export/dump</a>⟩ .

       <b>--keep-complete=</b><u>boolean</u>
              Use <b>--keep-complete=false</b> to disable two additional program phases between the split and the final
              distribution  phase (not recommended).  The first phase, called gen-problem-list, detects all ways
              and relations that are crossing the borders of one or more output files.  The second phase, called
              handle-problem-list, collects the coordinates of these ways and relations and calculates all  out‐
              put  files  that  are  crossed  or enclosed.  The information is passed to the final dist-phase in
              three temporary files.  This avoids broken polygons, but be aware that it requires to read the in‐
              put files at least two additional times.

              Do not specify it with <b>--overlap</b> unless you have a good reason to do so.

              Defaulte: true

       <b>--mapid=</b><u>int</u>
              Set  the  filename  for  the  split  files.   In  the  example  the  first  file  will  be  called
              <u>63240001.osm.pbf</u> and the next one will be <u>63240002.osm.pbf</u> and so on.

              Default: 63240001

       <b>--max-areas=</b><u>int</u>
              The maximum number of areas that can be processed in a single pass during the second stage of pro‐
              cessing.   This must be a number from 1 to 4096.  Higher numbers mean fewer passes over the source
              file and hence quicker overall processing, but also require more memory.  If you find you are run‐
              ning out of memory but don't want to increase your <b>--max-nodes</b> value, try reducing  this  instead.
              Changing  this  will  have  no effect on the result of the split, it's purely to let you trade off
              memory for performance.  Note that the first stage of the processing has a fixed  memory  overhead
              regardless  of  what this is set to so if you are running out of memory before the <u>areas.list</u> file
              is generated, you need to either increase your <b>-Xmx</b> value or reduce the size  of  the  input  file
              you're trying to split.

              Default: 512

       <b>--max-nodes=</b><u>int</u>
              The maximum number of nodes that can be in any of the resultant files.  The default is fairly con‐
              servative,  you could increase it quite a lot before getting any 'map too big' messages.  Not much
              experimentation has been done.  Also the bigger this value, the less memory is required during the
              splitting stage.

              Default: 1600000

       <b>--max-threads=</b><u>value</u>
              The maximum number of threads used by <b>mkgmap-splitter</b>.

              Default: 4 (auto)

       <b>--mixed=</b><u>boolean</u>
              Specify this if the input osm file has nodes, ways and relations intermingled or the ids  are  not
              strictly sorted.  To increase performance, use the <b>osmosis</b> sort function.

              Default: false

       <b>--no-trim=</b><u>boolean</u>
              Don't  trim  empty  space  off  the edges of tiles.  This option is ignored when <b>--polygon-file</b> is
              used.

              Default: false

       <b>--num-tiles=</b><u>value</u><b>string</b>
              A target value that is used when no split-file is given.  Splitting is done so that the given num‐
              ber of tiles is produced.  The <b>--max-nodes</b> value is ignored if this option is given.

       <b>--output=</b><u>string</u>
              The format in which the output files are written.  Possible values are xml, pbf,  o5m,  and  simu‐
              late.   The  default  is pbf, which produces the smallest file sizes.  The o5m format is faster to
              write, but creates around 40% larger files.  The simulate option is for debugging purposes.

       <b>--output-dir=</b><u>path</u>
              The directory to which splitter should write the output files.  If the specified path to a  direc‐
              tory  doesn't exist, <b>mkgmap-splitter</b> tries to create it.  Defaults to the current working directo‐
              ry.

       <b>--overlap=</b><u>string</u>
              Deprecated since r279.  With <b>--keep-complete=false</b>, <b>mkgmap-splitter</b> should include  nodes  outside
              the  bounding  box, so that <b>mkgmap</b> can neatly crop exactly at the border.  This parameter controls
              the size of that overlap.  It is in map units, a default of 2000 is used which  means  about  0.04
              degrees  of  latitude  or  longitude.  If <b>--keep-complete=true</b> is active and <b>--overlap</b> is given, a
              warning will be printed because this combination rarely makes sense.

       <b>--polygon-desc-file=</b><u>path</u>
              An osm file (.o5m, .pbf, .osm) with named ways that describe bounding polygons with OSM ways  hav‐
              ing tags name and mapid.

       <b>--polygon-file=</b><u>path</u>
              The  name  of  a  file containing a bounding polygon in the osmosis polygon file format .  <b>mkgmap-</b>
              <b>splitter</b> uses this file when calculating the areas.  It first calculates a grid  using  the  given
              <b>--resolution</b>.   The  input  file is read and for each node, a counter is increased for the related
              grid area.  If the input file contains a bounding box, this is applied to the grid so  that  nodes
              outside of the bounding box are ignored.  Next, if specified, the bounding polygon is used to zero
              those  grid  elements  outside of the bounding polygon area.  If the polygon area(s) describe(s) a
              rectilinear area with no more than 40 vertices, <b>mkgmap-splitter</b> will try to  create  output  files
              that fit exactly into the area, otherwise it will approximate the polygon area with rectangles.

       <b>--precomp-sea=</b><u>path</u>
              The  name of a directory containing precompiled sea tiles.  If given, <b>mkgmap-splitter</b> will use the
              precompiled sea tiles in the same way as <b>mkgmap</b> does.  Use this if you want to use a  polygon-file
              or  <b>--no-trim=true</b> and <b>mkgmap</b> creates empty *.img files combined with a message starting "There is
              not enough room in a single garmin map for all the input data".

       <b>--problem-file=</b><u>path</u>
              The name of a file containing ways and relations that are known to cause  problems  in  the  split
              process.   Use  this  option  if  <b>--keep-complete</b>  requires  too much time or memory and <b>--overlap</b>
              doesn't solve your problem.

              Syntax of problem file:

              way:&lt;id&gt; # comment...
              rel:&lt;id&gt; # comment...

              example:

              way:2784765 # Ferry Guernsey - Jersey

       <b>--problem-report=</b><u>path</u>
              The name of a file to write the generated problem list created with <b>--keep-complete</b>.  The  parame‐
              ter  is ignored if <b>--keep-complete=false</b>.  You can reuse this file with the <b>--problem-file</b> parame‐
              ter, but do this only if you use the same values for <b>--max-nodes</b> and <b>--resolution</b>.

       <b>--resolution=</b><u>int</u>
              The resolution of the density map produced during the first phase.  A value between 1 and 24.  De‐
              fault is 13.  Increasing the value to 14 requires four times more memory in the split phase.   The
              value is ignored if a <b>--split-file</b> is given.

       <b>--search-limit=</b><u>int</u>
              Search limit in split algo.  Higher values may find better splits, but will take longer.

              Default: 200000

       <b>--split-file=</b><u>path</u>
              Use  the  previously calculated tile areas instead of calculating them from scratch.  The file can
              be in .list or .kml format.

       <b>--status-freq=</b><u>int</u>
              Displays the amount of memory used by the JVM every <b>--status-freq</b> seconds.  Set =0 to disable.

              Default: 120

       <b>--stop-after=</b><u>string</u>
              Debugging: stop after a given program phase.  Can be split, gen-problem-list,  or  handle-problem-
              list.  Default is dist which means execute all phases.

       <b>--wanted-admin-level=</b><u>string</u>
              Specifies the lowest admin_level value of boundary relations that should be kept complete. Used to
              filter boundary relations for problem-list processing. The default value 5 means that boundary re‐
              lations  are  kept complete when the admin_level is 5 or higher (5..11).  The parameter is ignored
              if <b>--keep-complete=false</b>.  Default: 5

       <b>--write-kml=</b><u>path</u>
              The name of a kml file to write out the areas to.  This is in addition to <u>areas.list</u> (which is al‐
              ways written out).

       Special options

       <b>--version</b>
              If the parameter <b>--version</b> is found somewhere in the options, <b>mkgmap-splitter</b> will just print  the
              version info and exit.  Version info looks like this:

              splitter 279 compiled 2013-01-12T01:45:02+0000

       <b>--help</b> If  the  parameter  <b>--help</b> is found somewhere in the options, <b>mkgmap-splitter</b> will print a list of
              all known normal options together with a short help and exit.

</pre><h4><b>TUNING</b></h4><pre>
       Tuning for best performance

       A few hints for those that are using <b>mkgmap-splitter</b> to split large files.

       • For faster processing with <b>--keep-complete=true</b>, convert the input file to o5m format using:

         <b>osmconvert</b> <b>--drop-version</b> <u>file.osm</u> <b>-o=</b><u>file.o5m</u>

       • The option <b>--drop-version</b> is optional, it reduces the file to that data that is needed by <b>mkgmap-split‐</b>
         <b>ter</b> and <b>mkgmap</b>.

       • If you still experience poor performance, look into <u>splitter.log</u>.  Search for  the  word  Distributing.
         You may find something like this in the next line:

         Processing 1502 areas in 3 passes, 501 areas at a time

         This  means splitter has to read the input file input three times because the <b>--max-areas</b> parameter was
         much smaller than the number of areas.  If you have enough heap, set <b>--max-areas</b> value to a value  that
         is  higher  than  the  number  of areas, e.g.  <b>--max-areas=2048</b>.  Execute <b>mkgmap-splitter</b> again and you
         should find

         Processing 1502 areas in a single pass

       • More areas require more memory.  Make sure that <b>mkgmap-splitter</b> has enough heap (increase the <b>-Xmx</b>  pa‐
         rameter)  so  that it doesn't waste much time in the garbage collector (GC), but keep as much memory as
         possible for the systems I/O caches.

       • If available, use two different disks for input file and output directory, esp. when you use o5m format
         for input and output.

       • If you use <b>mkgmap</b> r2415 or later and disk space is no concern, consider to use <b>--output=o5m</b> to speed up
         processing.

       Tuning for low memory requirements

       If your machine has less than 1 GB free memory (eg. a netbook), you can still  use  <b>mkgmap-splitter</b>,  but
       you  might have to be patient if you use the parameter <b>--keep-complete</b> and want to split a file like <u>ger‐</u>
       <u>many.osm.pbf</u> or a larger one.  If needed, reduce the number of parallel processed areas to  50  with  the
       <b>--max-areas</b> parameter.  You have to use <b>--keep-complete=false</b> when splitting an area like Europe.

</pre><h4><b>NOTES</b></h4><pre>
       • There  is  no  longer an upper limit on the number of areas that can be output (previously it was 255).
         More areas just mean potentially more passes being required over the .osm file, and hence the  splitter
         will take longer to run.

       • There is no longer a limit on how many areas a way or relation can belong to (previously it was 4).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/mkgmap.1.html">mkgmap</a></b>(1), <b><a href="../man1/osmconvert.1.html">osmconvert</a></b>(1)

                                                  06 March 2025                               <u><a href="../man1/mkgmap-splitter.1.html">mkgmap-splitter</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>