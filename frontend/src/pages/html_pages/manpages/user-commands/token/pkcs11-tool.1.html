<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pkcs11-tool - utility for managing and using PKCS #11 security tokens</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/opensc">opensc_0.26.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pkcs11-tool - utility for managing and using PKCS #11 security tokens

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>pkcs11-tool</b> [<u>OPTIONS</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>pkcs11-tool</b> utility is used to manage the data objects on smart cards and similar PKCS #11 security
       tokens. Users can list and read PINs, keys and certificates stored on the token. User PIN authentication
       is performed for those operations that require it.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--attr-from</b> <u>filename</u>
           Extract information from <u>filename</u> (DER-encoded certificate file) and create the corresponding
           attributes when writing an object to the token. Example: the certificate subject name is used to
           create the CKA_SUBJECT attribute.

       <b>--change-pin</b>, <b>-c</b>
           Change the user PIN on the token

       <b>--unlock-pin</b>
           Unlock User PIN (without <b>--login</b> unlock in logged in session; otherwise <b>--login-type</b> has to be
           'context-specific').

       <b>--hash</b>, <b>-h</b>
           Hash some data.

       <b>--hash-algorithm</b> <u>mechanism</u>
           Specify hash algorithm used with RSA-PKCS-PSS signature or RSA-OAEP decryption. Allowed values are
           "SHA-1", "SHA256", "SHA384", "SHA512", and some tokens may also allow "SHA224". Default is "SHA-1".

           Note that the input to RSA-PKCS-PSS has to be of the size equal to the specified hash algorithm.
           E.g., for SHA256 the signature input must be exactly 32 bytes long (for mechanisms
           SHA256-RSA-PKCS-PSS there is no such restriction). For RSA-OAEP, the plaintext input size mLen must
           be at most keyLen - 2 - 2*hashLen. For example, for RSA 3072-bit key and SHA384, the longest
           plaintext to encrypt with RSA-OAEP is (with all sizes in bytes): 384 - 2 - 2*48 = 286, aka 286 bytes.

       <b>--id</b> <u>id</u>, <b>-d</b> <u>id</u>
           Specify the id of the object to operate on.

       <b>--init-pin</b>
           Initializes the user PIN. This option differs from <b>--change-pin</b> in that it sets the user PIN for the
           first time. Once set, the user PIN can be changed using <b>--change-pin</b>.

       <b>--init-token</b>
           Initialize a token: set the token label as well as a Security Officer PIN (the label must be
           specified using <b>--label</b>).

       <b>--input-file</b> <u>filename</u>, <b>-i</b> <u>filename</u>
           Specify the path to a file for input.

       <b>--keypairgen</b>, <b>-k</b>
           Generate a new key pair (public and private pair.)

       <b>--keygen</b>
           Generate a new key.

       <b>--key-type</b> <u>specification</u>
           Specify the type and (not always compulsory) flavour (byte-wise symmetric key length, bit-wise
           asymmetric key length, elliptic curve identifier, etc.) of the key to create, for example RSA:2048,
           EC:prime256v1, GOSTR3410-2012-256:B, DES:8, DES3:24, AES:16, AES: or GENERIC:64. If the key type was
           incompletely specified, possible values are listed.

       <b>--usage-sign</b>
           Specify 'sign' key usage flag (sets SIGN in privkey, sets VERIFY in pubkey).

       <b>--usage-decrypt</b>
           Specify 'decrypt' key usage flag.

           For RSA keys, sets DECRYPT in privkey and ENCRYPT in pubkey. For secret keys, sets both DECRYPT and
           ENCRYPT.

       <b>--usage-derive</b>
           Specify 'derive' key usage flag (EC only).

       <b>--usage-wrap</b>
           Specify 'wrap' key usage flag.

       <b>--label</b> <u>name</u>, <b>-a</b> <u>name</u>
           Specify the name of the object to operate on (or the token label when <b>--init-token</b> is used).

       <b>--list-mechanisms</b>, <b>-M</b>
           Display a list of mechanisms supported by the token.

       <b>--list-objects</b>, <b>-O</b>
           Display a list of objects.

           The options <b>--keytype</b>, <b>--label</b> , <b>--id</b> or <b>--application-id</b> can be used to filter the listed objects.

       <b>--list-slots</b>, <b>-L</b>
           Display a list of available slots on the token.

       <b>--list-token-slots</b>, <b>-T</b>
           List slots with tokens.

       <b>--list-interfaces</b>
           List interfaces of PKCS #11 3.0 library.

       <b>--session-rw</b>,
           Forces to open the PKCS#11 session with CKF_RW_SESSION.

       <b>--login</b>, <b>-l</b>
           Authenticate to the token before performing other operations. This option is not needed if a PIN is
           provided on the command line.

       <b>--login-type</b>
           Specify login type ('so', 'user', 'context-specific'; default:'user').

       <b>--mechanism</b> <u>mechanism</u>, <b>-m</b> <u>mechanism</u>
           Use the specified <u>mechanism</u> for token operations. See <b>-M</b> for a list of mechanisms supported by your
           token. The mechanism can also be specified in hexadecimal, e.g., <u>0x80001234</u>.

       <b>--mgf</b> <u>function</u>
           Use the specified Message Generation Function (MGF) <u>function</u> for RSA-PKCS-PSS signatures or RSA-OAEP
           decryptions. Supported arguments are MGF1-SHA1 to MGF1-SHA512 if supported by the driver. The default
           is based on the hash selection.

       <b>--module</b> <u>mod</u>
           Specify a PKCS#11 module (or library) to load.

       <b>--moz-cert</b> <u>filename</u>, <b>-z</b> <u>filename</u>
           Test a Mozilla-like key pair generation and certificate request. Specify the <u>filename</u> to the
           certificate file.

       <b>--output-file</b> <u>filename</u>, <b>-o</b> <u>filename</u>
           Specify the path to a file for output.

       <b>--pin</b> <u>pin</u>, <b>-p</b> <u>pin</u>
           Use the given <u>pin</u> for token operations. If set to env:<u>VARIABLE</u>, the value of the environment variable
           <u>VARIABLE</u> is used. WARNING: Be careful using this option as other users may be able to read the
           command line from the system or if it is embedded in a script. If set to env:<u>VARIABLE</u>, the value of
           the environment variable <u>VARIABLE</u> is used.

           This option will also set the <b>--login</b> option.

       <b>--puk</b> <u>puk</u>
           Supply User PUK on the command line.

       <b>--new-pin</b> <u>pin</u>
           Supply new User PIN on the command line.

       <b>--sensitive</b>
           Set the CKA_SENSITIVE attribute (object cannot be revealed in plaintext).

       <b>--extractable</b>
           Set the CKA_EXTRACTABLE attribute (object can be extracted)

       <b>--undestroyable</b>
           Set the CKA_DESTROYABLE attribute to false (object cannot be destroyed)

       <b>--set-id</b> <u>id</u>, <b>-e</b> <u>id</u>
           Set the CKA_ID of the object.

       <b>--show-info</b>, <b>-I</b>
           Display general token information.

       <b>--sign</b>, <b>-s</b>
           Sign some data.

       <b>--decrypt</b>,
           Decrypt some data.

       <b>--encrypt</b>,
           Encrypt some data.

       <b>--unwrap</b>,
           Unwrap key.

       <b>--wrap</b>,
           Wrap key.

       <b>--derive</b>,
           Derive a secret key using another key and some data.

       <b>--derive-pass-der</b>,
           Derive ECDHpass DER encoded pubkey for compatibility with some PKCS#11 implementations

       <b>--salt-len</b> <u>bytes</u>
           Specify how many bytes of salt should be used in RSA-PSS signatures. Accepts two special values: "-1"
           means salt length equals to digest length, "-2" or "-3" means use maximum permissible length. For
           verify operation "-2" means that the salt length is automatically recovered from signature. The value
           "-2" for the verify operation is supported for opensc pkcs#11 module only. Default is digest length
           (-1).

       <b>--slot</b> <u>id</u>
           Specify the id of the slot to use (accepts HEX format with 0x.. prefix or decimal number).

       <b>--slot-description</b> <u>description</u>
           Specify the description of the slot to use.

       <b>--slot-index</b> <u>index</u>
           Specify the index of the slot to use.

       <b>--object-index</b> <u>index</u>
           Specify the index of the object to use.

       <b>--use-locking</b>
           Tell pkcs11 module it should use OS thread locking.

       <b>--test-threads</b> <u>options</u>
           Test a pkcs11 module's thread implication. (See source code).

       <b>--token-label</b> <u>label</u>
           Specify the label of token. Will be used the first slot, that has the inserted token with this label.

       <b>--so-pin</b> <u>pin</u>
           Use the given <u>pin</u> as the Security Officer PIN for some token operations (token initialization, user
           PIN initialization, etc). If set to env:<u>VARIABLE</u>, the value of the environment variable <u>VARIABLE</u> is
           used. The same warning as <b>--pin</b> also applies here.

       <b>--test</b>, <b>-t</b>
           Perform some tests on the token. This option is most useful when used with either <b>--login</b> or <b>--pin</b>.

       <b>--test-hotplug</b>
           Test hotplug capabilities (C_GetSlotList + C_WaitForSlotEvent).

       <b>--private</b>
           Set the CKA_PRIVATE attribute (object is only viewable after a login).

       <b>--always-auth</b>
           Set the CKA_ALWAYS_AUTHENTICATE attribute to a private key object. If set, the user has to supply the
           PIN for each use (sign or decrypt) with the key.

       <b>--allowed-mechanisms</b> <u>mechanisms</u>
           Sets the CKA_ALLOWED_MECHANISMS attribute to a key objects when importing an object or generating a
           keys. The argument accepts comma-separated list of algorithmsm, that can be used with the given key.

       <b>--test-ec</b>
           Test EC (best used with the <b>--login</b> or <b>--pin</b> option).

       <b>--test-fork</b>
           Test forking and calling C_Initialize() in the child.

       <b>--type</b> <u>type</u>, <b>-y</b> <u>type</u>
           Specify the type of object to operate on. Valid value are cert, privkey, pubkey, secrkey and data.

       <b>--verbose</b>, <b>-v</b>
           Cause <b>pkcs11-tool</b> to be more verbose.

           NB! This does not affect OpenSC debugging level! To set OpenSC PKCS#11 module into debug mode, set
           the <u>OPENSC_DEBUG</u> environment variable to a non-zero number.

       <b>--verify</b>,
           Verify signature of some data.

       <b>--read-object</b>, <b>-r</b>
           Get object's CKA_VALUE attribute (use with <b>--type</b>).

       <b>--delete-object</b>, <b>-b</b>
           Delete an object.

       <b>--application-label</b> <u>label</u>
           Specify the application label of the data object (use with <b>--type</b> data).

       <b>--application-id</b> <u>id</u>
           Specify the application ID of the data object (use with <b>--type</b> data).

       <b>--issuer</b> <u>data</u>
           Specify the issuer in hexadecimal format (use with <b>--type</b> cert).

       <b>--subject</b> <u>data</u>
           Specify the subject in hexadecimal format (use with <b>--type</b> cert/privkey/pubkey).

       <b>--signature-file</b> <u>filename</u>
           The path to the signature file for signature verification

       <b>--signature-format</b> <u>format</u>
           Format for ECDSA signature: 'rs' (default), 'sequence', 'openssl'.

       <b>--write-object</b> <u>filename</u>, <b>-w</b> <u>filename</u>
           Write a key or certificate object to the token.  <u>filename</u> points to the DER-encoded certificate or
           key file.

       <b>--generate-random</b> <u>num</u>
           Get <u>num</u> bytes of random data.

       <b>--allow-sw</b>
           Allow using software mechanisms that do not have the CKF_HW flag set. May be required when using
           software tokens and emulators.

       <b>--iv</b> <u>data</u>
           Initialization vector for symmetric ciphers. The <u>data</u> is hexadecimal number, i.e. "000013aa7bffa0".

       <b>--mac-general-param</b> <u>num</u>
           Sets the length of the MAC for the general-length MACing mechanisms to <u>num</u> bytes.

       <b>--aad</b> <u>data</u>
           Additional authenticated data for AEAD ciphers. The <u>data</u> is an hexadecimal number.

       <b>--tag-bits-len</b> <u>num</u>
           Sets the length of the tag for AEAD ciphers to <u>num</u> bits.

       <b>--salt-file</b> <u>filename</u>
           Specify the file containing the salt for HKDF (optional)

       <b>--info-file</b> <u>filename</u>
           Specify the file containing the info for HKDF (optional)

</pre><h4><b>EXAMPLES</b></h4><pre>
       Perform a basic functionality test of the card:

           pkcs11-tool --test --login

       List all certificates on the smart card:

           pkcs11-tool --list-objects --type cert

       Read the certificate with ID <u>CERT_ID</u> in DER format from smart card and convert it to PEM via OpenSSL:

           pkcs11-tool --read-object --id $CERT_ID --type cert \
                                    --output-file cert.der
           openssl x509 -inform DER -in cert.der -outform PEM &gt; cert.pem

       Write a certificate to token:

           pkcs11-tool --login --write-object certificate.der --type cert

       Generate new RSA Key pair:

           pkcs11-tool --login --keypairgen --key-type RSA:2048

       Generate new extractable RSA Key pair:

           pkcs11-tool --login --keypairgen --key-type RSA:2048 --extractable

       Generate an elliptic curve key pair with OpenSSL and import it to the card as <u>$ID</u>:

           openssl genpkey -out EC_private.der -outform DER \
                -algorithm EC -pkeyopt ec_paramgen_curve:P-521
           pkcs11-tool --write-object EC_private.der --id "$ID" \
                --type privkey --label "EC private key" -p "$PIN"
           openssl pkey -in EC_private.der -out EC_public.der \
                -pubout -inform DER -outform DER
           pkcs11-tool --write-object EC_public.der --id "$ID" \
                --type pubkey  --label "EC public key" -p $PIN

       List private keys:

           pkcs11-tool --login --list-objects --type privkey

       Sign some data stored in file data using the private key with ID <u>ID</u> and using the RSA-PKCS mechanism:

           pkcs11-tool --sign --id $ID --mechanism RSA-PKCS \
                --input-file data --output-file data.sig

       The same is also possible by piping the data from stdin rather than specifying a input file:

           dd if=data bs=128 count=1 \
                | pkcs11-tool --sign --id $ID --mechanism RSA-PKCS \
                &gt; data.sig

       Verify the signed data:

           pkcs11-tool --id ID --verify -m RSA-PKCS \
                --input-file data --signature-file data.sig

       To encrypt file using the AES key with ID 85 and using mechanism AES-CBC with padding:

           pkcs11-tool --login --encrypt --id 85 -m AES-CBC-PAD \
                --iv "00000000000000000000000000000000" \
                -i file.txt -o encrypted_file.data

       Decipher the encrypted file:

           pkcs11-tool --login --decrypt --id 85 -m AES-CBC-PAD \
                --iv "00000000000000000000000000000000" \
                --i encrypted_file.data -o decrypted.txt

       Use the key with ID 75 using mechanism AES-CBC-PAD, with initialization vector
       "00000000000000000000000000000000" to wrap the key with ID 76 into output file exported_aes.key

           pkcs11-tool --login --wrap --id 75 --mechanism AES-CBC-PAD \
                --iv "00000000000000000000000000000000" \
                --application-id 76 \
                --output-file exported_aes.key

       Use the key with ID 22 and mechanism RSA-PKCS to unwrap key from file aes_wrapped.key. After a successful
       unwrap operation, a new AES key is created on token. ID of this key is set to 90 and label of this key is
       set to unwrapped-key Note: for the MyEID card, the AES key size must be present in key specification i.e.
       AES:16

           pkcs11-tool --login --unwrap --mechanism RSA-PKCS --id 22 \
                -i aes_wrapped.key --key-type AES: \
                --application-id 90 --applicatin-label unwrapped-key

       Use the SO-PIN to initialize or re-set the PIN:

           pkcs11-tool --login --login-type so --init-pin

</pre><h4><b>AUTHORS</b></h4><pre>
       <b>pkcs11-tool</b> was written by Olaf Kirch &lt;<a href="mailto:okir@suse.de">okir@suse.de</a>&gt;.

opensc                                             03/22/2025                                     <u><a href="../man1/PKCS11-TOOL.1.html">PKCS11-TOOL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>