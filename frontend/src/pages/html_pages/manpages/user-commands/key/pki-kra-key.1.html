<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pki-key - Command-line interface for managing keys in PKI KRA.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/pki-tools">pki-tools_11.0.0-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pki-key - Command-line interface for managing keys in PKI KRA.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key</b>
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-find</b> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-show</b> <u>key-ID</u> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-request-find</b> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-request-show</b> <u>request-ID</u> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-mod</b> <u>key-ID</u> --status <u>status</u> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-template-find</b> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-template-show</b> <u>template-ID</u> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-archive</b> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-retrieve</b> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-generate</b> <u>client-key-ID</u> --key-algorithm <u>algorithm</u> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-recover</b> [<u>command-options</u>]
       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-request-review</b> <u>request-ID</u> --action <u>action</u> [<u>command-options</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>pki</b> <b>kra-key</b> commands provide command-line interfaces to manage keys on the KRA.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key</b>
           This command is to list available key commands.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-find</b> [<u>command-options</u>]
           This command is to list keys.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-show</b> <u>key-ID</u> [<u>command-options</u>]
           This command is to view the details of a key in the KRA.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-request-find</b> [<u>command-options</u>]
           This command is to list key requests.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-request-show</b> <u>request-ID</u> [<u>command-options</u>]
           This command is to view the details of a key request submitted to the KRA.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-mod</b> <u>key-ID</u> --status <u>status</u> [<u>command-options</u>]
           This command is to modify the status of a particular key in the KRA.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-template-find</b> [<u>command-options</u>]
           This command is to list the templates for all types of requests in the system.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-template-show</b> <u>template-ID</u> [<u>command-options</u>]
           This command is to view details of the template of a specific key request.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-archive</b> [<u>command-options</u>]
           This command is to archive a secret in the KRA.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-retrieve</b> [<u>command-options</u>]
           This command is to retrieve a secret stored in the KRA.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-generate</b> <u>client-key-ID</u> --key-algorithm <u>algorithm</u> [<u>command-options</u>]
           This command is to generate a key in the KRA.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-recover</b> [<u>command-options</u>]
           This command is to recover details of a key in the KRA.

       <b>pki</b> [<u>CLI-options</u>] <b>kra-key-request-review</b> --action <u>action</u> [<u>command-options</u>]
           This command is to review a key request submitted ot the KRA.

</pre><h4><b>OPTIONS</b></h4><pre>
       The CLI options are described in <b><a href="../man1/pki.1.html">pki</a>(1)</b>.

</pre><h4><b>OPERATIONS</b></h4><pre>
       To   view   available  key  commands,  type  <b>pki</b>  <b>kra-key</b>.   To  view  each  command's  usage,  type  <b>pki</b>
       <b>kra-key-lt;commandgt;</b> <b>--help</b>.

       All the key commands require agent authentication.

   <b>Viewing</b> <b>the</b> <b>keys</b>
       To view the keys stored in KRA:

              $ pki &lt;agent authentication&gt; kra-key-find

       To view all active keys for a specific client key ID:

              $ pki &lt;agent authentication&gt; kra-key-find --clientKeyID &lt;Client Key ID&gt; --status active

       To view details of a specific key:

              $ pki &lt;agent authentication&gt; kra-key-show &lt;KeyID&gt;

   <b>Archiving</b> <b>a</b> <b>key</b>
       To archive a passphrase in the KRA:

              $ pki &lt;agent authentication&gt; kra-key-archive --clientKeyID &lt;Client Key ID&gt; \
                  --passphrase &lt;Passphrase&gt;

       A symmetric key can be archived using the "archiveKey" request template.

       To archive a secret using the request template stored in a file:

              $ pki &lt;agent authentication&gt; kra-key-archive --input &lt;path to the template file&gt;

   <b>Retrieving</b> <b>a</b> <b>key</b>
       To retrieve a key using the key ID:

              $ pki &lt;agent authentication&gt; kra-key-retrieve --keyID &lt;Key Identifier&gt;

       To retrieve a key using a recovery request template:

              $ pki &lt;agent authentication&gt; kra-key-retrieve --input &lt;template_file&gt;

       To retrieve a key encrypted in a custom password:

              $ pki &lt;agent authentication&gt; kra-key-retrieve --keyID &lt;Key Identifier&gt; --passphrase &lt;passphrase&gt;

       The returned output contains the secret wrapped in the provided passphrase, using DES3 algorithm, and the
       nonce used for encryption.

       To store the key information to an output file, use the <b>--output</b> option for the command.

   <b>Recovering</b> <b>a</b> <b>key</b>
       To initiate a key recovery:

              $ pki &lt;agent authentication&gt; kra-key-recover --keyID &lt;Key Identifier&gt;

       The request ID returned by this operation must be approved using the  <b>key-request-review</b>  command  before
       the actual key retrieval.

       To  actually recover (retrieve) the PKCS12 of the private key, use the "recovery request template" method
       listed above under "Retrieving a key"

   <b>Generating</b> <b>a</b> <b>Symmetric</b> <b>Key</b>
       To generate a symmetric key using the DES3 algorithm:

              $ pki &lt;agent authentication&gt; kra-key-generate &lt;Client Key ID&gt; \
                  --key-algorithm DES3 --usages wrap,unwrap

       There are other algorithms to generate symmetric keys such as the AES, DES, DESede, RC2, RC4.

       In case of using any of the  AES/RC2/RC4  algorithms,  the  key  size  has  to  be  specified  using  the
       kra-key-size option of the command.

       Generation of asymmetric keys is currently not implemented.

   <b>Reviewing</b> <b>a</b> <b>key</b> <b>request</b>
       To approve a key request:

              $ pki &lt;agent authentication&gt; kra-key-request-review &lt;Request ID&gt; --action approve

       On successful authentication, the request with the given request ID will be approved.

       There other actions that can be performed by an agent are reject/cancel.

   <b>Viewing</b> <b>a</b> <b>request</b> <b>template</b>
       To list all the key request templates:

              $ pki &lt;agent authentication&gt; kra-key-template-find

       To view a key archival request template:

              $ pki &lt;agent authentication&gt; kra-key-template-show archiveKey

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  following  pki  client examples show the usage of the above operations for a basic CA and KRA server
       installation.

       Only an agent can perform operations on  the  <b>key</b>  resource.  An  agent  certificate  must  be  used  for
       authentication.   This can be done by importing an agent certificate into an NSS database and passing the
       values to relevant options provided by the pki CLI framework.

       Running the following commands will set up the NSS database for use  by  a  pki  client  and  import  the
       agent's  certificate  into  the database and list information( including the nickname) of the certificate
       stored in the database.

              $ certutil -N -d &lt;CERT_DB&gt;
              $ pk12util -i &lt;Agent_Cert_P12_FILE&gt; -d &lt;CERT_DB&gt;
              $ certutil -L -d &lt;CERT_DB&gt;

       The first command creates an NSS database. It asks to enter a password  for  the  database.   The  second
       command imports the agent certificate in a PKCS12 format into the database.  It prompts for the passwords
       of  the  PKCS12  file  and  the NSS database.  The third command shows the information about the imported
       certificate.(including the nickname)

       For demonstration purposes, the administrator certificate can be used to  perform  agent  authentication.
       In a basic installation setup, the admin cert can be found at /root/.dogtag/pki-tomcat/ca_admin_cert.p12.
       Since the installation can only be performed by a root user, this file must be copied to a location where
       other users can access it, with valid permissions.

       On  completion  of  the setup, and, when issuing the first command using the authentication parameters, a
       user may be greeted with a warning message which indicates that  an  untrusted  issuer  was  encountered.
       Simply  reply 'Y' to import the CA certificate, and, presuming that the displayed CA server URL is valid,
       press the carriage return.

       To list all the keys and key requests stored in KRA:

              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-find
              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-request-find

       To view information of a specific key or a key request stored in KRA:

              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-show *key-ID*
              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-request-show &lt;Request ID&gt;

       Creating a request for archiving/retrieving/recovering a key

              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-archive \
                  --clientKeyID "vek12345" --passphrase "SampleSecret"
              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-retrieve \
                  --keyID &lt;Key ID of the archived secret&gt;
              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-recover \
                  --keyID &lt;Key ID of the archived secret&gt;

       Generating a symmetric key

              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-generate \
                  "vek123456" --key-algorithm DES3 --usages "encrypt,decrypt"

       Reviewing a key request

              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-request-review &lt;Request ID&gt; \
                  --action &lt;approve/reject/cancel&gt;

</pre><h4><b>Using</b> <b>templates</b> <b>for</b> <b>creating</b> <b>requests</b> <b>(for</b> <b>advanced</b> <b>users)</b></h4><pre>
       The messages for communication between the CLI framework and KRA  for  accessing  the  key  resource  are
       always encrypted.

       In  the  case  of  the  above  mentioned  examples,  the encryption and decryption of the secrets is done
       internally by the PKI client API.

       But, applications using the CLI framework to create various requests and also use  local  encryption,  so
       the xml templates can be used to supply data to the create a request.

       All the templates can be listed by executing:

              $ pki kra-key-template-find

   <b>Creating</b> <b>a</b> <b>kra-key-archival</b> <b>request</b>
       To fetch the template for key archival:

              $ pki kra-key-template-show archiveKey --output &lt;output file&gt;

       This command gets the template for a key archival request and stores it in an output file.

       Following is the description of the various parameters in the key archival template:

              • clientKeyID - Unique identifier for the secret.

              • dataType - Type of the data to be stored which can be passphrase/symmetricKey/asymmetricKey.

              • keyAlgorithm  -  Algorithm  used  to  create  a  symmetric key. (Not required if the dataType is
                passphrase)

              • keySize - Size used to generate the symmetric key. (Not required if the dataType is passphrase)

              • algorithmOID - Key Algorithm object identifier

              • symmetricAlgorithmParams - Base64 encoded nonce data. Nonce used while encrypting the secret.

              • wrappedPrivateData - Secret encrypted using a session key(A symmetric key) encoded using Base64.
                This entity contains the secret which is encrypted using a session key.

              • transWrappedSessionKey - The session key used to encrypt  the  secret,  wrapped  using  the  KRA
                transport key, and encoded in Base64 format.

              • pkiArchiveOptions  -  An  object  of  type  PKIArchiveOptions provided by the NSS/JSS library to
                securely transport a secret encoded in Base64 format.

       To create an archival request using the template file:

              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-archive \
                  --input &lt;template_file&gt;

   <b>Creating</b> <b>a</b> <b>kra-key-retrieval</b> <b>request</b>
       To fetch the template for key retrieval:

              $ pki kra-key-template-show retrieveKey --output &lt;output file&gt;

       This command gets the template for a key retrieval request and stores it in an output file.

       Following is the description of the various parameters in the key retrieval template:

              • keyID - Key identifier

              • requestID - Key request identifier

              • nonceData - Base64 encoded string of  nonce  used  during  encryption  (unused  for  PKCS12  key
                recovery)

              • passphrase - passphrase to encrypt the secret with/ passphrase for the PKCS12 file returned

              • sessionWrappedpassphrase  -  Base64 encoded string of - Passphrase encrypted with a session key.
                (unused for PKCS12 key recovery)

              • transWrapedSessionKey - Base64 encoded string of - session key encrypted  with  KRA's  transport
                key. (unused for PKCS12 key recovery)

              • certificate - Base64 encoded certificate for recovering the key.

       To  retrieve  (recover)  keys  using  the  template  file  (note: key recovery into PKCS12 can only use a
       template file):

              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-retrieve \
                  --input &lt;template_file&gt;

   <b>Creating</b> <b>a</b> <b>symmetric</b> <b>key</b> <b>generation</b> <b>request</b>
       To fetch the template for symmetric key generation:

              $ pki kra-key-template-show generateKey --output &lt;output file&gt;

       This command gets the template for a symmetric key generation request and stores it in an output file.

       Following is the description of the various parameters in the key retrieval template:

              • clientKeyID - Client specified unique key identifier

              • keyAlgorithm - Algorithm to be used to generate key (AES/DES/DES3/DESede/RC2/RC4)

              • keySize - Value for the size of the key to be generated.

              • keyUsage  -  usages  of  the  generated  key.   Useful   for   Symmetric   Keys   (DES3,AES,etc)
                (wrap,unwrap,encrypt,decrypt).      Useful     for     Asymmetric     Keys     (RSA,     EC,etc)
                (wrap,unwrap,encrypt,decrypt,sign,verify,sign_recover,verify_recover).

       To create a key generation request using the template file:

              $ pki -d &lt;CERT_DB&gt; -c &lt;CERT_DB_PWD&gt; -n &lt;Certificate_Nickname&gt; kra-key-generate \
                  --input &lt;template_file&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/pkispawn.8.html">pkispawn</a>(8)</b>, <b><a href="../man1/pki.1.html">pki</a>(1)</b>

</pre><h4><b>AUTHORS</b></h4><pre>
       Ade   Lee   lt;<a href="mailto:alee@redhat.comgt">alee@redhat.comgt</a>;,   Endi   S.   Dewata   lt;<a href="mailto:edewata@redhat.comgt">edewata@redhat.comgt</a>;,    Matthew    Harmsen
       lt;<a href="mailto:mharmsen@redhat.comgt">mharmsen@redhat.comgt</a>;, Christina Fu lt;<a href="mailto:cfu@redhat.com">cfu@redhat.com</a>;, and Abhishek Koneru lt;<a href="mailto:akoneru@redhat.comgt">akoneru@redhat.comgt</a>;.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright  (c)  2014  Red  Hat,  Inc.   This  is licensed under the GNU General Public License, version 2
       (GPLv2).  A copy of this license is available at <a href="http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt">http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt</a>.

PKI                                                May 5, 2014                                    <u><a href="../man1/pki-kra-key.1.html">pki-kra-key</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>