<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pk12util - Export and import keys and certificate to or from a PKCS #12 file and the NSS database</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/libnss3-tools">libnss3-tools_3.108-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pk12util - Export and import keys and certificate to or from a PKCS #12 file and the NSS database

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>pk12util</b> [-i p12File|-l p12File|-o p12File] [-c keyCipher] [-C certCipher] [-d directory] [-h tokenname]
                [-m | --key-len keyLength] [-M hashAlg] [-n certname] [-P dbprefix] [-r] [-v]
                [--cert-key-len certKeyLength] [-k slotPasswordFile|-K slotPassword]
                [-w p12filePasswordFile|-W p12filePassword]

</pre><h4><b>STATUS</b></h4><pre>
       This documentation is still work in progress. Please contribute to the initial review in <b>Mozilla</b> <b>NSS</b> <b>bug</b>
       <b>836477</b>[1]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The PKCS #12 utility, <b>pk12util</b>, enables sharing certificates among any server that supports PKCS #12. The
       tool can import certificates and keys from PKCS #12 files into security databases, export certificates,
       and list certificates and keys.

</pre><h4><b>OPTIONS</b> <b>AND</b> <b>ARGUMENTS</b></h4><pre>
       <b>Options</b>

       -i p12file
           Import keys and certificates from a PKCS #12 file into a security database.

       -l p12file
           List the keys and certificates in PKCS #12 file.

       -o p12file
           Export keys and certificates from the security database to a PKCS #12 file.

       <b>Arguments</b>

       -c keyCipher
           Specify the key encryption algorithm.

       -C certCipher
           Specify the certiticate encryption algorithm.

       -d directory
           Specify the database directory into which to import to or export from certificates and keys.

           <b>pk12util</b> supports two types of databases: the legacy security databases (cert8.db, key3.db, and
           secmod.db) and new SQLite databases (cert9.db, key4.db, and pkcs11.txt). If the prefix <b>dbm:</b> is not
           used, then the tool assumes that the given databases are in the SQLite format.

       -h tokenname
           Specify the name of the token to import into or export from.

       -k slotPasswordFile
           Specify the text file containing the slot's password.

       -K slotPassword
           Specify the slot's password.

       -m | --key-len keyLength
           Specify the desired length of the symmetric key to be used to encrypt the private key.

       -M hashAlg
           Specify the hash algorithm used in the pkcs #12 mac. This algorithm also specifies the HMAC used in
           the prf when using pkcs #5 v2.

       --cert-key-len certKeyLength
           Specify the desired length of the symmetric key to be used to encrypt the certificates and other
           meta-data.

       -n certname
           Specify the nickname of the cert and private key to export.

           The nickname can also be a PKCS #11 URI. For example, if you have a certificate named
           "my-server-cert" on the internal certificate store, it can be unambiguously specified as
           "pkcs11:token=NSS%20Certificate%20DB;object=my-server-cert". For details about the format, see RFC
           7512.

       -P prefix
           Specify the prefix used on the certificate and key databases. This option is provided as a special
           case. Changing the names of the certificate and key databases is not recommended.

       -r
           Dumps all of the data in raw (binary) form. This must be saved as a DER file. The default is to
           return information in a pretty-print ASCII format, which displays the information about the
           certificates and public keys in the p12 file.

       -v
           Enable debug logging when importing.

       -w p12filePasswordFile
           Specify the text file containing the pkcs #12 file password.

       -W p12filePassword
           Specify the pkcs #12 file password.

</pre><h4><b>RETURN</b> <b>CODES</b></h4><pre>
       •   0 - No error

       •   1 - User Cancelled

       •   2 - Usage error

       •   6 - NLS init error

       •   8 - Certificate DB open error

       •   9 - Key DB open error

       •   10 - File initialization error

       •   11 - Unicode conversion error

       •   12 - Temporary file creation error

       •   13 - PKCS11 get slot error

       •   14 - PKCS12 decoder start error

       •   15 - error read from import file

       •   16 - pkcs12 decode error

       •   17 - pkcs12 decoder verify error

       •   18 - pkcs12 decoder validate bags error

       •   19 - pkcs12 decoder import bags error

       •   20 - key db conversion version 3 to version 2 error

       •   21 - cert db conversion version 7 to version 5 error

       •   22 - cert and key dbs patch error

       •   23 - get default cert db error

       •   24 - find cert by nickname error

       •   25 - create export context error

       •   26 - PKCS12 add password itegrity error

       •   27 - cert and key Safes creation error

       •   28 - PKCS12 add cert and key error

       •   29 - PKCS12 encode error

</pre><h4><b>EXAMPLES</b></h4><pre>
       <b>Importing</b> <b>Keys</b> <b>and</b> <b>Certificates</b>

       The most basic usage of <b>pk12util</b> for importing a certificate or key is the PKCS #12 input file (<b>-i</b>) and
       some way to specify the security database being accessed (either <b>-d</b> for a directory or <b>-h</b> for a token).

       pk12util -i p12File [-h tokenname] [-v] [-d directory] [-P dbprefix] [-k slotPasswordFile|-K
       slotPassword] [-w p12filePasswordFile|-W p12filePassword]

       For example:

           # pk12util -i /tmp/cert-files/users.p12 -d /home/my/sharednssdb

           Enter a password which will be used to encrypt your keys.
           The password should be at least 8 characters long,
           and should contain at least one non-alphabetic character.

           Enter new password:
           Re-enter password:
           Enter password for PKCS12 file:
           pk12util: PKCS12 IMPORT SUCCESSFUL

       <b>Exporting</b> <b>Keys</b> <b>and</b> <b>Certificates</b>

       Using the <b>pk12util</b> command to export certificates and keys requires both the name of the certificate to
       extract from the database (<b>-n</b>) and the PKCS #12-formatted output file to write to. There are optional
       parameters that can be used to encrypt the file to protect the certificate material.

       pk12util -o p12File -n certname [-c keyCipher] [-C certCipher] [-m|--key_len keyLen] [-n|--cert_key_len
       certKeyLen] [-d directory] [-P dbprefix] [-k slotPasswordFile|-K slotPassword] [-w p12filePasswordFile|-W
       p12filePassword]

       For example:

           # pk12util -o certs.p12 -n Server-Cert -d /home/my/sharednssdb
           Enter password for PKCS12 file:
           Re-enter password:

       <b>Listing</b> <b>Keys</b> <b>and</b> <b>Certificates</b>

       The information in a .p12 file are not human-readable. The certificates and keys in the file can be
       printed (listed) in a human-readable pretty-print format that shows information for every certificate and
       any public keys in the .p12 file.

       pk12util -l p12File [-h tokenname] [-r] [-d directory] [-P dbprefix] [-k slotPasswordFile|-K
       slotPassword] [-w p12filePasswordFile|-W p12filePassword]

       For example, this prints the default ASCII output:

           # pk12util -l certs.p12

           Enter password for PKCS12 file:
           Key(shrouded):
               Friendly Name: Thawte Freemail Member's Thawte Consulting (Pty) Ltd. ID

               Encryption algorithm: PKCS #12 V2 PBE With SHA-1 And 3KEY Triple DES-CBC
                   Parameters:
                       Salt:
                           45:2e:6a:a0:03:4d:7b:a1:63:3c:15:ea:67:37:62:1f
                       Iteration Count: 1 (0x1)
           Certificate:
               Data:
                   Version: 3 (0x2)
                   Serial Number: 13 (0xd)
                   Signature Algorithm: PKCS #1 SHA-1 With RSA Encryption
                   Issuer: "E=<a href="mailto:personal-freemail@thawte.com">personal-freemail@thawte.com</a>,CN=Thawte Personal Freemail C
                       A,OU=Certification Services Division,O=Thawte Consulting,L=Cape T
                       own,ST=Western Cape,C=ZA"

       Alternatively, the <b>-r</b> prints the certificates and then exports them into separate DER binary files. This
       allows the certificates to be fed to another application that supports .p12 files. Each certificate is
       written to a sequentially-number file, beginning with file0001.der and continuing through file000N.der,
       incrementing the number for every certificate:

           pk12util -l test.p12 -r
           Enter password for PKCS12 file:
           Key(shrouded):
               Friendly Name: Thawte Freemail Member's Thawte Consulting (Pty) Ltd. ID

               Encryption algorithm: PKCS #12 V2 PBE With SHA-1 And 3KEY Triple DES-CBC
                   Parameters:
                       Salt:
                           45:2e:6a:a0:03:4d:7b:a1:63:3c:15:ea:67:37:62:1f
                       Iteration Count: 1 (0x1)
           Certificate    Friendly Name: Thawte Personal Freemail Issuing CA - Thawte Consulting

           Certificate    Friendly Name: Thawte Freemail Member's Thawte Consulting (Pty) Ltd. ID

</pre><h4><b>PASSWORD</b> <b>ENCRYPTION</b></h4><pre>
       PKCS #12 provides for not only the protection of the private keys but also the certificate and meta-data
       associated with the keys. Password-based encryption is used to protect private keys on export to a PKCS
       #12 file and, optionally, the associated certificates. If no algorithm is specified, the tool defaults to
       using PKCS #12 SHA-1 and 3-key triple DES for private key encryption. When not in FIPS mode, PKCS #12
       SHA-1 and 40-bit RC4 is used for certificate encryption. When in FIPS mode, there is no certificate
       encryption. If certificate encryption is not wanted, specify <b>"NONE"</b> as the argument of the <b>-C</b> option.

       The private key is always protected with strong encryption by default.

       Several types of ciphers are supported.

       PKCS #5 password-based encryption

           •   PBES2 with AES-CBC-Pad as underlying encryption scheme (<b>"AES-128-CBC"</b>, <b>"AES-192-CBC"</b>, and
               <b>"AES-256-CBC"</b>)

       PKCS #12 password-based encryption

           •   SHA-1 and 128-bit RC4 (<b>"PKCS</b> <b>#12</b> <b>V2</b> <b>PBE</b> <b>With</b> <b>SHA-1</b> <b>And</b> <b>128</b> <b>Bit</b> <b>RC4"</b> or <b>"RC4"</b>)

           •   SHA-1 and 40-bit RC4 (<b>"PKCS</b> <b>#12</b> <b>V2</b> <b>PBE</b> <b>With</b> <b>SHA-1</b> <b>And</b> <b>40</b> <b>Bit</b> <b>RC4"</b>) (used by default for
               certificate encryption in non-FIPS mode)

           •   SHA-1 and 3-key triple-DES (<b>"PKCS</b> <b>#12</b> <b>V2</b> <b>PBE</b> <b>With</b> <b>SHA-1</b> <b>And</b> <b>3KEY</b> <b>Triple</b> <b>DES-CBC"</b> or
               <b>"DES-EDE3-CBC"</b>)

           •   SHA-1 and 128-bit RC2 (<b>"PKCS</b> <b>#12</b> <b>V2</b> <b>PBE</b> <b>With</b> <b>SHA-1</b> <b>And</b> <b>128</b> <b>Bit</b> <b>RC2</b> <b>CBC"</b> or <b>"RC2-CBC"</b>)

           •   SHA-1 and 40-bit RC2 (<b>"PKCS</b> <b>#12</b> <b>V2</b> <b>PBE</b> <b>With</b> <b>SHA-1</b> <b>And</b> <b>40</b> <b>Bit</b> <b>RC2</b> <b>CBC"</b>)

       With PKCS #12, the crypto provider may be the soft token module or an external hardware module. If the
       cryptographic module does not support the requested algorithm, then the next best fit will be selected
       (usually the default). If no suitable replacement for the desired algorithm can be found, the tool
       returns the error <u>no</u> <u>security</u> <u>module</u> <u>can</u> <u>perform</u> <u>the</u> <u>requested</u> <u>operation</u>.

</pre><h4><b>NSS</b> <b>DATABASE</b> <b>TYPES</b></h4><pre>
       NSS originally used BerkeleyDB databases to store security information. The last versions of these <u>legacy</u>
       databases are:

       •   cert8.db for certificates

       •   key3.db for keys

       •   secmod.db for PKCS #11 module information

       BerkeleyDB has performance limitations, though, which prevent it from being easily used by multiple
       applications simultaneously. NSS has some flexibility that allows applications to use their own,
       independent database engine while keeping a shared database and working around the access issues. Still,
       NSS requires more flexibility to provide a truly shared security database.

       In 2009, NSS introduced a new set of databases that are SQLite databases rather than BerkleyDB. These new
       databases provide more accessibility and performance:

       •   cert9.db for certificates

       •   key4.db for keys

       •   pkcs11.txt, which is listing of all of the PKCS #11 modules contained in a new subdirectory in the
           security databases directory

       Because the SQLite databases are designed to be shared, these are the <u>shared</u> database type. The shared
       database type is preferred; the legacy format is included for backward compatibility.

       By default, the tools (<b>certutil</b>, <b>pk12util</b>, <b>modutil</b>) assume that the given security databases use the
       SQLite type Using the legacy databases must be manually specified by using the <b>dbm:</b> prefix with the given
       security directory. For example:

           # pk12util -i /tmp/cert-files/users.p12 -d dbm:/home/my/sharednssdb

       To set the legacy database type as the default type for the tools, set the <b>NSS_DEFAULT_DB_TYPE</b>
       environment variable to <b>dbm</b>:

           export NSS_DEFAULT_DB_TYPE="dbm"

       This line can be set added to the <a href="file:~/.bashrc">~/.bashrc</a> file to make the change permanent.

       •   https://wiki.mozilla.org/NSS_Shared_DB_Howto

       For an engineering draft on the changes in the shared NSS databases, see the NSS project wiki:

       •   https://wiki.mozilla.org/NSS_Shared_DB

</pre><h4><b>COMPATIBILITY</b> <b>NOTES</b></h4><pre>
       The exporting behavior of <b>pk12util</b> has changed over time, while importing files exported with older
       versions of NSS is still supported.

       Until the 3.30 release, <b>pk12util</b> used the UTF-16 encoding for the PKCS #5 password-based encryption
       schemes, while the recommendation is to encode passwords in UTF-8 if the used encryption scheme is
       defined outside of the PKCS #12 standard.

       Until the 3.31 release, even when <b>"AES-128-CBC"</b> or <b>"AES-192-CBC"</b> is given from the command line, <b>pk12util</b>
       always used 256-bit AES as the underlying encryption scheme.

       For historical reasons, <b>pk12util</b> accepts password-based encryption schemes not listed in this document.
       However, those schemes are not officially supported and may have issues in interoperability with other
       tools.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       certutil (1)

       modutil (1)

       The NSS wiki has information on the new database design and how to configure applications to use it.

       •   https://wiki.mozilla.org/NSS_Shared_DB_Howto

       •   https://wiki.mozilla.org/NSS_Shared_DB

</pre><h4><b>ADDITIONAL</b> <b>RESOURCES</b></h4><pre>
       For information about NSS and other tools related to NSS (like JSS), check out the NSS project wiki at
       <b><a href="http://www.mozilla.org/projects/security/pki/nss/">http://www.mozilla.org/projects/security/pki/nss/</a></b>. The NSS site relates directly to NSS code changes and
       releases.

       Mailing lists: https://lists.mozilla.org/listinfo/dev-tech-crypto

       IRC: Freenode at #dogtag-pki

</pre><h4><b>AUTHORS</b></h4><pre>
       The NSS tools were written and maintained by developers with Netscape, Red Hat, Sun, Oracle, Mozilla, and
       Google.

       Authors: Elio Maldonado &lt;<a href="mailto:emaldona@redhat.com">emaldona@redhat.com</a>&gt;, Deon Lackey &lt;<a href="mailto:dlackey@redhat.com">dlackey@redhat.com</a>&gt;.

</pre><h4><b>LICENSE</b></h4><pre>
       Licensed under the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed with this
       file, You can obtain one at <a href="http://mozilla.org/MPL/2.0/">http://mozilla.org/MPL/2.0/</a>.

</pre><h4><b>NOTES</b></h4><pre>
        1. Mozilla NSS bug 836477
           https://bugzilla.mozilla.org/show_bug.cgi?id=836477

nss-tools                                          19 May 2021                                       <u><a href="../man1/PK12UTIL.1.html">PK12UTIL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>