<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sc-hsm-tool - smart card utility for SmartCard-HSM</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/opensc">opensc_0.26.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sc-hsm-tool - smart card utility for SmartCard-HSM

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>sc-hsm-tool</b> [<u>OPTIONS</u>]

       The <b>sc-hsm-tool</b> utility can be used from the command line to perform extended maintenance tasks not
       available via PKCS#11 or other tools in the OpenSC package. It can be used to query the status of a
       SmartCard-HSM, initialize a device, generate and import Device Key Encryption Key (DKEK) shares and to
       wrap and unwrap keys.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--initialize</b>, <b>-X</b>
           Initialize token, removing all existing keys, certificates and files.

           Use <b>--so-pin</b> to define SO-PIN for first initialization or to verify in subsequent initializations.

           Use <b>--pin</b> to define the initial user pin value.

           Use <b>--pin-retry</b> to define the maximum number of wrong user PIN presentations.

           Use with <b>--dkek-shares</b> to enable key wrap / unwrap.

           Use with <b>--label</b> to define a token label

           Use with <b>--public-key-auth</b> and <b>--required-pub-keys</b> to require public key authentication for login

       <b>--create-dkek-share</b> <u>filename</u>, <b>-C</b> <u>filename</u>
           Create a DKEK share encrypted under a password and save it to the file given as parameter.

           Use <b>--password</b> to provide a password for encryption rather than prompting for one.

           Use <b>--pwd-shares-threshold</b> and <b>--pwd-shares-total</b> to randomly generate a password and split is using
           a (t, n) threshold scheme.

       <b>--import-dkek-share</b> <u>filename</u>, <b>-I</b> <u>filename</u>
           Prompt for user password, read and decrypt DKEK share and import into SmartCard-HSM.

           Use <b>--password</b> to provide a password for decryption rather than prompting for one.

           Use <b>--pwd-shares-total</b> to specify the number of shares that should be entered to reconstruct the
           password.

       <b>--wrap-key</b> <u>filename</u>, <b>-W</b> <u>filename</u>
           Wrap the key referenced in <b>--key-reference</b> and save with it together with the key description and
           certificate to the given file.

           Use <b>--pin</b> to provide the user PIN on the command line.

       <b>--unwrap-key</b> <u>filename</u>, <b>-U</b> <u>filename</u>
           Read wrapped key, description and certificate from file and import into SmartCard-HSM under the key
           reference given in <b>--key-reference</b>.

           Determine the key reference using the output of <b>pkcs15-tool</b> <b>-D</b>.

           Use <b>--pin</b> to provide a user PIN on the command line.

           Use <b>--force</b> to remove any key, key description or certificate in the way.

       <b>--dkek-shares</b> <u>number-of-shares</u>, <b>-s</b> <u>number-of-shares</u>
           Define the number of DKEK shares to use for recreating the DKEK.

           This is an optional parameter. Using <b>--initialize</b> without <b>--dkek-shares</b> will disable the DKEK
           completely.

           Using <b>--dkek-shares</b> with 0 shares requests the SmartCard-HSM to generate a random DKEK. Keys wrapped
           with this DKEK can only be unwrapped in the same SmartCard-HSM.

           After using <b>--initialize</b> with one or more DKEK shares, the SmartCard-HSM will remain in the
           initialized state until all DKEK shares have been imported. During this phase no new keys can be
           generated or imported.

       <b>--pin</b> <u>pin</u>, <b>--so-pin</b> <u>sopin</u>,
           These options can be used to specify the PIN values on the command line. If the value is set to
           env:<u>VARIABLE</u>, the value of the specified environment variable is used. By default, the code is
           prompted on the command line if needed.

           Note that on most operation systems, any user can display the command line of any process on the
           system using utilities such as <b><a href="../man1/ps.1.html">ps</a>(1)</b>. Therefore, you should prefer passing the codes via an
           environment variable on an unsecured system.

       <b>--pin-retry</b> <u>value</u>
           Define number of PIN retries for user PIN during initialization. Default is 3.

       <b>--bio-server1</b> <u>value</u>
           The hexadecimal AID of of the biometric server for template 1. Switches on the use of the user PIN as
           session PIN.

       <b>--bio-server2</b> <u>value</u>
           The hexadecimal AID of of the biometric server for template 2. Switches on the use of the user PIN as
           session PIN.

       <b>--password</b> <u>value</u>
           Define password for DKEK share encryption. If set to env:<u>VARIABLE</u>, the value of the environment
           variable <u>VARIABLE</u> is used.

       <b>--pwd-shares-threshold</b> <u>value</u>
           Define threshold for number of password shares required for reconstruction.

       <b>--pwd-shares-total</b> <u>value</u>
           Define number of password shares.

       <b>--force</b>
           Force removal of existing key, description and certificate.

       <b>--label</b> <u>label</u>, <b>-l</b> <u>label</u>
           Define the token label to be used in --initialize.

       <b>--reader</b> <u>arg</u>, <b>-r</b> <u>arg</u>
           Number of the reader to use. By default, the first reader with a present card is used. If <u>arg</u> is an
           ATR, the reader with a matching card will be chosen.

       <b>--public-key-auth</b> <u>total-number-of-public-keys</u>, <b>-K</b> <u>total-number-of-public-keys</u>
           Define the total number of public keys to use for public key authentication when using <b>--initialize</b>.
           <b>--public-key-auth</b> is optional, but if it's present, it must be used with <b>--required-pub-keys</b>.

           When the SmartCard-HSM is initialized with these options, it will require M-of-N public key
           authentication to be used, where <b>--required-pub-keys</b> sets the M and <b>--public-key-auth</b> sets the N.
           After the initialization, the user should use <b>--register-public-key</b> to register the N public keys
           before the SmartCard-HSM can be used.

       <b>--required-pub-keys</b> <u>required-number-of-public-keys</u>, <b>-n</b> <u>required-number-of-public-keys</u>
           Define the required number of public keys to use for public key authentication when using
           <b>--initialize</b>. This is the M in M-of-N public key authentication. See <b>--public-key-auth</b> for more
           information.

       <b>--register-public-key</b> <u>input-public-key-file</u>, <b>-g</b> <u>input-public-key-file</u>
           Register a public key to be used for M-of-N public key authentication. The file can be exported from
           a different SmartCard-HSM with <b>--export-for-pub-key-auth</b>. This can only be used when the
           SmartCard-HSM has been initialized with <b>--public-key-auth</b> and <b>--required-pub-keys</b> and fewer than N
           public keys have been registered. Use <b>--public-key-auth-status</b> to check the how many public keys have
           been registered.

       <b>--export-for-pub-key-auth</b> <u>output-public-key-file</u>, <b>-e</b> <u>output-public-key-file</u>
           Export a public key to be used for M-of-N public key authentication. This should be used with
           <b>--key-reference</b> to choose the key to export. The file should be registered on another SmartCard-HSM
           using <b>--register-public-key</b>.

       <b>--public-key-auth-status</b> <b>-S</b>
           Print the public key authentication status. This is only valid if the SmartCard-HSM was initialized
           to use M-of-N public key authentication.

       <b>--wait</b>, <b>-w</b>
           Wait for a card to be inserted

       <b>--verbose</b>, <b>-v</b>
           Causes <b>sc-hsm-tool</b> to be more verbose. Specify this flag several times to enable debug output in the
           opensc library.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Create a DKEK share:

       <b>sc-hsm-tool</b> <b>--create-dkek-share</b> <b>dkek-share-1.pbe</b>

       Create a DKEK share with random password split up using a (3, 5) threshold scheme:

       <b>sc-hsm-tool</b> <b>--create-dkek-share</b> <b>dkek-share-1.pbe</b> <b>--pwd-shares-threshold</b> <b>3</b> <b>--pwd-shares-total</b> <b>5</b>

       Initialize SmartCard-HSM to use a single DKEK share:

       <b>sc-hsm-tool</b> <b>--initialize</b> <b>--so-pin</b> <b>3537363231383830</b> <b>--pin</b> <b>648219</b> <b>--dkek-shares</b> <b>1</b> <b>--label</b> <b>mytoken</b>

       Import DKEK share:

       <b>sc-hsm-tool</b> <b>--import-dkek-share</b> <b>dkek-share-1.pbe</b>

       Import DKEK share using a password split up using a (3, 5) threshold scheme for encryption:

       <b>sc-hsm-tool</b> <b>--import-dkek-share</b> <b>dkek-share-1.pbe</b> <b>--pwd-shares-total</b> <b>3</b>

       Wrap referenced key, description and certificate:

       <b>sc-hsm-tool</b> <b>--wrap-key</b> <b>wrap-key.bin</b> <b>--key-reference</b> <b>1</b> <b>--pin</b> <b>648219</b>

       Unwrap key into same or in different SmartCard-HSM with the same DKEK:

       <b>sc-hsm-tool</b> <b>--unwrap-key</b> <b>wrap-key.bin</b> <b>--key-reference</b> <b>10</b> <b>--pin</b> <b>648219</b> <b>--force</b>

       Initialize SmartCard-HSM to use M-of-N public key authentication with M=2 and N=5

       <b>sc-hsm-tool</b> <b>--initialize</b> <b>--required-pub-keys</b> <b>2</b> <b>--public-key-auth</b> <b>5</b>

       Export a public key for M-of-N public key authentication to a file

       <b>sc-hsm-tool</b> <b>--key-reference</b> <b>1</b> <b>--export-for-pub-key-auth</b> <b>./public_key1.asn1</b>

       Register a public key for M-of-N public key authentication from a file

       <b>sc-hsm-tool</b> <b>--register-public-key</b> <b>./public_key1.asn1</b>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/opensc-tool.1.html">opensc-tool</a></b>(1)

</pre><h4><b>AUTHORS</b></h4><pre>
       <b>sc-hsm-tool</b> was written by Andreas Schwier &lt;<a href="mailto:andreas.schwier@cardcontact.de">andreas.schwier@cardcontact.de</a>&gt;.

opensc                                             03/22/2025                                     <u><a href="../man1/SC-HSM-TOOL.1.html">SC-HSM-TOOL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>