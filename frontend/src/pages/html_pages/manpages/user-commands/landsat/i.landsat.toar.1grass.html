<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>i.landsat.toar   -  Calculates  top-of-atmosphere  radiance  or  reflectance  and temperature for Landsat</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/grass-doc">grass-doc_8.4.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>i.landsat.toar</b>   -  Calculates  top-of-atmosphere  radiance  or  reflectance  and temperature for Landsat
       MSS/TM/ETM+/OLI

</pre><h4><b>KEYWORDS</b></h4><pre>
       imagery, radiometric conversion, radiance, reflectance, brightness temperature,  atmospheric  correction,
       satellite, Landsat

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>i.landsat.toar</b>
       <b>i.landsat.toar</b> <b>--help</b>
       <b>i.landsat.toar</b>  [-<b>rnp</b>] <b>input</b>=<u>basename</u> <b>output</b>=<u>basename</u>  [<b>metfile</b>=<u>name</u>]   [<b>sensor</b>=<u>string</u>]   [<b>method</b>=<u>string</u>]
       [<b>date</b>=<u>yyyy-mm-dd</u>]   [<b>sun_elevation</b>=<u>float</u>]   [<b>product_date</b>=<u>yyyy-mm-dd</u>]    [<b>gain</b>=<u>string</u>]    [<b>percent</b>=<u>float</u>]
       [<b>pixel</b>=<u>integer</u>]     [<b>rayleigh</b>=<u>float</u>]     [<b>lsatmet</b>=<u>string</u>[,<u>string</u>,...]]     [<b>scale</b>=<u>float</u>]    [--<b>overwrite</b>]
       [--<b>help</b>]  [--<b>verbose</b>]  [--<b>quiet</b>]  [--<b>ui</b>]

   <b>Flags:</b>
       <b>-r</b>
           Output at-sensor radiance instead of reflectance for all bands

       <b>-n</b>
           Input raster maps use as extension the number of the band instead the code

       <b>-p</b>
           Print output metadata info

       <b>--overwrite</b>
           Allow output files to overwrite existing files

       <b>--help</b>
           Print usage summary

       <b>--verbose</b>
           Verbose module output

       <b>--quiet</b>
           Quiet module output

       <b>--ui</b>
           Force launching GUI dialog

   <b>Parameters:</b>
       <b>input</b>=<u>basename</u> <b>[required]</b>
           Base name of input raster bands
           Example: ’B.’ for B.1, B.2, ...

       <b>output</b>=<u>basename</u> <b>[required]</b>
           Prefix for output raster maps
           Example: ’B.toar.’ generates B.toar.1, B.toar.2, ...

       <b>metfile</b>=<u>name</u>
           Name of Landsat metadata file (.met or MTL.txt)

       <b>sensor</b>=<u>string</u>
           Spacecraft sensor
           Required only if ’metfile’ not given (recommended for sanity)
           Options: <u>mss1,</u> <u>mss2,</u> <u>mss3,</u> <u>mss4,</u> <u>mss5,</u> <u>tm4,</u> <u>tm5,</u> <u>tm7,</u> <u>oli8</u>
           <b>mss1</b>: Landsat-1 MSS
           <b>mss2</b>: Landsat-2 MSS
           <b>mss3</b>: Landsat-3 MSS
           <b>mss4</b>: Landsat-4 MSS
           <b>mss5</b>: Landsat-5 MSS
           <b>tm4</b>: Landsat-4 TM
           <b>tm5</b>: Landsat-5 TM
           <b>tm7</b>: Landsat-7 ETM+
           <b>oli8</b>: Landsat_8 OLI/TIRS

       <b>method</b>=<u>string</u>
           Atmospheric correction method
           Options: <u>uncorrected,</u> <u>dos1,</u> <u>dos2,</u> <u>dos2b,</u> <u>dos3,</u> <u>dos4</u>
           Default: <u>uncorrected</u>

       <b>date</b>=<u>yyyy-mm-dd</u>
           Image acquisition date (yyyy-mm-dd)
           Required only if ’metfile’ not given

       <b>sun_elevation</b>=<u>float</u>
           Sun elevation in degrees
           Required only if ’metfile’ not given

       <b>product_date</b>=<u>yyyy-mm-dd</u>
           Image creation date (yyyy-mm-dd)
           Required only if ’metfile’ not given

       <b>gain</b>=<u>string</u>
           Gain (H/L) of all Landsat ETM+ bands (1-5,61,62,7,8)
           Required only if ’metfile’ not given

       <b>percent</b>=<u>float</u>
           Percent of solar radiance in path radiance
           Required only if ’method’ is any DOS
           Default: <u>0.01</u>

       <b>pixel</b>=<u>integer</u>
           Minimum pixels to consider digital number as dark object
           Required only if ’method’ is any DOS
           Default: <u>1000</u>

       <b>rayleigh</b>=<u>float</u>
           Rayleigh atmosphere (diffuse sky irradiance)
           Required only if ’method’ is DOS3
           Default: <u>0.0</u>

       <b>lsatmet</b>=<u>string[,string</u>,...]
           return value stored for a given metadata
           Required only if ’metfile’ and -p given
           Options: <u>number,</u> <u>creation,</u> <u>date,</u> <u>sun_elev,</u> <u>sensor,</u> <u>bands,</u> <u>sunaz,</u> <u>time</u>
           <b>number</b>: Landsat Number
           <b>creation</b>: Creation timestamp
           <b>date</b>: Date
           <b>sun_elev</b>: Sun Elevation
           <b>sensor</b>: Sensor
           <b>bands</b>: Bands count
           <b>sunaz</b>: Sun Azimuth Angle
           <b>time</b>: Time

       <b>scale</b>=<u>float</u>
           Scale factor for output
           Default: <u>1.0</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>i.landsat.toar</u> is used to transform  the  calibrated  digital  number  of  Landsat  imagery  products  to
       top-of-atmosphere radiance or top-of-atmosphere reflectance and temperature (band 6 of the sensors TM and
       ETM+).  Optionally,  it  can be used to calculate the at-surface radiance or reflectance with atmospheric
       correction (DOS method).

       Usually, to do so the production date,  the  acquisition  date,  and  the  solar  elevation  are  needed.
       Moreover, for Landsat-7 ETM+ it is also needed the gain (high or low) of the nine respective bands.

       Optionally  (recommended), the data can be read from metadata file (.met or MTL.txt) for all Landsat MSS,
       TM, ETM+ and OLI/TIRS. However, if the solar elevation is  given  the  value  of  the  metadata  file  is
       overwritten.  This  is  necessary  when  the data in the .met file is incorrect or not accurate. Also, if
       acquisition or production dates are not found in the metadata file then the command line values are used.

       <b>Attention</b>: Any null value or smaller than QCALmin in the input raster is set to null in the output raster
       and it is not included in the equations.

       <b>Attention</b>: This module does <b>not</b> respect the current  region  settings,  in  order  to  have  the  largest
       possible  sample of pixels from where to get the darkest one of the scene and perform the DOS correction.
       To limit the results to a custom region, the user is advised  to  clip  the  results  (with  r.clip,  for
       instance)  or  to  define  the region first, import the images with region cropping, and then running the
       module.

</pre><h4><b>Uncorrected</b> <b>at-sensor</b> <b>values</b> <b>(method=uncorrected,</b> <b>default)</b></h4><pre>
       The standard geometric and radiometric corrections result in a calibrated  digital  number  (QCAL  =  DN)
       images.  To  further standardize the impact of illumination geometry, the QCAL images are first converted
       first to at-sensor radiance and then to at-sensor reflectance. The thermal band is first  converted  from
       QCAL to at-sensor radiance, and then to effective at-sensor temperature in Kelvin degrees.

       Radiometric  calibration  converts QCAL to <b>at-sensor</b> <b>radiance</b>, a radiometric quantity measured in W/(m² *
       sr * µm) using the equations:

           •   gain = (Lmax - Lmin) / (QCALmax - QCALmin)

           •   bias = Lmin - gain * QCALmin

           •   radiance = gain * QCAL + bias
       where, <u>Lmax</u> and <u>Lmin</u> are the calibration constants, and <u>QCALmax</u> and  <u>QCALmin</u>  are  the  highest  and  the
       lowest points of the range of rescaled radiance in QCAL.

       Then, to calculate <b>at-sensor</b> <b>reflectance</b> the equations are:

           •   sun_radiance = [Esun * sin(e)] / (PI * d^2)

           •   reflectance = radiance / sun_radiance
       where, <u>d</u> is the earth-sun distance in astronomical units, <u>e</u> is the solar elevation angle, and <u>Esun</u> is the
       mean solar exoatmospheric irradiance in W/(m² * µm).

</pre><h4><b>Simplified</b> <b>at-surface</b> <b>values</b> <b>(method=dos[1-4])</b></h4><pre>
       Atmospheric  correction  and  reflectance calibration remove the path radiance, i.e. the stray light from
       the atmosphere, and the spectral effect of solar illumination. To output these simple <b>at-surface</b> <b>radiance</b>
       and <b>at-surface</b> <b>reflectance</b>, the equations are (not for thermal bands):

           •   sun_radiance = TAUv * [Esun * sin(e) * TAUz + Esky] / (PI * d^2)

           •   radiance_path = radiance_dark - percent * sun_radiance

           •   radiance = (at-sensor_radiance - radiance_path)

           •   reflectance = radiance / sun_radiance
       where, <u>percent</u> is a value between 0.0 and 1.0 (usually 0.01), <u>Esky</u> is the diffuse sky irradiance, <u>TAUz</u> is
       the atmospheric transmittance along the path from the  sun  to  the  ground  surface,  and  <u>TAUv</u>  is  the
       atmospheric  transmittance  along  the  path  from the ground surface to the sensor. <u>radiance_dark</u> is the
       at-sensor radiance calculated from the darkest object, i.e. DN with  a  least  ’dark_parameter’  (usually
       1000) pixels for the entire image.  The values are,

           •   DOS1: TAUv = 1.0, TAUz = 1.0 and Esky = 0.0

           •   DOS2:  TAUv = 1.0, Esky = 0.0, and TAUz = sin(e) for all bands with maximum wave length less than
               1. (i.e. bands 4-6 MSS, 1-4 TM, and 1-4 ETM+) other bands TAUz = 1.0

           •   DOS3: TAUv = exp[-t/cos(sat_zenith)], TAUz = exp[-t/sin(e)], Esky = rayleigh

           •   DOS4: TAUv = exp[-t/cos(sat_zenith)], TAUz = exp[-t/sin(e)], Esky = PI * radiance_dark
       <b>Attention</b>: Output radiance remain untouched (i.e. no set to 0.0  when  it  is  negative)  then  they  are
       possible negative values. However, output reflectance is set to 0.0 when is obtained a negative value.

</pre><h4><b>NOTES</b></h4><pre>
       The  output  raster cell values can be rescaled with the <b>scale</b> parameter (e.g., with 100 in case of using
       reflectance output in <u>i.gensigset</u>).

   <b>On</b> <b>Landsat-8</b> <b>metadata</b> <b>file</b>
       NASA reports a structure of the L1G Metadata file (LDCM-DFCB-004.pdf) for Landsat Data Continuity Mission
       (i.e. Landsat-8).

       NASA retains in MIN_MAX_RADIANCE group the necessary information to transform  Digital  Numbers  (DN)  in
       radiance values. Then, <u>i.landsat.toar</u> replaces the possible standard values with the metadata values. The
       results match with the values reported by the metada file in RADIOMETRIC_RESCALING group.

       Also,  NASA  reports  the  same  values  of  reflectance for all bands in max-min values and in gain-bias
       values. This is strange that all bands have the same range of reflectance. Also, they wrote  in  the  web
       page  as  to  calculate  reflectance directly from DN, first with RADIOMETRIC_RESCALING values and second
       divided by sin(sun_elevation).

       This is a simple rescaling

           •   reflectance = radiance / sun_radiance = (DN * RADIANCE_MULT + RADIANCE_ADD) / sun_radiance

           •   now reflectance = DN * REFLECTANCE_MULT + REFLECTANCE_ADD

           •   then REFLECTANCE_MULT = RADIANCE_MULT / sun_radiance

           •   and REFLECTANCE_ADD = RADIANCE_ADD / sun_radiance

       The problem arises when we need ESUN values (not provided) to compute sun_radiance  and  DOS.  We  assume
       that REFLECTANCE_MAXIMUM corresponds to the RADIANCE_MAXIMUM, then

           •   REFLECTANCE_MAXIMUM / sin(e) = RADIANCE_MAXIMUM / sun_radiance

           •   Esun = (PI * d^2) * RADIANCE_MAXIMUM / REFLECTANCE_MAXIMUM
       where <u>d</u> is the earth-sun distance provided by metadata file or computed inside the program.

       The  <u>i.landsat.toar</u>  reverts  back  the  NASA  rescaling to continue using Lmax, Lmin, and Esun values to
       compute the constant to convert DN to  radiance  and  radiance  to  reflectance  with  the  "traditional"
       equations  and  simple  atmospheric  corrections.   <b>Attention</b>:  When  MAXIMUM  values  are  not provided,
       <u>i.landsat.toar</u> tries to calculate Lmax, Lmin, and Esun from RADIOMETRIC_RESCALING (in tests  the  results
       were the same).

   <b>Calibration</b> <b>constants</b>
       In  verbose  mode (flag <b>--verbose</b>), the program write basic satellite data and the parameters used in the
       transformations.

       Production date is not an exact value but it is necessary to apply correct calibration  constants,  which
       were changed in the dates:

           •   Landsat-1 MSS: never

           •   Landsat-2 MSS: July 16, 1975

           •   Landsat-3 MSS: June 1, 1978

           •   Landsat-4 MSS: August 26, 1982 and April 1, 1983

           •   Landsat-4 TM:  August 1, 1983 and January 15, 1984

           •   Landsat-5 MSS: April 6, 1984 and November 9, 1984

           •   Landsat-5 TM:  May 4, 2003 and April, 2 2007

           •   Landsat-7 ETM+: July 1, 2000

           •   Landsat-8 OLI/TIRS: launched in 2013

</pre><h4><b>EXAMPLES</b></h4><pre>
   <b>Metadata</b> <b>file</b> <b>examples</b>
       Transform  digital  numbers  of  Landsat-7  ETM+  in band rasters 203_30.1, 203_30.2 [...] to uncorrected
       at-sensor reflectance in output files 203_30.1_toar, 203_30.2_toar [...]  and  at-sensor  temperature  in
       output files 293_39.61_toar and 293_39.62_toar:
       i.landsat.toar input=203_30. output=_toar \
         metfile=p203r030_7x20010620.met
       or
       i.landsat.toar input=L5121060_06020060714. \
         output=L5121060_06020060714_toar \
         metfile=L5121060_06020060714_MTL.txt
       or
       i.landsat.toar input=LC80160352013134LGN03_B output=toar \
         metfile=LC80160352013134LGN03_MTL.txt sensor=oli8 date=2013-05-14

   <b>DOS1</b> <b>example</b>
       DN to reflectance using DOS1:
       # rename channels or make a copy to match i.landsat.toar’s input scheme:
       g.copy raster=lsat7_2002_10,lsat7_2002.1
       g.copy raster=lsat7_2002_20,lsat7_2002.2
       g.copy raster=lsat7_2002_30,lsat7_2002.3
       g.copy raster=lsat7_2002_40,lsat7_2002.4
       g.copy raster=lsat7_2002_50,lsat7_2002.5
       g.copy raster=lsat7_2002_61,lsat7_2002.61
       g.copy raster=lsat7_2002_62,lsat7_2002.62
       g.copy raster=lsat7_2002_70,lsat7_2002.7
       g.copy raster=lsat7_2002_80,lsat7_2002.8
       Calculation of reflectance values from DN using DOS1 (metadata obtained from p016r035_7x20020524.met.gz):
       i.landsat.toar input=lsat7_2002. output=lsat7_2002_toar. sensor=tm7 \
         method=dos1 date=2002-05-24 sun_elevation=64.7730999 \
         product_date=2004-02-12 gain=HHHLHLHHL
       The resulting Landsat channels are named lsat7_2002_toar.1 .. lsat7_2002_toar.8.

</pre><h4><b>REFERENCES</b></h4><pre>
           •   Chander G., B.L. Markham and D.L. Helder, 2009: Remote Sensing of Environment, vol. 113

           •   Chander  G.H.  and B. Markham, 2003: IEEE Transactions On Geoscience And Remote Sensing, vol. 41,
               no. 11.

           •   Chavez  P.S.,  jr.  1996:  Image-based  atmospheric  corrections  -   Revisited   and   Improved.
               Photogrammetric Engineering and Remote Sensing <a href="../man9/62.9.html">62</a>(9): 1025-1036.

           •   Huang  et  al:  At-Satellite  Reflectance,  2002:  A  First Order Normalization Of Landsat 7 ETM+
               Images.

           •   R. Irish: Landsat 7. Science Data Users Handbook. February 17, 2007; 15 May 2011.

           •   Markham B.L. and  J.L.  Barker,  1986:  Landsat  MSS  and  TM  Post-Calibration  Dynamic  Ranges,
               Exoatmospheric Reflectances and At-Satellite Temperatures. EOSAT Landsat Technical Notes, No. 1.

           •   Moran M.S., R.D. Jackson, P.N. Slater and P.M. Teillet, 1992: Remote Sensing of Environment, vol.
               41.

           •   Song  et  al,  2001:  Classification  and Change Detection Using Landsat TM Data, When and How to
               Correct Atmospheric Effects? Remote Sensing of Environment, vol. 75.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
        <u>i.atcorr,</u> <u>i.colors.enhance,</u> <u>r.mapcalc,</u> <u>r.in.gdal</u>

       Landsat Data Dictionary by USGS

</pre><h4><b>AUTHOR</b></h4><pre>
       E. Jorge Tizado  (ej.tizado unileon es), Dept. Biodiversity and Environmental Management,  University  of
       León, Spain

</pre><h4><b>SOURCE</b> <b>CODE</b></h4><pre>
       Available at: i.landsat.toar source code (history)

       Accessed: Friday Apr 04 01:20:57 2025

       Main index | Imagery index | Topics index | Keywords index | Graphical index | Full index

       © 2003-2025 GRASS Development Team, GRASS GIS 8.4.1 Reference Manual

GRASS 8.4.1                                                                               <u><a href="../man1grass/i.landsat.toar.1grass.html">i.landsat.toar</a></u>(1grass)
</pre>
 </div>
</div></section>
</div>
</body>
</html>