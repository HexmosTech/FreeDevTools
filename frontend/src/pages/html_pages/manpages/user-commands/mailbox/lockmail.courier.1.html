<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lockmail - create mail lock files</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/courier-mta">courier-mta_1.3.13-11_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       lockmail - create mail lock files

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>lockmail</b> [-r] [-t <u>timeout</u>] {<u>lockfile</u>} {<u>program</u>} [argument...]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>lockmail</b> is a helper utility for working with mailbox files. Mailbox files must be locked to prevent
       other applications from modifying the mailbox at the same time. Different system use different locking
       conventions.  <b>lockmail</b> uses two of the most common locking mechanisms in use, which should work reliably
       on most systems.

       <u>lockfile</u> is the pathname to an existing mailbox file. By default, <b>lockmail</b> tries to lock the mailbox
       every five seconds (if the mailbox is already locked), and will give up after three minutes. After the
       mailbox is successfully locked, <b>lockmail</b> runs <u>program</u> as a child process, with any optional <u>argument</u>s.
       When <u>program</u> terminates, <b>lockmail</b> removes the mailbox lock, and terminates itself.

</pre><h4><b>OPTIONS</b></h4><pre>
       -r
           If a regular lock fails, try a read-only lock. Use this option to lock mailbox files in a read-only
           directory.

       -t <u>timeout</u>
           If the lock attempt fails, try again for up to <u>timeout</u> seconds. The actual timeout is rounded up to
           the next five second interval (a lock attempt is tried every five seconds).

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This section briefly describes the locking mechanism used by <b>lockmail</b>.  <b>lockmail</b> uses three different
       locking conventions in order to maximize compatibility with other mail software: C-Client folder locks,
       dot-locks, and file locks.

   <b>C-Client</b> <b>folder</b> <b>locks</b>
       Mail software based on the C-Client library creates lock files named <a href="file:/tmp/.">/tmp/.</a><u>dddddd</u>.<u>iiiiii</u>. Here, <u>dddddd</u>
       and <u>iiiiii</u> are the device number and the inode number of the mailbox file (the <u>st_dev</u> and <u>st_ino</u> fields
       in the inode), in hexadecimal. If the process ID saved in the C-Client folder lock file is not valid,
       <b>lockmail</b> concludes that it's a stale lock file, and will remove it.

           <b>Note</b>

           A race condition exists where a C-Client process is killed after it creates a lock file, but before
           saving its process ID in the lock file. The race window is very small, but it exists. The C-Client
           library does not appear to ever clear out the lock file.

           <b>lockmail</b> attempts to resolve this race condition by deleting zero-length lock files that are at least
           five minutes old.

   <b>dot-locks</b>
       <b>lockmail</b> also creates, and honors dot-lock files. Dot-lock files are first created as temporary files,
       then linked to <u>lockfile</u>.lock. The link operation fails if the dot-lock file already exists.  <b>lockmail</b>
       uses an enhanced method of dot-locking, where its process ID, and the name of the server where <b>lockmail</b>
       is running is also saved in its dot-lock file. If the operation fails due to an existing dot-lock file
       that was created by another <b>lockmail</b> process on the same server, and the process ID no longer exists,
       this stale dot-lock file is removed immediately. In all other situations a dot-lock file older than five
       minutes is considered stale, and removed.

           <b>Note</b>

           A failure to create a dot-lock file is silently ignored if the reason for the failure is because
           <b>lockmail</b> does not have the write permission in the dot-lock file's directory. The incoming mail spool
           directory (usually <a href="file:/var/mail">/var/mail</a>) typically does not have global write permissions, so the attempt to
           create the dot-lock file in the spool directory will fail, and <b>lockmail</b> will be content with using
           file-locking only.

   <b>File</b> <b>locks</b>
       The final locking mechanism <b>lockmail</b> uses is the operating system's file locking facility. If <b>lockmail</b>
       fails to obtain all three locks, <b>lockmail</b> will sleep for five seconds and try again. The only exception
       is a failure to create a dot-lock because of no write access to the dot-lock file's directory, which is
       ignored. If <b>lockmail</b> still fails to obtain all required locks in the amount of time specified by the <b>-t</b>
       option (or its default value), <b>lockmail</b> will terminate with the EX_TEMPFAIL exit code.

       <b>lockmail</b> runs <u>program</u> after obtaining the last file lock, waits until <u>program</u> terminates, and releases
       all locks.  <u>program</u> must terminate before any of the locks obtained by <b>lockmail</b> expire, and are
       considered stale.  <b>lockmail</b> will then terminate with the same exit code as <u>program</u>.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       <b>lockmail</b> terminates with the same exit status as <u>program</u> <b>lockmail</b> terminates with the EX_TEMPFAIL exit
       status if it was unable to obtain a lock, or if <u>program</u> was killed by a signal.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/maildrop.1.html">maildrop</a></b>(1)[1], <b><a href="../man8/sendmail.8.html">sendmail</a></b>(8).

</pre><h4><b>AUTHOR</b></h4><pre>
       <b>Sam</b> <b>Varshavchik</b>
           Author

</pre><h4><b>NOTES</b></h4><pre>
        1. <b><a href="../man1/maildrop.1.html">maildrop</a></b>(1)
           <a href="http://www.courier-mta.org/maildrop.html">http://www.courier-mta.org/maildrop.html</a>

Courier Mail Server                                06/10/2024                                        <u><a href="../man1/LOCKMAIL.1.html">LOCKMAIL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>