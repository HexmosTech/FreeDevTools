<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sup - software upgrade protocol</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/sup">sup_20100519-7_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sup - software upgrade protocol

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>sup</b> [ <u>flags</u> ] [ <u>supfile</u> ] [ <u>collection</u> ...]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>Sup</u>  is  a  program  used  for  upgrading  collections of files from other machines to your machine.  You
       execute <u>sup</u>, the <u>client</u> program, which talks over the network using IP/TCP to a <u>file</u> <u>server</u> process.  The
       file server process cooperates with <u>sup</u> to determine which files of the collection need to be upgraded on
       your machine.

       Sup collections can have multiple releases. One use for such releases is to provide different versions of
       the same files. At CMU, for example, system binaries have alpha, beta and default  release  corresponding
       to  different  staging  levels  of the software. We also use release names default and minimal to provide
       complete releases or subset releases.  In both of these cases, it only makes sense to sup one release  of
       the  collections.  Releases  have  also  been  used  in  private  or  external sups to provide subsets of
       collections where it makes sense to pick up several of the releases. For  example  the  Mach  3.0  kernel
       sources  has  a default release of machine independent sources and separate releases of machine dependent
       sources for each supported platform.

       In performing an upgrade, the file server constructs a list of files included in the specified release of
       the collection.  The list is sent to your machine, which determines which files are needed.  Those  files
       are then sent from the file server.  It will be most useful to run <u>sup</u> as a daemon each night so you will
       continually have the latest version of the files in the needed collections.

       The  only  required  argument to <u>sup</u> is the name of a supfile.  It must either be given explicitly on the
       command line, or the <b>-s</b> flag must be specified.  If the <b>-s</b> flag is given, the system supfile will be used
       and a supfile command argument should not be specified.  The list  of  collections  is  optional  and  if
       specified will be the only collections upgraded.  The following flags affect all collections specified:

       <b>-s</b>     As described above.

       <b>-t</b>     When  this  flag  is given, <u>sup</u> will print the time that each collection was last upgraded, rather
              than performing actual upgrades.

       <b>-u</b>     When this flag is given, <u>sup</u> will not try to restore the user access and modified times  of  files
              in the collections from the server.

       <b>-S</b>     Operate silently printing messages only on errors.

       <b>-N</b>     <u>Sup</u> will trace network messages sent and received that implement the <u>sup</u> network protocol.

       <b>-P</b>     Sup will use a set of non-privileged network ports reserved for debugging purposes.

       The  remaining  flags  affect  all  collections unless an explicit list of collections are given with the
       flags.  Multiple flags may be specified together that affect the  same  collections.   For  the  sake  of
       convenience,  any  flags  that always affect all collections can be specified with flags that affect only
       some collections.  For example, <b>sup</b> <b>-sde=coll1,coll2</b> would perform a system upgrade, and  the  first  two
       collections  would  allow  both  file  deletions  and command executions.  Note that this is not the same
       command as <b>sup</b> <b>-sde=coll1</b> <b>coll2,</b> which would perform a system upgrade of just the  coll2  collection  and
       would ignore the flags given for the coll1 collection.

       <b>-a</b>     All  files in the collection will be copied from the repository, regardless of their status on the
              current machine.  Because of this, it is a very expensive operation and should only  be  done  for
              small  collections if data corruption is suspected and been confirmed.  In most cases, the <b>-o</b> flag
              should be sufficient.

       <b>-b</b>     If the <b>-b</b> flag if given, or the <b>backup</b> supfile option is specified, the contents of regular  files
              on  the local system will be saved before they are overwritten with new data.  The file collection
              maintainer can designate specific files to be worthy of backing up  whenever  they  are  upgraded.
              However,  such  backup will only take place if you specify this flag or the <b>backup</b> option to allow
              backups for a file collection on your machine.  The backup mechanism will create  a  copy  of  the
              current version of a file immediately before a new copy is received from the file server; the copy
              is  given  the same name as the original file but is put into a directory called <b>BACKUP</b> within the
              directory containing the original file.  For example, <b>/usr/sas/src/foo.c</b> would have a backup  copy
              called  <b>/usr/sas/src/BACKUP/foo.c.</b>   There  is no provision for automatically maintaining multiple
              old versions of files; you would have to do this yourself.

       <b>-B</b>     The <b>-B</b> flag overrides and disables the <b>-b</b> flag and the <b>backup</b> supfile option.

       <b>-d</b>     Files that are no longer in the collection on the repository will be deleted  if  present  on  the
              local  machine and were put there by a previous sup.  This may also be specified in a supfile with
              the <b>delete</b> option.

       <b>-D</b>     The <b>-D</b> flag overrides and disables the <b>-d</b> flag and the <b>delete</b> supfile option.

       <b>-e</b>     Sup will execute commands sent from the repository that should be run when a file is upgraded.  If
              the <b>-e</b> flag is omitted, Sup will print a message that specifies the command to execute.  This  may
              also be specified in a supfile with the <b>execute</b> option.

       <b>-E</b>     The <b>-E</b> flag overrides and disables the <b>-e</b> flag and the <b>execute</b> supfile option.

       <b>-f</b>     A  <u>list-only</u>  upgrade will be performed.  Messages will be printed that indicate what would happen
              if an actual upgrade were done.

       <b>-k</b>     <u>Sup</u> will check the modification times of files on the local disk before updating them.  Only files
              which are newer on the repository than on the local disk will be updated; files that are newer  on
              the  local  disk  will be kept as they are.  This may also be specified in a supfile with the <b>keep</b>
              option.

       <b>-K</b>     The <b>-K</b> flag overrides and disables the <b>-k</b> flag and the <b>keep</b> supfile option.

       <b>-l</b>     Normally, <u>sup</u> will not upgrade a collection if the repository is on the same machine.  This allows
              users to run upgrades on all machines without having to make special  checks  for  the  repository
              machine.   If  the  <b>-l</b>  flag  is specified, collections will be upgraded even if the repository is
              local.

       <b>-m</b>     Normally, <u>sup</u> used standard output for messages.  If the <b>-m</b> flag if given, <u>sup</u> will send  mail  to
              the  user  running <u>sup</u>, or a user specified with the <b>notify</b> supfile option, that contains messages
              printed by <u>sup</u>.

       <b>-M</b> <b>&lt;user&gt;</b>
              like <b>-m</b> but send mail to the specified user.

       <b>-o</b>     <u>Sup</u> will normally only upgrade files that have changed on the repository since the  last  time  an
              upgrade was performed. That is, if the file in the repository is newer than the date stored in the
              <u>when</u>  file  on  the  client.   The <b>-o</b> flag, or the <b>old</b> supfile option, will cause <u>sup</u> to check all
              files in the collection for changes instead of just the new ones.

       <b>-O</b>     The <b>-O</b> flag overrides and disables the <b>-o</b> flag and the <b>old</b> supfile option.

       <b>-z</b>     Normally sup transfers files directly without any other processing, but with the <b>-z</b> flag,  or  the
              <b>compress</b>  supfile  option,  sup  will  compress  the file before sending it across the network and
              uncompress it and restore all the correct file attributes at the receiving end.

       <b>-Z</b>     The <b>-Z</b> flag overrides and disables the <b>-z</b> flag and the <b>compress</b> supfile option.

       <b>-v</b>     Normally, <u>sup</u> will only print messages if there are problems.  This flag causes <u>sup</u> to also  print
              messages during normal progress showing what <u>sup</u> is doing.

</pre><h4><b>SETTING</b> <b>UP</b> <b>UPGRADES</b></h4><pre>
       Each  file  collection to be upgraded must have a <u>base</u> <u>directory</u> which contains a subdirectory called <b>sup</b>
       that will be used by the <u>sup</u> program; it will be created automatically if you do not create it.  <u>Sup</u> will
       put subdirectories and files into this directory as needed.

       <u>Sup</u> will look for a subdirectory with the same name as the collection within the <b>sup</b> subdirectory of  the
       <u>base</u> <u>directory.</u>  If it exists it may contain any of the following files:

       <b>when.&lt;rel-suffix&gt;</b>
              This  file is automatically updated by <u>sup</u> when a collection is successfully upgraded and contains
              the time that the file server, or possibly <u>supscan</u>, created the list of files in the upgrade list.
              <u>Sup</u> will send this time to the file server for generating the list of files that have been changed
              on the repository machine.

       <b>refuse</b> This file contains a list of files  and  directories,  one  per  line,  that  the  client  is  not
              interested in that should not be upgraded.

       <b>lock</b>   This  file is used by <u>sup</u> to lock a collection while it is being upgraded.  <u>Sup</u> will get exclusive
              access to the lock file using <u><a href="../man2/flock.2.html">flock</a></u>(2), preventing more than  one  <u>sup</u>  from  upgrading  the  same
              collection at the same time.

       <b>last.&lt;rel-suffix&gt;</b>
              This  file  contains a list of files and directories, one per line, that have been upgraded by <u>sup</u>
              in the past.  This information is used when the <b>delete</b> option, or the <b>-d</b> flag is  used  to  locate
              files previously upgraded that are no longer in the collection that should be deleted.

       Each  file collection must also be described in one or more supfiles.  When <u>sup</u> is executed, it reads the
       specified supfile to determine what file collections  and releases to upgrade.   Each  collection-release
       set  is  described  by  a  single  line  of  text  in the supfile; this line must contain the name of the
       collection, and possibly one or more options separated by spaces.  The options are:

       <b>release=</b><u>releasename</u>
              If a collection contains multiple releases, you need to specify which release you  want.  You  can
              only specify one release per line, so if you want multiple releases from the same collections, you
              will  need  to  specify  the  collection more than once. In this case, you should use the <u>use-rel-</u>
              <u>suffix</u> option in the supfile to keep the last and when files for the two releases separate.

       <b>base=</b><u>directory</u>
              The usual default name of the base directory for a collection is described below (see  FILES);  if
              you want to specify another directory name, use this option specifying the desired directory.

       <b>prefix=</b><u>directory</u>
              Each  collection  may  also  have an associated <u>prefix</u> <u>directory</u> which is used instead of the base
              directory to specify in what directory files within the collection will be placed.

       <b>host=</b><u>hostname</u>
       <b>hostbase=</b><u>directory</u>
              <u>System</u> collections are supported by the system maintainers, and <u>sup</u> will  automatically  find  out
              the  name  of  the host machine and base directory on that machine.  However, you can also upgrade
              <u>private</u> collections; you simply specify with these options the <u>hostname</u> of the machine  containing
              the files and the <u>directory</u> used as a base directory for the file server on that machine.  Details
              of setting up a file collection are given in the section below.

       <b>login=</b><u>accountid</u>
       <b>password=</b><u>password</u>
       <b>crypt=</b><u>key</u>
              Files  on  the  file  server  may  be protected, and network transmissions may be encrypted.  This
              prevents unauthorized access to files via <u>sup</u>.  When files  are  not  accessible  to  the  default
              account  (e.g.  the <b>anon</b> anonymous account), you can specify an alternative <u>accountid</u> and <u>password</u>
              for the file server to use on the repository host.  Network transmission of the password  will  be
              always  be  encrypted.   You can also have the actual file data encrypted by specifying a <u>key</u>; the
              file collection on the repository must specify the same key or  else  <u>sup</u>  will  not  be  able  to
              upgrade  files from that collection.  In this case, the default account used by the file server on
              the repository machine will be the owner of the encryption key file (see FILES)  rather  than  the
              <b>anon</b> anonymous account.

       <b>notify=</b><u>address</u>
              If  you use the <b>-m</b> option to receive log messages by mail, you can have the mail sent to different
              user, possibly on another host, than the user running the sup program.  Messages will be  sent  to
              the  specified  <u>address</u>,  which  can  be  any  legal  netmail  address.   In particular, a project
              maintainer can be designated to receive mail for that project's file  collection  from  all  users
              running <u>sup</u> to upgrade that collection.

       <b>backup</b> As described above under the <b>-b</b> flag.

       <b>delete</b> As described above under the <b>-d</b> flag.

       <b>execute</b>
              As described above under the <b>-e</b> flag.

       <b>keep</b>   As described above under the <b>-k</b> flag.

       <b>old</b>    As described above under the <b>-o</b> flag.

       <b>use-rel-suffix</b>
              Causes  the  release  name  to  be  used as a suffix to the <u>last</u> and <u>when</u> files. This is necessary
              whenever you are supping more than one release in the same collection.

</pre><h4><b>PREPARING</b> <b>A</b> <b>FILE</b> <b>COLLECTION</b> <b>REPOSITORY</b></h4><pre>
       A set of files residing on a repository must be prepared before <u>sup</u> client processes  can  upgrade  those
       files.   The collection must be given a <u>name</u> and a <u>base</u> <u>directory.</u>  If it is a private collection, client
       users must be told the name of the collection,  repository  host,  and  base  directory;  these  will  be
       specified  in  the  supfile  via the <b>host</b> and <b>hostbase</b> options.  For a system-maintained file collection,
       entries must be placed into the host list file and directory list file as described in <u><a href="../man8/supservers.8.html">supservers</a></u>(8).

       Within the base directory, a subdirectory must be created called <b>sup</b> <b>.</b>  Within this directory there  must
       be  a  subdirectory  for  each  collection  using  that  base  directory,  whose  name is the name of the
       collection; within each of these directories will be a list file and possibly a prefix file, a host file,
       an encryption key file, a log file and a scan file.  The filenames are listed under FILES below.

       <b>prefix</b> Normally, all files in the collection are relative to the base directory.  This  file  contains  a
              single  line  which  is the name of a directory to be used in place of the base directory for file
              references.

       <b>host</b>   Normally, all remote host machines are allowed access to  a  file  collection.   If  you  wish  to
              restrict  access  to  specific  remote  hosts  for this collection, put each allowed hostname on a
              separate line of text in this file.  If a host has more than one name, only one of its names needs
              to be listed.  The name <b>LOCAL</b> can be used to grant access to all hosts on the local  network.  The
              host name may be a  numeric network address or a network name. If a crypt appears on the same line
              as  the  host  name,  that crypt will be used for that host. Otherwise, the crypt appearing in the
              <u>crypt</u> file, if any will be used.

       <b>crypt</b>  If you wish to use the <u>sup</u> data encryption mechanism, create an encryption file containing,  on  a
              single  line of text, the desired encryption key.  Client processes must then specify the same key
              with the <b>crypt</b> option in the supfile or they will be denied access to  the  files.   In  addition,
              actual network transmission of file contents and filenames will be encrypted.

       <b>list</b>   This  file  describes the actual list of files to be included in this file collection, in a format
              described below.

       <b>releases</b>
              This file describes any releases that the collection may have. Each line starts with  the  release
              name  and  then may specify any of the following files: <u>prefix=&lt;dirname&gt;</u> to use a different parent
              directory for the files in this release.  <u>list=&lt;listname&gt;</u> to specify the  list  of  files  in  the
              release.   <u>scan=&lt;scanfile&gt;</u>  must be used in multi-release collections that are scanned to keep the
              scan files  for  the  different  releases  separate.   <u>host=&lt;hostfile&gt;</u>  to  allow  different  host
              restrictions  for  this  release.   <u>next=&lt;release&gt;</u>  used  to chain releases together. This has the
              effect of making one release be a combination of several other releases. If the same file  appears
              in  more  than  one  chained  release,  the  first one found will be used.  If these files are not
              specified for a release the default names: prefix,list,scan and host will be used.

       <b>scan</b>   This file, created by <u>supscan</u>, is the list of filenames that correspond to the instructions in the
              list file.  The scan file is only used for frequently updated file collections; it makes the  file
              server run much faster.  See <u><a href="../man8/supservers.8.html">supservers</a></u>(8) for more information.

       <b>lock</b>   As  previously mentioned, this file is used to indicate that the collection should be locked while
              upgrades are in progress.  All file servers will try to get shared access to the  lock  file  with
              <u><a href="../man2/flock.2.html">flock</a></u>(2).

       <b>logfile</b>
              If  a  log  file  exists in the collection directory, the file server will append the last time an
              upgrade was successfully completed, the time the last upgrade started and finished, and  the  name
              of the host requesting the upgrade.

       It  should  be  noted that <u>sup</u> allows several different named collections to use the same base directory.
       Separate encryption, remote host access, and file lists are used for each collection, since  these  files
       reside in subdirectories <u>&lt;basedir&gt;/sup/&lt;coll.name&gt;.</u>

       The list file is a text file with one command on each line.  Each command contains a keyword and a number
       of  operands separated by spaces.  All filenames in the list file are evaluated on the repository machine
       relative to the host's base directory, or prefix directory if one is specified, and on your machine  with
       respect  to the base, or prefix, directory for the client.  The <u>filenames</u> below (except <u>exec-command</u>) may
       all include wild-cards and meta-characters as used by <u><a href="../man1/csh.1.html">csh</a></u>(1) including  *,  ?,  [...],  and  {...}.   The
       commands are:

       <b>upgrade</b> <u>filename</u> ...
              The specified file(s) (or directories) will be included in the list of files to be upgraded.  If a
              directory  name  is  given,  it  recursively  includes  all  subdirectories  and files within that
              directory.

       <b>always</b> <u>filename</u> ...
              The always command is identical to upgrade, except that omit and omitany commands  do  not  affect
              filenames specified with the always command.

       <b>omit</b> <u>filename</u> ...
              The  specified  file(s)  (or  directories) will be excluded from the list of files to be upgraded.
              For example, by specifying <b>upgrade</b> <b>/usr/vision</b> and <b>omit</b> <b>/usr/vision/exp,</b>  the  generated  list  of
              files  would  include  all subdirectories and files of /usr/vision except /usr/vision/exp (and its
              subdirectories and files).

       <b>omitany</b> <u>pattern</u> ...
              The specified patterns are compared against the files in the upgrade list.  If a pattern  matches,
              the  file is omitted.  The omitany command currently supports all wild-card patterns except {...}.
              Also, the pattern must match the entire filename, so a leading  */,  or  a  trailing  /*,  may  be
              necessary in the pattern.

       <b>backup</b> <u>filename</u> ...
              The specified file(s) are marked for backup; if they are upgraded and the client has specified the
              <b>backup</b>  option  in  the  corresponding  line of the supfile, then backup copies will be created as
              described above.  Directories may not be specified, and  no  recursive  filename  construction  is
              performed; you must specify the names of the specific files to be backed up before upgrading.

       <b>noaccount</b> <u>filename</u> ...
              The  accounting  information  of  the  specified file(s) will not be preserved by <u>sup</u>.  Accounting
              information consists of the owner, group, mode and modified time of a file.

       <b>symlink</b> <u>filename</u> ...
              The specified file(s) are to be treated as symbolic links and will be transferred as such and  not
              followed.  By default, <u>sup</u> will follow symbolic links.

       <b>rsymlink</b> <u>dirname</u> ...
              All symbolic links in the specified directory and its subdirectories are to be treated as symbolic
              links. That is the links will be transferred and not the files to which they point.

       <b>execute</b> <u>exec-command</u> (<u>filename</u> ...)
              The  <u>exec-command</u>  you  specified will be executed on the client process whenever any of the files
              listed in parentheses are upgraded.  A special token, <b>%s,</b> may be specified in the <u>exec-command</u> and
              will be replaced by the name of the file that was upgraded.   For  example,  if  you  say  <b>execute</b>
              <b>ranlib</b>  <b>%s</b>  <b>(libc.a)</b>,  then  whenever  libc.a  is upgraded, the client machine will execute <b>ranlib</b>
              <b>libc.a.</b>  As described above, the client must invoke <u>sup</u> with the <b>-e</b> flag to  allow  the  automatic
              execution of command files.

       <b>include</b> <u>listfile</u> ...
              The  specified  <u>listfiles</u> will be read at this point.  This is useful when one collection subsumes
              other collections; the larger  collection  can  simply  specify  the  listfiles  for  the  smaller
              collections contained within it.

       The  order  in  which  the command lines appear in the list file does not matter.  Blank lines may appear
       freely in the list file.

</pre><h4><b>FILES</b></h4><pre>
       Files on the client machine for <u>sup</u>:

       <b>/etc/supfiles/coll.list</b>
              supfile used for -s flag

       <b>/etc/supfiles/coll.what</b>
              supfile used for -s flag when -t flag is also specified

       <b>/etc/supfiles/coll.host</b>
              host name list for system collections

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/last</b>&lt;<u>.release</u>&gt;
              recorded list of files in collection as of last upgrade

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/lock</b>
              file used to lock collection

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/refuse</b>
              list of files to refuse in collection

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/when</b>&lt;<u>.release</u>&gt;
              recorded time of last upgrade

       <b>/usr/sup/</b>&lt;<u>collection</u>&gt;
              default base directory for file collection

       Files needed on each repository machine for the file server:

       <b>/etc/supfiles/coll.dir</b>
              base directory list for system collections

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/crypt</b>
              data encryption key for a collection. the owner of this file is the default account used when data
              encryption is specified

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/host</b>
              list of remote hosts allowed to upgrade a collection

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/list</b>
              list file for a collection

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/lock</b>
              lock file for a collection

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/logfile</b>
              log file for a collection

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/prefix</b>
              file containing the name of the prefix directory for a collection

       &lt;<u>base-directory</u>&gt;<b>/sup/</b>&lt;<u>collection</u>&gt;<b>/scan</b>
              scan file for a collection

       <b><a href="file:/usr/">/usr/</a></b>&lt;<u>collection</u>&gt;
              default base directory for a file collection

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man8/supservers.8.html">supservers</a></u>(8)
       <u>The</u> <u>SUP</u> <u>Software</u> <u>Upgrade</u> <u>Protocol</u>, S. A. Shafer, CMU Computer Science Department, 1985.

</pre><h4><b>EXAMPLE</b></h4><pre>
       &lt;example&gt;

</pre><h4><b>BUGS</b></h4><pre>
       The encryption mechanism should be strengthened, although it's not trivial.

       <u>sup</u> can delete files it should not with the delete option.  This is because in the delete pass, it  tries
       to delete all files in the old list that don't exist in the new list.  This is a problem when a directory
       becomes a symlink to a hierarchy that contains the same names.  Then sup will cross the symlink and start
       deleting  files  and  directories  from  the  destination.  This is not easily fixed.  Don't use sup with
       symlink/rsymlink and the delete option at the same time or *be careful*!

                                                    10/01/08                                              <u><a href="../man1/SUP.1.html">SUP</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>