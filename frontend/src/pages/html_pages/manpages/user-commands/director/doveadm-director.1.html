<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>doveadm-director - Manage Dovecot directors</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/dovecot-core">dovecot-core_2.3.21.1+dfsg1-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       doveadm-director - Manage Dovecot directors

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>doveadm</b> [<b>-Dv</b>] [<b>-f</b> <u>formatter</u>] <b>director</b> <u>command</u> [<u>OPTIONS</u>] [<u>ARGUMENTS</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>doveadm</b>  <b>director</b>  can  be  used to manage and query the status of the list of backend mail servers where
       Dovecot proxy can redirect connections to.

</pre><h4><b>OPTIONS</b></h4><pre>
       Global <b><a href="../man1/doveadm.1.html">doveadm</a></b>(1) <u>options</u>:

       <b>-D</b>     Enables verbosity and debug messages.

       <b>-f</b> <u>formatter</u>
              Specifies the <u>formatter</u> for formatting the output.  Supported formatters are:

              <b>flow</b>   prints each line with <u>key</u><b>=</b><u>value</u> pairs.

              <b>pager</b>  prints each <u>key</u>: <u>value</u> pair on its own line and separates records with form feed  character
                     (<b>^L</b>).

              <b>tab</b>    prints a table header followed by tab separated value lines.

              <b>table</b>  prints a table header followed by adjusted value lines.

       <b>-o</b> <u>setting</u><b>=</b><u>value</u>
              Overrides  the  configuration  <u>setting</u> from <u>/etc/dovecot/dovecot.conf</u> and from the userdb with the
              given <u>value</u>.  In order to override multiple settings, the <b>-o</b>  option  may  be  specified  multiple
              times.

       <b>-v</b>     Enables verbosity, including progress counter.

       Command specific <u>options</u>:

       <b>-a</b> <u>director_socket_path</u>
              This option is used to specify an alternative socket.  The option's argument is either an absolute
              path  to a local UNIX domain socket, or a hostname and port (<u>hostname</u>:<u>port</u>), in order to connect a
              remote host via a TCP socket.

              By default <b><a href="../man1/doveadm.1.html">doveadm</a></b>(1) will use the socket <u>/run/dovecot/director-admin</u>.  The socket may be  located
              in    another    directory,    when    the    default   <u>base_dir</u>   setting   was   overridden   in
              <u>/etc/dovecot/dovecot.conf</u>.

</pre><h4><b>ARGUMENTS</b></h4><pre>
       <u>host</u>   A mail server's hostname or IP address.

       <u>ip</u>     A director's IP address.

       <u>port</u>   The TCP port, on which the director server is listening for connections.  The default port is  the
              same as what the local director is listening in.

       <u>user</u>   Is  a  <u>user</u>'s login name.  Depending on the configuration, a login name may be for example <b>jane</b> or
              <b><a href="mailto:john@example.com">john@example.com</a></b>.

       <u>vhost_count</u>
              The number of "virtual hosts" to assign to this server. The higher the number is relative to other
              servers, the more connections it gets. The default is 100.

</pre><h4><b>COMMANDS</b></h4><pre>
   <b>director</b> <b>add</b>
       <b>doveadm</b> <b>director</b> <b>add</b> [<b>-a</b> <u>director_socket_path</u>] <u>host</u> [<u>vhost_count</u>]

       The command's tasks are:

       *   assign a new mail server to the director.

       *   increase/decrease the <u>vhost_count</u> of an already assigned server.

   <b>director</b> <b>dump</b>
       <b>doveadm</b> <b>director</b> <b>dump</b> [<b>-a</b> <u>director_socket_path</u>]

       Dump the current host configuration as doveadm commands. These commands can be easily run  after  a  full
       director cluster restart to get back to the dumped state.

   <b>director</b> <b>flush</b>
       <b>doveadm</b> <b>director</b> <b>flush</b> [<b>-a</b> <u>director_socket_path</u>] [<b>-F</b>] [<b>--max-parallel</b> <u>n</u>] <u>host</u>|<b>all</b>

       <b>doveadm</b>  <b>director</b>  <b>flush</b>  removes  all user associations either from the given <u>host</u> or <b>all</b> hosts. All the
       existing connections will be kicked. If <b>director_flush_socket</b>  is  specified,  a  flush  script  is  also
       automatically executed.

       Because  the  kicking  and  moving of users to new backends creates a temporary load spike, all the users
       aren't moved at once. The <b>--max-parallel</b> parameter specifies how many users can  be  moved  concurrently.
       The default is 100.

       If  the  <b>-F</b>  parameter  is  used, the user associations are simply dropped. Existing connections won't be
       kicked and flush scripts aren't run.

   <b>director</b> <b>kick</b>
       <b>doveadm</b> <b>director</b> <b>kick</b> [<b>-a</b> <u>director_socket_path</u>] <u>user</u>

       Kick the specified <u>user</u> from the entire Dovecot cluster.  This is similar to doveadm proxy kick, but this
       command needs to be run only once instead of in each director server.

   <b>director</b> <b>map</b>
       <b>doveadm</b> <b>director</b> <b>map</b> [<b>-a</b> <u>director_socket_path</u>] [<b>-f</b> <u>users_file</u>] [<b>-h</b>|<b>-u</b>] [<u>host</u>]

       The command <b>doveadm</b> <b>director</b> <b>map</b> is used to list current <u>user</u> â†’ <u>host</u> mappings.  Note  that  the  director
       works using 32bit hashes which makes collisions quite likely, so this command can't reliably list exactly
       which users have recently logged in.

       <b>-f</b> <u>users_file</u>
              Path  to  a  file  containing  all user names (one per line).  When given no <u>userdb</u> lookup will be
              performed.  This may be a helpful alternative when for example the network connection to the  LDAP
              or SQL server is slow.

       <b>-h</b>     Output all usernames, which match the given hash.

       <b>-u</b>     Output hash for the given username.

       <u>host</u>   Specify a server's IP address or hostname, to list only mappings of the given <u>host</u>.

   <b>director</b> <b>move</b>
       <b>doveadm</b> <b>director</b> <b>move</b> [<b>-a</b> <u>director_socket_path</u>] <u>user</u> <u>host</u>

       Move  the  <u>user</u>  to  the  specified  backend <u>host</u>.  If the <u>user</u> has any existing connections they will be
       killed.

   <b>director</b> <b>remove</b>
       <b>doveadm</b> <b>director</b> <b>remove</b> [<b>-a</b> <u>director_socket_path</u>] <u>host</u>

       Use this command in order to remove the given <u>host</u> from the director.

   <b>director</b> <b>ring</b> <b>add</b>
       <b>doveadm</b> <b>director</b> <b>ring</b> <b>add</b> [<b>-a</b> <u>director_socket_path</u>] <u>ip</u> [<u>port</u>]

       Add a new director to the ring.

   <b>director</b> <b>ring</b> <b>remove</b>
       <b>doveadm</b> <b>director</b> <b>ring</b> <b>remove</b> [<b>-a</b> <u>director_socket_path</u>] <u>ip</u> [<u>port</u>]

       Remove a director from the ring.

   <b>director</b> <b>ring</b> <b>status</b>
       <b>doveadm</b> <b>director</b> <b>ring</b> <b>status</b> [<b>-a</b> <u>director_socket_path</u>]

       Show the status of all the directors currently in the ring.

   <b>director</b> <b>status</b>
       <b>doveadm</b> <b>director</b> <b>status</b> [<b>-a</b> <u>director_socket_path</u>] [<u>user</u>]

       This command is used to show the current usage of all assigned mail servers.
       When a user name is given, this command shows which server the <u>user</u> is currently assigned to,  where  the
       user  will  be  assigned  after  the  current  saved  assignment gets removed and where the user would be
       assigned to if the whole proxy cluster was restarted fresh.

</pre><h4><b>FILES</b></h4><pre>
       <u>/etc/dovecot/dovecot.conf</u>
              Dovecot's main configuration file.

       <u>/etc/dovecot/conf.d/10-director.conf</u>
              Director specific settings.

</pre><h4><b>EXAMPLE</b></h4><pre>
       Add a director with vhost count 150 (or change existing one's vhost count to 150):

       <b>doveadm</b> <b>-v</b> <b>director</b> <b>add</b> <b>x1357.imap.ha.example.net</b> <b>150</b>
       2001:db8:543:6861:143::1357: OK

       Remove a director:

       <b>doveadm</b> <b>director</b> <b>remove</b> <b>x1357.imap.ha.example.net</b>

       Query the status of mail hosts in a director:

       <b>doveadm</b> <b>director</b> <b>status</b>
       mail server ip       vhosts  users
       192.168.10.1            100    125
       192.168.10.2            100    144
       192.168.10.3            100    115

       Query the status of a user's assignment:

       <b>doveadm</b> <b>director</b> <b>status</b> <b><a href="mailto:user@example.com">user@example.com</a></b>
       Current: 192.168.10.1 (expires 2010-06-18 20:17:04)
       Hashed: 192.168.10.2
       Initial config: 192.168.10.3

       This means that the user is currently assigned to mail server on IP 192.168.10.1.  After  all  of  user's
       connections  have  logged  out,  the assignment will be removed (currently it looks like at 20:17:04, but
       that may be increased). After the assignment has expired, the  user  will  next  time  be  redirected  to
       192.168.10.2  (assuming  no  changes  to  director  settings).  If  the  entire Dovecot proxy cluster was
       restarted, so that all of the director configuration would revert back to its initial  values,  the  user
       would be redirected to 192.168.10.3.

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report   bugs,  including  <u>doveconf</u>  <u>-n</u>  output,  to  the  Dovecot  Mailing  List  &lt;<a href="mailto:dovecot@dovecot.org">dovecot@dovecot.org</a>&gt;.
       Information about reporting bugs is available at: <a href="http://dovecot.org/bugreport.html">http://dovecot.org/bugreport.html</a>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/doveadm.1.html">doveadm</a></b>(1)

Dovecot v2.3                                       2014-08-30                                <u><a href="../man1/DOVEADM-DIRECTOR.1.html">DOVEADM-DIRECTOR</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>