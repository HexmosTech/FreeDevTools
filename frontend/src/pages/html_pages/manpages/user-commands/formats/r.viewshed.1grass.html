<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>r.viewshed  - Computes the viewshed of a point on an elevation raster map.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/grass-doc">grass-doc_8.4.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>r.viewshed</b>  - Computes the viewshed of a point on an elevation raster map.
       Default format: NULL (invisible), vertical angle wrt viewpoint (visible).

</pre><h4><b>KEYWORDS</b></h4><pre>
       raster, viewshed, line of sight, LOS

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>r.viewshed</b>
       <b>r.viewshed</b> <b>--help</b>
       <b>r.viewshed</b>    [-<b>crbe</b>]    <b>input</b>=<u>name</u>    <b>output</b>=<u>name</u>   <b>coordinates</b>=<u>east,north</u>    [<b>observer_elevation</b>=<u>value</u>]
       [<b>target_elevation</b>=<u>value</u>]    [<b>max_distance</b>=<u>value</u>]    [<b>direction_range</b>=<u>min,max</u>]    [<b>refraction_coeff</b>=<u>float</u>]
       [<b>memory</b>=<u>value</u>]   [<b>directory</b>=<u>string</u>]   [--<b>overwrite</b>]  [--<b>help</b>]  [--<b>verbose</b>]  [--<b>quiet</b>]  [--<b>ui</b>]

   <b>Flags:</b>
       <b>-c</b>
           Consider the curvature of the earth (current ellipsoid)

       <b>-r</b>
           Consider the effect of atmospheric refraction

       <b>-b</b>
           Output format is invisible = 0, visible = 1

       <b>-e</b>
           Output format is invisible = NULL, else current elev - viewpoint_elev

       <b>--overwrite</b>
           Allow output files to overwrite existing files

       <b>--help</b>
           Print usage summary

       <b>--verbose</b>
           Verbose module output

       <b>--quiet</b>
           Quiet module output

       <b>--ui</b>
           Force launching GUI dialog

   <b>Parameters:</b>
       <b>input</b>=<u>name</u> <b>[required]</b>
           Name of input elevation raster map

       <b>output</b>=<u>name</u> <b>[required]</b>
           Name for output raster map

       <b>coordinates</b>=<u>east,north</u> <b>[required]</b>
           Coordinates of viewing position

       <b>observer_elevation</b>=<u>value</u>
           Viewing elevation above the ground
           Default: <u>1.75</u>

       <b>target_elevation</b>=<u>value</u>
           Offset for target elevation above the ground
           Default: <u>0.0</u>

       <b>max_distance</b>=<u>value</u>
           Maximum visibility radius. By default infinity (-1)
           Default: <u>-1</u>

       <b>direction_range</b>=<u>min,max</u>
           Minimum and maximum horizontal angle limiting viewshed (0 is East, counterclockwise)
           Options: <u>0-360</u>

       <b>refraction_coeff</b>=<u>float</u>
           Refraction coefficient
           Options: <u>0.0-1.0</u>
           Default: <u>0.14286</u>

       <b>memory</b>=<u>value</u>
           Amount of memory to use in MB
           Default: <u>500</u>

       <b>directory</b>=<u>string</u>
           Directory to hold temporary files (they can be large)

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>r.viewshed</u>  is  a  module  that  computes  the viewshed of a point on a raster terrain. That is, given an
       elevation raster, and the location of an observer, it generates a raster output map showing  which  cells
       are  visible  from  the  given  location.   The  algorithm  underlying  <u>r.viewshed</u> minimizes both the CPU
       operations and the transfer of data between main memory and disk; as a result  <u>r.viewshed</u>  runs  fast  on
       very large rasters.

</pre><h4><b>NOTES</b></h4><pre>
       To  run <u>r.viewshed</u>, the user must specify an input elevation map name, an output raster map name, and the
       location of the viewpoint.

       For the time being the viewpoint (<b>coordinates</b> parameter) is assumed to be  located  inside  the  terrain.
       The viewpoint location is given in map coordinates.

       The output raster map may have one of three possible formats, based on which flags are set.

       By default, if no flag is set, the output is in angle-mode, and each point in the output map is marked as
       NULL  if  the  point  is  not visible or the respective point in the elevation map is NULL.  Otherwise, a
       value in [0, 180] representing the vertical angle with regard to the viewpoint, in degrees, if the  point
       is  visible.   A  value  of 0 is directly below the specified viewing position, 90 is due horizontal. The
       angle to the cell containing the viewing position is undefined and set to 180.

       If the <b>-b</b> flag is set, the output is in boolean-mode, and each point in the output map is marked as:

           •   0 if the point is no-data/null or not visible

           •   1 if the point is visible.

       If the <b>-e</b> flag is set, the output is in elevation-mode, and each point in the output map is marked as:

           •   no-data (null), if the respective point in the elevation map is no-data (null)

           •   -1, if the point is not visible

           •   the difference in elevation between the point and the viewpoint, if the point is visible.

       If you wish to identify the area of the map which  is  within  the  search  radius  but  not  visible,  a
       combination of <u>r.buffer</u> and <u>r.mapcalc</u> can be used to create a negative of the viewshed map.

       By default the elevations are not adjusted for the curvature of the earth. The user can turn this on with
       flag <b>-c</b>.

       By  default the observer is assumed to have height 1.75 map units above the terrain.  The user can change
       this using option <b>observer_elevation</b>. The value entered is in the same units as the elevation.

       By default the target is assumed to have height of 0 map units above the terrain.  The  user  can  change
       this  using option <b>target_elevation</b> to determine if objects of a given height would be visible. The value
       entered is in the same units as the elevation.

       By default there is no restriction on the maximum distance to which the observer can see.  The  user  can
       set  a  maximum distance of visibility using option <b>max_distance</b>.  The value entered is in the same units
       as the cell size of the raster.

       The user can limit view horizontally  by  specifying  a  minimum  and  maximum  directions  using  option
       <b>direction_range</b>.   The  angles  are  in degrees, CCW, East is 0.  The angles should be between 0 and 360,
       e.g. direction_range=0,180 (north view), or direction_range=270,90 (east view).

       Main memory usage: By default <u>r.viewshed</u> assumes it has 500MB of main memory, and sets  up  its  internal
       data structures so that it does not require more than this amount of RAM.  The user can set the amount of
       memory  used  by  the  program  by setting the <b>memory</b> to the number of MB of memory they would like to be
       used.

   <b>Memory</b> <b>mode</b>
       The algorithm can run in two modes: in internal memory, which means that  it  keeps  all  necessary  data
       structures in memory during the computation. And in external memory, which means that the data structures
       are  external,  i.e.  on  disk.   <u>r.viewshed</u> decides which mode to run in using the amount of main memory
       specified by the user.  The internal mode is (much) faster than the external mode.

       Ideally, the user should specify on the command line the amount of physical memory that is free  for  the
       program  to  use. Underestimating the memory may result in <u>r.viewshed</u> running in external mode instead of
       internal, which is slower. Overestimating the amount of free memory may result in <u>r.viewshed</u>  running  in
       internal mode and using virtual memory, which is slower than the external mode.

   <b>The</b> <b>algorithm</b>
       <u>r.viewshed</u>  uses  the  following  model for determining visibility: The height of a cell is assumed to be
       variable, and the actual height of a point falling into a cell, but not identical  the  cell  center,  is
       interpolated.  Thus  the  terrain is viewed as a smooth surface.  Two points are visible to each other if
       their line-of-sight does not intersect the terrain. The height for an arbitrary point x in the terrain is
       interpolated from the 4 surrounding neighbours. This means that this model does a bilinear  interpolation
       of heights.  This model is suitable for both low and high resolution rasters as well as terrain with flat
       and steep slopes.

       The core of the algorithm is determining, for each cell, the line-of-sight and its intersections with the
       cells in the terrain. For a (square) grid of <u>n</u> cells, there can be <u>O(n</u> <u>1/2)</u> cells that intersect the LOS.
       If  we  test every single such cell for every point in the grid, this adds up to <u>O(n3/2)</u> tests. We can do
       all these tests faster if we re-use information from one point to the next  (two  grid  points  that  are
       close  to  each  other  will  be  intersected  by  a lot of the same points) and organize the computation
       differently.

       More precisely, the algorithm uses a technique called <u>line</u> <u>sweeping</u>: It considers a half-line centered at
       the viewpoint, and rotates it radially around the viewpoint, 360 degrees.   During  the  sweep  it  keeps
       track  of  all the cells that intersect the sweep line at that time; These are called the <u>active</u> cells. A
       cell has 3 associated events: when it is first met by  the  sweep  line  and  inserted  into  the  active
       structure;  when  it  is  last  met by the sweep line and deleted from the active structure; and when the
       sweep line passes over its centerpoint, at which time its visibility is  determined.   To  determine  the
       visibility of a cell all cells that intersect the line-of-sight must be active, so they are in the active
       structure.  The algorithm looks at all the active cells that are between the point and the viewpoint, and
       finds  the  maximum  gradient  among  these.   If the cell’s gradient is higher, it is marked as visible,
       whereas if it is lower, it is marked as invisible.

       For a (square) raster of <u>n</u> point in total, the standard viewshed algorithm  uses  <u>O(n</u>  <u>sqrt(n))=</u>  <u>O(n3/2)</u>
       time,  while  the  sweep-line algorithm uses <u>O(n</u> <u>lg</u> <u>n)</u> time.  This algorithm is efficient in terms of CPU
       operations and can be also made efficient in terms of I/O-operations.  For all details see the REFERENCES
       below.

       The sweep-line.                                              The active cells.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Using the North Carolina dataset:  Compute viewshed from a observation point (coordinates: 638728.087167,
       220609.261501) which is 5 meters above ground:
       g.region raster=elev_lid792_1m -p
       r.viewshed input=elev_lid792_1m output=elev_lid792_1m_viewshed coordinates=638728,220609 observer_elevation=5.0
       <u>Viewshed</u> <u>shown</u> <u>on</u> <u>shaded</u> <u>terrain</u> <u>(observer</u> <u>position</u> <u>in</u> <u>the</u> <u>north-east</u> <u>quadrant</u> <u>with</u> <u>white</u> <u>dot;</u>  <u>5m</u>  <u>above</u>
       <u>ground)</u> Using the Spearfish dataset:  calculating the viewpoint from top of a mountain:
       g.region raster=elevation.10m
       r.viewshed input=elevation.10m output=viewshed coordinates=598869,4916642 memory=800

</pre><h4><b>REFERENCES</b></h4><pre>
           •   Computing Visibility on Terrains in External Memory.  Herman Haverkort, Laura Toma and Yi Zhuang.
               In <u>ACM</u> <u>Journal</u> <u>on</u> <u>Experimental</u> <u>Algorithmics</u> <u>(JEA)</u> 13 (2009).

           •   Computing  Visibility on Terrains in External Memory. Herman Haverkort, Laura Toma and Yi Zhuang.
               In the <u>Proceedings</u> <u>of</u> <u>the</u> <u>9th</u> <u>Workshop</u> <u>on</u> <u>Algorithm</u> <u>Engineering</u> <u>and</u>  <u>Experiments</u>  <u>/</u>  <u>Workshop</u>  <u>on</u>
               <u>Analytic</u> <u>Algorithms</u> <u>and</u> <u>Combinatorics</u> <u>(ALENEX/ANALCO</u> <u>2007)</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
        <u>r.mapcalc</u>

</pre><h4><b>AUTHORS</b></h4><pre>
       Laura Toma (Bowdoin College): <a href="mailto:ltoma@bowdoin.edu">ltoma@bowdoin.edu</a>

       Yi Zhuang (Carnegie-Mellon University): <a href="mailto:yzhuang@andrew.cmu.edu">yzhuang@andrew.cmu.edu</a>

       William Richard (Bowdoin College): <a href="mailto:willster3021@gmail.com">willster3021@gmail.com</a>

       Markus Metz

</pre><h4><b>SOURCE</b> <b>CODE</b></h4><pre>
       Available at: r.viewshed source code (history)

       Accessed: Friday Apr 04 01:19:55 2025

       Main index | Raster index | Topics index | Keywords index | Graphical index | Full index

       © 2003-2025 GRASS Development Team, GRASS GIS 8.4.1 Reference Manual

GRASS 8.4.1                                                                                   <u><a href="../man1grass/r.viewshed.1grass.html">r.viewshed</a></u>(1grass)
</pre>
 </div>
</div></section>
</div>
</body>
</html>