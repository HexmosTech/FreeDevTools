<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>guestfs-recipes - libguestfs, guestfish and virt tools recipes</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/libguestfs0t64">libguestfs0t64_1.54.1-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       guestfs-recipes - libguestfs, guestfish and virt tools recipes

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This page contains recipes for and links to things you can do using libguestfs, <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) and the virt
       tools.

</pre><h4><b>Access</b> <b>a</b> <b>remote</b> <b>disk</b> <b>image</b> <b>using</b> <b>guestfish</b></h4><pre>
       If the disk image is on a remote server which is accessible using SSH, HTTP, FTP, NBD, iSCSI, or similar,
       then you can open it directly.  See "ADDING REMOTE STORAGE" in <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) for several examples.  This
       requires libguestfs ≥ 1.22 and qemu ≥ 1.5.

</pre><h4><b>Audit</b> <b>a</b> <b>virtual</b> <b>machine</b> <b>for</b> <b>setuid</b> <b>files</b></h4><pre>
       See: "EXAMPLES" in <b><a href="../man1/virt-ls.1.html">virt-ls</a></b>(1).

</pre><h4><b>Audit</b> <b>a</b> <b>virtual</b> <b>machine</b> <b>for</b> <b>vulnerabilities</b> <b>and</b> <b>security</b> <b>problems</b></h4><pre>
       See: https://rwmj.wordpress.com/2013/05/16/scanning-offline-guests-using-openscap-and-guestmount/#content

</pre><h4><b>Change</b> <b>the</b> <b>background</b> <b>image</b> <b>in</b> <b>a</b> <b>Windows</b> <b>XP</b> <b>VM</b></h4><pre>
       The links below explain how to use <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) to change the background image for a user of a Windows XP
       VM.  Unfortunately the technique appears to be substantially different for each version of Windows.

       https://lists.fedoraproject.org/pipermail/virt/2011-May/002655.html
       https://lists.fedoraproject.org/pipermail/virt/2011-May/002658.html

</pre><h4><b>Checksum</b> <b>a</b> <b>file</b> <b>or</b> <b>device</b> <b>within</b> <b>a</b> <b>disk</b> <b>image</b></h4><pre>
       To checksum a whole device, or a partition, LV etc within a disk image:

        guestfish --ro -a disk.img run : checksum-device md5 /dev/sda1

       Replace "md5" with the type of checksum you want.  See "guestfs_checksum_device" in <b><a href="../man3/guestfs.3.html">guestfs</a></b>(3) for a list
       of supported types.

       <u>/dev/sda1</u> means "the first partition".  You could use <u>/dev/sda</u> to checksum the whole disk image, or the
       name of a logical volume or RAID device.

       To checksum a single file:

        guestfish --ro -a disk.img -i checksum sha256 <a href="file:/etc/passwd">/etc/passwd</a>

       or for a Windows guest:

        guestfish --ro -a disk.img -i \
          checksum sha256 'win:\windows\system32\config\SOFTWARE'

</pre><h4><b>Cloning</b> <b>a</b> <b>virtual</b> <b>machine</b></h4><pre>
       Use a combination of tools like <b><a href="../man1/cp.1.html">cp</a></b>(1), <b><a href="../man1/dd.1.html">dd</a></b>(1), and virt tools like <b><a href="../man1/virt-sysprep.1.html">virt-sysprep</a></b>(1), <b><a href="../man1/virt-sparsify.1.html">virt-sparsify</a></b>(1) and
       <b><a href="../man1/virt-resize.1.html">virt-resize</a></b>(1).

       For more details, see: "COPYING AND CLONING" in <b><a href="../man1/virt-sysprep.1.html">virt-sysprep</a></b>(1).

</pre><h4><b>Convert</b> <b>a</b> <b>CD-ROM</b> <b>/</b> <b>DVD</b> <b>/</b> <b>ISO</b> <b>to</b> <b>a</b> <b>tarball</b></h4><pre>
       This converts input <u>cd.iso</u> to output <u>cd.tar.gz</u>:

        guestfish --ro -a cd.iso -m /dev/sda tgz-out / cd.tar.gz

       To export just a subdirectory, eg. <u>/files</u>, do:

        guestfish --ro -a cd.iso -m /dev/sda tgz-out /files cd.tar.gz

</pre><h4><b>Convert</b> <b>from</b> <b>one</b> <b>format/filesystem</b> <b>to</b> <b>another</b></h4><pre>
       If you have a data disk in one format / filesystem / partition / volume manager, you can convert it
       another using this technique.

       In this example, we start with a data disk that has a single partition containing a filesystem, and we
       want to create another disk that contains the same files but on an ext3 filesystem embedded in a logical
       volume on a sparse raw-format disk.

       First create the formatted-but-empty target disk:

        truncate -s 10G target.img
        virt-format -a target.img --partition=mbr --lvm --filesystem=ext3

       Now, pipe two guestfish instances together to transfer the old data to the new disk:

        guestfish --ro -a source.img -m /dev/sda1  -- tar-out / - | \
        guestfish --rw -a target.img -m /dev/VG/LV -- tar-in - /

       To browse the final disk image, do:

        guestfish --ro -a target.img -m /dev/VG/LV
        &gt;&lt;fs&gt; ll /

       This technique is quite powerful, allowing you for example to split up source directories over the target
       filesystems.

       Note this won’t work (at least, not directly) for bootable virtual machine disks because it doesn't copy
       over the boot loader.

</pre><h4><b>Convert</b> <b>Windows</b> <b>DVD</b> <b>to</b> <b>bootable</b> <b>USB</b> <b>key</b></h4><pre>
       <a href="http://rwmj.wordpress.com/2013/05/09/tip-convert-a-windows-dvd-iso-to-a-bootable-usb-key-using-guestfish/">http://rwmj.wordpress.com/2013/05/09/tip-convert-a-windows-dvd-iso-to-a-bootable-usb-key-using-guestfish/</a>#content

</pre><h4><b>Convert</b> <b>Xen-style</b> <b>partitionless</b> <b>image</b> <b>to</b> <b>partitioned</b> <b>disk</b> <b>image</b></h4><pre>
       Xen disk images are often partitionless, meaning that the filesystem starts directly at the beginning of
       the disk with no partition table.  You can in fact use these directly in KVM (provided the guest isn't
       Windows), but some people like to convert them to regular partitioned disk images, and this is required
       for Windows guests.  Here is how to use guestfish to do this:

        guestfish
        &gt;&lt;fs&gt; add-ro input.img
        &gt;&lt;fs&gt; sparse output.img 10G     # adjust the output size
        &gt;&lt;fs&gt; run
        # Create a partition table on the output disk:
        &gt;&lt;fs&gt; part-init /dev/sdb mbr
        &gt;&lt;fs&gt; part-add /dev/sdb p 2048 -2048
        # Copy the data to the target partition:
        &gt;&lt;fs&gt; copy-device-to-device /dev/sda /dev/sdb1 sparse:true
        # Optionally resize the target filesystem.  Use ntfsresize
        # for Windows guests:
        &gt;&lt;fs&gt; resize2fs /dev/sdb1

       Such a disk image won’t be directly bootable.  You may need to boot it with an external kernel and
       initramfs (see below).  Or you can use the guestfish commands "syslinux" or "extlinux" to install a
       SYSLINUX bootloader.

</pre><h4><b>Create</b> <b>empty</b> <b>disk</b> <b>images</b></h4><pre>
       The <b><a href="../man1/virt-format.1.html">virt-format</a></b>(1) tool can do this directly.

       Use <b><a href="../man1/virt-make-fs.1.html">virt-make-fs</a></b>(1) to create a disk image with content.  This can also create some standard disk images
       such as virtual floppy devices (VFDs).

       You can also use the <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) <u>-N</u> option to create empty disk images.  The useful guide below explains
       the options available.

       https://rwmj.wordpress.com/2010/09/08/new-guestfish-n-options-in-1-5-9/#content

       <b><a href="../man1/virt-builder.1.html">virt-builder</a></b>(1) can create minimal guests.

</pre><h4><b>Delete</b> <b>a</b> <b>file</b> <b>(or</b> <b>other</b> <b>simple</b> <b>file</b> <b>operations)</b></h4><pre>
       Use guestfish.  To delete a file:

        guestfish -a disk.img -i rm /file/to/delete

       To touch a file (bring it up to date or create it):

        guestfish -a disk.img -i touch /file/to/touch

       To stat a file.  Since this is a read-only operation, we can make it safer by adding the <u>--ro</u> flag.

        guestfish --ro -a disk.img -i stat /file/to/stat

       There are dozens of these commands.  See <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) or the output of "guestfish -h"

</pre><h4><b>Diff</b> <b>two</b> <b>guests;</b> <b>compare</b> <b>a</b> <b>snapshot</b> <b>to</b> <b>the</b> <b>current</b> <b>version</b></h4><pre>
       Since libguestfs ≥ 1.26, use <b><a href="../man1/virt-diff.1.html">virt-diff</a></b>(1) to look for differences between two guests (for example if they
       were originally cloned from the same source), or between two snapshots from the same guest.  In earlier
       versions of libguestfs, use <b><a href="../man1/virt-ls.1.html">virt-ls</a></b>(1).

</pre><h4><b>Disable</b> <b>a</b> <b>systemd</b> <b>service</b></h4><pre>
       The following is the equivalent of "systemctl mask ...". To disable the "cloud-init" service so it
       doesn't start at next boot:

        guestfish -a disk.img -i \
            ln-sf /dev/null /etc/systemd/system/cloud-init.service

       To disable tmp-on-tmpfs:

        guestfish -a disk.img -i \
            ln-sf /dev/null /etc/systemd/system/tmp.mount

       One problem with the commands above is there is no feedback if you get the name of the service you are
       trying to mask wrong.  But you can use <b><a href="../man1/virt-ls.1.html">virt-ls</a></b>(1) to list the available systemd services like this:

        virt-ls -a /tmp/fedora-19.img -R <a href="file:/lib/systemd/system">/lib/systemd/system</a>

</pre><h4><b>Drive</b> <b>letters</b> <b>over</b> <b>FUSE</b></h4><pre>
       You have a Windows guest, and you want to expose the drive letters as FUSE mountpoints (<u>/C/...</u>, <u>/D/...</u>
       etc).  Instead of <b><a href="../man1/guestmount.1.html">guestmount</a></b>(1), use this Perl script:

        #!<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?perl">/usr/bin/perl</a> -w
        use strict;
        use Sys::Guestfs;
        $| = 1;
        die "usage: $0 mountpoint disk.img" if @ARGV &lt; 2;
        my $mp = shift @ARGV;
        my $g = new Sys::Guestfs;
        $g-&gt;add_drive_opts ($_) foreach @ARGV;
        $g-&gt;launch;
        my @roots = $g-&gt;inspect_os;
        die "$0: no operating system found" if @roots != 1;
        my $root = $roots[0];
        die "$0: not Windows" if $g-&gt;inspect_get_type ($root) ne "windows";
        my %map = $g-&gt;inspect_get_drive_mappings ($root);
        foreach (keys %map) {
            $g-&gt;mkmountpoint ("/$_");
            eval { $g-&gt;mount ($map{$_}, "/$_") };
            warn "$@ (ignored)\n" if $@;
        }
        $g-&gt;mount_local ($mp);
        print "filesystem ready on $mp\n";
        $g-&gt;mount_local_run;
        $g-&gt;shutdown;

       You can use the script like this:

        $ mkdir /tmp/mnt
        $ ./drive-letters.pl /tmp/mnt windows7.img
        filesystem ready on /tmp/mnt

       In another window:

        $ cd /tmp/mnt
        $ ls
        C  D
        $ cd C
        $ ls
        Documents and Settings
        PerfLogs
        ProgramData
        Program Files
        [etc]
        $ cd ..<a href="file:/..">/..</a>
        $ guestunmount /tmp/mnt

</pre><h4><b>Dump</b> <b>raw</b> <b>filesystem</b> <b>content</b> <b>from</b> <b>inside</b> <b>a</b> <b>disk</b> <b>image</b> <b>or</b> <b>VM</b></h4><pre>
       You can use the <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) "download" command to extract the raw filesystem content from any filesystem
       in a disk image or a VM (even one which is encrypted or buried inside an LV or RAID device):

        guestfish --ro -a disk.img run : download /dev/sda1 sda1.img

        guestfish --ro -d Guest run : download /dev/vg_guest/lv_root lv.img

       To download to stdout, replace the filename with a "-" character:

        guestfish --ro -a disk.img run : download /dev/sda1 - | gzip &gt; sda1.gz

       To list the filesystems in a disk image, use <b><a href="../man1/virt-filesystems.1.html">virt-filesystems</a></b>(1).

       See also "Uploading raw filesystem content".

</pre><h4><b>Edit</b> <b>grub</b> <b>configuration</b> <b>in</b> <b>a</b> <b>VM</b></h4><pre>
       You can use this to:

       •   Fix a virtual machine that does not boot.

       •   Change which kernel is used to boot the VM.

       •   Change kernel command line options.

       Use <b><a href="../man1/virt-edit.1.html">virt-edit</a></b>(1) to edit the grub configuration:

        virt-edit -d BrokenGuest /boot/grub2/grub.cfg

       or for general tinkering inside an unbootable VM use <b><a href="../man1/virt-rescue.1.html">virt-rescue</a></b>(1) like this:

        virt-rescue -d BrokenGuest

</pre><h4><b>Export</b> <b>any</b> <b>directory</b> <b>from</b> <b>a</b> <b>VM</b></h4><pre>
       To export <u><a href="file:/home">/home</a></u> from a VM into a local directory use <b><a href="../man1/virt-copy-out.1.html">virt-copy-out</a></b>(1):

        virt-copy-out -d Guest <a href="file:/home">/home</a> .

       Notes:

       •   The  final  dot  of the command is not a printing error.  It means we want to copy out to the current
           directory.

       •   This creates a directory called "home" under the current directory.

       If the guest is a Windows guest then you can use drive letters and backslashes, but you must  prefix  the
       path with "win:" and quote it to protect it from the shell, like this:

        virt-copy-out -d WinGuest 'win:c:\windows\system32\config' .

       To get the output as a compressed tarball, do:

        virt-tar-out -d Guest <a href="file:/home">/home</a> - | gzip --best &gt; home.tar.gz

       Although  it  sounds  tempting,  this is usually not a reliable way to get a backup from a running guest.
       See the entry in the FAQ: <a href="http://libguestfs.org/FAQ.html">http://libguestfs.org/FAQ.html</a>#backup

</pre><h4><b>Export</b> <b>external</b> <b>kernel</b> <b>and</b> <b>initramfs</b> <b>(initrd)</b></h4><pre>
       If a Linux guest doesn't have a boot loader or it is broken, then  you  can  usually  boot  it  using  an
       external kernel and initramfs.  In this configuration, the hypervisor acts like a bootloader, loading the
       kernel from the host disk into guest memory and jumping straight into the kernel.

       However  you  may  wonder  how  to  get the right kernel corresponding to the disk image you have.  Since
       libguestfs ≥ 1.24 <b><a href="../man1/virt-builder.1.html">virt-builder</a></b>(1) can get the latest kernel and corresponding initramfs for you:

        mkdir outputdir
        virt-builder --get-kernel disk.img -o outputdir
        ls -lh outputdir

</pre><h4><b>Find</b> <b>out</b> <b>which</b> <b>user</b> <b>is</b> <b>using</b> <b>the</b> <b>most</b> <b>space</b></h4><pre>
       This simple script examines a Linux guest to find out which user is using the most space  in  their  home
       directory:

        #!<a href="file:/bin/sh">/bin/sh</a> -

        set -e

        vm="$1"
        dir=<a href="file:/home">/home</a>

        eval $(guestfish --ro -d "$vm" -i --listen)

        for d in $(guestfish --remote ls "$dir"); do
            echo -n "$dir/$d"
            echo -ne '\t'
            guestfish --remote du "$dir/$d";
        done | sort -nr -k 2

        guestfish --remote exit

</pre><h4><b>Get</b> <b>DHCP</b> <b>address</b> <b>from</b> <b>a</b> <b>VM</b></h4><pre>
       The link below explains the many different possible techniques for getting the last assigned DHCP address
       of a virtual machine.

       https://rwmj.wordpress.com/2011/03/31/tip-code-for-getting-dhcp-address-from-a-virtual-machine-disk-image/#content

       In  the  libguestfs source examples directory you will find the latest version of the <u>virt-dhcp-address.c</u>
       program.

</pre><h4><b>Get</b> <b>the</b> <b>operating</b> <b>system</b> <b>product</b> <b>name</b> <b>string</b></h4><pre>
       Save the following script into a file called <u>product-name.sh</u>:

        #!<a href="file:/bin/sh">/bin/sh</a> -
        set -e
        eval "$(guestfish --ro -d "$1" --i --listen)"
        root="$(guestfish --remote inspect-get-roots)"
        guestfish --remote inspect-get-product-name "$root"
        guestfish --remote exit

       Make the script executable and run it on a named guest:

        $ product-name.sh fedora-40.img
        Fedora Linux 40 (Forty)

       You can also use an XPath query on the <b><a href="../man1/virt-inspector.1.html">virt-inspector</a></b>(1) XML using the "xpath" command line tool or  from
       your favourite programming language:

        $ virt-inspector -a fedora-40.img &gt; xml
        $ xpath -e '//product_name' &lt; xml
        Found 1 nodes in stdin:
        -- NODE --
        &lt;product_name&gt;Fedora Linux 40 (Forty)&lt;/product_name&gt;

</pre><h4><b>Get</b> <b>the</b> <b>default</b> <b>boot</b> <b>kernel</b> <b>for</b> <b>a</b> <b>Linux</b> <b>VM</b></h4><pre>
       The link below contains a program to print the default boot kernel for a Linux VM.

       https://rwmj.wordpress.com/2010/10/30/tip-use-augeas-to-get-the-default-boot-kernel-for-a-vm/#content

       It uses Augeas, and the technique is generally applicable for many different tasks, such as:

       •   listing the user accounts in the guest

       •   what repositories is it configured to use

       •   what NTP servers does it connect to

       •   what were the boot messages last time it booted

       •   listing who was logged in recently

       <a href="http://augeas.net/">http://augeas.net/</a>

</pre><h4><b>Hanging</b> <b>guests</b></h4><pre>
       There are various ways to use libguestfs to find out why a guest is hanging or unresponsive:

       1.  Read the log files using virt-cat:

            virt-cat Guest /var/log/messages | less

       2.  Read the Windows Event Log (Windows Vista or later only):

           https://rwmj.wordpress.com/2011/04/17/decoding-the-windows-event-log-using-guestfish/#content

       3.  Find out which files were last updated in a guest:

           https://rwmj.wordpress.com/2012/02/27/using-libguestfs-to-find-out-why-a-windows-guest-was-hanging/#content

           This might give you a clue as to what program is running.

</pre><h4><b>Hex-dumping</b> <b>sectors</b> <b>from</b> <b>the</b> <b>guest</b></h4><pre>
       Hex-dump the boot partition (Master Boot Record / first sector):

        guestfish --ro -a disk.img run : pread-device /dev/sda 0x200 0 |
          hexdump -C

       (0x200 = 512 bytes which is the size of traditional PC sectors)

       To hexdump the N'th partition, substitute a number for "N" in the following command:

        guestfish --ro -a disk.img \
            run : pread-device /dev/sda 0x200 $((N*0x200)) |
          hexdump -C

</pre><h4><b>Hex-editing</b> <b>sectors</b> <b>in</b> <b>the</b> <b>guest</b></h4><pre>
       Hex-edit the boot partition (Master Boot Record / first sector):

        guestfish --rw -a disk.img run : hexedit /dev/sda 0x200

</pre><h4><b>Install</b> <b>packages</b> <b>(RPMs,</b> <b>Debian</b> <b>packages)</b> <b>in</b> <b>a</b> <b>guest</b></h4><pre>
       Since  libguestfs  1.26,  <b><a href="../man1/virt-builder.1.html">virt-builder</a></b>(1), <b><a href="../man1/virt-customize.1.html">virt-customize</a></b>(1) and <b><a href="../man1/virt-sysprep.1.html">virt-sysprep</a></b>(1) have an <u>--install</u> option
       for installing packages in Linux guests.  (Use virt-customize if you have an  existing  guest,  or  virt-
       builder if you want to create a guest from scratch).

       For example:

        virt-builder fedora-20 --install emacs

</pre><h4><b>Install</b> <b>packages</b> <b>from</b> <b>an</b> <b>alternate</b> <b>repository</b></h4><pre>
       Since libguestfs 1.26, you can use <b><a href="../man1/virt-builder.1.html">virt-builder</a></b>(1), <b><a href="../man1/virt-customize.1.html">virt-customize</a></b>(1) or <b><a href="../man1/virt-sysprep.1.html">virt-sysprep</a></b>(1) <u>--edit</u> option to
       edit repository metadata before installing packages

       For example this would install packages from the updates-testing repository in Fedora:

        virt-builder fedora-20 \
          --edit '/etc/yum.repos.d/fedora-updates-testing.repo:
                    s/enabled=0/enabled=1/' \
          --install emacs

</pre><h4><b>Install</b> <b>SYSLINUX</b> <b>bootloader</b> <b>in</b> <b>a</b> <b>guest</b></h4><pre>
       SYSLINUX  is  a  small,  easy to configure bootloader for Linux and Windows guests.  If your guest is not
       bootable, you can install the SYSLINUX bootloader using either the  guestfish  commands  "syslinux"  (for
       FAT-based guests) or "extlinux" (for ext2/3/4 and btrfs-based guests).

       This  guide  assumes  a  Linux  guest  where  <u>/dev/sda1</u>  is <u><a href="file:/boot">/boot</a></u>, <u><a href="file:/boot/vmlinuz">/boot/vmlinuz</a></u> is the guest kernel, and
       <u>/dev/sda3</u> is the root partition.  For a Windows guest you would need a FAT-formatted boot  partition  and
       you would need to use the "syslinux" command instead.

       Create   a   <u>syslinux.cfg</u>   configuration   file.    You  should  check  the  SYSLINUX  documentation  at
       <a href="http://www.syslinux.org">http://www.syslinux.org</a> but it may look something like this:

        DEFAULT linux
        LABEL linux
          SAY Booting the kernel
          KERNEL vmlinuz
          INITRD initrd
          APPEND ro root=/dev/sda3

       Locate the syslinux master boot record (a file called something like <u>/usr/share/syslinux/mbr.bin</u>).

        guestfish -a disk.img -i
        # Upload the master boot record and configuration file:
        &gt;&lt;fs&gt; upload ..../mbr.bin /boot/mbr.bin
        &gt;&lt;fs&gt; upload ..../syslinux.cfg /boot/syslinux.cfg
        # Put the MBR into the boot sector:
        &gt;&lt;fs&gt; copy-file-to-device /boot/mbr.bin /dev/sda size:440
        # Install syslinux on the first partition:
        &gt;&lt;fs&gt; extlinux <a href="file:/boot">/boot</a>
        # Set the first partition as bootable:
        &gt;&lt;fs&gt; part-set-bootable /dev/sda 1 true

       See                                                                                                 also:
       <a href="http://rwmj.wordpress.com/2013/04/04/new-in-libguestfs-use-syslinux-or-extlinux-to-make-bootable-guests/">http://rwmj.wordpress.com/2013/04/04/new-in-libguestfs-use-syslinux-or-extlinux-to-make-bootable-guests/</a>#content

</pre><h4><b>List</b> <b>applications</b> <b>installed</b> <b>in</b> <b>a</b> <b>VM</b></h4><pre>
       Save the following to a file <u>list-apps.sh</u>:

        #!<a href="file:/bin/sh">/bin/sh</a> -
        set -e
        eval "$(guestfish --ro -d "$1" --i --listen)"
        root="$(guestfish --remote inspect-get-roots)"
        guestfish --remote inspect-list-applications "$root"
        guestfish --remote exit

       Make the file executable and then you can run it on any named virtual machine:

        # list-apps.sh WinGuest
        [0] = {
          app_name: Mozilla Firefox (3.6.12)
          app_display_name: Mozilla Firefox (3.6.12)
          app_epoch: 0
          app_version: 3.6.12 (en-GB)
          app_release:
          app_install_path: C:\Program Files\Mozilla Firefox
          app_trans_path:
          app_publisher: Mozilla
          app_url: <a href="http://www.mozilla.com/en-GB/">http://www.mozilla.com/en-GB/</a>
          app_source_package:
          app_summary:
          app_description: Mozilla Firefox
        }
        [1] = {
          app_name: VLC media player
          app_display_name: VLC media player 1.1.5
          app_epoch: 0
          app_version: 1.1.5
          app_release:
          app_install_path: C:\Program Files\VideoLAN\VLC
          app_trans_path:
          app_publisher: VideoLAN
          app_url: <a href="http://www.videolan.org/">http://www.videolan.org/</a>
          app_source_package:
          app_summary:
          app_description:
        }

       If  you  want to run the script on disk images (instead of libvirt virtual machines), change "-d "$1"" to
       "-a "$1"".  See also <b><a href="../man1/virt-inspector.1.html">virt-inspector</a></b>(1).

</pre><h4><b>List</b> <b>files</b> <b>and</b> <b>directories</b> <b>in</b> <b>a</b> <b>VM</b></h4><pre>
       Use <b><a href="../man1/virt-ls.1.html">virt-ls</a></b>(1).

</pre><h4><b>List</b> <b>services</b> <b>in</b> <b>a</b> <b>Windows</b> <b>VM</b></h4><pre>
       The link below contains a script that can be used to list out the services from a Windows VM, and whether
       those services run at boot time or are loaded on demand.

       https://rwmj.wordpress.com/2010/12/10/tip-list-services-in-a-windows-guest/#content

</pre><h4><b>Make</b> <b>a</b> <b>disk</b> <b>image</b> <b>sparse</b></h4><pre>
       Use <b><a href="../man1/virt-sparsify.1.html">virt-sparsify</a></b>(1).

</pre><h4><b>Monitor</b> <b>disk</b> <b>usage</b> <b>over</b> <b>time</b></h4><pre>
       You can use <b><a href="../man1/virt-df.1.html">virt-df</a></b>(1) to monitor disk usage of your guests over time.  The link below contains a guide.

       <a href="http://web.archive.org/web/20130214073726/http">http://web.archive.org/web/20130214073726/http</a>://virt-tools.org/learning/advanced-virt-df/

</pre><h4><b>Reading</b> <b>the</b> <b>Windows</b> <b>Event</b> <b>Log</b> <b>from</b> <b>Windows</b> <b>Vista</b> <b>(or</b> <b>later)</b></h4><pre>
       <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) plus the tools described in the link below can be used to read out  the  Windows  Event  Log
       from any virtual machine running Windows Vista or a later version.

       https://rwmj.wordpress.com/2011/04/17/decoding-the-windows-event-log-using-guestfish/#content

</pre><h4><b>Remove</b> <b>root</b> <b>password</b> <b>(Linux)</b></h4><pre>
       Using  the <b><a href="../man1/virt-edit.1.html">virt-edit</a></b>(1) <u>-e</u> option you can do simple replacements on files.  One use is to remove the root
       password from a Linux guest:

        virt-edit -d domname <a href="file:/etc/passwd">/etc/passwd</a> -e 's/^root:.*?:<a href="file:/root">/root</a>::/'

        virt-edit -a disk.img <a href="file:/etc/passwd">/etc/passwd</a> -e 's/^root:.*?:<a href="file:/root">/root</a>::/'

</pre><h4><b>Remove</b> <b>Administrator</b> <b>password</b> <b>(Windows)</b></h4><pre>
       The link below contains one technique for removing the Administrator password from a Windows VM, or to be
       more precise, it gives you a command prompt the next time you log in which you  can  use  to  bypass  any
       security:

       https://mdbooth.wordpress.com/2010/10/18/resetting-a-windows-guests-administrator-password-with-guestfish/

</pre><h4><b>Sysprepping</b> <b>a</b> <b>virtual</b> <b>machine</b> <b>(Windows)</b></h4><pre>
       It  is  possible to do a "sysprep" using libguestfs alone, although not straightforward.  Currently there
       is code in the Aeolus Oz project which does this (using libguestfs).  It is likely we will  add  this  to
       <b><a href="../man1/virt-sysprep.1.html">virt-sysprep</a></b>(1) in future.

       https://github.com/clalancette/oz https://www.redhat.com/archives/virt-tools-list/2011-May/msg00019.html

</pre><h4><b>Unpack</b> <b>a</b> <b>live</b> <b>CD</b></h4><pre>
       Linux  live  CDs  often  contain multiple layers of disk images wrapped like a Russian doll.  You can use
       <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) to look inside these multiple layers, as outlined in the guide below.

       https://rwmj.wordpress.com/2009/07/15/unpack-the-russian-doll-of-a-f11-live-cd/#content

</pre><h4><b>Uploading</b> <b>and</b> <b>downloading</b> <b>files</b></h4><pre>
       The link below contains general tips on uploading (copying in) and downloading (copying out)  files  from
       VMs.

       https://rwmj.wordpress.com/2010/12/02/tip-uploading-and-downloading/#content

</pre><h4><b>Uploading</b> <b>raw</b> <b>filesystem</b> <b>content</b></h4><pre>
       You can use <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) to upload whole filesystems into a VM, even into a filesystem which is encrypted
       or buried inside an LV or RAID device:

        guestfish --rw -a disk.img run : upload sda1.img /dev/sda1

        guestfish --rw -d Guest run : upload lv.img /dev/vg_guest/lv_root

       One  common  problem  is  that  the  filesystem isn't the right size for the target.  If it is too large,
       there’s not much you can do with libguestfs - you have to prepare the filesystem differently.  But if the
       filesystem needs to expand into the target, you can use guestfish to resize it to the right size:

        guestfish --rw -d Guest run : \
          upload lv.img /dev/vg_guest/lv_root : \
          resize2fs /dev/vg_guest/lv_root

       (or use "ntfsresize" if the filesystem is NTFS).

</pre><h4><b>Use</b> <b>libguestfs</b> <b>tools</b> <b>on</b> <b>VMware</b> <b>ESX</b> <b>guests</b></h4><pre>
       The link below explains how to use libguestfs, <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1) and the virt tools on any VMware ESX  guests,
       by first sharing the VMware VMFS over sshfs.

       https://rwmj.wordpress.com/2011/05/10/tip-use-libguestfs-on-vmware-esx-guests/#content

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/guestfs.3.html">guestfs</a></b>(3),  <b><a href="../man1/guestfish.1.html">guestfish</a></b>(1), <b><a href="../man3/guestfs-examples.3.html">guestfs-examples</a></b>(3), <b><a href="../man3/guestfs-erlang.3.html">guestfs-erlang</a></b>(3), <b><a href="../man3/guestfs-gobject.3.html">guestfs-gobject</a></b>(3), <b><a href="../man3/guestfs-golang.3.html">guestfs-golang</a></b>(3),
       <b><a href="../man3/guestfs-java.3.html">guestfs-java</a></b>(3), <b><a href="../man3/guestfs-lua.3.html">guestfs-lua</a></b>(3), <b><a href="../man3/guestfs-ocaml.3.html">guestfs-ocaml</a></b>(3), <b><a href="../man3/guestfs-perl.3.html">guestfs-perl</a></b>(3),  <b><a href="../man3/guestfs-python.3.html">guestfs-python</a></b>(3),  <b><a href="../man3/guestfs-ruby.3.html">guestfs-ruby</a></b>(3),
       <a href="http://libguestfs.org/">http://libguestfs.org/</a>.

</pre><h4><b>AUTHORS</b></h4><pre>
       Richard W.M. Jones ("rjones at redhat dot com")

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright (C) 2009-2023 Red Hat Inc.

</pre><h4><b>LICENSE</b></h4><pre>
       This  manual  page  contains  examples  which we hope you will use in your programs.  The examples may be
       freely copied, modified and distributed for any purpose without any restrictions.

</pre><h4><b>BUGS</b></h4><pre>
       To     get      a      list      of      bugs      against      libguestfs,      use      this      link:
       https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools

       To       report       a       new       bug       against       libguestfs,      use      this      link:
       https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools

       When reporting a bug, please supply:

       •   The version of libguestfs.

       •   Where you got libguestfs (eg. which Linux distro, compiled from source, etc)

       •   Describe the bug accurately and give a way to reproduce it.

       •   Run <b><a href="../man1/libguestfs-test-tool.1.html">libguestfs-test-tool</a></b>(1) and paste the <b>complete,</b> <b>unedited</b> output into the bug report.

libguestfs-1.54.1                                  2025-02-18                                 <u><a href="../man1/guestfs-recipes.1.html">guestfs-recipes</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>