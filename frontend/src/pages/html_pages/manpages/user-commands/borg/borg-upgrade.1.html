<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>borg-upgrade - upgrade a repository from a previous version</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/borgbackup">borgbackup_1.4.0-5_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       borg-upgrade - upgrade a repository from a previous version

</pre><h4><b>SYNOPSIS</b></h4><pre>
       borg [common options] upgrade [options] [REPOSITORY]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Upgrade an existing, local Borg repository.

   <b>When</b> <b>you</b> <b>do</b> <b>not</b> <b>need</b> <b>borg</b> <b>upgrade</b>
       Not every change requires that you run <b>borg</b> <b>upgrade</b>.

       You do <b>not</b> need to run it when:

       • moving your repository to a different place

       • upgrading to another point release (like 1.0.x to 1.0.y), except when noted otherwise in the changelog

       • upgrading from 1.0.x to 1.1.x, except when noted otherwise in the changelog

   <b>Borg</b> <b>1.x.y</b> <b>upgrades</b>
       Archive TAM authentication:

       Use  <b>borg</b>  <b>upgrade</b> <b>--archives-tam</b> <b>REPO</b> to add archive TAMs to all archives that are not TAM authenticated
       yet.  This is a convenient method to just trust all archives present - if an archive does  not  have  TAM
       authentication yet, a TAM will be added.  Archives created by old borg versions &lt; 1.0.9 do not have TAMs.
       Archives  created  by  newer borg version should have TAMs already.  If you have a high risk environment,
       you should not just run this, but first verify that the archives are authentic and not malicious (== have
       good content, have a good timestamp).  Borg 1.2.5+ needs all archives to be TAM authenticated for  safety
       reasons.

       This upgrade needs to be done once per repository.

       Manifest TAM authentication:

       Use  <b>borg</b>  <b>upgrade</b>  <b>--tam</b>  <b>REPO</b>  to require manifest authentication introduced with Borg 1.0.9 to address
       security issues. This means that modifying the repository after doing this with a version prior to  1.0.9
       will  raise  a  validation  error,  so  only  perform  this  upgrade after updating all clients using the
       repository to 1.0.9 or newer.

       This upgrade should be done on each client for safety reasons.

       If a repository is accidentally modified with a pre-1.0.9 client after this  upgrade,  use  <b>borg</b>  <b>upgrade</b>
       <b>--tam</b> <b>--force</b> <b>REPO</b> to remedy it.

       If  you  routinely do this you might not want to enable this upgrade (which will leave you exposed to the
       security issue). You can reverse the upgrade by issuing <b>borg</b> <b>upgrade</b> <b>--disable-tam</b> <b>REPO</b>.

       See    <u>https://borgbackup.readthedocs.io/en/stable/changes.html#pre-1-0-9-manifest-spoofing-vulnerability</u>
       for details.

   <b>Attic</b> <b>and</b> <b>Borg</b> <b>0.xx</b> <b>to</b> <b>Borg</b> <b>1.x</b>
       This  currently  supports converting an Attic repository to Borg and also helps with converting Borg 0.xx
       to 1.0.

       Currently, only LOCAL repositories can be upgraded (issue #465).

       Please note that <b>borg</b> <b>create</b> (since 1.0.0) uses bigger chunks by default than old borg or attic  did,  so
       the  new  chunks  won't deduplicate with the old chunks in the upgraded repository.  See <b>--chunker-params</b>
       option of <b>borg</b> <b>create</b> and <b>borg</b> <b>recreate</b>.

       <b>borg</b> <b>upgrade</b> will change the magic strings in the repository's segments  to  match  the  new  Borg  magic
       strings.  The  keyfiles  found  in $ATTIC_KEYS_DIR or <a href="file:~/.attic/keys/">~/.attic/keys/</a> will also be converted and copied to
       $BORG_KEYS_DIR or <a href="file:~/.config/borg/keys.">~/.config/borg/keys.</a>

       The  cache  files  are  converted,  from  $ATTIC_CACHE_DIR  or  <a href="file:~/.cache/attic">~/.cache/attic</a>  to   $BORG_CACHE_DIR   or
       <a href="file:~/.cache/borg">~/.cache/borg</a>,  but  the  cache layout between Borg and Attic changed, so it is possible the first backup
       after the conversion takes longer than expected due to the cache resync.

       Upgrade should be able to resume if interrupted, although it will still iterate over all segments. If you
       want to start from scratch, use <u>borg</u> <u>delete</u> over the copied repository to make sure the cache  files  are
       also removed:

          borg delete borg

       Unless  <b>--inplace</b>  is  specified,  the  upgrade process first creates a backup copy of the repository, in
       REPOSITORY.before-upgrade-DATETIME, using hardlinks.  This requires that the repository  and  its  parent
       directory  reside  on  same  filesystem  so  the hardlink copy can work.  This takes longer than in place
       upgrades, but is much safer and gives progress information (as opposed to <b>cp</b> <b>-al</b>). Once you are satisfied
       with the conversion, you can safely destroy the backup copy.

       WARNING: Running the upgrade in place will make the current copy unusable with older version, with no way
       of going back to previous versions. This can PERMANENTLY DAMAGE YOUR REPOSITORY!  Attic CAN NOT READ BORG
       REPOSITORIES, as the magic strings have changed. You have been warned.

</pre><h4><b>OPTIONS</b></h4><pre>
       See <u><a href="../man1/borg-common.1.html">borg-common</a>(1)</u> for common options of Borg commands.

   <b>arguments</b>
       <b>REPOSITORY</b>
              path to the repository to be upgraded

   <b>optional</b> <b>arguments</b>
       <b>-n</b>, <b>--dry-run</b>
              do not change repository

       <b>--inplace</b>
              rewrite repository in place, with no chance of going back to older versions of the repository.

       <b>--force</b>
              Force upgrade

       <b>--tam</b>  Enable manifest authentication (in key and cache) (Borg 1.0.9 and later).

       <b>--check-tam</b>
              check manifest authentication (in key and cache).

       <b>--disable-tam</b>
              Disable manifest authentication (in key and cache).

       <b>--check-archives-tam</b>
              check TAM authentication for all archives.

       <b>--archives-tam</b>
              add TAM authentication for all archives.

</pre><h4><b>EXAMPLES</b></h4><pre>
          # Upgrade the borg repository to the most recent version.
          $ borg upgrade -v /path/to/repo
          making a hardlink copy in /path/to/repo.before-upgrade-2016-02-15-20:51:55
          opening attic repository with borg and converting
          no key file found for repository
          converting repo index /path/to/repo/index.0
          converting 1 segments...
          converting borg 0.xx to borg current
          no key file found for repository

   <b>Upgrading</b> <b>a</b> <b>passphrase</b> <b>encrypted</b> <b>attic</b> <b>repo</b>
       attic offered a "passphrase" encryption mode, but this was removed  in  borg  1.0  and  replaced  by  the
       "repokey" mode (which stores the passphrase-protected encryption key into the repository config).

       Thus, to upgrade a "passphrase" attic repo to a "repokey" borg repo, 2 steps are needed, in this order:

       • borg upgrade repo

       • borg key migrate-to-repokey repo

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/borg-common.1.html">borg-common</a>(1)</u>

</pre><h4><b>AUTHOR</b></h4><pre>
       The Borg Collective

                                                   2024-07-02                                    <u><a href="../man1/BORG-UPGRADE.1.html">BORG-UPGRADE</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>