<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>strelaysrv - Syncthing Relay Server</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/syncthing-relaysrv">syncthing-relaysrv_1.29.2~ds1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       strelaysrv - Syncthing Relay Server

</pre><h4><b>SYNOPSIS</b></h4><pre>
          strelaysrv [-debug] [-ext-address=&lt;address&gt;] [-global-rate=&lt;bytes/s&gt;] [-keys=&lt;dir&gt;] [-listen=&lt;listen addr&gt;]
                     [-message-timeout=&lt;duration&gt;] [-nat] [-nat-lease=&lt;duration&gt;] [-nat-renewal=&lt;duration&gt;]
                     [-nat-timeout=&lt;duration&gt;] [-network-timeout=&lt;duration&gt;] [-per-session-rate=&lt;bytes/s&gt;]
                     [-ping-interval=&lt;duration&gt;] [-pools=&lt;pool addresses&gt;] [-pprof] [-protocol=&lt;string&gt;]
                     [-provided-by=&lt;string&gt;] [-status-srv=&lt;listen addr&gt;] [-token=&lt;string&gt;] [-version]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Syncthing  relies on a network of community-contributed relay servers. Anyone can run a relay server, and
       it will automatically join the relay pool and be available to Syncthing users. The current list of relays
       can be found at <u>https://relays.syncthing.net/</u>.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-debug</b> Enable debug output.

       <b>-ext-address=&lt;address&gt;</b>
              An optional address to advertising as being available on. Allows listening on an unprivileged port
              with port forwarding from e.g. 443, and be connected to on port 443.

       <b>-global-rate=&lt;bytes/s&gt;</b>
              Global rate limit, in bytes/s.

       <b>-keys=&lt;dir&gt;</b>
              Directory where cert.pem and key.pem is stored (default “.”).

       <b>-listen=&lt;listen</b> <b>addr&gt;</b>
              Protocol listen address (default “:22067”).

       <b>-message-timeout=&lt;duration&gt;</b>
              Maximum amount of time we wait for relevant messages to arrive (default 1m0s).

       <b>-nat</b>   Use UPnP/NAT-PMP to acquire external port mapping

       <b>-nat-lease=&lt;duration&gt;</b>
              NAT lease length in minutes (default 60)

       <b>-nat-renewal=&lt;duration&gt;</b>
              NAT renewal frequency in minutes (default 30)

       <b>-nat-timeout=&lt;duration&gt;</b>
              NAT discovery timeout in seconds (default 10)

       <b>-network-timeout=&lt;duration&gt;</b>
              Timeout for network operations between the client and the relay. If no data  is  received  between
              the  client and the relay in this period of time, the connection is terminated. Furthermore, if no
              data is sent between either clients being relayed within this period of time, the session is  also
              terminated. (default 2m0s)

       <b>-per-session-rate=&lt;bytes/s&gt;</b>
              Per session rate limit, in bytes/s.

       <b>-ping-interval=&lt;duration&gt;</b>
              How often pings are sent (default 1m0s).

       <b>-pools=&lt;pool</b> <b>addresses&gt;</b>
              Comma     separated     list     of     relay    pool    addresses    to    join    (default    “‐
              <u>https://relays.syncthing.net/endpoint</u>”).  Blank  to  disable  announcement  to  a  pool,   thereby
              remaining a private relay.

       <b>-pprof</b> Enable the built in profiling on the status server

       <b>-protocol=&lt;string&gt;</b>
              Protocol  used  for  listening. ‘tcp’ for IPv4 and IPv6, ‘tcp4’ for IPv4, ‘tcp6’ for IPv6 (default
              “tcp”).

       <b>-provided-by=&lt;string&gt;</b>
              An optional description about who provides the relay.

       <b>-status-srv=&lt;listen</b> <b>addr&gt;</b>
              Listen address for status service (blank to disable) (default “:22070”).  Status service  is  used
              by the relay pool server UI for displaying stats (data transferred, number of clients, etc.)

       <b>-token=&lt;string&gt;</b>
              Token to restrict access to the relay (optional). Disables joining any pools.

       <b>-version</b>
              Show version

   <b>Installing</b>
       Go  to  <u>releases</u>  &lt;<b>https://github.com/syncthing/relaysrv/releases</b>&gt;  and download the file appropriate for
       your operating system. Unpacking it will yield a binary called <b>strelaysrv</b> (or <b>strelaysrv.exe</b> on Windows).
       Start this in whatever way you are most comfortable with; double clicking should work  in  any  graphical
       environment.  At  first  start,  strelaysrv  will  generate certificate files and database in the current
       directory unless given flags to the contrary. It will also join the default pools of relays, which  means
       that it is publicly visible and any client can connect to it.  The startup message prints instructions on
       how to change this.

       The relay server can also be obtained through apt, the Debian/Ubuntu package manager. Recent releases can
       be  found  at  syncthing’s  <u>apt</u>  <u>repository</u>  &lt;<b>https://apt.syncthing.net/</b>&gt;.  The  name  of  the package is
       syncthing-relaysrv.

</pre><h4><b>SETTING</b> <b>UP</b></h4><pre>
       Primarily, you need to decide on a directory to store the TLS key and certificate and a listen port.  The
       default listen port of 22067 works, but for optimal compatibility a well known port for encrypted traffic
       such  as  443  is  recommended.  This  may  require additional setup to work without running as root or a
       privileged user, see <u>Running</u> <u>on</u> <u>port</u> <u>443</u> <u>as</u> <u>an</u> <u>unprivileged</u> <u>user</u> below. In principle something similar to
       this should work on a Linux/Unix system:

          $ sudo useradd strelaysrv
          $ sudo mkdir /etc/strelaysrv
          $ sudo chown strelaysrv /etc/strelaysrv
          $ sudo -u strelaysrv /usr/local/bin/strelaysrv -keys /etc/strelaysrv

       This creates a user <b>strelaysrv</b> and a directory <b>/etc/strelaysrv</b> to store the keys. The keys are  generated
       on first startup. The relay will join the global relay pool, unless a <b>-pools=""</b> argument is given.

       To  make  the  relay server start automatically at boot, use the recommended procedure for your operating
       system.

   <b>Client</b> <b>configuration</b>
       Syncthing can be configured to use specific relay servers (exclusively of the public pool) by adding  the
       required  servers to the Sync Protocol Listen Address field, under Actions and Settings. The format is as
       follows:

          relay://&lt;host name|IP&gt;[:port]/?id=&lt;relay device ID&gt;

       For example:

          relay://private-relay-1.example.com:443/?id=ITZRNXE-YNROGBZ-HXTH5P7-VK5NYE5-QHRQGE2-7JQ6VNJ-KZUEDIU-5PPR5AM

       The relay’s device ID is output on start-up.

   <b>Running</b> <b>on</b> <b>port</b> <b>443</b> <b>as</b> <b>an</b> <b>unprivileged</b> <b>user</b>
       It is recommended that you run the relay on port 443 (or another port which is commonly  allowed  through
       corporate  firewalls), in order to maximise the chances that people are able to connect. However, binding
       to ports below 1024 requires root privileges, and running a relay as root is not recommended.  Thankfully
       there are a couple of approaches available to you.

       One  option  is to run the relay on port 22067, and use an <b>iptables</b> rule to forward traffic from port 443
       to port 22067, for example:

          iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-port 22067

       Or, if you’re using <b>ufw</b>, add the following to <b><a href="file:/etc/ufw/before.rules">/etc/ufw/before.rules</a></b>:

          *nat
          :PREROUTING ACCEPT [0:0]
          :POSTROUTING ACCEPT [0:0]

          -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-port 22067

          COMMIT

       You will need to start <b>strelaysrv</b> with  <b>-ext-address</b>  <b>":443"</b>.  This  tells  <b>strelaysrv</b>  that  it  can  be
       contacted on port 443, even though it is listening on port 22067. You will also need to let both port 443
       and 22067 through your firewall.

       Another  option  is  <u>described</u>  <u>here</u>  &lt;<b>https://wiki.apache.org/httpd/NonRootPortBinding</b>&gt;,  although  your
       mileage may vary.

</pre><h4><b>FIREWALL</b> <b>CONSIDERATIONS</b></h4><pre>
       The relay server listens on two ports by default.  One for data connections and the other  for  providing
       public statistics at <u>https://relays.syncthing.net/</u>.  The firewall, such as <b>iptables</b>, must permit incoming
       TCP connections to the following ports:

       • Data port:  <b>22067/tcp</b> overridden with <b>-listen</b> and advertised with <b>-ext-address</b>

       • Status port: <b>22070/tcp</b> overridden with <b>-status-srv</b>

       Runtime <b>iptables</b> rules to allow access to the default ports:

          iptables -I INPUT -p tcp --dport 22067 -j ACCEPT
          iptables -I INPUT -p tcp --dport 22070 -j ACCEPT

       Please consult Linux distribution documentation to persist firewall rules.

</pre><h4><b>ACCESS</b> <b>CONTROL</b> <b>FOR</b> <b>PRIVATE</b> <b>RELAYS</b></h4><pre>
       Added in version 1.22.1.

       Private  relays can be configured to only accept connections from peers in possession of a shared secret.
       To configure this use the <b>-token</b> option:

       $ strelaysrv -token=mySecretToken

       Then configure your Syncthing devices to send the token when joining the relay:

          relay://&lt;host name|IP&gt;[:port]/?id=&lt;relay device ID&gt;&amp;token=mySecretToken

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/syncthing-relay.7.html">syncthing-relay</a>(7)</b>, <b><a href="../man7/syncthing-faq.7.html">syncthing-faq</a>(7)</b>, <b><a href="../man7/syncthing-networking.7.html">syncthing-networking</a>(7)</b>

</pre><h4><b>AUTHOR</b></h4><pre>
       The Syncthing Authors

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2014-2019, The Syncthing Authors

v1.28.1                                           Jan 06, 2025                                     <u><a href="../man1/STRELAYSRV.1.html">STRELAYSRV</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>