<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>traffic_layout - Traffic Server sandbox management tool</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/trafficserver">trafficserver_9.2.5+ds-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       traffic_layout - Traffic Server sandbox management tool

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>traffic_layout</b> SUBCOMMAND [OPTIONS]

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       <b>TS_RUNROOT</b>
              The path to the run root file. It has the same effect as the command line option <u>--run-root</u>.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Document  for  the  <b>traffic_layout</b>  about  the  <b>runroot</b>.  This feature is for the setup of Traffic Server
       runroot.  It will create a runtime sandbox for any program of Traffic Server to run under.   For  details
       about runroot for programs, please refer to <b>developer-guide/layout/runroot.en</b>.

</pre><h4><b>USAGE</b></h4><pre>
       First we need to create a runroot. It can be created simply by calling command <u>init</u>.

          traffic_layout init --path /path/to/runroot

       A  runroot  will be created in <b>/path/to/runroot</b>, available for other programs to use.  If the path is not
       specified, the current working directory will be used.

       <b>For</b> <b>example,</b> <b>to</b> <b>run</b> <b>traffic_manager,</b> <b>using</b> <b>the</b> <b>runroot,</b> <b>there</b> <b>are</b> <b>several</b> <b>ways:</b>

              1. <b>/path/to/runroot/bin/traffic_manager</b>

              2. <b>traffic_manager</b> <b>--run-root=/path/to/runroot</b>

              3. <b>traffic_manager</b> <b>--run-root=/path/to/runroot/runroot.yaml</b>

              4. Set <u>TS_RUNROOT</u> to <b>/path/to/runroot</b> and run <b>traffic_manager</b>

              5. Run <b>traffic_manager</b> with <b>/path/to/runroot</b> as current working directory

       <b>NOTE:</b>
          if none of the above is found as runroot, runroot will not be used and the program will fall  back  to
          the default.

</pre><h4><b>SUBCOMMANDS</b></h4><pre>
   <b>init</b>
       Use  the  current  working directory or the specific path to create runroot.  The path can be absolute or
       relative.

       <b>workflow:</b>

              1. Create a sandbox directory for programs to run under.

              2. Copy and symlink build time directories and files to the  sandbox,  allowing  users  to  modify
                 freely.

              3. Emit a YAML file that defines layout structure for other programs to use (relative path).

       Example:

          traffic_layout init (--path /path/to/sandbox/) (--force) (--absolute) (--copy-style=[HARD/SOFT/FULL]) (--layout=special_layout.yml)

       For  the  <b>--layout=[&lt;YAML</b> <b>file&gt;]</b> option, a custom layout can be used to construct a runroot.  Below is an
       example of customized yaml file (custom.yml) to construct.

          prefix: ./runroot
          exec_prefix: ./runroot
          bindir: ./runroot/custom_bin
          sbindir: ./runroot/custom_sbin
          sysconfdir: ./runroot/custom_sysconf
          datadir: ./runroot/custom_data
          includedir: ./runroot/custom_include
          libdir: ./runroot/custom_lib
          libexecdir: ./runroot/custom_libexec
          localstatedir: ./runroot/custom_localstate
          runtimedir: ./runroot/custom_runtime
          logdir: ./runroot/custom_log
          cachedir: ./runroot/custom_cache

       If <b>traffic_layout</b> <b>init</b> <b>--layout="custom.yml"</b> is executed, a runroot following the format  above  will  be
       created.

       <b>NOTE:</b>
          <u>storage.config</u>  does  not  use  the cachedir value, but makes its relatives paths relative to the base
          prefix.  So please update the directory for  cache  in  <b>storage.config</b>  according  to  the  customized
          runroot.

   <b>remove</b>
       <b>Find</b> <b>the</b> <b>sandbox</b> <b>to</b> <b>remove</b> <b>in</b> <b>following</b> <b>order:</b>

              1. specified in --path as absolute or relative.

              2. current working directory.

              3. installed directory.

       Example:

          traffic_layout remove (--path /path/to/sandbox/) (--force)

   <b>verify</b>
       Verify  the permission of the sandbox. The permission issues can be fixed with <b>--fix</b> option.  <b>--with-user</b>
       option can be used to verify the permission of the runroot for specific user.

       Example:

          traffic_layout verify (--path /path/to/sandbox/) (--fix) (--with-user root)

       <b>WARNING:</b>
          If a custom layout is used and system files are included  in  some  directories,  <b>--fix</b>  option  might
          potentially  have  unexpected  behaviors.   For  example,  if sysconfdir is defined as <b><a href="file:/etc">/etc</a></b> instead of
          <b>/etc/trafficserver</b> in <b>runroot.yaml</b>, <b>--fix</b> may perform permission changes on the  system  configuration
          files.  With normally created runroot with default layout, there is no such issue since Traffic Server
          related files are filtered.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--run-root=[&lt;path&gt;]</b>
              Use the run root file at <u>path</u>.

       <b>-V,</b> <b>--version</b>
              Print version information and exit.

       <b>-h,</b> <b>--help</b>
              Print usage information and exit.

       <b>-p,</b> <b>--path</b>
              Specify the path of runroot for commands (init, remove, verify).

   <b>init</b>
       <b>-f,</b> <b>--force</b>
              Force init will create sandbox even if the directory is not empty.

       <b>-a,</b> <b>--absolute</b>
              Put directories in the YAML file in the form of absolute paths when creating.

       <b>-c,</b> <b>--copy-style</b> <b>[HARD/SOFT/FULL]</b>
              Specify the way of copying executables when creating runroot.  HARD means hard  link.  SOFT  means
              symlink. FULL means full copy.

       <b>-l,</b> <b>--layout</b> <b>[&lt;YAML</b> <b>file&gt;]</b>
              Use specific layout (providing YAML file) to create runroot.

   <b>remove</b>
       <b>`-f`,</b> <b>`--force`</b>
              Force remove will remove the directory even if it has no YAML file.

   <b>verify</b>
       <b>-x,</b> <b>--fix</b>
              Fix the permission issues verify found. <b>--fix</b> requires root privilege (sudo).

       <b>-w,</b> <b>--with-user</b>
              Verify runroot with certain user. The value can be passed in as the username or <b>#</b> followed by uid.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2025, <a href="mailto:dev@trafficserver.apache.org">dev@trafficserver.apache.org</a>

9.2                                               Mar 17, 2025                                 <u><a href="../man1/TRAFFIC_LAYOUT.1.html">TRAFFIC_LAYOUT</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>