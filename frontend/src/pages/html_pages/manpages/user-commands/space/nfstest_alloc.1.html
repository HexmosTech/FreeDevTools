<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nfstest_alloc - Space reservation tests</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/nfstest">nfstest_3.2-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nfstest_alloc - Space reservation tests

</pre><h4><b>SYNOPSIS</b></h4><pre>
       nfstest_alloc --server &lt;server&gt; [options]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Verify correct functionality of space reservations so applications are able to reserve or unreserve space
       for  a  file. The system call fallocate is used to manipulate the allocated disk space for a file, either
       to preallocate or deallocate it. For filesystems which support the fallocate system  call,  preallocation
       is  done  quickly  by  allocating  blocks and marking them as uninitialized, requiring no I/O to the data
       blocks.  This is much faster than creating a file and filling it with zeros.

       Basic allocate tests verify the disk space is actually preallocated or reserved for the  given  range  by
       filling  up  the  device  after  the  allocation and make sure data can be written to the allocated range
       without any problems. Also, any data written outside the allocated range  will  fail  with  NFS4ERR_NOSPC
       when there is no more space left on the device.  On the other hand, deallocating space will give the disk
       space  back so it can be used by either the same file on regions not already preallocated or by different
       files without the risk of getting a no space error.

       Performance testing using ALLOCATE versus initializing  a  file  to  all  zeros  is  also  included.  The
       performance comparison is done with different file sizes.

       Some  tests  include  testing  at  the  protocol level by taking a packet trace and inspecting the actual
       packets sent to the server or servers.

       Negative testing is included whenever possible since some testing cannot be done at  the  protocol  level
       because  the fallocate system call does some error checking of its own and the NFS client won't even send
       an ALLOCATE or DEALLOCATE operation to the server letting the server deal with the error. Negative  tests
       include trying to allocate an invalid range, having an invalid value for either the offset or the length,
       trying to allocate or deallocate a region on a file opened as read only or the file is a non-regular file
       type.

</pre><h4><b>OPTIONS</b></h4><pre>
       --version
              show program's version number and exit

       -h, --help
              show this help message and exit

       -f FILE, --file=FILE
              File  where  options  are  specified  besides  the  system  wide file /etc/nfstest, user wide file
              $HOME/.nfstest or in the current directory .nfstest file

   <b>NFS</b> <b>specific</b> <b>options:</b>
       -s SERVER, --server=SERVER
              Server name or IP address

       -e EXPORT, --export=EXPORT
              Exported file system to mount [default: '/']

       --nfsversion=NFSVERSION
              NFS version, e.g., 3, 4, 4.1, etc. [default: 4.2]

       -m MTPOINT, --mtpoint=MTPOINT
              Mount point [default: '/mnt/t']

       -p PORT, --port=PORT
              NFS server port [default: 2049]

       --proto=PROTO
              NFS protocol name [default: 'tcp']

       --sec=SEC
              Security flavor [default: 'sys']

       --nconnect=NCONNECT
              Multiple TCP connections option [default: '1']

       -o MTOPTS, --mtopts=MTOPTS
              Mount options [default: 'hard,rsize=4096,wsize=4096']

       --datadir=DATADIR
              Data directory where files are created, directory is created on the mount point [default: '']

   <b>Logging</b> <b>options:</b>
       -v VERBOSE, --verbose=VERBOSE
              Verbose level for debug messages [default: 'opts|info|dbg1|dbg2|dbg3']

       --tverbose=TVERBOSE
              Verbose level for test messages [default: '1']

       --createlog
              Create log file

       --rexeclog
              Create rexec log files

       --warnings
              Display warnings

       --tag=TAG
              Informational tag, it is displayed as an INFO message [default: '']

       --notty
              Do not use terminal colors on output

       --isatty
              Use terminal colors on output -- useful when running with nohup

   <b>Packet</b> <b>trace</b> <b>options:</b>
       --createtraces
              Create a packet trace for each test

       --tbsize=TBSIZE
              Capture buffer size for tcpdump [default: 192k]

       --trcdelay=TRCDELAY
              Seconds to delay before stopping packet trace [default: 2.0]

       --keeptraces
              Do not remove any trace files [default: remove trace files if no errors]

       --rmtraces
              Remove trace files [default: remove trace files if no errors]

       -i INTERFACE, --interface=INTERFACE
              Device interface [default: automatically selected]

   <b>File</b> <b>options:</b>
       --nfiles=NFILES
              Number of files to create [default: 2]

       --filesize=FILESIZE
              File size to use for test files [default: 64k]

       --rsize=RSIZE
              Read size to use when reading files [default: 4k]

       --wsize=WSIZE
              Write size to use when writing files [default: 4k]

       --iodelay=IODELAY
              Seconds to delay I/O operations [default: 0.1]

       --offset-delta=OFFSET_DELTA
              Read/Write offset delta [default: 4k]

   <b>Path</b> <b>options:</b>
       --sudo=SUDO
              Full path of binary for sudo [default: '<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?sudo">/usr/bin/sudo</a>']

       --kill=KILL
              Full path of binary for kill [default: '<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?kill">/usr/bin/kill</a>']

       --nfsstat=NFSSTAT
              Full path of binary for nfsstat [default: '/usr/sbin/nfsstat']

       --tcpdump=TCPDUMP
              Full path of binary for tcpdump [default: '/usr/sbin/tcpdump']

       --iptables=IPTABLES
              Full path of binary for iptables [default: '<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?iptables">/usr/sbin/iptables</a>']

       --messages=MESSAGES
              Full path of log messages file [default: '/var/log/messages']

       --trcevents=TRCEVENTS
              Full path of tracing events directory [default: '/sys/kernel/debug/tracing/events']

       --trcpipe=TRCPIPE
              Full path of trace pipe file [default: '/sys/kernel/debug/tracing/trace_pipe']

       --tmpdir=TMPDIR
              Temporary directory [default: '<a href="file:/tmp">/tmp</a>']

   <b>Debug</b> <b>options:</b>
       --nocleanup
              Do not cleanup created files

       --notimestamps
              Do not display timestamps in debug messages

       --bugmsgs=BUGMSGS
              File containing test messages to mark as bugs if they failed

       --nomount
              Do not mount server and run the tests on local disk space

       --basename=BASENAME
              Base name for all files and logs [default: automatically generated]

       --nfsdebug=NFSDEBUG
              Set NFS kernel debug flags and save log messages [default: '']

       --rpcdebug=RPCDEBUG
              Set RPC kernel debug flags and save log messages [default: '']

       --tracepoints=TRACEPOINTS
              List of trace points modules to enable [default: '']

       --nfsstats
              Get NFS stats [default: 'False']

       --pktdisp
              Display main packets related to the given test

       --nfserrors
              Fail every NFS error found in the packet trace

       --client-ipaddr=CLIENT_IPADDR
              IP address of localhost

   <b>Reporting</b> <b>options:</b>
       --xunit-report
              Generate xUnit compatible test report

       --xunit-report-file=XUNIT_REPORT_FILE
              Path to xout report file

   <b>Test</b> <b>options:</b>
       --runtest=RUNTEST
              Comma separated list of tests to run, if list starts with a '^' then all tests are run except  the
              ones listed [default: 'all']

       --free-blocks=FREE_BLOCKS
              Number of free blocks to use when trying to allocate all available space [default: 64]

       --perf-fsize=PERF_FSIZE
              Starting file size for the perf01 test [default: 1MB]

       --perf-mult=PERF_MULT
              File  size  multiplier  for  the  perf01  test, the tests are performed for a file size which is a
              multiple of the previous test file size [default: 4]

       --perf-time=PERF_TIME
              Run the performance test perf01 until the sub-test for the current file  size  executes  for  more
              than this time [default: 15]

</pre><h4><b>TESTS</b></h4><pre>
   <b>alloc</b>
       Run all ALLOCATE tests: alloc01, alloc02, alloc03, alloc04, alloc05,
       alloc06

   <b>alloc01</b>
       Verify ALLOCATE succeeds on files opened as write only

   <b>alloc02</b>
       Verify ALLOCATE succeeds on files opened as read and write

   <b>alloc03</b>
       Verify ALLOCATE fails on files opened as read only

   <b>alloc04</b>
       Verify ALLOCATE fails with EINVAL for invalid offset or length

   <b>alloc05</b>
       Verify ALLOCATE fails with ESPIPE when using a named pipe file handle

   <b>alloc06</b>
       Verify ALLOCATE reserves the disk space

   <b>dealloc</b>
       Run all DEALLOCATE tests: dealloc01, dealloc02, dealloc03, dealloc04,
       dealloc05, dealloc06

   <b>dealloc01</b>
       Verify DEALLOCATE succeeds on files opened as write only

   <b>dealloc02</b>
       Verify DEALLOCATE succeeds on files opened as read and write

   <b>dealloc03</b>
       Verify DEALLOCATE fails on files opened as read only

   <b>dealloc04</b>
       Verify DEALLOCATE fails with EINVAL for invalid offset or length

   <b>dealloc05</b>
       Verify DEALLOCATE fails with ESPIPE when using a named pipe file handle

   <b>dealloc06</b>
       Verify DEALLOCATE unreserves the disk space

   <b>perf01</b>
       Verify ALLOCATE outperforms initializing the file to all zeros

   <b>all</b>
       Run all tests: alloc01, alloc02, alloc03, alloc04, alloc05, alloc06,
       dealloc01, dealloc02, dealloc03, dealloc04, dealloc05, dealloc06, perf01

</pre><h4><b>EXAMPLES</b></h4><pre>
       The only required option is --server
       $ nfstest_alloc --server 192.168.0.11

</pre><h4><b>NOTES</b></h4><pre>
       The  user  id in the local host must have access to run commands as root using the 'sudo' command without
       the need for a password.

       Tests which require filling up all the disk space on the mounted device should have exclusive  access  to
       the device.

       Valid only for NFS version 4.2 and above.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man3/formatstr.3.html">formatstr</a>(3),</b>    <b><a href="../man3/nfstest.test_util.3.html">nfstest.test_util</a>(3),</b>    <b><a href="../man3/nfstest.utils.3.html">nfstest.utils</a>(3),</b>    <b><a href="../man1/nfstest_cache.1.html">nfstest_cache</a>(1),</b>   <b><a href="../man1/nfstest_delegation.1.html">nfstest_delegation</a>(1),</b>
       <b><a href="../man1/nfstest_dio.1.html">nfstest_dio</a>(1),</b> <b><a href="../man1/nfstest_fcmp.1.html">nfstest_fcmp</a>(1),</b>  <b><a href="../man1/nfstest_file.1.html">nfstest_file</a>(1),</b>  <b><a href="../man1/nfstest_interop.1.html">nfstest_interop</a>(1),</b>  <b><a href="../man1/nfstest_io.1.html">nfstest_io</a>(1),</b>  <b><a href="../man1/nfstest_lock.1.html">nfstest_lock</a>(1),</b>
       <b><a href="../man1/nfstest_pkt.1.html">nfstest_pkt</a>(1),</b>  <b><a href="../man1/nfstest_pnfs.1.html">nfstest_pnfs</a>(1),</b>  <b><a href="../man1/nfstest_posix.1.html">nfstest_posix</a>(1),</b>  <b><a href="../man1/nfstest_rdma.1.html">nfstest_rdma</a>(1),</b> <b><a href="../man1/nfstest_sparse.1.html">nfstest_sparse</a>(1),</b> <b><a href="../man1/nfstest_ssc.1.html">nfstest_ssc</a>(1),</b>
       <b><a href="../man1/nfstest_xattr.1.html">nfstest_xattr</a>(1),</b> <b><a href="../man1/nfstest_xid.1.html">nfstest_xid</a>(1),</b> <b><a href="../man3/packet.nfs.nfs4_const.3.html">packet.nfs.nfs4_const</a>(3)</b>

</pre><h4><b>BUGS</b></h4><pre>
       No known bugs.

</pre><h4><b>AUTHOR</b></h4><pre>
       Jorge Mora (<a href="mailto:mora@netapp.com">mora@netapp.com</a>)

NFStest 3.2                                       21 March 2023                                 <u><a href="../man1/NFSTEST_ALLOC.1.html">NFSTEST_ALLOC</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>