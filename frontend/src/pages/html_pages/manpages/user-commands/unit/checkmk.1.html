<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>checkmk - Awk script for generating C unit tests for use with the    Check unit testing framework.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/check">check_0.15.2-3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       checkmk - Awk script for generating C unit tests for use with the    Check unit testing framework.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>checkmk</b> [ <b>clean_mode=1</b> ] [ <u>input-file</u> ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Generate C-language source files containing unit tests for use with the Check unit testing framework. The
       aim of this script is to automate away some of the typical boilerplate one must write when writing a test
       suite  using  Check:  specifically,  the  instantiation  of  an  SRunner, Suite(s), and TCase(s), and the
       building of relationships between these objects and the test functions.

       This tool is intended to be used by those who  are  familiar  with  the  Check  unit  testing  framework.
       Familiarity with the framework will be assumed throughout this manual.

       The     Check     framework,    along    with    information    regarding    it,    is    available    at
       https://libcheck.github.io/check/ &lt;URL:https://libcheck.github.io/check/&gt;.

       The <u>input-file</u> argument to <b>checkmk</b> uses a simple, C-preprocessor-like syntax to declare  test  functions,
       and to describe their relationships to Suites and TCases in Check.  <b>checkmk</b> then uses this information to
       automatically  write a <b>main()</b> function containing all of the necessary declarations, and whatever code is
       needed to run the test suites. The final C-language output is printed to <b>checkmk</b>'s standard output.

       Facilities are provided for the insertion of user code into the generated <b>main()</b> function, to provide for
       the use of logging, test fixtures or specialized exit values.

       While it is possible to omit the <u>input-file</u> argument to <b>checkmk</b> and provide the input file  on  <b>checkmk</b>'s
       standard  input  instead,  it  is  generally  recommended to provide it as an argument. Doing this allows
       <b>checkmk</b> to be aware of the file's name, to place references to it in  the  initial  comments  of  the  C-
       language output, and to intersperse C #line directives throughout, to facilitate in debugging problems by
       directing the user to the original input file.

</pre><h4><b>OPTIONS</b></h4><pre>
       The  only  officially supported option is specifying a true value (using Awk's definition for "true") for
       the variable <b>clean_mode</b>. This causes <b>checkmk</b> not to place appropriate  #line  directives  in  the  source
       code, which some might find to be unnecessary clutter.

       The author recommends against the use of this option, as it will cause C compilers and debugging tools to
       refer  to  lines  in the automatically generated output, rather than the original input files to <b>checkmk</b>.
       This would encourage users to edit the output files instead of the original input files,  would  make  it
       difficult  for  intelligent  editors  or  IDEs to pull up the right file to edit, and could result in the
       fixes being overwritten when the output files are regenerated.

       #line directives are automatically suppressed when the input file is provided on standard  input  instead
       of as a command-line argument.

</pre><h4><b>BASIC</b> <b>EXAMPLE</b></h4><pre>
       In its most basic form, an input file can be simply a prologue and a test function. Anything that appears
       before  the first test function is in the prologue, and will be copied into the output verbatim. The test
       function is begun by a line in the form:

       #test <u>test_name</u>

       Where <u>test_name</u> is the name of your test function. This will be used to name a C function, so it must  be
       a valid C identifier.

       Here is a small, complete example:

       --------------------------------------------------
       /* A complete test example */

       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;

       #test the_test
           int nc;
           const char msg[] = "\n\n    Hello, world!\n";

           nc = printf("%s", msg);
           ck_assert(nc == (<a href="../manmsg/sizeof.msg.html">sizeof</a>(msg) - 1)); /* for terminating NUL. */
       --------------------------------------------------

       If you place the above into a file named <u>basic_complete.ts</u> and process it using the following command:

       <b>$</b> <b>checkmk</b> <b>basic_complete.ts</b> <b>&gt;</b> <b>basic_complete.c</b>

       <u>basic_complete.c</u> will contain output similar to:

       --------------------------------------------------
       /*
        * DO NOT EDIT THIS FILE. Generated by checkmk.
        * Edit the original source file "in" instead.
        */

       #include &lt;check.h&gt;

       /* A complete test example */

       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;

       START_TEST(the_test)
       {
           int nc;
           const char msg[] = "\n\n    Hello, world!\n";

           nc = printf("%s", msg);
           ck_assert(nc == (<a href="../manmsg/sizeof.msg.html">sizeof</a>(msg) - 1)); /* for terminating NUL. */
       }
       END_TEST

       int main(void)
       {
           Suite *s1 = suite_create("Core");
           TCase *tc1_1 = tcase_create("Core");
           SRunner *sr = srunner_create(s1);
           int nf;

           suite_add_tcase(s1, tc1_1);
           tcase_add_test(tc1_1, the_test);

           srunner_run_all(sr, CK_ENV);
           nf = srunner_ntests_failed(sr);
           srunner_free(sr);

           return nf == 0 ? 0 : 1;
       }
       --------------------------------------------------

       In real usage, <u>basic_complete.c</u> would also contain #line directives.

</pre><h4><b>DIRECTIVE</b> <b>SUMMARY</b></h4><pre>
       Here is a complete summary of all the C-preprocessor-style directives that are understood by <b>checkmk</b>. See
       below for more details.

       # test <u>test_name</u>
       # test-signal(<u>signal</u>) <u>test_name</u>
       # test-exit(<u>exit_code</u>) <u>test_name</u>
       # test-loop(<u>start</u>, <u>end</u>) <u>test_name</u>
       # test-loop-signal(<u>signal</u>, <u>start</u>, <u>end</u>) <u>test_name</u>
       # test-loop-exit(<u>exit_code</u>, <u>start</u>, <u>end</u>) <u>test_name</u>
       # suite <u>TestSuiteName</u>
       # tcase <u>TestCaseName</u>
       # main-pre
       # main-post

       All  directives  are  case-insensitive.  Whitespace may appear at the beginning of the line before the #,
       between the # and the directive, between the directive and any argument, and at the end of the line.

</pre><h4><b>TEST-DEFINING</b> <b>DIRECTIVES</b></h4><pre>
       Here is a more detailed explanation of the directives that may be used to define test functions and their
       containers.

   <b>TEST</b> <b>FUNCTIONS</b>
       # test <u>test_name</u>
       # test-signal(<u>signal</u>) <u>test_name</u>
       # test-exit(<u>exit_code</u>) <u>test_name</u>
       # test-loop(<u>start</u>, <u>end</u>) <u>test_name</u>
       # test-loop-signal(<u>signal</u>, <u>start</u>, <u>end</u>) <u>test_name</u>
       # test-loop-exit(<u>exit_code</u>, <u>start</u>, <u>end</u>) <u>test_name</u>

       These are the most basic directives for creating a template for input  to  <b>checkmk</b>.  They  are  the  only
       directives  that  are required: there must be at least one #test* directive appearing in the template, or
       <b>checkmk</b> will fail with an error message. The #test* directives may be specified several times,  each  one
       beginning the definition of a new test function.

       The  <u>test_name</u>  argument will be used as the name of a test function in the C-language output, so it must
       be a valid C identifier. That is, it must begin with an  alphabetic  character  or  the  underscore  (_),
       followed by optional alpha-numeric characters and/or underscores.

       Universal  Character  Names (introduced in C99) are also allowed, of the form \uXXXX or \UXXXXXXXX, where
       the X's represent hexadecimal digits.

       It is an error to specify the same <u>test_name</u> in more than one #test*  directive,  regardless  of  whether
       they are associated with different test cases or suites.

       See  CHECKMK  IDENTIFIERS  for  the  list of identifiers which should be avoided for use as test function
       names.

   <b>TEST</b> <b>SUITES</b>
       # suite <u>TestSuiteName</u>

       This directive specifies the name of the test suite (<b>Suite</b> object in the Check test framework)  to  which
       all future test cases (and their test functions) will be added.

       The  <u>TestSuiteName</u>  is a text string, and may contain any sort of characters at all (other than ASCII NUL
       character, and the newline, which would terminate the directive). Any leading or trailing whitespace will
       be omitted from the test suite name.

       Starting a new test suite also begins a new test case, whose name is identical to  the  new  test  suite.
       This test case name may be overridden by a subsequent #tcase directive.

       Note  that  a <b>Suite</b> object won't actually be defined by <b>checkmk</b> in the C output, unless it is followed at
       some point by a #test directive (without an intervening #suite). It is not an error for a #suite to  have
       no  associated #test's; the #suite (and any associated #tcase's) simply won't result in any action on the
       part of <b>checkmk</b> (and would therefore be useless).

       It is an error for a #suite directive to specify the same (case sensitive) suite multiple  times,  unless
       the previous uses were not instantiated by the presence of at least one associated #test directive.

       If  you  do  not  specify  a  #suite  directive  before  the  first #test directive, <b>checkmk</b> performs the
       equivalent of an implicit #suite directive, with the string "Core" as the value for  <u>TestSuiteName</u>  (this
       also implies a "Core" test case object). This is demonstrated above in BASIC EXAMPLE.

   <b>TEST</b> <b>CASES</b>
       # tcase <u>TestCaseName</u>

       This  directive  specifies  the name of the test case (<b>TCase</b> object in the Check test framework) to which
       all future test functions will be added.

       The #tcase works very in a way very similar to #suite. The <u>TestCaseName</u> is a text string, and may contain
       arbitrary characters; and a <b>TCase</b> object won't actually be defined unless it is followed by an associated
       #test directive.

       It is an error for a #tcase directive to specify the same (case  sensitive)  test  case  multiple  times,
       unless  the  previous  uses  were  not  instantiated  by  the  presence  of at least one associated #test
       directive.

       See also the #suite directive, described above.

</pre><h4><b>USER</b> <b>CODE</b> <b>IN</b> <b>MAIN()</b></h4><pre>
       The C  <b>main()</b>  is  automatically  generated  by  <b>checkmk</b>,  defining  the  necessary  <b>SRunner</b>'s,  <b>Suite</b>'s,
       and <b>TCase</b>'s required by the test-defining directives specified by the user.

       For  most  situations,  this  completely  automated  <b>main()</b>  is  quite suitable as-is. However, there are
       situations where one might wish to add custom code to the <b>main()</b>. For instance, if the user wishes to:

       • change the test timeout value via <b>tcase_set_timeout()</b>,

       • specify Check's "no-fork-mode" via <b>srunner_set_fork_status()</b>,

       • set    up    test    fixtures    for    some    test     cases,     via     <b>tcase_add_checked_fixture()</b>
         or <b>tcase_add_unchecked_fixture()</b>,

       • set up test logging for the suite runner, via <b>srunner_set_log()</b> or <b>srunner_set_xml()</b>, or

       • perform custom wrap-up after the test suites have been run.

       For these purposes, the #main-pre and #main-post directives have been provided.

   <b>MAIN()</b> <b>PROLOGUE</b>
       # main-pre

       The text following this directive will be placed verbatim into the body of the generated <b>main()</b> function,
       just  after  <b>checkmk</b>'s  own  local  variable  declarations,  and  before any test running has taken place
       (indeed, before even the relationships between the tests, test cases, and test suites have been  set  up,
       though  that  fact  shouldn't  make  much  difference).  Since  <b>checkmk</b> has only just finished making its
       declarations, it is permissible, even under strict  1990  ISO  C  guidelines,  to  make  custom  variable
       declarations here.

       Unlike  the  previously-described  directives,  #main-pre  may  be  specified at most once. It may not be
       preceded by the #main-post directive, and no #suite, #tcase, or #test directive may appear after it.

       #main-pre is a good place to tweak settings or set up test fixtures. Of course, in order to  do  so,  you
       need to know what names <b>checkmk</b> has used to instantiate the <b>SRunner</b>'s, <b>Suite</b>'s, and <b>TCase</b>'s.

   <b>CHECKMK</b> <b>IDENTIFIERS</b>
       Pointers  to  <b>Suite</b>'s  are  declared  using  the pattern s<u>X</u>, where <u>X</u> is a number that starts at 1, and is
       incremented for each subsequent #suite directive.  s1 always  exists,  and  contains  the  test  function
       declared  by  the first #test directive. If that directive was not preceded by a #suite, it will be given
       the name "Core".

       Pointers to <b>TCase</b>'s are declared using the pattern tc<u>X</u>_<u>Y</u>, where <u>X</u> corresponds to the number used for  the
       name  of  the  <b>Suite</b> that will contain this <b>TCase</b>; and <u>Y</u> is a number that starts at 1 for each new <b>Suite</b>,
       and is incremented for each <b>TCase</b> in that <b>Suite</b>.

       A pointer to <b>SRunner</b> is declared using the identifier sr; there is also an integer named nf  which  holds
       the number of test failures (after the tests have run).

       For  obvious  reasons,  the user should not attempt to declare local identifiers in <b>main()</b>, or define any
       macros or test functions, whose names might conflict with the local variable names used  by  <b>checkmk</b>.  To
       summarize, these names are:

       s<u>X</u>

       tc<u>X</u>_<u>Y</u>

       sr

       nf.

   <b>MAIN()</b> <b>EPILOGUE</b>
       # main-post

       Though it is not as useful, <b>checkmk</b> also provides a #main-post directive to insert custom code at the end
       of  <b>main()</b>, after the tests have run. This could be used to clean up resources that were allocated in the
       prologue, or to print information about the failed tests, or to provide a custom exit status code.

       Note that, if you make use of this directive, <b>checkmk</b> will <b>not</b> provide a return statement: you will  need
       to provide one yourself.

       The #main-post directive may not be followed by any other directives recognized by <b>checkmk</b>.

</pre><h4><b>COMPREHENSIVE</b> <b>EXAMPLE</b></h4><pre>
       Now  that  you've  gotten  the  detailed  descriptions of the various directives, let's see it all put to
       action with this fairly comprehensive template.

       --------------------------------------------------
       #include "mempool.h"  /* defines MEMPOOLSZ, prototypes for
                                mempool_init() and mempool_free() */

       void *mempool;

       void mp_setup(void)
       {
           mempool = mempool_init(MEMPOOLSZ);
           ck_assert_msg(mempool != NULL, "Couldn't allocate mempool.");
       }

       void mp_teardown(void)
       {
           <a href="../manmempool/mempool_free.mempool.html">mempool_free</a>(mempool);
       }

       /* end of prologue */

       #suite Mempool

       #tcase MP Init

       #test mempool_init_zero_test
           mempool = <a href="../man0/mempool_init.0.html">mempool_init</a>(0);
           ck_assert_msg(mempool == NULL, "Allocated a zero-sized mempool!");
           ck_assert_msg(mempool_error(), "Didn't get an error for zero alloc.");

       /* "MP Util" TCase uses checked fixture. */
       #tcase MP Util

       #test mempool_copy_test
           void *cp = <a href="../manmempool/mempool_copy.mempool.html">mempool_copy</a>(mempool);
           ck_assert_msg(cp != NULL, "Couldn't perform mempool copy.");
           ck_assert_msg(cp != mempool, "Copy returned original pointer!");

       #test mempool_size_test
           ck_assert(<a href="../manmempool/mempool_getsize.mempool.html">mempool_getsize</a>(mempool) == MEMPOOLSZ);

       #main-pre
           tcase_add_checked_fixture(tc1_2, mp_setup, mp_teardown);
           srunner_set_log(sr, "mplog.txt");

       #main-post
           if (nf != 0) {
             printf("Hey, something's wrong! %d whole tests failed!\n", nf);
           }
           return 0; /* Harness checks for output, always return success
                        regardless. */
       --------------------------------------------------

       Plugging this into <b>checkmk</b>, we'll get output roughly like the following:

       --------------------------------------------------
       /*
        * DO NOT EDIT THIS FILE. Generated by checkmk.
        * Edit the original source file "comprehensive.ts" instead.
        */

       #include &lt;check.h&gt;

       #include "mempool.h"

       void *mempool;

       void mp_setup(void)
       {
       ...
       }

       void mp_teardown(void)
       {
       ...
       }

       /* end of prologue */

       <a href="../manmempool_init_zero_test/START_TEST.mempool_init_zero_test.html">START_TEST</a>(mempool_init_zero_test)
       {
       ...
       }
       END_TEST

       <a href="../manmempool_copy_test/START_TEST.mempool_copy_test.html">START_TEST</a>(mempool_copy_test)
       {
       ...
       }
       END_TEST

       <a href="../manmempool_size_test/START_TEST.mempool_size_test.html">START_TEST</a>(mempool_size_test)
       {
       ...
       }
       END_TEST

       int main(void)
       {
           Suite *s1 = suite_create("Mempool");
           TCase *tc1_1 = tcase_create("MP Init");
           TCase *tc1_2 = tcase_create("MP Util");
           SRunner *sr = srunner_create(s1);
           int nf;

           /* User-specified pre-run code */
           tcase_add_checked_fixture(tc1_2, mp_setup, mp_teardown);
           srunner_set_log(sr, "mplog.txt");

           suite_add_tcase(s1, tc1_1);
           tcase_add_test(tc1_1, mempool_init_zero_test);
           suite_add_tcase(s1, tc1_2);
           tcase_add_test(tc1_2, mempool_copy_test);
           tcase_add_test(tc1_2, mempool_size_test);

           srunner_run_all(sr, CK_ENV);
           nf = srunner_ntests_failed(sr);
           srunner_free(sr);

           /* User-specified post-run code */
           if (nf != 0) {
             printf("Hey, something's wrong! %d whole tests failed!\n", nf);
           }
           return 0; /* Harness checks for output, always return success
                        regardless. */
       }
       --------------------------------------------------

</pre><h4><b>AUTHOR</b></h4><pre>
       <b>checkmk</b> and this manual were written by Micah J Cowan.

       Copyright (C) 2006, 2010 Micah J Cowan.

                                                09 February 2010                                      <u><a href="../man1/CHECKMK.1.html">CHECKMK</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>