<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pg_resetwal - reset the write-ahead log and other control information of a PostgreSQL database cluster</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/postgresql-17">postgresql-17_17.5-0ubuntu0.25.04.1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pg_resetwal - reset the write-ahead log and other control information of a PostgreSQL database cluster

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>pg_resetwal</b> [<b>-f</b> | <b>--force</b>] [<b>-n</b> | <b>--dry-run</b>] [<u>option</u>...] [<b>-D</b> | <b>--pgdata</b>]<u>datadir</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pg_resetwal</b> clears the write-ahead log (WAL) and optionally resets some other control information stored
       in the pg_control file. This function is sometimes needed if these files have become corrupted. It should
       be used only as a last resort, when the server will not start due to such corruption.

       Some options, such as <b>--wal-segsize</b> (see below), can also be used to modify certain global settings of a
       database cluster without the need to rerun <b>initdb</b>. This can be done safely on an otherwise sound database
       cluster, if none of the dangerous modes mentioned below are used.

       If <b>pg_resetwal</b> is used on a data directory where the server has been cleanly shut down and the control
       file is sound, then it will have no effect on the contents of the database system, except that no longer
       used WAL files are cleared away. Any other use is potentially dangerous and must be done with great care.
       <b>pg_resetwal</b> will require the <b>-f</b> (force) option to be specified before working on a data directory in an
       unclean shutdown state or with a corrupted control file.

       After running this command on a data directory with corrupted WAL or a corrupted control file, it should
       be possible to start the server, but bear in mind that the database might contain inconsistent data due
       to partially-committed transactions. You should immediately dump your data, run <b>initdb</b>, and restore.
       After restore, check for inconsistencies and repair as needed.

       If <b>pg_resetwal</b> complains that it cannot determine valid data for pg_control, you can force it to proceed
       anyway by specifying the <b>-f</b> (force) option. In this case plausible values will be substituted for the
       missing data. Most of the fields can be expected to match, but manual assistance might be needed for the
       next OID, next transaction ID and epoch, next multitransaction ID and offset, and WAL starting location
       fields. These fields can be set using the options discussed below. If you are not able to determine
       correct values for all these fields, <b>-f</b> can still be used, but the recovered database must be treated
       with even more suspicion than usual: an immediate dump and restore is imperative.  <u>Do</u> <u>not</u> execute any
       data-modifying operations in the database before you dump, as any such action is likely to make the
       corruption worse.

       This utility can only be run by the user who installed the server, because it requires read/write access
       to the data directory.

</pre><h4><b>OPTIONS</b></h4><pre>
       <u>datadir</u>
       <b>-D</b> <u>datadir</u>
       <b>--pgdata=</b><u>datadir</u>
           Specifies the location of the database directory. For safety reasons, you must specify the data
           directory on the command line.  <b>pg_resetwal</b> does not use the environment variable <b>PGDATA</b>.

       <b>-f</b>
       <b>--force</b>
           Force <b>pg_resetwal</b> to proceed even in situations where it could be dangerous, as explained above.
           Specifically, this option is required to proceed if the server had not been cleanly shut down or if
           <b>pg_resetwal</b> cannot determine valid data for pg_control.

       <b>-n</b>
       <b>--dry-run</b>
           The <b>-n</b>/<b>--dry-run</b> option instructs <b>pg_resetwal</b> to print the values reconstructed from pg_control and
           values about to be changed, and then exit without modifying anything. This is mainly a debugging
           tool, but can be useful as a sanity check before allowing <b>pg_resetwal</b> to proceed for real.

       <b>-V</b>
       <b>--version</b>
           Display version information, then exit.

       <b>-?</b>
       <b>--help</b>
           Show help, then exit.

       The following options are only needed when <b>pg_resetwal</b> is unable to determine appropriate values by
       reading pg_control. Safe values can be determined as described below. For values that take numeric
       arguments, hexadecimal values can be specified by using the prefix 0x. Note that these instructions only
       apply with the standard block size of 8 kB.

       <b>-c</b> <u>xid</u><b>,</b><u>xid</u>
       <b>--commit-timestamp-ids=</b><u>xid</u><b>,</b><u>xid</u>
           Manually set the oldest and newest transaction IDs for which the commit time can be retrieved.

           A safe value for the oldest transaction ID for which the commit time can be retrieved (first part)
           can be determined by looking for the numerically smallest file name in the directory pg_commit_ts
           under the data directory. Conversely, a safe value for the newest transaction ID for which the commit
           time can be retrieved (second part) can be determined by looking for the numerically greatest file
           name in the same directory. The file names are in hexadecimal.

       <b>-e</b> <u>xid_epoch</u>
       <b>--epoch=</b><u>xid_epoch</u>
           Manually set the next transaction ID's epoch.

           The transaction ID epoch is not actually stored anywhere in the database except in the field that is
           set by <b>pg_resetwal</b>, so any value will work so far as the database itself is concerned. You might need
           to adjust this value to ensure that replication systems such as Slony-I and Skytools work correctly —
           if so, an appropriate value should be obtainable from the state of the downstream replicated
           database.

       <b>-l</b> <u>walfile</u>
       <b>--next-wal-file=</b><u>walfile</u>
           Manually set the WAL starting location by specifying the name of the next WAL segment file.

           The name of next WAL segment file should be larger than any WAL segment file name currently existing
           in the directory pg_wal under the data directory. These names are also in hexadecimal and have three
           parts. The first part is the “timeline ID” and should usually be kept the same. For example, if
           00000001000000320000004A is the largest entry in pg_wal, use -l 00000001000000320000004B or higher.

           Note that when using nondefault WAL segment sizes, the numbers in the WAL file names are different
           from the LSNs that are reported by system functions and system views. This option takes a WAL file
           name, not an LSN.

               <b>Note</b>
               <b>pg_resetwal</b> itself looks at the files in pg_wal and chooses a default <b>-l</b> setting beyond the last
               existing file name. Therefore, manual adjustment of <b>-l</b> should only be needed if you are aware of
               WAL segment files that are not currently present in pg_wal, such as entries in an offline
               archive; or if the contents of pg_wal have been lost entirely.

       <b>-m</b> <u>mxid</u><b>,</b><u>mxid</u>
       <b>--multixact-ids=</b><u>mxid</u><b>,</b><u>mxid</u>
           Manually set the next and oldest multitransaction ID.

           A safe value for the next multitransaction ID (first part) can be determined by looking for the
           numerically largest file name in the directory pg_multixact/offsets under the data directory, adding
           one, and then multiplying by 65536 (0x10000). Conversely, a safe value for the oldest
           multitransaction ID (second part of <b>-m</b>) can be determined by looking for the numerically smallest
           file name in the same directory and multiplying by 65536. The file names are in hexadecimal, so the
           easiest way to do this is to specify the option value in hexadecimal and append four zeroes.

       <b>-o</b> <u>oid</u>
       <b>--next-oid=</b><u>oid</u>
           Manually set the next OID.

           There is no comparably easy way to determine a next OID that's beyond the largest one in the
           database, but fortunately it is not critical to get the next-OID setting right.

       <b>-O</b> <u>mxoff</u>
       <b>--multixact-offset=</b><u>mxoff</u>
           Manually set the next multitransaction offset.

           A safe value can be determined by looking for the numerically largest file name in the directory
           pg_multixact/members under the data directory, adding one, and then multiplying by 52352 (0xCC80).
           The file names are in hexadecimal. There is no simple recipe such as the ones for other options of
           appending zeroes.

       <b>--wal-segsize=</b><u>wal_segment_size</u>
           Set the new WAL segment size, in megabytes. The value must be set to a power of 2 between 1 and 1024
           (megabytes). See the same option of <b><a href="../man1/initdb.1.html">initdb</a></b>(1) for more information.

           This option can also be used to change the WAL segment size of an existing database cluster, avoiding
           the need to re-<b>initdb</b>.

               <b>Note</b>
               While <b>pg_resetwal</b> will set the WAL starting address beyond the latest existing WAL segment file,
               some segment size changes can cause previous WAL file names to be reused. It is recommended to
               use <b>-l</b> together with this option to manually set the WAL starting address if WAL file name
               overlap will cause problems with your archiving strategy.

       <b>-u</b> <u>xid</u>
       <b>--oldest-transaction-id=</b><u>xid</u>
           Manually set the oldest unfrozen transaction ID.

           A safe value can be determined by looking for the numerically smallest file name in the directory
           pg_xact under the data directory and then multiplying by 1048576 (0x100000). Note that the file names
           are in hexadecimal. It is usually easiest to specify the option value in hexadecimal too. For
           example, if 0007 is the smallest entry in pg_xact, -u 0x700000 will work (five trailing zeroes
           provide the proper multiplier).

       <b>-x</b> <u>xid</u>
       <b>--next-transaction-id=</b><u>xid</u>
           Manually set the next transaction ID.

           A safe value can be determined by looking for the numerically largest file name in the directory
           pg_xact under the data directory, adding one, and then multiplying by 1048576 (0x100000). Note that
           the file names are in hexadecimal. It is usually easiest to specify the option value in hexadecimal
           too. For example, if 0011 is the largest entry in pg_xact, -x 0x1200000 will work (five trailing
           zeroes provide the proper multiplier).

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       <b>PG_COLOR</b>
           Specifies whether to use color in diagnostic messages. Possible values are always, auto and never.

</pre><h4><b>NOTES</b></h4><pre>
       This command must not be used when the server is running.  <b>pg_resetwal</b> will refuse to start up if it
       finds a server lock file in the data directory. If the server crashed then a lock file might have been
       left behind; in that case you can remove the lock file to allow <b>pg_resetwal</b> to run. But before you do so,
       make doubly certain that there is no server process still alive.

       <b>pg_resetwal</b> works only with servers of the same major version.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/pg_controldata.1.html">pg_controldata</a></b>(1)

PostgreSQL 17.5                                       2025                                        <u><a href="../man1/PG_RESETWAL.1.html">PG_RESETWAL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>