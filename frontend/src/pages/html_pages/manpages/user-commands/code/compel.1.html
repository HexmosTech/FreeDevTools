<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/criu">criu_4.0-4_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b> <b>compel</b> <b>-</b> <b>Execute</b> <b>parasitic</b> <b>code</b> <b>within</b> <b>another</b> <b>process.</b></h4><pre>

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>compel</b> <u>hgen</u> [<u>option</u> ...]

       <b>compel</b> <u>plugins</u> [<u>PLUGIN_NAME</u> ...]

       <b>compel</b> [<u>--compat</u>] <u>includes</u> | <u>cflags</u> | <u>ldflags</u>

       <b>compel</b> [<u>--compat</u>] [<u>--static</u>] <u>libs</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>

       <b>compel</b>  is  a  utility  to execute arbitrary code, also called parasite code, in the context of a foreign
       process. The parasitic code, once compiled with compel flags and packed, can be executed in  the  context
       of  other  tasks.  Currently  there  is  only  one  way to load the parasitic blob into victim task using
       libcompel.a, called c-header.

</pre><h4><b>ARGUMENTS</b></h4><pre>

   <b>Positional</b> <b>Arguments</b>

       <b>hgen</b>
           create a header from the .po file, which is the parasite binary.

       <b>plugins</b>
           prints the plugins available.

       <b>ldflags</b>
           prints the ldflags available to compel during linking of parasite code.

       <b>cflags</b>
           prints the compel cflags to be used during compilation of parasitic code.

       <b>includes</b>
           prints list of standard include directories.

       <b>libs</b>
           prints list of static or dynamic libraries that compel can link with.

</pre><h4><b>OPTIONS</b></h4><pre>

       <b>-f</b>, <b>--file</b> <u>FILE</u>
           Path to the binary file, <u>FILE</u>, which <b>compel</b> must turn into a header

       <b>-o</b>, <b>--output</b> <u>FILE</u>
           Path to the header file, <u>FILE</u>, where compel must write the resulting header.

       <b>-p</b>, <b>--prefix</b> <u>NAME</u>
           Specify prefix for var names

       <b>-l</b>, <b>--log-level</b> <u>NUM</u>
           Default log level of compel.

       <b>-h</b>, <b>--help</b>
           Prints usage and exits.

       <b>-V</b>, <b>--version</b>
           Prints version number of compel.

</pre><h4><b>SOURCE</b> <b>EXAMPLES</b></h4><pre>

   <b>Parasitic</b> <b>Code</b>

       <b>#include</b> <b>&lt;compel/plugins/std.h&gt;</b>

       <b>int</b> <b>parasite_trap_cmd(int</b> <b>cmd,</b> <b>void</b> <b>*args);</b> //gets called by compel_run_in_thread()

       <b>int</b>   <b>parasite_daemon_cmd(int</b>   <b>cmd,</b>   <b>void</b>   <b>*arg);</b>   //   gets   called   by   compel_rpc_call()    and
       compel_rpc_call_sync()

       <b>void</b> <b>parasite_cleanup(void);</b> //gets called on parasite unload by compel_cure()

   <b>Infecting</b> <b>code</b>

       <b>The</b> <b>parasitic</b> <b>code</b> <b>is</b> <b>compiled</b> <b>and</b> <b>converted</b> <b>to</b> <b>a</b> <b>header</b> <b>using</b> <b>compel</b>, and included here.

       <b>#include</b> <b>&lt;compel/infect.h&gt;</b>

       <b>#include</b> <b>"parasite.h"</b>

       Following steps are performed to infect the victim process:

       •   stop the task: <b>int</b> <b>compel_stop_task(int</b> <b>pid);</b>

       •   prepare infection handler: <b>struct</b> <b>parasite_ctl</b> <b>*compel_prepare(int</b> <b>pid);</b>

       •   execute system call: <b>int</b> <b>compel_syscall(ctl,</b> <b>int</b> <b>syscall_nr,</b> <b>long</b> <b>*ret,</b> <b>int</b> <b>arg</b> <b>...);</b>

       •   infect victim: <b>int</b> <b>compel_infect(ctl,</b> <b>nr_thread,</b> <b>size_of_args_area);</b>

       •   cure the victim: <b>int</b> <b>compel_cure(ctl);</b> //ctl pointer is freed by this call

       •   Resume  victim:  <b>int</b>  <b>compel_resume_task(pid,</b>  <b>orig_state,</b>  <b>state)</b> or <b>int</b> <b>compel_resume_task_sig(pid,</b>
           <b>orig_state,</b> <b>state,</b> <b>stop_signo).</b>  //compel_resume_task_sig() could be used in case when victim  is  in
           stopped state. stop_signo could be read by calling compel_parse_stop_signo().

       <b>ctl</b>  must  be  configured  with  blob  information  by  calling  <b>PREFIX_setup_c_header()</b>, with ctl as its
       argument. <b>PREFIX</b> is the argument given to <b>-p</b> when calling hgen, else it is deduced from file name.

</pre><h4><b>EXAMPLES</b></h4><pre>

       <b>To</b> <b>generate</b> <b>a</b> <b>header</b> <b>file(.h)</b> <b>from</b> <b>a</b> <b>parasite</b> <b>binary</b> <b>file(.po)</b> <b>use:</b>

               <b>compel</b> <b>hgen</b> <b>-f</b> <b>parasite.po</b> <b>-o</b> <b>parasite.h</b>

       <u>parasite.po</u> file is obtained by compiling the parasite source with compel flags and linking it  with  the
       compel plugins.

</pre><h4><b>AUTHOR</b></h4><pre>

       <b>The</b> <b>CRIU</b> <b>team.</b>

criu 4.0                                           03/10/2025                                          <u><a href="../man1/COMPEL.1.html">COMPEL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>