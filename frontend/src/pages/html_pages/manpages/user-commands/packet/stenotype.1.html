<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stenotype - dump raw packets to disk</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/stenographer">stenographer_1.0.1-7_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>stenotype</b> - dump raw packets to disk

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>stenotype</b> [<b>-qv</b>?] [<b>--aiops</b>=NUM] [<b>--blocks</b>=NUM] [<b>--count</b>=NUM]
                 [<b>--dir</b>=STRING] [<b>--fanout_id</b>=NUM] [<b>--fanout_type</b>=NUM]
                 [<b>--fileage_sec</b>=NUM] [<b>--filesize_mb</b>=NUM] [<b>--filter</b>=STRING]
                 [<b>--gid</b>=NUM] [<b>--iface</b>=STRING] [<b>--index_nicelevel</b>=NUM] [<b>--no_index</b>]
                 [<b>--no_watchdogs</b>] [<b>--preallocate_file_mb</b>=NUM] [<b>--seccomp</b>=STRING]
                 [<b>--threads</b>=NUM] [<b>--uid</b>=NUM] [<b>--help</b>] [<b>--usage</b>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Stenotype  is a mechanism for quickly dumping raw packets to disk. It aims to have a simple interface (no
       file rotation: that's left as an exercise for the reader) while being very powerful.

       <b>stenotype</b> uses a NIC-&gt;disk pipeline specifically designed to  provide  as  fast  an  output  to  disk  as
       possible while just using the kernel's built-in mechanisms.

       1.  NIC  -&gt;  RAM:  <b>stenotype</b>  uses MMAP'd AF_PACKET with 1MB blocks and a high timeout to offload writing
           packets and deciding their layout to the kernel. The kernel packs all the packets it  can  into  1MB,
           then  lets the userspace process know there's a block available in the MMAP'd ring buffer. Nicely, it
           guarantees no overruns (packets crossing the 1MB boundary) and good alignment to memory pages.

       2.  RAM -&gt; Disk: Since the kernel already gave us a single 1MB block of packets that's nicely aligned, we
           can O_DIRECT write it straight to disk. This avoids any additional copying or  kernel  buffering.  To
           keep  sequential  reads  going  strong,  we  do all disk IO asynchronously via io_submit (which works
           specifically for O_DIRECT files... joy!). Since the data is being written to disk asynchronously,  we
           use the time it's writing to disk to do our own in-memory processing and indexing.

       There  are  N  (flag-specified)  async IO operations available... once we've used up all N, we block on a
       used one finishing, then reuse it. The whole pipeline consists of:

              •  kernel gives userspace a 1MB block of packets

              •  userspace iterates over packets in block, updates any indexes

              •  userspace starts async IO operation to write block to disk

              •  after N async IO operations are submitted, we synchronously wait for the least  recent  one  to
                 finish.

              •  when  an async IO operation finishes, we release the 1MB block back to the kernel to write more
                 packets.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--aiops=NUM</b>
              Max number of async IO operations

       <b>--blocks=NUM</b>
              Total number of blocks to use, each is 1MB

       <b>--count=NUM</b>
              Total number of packets to read, <b>-1</b> to read forever

       <b>--dir=STRING</b>
              Directory to store packet files in

       <b>--fanout_id=NUM</b>
              If fanning out across processes, set this

       <b>--fanout_type=NUM</b>
              TPACKET_V3 fanout type to fanout packets

       <b>--fileage_sec=NUM</b>
              Files older than this many secs are rotated

       <b>--filesize_mb=NUM</b>
              Max file size in MB before file is rotated

       <b>--filter=STRING</b>
              BPF compiled filter used to filter which packets will be captured. This has to be a  compiled  BPF
              in  hexadecimal,  which can be obtained from a human readable filter expression using the provided
              compile_bpf.sh script.

       <b>--gid=NUM</b>
              Drop privileges to this group

       <b>--iface=STRING</b>
              Interface to read packets from

       <b>--index_nicelevel=NUM</b>
              Nice level of indexing threads

       <b>--no_index</b>
              Do not compute or write indexes

       <b>--no_watchdogs</b>
              Don't start any watchdogs

       <b>--preallocate_file_mb=NUM</b>
              When creating new files, preallocate to this many MB

       <b>-q</b>     Quiet logging.  Each <b>-q</b> counteracts one <b>-v</b>

       <b>--seccomp=STRING</b>
              Seccomp style, one of 'none', 'trace', 'kill'.

       <b>--threads=NUM</b>
              Number of parallel threads to read packets with

       <b>--uid=NUM</b>
              Drop privileges to this user

       <b>-v</b>     Verbose logging, may be given multiple times

       <b>-?,</b> <b>--help</b>
              Give this help list

       <b>--usage</b>
              Give a short usage message

stenographer 1.0.1                               07 August 2024                                     <u><a href="../man1/stenotype.1.html">stenotype</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>