<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pg_receivewal - stream write-ahead logs from a PostgreSQL server</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/postgresql-client-17">postgresql-client-17_17.5-0ubuntu0.25.04.1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pg_receivewal - stream write-ahead logs from a PostgreSQL server

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>pg_receivewal</b> [<u>option</u>...]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       pg_receivewal is used to stream the write-ahead log from a running PostgreSQL cluster. The write-ahead
       log is streamed using the streaming replication protocol, and is written to a local directory of files.
       This directory can be used as the archive location for doing a restore using point-in-time recovery (see
       Section 25.3).

       pg_receivewal streams the write-ahead log in real time as it's being generated on the server, and does
       not wait for segments to complete like archive_command and archive_library do. For this reason, it is not
       necessary to set archive_timeout when using pg_receivewal.

       Unlike the WAL receiver of a PostgreSQL standby server, pg_receivewal by default flushes WAL data only
       when a WAL file is closed. The option <b>--synchronous</b> must be specified to flush WAL data in real time.
       Since pg_receivewal does not apply WAL, you should not allow it to become a synchronous standby when
       synchronous_commit equals remote_apply. If it does, it will appear to be a standby that never catches up,
       and will cause transaction commits to block. To avoid this, you should either configure an appropriate
       value for synchronous_standby_names, or specify <u>application_name</u> for pg_receivewal that does not match
       it, or change the value of <u>synchronous_commit</u> to something other than remote_apply.

       The write-ahead log is streamed over a regular PostgreSQL connection and uses the replication protocol.
       The connection must be made with a user having REPLICATION permissions (see Section 21.2) or a superuser,
       and pg_hba.conf must permit the replication connection. The server must also be configured with
       max_wal_senders set high enough to leave at least one session available for the stream.

       The starting point of the write-ahead log streaming is calculated when pg_receivewal starts:

        1. First, scan the directory where the WAL segment files are written and find the newest completed
           segment file, using as the starting point the beginning of the next WAL segment file.

        2. If a starting point cannot be calculated with the previous method, and if a replication slot is used,
           an extra <b>READ_REPLICATION_SLOT</b> command is issued to retrieve the slot's restart_lsn to use as the
           starting point. This option is only available when streaming write-ahead logs from PostgreSQL 15 and
           up.

        3. If a starting point cannot be calculated with the previous method, the latest WAL flush location is
           used as reported by the server from an IDENTIFY_SYSTEM command.

       If the connection is lost, or if it cannot be initially established, with a non-fatal error,
       pg_receivewal will retry the connection indefinitely, and reestablish streaming as soon as possible. To
       avoid this behavior, use the -n parameter.

       In the absence of fatal errors, pg_receivewal will run until terminated by the SIGINT (Control+C) or
       SIGTERM signal.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-D</b> <u>directory</u>
       <b>--directory=</b><u>directory</u>
           Directory to write the output to.

           This parameter is required.

       <b>-E</b> <u>lsn</u>
       <b>--endpos=</b><u>lsn</u>
           Automatically stop replication and exit with normal exit status 0 when receiving reaches the
           specified LSN.

           If there is a record with LSN exactly equal to <u>lsn</u>, the record will be processed.

       <b>--if-not-exists</b>
           Do not error out when <b>--create-slot</b> is specified and a slot with the specified name already exists.

       <b>-n</b>
       <b>--no-loop</b>
           Don't loop on connection errors. Instead, exit right away with an error.

       <b>--no-sync</b>
           This option causes <b>pg_receivewal</b> to not force WAL data to be flushed to disk. This is faster, but
           means that a subsequent operating system crash can leave the WAL segments corrupt. Generally, this
           option is useful for testing but should not be used when doing WAL archiving on a production
           deployment.

           This option is incompatible with --synchronous.

       <b>-s</b> <u>interval</u>
       <b>--status-interval=</b><u>interval</u>
           Specifies the number of seconds between status packets sent back to the server. This allows for
           easier monitoring of the progress from server. A value of zero disables the periodic status updates
           completely, although an update will still be sent when requested by the server, to avoid timeout
           disconnect. The default value is 10 seconds.

       <b>-S</b> <u>slotname</u>
       <b>--slot=</b><u>slotname</u>
           Require pg_receivewal to use an existing replication slot (see Section 26.2.6). When this option is
           used, pg_receivewal will report a flush position to the server, indicating when each segment has been
           synchronized to disk so that the server can remove that segment if it is not otherwise needed.

           When the replication client of pg_receivewal is configured on the server as a synchronous standby,
           then using a replication slot will report the flush position to the server, but only when a WAL file
           is closed. Therefore, that configuration will cause transactions on the primary to wait for a long
           time and effectively not work satisfactorily. The option --synchronous (see below) must be specified
           in addition to make this work correctly.

       <b>--synchronous</b>
           Flush the WAL data to disk immediately after it has been received. Also send a status packet back to
           the server immediately after flushing, regardless of --status-interval.

           This option should be specified if the replication client of pg_receivewal is configured on the
           server as a synchronous standby, to ensure that timely feedback is sent to the server.

       <b>-v</b>
       <b>--verbose</b>
           Enables verbose mode.

       <b>-Z</b> <u>level</u>
       <b>-Z</b> <u>method</u><b>[:</b><u>detail</u><b>]</b>
       <b>--compress=</b><u>level</u>
       <b>--compress=</b><u>method</u><b>[:</b><u>detail</u><b>]</b>
           Enables compression of write-ahead logs.

           The compression method can be set to gzip, lz4 (if PostgreSQL was compiled with <b>--with-lz4</b>) or none
           for no compression. A compression detail string can optionally be specified. If the detail string is
           an integer, it specifies the compression level. Otherwise, it should be a comma-separated list of
           items, each of the form <u>keyword</u> or <u>keyword=value</u>. Currently, the only supported keyword is level.

           If no compression level is specified, the default compression level will be used. If only a level is
           specified without mentioning an algorithm, gzip compression will be used if the level is greater than
           0, and no compression will be used if the level is 0.

           The suffix .gz will automatically be added to all filenames when using gzip, and the suffix .lz4 is
           added when using lz4.

       The following command-line options control the database connection parameters.

       <b>-d</b> <u>connstr</u>
       <b>--dbname=</b><u>connstr</u>
           Specifies parameters used to connect to the server, as a connection string; these will override any
           conflicting command line options.

           This option is called --dbname for consistency with other client applications, but because
           pg_receivewal doesn't connect to any particular database in the cluster, any database name included
           in the connection string will be ignored by the server. However, a database name supplied that way
           overrides the default database name (replication) for purposes of looking up the replication
           connection's password in <a href="file:~/.pgpass.">~/.pgpass.</a> Similarly, middleware or proxies used in connecting to PostgreSQL
           might utilize the name for purposes such as connection routing.

       <b>-h</b> <u>host</u>
       <b>--host=</b><u>host</u>
           Specifies the host name of the machine on which the server is running. If the value begins with a
           slash, it is used as the directory for the Unix domain socket. The default is taken from the <b>PGHOST</b>
           environment variable, if set, else a Unix domain socket connection is attempted.

       <b>-p</b> <u>port</u>
       <b>--port=</b><u>port</u>
           Specifies the TCP port or local Unix domain socket file extension on which the server is listening
           for connections. Defaults to the <b>PGPORT</b> environment variable, if set, or a compiled-in default.

       <b>-U</b> <u>username</u>
       <b>--username=</b><u>username</u>
           User name to connect as.

       <b>-w</b>
       <b>--no-password</b>
           Never issue a password prompt. If the server requires password authentication and a password is not
           available by other means such as a .pgpass file, the connection attempt will fail. This option can be
           useful in batch jobs and scripts where no user is present to enter a password.

       <b>-W</b>
       <b>--password</b>
           Force pg_receivewal to prompt for a password before connecting to a database.

           This option is never essential, since pg_receivewal will automatically prompt for a password if the
           server demands password authentication. However, pg_receivewal will waste a connection attempt
           finding out that the server wants a password. In some cases it is worth typing <b>-W</b> to avoid the extra
           connection attempt.

       pg_receivewal can perform one of the two following actions in order to control physical replication
       slots:

       <b>--create-slot</b>
           Create a new physical replication slot with the name specified in <b>--slot</b>, then exit.

       <b>--drop-slot</b>
           Drop the replication slot with the name specified in <b>--slot</b>, then exit.

       Other options are also available:

       <b>-V</b>
       <b>--version</b>
           Print the pg_receivewal version and exit.

       <b>-?</b>
       <b>--help</b>
           Show help about pg_receivewal command line arguments, and exit.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       pg_receivewal will exit with status 0 when terminated by the SIGINT or SIGTERM signal. (That is the
       normal way to end it. Hence it is not an error.) For fatal errors or other signals, the exit status will
       be nonzero.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       This utility, like most other PostgreSQL utilities, uses the environment variables supported by libpq
       (see Section 32.15).

       The environment variable <b>PG_COLOR</b> specifies whether to use color in diagnostic messages. Possible values
       are always, auto and never.

</pre><h4><b>NOTES</b></h4><pre>
       When using pg_receivewal instead of archive_command or archive_library as the main WAL backup method, it
       is strongly recommended to use replication slots. Otherwise, the server is free to recycle or remove
       write-ahead log files before they are backed up, because it does not have any information, either from
       archive_command or archive_library or the replication slots, about how far the WAL stream has been
       archived. Note, however, that a replication slot will fill up the server's disk space if the receiver
       does not keep up with fetching the WAL data.

       pg_receivewal will preserve group permissions on the received WAL files if group permissions are enabled
       on the source cluster.

</pre><h4><b>EXAMPLES</b></h4><pre>
       To stream the write-ahead log from the server at mydbserver and store it in the local directory
       /usr/local/pgsql/archive:

           $ <b>pg_receivewal</b> <b>-h</b> <b>mydbserver</b> <b>-D</b> <b>/usr/local/pgsql/archive</b>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/pg_basebackup.1.html">pg_basebackup</a></b>(1)

PostgreSQL 17.5                                       2025                                      <u><a href="../man1/PG_RECEIVEWAL.1.html">PG_RECEIVEWAL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>