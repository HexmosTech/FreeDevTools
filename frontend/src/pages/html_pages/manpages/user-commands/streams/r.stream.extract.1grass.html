<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>r.stream.extract  - Performs stream network extraction.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/grass-doc">grass-doc_8.4.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>r.stream.extract</b>  - Performs stream network extraction.

</pre><h4><b>KEYWORDS</b></h4><pre>
       raster, hydrology, stream network

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>r.stream.extract</b>
       <b>r.stream.extract</b> <b>--help</b>
       <b>r.stream.extract</b>  <b>elevation</b>=<u>name</u>  [<b>accumulation</b>=<u>name</u>]   [<b>depression</b>=<u>name</u>]  <b>threshold</b>=<u>float</u>  [<b>d8cut</b>=<u>float</u>]
       [<b>mexp</b>=<u>float</u>]       [<b>stream_length</b>=<u>integer</u>]       [<b>memory</b>=<u>memory</u>     <u>in</u>     <u>MB</u>]       [<b>stream_raster</b>=<u>name</u>]
       [<b>stream_vector</b>=<u>name</u>]   [<b>direction</b>=<u>name</u>]   [--<b>overwrite</b>]  [--<b>help</b>]  [--<b>verbose</b>]  [--<b>quiet</b>]  [--<b>ui</b>]

   <b>Flags:</b>
       <b>--overwrite</b>
           Allow output files to overwrite existing files

       <b>--help</b>
           Print usage summary

       <b>--verbose</b>
           Verbose module output

       <b>--quiet</b>
           Quiet module output

       <b>--ui</b>
           Force launching GUI dialog

   <b>Parameters:</b>
       <b>elevation</b>=<u>name</u> <b>[required]</b>
           Name of input elevation raster map

       <b>accumulation</b>=<u>name</u>
           Name of input accumulation raster map
           Stream extraction will use provided accumulation instead of calculating it anew

       <b>depression</b>=<u>name</u>
           Name of input raster map with real depressions
           Streams will not be routed out of real depressions

       <b>threshold</b>=<u>float</u> <b>[required]</b>
           Minimum flow accumulation for streams
           Must be &gt; 0

       <b>d8cut</b>=<u>float</u>
           Use SFD above this threshold
           If accumulation is larger than d8cut, SFD is used instead of MFD. Applies only if no accumulation map
           is given.

       <b>mexp</b>=<u>float</u>
           Montgomery exponent for slope, disabled with 0
           Montgomery: accumulation is multiplied with pow(slope,mexp) and then compared with threshold
           Default: <u>0</u>

       <b>stream_length</b>=<u>integer</u>
           Delete stream segments shorter than stream_length cells
           Applies only to first-order stream segments (springs/stream heads)
           Default: <u>0</u>

       <b>memory</b>=<u>memory</u> <u>in</u> <u>MB</u>
           Maximum memory to be used (in MB)
           Cache size for raster rows
           Default: <u>300</u>

       <b>stream_raster</b>=<u>name</u>
           Name for output raster map with unique stream ids

       <b>stream_vector</b>=<u>name</u>
           Name for output vector map with unique stream ids

       <b>direction</b>=<u>name</u>
           Name for output raster map with flow direction

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>r.stream.extract</u>  extracts  streams  in both raster and vector format from a required input <b>elevation</b> map
       and optional input <b>accumulation</b> map.

</pre><h4><b>NOTES</b></h4><pre>
       NULL (nodata) cells in the input <b>elevation</b> map are ignored, zero and negative values are valid  elevation
       data.  Gaps  in the elevation map that are located within the area of interest must be filled beforehand,
       e.g. with <u>r.fillnulls</u>, to avoid distortions.

       All non-NULL and non-zero cells of <b>depression</b> map will be regarded as real depressions. Streams will  not
       be  routed  out  of  depressions.  If  an  area  is  marked  as depression but the elevation model has no
       depression at this location, streams will not stop there. If a flow accumulation map and a map with  real
       depressions  are  provided, the flow accumulation map must match the depression map such that flow is not
       distributed out of the  indicated  depressions.  It  is  recommended  to  use  internally  computed  flow
       accumulation if a depression map is provided.

       Option  <b>threshold</b>  defines the minimum (optionally modified) flow accumulation value that will initiate a
       new stream. If Montgomeryâ€™s method for channel initiation is used, the cell  value  of  the  accumulation
       input  map is multiplied by (tan(local slope))mexp and then compared to <b>threshold</b>. If <b>mexp</b> is given, then
       the method of Montgomery and Foufoula-Georgiou (1993) is used to initiate a stream with this  value.  The
       cell  value  of  the  accumulation input map is multiplied by (tan(local slope))mexp and then compared to
       <b>threshold</b>. If threshold is reached or exceeded, a new stream is initiated. The default value  0  disables
       Montgomery.  Montgomery  and  Foufoula-Georgiou  (1993)  generally recommend to use 2.0 as exponent. <b>mexp</b>
       values closer to 0 will produce streams more similar  to  streams  extracted  with  Montgomery  disabled.
       Larger  <b>mexp</b>  values  decrease  the number of streams in flat areas and increase the number of streams in
       steep areas. If <b>weight</b> is given, the weight is applied first.

       Option <b>d8cut</b> defines minimum amount of overland flow (accumulation) when SFD (D8) will be used instead of
       MFD (FD8) to calculate flow accumulation. Only applies if no accumulation map is provided. Setting  to  0
       disables MFD completely.

       Option  <b>stream_length</b>  defines  minimum  stream  length  in number of cells for first-order (head/spring)
       stream segments. All first-order stream segments shorter than <b>stream_length</b> will be deleted.

       Output <b>direction</b> raster map contains flow direction for all  non-NULL  cells  in  input  elevation.  Flow
       direction  is of D8 type with a range of 1 to 8.  Multiplying values with 45 gives degrees CCW from East.
       Flow direction was adjusted during thinning, taking shortcuts and skipping cells that were eliminated  by
       the thinning procedure.

   <b>Stream</b> <b>extraction</b>
       If  no  <b>accumulation</b>  input map is provided, flow accumulation is determined with a hydrological analysis
       similar to <u>r.watershed</u>. The algorithm is MFD (FD8) after Holmgren 1994, as for <u>r.watershed</u>. The <b>threshold</b>
       option determines the number of streams and  detail  of  stream  networks.   Whenever  flow  accumulation
       reaches <b>threshold</b>, a new stream is started and traced downstream to its outlet point. As for <u>r.watershed</u>,
       flow accumulation is calculated as the number of cells draining through a cell.

       If  <b>accumulation</b> is given, then the accumulation values of the provided <b>accumulation</b> map are used and not
       calculated from the input <b>elevation</b> map. In this case, the <b>elevation</b> map must be  exactly  the  same  map
       used  to  calculate  <b>accumulation</b>.  If <b>accumulation</b> was calculated with <u>r.terraflow</u>, the filled elevation
       output of <u>r.terraflow</u> must be used. Further on, the current region should be aligned to the  <b>accumulation</b>
       map.  Flow  direction  is  first  calculated  from <b>elevation</b> and then adjusted to <b>accumulation</b>. It is not
       necessary to provide <b>accumulation</b> as the number of cells, it can  also  be  the  optionally  adjusted  or
       weighed  total  contributing area in square meters or any other unit.  When an original flow accumulation
       map is adjusted or weighed, the adjustment or weighing should not convert valid  accumulation  values  to
       NULL (nodata) values.

       In case of getting the error message ERROR: Accumulation raster map is NULL but elevation map is not NULL
       the computational region must be carefully adjusted to exclude NULL pixels in the accumulation raster map
       prior to stream extraction.

   <b>Weighed</b> <b>flow</b> <b>accumulation</b>
       Flow  accumulation  can  be calculated first, e.g. with <u>r.watershed</u>, and then modified before using it as
       input for <u>r.stream.extract</u>. In its general form,  a  weighed  accumulation  map  is  generated  by  first
       creating  a weighing map and then multiplying the accumulation map with the weighing map using <u>r.mapcalc</u>.
       It is highly recommended to evaluate the weighed flow accumulation map first, before using  it  as  input
       for <u>r.stream.extract</u>.

       This allows e.g. to decrease the number of streams in dry areas and increase the number of streams in wet
       areas by setting <b>weight</b> to smaller than 1 in dry areas and larger than 1 in wet areas.

       Another  possibility  is  to  restrict  channel initiation to valleys determined from terrain morphology.
       Valleys can be determined with <u>r.param.scale</u>  method=crosc  (cross-sectional  or  tangential  curvature).
       Curvature  values  &lt;  0  indicate  concave  features,  i.e.  valleys.  The  size of the processing window
       determines whether narrow or broad valleys will be identified (See example below).

   <b>Defining</b> <b>a</b> <b>region</b> <b>of</b> <b>interest</b>
       The stream extraction procedure can be restricted to a certain region of interest, e.g.  a  subbasin,  by
       setting  the computational region with <u>g.region</u> and/or creating a MASK. Such region of interest should be
       a complete catchment area, complete in the sense that the complete area upstream of an  outlet  point  is
       included and buffered with at least one cell.

   <b>Stream</b> <b>output</b>
       The  output raster and vector contains stream segments with unique IDs. Note that these IDs are different
       from the IDs assigned by <u>r.watershed</u>. The vector output also contains points at the location of the start
       of a stream segment, at confluences and at stream network outlet locations.

       Output <b>stream_raster</b> raster map stores extracted streams. Cell values encode a unique ID for each  stream
       segment.

       Output  <b>stream_vector</b>  vector  map stores extracted stream segments and points. Points are written at the
       start location of each stream segment and at the outlet of a stream network. In layer 1,  categories  are
       unique  IDs,  identical  to  the  cell  value of the raster output. The attribute table for layer 1 holds
       information about the type of stream segment: start segment, or intermediate  segment  with  tributaries,
       and  about  the  stream  network  this  stream  or  node  belongs  to.  Columns  are  cat int,stream_type
       varchar(),type_code int,network int. The network attribute is the network  ID  of  the  stream/node.  The
       encoding  for type_code is 0 = start, 1 = intermediate. In layer 2, categories are identical to type_code
       in layer 1 with additional category 2 = outlet for outlet points. Points with category 1  =  intermediate
       in layer 2 are at the location of confluences.

</pre><h4><b>EXAMPLE</b></h4><pre>
       This  example  is based on the elevation map "elev_ned_30m" in the North Carolina sample dataset and uses
       valleys determined with <u>r.param.scale</u> to weigh an accumulation map produced with <u>r.watershed</u>.
       # set region
       g.region -p raster=elev_ned_30m@PERMANENT
       # calculate flow accumulation
       r.watershed ele=elev_ned_30m@PERMANENT acc=elev_ned_30m.acc
       # curvature to get narrow valleys
       r.param.scale input=elev_ned_30m@PERMANENT output=tangential_curv_5 size=5 method=crosc
       # curvature to get a bit broader valleys
       r.param.scale input=elev_ned_30m@PERMANENT output=tangential_curv_7 size=7 method=crosc
       # curvature to get broad valleys
       r.param.scale input=elev_ned_30m@PERMANENT output=tangential_curv_11 size=11 method=crosc
       # create weight map
       r.mapcalc "weight = if(tangential_curv_5 &lt; 0, -100 * tangential_curv_5, \
                           if(tangential_curv_7 &lt; 0, -100 * tangential_curv_7, \
                           if(tangential_curv_11 &lt; 0, -100 * tangential_curv_11, 0.000001)))"
       # weigh accumulation map
       r.mapcalc expr="elev_ned_30m.acc.weighed = elev_ned_30m.acc * weight"
       # copy color table from original accumulation map
       r.colors map=elev_ned_30m.acc.weighed raster=elev_ned_30m.acc

       Weight map (spatial subset with lake in the southern half)

       Original flow accumulation map (spatial subset with lake in the southern half)

       Weighed flow accumulation map (spatial subset with lake in the southern half)

       Display both the original and the weighed accumulation map.  Compare them  and  proceed  if  the  weighed
       accumulation map makes sense.
       # extract streams using the original accumulation map
       r.stream.extract elevation=elev_ned_30m@PERMANENT \
                        accumulation=elev_ned_30m.acc \
                        threshold=1000 \
                        stream_rast=elev_ned_30m.streams.noweight
       # extract streams from weighed map
       # note that the weighed map is a bit smaller than the original map
       r.stream.extract elevation=elev_ned_30m@PERMANENT \
                        accumulation=elev_ned_30m.acc.weighed \
                        threshold=1000 \
                        stream_rast=elev_ned_30m.streams

       Now display both stream maps and decide which one is more realistic.

       Extracted streams from original flow accumulation map

       Extracted streams from weighed flow accumulation map

</pre><h4><b>REFERENCES</b></h4><pre>
           â€¢   Ehlschlaeger,  C. (1989). <u>Using</u> <u>the</u> <u>AT</u> <u>Search</u> <u>Algorithm</u> <u>to</u> <u>Develop</u> <u>Hydrologic</u> <u>Models</u> <u>from</u> <u>Digital</u>
               <u>Elevation</u> <u>Data</u>, <b>Proceedings</b> <b>of</b> <b>International</b> <b>Geographic</b> <b>Information</b> <b>Systems</b> <b>(IGIS)</b> <b>Symposium</b> <b>â€™89</b>,
               pp       275-281       (Baltimore,        MD,        18-19        March        1989).        URL:
               https://www.researchgate.net/publication/243781937_Using_the_AT_search_algorithm_to_develop_hydrologic_models_from_digital_elevation_data

           â€¢   Holmgren,  P.  (1994).  <u>Multiple</u>  <u>flow</u>  <u>direction</u>  <u>algorithms</u>  <u>for</u> <u>runoff</u> <u>modelling</u> <u>in</u> <u>grid</u> <u>based</u>
               <u>elevation</u> <u>models:</u> <u>An</u> <u>empirical</u> <u>evaluation.</u>  <b>Hydrological</b> <b>Processes</b> Vol  <a href="../man4/8.4.html">8</a>(4),  pp  327-334.  DOI:
               10.1002/hyp.3360080405

           â€¢   Montgomery,  D.R.,  Foufoula-Georgiou,  E.  (1993).  <u>Channel</u>  <u>network</u> <u>source</u> <u>representation</u> <u>using</u>
               <u>digital</u> <u>elevation</u> <u>models.</u>  <b>Water</b> <b>Resources</b> <b>Research</b> Vol <a href="../man12/29.12.html">29</a>(12), pp 3925-3934.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
        <u>r.mapcalc,</u> <u>r.param.scale,</u> <u>r.stream.channel</u> <u>(Addon),</u> <u>r.stream.distance</u> <u>(Addon),</u>  <u>r.stream.order</u>  <u>(Addon),</u>
       <u>r.stream.segment</u>   <u>(Addon),</u>   <u>r.stream.slope</u>  <u>(Addon),</u>  <u>r.stream.snap</u>  <u>(Addon),</u>  <u>r.stream.stats</u>  <u>(Addon),</u>
       <u>r.terraflow,</u> <u>r.thin,</u> <u>r.to.vect,</u> <u>r.watershed</u>

       See also r.streams.*  modules wiki page.

</pre><h4><b>AUTHOR</b></h4><pre>
       Markus Metz

</pre><h4><b>SOURCE</b> <b>CODE</b></h4><pre>
       Available at: r.stream.extract source code (history)

       Accessed: Friday Apr 04 01:19:38 2025

       Main index | Raster index | Topics index | Keywords index | Graphical index | Full index

       Â© 2003-2025 GRASS Development Team, GRASS GIS 8.4.1 Reference Manual

GRASS 8.4.1                                                                             <u><a href="../man1grass/r.stream.extract.1grass.html">r.stream.extract</a></u>(1grass)
</pre>
 </div>
</div></section>
</div>
</body>
</html>