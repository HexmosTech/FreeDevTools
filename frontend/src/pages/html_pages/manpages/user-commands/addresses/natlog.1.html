<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>natlog - source-nat logging tool</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/natlog">natlog_3.00.01-1build2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       natlog - source-nat logging tool

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>natlog</b> [OPTIONS] <u>command</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Firewalls  like  <b><a href="../man1/iptables.1.html">iptables</a></b>(1)  may offer <u>POSTROUTING</u> (source network address translation, snat) facilities
       changing the source address of a host behind the firewall to the address of the  host  connected  to  the
       outer world. With <u>snat</u> the following combinations of IP addresses and port numbers are encountered:

       o      the IP address and port number used by the host protected by (i.e., behind) the firewall initiates
              a  connection  to  the  outer  world  (the  source host, in this manual page referred to as <u>IPsrc,</u>
              <u>sport</u>);

       o      the IP address and port number of the host outside (i.e., before) the firewall that <u>IPsrc</u> connects
              to (the destination host, in this manual page referred to as <u>IPdst,</u> <u>dport</u>);

       o      the IP address and port number of the host where  the  firewall  has  been  installed.  This  host
              performs  the  source  natting,  and  its  IP-address  and the port it uses when forwarding <u>IPsrc,</u>
              <u>sport</u>’s requests to <u>IPdst,</u> <u>dport</u> are in this manual page referred to as <u>IPfw,</u> <u>fwport</u>.  )

       Source natting usually uses <u>sport</u> for <u>fwport</u>, but <u>fwport</u> may  already  be  in  use,  in  which  case  the
       firewalling  host  must  use another, available port to forward communication from <u>IPsrc,</u> <u>sport</u> to <u>IPdst,</u>
       <u>dport</u>.

       The general scheme that applies to source natting, therefore, looks like this:

           IPsrc:sport is translated by the firewall to IPfw:fwport;
           IPfw:fwport is used when communicating with IPdst:dport.

       From  the  perspective  of  the  destination  host  the  communication  originates  at  <u>IPfw::fwport</u>  and
       consequently  all  communication  (e.g.,  incident reports) sent by the systems administrator maintaining
       <u>IPdst</u> to <u>IPfw</u>’s systems administrator will refer to <u>IPfw:fwport</u>, rather than to <u>IPsrc::sport</u>.

       Relating <u>IPfw:fwport</u> to <u>IPsrc:sport</u> is difficult when merely using the standard log  facilities  provided
       by <u>iptables</u> and <u>natlog</u> was developed to fill in that particular niche.

       <u>Natlog</u>  provides  data  about  source  natting  in  various  forms. The standard logging mode consists of
       messages sent to the syslog daemon (cf., <b><a href="../man8/rsyslogd.8.html">rsyslogd</a></b>(8)) and/or to the standard output  stream  showing  the
       essential  characteristics  of  connections  using source natting. Here is an example of a logged message
       (log-entries occupy single lines; the line-breaks below are to enhance readability):

           NATLOG: from 1338990672:55588 thru 1338990747:807100 (UTC): tcp
               192.168.19.72:4467 (via: 129.125.90.132:4467) to
               to 200.49.219.180:443; sent: 802, received: 7669

       The values <u>1338990672:55588</u> and <u>1338990747:807100</u> are time stamps showing the  begin-  and  end-times  in
       seconds:microseconds of a tcp connection since the beginning of the epoch (Jan 1, 1970, 0:00 UTC). <u>Natlog</u>
       offers  the  <u>--time</u>  option  for requesting human-readable time specifications like <u>Nov</u> <u>2</u> <u>13:29:11</u> rather
       than time representations using seconds and micro seconds.

       The next value (<u>192.168.19.72:4467</u>) represents <u>IPsrc::sport</u>. This  is  followed  by  <u>129.125.90.132:4467</u>,
       representing <u>IPfw:fwport</u>. The third pair of values (<u>200.49.219.180:443</u>) represents <u>IPdst:dport</u>.

       In this example, host <u>192.168.19.72</u>, using port <u>4467</u>, connected to host <u>200.49.219.180</u>, port <u>443</u>. To this
       latter  host  the  connection  appears  to have originated from <u>129.125.90.132</u> port <u>4467</u>. The log message
       allows us to associate this with  the  `real’  host  and  port  from  which  the  connection  originated:
       <u>192.168.19.72:4467</u>.

       The  final  entries  show the number of bytes that were sent by the source-host (<u>IPsrc</u>) and received from
       the destination-host (<u>IPdst</u>).

       When <u>natlog</u> is terminated it can no  longer  track  connections  that  are  still  open.  If  <u>natlog</u>  was
       terminated (by a <u>SIGINT</u> or <u>SIGTERM</u> signal), then it logs a `terminating’ line, followed by an overview of
       all  (potentially)  still open connections. Those connections are flagged with a trailing ’(EOP)’ (end of
       program) log-element, and their end-times show <u>natlog’s</u> termination  time.  Incomplete  connections  show
       <u>(EXPIRED)</u>.

       In  addition  to the standard logs the option <u>--log-data</u> is available. This option requires the path to a
       file where information is logged in tabular form, which can easily be processed by  statistical  software
       like  <b><a href="../man1/R.1.html">R</a></b>(1).  When  specifying  this option information will be appended to an existing file. When the log
       file does not yet exist it is created. The first line of the thus written log files names the columns  of
       the table. The column names are (all on one line):

           type, srcNr, srcIP, srcPort, dstNr, dstIP, dstPort,
               sent, recvd, begin,  end, beginTime, endTime, status

       Most  column labels will be self-explanatory. <u>Type</u> indicates the connection type, logged as <u>icmp,</u> <u>tcp,</u> or
       <u>udp</u>; <u>srcNr</u> and <u>dstNr</u> are the 32 bit numeric values of, respectively, the source host’s IP address and the
       destination host’s IP address (decimal representations); <u>begin</u> and <u>end</u> are the times in seconds since the
       beginning of the epoch, corresponding to the times displayed at,  respectively,  <u>beginTime</u>  and  <u>endTime</u>;
       <u>status</u>  indicates  the  status  of  the logged connection information: <u>ok</u> indicates a connection that was
       normally completed; <u>expired</u> indicates that the connection was recognized, but was not normally completed;
       <u>eop</u> is used for connections that were still active by the time <u>natlog</u> terminates. When the status  equals
       <u>expired</u>, the time entries show the times of receiving the first and last packets of that connection; when
       <u>eop</u>, then the <u>end</u> and <u>endTime</u> entries show <u>natlog’s</u> termination time.

       Log  entries  look  like  this  (each  entry  occupies  one  line,  header line and logged data lines are
       right-aligned):

           tcp, 101820608,    192.168.17.6,        48886,
               4012145084,  188.121.36.239,           80,
                      430,            2266,   1517387644,    1517387644,
               Jan 31 08:34:04:318340, Jan 31 08:34:04:383170,  ok

</pre><h4><b>MODES</b> <b>AND</b> <b>COMMANDS</b></h4><pre>
       o      <u>conntrack</u>: the `conntrack’-mode. This command can only be  used  on  platforms  using  <b><a href="../man1/iptables.1.html">iptables</a></b>(1)
              where  <b><a href="../man1/conntrack.1.html">conntrack</a></b>(1)  has  also been installed. Information about snat connections is obtained from
              <b><a href="../man1/conntrack.1.html">conntrack</a></b>(1)’s output. In this mode all, or one of the tcp (the protocol used  by  default),  udp,
              and icmp layer four protocols can be monitored.

              When  using the <u>conntrack</u> mode the <u>conntrack</u> program will report sent and received number of bytes
              unless the option <u>no-bytes</u> has been specified.

              <u>Conntrack</u> includes the sizes of the IP headers (usually 20 bytes) in reported byte  counts.  Thus,
              <u>icmp</u>  packets  are usually reported as having size 84, even though <b><a href="../man1/ping.1.html">ping</a></b>(1) reports a payload of 64
              bytes. Since the actual sizes of IP headers cannot be  determined  from  conntrack’s  output,  the
              sizes  reported when using <u>natlog’s</u> conntrack mode are as reported by <u>conntrack</u>, and are therefore
              not corrected for IP header lengths. The option <u>--conntrack-ip-header-size</u> can be used to  correct
              for the (assumed) IP header sizes.

              <u>Conntrack</u>  can  also  be  used  to track all connections, not just the snat connections. If that’s
              required omit <u>conntrack’s</u> option <u>-n</u>, and optionally specify option <u>no-via</u>.

              See also the <u>conntrack-command</u> option.

       o      <u>indevice</u> <u>outdevice</u>: the `devices’-mode. Here, <u>indevice</u> is  the  name  of  the  device  behind  the
              firewall: addresses living behind the <u>indevice</u> are source-natted to the firewall host’s IP address
              when passed on to the <u>outdevice</u>.

              <u>Outdevice</u>  is  the name of the device where source-natted packets are forwarded to, and from where
              replies for source-natted hosts living behind the <u>indevice</u> are received. With this command all, or
              any combination of the tcp (the protocol monitored by default), udp, and icmp layer four protocols
              can be monitored.

              For example, when specifying the arguments

                  eth1 eth0

              thene <u>eth1</u> is the device behind the firewall, and  <u>eth0</u>  is  the  device  to  where  source-natted
              packets are forwared.

              This  command  can  also be used to track all connections using a single device, instead of merely
              tracking snat connections. In that case specify the same devices for <u>indevice</u> and  <u>outdevice</u>,  and
              optionally specify option <u>no-via</u>. E.g.,

                  eth0 eth0

       o      <u>infile</u>  <u>in-address</u>  <u>in-mask</u>  <u>outfile</u> <u>out-address</u> <u>out-mask</u>: the `tcpdump’-mode. This command can be
              used to process <b><a href="../man1/tcpdump.1.html">tcpdump</a></b>(1) generated binary files, generated on  the  source-natting  host.  If  a
              source  natting  host  uses  interface <u>eth1</u> behind the firewall and <u>eth0</u> to connect to the outside
              world, then the follow <u>tcpdump</u> commands produce the required binary  files  (these  commands  will
              normally be run in the background, hence the trailing <u>&amp;</u>):

                  tcpdump -wi eth0 /tmp/eth0 &amp;
                  tcpdump -wi eth1 /tmp/eth1 &amp;

              To  have  <u>natlog</u>  process these files, end the <u>tcpdump</u> processes, and transfer the files <u>/tmp/eth0</u>
              and <u>/tmp/eth1</u> to the host where <u>natlog</u> has been installed. The required addresses  and  masks  are
              shown by the <b><a href="../man1/ifconfig.1.html">ifconfig</a></b>(1) command. E.g.,

              eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
                    inet 129.125.1.123  netmask 255.255.0.0
                                        broadcast 129.125.255.255

              eth1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
                      inet 192.168.1.1  netmask 255.255.255.0
                                        broadcast 192.168.1255

              The  relevant  info is shown in the lines following the interface’s name: the value following <u>inet</u>
              is the interface’s IP address, and the value following <u>netmask</u> is the network’s mask.

              Combining files and addresses, <u>natlog</u> is run as follows (all on one line):

                  natlog  /tmp/eth0 129.125.1.123  255.255.0.0
                          /tmp/eth1 192.168.1.1 255.255.255.0

              Instead of fully specifying the netmask, netmaks specifications like /24  are  also  accepted.  In
              that  case the number following the slash indicates the number of non-zero bits of the netmask. In
              practice, each value of the netmask is either 255 (8 bits are set) or 0 (0 bits are set),  and  so
              255.255.0.0 can also be specified as /16, while 255.255.255.0 can be specified like /24.

</pre><h4><b>OPTIONS</b></h4><pre>
       See also section <u>SYSTEMD</u>.

       o      <b>--config</b>=<u>config-path</u> (<b>-c</b>)
              The  argument  <u>config-path</u>  defines  the  path  to  <u>natlog’s</u>  configuration file. By default it is
              <u>/etc/natlog.conf</u>. All configuration options have defaults, which are used  when  no  configuration
              file and no command-line options were provided.

              All  options,  except for <u>config,</u> <u>help,</u> <u>S,</u> <u>terminate,</u> <u>verbose</u> and <u>version</u> can also be specified in
              the configuration file. The configuration file ignores empty lines and all  information  on  lines
              beginning  with  a hash-mark (<u>#</u>). In the configuration file initial hyphens should be omitted, and
              option names may immediately be followed by a colon. Do not surround option  values  with  quotes.
              Examples:

                  stdout
                  syslog-facility: LOCAL0

              Command-line options override configuration file options.

       o      <b>--conntrack-command</b>=<u>path</u> <u>[options]</u>
              The path and options to the <b><a href="../man1/conntrack.1.html">conntrack</a></b>(1) program. By default this is

                  /usr/sbin/conntrack -p tcp -E -n -o timestamp -e NEW,DESTROY

              resulting in:

              - Monitoring the tcp layer four protocol;
              - Displaying real-time event logs (<u>-E</u>);
              - Only use snat connections (<u>-n</u>);
              - Displaying time stamps (<u>-o</u> <u>timestamp</u>);
              - Logging all new and destroyed (ended) events (<u>-e</u> <u>NEW,DESTROY</u>);
              - Reporting the number of bytes sent- and received by connections;

              By default <u>tcp</u> is monitored. Other protocols can be configured using the <u>--protocol</u> option.

              The  <u>conntrack</u>  program  must  be available when requesting <u>natlog</u>’s <u>conntrack</u> command. Layer four
              protocols other than tcp, udp and icmp are currently not supported.  A  subset  of  the  supported
              protocols may be requested using <u>conntrack’s</u> <u>-p</u> <u>tcp,</u> <u>-p</u> <u>udp</u> or <u>-p</u> <u>icmp</u> options.

              When all connections should be logged (not just snat connections) then omit <u>conntrack’s</u> <u>-n</u> option.
              See also option <u>--no-via</u> below.

              Unless  option  <u>--no-bytes</u>  is  specified  the  conntrack  program  reports the number of sent and
              received bytes  of  connections.  Conntrack  does  so  when  the  value  1  has  been  written  to
              <u><a href="file:/proc/sys/net/netfilter/nf_conntrack_acct">/proc/sys/net/netfilter/nf_conntrack_acct</a></u>. When <u>natlog</u> starts, and <u>no-bytes</u> has not been specified
              then <u>natlog</u> writes 1 to <u>nf_conntrack_acct</u>.

              Note:  when specifying the <u>conntrack-command</u> option in the configuration file do not sourround the
              command with quotes.

       o      <b>--conntrack-device</b>=<u>dev</u>
              By default <u>conntrack</u> monitors the information made available at the <u>/proc/net/nf_conntrack</u> device.
              When another device should be used, specify it using this option.

       o      <b>--conntrack-ip-header-size</b>=<u>size</u>
              This option is used to correct for the IP header sizes. By default, <u>conntrack</u> includes these sizes
              in reported byte counts. By specifying this option packet sizes reported by <u>conntrack</u> are  reduced
              by   <u>size</u>.   Commonly   IP  headers  consist  of  20  bytes  (so,  to  correct  for  this  specify
              <u>--conntrack-ip-header-size</u> <u>20</u>).

       o      <b>--conntrack-restart</b>=<u>max</u>
              If the conntrack process prematurely ends it is restarted  at  most  <u>max</u>  times  (these  are  pure
              <u>restarts</u>:  conntrack’s initial startup is not counted for this option). By default 10 restarts are
              allowed.

       o      <b>--debug</b>
              Write additional info to  the  log  file.  Currently,  <u>--debug</u>  writes  information  about  memory
              consumption to the log file.

       o      <b>--help</b> (<b>-h</b>)
              Write basic usage information to the standard output stream and terminate.

       o      <b>--log</b>=<u>argument</u>
              By  default  <u>natlog</u>  forwards  log  messages about <u>natlog</u> and connection information to the syslog
              daemon using the <u>DAEMON</u> facility with priority <u>NOTICE</u> (see below at the <u>syslog*</u> options). This  is
              identical to specifying the argument <u>syslog</u>.

              Alternatively,  specify  the  argument <u>off</u> to suppress writing log messages. Any other argument is
              interpreted as a path-specification to a file  to  receive  the  log  messages:  log-messages  are
              appended to existing files. If the log file does not yet exist it is first created.

              The  <u>stdout</u>  option  is handled independently from the <u>log</u> option: log messages will appear to the
              standard output stream if <u>stdout</u> and <u>log:</u> <u>off</u> are both specified.

       o      <b>--log-data</b>=<u>path</u>
              <u>Path</u> specifies the pathname of the file where information about observed connections is written in
              tabular form. If <u>path</u> does not yet exist it is first created. Refer to the <u>DESCRIPTION</u> section for
              information about the format of the generated table. Specify <u>""</u>  as  command-line  option  if  the
              configuration file specifies a log data file, but no tabular data should be logged for that <u>natlog</u>
              run.

              Like  the  standard  log  file  (option  <u>--log</u>)  the  <u>log-data</u>  file is not rotated if rotation is
              requested (cf. option  <u>log-rotate</u>).  For  statistical  analyses  rotated  log-data  files  can  be
              concatenated (usually omitting the first (header) line of rotated log-data files).

       o      <b>--log-rotate</b>=<u>spec</u>
              This  option  specifies  the  frequency  and  the number of log-files that are rotated. By default
              log-files are not rotated.
              To rotate log-files use <u>time[mhd]</u> or <u>time[mhd]nFiles</u>. The ’time’ specification is a number,  which
              must  be  followed by <u>m</u> for minutes, <u>h</u> for hours, and <u>d</u> for days. <u>nFiles</u> specifies the max. number
              of rotated files. If only <u>time[mhd]</u> is specified, then <u>nFiles</u> is set to 1.  By default (or if <u>time</u>
              or <u>nfiles</u> are specified as zero (0)) log files are not rotated.

       Note: when  using  <b><a href="../man1/rsyslogd.1.html">rsyslogd</a></b>(1)  for  logging  (i.e.,  when  specifying  <u>--log</u>  <u>syslog</u>,  see  also  option
       <u>syslog-facility</u>  below),  then  it  is assumed that the syslog daemon or a log-file rotation program like
       <b><a href="../man8/logrotate.8.html">logrotate</a></b>(8) handles the log file rotations. Rotating the <u>log-data</u> file is  not  affected  by  specifying
       <u>--log</u> <u>syslog</u>.

       <u>Natlog</u> uses a built-in minimum rotation interval of 30 seconds.

       o      <b>--no-bytes</b>
              By  default log-entries show numbers of sent and received bytes. Specify this option to omit these
              statistics from log-entries.

       o      <b>--no-daemon</b>
              By default, <u>natlog</u> runs in the background (a daemon). <u>Natlog</u> runs as an ordinary program (i.e., in
              the foreground when the option <u>no-daemon</u> is specified). When running as a  daemon,  <u>--stdout</u>  (see
              below)  is  suppressed,  and  <u>--verbose</u> messages (see below) are sent to the syslog daemon, unless
              <u>--no-syslog</u> was specified. When using the tcpdump-mode <u>natlog</u> does not run in the  background.  In
              this  case,  if  <u>no-daemon</u>  is  omitted  a  warning  message is logged, and <u>natlog</u> continues as an
              ordinary program.

       o      <b>--no-dst</b>
              Normally, when snat connections are logged the destination  IP  addresses  and  port  numbers  are
              logged  as ’dst’ entries in log-data files and as ’to’ entries in log-files.  If these destination
              items should be omitted specify <u>no-via</u> as configuration parameter or as option.

       o      <b>--no-via</b>
              Normally, when snat connections are logged the host handling the address translations  are  logged
              as  ’via’  entries  in  log-files.   If  the  ’via’  entries  should be omitted activate <u>no-via</u> as
              configuration parameter or as option.

       o      <b>--pid-file</b>=<u>path</u> (<b>-p</b>)
              When <u>natlog</u> runs in the background, then <u>path</u> is the name of the path  of  the  file  holding  the
              daemon’s  process-id.  By  default  this  file  is <u>/run/natlog.pid</u>. To end the daemon, simply call
              <u>natlog</u> <u>--terminate</u> (or send a <u>SIGINT</u> or  <u>SIGTERM</u>  signal  to  the  process  id  mentioned  in  the
              <u>pid-file</u>). <u>Natlog</u> uses <u>SIGHUP</u> and <u>SIGALRM</u> signals for explicit rotations of log-files (see options
              <u>--rotate</u> and <u>--rotate-data</u> below.

       o      <b>--protocol</b>=<u>specification</u> (<b>-P</b>)
              The  protocol(s)  to  monitor.  By  default  the  tcp  layer four protocol is monitored. Currently
              <u>natlog’s</u> <u>conntrack</u> command can monitor the tcp, udp, and icmp layer  four  protocols.   Using  the
              <u>protocol</u> option (note: only one <u>protocol</u> option should be specified) any subset of these protocols
              can  be  selected  by  specifying a colon-separated subset of tcp, udp, and icmp (e.g., <u>--protocol</u>
              <u>udp:tcp</u>). The specification <u>all</u> can be used to monitor all three protocols (tcp, udp, and icmp).

       o      <b>--rotate</b>
              When <u>--log</u> has been used then this option forces rotating the  log  file  independently  from  the
              interval  specified  by  <u>--log-rotate</u>.  <u>Natlog</u>  uses  a  built-in  minimum rotation interval of 30
              seconds.

       o      <b>--rotate-data</b>
              When <u>--log-data</u> has been used then this option forces rotating  the  log-data  file  independently
              from  the  interval specified by <u>--log-rotate</u>. <u>Natlog</u> uses a built-in minimum rotation interval of
              30 seconds.

       o      <b>-S</b>
              Use this option as first option, immediately following the program name, when starting <u>natlog</u> from
              a <b><a href="../man1/systemd.1.html">systemd</a></b>(1) <u>natlog.service</u> file. See also section <b>SYSTEMD</b> below.

       o      <b>--stdout</b> (<b>-s</b>)
              Syslog-equivalent messages are sent to the standard output.  This option is suppressed when <u>natlog</u>
              runs as a daemon.

       o      <b>--syslog-facility</b>=<u>facility</u>
              The facility that is used to write the syslog messages to. By  default  this  is  <u>DAEMON</u>.  For  an
              overview  of  facilities  and  their  meanings,  see,  e.g., <b><a href="../man3/syslog.3.html">syslog</a></b>(3). With <u>natlog</u> the facilities
              <u>DAEMON,</u> <u>LOCAL0,</u> <u>LOCAL1,</u> <u>LOCAL2,</u> <u>LOCAL3,</u> <u>LOCAL4,</u> <u>LOCAL5,</u> <u>LOCAL6,</u> <u>LOCAL7</u>, and <u>USER</u> can be used.

       When <u>rsyslog</u> <u>filtering</u> is used (see that section  below)  then  <b><a href="../man8/rsyslogd.8.html">rsyslogd</a></b>(8)  uses  that  instead  of  the
       specified facility.

       o      <b>--syslog-priority</b>=<u>priority</u>
              The  priority  that  is  used  to  write the syslog messages to. By default this is <u>NOTICE</u>. For an
              overview of priorities  and  their  meanings,  see,  e.g.,  <b><a href="../man3/syslog.3.html">syslog</a></b>(3).  With  <u>natlog</u>  all  defined
              priorities can be used. E.g.,  <u>EMERG,</u> <u>ALERT,</u> <u>CRIT,</u> <u>ERR,</u> <u>WARNING,</u> <u>NOTICE,</u> <u>INFO</u> and <u>DEBUG</u>.

       o      <b>--syslog-tag</b>=<u>tag</u>
              When  syslog  messages  are generated they can be provided with a <u>tag</u>, which can be used to filter
              <u>natlog</u>’s syslog messages from the log-files. By default the tag <u>NATLOG</u> is used. See  also  section
              <u>RSYSLOG</u> <u>FILTERING</u> below.

       o      <b>--terminate</b>
              When  <u>natlog</u>  runs  as  a  daemon,  the  command <u>natlog</u> <u>--terminate</u> can be issued to terminate the
              daemon. By default it reads the daemon’s process ID from <u>natlog’s</u> pid-file (cf.  option  <u>pid-file</u>)
              <u>/run/natlog.pid</u>). If another pid-file holds the process ID of the <u>natlog</u> program to terminate then
              specify the location of the pid-file to use using a command like

                  natlog --terminate --pid-file=/path/to/the/pid-file

              When  the daemon could be terminated 0 is returned. Otherwise, an error message is displayed and 1
              is returned.

       o      <b>--time</b>=<u>spec</u> (<b>-t</b>)
              By default time stamps written by <u>natlog</u> are in raw, numeric form. E.g.,

                  NATLOG: From 1338990672:55588 thru 1338990747:807100

              These time stamps indicate times in seconds:microseconds since the beginning of the epoch, January
              1, 1970, 0:00 UTC. This option can be used to change the seconds part of the time stamps  to  more
              conventional representations.
              Specify <u>raw</u> (the default) for the default representation in seconds since the epoch;
              specify <u>utc</u> for a representation like <u>Jun</u> <u>6</u> <u>13:29:11</u>, using Universal Time Coordinated;
              specify  <u>local</u>  for a representation like <u>Jun</u> <u>6</u> <u>13:29:11</u>, using the local time zone defined by the
              computer running <u>natlog</u>.

       o      <b>--ttl</b>=<u>secs[ui]</u> (<b>-T</b>)
              time-to-live for received connections. At most two time-to-live specifications  can  be  provided:
              for  udp/icmp  connections a letter <u>u</u> must be appended to the specified seconds. By default <u>60u</u> is
              used. For tcp connections a letter <u>t</u> must be appended to the specified seconds. By  default  <u>3000t</u>
              is   used.  Both  time-to-live  specifications  may  be  combined:  <u>--ttl</u>  <u>120u1800t</u>  specifies  a
              time-to-live of two minutes for udp/icmp connections and a time-to-live of half an  hour  for  tcp
              connections. Time-to-live is not used in conntrack-mode.

       o      <b>--verbose</b> (<b>-V</b>)
              Additional  messages about <u>natlog</u>’s mode of operation are sent to the standard output stream. When
              <u>natlog</u> runs as a daemon these messages are sent to  the  syslog  daemon,  unless  <u>--no-syslog</u>  was
              specified.

       When  <u>--verbose</u>  is specified twice then all actual configuration parameters are shown just before <u>natlog</u>
       starts.

       When <u>--verbose</u> is specified more often then <u>natlog</u> ends after reporting the configuration parameters.

       o      <b>--version</b> (<b>-v</b>)
              Write <u>natlog</u>’s version number to the standard output stream and terminate.

       )

</pre><h4><b>SYSTEMD</b></h4><pre>
       An annoying characteristic of <b><a href="../man1/systemd.1.html">systemd</a></b>(1) is that environment variables containing blanks  are  passed  as
       single  arguments  to the program being called by their <u>.service</u> files. As a consequence, it is very hard
       to provide an environment variable  in,  e.g.,  <u>/etc/default/natlog</u>  specifying  <u>natlog’s</u>  arguments:  in
       practice  the  number  of arguments varies, and so even constructions like <u>ARG1=value1,</u> <u>ARG2=value2</u>, etc.
       are awkward at best.

       As a stopgap for this unwelcome characteristic of <u>systemd</u> the option <u>-S</u> is provided. When used it <u>must</u> be
       specified as <u>natlog’s</u> first argument.  <u>Natlog</u>  will  then  inspect  all  remaining  arguments,  splitting
       arguments  containing  blanks into separate arguments, which are then processed by <u>natlog</u> as intended. Be
       aware that, to limit the complexity  of  the  splitting-procedure,  it  is  not  full-proof:  double-  or
       single-quote  delimited  string-arguments  will  also  be split into separate arguments. Unless filenames
       themselves containing blanks are passed as arguments to <u>natlog</u>  this  limitation  is  probably  not  very
       serious.

       As an example, here is an example of <u>systemd’s</u> <u>ExecStart</u> specification:

           ExecStart=/usr/bin/natlog -S -p ${PIDFILE} ${DAEMON_ARGS}

       where <u>DAEMON_ARGS</u> might have been specified in <u>/etc/default/natlog</u> as

           DAEMON_ARGS=--log /tmp/natlog.log --log-data /dev/null conntrack

</pre><h4><b>RSYSLOG</b> <b>FILTERING</b></h4><pre>
       When  using  <b><a href="../man8/rsyslogd.8.html">rsyslogd</a></b>(8) property based filters may be used to filter syslog messages and write them to a
       file of your choice. E.g., to filter messages starting with the syslog message tag (e.g., <u>NATLOG</u>) use

       :syslogtag, isequal, "NATLOG:"   /var/log/natlog.log
       :syslogtag, isequal, "NATLOG:"   stop

       Note that the colon is part of the tag, but is not specified with the <u>syslog-tag</u> option.

       This causes all messages having the <u>NATLOG:</u> tag to be written on <u>/var/log/natlog.log</u> after which they are
       discarded.      More      extensive      filtering      is      also      supported,      see,      e.g.,
       <u><a href="http://www.rsyslog.com/doc/rsyslog_conf_filter.html">http://www.rsyslog.com/doc/rsyslog_conf_filter.html</a></u> and <u><a href="http://www.rsyslog.com/doc/property_replacer.html">http://www.rsyslog.com/doc/property_replacer.html</a></u>

</pre><h4><b>EXAMPLES</b></h4><pre>
       Examples of <u>natlog</u> activations:

       o      <u>natlog</u> <u>--no-daemon</u> <u>--no-syslog</u> <u>-s</u> <u>br0</u> <u>eth0</u>
              <u>Natlog</u>  remains  active as a foreground process, no syslog messages are written, syslog-equivalent
              message are written to the standard output. <u>Natlog</u> uses the pcap library to capture  packets  from
              the  <u>br0</u> device, which is active behind the firewall, and to capture packets from the <u>eth0</u> device,
              which is the device to where source-natted packages are sent.

       o      <u>natlog</u> <u>conntrack</u>
              Depending on the options specified in <u>/etc/natlog.conf</u> (or, if  not  available,  <u>natlog</u>’s  default
              options)  source-natted connections are obtained from <b><a href="../man1/conntrack.1.html">conntrack</a></b>(1). By default <u>natlog</u> continues as
              a daemon process, generating syslog messages using syslog tags <u>NATLOG:</u>, and containing information
              about source-natted connections.

       Here is <u>natlog</u>’s default configuration file. Empty lines and  lines  starting  with  hash-marks  (#)  are
       ignored. Options adhere to the following syntax:

       option  value

       Option and value are separated by white space, a colon may be appended to option names:

       # This configuration file shows the default option values.
       #   Options that are *not* active by default have an extra comment-line
       #   showing ’not by default:’

       # all options and values are case sensitive
       # see `man natlog’ for further details

           # the path and options of the conntrack program:
           # when no filtering options are specified, the tcp
           # protocol is monitored
           # the default command is shown.
           # Note: do not surround the conntrack command specification with quotes
       #conntrack-command:  /usr/sbin/conntrack -E -n -o timestamp -e NEW,DESTROY

           # the device used by conntrack
       #conntrack-device:  /proc/net/nf_conntrack

           # correction for the IP header size
           # (standard IP header size is 20 bytes)
       #conntrack-ip-header-size:  0

           # max. number of conntrack restarts
       #conntrack-restart: 10

           # write additional info to the log file
       # not by default:
       #debug

           # log messages are written to ’pathname’; use ’log: off’ to suppress log
           # messages
       # not by default:
       #log: pathname

           # data file containing tabular logs
       # not by default:
       #log-data:  pathname

           # tmespec: time[mhd]nFiles - specification for rotating log-files
       # not by default:
       #log-rotate: timespec

           # do not log the sent/received byte counts (default: counts are logged)
       # not by default:
       #no-bytes

           # do not run as a daemon
       # not by default:
       #no-daemon

           # do not log the destination entries
       # not by default:
       #no-dst

           # do not log the via: entries
       # not by default:
       #no-via

           # the path to the pid-file of natlog’s daemon process
       #pid-file: /run/natlog.pid

           # the protocols that are scanned with the ’conntrack’ command:
           #   protocol: all       - monitors tcp, udp, icmp
           #   protocol: udp:tcp   - monitors upd and tcp (any non-empty subset,
           #                         possibly including icmp is OK)
       #protocol: tcp

           # write messages to stdout (ignored by daemons)
       # not by default:
       #stdout

           # the default syslog facility:
       #syslog-facility: DAEMON

           # the default syslog priority:
       #syslog-priority: NOTICE

           # the default syslog tag:
       #syslog-tag: NATLOG

           # the default time specification (alternatives: utc, local):
       #time: raw

           # ttl: time to live (seconds) for udp/icmp connections
       #ttl: 60

       # end of the configuration file

</pre><h4><b>FILES</b></h4><pre>
       o      <u>/etc/natlog.conf</u>: default configuration file location;

       o      <u>/etc/default/natlog</u>: arguments for startup scripts;

       o      <u>/etc/init.d/natlog</u>: SysV startup script;

       o      <u>/etc/systemd/system/natlog.service</u>: systemd startup script (calling <u>/etc/init.d/natlog</u>).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/conntrack.1.html">conntrack</a></b>(1),   <b><a href="../man1/ifconfig.1.html">ifconfig</a></b>(1),  <b><a href="../man1/iptables.1.html">iptables</a></b>(1),  <b><a href="../man8/logrotate.8.html">logrotate</a></b>(8),  <b><a href="../man7/pcap-filter.7.html">pcap-filter</a></b>(7),  <b><a href="../man1/ping.1.html">ping</a></b>(1),  <b><a href="../man1/R.1.html">R</a></b>(1),  <b><a href="../man8/rsyslogd.8.html">rsyslogd</a></b>(8),
       <b><a href="../man3/syslog.3.html">syslog</a></b>(3), <b><a href="../man1/systemd.1.html">systemd</a></b>(1), <b><a href="../man1/tcpdump.1.html">tcpdump</a></b>(1)

</pre><h4><b>BUGS</b></h4><pre>
       <u>Natlog</u> currently can process tcp, udp and icmp layer four protocols.

</pre><h4><b>AUTHOR</b></h4><pre>
       Frank B. Brokken (<a href="mailto:f.b.brokken@rug.nl">f.b.brokken@rug.nl</a>).

natlog.3.00.01                                      2012-2022                                          <u><a href="../man1/natlog.1.html">natlog</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>