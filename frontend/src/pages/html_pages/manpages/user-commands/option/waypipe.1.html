<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>waypipe - A transparent proxy for Wayland applications</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/waypipe">waypipe_0.9.2-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       waypipe - A transparent proxy for Wayland applications

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>waypipe</b> [options...] <b>ssh</b> [ssh options] <u>destination</u> <u>command...</u>

       <b>waypipe</b> [options...] <b>client</b>
       <b>waypipe</b> [options...] <b>server</b> -- <u>command...</u>
       <b>waypipe</b> <b>recon</b> <u>control_pipe</u> <u>new_socket_path</u>
       <b>waypipe</b> <b>bench</b> <u>bandwidth</u>
       <b>waypipe</b> [<b>--version</b>] [<b>-h</b>, <b>--help</b>]

       [options...] = [<b>-c</b>, <b>--compress</b> C] [<b>-d</b>, <b>--debug</b>] [<b>-n</b>, <b>--no-gpu</b>] [<b>-o</b>, <b>--oneshot</b>] [<b>-s</b>, <b>--socket</b> S] [<b>--allow-</b>
       <b>tiled</b>]  [<b>--control</b>  C]  [<b>--display</b>  D]  [<b>--drm-node</b> R] [<b>--remote-node</b> R] [<b>--remote-bin</b> R] [<b>--login-shell</b>]
       [<b>--threads</b> T] [<b>--title-prefix</b> P] [<b>--unlink-socket</b>] [<b>--video</b>[=V]] [<b>--vsock</b>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Waypipe is a proxy for Wayland clients, with the aim of supporting behavior like <b>ssh</b> <b>-X</b>.

       Prefixing an <b>ssh</b> <b>...</b> command to become <b>waypipe</b> <b>ssh</b> <b>...</b> will automatically run <b>waypipe</b>  both  locally  and
       remotely,  and  modify  the  ssh  command  to set up forwarding between the two instances of <b>waypipe</b>. The
       remote instance will act like a Wayland compositor, letting Wayland applications that are run remotely be
       displayed locally.

       When run as <b>waypipe</b> <b>client</b>, it will open a socket  (by  default  at  <u>/tmp/waypipe-client.sock</u>)  and  will
       connect to the local Wayland compositor and forward all Wayland applications which were linked to it over
       the socket by a matching <b>waypipe</b> <b>server</b> instance.

       When  run  as <b>waypipe</b> <b>server</b>, it will run the command that follows in its command line invocation, set up
       its own Wayland compositor socket, and try to connect to its matching <b>waypipe</b> <b>client</b> socket  (by  default
       <u>/tmp/waypipe-server.sock</u>)  and  try  to  forward  all the Wayland clients that connect to fake compositor
       socket to the matching <b>waypipe</b> <b>client</b>.

       The <b>waypipe</b> <b>recon</b> mode is used to reconnect a <b>waypipe</b> <b>server</b>  instance  which  has  had  a  control  pipe
       (option <b>--control</b>) set. The new socket path should indicate a Unix socket whose connections are forwarded
       to the <b>waypipe</b> <b>client</b> that the <b>waypipe</b> <b>server</b> was initially connected to.

       The  <b>waypipe</b>  <b>bench</b>  mode can be used to estimate, given a specific connection <u>bandwidth</u> in MB/sec, which
       compression options produce the lowest latency. It tests two synthetic images, one made to be roughly  as
       compressible  as  images containing text, and one made to be roughly as compressible as images containing
       pictures.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-c</b> <b>C,</b> <b>--compress</b> <b>C</b>
           Select the compression method applied  to  data  transfers.  Options  are  <u>none</u>  (for  high-bandwidth
           networks),  <u>lz4</u>  (intermediate),  <u>zstd</u>  (slow  connection).  The  default  compression  is  <u>lz4</u>.† The
           compression level can be chosen by appending = followed by a number. For example,  if  <b>C</b>  is  <u>zstd=7</u>,
           waypipe will use level 7 Zstd compression.

           † Unless <b>waypipe</b> is built without LZ4 support, in which case the default compression will be <u>none</u>.

       <b>-d,</b> <b>--debug</b>
           Print debug log messages.

       <b>-h,</b> <b>--help</b>
           Show help message and quit.

       <b>-n,</b> <b>--no-gpu</b>
           Block protocols like wayland-drm and linux-dmabuf which require access to e.g. render nodes.

       <b>-o,</b> <b>--oneshot</b>
           Only permit a single connection, and exit when it is closed.

       <b>-s</b> <b>S,</b> <b>--socket</b> <b>S</b>
           Use  <b>S</b>  as  the  path  for  the Unix socket. The default socket path for server mode is <u>/tmp/waypipe-</u>
           <u>server.sock</u>; for client mode, it is <u>/tmp/waypipe-client.sock</u>; and in ssh mode,  <b>S</b>  gives  the  prefix
           used  by  both  the  client  and the server for their socket paths. The default prefix in ssh mode is
           <u>/tmp/waypipe</u>.

           When vsock is enabled use <b>S</b> to specify a CID and a port number.

       <b>--version</b>
           Briefly describe Waypipe's version and the features it was built with, then quit. Possible  features:
           LZ4  compression  support,  ZSTD  compression support, ability to transfer DMABUFs, video compression
           support, VAAPI hardware video de/encoding support.

       <b>--allow-tiled</b>
           By default, waypipe filters out all advertised DMABUF formats which have format layout modifiers,  as
           CPU  access  to these formats may be very slow. Setting this flag disables the filtering. Since tiled
           images often permit faster GPU operations, most OpenGL applications will select tiling modifiers when
           they are available.

       <b>--control</b> <b>C</b>
           For server or ssh mode, provide the path to the "control pipe" that will be created the  the  server.
           Writing  (with  <b>waypipe</b>  <b>recon</b>  <b>C</b> <b>T</b>, or 'echo -n T &gt; C') a new socket path to this pipe will make the
           server instance replace all running connections with connections to the  new  Unix  socket.  The  new
           socket  should  ultimately  forward  data to the same waypipe client that the server was connected to
           before.

       <b>--display</b> <b>D</b>
           For server or ssh mode, provide <u>WAYLAND_DISPLAY</u> and let waypipe configure its Wayland display  socket
           to  have  a  matching  path.  (If <b>D</b> is not an absolute path, the socket will be created in the folder
           given by the environment variable <u>XDG_RUNTIME_DIR</u>.)

       <b>--drm-node</b> <b>R</b>
           Specify the path <b>R</b> to the drm device that this instance of waypipe should use and  (in  server  mode)
           notify connecting applications about.

       <b>--remote-node</b> <b>R</b>
           In  ssh  mode,  specify  the path <b>R</b> to the drm device that the remote instance of waypipe (running in
           server mode) should use.

       <b>--remote-bin</b> <b>R</b>
           In ssh mode, specify the path <b>R</b> to the waypipe binary on the remote computer, or its name  if  it  is
           available in <u>PATH</u>. It defaults to <b>waypipe</b> if this option isn’t passed.

       <b>--login-shell</b>
           Only for server mode; if no command is being run, open a login shell.

       <b>--threads</b> <b>T</b>
           Set  the  number  of  total threads (including the main thread) which a <b>waypipe</b> instance will create.
           These threads will be used to parallelize compression operations. This flag is passed on  to  <b>waypipe</b>
           <b>server</b>  when  given  to  <b>waypipe</b>  <b>ssh</b>. The flag also controls the thread count for <b>waypipe</b> <b>bench</b>. The
           default behavior (choosable by setting <b>T</b> to <u>0</u>) is to use half as many threads  as  the  computer  has
           hardware threads available.

       <b>--title-prefix</b> <b>P</b>
           Prepend  <b>P</b>  to  any  window titles specified using the XDG shell protocol. In ssh mode, the prefix is
           applied only on the client side.

       <b>--unlink-socket</b>
           Only for server mode; on shutdown, unlink the Unix socket that waypipe connects to.

       <b>--video[=V]</b>
           Compress specific DMABUF formats using a lossy video codec. Opaque, 10-bit, and multiplanar  formats,
           among  others,  are  not  supported.  <b>V</b>  is  a  comma  separated list of options to control the video
           encoding. Using the <b>--video</b> flag without setting any options  is  equivalent  to  using  the  default
           setting of: <b>--video=sw,bpf=120000,h264</b>. Later options supersede earlier ones.

           <b>sw</b>
               Use software encoding and decoding.

           <b>hw</b>
               Use  hardware  (VAAPI) encoding and decoding, if available. This can be finicky and may only work
               with specific window buffer formats and sizes.

           <b>h264</b>
               Use H.264 encoded video.

           <b>vp9</b>
               Use VP9 encoded video.

           <b>bpf=B</b>
               Set the target bit rate of the video encoder, in units of bits per frame. <b>B</b> can be written as  an
               integer or with exponential notation; thus <b>--video=bpf=7.5e5</b> is equivalent to <b>--video=bpf=750000</b>.

       <b>--hwvideo</b>
           Deprecated option, equivalent to --video=hw .

       <b>--vsock</b>
           Use  vsock  instead  of  unix sockets. This is used when waypipe is running in virtual machines. With
           this option enabled specify a CID and a port number in <b>S</b>. CID is only used in the server mode and can
           be omitted when connecting from a guest virtual machine to host.

       <b>--secctx</b> <b>S</b>
           Enable the Wayland security context protocol (client or ssh modes). Specify an application ID <b>S</b>  that
           will be attached to the security context.

</pre><h4><b>EXAMPLE</b></h4><pre>
       The  following  <b>waypipe</b> <b>ssh</b> subcommand will attempt to run <b>weston-flower</b> on the server <u>exserv</u>, displaying
       the result on the local system.

                waypipe ssh user@exserv weston-flower

       One can obtain similar behavior by explicitly running waypipe and ssh:

                waypipe --socket /tmp/socket-client client  &amp;
                ssh -R /tmp/socket-server:/tmp/socket-client user@exserv \
                     waypipe --socket /tmp/socket-server server -- weston-flower
                kill %1

       Waypipe may be run locally without an SSH connection by specifying matching socket paths. For example:

                waypipe --socket /tmp/waypipe.sock client &amp;
                waypipe --socket /tmp/waypipe.sock server weston-simple-dmabuf-egl
                kill %1
                rm /tmp/waypipe.sock

       Using transports other than SSH is a bit more complicated. A recipe with ncat to connect to  <u>remote</u>  from
       computer <u>local</u>:

               $ waypipe --socket /tmp/waypipe-remote.sock client &amp;
               $ ncat --ssl -lk 12345 --sh-exec 'ncat -U /tmp/waypipe-remote.sock' &amp;
               $ ssh user@remote

               &gt; ncat -lkU /tmp/waypipe-local.sock --sh-exec 'ncat --ssl local 12345' &amp;
               &gt; waypipe --display wayland-local \
                           --socket /tmp/waypipe-local.sock server -- sleep inf &amp;
               &gt; WAYLAND_DISPLAY=wayland-local application

       Given  a  certificate  file,  socat  can also provide an encrypted connection (remove 'verify=0' to check
       certificates):

               $ waypipe --socket /tmp/waypipe-remote.sock client &amp;
               $ socat openssl-listen:12345,reuseaddr,cert=certificate.pem,verify=0,fork \
                   unix-connect:/tmp/waypipe-remote.sock
               $ ssh user@remote

               &gt; socat unix-listen:/tmp/waypipe-local.sock,reuseaddr,fork \
                   openssl-connect:local:12345,verify=0 &amp;
               &gt; waypipe --socket /tmp/waypipe-local.sock server -- application

       Many applications require specific environment variables to use Wayland instead  of  X11.  If  ssh  isn't
       configured  to  support  loading  <u><a href="file:~/.ssh/environment">~/.ssh/environment</a></u>,  or  to  allow  specific  variables  to be set with
       <u>AcceptEnv</u>/<u>SetEnv</u>, one can run <b>waypipe</b> <b>ssh</b> without a command (and thereby open a login shell), or use  <b>env</b>
       to set the needed variables each time:

                 waypipe ssh user@host env XDG_SESSION_TYPE=wayland dolphin

       In some cases, one may wish to set environment variables for the <b>waypipe</b> <b>server</b> process itself; the above
       trick with <b>env</b> will not do this, because the <b>env</b> process will be a child of <b>waypipe</b> <b>server</b>, not the other
       way  around. Instead, one can use <u><a href="file:~/.ssh/environment">~/.ssh/environment</a></u>, or use the <b>--remote-bin</b> option to change the remote
       Waypipe instance to a shell script that sets the environment before running the actual <b>waypipe</b> program.

       Waypipe has support for reconnecting a <b>waypipe</b> <b>client</b> and a <b>waypipe</b> <b>server</b>  instance  when  whatever  was
       used  to  transfer  data  between their sockets fails. For this to work, waypipe must still be running on
       both sides of the connection. As the <b>waypipe</b> <b>ssh</b> wrapper will automatically close both the <b>waypipe</b> <b>client</b>
       and the <b>waypipe</b> <b>server</b> when the connection fails, the client and server modes must be run seprately.  For
       example,  to  persistently  forward  applications  running  on server <u>rserv</u> to a local Wayland compositor
       running on <u>lserv</u>, one would first set up a waypipe client instance on <u>lserv</u>,

                waypipe -s /tmp/waypipe.sock client &amp;

       and on server <u>rserv</u>, establish socket forwarding and run the server

                ssh -fN -L /tmp/waypipe-lserv.sock:/tmp/waypipe.sock user@lserv
                waypipe -s /tmp/waypipe-lserv.sock --control /tmp/ctrl-lserv.pipe \
                     --display wayland-lserv server -- sleep inf &amp;

       then set <u>WAYLAND_DISPLAY=wayland-lserv</u> and run the desired applications. When the ssh forwarding  breaks,
       on <u>rserv</u>, reconnect with

                ssh -fN -L /tmp/waypipe-lserv-2.sock:/tmp/waypipe.sock user@lserv
                waypipe recon /tmp/ctrl-lserv.pipe /tmp/waypipe-lserv-2.sock

   <b>Running</b> <b>waypipe</b> <b>in</b> <b>virtual</b> <b>machines</b>
       When  running  waypipe  in  virtual  machines  on the same host it is possible to use vsock for efficient
       inter-vm communication. The following scenarios are supported:

       •   Running applications on host from guest.

                host&gt; waypipe --vsock -s 1234 client
                guest&gt; waypipe --vsock -s 1234 server weston-terminal

       •   Running applications in a guest virtual machine from host.

                guest&gt; waypipe --vsock -s 1234 client
                host&gt; waypipe --vsock -s 3:1234 server weston-terminal

       In this example waypipe server connects to a virtual machine with CID 3 on port 1234.

       •   Running applications in a guest virtual machine from other guest virtual machines. When running  both
           client  and  server  in  virtual  machines  it  is possble to enable the VMADDR_FLAG_TO_HOST flag for
           sibling communication by prefixing the CID with an s:

                guest&gt; waypipe --vsock -s 1234 client
                guest&gt; waypipe --vsock -s s3:1234 server weston-terminal

       In this case all packets will be routed to host where they can be forwarded to  another  virtual  machine
       with a vhost-device-vsock device or some other utility.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       When running as a server, by default <u>WAYLAND_DISPLAY</u> will be set for the invoked process.

       If  the  <b>--oneshot</b>  flag is set, waypipe will instead set <u>WAYLAND_SOCKET</u> and inherit an already connected
       socketpair file descriptor to the invoked (child)  process.  Some  programs  open  and  close  a  Wayland
       connection repeatedly as part of their initialization, and will not work correctly with this flag.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       <b>waypipe</b>  <b>ssh</b>  will exit with the exit status code from the remote command, or with return code 1 if there
       has been an error.

</pre><h4><b>SECURITY</b></h4><pre>
       Waypipe does not provide any strong security guarantees, and  connecting  to  untrusted  servers  is  not
       recommended.  It  does  not  filter  which Wayland protocols the compositor makes available to the client
       (with a few exceptions for protocols that require file descriptors which Waypipe cannot yet handle).  For
       example,  if  a  Wayland compositor gives all its clients access to a screenshot or lock-screen protocol,
       then proxied clients run under Waypipe can also make screenshots or lock the screen.

       In general, applications are not well tested against malicious compositors, and compositors are not  well
       tested  against malicious clients. Waypipe can connect the two, and may blindly forward denial-of-service
       and other attacks.

       Waypipe itself is written in C and links to compression, graphics, and video libraries; both it and these
       libraries may have security bugs. Some risk can be avoided by building Waypipe with DMABUF support turned
       off, or running Waypipe with the <b>--no-gpu</b> flag so that it does not expose graphics libraries.

       <b>waypipe</b> <b>ssh</b> has no explicit protections against timing attacks; an  observer  to  the  resulting  network
       traffic  may,  by studying the size and timing of packets, learn information about the user's interaction
       with a Wayland client proxied through <b>waypipe</b> <b>ssh</b>. For example: a lack of activity suggests the  user  is
       not  currently using the application, while an intermittant stream of messages from the compositor to the
       client may indicate mouse movement (or maybe something else: the contents of the messages  are  protected
       by <b>ssh</b>.)

       The  memory used by Waypipe processes may, at a given time, include Wayland messages encoding user input,
       and the contents of current and recent frames drawn for application windows. Swap should be encrypted  to
       prevent this data from being leaked to disk.

</pre><h4><b>BUGS</b></h4><pre>
       File bug reports at: https://gitlab.freedesktop.org/mstoeckl/waypipe/

       Some  programs  (gnome-terminal, firefox, kate, among others) have special mechanisms to ensure that only
       one process is running at a time. Starting those programs under Waypipe while they are  running  under  a
       different  Wayland  compositor may silently open a window or tab in the original instance of the program.
       Such programs may have a command line argument to create a new instance.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/weston.1.html">weston</a></b>(1), <b><a href="../man1/ssh.1.html">ssh</a></b>(1), <b><a href="../man1/socat.1.html">socat</a>(1)</b>, <b><a href="../man1/ncat.1.html">ncat</a>(1)</b>

                                                   2024-12-01                                         <u><a href="../man1/waypipe.1.html">waypipe</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>