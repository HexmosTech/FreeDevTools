<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rsyncrypto - rsync friendly encryption</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/rsyncrypto">rsyncrypto_1.14-1.2build3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       rsyncrypto - rsync friendly encryption

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>rsyncrypto</b> [<u>options</u>] <u>srcfile</u> <u>dstfile</u> <u>keyfile</u> <u>key</u>
       <b>rsyncrypto</b> [<u>options</u>] <b>-r</b> <u>srcdir</u> <u>dstdir</u> <u>keysdir</u> <u>key</u>
       <b>rsyncrypto</b> [<u>options</u>] <b>--filelist=</b><u>file</u> <u>srcdir</u> <u>dstdir</u> <u>keysdir</u> <u>key</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This manual page documents the <b>rsyncrypto</b> command.

       <b>rsyncrypto</b>  is a utility that encrypts a file (or a directory structure) in a way that ensures that local
       changes to the plain text file will result in local changes to the  cipher  text  file.  This,  in  turn,
       ensures  that  doing  <b>rsync</b>  to synchronize the encrypted files to another machine will have only a small
       impact on <b>rsync</b>'s wire efficiency.

       <b>rsyncrypto</b> will encrypt files using a symmetric block cipher (AES). Each file is encrypted using a unique
       key. The file key is stored in two locations.  One is the "<u>key</u>"  file,  and  the  second  is  inside  the
       encrypted  file  itself. The second copy is encrypted using a RSA public key, which can be shared for all
       encrypted files.

       Decrypting the file can take place in one of two forms:

       <b>Warm</b> <b>Decryption</b>
              <u>keyfile</u> is used to decrypt <u>srcfile</u> into <u>dstfile</u>.

       <b>Cold</b> <b>Decryption</b>
              If <u>keyfile</u> is lost and <u>key</u> is the <b>private</b> key for the RSA encryption, extract and  create  <u>keyfile</u>
              from the encrypted <u>srcfile</u>, and create both <u>keyfile</u> and <u>dstfile</u>.

       If  both  <u>keyfile</u>  and  the  private key are not available, decryption cannot take place. Typically, this
       means that you would either want to transfer the encrypted files in whatever way (secure or insecure, but
       probably <b>rsync</b> :), and keep the plain text file, as well as the key file, secure. As long  as  you  saved
       the RSA private key, you can reconstruct them both.

</pre><h4><b>ARGUMENTS</b></h4><pre>
       The argument meaning depends on the existence of the <b>-r</b>, <b>--filelist</b> and <b>-d</b> flags.

       <u>srcfile</u> or <u>srcdir</u>
              This  is  the  source  for the operation. This will be the plain text file for encryption, and the
              cipher text file for decryption. If the <b>-r</b> option is given, <u>srcdir</u> is  the  directory  from  which
              files are to be encrypted/decrypted. If the <b>--filelist</b> option is given, <u>srcdir</u> is the directory in
              relation to which the file names given by the filelist file are interpreted. If neither are given,
              <u>srcfile</u>  is  the  file  to  be  encrypted/decrypted.  In any case, <u>src</u> must exist prior to running
              <b>rsyncrypto</b>.

       <u>dstfile</u> or <u>dstdir</u>
              Similar to <u>src</u>, this is the destination of the operation. It will be the plain text to be  created
              if <b>-d</b> was given, or the encrypted file otherwise.

       <u>keyfile</u> or <u>keydir</u>
              The file holding the symmetric key for the encryption, or a directory in which symmetric key files
              reside. If the later, the key files will have the same name as the plain text files.

       <u>key</u>    This  file can either be a X509 certificate holding a public key, or a PEM format private key. The
              private key is never needed unless a cold decryption is required. See the <b><a href="../man1/req.1.html">req</a></b>(1) or <b><a href="../man1/x509.1.html">x509</a></b>(1) manual
              pages for more info.

       If <u>dst</u> does not exist, it will be created. The directory in which it is to be created must exist prior to
       running <b>rsyncrypto</b>.

       If encrypting, and a symmetric key for the file is found, the  same  parameters  will  be  used  for  the
       encryption  unless  the  <b>--fr</b>  or  <b>--fk</b> options are used. If that's the case, the key file is going to be
       replaced with the correct parameters.

</pre><h4><b>OPTIONS</b></h4><pre>
       These programs follow the usual GNU command line syntax, with  long  options  starting  with  two  dashes
       (`--').

       <b>-h</b>, <b>--help</b>
              Show summary of options.

       <b>-V</b>, <b>--version</b>
              Print out the current version number.

       <b>-d</b>, <b>--decrypt</b>
              Decrypt  <u>src</u>  into  <u>dst</u>. The default behavior is to encrypt <u>src</u> into <u>dst</u>, and create <u>keyfile</u> if it
              does not exist.

       <b>-r</b>, <b>--recurse</b>
              Recursively encrypt/decrypt an  entire  directory  structure.  All  files  under  <u>srcdir</u>  will  be
              encrypted  to  files of the same name and path (almost, see "<b>--trim</b>") under <u>dstdir</u>. If not already
              there, a key file will be created for each file under <u>keydir</u>.

       <b>--filelist=</b><u>file</u>
              <u>File</u> is the name of a file (or "-" for stdin) that has a list of files and directories to process.
              If the name matches a directory, the entire directory is encrytped in recursive mode.

              Absolute file names in <u>file</u> are taken literally, but are  stored  as  relative  (stripped  of  the
              leading  slash and drive name where applicable). Relative names are interpreted in relation to the
              directory name given by the <u>srcdir</u> argument.  All  names  are  trimmed  according  to  the  <b>--trim</b>
              option.

              <u>dstdir</u> is interpreted as with the <b>-r</b> option.

              <b>--filelist</b> and <b>-r</b> are mutually exclusive.

              <b>BACKWARDS</b>  <b>INCOMPATIBILITY</b> <b>NOTICE:</b> Up until version 1.12 of rsyncrypto, <b>--filelist</b> did not receive
              any parameters, and the file name to use was taken from the <u>src</u> argument.   This  was  changed  in
              version  1.13  because  the  previous  way  could cause problems when the file list was created in
              relation to a different work directory than the one in use. Pass `<b>.</b>' as  <u>srcdir</u>  to  get  the  old
              semantics.

       <b>-c</b>, <b>--changed</b>
              Check  the  src  and  destination  modified  time  (see  <b>--modify-window</b>)  prior to performing the
              operation. If the modified time is the same, assume that the files are also the same, and skip the
              operation. Notice that unlike <b>rsync</b>, file sizes are not compared. This is because the file size is
              expected to change during the encryption (and thus decryption) operation.

       <b>--risky-writes</b>
              Usually, when rsyncrypto writes a file, it uses a temporary name and moves the file to  its  final
              name when successfully done. This serves two purposes.  During encryption, this prevents the false
              sense  of  security  that  may arise in case of an rsyncrypto interruption by preventing a partial
              file from being present (and in case of an update, by keeping the old backup). This  also  ensures
              that  restarting  rsyncrypto  will enable it to correctly detect whether the operation needs to be
              repeated. During decryption, this prevents overwriting a file until we are certain we can  decrypt
              its source.

              The  main  problem with this approach is that, if the file being written is large, the file system
              needs to have enough space for two copies of it for the duration of the operation. Also,  if  hard
              links are maintained, the default rsyncrypto behavior will break the link.

              Specify  <b>--risky-writes</b>  to  make  rsyncrypto directly overwrite the existing file using the final
              name.

       <b>--modify-window=</b><u>num</u>
              Only applicable when <b>-c</b> is in effect. When comparing  file  modification  times,  treat  as  equal
              modification times that are <u>num</u> seconds apart. Default value is zero.

              This  option  is most useful when the encrypted file is stored on a FAT file system.  FAT can only
              store modification time with a 2 seconds accuracy.  This  may  result  in  the  modification  time
              changing between original and encrypted file. In such a case, <b>--modify-window=1</b> should be used.

       <b>--export-changes=</b><u>logfile</u>
              Whenever  encrypting  or  deleting  a  file, write the file's name to <u>logfile</u>. This allows passing
              <u>logfile</u> to <b><a href="../man1/rsync.1.html">rsync</a></b>(1) using the <b>--include-from</b> rsync option.

              This option is mostly useful if <b>rsyncrypto</b> is used to repeatedly encrypt a  huge  directory  tree,
              and  then  using rsync to synchronize it remotely. The use of this option allows focusing <b>rsync</b> on
              only those files that are known to have changed, rather than have it send the entire file list  to
              the  remote  machine,  making  the rsync operation faster. It should be noted that rsync version 3
              starts the actual file transfer  while  it  is  still  transferring  the  file  list,  making  the
              performance gain from this option less noticeable.

              When  using  this option in conjunction with rsync, keep in mind that <u>logfile</u> is zeroed out before
              being written into. This means that unless there is  at  least  one  completely  successful  rsync
              operation  for  each rsyncrypto invocation, it is possible to have files that have been changed on
              disk by a previous invocation of rsyncrypto, but were over written by a later  invocation  and  do
              not  show up in the latest version of <u>logfile</u>. In other words, if rsyncrypto is run more than once
              between two completely successful invocations of rsync, it is  possible  for  <u>logfile</u>  not  to  be
              complete. <b>Use</b> <b>this</b> <b>option</b> <b>at</b> <b>your</b> <b>own</b> <b>risk!</b>

              It  is  highly  recommended that you upgrade to rsync version 3 or higher rather than rely on this
              option.

       <b>-n</b>, <b>--name-encrypt=</b><u>translation_file</u>
              Encrypt the file name. If this option is specified, this means that file names  are  encrypted  as
              well.  This  is  done by changing the name of the encrypted file to a random string of characters,
              and storing the translation in the file given as parameter.  If working in  recursive  mode,  this
              file is automatically also included in the encryption, and is given the fixed name "filemap". This
              is done so that decryption of the file names is possible when the symmetric keys are lost.

       <b>--ne-nesting=</b><u>num</u>
              When  the  <b>--name-encrypt</b> option is used, by default all mangled file names are stored in a single
              directory. When encrypting large directory trees, this can result in rather big directories. Using
              "<b>--ne-nesting</b>" will split the files to sub directories, according to random bits that are part  of
              the encrypted file name. "<u>num</u>" is the number of directories to nest.

       <b>--trim=</b><u>num</u>
              Determine  how  many  directory levels to trim from the beginning of the <u>srcdir</u> path when creating
              directories under <u>dstdir</u>. The default value is 1. See <b>THE</b> <b>TRIM</b> <b>OPTION</b> for more details.

       <b>--delete</b>
              When in recursive mode, delete files and directories under <u>dstdir</u> that do not exist under <u>srcdir</u>.

       <b>--delete-keys</b>
              When deleting files, also delete their symmetric key and file name mapping (if  applicable).  When
              only  <b>--delete</b>  is  used,  the  symmetric  key  and  file mapping are kept, so that if the file is
              recreated, it will be rsyncable with the original file. This option implies <b>--delete</b>.

       <b>-b</b><u>num</u> <b>--keybits=</b><u>num</u>
              Specify the block cipher's key size. For AES, these can be 128, 192 or 256.  Note that unless  the
              <u>--fr</u> or <u>--fk</u> options are also specified, this will only affect files for which no <u>keyfile</u> exists.

       <b>--noatime=</b><u>num</u>
              (Only  on some platforms, most notably Linux). The platform usually keeps track of when files were
              last being accessed. Since <b>rsyncrypto</b> is typically used for backup, it opens the files it encrypts
              with the <b>O_NOATIME</b> option, which is a Linux specific extension that tells the system not to update
              the file's access time. When opening a file where the opening process is not  owned  by  the  file
              owner,  an  attempt  to  open the file with O_NOATIME will cause the open to fail with "permission
              denied".

              <u>num</u> can be one of these options: <b>0</b> means do not use <b>O_NOATIME</b>  at  all.   <b>1</b>  (the  default)  means
              attempt to only use <b>O_NOATIME</b> if <b>rsyncrypto</b> thinks it will not cause a permission denied error.  <b>2</b>
              means to use <b>O_NOATIME</b> always.

       <b>--no-archive-mode</b>
              Do not try to preserve timestamps. This option is incompatible with <b>-c</b>.

       <b>--gzip=</b><u>path</u>
              By default, <b>rsyncrypto</b> will compress the plain text prior to encrypting it. In order not to become
              rsync  unfriendly  due  to  the  compression,  <b>rsyncrypto</b>  will search the path for an instance of
              <b><a href="../man1/gzip.1.html">gzip</a></b>(1) that supports the <b>--rsyncable</b> option. If the system's default gzip does not  support  this
              option  (all  Debian and derivatives, as well as some others, support it), use this option to tell
              <b>rsyncrypto</b> to use a different instance of gzip. The tests directory of rsyncrypto's source  has  a
              file called "gzip", that does NULL compression by redirecting the input and output to <b><a href="../man1/cat.1.html">cat</a></b>(1).

       <b>--roll-win=</b><u>num</u><b>,</b> <b>--roll-min=</b><u>num</u><b>,</b> <b>--roll-sensitivity=</b><u>num</u>
              Affects the rolling block algorithm. See <b>NOTES</b>.

       <b>--fk</b>, <b>--fr</b>
              If  command  line, or a version with different defaults, dictate different values for the <b>--roll-*</b>
              options or the <b>-b</b> option, these will only affect files for  which  <u>keyfile</u>  does  not  yet  exist.
              specifying  the  <b>--fk</b>  or  <b>--fr</b> will recreate <u>keyfile</u> if it has values different than those in the
              previous key file.

       <b>-v</b>, <b>--verbose</b>
              Increase verbosity level. Specify several times to be more verbose.

</pre><h4><b>NOTES</b></h4><pre>
       <b>encrypting</b> <b>stdin</b>

       If <u>srcfile</u> is given as `-', the plain text data will be read from stdin.  This  does  not  yet  work  for
       decompression (see <b>BUGS</b>).

       <b>--roll-win=</b><u>num</u><b>,</b> <b>--roll-min=</b><u>num</u><b>,</b> <b>--roll-sensitivity=</b><u>num</u>

       These  values  affect  some  of the inner workings of <b>rsyncrypto</b>'s decision making.  In particular, these
       affect how <b>rsyncrypto</b> decides when to revert to the IV.

       These options should not be played with unless you understand what you are doing. They are not dangerous,
       in that they will never cause data loss. Any value should still allow decryption of  the  file.  They  do
       have an affect on <b>rsync</b>'s efficiency.

       These  options  are  only  there  to  allow  quick response in case a security problem pops up with their
       default values. If that happens, an advisory may come out giving new values to fill in as  a  workaround.
       Until that happens, most users are advised to leave these options alone.

</pre><h4><b>THE</b> <b>TRIM</b> <b>OPTION</b></h4><pre>
       When  running  <b>rsyncrypto</b>  in  recursive  mode,  the directory structure under <u>srcdir</u> is re-created under
       <u>dstdir</u>, with one directory stripped from the path. In other words, if we have a directory structure which
       has:

       a/b/c/file

       running <b>rsyncrypto</b> with <u>srcdir</u> of "a/b", and <u>dstdir</u> of "f" will create "f/b/c/file".

       The <b>--trim</b> options lets the user say how many parts to trim from <u>srcdir</u> when creating  directories  under
       <u>dstdir</u>  and  <u>keydir</u>.  If,  in  the  above  example,  we said <b>--trim</b>=0 then "f/a/b/c/file" would have been
       created. Likewise, if we said <b>--trim</b>=2 then "f/c/file" would have been created.

       It is an error to give a trim value which is higher than  the  number  of  directory  parts  actually  in
       <u>srcdir</u>. In the above example, <b>--trim</b>=3 would result in an error.

</pre><h4><b>SECURITY</b></h4><pre>
       The  roll  values  affect,  to a not totally known degree, how much information is "leaked" between plain
       text and cipher text. The default values are supposed to leak less than 20 bits of aggregated information
       about the plain text file for every 8KB, in the worst case. These values, we  hope,  will  be  considered
       secure  enough  for  most  usages. However, if your country's fate is at stake, use a non-rsync optimized
       encryption, such as the one provided by <b><a href="../man1/openssl.1.html">openssl</a></b>(1).

</pre><h4><b>EXAMPLES</b> <b>AND</b> <b>TUTORIAL</b></h4><pre>
       Before starting to use rsyncrypto you will need a public key in X509 certificate format. The quickest way
       to generate one of these is using the <a href="../man1/openssl.1.html">openssl</a>(1)  package.  To  generate  a  new  1536  bit  RSA  key  as
       "backup.key",  and  store  the  corresponding  unencrypted  public key in "backup.crt", use the following
       command:

              openssl req -nodes -newkey rsa:1536 -x509 -keyout backup.key -out backup.crt

       It does not matter what you answer for the certificate details, or when you set it to expire.  Rsyncrypto
       ignores everything in the certificate but the actual key.

       To encrypt file "data" into "data.enc", storing the file's specific key at "data.key", run:

              rsyncrypto data data.enc data.key backup.crt

       Anywhere  in  these examples that "backup.crt" is used, "backup.key" can be used as well. The above could
       also have "backup.key" as the last argument. If these examples list "backup.key"  specifically,  then  it
       means that "backup.crt" <b>cannot</b> be used instead.

       "data.enc"  will  be created. If "data.key" exists from a previous run, then the newly created "data.enc"
       will have the same symmetric key and other attributes, thus maintaining the  rsync  friendliness  of  the
       encryption. It is therefor important to provide any previous key file for the data if one is available.

       The  command  line  to  decrypt  the file depends on whether you have the key file used when the file was
       encrypted. If you do, then decryption can take place using  only  the  public  key,  with  the  following
       command:

              rsyncrypto -d data.enc data.dec data.key backup.crt

       If  the  key  file was lost, the private key must be used to recover it from the encrypted file using the
       following command:

              rsyncrypto -d data.enc data.dec data.key backup.key

       "data.key" will be created by the above command, as well as "data.dec".

       Use of rsyncrypto to encrypt whole directories is similar, with directory names replacing file  names  in
       the  above  example.  To  encrypt  the  content of a directory called "data" to a directory called "enc",
       storing the symmetric keys in a directory called "keys", run the following command:

              rsyncrypto -r data enc keys backup.crt

       As before the directories "enc" and "keys" will be created if they do not already  exist.  The  directory
       structure  under  "plain"  will  be  duplicated under "enc" and under "keys". That is, if there is a file
       called "foo" under "data", an encrypted files called "foo" will be created under "enc", and  a  key  file
       named  "foo"  will be created under "keys". In other words, the first part of the path to "data/foo" (the
       part that says "data") is eliminated from the path, and this determines the name of the files under "enc"
       and "keys".

       If a different trimming  is  required,  the  --trim  option  can  be  used.  To  have  rsyncrypto  create
       "enc/data/foo" instead of the above, use the following command:

              rsyncrypto -r --trim=0 data enc keys backup.crt

       Instead  of  taking all files from a single directory, it is possible to supply rsyncrypto with a list of
       files and directories which to encrypt. This is done using the --filelist option, like so:

              rsyncrypto --filelist --trim=0 list enc keys backup.crt

       "enc" and "keys" retain the same meaning as before. "list" is a text file with a list, one per  line,  of
       files  to  encrypt.  The  --trim=0  option says that if list contains a line saying "/home/foo/bar" which
       states the name of a file, then an encrypted file called "enc/home/foo/bar" will be created. Without  it,
       the file will be called "enc/foo/bar". Likewise, with --trim=2, the file would be created as "enc/bar".

       It  is  often a problem that the file names are not encrypted. If that is the case, we can ask rsyncrypto
       to encrypt the file names, as well as the actual files. Rsyncrypto does not  actually  encrypt  the  file
       names.  Instead, it replaces the actual file name with a random series of characters. The mapping between
       the actual file name and the garbled name is stored in a mapping file.

              rsyncrypto --name-encrypt=map --trim=0 -r plain enc keys backup.crt

       This will encrypt the "plain" directory structure into enc, exactly as before.  Unlike before, all  files
       will  be  directly  under  the  "enc" directory, and will be named as a meaningless garble. A file called
       "map" will be created under the current directory that contains a map between the  gabled  and  the  real
       name  of the file. In addition, two files, called "enc/filemap" and "keys/filemap", will also be created.
       These are the encrypted and key file corresponding to the "map" file mentioned above. During  decryption,
       if "map" does not exist, it will be created by decrypting "enc/filemap".

       <b>Important</b>  <b>note:</b> When performing file name encryption, it is vitally important to give the correct --trim
       values, both during encryption and during decryption. Failing to do so will cause  rsyncrypto  to  search
       for non-existing file names, and to fail to locate the files to decrypt.

</pre><h4><b>BUGS</b></h4><pre>
       It is not yet possible to decrypt using password protected private key.

       Decrypting from stdin is not yet supported.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/rsync.1.html">rsync</a></b>(1), <b><a href="../man1/gzip.1.html">gzip</a></b>(1), <b><a href="../man1/openssl.1.html">openssl</a></b>(1), <b><a href="../man1/x509.1.html">x509</a></b>(1), <b><a href="../man1/req.1.html">req</a></b>(1).

</pre><h4><b>AUTHOR</b></h4><pre>
       rsyncrypto was written by Shachar Shemesh for Lingnu Open Source Consulting ltd.  <a href="http://www.lingnu.com">http://www.lingnu.com</a>

       This manual page was written by Shachar Shemesh &lt;<a href="mailto:shachar@debian.org">shachar@debian.org</a>&gt;

</pre><h4><b>PROJECT</b> <b>HOMEPAGE</b></h4><pre>
       <a href="http://rsyncrypto.lingnu.com">http://rsyncrypto.lingnu.com</a>

Lingnu Open Source Consulting                   October 22, 2008                                   <u><a href="../man1/RSYNCRYPTO.1.html">RSYNCRYPTO</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>