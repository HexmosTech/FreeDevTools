<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>depthchargectl - Manage the ChromeOS bootloader and its boot images</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/depthcharge-tools">depthcharge-tools_0.6.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       depthchargectl - Manage the ChromeOS bootloader and its boot images

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>depthchargectl</b> [options] <u>COMMAND</u> ...

       <b>depthchargectl</b> <b>bless</b> [options] [<u>PARTITION</u> | <u>DISK</u>]

       <b>depthchargectl</b> <b>build</b> [options] [<u>KERNEL_VERSION</u>]

       <b>depthchargectl</b> <b>check</b> [options] <u>IMAGE</u>

       <b>depthchargectl</b> <b>config</b> [options] <u>KEY</u>

       <b>depthchargectl</b> <b>list</b> [options] [<u>DISK</u> ...]

       <b>depthchargectl</b> <b>remove</b> [options] (<u>KERNEL_VERSION</u> | <u>IMAGE</u>)

       <b>depthchargectl</b> <b>target</b> [options] [<u>PARTITION</u> | <u>DISK</u> ...]

       <b>depthchargectl</b> <b>write</b> [options] [<u>KERNEL_VERSION</u> | <u>IMAGE</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>depthchargectl</b> automatically manages the ChromeOS bootloader by building images for the current board and
       system,   writing   them  to  appropriate  ChromeOS  kernel  partitions,  prioritizing  those  partitions
       accordingly, and setting them as successful on  boot.  When  you  have  more  than  one  ChromeOS  kernel
       partition,  they will be utilized in rotation so that an unsuccessful boot attempt can revert to the last
       good version.

       The <u>KERNEL_VERSION</u> argument is a distro-specific representation of a kernel and  usually  is  the  latter
       part of <b>/boot/vmlinuz-</b><u>VERSION</u>.  The <u>IMAGE</u> argument is a boot image for the ChromeOS bootloader, or a file
       suspected  to be one. <u>DISK</u> should be a physical disk containing a GPT partition table (e.g. <b>/dev/mmcblk0</b>,
       <b>/dev/sda</b>), but virtual disks (e.g. <b>/dev/dm-0</b>) are resolved to such physical disks if possible.  <u>PARTITION</u>
       must  be  one  of  partition  devices  of  a  physical disk (e.g <b>/dev/mmcblk0p1</b>, <b>/dev/sda2</b>). The <u>vmlinuz</u>,
       <u>initramfs</u> and <u>dtb</u> files are as explained in <u><a href="../man1/mkdepthcharge.1.html">mkdepthcharge</a></u>(1).

       The program's functionality is divided into subcommands:

   <b>depthchargectl</b> <b>bless</b>
       Sets bootloader-specific flags for a given partition or the currently booted partition as  detected  from
       the <b>kern_guid=</b><u>PARTUUID</u> parameter <u><a href="../man1/mkdepthcharge.1.html">mkdepthcharge</a></u>(1) adds to the kernel command line. By default, this marks
       the partition as successfully booted and the most preferred one, but can disable the partition or make it
       boot only on the next attempt as well.

   <b>depthchargectl</b> <b>build</b>
       Builds  a  bootable  image  from the running system for this board, using the latest or a specific kernel
       version. <b>depthchargectl</b> keeps a database of known ChromeOS boards and how to build  bootable  images  for
       them. For example, it keeps track of which device-tree file that needs to be included for each ARM board.
       It  also  figures  out  distro-specific  information  of  where  the <u>vmlinuz</u>, <u>initramfs</u> and <u>dtb</u> files are
       located. It uses this information and <u><a href="../man1/mkdepthcharge.1.html">mkdepthcharge</a></u>(1) to build this image.

       It automatically adds an appropriate <b>root=</b><u>ROOT</u> kernel command line  parameter  deduced  from  <b><a href="file:/etc/fstab">/etc/fstab</a></b>.
       Higher compression levels for the kernel are automatically tried as necessary, when the firmware supports
       them.

   <b>depthchargectl</b> <b>config</b>
       Retrieves the configured value for a given configuration key, primarily for use in scripts that integrate
       <b>depthchargectl</b> with the system upgrade process. Can also query information about boards.

   <b>depthchargectl</b> <b>check</b>
       Checks if a file is a depthcharge image that can be booted on this board. <b>depthchargectl</b> also keeps track
       of  restrictions  on  images  for each board. For example, earlier ChromeOS board can boot images up to a
       specific size, e.g. 32MiB. It checks if its input is in a format  the  ChromeOS  bootloader  expects  and
       satisfies these restrictions.

   <b>depthchargectl</b> <b>list</b>
       Prints  a  table  of ChromeOS kernel partitions and their bootloader specific GPT flags (i.e. Successful,
       Priority, Tries). By default, it only searches the physical disks on which the boot and  root  partitions
       reside.

   <b>depthchargectl</b> <b>remove</b>
       Disables  partitions that contain a specific image or a specific kernel version. This is most useful when
       you are removing a kernel version and its modules from your system,  and  know  images  built  with  this
       kernel will fail to boot from that point on.

   <b>depthchargectl</b> <b>target</b>
       Chooses and prints the lowest priority, preferably unsuccessful ChromeOS kernel partition to write a boot
       image  to. By default, searches the same disks as the <b>list</b> subcommand. If a partition is given, it checks
       if it is an appropriate for a boot image. Tries to avoid the currently booted kernel.

   <b>depthchargectl</b> <b>write</b>
       Writes a specific image or builds and writes a <u>kernel-version</u> image to a partition the <b>target</b>  subcommand
       returns,  and  marks  it  as  bootable  once  on  the next boot. The <b>bless</b> subcommand must be run after a
       successful boot to make the partiiton permanently bootable, but that is possible to do automatically with
       the service files provided with this package.

</pre><h4><b>OPTIONS</b></h4><pre>
   <b>Global</b> <b>options</b>
       <b>-h</b>, <b>--help</b>
              Show a help message and exit.

       <b>-v</b>, <b>--verbose</b>
              Print info messages and <u><a href="../man1/mkdepthcharge.1.html">mkdepthcharge</a></u>(1) output to stderr.

       <b>-V</b>, <b>--version</b>
              Print program version and exit.

       <b>--root</b> <u>ROOT</u>
              Root device or mountpoint of the system to work on. If a mounted device is given,  its  mountpoint
              is used. Defaults to the currently booted system's root.

       <b>--root-mountpoint</b> <u>DIR</u>, <b>--boot-mountpoint</b> <u>DIR</u>
              Root  and  boot  mountpoints  of  the  system  to  work  on. If not given, deduced from the <b>--root</b>
              argument. These are helpful because the <b>--root</b> argument is overloaded  by  the  <b>build</b>  subcommand,
              which  adds  it  as  a  kernel  command line argument, and it can be desirable to avoid that while
              building an image for a chroot.

       <b>--tmpdir</b> <u>DIR</u>
              Directory to keep temporary files. Normally <b>depthchargectl</b> creates a temporary directory by itself
              and removes it when it quits. However, if a temporary directory is specified with this option  any
              temporary files will be created under it and will not be deleted.

   <b>Configuration</b> <b>options</b>
       In  addition  to  its  built-in  configuration,  <b>depthchargectl</b>  reads  <b>/etc/depthcharge-tools/config</b> and
       <b>/etc/depthcharge-tools/config.d</b>/<u>*</u> as configuration files to make it adaptable  to  different  boards  and
       systems. The following options allow this configuration to be overridden temporarily.

       <b>--config</b> <u>FILE</u>
              Additional  configuration  file  to read. This can include changing board properties or adding new
              boards, which mostly isn't possible to do with command-line options.

       <b>--board</b> <u>CODENAME</u>
              Assume <b>depthchargectl</b> is running on the specified board. Normally it tries to detect  which  board
              it's running on primarily based on the HWID of the board set by the vendor, among other things.

       <b>--images-dir</b> <u>DIR</u>
              Directory to store and look for built depthcharge images. By default, set to <b>/boot/depthcharge</b>.

       <b>--vboot-keyblock</b> <u>KEYBLOCK</u>
              The  kernel  keyblock file required to sign and verify images. By default, <b>depthchargectl</b> searches
              for these keys in <b>/etc/depthcharge-tools</b> and <b>/usr/share/vboot/devkeys</b> directories.

       <b>--vboot-public-key</b> <u>SIGNPUBKEY</u>
              The public key required to verify images, in .vbpubk format. By default,  <b>depthchargectl</b>  searches
              for these keys in <b>/etc/depthcharge-tools</b> and <b>/usr/share/vboot/devkeys</b> directories.

       <b>--vboot-private-key</b> <u>SIGNPRIVATE</u>
              The  private key necessary to sign images, in .vbprivk format. By default, <b>depthchargectl</b> searches
              for these keys in <b>/etc/depthcharge-tools</b> and <b>/usr/share/vboot/devkeys</b> directories.

       <b>--kernel-cmdline</b> <u>CMD</u> <b>[</b><u>CMD</u> <b>...]</b>
              Command-line parameters for the kernel. By  default,  these  are  read  from  <b>/etc/kernel/cmdline</b>,
              <b>/usr/lib/kernel/cmdline</b>  or  <b><a href="file:/proc/cmdline">/proc/cmdline</a></b>.   <b>depthchargectl</b>  and <u><a href="../man1/mkdepthcharge.1.html">mkdepthcharge</a></u>(1) may append some
              other values to this: an appropriate <b>root=</b><u>ROOT</u>, the <b>kern_guid=%U</b> parameter required for the  <b>bless</b>
              subcommand, <b>noinitrd</b> if <b>--ignore-initramfs</b> is given.

       <b>--ignore-initramfs</b>
              Do  not  include  <u>initramfs</u>  in  the  built  images, ignore the initramfs checks for the <b>root=</b><u>ROOT</u>
              argument, and add <b>noinitrd</b> to the kernel cmdline. If you know that your OS kernel can boot on this
              board without an initramfs (perhaps because it has a built-in one), you can specify this option to
              build an initramfs-less image.

       <b>--zimage-initramfs-hack</b>
              Choose which initramfs support hack will be used for the zimage format. Either <b>set-init-size</b>  (the
              default),  <b>pad-vmlinuz</b>  for kernels without <b>KASLR</b>, or <b>none</b> if depthcharge ever gets native support
              for safely loading zimage initramfs.

   <b>depthchargectl</b> <b>bless</b> <b>options</b>
       <b>--bad</b>  Set the specified partition as unbootable. This sets all three of the <u>Successful</u>, <u>Priority</u>,  <u>Tries</u>
              flags to 0.

       <b>--oneshot</b>
              Set the specified partition to be tried once in the next boot. This sets the <u>Successful</u> flag to 0,
              <u>Tries</u>  flag  to 1, and makes sure the <u>Priority</u> flag is the highest one among all the partitions of
              the disk the specified one is in.

       <b>-i</b> <u>NUM</u>, <b>--partno</b> <u>NUM</u>
              Partition number in the given disk image, for when the positional argument is a disk image instead
              of a partition block device.

   <b>depthchargectl</b> <b>build</b> <b>options</b>
       <b>--description</b> <u>DESC</u>
              Human-readable description for the image. By default, a string that describes your system with the
              specified kernel release name, like "Debian GNU/Linux, with Linux 5.10.0-6-arm64".

       <b>--root</b> <u>ROOT</u>
              Root device to add to kernel cmdline. By default, this is acquired from <b><a href="file:/etc/fstab">/etc/fstab</a></b> or a filesystem
              UUID is derived from the mounted root. If <b>none</b> is passed, no root parameter is added.

       <b>--compress</b> <u>TYPE</u> <b>[</b><u>TYPE</u> <b>...]</b>
              Compression types to attempt. By default, all compression types that the board supports  based  on
              <b>depthchargectl</b> configuration are attempted from lowest to highest compression.

       <b>--timestamp</b> <u>SECONDS</u>
              Build  timestamp  for  the  image.  By default, <b>SOURCE_DATE_EPOCH</b> is used if it's set. If not, the
              modification date of either the <u>initramfs</u> or <u>vmlinuz</u> is used as an attempt to keep images somewhat
              reproducible.

       <b>-o</b> <u>PATH</u>, <b>--output</b> <u>PATH</u>
              Output image to path instead of storing it in the images-dir.

       The following options allow one to specify the exact files to be used in building the image,  instead  of
       letting <b>depthchargectl</b> deduce them:

       <b>--kernel-release</b> <u>NAME</u>
              Release  name for the kernel to be used in image filename under the images-dir (unless <b>--output</b> is
              specified).

       <b>--kernel</b> <u>FILE</u>
              Kernel executable. Usually <b>/boot/vmlinuz-</b><u>VERSION</u> by default, but depends on your OS.

       <b>--initramfs</b> <u>FILE</u> <b>[</b><u>FILE</u> <b>...]</b>
              Ramdisk image. Usually <b>/boot/initrd.img-</b><u>VERSION</u> by default, but depends on your  OS.  If  <b>none</b>  is
              passed, no initramfs is added.

       <b>--fdtdir</b> <u>DIR</u>
              Directory  to  search  device-tree  binaries for the board. Usually <b>/boot/dtbs</b> or a directory like
              <b>/usr/lib/linux-image-</b><u>VERSION</u>, depends on your OS. <u>dtb</u> files in this dir are searched to find  ones
              matching your board's device-tree compatible string set in configuration.

       <b>--dtbs</b> <u>FILE</u> <b>[</b><u>FILE</u> <b>...]</b>
              Device-tree binary files to use instead of searching <u>fdtdir</u>.

   <b>depthchargectl</b> <b>config</b> <b>options</b>
       <b>--section</b> <u>SECTION</u>
              Config  section  to  retrieve  configured  values  from.  By default, this is the globally default
              section: <b>depthcharge-tools</b>.

       <b>--default</b> <u>DEFAULT</u>
              A default value to return if the given config key doesn't exist in the given config section. If  a
              default  value is not given, this subcommand prints an error message and exits with nonzero status
              when the key is missing.

   <b>depthchargectl</b> <b>check</b> <b>options</b>
       This subcommand takes no specific options.

   <b>depthchargectl</b> <b>list</b> <b>options</b>
       <b>-a</b>, <b>--all-disks</b>
              List partitions on all disks.

       <b>-c</b>, <b>--count</b>
              Print only the count of partitions.

       <b>-n</b>, <b>--noheadings</b>
              Don't print column headings.

       <b>-o</b> <u>COLUMNS</u>, <b>--output</b> <u>COLUMNS</u>
              Comma separated list of columns to output. Supported columns are <b>ATTRIBUTE</b> (or <b>A</b>), <b>SUCCESSFUL</b>  (or
              <b>S</b>),  <b>TRIES</b>  (or  <b>T</b>),  <b>PRIORITY</b>  (or  <b>P</b>)  for ChromeOS GPT flags, <b>PATH</b> for the partition device (if
              exists), <b>DISKPATH</b> (or <b>DISK</b>) for the  disk  device/image  the  partition  is  in,  <b>PARTNO</b>  for  the
              partition number, and <b>SIZE</b> for the partition size in bytes.

   <b>depthchargectl</b> <b>remove</b> <b>options</b>
       <b>-f</b>, <b>--force</b>
              Allow disabling the currently booted partition.

   <b>depthchargectl</b> <b>target</b> <b>options</b>
       <b>-a</b>, <b>--all-disks</b>
              Consider  all  available  disks,  instead  of  considering only disks containing the root and boot
              partitions.

       <b>--allow-current</b>
              Allow targeting the currently booted partition.

       <b>-s</b> <u>BYTES</u>, <b>--min-size</b> <u>BYTES</u>
              Only consider partitions larger than this size in bytes. Defaults  to  <b>64</b>  <b>KiB</b>  to  ignore  unused
              partitions in ChromeOS installations.

   <b>depthchargectl</b> <b>write</b> <b>options</b>
       <b>--allow-current</b>
              Allow overwriting the currently booted partition.

       <b>-f</b>, <b>--force</b>
              Write image to disk even if it cannot be verified by the <b>check</b> subcommand.

       <b>--no-prioritize</b>
              Don't  modify  ChromeOS  GPT  flags on the partition. Normally, the flags would be set to make the
              system boot from the newly written partition on the next boot.

       <b>-t</b> <u>DEVICE</u>, <b>--target</b> <u>DEVICE</u>
              Specify a disk or partition device to write to. This device is passed to the <b>target</b> subcommand  to
              determine where exactly to write to.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       In  general,  exits  with zero on success and non-zero on failure. Some subcommands return more specified
       exit statuses:

   <b>depthchargectl</b> <b>build</b> <b>exit</b> <b>status</b>
       <b>0</b>      Image built and stored successfully.

       <b>1</b>      An error occurred before or during building the image.

       <b>3</b>      Can build an image with an <u>initramfs</u>, but it is too  big  for  the  board  despite  using  maximum
              allowed kernel compression. This might be solvable by reducing the <u>initramfs</u> size.

       <b>4</b>      Like  <b>3</b>,  but  without  an <u>initramfs</u> or reducing the <u>initramfs</u> size wouldn't make things fit. This
              might be solvable by reducing the <u>vmlinuz</u> size, perhaps by building a custom kernel.

   <b>depthchargectl</b> <b>check</b> <b>exit</b> <b>status</b>
       <b>0</b>      The <u>image</u> passes all checks.

       <b>1</b>      Errors unrelated to image checks.

       <b>2</b>      The <u>image</u> isn't a readable file.

       <b>3</b>      Size of the <u>image</u> is too big for the board.

       <b>4</b>      The <u>image</u> cannot be interpreted by <u><a href="../man1/vbutil_kernel.1.html">vbutil_kernel</a></u>(1).

       <b>5</b>      The <u>image</u> fails the <u><a href="../man1/vbutil_kernel.1.html">vbutil_kernel</a></u>(1) signature checks.

       <b>6</b>      The <u>image</u> is built with a wrong format for the board.

       <b>7</b>      The <u>image</u> is missing device-tree files compatible with the board.

   <b>depthchargectl</b> <b>target</b> <b>exit</b> <b>status</b>
       <b>0</b>      A usable <u>partition</u> is given, or a usable partition was chosen from <u>disk</u>s. The partition passes the
              checks and is printed to output.

       <b>1</b>      Errors unrelated to partition checks.

       <b>2</b>      The <u>partition</u> is not a writable block device.

       <b>3</b>      The disk containing the <u>partition</u> is not a writable block device.

       <b>4</b>      Cannot parse a partition number from the <u>partition</u>.

       <b>5</b>      The <u>partition</u> is not a ChromeOS kernel partition.

       <b>6</b>      The <u>partition</u> is the currently booted partition.

       <b>7</b>      The <u>partition</u> is smaller than the <b>--min-size</b> argument.

</pre><h4><b>FILES</b></h4><pre>
       <b>/etc/depthcharge-tools</b>
              Configuration directory. <b>depthchargectl</b>  searches  this  directory  for  configuration  files  and
              ChromiumOS verified boot keys.

       <b>/etc/depthcharge-tools/config</b>
              System  configuration  file.  The  "Configuration options" explained above can be set here to have
              them as long-term defaults. It's also possible to modify board properties or add new boards here.

       <b>/etc/depthcharge-tools/config.d/</b><u>*</u>
              These files are considered appended to the <b>config</b> file.

       <b>/etc/kernel/cmdline,</b> <b>/usr/lib/kernel/cmdline,</b> <b><a href="file:/proc/cmdline">/proc/cmdline</a></b>
              Files from which <b>depthchargectl</b> may deduce a default kernel command line.

       <b>/usr/lib/systemd/system/depthchargectl-bless.service</b>
              A systemd service that runs <b>depthchargectl</b> <b>bless</b> on successful boots.

       <b>/usr/lib/kernel/install.d/90-depthcharge-tools.install</b>
              A   systemd   kernel-install   plugin   that   can   automatically   manage   your    system    if
              <b>layout=depthcharge-tools</b> is set in <b>/etc/kernel/install.conf</b>.

       <b>/etc/init.d/depthchargectl-bless</b>
              An init service that runs <b>depthchargectl</b> <b>bless</b> on successful boots.

       <b>/usr/share/vboot/devkeys</b>
              A   directory  containing  test  keys  which  should  have  been  installed  by  <u><a href="../man1/vbutil_kernel.1.html">vbutil_kernel</a></u>(1).
              <b>depthchargectl</b> also searches this directory if no verified boot keys are set in  configuration  or
              found in config directories.

       <b>/boot/depthcharge/</b><u>*</u><b>.img</b>
              The most recently built images for each kernel version.

</pre><h4><b>EXAMPLES</b></h4><pre>
       <b>depthchargectl</b> <b>list</b> <b>-n</b> <b>-o</b> <u>PATH</u>
              Get a list of partitions <b>depthchargectl</b> will act on by default.

       <b>depthchargectl</b> <b>build</b> <b>--board</b> <u>kevin</u> <b>--root</b> <u><a href="file:/mnt">/mnt</a></u> <b>--output</b> <u>depthcharge.img</u>
              Build  an  image  for the Samsung Chromebook Plus (v1), using files from and intended to boot with
              the chroot system mounted at <u><a href="file:/mnt">/mnt</a></u>.

       <b>depthchargectl</b> <b>config</b> <u>board</u>
              Print the board codename for the detected board.

       <b>depthchargectl</b> <b>config</b> <b>--default</b> <u>False</u> <u>enable-system-hooks</u>
              Print the <u>enable-system-hooks</u> config if it's set, <u>False</u> if not.  This specific config key is meant
              to be a common mechanism which distro packagers can use to let users disable system upgrade  hooks
              that use depthchargectl.

       <b>depthchargectl</b> <b>write</b> <b>--allow-current</b>
              Build,  check  and  write  an  image  for  the  latest <u>kernel-version</u> of this system to disk while
              allowing overwriting the currently booted partiiton. You might use this if you only have a  single
              ChromeOS kernel partition, but broken kernels might make your system unbootable.

       <b>depthchargectl</b> <b>write</b> <u>vmlinux.kpart</u> <b>-t</b> <u>/dev/mmcblk1p1</u>
              Write  the  <b>vmlinux.kpart</b>  file  to  <b>/dev/mmcblk1p1</b>,  only if both the image and the partition are
              valid. Something of this form would be used for writing images to a secondary or external disk.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/mkdepthcharge.1.html">mkdepthcharge</a></u>(1), <u><a href="../man1/cgpt.1.html">cgpt</a></u>(1), <u><a href="../man1/vbutil_kernel.1.html">vbutil_kernel</a></u>(1)

v0.6.2                                             2023-06-30                                  <u><a href="../man1/DEPTHCHARGECTL.1.html">DEPTHCHARGECTL</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>