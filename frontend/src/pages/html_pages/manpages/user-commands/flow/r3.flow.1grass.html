<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>r3.flow  - Computes 3D flow lines and 3D flow accumulation.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/grass-doc">grass-doc_8.4.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>r3.flow</b>  - Computes 3D flow lines and 3D flow accumulation.

</pre><h4><b>KEYWORDS</b></h4><pre>
       raster3d, hydrology, voxel

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>r3.flow</b>
       <b>r3.flow</b> <b>--help</b>
       <b>r3.flow</b>   [-<b>a</b>]    [<b>input</b>=<u>name</u>]    [<b>vector_field</b>=<u>name</u>[,<u>name</u>,...]]    [<b>seed_points</b>=<u>name</u>]    [<b>flowline</b>=<u>name</u>]
       [<b>flowaccumulation</b>=<u>name</u>]       [<b>sampled</b>=<u>name</u>]       [<b>unit</b>=<u>string</u>]       [<b>step</b>=<u>float</u>]       [<b>limit</b>=<u>integer</u>]
       [<b>max_error</b>=<u>float</u>]      [<b>skip</b>=<u>integer</u>[,<u>integer</u>,...]]      [<b>direction</b>=<u>string</u>]     [--<b>overwrite</b>]    [--<b>help</b>]
       [--<b>verbose</b>]  [--<b>quiet</b>]  [--<b>ui</b>]

   <b>Flags:</b>
       <b>-a</b>
           Create and fill attribute table

       <b>--overwrite</b>
           Allow output files to overwrite existing files

       <b>--help</b>
           Print usage summary

       <b>--verbose</b>
           Verbose module output

       <b>--quiet</b>
           Quiet module output

       <b>--ui</b>
           Force launching GUI dialog

   <b>Parameters:</b>
       <b>input</b>=<u>name</u>
           Name of input 3D raster map

       <b>vector_field</b>=<u>name[,name</u>,...]
           Names of three 3D raster maps describing x, y, z components of vector field

       <b>seed_points</b>=<u>name</u>
           Name of vector map with points from which flow lines are generated
           If no map is provided, flow lines are generated from each cell of the input 3D raster

       <b>flowline</b>=<u>name</u>
           Name for vector map of flow lines

       <b>flowaccumulation</b>=<u>name</u>
           Name for output flowaccumulation 3D raster

       <b>sampled</b>=<u>name</u>
           Name for 3D raster sampled by flowlines
           Values of this 3D raster will be stored as attributes of flowlines segments

       <b>unit</b>=<u>string</u>
           Unit of integration step
           Default unit is cell
           Options: <u>time,</u> <u>length,</u> <u>cell</u>
           Default: <u>cell</u>
           <b>time</b>: elapsed time
           <b>length</b>: length in map units
           <b>cell</b>: length in cells (voxels)

       <b>step</b>=<u>float</u>
           Integration step in selected unit
           Default step is 0.25 cell
           Default: <u>0.25</u>

       <b>limit</b>=<u>integer</u>
           Maximum number of steps
           Default: <u>2000</u>

       <b>max_error</b>=<u>float</u>
           Maximum error of integration
           Influences step, increase maximum error to allow bigger steps
           Default: <u>1e-5</u>

       <b>skip</b>=<u>integer[,integer</u>,...]
           Number of cells between flow lines in x, y and z direction

       <b>direction</b>=<u>string</u>
           Compute flowlines upstream, downstream or in both direction.
           Options: <u>up,</u> <u>down,</u> <u>both</u>
           Default: <u>down</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Module <u>r3.flow</u> computes 3D flow lines and 3D flow accumulation.  It accepts either three 3D  raster  maps
       representing  the vector field or one 3D raster map.  In case of one map, it computes on-the-fly gradient
       field.

   <b>Flow</b> <b>lines</b>
       Flow lines are computed either from points (seeds) provided in <b>seed_points</b> vector map, or if there are no
       seeds, it creates seeds in a regular grid in the center of voxels (3D raster cells).  Parameter <b>skip</b> then
       controls the step between the regularly distributed seeds.  If skip  is  not  provided,  r3.flow  decides
       optimal  skip  for each dimension based on current 3D region as one tenth of the number of columns, rows,
       and depths.  Flow lines can be computed in upstream direction (in the direction  of  gradient  or  vector
       field), in downstream direction or in both directions.

   <b>Flow</b> <b>accumulation</b>
       Flow  accumulation  is  computed as the number of flow lines traversing each voxel.  Since the flow lines
       are computed for each voxel, the flow accumulation computation can be  more  demanding.   Parameter  skip
       does not influence the flow accumulation computation, parameter direction does.

   <b>Flow</b> <b>line</b> <b>integration</b>
       Flow line integration can be influenced by several parameters.  Option <b>step</b> controls the integration step
       and  influences the precision and computational time.  The unit of step can be defined either in terms of
       the size of the voxel (3D raster cell), length in map units, or as elapsed time.  Option <b>limit</b>  specifies
       the maximum number of steps of each flow line.

   <b>Attributes</b>
       Without  using flag <b>a</b>, no attribute table is created and each flow line is represented by one vector line
       with one category. With <b>a</b> flag, an attribute table is created and each category (record)  represents  one
       segment  of  a flowline, so that attributes specific for segments can be written. In case of <b>vector_field</b>
       input, only velocity is written, in case of <b>input</b> option, also values of the input 3D raster are written.
       Option <b>sampled</b> allows sampling (query) given 3D raster by flow lines (computed from different 3D  raster)
       and  write  the values of the given 3D raster as attributes of the flow line segments.  Note that using <b>a</b>
       flag results in longer computation time, so consider increasing <b>step</b> and <b>max_error</b> parameter.

</pre><h4><b>NOTES</b></h4><pre>
       r3.flow uses Runge-Kutta with adaptive step size (Cash-Karp method).

</pre><h4><b>EXAMPLES</b></h4><pre>
       First we create input data using example 1 from r3.gwflow manual page:
       # set the region accordingly
       g.region res=25 res3=25 t=100 b=0 n=1000 s=0 w=0 e=1000 -p3
       # now create the input raster maps for a confined aquifer
       r3.mapcalc expression="phead = if(row() == 1 &amp;&amp; depth() == 4, 50, 40)"
       r3.mapcalc expression="status = if(row() == 1 &amp;&amp; depth() == 4, 2, 1)"
       r3.mapcalc expression="well = if(row() == 20 &amp;&amp; col() == 20 &amp;&amp; depth() == 2, -0.25, 0)"
       r3.mapcalc expression="hydcond = 0.00025"
       r3.mapcalc expression="syield = 0.0001"
       r.mapcalc  expression="recharge = 0.0"
       r3.gwflow solver=cg phead=phead status=status hc_x=hydcond hc_y=hydcond  \
          hc_z=hydcond q=well s=syield r=recharge output=gwresult dt=8640000 vx=vx vy=vy vz=vz budget=budget
       Then we compute flow lines in both directions and downstream flowaccumulation.
       r3.flow vector_field=vx,vy,vz flowline=gw_flowlines skip=5,5,2 direction=both
       r3.flow vector_field=vx,vy,vz flowaccumulation=gw_flowacc
       We can visualize the result in 3D view:

       We can store velocity values (and values of the input 3D raster map if we  use  option  <b>input</b>)  for  each
       segment of flow line in an attribute table.
       r3.flow -a vector_field=vx,vy,vz flowline=gw_flowlines skip=5,5,2 direction=both
       v.colors map=flowlines_color@user1 use=attr column=velocity color=bcyr
       Again,  we  visualize  the  result  in 3D view and we check ’use color for thematic rendering’ on 3D view
       vector page.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
        <u>r.flow,</u> <u>r3.gradient,</u> <u>r3.gwflow</u>

</pre><h4><b>AUTHOR</b></h4><pre>
       Anna Petrasova, NCSU GeoForAll Lab, developed during GSoC 2014.

</pre><h4><b>SOURCE</b> <b>CODE</b></h4><pre>
       Available at: r3.flow source code (history)

       Accessed: Friday Apr 04 01:20:05 2025

       Main index | 3D raster index | Topics index | Keywords index | Graphical index | Full index

       © 2003-2025 GRASS Development Team, GRASS GIS 8.4.1 Reference Manual

GRASS 8.4.1                                                                                      <u><a href="../man1grass/r3.flow.1grass.html">r3.flow</a></u>(1grass)
</pre>
 </div>
</div></section>
</div>
</body>
</html>