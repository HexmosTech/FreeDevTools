<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rrsync - a script to setup restricted rsync users via ssh logins</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/rsync">rsync_3.4.1+ds1-3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       rrsync - a script to setup restricted rsync users via ssh logins

</pre><h4><b>SYNOPSIS</b></h4><pre>
       rrsync [-ro|-wo] [-munge] [-no-del] [-no-lock] [-no-overwrite]  DIR

       The single non-option argument specifies the restricted <u>DIR</u> to use. It can be relative to the user's home
       directory or an absolute path.

       The   online   version  of  this  manpage  (that  includes  cross-linking  of  topics)  is  available  at
       https://download.samba.org/pub/rsync/rrsync.1.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       A user's ssh login can be restricted to only allow the running of an rsync transfer in one  of  two  easy
       ways:

       o      forcing the running of the rrsync script

       o      forcing the running of an rsync daemon-over-ssh command.

       Both  of  these  setups  use  a  feature  of  ssh that allows a command to be forced to run instead of an
       interactive shell.  However, if the user's home shell is bash, please  see  BASH  SECURITY  ISSUE  for  a
       potential issue.

       To  use  the  rrsync script, edit the user's <b><a href="file:~/.ssh/authorized_keys">~/.ssh/authorized_keys</a></b> file and add a prefix like one of the
       following (followed by a space) in front of each ssh-key line that should be restricted:

           command="rrsync DIR"
           command="rrsync -ro DIR"
           command="rrsync -munge -no-del DIR"

       Then, ensure that the rrsync script has your desired option restrictions. You may want to copy the script
       to a local bin dir with a unique name if you want to have multiple configurations.  One  or  more  rrsync
       options can be specified prior to the <u>DIR</u> if you want to further restrict the transfer.

       To  use  an  rsync daemon setup, edit the user's <b><a href="file:~/.ssh/authorized_keys">~/.ssh/authorized_keys</a></b> file and add a prefix like one of
       the following (followed by a space) in front of each ssh-key line that should be restricted:

           command="rsync --server --daemon ."
           command="rsync --server --daemon --config=/PATH/TO/rsyncd.conf ."

       Then, ensure that the rsyncd.conf file is created with one or more module names with the appropriate path
       and option restrictions.  If rsync's <b>--config</b> option is omitted, it defaults to <b><a href="file:~/rsyncd.conf">~/rsyncd.conf</a></b>.   See  the
       <b><a href="../man5/rsyncd.conf.5.html">rsyncd.conf</a></b>(5) manpage for details of how to configure an rsync daemon.

       When using rrsync, there can be just one restricted dir per authorized key.  A daemon setup, on the other
       hand, allows multiple module names inside the config file, each one with its own path setting.

       The remainder of this manpage is dedicated to using the rrsync script.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-ro</b>    Allow only reading from the DIR. Implies <b>-no-del</b> and <b>-no-lock</b>.

       <b>-wo</b>    Allow only writing to the DIR.

       <b>-munge</b> Enable rsync's <b>--munge-links</b> on the server side.

       <b>-no-del</b>
              Disable rsync's <b>--delete*</b> and <b>--remove*</b> options.

       <b>-no-lock</b>
              Avoid the single-run (per-user) lock check.  Useful with <b>-munge</b>.

       <b>-no-overwrite</b>
              Enforce  <b>--ignore-existing</b>  on  the server. Prevents overwriting existing files when the server is
              the receiver.

       <b>-help</b>, <b>-h</b>
              Output this help message and exit.

</pre><h4><b>SECURITY</b> <b>RESTRICTIONS</b></h4><pre>
       The rrsync script validates the path arguments it is sent to try to restrict them to staying  within  the
       specified DIR.

       The  rrsync  script  rejects rsync's <b>--copy-links</b> option (by default) so that a copy cannot dereference a
       symlink within the DIR to get to a file outside the DIR.

       The rrsync script rejects rsync's <b>--protect-args</b> (<b>-s</b>) option because it would allow options to be sent to
       the server-side that the script cannot check.  If you want to support <b>--protect-args</b>, use a  daemon-over-
       ssh setup.

       The  rrsync  script  accepts  just  a subset of rsync's options that the real rsync uses when running the
       server command.  A few extra convenience options are also included to help it to interact  with  BackupPC
       and accept some convenient user overrides.

       The script (or a copy of it) can be manually edited if you want it to customize the option handling.

</pre><h4><b>BASH</b> <b>SECURITY</b> <b>ISSUE</b></h4><pre>
       If  your  users  have bash set as their home shell, bash may try to be overly helpful and ensure that the
       user's login bashrc files are run prior to executing the forced command.  This can be a  problem  if  the
       user  can  somehow  update  their  home  bashrc  files,  perhaps  via  the restricted copy, a shared home
       directory, or something similar.

       One simple way to avoid the issue is to switch the user to a simpler shell, such as dash.  When  choosing
       the  new  home  shell, make sure that you're not choosing bash in disguise, as it is unclear if it avoids
       the security issue.

       Another potential fix is to ensure that the user's home directory is not a shared  mount  and  that  they
       have  no  means  of copying files outside of their restricted directories.  This may require you to force
       the enabling of symlink munging on the server side.

       A future version of openssh may have a change to the handling of forced commands that allows it to  avoid
       using the user's home shell.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The <b><a href="file:~/.ssh/authorized_keys">~/.ssh/authorized_keys</a></b> file might have lines in it like this:

           command="rrsync client/logs" ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAIEAzG...
           command="rrsync -ro results" ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAIEAmk...

</pre><h4><b>FILES</b></h4><pre>
       <a href="file:~/.ssh/authorized_keys">~/.ssh/authorized_keys</a>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/rsync.1.html">rsync</a></b>(1), <b><a href="../man5/rsyncd.conf.5.html">rsyncd.conf</a></b>(5)

</pre><h4><b>VERSION</b></h4><pre>
       This manpage is current for version 3.4.1 of rsync.

</pre><h4><b>CREDITS</b></h4><pre>
       rsync is distributed under the GNU General Public License.  See the file COPYING for details.

       An   rsync   web   site   is   available   at   https://rsync.samba.org/   and   its  github  project  is
       https://github.com/RsyncProject/rsync.

</pre><h4><b>AUTHOR</b></h4><pre>
       The original rrsync perl script was written by Joe Smith.  Many people have later contributed to it.  The
       python version was created by Wayne Davison.

rrsync from rsync 3.4.1                            15 Jan 2025                                         <u><a href="../man1/rrsync.1.html">rrsync</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>