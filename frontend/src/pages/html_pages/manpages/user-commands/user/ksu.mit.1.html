<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ksu - Kerberized super-user</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/krb5-user">krb5-user_1.21.3-4ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ksu - Kerberized super-user

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>ksu</b> [ <u>target_user</u> ] [ <b>-n</b> <u>target_principal_name</u> ] [ <b>-c</b> <u>source_cache_name</u> ] [ <b>-k</b> ] [ <b>-r</b> time ] [ <b>-p</b> | <b>-P</b>] [
       <b>-f</b> | <b>-F</b>] [ <b>-l</b> <u>lifetime</u> ] [ <b>-z</b> <b>|</b> <b>Z</b> ] [ <b>-q</b> ] [ <b>-e</b> <u>command</u> [ args ...  ] ] [ <b>-a</b> [ args ...  ] ]

</pre><h4><b>REQUIREMENTS</b></h4><pre>
       Must  have Kerberos version 5 installed to compile ksu.  Must have a Kerberos version 5 server running to
       use ksu.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       ksu is a Kerberized version of the su program that has two missions: one is to securely change  the  real
       and effective user ID to that of the target user, and the other is to create a new security context.

       <b>NOTE:</b>
          For  the sake of clarity, all references to and attributes of the user invoking the program will start
          with "source" (e.g., "source user", "source cache", etc.).

          Likewise, all references to and attributes of the target account will start with "target".

</pre><h4><b>AUTHENTICATION</b></h4><pre>
       To fulfill the first mission, ksu operates in two phases: authentication  and  authorization.   Resolving
       the target principal name is the first step in authentication.  The user can either specify his principal
       name  with the <b>-n</b> option (e.g., <b>-n</b> <b><a href="mailto:jqpublic@USC.EDU">jqpublic@USC.EDU</a></b>) or a default principal name will be assigned using a
       heuristic described in the OPTIONS section (see <b>-n</b> option).  The target  user  name  must  be  the  first
       argument  to  ksu;  if not specified root is the default.  If <b>.</b> is specified then the target user will be
       the source user (e.g., <b>ksu</b> <b>.</b>).  If the source user is root or the target user  is  the  source  user,  no
       authentication  or authorization takes place.  Otherwise, ksu looks for an appropriate Kerberos ticket in
       the source cache.

       The ticket can either be for the end-server or a ticket granting ticket (TGT) for the target  principal's
       realm.   If  the ticket for the end-server is already in the cache, it's decrypted and verified.  If it's
       not in the cache but the TGT is, the TGT is used to obtain the ticket for the end-server.  The end-server
       ticket  is  then  verified.   If  neither  ticket  is  in  the  cache,  but  ksu  is  compiled  with  the
       <b>GET_TGT_VIA_PASSWD</b>  define,  the user will be prompted for a Kerberos password which will then be used to
       get a TGT.  If the user is logged in remotely and does not have a secure channel,  the  password  may  be
       exposed.  If neither ticket is in the cache and <b>GET_TGT_VIA_PASSWD</b> is not defined, authentication fails.

</pre><h4><b>AUTHORIZATION</b></h4><pre>
       This section describes authorization of the source user when ksu is invoked without the <b>-e</b> option.  For a
       description of the <b>-e</b> option, see the OPTIONS section.

       Upon  successful  authentication,  ksu  checks  whether  the target principal is authorized to access the
       target account.  In the target user's home directory, ksu attempts to  access  two  authorization  files:
       .<a href="../man5/k5login.5.html">k5login</a>(5)  and  .k5users.   In  the  .k5login  file  each line contains the name of a principal that is
       authorized to access the account.

       For example:

          <a href="mailto:jqpublic@USC.EDU">jqpublic@USC.EDU</a>
          jqpublic/<a href="mailto:secure@USC.EDU">secure@USC.EDU</a>
          jqpublic/<a href="mailto:admin@USC.EDU">admin@USC.EDU</a>

       The format of .k5users is the same, except the principal name may be followed by a list of commands  that
       the principal is authorized to execute (see the <b>-e</b> option in the OPTIONS section for details).

       Thus  if  the target principal name is found in the .k5login file the source user is authorized to access
       the target account.  Otherwise ksu looks in the .k5users file.  If the target  principal  name  is  found
       without  any  trailing  commands  or  followed  only  by <b>*</b> then the source user is authorized.  If either
       .k5login or .k5users exist but an appropriate entry for the target principal does not exist  then  access
       is  denied.  If neither file exists then the principal will be granted access to the account according to
       the aname-&gt;lname mapping rules.  Otherwise, authorization fails.

</pre><h4><b>EXECUTION</b> <b>OF</b> <b>THE</b> <b>TARGET</b> <b>SHELL</b></h4><pre>
       Upon successful authentication and  authorization,  ksu  proceeds  in  a  similar  fashion  to  su.   The
       environment  is  unmodified  with the exception of USER, HOME and SHELL variables.  If the target user is
       not root, USER gets set to the target user name.  Otherwise USER remains unchanged.  Both HOME and  SHELL
       are  set to the target login's default values.  In addition, the environment variable <b>KRB5CCNAME</b> gets set
       to the name of the target cache.  The real and effective user ID are changed to that of the target  user.
       The  target  user's  shell  is  then  invoked  (the  shell name is specified in the password file).  Upon
       termination of the shell, ksu deletes the target cache (unless ksu is invoked with the <b>-k</b> option).   This
       is implemented by first doing a fork and then an exec, instead of just exec, as done by su.

</pre><h4><b>CREATING</b> <b>A</b> <b>NEW</b> <b>SECURITY</b> <b>CONTEXT</b></h4><pre>
       ksu  can  be  used  to  create a new security context for the target program (either the target shell, or
       command specified via the <b>-e</b> option).  The target program inherits a set of credentials from  the  source
       user.   By  default,  this  set  includes  all of the credentials in the source cache plus any additional
       credentials obtained during authentication.  The source user is able to limit the credentials in this set
       by using <b>-z</b> or <b>-Z</b> option.  <b>-z</b> restricts the copy of tickets from the source cache to the target cache  to
       only  the tickets where client == the target principal name.  The <b>-Z</b> option provides the target user with
       a fresh target cache (no creds in the cache).  Note that for security reasons, when the  source  user  is
       root and target user is non-root, <b>-z</b> option is the default mode of operation.

       While  no  authentication  takes  place  if  the  source  user is root or is the same as the target user,
       additional tickets can still be obtained for the target cache.  If <b>-n</b> is specified and no credentials can
       be copied to the target cache, the source user is prompted for a Kerberos password (unless  <b>-Z</b>  specified
       or  <b>GET_TGT_VIA_PASSWD</b>  is  undefined).   If  successful,  a TGT is obtained from the Kerberos server and
       stored in the target cache.  Otherwise, if a password is not provided (user hit return) ksu continues  in
       a normal mode of operation (the target cache will not contain the desired TGT).  If the wrong password is
       typed in, ksu fails.

       <b>NOTE:</b>
          During authentication, only the tickets that could be obtained without providing a password are cached
          in the source cache.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-n</b> <u>target_principal_name</u>
              Specify a Kerberos target principal name.  Used in authentication and authorization phases of ksu.

              If ksu is invoked without <b>-n</b>, a default principal name is assigned via the following heuristic:

              • Case 1: source user is non-root.

                If the target user is the source user the default principal name is set to the default principal
                of  the  source  cache.   If  the cache does not exist then the default principal name is set to
                <b>target_user@local_realm</b>.   If  the  source  and  target  users   are   different   and   neither
                <b>~target_user/.k5users</b>  nor  <b>~target_user/.k5login</b>  exist  then  the  default  principal  name is
                <b>target_user_login_name@local_realm</b>.  Otherwise, starting with the first principal listed  below,
                ksu  checks  if  the principal is authorized to access the target account and whether there is a
                legitimate ticket for that principal in the source cache.   If  both  conditions  are  met  that
                principal becomes the default target principal, otherwise go to the next principal.

                a. default principal of the source cache

                b. target_user@local_realm

                c. source_user@local_realm

                If  a-c  fails  try  any  principal  for which there is a ticket in the source cache and that is
                authorized to access the target account.  If that fails  select  the  first  principal  that  is
                authorized  to access the target account from the above list.  If none are authorized and ksu is
                configured with <b>PRINC_LOOK_AHEAD</b> turned on, select the default principal as follows:

                For each candidate in the above list, select an authorized principal that  has  the  same  realm
                name  and first part of the principal name equal to the prefix of the candidate.  For example if
                candidate a) is <b><a href="mailto:jqpublic@ISI.EDU">jqpublic@ISI.EDU</a></b> and <b>jqpublic/<a href="mailto:secure@ISI.EDU">secure@ISI.EDU</a></b> is authorized to access the  target
                account then the default principal is set to <b>jqpublic/<a href="mailto:secure@ISI.EDU">secure@ISI.EDU</a></b>.

              • Case 2: source user is root.

                If  the  target  user  is  non-root  then the default principal name is <b>target_user@local_realm</b>.
                Else, if the source cache exists the default principal name is set to the default  principal  of
                the  source  cache.   If  the  source  cache  does  not  exist, default principal name is set to
                <b>root\@local_realm</b>.

       <b>-c</b> <u>source_cache_name</u>
          Specify source cache name (e.g., <b>-c</b> <b>FILE:/tmp/my_cache</b>).  If <b>-c</b> option is not used then  the  name  is
          obtained  from <b>KRB5CCNAME</b> environment variable.  If <b>KRB5CCNAME</b> is not defined the source cache name is
          set  to  <b>krb5cc_&lt;source</b>  <b>uid&gt;</b>.   The  target  cache  name  is  automatically  set  to   <b>krb5cc_&lt;target</b>
          <b>uid&gt;.(gen_sym())</b>,  where gen_sym generates a new number such that the resulting cache does not already
          exist.  For example:

              krb5cc_1984.2

       <b>-k</b>     Do not delete the target cache upon termination of the target shell or  a  command  (<b>-e</b>  command).
              Without <b>-k</b>, ksu deletes the target cache.

       <b>-z</b>     Restrict  the  copy of tickets from the source cache to the target cache to only the tickets where
              client == the target principal name.  Use the <b>-n</b> option if you want the tickets for other then the
              default principal.  Note that the <b>-z</b> option is mutually exclusive with the <b>-Z</b> option.

       <b>-Z</b>     Don't copy any tickets from the source cache to the target cache.   Just  create  a  fresh  target
              cache,  where the default principal name of the cache is initialized to the target principal name.
              Note that the <b>-Z</b> option is mutually exclusive with the <b>-z</b> option.

       <b>-q</b>     Suppress the printing of status messages.

       Ticket granting ticket options:

       <b>-l</b> <u>lifetime</u> <b>-r</b> <u>time</u> <b>-p</b> <b>-P</b> <b>-f</b> <b>-F</b>
              The ticket granting ticket options only apply to the case where there are no  appropriate  tickets
              in  the  cache to authenticate the source user.  In this case if ksu is configured to prompt users
              for a Kerberos password (<b>GET_TGT_VIA_PASSWD</b> is defined), the ticket granting ticket  options  that
              are specified will be used when getting a ticket granting ticket from the Kerberos server.

       <b>-l</b> <u>lifetime</u>
              (duration  string.)   Specifies the lifetime to be requested for the ticket; if this option is not
              specified, the default ticket lifetime (12 hours) is used instead.

       <b>-r</b> <u>time</u>
              (duration string.)  Specifies that the <b>renewable</b> option should be requested for  the  ticket,  and
              specifies the desired total lifetime of the ticket.

       <b>-p</b>     specifies that the <b>proxiable</b> option should be requested for the ticket.

       <b>-P</b>     specifies  that  the  <b>proxiable</b> option should not be requested for the ticket, even if the default
              configuration is to ask for proxiable tickets.

       <b>-f</b>     option specifies that the <b>forwardable</b> option should be requested for the ticket.

       <b>-F</b>     option specifies that the <b>forwardable</b> option should not be requested for the ticket, even  if  the
              default configuration is to ask for forwardable tickets.

       <b>-e</b> <u>command</u> [<u>args</u> ...]
              ksu  proceeds  exactly  the  same  as  if  it was invoked without the <b>-e</b> option, except instead of
              executing the target shell, ksu executes the specified command. Example of usage:

                 ksu bob -e ls -lag

              The authorization algorithm for <b>-e</b> is as follows:

              If the source user is root or source user == target user, no authorization  takes  place  and  the
              command  is  executed.   If  source  user  id != 0, and <b>~target_user/.k5users</b> file does not exist,
              authorization fails.  Otherwise, <b>~target_user/.k5users</b> file must have  an  appropriate  entry  for
              target principal to get authorized.

              The .k5users file format:

              A  single  principal  entry  on  each  line  that  may  be followed by a list of commands that the
              principal is authorized to execute.  A principal name followed by a  <b>*</b>  means  that  the  user  is
              authorized to execute any command.  Thus, in the following example:

                 <a href="mailto:jqpublic@USC.EDU">jqpublic@USC.EDU</a> ls mail /local/kerberos/klist
                 jqpublic/<a href="mailto:secure@USC.EDU">secure@USC.EDU</a> *
                 jqpublic/<a href="mailto:admin@USC.EDU">admin@USC.EDU</a>

              <b><a href="mailto:jqpublic@USC.EDU">jqpublic@USC.EDU</a></b>    is    only    authorized   to   execute   <b>ls</b>,   <b>mail</b>   and   <b>klist</b>   commands.
              <b>jqpublic/<a href="mailto:secure@USC.EDU">secure@USC.EDU</a></b> is authorized to  execute  any  command.   <b>jqpublic/<a href="mailto:admin@USC.EDU">admin@USC.EDU</a></b>  is  not
              authorized to execute any command.  Note, that <b>jqpublic/<a href="mailto:admin@USC.EDU">admin@USC.EDU</a></b> is authorized to execute the
              target shell (regular ksu, without the <b>-e</b> option) but <b><a href="mailto:jqpublic@USC.EDU">jqpublic@USC.EDU</a></b> is not.

              The  commands listed after the principal name must be either a full path names or just the program
              name.  In the second case, <b>CMD_PATH</b> specifying the location of authorized programs must be defined
              at the compilation time of ksu.  Which command gets executed?

              If the source user is root or the target user is the source user or  the  user  is  authorized  to
              execute  any command (<b>*</b> entry) then command can be either a full or a relative path leading to the
              target program.  Otherwise, the user must specify either a full path or just the program name.

       <b>-a</b> <u>args</u>
              Specify arguments to be passed to the target shell.  Note that all flags and parameters  following
              -a will be passed to the shell, thus all options intended for ksu must precede <b>-a</b>.

              The <b>-a</b> option can be used to simulate the <b>-e</b> option if used as follows:

                 -a -c [command [arguments]].

              <b>-c</b> is interpreted by the c-shell to execute the command.

</pre><h4><b>INSTALLATION</b> <b>INSTRUCTIONS</b></h4><pre>
       ksu can be compiled with the following four flags:

       <b>GET_TGT_VIA_PASSWD</b>
              In  case  no  appropriate  tickets  are found in the source cache, the user will be prompted for a
              Kerberos password.  The password is then used to get a ticket granting ticket  from  the  Kerberos
              server.  The danger of configuring ksu with this macro is if the source user is logged in remotely
              and does not have a secure channel, the password may get exposed.

       <b>PRINC_LOOK_AHEAD</b>
              During  the  resolution  of  the  default  principal  name,  <b>PRINC_LOOK_AHEAD</b>  enables ksu to find
              principal names in the .k5users file as described in the OPTIONS section (see <b>-n</b> option).

       <b>CMD_PATH</b>
              Specifies a list of directories containing programs that users  are  authorized  to  execute  (via
              .k5users file).

       <b>HAVE_GETUSERSHELL</b>
              If the source user is non-root, ksu insists that the target user's shell to be invoked is a "legal
              shell".   <u><a href="../man3/getusershell.3.html">getusershell</a>(3)</u>  is  called to obtain the names of "legal shells".  Note that the target
              user's shell is obtained from the passwd file.

       Sample configuration:

          KSU_OPTS = -DGET_TGT_VIA_PASSWD -DPRINC_LOOK_AHEAD -DCMD_PATH='"<a href="file:/bin">/bin</a> /usr/ucb /local/bin"

       ksu should be owned by root and have the set user id bit turned on.

       ksu attempts to get a ticket for the end server just as Kerberized telnet and rlogin.  Thus,  there  must
       be  an  entry  for the server in the Kerberos database (e.g., <b>host/<a href="mailto:nii.isi.edu@ISI.EDU">nii.isi.edu@ISI.EDU</a></b>).  The keytab file
       must be in an appropriate location.

</pre><h4><b>SIDE</b> <b>EFFECTS</b></h4><pre>
       ksu deletes all expired tickets from the source cache.

</pre><h4><b>AUTHOR</b> <b>OF</b> <b>KSU</b></h4><pre>
       GENNADY (ARI) MEDVINSKY

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       See <a href="../man7/kerberos.7.html">kerberos</a>(7) for a description of Kerberos environment variables.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man7/kerberos.7.html">kerberos</a>(7), <a href="../man1/kinit.1.html">kinit</a>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
       MIT

</pre><h4><b>COPYRIGHT</b></h4><pre>
       1985-2024, MIT

1.21.3                                                                                                    <u><a href="../man1/KSU.1.html">KSU</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>