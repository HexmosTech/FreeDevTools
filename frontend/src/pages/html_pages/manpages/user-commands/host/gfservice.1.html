<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gfservice - control Gfarm servers from a remote host</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/gfarm-client">gfarm-client_2.7.20+dfsg-1.1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       gfservice - control Gfarm servers from a remote host

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>gfservice</b> [<u>options</u>] sub-command [host-id] [<u>argument</u> <u>...</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>gfservice</b> is an utility for Gfarm administrators to operate servers (<b>gfmd</b>, <b>gfsd</b> and PostgreSQL) on remote
       hosts. OpenLDAP is not supported currently. It can start, stop, set up (execute <b>config-gfarm</b> and
       <b>config-gfsd</b>) and clean up the servers, for example.

       A sample command line of <b>gfservice</b> looks like:

                <b>gfservice</b> <u>start-gfmd</u> <u>gfmd2</u>

       where "<u>start-gfmd</u>" is a sub-command and <u>gfmd2</u> is a host-id respectively. Executing the command, <b>gfservice</b>
       tries to start gfmd on the host named <u>gfmd2</u>. To specify a remote server host, <b>gfservice</b> uses host-id
       instead of hostname. All host-ids (<u>gfmd1</u>, <u>gfmd2</u>, and so on) are defined in a configuration file of
       <b>gfservice</b>. Here is an example of the configuration file:

                gfmd1=metadb1.example.com
                gfmd1_CONFIG_GFARM_OPTIONS="-A $LOGNAME -X"
                gfmd2=metadb2.example.com
                gfmd2_CONFIG_GFARM_OPTIONS="-A $LOGNAME -X"

                gfsd1=spool1.example.com
                gfsd2=spool2.example.com

       <b>gfservice</b> determines a path of the configuration file to be read with the following procedures:

        1. <b>-f</b> <u>file</u> option is specified, read <u>file</u>.

        2. Otherwise, the environment variable <u>GFSERVICE_CONF</u> is defined and not empty, read the file.

        3. Otherwise, read $HOME/.gfservice.

       If <b>gfservice</b> fails to read a configuration file, it prints an error message and exits immediately. Note
       that the configuration file itself is a Bourne-shell script and <b>gfservice</b> includes (exactly to say,
       <u>evaluates</u>) the file. See <a href="../man5/gfservice.conf.5.html">gfservice.conf</a>(5) for more details about the configuration file.

       <b>gfservice</b> uses SSH (Secure Shell) to connect with a remote host. Since it may execute <b>ssh</b> several times
       during a sub-command operation, it is recommended to use an SSH agent (e.g.  <b>ssh-agent</b> of OpenSSH) or an
       authentication key with an empty passphrase to avoid typing a passphrase every time.

       In addition with SSH, <b>gfservice</b> uses Sudo to get root privilege on the remote host. Please add a line
       like below to sudoers file (Sudo's configuration file) on each remote host.

                <u>user</u> ALL=(root, _gfarmfs, _gfarmmd) NOPASSWD: gfservice-agent

       where <u>user</u> is an user name who executes <b>gfservice</b>. The NOPASSWD option is not mandatory, but <b>sudo</b> may ask
       you a password several times if omitted.

       Since <b>gfservice</b> executes an agent command named <b>gfservice-agent</b> on the remote host using SSH and Sudo,
       <b>gfservice-agent</b> command must have been installed on all hosts you want to operate using <b>gfservice</b>.

       <b>gfservice</b> has a plug-in system so that user can add new sub-commands. See "PLUG-IN SYSTEM" section of
       this man page for more details.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-d</b>
           Print debug information.  <b>gfservice</b> passes this option to <b>gfservice-agent</b> so that also
           <b>gfservice-agent</b> outputs debug information.

       <b>-f</b> <u>file</u>
           Read configuration from <u>file</u> instead of the default.

       <b>-t</b> <u>time</u>
           Set operation timeout in <u>time</u> seconds. When <b>gfservice</b> tries to start or stop a server program (gfmd,
           gfsd or a backend database), it waits until the operation is complete or <u>time</u> interval is elapsed. If
           "no" is specified as <u>time</u>, timeout never occurs. The default value is "no".

       <b>-k</b>
           When this option is specified with sub-command <b>config-gfarm</b> or <b>config-gfarm-master</b>, <b>gfservice</b> creates
           a shared secret key files using <b>gfkey</b> command.

</pre><h4><b>SUB-COMMANDS</b> <b>FOR</b> <b>GFMD</b></h4><pre>
       The followings are sub-commands which operate <b>gfmd</b>. The given host-id argument must be "gfmd<u>n</u>" (gfmd1,
       gfmd2, ...). Otherwise <b>gfservice</b> reports an error and exits immediately.

       <b>backend-db-status</b> <u>host-id</u>
           Exit with an exit code 0, if a backend database is currently running. Otherwise exits with 1.

       <b>gfmd-status</b> <u>host-id</u>
           Exit with an exit code 0, if <b>gfmd</b> is currently running. Otherwise exits with 1.

       <b>start-backend-db</b> <u>host-id</u>
           Start a backend database if it is not running currently.

       <b>start-gfmd</b> <u>host-id</u>
           Start <b>gfmd</b> if it is not running currently.

       <b>start-gfmd-master</b> <u>host-id</u>
           An alias of "<b>start-gfmd</b>" sub-command.

       <b>start-gfmd-slave</b> <u>host-id</u>
           This sub-command is the same as "<b>start-gfmd</b>", but <b>-S</b> option is added to <b>gfmd</b>.

       <b>start-gfarm</b> <u>host-id</u>
           Start a backend database and <b>gfmd</b> if they are not running currently.

       <b>start-gfarm-master</b> <u>host-id</u>
           An alias of "<b>start-gfarm</b>" sub-command.

       <b>start-gfarm-slave</b> <u>host-id</u>
           This sub-command is the same as "<b>start-gfarm</b>", but <b>-S</b> option is added to <b>gfmd</b>.

       <b>stop-backend-db</b> <u>host-id</u>
           Stop a backend database if it is running currently.

       <b>stop-gfmd</b> <u>host-id</u>
           Stop <b>gfmd</b> if it is running currently.

       <b>stop-gfarm</b> <u>host-id</u>
           Stop <b>gfmd</b> and a backend database if they are running currently.

       <b>kill-gfmd</b> <u>host-id</u>
           Kill <b>gfmd</b> (send SIGKILL) if it is running currently.

       <b>restart-backend-db</b> <u>host-id</u>
           Perform "<b>stop-backend-db</b>" and "<b>start-backend-db</b>" sub-commands successively.

       <b>restart-gfmd</b> <u>host-id</u>
           Perform "<b>stop-gfmd</b>" and "<b>start-gfmd</b>" sub-commands successively.

       <b>restart-gfmd-master</b> <u>host-id</u>
           An alias of "<b>restart-gfmd</b>" sub-command.

       <b>restart-gfmd-slave</b> <u>host-id</u>
           Perform "<b>stop-gfmd</b>" and "<b>start-gfmd-slave</b>" sub-commands successively.

       <b>restart-gfarm</b> <u>host-id</u>
           Perform "<b>stop-gfarm</b>" and "<b>start-gfarm</b>" sub-commands successively.

       <b>restart-gfarm-master</b> <u>host-id</u>
           An alias of "<b>restart-gfarm</b>" sub-command.

       <b>restart-gfarm-slave</b> <u>host-id</u>
           Perform "<b>stop-gfarm</b>" and "<b>start-gfarm-slave</b>" sub-commands successively.

       <b>promote</b> <u>host-id</u>
           Promote <b>gfmd</b> from a slave to a master.

       <b>promote-gfmd</b> <u>host-id</u>
           An alias of "<b>promote</b>" sub-command.

       <b>set-gfmd-conf</b> <u>host-id</u> <u>directive</u> <u>value</u>
           Add

                    <u>directive</u> <u>value</u>

           line to gfmd.conf file on the remote host. If gfmd.conf already has a <u>directive</u> line, <b>gfservice</b>
           deletes it and then add a new line.

       <b>set-gfsd-conf</b> <u>host-id</u> <u>directive</u> <u>value</u>
           Add

                    <u>directive</u> <u>value</u>

           line to gfsd.conf file on the remote host. If gfsd.conf already has a <u>directive</u> line, <b>gfservice</b>
           deletes it and then add a new line.

       <b>unset-gfmd-conf</b> <u>host-id</u> <u>directive</u>
           Delete a <u>directive</u> line in gfmd.conf file on the remote host. If gfmd.conf file doesn't contain
           <u>directive</u> line, the file is unchanged.

       <b>unset-gfsd-conf</b> <u>host-id</u> <u>directive</u>
           Delete a <u>directive</u> line in gfsd.conf file on the remote host. If gfsd.conf file doesn't contain
           <u>directive</u> line, the file is unchanged.

       <b>backup-backend-db</b>
           Backup a backend database on the remote host and output the backup data to standard out.

       <b>backup-gfmd-conf</b> <u>host-id</u>
           Output gfmd.conf file on the remote host to standard out.

       <b>backup-gfsd-conf</b> <u>host-id</u>
           Output gfsd.conf file on the remote host to standard out. This sub-command can be worked only when
           the remote host is configured in the private mode.

       <b>backup-usermap</b> <u>host-id</u>
           Output usermap file on the remote host to standard out. This sub-command can be worked only when the
           remote host is configured in the private mode.

       <b>restore-backend-db</b> <u>host-id</u>
           Restore a backend database on the remote host. The backup data are read from standard in.

       <b>restore-gfmd-conf</b> <u>host-id</u>
           Recover gfmd.conf file on the remote host.  <b>gfservice</b> reads a backup of gfmd.conf from standard in.

       <b>restore-gfsd-conf</b> <u>host-id</u>
           Recover gfsd.conf file on the remote host.  <b>gfservice</b> reads a backup of gfsd.conf from standard in.
           This sub-command can be worked only when the remote host is configured in the private mode.

       <b>restore-usermap</b> <u>host-id</u>
           Recover usermap file on the remote host.  <b>gfservice</b> reads a backup of usermap from standard in. This
           sub-command can be worked only when the remote host is configured in the private mode.

       <b>config-gfarm</b> <u>host-id</u>
           Execute <b>config-gfarm</b> command on the remote host. If "gfmd<u>n</u>_CONFIG_GFARM_OPTIONS" variable is declared
           in the configuration file of <b>gfservice</b>, its value is passed to <b>config-gfarm</b> command as options. Don't
           use this sub-command when you want to enable replication of gfmd. Instead, use "<b>config-gfarm-master</b>"
           or "<b>config-gfarm-slave</b>" sub-command in that case. If <b>-k</b> option is specified, <b>gfservice</b> also creates a
           shared secret key files onto the gfmd host, using <b>gfkey</b> command.

       <b>config-gfarm-master</b> <u>host-id</u>
           This sub-command is the same as <b>config-gfarm</b> but gfmd replication is enabled automatically.

       <b>config-gfarm-slave</b> <u>host-id</u> <u>master-host-id</u>
           This sub-command is the same as <b>config-gfarm</b> but gfmd replication is enabled automatically and the
           remote gfmd host is configured as a slave of <u>master-host-id</u>. Then <b>gfservice</b> registers the slave host
           to a server list using <b>gfmdhost</b> command.  <b>gfservice</b> also adds the slave host to <u>metadb_server_list</u>
           directive in gfarm2.conf file on the master gfmd host and distribute the updated gfarm2.conf file to
           all hosts defined in the configuration file. It also updates gfsd.conf file and distributes it to all
           gfmd and gfsd hosts, if "gfmd<u>n</u>_PRIVATE_MODE" variable is set to "true". If the value of the variable
           "gfmd<u>n</u>_AUTH_TYPE" is "sharedsecret", it also copies a shared key file from the maste gfmd to the
           slave gfmd host.

       <b>unconfig-gfarm</b> <u>host-id</u>
           Execute "<b>stop-gfarm</b>" sub-command and then delete all files and directories created by gfmd and a
           backend database. If you want to unconfigure a slave gfmd, use "<b>unconfig-gfarm-slave</b>" sub-command
           instead.

       <b>unconfig-gfarm-master</b> <u>host-id</u>
           An alias of "<b>unconfig-gfarm</b>" sub-command.

       <b>unconfig-gfarm-slave</b> <u>host-id</u> <u>master-host-id</u>
           This sub-command is the same as "<b>unconfig-gfarm</b>", but <b>gfservice</b> does some additional works. It also
           deletes the slave host from a server list using <b>gfmdhost</b> command and from <u>metadb_server_list</u>
           directive in gfarm2.conf file on all hosts defined in the configuration file. It also updates
           gfsd.conf file and distributes it to all gfmd and gfsd hosts, if "gfmd<u>n</u>_PRIVATE_MODE" variable is set
           to "true".

</pre><h4><b>SUB-COMMANDS</b> <b>FOR</b> <b>GFSD</b></h4><pre>
       The followings are sub-commands which operate <b>gfsd</b>. The given host-id argument must be "gfsd<u>n</u>" (gfsd1,
       gfsd2, ...). Otherwise <b>gfservice</b> reports an error and exits immediately.

       <b>gfsd-status</b> <u>host-id</u>
           Exit with an exit code 0, if <b>gfsd</b> is currently running. Otherwise exits with 1.

       <b>start-gfsd</b>
           Start <b>gfsd</b> if it is not running currently.

       <b>stop-gfsd</b>
           Stop <b>gfsd</b> if it is running currently.

       <b>restart-gfsd</b> <u>host-id</u>
           Perform "<b>stop-gfsd</b>" and "<b>start-gfsd</b>" sub-commands successively.

       <b>set-gfsd-conf</b> <u>host-id</u> <u>directive</u> <u>value</u>
           Same as <b>set-gfsd-conf</b> sub-command for gfmd.

       <b>unset-gfsd-conf</b> <u>host-id</u> <u>directive</u>
           Same as <b>unset-gfsd-conf</b> sub-command for gfmd.

       <b>backup-gfsd-conf</b> <u>host-id</u>
           Same as <b>backup-gfsd-conf</b> sub-command for gfmd.

       <b>backup-usermap</b> <u>host-id</u>
           Same as <b>backup-usermap</b> sub-command for gfmd.

       <b>restore-gfsd-conf</b> <u>host-id</u>
           Same as <b>restore-gfsd-conf</b> sub-command for gfmd.

       <b>restore-usermap</b> <u>host-id</u>
           Same as <b>restore-usermap</b> sub-command for gfmd.

       <b>config-gfsd</b> <u>host-id</u>
           Execute "<b>config-gfsd</b>" command on the remote host. If "gfsd<u>n</u>_CONFIG_GFSD_OPTIONS" variable is declared
           in the configuration file of <b>gfservice</b>, its value is passed to <b>config-gfsd</b> command as options.
           <b>gfservice</b> also registers the configured remote host as a filesystem node using <b>gfhost</b> command. If the
           value of the variable "gfsd<u>n</u>_AUTH_TYPE" is "sharedsecret", it also copies a shared key file from
           gfmd1 to the gfsd host.

       <b>unconfig-gfsd</b> <u>host-id</u>
           Execute "<b>stop-gfsd</b>" sub-command and then delete all files and directories created by gfsd.

</pre><h4><b>SUB-COMMANDS</b> <b>FOR</b> <b>CLIENT</b></h4><pre>
       The followings are sub-commands which operate a client. The given host-id argument must be "gfmd<u>n</u>"
       (gfmd1, gfmd2, ...), "gfsd<u>n</u>" (gfsd1, gfsd2, ...) or "client<u>n</u>" (client1, client2, ...). Otherwise
       <b>gfservice</b> reports an error and exits immediately.

       <b>mount</b> <u>host-id</u> <u>directory</u> <u>option...</u>
           Mount a Gfarm2 filesystem on <u>directory</u> on the remote host. The argument <u>option</u> is an option to
           <b>gfarm2fs</b> command.

       <b>unmount</b> <u>host-id</u> <u>directory</u>
           Unmount a Gfarm2 filesystem on <u>directory</u> on the remote host.

       <b>umount</b> <u>host-id</u> <u>directory</u>
           An alias of "<b>unmount</b>" sub-command.

       <b>set-gfarm-conf</b> <u>host-id</u> <u>directive</u> <u>value</u>
           Add

                    <u>directive</u> <u>value</u>

           line to gfarm2.conf file on the remote host. If gfarm2.conf already has a <u>directive</u> line, <b>gfservice</b>
           deletes it and then add a new line.

       <b>unset-gfarm-conf</b> <u>host-id</u> <u>directive</u>
           Delete a <u>directive</u> line in gfarm2.conf file on the remote host. If gfarm2.conf file doesn't contain
           <u>directive</u> line, the file is unchanged.

       <b>backup-gfarm-conf</b> <u>host-id</u>
           Output gfarm2.conf file on the remote host to standard out.

       <b>backup-shared-key</b> <u>host-id</u>
           Output a shared secret key file to standard out.

       <b>restore-gfarm-conf</b> <u>host-id</u>
           Recover gfarm2.conf file on the remote host.  <b>gfservice</b> reads a backup of gfarm2.conf from standard
           in.

       <b>restore-shared-key</b> <u>host-id</u>
           Recover a shared secret key file on the remote host.  <b>gfservice</b> reads a backup of the shared secret
           key from standard in.

       <b>config-client</b> <u>host-id</u>
           Copy gfarm2.conf file from gfmd1 to the client host. If the value of the variable "client<u>n</u>_AUTH_TYPE"
           is "sharedsecret", it also copies a shared key file from gfmd1 to the client host.

       <b>unconfig-client</b> <u>host-id</u>
           Delete gfarm2.conf file and a shared secret key file on the remote host.

       <b>gfcmd</b> <u>host-id</u> <u>command-name</u> <u>command-argument</u> <u>...</u>
           Execute a Gfarm command on the remote host.

       <b>gfcmd-root</b> <u>host-id</u> <u>command-name</u> <u>command-argument</u> <u>...</u>
           Execute a Gfarm command on the remote host with root privilege.

       <b>grid-proxy-init</b> <u>host-id</u> <u>command-argument</u> <u>...</u>
           Execute <b>grid-proxy-init</b> command on the remote host.

</pre><h4><b>SUB-COMMANDS</b> <b>FOR</b> <b>MULTIPLE</b> <b>HOSTS</b></h4><pre>
       The followings are sub-commands which operate on multiple hosts. The host-id argument must not be
       specified.

       <b>start-all</b>
           Start all backend databases, <b>gfmd</b> servers and <b>gfsd</b> servers.

       <b>stop-all</b>
           Stop all <b>gfsd</b> servers, <b>gfmd</b> servers and backend databases,

       <b>kill-gfmd-all</b>
           Kill (send SIGKILL) all <b>gfmd</b> servers.

       <b>restart-all</b>
           Perform "<b>stop-all</b>" and "<b>start-all</b>" sub-commands successively.

       <b>config-all</b>
           Perform "<b>config-gfarm-master</b>" for <u>gfmd1</u> and "<b>config-gfarm-slave</b>" for all other gfmd nodes. Then,
           perform "<b>config-gfsd</b>" for all gfds nodes. Finally, perform "<b>config-client</b>" for all client nodes.

       <b>unconfig-all</b>
           Perform "<b>unconfig-client</b>" for all client nodes. Then, perform "<b>unconfig-gfsd</b>" for all gfds nodes.
           Finally, perform "<b>unconfig-gfarm</b>" for all gfmd nodes.

</pre><h4><b>PLUG-IN</b> <b>SYSTEM</b></h4><pre>
       <b>gfservice</b> has a plug-in system so that user can add new sub-commands. If given sub-command is not
       provided by <b>gfservice</b>, <b>gfservice</b> refers to a file which has name of sub-command under
       %%DATADIR%%/gfarm/gfservice directory.

       Sub-command file must be written as Bourne shell script. Sub-command file for sub-command "<u>name</u>", must
       have shell function named "<b>subcmd_</b><u>name</u>" which will be executed from <b>gfservice</b>, and "<b>subcmd_</b><u>name</u><b>_agent</b>"
       which will be executed from <b>gfservice-agent</b>.

       For the case a sub-command depends on a other user provided sub-command, Sub-command file for sub-command
       "<u>name</u>", must have shell function named "<u>name</u><b>_depends</b>" which must return list of sub-commands. List of
       sub-commands must be a string which is space separated list of sub-command names. If sub-command or it's
       agent does not have dependencies, return empty string. Similarly, sub-command file must have shell
       function named "<u>name</u><b>_agent_depends</b>" which must return list of sub-command's agents.

Gfarm                                              6 Jun 2013                                       <u><a href="../man1/GFSERVICE.1.html">GFSERVICE</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>