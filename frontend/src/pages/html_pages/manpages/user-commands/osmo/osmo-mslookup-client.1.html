<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>osmo-mslookup-client - osmo-mgw</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/osmo-mslookup-utils">osmo-mslookup-utils_1.9.0+dfsg1-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       osmo-mslookup-client - osmo-mgw

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Osmocom  Media  Gateway,  to  manage,  connect  and  optionally transcode voice streams between different
       network elements such as BTSs and external entities like  SIP.  It  is  typically  co-located  with  both
       OsmoBSC and OsmoMSC and controlled by them via IETF MGCP (Media Gateway Control Protocol).

       https://osmocom.org/projects/osmo-mgw

       osmo-mslookup-client version 1.9.0

</pre><h4><b>OPTIONS</b></h4><pre>
       [[delay-][timeout]@]service.number.id

              A service query string with optional individual timeout.  The same format is also used on a daemon
              socket,  if  any.  The timeout consists of the min-delay and the timeout numbers, corresponding to
              the <b>--min-delay</b> and <b>--timeout</b> options, in milliseconds.  These options apply  if  a  query  string
              lacks own numbers.  Examples:

       gsup.hlr.1234567.imsi
              Use cmdline timeout settings

       <a href="mailto:5000@gsup.hlr.1234567.imsi">5000@gsup.hlr.1234567.imsi</a>
              Return N results for 5 seconds

       <a href="mailto:1000-5000@sip.voice.123.msisdn">1000-5000@sip.voice.123.msisdn</a>
              Same, but silent for first second

       <a href="mailto:10000-@smpp.sms.567.msisdn">10000-@smpp.sms.567.msisdn</a>
              Return 1 result after 10 seconds

       <b>--format</b> <b>-f</b> csv (default)

              Format result lines in CSV format.

       <b>--no-csv-headers</b> <b>-H</b>

              If  the  format  is  'csv',  by default, the first output line prints the CSV headers used for CSV
              output format. This option disables these CSV headers.

       <b>--format</b> <b>-f</b> json

              Format   result   lines   in   json   instead   of   semicolon    separated,    like:    {"query":
              "sip.voice.12345.msisdn", "result": "ok", "v4": ["10.9.8.7", "5060"]}

       <b>--daemon</b> <b>-d</b>

              Keep running after a request has been serviced

       <b>--mdns-ip</b> <b>-m</b> 239.192.23.42 <b>-m</b> ff08::23:42 <b>--mdns-port</b> <b>-M</b> 4266

              Set multicast IP address / port to send mDNS requests and listen for mDNS responses

       <b>--mdns-domain-suffix</b> <b>-D</b> mdns.osmocom.org

              Append  this  suffix  to  each  mDNS  query's domain to avoid colliding with the top-level domains
              administrated by IANA.

       <b>--min-delay</b> <b>-t</b> 1000 (in milliseconds)

              Set minimum delay to wait before returning any results.  When this timeout has elapsed,  the  best
              current  result  is  returned,  if  any  is available.  Responses arriving after the min-delay has
              elapsed which have a younger age than previous results are returned  immediately.   Note:  When  a
              response  with  age  of  zero  comes  in,  the  result  is returned immediately and the request is
              discarded: non-daemon mode exits, daemon mode ignores later results.

       <b>--timeout</b> <b>-T</b> 1000 (in milliseconds)

              Set timeout after which to stop listening for responses.  If this is smaller than  <b>-t</b>,  the  value
              from  <b>-t</b> will be used for <b>-T</b> as well.  Note: When a response with age of zero comes in, the result
              is returned immediately and the request is discarded: non-daemon mode exits, daemon  mode  ignores
              later results.

       <b>--socket</b> <b>-s</b> <u>/path/to/unix-domain-socket</u>

              Listen to requests from and write responses to a UNIX domain socket.

       <b>--send</b> <b>-S</b> &lt;query&gt; &lt;age&gt; &lt;ip1&gt; &lt;port1&gt; &lt;ip2&gt; &lt;port2&gt;

              Do  not  query,  but  send  an  mslookup result. This is useful only for testing. Examples: <b>--send</b>
              foo.123.msisdn 300 23.42.17.11 1234 <b>--send</b> foo.123.msisdn 300 2323:4242:1717:1111::42 1234  <b>--send</b>
              foo.123.msisdn 300 23.42.17.11 1234 2323:4242:1717:1111::42 1234

       <b>--quiet</b> <b>-q</b>

              Do not print errors to stderr, do not log to stderr.

       <b>--help</b> <b>-h</b>

              This help

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright © 2019 by sysmocom - s.f.m.c. GmbH
       Copyright  © 2019 by Neels Hofmeyr &lt;<a href="mailto:neels@hofmeyr.de">neels@hofmeyr.de</a>&gt; This program is free software; you can redistribute
       it and/or modify it under the terms of the GNU General Public License as published by the  Free  Software
       Foundation; either version 2 of the License, or (at your option) any later version.

       Standalone mslookup client for Distributed GSM

       Receiving mslookup results means listening for responses on a socket. Often, integration (e.g. FreeSwitch
       dialplan.py)  makes  it  hard to select() on a socket to read responses, because that interferes with the
       main program (e.g.  FreeSwitch's dialplan.py seems to be integrated with an own select() main  loop  that
       interferes with osmo_select_main(), or an smpp.py uses smpplib.client.listen() as main loop, etc.).

       This  program  provides  a trivial solution, by outsourcing the mslookup main loop to a separate process.
       Communication is done via cmdline arg and stdout pipe or a (blocking) unix  domain  socket,  results  are
       returned in CSV or JSON format.

       This can be done one-shot, i.e. exit as soon as the response has been determined, or in daemon form, i.e.
       continuously listen for requests and return responses.

       About running a local daemon: it is unintuitive to connect to a socket to solve a problem of reading from
       a  socket  <b>--</b>  it  seems like just more of the same problem. The reasons why the daemon is in fact useful
       are: - The osmo-mslookup-client daemon will return only those results matching

              requests issued on that socket connection.

       - A program can simply blockingly recv() from the osmo-mslookup-client socket

              instead of needing to run osmo_select_main() so that libosmo-mslookup is  able  to  asynchronously
              receive responses from remote servers.

       - Only one long-lived multicast socket needs to be opened instead of a new

              socket for each request.

       Output  is  in  CSV  or  json,  see  <b>--format</b>. The default is tab-separated CSV with these columns: query
       result  last    age     v4_ip   v4_port v6_ip   v6_port

       One-shot  operation  example:  $  osmo-mslookup-client  <a href="mailto:1000-@sip.voice.12345.msisdn">1000-@sip.voice.12345.msisdn</a>  <b>-f</b>  json  {"query":
       "sip.voice.12345.msisdn", "result": "result", "last": true, "age": 5, "v4": ["1.2.3.7", "23"]} $

       Daemon  operation example: $ osmo-mslookup-client <b>-s</b> <u>/tmp/mslookup</u> <b>-d</b> (and a client program then connects
       to <u>/tmp/mslookup</u>, find an implementation example below)

       Integrating with calling programs can be done by: - call osmo-mslookup-client with the  query  string  as
       argument.

              It  will open a multicast DNS socket, send out a query and wait for the matching response. It will
              print the result on stdout and exit.  This method launches a new process for every mslookup query,
              and creates a short-lived multicast listener for each invocation.  This is fine for low  activity,
              but does not scale well.

       - invoke osmo-mslookup-client <b>--socket</b> <u>/tmp/mslookup</u> <b>-d</b>.

              Individual  queries  can  be sent by connecting to that unix domain socket, blockingly reading the
              response when it arrives and disconnecting.   This  way  only  one  process  keeps  one  multicast
              listener  open.   Callers  can  connect  to  this  socket  without  spawning  processes.   This is
              recommended for scale.

       Python     example     clients     for     {CSV,JSON}x{cmdline,socket}     can     be     found     here:
       <a href="http://git.osmocom.org/osmo-hlr/tree/contrib/dgsm/osmo-mslookup-pipe.py">http://git.osmocom.org/osmo-hlr/tree/contrib/dgsm/osmo-mslookup-pipe.py</a>
       <a href="http://git.osmocom.org/osmo-hlr/tree/contrib/dgsm/osmo-mslookup-socket.py">http://git.osmocom.org/osmo-hlr/tree/contrib/dgsm/osmo-mslookup-socket.py</a>

       Copyright © 2019 by sysmocom - s.f.m.c. GmbH
       Copyright  © 2019 by Neels Hofmeyr &lt;<a href="mailto:neels@hofmeyr.de">neels@hofmeyr.de</a>&gt; This program is free software; you can redistribute
       it and/or modify it under the terms of the GNU General Public License as published by the  Free  Software
       Foundation; either version 2 of the License, or (at your option) any later version.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       https://osmocom.org/projects/osmo-mgw/wiki

       The full documentation for <b>osmo-mslookup-client</b> is maintained as a Texinfo manual.  If the <b>info</b> and <b>osmo-</b>
       <b>mslookup-client</b> programs are properly installed at your site, the command

              <b>info</b> <b>osmo-mslookup-client</b>

       should give you access to the complete manual.

osmo-mslookup-client version 1.9.0                 March 2025                            <u><a href="../man1/OSMO-MSLOOKUP-CLIENT.1.html">OSMO-MSLOOKUP-CLIENT</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>