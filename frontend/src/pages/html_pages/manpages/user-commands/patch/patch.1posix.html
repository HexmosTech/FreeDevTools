<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-posix">manpages-posix_2017a-2_all</a> <br><br><pre>
</pre><h4><b>PROLOG</b></h4><pre>
       This  manual  page  is part of the POSIX Programmer's Manual.  The Linux implementation of this interface
       may differ (consult the corresponding Linux manual page for details of Linux behavior), or the  interface
       may not be implemented on Linux.

</pre><h4><b>NAME</b></h4><pre>
       patch — apply changes to files

</pre><h4><b>SYNOPSIS</b></h4><pre>
       patch <b>[</b>-blNR<b>]</b> <b>[</b>-c|-e|-n|-u<b>]</b> <b>[</b>-d <u>dir</u><b>]</b> <b>[</b>-D <u>define</u><b>]</b> <b>[</b>-i <u>patchfile</u><b>]</b>
           <b>[</b>-o <u>outfile</u><b>]</b> <b>[</b>-p <u>num</u><b>]</b> <b>[</b>-r <u>rejectfile</u><b>]</b> <b>[</b><u>file</u><b>]</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <u>patch</u>  utility  shall  read  a source (patch) file containing any of four forms of difference (diff)
       listings produced by the <u>diff</u> utility (normal, copied context, unified context, or in the  style  of  <u>ed</u>)
       and apply those differences to a file. By default, <u>patch</u> shall read from the standard input.

       The  <u>patch</u> utility shall attempt to determine the type of the <u>diff</u> listing, unless overruled by a <b>-c</b>, <b>-e</b>,
       <b>-n</b>, or <b>-u</b> option.

       If the patch file contains more than one patch, <u>patch</u> shall attempt to apply each of them as if they came
       from separate patch files. (In this case, the application shall ensure that the name of the patch file is
       determinable for each <u>diff</u> listing.)

</pre><h4><b>OPTIONS</b></h4><pre>
       The <u>patch</u> utility shall conform to the Base Definitions volume of  POSIX.1‐2017,  <u>Section</u>  <u>12.2</u>,  <u>Utility</u>
       <u>Syntax</u> <u>Guidelines</u>.

       The following options shall be supported:

       <b>-b</b>        Save a copy of the original contents of each modified file, before the differences are applied,
                 in a file of the same name with the suffix <b>.orig</b> appended to it. If the file already exists, it
                 shall be overwritten; if multiple patches are applied to the same file, the <b>.orig</b> file shall be
                 written only for the first patch. When the <b>-o</b> <u>outfile</u> option is also specified, <u>file</u><b>.orig</b> shall
                 not be created but, if <u>outfile</u> already exists, <u>outfile</u><b>.orig</b> shall be created.

       <b>-c</b>        Interpret  the  patch  file as a copied context difference (the output of the utility <u>diff</u> when
                 the <b>-c</b> or <b>-C</b> options are specified).

       <b>-d</b> <u>dir</u>    Change the current directory to <u>dir</u> before processing as described in the EXTENDED  DESCRIPTION
                 section.

       <b>-D</b> <u>define</u> Mark changes with one of the following C preprocessor constructs:

                     #ifdef define
                     ...
                     #endif

                     #ifndef define
                     ...
                     #endif

                 optionally  combined with the C preprocessor construct <b>#else</b>.  If the patched file is processed
                 with the C preprocessor, where the macro <u>define</u>  is  defined,  the  output  shall  contain  the
                 changes  from  the patch file; otherwise, the output shall not contain the patches specified in
                 the patch file.

       <b>-e</b>        Interpret the patch file as an <u>ed</u> script, rather than a <u>diff</u> script.

       <b>-i</b> <u>patchfile</u>
                 Read the patch information from the file named by  the  pathname  <u>patchfile</u>,  rather  than  the
                 standard input.

       <b>-l</b>        (The  letter  ell.)  Cause any sequence of &lt;blank&gt; characters in the difference script to match
                 any sequence of &lt;blank&gt; characters in  the  input  file.  Other  characters  shall  be  matched
                 exactly.

       <b>-n</b>        Interpret the script as a normal difference.

       <b>-N</b>        Ignore  patches  where  the  differences  have  already  been  applied to the file; by default,
                 already-applied patches shall be rejected.

       <b>-o</b> <u>outfile</u>
                 Instead of modifying the files (specified by the  <u>file</u>  operand  or  the  difference  listings)
                 directly,  write  a copy of the file referenced by each patch, with the appropriate differences
                 applied, to <u>outfile</u>.  Multiple patches for a single file shall be applied to  the  intermediate
                 versions  of  the  file  created  by  any  previous  patches,  and  shall  result  in multiple,
                 concatenated versions of the file being written to <u>outfile</u>.

       <b>-p</b> <u>num</u>    For all pathnames in the patch file that indicate the names of files to be patched, delete  <u>num</u>
                 pathname  components  from the beginning of each pathname. If the pathname in the patch file is
                 absolute, any leading &lt;slash&gt; characters shall be considered the first component (that is, <b>-p</b> <b>1</b>
                 shall remove the leading &lt;slash&gt; characters). Specifying <b>-p</b> <b>0</b> shall cause the full pathname  to
                 be  used.  If  <b>-p</b>  is  not specified, only the basename (the final pathname component) shall be
                 used.

       <b>-R</b>        Reverse the sense of the patch script; that is, assume that the difference script  was  created
                 from  the  new  version  to the old version.  The <b>-R</b> option cannot be used with <u>ed</u> scripts. The
                 <u>patch</u> utility shall attempt to reverse each portion of the script before applying it.  Rejected
                 differences  shall  be  saved  in  swapped format. If this option is not specified, and until a
                 portion of the patch file is successfully applied, <u>patch</u> attempts to apply each portion in  its
                 reversed  sense as well as in its normal sense. If the attempt is successful, the user shall be
                 prompted to determine whether the <b>-R</b> option should be set.

       <b>-r</b> <u>rejectfile</u>
                 Override the default reject filename. In the default case, the reject file shall have the  same
                 name as the output file, with the suffix <b>.rej</b> appended to it; see <u>Patch</u> <u>Application</u>.

       <b>-u</b>        Interpret  the  patch file as a unified context difference (the output of the <u>diff</u> utility when
                 the <b>-u</b> or <b>-U</b> options are specified).

</pre><h4><b>OPERANDS</b></h4><pre>
       The following operand shall be supported:

       <u>file</u>      A pathname of a file to patch.

</pre><h4><b>STDIN</b></h4><pre>
       See the INPUT FILES section.

</pre><h4><b>INPUT</b> <b>FILES</b></h4><pre>
       Input files shall be text files.

</pre><h4><b>ENVIRONMENT</b> <b>VARIABLES</b></h4><pre>
       The following environment variables shall affect the execution of <u>patch</u>:

       <u>LANG</u>      Provide a default value for the internationalization variables that are unset or null. (See the
                 Base Definitions volume  of  POSIX.1‐2017,  <u>Section</u>  <u>8.2</u>,  <u>Internationalization</u>  <u>Variables</u>  the
                 precedence   of   internationalization  variables  used  to  determine  the  values  of  locale
                 categories.)

       <u>LC_ALL</u>    If set to a non-empty string value, override the values of all the  other  internationalization
                 variables.

       <u>LC_COLLATE</u>
                 Determine  the  locale  for  the  behavior  of ranges, equivalence classes, and multi-character
                 collating elements used in the extended regular  expression  defined  for  the  <b>yesexpr</b>  locale
                 keyword in the <u>LC_MESSAGES</u> category.

       <u>LC_CTYPE</u>  Determine  the  locale  for the interpretation of sequences of bytes of text data as characters
                 (for example, single-byte as opposed to multi-byte characters in arguments  and  input  files),
                 and  the  behavior of character classes used in the extended regular expression defined for the
                 <b>yesexpr</b> locale keyword in the <u>LC_MESSAGES</u> category.

       <u>LC_MESSAGES</u>
                 Determine the locale used to process affirmative responses, and the locale used to  affect  the
                 format and contents of diagnostic messages and prompts written to standard error.

       <u>NLSPATH</u>   Determine the location of message catalogs for the processing of <u>LC_MESSAGES</u>.

       <u>LC_TIME</u>   Determine  the locale for recognizing the format of file timestamps written by the <u>diff</u> utility
                 in a context-difference input file.

</pre><h4><b>ASYNCHRONOUS</b> <b>EVENTS</b></h4><pre>
       Default.

</pre><h4><b>STDOUT</b></h4><pre>
       Not used.

</pre><h4><b>STDERR</b></h4><pre>
       The standard error shall be used for diagnostic and informational messages.

</pre><h4><b>OUTPUT</b> <b>FILES</b></h4><pre>
       The output of the <u>patch</u> utility, the save files (<b>.orig</b> suffixes), and the reject  files  (<b>.rej</b>  suffixes)
       shall be text files.

</pre><h4><b>EXTENDED</b> <b>DESCRIPTION</b></h4><pre>
       A  patch  file may contain patching instructions for more than one file; filenames shall be determined as
       specified in <u>Filename</u> <u>Determination</u>.  When the <b>-b</b>  option  is  specified,  for  each  patched  file,  the
       original shall be saved in a file of the same name with the suffix <b>.orig</b> appended to it.

       For  each  patched file, a reject file may also be created as noted in <u>Patch</u> <u>Application</u>.  In the absence
       of a <b>-r</b> option, the name of this file shall be formed by  appending  the  suffix  <b>.rej</b>  to  the  original
       filename.

   <b>Patch</b> <b>File</b> <b>Format</b>
       The  patch  file  shall contain zero or more lines of header information followed by one or more patches.
       Each patch shall contain zero or more lines of filename identification in the format produced by the  <b>-c</b>,
       <b>-C</b>,  <b>-u</b>,  or  <b>-U</b>  options of the <u>diff</u> utility, and one or more sets of <u>diff</u> output, which are customarily
       called <u>hunks</u>.

       The <u>patch</u> utility shall recognize the following expression in the header information:

       <b>Index:</b> <u>pathname</u>
             The file to be patched is named <u>pathname</u>.

       If all lines (including headers) within  a  patch  begin  with  the  same  leading  sequence  of  &lt;blank&gt;
       characters,  the  <u>patch</u>  utility  shall remove this sequence before proceeding. Within each patch, if the
       type of difference is common context, the <u>patch</u> utility shall recognize the following expressions:

       *** <u>filename</u> <u>timestamp</u>
             The patches arose from <u>filename</u>.

       --- <u>filename</u> <u>timestamp</u>
             The patches should be applied to <u>filename</u>.

       If the type  of  difference  is  unified  context,  the  <u>patch</u>  utility  shall  recognize  the  following
       expressions:

       --- <u>filename</u> <u>timestamp</u>
             The patches arose from <u>filename</u>.

       +++ <u>filename</u> <u>timestamp</u>
             The patches should be applied to <u>filename</u>.

       Each  hunk  within  a patch shall be the <u>diff</u> output to change a line range within the original file. The
       line numbers for successive hunks within a patch shall occur in ascending order.

   <b>Filename</b> <b>Determination</b>
       If no <u>file</u> operand is specified, <u>patch</u> shall perform the following steps to  determine  the  filename  to
       use:

        1. If  the  type of <u>diff</u> is context, the <u>patch</u> utility shall delete pathname components (as specified by
           the <b>-p</b> option) from the filename on the line beginning with <b>"***"</b> (if copied context)  or  <b>"---"</b>  (if
           unified  context), then test for the existence of this file relative to the current directory (or the
           directory specified with the <b>-d</b> option). If the  file  exists,  the  <u>patch</u>  utility  shall  use  this
           filename.

        2. If  the type of <u>diff</u> is context, the <u>patch</u> utility shall delete the pathname components (as specified
           by the <b>-p</b> option) from the filename on the line beginning with <b>"---"</b> (if copied context) or <b>"+++"</b> (if
           unified context), then test for the existence of this file relative to the current directory (or  the
           directory  specified  with  the  <b>-d</b>  option).  If  the  file exists, the <u>patch</u> utility shall use this
           filename.

        3. If the header information contains a line beginning with the string <b>Index:</b>, the <u>patch</u>  utility  shall
           delete  pathname  components  (as  specified  by  the  <b>-p</b>  option)  from this line, then test for the
           existence of this file relative to the current directory (or the  directory  specified  with  the  <b>-d</b>
           option). If the file exists, the <u>patch</u> utility shall use this filename.

        4. If  an  <b>SCCS</b>  directory  exists  in  the  current  directory, <u>patch</u> shall attempt to perform a <u>get</u> <b>-e</b>
           <b>SCCS/s.</b><u>filename</u> command to retrieve an editable version of the file. If the file  exists,  the  <u>patch</u>
           utility shall use this filename.

        5. The  <u>patch</u>  utility shall write a prompt to standard output and request a filename interactively from
           the controlling terminal (for example, <b>/dev/tty</b>).

   <b>Patch</b> <b>Application</b>
       If the <b>-c</b>, <b>-e</b>, <b>-n</b>, or <b>-u</b> option is present, the <u>patch</u> utility shall  interpret  information  within  each
       hunk  as  a  copied  context  difference,  an  <u>ed</u>  difference,  a normal difference, or a unified context
       difference, respectively. In the absence of any of these options, the <u>patch</u> utility shall  determine  the
       type of difference based on the format of information within the hunk.

       For  each  hunk,  the  <u>patch</u>  utility  shall begin to search for the place to apply the patch at the line
       number at the beginning of the hunk, plus or minus any offset used in  applying  the  previous  hunk.  If
       lines matching the hunk context are not found, <u>patch</u> shall scan both forwards and backwards at least 1000
       bytes for a set of lines that match the hunk context.

       If  no  such  place is found and it is a context difference, then another scan shall take place, ignoring
       the first and last line of context. If that fails, the first two and last two lines of context  shall  be
       ignored  and  another  scan  shall  be made. Implementations may search more extensively for installation
       locations.

       If no location can be found, the <u>patch</u> utility shall append the hunk to the reject file. A rejected  hunk
       that is a copied context difference, an <u>ed</u> difference, or a normal difference shall be written in copied-
       context-difference  format  regardless  of  the  format  of  the patch file. It is implementation-defined
       whether a rejected hunk that is a unified context  difference  is  written  in  copied-context-difference
       format  or  in  unified-context-difference format.  If the input was a normal or <u>ed</u>-style difference, the
       reject file may contain differences with zero lines of context. The line numbers  on  the  hunks  in  the
       reject  file  may  be  different  from  the  line  numbers in the patch file since they shall reflect the
       approximate locations for the failed hunks in the new file rather than the old one.

       If the type of patch is an <u>ed</u> diff, the implementation may accomplish the patching  by  invoking  the  <u>ed</u>
       utility.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       The following exit values shall be returned:

        0    Successful completion.

        1    One or more lines were written to a reject file.

       &gt;1    An error occurred.

</pre><h4><b>CONSEQUENCES</b> <b>OF</b> <b>ERRORS</b></h4><pre>
       Patches that cannot be correctly placed in the file shall be written to a reject file.

       <u>The</u> <u>following</u> <u>sections</u> <u>are</u> <u>informative.</u>

</pre><h4><b>APPLICATION</b> <b>USAGE</b></h4><pre>
       The  <b>-R</b>  option  does not work with <u>ed</u> scripts because there is too little information to reconstruct the
       reverse operation.

       The <b>-p</b> option makes it possible to customize a patch file to  local  user  directory  structures  without
       manually editing the patch file. For example, if the filename in the patch file was:

           /curds/whey/src/blurfl/blurfl.c

       Setting <b>-p</b> <b>0</b> gives the entire pathname unmodified; <b>-p</b> <b>1</b> gives:

           curds/whey/src/blurfl/blurfl.c

       without the leading &lt;slash&gt;, <b>-p</b> <b>4</b> gives:

           blurfl/blurfl.c

       and not specifying <b>-p</b> at all gives:

           blurfl.c .

</pre><h4><b>EXAMPLES</b></h4><pre>
       None.

</pre><h4><b>RATIONALE</b></h4><pre>
       Some  of the functionality in historical <u>patch</u> implementations was not specified. The following documents
       those features present in historical implementations that have not been specified.

       A deleted piece of functionality was the <b>'+'</b> pseudo-option allowing an additional set of  options  and  a
       patch file operand to be given. This was seen as being insufficiently useful to standardize.

       In  historical  implementations,  if the string <b>"Prereq:"</b> appeared in the header, the <u>patch</u> utility would
       search for the corresponding version information (the  string  specified  in  the  header,  delimited  by
       &lt;blank&gt; characters or the beginning or end of a line or the file) anywhere in the original file. This was
       deleted as too simplistic and insufficiently trustworthy a mechanism to standardize. For example, if:

           Prereq: 1.2

       were in the header, the presence of a delimited 1.2 anywhere in the file would satisfy the prerequisite.

       The  following  options were dropped from historical implementations of <u>patch</u> as insufficiently useful to
       standardize:

       <b>-b</b>        The <b>-b</b> option historically provided a method for changing the name extension of the backup file
                 from the default <b>.orig</b>.  This  option  has  been  modified  and  retained  in  this  volume  of
                 POSIX.1‐2017.

       <b>-F</b>        The  <b>-F</b>  option  specified the number of lines of a context diff to ignore when searching for a
                 place to install a patch.

       <b>-f</b>        The <b>-f</b> option historically caused <u>patch</u> not to request additional information from the user.

       <b>-r</b>        The <b>-r</b> option historically provided a method of overriding the extension  of  the  reject  file
                 from the default <b>.rej</b>.

       <b>-s</b>        The <b>-s</b> option historically caused <u>patch</u> to work silently unless an error occurred.

       <b>-x</b>        The <b>-x</b> option historically set internal debugging flags.

       In some file system implementations, the saving of a <b>.orig</b> file may produce unwanted results. In the case
       of  12,  13,  or  14-character filenames (on file systems supporting 14-character maximum filenames), the
       <b>.orig</b> file overwrites the new file. The  reject  file  may  also  exceed  this  filename  limit.  It  was
       suggested, due to some historical practice, that a &lt;tilde&gt; (<b>'~'</b>) suffix be used instead of <b>.orig</b> and some
       other character instead of the <b>.rej</b> suffix. This was rejected because it is not obvious to the user which
       file is which. The suffixes <b>.orig</b> and <b>.rej</b> are clearer and more understandable.

       The  <b>-b</b>  option has the opposite sense in some historical implementations—do not save the <b>.orig</b> file. The
       default case here is not to save the files, making <u>patch</u> behave more consistently with the other standard
       utilities.

       The <b>-w</b> option in early proposals was changed to <b>-l</b> to match historical practice.

       The <b>-N</b> option was included because without it, a non-interactive  application  cannot  reject  previously
       applied patches. For example, if a user is piping the output of <u>diff</u> into the <u>patch</u> utility, and the user
       only wants to patch a file to a newer version non-interactively, the <b>-N</b> option is required.

       Changes  to  the  <b>-l</b>  option  description  were proposed to allow matching across &lt;newline&gt; characters in
       addition to just &lt;blank&gt; characters. Since this is not historical practice, and  since  some  ambiguities
       could  result,  it is suggested that future developments in this area utilize another option letter, such
       as <b>-L</b>.

       The <b>-u</b> option of GNU <u>patch</u> has been added, along with support for unified context formats.

</pre><h4><b>FUTURE</b> <b>DIRECTIONS</b></h4><pre>
       None.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>diff</u>, <u>ed</u>

       The Base Definitions volume of POSIX.1‐2017, <u>Chapter</u> <u>8</u>,  <u>Environment</u>  <u>Variables</u>,  <u>Section</u>  <u>12.2</u>,  <u>Utility</u>
       <u>Syntax</u> <u>Guidelines</u>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1-2017, Standard
       for  Information  Technology  --  Portable  Operating  System  Interface  (POSIX),  The  Open  Group Base
       Specifications Issue 7, 2018 Edition, Copyright (C) 2018 by the Institute of Electrical  and  Electronics
       Engineers, Inc and The Open Group.  In the event of any discrepancy between this version and the original
       IEEE  and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document.
       The original Standard can be obtained online at <a href="http://www.opengroup.org/unix/online.html">http://www.opengroup.org/unix/online.html</a> .

       Any typographical or formatting errors that appear in this page are most likely to have  been  introduced
       during   the   conversion  of  the  source  files  to  man  page  format.  To  report  such  errors,  see
       https://www.kernel.org/doc/man-pages/reporting_bugs.html .

IEEE/The Open Group                                   2017                                         <u><a href="../man1POSIX/PATCH.1POSIX.html">PATCH</a></u>(1POSIX)
</pre>
 </div>
</div></section>
</div>
</body>
</html>