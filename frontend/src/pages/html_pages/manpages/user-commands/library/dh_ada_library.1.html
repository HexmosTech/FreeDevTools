<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dh_ada_library - help packaging Ada libraries for Debian</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/dh-ada-library">dh-ada-library_9.8_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       dh_ada_library - help packaging Ada libraries for Debian

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>dh_ada_library</b> [<u>debhelper</u> <u>options</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>dh_ada_library</b> is a debhelper program that handles some common tasks in packaging libraries written in
       the Ada programming language.

       The difficult work is to convince the upstream build system to produce both a static and a relocatable
       library in a row (during the <b>dh_auto_configure</b> and <b>dh_auto_build</b> steps), then to install these under
       <b>debian/tmp/</b> with the directory structure described by the Debian Policy for Ada (<b>dh_auto_install</b>).  The
       <b>/usr/share/ada/packaging.mk</b> Makefile snippet, part of the same <b>dh-ada-library</b> package, may help for that.
       It contains lots of comments describing its usage.

       Once the files are installed, <b>dh_ada_library</b> is in charge of dispatching them to the specific package
       temporary directories.  It is enabled by the presence of the <b>dh-sequence-ada-library</b> virtual package in
       the <b>Build-Depends-Arch</b> field of the <b>debian/control</b> file.  For a while, you should in addition depend on
       the explicit <b>dh-ada-library</b> concrete package and require at least version 9, because this version
       introduces incompatible changes, and virtual packages cannot receive version restrictions.

       At start, it parses <u>debian/control</u> to find Ada libraries: architecture-dependent packages, named
       <b>lib</b><u>name</u><b>-dev</b>, depending on <b>${ada:Depends}</b> and providing <b>${ada:Provides}</b>.

       For each one, there must also be a runtime library package, named from the shared object name as
       described in section 8 of the Debian Policy (usually <b>lib</b><u>name</u><b>-</b><u>SOversion</u>).

       For a description of <u>DEB_HOST_MULTIARCH</u>, see <b><a href="../man1/dpkg-architecture.1.html">dpkg-architecture</a></b>(1).  The installation directories
       (<u>DEB_ADA_SOURCE_DIR</u>, <u>DEB_LIB_DIR</u>, <u>DEB_ADA_LIB_INFO_DIR</u> and <u>DEB_GNAT_PROJECT_DIR</u>) are defined in the
       Debian Policy, their current values are available via <b>packaging.mk</b>.

   <b>Runtime</b> <b>library</b> <b>package</b>
       The following files are copied from <b>debian/tmp/</b> to <b>debian/lib</b><u>name</u><b>-</b><u>SOversion</u><b>/</b>.

       <u>DEB_LIB_DIR</u><b>/</b><u>shared</u> <u>library</u>
           The   concrete   file   containing   the   shared   library.    It   is   found   by   following  the
           <b>debian/tmp/</b><u>DEB_LIB_DIR</u><b><a href="file:/lib">/lib</a></b><u>name</u><b>.so</b> symbolic link.

       <u>DEB_LIB_DIR</u><b>/</b><u>SOname</u>
           The shared object name (<u>SOname</u>) is extracted from the binary data in  the  shared  library,  and  may
           differ  from  the file name.  If so, this symbolic link also refers to the <u>shared</u> <u>library</u> and is also
           installed (for ldconfig, see the Debian Policy for details).

           <b>dh_link</b> later removes the redundant path components like <b>lib/..</b>.

       Versions before 8.1 were ignoring the SOname/Library_Version, and guessing it from the SOversion  in  the
       Debian package name.  Patches caused by this unfortunate decision can now be unapplied.

   <b>Development</b> <b>package</b> <b>(-dev)</b>
       The following files are copied from <b>debian/tmp/</b> to <b>debian/lib</b><u>name</u><b>/</b>.

       <u>DEB_ADA_LIB_INFO_DIR</u><b>/</b><u>name</u><b>/</b><u>*</u><b>.ali</b>
           The  GNAT  Ada  Library  Information  files  files created along the objects when building the shared
           library.

           <b>dh_fixperms</b> later checks that their permissions are 444.

           In order to improve build reproducibility, <u>-f*-prefix-map</u> compiler flags are removed from them.

       <u>DEB_ADA_SOURCE_DIR</u><b>/</b><u>name</u><b>/</b><u>*</u>
           The sources, Ada or not, should all be in a single directory.

       <u>DEB_LIB_DIR</u><b><a href="file:/lib">/lib</a></b><u>name</u><b>.a</b>
           The static archive.

       <u>DEB_GNAT_PROJECT_DIR</u><b>/</b><u>name</u><b>.gpr</b>
           This standalone library GNAT project intended for use after installation.

           If the library was built with <b>gprbuild</b> and another GNAT project, the  <b>gprinstall</b>  tool  can  generate
           such  a standalone project with the correct <b>Languages</b>, <b>Linker_Switches</b> in the <b>Linker</b> package, imports
           (<b>with</b>), source file renamings...  Else, the maintainer must write a new project, or  more  accurately
           generate  it  because  <b>DEB_HOST_MULTIARCH</b>  cannot  be  hardcoded.   If  so, it is recommended to also
           substitute the path variables set by <b>/usr/share/ada/packaging.mk</b>, in  case  the  directory  structure
           ever has to change (again).

           In  order  to  improve build reproducibility, <u>-f*-prefix-map</u> compiler flags are removed (for examples
           because <b>gprbuild</b> has copied variables like <b>ADAFLAGS</b> from the build project).

       <u>DEB_LIB_DIR</u><b><a href="file:/lib">/lib</a></b><u>name</u><b>.so</b>
           The development symbolic link is installed here, but dangling because the concrete shared library  is
           in the runtime library package.

           <b>dh_link</b> later removes the redundant path components like <b>lib/..</b>.

       <b>ada:Depends</b>
           This debhelper substitution variable is created for inclusion in the <b>Depends</b> field of the <b>lib</b><u>name</u><b>-dev</b>
           package in <b>debian/control</b>.  Its value contains the following dependencies.

           <b>lib</b><u>name</u><b>-</b><u>SOversion</u> <b>(=</b> <b>${binary:Version})</b>
               The  development  package  needs  the  same version of the runtime library package because of the
               dangling symbolic link.

           <b>gnat</b> <b>(&gt;=</b> <u>DEB_GNAT_VERSION</u><b>),</b> <b>gnat</b> <b>(&lt;&lt;</b> <u>DEB_GNAT_VERSION</u> <u>+</u> <u>1</u><b>)</b>
               The development package requires the default Ada compiler in order to  ensure  the  compatibility
               with all other Ada packages.

           <b>gnat-</b><u>DEB_GNAT_VERSION</u><b>-</b><u>HASH</u>
               This virtual package reflects the (host) version of the run-time library used during the build.

           More  items  are  added as described in the next sections in order to reflect the dependencies across
           Ada library packages.

       <b>ada:Provides</b>
           This debhelper substitution  variable  is  created  for  inclusion  in  the  <b>Provides</b>  field  of  the
           <b>lib</b><u>name</u><b>-dev</b> package in <b>debian/control</b>.

           It  only  contains <b>lib</b><u>name</u><b>-dev-</b><u>HASH</u>, where <u>HASH</u> is a 32 bit XOR of all checksums in the <b>.ali</b> files (8
           lowercase hexadecimal digits).

       Imported projects
           In addition, <b>dh_ada_library</b> searches <b>debian/tmp/</b><u>DEB_GNAT_PROJECT_DIR</u><b>/</b><u>name</u><b>.gpr</b> for  imported  projects
           (<b>with</b>).  For each imported library project <u>dep</u><b>.gpr</b>, a dependency is added into <b>ada:Depends</b>.

           If   <b>lib</b><u>dep</u><b>-dev</b>   is   built   from  the  same  source  package,  the  dependency  is  <b>lib</b><u>dep</u><b>-dev</b>  <b>(=</b>
           <b>${binary:Version})</b>, ensuring that all static libraries are compiled with compatible options.  Such  a
           restriction is more specific than a hash suffix.

           If  <b>lib</b><u>dep</u><b>-dev</b> is not built from the same source but is installed on the system, in other words if it
           is listed in <b>Build-Depends</b>, the dependency is on the <b>lib</b><u>dep</u><b>-dev-</b><u>hash</u> virtual package provided by  the
           installed  concrete  <b>lib</b><u>dep</u><b>-dev</b>.  It prevents later installation of an update of <b>lib</b><u>dep</u><b>-dev</b> modifying
           its ALI checksums.

           Remaining projects trigger a warning, because the maintainer will need to find the right dependency.

       Versions before 8.1 were guessing more dependencies from <b>Linker'Linker_Options</b>.  This  was  often  wrong,
       for no benefit since C -dev packages carry no version and can be hard-coded in <b>debian/control</b>.

   <b>Files</b> <b>that</b> <b>are</b> <b>not</b> <b>installed</b>
       The  following  files,  if  they  exist  under  <b>debian/tmp/</b>,  are  ignored  but  marked  as  installed by
       <b>dh_ada_library</b> in order to prevent a false alert by <b>dh_missing</b> later, as if  the  files  were  listed  in
       <b>debian/not-installed</b>.

       <b>usr/unwantedly_gprinstalled/</b>
           Please refer to <b>/usr/share/ada/packaging.mk</b>.

       <u>DEB_LIB_DIR</u><b><a href="file:/lib">/lib</a></b><u>name</u><b>.la</b>
           The Debian Policy recommends not to install libtool <b>.la</b> files.

</pre><h4><b>REMARKS</b></h4><pre>
       It  would be easy to fix the directory structure, and versions before 8.1 were doing exactly this, at the
       cost of generating a project with different paths.  Now that gprinstall is almost capable of dealing with
       stagged installs, duplicating its job seems a waste of energy.

       For now, <u>DEB_ADA_SOURCE_DIR</u> and <u>DEB_GNAT_PROJECT_DIR</u> are under <b>/usr/share/ada/</b>.  This  implies  that  the
       -dev  package  cannot  be declared <b>Multi-Arch:</b> <b>same</b> as the content of the project (and maybe of generated
       sources) will vary across architectures.

       The <u>Linker'Linker_Options</u> attribute should rarely be needed.  A  dependency  written  in  Ada  should  be
       described  by  an imported project, also handling <u>.ali</u> files.  A dependency written in C should be listed
       in <u>Library_Options</u> when building a shared library, and  in  <u>Linker'Linker_Options</u>  when  using  a  static
       archive,  but  is  not  always  required  in <u>Linker'Linker_Options</u> for shared libraries.  Until now, such
       options have only proved useful to light bindings importing C symbols from a specification or an  inlined
       procedure.   In  a  <u>foo.pc</u>  file  as  read  by  <b>pkg-config</b>,  they  are  named  <u>Libs</u>,  excluding <u>-lfoo</u> and
       <u>Libs.private</u>.

</pre><h4><b>OPTIONS</b></h4><pre>
       Common debhelper command line options and environment variables are recognized.

       <b>--export-versions</b>
           This option is intended for support of <b>packaging.mk</b>.  Print Makefile definitions  for  the  variables
           described in it.

</pre><h4><b>EXAMPLES</b></h4><pre>
       This stanza in <b>debian/rules</b> may help debugging.

         override_dh_ada_library:
               dh_ada_library -v"

</pre><h4><b>VERSIONS</b></h4><pre>
       The  version  is  composed  of  two numbers separated by a dot.  The second one increases during a normal
       update, which supposedly fixes bugs, introduces compatible  evolutions,  or  remove  stuff  unused  since
       <u>oldoldstable</u>.   A  change  in  the  first one announces an incompatibility requiring some users to modify
       their source package.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/debhelper.7.html">debhelper</a></b>(7),           <b><a href="../man5/deb-substvars.5.html">deb-substvars</a></b>(5),           the            <b>Debian</b>            <b>Policy</b>            at
       &lt;https://www.debian.org/doc/debian-policy/ch-sharedlibs.html#run-time-shared-libraries&gt;,    the    <b>Debian</b>
       <b>Policy</b> <b>for</b> <b>Ada</b> at &lt;<a href="http://people.debian.org/~lbrenta/debian-ada-policy.html">http://people.debian.org/~lbrenta/debian-ada-policy.html</a>&gt;, and  the  documentation  of
       GNAT project tools installed into <b>/usr/share/doc/gprbuild</b> by the gprbuild-doc package.

</pre><h4><b>AUTHOR</b></h4><pre>
       Nicolas Boulenguez &lt;<a href="mailto:nicolas@debian.org">nicolas@debian.org</a>&gt;

9.8                                                2025-02-24                                  <u><a href="../man1/DH_ADA_LIBRARY.1.html">DH_ADA_LIBRARY</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>