<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pki --est - Enroll an X.509 certificate with an EST server</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/strongswan-pki">strongswan-pki_5.9.13-2ubuntu4_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pki --est - Enroll an X.509 certificate with an EST server

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pki</b> <b>--est</b> <b>---url</b> <u>url</u> [<b>--label</b> <u>label</u>] [<b>--in</b> <u>file</u>] <b>--cacert</b> <u>file</u> [<b>--cert</b> <u>file</u>|<b>--certid</b> <u>hex</u> <b>--key</b>
                 <u>file</u>|<b>--keyid</b> <u>hex</u>] [<b>--userpass</b> <u>username:password</u>] [<b>--interval</b> <u>time</u>] [<b>--maxpolltime</b> <u>time</u>]
                 [<b>--outform</b> <u>encoding</u>] [<b>--debug</b> <u>level</u>]

       <b>pki</b> <b>--est</b> <b>--options</b> <u>file</u>

       <b>pki</b> <b>--est</b> <b>-h</b> | <b>--help</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This sub-command of <b><a href="../man1/pki.1.html">pki</a></b>(1) sends a PKCS#10 certificate request via HTTPS to a server using the Enrollment
       over  Secure  Transport  (EST)  Protocol  (RFC  7030).  After  successful authorization which with manual
       authentication requires periodic polling by the enrollment  client,  the  EST  server  returns  an  X.509
       certificate signed by the CA.

       Before  the  expiry of the current certificate, a new client certificate based on a fresh private key can
       be requested, using the old certificate and the old key for automatic TLS client authentication with  the
       EST server.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-h,</b> <b>--help</b>
              Print usage information with a summary of the available options.

       <b>-v,</b> <b>--debug</b> <u>level</u>
              Set debug level, default: 1.

       <b>-+,</b> <b>--options</b> <u>file</u>
              Read command line options from <u>file</u>.

       <b>-u,</b> <b>--url</b> <u>url</u>
              URL of the EST server.

       <b>-l,</b> <b>--label</b> <u>label</u>
              Label in the EST server path.

       <b>-i,</b> <b>--in</b> <u>file</u>
              PKCS#10 certificate request. If not given, the certificate request is read from <u>STDIN</u>.

       <b>-C,</b> <b>--cacert</b> <u>file</u>
              CA  certificate  in the trust chain used for EST TLS server signature verification or in the trust
              chain to verify the client certificate issued by the CA.  Can be used multiple times.

       <b>-c,</b> <b>--cert</b> <u>file</u>
              Client certificate to be renewed.

       <b>-X,</b> <b>--certid</b> <u>hex</u>
              Smartcard or TPM 2.0 client certificate object handle.

       <b>-k,</b> <b>--key</b> <u>file</u>
              Client private key to be replaced.

       <b>-x,</b> <b>--keyid</b> <u>hex</u>
              Smartcard or TPM 2.0 client private key object handle.

       <b>-p,</b> <b>--userpass</b> <u>username:password</u>
              Optional username:password that may be used for HTTP basic authentication.

       <b>-t,</b> <b>--interval</b> <u>time</u>
              Poll interval in seconds, defaults to <u>60s</u>. This value might  get  overridden  by  the  <b>retry-after</b>
              header in the HTTP 202 reply from the EST server.

       <b>-m,</b> <b>--maxpolltime</b> <u>time</u>
              Maximum poll time in seconds, defaults to <u>0</u> which means unlimited polling.

       <b>-f,</b> <b>--outform</b> <u>encoding</u>
              Encoding  of the created certificate file. Either <u>der</u> (ASN.1 DER) or <u>pem</u> (Base64 PEM), defaults to
              <u>der</u>.

</pre><h4><b>EXAMPLES</b></h4><pre>
       To save some typing work the following command line options are stored in a <u>est.opt</u> file:

       --url https://pki.strongswan.org:8443
       --cacert tlsca.crt
       --cacert tlsca-1.crt
       --cacert myca.crt
       --cacert myca-1.crt

       <b>NOTE:</b> For a successful HTTPS connection, trust must be established into the EST server  certificate.  The
       TLS  trust  chain  including  the root CA certificate and optionally intermediate CA certificates must be
       given using multiple <b>--cacert</b> options.

       The <b>--cacert</b> option must also be used to be able to verify the received client certificate issued by  the
       CA.  This  second trust chain might be identical to the TLS trust chain (if the EST server is using a TLS
       server certificate issued by its own CA) or might be totally different,  e.g.  if  a  Let's  Encrypt  EST
       server certificate is used.

       With  the  following command, an X.509 certificate signed by the intermediate CA is requested from an EST
       server based on a PKCS#10 certificate request:

       pki --options est.opt --in moonReq.der &gt; moonCert.der

       negotiated TLS 1.3 using suite TLS_AES_256_GCM_SHA384
       received TLS server certificate 'C=CH, O=strongSwan Project, CN=pki.strongswan.org'
         using certificate "C=CH, O=strongSwan Project, CN=pki.strongswan.org"
         using trusted intermediate ca certificate "C=CH, O=strongSwan Project, CN=strongSwan Issuing CA"
         using trusted ca certificate "C=CH, O=strongSwan Project, CN=strongSwan Root CA"
         reached self-signed root ca with a path length of 1
         EST request pending, polling indefinitely every 300 seconds
         going to sleep for 300 seconds
         ...
       Issued certificate "C=CH, O=strongSwan Project, CN=moon.strongswan.org"
         serial: 1a:ff:de:66:d9:38:ea:d5:b6:da
         using certificate "C=CH, O=strongSwan Project, CN=moon.strongswan.org"
         using trusted intermediate ca certificate "C=CH, O=strongSwan Project, CN=strongSwan Issuing CA"
         using trusted ca certificate "C=CH, O=strongSwan Project, CN=strongSwan Root CA"
         reached self-signed root ca with a path length of 1
       Issued certificate is trusted, valid from Aug 22 15:19:43 2022 until Aug 22 15:19:43 2023 (currently valid)

       This certificate can be renewed some time before it expires with the command:

       pki --options est.opt --in moonReqNew.der --cert moonCert.der --key moonKey.der &gt; moonCertNew.der

       negotiated TLS 1.3 using suite TLS_AES_256_GCM_SHA384
       received TLS server certificate 'C=CH, O=strongSwan Project, CN=pki.strongswan.org'
         using certificate "C=CH, O=strongSwan Project, CN=pki.strongswan.org"
         using trusted intermediate ca certificate "C=CH, O=strongSwan Project, CN=strongSwan Issuing CA"
         using trusted ca certificate "C=CH, O=strongSwan Project, CN=strongSwan Root CA"
         reached self-signed root ca with a path length of 1
       sending TLS client certificate 'C=CH, O=strongSwan Project, CN=moon.strongswan.org'
       sending TLS intermediate certificate 'C=CH, O=strongSwan Project, CN=strongSwan Issuing CA'
       Issued certificate "C=CH, O=strongSwan Project, CN=moon.strongswan.org"
         serial: 1b:ff:ad:dc:2f:50:c4:cb:a1:44
         using certificate "C=CH, O=strongSwan Project, CN=moon.strongswan.org"
         using trusted intermediate ca certificate "C=CH, O=strongSwan Project, CN=strongSwan Issuing CA"
         using trusted ca certificate "C=CH, O=strongSwan Project, CN=strongSwan Root CA"
         reached self-signed root ca with a path length of 1
       Issued certificate is trusted, valid from Jul 20 12:21:00 2023 until Jul 20 12:21:00 2024 (currently valid)

       If the private key and the certificate of the client is stored in a TPM 2.0, the renewal can be done with
       the following options:

       pki --options est.opt --in moonReqNew.der --certid 0x01800004 --keyid 0x81010004 &gt; moonCertNew.der

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/pki.1.html">pki</a></b>(1)

5.9.13                                             2022-08-22                                       <u>PKI</u> <u>--<a href="../man1/EST.1.html">EST</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>