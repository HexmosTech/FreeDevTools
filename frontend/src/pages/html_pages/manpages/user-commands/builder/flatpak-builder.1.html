<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flatpak-builder - Help build application dependencies</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/flatpak-builder">flatpak-builder_1.4.4-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       flatpak-builder - Help build application dependencies

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>flatpak-builder</b> [OPTION...] DIRECTORY MANIFEST

       <b>flatpak-builder</b> --run [OPTION...] DIRECTORY MANIFEST COMMAND

       <b>flatpak-builder</b> --show-deps [OPTION...] MANIFEST

       <b>flatpak-builder</b> --show-manifest [OPTION...] MANIFEST

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>flatpak-builder</b> is a wrapper around the <b>flatpak</b> <b>build</b> command that automates the building of applications
       and their dependencies. It is one option you can use to build applications.

       The goal of <b>flatpak-builder</b> is to push as much knowledge about how to build modules to the individual
       upstream projects. It does this by assuming that the modules adhere to the Build API specified at
       https://github.com/cgwalters/build-api. This essentially means that it follows the <b>./configure</b> <b>&amp;&amp;</b> <b>make</b> <b>&amp;&amp;</b>
       <b>make</b> <b>install</b> scheme with an optional autogen script. If the upstream does not adhere to the API you can
       make it do so by adding patches and extra files.

       An invocation of <b>flatpak-builder</b> proceeds in these stages, each being specified in detail in json format
       in MANIFEST:

       •   Download all sources

       •   Initialize the application directory with <b>flatpak</b> <b>build-init</b>

       •   Build and install each module with <b>flatpak</b> <b>build</b>

       •   Clean up the final build tree by removing unwanted files and e.g. stripping binaries

       •   Finish the application directory with <b>flatpak</b> <b>build-finish</b>

       After this you will end up with a build of the application in DIRECTORY, which you can export to a
       repository with the <b>flatpak</b> <b>build-export</b> command. If you use the <b>--repo</b> option, flatpak-builder will do
       the export for you at the end of the build process. When flatpak-builder does the export, it also stores
       the manifest that was used for the build in /app/manifest.json. The manifest is 'resolved', i.e. git
       branch names are replaced by the actual commit IDs that were used in the build.

       At each of the above steps flatpak caches the result, and if you build the same file again, it will start
       at the first step where something changes. For instance the first version controlled source that had new
       commits added, or the first module where some changes to the MANIFEST file caused the build environment
       to change. This makes flatpak-builder very efficient for incremental builds.

       When building a flatpak to be published to the internet, <b>--collection-id=COLLECTION-ID</b> should be
       specified as a globally unique reverse DNS value to identify the collection of flatpaks this will be
       added to. Setting a globally unique collection ID allows the apps in the repository to be shared over
       peer to peer systems without needing further configuration.

</pre><h4><b>MANIFEST</b></h4><pre>
       The manifest file is a json or yaml file whose format is described in detail in its own manual page.

</pre><h4><b>OPTIONS</b></h4><pre>
       The following options are understood:

       <b>-h</b>, <b>--help</b>
           Show help options and exit.

       <b>-v</b>, <b>--verbose</b>
           Print debug information during command processing.

       <b>--version</b>
           Print version information and exit.

       <b>--arch=ARCH</b>
           Specify the machine architecture to build for. If no architecture is specified, the host architecture
           will be automatically detected. Only host compatible architectures can be specified.

       <b>--default-branch=</b><u>BRANCH</u>
           Set the default branch to <u>BRANCH</u>. This is used if the manifest does not specify a branch. The default
           is master.

       <b>--disable-cache</b>
           Don't look at the existing cache for a previous build, instead always rebuild modules.

       <b>--disable-rofiles-fuse</b>
           Disable the use of rofiles-fuse to optimize the cache use via hardlink checkouts.

       <b>--disable-download</b>
           Don't download any sources. This only works if some version of all sources are downloaded already.
           This is useful if you want to guarantee that no network i/o is done. However, the build will fail if
           some source is not locally available.

       <b>--disable-updates</b>
           Download missing sources, but don't update local mirrors of version control repos. This is useful to
           rebuild things but without updating git, bzr or svn repositories from the remote repository.

       <b>--disable-tests</b>
           Don't run any of the tests.

       <b>--run</b>
           Run a command in a sandbox based on the build dir. This starts flatpak build, with some extra
           arguments to give the same environment as the build, and the same permissions the final app will have
           (except filesystem permissions). The command to run must be the last argument passed to
           flatpak-builder, after the directory and the manifest.

           Only the <b>--arch=</b><u>ARCH</u>, <b>--ccache</b> and <b>--verbose</b> options can be combined with this option.

       <b>--build-shell=MODULENAME</b>
           Extract and prepare the sources for the named module, and then start a shell in a sandbox identical
           to the one flatpak-builder would use for building the module. This is useful to debug a module.

       <b>--show-deps</b>
           List all the (local) files that the manifest depends on.

           Only the <b>--verbose</b> option can be combined with this option.

       <b>--show-manifest</b>
           Loads the manifest, including any included files and prints it in a canonical json format. This is
           useful for tools that want to handle manifest files to avoid having to support both yaml and json, as
           well as some non-standard json handling that is supported (for example comments and multiline
           strings).

           Only the <b>--verbose</b> option can be combined with this option.

       <b>--download-only</b>
           Exit successfully after downloading the required sources.

       <b>--bundle-sources</b>
           Create an additional runtime with the source code for this module. It will be named <u>app-id</u>.Sources,
           for example org.gnome.Maps.Sources.

       <b>--build-only</b>
           Don't do the cleanup and finish stages, which is useful if you want to build more things into the
           app.

       <b>--finish-only</b>
           Only do the cleanup, finish and export stages, picking up where a --build-only command left off.

       <b>--export-only</b>
           Only do the export stages, picking up the build result from a previous build. This can be used to
           split the build and export/signature into two calls by leaving out --repo in the first call.

       <b>--require-changes</b>
           Do nothing, leaving a non-existent DIRECTORY if nothing changes since last cached build. If this is
           not specified, the latest version from the cache will be put into DIRECTORY.

       <b>--state-dir=PATH</b>
           Use this directory for storing state (downloads, build dirs, build cache, etc) rather than
           .flatpak-builder. This can be an absolute or relative path, but must be on the same filesystem as the
           specified target DIRECTORY.

       <b>--keep-build-dirs</b>
           Don't remove the sources and build after having built and installed each module. This also creates a
           symlink to the build directory with a stable name ("build-modulename").

       <b>--delete-build-dirs</b>
           Always remove the sources and build after having built each module, even if the build failed. The
           default is to keep failed build directories but remove successful ones. This is useful in e.g.
           automatic build systems.

       <b>--ccache</b>
           Enable use of ccache in the build (needs ccache in the sdk). The default ccache folder can be
           overridden by setting the environment variable CCACHE_DIR.

       <b>--stop-at=MODULENAME</b>
           Stop at the specified module, ignoring it and all the following ones in both the "download" and
           "build" phases. This is useful for debugging and development. For instance, you can build all the
           dependencies, but stop at the main application so that you can then do a build from a pre-existing
           checkout. Implies --build-only.

       <b>--repo=DIR</b>
           After the build finishes, run <b>flatpak</b> <b>build-export</b> to export the result to the repository DIR. If DIR
           exists, it must be an OSTree repository; otherwise a new one will be created.

       <b>-s</b>, <b>--subject=SUBJECT</b>
           One line subject for the commit message. Used when exporting the build results.

       <b>-b</b>, <b>--body=BODY</b>
           Full description for the commit message. Used when exporting the build results.

       <b>--collection-id=COLLECTION-ID</b>
           Set as the collection ID of the repository. Setting a globally unique collection ID allows the apps
           in the repository to be shared over peer to peer systems without needing further configuration. If
           building in an existing repository, the collection ID must match the existing configured collection
           ID for that repository.

       <b>--token-type=VAL</b>
           Set type of token needed to install this commit. Setting this to a value greater than 0 implies that
           authentication will be needed to install the flatpak. A <b>token-type</b> property set in the manifest takes
           precedence over this option. Used when exporting the build results.

       <b>--gpg-sign=KEYID</b>
           Sign the commit with this GPG key. Used when exporting the build results. This option can be used
           multiple times.

       <b>--gpg-homedir=PATH</b>
           GPG Homedir to use when looking for keyrings. Used when exporting the build results.

       <b>--jobs=JOBS</b>
           Limit the number of parallel jobs during the build. The default is the number of CPUs on the machine.

       <b>--force-clean</b>
           Erase the previous contents of DIRECTORY if it is not empty.

       <b>--sandbox</b>
           Disable the possibility to specify build-args that are passed to flatpak build. This means the build
           process can't break out of its sandbox, and is useful when building less trusted software.

       <b>--allow-missing-runtimes</b>
           Do not immediately fail if the sdk or platform runtimes are not installed on this system. Attempting
           to build any manifest modules will still fail if the sdk is missing, but may be useful for apps that
           install files without a sandbox build.

       <b>--rebuild-on-sdk-change</b>
           Record the exact version of the sdk in the cache, and rebuild everything if it changes. This is
           useful if you're building against an API-unstable runtime, like a nightly build.

       <b>--skip-if-unchanged</b>
           If the json is unchanged since the last build of this filename, then do nothing, and return exit code
           42.

       <b>--mirror-screenshots-url=URL</b>
           Mirror any screenshots in the appstream and rewrite the appstream xml as if they were on the
           specified URL. The resulting files will be stored in the "screenshots" subdirectory in the app
           directory and needs to be copied to the specified URL for the appdata to work.

       <b>--extra-sources=SOURCE-DIR</b>
           When downloading sources (archives, files, git, bzr, svn), look in this directory for pre-existing
           copies and use them instead of downloading.

       <b>--extra-sources-url=URL</b>
           When downloading sources (archives, files, git, bzr, svn), look at this url for mirrored downloads
           before downloading from the original url.

       <b>--from-git=GIT</b>
           Look for the manifest in the given git repository. If this option is given, MANIFEST is interpreted
           as a relative path inside the repository.

       <b>--from-git-branch=BRANCH</b>
           The branch to use with --from-git.

       <b>--no-shallow-clone</b>
           Don't use shallow clones when mirroring git repos.

       <b>--add-tag=TAG</b>
           Add this tag to the tags list of the manifest before building.

       <b>--remove-tag=TAG</b>
           Remove this tag to the tags list of the manifest before building. The remove happen before processing
           the --add-tag option, so if both are specified, then --app-tag wins.

       <b>--install-deps-from=REMOTE</b>
           Install/update build required dependencies from the specified remote.

       <b>--install-deps-only</b>
           Stop after downloading dependencies.

       <b>--install</b>
           When the build is finished, install the result locally.

       <b>--user</b>
           Install the dependencies in a per-user installation.

       <b>--system</b>
           Install the dependencies in the default system-wide installation.

       <b>--installation=NAME</b>
           Install the dependencies in a system-wide installation specified by NAME among those defined in
           /etc/flatpak/installations.d/. Using --installation=default is equivalent to using --system.

</pre><h4><b>CACHING</b></h4><pre>
       flatpak-builder caches sources and partial build results in the state directory (defaulting to the
       .flatpak-builder subdirectory of the current directory). If you use <b>--keep-build-dirs</b>, build directories
       for each module are also stored here.

       It is safe to remove the state directory. This will force a full build the next time you build.

</pre><h4><b>EXAMPLES</b></h4><pre>
       <b>$</b> <b>flatpak-builder</b> <b>my-app-dir</b> <b>manifest.json</b>

       Example manifest file:

           {
               "id": "org.test.TestApp",
               "runtime": "org.freedesktop.Platform",
               "runtime-version": "1.2",
               "sdk": "org.freedesktop.Sdk",
               "command": "test",
               "cleanup": [ "/include", "*.la" ],
               "build-options" : {
                   "cflags": "-O2 -g",
                   "cxxflags": "-O2 -g",
                   "env": {
                       "V": "1"
                   },
                   "arch": {
                       "x86_64": {
                           "cflags": "-O3 -g",
                       }
                   }
               },
               "modules": [
                   {
                       "name": "pygobject",
                       "config-opts": [ "--disable-introspection" ],
                       "sources": [
                           {
                               "type": "archive",
                               "url": "<a href="http://ftp.gnome.org/pub/GNOME/sources/pygobject/2.28/pygobject-2.28.6.tar.xz">http://ftp.gnome.org/pub/GNOME/sources/pygobject/2.28/pygobject-2.28.6.tar.xz</a>",
                               "sha256": "fb8a1d4f665130a125011659bd347c7339c944232163dbb9a34fd0686577adb8"
                           },
                           {
                               "type": "patch",
                               "path": "required-pygobject-fix.patch"
                           },
                           {
                               "type": "file",
                               "path": "pygobject-extra-file",
                               "dest-filename": "extra-file"
                           }
                       ]
                   },
                   {
                       "name": "babl",
                       "build-options" : { "cxxflags": "-O2 -g -std=c++11" },
                       "cleanup": [ "<a href="file:/bin">/bin</a>" ],
                       "sources": [
                           {
                               "type": "git",
                               "url": "https://gitlab.gnome.org/GNOME/babl.git"
                           }
                       ]
                   },
                   {
                       "name": "testapp",
                       "sources": [
                           {
                               "type": "bzr",
                               "url": "lp:testapp"
                           }
                       ]
                   }
               ]
           }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/flatpak.1.html">flatpak</a></b>(1), <b><a href="../man5/flatpak-manifest.5.html">flatpak-manifest</a></b>(5), <b><a href="../man1/flatpak-build-init.1.html">flatpak-build-init</a></b>(1), <b><a href="../man1/flatpak-build.1.html">flatpak-build</a></b>(1), <b><a href="../man1/flatpak-build-finish.1.html">flatpak-build-finish</a></b>(1),
       <b><a href="../man1/flatpak-build-export.1.html">flatpak-build-export</a></b>(1)

flatpak                                                                                       <u><a href="../man1/FLATPAK-BUILDER.1.html">FLATPAK-BUILDER</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>