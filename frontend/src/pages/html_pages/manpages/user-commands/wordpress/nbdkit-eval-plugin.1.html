<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nbdkit-eval-plugin - write a shell script plugin on the command line</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/nbdkit">nbdkit_1.42.2-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nbdkit-eval-plugin - write a shell script plugin on the command line

</pre><h4><b>SYNOPSIS</b></h4><pre>
        nbdkit eval get_size='SCRIPT' pread='SCRIPT' pwrite='SCRIPT' [...]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       "nbdkit-eval-plugin" is an <b><a href="../man1/nbdkit.1.html">nbdkit</a></b>(1) plugin which allows you to write custom plugins as shell scripts
       snippets ‘eval’d on the command line.

       A common alternative to this plugin is <b><a href="../man3/nbdkit-sh-plugin.3.html">nbdkit-sh-plugin</a></b>(3).  Both plugins share the same source code and
       work in almost the same way.  You should read <b><a href="../man3/nbdkit-sh-plugin.3.html">nbdkit-sh-plugin</a></b>(3) first.  It is easier to describe the
       differences between the two plugins and look at the examples below.

       •   <b><a href="../man3/nbdkit-sh-plugin.3.html">nbdkit-sh-plugin</a></b>(3)  plugins  are  written  as  a single script in a separate file.  Eval plugins are
           shell script fragments written on the nbdkit command line — there is no separate script file.

       •   <b><a href="../man3/nbdkit-sh-plugin.3.html">nbdkit-sh-plugin</a></b>(3) has no way to know if a method is missing or not and so each "can_*" method  (eg.
           "can_write")  must  be  written  explicitly.  In eval plugins you have the option of omitting "can_*"
           methods if the associated callback (eg. "pwrite") is defined.  In this way  eval  plugins  work  more
           like regular nbdkit plugins.

       •   Eval  plugins  can  only use <u><a href="file:/bin/sh">/bin/sh</a></u> to run the script snippets, but <b><a href="../man3/nbdkit-sh-plugin.3.html">nbdkit-sh-plugin</a></b>(3) (in spite of
           the name) can run any executable.

       •   There is no "load" method (although there is an "unload" method and all other methods are identical).

</pre><h4><b>EXAMPLES</b></h4><pre>
       Create a 64M read-only disk of zeroes:

        nbdkit eval get_size=' echo 64M ' \
                       pread=' dd if=/dev/zero count=$3 iflag=count_bytes '

       The following command is the eval plugin equivalent of <b><a href="../man1/nbdkit-file-plugin.1.html">nbdkit-file-plugin</a></b>(1)  (except  not  as  fast  and
       missing many features):

        nbdkit eval \
          config='ln -sf "$(realpath "$3")" $tmpdir/file' \
          get_size='stat -Lc %s $tmpdir/file' \
          pread='dd if=$tmpdir/file skip=$4 count=$3 iflag=count_bytes,skip_bytes' \
          pwrite='dd of=$tmpdir/file seek=$4 conv=notrunc oflag=seek_bytes' \
          file=disk.img

</pre><h4><b>PARAMETERS</b></h4><pre>
       <b>after_fork=</b>SCRIPT
       <b>block_size=</b>SCRIPT
       <b>cache=</b>SCRIPT
       <b>can_cache=</b>SCRIPT
       <b>can_extents=</b>SCRIPT
       <b>can_fast_zero=</b>SCRIPT
       <b>can_flush=</b>SCRIPT
       <b>can_fua=</b>SCRIPT
       <b>can_multi_conn=</b>SCRIPT
       <b>can_trim=</b>SCRIPT
       <b>can_write=</b>SCRIPT
       <b>can_zero=</b>SCRIPT
       <b>close=</b>SCRIPT
       <b>config=</b>SCRIPT
       <b>config_complete=</b>SCRIPT
       <b>default_export=</b>SCRIPT
       <b>dump_plugin=</b>SCRIPT
       <b>export_description=</b>SCRIPT
       <b>extents=</b>SCRIPT
       <b>flush=</b>SCRIPT
       <b>get_ready=</b>SCRIPT
       <b>get_size=</b>SCRIPT
       <b>is_rotational=</b>SCRIPT
       <b>list_exports=</b>SCRIPT
       <b>default_export=</b>SCRIPT
       <b>open=</b>SCRIPT
       <b>pread=</b>SCRIPT
       <b>preconnect=</b>SCRIPT
       <b>pwrite=</b>SCRIPT
       <b>thread_model=</b>SCRIPT
       <b>trim=</b>SCRIPT
       <b>unload=</b>SCRIPT
       <b>zero=</b>SCRIPT
           Define  the  script  associated  with  each  method.  "SCRIPT" is a fragment of shell script which is
           executed when nbdkit wants to invoke the associated method.

           If you are typing these commands at the shell, be careful about quoting.  Normally you will  need  to
           enclose "SCRIPT" in '...' (single quotes) to prevent it from being modified by your shell.

           The  script  fragment  behaves  the  same way as the corresponding method in <b><a href="../man3/nbdkit-sh-plugin.3.html">nbdkit-sh-plugin</a></b>(3).  In
           particular, parameters are identical, $tmpdir is present and used in the same way, the exit code must
           be one of the valid exit codes described in that manual page, and error handling works the  same  way
           too.  Likewise, <b>nbdkit</b> <b>--dump-plugin</b> <b>eval</b> includes a line for <b>max_known_status=</b> in nbdkit ≥ 1.34.

           Note  that  a  "config" callback will only handle keys not recognized as callback names; when picking
           key=value pairs that you want your script fragment to understand, be aware that if  a  future  nbdkit
           release creates a callback by that name, your "config" script fragment will no longer see that key.

           All of these parameters are optional.

       <b>missing=</b>SCRIPT
           The  parameter  "missing"  defines  a  script  that will be called in place of any other callback not
           explicitly provided.  If omitted, this defaults to the script "exit 2".

</pre><h4><b>ENVIRONMENT</b> <b>VARIABLES</b></h4><pre>
       "tmpdir"
           This is defined to the name of a temporary directory which can be used by the script snippets.  It is
           deleted when nbdkit exits.

</pre><h4><b>FILES</b></h4><pre>
       <u><a href="file:/bin/sh">/bin/sh</a></u>
           Shell script fragments are executed using <u><a href="file:/bin/sh">/bin/sh</a></u>.

       <u>$plugindir/nbdkit-eval-plugin.so</u>
           The plugin.

           Use "nbdkit --dump-config" to find the location of $plugindir.

</pre><h4><b>VERSION</b></h4><pre>
       "nbdkit-eval-plugin" first appeared in nbdkit 1.18.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/nbdkit.1.html">nbdkit</a></b>(1), <b><a href="../man3/nbdkit-plugin.3.html">nbdkit-plugin</a></b>(3), <b><a href="../man3/nbdkit-sh-plugin.3.html">nbdkit-sh-plugin</a></b>(3), <b><a href="../man1/nbdkit-cc-plugin.1.html">nbdkit-cc-plugin</a></b>(1).

</pre><h4><b>AUTHORS</b></h4><pre>
       Richard W.M. Jones

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright Red Hat

</pre><h4><b>LICENSE</b></h4><pre>
       Redistribution and use in source and binary forms, with or without modification, are  permitted  provided
       that the following conditions are met:

       •   Redistributions  of  source  code must retain the above copyright notice, this list of conditions and
           the following disclaimer.

       •   Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
           the following disclaimer in the documentation and/or other materials provided with the distribution.

       •   Neither the name of Red Hat nor the names of its contributors may  be  used  to  endorse  or  promote
           products derived from this software without specific prior written permission.

       THIS  SOFTWARE  IS  PROVIDED BY RED HAT AND CONTRIBUTORS ''AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
       INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND  FITNESS  FOR  A  PARTICULAR
       PURPOSE  ARE  DISCLAIMED.  IN  NO EVENT SHALL RED HAT OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
       INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,  PROCUREMENT  OF
       SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
       ON  ANY  THEORY  OF  LIABILITY,  WHETHER  IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
       OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
       DAMAGE.

nbdkit-1.42.2                                      2025-04-02                              <u><a href="../man1/nbdkit-eval-plugin.1.html">nbdkit-eval-plugin</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>