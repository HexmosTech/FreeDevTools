<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>borg-check - Check repository consistency</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/borgbackup2">borgbackup2_2.0.0b14-3build1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       borg-check - Check repository consistency

</pre><h4><b>SYNOPSIS</b></h4><pre>
       borg [common options] check [options]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  check  command  verifies the consistency of a repository and its archives.  It consists of two major
       steps:

       1. Checking the consistency of the repository itself. This includes checking the file magic headers,  and
          both  the  metadata  and  data  of all objects in the repository. The read data is checked by size and
          hash. Bit rot and other types of accidental damage can be detected this way.  Running  the  repository
          check  can  be  split  into  multiple  partial checks using <b>--max-duration</b>.  When checking a  &lt;ssh://&gt;
          remote repository, please note that the checks run on the server and do not cause significant  network
          traffic.

       2. Checking  consistency  and  correctness  of the archive metadata and optionally archive data (requires
          <b>--verify-data</b>). This includes ensuring that the repository manifest exists, the archive metadata chunk
          is present, and that all chunks referencing files (items) in the archive exist. This requires  reading
          archive and file metadata, but not data. To scan for archives whose entries were lost from the archive
          directory,  pass <b>--find-lost-archives</b>.  It requires reading all data and is hence very time consuming.
          To additionally cryptographically verify the file (content) data integrity, pass <b>--verify-data</b>,  which
          is even more time consuming.

          When  checking  archives of a remote repository, archive checks run on the client machine because they
          require decrypting data and therefore the encryption key.

       Both steps can also be run independently. Pass <b>--repository-only</b> to run the repository  checks  only,  or
       pass <b>--archives-only</b> to run the archive checks only.

       The  <b>--max-duration</b>  option  can  be  used to split a long-running repository check into multiple partial
       checks. After the given number of seconds the check is interrupted. The next partial check will  continue
       where  the  previous  one  stopped, until the full repository has been checked. Assuming a complete check
       would take 7 hours, then running a daily check with <b>--max-duration=3600</b> (1 hour) would result in one full
       repository check per week. Doing a full repository check aborts any  previous  partial  check;  the  next
       partial check will restart from the beginning. With partial repository checks you can run neither archive
       checks,  nor  enable  repair  mode.  Consequently,  if  you want to use <b>--max-duration</b> you must also pass
       <b>--repository-only</b>, and must not pass <b>--archives-only</b>, nor <b>--repair</b>.

       <b>Warning:</b> Please note that partial repository checks  (i.e.  running  it  with  <b>--max-duration</b>)  can  only
       perform  non-cryptographic  checksum  checks  on the repository files. Enabling partial repository checks
       excepts archive checks for the same reason. Therefore partial  checks  may  be  useful  with  very  large
       repositories only where a full check would take too long.

       The  <b>--verify-data</b>  option  will  perform  a full integrity verification (as opposed to checking just the
       xxh64) of data, which means reading the data from the repository, decrypting and decompressing it. It  is
       a  complete  cryptographic verification and hence very time consuming, but will detect any accidental and
       malicious corruption. Tamper-resistance is only guaranteed for encrypted repositories  against  attackers
       without access to the keys. You can not use <b>--verify-data</b> with <b>--repository-only</b>.

       The  <b>--find-lost-archives</b>  option  will also scan the whole repository, but tells Borg to search for lost
       archive metadata. If Borg encounters any archive metadata that doesn't match with  an  archive  directory
       entry (including soft-deleted archives), it means that an entry was lost.  Unless <b>borg</b> <b>compact</b> is called,
       these archives can be fully restored with <b>--repair</b>. Please note that <b>--find-lost-archives</b> must read a lot
       of  data  from  the repository and is thus very time consuming. You can not use <b>--find-lost-archives</b> with
       <b>--repository-only</b>.

   <b>About</b> <b>repair</b> <b>mode</b>
       The check command is a readonly task by default. If any corruption is found, Borg will report  the  issue
       and proceed with checking. To actually repair the issues found, pass <b>--repair</b>.

       <b>NOTE:</b>
          <b>--repair</b>  is  a  <b>POTENTIALLY</b> <b>DANGEROUS</b> <b>FEATURE</b> and might lead to data loss! This does not just include
          data that was previously lost anyway, but might include more data for kinds of corruption  it  is  not
          capable of dealing with. <b>BE</b> <b>VERY</b> <b>CAREFUL!</b>

       Pursuant  to  the  previous warning it is also highly recommended to test the reliability of the hardware
       running Borg with  stress  testing  software.  This  especially  includes  storage  and  memory  testers.
       Unreliable hardware might lead to additional data loss.

       It  is  highly  recommended  to  create  a  backup of your repository before running in repair mode (i.e.
       running it with <b>--repair</b>).

       Repair mode will attempt to fix any corruptions found. Fixing corruptions does not mean  recovering  lost
       data:  Borg  can  not  magically restore data lost due to e.g. a hardware failure. Repairing a repository
       means sacrificing some data for the sake of the repository as a whole and the remaining  data.  Hence  it
       is, by definition, a potentially lossy task.

       In practice, repair mode hooks into both the repository and archive checks:

       1. When  checking the repository's consistency, repair mode removes corrupted objects from the repository
          after it did a 2nd try to read them correctly.

       2. When checking the consistency and correctness of archives, repair mode  might  remove  whole  archives
          from  the  manifest  if  their  archive  metadata chunk is corrupt or lost. On a chunk level (i.e. the
          contents of files), repair mode will replace corrupt or lost chunks with a same-size replacement chunk
          of zeroes. If a previously zeroed chunk reappears, repair mode will restore this lost chunk using  the
          new chunk.

       Most  steps  taken  by repair mode have a one-time effect on the repository, like removing a lost archive
       from the repository. However, replacing a corrupt or lost chunk with an all-zero replacement will have an
       ongoing effect on the repository: When attempting to extract a file referencing an  all-zero  chunk,  the
       <b>extract</b>  command  will  distinctly  warn  about it. The FUSE filesystem created by the <b>mount</b> command will
       reject reading such a "zero-patched" file unless a special mount option is given.

       As mentioned earlier, Borg might be able to "heal" a "zero-patched" file  in  repair  mode,  if  all  its
       previously  lost  chunks  reappear  (e.g.  via a later backup). This is achieved by Borg not only keeping
       track of the all-zero replacement chunks, but also by keeping metadata about the lost chunks.  In  repair
       mode Borg will check whether a previously lost chunk reappeared and will replace the all-zero replacement
       chunk  by  the  reappeared  chunk. If all lost chunks of a "zero-patched" file reappear, this effectively
       "heals" the file.  Consequently, if lost chunks were repaired earlier, it is advised to  run  <b>--repair</b>  a
       second time after creating some new backups.

       If  <b>--repair</b>  <b>--find-lost-archives</b>  is  given,  previously  lost entries will be recreated in the archive
       directory. This is only possible before <b>borg</b> <b>compact</b> would remove the archives' data completely.

</pre><h4><b>OPTIONS</b></h4><pre>
       See <u><a href="../man1/borg-common.1.html">borg-common</a>(1)</u> for common options of Borg commands.

   <b>options</b>
       <b>--repository-only</b>
              only perform repository checks

       <b>--archives-only</b>
              only perform archives checks

       <b>--verify-data</b>
              perform cryptographic archive data integrity verification (conflicts with <b>--repository-only</b>)

       <b>--repair</b>
              attempt to repair any inconsistencies found

       <b>--find-lost-archives</b>
              attempt to find lost archives

       <b>--max-duration</b> <u>SECONDS</u>
              do only a partial repo check for max. SECONDS seconds (Default: unlimited)

   <b>Archive</b> <b>filters</b>
       <b>-a</b> <u>PATTERN</u>, <b>--match-archives</b> <u>PATTERN</u>
              only consider archives matching all patterns. see "borg help match-archives".

       <b>--sort-by</b> <u>KEYS</u>
              Comma-separated list of sorting keys; valid keys are: timestamp, archive, name,  id,  tags,  host,
              user; default is: timestamp

       <b>--first</b> <u>N</u>
              consider first N archives after other filters were applied

       <b>--last</b> <u>N</u>
              consider last N archives after other filters were applied

       <b>--oldest</b> <u>TIMESPAN</u>
              consider archives between the oldest archive's timestamp and (oldest + TIMESPAN), e.g. 7d or 12m.

       <b>--newest</b> <u>TIMESPAN</u>
              consider archives between the newest archive's timestamp and (newest - TIMESPAN), e.g. 7d or 12m.

       <b>--older</b> <u>TIMESPAN</u>
              consider archives older than (now - TIMESPAN), e.g. 7d or 12m.

       <b>--newer</b> <u>TIMESPAN</u>
              consider archives newer than (now - TIMESPAN), e.g. 7d or 12m.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/borg-common.1.html">borg-common</a>(1)</u>

</pre><h4><b>AUTHOR</b></h4><pre>
       The Borg Collective

                                                   2025-01-03                                      <u><a href="../man1/BORG-CHECK.1.html">BORG-CHECK</a></u>(1)
</pre>
 </div>
</div></section>
</div>
</body>
</html>