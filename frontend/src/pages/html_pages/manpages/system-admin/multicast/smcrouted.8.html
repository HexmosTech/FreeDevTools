<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>smcrouted — SMCRoute, a static multicast router</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/smcroute">smcroute_2.5.7-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       smcrouted — SMCRoute, a static multicast router

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>smcrouted</b>  [<b>-nNhsv</b>]  [<b>-c</b>  <u>SEC</u>]  [<b>-d</b>  <u>SEC</u>]  [<b>-e</b>  <u>CMD</u>]  [<b>-f</b>  <u>FILE</u>]  [<b>-F</b>  <u>FILE</u>]  [<b>-i</b> <u>NAME</u>] [<b>-l</b> <u>LVL</u>] [<b>-m</b> <u>SEC</u>]
                 [<b>-p</b> <u>USER:GROUP</u>] [<b>-P</b> <u>FILE</u>] [<b>-t</b> <u>ID</u>] [<b>-u</b> <u>FILE</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>smcrouted</b> is a static multicast  routing  daemon  providing  fine  grained  control  over  the  multicast
       forwarding cache (MFC) in the UNIX kernel.  Both IPv4 and IPv6 are fully supported.

       <b>smcrouted</b>  can  be  used  as  an  alternative  to  dynamic  multicast daemons like <u><a href="../man8/mrouted.8.html">mrouted</a></u>(8), <u><a href="../man8/pimd.8.html">pimd</a></u>(8) or
       <u><a href="../man8/pim6sd.8.html">pim6sd</a></u>(8) in situations where static multicast routes should be maintained and/or no proper IGMP  or  MLD
       signaling exists.

       Multicast  routes  exist  in  the  UNIX kernel only as long as a multicast routing daemon is running.  On
       Linux, multiple multicast routers can run simultaneously using different multicast  routing  tables.   To
       run <b>smcrouted</b> and, <b>mrouted</b> at the same time, set the former to use a routing table other than the default
       (0).

       <b>smcrouted</b>  modifies  the kernel routing table and needs either full <u>superuser</u> <u>rights</u>, or <b>CAP_NET_ADMIN</b> on
       Linux.  This also applies to the friendly control tool <u><a href="../man8/smcroutectl.8.html">smcroutectl</a></u>(8).

   <b>Warning</b>
       Be careful when creating multicast routes.  You can easily flood your networks by inadvertently  creating
       routing  loops.   Either direct loops listing an inbound interface also as an outbound, or indirect loops
       by going through other routers.

</pre><h4><b>OPTIONS</b></h4><pre>
       The following command line options are available:

       <b>-c</b> <u>SEC</u>  Flush unused dynamic (*,G) multicast routes every <u>SEC</u> seconds.

               This option is intended for systems with topology  changes,  i.e.,  when  inbound  multicast  may
               change both interface and source IP address.  E.g. in a setup with at least two VRRP routers.  If
               there  is no way of detecting such a topology change this option makes sure to periodically flush
               all dynamically learned multicast routes so that traffic may  resume.   Flushing  of  a  specific
               route  only  occurs  if  it  was unused during the last flush interval, i.e. there was no traffic
               matching it.  This avoids toggling between different inbound interfaces  if  traffic  arrives  on
               several  interfaces  simultaneously.   In  this  case,  the  first  selected inbound interface is
               retained until traffic on it ceases.

               Default is 60 sec, set to 0 to disable.  See also the <b>smcroutectl</b> <b>flush</b>  command,  which  can  be
               called manually on topology changes.

       <b>-d</b> <u>SEC</u>  Daemon  startup  delay.   Delays  the  probe of interfaces and parsing of the configuration file.
               Note, the PID file is also not created, since the daemon is not ready yet.

               This command line option, although useful in some use-cases, is fragile.   It  is  almost  always
               better  to  rely  on  an  init  or  process  supervisor  that handles dependencies properly, like
               <u><a href="../man8/finit.8.html">finit</a></u>(8), which can wait for interfaces to come up and files to  be  created  before  starting  a
               service.

       <b>-e</b> <u>CMD</u>  Specify  external  script  or  command to be called when <b>smcrouted</b> has loaded/reloaded all static
               multicast routes from the  configuration  file,  or  when  a  source-less  (ANY)  rule  has  been
               installed.

       <b>-f</b> <u>FILE</u>
               Alternate configuration file, default <u>/etc/smcroute.conf</u>

       <b>-F</b> <u>FILE</u>
               Check configuration file syntax, use <b>-l</b> <u>LEVEL</u> to increase verbosity.  Returns non-zero on error.

       <b>-h</b>      Show summary of command line options and exit.

       <b>-i</b> <u>NAME</u>
               Set  daemon  identity.   Used  to create unique PID, IPC socket, and configuration file names, as
               well as set the syslog identity.  E.g., <b>-I</b> <u>foo</u> would make <b>smcrouted</b> look for <b>/etc/foo.conf</b>, write
               its PID to <b>/var/run/foo.pid</b> and create an IPC socket for <b>smcroutectl</b> in <b>/var/run/foo.sock</b>.

               For <b>smcroutectl</b> the same option can be used to select the proper <b>smcrouted</b> instance to  send  IPC
               to.

               This  option  is  required  for both daemon and client when running multiple <b>smcrouted</b> instances,
               using multiple routing tables, on Linux.

       <b>-l</b> <u>LEVEL</u>
               Set log level: none, err, notice, info, debug.  Default is notice.

       <b>-m</b> <u>SEC</u>  Modify Multicast Router Discovery (mrdisc) announcement interval.  Default 20 sec.   This  option
               is only available when <b>smcrouted</b> is built with mrdisc support (Linux, and IPv4, only). RFC4286.

       <b>-n</b>      Run daemon in foreground, do not detach from controlling terminal

       <b>-N</b>      By  default  <b>smcrouted</b>  enables  multicast  routing  on  all  available,  and  multicast capable,
               interfaces in the system.  These interfaces are enumerated as VIFs, virtual interfaces, of  which
               most  UNIX  systems  have  a  very  limited  amount,  usually 32.  This daemon option inverts the
               behavior so no interfaces are enabled by default.  Useful on systems with many interfaces,  where
               multicast routing only makes use of a few.

               The config file setting <u>phyint</u> <u>IFNAME</u> <u>enable</u> is required to enable the required interfaces.

       <b>-p</b> <u>USER</u> [:GROUP]
               Drop  root  privileges to USER:GROUP after start and retain CAP_NET_ADMIN capabilities only.  The
               :GROUP is optional.  This option is only available when <b>smcrouted</b> is built with libcap support.

       <b>-P</b> <u>FILE</u>
               Set PID file name, and optionally full path, in case you need to override the  default  identity,
               or  the  identity set with <b>-i</b> <u>NAME</u>.  Regardless, setting this option overrides all others, but it
               is recommended to use the ident option instead.

       <b>-s</b>      Let daemon log to syslog, default unless running in foreground.

       <b>-t</b> <u>ID</u>   Set multicast routing table ID.  Remember to also create routing rules directing packets  to  the
               table.  This example uses routing table ID 123:

               ip mrule add iif eth0 lookup 123
               ip mrule add oif eth0 lookup 123

               <b>Note:</b> Only available on Linux.

       <b>-u</b> <u>FILE</u>
               UNIX  domain  socket  path,  used  for  the  IPC  between <b>smcrouted</b> and <b>smcroutectl</b>.  Use this to
               override the default socket path, derived from the daemon identity, <b>-i</b> <u>NAME</u>.  This option can  be
               useful  when overriding the identity is not sufficient, e.g. for testing.  The default depends on
               how <b>smcrouted</b> is configured at build time, see “FILES”.

       <b>-v</b>      Show program version and support information.

       The <b>-e</b> <u>CMD</u> option is useful if you want to trigger other processes to start when <b>smcrouted</b> has  completed
       installing  dynamic  multicast routes from (*,G) rules in <u>/etc/smcroute.conf</u>, or when a source-less (ANY)
       route, a.k.a (*,G) multicast rule, from <u>/etc/smcroute.conf</u>.  is matched  and  installed.   For  instance,
       calling <u>conntrack</u> on Linux to flush firewall connection tracking when NAT:ing multicast.

       The  script  <u>CMD</u>  is  called with an argument <u>reload</u> or <u>install</u> to let the script know if it is called on
       SIGHUP/startup, or when a (*,G) rule is matched and installed.  In the latter case  <b>smcrouted</b>  also  sets
       two   environment   variables:   <b>source</b>,   and  <b>group</b>.   Beware  that  these  environment  variables  are
       unconditionally overwritten by <b>smcrouted</b> and can thus not be used to pass information to the script  from
       outside of <b>smcrouted</b>.

</pre><h4><b>OPERATION</b></h4><pre>
   <b>Introduction</b>
       When  <b>smcrouted</b>  starts  up  it  scans for available network interfaces that have the <b>MULTICAST</b> flag set.
       Provided the <b>-N</b> flag is not set, each interface is enumerated as a virtual interface (VIF) which is  what
       the  kernel's  multicast  routing  stack  uses.   The  enumeration process on some operating systems also
       require each interface to have an IP address, but Linux and FreeBSD systems only require the ifindex  and
       the  MULTICAST  flag.   If the interface does not yet exist when <b>smcrouted</b> starts, the <b>-d</b> <u>SEC</u> flag can be
       used to delay startup.  Otherwise <b>smcrouted</b> needs  to  be  reloaded  (e.g.,  using  SIGHUP)  when  a  new
       interface has been added to the system.

       Since VIFs are a limited resource, most operating systems only support 32 in total, the administrator may
       need  to  declare  which  interfaces  to  use  for  multicast routing using the <u>/etc/smcroute.conf</u> <b>phyint</b>
       directive.  It is recommended to always start <b>smcrouted</b> with the  <b>-N</b>  flag,  disabling  VIF  creation  by
       default,  and  then  selectively  enable  each  of  the  interfaces  you are going to route between.  See
       <u><a href="../man5/smcroute.conf.5.html">smcroute.conf</a></u>(5) for more information.

   <b>Multicast</b> <b>Scoping</b>
       Because multicast inherently is broadcast there is an obvious need to limit.  On a LAN  this  is  usually
       managed  automatically  by  bridges  (switches) with built-in multicast snooping (IGMP and MLD).  Between
       LANs there is also the need to scope multicast, often the same multicast groups are  used  for  different
       purposes on different LANs.  This must be managed by administrators, at least three options exist:

             <b>TTL</b> <b>scoping</b>
                     The  traditional  way of "raising walls" between zones.  The outbound interfaces of routers
                     are given a TTL threshold greater than the hop it represents.  The default TTL threshold is
                     1.  Managing the routers is a lot easier than adjusting the TTL  value  of  each  multicast
                     sender.  The only real downside to this is that it scales poorly with the number of routers
                     and it affects all multicast traversing the router's interfaces.

             <b>Administrative</b> <b>scoping</b> <b>(RFC2365)</b>
                     This is one of the current best practices, defining boundaries for sets of multicast groups
                     instead  of limiting all multicast (as TTL scoping does).  In the case of <b>smcrouted</b> this is
                     left to the administrator  to  manage.   See  <u><a href="../man8/mrouted.8.html">mrouted</a></u>(8),  and  <u><a href="../man5/mrouted.conf.5.html">mrouted.conf</a></u>(5),  for  more
                     details.

             <b>Filtering</b>
                     Some  sort  of  filtering  mechanism,  e.g., firewall (Linux netfilter) or low-level filter
                     (Linux tc or eBPF) that may  even  have  some  hardware  offloading  support  (TCAM).   The
                     firewall  is  likely  the most common since it is also often used to set up SNAT or 1:1 NAT
                     (Linux netmap).

   <b>Multicast</b> <b>Routes</b>
       A multicast route is defined by an input interface <u>IFNAME</u>, the sender's unicast IP address <u>SOURCE</u>,  which
       is optional, the multicast group <u>GROUP</u> and a list of, at least one, output interface <u>IFNAME</u> <u>[IFNAME</u> <u>...]</u>.

             mroute from eth0                  group 225.1.2.3  to eth1 eth2
             mroute from eth0 source 1.2.3.4   group 225.3.2.1  to eth1 eth2

             mroute from eth0                  group  ff2e::42  to eth1 eth2
             mroute from eth0 source 2001:3::1 group  ff2e::43  to eth1 eth2

       The sender address and multicast group must both be either IPv4 or IPv6 addresses.

       The  output  interfaces  are  not  needed when removing routes using the <b>smcroutectl</b> <b>remove</b> command.  The
       first three parameters are sufficient to identify the source of the multicast route.

       The intended purpose of <b>smcrouted</b> is to aid in situations where dynamic multicast routing does  not  work
       properly.   However,  a dynamic multicast routing protocol is in nearly all cases the preferred solution.
       The reason for this is their ability to translate Layer-3 signaling to Layer-2 and vice  versa  (IGMP  or
       MLD).

       <b>Note:</b>  the  optional source address multicast routes are not installed in the kernel multicast forwarding
       cache (MFC) by <b>smcrouted</b>.  Instead, it dynamically installs new routes to the kernel  MFC,  matching  the
       group  and inbound interface, when the kernel notifies <b>smcrouted</b> using "upcalls" called <b>NOCACHE</b> messages.
       This feature was grafted onto <b>smcrouted</b> from <u><a href="../man8/mrouted.8.html">mrouted</a></u>(8), and may not work as intended in all use-cases.

   <b>Multicast</b> <b>Groups</b>
       <b>smcrouted</b> is capable of simple group join and leave by sending commands to the kernel.  The  kernel  then
       handles  sending  Layer-2  IGMP/MLD join and leave frames as needed.  This can be used for testing but is
       also useful sometimes to open up multicast from the sender if located on a  LAN  with  switches  equipped
       with  IGMP/MLD  Snooping.   Such  devices will prevent forwarding of multicast unless an IGMP/MLD capable
       router or multicast client is located on the same physical port as you run <b>smcrouted</b> on.   However,  this
       feature  of  <b>smcrouted</b>  is  only  intended as a workaround.  Some platforms impose a limit on the maximum
       number of groups that can be joined, some of these systems can be tuned  to  increase  this  limit.   For
       bigger  installations it is strongly recommended to instead address the root cause, e.g. enable multicast
       router ports on intermediate switches, either statically or by enabling the  multicast  router  discovery
       feature of <b>smcrouted</b>.

       To emulate a multicast client using <b>smcrouted</b> you use the <b>join</b> and <b>leave</b> commands to issue join and leave
       commands  for  a given multicast group on a given interface <u>IFNAME</u>.  The <u>GROUP</u> may be given in an IPv4 or
       IPv6 address format.

       The command is passed to the daemon that passes it to the kernel. The  kernel  then  tries  to  join  the
       multicast  group  <u>GROUP</u> on interface <u>IFNAME</u> by starting IGMP, or MLD for IPv6 group address, signaling on
       the given interface.  This signaling may be  received  by  routers/switches  connected  on  that  network
       supporting  IGMP/MLD  multicast  signaling  and, in turn, start forwarding the requested multicast stream
       eventually reach your desired interface.

   <b>Multiple</b> <b>Daemon</b> <b>Instances</b>
       When running multiple <b>smcrouted</b> instances, using the <b>-t</b> <u>ID</u> command line flag, one per  routing  table  on
       Linux,  it is required to use the <b>-i</b> <u>NAME</u> option to both daemon and client.  This because the name of the
       IPC socket used for communicating is composed from the identity.

</pre><h4><b>DEBUGGING</b></h4><pre>
       The most common problem when attempting to route multicast is the TTL.  Always start  by  verifying  that
       the  TTL  of  your multicast stream is not set to 1, because the router decrements the TTL of an IP frame
       before routing it.  Test your setup using <u><a href="../man8/ping.8.html">ping</a></u>(8) or <u><a href="../man1/iperf.1.html">iperf</a></u>(1).  Either of which is  capable  of  creating
       multicast  traffic  with  an  adjustable  TTL.   Iperf in particular is useful since it can act both as a
       multicast source (sender) and a multicast sink (receiver).  For more advanced IP  multicast  testing  the
       <u><a href="../man1/mcjoin.1.html">mcjoin</a></u>(1) tool can be used.

   <b>Note</b>
       A lot of extra information is sent under the daemon facility and the debug priority to the syslog daemon.
       Use ‘smcrouted -s -l debug’ to enable.

</pre><h4><b>SIGNALS</b></h4><pre>
       For  convenience  in  sending  signals,  <b>smcrouted</b>  writes  its  process ID to <u>/var/run/smcroute.pid</u> upon
       startup, unless the <b>-p</b> <u>FILE</u> or <b>-i</b> <u>NAME</u> options are used to change the identity or file  name  used.   The
       following signals are supported:

       <b>HUP</b>   Tell <b>smcrouted</b> to reload its configuration file and activate the changes.
       <b>INT</b>   Terminates execution gracefully.
       <b>TERM</b>  The same as INT.

</pre><h4><b>FILES</b></h4><pre>
       <u>/etc/smcroute.conf</u>      Optional  configuration file for <b>smcrouted</b>.  Defined interfaces to use, groups to
                               join, and routes to set when starting, or reloading <b>smcrouted</b>  on  <u>SIGHUP</u>.   Like
                               the  PID  file,  the name of the configuration file may be different depending on
                               command line options given to the daemon.  Most notably,  <b>-I</b>  <u>IDENT</u>  defines  the
                               full  suite  of  files  used  by  the <b>smcrouted</b> daemon.  See <u><a href="../man5/smcroute.conf.5.html">smcroute.conf</a></u>(5) for
                               details.
       <u>/etc/smcroute.d/*.conf</u>  Optional  configuration  directory,  path  defined  by  convention  only,  actual
                               configuration  directory,  or  file(s) to include, defined by <u>/etc/smcroute.conf</u>.
                               See <u><a href="../man5/smcroute.conf.5.html">smcroute.conf</a></u>(5) for details.
       <u>/var/run/smcroute.pid</u>   Default PID file (re)created by <b>smcrouted</b> when it has started up and is ready  to
                               receive  commands.   See also the <b>-i</b> <u>NAME</u> or <b>-P</b> <u>FILE</u> options which can change the
                               default name.
       <u>/var/run/smcroute.sock</u>  IPC socket created by <b>smcrouted</b> for use by <b>smcroutectl</b>.  Same  caveats  apply  to
                               this  file  as  the previous two, command line options <b>-i</b> <u>NAME</u> and <b>-S</b> <u>FILE</u> to the
                               daemon can be used to change the socket file name.
       <u><a href="file:/proc/net/ip_mr_cache">/proc/net/ip_mr_cache</a></u>   Linux specific, holds active IPv4 multicast routes.
       <u><a href="file:/proc/net/ip_mr_vif">/proc/net/ip_mr_vif</a></u>     Linux specific, holds the IPv4 virtual interfaces used by  the  active  multicast
                               routing daemon.
       <u><a href="file:/proc/net/ip6_mr_cache">/proc/net/ip6_mr_cache</a></u>  Linux specific, holds active IPv6 multicast routes.
       <u><a href="file:/proc/net/ip6_mr_vif">/proc/net/ip6_mr_vif</a></u>    Linux  specific,  holds  the IPv6 virtual interfaces used by the active multicast
                               routing daemon.
       <u><a href="file:/proc/net/igmp">/proc/net/igmp</a></u>          Linux specific, holds active IGMP ASM (*,G) joins.
       <u><a href="file:/proc/net/igmp6">/proc/net/igmp6</a></u>         Linux specific, holds active MLD ASM (*,G) joins.
       <u><a href="file:/proc/net/mcfilter">/proc/net/mcfilter</a></u>      Linux specific, holds active IGMP SSM (S,G) joins.
       <u><a href="file:/proc/net/mcfilter6">/proc/net/mcfilter6</a></u>     Linux specific, holds active MLD SSM (S,G) joins.
       <u><a href="file:/proc/sys/net/ipv4/igmp_max_memberships">/proc/sys/net/ipv4/igmp_max_memberships</a></u>
                               Linux specific tuning of max IGMP ASM (*,G) per socket, default 20.
       <u><a href="file:/proc/sys/net/ipv4/igmp_max_msf">/proc/sys/net/ipv4/igmp_max_msf</a></u>
                               Linux specific tuning of max IGMP SSM (S,G) per socket, default 10.

       BSD systems may consult the <u><a href="../man1/netstat.1.html">netstat</a></u>(1) tool for stats on virtual multicast interface tables and multicast
       forwarding caches, and VIF/MIF allocation, as well as the <u><a href="../man8/ifmcstat.8.html">ifmcstat</a></u>(8) tool for querying group membership.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       <b>smcrouted</b> leverages BSD <u>sysexits.h</u> exit codes (64-78), which  process  supervisors  like  <u><a href="../man1/systemd.1.html">systemd</a></u>(1)  and
       <u><a href="../man8/finit.8.html">finit</a></u>(8) understands.  The following table details what codes are used for and how to interpret them.

             <b>Status</b>    <b>Symbolic</b> <b>Name</b>    <b>Description</b>
             0         EX_OK            Success
             64        EX_USAGE         Invalid command line option, or missing argument
             69        EX_UNAVAILABLE   Multicast routing socket (or table) already in use
             79        EX_SOFTWARE      Internal error, bug in <b>smcrouted</b>
             71        EX_OSERR         Failed <b>fork</b>(), <b>daemon</b>(), <b>getifaddrs</b>(), <b>malloc</b>(), etc.
             76        EX_PROTOCOL      Kernel does not seem to support multicast routing
             77        EX_NOPERM        Not enough permissions to run
             78        EX_CONFIG        Parse error in configuration file

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man5/smcroute.conf.5.html">smcroute.conf</a></u>(5), <u><a href="../man8/smcroutectl.8.html">smcroutectl</a></u>(8), <u><a href="../man8/mrouted.8.html">mrouted</a></u>(8), <u><a href="../man8/pimd.8.html">pimd</a></u>(8), <u><a href="../man8/pim6sd.8.html">pim6sd</a></u>(8), <u><a href="../man8/ping.8.html">ping</a></u>(8), <u><a href="../man1/mcjoin.1.html">mcjoin</a></u>(1), <u><a href="../man1/iperf.1.html">iperf</a></u>(1)

</pre><h4><b>AUTHORS</b></h4><pre>
       SMCRoute  was  originally  created  by Carsten Schill &lt;<u><a href="mailto:carsten@cschill.de">carsten@cschill.de</a></u>&gt;.  Initial IPv6 support by Todd
       Hayton &lt;<u><a href="mailto:todd.hayton@gmail.com">todd.hayton@gmail.com</a></u>&gt;.  Initial FreeBSD support by Micha Lenk &lt;<u><a href="mailto:micha@debian.org">micha@debian.org</a></u>&gt;.

       SMCRoute  is  currently  maintained   by   Joachim   Wiberg   &lt;<u><a href="mailto:troglobit@gmail.com">troglobit@gmail.com</a></u>&gt;,   and   Micha   Lenk
       &lt;<u><a href="mailto:micha@debian.org">micha@debian.org</a></u>&gt; at <u>GitHub</u>: https://github.com/troglobit/smcroute.

Debian                                          November 28, 2021                                   <u><a href="../man8/SMCROUTED.8.html">SMCROUTED</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>