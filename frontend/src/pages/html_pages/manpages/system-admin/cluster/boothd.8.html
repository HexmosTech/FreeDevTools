<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>boothd - The Booth Cluster Ticket Manager.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/booth">booth_1.2-3ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       boothd - The Booth Cluster Ticket Manager.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>boothd</b> <u>daemon</u> [-SD] [-c <u>config</u>] [-l <u>lockfile</u>]

       <b>booth</b> <u>list</u> [-s <u>site</u>] [-c <u>config</u>]

       <b>booth</b> <u>grant</u> [-s <u>site</u>] [-c <u>config</u>] [-FCw] <u>ticket</u>

       <b>booth</b> <u>revoke</u> [-s <u>site</u>] [-c <u>config</u>] [-w] <u>ticket</u>

       <b>booth</b> <u>peers</u> [-s <u>site</u>] [-c <u>config</u>]

       <b>booth</b> <u>status</u> [-D] [-c <u>config</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Booth manages tickets which authorizes one of the cluster sites located in geographically dispersed
       distances to run certain resources. It is designed to be extend Pacemaker to support geographically
       distributed clustering.

       It is based on the RAFT protocol, see eg.
       https://ramcloud.stanford.edu/wiki/download/attachments/11370504/raft.pdf for details.

</pre><h4><b>SHORT</b> <b>EXAMPLES</b></h4><pre>
           # boothd daemon -D

           # booth list

           # booth grant ticket-nfs

           # booth revoke ticket-nfs

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-c</b> <u>configfile</u>
           Configuration to use.

           Can be a full path to a configuration file, or a short name; in the latter case, the directory
           <u>/etc/booth</u> and suffix <u>.conf</u> are added. Per default <u>booth</u> is used, which results in the path
           <u>/etc/booth/booth.conf</u>.

           The configuration name also determines the name of the PID file - for the defaults,
           <u>/var/run/booth/booth.pid</u>.

       <b>-s</b>
           Site address or name.

           The special value <u>other</u> can be used to specify the other site. Obviously, in that case, the booth
           configuration must have exactly two sites defined.

       <b>-F</b>
           <u>immediate</u> <u>grant</u>: Don’t wait for unreachable sites to relinquish the ticket. See the <u>Booth</u> <u>ticket</u>
           <u>management</u> section below for more details. For manual tickets this option allows one to grant a
           ticket which is currently granted. See the <u>Manual</u> <u>tickets</u> section below for more details.

           This option may be DANGEROUS. It makes booth grant the ticket even though it cannot ascertain that
           unreachable sites don’t hold the same ticket. It is up to the user to make sure that unreachable
           sites don’t have this ticket as granted.

       <b>-w</b>
           <u>wait</u> <u>for</u> <u>the</u> <u>request</u> <u>outcome</u>: The client waits for the final outcome of grant or revoke request.

       <b>-C</b>
           <u>wait</u> <u>for</u> <u>ticket</u> <u>commit</u> <u>to</u> <u>CIB</u>: The client waits for the ticket commit to CIB (only for grant
           requests). If one or more sites are unreachable, this takes the ticket expire time (plus, if defined,
           the <u>acquire-after</u> time).

       <b>-h</b>, <b>--help</b>
           Give a short usage output.

       <b>--version</b>
           Report version information.

       <b>-S</b>
           <u>systemd</u> mode: don’t fork. Disables daemonizing, the process will remain in the foreground.

       <b>-D</b>
           Increases the debug output level.

       <b>-l</b> <u>lockfile</u>
           Use another lock file. By default, the lock file name is inferred from the configuration file name.
           Normally not needed.

</pre><h4><b>COMMANDS</b></h4><pre>
       Whether the binary is called as <u>boothd</u> or <u>booth</u> doesn’t matter; the first argument determines the mode of
       operation.

       <u>daemon</u>
           Tells <u>boothd</u> to serve a site. The locally configured interfaces are searched for an IP address that
           is defined in the configuration. booth then runs in either /arbitrator/ or /site/ mode.

       <u>client</u>
           Booth clients can list the ticket information (see also <u>crm_ticket</u> <u>-L</u>), and revoke or grant tickets
           to a site.

           The grant and, under certain circumstances, revoke operations may take a while to return a definite
           operation’s outcome. The client will wait up to the network timeout value (by default 5 seconds) for
           the result. Unless the <u>-w</u> option was set, in which case the client waits indefinitely.

           In this mode the configuration file is searched for an IP address that is locally reachable, ie.
           matches a configured subnet. This allows one to run the client commands on another node in the same
           cluster, as long as the config file and the service IP is locally reachable.

           For instance, if the booth service IP is 192.168.55.200, and the local node has 192.168.55.15
           configured on one of its network interfaces, it knows which site it belongs to.

           Use <u>-s</u> to direct client to connect to a different site.

       <u>status</u>
           <u>boothd</u> looks for the (locked) PID file and the UDP socket, prints some output to stdout (for use in
           shell scripts) and returns an OCF-compatible return code. With <u>-D</u>, a human-readable message is
           printed to STDERR as well.

       <u>peers</u>
           List the other <u>boothd</u> servers we know about.

           In addition to the type, name (IP address), and the last time the server was heard from, network
           statistics are also printed. The statistics are split into two rows, the first one consists of
           counters for the sent packets and the second one for the received packets. The first counter is the
           total number of packets and descriptions of the other counters follows:

           <u>resends</u>
               Packets which had to be resent because the recipient didn’t acknowledge a message. This usually
               means that either the message or the acknowledgement got lost. The number of resends usually
               reflect the network reliability.

           <u>error</u>
               Packets which either couldn’t be sent, got truncated, or were badly formed. Should be zero.

           <u>invalid</u>
               These packets contain either invalid or non-existing ticket name or refer to a non-existing
               ticket leader. Should be zero.

           <u>authfail</u>
               Packets which couldn’t be authenticated. Should be zero.

</pre><h4><b>CONFIGURATION</b> <b>FILE</b></h4><pre>
       The configuration file must be identical on all sites and arbitrators.

       A minimal file may look like this:

           site="192.168.201.100"
           site="192.168.202.100"
           arbitrator="192.168.203.100"
           ticket="ticket-db8"

       Comments start with a hash-sign (<u>'#</u>'). Whitespace at the start and end of the line, and around the <u>'=</u>',
       are ignored.

       The following key/value pairs are defined:

       <u>port</u>
           The UDP/TCP port to use. Default is <u>9929</u>.

       <u>transport</u>
           The transport protocol to use for Raft exchanges. Currently only UDP is supported.

           Clients use TCP to communicate with a daemon; Booth will always bind and listen to both UDP and TCP
           ports.

       <u>authfile</u>
           File containing the authentication key. The key can be either binary or text. If the latter, then
           both leading and trailing white space, including new lines, is ignored. This key is a shared secret
           and used to authenticate both clients and servers. The key must be between 8 and 64 characters long
           and be readable only by the file owner.

       <u>maxtimeskew</u>
           As protection against replay attacks, packets contain generation timestamps. Such a timestamp is not
           allowed to be too old. Just how old can be specified with this parameter. The value is in seconds and
           the default is 600 (10 minutes). If clocks vary more than this default between sites and nodes (which
           is definitely something you should fix) then set this parameter to a higher value. The time skew test
           is performed only in concert with authentication.

       <u>debug</u>
           Specifies the debug output level. Alternative to command line argument. Effective only for <u>daemon</u>
           mode of operation.

       <u>site</u>
           Defines a site Raft member with the given IP. Sites can acquire tickets. The sites' IP should be
           managed by the cluster.

       <u>arbitrator</u>
           Defines an arbitrator Raft member with the given IP. Arbitrators help reach consensus in elections
           and cannot hold tickets.

       Booth needs at least three members for normal operation. Odd number of members provides more redundancy.

       <u>site-user</u>, <u>site-group</u>, <u>arbitrator-user</u>, <u>arbitrator-group</u>
           These define the credentials <u>boothd</u> will be running with.

           On a (Pacemaker) site the booth process will have to call <u>crm_ticket</u>, so the default is to use
           <u>hacluster</u>:'haclient'; for an arbitrator this user and group might not exists, so there we default to
           <u>nobody</u>:'nobody'.

       <u>ticket</u>
           Registers a ticket. Multiple tickets can be handled by single Booth instance.

           Use the special ticket name __defaults__ to modify the defaults. The __defaults__ stanza must precede
           all the other ticket specifications.

       All times are in seconds.

       <u>expire</u>
           The lease time for a ticket. After that time the ticket can be acquired by another site if the ticket
           holder is not reachable.

           The default is <u>600</u>.

       <u>acquire-after</u>
           Once a ticket is lost, wait this time in addition before acquiring the ticket.

           This is to allow for the site that lost the ticket to relinquish the resources, by either stopping
           them or fencing a node.

           A typical delay might be 60 seconds, but ultimately it depends on the protected resources and the
           fencing configuration.

           The default is <u>0</u>.

       <u>renewal-freq</u>
           Set the ticket renewal frequency period.

           If the network reliability is often reduced over prolonged periods, it is advisable to try to renew
           more often.

           Before every renewal, if defined, the command or commands specified in <u>before-acquire-handler</u> is run.
           In that case the <u>renewal-freq</u> parameter is effectively also the local cluster monitoring interval.

       <u>timeout</u>
           After that time <u>booth</u> will re-send packets if there was an insufficient number of replies. This
           should be long enough to allow packets to reach other members.

           The default is <u>5</u>.

       <u>retries</u>
           Defines how many times to retry sending packets before giving up waiting for acks from other members.

           Default is <u>10</u>. Values lower than 3 are illegal.

           Ticket renewals should allow for this number of retries. Hence, the total retry time must be shorter
           than the renewal time (either half the expire time or <u>renewal-freq</u>):

               timeout*(retries+1) &lt; renewal

       <u>weights</u>
           A comma-separated list of integers that define the weight of individual Raft members, in the same
           order as the <u>site</u> and <u>arbitrator</u> lines.

           Default is <u>0</u> for all; this means that the order in the configuration file defines priority for
           conflicting requests.

       <u>before-acquire-handler</u>
           If set, this parameter specifies either a file containing a program to be run or a directory where a
           number of programs can reside. They are invoked before <u>boothd</u> tries to acquire or renew a ticket. If
           any of them exits with a code other than 0, <u>boothd</u> relinquishes the ticket.

           Thus it is possible to ensure whether the services and its dependencies protected by the ticket are
           in good shape at this site. For instance, if a service in the dependency-chain has a failcount of
           <u>INFINITY</u> on all available nodes, the service will be unable to run. In that case, it is of no use to
           claim the ticket.

           One or more arguments may follow the program or directory location. Typically, there is at least the
           name of one of the resources which depend on this ticket.

           See below for details about booth specific environment variables. The distributed <u>service-runnable</u>
           script is an example which may be used to test whether a pacemaker resource can be started.

       <u>attr-prereq</u>
           Sites can have GEO attributes managed with the <u><a href="../man8/geostore.8.html">geostore</a>(8)</u> program. Attributes are within ticket’s
           scope and may be tested by <u>boothd</u> for additional control of ticket failover (automatic) or ticket
           acquire (manual).

           Attributes are typically used to convey extra information about resources, for instance database
           replication status. The attributes are commonly updated by resource agents.

           Attribute values are referenced in expressions and may be tested for equality with the <u>eq</u> binary
           operator or inequality with the <u>ne</u> operator. The usage is as follows:

               attr-prereq = &lt;grant_type&gt; &lt;name&gt; &lt;op&gt; &lt;value&gt;

               &lt;grant_type&gt;: "auto" | "manual"
               &lt;name&gt;:       attribute name
               &lt;op&gt;:         "eq" | "ne"
               &lt;value&gt;:      attribute value

           The two grant types are <u>auto</u> for ticket failover and <u>manual</u> for grants using the booth client. Only
           in case the expression evaluates to true can the ticket be granted.

           It is not clear whether the <u>manual</u> grant type has any practical use because, obviously, this
           operation is anyway controlled by a human.

           Note that there can be no guarantee on whether an attribute value is up to date, i.e. if it actually
           reflects the current state.

       <u>mode</u>
           Specifies if the ticket is manual or automatic.

           By default all tickets are automatic (that is, they are fully controlled by Raft algorithm). Assign
           the strings "manual" or "MANUAL" to define the ticket as manually controlled.

       One example of a booth configuration file:

           transport = udp
           port = 9930

           # D-85774
           site="192.168.201.100"
           # D-90409
           site="::ffff:192.168.202.100"
           # A-1120
           arbitrator="192.168.203.100"

           ticket="ticket-db8"
               expire        = 600
               acquire-after = 60
               timeout       = 10
               retries       = 5
               renewal-freq  = 60
               before-acquire-handler = /usr/share/booth/service-runnable db8
               attr-prereq = auto repl_state eq ACTIVE

</pre><h4><b>BOOTH</b> <b>TICKET</b> <b>MANAGEMENT</b></h4><pre>
       The booth cluster guarantees that every ticket is owned by only one site at the time.

       Tickets must be initially granted with the <u>booth</u> <u>client</u> <u>grant</u> command. Once it gets granted, the ticket
       is managed by the booth cluster. Hence, only granted tickets are managed by <u>booth</u>.

       If the ticket gets lost, i.e. that the other members of the booth cluster do not hear from the ticket
       owner in a sufficiently long time, one of the remaining sites will acquire the ticket. This is what is
       called <u>ticket</u> <u>failover</u>.

       If the remaining members cannot form a majority, then the ticket cannot fail over.

       A ticket may be revoked at any time with the <u>booth</u> <u>client</u> <u>revoke</u> command. For revoke to succeed, the site
       holding the ticket must be reachable.

       Once the ticket is administratively revoked, it is not managed by the booth cluster anymore. For the
       booth cluster to start managing the ticket again, it must be again granted to a site.

       The grant operation, in case not all sites are reachable, may get delayed for the ticket expire time
       (and, if defined, the <u>acquire-after</u> time). The reason is that the other booth members may not know if the
       ticket is currently granted at the unreachable site.

       This delay may be disabled with the <u>-F</u> option. In that case, it is up to the administrator to make sure
       that the unreachable site is not holding the ticket.

       When the ticket is managed by <u>booth</u>, it is dangerous to modify it manually using either crm_ticket
       command or crm site ticket. Neither of these tools is aware of <u>booth</u> and, consequently, <u>booth</u> itself may
       not be aware of any ticket status changes. A notable exception is setting the ticket to standby which is
       typically done before a planned failover.

</pre><h4><b>NOTES</b></h4><pre>
       Tickets are not meant to be moved around quickly, the default <u>expire</u> time is 600 seconds (10 minutes).

       <u>booth</u> works with both IPv4 and IPv6 addresses.

       <u>booth</u> renews a ticket before it expires, to account for possible transmission delays. The renewal time,
       unless explicitly set, is set to half the <u>expire</u> time.

</pre><h4><b>HANDLERS</b></h4><pre>
       Currently, there’s only one external handler defined (see the <u>before-acquire-handler</u> configuration item
       above).

       The following environment variables are exported to the handler:

       <u>BOOTH_TICKET</u>
           The ticket name, as given in the configuration file. (See <u>ticket</u> item above.)

       <u>BOOTH_LOCAL</u>
           The local site name, as defined in <u>site</u>.

       <u>BOOTH_CONF_PATH</u>
           The path to the active configuration file.

       <u>BOOTH_CONF_NAME</u>
           The configuration name, as used by the <u>-c</u> commandline argument.

       <u>BOOTH_TICKET_EXPIRES</u>
           When the ticket expires (in seconds since 1.1.1970), or <u>0</u>.

       The handler is invoked with positional arguments specified after it.

</pre><h4><b>FILES</b></h4><pre>
       <u>/etc/booth/booth.conf</u>
           The default configuration file name. See also the <u>-c</u> argument.

       <u>/etc/booth/authkey</u>
           There is no default, but this is a typical location for the shared secret (authentication key).

       <u>/var/run/booth/</u>
           Directory that holds PID/lock files. See also the <u>status</u> command.

</pre><h4><b>RAFT</b> <b>IMPLEMENTATION</b></h4><pre>
       In essence, every ticket corresponds to a separate Raft cluster.

       A ticket is granted to the Raft <u>Leader</u> which then owns (or keeps) the ticket.

</pre><h4><b>ARBITRATOR</b> <b>MANAGEMENT</b></h4><pre>
       The booth daemon for an arbitrator which typically doesn’t run the cluster stack, may be started through
       systemd or with <u>/etc/init.d/booth-arbitrator</u>, depending on which init system the platform supports.

       The SysV init script starts a booth arbitrator for every configuration file found in <u>/etc/booth</u>.

       Platforms running systemd can enable and start every configuration separately using <u>systemctl</u>:

           # systemctl enable booth@&lt;configurationname&gt;
           # systemctl start  booth@&lt;configurationname&gt;

       <u>systemctl</u> requires the configuration name, even for the default name <u>booth</u>.

           MANUAL TICKETS

       Manual tickets allow users to create and manage tickets which are subsequently handled by booth without
       using the Raft algorithm. Granting and revoking manual tickets is fully controlled by the administrator.
       It is possible to define a number of manual and normal tickets in one GEO cluster.

       Automatic ticket management provided by Raft algorithm isn’t applied to manually controlled tickets. In
       particular, there is no elections, automatic failover procedures, and term expiration.

       However, <u>booth</u> controls if a ticket is currently being granted to any site and warns the user
       approprietly.

       Tickets which were manually granted to a site, will remain there until they are manually revoked. Even if
       a site becomes offline, the ticket will not be moved to another site. This behavior allows administrators
       to make sure that some services will remain in a particular site and will not be moved to another site,
       possibly located in a different geographical location.

       Also, configuring only manual tickets in a GEO cluster, allows one to have just two sites in a cluster,
       without a need of having an arbitrator. This is possible because there is no automatic elections and no
       voting performed for manual tickets.

       Manual tickets are defined in a configuration files by adding a <u>mode</u> ticket parameter and setting it to
       <u>manual</u> or <u>MANUAL</u>:

           ticket="manual-ticket"
               [...]
               mode = manual
               [...]

       Manual tickets can be granted and revoked by using normal <u>grant</u> and <u>revoke</u> commands, with the usual flags
       and parameters. The only difference is that specyfiyng <u>-F</u> flag during <u>grant</u> command, forced a site to
       become a leader of the specified ticket, even if the ticket is granted to another site.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       <b>0</b>
           Success. For the <u>status</u> command: Daemon running.

       <b>1</b> (PCMK_OCF_UNKNOWN_ERROR)
           General error code.

       <b>7</b> (PCMK_OCF_NOT_RUNNING)
           No daemon process for that configuration active.

</pre><h4><b>BUGS</b></h4><pre>
       Booth is tested regularly. See the README-testing file for more information.

       Please report any bugs either at GitHub: https://github.com/ClusterLabs/booth/issues

       Or, if you prefer bugzilla, at openSUSE bugzilla (component "High Availability"):
       https://bugzilla.opensuse.org/enter_bug.cgi?product=openSUSE%20Factory

</pre><h4><b>AUTHOR</b></h4><pre>
       <u>boothd</u> was originally written (mostly) by Jiaju Zhang.

       In 2013 and 2014 Philipp Marek took over maintainership.

       Since April 2014 it has been mainly developed by Dejan Muhamedagic.

       Many people contributed (see the AUTHORS file).

</pre><h4><b>RESOURCES</b></h4><pre>
       GitHub: https://github.com/ClusterLabs/booth

       Documentation: <a href="http://doc.opensuse.org/products/draft/SLE-HA/SLE-ha-guide_sd_draft/cha.ha.geo.html">http://doc.opensuse.org/products/draft/SLE-HA/SLE-ha-guide_sd_draft/cha.ha.geo.html</a>

</pre><h4><b>COPYING</b></h4><pre>
       Copyright © 2011 Jiaju Zhang <a href="mailto:jjzhang@suse.de">jjzhang@suse.de</a>

       Copyright © 2013-2014 Philipp Marek <a href="mailto:philipp.marek@linbit.com">philipp.marek@linbit.com</a>

       Copyright © 2014 Dejan Muhamedagic <a href="mailto:dmuhamedagic@suse.com">dmuhamedagic@suse.com</a>

       Free use of this software is granted under the terms of the GNU General Public License (GPL) as of
       version 2 (see COPYING file) or later.

                                                   2025-06-03                                          <u><a href="../man8/BOOTHD.8.html">BOOTHD</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>