<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mandos-client - Client for Mandos</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/mandos-client">mandos-client_1.8.19-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mandos-client - Client for Mandos

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>mandos-client</b> [<b>--connect</b> <u>ADDRESS</u><b>:</b><u>PORT</u> | <b>-c</b> <u>ADDRESS</u><b>:</b><u>PORT</u>]
                     [<b>--interface</b> <u>NAME</u><b>[,</b><u>NAME</u>...] | <b>-i</b> <u>NAME</u><b>[,</b><u>NAME</u>...]...]
                     [<b>--pubkey</b> <u>FILE</u> | <b>-p</b> <u>FILE</u>]
                     [<b>--seckey</b> <u>FILE</u> | <b>-s</b> <u>FILE</u>]
                     [<b>--tls-privkey</b> <u>FILE</u> | <b>-t</b> <u>FILE</u>]
                     [<b>--tls-pubkey</b> <u>FILE</u> | <b>-T</b> <u>FILE</u>]
                     [<b>--priority</b> <u>STRING</u>]
                     [<b>--dh-bits</b> <u>BITS</u>]
                     [<b>--dh-params</b> <u>FILE</u>]
                     [<b>--delay</b> <u>SECONDS</u>]
                     [<b>--retry</b> <u>SECONDS</u>]
                     [<b>--network-hook-dir</b> <u>DIR</u>]
                     [<b>--debug</b>]

       <b>mandos-client</b> {<b>--help</b> | <b>-?</b>}

       <b>mandos-client</b> <b>--usage</b>

       <b>mandos-client</b> {<b>--version</b> | <b>-V</b>}

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>mandos-client</b> is a client program that communicates with <b><a href="../man8/mandos.8.html">mandos</a></b>(8) to get a password. In slightly more
       detail, this client program brings up network interfaces, uses the interfaces’ IPv6 link-local addresses
       to get network connectivity, uses Zeroconf to find servers on the local network, and communicates with
       servers using TLS with a raw public key to ensure authenticity and confidentiality. This client program
       keeps running, trying all servers on the network, until it receives a satisfactory reply or a TERM
       signal. After all servers have been tried, all servers are periodically retried. If no servers are found
       it will wait indefinitely for new servers to appear.

       The network interfaces are selected like this: If any interfaces are specified using the <b>--interface</b>
       option, those interface are used. Otherwise, <b>mandos-client</b> will use all interfaces that are not loopback
       interfaces, are not point-to-point interfaces, are capable of broadcasting and do not have the NOARP flag
       (see <b><a href="../man7/netdevice.7.html">netdevice</a></b>(7)). (If the <b>--connect</b> option is used, point-to-point interfaces and non-broadcast
       interfaces are accepted.) If any used interfaces are not up and running, they are first taken up (and
       later taken down again on program exit).

       Before network interfaces are selected, all “network hooks” are run; see the section called “NETWORK
       HOOKS”.

       This program is not meant to be run directly; it is really meant to be run by other programs in the
       initial RAM disk environment; see the section called “OVERVIEW”.

</pre><h4><b>PURPOSE</b></h4><pre>
       The purpose of this is to enable <u>remote</u> <u>and</u> <u>unattended</u> <u>rebooting</u> of client host computer with an
       <u>encrypted</u> <u>root</u> <u>file</u> <u>system</u>. See the section called “OVERVIEW” for details.

</pre><h4><b>OPTIONS</b></h4><pre>
       This program is commonly not invoked from the command line; it is normally started by another program as
       described in the section called “DESCRIPTION”. Any command line options this program accepts are
       therefore normally provided by the invoking program, and not directly.

       <b>--connect=</b><u>ADDRESS</u><b>:</b><u>PORT</u>, <b>-c</b> <u>ADDRESS</u><b>:</b><u>PORT</u>
           Do not use Zeroconf to locate servers. Connect directly to only one specified Mandos server. Note
           that an IPv6 address has colon characters in it, so the <u>last</u> colon character is assumed to separate
           the address from the port number.

           Normally, Zeroconf would be used to locate Mandos servers, in which case this option would only be
           used when testing and debugging.

       <b>--interface=</b><u>NAME</u><b>[,</b><u>NAME</u>...], <b>-i</b> <u>NAME</u><b>[,</b><u>NAME</u>...]
           Comma separated list of network interfaces that will be brought up and scanned for Mandos servers to
           connect to. The default is the empty string, which will automatically use all appropriate interfaces.

           If the <b>--connect</b> option is used, and exactly one interface name is specified (except “none”), this
           specifies the interface to use to connect to the address given.

           Note that since this program will normally run in the initial RAM disk environment, the interface
           must be an interface which exists at that stage. Thus, the interface can normally not be a
           pseudo-interface such as “br0” or “tun0”; such interfaces will not exist until much later in the boot
           process, and can not be used by this program, unless created by a “network hook” — see the section
           called “NETWORK HOOKS”.

           <u>NAME</u> can be the string “none”; this will make <b>mandos-client</b> only bring up interfaces specified <u>before</u>
           this string. This is not recommended, and only meant for advanced users.

       <b>--pubkey=</b><u>FILE</u>, <b>-p</b> <u>FILE</u>
           OpenPGP public key file name. The default name is “/conf/conf.d/mandos/pubkey.txt”.

       <b>--seckey=</b><u>FILE</u>, <b>-s</b> <u>FILE</u>
           OpenPGP secret key file name. The default name is “/conf/conf.d/mandos/seckey.txt”.

       <b>--tls-pubkey=</b><u>FILE</u>, <b>-T</b> <u>FILE</u>
           TLS raw public key file name. The default name is “/conf/conf.d/mandos/tls-pubkey.pem”.

       <b>--tls-privkey=</b><u>FILE</u>, <b>-t</b> <u>FILE</u>
           TLS secret key file name. The default name is “/conf/conf.d/mandos/tls-privkey.pem”.

       <b>--priority=</b><u>STRING</u>
           GnuTLS priority string for the TLS handshake. The default is

           “SECURE128:!CTYPE-X.509:+CTYPE-RAWPK:!RSA:!VERS-ALL:+VERS-TLS1.3:%PROFILE_ULTRA” when using raw
           public keys in TLS, and “SECURE256:!CTYPE-X.509:+CTYPE-OPENPGP:!RSA:+SIGN-DSA-SHA256” when using
           OpenPGP keys in TLS,. See <b><a href="../man3/gnutls_priority_init.3.html">gnutls_priority_init</a></b>(3) for the syntax.  <u>Warning</u>: changing this may make
           the TLS handshake fail, making server-client communication impossible. Changing this option may also
           make the network traffic decryptable by an attacker.

       <b>--dh-bits=</b><u>BITS</u>
           Sets the number of bits to use for the prime number in the TLS Diffie-Hellman key exchange. The
           default value is selected automatically based on the GnuTLS security profile set in its priority
           string. Note that if the <b>--dh-params</b> option is used, the values from that file will be used instead.

       <b>--dh-params=</b><u>FILE</u>
           Specifies a PEM-encoded PKCS#3 file to read the parameters needed by the TLS Diffie-Hellman key
           exchange from. If this option is not given, or if the file for some reason could not be used, the
           parameters will be generated on startup, which will take some time and processing power. Those using
           servers running under time, power or processor constraints may want to generate such a file in
           advance and use this option.

       <b>--delay=</b><u>SECONDS</u>
           After bringing a network interface up, the program waits for the interface to arrive in a “running”
           state before proceeding. During this time, the kernel log level will be lowered to reduce clutter on
           the system console, alleviating any other plugins which might be using the system console. This
           option sets the upper limit of seconds to wait. The default is 2.5 seconds.

       <b>--retry=</b><u>SECONDS</u>
           All Mandos servers are tried repeatedly until a password is received. This value specifies, in
           seconds, how long between each successive try <u>for</u> <u>the</u> <u>same</u> <u>server</u>. The default is 10 seconds.

       <b>--network-hook-dir=</b><u>DIR</u>
           Network hook directory. The default directory is “/lib/mandos/network-hooks.d”.

       <b>--debug</b>
           Enable debug mode. This will enable a lot of output to standard error about what the program is
           doing. The program will still perform all other functions normally.

           It will also enable debug mode in the Avahi and GnuTLS libraries, making them print large amounts of
           debugging output.

       <b>--help</b>, <b>-?</b>
           Gives a help message about options and their meanings.

       <b>--usage</b>
           Gives a short usage message.

       <b>--version</b>, <b>-V</b>
           Prints the program version.

</pre><h4><b>OVERVIEW</b></h4><pre>
       This is part of the Mandos system for allowing computers to have encrypted root file systems and at the
       same time be capable of remote and/or unattended reboots. The computers run a small client program in the
       initial RAM disk environment which will communicate with a server over a network. All network
       communication is encrypted using TLS. The clients are identified by the server using a TLS key; each
       client has one unique to it. The server sends the clients an encrypted password. The encrypted password
       is decrypted by the clients using a separate OpenPGP key, and the password is then used to unlock the
       root file system, whereupon the computers can continue booting normally.

       This program is the client part. It is run automatically in an initial RAM disk environment.

       In an initial RAM disk environment using <b><a href="../man1/systemd.1.html">systemd</a></b>(1), this program is started by the Mandos <b><a href="../man8mandos/passwordagent.8mandos.html">password-</a></b>
       <b><a href="../man8mandos/passwordagent.8mandos.html">agent</a></b>(8mandos), which in turn is started automatically by the <b><a href="../man1/systemd.1.html">systemd</a></b>(1) “Password Agent” system.

       In the case of a non-<b><a href="../man1/systemd.1.html">systemd</a></b>(1) environment, this program is started as a plugin of the Mandos <b><a href="../man8mandos/pluginrunner.8mandos.html">plugin-</a></b>
       <b><a href="../man8mandos/pluginrunner.8mandos.html">runner</a></b>(8mandos), which runs in the initial RAM disk environment because it is specified as a “keyscript”
       in the <b><a href="../man5/crypttab.5.html">crypttab</a></b>(5) file.

       This program could, theoretically, be used as a keyscript in <a href="file:/etc/crypttab">/etc/crypttab</a>, but it would then be
       impossible to enter a password for the encrypted root disk at the console, since this program does not
       read from the console at all.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       This program will exit with a successful (zero) exit status if a server could be found and the password
       received from it could be successfully decrypted and output on standard output. The program will exit
       with a non-zero exit status only if a critical error occurs. Otherwise, it will forever connect to any
       discovered Mandos servers, trying to get a decryptable password and print it.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       <b>MANDOSPLUGINHELPERDIR</b>
           This environment variable will be assumed to contain the directory containing any helper executables.
           The use and nature of these helper executables, if any, is purposely not documented.

       This program does not use any other environment variables, not even the ones provided by <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8).

</pre><h4><b>NETWORK</b> <b>HOOKS</b></h4><pre>
       If a network interface like a bridge or tunnel is required to find a Mandos server, this requires the
       interface to be up and running before <b>mandos-client</b> starts looking for Mandos servers. This can be
       accomplished by creating a “network hook” program, and placing it in a special directory.

       Before the network is used (and again before program exit), any runnable programs found in the network
       hook directory are run with the argument “start” or “stop”. This should bring up or down, respectively,
       any network interface which <b>mandos-client</b> should use.

   <b>REQUIREMENTS</b>
       A network hook must be an executable file, and its name must consist entirely of upper and lower case
       letters, digits, underscores, periods, and hyphens.

       A network hook will receive one argument, which can be one of the following:

       start
           This should make the network hook create (if necessary) and bring up a network interface.

       stop
           This should make the network hook take down a network interface, and delete it if it did not exist
           previously.

       files
           This should make the network hook print, <u>one</u> <u>file</u> <u>per</u> <u>line</u>, all the files needed for it to run.
           (These files will be copied into the initial RAM filesystem.) Typical use is for a network hook which
           is a shell script to print its needed binaries.

           It is not necessary to print any non-executable files already in the network hook directory, these
           will be copied implicitly if they otherwise satisfy the name requirements.

       modules
           This should make the network hook print, <u>on</u> <u>separate</u> <u>lines</u>, all the kernel modules needed for it to
           run. (These modules will be copied into the initial RAM filesystem.) For instance, a tunnel interface
           needs the “tun” module.

       The network hook will be provided with a number of environment variables:

       <b>MANDOSNETHOOKDIR</b>
           The network hook directory, specified to <b>mandos-client</b> by the <b>--network-hook-dir</b> option. Note: this
           should <u>always</u> be used by the network hook to refer to itself or any files in the hook directory it
           may require.

       <b>DEVICE</b>
           The network interfaces, as specified to <b>mandos-client</b> by the <b>--interface</b> option, combined to one
           string and separated by commas. If this is set, and does not contain the interface a hook will bring
           up, there is no reason for a hook to continue.

       <b>MODE</b>
           This will be the same as the first argument; i.e.  “start”, “stop”, “files”, or “modules”.

       <b>VERBOSITY</b>
           This will be the “1” if the <b>--debug</b> option is passed to <b>mandos-client</b>, otherwise “0”.

       <b>DELAY</b>
           This will be the same as the <b>--delay</b> option passed to <b>mandos-client</b>. Is only set if <b>MODE</b> is “start”
           or “stop”.

       <b>CONNECT</b>
           This will be the same as the <b>--connect</b> option passed to <b>mandos-client</b>. Is only set if <b>--connect</b> is
           passed and <b>MODE</b> is “start” or “stop”.

       A hook may not read from standard input, and should be restrictive in printing to standard output or
       standard error unless <u>VERBOSITY</u> is “1”.

</pre><h4><b>FILES</b></h4><pre>
       /conf/conf.d/mandos/pubkey.txt, /conf/conf.d/mandos/seckey.txt
           OpenPGP public and private key files, in “ASCII Armor” format. These are the default file names, they
           can be changed with the <b>--pubkey</b> and <b>--seckey</b> options.

       /conf/conf.d/mandos/tls-pubkey.pem, /conf/conf.d/mandos/tls-privkey.pem
           Public and private raw key files, in “PEM” format. These are the default file names, they can be
           changed with the <b>--tls-pubkey</b> and <b>--tls-privkey</b> options.

       /lib/mandos/network-hooks.d
           Directory where network hooks are located. Change this with the <b>--network-hook-dir</b> option. See the
           section called “NETWORK HOOKS”.

</pre><h4><b>BUGS</b></h4><pre>
       Please report bugs to the Mandos development mailing list: &lt;<a href="mailto:mandos-dev@recompile.se">mandos-dev@recompile.se</a>&gt; (subscription
       required). Note that this list is public. The developers can be reached privately at
       &lt;<a href="mailto:mandos@recompile.se">mandos@recompile.se</a>&gt; (OpenPGP key fingerprint 153A 37F1 0BBA 0435 987F 2C4A 7223 2973 CA34 C2C4 for
       encrypted mail).

</pre><h4><b>EXAMPLE</b></h4><pre>
       Note that normally, command line options will not be given directly, but passed on via the program
       responsible for starting this program; see the section called “OVERVIEW”.

       Normal invocation needs no options, if the network interfaces can be automatically determined:

       <b>mandos-client</b>

       Search for Mandos servers (and connect to them) using one specific interface:

       <b>mandos-client</b> <b>--interface</b> <b>eth1</b>

       Run in debug mode, and use custom keys:

       <b>mandos-client</b> <b>--debug</b> <b>--pubkey</b> <b>keydir/pubkey.txt</b> <b>--seckey</b> <b>keydir/seckey.txt</b> <b>--tls-pubkey</b>
       <b>keydir/tls-pubkey.pem</b> <b>--tls-privkey</b> <b>keydir/tls-privkey.pem</b>

       Run in debug mode, with custom keys, and do not use Zeroconf to locate a server; connect directly to the
       IPv6 link-local address “fe80::aede:48ff:fe71:f6f2”, port 4711, using interface eth2:

       <b>mandos-client</b> <b>--debug</b> <b>--pubkey</b> <b>keydir/pubkey.txt</b> <b>--seckey</b> <b>keydir/seckey.txt</b> <b>--tls-pubkey</b>
       <b>keydir/tls-pubkey.pem</b> <b>--tls-privkey</b> <b>keydir/tls-privkey.pem</b> <b>--connect</b> <b>fe80::aede:48ff:fe71:f6f2:4711</b>
       <b>--interface</b> <b>eth2</b>

</pre><h4><b>SECURITY</b></h4><pre>
       This program assumes that it is set-uid to root, and will switch back to the original (and presumably
       non-privileged) user and group after bringing up the network interface.

       To use this program for its intended purpose (see the section called “PURPOSE”), the password for the
       root file system will have to be given out to be stored in a server computer, after having been encrypted
       using an OpenPGP key. This encrypted data which will be stored in a server can only be decrypted by the
       OpenPGP key, and the data will only be given out to those clients who can prove they actually have that
       key. This key, however, is stored unencrypted on the client side in its initial RAM disk image file
       system. This is normally readable by all, but this is normally fixed during installation of this program;
       file permissions are set so that no-one is able to read that file.

       The only remaining weak point is that someone with physical access to the client hard drive might turn
       off the client computer, read the OpenPGP and TLS keys directly from the hard drive, and communicate with
       the server. To safeguard against this, the server is supposed to notice the client disappearing and stop
       giving out the encrypted data. Therefore, it is important to set the timeout and checker interval values
       tightly on the server. See <b><a href="../man8/mandos.8.html">mandos</a></b>(8).

       It will also help if the checker program on the server is configured to request something from the client
       which can not be spoofed by someone else on the network, like SSH server key fingerprints, and unlike
       unencrypted ICMP echo (“ping”) replies.

       <u>Note</u>: This makes it completely insecure to have Mandos clients which dual-boot to another operating
       system which is <u>not</u> trusted to keep the initial RAM disk image confidential.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8mandos/intro.8mandos.html">intro</a></b>(8mandos), <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8), <b><a href="../man5/crypttab.5.html">crypttab</a></b>(5), <b><a href="../man8/mandos.8.html">mandos</a></b>(8), <b><a href="../man8mandos/password-agent.8mandos.html">password-agent</a></b>(8mandos), <b><a href="../man8mandos/plugin-runner.8mandos.html">plugin-runner</a></b>(8mandos)

       <b>Zeroconf</b>[1]
           Zeroconf is the network protocol standard used for finding Mandos servers on the local network.

       <b>Avahi</b>[2]
           Avahi is the library this program calls to find Zeroconf services.

       <b>GnuTLS</b>[3]
           GnuTLS is the library this client uses to implement TLS for communicating securely with the server,
           and at the same time send the public key to the server.

       <b>GPGME</b>[4]
           GPGME is the library used to decrypt the OpenPGP data sent by the server.

       RFC 4291: IP Version 6 Addressing Architecture

           Section 2.2: Text Representation of Addresses

           Section 2.5.5.2: IPv4-Mapped IPv6 Address

           Section 2.5.6, Link-Local IPv6 Unicast Addresses
               This client uses IPv6 link-local addresses, which are immediately usable since a link-local
               addresses is automatically assigned to a network interface when it is brought up.

       RFC 5246: The Transport Layer Security (TLS) Protocol Version 1.2
           TLS 1.2 is the protocol implemented by GnuTLS.

       RFC 4880: OpenPGP Message Format
           The data received from the server is binary encrypted OpenPGP data.

       RFC 7250: Using Raw Public Keys in Transport Layer Security (TLS) and Datagram Transport Layer Security
       (DTLS)
           This is implemented by GnuTLS in version 3.6.6 and is, if present, used by this program so that raw
           public keys can be used.

       RFC 6091: Using OpenPGP Keys for Transport Layer Security
           This is implemented by GnuTLS before version 3.6.0 and is, if present, used by this program so that
           OpenPGP keys can be used.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright © 2008-2024 Teddy Hogeborn, Björn Påhlsson

       This manual page is part of Mandos.

       Mandos is free software: you can redistribute it and/or modify it under the terms of the GNU General
       Public License as published by the Free Software Foundation, either version 3 of the License, or (at your
       option) any later version.

       Mandos is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the
       implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
       License for more details.

       You should have received a copy of the GNU General Public License along with Mandos. If not, see
       <b><a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a></b>.

</pre><h4><b>NOTES</b></h4><pre>
        1. Zeroconf
           <a href="http://www.zeroconf.org/">http://www.zeroconf.org/</a>

        2. Avahi
           https://www.avahi.org/

        3. GnuTLS
           https://www.gnutls.org/

        4. GPGME
           https://www.gnupg.org/related_software/gpgme/

Mandos 1.8.19                                      2025-06-27                             <u><a href="../man8mandos/MANDOS-CLIENT.8mandos.html">MANDOS-CLIENT</a></u>(8mandos)
</pre>
 </div>
</div></section>
</div>
</body>
</html>