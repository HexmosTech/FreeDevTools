<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nbd-client - connect to a server running nbd-server(1), to use its    exported block device</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/nbd-client">nbd-client_3.26.1-6ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       nbd-client - connect to a server running <a href="../man1/nbd-server.1.html">nbd-server</a>(1), to use its    exported block device

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>nbd-client</b>  <u>host</u>  [  <u>port</u> ] <u>nbd-device</u> [ <b>-connections</b> <u>num</u> ] [ <b>-sdp</b> ] [ <b>-swap</b> ] [ <b>-persist</b> ] [ <b>-nofork</b> ] [
       <b>-nonetlink</b> ] [ <b>-systemd-mark</b> ] [ <b>-readonly</b> ] [ <b>-preinit</b> ] [ <b>-block-size</b> <u>block</u> <u>size</u> ] [ <b>-size</b>  <u>bytes</u>  ]  [
       <b>-timeout</b>  <u>seconds</u> ] [ <b>-name</b> <u>name</u> ] [ <b>-certfile</b> <u>certfile</u> ] [ <b>-keyfile</b> <u>keyfile</u> ] [ <b>-cacertfile</b> <u>cacertfile</u> ]
       [ <b>-tlshostname</b> <u>hostname</u> ] [ <b>-priority</b> <u>gnutls-priority-string</u> ]

       <b>nbd-client</b> <b>-unix</b> <u>path</u> <u>nbd-device</u> [ <b>-connections</b> <u>num</u> ] [ <b>-sdp</b> ] [ <b>-swap</b> ] [  <b>-persist</b>  ]  [  <b>-nofork</b>  ]  [
       <b>-nonetlink</b>  ]  [  <b>-systemd-mark</b> ] [ <b>-readonly</b> ] [ <b>-preinit</b> ] [ <b>-block-size</b> <u>block</u> <u>size</u> ] [ <b>-size</b> <u>bytes</u> ] [
       <b>-timeout</b> <u>seconds</u> ] [ <b>-name</b> <u>name</u> ]

       <b>nbd-client</b> <u>nbd-device</u>

       <b>nbd-client</b> <b>-d</b> <u>nbd-device</u>

       <b>nbd-client</b> <b>-c</b> <u>nbd-device</u>

       <b>nbd-client</b> <b>-l</b> <u>host</u> [ <b>port</b> ]

       <b>nbd-client</b> [ <b>-netlink</b> ] <b>-l</b> <u>host</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       With <b>nbd-client</b>, you can connect to a server running <b>nbd-server</b>,  thus  using  raw  diskspace  from  that
       server as a blockdevice on the local client.

       To  do  this,  support from the Linux Kernel is necessary, in the form of the Network Block Device (NBD).
       When you have that, either in the kernel, or as a module, you can connect to an NBD server  and  use  its
       exported file through a block special file with major mode 43.

       Optionally, long options can also be specified with two leading dashes.

</pre><h4><b>OPTIONS</b></h4><pre>
       The following options are supported:

       <b>-block-size</b> <u>block</u> <u>size</u>

       <b>-b</b>     Use a blocksize of "block size". Default is 512; allowed values are either 512, 1024, 2048 or 4096

       <b>-connections</b> <u>num</u>

       <b>-C</b>     Use  <u>num</u>  connections  to the server, to allow speeding up request handling, at the cost of higher
              resource usage on the server. Use of this option requires  kernel  support  available  first  with
              Linux 4.9.

       <b>host</b>   The  hostname  or  IP  address  of the machine running <b>nbd-server</b>. Since 2.9.15, the NBD utilities
              support IPv6.

       <b>-timeout</b> <u>seconds</u>

       <b>-t</b>     Set the connection timeout to "seconds". For this to work, you need a kernel with support for  the
              NBD_SET_TIMEOUT  ioctl;  this  was  introduced into Linus' tree on 2007-10-11, and will be part of
              kernel 2.6.24.

       <b>port</b>   The TCP port on which <b>nbd-server</b> is running at the server.

              The port number defaults to 10809, the IANA-assigned port number for the NBD protocol.

              Previous versions of the nbd tools supported an older version of the negotiation protocol known as
              "oldstyle".  This protocol version is no longer supported as of version 3.11 of  the  nbd  support
              tools.

       <b>nbd-device</b>
              The  block  special file (<u><a href="file:/dev">/dev</a></u> entry) which this nbd-client should connect to, specified as a full
              path.

              When the mode is used wherein no hostname or export name is specified, nbd-client will look up the
              necessary configuration in the <u>nbdtab</u> file. For more information, see <a href="../man5/nbdtab.5.html">nbdtab</a>(5).

       <b>-check</b>

       <b>-c</b>     Check whether the specified nbd device is connected.

              If the device is connected, nbd-client will exit with an exit state of 0 and print the PID of  the
              nbd-client instance that connected it to stdout.

              If  the  device  is  not  connected  or does not exist (for example because the nbd module was not
              loaded), nbd-client will exit with an exit state of 1 and not print anything on stdout.

              If an error occurred, nbd-client will exit with an exit state of 2,  and  not  print  anything  on
              stdout either.

       <b>-disconnect</b>

       <b>-d</b>     Disconnect the specified nbd device from the server

       <b>-list</b>

       <b>-l</b>     Ask  the  server  for a list of available exports. If the server is exporting over IPv6 as well as
              over IPv4, this will list all exports twice; otherwise, it should list them all only once.

              Note that this option <b>only</b> works with nbd-server processes running version 3.1 or above, and  must
              be enabled in server configuration (with the "allowlist" option) before it can be used.

       <b>-nonetlink</b>

       <b>-L</b>     Starting with version 3.17, nbd-client will default to using the netlink interface to configure an
              NBD device. This option allows to use the older ioctl() interface to configure the device.

              This  option  is  only available if nbd-client was compiled against libnl-genl. If that is not the
              case, nbd-client will only be able to use  the  ioctl  interface  (and  the  option  will  not  be
              available).

              Note  that a future version of nbd-client will <b>require</b> the use of netlink, but it has not yet been
              decided when that will be the case.

       <b>-persist</b>

       <b>-p</b>     When this option is specified, nbd-client will immediately try to reconnect an nbd device  if  the
              connection ever drops unexpectedly due to a lost server or something similar.

       <b>-preinit</b>

       <b>-P</b>     When  this  option  is  specified, nbd-client will skip the usual negotiation with the server, and
              hand the socket to the kernel immediately after connecting.  Only  use  this  when  connecting  to
              specialized  NBD  servers  specifically  designed for it. This requires specifying the size of the
              device via the -B option, and does not support TLS.

       <b>-readonly</b>

       <b>-R</b>     When this option is specified, nbd-client will tell the kernel to treat the device  as  read-only,
              even if the server would allow writes.

       <b>-size</b> <u>bytes</u>

       <b>-B</b> <u>bytes</u>
              Force  the  device  size to the specified number of bytes, rather than using the value from server
              negotiation. Must be a multiple of the block size. If using preinit (-P) to skip negotiation, this
              option is required.

       <b>-sdp</b>

       <b>-S</b>     Connect to the server using the Socket Direct Protocol (SDP), rather than  IP.  See  <a href="../man5/nbd-server.5.html">nbd-server</a>(5)
              for details.

       <b>-swap</b>

       <b>-s</b>     Specifies  that  this  NBD  device  will  be  used  as  swapspace. This option attempts to prevent
              deadlocks by performing mlockall() and adjusting the oom-killer score at an appropriate  time.  It
              does not however guarantee that such deadlocks can be avoided.

       <b>-systemd-mark</b>

       <b>-m</b>     The  systemd  init  system  requires that processes which should not be killed at shutdown time be
              marked appropriately by replacing the first letter of their argv[0] with an '@' sign.

              This option will cause nbd-client to do so.

              Note that this only works if nbd-client is run from an initrd; i.e., systemd will  ignore  such  a
              mark if run from a systemd unit file or from the command line.

       <b>-nofork</b>

       <b>-n</b>     Specifies  that  the  NBD client should not detach and daemonize itself. This is mostly useful for
              debugging.

              Note that nbd-client will still fork once to trigger an update  to  the  device  node's  partition
              table. It is not possible to disable this.

       <b>-no-optgo</b>

       <b>-g</b>     Disable  the  use  of  the  NBD_OPT_GO  protocol message, and force the use of NBD_OPT_EXPORT_NAME
              instead.

              The NBD protocol has two phases: the negotiation phase, and the transmission phase. To  move  from
              negotation  to  transmission,  older  clients  sent the NBD_OPT_EXPORT_NAME message, for which the
              server could not produce an error message in case the export name did not exist (or the client had
              insufficient permissions to access it). Due to those limitations, a replacement message NBD_OPT_GO
              was created instead, which allows the server to reply with an error in case of any problems.

              The protocol allows for a server to discard a message  which  it  does  not  understand;  however,
              unfortunately  some  implementations  (including older versions of nbd-server) did not handle that
              situation correctly and would get out of sync with the client when it sent  a  message  which  the
              server did not understand.

              When   sending  NBD_OPT_GO,  nbd-client  will  try  to  do  the  right  thing  and  fall  back  to
              NBD_OPT_EXPORT_NAME. However, when the server has the above-described  bug,  then  this  does  not
              work. In such a situation, the client will issue a diagnostic suggesting the use of this option.

              Note that there is a corresponding option for nbdtab, too.

       <b>-name</b>

       <b>-N</b>     Specifies  the name of the export that we want to use. If not specified, nbd-client will ask for a
              "default" export, if one exists on the server.

       <b>-unix</b>

       <b>-u</b>     Connect to the server over a unix domain socket at <u>path</u>, rather  than  to  a  server  over  a  TCP
              socket. The server must be listening on the given socket.

       <b>-certfile</b> <u>file</u>

       <b>-F</b>     Use the specified file as the client certificate for TLS authentication to the server.

       <b>-keyfile</b> <u>file</u>

       <b>-K</b>     Use the specified file as the private key for the client cerificate.

       <b>-cacertfile</b> <u>file</u>

       <b>-A</b>     Use the specified file as the CA certificate for TLS authentication to the server.

       <b>-tlshostname</b> <u>hostname</u>

       <b>-H</b>     Use  the specified hostname for the TLS context. If not specified, the hostname used to connect to
              the server will be used.

       <b>-priority</b> <u>gnutls</u> <u>priority</u> <u>string</u>

       <b>-y</b>     Pass the specified priority string to GnuTLS. This can be used to configure  the  TLS  connection;
              see the GnuTLS documentation for details.

              The default value for this option is NORMAL:-VERS-TLS-ALL:+VERS-TLS1.2.

   <b>TLS</b> <b>SUPPORT</b>
       Enabling  any of the TLS-related options causes the client to use the NBD_OPT_STARTTLS command to upgrade
       the connection to TLS. Since negotiating TLS support from userspace for a kernel  socket  would  be  very
       involved  (if  passing  keys  to  kernel  space  were  even  possible,  which  it isn't), the way this is
       implemented is that the nbd-client process creates a socketpair, one  side  of  which  it  hands  to  the
       kernel, and the other side of which is handed to an encrypting/decrypting proxy. This has the effect that
       all  communication  will  be  encrypted before being sent over the wire; however, doing so is not safe in
       combination with swapping over an NBD device:

       In order to free memory by swapping, the kernel needs to be sure that the write to  the  nbd  device  has
       finalized.  For  this,  it  needs  to be able to receive an NBD_CMD_WRITE reply which informs it that the
       write has completed successfully and that the memory may be released. Receiving data  over  the  network,
       however,  requires  that  the kernel <b>allocate</b> memory first, which is impossible if we're low on memory (a
       likely situation when trying to swap). This is likely to cause a deadlock when we're low  on  memory  and
       there are high amounts of network traffic.

       To  remedy  this situation, the kernel sets the PF_MEMALLOC option on the nbd socket; when low on memory,
       it will throw away all packets except for those destined to a socket with that option set, relying on the
       normal TCP retransmit system to ensure that data is not lost. This avoids the deadlock described above.

       However, the PF_MEMALLOC option is set on the socket that  is  connected  to  the  nbd  device,  not  the
       encrypted  socket  connected to the encrypting/decrypting proxy. As such, when using TLS, the PF_MEMALLOC
       option is not set on the socket that actually receives data  from  the  network,  which  means  that  the
       deadlock reappears.

       For  this  reason,  if  the <b>-swap</b> option is used when TLS is in use, nbd-client will issue an appropriate
       warning.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Some examples of nbd-client usage:

       • To connect to a server running on port 2000 at  host  "server.domain.com",  using  the  client's  block
         special file "/dev/nbd0":

         <b>nbd-client</b> <b>server.domain.com</b> <b>2000</b> <b>/dev/nbd0</b>

       • To  connect  to a server running on port 2001 at host "swapserver.domain.com", using the client's block
         special file "/dev/nbd1", for swap purposes:

         <b>nbd-client</b> <b>swapserver.domain.com</b> <b>2001</b> <b>/dev/nbd1</b> <b>-swap</b>

       • To disconnect the above connection again (after making sure the  block  special  file  is  not  in  use
         anymore):

         <b>nbd-client</b> <b>-d</b> <b>/dev/nbd1</b>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       nbd-server (1).

</pre><h4><b>AUTHOR</b></h4><pre>
       The NBD kernel module and the NBD tools have been written by Pavel Macheck (<a href="mailto:pavel@ucw.cz">pavel@ucw.cz</a>).

       The  kernel  module  is  now maintained by Paul Clements (<a href="mailto:Paul.Clements@steeleye.com">Paul.Clements@steeleye.com</a>), while the userland
       tools are maintained by Wouter Verhelst (<a href="mailto:wouter@debian.org">wouter@debian.org</a>)

       This manual page was written by Wouter Verhelst (&lt;<a href="mailto:wouter@debian.org">wouter@debian.org</a>&gt;) for  the  Debian  GNU/Linux  system
       (but may be used by others).  Permission is granted to copy, distribute and/or modify this document under
       the terms of the GNU General Public License, version 2, as published by the Free Software Foundation.

                                                     $Date$                                        <u><a href="../man8/NBD-CLIENT.8.html">NBD-CLIENT</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>