<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ext4magic - recover deleted files on ext3/4 filesystems</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/ext4magic">ext4magic_0.3.2-15_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ext4magic - recover deleted files on ext3/4 filesystems

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>ext4magic</b> <b>{-M|-m}</b> [-j &lt;journal_file&gt;] [-d &lt;target_dir&gt;] &lt;filesystem&gt;

       <b>ext4magic</b> [-S|-J|-H|-V|-T] [-x] [-j &lt;journal_file&gt;] [-B n|-I n|-f &lt;file_name&gt;|-i &lt;input_list&gt;] [-t n|[[-a
       n][-b n]]] [-d &lt;target_dir&gt;] [-R|-r|-L|-l] [-Q] &lt;filesystem&gt;

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The deletion of files in ext3/4 filesystems can not be easily reversed.  Zero out of the block references
       in  the  Inodes makes that impossible.  Experience with other programs have proved, it is often possible,
       to restore sufficient information for a recover of many data files, directly from the filesystem Journal.
       ext4magic can extract the information from the Journal, and can restore files in entire directory  trees,
       provided  that  the information in the Journal are sufficient. This tool can recover the most file types,
       can recover large and sparse files, recovered files with original filename, with the  original  owner  an
       group, the original file mode bits, and also the old atime/mtime stamp.

       The  filesystem  Journal has a very different purpose, and it will not be possible to recover any file at
       any time. Many factors affects which data and how long the data store in the Journal. Read the  ext4magic
       documentation for more extensive information about the filesystem Journal.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>Magic</b>  <b>Options:</b>  These options are for a mulit-stage recover especially for file restore after a recursiv
       deletion of parts or the whole file system.  (third step currently available for ext3 by versions 0.2.x ;
       a for ext4 is included in version 0.3.x )

       Umount the file system directly after an accidentally destroy and use these options with the umount  file
       system or with a copy of this file system.  The program automatically determines the correct time options
       if  the  deletion  has only worked a short time (&lt; 5 min) .  For very large deletions, you must use the "
       <b>after</b> <b>time</b> "

       In the first and second step files restored by copies of inodes.  The third step is trying to restore the
       remaining files without inode copies. This may take a long time

       <b>-M</b>     Try to recover all files. This option should be used if the entire Filesystem was deleted.

       <b>-m</b>     Try to recover only all deleted files. Use this option with a partially deleted Filesystem.

       <b>Information</b> <b>Options:</b> These options generate generic  status  information  from  the  filesystem  and  the
       Journal.

       <b>-S</b>     Print  the  filesystem superblock, the option.  <b>-x</b> allows the additional display of content of the
              group descriptor table.

       <b>-J</b>     Print the content of the Journal superblock.  This option also  can  used  to  force  loading  the
              Journal. This has a flow control effect in ext4magic with some other options.

       <b>-H</b>     Output  a  histogram  of time stamps from all filesystem Inodes. Allows you to determine the exact
              time of changes in the filesystem. In connection with a directory name or a directory Inode,  only
              the  time  stamps  of  this directory tree will be displayed. There are not evaluated any changes,
              only one per Inode. either the last change or the deletion time per Inode arrives to  display.  If
              present (ext4), it also create a histogram of create time stamps.

              The optional option <b>-x</b> allows additional a better resolution of the time intervals.

       <b>-V</b>     Print the version of ext4magic and libext2fs

       <b>-T</b>     Display  the  entire  transaction list of all copies of data blocks in the Journal. In conjunction
              with the <b>-B</b> <b>;</b> <b>-I</b> and <b>-f</b> , only display the corresponding data blocks for this data . The  optional
              option  <b>-x</b>  allows an additional transmission time of the transactions, but only if the block is a
              Inode block. The print is in the same order as the data in journal. You can make conclusions  from
              the  data  received  in the Journal.  After the import of backups or after change of timestamps of
              files, the additional transmission time will display not always the real  transmission  time.   If
              here  absolutely  incorrect  time  entries, then check if you using a journal of a read-write open
              file system.

       <b>-x</b>     controls optional the output format and the information content of certain commands.  Affects  the
              following options: <b>-S</b> <b>;</b> <b>-H</b> <b>;</b> <b>-T</b> <b>;</b> <b>-B</b> <b>;</b> <b>-I</b> <b>;</b> <b>-f</b> <b>;</b> <b>-L</b> <b>;</b> <b>-l</b> Detailed description see there.

       <b>Selection</b>  <b>Options:</b>  These  options specify the exact files, directories, and data blocks. One hand, they
       produce specific information, and on the other hand, be used to address the data for the <b>Action</b>  <b>Options.</b>
       ext4magic will accept only one of these options at command.

       <b>-B</b> <b>n</b>   <b>n</b>  is  the  data  block number of a filesystem datablock. Without further options it print a "one-
              byte" hex+ASCII dump from the data block on the filesystem, like the  <b>"hexdump</b>  <b>-C"</b>  command.  The
              optional option <b>-x</b> produced a "four byte" hex+ASCII output.

              With  the  option  <b>-t</b>  <b>n</b> it print a copy of the filesystem data block with this transaction number
              from the Journal.

              <b>#</b> <b>ext4magic</b> <b>/dir/filesystem.iso</b> <b>-B</b> <b>97</b> <b>-t</b> <b>22</b>

              print a hexdump of the copy from filesystem block number 97, which has been writing to the Journal
              with the transaction number 22. All copies of a particular data  block  in  the  Journal  and  the
              associated transaction numbers you can find with the optional Option <b>-T</b>

              <b>#</b> <b>ext4magic</b> <b>/dir/filesystem.iso</b> <b>-B</b> <b>97</b>  <b>-T</b>

              will  print  a list with all copies of filesystem block number 97 with the transaction numbers. If
              this data block is a Inode block, print out the exact time for the transaction with  the  optional
              option <b>-x</b>

       <b>-I</b> <b>n</b>   <b>n</b>  is the Inode number. Without any other option, the output is the content of the real filesystem
              Inode. With a optional <b>-x</b> additional output of a list of all data blocks addressed by this  Inode.
              If Inode is a directory Inode, the content of the directory entries also printed.

              Together  with  one  of  the  following option <b>-T</b> <b>;</b> <b>-J</b> the output is not the content from the real
              filesystem Inode. The content of all differend Inode copies found in the Journal are printed.

              with the option <b>-t</b> <b>n</b> only the content of the Inode from transaction " <b>n</b> " are printed.

              the option <b>-I</b> <b>n</b> can also be used in conjunction with the options <b>-L</b> <b>;</b> <b>-l</b> <b>;</b> <b>-r</b> or <b>-R</b> (show there)

       <b>-f</b> <b>&lt;filename&gt;</b>
              the function is the same as <b>-I</b> <b>n</b> only here is the  <b>&lt;filename&gt;</b>  given  instead  the  Inode  number.
              ext4magic  search  the  filesystem to find the Inode number.  The filename can be a directory or a
              filename and must be specified here from the root directory of this filesystem, and not  from  the
              root directory of the LINUX system.

              An  example:  the  mount  point  for  this  filesystem is " <b><a href="file:/home">/home</a></b> " an the filename for Linux is "
              <b>/home/usr1/Document</b> " you can use now
               # ext4magic /dev/sda3 -f usr1/Document

              The root directory of the filesystem you can use

              <b>-f</b> <b>/</b>
               or

              <b>-f</b> <b>""</b>
               for ext4magic this is the same.

              you should specify no leading "/" for all other filename. And directory names you  should  specify
              without final "/" .

       <b>Expert</b>   <b>Options:</b>   (new   0.2.1)   The   optional   Expert-Mode   must   be   enabled  with  the  option
       <b>"--enable-expert-mode"</b> by configure. This makes it possible to open  and  recover  front  corrupted  file
       systems.   In the current version it is possible to address backup superblocks and the attempt to recover
       of the Journal address from the data of the super block,  and  recover  all  undamaged  files  after  the
       filesystem was partially damaged or overwritten.

       <b>-s</b> <b>blocksize</b> <b>-n</b> <b>blocknumber</b>
              with  this  options  you  can  select the backup superblock.  <b>blocksize</b> can be 1024, 2048 or 4096.
              <b>blocknumber</b> is the block number of the backup superblock this depends on the block size.  Use  the
              same  values  as  with  "fsck"  or  "debugfs"  or use the output of <b>"mkfs</b> <b>-n</b> <b>.."</b>  to determine the
              correct value.

              Use the options necessarily in the order <b>"-s</b> <b>...</b> <b>-n</b> <b>..."</b>

       <b>-c</b>     This will attempt to find the journal using the data of the superblock.  Can  help  if  the  first
              inode blocks of the file system are damaged.

       <b>-D</b>     trying  a  restore  of  all  files  from a badly damaged file system. The combination of all these
              Expert Options try a file system restore if the superblock broken and the beginning  of  the  file
              system  is  corrupted or overwritten.  This can only work if <b>e2fsck</b> has not yet changed the faulty
              file system.

              Example : the first few megabytes of the file system are overwritten. The following tries  a  copy
              of all undamaged files of the filesystem. Target directory is "/tmp/recoverdir"

              <b>#</b> <b>ext4magic</b> <b>/dev/sda1</b> <b>-s</b> <b>4096</b> <b>-n</b> <b>32768</b> <b>-c</b> <b>-D</b> <b>-d</b> <b>/tmp/recoverdir</b>

       <b>-Q</b>     This is a optional high quality Option for recover and only impact with " <b>-r</b> " and " <b>-R</b> ". Without
              this option, any valid file name restored from the directories and you can set the " <b>before</b> " time
              stamp  to  a  time in which all files are deleted. So you will find the maximum possible number of
              files.  It need not necessarily be found old directory data blocks in the Journal.  However, there
              are some files found too much. In this mode, re-used  file  name  and  reused  Inode  can  not  be
              noticed. As a result some file will be created with the extension " <b>"#"</b> or some files created with
              wrong content. You have to check the files and find bad files and delete itself.

              With  option " <b>-Q</b> " works ext4magic more accurately, and can avoid such false and duplicate files.
              This requires old data blocks of the directories  in  the  Journal.  You  will  not  find  of  all
              directories  those old blocks in the Journal. Only directories in which files have been previously
              created or deleted, but not of directories in which no change has been a long time. You should set
              the time stamp " <b>before</b> " immediately before destruction time of the  files.  Are  not  sufficient
              directory data available, may be, ext4magic can't found deleted files or entire directory content.
              This option should be used very carefully and will achieve good results only in a few directories.

       <b>Time</b> <b>Options:</b> With this options you specify a time window at which the program searches for matching time
       stamps  in  the  Journal data.  ext4magic required for most internaly functions two times. A time "after"
       and a time "before".

       Found Inode only accepted, if not deleted and there time stamp less than "before". If the delete time  is
       less  then  "after",  the  Inode are also not used. ext4magic is still trying to find for valid directory
       Inode also a time-matching directory data. For a recover action "before" set to a value at which the data
       deleted, and "after" set to a value at which the data available. Inodes and  directory  data  with  other
       timestamps will be skipped and not used.

       Default,  without  any  time option, ext4magic will search with "now" for the internal time "before", and
       "now -24 hour" for the internal time "after". If you try to recover  without  any  time  option,  so  you
       search  only over the last 24 hours. If you wait a couple of days before you try to recover deleted data,
       you must always use time options, or you find nothing

       <b>-a</b> <b>n</b>   with this option you can set the " <b>after</b> " time

       <b>-b</b> <b>n</b>   with this option you can set the " <b>before</b> " time

              <b>n</b> is the number of seconds since 1970-01-01 00:00:00 UTC. This time information can  you  find  in
              many  prints  of ext4magic, and you can it produce on the console with the command "date" and also
              insert directly in the ext4magic command line.

              <b>-a</b> <b>$(date</b> <b>-d</b> <b>"-3day"</b> <b>+%s)</b> <b>-b</b> <b>$(date</b> <b>-d</b> <b>"-2day"</b> <b>+%s)</b>

              this example set "after=now-36h" and "before=now-24h"

       <b>-t</b> <b>n</b>   is an indirect time option. you can use it with the options <b>-B</b> <b>;</b> <b>-I</b>  <b>;</b>  <b>-f</b>  The  value  <b>n</b>  is  the
              transaction  number.  With  this  option  you  can  print,  list,  or  recover  the data from this
              transaction number.  you can find the transaction numbers with the option <b>-T</b> or in  the  print  of
              the Inode content.

       <b>File-,</b>  <b>IN-</b> <b>and</b> <b>OUT-Options:</b> With these options group, you select the filesystem, and other optional file
       input and output for control of ext4magic.

       <b>&lt;filesystem&gt;</b>
              selects the filesystem and must always be set.  <b>&lt;filesystem&gt;</b> can  be  a  blockdevice  with  ext3/4
              filesystem, it can also be a uncompressed file image of such a partition.

       <b>-j</b> <b>&lt;journal_file&gt;</b>
              optional  you  can  select a external copy of the Journal file. Without this option, automatically
              the internal Journal or, if configured, the external Journal on a block device will used.

       <b>-d</b> <b>&lt;target_dir&gt;</b>
              select the output directory. There, the recovered files were written. If it does not exist, it  is
              created.  By default, created files are written to the subdirectory " <b>RECOVERDIR</b> " in the workpath
              of the actual shell. This output directory can  not  be  on  the  same  filesystem  to  be  tested
              filesystem,  and should have sufficient space to write the recovered files. The filesystem on this
              directory should be also ext3/4, otherwise, not LINUX like filesystems generate some errors  while
              writing  the  file  properties.   Either  you must first changed with the shell in such a suitable
              filesystem, or you must specify the <b>-d</b> with a target to such a directory

       <b>-i</b> <b>&lt;input_list&gt;</b>
              input_list is a input file. Must contain a list with double-quoted filenames. The files  from  the
              list will be restored with option <b>-r</b> or <b>-R</b>

              Blank lines, not cleanly double quoted filenames and all areas before and after <b>"</b> will be ignored.
              Such  a  double-quoted  list of file names can create with options <b>-l</b> <b>-x</b> or <b>-L</b> <b>-x</b> by ext4magic and
              edited by script or by hand.

       <b>Action</b> <b>Options:</b> This option group includes list and recover options. All functions  together,  they  work
       recursiv  controlled  by  the  time  options  through  directory  trees. The starting point for search is
       determined by a directory name or a directory Inode number. Default is root of this Filesystem.  Matching
       the  time  options,  the  filesystem data, inclusive directory data, taken from the Journal. If good data
       from the file system sections available in Journal, it is possible to see or recover  the  state  of  the
       filesystem at different times.

       <b>-L</b>     Prints  the  list  of all filenames and Inode number of the selected directory tree. Included here
              also are deleted files and deleted directory trees.  With the  additional  option.   <b>-x</b>  the  file
              names are printed double-quoted. You can use it for a "Input list" with option <b>-i</b>

       <b>-l</b>     Prints  a list of all filenames which have not allocated data blocks. At the beginning of the line
              are the percentage of unallocated data blocks.  After deletion you find here all  the  file  names
              you  can  recover  with the Journal data. If you use a very old value for the "before" time, it is
              possible there are files whose data blocks reused  and  these  files  in  the  interim  also  been
              deleted.  Also included in the list all files without data blocks, symbolic links, empty and other
              special files.

              Likewise double-quoted file names with optional <b>-x</b>

       <b>-r</b>     applied to directories, all files without conflicts with the occupied blocks will recovered.  This
              are  all you can sea with the option <b>-l</b> and be 100% unallocated. This options only recover deleted
              files and files without data blocks, in example: symbolic links or empty files.

              The recovered files written to the <b>RECOVERDIR/</b> This can also set to an alternate &lt;target_dir&gt; with
              the option <b>-d</b>

              All files become the old filename and if possible, also the old file  properties.  A  subdirectory
              tree  can  set  with  <b>"-f</b>  <b>dirname"</b>  oder  <b>"-I</b>  <b>inodenumber"</b> If use with a given Inode number, the
              directory name is set to <b>&lt;inodenumber&gt;</b>

              The Time options affect the search. If a file name already exists, or you recover  again,  it  not
              overwrite  files,  and  a  new  filename  by  added  a final <b>"#"</b> will created. The maximum ist the
              extension " <b>#####</b> " for a filename.

              single files also can recovered, possible search with time-stamps or transaction number.

              <b>(new</b> <b>0.2.1):</b> Starts this function from the root directory the first stage of the  magic  functions
              will follow.

              This starts <b>"lost</b> <b>directory</b> <b>search"</b> and <b>"lost</b> <b>file</b> <b>search"</b> and recovers all the deleted inode that
              can  not  be  assigned  to  a  file name.  These files you can find in the directories MAGIC-1 and
              MAGIC-2

       <b>-R</b>     recovers directory tree, is the same as <b>-r</b>

              But two very important differences: Recover of all matched Inodes, even if the  blocks  allocated,
              and  recover  if  possible  the old directory properties. Also empty directories will be restored.
              This recovers all deleted and all undeleted  files,  and  it's  possible  to  recover  older  file
              versions or directory versions.

              In  completely  deleted directories the behavior " <b>-R</b> " and " <b>-r</b> " is identical. The difference is
              there only the complete recover of all directories with option "  <b>-R</b>  ".   You  can  also  restore
              individual files with time options or a transaction number.

       <b>For</b> <b>all</b> <b>recover</b> <b>cases</b> ACL, SEL and other extended attribute can not recovered in the current version.

       The  output  starts  at  line  with a string "--------" before the recovered file name. This is a sign of
       successful recover. Are not enough permissions to write the recovered files, then you will see there some
       "x" in the string.

       At the end of the process, possibly an issue comes from the hardlink database. A positive number before a
       file name means : not found all hardlinks to this file. A negative number means :  it  created  too  many
       hardlinks  to  this  file (possible are, reused filenames or reused Inodes, and so, too many or wrong old
       filenames for this hardlink. But also possible, all files for this hardlink are correct, the time options
       was not set correct and because of that, the selected inode for the recover was  not  up  to  date.   You
       should check such reports.)

       Re-used  data  blocks  can't realize and so it's possible, it ends in some corrupted files.  Check in any
       case, all the recoverd files before you use them.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Print the content of a Inode, there are some possibilities.

               # ext4magic /dev/sda3 -f /

               # ext4magic /dev/sda3 -I 2

              the output is the actual filesystem root Inode.  In  first  example  input  the  pathname,  second
              example Inode 2 is also the root directory

               # ext4magic /tmp/filesystem.iso -f / -T -x

              use  filesystem  image "/tmp/filesystem.iso", search and print all transactions of the Block which
              included the root Inode, and print all differend  Inode.  Inclusiv  the  blocklist  off  the  data
              blocks.  If  it's  a  directory,  then  print  also  for  each individual Inode the content of the
              directory.

               # ext4magic /tmp/filesystem.iso -j /tmp/journal.backup -I 8195 -t 182

              Use  filesystem  image  "/tmp/filesystem.iso"   and   read   from   external   Journal   in   file
              "/tmp/journal.backup"  and print the content of the Inode number 8195 from the journal transaction
              number 182

               # ext4magic /dev/sda3 -f user1/Documents -a $(date -d "-3 day" +%s) -b $(date -d "-2 day" +%s)

              print a undeleded Inode for  pathname  "user1/Documents"  two  to  three  days  back.  If  it's  a
              directory,  then also the content of this directory.  If can not found the old directory blocks in
              Journal, the directory content would be the actual from filesystem.

       Examples of simple Recover

               # ext4magic /dev/sda3 -r -f user1/picture/cim01234.jpg -d <a href="file:/tmp">/tmp</a>

              Recover the file "/home/user1/picture/cim01234.jpg" which has just been deleted. The  file  system
              is mounted normally under "<a href="file:/home">/home</a>".  Note the file path is specified from the root directory of the
              file  system  and not from the root of the entire Linux system. Whenever possible, umount the file
              system for the recover.  The file will be written as  "/tmp/user1/picture/cim01234.jpg"

               # ext4magic /dev/sda3 -r

              try to restore all files deleted last 24 hours. Write to directory "./RECOVERDIR/"

               # ext4magic /dev/sda3 -R -a $(date -d "-5day" +%s)

              Attempts to recover all files, even if they are already partially overwritten,  recover  also  all
              not deleted files.  The erase time is 4 days ago.

               # ext4magic /dev/sda3 -M -d /home/recover

              try multi-stage recover of all files after the filesystem is deleted with a "rm -rf *" . Write the
              files to "/home/recover". (on ext4 : in this version skipped the last step.)

               # ext4magic /dev/sda3 -RQ -f user1/Dokuments -a 1274210280 -b 1274211280 -d /mnt/testrecover

              try  to restore the directory tree "user1/Dokuments/". The "-b" timestamp you must set just before
              deleting files, the "-a" timestamp prevents found old file versions. This will only work well,  if
              you've  there  created  or  deleted  files  bevor  the  "-b"  timestamp.  Write  to  the directory
              "/mnt/testrecover/". If only a few files recovers, attempts the same without the option <b>-Q</b>

               # ext4magic /home/filesystem.iso -Lx  -f user1 | grep "jpg" &gt; ./tmpfile

               # ext4magic /home/filesystem.iso -i ./tmpfile -r -d /mnt/testrecover

              try to restore only all deleted files from directory tree "user1/", and have  "jpg"  in  filename.
              (last  24  hour)  and write to "/mnt/testrecover" - use a temporary file "./tmpfile" for a list of
              filenames.

</pre><h4><b>BUGS</b></h4><pre>
       Direct use of the Journal of a currently read-write open filesystem produce reading of bad  blocks.  Such
       bad  blocks provide program errors and false results. You shall therefore never use the Journal of such a
       read-write open file system directly.  Should it be necessary to use a mounted file system, create a copy
       of the file system journal and used the option <b>-j</b>

</pre><h4><b>AUTHOR</b></h4><pre>
       Roberto Maar

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>debugfs</b> (8) , <b>e2fsck</b> (8)

version 0.3.2                                       Oct 2014                                        <u><a href="../man8/ext4magic.8.html">ext4magic</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>