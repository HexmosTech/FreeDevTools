<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xfs_repair - repair an XFS filesystem</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/xfsprogs">xfsprogs_6.13.0-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       xfs_repair - repair an XFS filesystem

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>xfs_repair</b> [ <b>-dfLPv</b> ] [ <b>-n</b> | <b>-e</b> ] [ <b>-m</b> <u>maxmem</u> ] [ <b>-c</b> <u>subopt</u><b>=</b><u>value</u> ] [ <b>-o</b> <u>subopt</u>[<b>=</b><u>value</u>] ] [ <b>-t</b> <u>interval</u> ]
       [ <b>-l</b> <u>logdev</u> ] [ <b>-r</b> <u>rtdev</u> ] <u>device</u>
       <b>xfs_repair</b> <b>-V</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>xfs_repair</b>  repairs  corrupt  or damaged XFS filesystems (see <b><a href="../man5/xfs.5.html">xfs</a></b>(5)).  The filesystem is specified using
       the <u>device</u> argument which should be the device name of  the  disk  partition  or  volume  containing  the
       filesystem.  If  given  the  name  of  a  block  device,  <b>xfs_repair</b>  will attempt to find the raw device
       associated with the specified block device and will use the raw device instead.

       Regardless, the filesystem to be repaired must be unmounted, otherwise, the resulting filesystem  may  be
       inconsistent or corrupt.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-f</b>     Specifies that the filesystem image to be processed is stored in a regular file at <u>device</u> (see the
              <b>mkfs.xfs</b>  <b>-d</b>  <u>file</u>  option). This might happen if an image copy of a filesystem has been copied or
              written into an ordinary file.  This option implies that any external log or realtime  section  is
              also in an ordinary file.

       <b>-L</b>     Force  Log  Zeroing.   Forces  <b>xfs_repair</b>  to  zero the log even if it is dirty (contains metadata
              changes).  When using this option the filesystem will likely appear to be corrupt, and  can  cause
              the loss of user files and/or data.  See the <b>DIRTY</b> <b>LOGS</b> section for more information.

       <b>-l</b> <u>logdev</u>
              Specifies  the  device  special  file  where the filesystem's external log resides. Only for those
              filesystems which use an external log.  See the <b>mkfs.xfs</b> <b>-l</b> option, and  refer  to  <b><a href="../man5/xfs.5.html">xfs</a></b>(5)  for  a
              detailed description of the XFS log.

       <b>-r</b> <u>rtdev</u>
              Specifies  the device special file where the filesystem's realtime section resides. Only for those
              filesystems which use a realtime section.  See the <b>mkfs.xfs</b> <b>-r</b> option, and refer to <b><a href="../man5/xfs.5.html">xfs</a></b>(5)  for  a
              detailed description of the XFS realtime section.

       <b>-n</b>     No  modify  mode.  Specifies that <b>xfs_repair</b> should not modify the filesystem but should only scan
              the filesystem and indicate what repairs would have been made. This option cannot be used together
              with <b>-e</b>.

       <b>-P</b>     Disable prefetching of inode and directory blocks. Use this option if  you  find  <b>xfs_repair</b>  gets
              stuck and stops proceeding. Interrupting a stuck <b>xfs_repair</b> is safe.

       <b>-m</b> <u>maxmem</u>
              Specifies  the  approximate  maximum  amount  of  memory,  in  megabytes,  to  use for <b>xfs_repair</b>.
              <b>xfs_repair</b> has its own internal block cache which will scale out up to the lesser of the process's
              virtual address limit or about 75% of the system's physical  RAM.   This  option  overrides  these
              limits.

              <b>NOTE:</b> These memory limits are only approximate and may use more than the specified limit.

       <b>-c</b> <u>subopt</u><b>=</b><u>value</u>
              Change  filesystem  parameters.  Refer  to  <b><a href="../man8/xfs_admin.8.html">xfs_admin</a></b>(8)  for  information  on changing filesystem
              parameters.

       <b>-o</b> <u>subopt</u>[<b>=</b><u>value</u>]
              Override what the program might conclude about the filesystem if left to its own devices.

              The <u>subopt</u>ions supported are:

                 <b>bhash=</b><u>bhashsize</u>
                        overrides the default buffer cache hash size. The total number of buffer  cache  entries
                        are  limited  to 8 times this amount. The default size is set to use up the remainder of
                        75% of the system's physical RAM size.

                 <b>ag_stride=</b><u>ags_per_concat_unit</u>
                        This creates additional processing threads to parallel process AGs  that  span  multiple
                        concat units. This can significantly reduce repair times on concat based filesystems.

                 <b>force_geometry</b>
                        Check  the  filesystem  even  if  geometry information could not be validated.  Geometry
                        information can not be validated if only a single allocation group exists and thus we do
                        not have a backup superblock available, or if there are two allocation  groups  and  the
                        two  superblocks  do  not agree on the filesystem geometry.  Only use this option if you
                        validated the geometry yourself and know what you are doing.  If  In  doubt  run  in  no
                        modify mode first.

                 <b>noquota</b>
                        Don't  validate  quota counters at all.  Quotacheck will be run during the next mount to
                        recalculate all values.

       <b>-t</b>  <b>interval</b>
              Modify reporting interval, specified in seconds. During long runs <b>xfs_repair</b> outputs its  progress
              every 15 minutes. Reporting is only activated when ag_stride is enabled.

       <b>-v</b>     Verbose output.  May be specified multiple times to increase verbosity.

       <b>-d</b>     Repair  dangerously.  Allow  <b>xfs_repair</b>  to  repair  an  XFS filesystem mounted read only. This is
              typically done on a root filesystem from single user mode, immediately followed by a reboot.

       <b>-e</b>     If any metadata corruption was repaired, the status returned is 4 instead of  the  usual  0.  This
              option cannot be used together with <b>-n</b>.

       <b>-V</b>     Prints the version number and exits.

   <b>Checks</b> <b>Performed</b>
       The correctness of the crc32c checksum implementation will be tested before examining the filesystem.  If
       the test fails, the program will abort.

       Inconsistencies corrected include the following:

       1.     Inode  and  inode  blockmap  (addressing)  checks: bad magic number in inode, bad magic numbers in
              inode blockmap blocks, extents out of order, incorrect number of records in inode blockmap blocks,
              blocks claimed that are not in a legal data area of the filesystem, blocks  that  are  claimed  by
              more than one inode.

       2.     Inode allocation map checks: bad magic number in inode map blocks, inode state as indicated by map
              (free  or  in-use)  inconsistent  with  state  indicated  by  the  inode, inodes referenced by the
              filesystem that do not appear in the inode allocation map, inode allocation map referencing blocks
              that do not appear to contain inodes.

       3.     Size checks: number of blocks claimed by inode inconsistent with inode size,  directory  size  not
              block aligned, inode size not consistent with inode format.

       4.     Directory  checks:  bad  magic  numbers  in  directory  blocks,  incorrect  number of entries in a
              directory block, bad freespace information in  a  directory  leaf  block,  entry  pointing  to  an
              unallocated (free) or out of range inode, overlapping entries, missing or incorrect dot and dotdot
              entries, entries out of hashvalue order, incorrect internal directory pointers, directory type not
              consistent with inode format and size.

       5.     Pathname  checks:  files  or directories not referenced by a pathname starting from the filesystem
              root, illegal pathname components.

       6.     Link count checks: link counts that do not agree with the number of directory  references  to  the
              inode.

       7.     Freemap  checks: blocks claimed free by the freemap but also claimed by an inode, blocks unclaimed
              by any inode but not appearing in the freemap.

       8.     Super Block checks: total free block and/or  free  i-node  count  incorrect,  filesystem  geometry
              inconsistent, secondary and primary superblocks contradictory.

       Orphaned  files  and  directories (allocated, in-use but unreferenced) are reconnected by placing them in
       the <u>lost+found</u> directory.  The name assigned is the inode number.

   <b>Disk</b> <b>Errors</b>
       <b>xfs_repair</b> aborts on most disk I/O errors. Therefore, if you are trying to repair a filesystem  that  was
       damaged  due  to  a disk drive failure, steps should be taken to ensure that all blocks in the filesystem
       are readable and writable before attempting to use <b>xfs_repair</b> to repair the filesystem. A possible method
       is using <b><a href="../man8/dd.8.html">dd</a></b>(8) to copy the data onto a good disk.

   <b>lost+found</b>
       The directory <u>lost+found</u> does not have to already  exist  in  the  filesystem  being  repaired.   If  the
       directory  does  not  exist,  it  is automatically created if required.  If it already exists, it will be
       checked for consistency and if valid will be used  for  additional  orphaned  files.  Invalid  <u>lost+found</u>
       directories are removed and recreated. Existing files in a valid <u>lost+found</u> are not removed or renamed.

   <b>Corrupted</b> <b>Superblocks</b>
       XFS has both primary and secondary superblocks.  <b>xfs_repair</b> uses information in the primary superblock to
       automatically  find  and  validate  the  primary  superblock  against  the  secondary  superblocks before
       proceeding.  Should the primary be too corrupted to be useful in locating the secondary superblocks,  the
       program  scans the filesystem until it finds and validates some secondary superblocks.  At that point, it
       generates a primary superblock.

   <b>Quotas</b>
       If quotas are in use, it is possible that <b>xfs_repair</b> will clear some  or  all  of  the  filesystem  quota
       information.  If so, the program issues a warning just before it terminates.  If all quota information is
       lost, quotas are disabled and the program issues a warning to that effect.

       Note  that  <b>xfs_repair</b>  does not check the validity of quota limits. It is recommended that you check the
       quota limit information manually after  <b>xfs_repair</b>.   Also,  space  usage  information  is  automatically
       regenerated the next time the filesystem is mounted with quotas turned on, so the next quota mount of the
       filesystem may take some time.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       <b>xfs_repair</b>  issues  informative  messages as it proceeds indicating what it has found that is abnormal or
       any corrective action that it has taken.  Most of the messages  are  completely  understandable  only  to
       those  who are knowledgeable about the structure of the filesystem.  Some of the more common messages are
       explained here.  Note that the language of the messages is slightly different if <b>xfs_repair</b> is run in no-
       modify mode because the program is not changing anything on disk.  No-modify mode indicates what it would
       do to repair the filesystem if run without the no-modify flag.

       <b>disconnected</b> <b>inode</b> <u>ino</u><b>,</b> <b>moving</b> <b>to</b> <b>lost+found</b>

              An inode numbered <u>ino</u> was not connected to the filesystem directory tree and  was  reconnected  to
              the  <u>lost+found</u>  directory.  The  inode  is  assigned  the  name  of its inode number (<u>ino</u>).  If a
              <u>lost+found</u> directory does not exist, it is automatically created.

       <b>disconnected</b> <b>dir</b> <b>inode</b> <u>ino</u><b>,</b> <b>moving</b> <b>to</b> <b>lost+found</b>

              As above only the inode is a directory inode.  If a directory inode is attached to <u>lost+found</u>, all
              of its children  (if  any)  stay  attached  to  the  directory  and  therefore  get  automatically
              reconnected when the directory is reconnected.

       <b>imap</b> <b>claims</b> <b>in-use</b> <b>inode</b> <u>ino</u> <b>is</b> <b>free,</b> <b>correcting</b> <b>imap</b>

              The  inode allocation map thinks that inode <u>ino</u> is free whereas examination of the inode indicates
              that the inode may be in use (although it may be disconnected).  The  program  updates  the  inode
              allocation map.

       <b>imap</b> <b>claims</b> <b>free</b> <b>inode</b> <u>ino</u> <b>is</b> <b>in</b> <b>use,</b> <b>correcting</b> <b>imap</b>

              The  inode  allocation  map  thinks  that  inode  <u>ino</u>  is  in use whereas examination of the inode
              indicates that the inode is not in use and therefore is  free.   The  program  updates  the  inode
              allocation map.

       <b>resetting</b> <b>inode</b> <u>ino</u> <b>nlinks</b> <b>from</b> <u>x</u> <b>to</b> <u>y</u>

              The  program  detected  a mismatch between the number of valid directory entries referencing inode
              <u>ino</u> and the number of references recorded in the inode and corrected the the number in the inode.

       <u>fork-type</u> <b>fork</b> <b>in</b> <b>ino</b> <u>ino</u> <b>claims</b> <b>used</b> <b>block</b> <u>bno</u>

              Inode <u>ino</u> claims a block <u>bno</u> that is used (claimed) by either  another  inode  or  the  filesystem
              itself  for  metadata storage. The <u>fork-type</u> is either <b>data</b> or <b>attr</b> indicating whether the problem
              lies in the portion of the inode that tracks regular data or the portion of the inode that  stores
              XFS  attributes.   If  the  inode  is a real-time (rt) inode, the message says so.  Any inode that
              claims blocks used by the filesystem is deleted.  If two or more inodes claim the same block, they
              are both deleted.

       <u>fork-type</u> <b>fork</b> <b>in</b> <b>ino</b> <u>ino</u> <b>claims</b> <b>dup</b> <b>extent</b> <b>...</b>

              Inode <u>ino</u> claims a block in an extent known to be claimed more  than  once.   The  offset  in  the
              inode, start and length of the extent is given.  The message is slightly different if the inode is
              a real-time (rt) inode and the extent is therefore a real-time (rt) extent.

       <b>inode</b> <u>ino</u> <b>-</b> <b>bad</b> <b>extent</b> <b>...</b>

              An extent record in the blockmap of inode <u>ino</u> claims blocks that are out of the legal range of the
              filesystem.   The  message supplies the start, end, and file offset of the extent.  The message is
              slightly different if the extent is a real-time (rt) extent.

       <b>bad</b> <u>fork-type</u> <b>fork</b> <b>in</b> <b>inode</b> <u>ino</u>

              There was something structurally wrong or inconsistent with the data structures that  map  offsets
              to filesystem blocks.

       <b>cleared</b> <b>inode</b> <u>ino</u>

              There  was  something  wrong with the inode that was uncorrectable so the program freed the inode.
              This usually happens because the inode claims blocks that are used by something else or the  inode
              itself  is badly corrupted. Typically, this message is preceded by one or more messages indicating
              why the inode needed to be cleared.

       <b>bad</b> <b>attribute</b> <b>fork</b> <b>in</b> <b>inode</b> <u>ino</u>, <b>clearing</b> <b>attr</b> <b>fork</b>

              There was something wrong with the portion of the inode that stores XFS attributes (the  attribute
              fork)  so the program reset the attribute fork.  As a result of this, all attributes on that inode
              are lost.

       <b>correcting</b> <b>nextents</b> <b>for</b> <b>inode</b> <u>ino</u>, <b>was</b> <u>x</u> <b>-</b> <b>counted</b> <u>y</u>

              The program found that the number of extents used to store the data in  the  inode  is  wrong  and
              corrected  the  number.   The  message  refers  to nextents if the count is wrong on the number of
              extents used to store attribute information.

       <b>entry</b> <u>name</u> <b>in</b> <b>dir</b> <u>dir_ino</u> <b>not</b> <b>consistent</b> <b>with</b> <b>..</b> <b>value</b> <b>(</b><u>xxxx</u><b>)</b> <b>in</b> <b>dir</b>  <b>ino</b>  <u>ino</u><b>,</b>  <b>junking</b>  <b>entry</b>  <u>name</u>  <b>in</b>
       <b>directory</b> <b>inode</b> <u>dir_ino</u>

              The entry <u>name</u> in directory inode <u>dir_ino</u> references a directory inode <u>ino</u>.  However, the .. entry
              in  directory  <u>ino</u> does not point back to directory <u>dir_ino</u>, so the program deletes the entry <u>name</u>
              in directory inode <u>dir_ino</u>.  If the directory inode <u>ino</u> winds up becoming a disconnected inode  as
              a result of this, it is moved to <u>lost+found</u> later.

       <b>entry</b> <u>name</u> <b>in</b> <b>dir</b> <u>dir_ino</u> <b>references</b> <b>already</b> <b>connected</b> <b>dir</b> <b>ino</b> <u>ino</u><b>,</b> <b>junking</b> <b>entry</b> <u>name</u> <b>in</b> <b>directory</b> <b>inode</b>
       <u>dir_ino</u>

              The  entry  <u>name</u>  in directory inode <u>dir_ino</u> points to a directory inode <u>ino</u> that is known to be a
              child of another directory.  Therefore, the entry is invalid and is deleted.  This message  refers
              to  an  entry  in  a  small directory.  If this were a large directory, the last phrase would read
              "will clear entry".

       <b>entry</b> <b>references</b> <b>free</b> <b>inode</b> <u>ino</u> <b>in</b> <b>directory</b> <u>dir_ino</u><b>,</b> <b>will</b> <b>clear</b> <b>entry</b>

              An entry in directory inode <u>dir_ino</u> references an inode <u>ino</u> that is known to be free. The entry is
              therefore invalid and is deleted.  This message refers to a large  directory.   If  the  directory
              were small, the message would read "junking entry ...".

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       <b>xfs_repair</b>  <b>-n</b>  (no modify mode) will return a status of 1 if filesystem corruption was detected and 0 if
       no filesystem corruption was detected.  <b>xfs_repair</b> run without the -n option will always return a  status
       code  of  0 if it completes without problems, unless the flag <b>-e</b> is used. If it is used, then status 4 is
       reported when any issue with the filesystem was found,  but  could  be  fixed.  If  a  runtime  error  is
       encountered during operation, it will return a status of 1. In this case, <b>xfs_repair</b> should be restarted.
       If <b>xfs_repair</b> <b>is</b> <b>unable</b> to proceed due to a dirty log, it will return a status of 2.  See below.

</pre><h4><b>DIRTY</b> <b>LOGS</b></h4><pre>
       Due to the design of the XFS log, a dirty log can only be replayed by the kernel, on a machine having the
       same  CPU architecture as the machine which was writing to the log.  <b>xfs_repair</b> cannot replay a dirty log
       and will exit with a status code of 2 when it detects a dirty log.

       In this situation, the log can be replayed by mounting and immediately unmounting the filesystem  on  the
       same  class  of  machine  that  crashed.  Please make sure that the machine's hardware is reliable before
       replaying to avoid compounding the problems.

       If mounting fails, the log can be erased by running <b>xfs_repair</b> with the -L option.  All metadata  updates
       in  progress  at the time of the crash will be lost, which may cause significant filesystem damage.  This
       should <b>only</b> be used as a last resort.

</pre><h4><b>BUGS</b></h4><pre>
       The filesystem to be  checked  and  repaired  must  have  been  unmounted  cleanly  using  normal  system
       administration  procedures  (the  <b><a href="../man8/umount.8.html">umount</a></b>(8)  command  or  system shutdown), not as a result of a crash or
       system reset.  If the filesystem has not been unmounted cleanly, mount it and unmount it  cleanly  before
       running <b>xfs_repair</b>.

       <b>xfs_repair</b>  does  not  do a thorough job on XFS extended attributes.  The structure of the attribute fork
       will be consistent, but only the contents of attribute forks that will fit into  an  inode  are  checked.
       This limitation will be fixed in the future.

       The  no-modify  mode  (<b>-n</b>  option)  is not completely accurate.  It does not catch inconsistencies in the
       freespace and inode maps, particularly lost blocks or subtly corrupted maps (trees).

       The no-modify mode can generate repeated warnings about the same  problems  because  it  cannot  fix  the
       problems as they are encountered.

       If  a filesystem fails to be repaired, a metadump image can be generated with <b><a href="../man8/xfs_metadump.8.html">xfs_metadump</a></b>(8) and be sent
       to an XFS maintainer to be analysed and <b>xfs_repair</b> fixed and/or improved.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/dd.1.html">dd</a></b>(1), <b><a href="../man8/mkfs.xfs.8.html">mkfs.xfs</a></b>(8), <b><a href="../man8/umount.8.html">umount</a></b>(8), <b><a href="../man8/xfs_admin.8.html">xfs_admin</a></b>(8), <b><a href="../man8/xfs_metadump.8.html">xfs_metadump</a></b>(8), <b><a href="../man5/xfs.5.html">xfs</a></b>(5).

                                                                                                   <u><a href="../man8/xfs_repair.8.html">xfs_repair</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>