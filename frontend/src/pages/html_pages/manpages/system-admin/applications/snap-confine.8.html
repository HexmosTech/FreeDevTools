<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>snap-confine - internal tool for confining snappy applications</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/snapd">snapd_2.71+ubuntu25.10_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       snap-confine - internal tool for confining snappy applications

</pre><h4><b>SYNOPSIS</b></h4><pre>
          snap-confine [--classic] [--base BASE] SECURITY_TAG COMMAND [...ARGUMENTS]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <u>snap-confine</u>  is  a program used internally by <u>snapd</u> to construct the execution environment for snap
       applications.

</pre><h4><b>OPTIONS</b></h4><pre>
       The <u>snap-confine</u> program accepts two options:
          <u>--classic</u> requests the so-called _classic_ _confinement_ in which applications are not confined at all
          (like in classic systems, hence the name). This disables  the  use  of  a  dedicated,  per-snap  mount
          namespace. The <u>snapd</u> service generates permissive apparmor and seccomp profiles that allow everything.

          <u>--base</u>  <u>BASE</u>  directs  snap-confine  to  use the given base snap as the root filesystem. If omitted it
          defaults to the <u>core</u> snap. This is derived from snap meta-data by <u>snapd</u> when starting the  application
          process.

</pre><h4><b>FEATURES</b></h4><pre>
   <b>Apparmor</b> <b>profiles</b>
       <u>snap-confine</u>  switches  to  the apparmor profile <u>$SECURITY_TAG</u>. The profile is <b>mandatory</b> and <u>snap-confine</u>
       will refuse to run without it.

       The profile has to be loaded into the kernel prior to using <u>snap-confine</u>.  Typically this is arranged for
       by <u>snapd</u>. The profile contains rich description of what the application process is allowed  to  do,  this
       includes  system  calls,  file  paths, access patterns, linux capabilities, etc. The apparmor profile can
       also do extensive dbus mediation. Refer to apparmor documentation for more details.

   <b>Seccomp</b> <b>profiles</b>
       <u>snap-confine</u> looks for the <u>/var/lib/snapd/seccomp/bpf/$SECURITY_TAG.bin</u> file. This file is <b>mandatory</b>  and
       <u>snap-confine</u>  will  refuse  to  run without it. This file contains the seccomp bpf binary program that is
       loaded into the kernel by snap-confine.

       The file is generated with the <u><a href="file:/usr/lib/snapd/snap-seccomp">/usr/lib/snapd/snap-seccomp</a></u> compiler from the <u>$SECURITY_TAG.src</u> file  that
       uses  a  custom syntax that describes the set of allowed system calls and optionally their arguments. The
       profile is then used to confine the started application.

       As a security precaution disallowed system calls cause the started application executable to be killed by
       the kernel. In the future this restriction may be lifted to return <u>EPERM</u> instead.

   <b>Mount</b> <b>profiles</b>
       <u>snap-confine</u> uses a helper process, <u>snap-update-ns</u>, to apply  the  mount  namespace  profile  to  freshly
       constructed mount namespace. That tool looks for the <u>/var/lib/snapd/mount/snap.$SNAP_NAME.fstab</u> file.  If
       present  it is read, parsed and treated like a mostly-typical <u><a href="../man5/fstab.5.html">fstab</a>(5)</u> file.  The mount directives listed
       there are executed in order. All directives must succeed as any failure will abort execution.

       By default all mount entries start with the following flags: <u>bind</u>, <u>ro</u>,  <u>nodev</u>,  <u>nosuid</u>.   Some  of  those
       flags can be reversed by an appropriate option (e.g. <u>rw</u> can cause the mount point to be writable).

       Certain  additional  features  are  enabled  and  conveyed through the use of mount options prefixed with
       <u>x-snapd-</u>.

       As a security precaution only <u>bind</u> mounts are supported at this time.

   <b>Sharing</b> <b>of</b> <b>the</b> <b>mount</b> <b>namespace</b>
       As of version 1.0.41 all the applications from the  same  snap  will  share  the  same  mount  namespace.
       Applications from different snaps continue to use separate mount namespaces.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       <u>snap-confine</u> responds to the following environment variables

       <u>SNAP_CONFINE_DEBUG</u><b>:</b>
              When  defined  the  program  will  print additional diagnostic information about the actions being
              performed. All the output goes to stderr.

       The following variables are only used when <u>snap-confine</u> is not setuid root.  This is only applicable when
       testing the program itself.

       <u>SNAPPY_LAUNCHER_INSIDE_TESTS</u><b>:</b>
              Internal variable that should not be relied upon.

       <u>SNAPPY_LAUNCHER_SECCOMP_PROFILE_DIR</u><b>:</b>
              Internal variable that should not be relied upon.

       <u>SNAP_USER_DATA</u><b>:</b>
              Full path to the directory like <a href="file:/home/">/home/</a>$LOGNAME/snap/$SNAP_NAME/$SNAP_REVISION.

              This directory is created by snap-confine on startup. This is a temporary  feature  that  will  be
              merged  into snapd's snap-run command. The set of directories that can be created is confined with
              apparmor.

</pre><h4><b>FILES</b></h4><pre>
       <u>snap-confine</u> and <u>snap-update-ns</u> use the following files:

       <u>/var/lib/snapd/mount/snap.*.fstab</u>:
          Description of the mount profile.

       <u>/var/lib/snapd/seccomp/bpf/*.src</u>:
          Input for the <a href="file:/usr/lib/snapd/snap-seccomp">/usr/lib/snapd/snap-seccomp</a> profile compiler.

       <u>/var/lib/snapd/seccomp/bpf/*.bin</u>:
          Compiled seccomp bpf profile programs.

       <u>/run/snapd/ns/</u>:
          Directory used to keep shared mount namespaces.

          <u>snap-confine</u> internally converts this directory to a private bind mount.  Semantically the behavior is
          identical to the following mount commands:

          mount --bind /run/snapd/ns /run/snapd/ns mount --make-private /run/snapd/ns

       <u>/run/snapd/ns/.lock</u>:
          A <u><a href="../man2/flock.2.html">flock</a>(2)</u>-based lock file acquired to create and convert <u>/run/snapd/ns/</u> to a private bind mount.

       <u>/run/snapd/ns/$SNAP_NAME.lock</u>:
          A  <u><a href="../man2/flock.2.html">flock</a>(2)</u>-based  lock  file  acquired  to  create  or  join  the  mount  namespace  represented   as
          <u>/run/snaps/ns/$SNAP_NAME.mnt</u>.

       <u>/run/snapd/ns/$SNAP_NAME.mnt</u>:
          This file can be either:

          • An  empty  file that may be seen before the mount namespace is preserved or when the mount namespace
            is unmounted.

          • A file belonging to the <u>nsfs</u> file system, representing a fully populated mount namespace of a  given
            snap. The file is bind mounted from <u><a href="file:/proc/self/ns/mnt">/proc/self/ns/mnt</a></u> from the first process in any snap.

       <u><a href="file:/proc/self/mountinfo">/proc/self/mountinfo</a></u>:
          This  file  is  read  to  decide if <u>/run/snapd/ns/</u> needs to be created and converted to a private bind
          mount, as described above.

       Note that the apparmor profile is external to <u>snap-confine</u> and is loaded directly into  the  kernel.  The
       actual apparmor profile is managed by <u>snapd</u>.

</pre><h4><b>BUGS</b></h4><pre>
       Please report all bugs with  &lt;https://bugs.launchpad.net/snapd/+filebug&gt;

</pre><h4><b>AUTHOR</b></h4><pre>
       <a href="mailto:zygmunt.krynicki@canonical.com">zygmunt.krynicki@canonical.com</a>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Canonical Ltd.

2.28                                               2017-09-18                                    <u><a href="../man8/SNAP-CONFINE.8.html">SNAP-CONFINE</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>