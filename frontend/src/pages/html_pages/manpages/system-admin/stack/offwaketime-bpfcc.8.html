<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>offwaketime - Summarize blocked time by off-CPU stack + waker stack. Uses Linux eBPF/bcc.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/bpfcc-tools">bpfcc-tools_0.31.0+ds-7ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       offwaketime - Summarize blocked time by off-CPU stack + waker stack. Uses Linux eBPF/bcc.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>offwaketime</b>   <b>[-h]</b>   <b>[-p</b>   <b>PID</b>  <b>|</b>  <b>-t</b>  <b>TID</b>  <b>|</b>  <b>-u</b>  <b>|</b>  <b>-k]</b>  <b>[-U</b>  <b>|</b>  <b>-K]</b>  <b>[-d]</b>  <b>[-f]</b>  <b>[--stack-storage-size</b>
       <b>STACK_STORAGE_SIZE]</b> <b>[-m</b> <b>MIN_BLOCK_TIME]</b> <b>[-M</b> <b>MAX_BLOCK_TIME]</b> <b>[--state</b> <b>STATE]</b> <b>[duration]</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This program shows kernel stack traces and task names that were blocked and  "off-CPU",  along  with  the
       stack  traces  and  task  names for the threads that woke them, and the total elapsed time from when they
       blocked to when they were woken up.  This combines the summaries from both the offcputime and  wakeuptime
       tools.   The  time  measurement will be very similar to off-CPU time, however, off-CPU time may include a
       little extra time spent waiting on a run queue to be scheduled.  The combined  stacks,  task  names,  and
       total time is summarized in kernel context for efficiency, using an eBPF map.

       The  output  summary  will  further help you identify reasons why threads were blocking, and quantify the
       time from when they were blocked to woken up.  This spans all  types  of  blocking  activity:  disk  I/O,
       network I/O, locks, page faults, swapping, sleeping, involuntary context switches, etc.

       This  is  complementary to CPU profiling (e.g., CPU flame graphs) which shows the time spent on-CPU. This
       shows the time spent blocked off-CPU, and the output, especially the -f format, can be used  to  generate
       an "off-wake time flame graph".

       See <a href="http://www.brendangregg.com/FlameGraphs/offcpuflamegraphs.html">http://www.brendangregg.com/FlameGraphs/offcpuflamegraphs.html</a>

</pre><h4><b>REQUIREMENTS</b></h4><pre>
       CONFIG_BPF and bcc.

</pre><h4><b>OPTIONS</b></h4><pre>
       -h     Print usage message.

       -f     Print output in folded stack format.

       -p PID Trace this process ID only (filtered in-kernel). Can be a comma separated list of PIDS.

       -t TID Trace this thread ID only (filtered in-kernel). Can be a comma separated list of TIDS.

       -u     Only trace user threads (no kernel threads).

       -k     Only trace kernel threads (no user threads).

       -U     Show stacks from user space only (no kernel space stacks).

       -K     Show stacks from kernel space only (no user space stacks).

       -d, --delimited
              insert delimiter between kernel/user stacks

       --stack-storage-size STACK_STORAGE_SIZE
              Change the number of unique stack traces that can be stored and displayed.

       duration
              Duration to trace, in seconds.

       -m MIN_BLOCK_TIME
              The amount of time in microseconds over which we store traces (default 1)

       -M MAX_BLOCK_TIME
              The amount of time in microseconds under which we store traces (default U64_MAX)

       --state
              Filter  on  this  thread state bitmask (eg, 2 == TASK_UNINTERRUPTIBLE).  See include/linux/sched.h
              for states.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Trace all thread blocking events, and summarize (in-kernel) by user and kernel off-CPU stack trace, waker
       stack traces, task names, and total blocked time:
              # <b>offwaketime</b>

       Trace for 5 seconds only:
              # <b>offwaketime</b> <b>5</b>

       Trace for 5 seconds, and emit output in folded stack format (suitable for flame graphs), user-mode
       threads only:
              # <b>offwaketime</b> <b>-fu</b> <b>5</b>

       Trace PID 185 only:
              # <b>offwaketime</b> <b>-p</b> <b>185</b>

</pre><h4><b>OVERHEAD</b></h4><pre>
       This summarizes unique stack trace pairs in-kernel for efficiency, allowing it to trace a higher rate  of
       events  than  methods  that  post-process in user space.  The stack trace and time data is only copied to
       user space once, when the output is printed. While these techniques  greatly  lower  overhead,  scheduler
       events  are  still a high frequency event, as they can exceed 1 million events per second, and so caution
       should still be used. Test before production use.

       If the overhead is still a problem, take a look at the min block option.  If your aim is  to  chase  down
       longer  blocking events, then this could be increased to filter shorter blocking events, further lowering
       overhead.

</pre><h4><b>SOURCE</b></h4><pre>
       This is from bcc.

              https://github.com/iovisor/bcc

       Also look in the bcc distribution for a companion _examples.txt file containing  example  usage,  output,
       and commentary for this tool.

</pre><h4><b>OS</b></h4><pre>
       Linux

</pre><h4><b>STABILITY</b></h4><pre>
       Unstable - in development.

</pre><h4><b>AUTHOR</b></h4><pre>
       Brendan Gregg

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/offcputime.8.html">offcputime</a>(8), <a href="../man8/wakeuptime.8.html">wakeuptime</a>(8)

USER COMMANDS                                      2016-01-30                                     <u><a href="../man8/offwaketime.8.html">offwaketime</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>