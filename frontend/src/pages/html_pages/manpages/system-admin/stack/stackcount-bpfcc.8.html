<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stackcount - Count function calls and their stack traces. Uses Linux eBPF/bcc.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/bpfcc-tools">bpfcc-tools_0.31.0+ds-7ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       stackcount - Count function calls and their stack traces. Uses Linux eBPF/bcc.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>stackcount</b> <b>[-h]</b> <b>[-p</b> <b>PID]</b> <b>[-c</b> <b>CPU]</b> <b>[-i</b> <b>INTERVAL]</b> <b>[-D</b> <b>DURATION]</b> <b>[-T]</b>
                     [-r] [-s] [-P] [-K] [-U] [-v] [-d] [-f] [--debug] pattern

</pre><h4><b>DESCRIPTION</b></h4><pre>
       stackcount  traces  functions  and  frequency counts them with their entire stack trace, kernel stack and
       user stack, summarized in-kernel for efficiency.  This allows higher frequency events to be studied.  The
       output  consists  of  unique  stack  traces,  and their occurrence counts. In addition to kernel and user
       functions, kernel tracepoints and USDT tracepoint are also supported.

       The pattern is a string with optional '*' wildcards, similar to file globbing.  If you'd  prefer  to  use
       regular expressions, use the -r option.

       This  tool only works on Linux 4.6+. Stack traces are obtained using the new `BPF_STACK_TRACE` APIs.  For
       kernels older than 4.6, see the version under tools/old.

</pre><h4><b>REQUIREMENTS</b></h4><pre>
       CONFIG_BPF and bcc.

</pre><h4><b>OPTIONS</b></h4><pre>
       -h     Print usage message.

       -r     Allow regular expressions for the search pattern. The default allows "*" wildcards only.

       -s     Show address offsets.

       -P     Display stacks separately for each process.

       -K     Show kernel stack only.

       -U     Show user stack only.

       -T     Include a timestamp with interval output.

       -v     Show raw addresses.

       -d     Print a delimiter ("--") in-between the kernel and user stacks.

       --debug
              Print the source of the BPF program when loading it (for debugging purposes).

       -i interval
              Summary interval, in seconds.

       -D duration
              Total duration of trace, in seconds.  -f Folded output format.

       -p PID Trace this process ID only (filtered in-kernel).

       -c CPU Trace this CPU only (filtered in-kernel).

       pattern
              A function name, or a search pattern. Can include wildcards ("*"). If the -r option is  used,  can
              include regular expressions.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Count kernel and user stack traces for submit_bio():
              # <b>stackcount</b> <b>submit_bio</b>

       Count stacks with a delimiter for submit_bio():
              # <b>stackcount</b> <b>-d</b> <b>submit_bio</b>

       Count kernel stack trace only for submit_bio():
              # <b>stackcount</b> <b>-K</b> <b>submit_bio</b>

       Count user stack trace only for submit_bio():
              # <b>stackcount</b> <b>-U</b> <b>submit_bio</b>

       Count stack traces for ip_output():
              # <b>stackcount</b> <b>ip_output</b>

       Show symbol offsets:
              # <b>stackcount</b> <b>-s</b> <b>ip_output</b>

       Show offsets and raw addresses (verbose):
              # <b>stackcount</b> <b>-sv</b> <b>ip_output</b>

       Count stacks for kernel functions matching tcp_send*:
              # <b>stackcount</b> <b>'tcp_send*'</b>

       Same as previous, but using regular expressions:
              # <b>stackcount</b> <b>-r</b> <b>'^tcp_send.*'</b>

       Output every 5 seconds, with timestamps:
              # <b>stackcount</b> <b>-Ti</b> <b>5</b> <b>ip_output</b>

       Only count stacks when PID 185 is on-CPU:
              # <b>stackcount</b> <b>-p</b> <b>185</b> <b>ip_output</b>

       Only count stacks for CPU 1:
              # <b>stackcount</b> <b>-c</b> <b>1</b> <b>put_prev_entity</b>

       Count user stacks for dynamic heap allocations with malloc in PID 185:
              # <b>stackcount</b> <b>-p</b> <b>185</b> <b>c:malloc</b>

       Count user stacks for thread creation (USDT tracepoint) in PID 185:
              # <b>stackcount</b> <b>-p</b> <b>185</b> <b>u:pthread:pthread_create</b>

       Count stacks for context switch events using a kernel tracepoint:
              # <b>stackcount</b> <b>t:sched:sched_switch</b>

</pre><h4><b>OVERHEAD</b></h4><pre>
       This  summarizes  unique  stack  traces  in-kernel  for efficiency, allowing it to trace a higher rate of
       function calls than methods that post-process in user space. The stack trace data is only copied to  user
       space  when  the output is printed, which usually only happens once. The stack walking also happens in an
       optimized code path in the kernel thanks to the new BPF_STACK_TRACE table  APIs,  which  should  be  more
       efficient  than  the manual walker in the eBPF tracer which older versions of this script used. With this
       in mind, call rates of &lt; 10,000/sec would incur negligible overhead. Test before production use. You  can
       also use funccount to get a handle on function call rates first.

</pre><h4><b>SOURCE</b></h4><pre>
       This is from bcc.

              https://github.com/iovisor/bcc

       Also  look  in  the bcc distribution for a companion _examples.txt file containing example usage, output,
       and commentary for this tool.

</pre><h4><b>OS</b></h4><pre>
       Linux

</pre><h4><b>STABILITY</b></h4><pre>
       Unstable - in development.

</pre><h4><b>AUTHOR</b></h4><pre>
       Brendan Gregg, Sasha Goldshtein

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/stacksnoop.8.html">stacksnoop</a>(8), <a href="../man8/funccount.8.html">funccount</a>(8)

USER COMMANDS                                      2016-01-14                                      <u><a href="../man8/stackcount.8.html">stackcount</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>