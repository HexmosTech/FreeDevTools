<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>debootstick - Generate a bootable image from a Debian-based chroot environment</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/debootstick">debootstick_2.8_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       debootstick - Generate a bootable image from a Debian-based chroot environment

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>debootstick</b> [<u>options</u>] <u>SOURCE</u> <u>DEST</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>debootstick</b> generates a bootable image (at <u>DEST</u>) from a Debian-based chroot environment (at <u>SOURCE</u>).
       The output image generated at <u>DEST</u> should then be copied to a USB stick, disk or SD card.

       <b>debootstick</b> can currently generate bootable images for:
       - Standard PC systems (32 or 64bits)
       - Raspberry Pi boards
       This  target  system  is  automatically  selected  given  the <u>SOURCE</u> chroot environment (Debian/Ubuntu or
       Raspbian-based).

       Most popular options for generating the <u>SOURCE</u> directory are:
       - exporting the content of a <b>docker</b> container
       - using dedicated tools such as <b><a href="../man8/debootstrap.8.html">debootstrap</a></b>(8) or <b><a href="../man1/qemu-debootstrap.1.html">qemu-debootstrap</a></b>(1)
       See section <b>CHROOT</b> <b>ENVIRONMENTS</b> below.

       The embedded system is:
       - ready to be used (no installation step)
       - viable in the long-term, fully upgradable (kernel, bootloader included)
       - compatible with BIOS and UEFI systems (PC), or Raspberry Pi Boards.

       <b>debootstick</b> can also generate installer media (for PCs). See option <b>--system-type</b> below.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>debootstick</b> follows the usual GNU command line syntax, with long options starting with two dashes  (`-').
       A summary of options is included below.

       <b>-h,</b> <b>--help</b>
              Show summary of options.

       <b>-v,</b> <b>--version</b>
              Show version of program.

       <b>--help-os-support</b>
              Describe which chroot environments are supported.

       <b>--system-type</b> <b>[live|installer]</b>
              Specify  which  kind  of  system  is  targeted.  The default is <b>live</b>.  When booting a system where
              <b>installer</b> was selected, the system will try to migrate to a larger device on  first  startup.   If
              <b>live</b>  was  selected,  or  if  no  such option was specified, no migration will occur.  See section
              <b>INSTALLER</b> <b>MEDIA</b> below.

       <b>--kernel-package</b> <b>PACKAGE_NAME</b>
              Specify the kernel that should be installed. Without  this  option,  <b>debootstick</b>  will  install  a
              default one (depending on the embedded distribution).

       <b>--config-hostname</b> <b>HOSTNAME</b>
              Specify the hostname the embedded system will have.

       <b>--config-kernel-bootargs</b> <b>BOOTARGS</b>
              Specify  boot  arguments  to  be  added/removed from the kernel cmdline.  Use a plus sign to get a
              bootarg added and a minus sign to have it removed from the existing bootloader configuration.  For
              example, <b>--config-kernel-bootargs</b> <b>"+console=ttyS0</b> <b>-rootdelay"</b> will add <b>console=ttyS0</b> to the kernel
              cmdline, and remove any parameter matching <b>rootdelay=&lt;value&gt;</b> or just <b>rootdelay</b>.  When no  plus  or
              minus sign is specified, the bootarg is added (like plus).  An alternative to using this option is
              to have the bootloader installed and customized before you call <b>debootstick</b>.

       <b>--config-root-password-ask</b>
              Prompt for the root password of the embedded system and set it accordingly.

       <b>--config-root-password-none</b>
              Remove the root password of the embedded system (root login will not prompt any password).

       <b>--config-root-password-first-boot</b>
              Ask for the root password when the system will be booted for the first time.

       <b>--config-grub-on-serial-line</b>
              Update grub configuration to show boot menu on serial line. (This is obviously PC-specific.)

       <b>--disk-layout</b> <b>DISK_LAYOUT_FILE</b>
              Specify an alternate disk layout configuration file. See section <b>DISK</b> <b>LAYOUTS</b> below.

       <b>--run-on-first-boot</b> <b>FIRST_BOOT_SCRIPT_FILE</b>
              Let <b>debootstick</b> run the specified custom script (or other kind of executable) on first boot, after
              OS  resizing  or  migration  is completed.  The path specified must be relative to the root of the
              chroot environment.

       <b>--sector-size</b> <b>SECTOR_SIZE</b>
              Specify an alternate sector size (default is 512).  For instance, to build an image that  will  be
              flashed on a 4Kn disk, use <b>--sector-size</b> <b>4096</b>.
              See section <b>DISK</b> <b>SECTOR</b> <b>SIZE</b> below.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The most common workflow is the following.

       <b>1-</b> Generate a chroot environment:
       <b>debootstrap</b> --variant=minbase buster /tmp/buster_tree

       <b>2-</b> (Optionally) customize it:
       <b>chroot</b> /tmp/buster_tree; [...]; exit

       <b>3-</b> Generate the bootable image:
       <b>debootstick</b> --config-root-password-ask /tmp/buster_tree /tmp/img.dd
       Enter root password:
       Enter root password again:
       OK
       [...]

       <b>4-</b> Test it with kvm.
       <b>cp</b> /tmp/img.dd /tmp/img.dd-test    # let's work on a copy, our test is destructive
       <b>truncate</b> -s 2G /tmp/img.dd-test    # simulate a copy on a 2G-large USB stick
       <b>kvm</b> -m 2048 -hda /tmp/img.dd-test  # the test itself (BIOS mode)

       <b>5-</b> Copy the boot image to a USB stick or disk.
       <b>dd</b> bs=10M if=<b>/tmp/img.dd</b> of=/dev/your-device

       The USB device may now be booted on any BIOS or UEFI system.

</pre><h4><b>CHROOT</b> <b>ENVIRONMENTS</b></h4><pre>
       An example of chroot environment generation for a PC system is given in the previous section.

       In order to generate a chroot environment for a Raspberry Pi, you can use <b><a href="../man1/qemu-debootstrap.1.html">qemu-debootstrap</a></b>(1):
       <b>qemu-debootstrap</b>       --no-check-gpg       --arch=armhf       --variant=minbase       buster      rpi-fs
       <a href="http://mirrordirector.raspbian.org/raspbian">http://mirrordirector.raspbian.org/raspbian</a>

       Exporting the OS files from a virtual machine or a docker container  is  another  option  to  generate  a
       chroot  environment.   The  added  benefit  of  this  approach  is that a virtualized environment is very
       convenient for the OS customization phase, before calling <b>debootstick</b>.

</pre><h4><b>TARGET</b> <b>SYSTEM</b> <b>ARCHITECTURES</b></h4><pre>
       <b>debootstick</b> expects a chroot environment built for amd64 or i386 systems, or for Raspberry Pi boards.  Of
       course, the resulting image will reflect this initial architecture, and thus it should  be  booted  on  a
       compatible system.

</pre><h4><b>INSTALLER</b> <b>MEDIA</b></h4><pre>
       When first booting a system built with the <b>--system-type</b> <b>installer</b> option, it will look for a larger disk
       and  move  to  that  disk.   This  operation  does  not require a reboot. Once done, the system will just
       continue its bootup procedure (and the initial device can be removed).

       Notes:
       - <b>CAUTION:</b> Any data on the target disk will be lost!
       - The system is <b>moved</b>, not copied. Thus the initial device cannot be used anymore  after  the  migration,
       unless you copy an image on it again, of course.
       -  This option is <b>not</b> available for Raspberry Pi boards.  It would make little sense anyway, since the SD
       card is usually the only bootable media available on this kind of board.

</pre><h4><b>UEFI</b> <b>BOOTING</b></h4><pre>
       It is also possible to test the UEFI boot with <b>kvm</b>, if you have the <b>ovmf</b>  package  installed,  by  adding
       <b>-bios</b> <b>/path/to/OVMF.fd</b> to the <b>kvm</b> command line.

</pre><h4><b>DISK</b> <b>LAYOUTS</b></h4><pre>
       It is possible to modify the disk layout of the system <b>debootstick</b> generates.

       If  option  <b>--disk-layout</b>  is  not specified, a default layout file is used, and the path of this file is
       printed.
       The preferred way to write a new layout file is to copy this default file, modify it, and then add option
       <b>--disk-layout</b> <b>&lt;modified-layout&gt;</b>.
       An example of a modification could be to set <b><a href="file:/var">/var</a></b> on a different partition or dedicated LVM volume.

       Notes:
       - Not all modifications are allowed. <b>debootstick</b> will print an error message if needed.
       - Currently <b>debootstick</b> only handles fat and ext4 filesystems.

       About the size of a partition or lvm volume:
       - <b>auto</b> means <b>debootstick</b> will reserve enough space for this volume, with a little margin.  For  instance,
       on a <a href="file:/boot">/boot</a> partition with fat filesystem, it will estimate the size needed for the files stored there and
       size the partition accordingly.
       -  <b>&lt;xx&gt;[G|M]</b>  (e.g.  1G  or  50M)  means  debootstick  should allocate exactly the specified size to this
       partition/volume. Use this preferably on LVM volumes or on the last disk partition: since  previous  disk
       partitions  cannot  be  resized,  <b>debootstick</b>  has  to  reserve  the  space for them on the disk image it
       generates, which can make it large.
       - <b>&lt;xx&gt;%</b> (e.g. 10%)  means  debootstick  should  allocate  the  given  percentage  of  the  disk  to  this
       partition/volume.
       - <b>max</b> means debootstick should allocate any remaining free space to this partition/volume.

       Keep  in  mind  that  debootstick  is  supposed to generate a minimal image, and, at this time, it has no
       knowledge about the size of the device where the image will be copied.  Using <b>max</b> and  <b>&lt;xx&gt;%</b>  on  an  lvm
       volume  and  on  last  partition allows one to ensure an appropriate disk layout, when the OS will expand
       itself over the device (or migrate), on first boot.

       If LVM is used, it is possible to set a custom volume group  name  by  using  keyword  <b>lvm_vg_name</b>.   For
       instance,  one could specify <b>lvm_vg_name</b> <b>"MYVG"</b> (quotes are optional).  If not specified, or when special
       value <b>auto</b> is given instead of the group name, <b>debootstick</b> generates a random name <b>DBSTCK_&lt;hex-value&gt;</b>.
       Note that on first boot, even if a volume group name was specified, the system will first use the  random
       name  <b>DBSTCK_&lt;hex-value&gt;</b>,  and then rename it at the end of the bootup procedure.  This allows the system
       to boot properly even if the target name conflicts with a volume group already  present  on  a  secondary
       disk.

</pre><h4><b>DISK</b> <b>SECTOR</b> <b>SIZE</b></h4><pre>
       If the image should be flashed on a disk with non-default logical sector size (default is 512 bytes), one
       may use option <b>--sector-size</b> <b>&lt;value&gt;</b> to change it.

       The  value  of  option  <b>--sector-size</b>  should match the logical sector size of <b>the</b> <b>disk</b> <b>the</b> <b>image</b> <b>will</b> <b>be</b>
       <b>flashed</b> <b>on</b>. Usually, this disk is a removable device with a logical sector size of 512 bytes. Thus, in  a
       vast majority of cases debootstick should generate a compatible image with its default option value.

       When  using  the  installer mode, the fact the target disk (i.e. the disk the OS will finally migrate to)
       has a different sector size does <b>not</b> mean the image sector size should be changed.

</pre><h4><b>DESIGN</b> <b>NOTES</b></h4><pre>
       Many Live distributions propose a highly compressed system based on a squashfs image.  They handle writes
       using an overlay based on a filesystem union.  While this allows the system  to  remain  compact  in  the
       first times, this also has disavantages:
       -  Some important files remain read-only and cannot be upgraded (that is the case of the linux kernel and
       the bootloader) which quickly leads to security issues or upgrade problems.
       - Storing modified files in an overlay and never releasing the room needed for the original  versions  in
       the squashfs image is counter-productive in the long term.
       One  of  the objectives <b>debootstick</b> achieves is to provide a viable long-term live system, therefore this
       kind of setup has been discarded.

</pre><h4><b>AUTHORS</b></h4><pre>
       Etienne Duble (<a href="mailto:etienne.duble@imag.fr">etienne.duble@imag.fr</a>) and contributors.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/debootstrap.8.html">debootstrap</a></b>(8), <b><a href="../man1/qemu-debootstrap.1.html">qemu-debootstrap</a></b>(1), <b><a href="../man1/kvm.1.html">kvm</a></b>(1).

                                                November 2, 2020                                  <u><a href="../man8/DEBOOTSTICK.8.html">DEBOOTSTICK</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>