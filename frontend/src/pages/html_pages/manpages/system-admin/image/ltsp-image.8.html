<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ltsp image - generate a squashfs image from an image source</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/ltsp">ltsp_23.02-3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>ltsp</b> <b>image</b> - generate a squashfs image from an image source

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>ltsp</b>  [<u>ltsp-options</u>] <b>image</b> [<b>-b</b> <u>backup</u>] [<b>-c</b> <u>cleanup</u>] [<b>-i</b> <u>ionice</u>] [<b>-k</b> <u>kernel-initrd</u>] [<b>-m</b> <u>mksquashfs-params</u>]
       [<b>-r</b> <u>revert</u>] [<u>image</u>] ...

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Compress a virtual machine image or chroot directory into a squashfs image, to be  used  as  the  network
       root  filesystem  of  LTSP  clients. It's used in similar fashion to live CDs, i.e. all clients will boot
       from this single read only image and then use SSHFS or NFS to mount /home/username from the server.

</pre><h4><b>OPTIONS</b></h4><pre>
       See the <b><a href="../man8/ltsp.8.html">ltsp</a>(8)</b> man page for <u>ltsp-options</u>.

       <b>-b</b>, <b>--backup</b>=<u>0|1</u>
              Backup /srv/ltsp/images/<u>image</u>.img to <u>image</u>.img.old. Defaults to 1.

       <b>-c</b>, <b>--cleanup</b>=<u>0|1</u>
              Create a writeable overlay on top of the image source and temporarily  remove  user  accounts  and
              sensitive data before calling mksquashfs.  Defaults to 1.

       <b>-i</b>, <b>--ionice</b>=<u>cmdline</u>
              Set  a  prefix  command  to  run  mksquashfs  with  a  lower priority, or specify "" to disable it
              completely. Defaults to <b>nice</b> <b>ionice</b> <b>-c3</b>.

       <b>-k</b>, <b>--kernel-initrd</b>=<u>glob-regex</u>
              Pass this parameter to the <b>ltsp</b> <b>kernel</b> call after the squashfs creation.  See  <a href="../man8/ltsp-kernel.8.html">ltsp-kernel</a>(8)  for
              more information.

       <b>-m</b>, <b>--mksquashfs-params</b>=<u>"params"</u>
              Pass   <u>$params</u>  to  the  mksquashfs  call  unquoted;  so  <u>params</u>  shouldn't  contain  spaces.  See
              <a href="../man1/mksquashfs.1.html">mksquashfs</a>(1) for more information.

       <b>-r</b>, <b>--revert</b>[=<u>0|1</u>]
              Move /srv/ltsp/images/<u>image</u>.img.old to <u>image</u>.img and call  <b>ltsp</b>  <b>kernel</b>  <b>image</b>.  Useful  when  the
              clients won't boot with the new image.

</pre><h4><b>IMAGE</b> <b>TYPES</b></h4><pre>
       There  are  three "image" types in LTSP, in the following locations. The /srv/ltsp path can be configured
       using <b>ltsp</b> <b>--base-dir=</b>:

       <b>/srv/ltsp/</b><u>img_name</u><b>.img</b>
              Source images are placed directly under /srv/ltsp and usually are symlinks to virtual machine  raw
              disk files. They're only used by <b>ltsp</b> <b>image</b>.

       <b>/srv/ltsp/</b><u>img_name</u>
              Chroot  directories  can  be  used  both as sources for <b>ltsp</b> <b>image</b> and as NFS root exports for the
              clients.

       <b>/srv/ltsp/images/</b><u>img_name</u><b>.img</b>
              Exported images (usually squashfs) are placed under the  images  directory  and  the  clients  can
              netboot from them.

       Images  can  be  specified  as  simple  names  like <b>ltsp</b> <b>image</b> <b>img_name</b>, in which case the aforementioned
       locations are searched, or as or full paths like <b>ltsp</b> <b>image</b> <b><a href="file:~/VMs/vm.img">~/VMs/vm.img</a></b>.

       The supported image types result in the following three methods to use LTSP.  You may use either  one  of
       the methods or even all of them at the same time.

</pre><h4><b>CHROOTLESS</b></h4><pre>
       Chrootless  LTSP,  previously  called  "ltsp-pnp",  is  the  recommended  way  to  maintain  LTSP  <b>if</b> its
       restrictions are acceptable.  In this mode, the  server  operating  system  itself  is  exported  into  a
       squashfs file and used for netbooting all the clients. You, the sysadmin, would use the typical GUI tools
       to manage the server, like software centers or update managers. Then whenever necessary, you'd run:

       ltsp image /

       This  creates  or  updates /srv/ltsp/images/x86_64.img (the arch name comes from <b>uname</b> <b>-m</b>). Then, all the
       clients should be able to boot from x86_64.img and have a desktop environment identical to the server.

       The big advantage of the chrootless mode  is  simplicity:  there  are  no  virtual  machines  or  chroots
       involved.  You'd  maintain the server like any "home desktop PC", and have all clients be exact replicas,
       which is as simple as it gets.

       The disadvantages are that the clients need to have  the  same  architecture  as  the  server  (e.g.  all
       x86_64),  and  that  the  server  can't  be a "full blown server" with LDAP and Apache and a lot of other
       services, without taking care to disable those services on  the  clients  with  the  MASK_SYSTEM_SERVICES
       parameter  of ltsp.conf. Note that MASK_SYSTEM_SERVICES already includes Apache and MySQL and a few other
       popular services that we don't want in LTSP clients, so it's not a problem if you install Apache  on  the
       LTSP server.

       If for some reason you prefer a different name to <b>uname</b> <b>-m</b>, you may create a symlink:

       ln -s / <a href="file:~/amd64">~/amd64</a>

       ...and run <b>ltsp</b> <b>image</b> <b><a href="file:~/amd64">~/amd64</a></b> instead.

</pre><h4><b>VM</b> <b>IMAGES</b></h4><pre>
       If  the  chrootless  case  doesn't fit you, you may use VirtualBox, virt-manager, KVM, VMWare and similar
       tools to maintain one or more template images for the clients. As an example, let's suppose you create  a
       VM  in VirtualBox and call it "debian". At the disk creation dialog, select "VMDK" type and "Fixed size",
       not "Dynamically allocated". Proceed with installing Debian on it.  In the partitioning step,  make  sure
       that  the  whole  operating  system  goes in the first partition, without extra partitions for <a href="file:/boot">/boot</a> etc.
       BIOS/MBR is easier, while if you have to use GPT/UEFI, put the EFI partition second.  When  you're  done,
       close VirtualBox and symlink the VM disk so that LTSP finds it more easily:

       ln -rs <a href="file:~/VirtualBox">~/VirtualBox</a>\ VMs/debian/debian-flat.vmdk /srv/ltsp/debian.img

       To export this image to the clients, after the initial creation or after updates etc, you'd run:

       ltsp image debian

       It's also possible to omit the symlink by running:

       ltsp image <a href="file:~/VirtualBox">~/VirtualBox</a>\ VMs/debian/debian-flat.vmdk

       ...but then the image name shown in the iPXE boot menu would be "debian-flat", which isn't pretty.

       In  summary,  you  may symlink raw VM disks in /srv/ltsp/img_name.img, and <b>ltsp</b> <b>image</b> <b>img_name</b> will allow
       LTSP clients to netboot from them.  Please also see the DIRECT IMAGES section of  <a href="../man8/ltsp-kernel.8.html">ltsp-kernel</a>(8)  for  an
       advanced method of allowing clients to netboot directly from a VM or .iso image without even running <b>ltsp</b>
       <b>image</b>,  and  the  ADVANCED  IMAGE SOURCES section of <a href="../man8/ltsp-ipxe.8.html">ltsp-ipxe</a>(8) for extreme cases like telling the LTSP
       clients to boot from an .iso image inside a local disk partition!

</pre><h4><b>CHROOTS</b></h4><pre>
       Chroot directories in /srv/ltsp/img_name are properly supported as  image  sources  by  LTSP,  but  their
       creation  and  maintenance  are  left  to external tools like debootstrap, lxc etc. The <b>ltsp-build-client</b>
       LTSPv5 tool no longer exists. LTSP users are invited to create appropriate documentation in the community
       wiki ⟨https://github.com/ltsp/ltsp/wiki/chroots⟩.  As a small example, you  can  use  kvm  to  netboot  a
       chroot and maintain it if you NFS-export /srv/ltsp/img_name in rw mode for your server IP, and then run

       kvm -m 512 -kernel img_name/vmlinuz -initrd img_name/initrd.img \
           -append "rw root=/dev/nfs nfsroot=192.168.67.1:/srv/ltsp/img_name"

</pre><h4><b>EXAMPLES</b></h4><pre>
       Use the server installation as a template to generate a client image (chrootless, previously called ltsp-
       pnp):

       ltsp image /

       Inform <b>ltsp</b> <b>image</b> that a chrootless installation uses separate <a href="file:/boot">/boot</a> and <a href="file:/opt">/opt</a> partitions:

       ltsp image /,,<a href="file:/boot">/boot</a>,subdir=boot,,<a href="file:/opt">/opt</a>,subdir=opt

       Compress  the /srv/ltsp/x86_64 chroot or the /srv/ltsp/x86_64.img virtual machine image, whichever exists
       of those two, into /srv/ltsp/images/x86_64.img, while disabling ionice:

       ltsp image --ionice="" x86_64

       Specify an absolute path to a virtual machine image:

       ltsp image /home/user/VirtualBox\ VMs/x86_32/x86_32-flat.vmdk

       Revert to the the previous version of the "chrootless" image:

       ltsp image -r /

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2019-2022 the LTSP team, see AUTHORS.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/ltsp.8.html">ltsp</a></b>(8), <b><a href="../man5/ltsp.conf.5.html">ltsp.conf</a></b>(5), <b><a href="../man8/ltsp-dnsmasq.8.html">ltsp-dnsmasq</a></b>(8), ,  <b><a href="../man8/ltsp-info.8.html">ltsp-info</a></b>(8),  <b><a href="../man8/ltsp-initrd.8.html">ltsp-initrd</a></b>(8),  <b><a href="../man8/ltsp-ipxe.8.html">ltsp-ipxe</a></b>(8),  <b><a href="../man8/ltsp-kernel.8.html">ltsp-kernel</a></b>(8),
       <b><a href="../man8/ltsp-nfs.8.html">ltsp-nfs</a></b>(8), <b><a href="../man8/ltsp-remoteapps.8.html">ltsp-remoteapps</a></b>(8)

       Online documentation is available on https://ltsp.org

LTSP 23.02-3                                       2024-09-07                                      <u><a href="../man8/LTSP-IMAGE.8.html">LTSP-IMAGE</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>