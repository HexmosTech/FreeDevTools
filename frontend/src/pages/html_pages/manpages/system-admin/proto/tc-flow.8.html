<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flow - flow based traffic control filter</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/iproute2">iproute2_6.14.0-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       flow - flow based traffic control filter

</pre><h4><b>SYNOPSIS</b></h4><pre>
       Mapping mode:

              <b>tc</b> <b>filter</b> ... <b>flow</b> <b>map</b> <b>key</b> <u>KEY</u> [ <u>OPS</u> ] [ <u>OPTIONS</u> ]

       Hashing mode:

              <b>tc</b> <b>filter</b> ... <b>flow</b> <b>hash</b> <b>keys</b> <u>KEY_LIST</u> [ <b>perturb</b> <u>secs</u> ] [ <u>OPTIONS</u> ]

       <u>OPS</u> := [ <u>OPS</u> ] <u>OP</u>

       <u>OPTIONS</u> := [ <b>divisor</b> <u>NUM</u> ] [ <b>baseclass</b> <u>ID</u> ] [ <b>match</b> <u>EMATCH_TREE</u> ] [ <b>action</b> <u>ACTION_SPEC</u> ]

       <u>KEY_LIST</u> := [ <u>KEY_LIST</u> ] <u>KEY</u>

       <u>OP</u> := { <b>or</b> | <b>and</b> | <b>xor</b> | <b>rshift</b> | <b>addend</b> } <u>NUM</u>

       <u>ID</u> := <u>X</u>:<u>Y</u>

       <u>KEY</u> := { <b>src</b> | <b>dst</b> | <b>proto</b> | <b>proto-src</b> | <b>proto-dst</b> | <b>iif</b> | <b>priority</b> | <b>mark</b> | <b>nfct</b> | <b>nfct-src</b> | <b>nfct-dst</b> |
               <b>nfct-proto-src</b> | <b>nfct-proto-dst</b> | <b>rt-classid</b> | <b>sk-uid</b> | <b>sk-gid</b> | <b>vlan-tag</b> | <b>rxhash</b> }

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>flow</b>  classifier  is  meant  to  extend  the  <b>SFQ</b>  hashing capabilities without hard-coding new hash
       functions. It also allows deterministic mappings of keys to classes.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>action</b> <u>ACTION_SPEC</u>
              Apply an action from the generic actions framework on matching packets.

       <b>baseclass</b> <u>ID</u>
              An offset for the resulting class ID.  <u>ID</u> may be <b>root</b>, <b>none</b> or a hexadecimal class ID in the  form
              [<u>X</u><b>:</b>]<u>Y</u>.  <u>X</u>  must  match  qdisc's/class's  major  handle  (if  omitted,  the correct value is chosen
              automatically). If the whole <b>baseclass</b> is omitted, <u>Y</u> defaults to 1.

       <b>divisor</b> <u>NUM</u>
              Number of buckets to use for sorting into. Keys are calculated modulo <u>NUM</u>.

       <b>hash</b> <b>keys</b> <u>KEY-LIST</u>
              Perform a <b>jhash2</b> operation over the keys in <u>KEY-LIST</u>, the result (modulo the <b>divisor</b> if given)  is
              taken  as  class  ID,  optionally  offset by the value of <b>baseclass</b>.  It is possible to specify an
              interval (in seconds)  after  which  <b>jhash2</b>'s  entropy  source  is  recreated  using  the  <b>perturb</b>
              parameter.

       <b>map</b> <b>key</b> <u>KEY</u>
              Packet  data identified by <u>KEY</u> is translated into class IDs to push the packet into. The value may
              be mangled by <u>OPS</u> before using it for the mapping. They are applied in the order listed here:

              <b>and</b> <u>NUM</u>
                  Perform bitwise <b>AND</b> operation with numeric value <u>NUM</u>.

              <b>or</b> <u>NUM</u>
                  Perform bitwise <b>OR</b> operation with numeric value <u>NUM</u>.

              <b>xor</b> <u>NUM</u>
                  Perform bitwise <b>XOR</b> operation with numeric value <u>NUM</u>.

              <b>rshift</b> <u>NUM</u>
                  Shift the value of <u>KEY</u> to the right by <u>NUM</u> bits.

              <b>addend</b> <u>NUM</u>
                  Add <u>NUM</u> to the value of <u>KEY</u>.

              For the <b>or</b>, <b>and</b>, <b>xor</b> and <b>rshift</b> operations, <u>NUM</u> is assumed to be an unsigned, 32bit integer value.
              For the <b>addend</b> operation, <u>NUM</u> may be much more complex: It may be prefixed by a minus  ('-')  sign
              to cause subtraction instead of addition and for keys of <b>src</b>, <b>dst</b>, <b>nfct-src</b> and <b>nfct-dst</b> it may be
              given in IP address notation. See below for an illustrating example.

       <b>match</b> <u>EMATCH_TREE</u>
              Match packets using the extended match infrastructure. See <b><a href="../man8/tc-ematch.8.html">tc-ematch</a></b>(8) for a detailed description
              of the allowed syntax in <u>EMATCH_TREE</u>.

</pre><h4><b>KEYS</b></h4><pre>
       In  mapping mode, a single key is used (after optional permutation) to build a class ID. The resulting ID
       is deducible in most cases. In hashing more, a number of keys may be specified which are then hashed  and
       the output used as class ID.  This ID is not deducible in beforehand, and may even change over time for a
       given flow if a <b>perturb</b> interval has been given.

       The range of class IDs can be limited by the <b>divisor</b> option, which is used for a modulus.

       <b>src</b>, <b>dst</b>
              Use  source  or  destination  address as key. In case of IPv4 and TIPC, this is the actual address
              value. For IPv6, the 128bit address is folded into a 32bit value by XOR'ing the four 32bit  words.
              In all other cases, the kernel-internal socket address is used (after folding into 32bits on 64bit
              systems).

       <b>proto</b>  Use the layer four protocol number as key.

       <b>proto-src</b>
              Use  the  layer  four  source port as key. If not available, the kernel-internal socket address is
              used instead.

       <b>proto-dst</b>
              Use the layer four destination port as key.  If  not  available,  the  associated  kernel-internal
              dst_entry address is used after XOR'ing with the packet's layer three protocol number.

       <b>iif</b>    Use the incoming interface index as key.

       <b>priority</b>
              Use the packet's priority as key. Usually this is the IP header's DSCP/ECN value.

       <b>mark</b>   Use the netfilter <b>fwmark</b> as key.

       <b>nfct</b>   Use the associated conntrack entry address as key.

       <b>nfct-src</b>, <b>nfct-dst</b>, <b>nfct-proto-src</b>, <b>nfct-proto-dst</b>
              These  are  conntrack-aware  variants of <b>src</b>, <b>dst</b>, <b>proto-src</b> and <b>proto-dst</b>.  In case of NAT, these
              are basically the packet header's values before NAT was applied.

       <b>rt-classid</b>
              Use the packet's destination routing table entry's realm as key.

       <b>sk-uid</b>
       <b>sk-gid</b> For locally generated packets, use the user or group ID the originating socket belongs to as key.

       <b>vlan-tag</b>
              Use the packet's vlan ID as key.

       <b>rxhash</b> Use the flow hash as key.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Classic SFQ hash:

              tc filter add ... flow hash \
                   keys src,dst,proto,proto-src,proto-dst divisor 1024

       Classic SFQ hash, but using information from conntrack to work properly in combination with NAT:

              tc filter add ... flow hash \
                   keys nfct-src,nfct-dst,proto,nfct-proto-src,nfct-proto-dst \
                   divisor 1024

       Map destination IPs of 192.168.0.0/24 to classids 1-256:

              tc filter add ... flow map \
                   key dst addend -192.168.0.0 divisor 256

       Alternative to the above:

              tc filter add ... flow map \
                   key dst and 0xff

       The same, but in reverse order:

              tc filter add ... flow map \
                   key dst and 0xff xor 0xff

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/tc.8.html">tc</a></b>(8), <b><a href="../man8/tc-ematch.8.html">tc-ematch</a></b>(8), <b><a href="../man8/tc-sfq.8.html">tc-sfq</a></b>(8)

iproute2                                           20 Oct 2015                              <u>Flow</u> <u>filter</u> <u>in</u> <u><a href="../man8/tc.8.html">tc</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>