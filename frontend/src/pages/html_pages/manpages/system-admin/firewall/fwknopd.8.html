<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fwknopd - Firewall Knock Operator Daemon</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/fwknop-server">fwknop-server_2.6.11-2build1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       fwknopd - Firewall Knock Operator Daemon

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>fwknopd</b> [<u>options</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>fwknopd</b> is the server component for the FireWall Knock Operator, and is responsible for monitoring and
       processing Single Packet Authorization (SPA) packets that are generated by <b>fwknop</b> clients, modifying a
       firewall or ACL policy to allow the desired access after authenticating and decrypting a valid SPA packet
       (in that order), and removing access after a configurable timeout.

       The main application of this program is to conceal services such as <u>SSH</u> with an additional layer of
       security in order to make the exploitation of vulnerabilities (both 0-day and unpatched code) much more
       difficult. In addition, services that are concealed in this fashion naturally cannot be scanned for with
       <u>Nmap</u> or <u>Shodan</u>.

       The main configuration for <b>fwknopd</b> is maintained within two files: <u>fwknopd.conf</u> and <u>access.conf</u>. The
       default location for these files is determined at package configuration (typically <u>/etc/fwknop</u>). The
       configuration variables within these files are described below.

       Additional information may be found in the tutorial “Single Packet Authorization: A Comprehensive Guide
       to Strong Service Concealment with fwknop” available online (see:
       <u><a href="http://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html">http://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html</a></u>).

</pre><h4><b>COMMAND-LINE</b> <b>OPTIONS</b></h4><pre>
       <b>-i,</b> <b>--interface</b>=<u>&lt;interface&gt;</u>
           Manually specify interface on which to sniff, e.g. “-i eth0”. This option is not usually needed
           because the “PCAP_INTF” keyword in the <u>fwknopd.conf</u> file defines the sniffing interface.

       <b>-f,</b> <b>--foreground</b>
           Run <b>fwknopd</b> in the foreground instead of becoming a daemon. When run in the foreground, message that
           would go to the log would instead be sent to stderr. This mode is usually used when testing and/or
           debugging.

       <b>--fw-list</b>
           List only firewall rules that any running <b>fwknopd</b> daemon has created and then exit.

       <b>-a,</b> <b>--access-file</b>=<u>&lt;access-file&gt;</u>
           Specify the location of the <u>access.conf</u> file. If this option is not given, <u>fwknopd</u> will use the
           compile-time default location (typically <u>/etc/fwknop/access.conf</u>).

       <b>--access-folder</b>=<u>&lt;access-folder&gt;</u>
           Specify the location of the <u>access.conf</u> folder. If this option is given, rather than load a single
           access.conf file, all the .conf files in the given folders are processed.

       <b>-c,</b> <b>--config</b>=<u>&lt;config-file&gt;</u>
           Specify the location of the <u>fwknopd.conf</u> file. If this option is not given, <u>fwknopd</u> will use the
           default location (typically <u>/etc/fwknop/fwknopd.conf</u>.

       <b>-C,</b> <b>--packet-limit</b>=<u>&lt;n&gt;</u>
           Specify the number of candidate SPA packets to process and exit when this limit is reached.

       <b>-d,</b> <b>--digest-file</b>=<u>&lt;digest-file&gt;</u>
           Specify the location of the <u>digest.cache</u> file. If this option is not given, <u>fwknopd</u> will use the
           compile-time default location (typically <u>@runstatedir@/fwknop/digest.cache</u>).

       <b>-D,</b> <b>--dump-config</b>
           Dump the configuration values that <b>fwknopd</b> derives from the <u>/etc/fwknop/fwknopd.conf</u> (or override
           files) and <u>/etc/fwknop/access.conf</u> on stderr.

       <b>--dump-serv-err-codes</b>
           Dump all possible <b>fwknopd</b> error codes to stdout and exit. This option is rarely needed in practice,
           and was added to assist with test coverage.

       <b>--fault-injection-tag</b>=<u>&lt;tag&gt;</u>
           This option is only used for fault injection testing when <b>fwknop</b> is compiled to support the libfiu
           library (see: <u><a href="http://blitiri.com.ar/p/libfiu/">http://blitiri.com.ar/p/libfiu/</a></u>). Under normal circumstances this option is not used,
           and any packaged version of fwknop will not have code compiled in so this capability is not enabled
           at run time. It is documented here for completeness. version of fwknop will not have code compiled in
           to enable this capability at run time. It is documented here for completeness.

       <b>-A,</b> <b>--afl-fuzzing</b>
           Instruct <b>fwknopd</b> to acquire SPA packets directly from stdin in support of fuzzing operations from the
           <u>American</u> <u>Fuzzy</u> <u>Lop</u> (AFL) fuzzer written by Michal Zalewski. This requires that <b>fwknop</b> is compiled
           with the <u>--enable-afl-fuzzing</u> argument to the <b>configure</b> script as this allows encryption/digest short
           circuiting in a manner necessary for AFL to function properly. The benefit of this strategy is that
           AFL can fuzz the SPA packet decoding routines implemented by <b>libfko</b>.

       <b>--fw-list-all</b>
           List all firewall rules including those that have nothing to do with <b>fwknopd</b>.

       <b>--fw-flush</b>
           Flush any firewall rules created by a running <b>fwknopd</b> process. This option allows the used to easily
           delete <b>fwknopd</b> firewall rules without having to wait for them to be timed out.

       <b>-K,</b> <b>--kill</b>
           Kill the current <b>fwknopd</b> process. This provides a quick and easy way to stop <b>fwknopd</b> without having
           to look in the process table.

       <b>--exit-parse-config</b>
           Parse config files (<u>/etc/fwknop/fwknopd.conf</u>, and <u>/etc/fwknop/access.conf</u>) and then exit. This
           provides a way to test whether the config files are properly structured without having to start
           processing network traffic.

       <b>--exit-parse-digest-cache</b>
           Parse the digest cache file <u>@runstatedir@/fwknop/digest.cache</u> and exit. This validates the structure
           of the digest cache file without having to start processing network traffic. Note that the standard
           configuration files are also parsed in this mode.

       <b>-l,</b> <b>--locale</b>=<u>&lt;locale&gt;</u>
           Set/override the system default locale setting.

       <b>--no-ipt-check-support</b>
           Disable the usage of the iptables <u>-C</u> option. This is not normally needed, and is only useful on older
           Linux distributions where iptables does not have <u>-C</u> support.

       <b>-O,</b> <b>--override-config</b>=<u>&lt;file&gt;</u>
           Override config variable values that are normally read from the <u>/etc/fwknop/fwknopd.conf</u> file with
           values from the specified file. Multiple override config files can be given as a comma-separated
           list.

       <b>--key-gen</b>
           Have <b>fwknopd</b> generate both Rijndael and HMAC keys that can be used for SPA packet encryption and
           authentication. These keys are derived from /dev/urandom and then base64 encoded before being printed
           to stdout, and are meant to be manually included in a stanza within the <u>/etc/fwknop/access.conf</u> file.
           Such keys are generally more secure than passphrases.

       <b>--key-gen-file</b>=<u>&lt;file&gt;</u>
           Write generated keys to the specified file. Note that the file is overwritten if it already exists.
           If this option is not given, then <b>--key-gen</b> writes the keys to stdout.

       <b>--key-len</b>=<u>&lt;length&gt;</u>
           Specify the number of bytes for a generated Rijndael key. The maximum size is currently 128 bytes.

       <b>--hmac-key-len</b>=<u>&lt;length&gt;</u>
           Specify the number of bytes for a generated HMAC key. The maximum size is currently 128 bytes.

       <b>-p,</b> <b>--pid-file</b>=<u>&lt;pid-file&gt;</u>
           Specify the location of the <u>fwknopd.pid</u> file. If this option is not given, <u>fwknopd</u> will use the
           compile-time default location (typically <u>@runstatedir@/fwknop/fwknopd.pid</u>).

       <b>-P,</b> <b>--pcap-filter</b>=<u>&lt;filter&gt;</u>
           Specify a Berkeley packet filter statement on the <b>fwknopd</b> command line. This overrides the value of
           the PCAP_FILTER variable taken from the <u>/etc/fwknop/fwknopd.conf</u> file.

       <b>--pcap-file</b>=<u>&lt;pcap-file&gt;</u>
           This option instructs <b>fwknopd</b> to read packet data from a pcap file instead of sniffing an interface
           directly. This mode is usually used for debugging purposes, and will disable SPA packet age checking
           unless it is manually enabled in the <u>/etc/fwknop/fwknopd.conf</u> file.

       <b>--pcap-any-direction</b>
           Allow <b>fwknopd</b> to sniff SPA packets regardless of whether they are received on the sniffing interface
           or sent from the sniffing interface. In the later case, this can be useful to have fwknopd sniff SPA
           packets that are forwarded through a system and destined for a different network. If the sniffing
           interface is the egress interface for such packets (and hence SPA packets are sent by this interface
           instead of received), then this option will need to used in order for <b>fwknopd</b> to see them. The
           default is to only sniff packets that are received on the sniffing interface. Note that this setting
           is independent of promiscuous mode.

       <b>-R,</b> <b>--restart</b>
           Restart the currently running <b>fwknopd</b> processes. This option will preserve the command line options
           that were supplied to the original <b>fwknopd</b> process but will force <b>fwknopd</b> to re-read the <u>fwknopd.conf</u>
           and <u>/etc/fwknop/access.conf</u> files. This will also force a flush of the current “FWKNOP” iptables
           chain(s).

       <b>--rotate-digest-cache</b>
           Rotate the digest cache file by renaming it to “&lt;name&gt;-old”, and starting a new one. The digest cache
           file is typically found in <u>@runstatedir@/fwknop/digest.cache</u>.

       <b>-r,</b> <b>--run-dir</b>=<u>&lt;path&gt;</u>
           Specify the directory where <b>fwknopd</b> writes run time state files. The default is <u>@runstatedir@</u>.

       <b>-S,</b> <b>--status</b>
           Display the status of any <b>fwknopd</b> processes that may or not be running. If there is an existing
           fwknopd process then 0 is returned for the exit status and 1 is returned otherwise.

       <b>--syslog-enable</b>
           Allow messages to be sent to syslog even if the foreground mode is set.

       <b>-t,</b> <b>--test</b>
           Run <b>fwknopd</b> in test mode. This instructs <b>fwknopd</b> to acquire and process SPA packets, but not
           manipulate firewall rules or execute commands that are provided by SPA clients. This option is mostly
           useful for the fuzzing tests in the test suite to ensure broad code coverage under adverse
           conditions.

       <b>-U,</b> <b>--udp-server</b>
           Run <b>fwknopd</b> in UDP server mode so that SPA packets are acquired via a UDP socket directly without
           having to use libpcap. See the discussion of the “ENABLE_UDP_SERVER” configuration variable below for
           more information.

       <b>-v,</b> <b>--verbose</b>
           Run <b>fwknopd</b> in verbose mode. This can option can be specified multiple times to increase the
           verbosity of the output to the system log file (or to the screen if running in the foreground).

       <b>-h,</b> <b>--help</b>
           Display usage information and exit.

       <b>-V,</b> <b>--Version</b>
           Display version information and exit.

</pre><h4><b>FWKNOPD</b> <b>CONFIG</b> <b>AND</b> <b>ACCESS</b> <b>VARIABLES</b></h4><pre>
       <b>fwknopd</b> references the <u>/etc/fwknop/fwknopd.conf</u> file for configuration variables to define operational
       parameters (what network interface and port to sniff, what features to enable/disable, etc.). The
       <u>fwknopd.conf</u> file does not define any access control directives or set any encryption or authentication
       keys.

       The access control directives are contained in the <u>/etc/fwknop/access.conf</u> file. Access control
       directives define encryption keys and level of access that is granted to an fwknop client that has
       generated the appropriate encrypted SPA message.

   <b>FWKNOPD.CONF</b> <b>VARIABLES</b>
       This section list the more prominent configuration variables used by <b>fwknopd</b>. You will want to make sure
       to check these to make sure they have appropriate values, but sensible defaults are provided for most
       systems. See the <u>/etc/fwknop/fwknopd.conf</u> file for additional details.

       <b>PCAP_INTF</b> <u>&lt;interface&gt;</u>
           Specify the ethernet interface on which <b>fwknopd</b> will sniff packets.

       <b>ENABLE_PCAP_PROMISC</b> <u>&lt;Y/N&gt;</u>
           By default <b>fwknopd</b> puts the pcap interface into promiscuous mode. Set this to “N” to disable that
           behavior (non-promiscuous).

       <b>PCAP_FILTER</b> <u>&lt;pcap</u> <u>filter</u> <u>spec&gt;</u>
           Define the filter used for <u>PCAP</u> modes; <b>fwknopd</b> defaults to UDP port 62201. However, if an <b>fwknop</b>
           client uses the <b>--rand-port</b> option to send the SPA packet over a random port, then this variable
           should be updated to something like “udp dst portrange 10000-65535”.

       <b>ENABLE_SPA_PACKET_AGING</b> <u>&lt;Y/N&gt;</u>
           This instructs <b>fwknopd</b> to not honor SPA packets that have an old time stamp. The value for “old” is
           defined by the “MAX_SPA_PACKET_AGE” variable. If “ENABLE_SPA_PACKET_AGING” is set to “N”, <b>fwknopd</b>
           will not use the client time stamp at all.

       <b>MAX_SPA_PACKET_AGE</b> <u>&lt;seconds&gt;</u>
           Defines the maximum age (in seconds) that an SPA packet will be accepted. This requires that the
           client system is in relatively close time synchronization with the <b>fwknopd</b> server system (NTP is
           good). The default age is 120 seconds (two minutes).

       <b>ENABLE_DIGEST_PERSISTENCE</b> <u>&lt;Y/N&gt;</u>
           Track digest sums associated with previous SPA packets processed by <b>fwknopd</b>. This allows digest sums
           to remain persistent across executions of <b>fwknopd</b>. The default is “Y”. If set to “N”, <b>fwknopd</b> will
           not check incoming SPA packet data against any previously save digests. It is a good idea to leave
           this feature on to reduce the possibility of being vulnerable to a replay attack.

       <b>RULES_CHECK_THRESHOLD</b> <u>&lt;count&gt;</u>
           Defines the number of times firewall rule expiration times must be checked before a "deep" check is
           run. This allows <b>fwknopd</b> to remove rules that contain a proper <u>exp&lt;time&gt;</u> even if a third party
           program added them instead of <b>fwknopd</b>. The default value for this variable is 20, and this typically
           results in this check being run every two seconds or so. To disable this type of checking altogether,
           set this variable to zero.

       <b>ENABLE_IPT_FORWARDING</b> <u>&lt;Y/N&gt;</u>
           Allow SPA clients to request access to services through an iptables firewall instead of just to it
           (i.e. access through the FWKNOP_FORWARD chain instead of the INPUT chain).

       <b>ENABLE_IPT_LOCAL_NAT</b> <u>&lt;Y/N&gt;</u>
           Allow SPA clients to request access to a local socket via NAT. This still puts an ACCEPT rule into
           the FWKNOP_INPUT chain, but a different port is translated via DNAT rules to the real one. So, the
           user would do “ssh -p &lt;port&gt;” to access the local service (see the <b>--NAT-local</b> and <b>--NAT-rand-port</b> on
           the <b>fwknop</b> client command line).

       <b>ENABLE_IPT_SNAT</b> <u>&lt;Y/N&gt;</u>
           Set this to “Y” to enable a corresponding SNAT rule. By default, if forwarding access is enabled (see
           the “ENABLE_IPT_FORWARDING” variable above), then <b>fwknopd</b> creates DNAT rules for incoming
           connections, but does not also complement these rules with SNAT rules at the same time. In some
           situations, internal systems may not have a route back out for the source address of the incoming
           connection, so it is necessary to also apply SNAT rules so that the internal systems see the IP of
           the internal interface where <b>fwknopd</b> is running.

       <b>SNAT_TRANSLATE_IP</b> <u>&lt;ip_address&gt;</u>
           Specify the IP address for SNAT. This functionality is only enabled when “ENABLE_IPT_SNAT” is set to
           “Y” and by default SNAT rules are built with the MASQUERADE target (since then the internal IP does
           not have to be defined here in the <u>/etc/fwknop/fwknopd.conf</u> file), but if you want <b>fwknopd</b> to use the
           SNAT target, you must also define an IP address with the “SNAT_TRANSLATE_IP” variable. Note that this
           variable is generally deprecated in favor of the “FORCE_SNAT” variable in the <u>/etc/fwknop/access.conf</u>
           file which enables per-stanza control over the SNAT IP.

       <b>ENABLE_IPT_OUTPUT</b> <u>&lt;Y/N&gt;</u>
           Add ACCEPT rules to the FWKNOP_OUTPUT chain. This is usually only useful if there are no state
           tracking rules to allow connection responses out and the OUTPUT chain has a default-drop stance.

       <b>MAX_SNIFF_BYTES</b> <u>&lt;bytes&gt;</u>
           Specify the the maximum number of bytes to sniff per frame. 1500 is the default.

       <b>FLUSH_IPT_AT_INIT</b> <u>&lt;Y/N&gt;</u>
           Flush all existing rules in the fwknop chains at <b>fwknopd</b> start time. The default is “Y”.

       <b>FLUSH_IPT_AT_EXIT</b> <u>&lt;Y/N&gt;</u>
           Flush all existing rules in the fwknop chains when <b>fwknopd</b> is stopped or otherwise exits cleanly. The
           default is “Y”.

       <b>EXIT_AT_INTF_DOWN</b> <u>&lt;Y/N&gt;</u>
           When <b>fwknopd</b> is sniffing an interface, if the interface is administratively downed or unplugged,
           fwknopd will cleanly exit and an assumption is made that any process monitoring infrastructure like
           systemd or upstart will restart it. However, if fwknopd is not being monitored by systemd, upstart,
           or anything else, this behavior can be disabled with the “EXIT_AT_INTF_DOWN” variable. If disabled,
           fwknopd will try to recover when a downed interface comes back up.

       <b>ENABLE_RULE_PREPEND</b> <u>&lt;Y/N&gt;</u>
           For systems running iptables or firewalld, have <b>fwknopd</b> insert new SPA rules at the beginning of the
           relevant chain (such as “FWKNOP_INPUT”) instead of appending them to the end of the chain. This
           causes newly created rules to have precedence over older ones.

       <b>ENABLE_NAT_DNS</b> <u>&lt;Y/N&gt;</u>
           Allow fwknopd to resolve hostnames in NAT access messages.

       <b>GPG_HOME_DIR</b> <u>&lt;path&gt;</u>
           If GPG keys are used instead of a Rijndael symmetric key, this is the default GPG keys directory.
           Note that each access stanza in <u>/etc/fwknop/access.conf</u> can specify its own GPG directory to override
           this default. If not set here or in an <u>access.conf</u> stanza, then the <u>$HOME/.gnupg</u> directory of the
           user running <b>fwknopd</b> (most likely root).

       <b>GPG_EXE</b> <u>&lt;path&gt;</u>
           Specify the path to GPG, and defaults to <u><a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?gpg">/usr/bin/gpg</a></u> if not set.

       <b>LOCALE</b> <u>&lt;locale&gt;</u>
           Set the locale (via the LC_ALL variable). This can be set to override the default system locale.

       <b>ENABLE_SPA_OVER_HTTP</b> <u>&lt;Y/N&gt;</u>
           Allow <b>fwknopd</b> to acquire SPA data from HTTP requests (generated with the fwknop client in <b>--HTTP</b>
           mode). Note that when this is enabled, the “PCAP_FILTER” variable would need to be updated to sniff
           traffic over TCP/80 connections and a web server should be running on the same server as <b>fwknopd</b>.

       <b>ENABLE_X_FORWARDED_FOR</b> <u>&lt;Y/N&gt;</u>
           Allows <b>fwknopd</b> to use the X-Forwarded-for header from a captured SPA packet over HTTP as the source
           IP. This can happen when using SPA through an HTTP proxy.

       <b>ENABLE_TCP_SERVER</b> <u>&lt;Y/N&gt;</u>
           Enable the fwknopd TCP server. This is a "dummy" TCP server that will accept TCP connection requests
           on the specified TCPSERV_PORT. If set to "Y", fwknopd will fork off a child process to listen for,
           and accept incoming TCP request. This server only accepts the request. It does not otherwise
           communicate. This is only to allow the incoming SPA over TCP packet which is detected via PCAP. The
           connection is closed after 1 second regardless. Note that fwknopd still only gets its data via pcap,
           so the filter defined by PCAP_FILTER needs to be updated to include this TCP port.

       <b>TCPSERV_PORT</b> <u>&lt;port&gt;</u>
           Set the port number that the “dummy” TCP server listens on. This server is only spawned when
           “ENABLE_TCP_SERVER” is set to “Y”.

       <b>ENABLE_UDP_SERVER</b> <u>&lt;Y/N&gt;</u>
           Enable the <b>fwknopd</b> UDP server. This instructs <b>fwknopd</b> to acquire SPA packets via a UDP socket
           directly without having to use libpcap. When this mode is enabled, <b>fwknop</b> should be compiled with
           <b>--enable-udp-server</b> (passed to the <b>configure</b> script) so that libpcap can be removed as a dependency.
           As one would expect, when the UDP server is used, no incoming packets are ever acknowledged by
           <b>fwknopd</b> and therefore collecting SPA packets in this mode is a good alternative to sniffing the wire
           directly.

       <b>UDPSERV_PORT</b> <u>&lt;port&gt;</u>
           Set the port number that the UDP server listens on. This server is only spawned when
           “ENABLE_UDP_SERVER” is set to “Y”.

       <b>PCAP_DISPATCH_COUNT</b> <u>&lt;count&gt;</u>
           Sets the number of packets that are processed when the <b>pcap_dispatch()</b> call is made. The default is
           zero, since this allows <b>fwknopd</b> to process as many packets as possible in the corresponding callback
           where the SPA handling routine is called for packets that pass a set of prerequisite checks. However,
           if <b>fwknopd</b> is running on a platform with an old version of libpcap, it may be necessary to change
           this value to a positive non-zero integer. More information can be found in the <b><a href="../man3/pcap_dispatch.3.html">pcap_dispatch</a>(3)</b> man
           page.

       <b>PCAP_LOOP_SLEEP</b> <u>&lt;microseconds&gt;</u>
           Sets the number of microseconds to passed as an argument to usleep() in the pcap loop. The default is
           100000, or 1/10th of a second.

       <b>ENABLE_PCAP_ANY_DIRECTION</b> <u>&lt;Y/N&gt;</u>
           Controls whether fwknopd is permitted to sniff SPA packets regardless of whether they are received on
           the sniffing interface or sent from the sniffing interface. In the later case, this can be useful to
           have fwknopd sniff SPA packets that are forwarded through a system and destined for a different
           network. If the sniffing interface is the egress interface for such packets, then this variable will
           need to be set to "Y" in order for fwknopd to see them. The default is "N" so that fwknopd only looks
           for SPA packets that are received on the sniffing interface (note that this is independent of
           promiscuous mode).

       <b>SYSLOG_IDENTITY</b> <u>&lt;identity&gt;</u>
           Override syslog identity on message logged by <b>fwknopd</b>. The defaults are usually ok.

       <b>SYSLOG_FACILITY</b> <u>&lt;facility&gt;</u>
           Override syslog facility. The “SYSLOG_FACILITY” variable can be set to

       <b>ENABLE_DESTINATION_RULE</b> <u>&lt;Y/N&gt;</u>
           Controls whether <b>fwknopd</b> will set the destination field on the firewall rule to the destination
           address specified on the incoming SPA packet. This is useful for interfaces with multiple IP
           addresses hosting separate services. If “ENABLE_IPT_OUTPUT” is set to “Y”, the source field of the
           firewall rule is set. FORWARD and SNAT rules are not affected however, DNAT rules will also have
           their destination field set. The default is “N”, which sets the destination field to 0.0.0.0/0 (any).

       <b>FWKNOP_RUN_DIR</b> <u>&lt;path&gt;</u>
           Specify the directory where <b>fwknopd</b> writes run time state files. The default is <u>@runstatedir@</u>.

   <b>ACCESS.CONF</b> <b>VARIABLES</b>
       This section describes the access control directives in the <u>/etc/fwknop/access.conf</u> file. Theses
       directives define encryption and authentication keys, and the level of access that is granted to <b>fwknop</b>
       clients that have generated an appropriate encrypted and authenticated SPA packet.

       The <u>access.conf</u> variables described below provide the access directives for the SPA packets with a source
       (or embedded request) IP that matches an address or network range defined by the “SOURCE” variable. All
       variables following “SOURCE” apply to the source <u>stanza</u>. Each “SOURCE” directive starts a new stanza.

       <b>SOURCE</b> <u>&lt;IP,..,IP/NET,..,NET/ANY&gt;</u>
           This defines the source address from which the SPA packet will be accepted. The string “ANY” is also
           accepted if a valid SPA packet should be honored from any source IP. Every authorization stanza in
           <u>/etc/fwknop/access.conf</u> definition must start with the “SOURCE” keyword. Networks should be specified
           in CIDR notation (e.g. “192.168.10.0/24”), and individual IP addresses can be specified as well.
           Also, multiple IP’s and/or networks can be defined as a comma separated list (e.g.
           “192.168.10.0/24,10.1.1.123”)

       <b>DESTINATION</b> <u>&lt;IP,..,IP/NET,..,NET/ANY&gt;</u>
           This defines the destination address for which the SPA packet will be accepted. The string “ANY” is
           also accepted if a valid SPA packet should be honored to any destination IP. Networks should be
           specified in CIDR notation (e.g. “192.168.10.0/24”), and individual IP addresses can be specified as
           well. Also, multiple IP’s and/or networks can be defined as a comma separated list (e.g.
           “192.168.10.0/24,10.1.1.123”)

       <b>OPEN_PORTS</b> <u>&lt;proto/port&gt;,...,&lt;proto/port&gt;</u>
           Define a set of ports and protocols (tcp or udp) that will be opened if a valid knock sequence is
           seen. If this entry is not set, <b>fwknopd</b> will attempt to honor any proto/port request specified in the
           SPA data (unless of it matches any “RESTRICT_PORTS” entries). Multiple entries are comma-separated.

       <b>RESTRICT_PORTS</b> <u>&lt;proto/port&gt;,...,&lt;proto/port&gt;</u>
           Define a set of ports and protocols (tcp or udp) that are explicitly <b>not</b> allowed regardless of the
           validity of the incoming SPA packet. Multiple entries are comma-separated.

       <b>KEY</b> <u>&lt;passphrase&gt;</u>
           Define the symmetric key used for decrypting an incoming SPA packet that is encrypted by the <b>fwknop</b>
           client with Rijndael. The actual encryption key that is used is derived from the standard PBKDF1
           algorithm. This variable is required for all SPA packets unless GnuPG is used instead (see the GPG
           variables below).

       <b>KEY_BASE64</b> <u>&lt;base64</u> <u>encoded</u> <u>passphrase&gt;</u>
           Same as the <b>KEY</b> option above, but specify the symmetric key as a base64 encoded string. This allows
           non-ascii characters to be included in the base64-decoded key.

       <b>HMAC_KEY</b> <u>&lt;key&gt;</u>
           Specify the HMAC key for authenticated encryption of SPA packets. This supports both Rijndael and GPG
           encryption modes, and is applied according to the encrypt-then-authenticate model.

       <b>HMAC_KEY_BASE64</b> <u>&lt;base64</u> <u>encoded</u> <u>key&gt;</u>
           Specify the HMAC key as a base64 encoded string. This allows non-ascii characters to be included in
           the base64-decoded key.

       <b>FW_ACCESS_TIMEOUT</b> <u>&lt;seconds&gt;</u>
           Define the length of time access will be granted by <b>fwknopd</b> through the firewall after a valid knock
           sequence from a source IP address. If “FW_ACCESS_TIMEOUT” is not set then the default timeout of 30
           seconds will automatically be set.

       <b>%include</b> <u>&lt;file&gt;</u>
           Have <b>fwknopd</b> import an additional <u>access.conf</u> file. This allows more access stanzas to be defined in
           other locations in the filesystem, and this can be advantageous in some scenarios by letting
           non-privileged users define their own encryption and authentication keys for SPA operations. This
           way, users do not need write access to the main <u>/etc/fwknop/access.conf</u> file to change keys around or
           define new ones.

       <b>%include_folder</b> <u>&lt;directory&gt;</u>
           Similarly to the <u>%include</u> option above, the <u>%include_folder</u> directive has <b>fwknopd</b> import all .conf
           files from the specified directory. There is also command line support for this via the <u>access-folder</u>
           option.

       <b>ENCRYPTION_MODE</b> <u>&lt;mode&gt;</u>
           Specify the encryption mode when AES is used. The default is CBC mode, but other modes can be
           selected such as OFB and CFB. In general, it is recommended to not use this variable and leave it as
           the default. Note that the string “legacy” can be specified in order to generate SPA packets with the
           old initialization vector strategy used by versions of <b>fwknop</b> before 2.5. With the 2.5 release,
           <b>fwknop</b> uses PBKDF1 for key derivation.

       <b>HMAC_DIGEST_TYPE</b> <u>&lt;digest</u> <u>algorithm&gt;</u>
           Specify the digest algorithm for incoming SPA packet authentication. Must be one of <b>MD5</b>, <b>SHA1</b>,
           <b>SHA256</b>, <b>SHA384</b>, <b>SHA512</b>, <b>SHA3_256</b>, or <b>SHA3_512</b>. This is an optional field, and if not specified then
           <b>fwknopd</b> defaults to using SHA256 if the access stanza requires an HMAC.

       <b>ACCESS_EXPIRE</b> <u>&lt;MM/DD/YYYY&gt;</u>
           Defines an expiration date for the access stanza in MM/DD/YYYY format. All SPA packets that match an
           expired stanza will be ignored. This parameter is optional.

       <b>ACCESS_EXPIRE_EPOCH</b> <u>&lt;seconds&gt;</u>
           Defines an expiration date for the access stanza as the epoch time, and is useful if a more accurate
           expiration time needs to be given than the day resolution offered by the ACCESS_EXPIRE variable
           above. All SPA packets that match an expired stanza will be ignored. This parameter is optional.

       <b>ENABLE_CMD_EXEC</b> <u>&lt;Y/N&gt;</u>
           This instructs <b>fwknopd</b> to accept complete commands that are contained within an authorization packet.
           Any such command will be executed on the <b>fwknopd</b> server as the user specified by the “CMD_EXEC_USER”
           or as the user that started <b>fwknopd</b> if that is not set.

       <b>ENABLE_CMD_SUDO_EXEC</b> <u>&lt;Y/N&gt;</u>
           <b>sudo</b> provides a powerful means of restricting the sets of commands that users can execute via the
           “sudoers” file. By enabling this feature (and in “ENABLE_CMD_EXEC” mode), all incoming commands from
           valid SPA packets will be prefixed by “/path/to/sudo -u &lt;user&gt; -g &lt;group&gt;” where the path to sudo is
           set by the “SUDO_EXE” variable, “&lt;user&gt;” is set by the “CMD_SUDO_EXEC_USER” variable (default is
           “root” if not set), and “&lt;group&gt;” is set by “CMD_SUDO_EXEC_GROUP” (default is also “root” if not
           set).

       <b>CMD_EXEC_USER</b> <u>&lt;username&gt;</u>
           Specify the user (via setuid) that will execute a command contained within a SPA packet. If this
           variable is not given, fwknopd will execute the command as the user it is running as (most likely
           root). Setting this to a non-root user such as “nobody” is highly recommended if elevated permissions
           are not needed.

       <b>CMD_SUDO_EXEC_USER</b> <u>&lt;username&gt;</u>
           Specify the user (via “sudo -u &lt;user&gt;”) that will execute a command contained within a SPA packet. If
           this variable is not given, fwknopd will assume the command should be executed as root.

       <b>CMD_EXEC_GROUP</b> <u>&lt;groupname&gt;</u>
           Specify the group (via setgid) that will execute a command contained within a SPA packet. If this
           variable is not given, fwknopd will execute the command as the user it is running as (most likely
           root). Setting this to a non-root user such as “nobody” is highly recommended if elevated permissions
           are not needed.

       <b>CMD_SUDO_EXEC_GROUP</b> <u>&lt;groupname&gt;</u>
           Specify the group (via “sudo -g &lt;group&gt;”) that will execute a command contained within a SPA packet.
           If this variable is not given, fwknopd will assume the command should be executed as root.

       <b>CMD_CYCLE_OPEN</b> <u>&lt;command&gt;</u>
           Specify a command open/close cycle to be executed upon receipt of a valid SPA packet. This directive
           sets the initial command, and is meant to be used in conjunction with the “CMD_CYCLE_CLOSE” variable
           below. The main application of this feature is to allow <b>fwknopd</b> to interact with firewall or ACL’s
           that are not natively supported, and facilitate the same access model as for the main supported
           firewalls such as iptables. That is, a command is executed to open the firewall or ACL, and then a
           corresponding close command is executed after a timer expires. Both the “CMD_CYCLE_OPEN” and
           “CMD_CYCLE_CLOSE” variables support special substitution strings to allow values to be taken from the
           SPA payload and used on the command line of the executed command. These strings begin with a “$”
           character, and include “$IP” (the allow IP decrypted from the SPA payload), “$SRC” (synonym for
           “$IP”) , “$PKT_SRC” (the source IP in the network layer header of the SPA packet), “$DST” (the
           destination IP), “$PORT” (the allow port), and “$PROTO” (the allow protocol), “$TIMEOUT” (set the
           client timeout if specified).

       <b>CMD_CYCLE_CLOSE</b> <u>&lt;command&gt;</u>
           Specify the close command that corresponds to the open command set by the “CMD_CYCLE_OPEN” variable
           described above. The same string substitutions such as “$IP”, “$PORT”, and “$PROTO” are supported. In
           addition, the special value “NONE” can be set to allow no close command to be executed after the open
           command. This might be handy in certain situations where, say, indefinite access is desired and
           allowed.

       <b>CMD_CYCLE_TIMER</b> <u>&lt;seconds&gt;</u>
           Set the number of seconds after which the close command set in “CMD_CYCLE_CLOSE” will be executed.
           This defines the open/close timer interval.

       <b>SUDO_EXE</b> <u>&lt;path&gt;</u>
           Define the path to the sudo binary. Default is “<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?sudo">/usr/bin/sudo</a>”.

       <b>REQUIRE_USERNAME</b> <u>&lt;username&gt;</u>
           Require a specific username from the client system as encoded in the SPA data. This variable is
           optional and if not specified, the username data in the SPA data is ignored.

       <b>REQUIRE_SOURCE_ADDRESS</b> <u>&lt;Y/N&gt;</u>
           Force all SPA packets to contain a real IP address within the encrypted data. This makes it
           impossible to use the <b>-s</b> command line argument on the <b>fwknop</b> client command line, so either <b>-R</b> has to
           be used to automatically resolve the external address (if the client behind a NAT) or the client must
           know the external IP and set it via the <b>-a</b> argument.

       <b>REQUIRE_SOURCE_ADDRESS</b> <u>&lt;Y/N&gt;</u>
           Synonym for “REQUIRE_SOURCE_ADDRESS”.

       <b>FORCE_NAT</b> <u>&lt;IP&gt;</u> <u>&lt;PORT&gt;</u>
           For any valid SPA packet, force the requested connection to be NAT’d through to the specified
           (usually internal) IP and port value. This is useful if there are multiple internal systems running a
           service such as SSHD, and you want to give transparent access to only one internal system for each
           stanza in the access.conf file. This way, multiple external users can each directly access only one
           internal system per SPA key.

       <b>FORCE_SNAT</b> <u>&lt;IP&gt;</u>
           For any valid SPA packet, add an SNAT rule in addition to any DNAT rule created with a corresponding
           (required) FORCE_NAT variable. This is analogous to “SNAT_TRANSLATE_IP” from the
           <u>/etc/fwknop/fwknopd.conf</u> file except that it is per access stanza and overrides any value set with
           “SNAT_TRANSLATE_IP”. This is useful for situations where an incoming NAT’d connection may be
           otherwise unanswerable due to routing constraints (i.e. the system receiving the SPA authenticated
           connection has a default route to a different device than the SPA system itself).

       <b>FORCE_MASQUERADE</b> <u>&lt;Y/N&gt;</u>
           This is similar to the “FORCE_SNAT” variable, except that it is not necessary to also specify an IP
           address for SNAT rules because the MASQUERADE target is used instead.

       <b>FORWARD_ALL</b> <u>&lt;Y/N&gt;</u>
           In NAT scenarios, control whether all traffic is forwarded through the <b>fwknopd</b> system as opposed to
           just forwarding connections to specific services as requested by the <b>fwknop</b> client.

       <b>DISABLE_DNAT</b> <u>&lt;Y/N&gt;</u>
           Control whether DNAT rules are created in FORCE_NAT scenarios. This is mainly used in conjunction
           with the FORWARD_ALL variable to allow <b>fwknopd</b> to act essentially as an SPA gateway. I.e., the <b>fwknop</b>
           client is used to gain access via SPA to the broader Internet after being granted an IP via DHCP, but
           prior to sending the SPA packet all traffic is blocked by default to the Internet.

       <b>GPG_DECRYPT_ID</b> <u>&lt;keyID&gt;</u>
           Define a GnuPG key ID to use for decrypting SPA messages that have been encrypted by an <b>fwknop</b>
           client. This keyword is required for authentication that is based on GPG keys. The GPG key ring on
           the client must have imported and signed the <b>fwknopd</b> server key, and vice versa. It is ok to use a
           sensitive personal GPG key on the client, but each <b>fwknopd</b> server should have its own GPG key that is
           generated specifically for fwknop communications. The reason for this is that the decryption password
           for the server key must be placed within the <u>/etc/fwknop/access.conf</u> file for <b>fwknopd</b> to function (it
           has to be able to decrypt SPA messages that have been encrypted with the server’s public key). For
           more information on using fwknop with GnuPG keys, see the following link:
           “<a href="http://www.cipherdyne.org/fwknop/docs/gpghowto.html">http://www.cipherdyne.org/fwknop/docs/gpghowto.html</a>”.

       <b>GPG_DECRYPT_PW</b> <u>&lt;decrypt</u> <u>password&gt;</u>
           Specify the decryption password for the gpg key defined by the “GPG_DECRYPT_ID” above. This is a
           required field for gpg-based authentication.

       <b>GPG_ALLOW_NO_PW</b> <u>&lt;Y/N&gt;</u>
           Allow <b>fwknopd</b> to leverage a GnuPG key pair that does not have an associated password. While this may
           sound like a controversial deployment mode, in automated environments it makes sense because "there
           is usually no way to store a password more securely than on the secret keyring itself" according to:
           “<a href="http://www.gnupg.org/faq/GnuPG-FAQ.html">http://www.gnupg.org/faq/GnuPG-FAQ.html</a>#how-can-i-use-gnupg-in-an-automated-environment”. Using this
           feature and removing the passphrase from a GnuPG key pair is useful in some environments where
           libgpgme is forced to use gpg-agent and/or pinentry to collect a passphrase.

       <b>GPG_REQUIRE_SIG</b> <u>&lt;Y/N&gt;</u>
           With this setting set to <u>Y</u>, fwknopd check all GPG-encrypted SPA messages for a signature (signed by
           the sender’s key). If the incoming message is not signed, the decryption process will fail. If not
           set, the default is <u>Y</u>.

       <b>GPG_DISABLE_SIG</b> <u>&lt;Y/N&gt;</u>
           Disable signature verification for incoming SPA messages. This is not a recommended setting, and the
           default is <u>N</u>.

       <b>GPG_IGNORE_SIG_VERIFY_ERROR</b> <u>&lt;Y/N&gt;</u>
           Setting this will allow fwknopd to accept incoming GPG-encrypted packets that are signed, but the
           signature did not pass verification (i.e. the signer key was expired, etc.). This setting only
           applies if the GPG_REQUIRE_SIG is also set to <u>Y</u>.

       <b>GPG_REMOTE_ID</b> <u>&lt;keyID,...,keyID&gt;</u>
           Define a list of gpg key ID’s that are required to have signed any incoming SPA message that has been
           encrypted with the <b>fwknopd</b> server key. This ensures that the verification of the remote user is
           accomplished via a strong cryptographic mechanism. Signature verification is enabled by default, and
           can only be disabled if “GPG_DISABLE_SIG” is set to <u>Y</u> (not a recommended setting). Separate multiple
           entries with a comma.

       <b>GPG_FINGERPRINT_ID</b> <u>&lt;keyID,...,keyID&gt;</u>
           Specify a set of full-length GnuPG key fingerprints instead of the shorter key identifiers set with
           the “GPG_REMOTE_ID” variable. Here is an example fingerprint for one of the fwknop test suite keys:
           <u>00CC95F05BC146B6AC4038C9E36F443C6A3FAD56</u>.

       <b>GPG_HOME_DIR</b> <u>&lt;path&gt;</u>
           Define the path to the GnuPG directory to be used by the <b>fwknopd</b> server. If this keyword is not
           specified within <u>/etc/fwknop/access.conf</u> then <b>fwknopd</b> will default to using the <u>/root/.gnupg</u>
           directory for the server key(s) for incoming SPA packets handled by the matching <u>access.conf</u> stanza.

       <b>GPG_EXE</b> <u>&lt;path&gt;</u>
           Define the path to the GnuPG executable. If this keyword is not specified within
           <u>/etc/fwknop/access.conf</u> then <b>fwknopd</b> will default to using <u><a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?gpg">/usr/bin/gpg</a></u>.

</pre><h4><b>FILES</b></h4><pre>
       <b>/etc/fwknop/fwknopd.conf</b>
           The main configuration file for fwknop.

       <b>/etc/fwknop/access.conf</b>
           Defines all knock sequences and access control directives.

</pre><h4><b>DEPENDENCIES</b></h4><pre>
       <b>fwknopd</b> requires <u>libfko</u> which is normally included with both source and binary distributions, and is a
       dedicated library developed by the fwknop project.

       For packet sniffing, <b>fwknopd</b> currently requires libpcap, but future versions will (optionally) remove
       this as a dependency.

       For GPG functionality, GnuPG must also be correctly installed and configured along with the libgpgme
       library.

       To take advantage of all of the authentication and access management features of the <b>fwknopd</b>
       daemon/service a functioning iptables, ipfw, or pf firewall is required on the underlying operating
       system.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       <b>fwknopd</b> can be run in debug mode by combining the <b>-f,</b> <b>--foreground</b> and the <b>-v,</b> <b>--verbose</b> command line
       options. This will disable daemon mode execution, and print verbose information to the screen on stderr
       as packets are received.

       The most comprehensive way to gain diagnostic information on <b>fwknopd</b> is to run the test suite
       <u>test-fwknop.pl</u> script located in the <u>test/</u> directory in the fwknop sources. The test suite runs sends
       fwknop through a large number of run time tests, has <u>valgrind</u> support, validates both SPA encryption and
       HMAC results against OpenSSL, and even has its own built in fuzzer for SPA communications.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/fwknopd.8.html">fwknopd</a>(8), <a href="../man8/iptables.8.html">iptables</a>(8), <a href="../man4/pf.4.html">pf</a>(4), <a href="../man8/pfctl.8.html">pfctl</a>(8), <a href="../man8/ipfw.8.html">ipfw</a>(8), <a href="../man1/gpg.1.html">gpg</a>(1), libfko documentation.

       More information on Single Packet Authorization can be found in the paper “Single Packet Authorization
       with fwknop” available at <u><a href="http://www.cipherdyne.org/fwknop/docs/SPA.html">http://www.cipherdyne.org/fwknop/docs/SPA.html</a></u>. A comprehensive tutorial on
       <b>fwknop</b> operations and theory can be found at <u><a href="http://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html">http://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html</a></u>.
       This tutorial also includes information about the design of <b>fwknop</b> that may be worth reading for those
       interested in why fwknop is different from other SPA implementations.

       <b>fwknop</b> uses the <u>git</u> versioning system as its source code repository along with <u>Github</u> for tracking of
       issues and milestones:

               $ git clone https://github.com/mrash/fwknop.git fwknop.git

       Additional commentary on Single Packet Authorization can be found via Michael Rash’s Twitter feed:
       <a href="http://twitter.com/michaelrash">http://twitter.com/michaelrash</a>, @michaelrash

</pre><h4><b>AUTHORS</b></h4><pre>
       The primary developers of <b>fwknop</b> are Michael Rash (project creator) &lt;<a href="mailto:mbr@cipherdyne.org">mbr@cipherdyne.org</a>&gt;, Damien Stuart
       &lt;<a href="mailto:dstuart@dstuart.org">dstuart@dstuart.org</a>&gt;, and Jonathan Bennett &lt;<a href="mailto:jbennett@incomsystems.biz">jbennett@incomsystems.biz</a>&gt;.

</pre><h4><b>CONTRIBUTORS</b></h4><pre>
       This “C” version of fwknop was derived from the original Perl-based version on which many people who are
       active in the open source community have contributed. See the CREDITS file in the fwknop sources, or
       visit <u>https://github.com/mrash/fwknop/blob/master/CREDITS</u> to view the online list of contributors. A few
       contributors deserve to be singled out including: Franck Joncourt, Max Kastanas, Vlad Glagolev, Sean
       Greven, Hank Leininger, Fernando Arnaboldi, and Erik Gomez.

       The phrase “Single Packet Authorization” was coined by MadHat and Simple Nomad at the BlackHat Briefings
       of 2005.

</pre><h4><b>BUGS</b></h4><pre>
       Send bug reports to <a href="mailto:dstuart@dstuart.org">dstuart@dstuart.org</a> or <a href="mailto:mbr@cipherdyne.org">mbr@cipherdyne.org</a>, or open a new issue on Github (see
       <u>https://github.com/mrash/fwknop.git</u>). Suggestions and/or comments are always welcome as well. Additional
       information may be found in the <b>fwknop</b> mailing list archives (see:
       <u>https://lists.sourceforge.net/lists/listinfo/fwknop-discuss</u>).

</pre><h4><b>DISTRIBUTION</b></h4><pre>
       <b>fwknopd</b> is distributed under the GNU General Public License (GPL v2+), and the latest version may be
       downloaded from <u><a href="http://www.cipherdyne.org">http://www.cipherdyne.org</a></u>.

Fwknop Server                                      08/06/2018                                         <u><a href="../man8/FWKNOPD.8.html">FWKNOPD</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>