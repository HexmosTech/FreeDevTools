<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fwknop - Firewall Knock Operator</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/fwknop-client">fwknop-client_2.6.11-2build1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       fwknop - Firewall Knock Operator

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>fwknop</b> <b>-A</b> &lt;'proto/ports'&gt; <b>-R</b>|<b>-a</b>|<b>-s</b> <b>-D</b> &lt;'host'&gt; [<u>options</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>fwknop</b> implements an authorization scheme known as Single Packet Authorization (SPA) for strong service
       concealment. SPA requires only a single packet which is encrypted, non-replayable, and authenticated via
       an HMAC in order to communicate desired access to a service that is hidden behind a firewall in a
       default-drop filtering stance. The main application of SPA is to use a firewall to drop all attempts to
       connect to services such as <u>SSH</u> in order to make the exploitation of vulnerabilities (both 0-day and
       unpatched code) more difficult. Any service that is concealed by SPA naturally cannot be scanned for with
       <u>Nmap</u>. The fwknop project natively supports four different firewalls: <u>iptables</u>, <u>firewalld</u>, <u>PF</u>, and <u>ipfw</u>
       across Linux, OpenBSD, FreeBSD, and Mac OS X. There is also support for custom scripts so that fwknop can
       be made to support other infrastructure such as <u>ipset</u> or <u>nftables</u>.

       SPA is essentially next generation Port Knocking (PK), but solves many of the limitations exhibited by PK
       while retaining its core benefits. PK limitations include a general difficulty in protecting against
       replay attacks, asymmetric ciphers and HMAC schemes are not usually possible to reliably support, and it
       is trivially easy to mount a DoS attack against a PK server just by spoofing an additional packet into a
       PK sequence as it traverses the network (thereby convincing the PK server that the client doesn’t know
       the proper sequence). All of these limitation are solved by SPA. At the same time, SPA hides services
       behind a default-drop firewall policy, acquires SPA data passively (usually via libpcap or other means),
       and implements standard cryptographic operations for SPA packet authentication and encryption/decryption.

       This is the manual page for the <b>fwknop</b> client which is responsible for constructing SPA packets and
       sending them over the network. The server side is implemented by the <b>fwknopd</b> daemon which sniffs the
       network for SPA packets and interacts with the local firewall to allow SPA authenticated connections. It
       is recommended to read the <u><a href="../man8/fwknopd.8.html">fwknopd</a>(8)</u> manual page as well. Further detailed information may be found in
       the tutorial “Single Packet Authorization: A Comprehensive Guide to Strong Service Concealment with
       fwknop” available online (see: <u><a href="http://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html">http://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html</a></u>).

       SPA packets generated by <b>fwknop</b> leverage HMAC for authenticated encryption in the
       encrypt-then-authenticate model. Although the usage of an HMAC is currently optional (enabled via the
       <b>--use-hmac</b> command line switch), it is highly recommended for three reasons: <u>1)</u> without an HMAC,
       cryptographically strong authentication is not possible with <b>fwknop</b> unless GnuPG is used, but even then
       an HMAC should still be applied, <u>2)</u> an HMAC applied after encryption protects against cryptanalytic
       CBC-mode padding oracle attacks such as the Vaudenay attack and related trickery (like the more recent
       "Lucky 13" attack against SSL), and <u>3)</u> the code required by the <b>fwknopd</b> daemon to verify an HMAC is much
       more simplistic than the code required to decrypt an SPA packet, so an SPA packet without a proper HMAC
       isn’t even sent through the decryption routines. Reason <u>3)</u> is why an HMAC should still be used even when
       SPA packets are encrypted with GnuPG due to the fact that SPA data is not sent through <b>libgpgme</b> functions
       unless the HMAC checks out first. GnuPG and libgpgme are relatively complex bodies of code, and therefore
       limiting the ability of a potential attacker to interact with this code through an HMAC operation helps
       to maintain a stronger security stance. Generating an HMAC for SPA communications requires a dedicated
       key in addition to the normal encryption key, and both can be generated with the <b>--key-gen</b> option.

       <b>fwknop</b> encrypts SPA packets either with the <u>Rijndael</u> block cipher or via <u>GnuPG</u> and associated asymmetric
       cipher. If the symmetric encryption method is chosen, then as usual the encryption key is shared between
       the client and server (see the <b>fwknopd</b> <u>/etc/fwknop/access.conf</u> file for details). The actual encryption
       key used for Rijndael encryption is generated via the standard PBKDF1 key derivation algorithm, and CBC
       mode is set. If the GnuPG method is chosen, then the encryption keys are derived from GnuPG key rings.
       SPA packets generated by fwknop running as a client adhere to the following format (before encryption and
       the HMAC is applied):

               random data (16 digits)
               username
               timestamp
               software version
               mode (command mode (0) or access mode (1))
               if command mode =&gt; command to execute
               else access mode  =&gt; IP,proto,port
               message digest (SHA512 / SHA384 / SHA256 / SHA1 / MD5 / SHA3_256 / SHA3_512)

       Each of the above fields are separated by a ":" character due to the variable length of several of the
       fields, and those that might contain ":" characters are base64 encoded. The message digest (<b>SHA256</b> by
       default) is part of the data to be encrypted and is independent of the HMAC which is appended to the SPA
       packet data after encryption. The 16 digits of random data (about 53 bits) ensures that no two SPA
       packets are identical, and this is in addition to and independent of using PBKDF1 for key derivation for
       Rijndael in CBC mode (which uses an 8-byte random "salt" value). Because <b>fwknopd</b> tracks the SHA256 digest
       of all incoming valid SPA packets and throws out duplicates, replay attacks are not feasible against
       <b>fwknop</b>. Syslog alerts are generated if a replay is detected.

       By default, the <b>fwknop</b> client sends authorization packets over UDP port 62201, but this can be altered
       with the <b>--server-port</b> argument (this requires <b>fwknopd</b> to be configured to acquire SPA data over the
       selected port). Also, <b>fwknop</b> can send the SPA packet over a random port via the <b>--rand-port</b> argument. See
       <u><a href="../man8/fwknopd.8.html">fwknopd</a>(8)</u> for further details. See the <b>EXAMPLES</b> section for example invocations of the <b>fwknop</b> client.

       The <b>fwknop</b> client is quite portable, and is known to run on various Linux distributions (all major
       distros and embedded ones such as OpenWRT as well), FreeBSD, OpenBSD, Mac OS X, and Cygwin on Windows.
       There is also a library <b>libfko</b> that both <b>fwknop</b> and <b>fwknopd</b> use for SPA packet encryption/decryption and
       HMAC authentication operations. This library can be used to allow third party applications to use SPA
       subject to the terms of the GNU General Public License (GPL v2+).

</pre><h4><b>REQUIRED</b> <b>ARGUMENTS</b></h4><pre>
       These required arguments can be specified via command-line or from within the <u><a href="file:~/.fwknoprc">~/.fwknoprc</a></u> file (see <u>-n,</u>
       <u>--named-config</u> option and the FWKNOPRC FILE section below).

       <b>-A,</b> <b>--access</b>=<u>&lt;port</u> <u>list&gt;</u>
           Provide a list of ports and protocols to access on a remote computer running <b>fwknopd</b>. The format of
           this list is “+&lt;proto&gt;/&lt;port&gt;...&lt;proto&gt;/&lt;port&gt;+”, e.g. “tcp/22,udp/53”.  <b>NOTE:</b> The vast majority of
           usages for <b>fwknop</b> require the <b>-A</b> argument, but sending full commands with the <b>--server-cmd</b> argument
           via an SPA packet to be executed by <b>fwknopd</b> does not require this argument.

       <b>-D,</b> <b>--destination</b>=<u>&lt;hostname/IP-address&gt;</u>
           Direct the <b>fwknop</b> client to authenticate with the <b>fwknopd</b> daemon/service at the specified destination
           hostname or IP address. The connection mode is discovered by the <b>fwknopd</b> daemon/service when it
           decrypts and parses the authentication packet.

       <b>-R|-a|-s</b>
           One of these options (see below) is required to tell the remote <b>fwknopd</b> daemon what IP should be
           allowed through the firewall. It is recommend to use the <b>-R</b> or <b>-a</b> options instead of <b>-s</b> in order to
           harden SPA communications against possible <u>Man-In-The-Middle</u> (MITM) attacks, and on the server side
           set <u>REQUIRE_SOURCE_ADDRESS</u> variable in the <u>/etc/fwknop/access.conf</u> file. Note that the most secure
           option is <b>-a</b> so that <b>fwknop</b> does not have to issue any HTTPS request to
           <u>https://www.cipherdyne.org/cgi-bin/myip</u> in order to resolve the externally routable IP address. Using
           <b>-a</b> requires that the user already knows what the external IP is for the network where fwknop is
           running.

</pre><h4><b>GENERAL</b> <b>OPTIONS</b></h4><pre>
       <b>-h,</b> <b>--help</b>
           Print a usage summary message and exit.

       <b>-G,</b> <b>--get-key</b>=<u>&lt;file&gt;</u>
           Load an encryption key/password from the specified file. The key file contains a line for each
           destination hostname or IP address, a colon (":"), optional space and the password, followed by a
           newline. Note that the last line has to have a terminating newline character. Also note: though this
           is a convenience, having a file on your system with clear text passwords is not a good idea and is
           not recommended. Having the <b>fwknop</b> client prompt you for the key is generally more secure. Note also
           that if a key is stored on disk, the <b>fwknop</b> rc file is a more powerful mechanism for specifying not
           only the key but other options as well.

       <b>--stdin</b>
           Read the encryption key/password from stdin. This can be used to send the data via a pipe for
           example. This command is similar to --fd 0.

       <b>--fd</b>=<u>&lt;number&gt;</u>
           Specify the file descriptor number to read the key/password from. This command avoids the user being
           prompted for a password if none has been found in the user specific stanza, or none has been supplied
           on the command line. A file descriptor set to 0 is similar to the stdin command.

       <b>--get-hmac-key</b>=<u>&lt;file&gt;</u>
           Load an HMAC key/password from the specified file. Similarly to the format for the <b>--get-key</b> option,
           the HMAC key file contains a line for each destination hostname or IP address, a colon (":"),
           optional space and the password, followed by a newline. Note that the last line has to have a
           terminating newline character. Also note: though this is a convenience, having a file on your system
           with clear text passwords is not a good idea and is not recommended. Having the <b>fwknop</b> client prompt
           you for the HMAC key is generally more secure. Note also that if a key is stored on disk, the <b>fwknop</b>
           rc file is a more powerful mechanism for specifying not only the HMAC key but other options as well.

       <b>--key-gen</b>
           Have <b>fwknop</b> generate both Rijndael and HMAC keys that can be used for SPA packet encryption and
           authentication. These keys are derived from /dev/urandom and then base64 encoded before being printed
           to stdout, and are meant to be included within the “$HOME/.fwknoprc” file (or the file referenced by
           <b>--get-key</b>). Such keys are generally more secure than passphrases that are typed in from the command
           line.

       <b>--key-gen-file</b>=<u>&lt;file&gt;</u>
           Write generated keys to the specified file. Note that the file is overwritten if it already exists.
           If this option is not given, then <b>--key-gen</b> writes the keys to stdout.

       <b>--key-len</b>=<u>&lt;length&gt;</u>
           Specify the number of bytes for a generated Rijndael key. The maximum size is currently 128 bytes.

       <b>--hmac-key-len</b>=<u>&lt;length&gt;</u>
           Specify the number of bytes for a generated HMAC key. The maximum size is currently 128 bytes.

       <b>-l,</b> <b>--last-cmd</b>
           Execute <b>fwknop</b> with the command-line arguments from the previous invocation (if any). The previous
           arguments are parsed out of the <u><a href="file:~/.fwknop.run">~/.fwknop.run</a></u> file.

       <b>-n,</b> <b>--named-config</b>=<u>&lt;stanza</u> <u>name&gt;</u>
           Specify the name of the configuration stanza in the “$HOME/.fwknoprc” file to pull configuration and
           command directives. These named stanzas alleviate the need for remembering the various command-line
           arguments for frequently used invocations of <b>fwknop</b>. See the section labeled, FWKNOPRC FILE below for
           a list of the valid configuration directives in the <u>.fwknoprc</u> file.

       <b>--key-rijndael</b>=<u>&lt;key&gt;</u>
           Specify the Rijndael key on the command line. Since the key may be visible to utilities such as <u>ps</u>
           under Unix, this form should only be used where security is not critical. Having the <b>fwknop</b> client
           either prompt you for the key or acquire via the “$HOME/.fwknoprc” file is generally more secure.

       <b>--key-base64-rijndael</b>=<u>&lt;key&gt;</u>
           Specify the base64 encoded Rijndael key. Since the key may be visible to utilities such as <u>ps</u> under
           Unix, this form should only be used where security is not critical. Having the <b>fwknop</b> client either
           prompt you for the key or acquire via the “$HOME/.fwknoprc” file is generally more secure.

       <b>--key-base64-hmac</b>=<u>&lt;key&gt;</u>
           Specify the base64 encoded HMAC key. Since the key may be visible to utilities such as <u>ps</u> under Unix,
           this form should only be used where security is not critical. Having the <b>fwknop</b> client either prompt
           you for the key or acquire via the “$HOME/.fwknoprc” file is generally more secure.

       <b>--key-hmac</b>=<u>&lt;key&gt;</u>
           Specify the raw HMAC key (not base64 encoded). Since the key may be visible to utilities such as <u>ps</u>
           under Unix, this form should only be used where security is not critical. Having the <b>fwknop</b> client
           either prompt you for the key or acquire via the “$HOME/.fwknoprc” file is generally more secure.

       <b>--rc-file</b>=<u>&lt;file&gt;</u>
           Specify path to the <b>fwknop</b> rc file (default is “$HOME/.fwknoprc”).

       <b>--no-rc-file</b>
           Perform <b>fwknop</b> client operations without referencing the “$HOME/.fwknoprc” file.

       <b>--no-home-dir</b>
           Do not allow the <b>fwknop</b> client to look for the home directory associated with the user.

       <b>--save-rc-stanza</b>=<u>&lt;stanza</u> <u>name&gt;</u>
           Save command line arguments to the “$HOME/.fwknoprc” stanza specified with the <b>-n</b> option. If the <b>-n</b>
           option is omitted, then the stanza name will default to the destination server value (hostname or IP)
           given with the <b>-D</b> argument.

       <b>--force-stanza</b>
           Used with <b>--save-rc-stanza</b> to overwrite all of the variables for the specified stanza

       <b>--stanza-list</b>
           Dump a list of the stanzas found in “$HOME/.fwknoprc”.

       <b>--show-last</b>
           Display the last command-line arguments used by <b>fwknop</b>.

       <b>-E,</b> <b>--save-args-file</b>=<u>&lt;file&gt;</u>
           Save command line arguments to a specified file path. Without this option, and when <b>--no-save-args</b> is
           not also specified, then the default save args path is <u><a href="file:~/.fwknop.run">~/.fwknop.run</a></u>.

       <b>--no-save-args</b>
           Do not save the command line arguments given when <b>fwknop</b> is executed.

       <b>-T,</b> <b>--test</b>
           Test mode. Generate the SPA packet data, but do not send it. Instead, print a break-down of the SPA
           data fields, then run the data through the decryption and decoding process and print the break-down
           again. This is primarily a debugging feature.

       <b>-B,</b> <b>--save-packet</b>=<u>&lt;file&gt;</u>
           Instruct the <b>fwknop</b> client to write a newly created SPA packet out to the specified file so that it
           can be examined off-line.

       <b>-b,</b> <b>--save-packet-append</b>
           Append the generated packet data to the file specified with the <b>-B</b> option.

       <b>--fault-injection-tag</b>=<u>&lt;tag&gt;</u>
           This option is only used for fault injection testing when <b>fwknop</b> is compiled to support the libfiu
           library (see: <u><a href="http://blitiri.com.ar/p/libfiu/">http://blitiri.com.ar/p/libfiu/</a></u>). Under normal circumstances this option is not used,
           and any packaged version of fwknop will not have code compiled in so this capability is not enabled
           at run time. It is documented here for completeness.

       <b>-v,</b> <b>--verbose</b>
           Run the <b>fwknop</b> client in verbose mode. This causes <b>fwknop</b> to print some extra information about the
           current command and the resulting SPA data.

       <b>-V,</b> <b>--version</b>
           Display version information and exit.

</pre><h4><b>SPA</b> <b>OPTIONS</b></h4><pre>
       <b>--use-hmac</b>
           Set HMAC mode for authenticated encryption of SPA communications. As of <b>fwknop</b> 2.5, this is an
           optional feature, but this will become the default in a future release.

       <b>-a,</b> <b>--allow-ip</b>=<u>&lt;IP-address&gt;</u>
           Specify IP address that should be permitted through the destination <b>fwknopd</b> server firewall (this IP
           is encrypted within the SPA packet itself). This is useful to prevent a MITM attack where a SPA
           packet can be intercepted en-route and sent from a different IP than the original. Hence, if the
           <b>fwknopd</b> server trusts the source address on the SPA packet IP header then the attacker gains access.
           The <b>-a</b> option puts the source address within the encrypted SPA packet, and so thwarts this attack.
           The <b>-a</b> option is also useful to specify the IP that will be granted access when the SPA packet itself
           is spoofed with the <b>--spoof-src</b> option. Another related option is <b>-R</b> (see below) which instructs the
           <b>fwknop</b> client to automatically resolve the externally routable IP address the local system is
           connected to by querying <u>https://www.cipherdyne.org/cgi-bin/myip</u>. This returns the actual IP address
           it sees from the calling system.

       <b>-g,</b> <b>--gpg-encryption</b>
           Use GPG encryption on the SPA packet (default if not specified is Rijndael).  <b>Note:</b> Use of this
           option will also require a GPG recipient (see <b>--gpg-recipient</b> along with other GPG-related options
           below).

       <b>--hmac-digest-type</b>=<u>&lt;digest&gt;</u>
           Set the HMAC digest algorithm for authenticated encryption of SPA packets. Choices are: <b>MD5</b>, <b>SHA1</b>,
           <b>SHA256</b> (the default), <b>SHA384</b>, <b>SHA512</b>, <b>SHA3_256</b>, and <b>SHA3_512</b>.

       <b>-N,</b> <b>--nat-access</b>=<u>&lt;internalIP:forwardPort&gt;</u>
           The <b>fwknopd</b> server offers the ability to provide SPA access through an iptables firewall to an
           internal service by interfacing with the iptables NAT capabilities. So, if the <b>fwknopd</b> server is
           protecting an internal network on an RFC-1918 address space, an external <b>fwknop</b> client can request
           that the server port forward an external port to an internal IP, i.e. “+--NAT-access
           192.168.10.2,55000+”. In this case, access will be granted to 192.168.10.2 via port 55000 to whatever
           service is requested via the <b>--access</b> argument (usually tcp/22). Hence, after sending such an SPA
           packet, one would then do “ssh -p 55000 user@host” and the connection would be forwarded on through
           to the internal 192.168.10.2 system automatically. Note that the port “55000” can be randomly
           generated via the <b>--nat-rand-port</b> argument (described later).

       <b>--nat-local</b>
           On the <b>fwknopd</b> server, a NAT operation can apply to the local system instead of being forwarded
           through the system. That is, for iptables firewalls, a connection to, say, port 55,000 can be
           translated to port 22 on the local system. By making use of the <b>--nat-local</b> argument, the <b>fwknop</b>
           client can be made to request such access. This means that any external attacker would only see a
           connection over port 55,000 instead of the expected port 22 after the SPA packet is sent.

       <b>--nat-port</b>
           Usually <b>fwknop</b> is used to request access to a specific port such as tcp/22 on a system running
           <b>fwknopd</b>. However, by using the <b>--nat-port</b> argument, it is possible to request access to a (again,
           such as tcp/22), but have this access granted via the specified port (so, the <b>-p</b> argument would then
           be used on the <u>SSH</u> client command line). See the <b>--nat-local</b> and <b>--nat-access</b> command line arguments
           to <b>fwknop</b> for additional details on gaining access to services via a NAT operation.

       <b>--nat-rand-port</b>
           Usually <b>fwknop</b> is used to request access to a specific port such as tcp/22 on a system running
           <b>fwknopd</b>. However, by using the <b>--nat-rand-port</b> argument, it is possible to request access to a
           particular service (again, such as tcp/22), but have this access granted via a random translated
           port. That is, once the <b>fwknop</b> client has been executed in this mode and the random port selected by
           <b>fwknop</b> is displayed, the destination port used by the follow-on client must be changed to match this
           random port. For <u>SSH</u>, this is accomplished via the <b>-p</b> argument. See the <b>--nat-local</b> and <b>--nat-access</b>
           command line arguments to <b>fwknop</b> for additional details on gaining access to services via a NAT
           operation.

       <b>-p,</b> <b>--server-port</b>=<u>&lt;port&gt;</u>
           Specify the port number where <b>fwknopd</b> accepts packets via libpcap or ulogd pcap writer. By default
           <b>fwknopd</b> looks for authorization packets over UDP port 62201.

       <b>-P,</b> <b>--server-proto</b>=<u>&lt;protocol&gt;</u>
           Set the protocol (udp, tcp, http, udpraw, tcpraw, or icmp) for the outgoing SPA packet. Note: The
           <b>udpraw</b>, <b>tcpraw</b>, and <b>icmp</b> modes use raw sockets and thus require root access to run. Also note: The
           <b>tcp</b> mode expects to establish a TCP connection to the server before sending the SPA packet. This is
           not normally done, but is useful for compatibility with the Tor for strong anonymity; see
           <u><a href="http://tor.eff.org/">http://tor.eff.org/</a></u>. In this case, the <b>fwknopd</b> server will need to be configured to listen on the
           target TCP port (which is 62201 by default).

       <b>-Q,</b> <b>--spoof-src</b>=<u>&lt;IP&gt;</u>
           Spoof the source address from which the <b>fwknop</b> client sends SPA packets. This requires root on the
           client side access since a raw socket is required to accomplish this. Note that the <b>--spoof-user</b>
           argument can be given in this mode in order to pass any <b>REQUIRE_USERNAME</b> keyword that might be
           specified in <u>/etc/fwknop/access.conf</u>.

       <b>-r,</b> <b>--rand-port</b>
           Instruct the <b>fwknop</b> client to send an SPA packet over a random destination port between 10,000 and
           65535. The <b>fwknopd</b> server must use a <b>PCAP_FILTER</b> variable that is configured to accept such packets.
           For example, the <b>PCAP_FILTER</b> variable could be set to: “+udp dst portrange 10000-65535+”.

       <b>-R,</b> <b>--resolve-ip-https</b>
           This is an important option, and instructs the <b>fwknop</b> client to issue an HTTPS request to a script
           running on <u>cipherdyne.org</u> that returns the client’s IP address (as seen by the web server). In some
           cases, this is needed to determine the IP address that should be allowed through the firewall policy
           at the remote <b>fwknopd</b> server side. This option is useful if the <b>fwknop</b> client is being used on a
           system that is behind an obscure NAT address, and the external Internet facing IP is not known to the
           user. The full resolution URL is: <u>https://www.cipherdyne.org/cgi-bin/myip</u>, and is accessed by <b>fwknop</b>
           via <u>wget</u> in <b>--secure-protocol</b> mode. Note that it is generally more secure to use the <b>-a</b> option if the
           externally routable IP address for the client is already known to the user since this eliminates the
           need for <b>fwknop</b> to issue any sort of HTTPS request.

       <b>--resolve-url</b> <u>&lt;url&gt;</u>
           Override the default URL used for resolving the source IP address. For best results, the URL
           specified here should point to a web service that provides just an IP address in the body of the HTTP
           response.

       <b>--resolve-http-only</b>
           This option forces the <b>fwknop</b> client to resolve the external IP via HTTP instead of HTTPS. There are
           some circumstances where this might be necessary such as when <u>wget</u> is not available (or hasn’t been
           compiled with SSL support), but generally this is not recommended since it opens the possibility of a
           MITM attack through manipulation of the IP resolution HTTP response. Either specify the IP manually
           with <b>-a</b>, or use <b>-R</b> and omit this option.

       <b>-w,</b> <b>--wget-cmd</b>=<u>&lt;wget</u> <u>full</u> <u>path&gt;</u>
           Manually set the full path to the <u>wget</u> command. Normally the <u>configure</u> script finds the <u>wget</u> command,
           but this option can be used to specify the path if it is located in a non-standard place.

       <b>-s,</b> <b>--source-ip</b>
           Instruct the <b>fwknop</b> client to form an SPA packet that contains the special-case IP address
           “+0.0.0.0+” which will inform the destination <b>fwknopd</b> SPA server to use the source IP address from
           which the SPA packet originates as the IP that will be allowed through upon modification of the
           firewall ruleset. This option is useful if the <b>fwknop</b> client is deployed on a machine that is behind
           a NAT device and the external IP is not known. However, usage of this option is not recommended, and
           either the <b>-a</b> or <b>-R</b> options should be used instead. The permit-address options <b>-s</b>, <b>-R</b> and <b>-a</b> are
           mutually exclusive.

       <b>-S,</b> <b>--source-port</b>=<u>&lt;port&gt;</u>
           Set the source port for outgoing SPA packet.

       <b>--server-resolve-ipv4</b>
           This option forces the <b>fwknop</b> client to only accept an IPv4 address from DNS when a hostname is used
           for the SPA server. This is necessary in some cases where DNS may return both IPv6 and IPv4
           addresses.

       <b>-f,</b> <b>--fw-timeout</b>=<u>&lt;seconds&gt;</u>
           Specify the length of time (seconds) that the remote firewall rule that grants access to a service is
           to remain active. The default maintained by <b>fwknopd</b> is 30 seconds, but any established connection can
           be kept open after the initial accept rule is deleted through the use of a connection tracking
           mechanism that may be offered by the firewall.

       <b>-C,</b> <b>--server-cmd</b>=<u>&lt;command</u> <u>to</u> <u>execute&gt;</u>
           Instead of requesting access to a service with an SPA packet, the <b>--server-cmd</b> argument specifies a
           command that will be executed by the <b>fwknopd</b> server. The command is encrypted within the SPA packet
           and sniffed off the wire (as usual) by the <b>fwknopd</b> server.

       <b>-H,</b> <b>--http-proxy</b>=<u>&lt;proxy-host&gt;[:port]</u>
           Specify an HTTP proxy that the <b>fwknop</b> client will use to send the SPA packet through. Using this
           option will automatically set the SPA packet transmission mode (usually set via the <b>--server-proto</b>
           argument) to "http". You can also specify the proxy port by adding ":&lt;port&gt;" to the proxy host name
           or ip.

       <b>-m,</b> <b>--digest-type</b>=<u>&lt;digest&gt;</u>
           Specify the message digest algorithm to use in the SPA data. Choices are: <b>MD5</b>, <b>SHA1</b>, <b>SHA256</b> (the
           default), <b>SHA384</b>, and <b>SHA512</b>, <b>SHA3_256</b>, and <b>SHA3_512</b>.

       <b>-M,</b> <b>--encryption-mode</b>=<u>&lt;mode&gt;</u>
           Specify the encryption mode when AES is used for encrypting SPA packets. The default is CBC mode, but
           others can be chosen such as CFB or OFB as long as this is also specified in the
           <u>/etc/fwknop/access.conf</u> file on the server side via the ENCRYPTION_MODE variable. In general, it is
           recommended to not include this argument and let the default (CBC) apply. Note that the string
           “legacy” can be specified in order to generate SPA packets with the old initialization vector
           strategy used by versions of <b>fwknop</b> prior to 2.5. With the 2.5 release, <b>fwknop</b> generates
           initialization vectors in a manner that is compatible with OpenSSL via the PBKDF1 algorithm.

       <b>--time-offset-plus</b>=<u>&lt;time&gt;</u>
           By default, the <b>fwknopd</b> daemon on the server side enforces time synchronization between the clocks
           running on client and server systems. The <b>fwknop</b> client places the local time within each SPA packet
           as a time stamp to be validated by the fwknopd server after decryption. However, in some
           circumstances, if the clocks are out of sync and the user on the client system does not have the
           required access to change the local clock setting, it can be difficult to construct and SPA packet
           with a time stamp the server will accept. In this situation, the <b>--time-offset-plus</b> option can allow
           the user to specify an offset (e.g. “60sec” “60min” “2days” etc.) that is added to the local time.

       <b>--time-offset-minus</b>=<u>&lt;time&gt;</u>
           This is similar to the <b>--time-offset-plus</b> option (see above), but subtracts the specified time offset
           instead of adding it to the local time stamp.

       <b>-u,</b> <b>--user-agent</b>=<u>&lt;user-agent-string&gt;</u>
           Set the HTTP User-Agent for resolving the external IP via <b>-R</b>, or for sending SPA packets over HTTP.

       <b>--use-wget-user-agent</b>
           By default when the <b>fwknop</b> client resolves the external IP with <b>wget</b> via SSL, it sets the User-Agent
           to “Fwknop/&lt;version&gt;” unless it was already manually specified with the <b>--user-agent</b> option mentioned
           above. However, the <b>--user-wget-user-agent</b> option lets the default <b>wget</b> User-Agent string apply
           without influence from <b>fwknop</b>.

       <b>-U,</b> <b>--spoof-user</b>=<u>&lt;user&gt;</u>
           Specify the username that is included within SPA packet. This allows the <b>fwknop</b> client to satisfy any
           non-root <b>REQUIRE_USERNAME</b> keyword on the fwknopd server (<b>--spoof-src</b> mode requires that the <b>fwknop</b>
           client is executed as root).

       <b>--icmp-type</b>=<u>&lt;type&gt;</u>
           In <b>-P</b> <b>icmp</b> mode, specify the ICMP type value that will be set in the SPA packet ICMP header. The
           default is echo reply.

       <b>--icmp-code</b>=<u>&lt;code&gt;</u>
           In <b>-P</b> <b>icmp</b> mode, specify the ICMP code value that will be set in the SPA packet ICMP header. The
           default is zero.

</pre><h4><b>GPG</b> <b>OPTIONS</b></h4><pre>
       Note that the usage of GPG for SPA encryption/decryption can and should involve GPG keys that are signed
       by each side (client and server). The basic procedure for this involves the following steps after the
       client key has been transferred to the server and vice-versa:

               [spaserver]# gpg --import client.asc
               [spaserver]# gpg --edit-key 1234ABCD
               Command&gt; sign

               [spaclient]$ gpg --import server.asc
               [spaclient]$ gpg --edit-key ABCD1234
               Command&gt; sign

       More comprehensive information on this can be found here:
       <u><a href="http://www.cipherdyne.org/fwknop/docs/gpghowto.html">http://www.cipherdyne.org/fwknop/docs/gpghowto.html</a></u>.

       <b>--gpg-agent</b>
           Instruct <b>fwknop</b> to acquire GnuPG key password from a running gpg-agent instance (if available).

       <b>--gpg-home-dir</b>=<u>&lt;dir&gt;</u>
           Specify the path to the GnuPG directory; normally this path is derived from the home directory of the
           user that is running the <b>fwknop</b> client (so the default is <u><a href="file:~/.gnupg">~/.gnupg</a></u>). This is useful when a “root”
           user wishes to log into a remote machine whose sshd daemon/service does not permit root login.

       <b>--gpg-recipient</b>=<u>&lt;key</u> <u>ID</u> <u>or</u> <u>Name&gt;</u>
           Specify the GnuPG key ID, e.g. “+1234ABCD+” (see the output of "gpg—list-keys") or the key name
           (associated email address) of the recipient of the Single Packet Authorization message. This key is
           imported by the <b>fwknopd</b> server and the associated private key is used to decrypt the SPA packet. The
           recipient’s key must first be imported into the client GnuPG key ring.

       <b>--gpg-signer-key</b>=<u>&lt;key</u> <u>ID</u> <u>or</u> <u>Name&gt;</u>
           Specify the GnuPG key ID, e.g. “+ABCD1234+” (see the output of "gpg --list-keys") or the key name to
           use when signing the SPA message. The user is prompted for the associated GnuPG password to create
           the signature. This adds a cryptographically strong mechanism to allow the <b>fwknopd</b> daemon on the
           remote server to authenticate who created the SPA message.

       <b>--gpg-no-signing-pw</b>
           Instruct <b>fwknop</b> to not acquire a passphrase for usage of GnuPG signing key. This option is provided
           to make SPA packet construction easier for client-side operations in automated environments where the
           passphrase for the signing key has been removed from the GnuPG key ring. However, it is usually
           better to leverage <u>gpg-agent</u> instead of using this option.

</pre><h4><b>FWKNOPRC</b> <b>FILE</b></h4><pre>
       The <u>.fwknoprc</u> file is used to set various parameters to override default program parameters at runtime.
       It also allows for additional named configuration <u>stanzas</u> for setting program parameters for a particular
       invocation.

       The <b>fwknop</b> client will create this file if it does not exist in the user’s home directory. This initial
       version has some sample directives that are commented out. It is up to the user to edit this file to meet
       their needs.

       The <u>.fwknoprc</u> file contains a default configuration area or stanza which holds global configuration
       directives that override the program defaults. You can edit this file and create additional <u>named</u> <u>stanzas</u>
       that can be specified with the <b>-n</b> or <b>--named-config</b> option. Parameters defined in the named stanzas will
       override any matching <u>default</u> stanza directives. Note that command-line options will still override any
       corresponding <u>.fwknoprc</u> directives.

       There are directives to match most of the command-line parameters <b>fwknop</b> supports. Here is the current
       list of each directive along with a brief description and its matching command-line option(s):

       <b>SPA_SERVER</b> <u>&lt;hostname/IP-address&gt;</u>
           Specify the hostname or IP of the destination (<b>fwknopd</b>) server (<u>-D,</u> <u>--destination</u>).

       <b>ALLOW_IP</b> <u>&lt;IP-address&gt;</u>
           Specify the address to allow within the SPA data. Note: This parameter covers the <b>-a</b>, <b>-s</b>, and <b>-R</b>
           command-line options. You can specify a hostname or IP address (the <b>-a</b> option), specify the word
           "source" to tell the <b>fwknopd</b> server to accept the source IP of the packet as the IP to allow (the <b>-s</b>
           option), or use the word "resolve" to have <b>fwknop</b> resolve the external network IP via HTTP request
           (the <b>-R</b> option).

       <b>ACCESS</b> <u>&lt;port</u> <u>list&gt;</u>
           Set the one or more protocol/ports to open on the firewall (<u>-A,</u> <u>--access</u>). The format of this list is
           “+&lt;proto&gt;/&lt;port&gt;...&lt;proto&gt;/&lt;port&gt;+”, e.g. “tcp/22,udp/53”.

       <b>SPA_SERVER_PORT</b> <u>&lt;port&gt;</u>
           Set the server port to use for sending the SPA packet (<u>-p,</u> <u>--server-port</u>).

       <b>SPA_SERVER_PROTO</b> <u>&lt;protocol</u>&gt;
           Set the protocol to use for sending the SPA packet (<u>-P,</u> <u>--server-proto</u>).

       <b>KEY</b> <u>&lt;passphrase&gt;</u>
           This is the passphrase that is used for SPA packet encryption and applies to both Rijndael or GPG
           encryption modes. The actual encryption key that is used for Rijndael is derived from the PBKDF1
           algorithm, and the GPG key is derived from the specified GPG key ring.

       <b>KEY_BASE64</b> <u>&lt;base64</u> <u>encoded</u> <u>passphrase&gt;</u>
           Specify the encryption passphrase as a base64 encoded string. This allows non-ascii characters to be
           included in the base64-decoded key.

       <b>USE_HMAC</b> <u>&lt;Y/N&gt;</u>
           Set HMAC mode for authenticated encryption of SPA packets. This will have <b>fwknop</b> prompt the user for
           a dedicated HMAC key that is independent of the encryption key. Alternatively, the HMAC key can be
           specified with the <u>HMAC_KEY</u> or <u>HMAC_KEY_BASE64</u> directives (see below).

       <b>HMAC_KEY</b> <u>&lt;key&gt;</u>
           Specify the HMAC key for authenticated encryption of SPA packets. This supports both Rijndael and GPG
           encryption modes, and is applied according to the encrypt-then-authenticate model.

       <b>HMAC_KEY_BASE64</b> <u>&lt;base64</u> <u>encoded</u> <u>key&gt;</u>
           Specify the HMAC key as a base64 encoded string. This allows non-ascii characters to be included in
           the base64-decoded key.

       <b>HMAC_DIGEST_TYPE</b> <u>&lt;digest</u> <u>algorithm&gt;</u>
           Set the HMAC digest algorithm used for authenticated encryption of SPA packets. Choices are: <b>MD5</b>,
           <b>SHA1</b>, <b>SHA256</b> (the default), <b>SHA384</b>, <b>SHA512</b>, <b>SHA3_256</b>, and <b>SHA3_512</b>.

       <b>SPA_SOURCE_PORT</b> <u>&lt;port&gt;</u>
           Set the source port to use for sending the SPA packet (<u>-S,</u> <u>--source-port</u>).

       <b>FW_TIMEOUT</b> <u>&lt;seconds&gt;</u>
           Set the firewall rule timeout value (<u>-f,</u> <u>--fw-timeout</u>).

       <b>RESOLVE_IP_HTTPS</b> <u>&lt;Y/N&gt;</u>
           Set to <u>Y</u> to automatically resolve the externally routable IP associated with the <b>fwknop</b> client. This
           is done over SSL via <u>wget</u> in <u>--secure-protocol</u> mode against the IP resolution service available at
           <u>https://www.cipherdyne.org/cgi-bin/myip</u>.

       <b>RESOLVE_HTTP_ONLY</b> <u>&lt;Y/N&gt;</u>
           When the <b>fwknop</b> client is instructed to resolve the external client IP, this option can be used to
           force an <u>HTTP</u> connection instead of an <u>HTTPS</u> connection when set to <u>Y</u>. This option is useful when
           <u>wget</u> is not installed on the local OS, or when it is not compiled against an SSL library.

       <b>RESOLVE_URL</b> <u>&lt;url&gt;</u>
           Set to a URL that will be used for resolving the source IP address (<u>--resolve-url</u>).

       <b>WGET_CMD</b> <u>&lt;wget</u> <u>full</u> <u>path&gt;</u>
           Set the full path to the <u>wget</u> command (used for client IP resolution).

       <b>TIME_OFFSET</b> <u>&lt;time&gt;</u>
           Set a value to apply to the timestamp in the SPA packet. This can be either a positive or negative
           value (<u>--time-offset-plus/minus</u>).

       <b>ENCRYPTION_MODE</b> <u>&lt;mode&gt;</u>
           Specify the encryption mode when AES is used. This variable is a synonym for the <u>-M,</u>
           <u>--encryption-mode</u> command line argument. In general, it is recommended to not include this argument
           and let the default (CBC) apply. Note that the string “legacy” can be specified in order to generate
           SPA packets with the old initialization vector strategy used by versions of <b>fwknop</b> prior to 2.5.

       <b>DIGEST_TYPE</b> <u>&lt;digest</u> <u>algorithm&gt;</u>
           Set the SPA message digest type (<u>-m,</u> <u>--digest-type</u>). Choices are: <b>MD5</b>, <b>SHA1</b>, <b>SHA256</b> (the default),
           <b>SHA384</b>, <b>SHA512</b>, <b>SHA3_256</b>, and <b>SHA3_512</b>.

       <b>USE_GPG</b> <u>&lt;Y/N&gt;</u>
           Set to <u>Y</u> to specify the use of GPG for encryption (<u>--gpg-encryption</u>).

       <b>USE_GPG_AGENT</b> <u>&lt;Y/N&gt;</u>
           Set to <u>Y</u> to have <b>fwknop</b> interface with a GPG agent instance for the GPG key password (<u>--gpg-agent</u>).
           Agent information itself is specified with the <u>GPG_AGENT_INFO</u> environmental variable.

       <b>GPG_SIGNING_PW</b> <u>&lt;passphrase&gt;</u>
           This is the passphrase that is used for signing SPA packet data in GPG encryption mode, and is a
           synonym for the <u>KEY</u> variable (i.e. the signing passphrase can be specified with the <u>KEY</u> variable
           instead). The SPA packet is encrypted with the remote server key and signed with the local client
           key.

       <b>GPG_SIGNING_PW_BASE64</b> <u>&lt;base64</u> <u>encoded</u> <u>passphrase&gt;</u>
           Specify the GPG signing passphrase as a base64 encoded string. This allows non-ascii characters to be
           included in the base64-decoded key.

       <b>GPG_SIGNER</b> <u>&lt;key</u> <u>ID</u> <u>or</u> <u>Name&gt;</u>
           Specify the GPG key name or ID for signing the GPG-encrypted SPA data (<u>--gpg-signer-key</u>).

       <b>GPG_RECIPIENT</b> <u>&lt;key</u> <u>ID</u> <u>or</u> <u>Name&gt;</u>
           Specify the GPG key name or ID for the recipient of the GPG-encrypted SPA data (<u>--gpg-recipient-key</u>).

       <b>GPG_HOMEDIR</b> <u>&lt;dir&gt;</u>
           Specify the GPG home directory (<u>--gpg-home-dir</u>). Defaults to <u><a href="file:~/.gnupg">~/.gnupg</a></u>.

       <b>GPG_EXE</b> <u>&lt;path&gt;</u>
           Specify the path to GPG (<u>--gpg-exe</u>). Defaults to <u><a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?gpg">/usr/bin/gpg</a></u>.

       <b>SPOOF_USER</b> <u>&lt;user&gt;</u>
           Set the username in the SPA data to the specified value (<u>-U,</u> <u>--spoof-user</u>).

       <b>SPOOF_SOURCE_IP</b> <u>&lt;IP&gt;</u>
           Set the source IP of the outgoing SPA packet to the specified value (<u>-Q,</u> <u>--spoof-source</u>).

       <b>RAND_PORT</b> <u>&lt;Y/N&gt;</u>
           Send the SPA packet over a randomly assigned port (<u>-r,</u> <u>--rand-port</u>).

       <b>KEY_FILE</b> <u>&lt;file&gt;</u>
           Load an encryption key/password from a file (<u>-G,</u> <u>--get-key</u>).

       <b>HTTP_USER_AGENT</b> <u>&lt;agent</u> <u>string&gt;</u>
           Set the HTTP User-Agent for resolving the external IP via -R, or for sending SPA packets over HTTP
           (<u>-u,</u> <u>--user-agent</u>).

       <b>USE_WGET_USER_AGENT</b> <u>&lt;Y/N&gt;</u>
           Allow default <b>wget</b> User-Agent string to be used when resolving the external IP instead of a
           User-Agent supplied by the <b>fwknop</b> client.

       <b>NAT_ACCESS</b> <u>&lt;internalIP:forwardPort&gt;</u>
           Gain NAT access to an internal service protected by the fwknop server (<u>-N,</u> <u>--nat-access</u>).

       <b>NAT_LOCAL</b> <u>&lt;Y/N&gt;</u>
           Access a local service via a forwarded port on the fwknopd server system (<u>--nat-local</u>).

       <b>NAT_PORT</b> <u>&lt;port&gt;</u>
           Specify the port to forward to access a service via NAT (<u>--nat-port</u>).

       <b>NAT_RAND_PORT</b> <u>&lt;Y/N&gt;</u>
           Have the fwknop client assign a random port for NAT access (<u>--nat-rand-port</u>).

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       <b>SPOOF_USER</b>, <b>GPG_AGENT_INFO</b> (only used in <b>--gpg-agent</b> mode).

</pre><h4><b>SPA</b> <b>PACKET</b> <b>SPOOFING</b></h4><pre>
       Because <b>fwknop</b> places the IP to be allowed through the firewall within the encrypted SPA payload (unless
       <b>-s</b> is used which is not recommended and can be prohibited in the <b>fwknopd</b> server configuration), SPA
       packets can easily be spoofed, and this is a good thing in this context. That is, the source IP of an SPA
       packet is ignored by the <b>fwknopd</b> daemon (when the <u>REQUIRE_SOURCE_ADDRESS</u> variable is set in the
       <u>/etc/fwknop/access.conf</u> file) and only the IP that is contained within an authenticated and properly
       decrypted SPA packet is granted access through the firewall. This makes it possible to make it appear as
       though, say, www.yahoo.com is trying to authenticate to a target system but in reality the actual
       connection will come from a seemingly unrelated IP.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following examples illustrate the command line arguments that could be supplied to the fwknop client
       in a few situations:

   <b>Quick</b> <b>start</b>
       The most effective and easiest way to use <b>fwknop</b> is to have the client generate both an encryption key
       and an HMAC key, and then save them to the “$HOME/.fwknoprc” file along with access request specifics.
       The keys will also need to be transferred to the system where <b>fwknopd</b> is running. The also client
       supports a separate set of encryption and HMAC keys for each SPA destination if multiple fwknopd servers
       are running on different systems.

       So, assuming that the IP <u>2.2.2.2</u> is the system where <b>fwknopd</b> is deployed and SSH is protected by the
       firewall on that system in a default-drop stance, run the client like so to generate encryption and HMAC
       keys:

               $ fwknop -A tcp/22 --use-hmac -R -D 2.2.2.2 --key-gen --save-rc-stanza --verbose
               [+] Wrote Rijndael and HMAC keys to rc file: /home/user/.fwknoprc

       With the access request arguments and encryption and HMAC keys generated and saved in “$HOME/.fwknoprc”,
       the keys themselves need to be transferred to the <u>2.2.2.2</u> system where fwknopd is running. As always,
       this should be done via some secure means such as SSH before SPA is enabled and SSHD is blocked by the
       firewall. Here is what the new <u>2.2.2.2</u> stanza looks like in the <u><a href="file:~/.fwknoprc">~/.fwknoprc</a></u> file:

               $ tail -n 8 /home/user/.fwknoprc
               [2.2.2.2]
               ACCESS                      tcp/22
               SPA_SERVER                  2.2.2.2
               KEY_BASE64                  HvUtIOramehLGKimD4ECXOzinaH4h3U8H1WXum7b54Q=
               HMAC_KEY_BASE64             DLeLf93a3yBT2vhEpM+dWlirGta5GU+jdyG5uXp4461HgOtbqMem4gX0Bp2PJGzYZlbbcavcOM00UPm+0GqkXA==
               USE_HMAC                    Y
               VERBOSE                     Y
               RESOLVE_IP_HTTPS            Y

       The keys are base64 encoded blobs of random data, and both the <b>KEY_BASE64</b> and <b>HMAC_KEY_BASE64</b> lines
       should be copied verbatim and placed within the <u>/etc/fwknop/access.conf</u> file on <u>2.2.2.2</u>. Once this is
       done, <b>fwknopd</b> can be started on that system, a default-drop policy against SSH connections can be put in
       place, and then access to SSH is managed via fwknop. To access SSH, just use the <b>-n</b> argument to reference
       the <u>2.2.2.2</u> stanza out of the .fwknoprc file (some <b>--verbose</b> output is included for illustration):

               $ fwknop -n 2.2.2.2

               FKO Field Values:
               =================

                  Random Value: 8950423288486978
                      Username: mbr
                     Timestamp: 1370194770
                   FKO Version: 2.5
                  Message Type: 1 (Access msg)
                Message String: 1.1.1.1,tcp/22
                    Nat Access: &lt;NULL&gt;
                   Server Auth: &lt;NULL&gt;
                Client Timeout: 0 (seconds)
                   Digest Type: 3 (SHA256)
                     HMAC Type: 3 (SHA256)
               Encryption Type: 1 (Rijndael)
               Encryption Mode: 2 (CBC)
               ...

               $ ssh -l user 2.2.2.2
               <a href="mailto:user@2.2.2.2">user@2.2.2.2</a>'s password:

   <b>Access</b> <b>mode</b> <b>examples</b>
       The most common usage of <b>fwknop</b> is to gain access to SSH running on a remote system that has the <b>fwknopd</b>
       daemon deployed along with a default-drop firewall policy. The following command illustrates this where
       IP <u>1.1.1.1</u> is the IP to be allowed through the firewall running on <u>3.3.3.3</u> (note that the
       <u>/etc/fwknop/access.conf</u> file consumed by <b>fwknopd</b> will need to have matching encryption and HMAC keys, and
       configuration specifics can be found in the <u><a href="../man8/fwknopd.8.html">fwknopd</a>(8)</u> manual page). Also, note the examples below prompt
       the user to supply the encryption and HMAC keys via stdin instead of writing them to disk as in the case
       of using the “$HOME/.fwknoprc” file in the example above. However, all of the following examples can be
       converted to using the <a href="file:~/.fwknoprc">~/.fwknoprc</a> file just by adding the <b>--save-rc-stanza</b> argument:

               $ fwknop -A tcp/22 --use-hmac -a 1.1.1.1 -D 3.3.3.3
               Enter encryption key:
               Enter HMAC key:
               $ ssh -l user 3.3.3.3
               <a href="mailto:user@3.3.3.3">user@3.3.3.3</a>'s password:

       If the <b>--verbose</b> flag is added to the command line, then some SPA packet specifics are printed to stdout
       (not all output is shown for brevity):

               $ fwknop -A tcp/22 --use-hmac -a 1.1.1.1 -D 3.3.3.3 --verbose
               Enter encryption key:
               Enter HMAC key:

                  Random Value: 1916307060193417
                      Username: mbr
                     Timestamp: 1368498909
                   FKO Version: 2.5
                  Message Type: 1 (Access msg)
                Message String: 1.1.1.1,tcp/22
                    Nat Access: &lt;NULL&gt;
                   Server Auth: &lt;NULL&gt;
                Client Timeout: 0 (seconds)
                   Digest Type: 3 (SHA256)
                     HMAC Type: 3 (SHA256)
               Encryption Type: 1 (Rijndael)
               Encryption Mode: 2 (CBC)

       Simultaneous access to multiple services is also supported, and here is an example of requesting access
       to both <u>SSH</u> and <u>OpenVPN</u> on <u>3.3.3.3</u>:

               $ fwknop -A "tcp/22,tcp/1194" --use-hmac -a 1.1.1.1 -D 3.3.3.3

       There are many cases where an <b>fwknop</b> client is deployed on a network behind a NAT device and the
       externally routable IP is not known to the user. In this case, use the IP resolution service available at
       <u>https://www.cipherdyne.org/cgi-bin/myip</u> via the <b>-R</b> command line switch in order to derive the external
       client IP address. This is a safer method of acquiring the client IP address than using the <b>-s</b> option
       mentioned earlier in this manual page because the source IP is put within the encrypted packet instead of
       having the <b>fwknopd</b> daemon grant the requested access from whatever IP address the SPA packet originates
       (i.e. using <b>-s</b> opens the possibility of a MITM attack):

               $ fwknop -A tcp/22 --use-hmac -R -D 3.3.3.3

       Use the Single Packet Authorization mode to gain access to <u>SSH</u> and this time use GnuPG keys to encrypt
       and decrypt:

               $ fwknop -A tcp/22 --use-hmac --gpg-sign ABCD1234 --gpg--recipient 1234ABCD -R -D 3.3.3.3

       Instruct the fwknop server running at 3.3.3.3 to allow 1.1.1.1 to connect to <u>SSH</u>, but spoof the
       authorization packet from an IP associated with <u>www.yahoo.com</u> (requires root on the <b>fwknop</b> client OS):

               # fwknop --spoof-src "www.yahoo.com" -A tcp/22 --use-hmac -a 1.1.1.1 -D 3.3.3.3

       When <b>fwknopd</b> is running on an iptables firewall with systems deployed behind it, it is possible to take
       advantage of the NAT capabilities offered by iptables in order to transparently reach systems behind the
       firewall via SPA. Here is an example where the <b>fwknop</b> client is used to gain access to SSH running on the
       non-routable IP <u>192.168.10.23</u> that is deployed on the network behind <u>3.3.3.3</u>. In this case, the SSH
       connection made to <u>3.3.3.3</u> is translated via NAT to the <u>192.168.10.2</u> system automatically:

               $ fwknop -A tcp/22 -N 192.168.10.2:22 -R -D 3.3.3.3

</pre><h4><b>BACKWARDS</b> <b>COMPATIBILITY</b></h4><pre>
       With the <u>2.5</u> release, <b>fwknop</b> underwent significant changes in its usage of cryptography including the
       addition of support for HMAC authenticated encryption for both Rijndael and GnuPG modes, ensuring the
       proper usage of PBKDF1 for key derivation when SPA packets are encrypted with Rijndael, and several bugs
       were fixed from previous versions of fwknop. In general, this implies that when Rijndael is used, SPA
       packets produced by the <u>2.5</u> release are incompatible with previous versions of fwknop. The GnuPG
       encryption mode is unaffected by these updates. However, even with Rijndael is used, backwards
       compatibility is supported through setting the <u>legacy</u> encryption mode with <b>-M</b> on the fwknop client
       command line and/or the <u>ENCRYPTION_MODE</u> variable in the <u>/etc/fwknop/access.conf</u> file. This way, a pre-2.5
       server can decrypt SPA packets produced by a 2.5 and later client (set <u>-M</u> <u>legacy</u>), and a 2.5 and later
       server can decrypt SPA packets produced by pre-2.5 clients (set <u>ENCRYPTION_MODE</u> <u>legacy</u> in the access.conf
       file). Note that HMAC is only supported as of 2.5 and is an optional feature, so backwards compatibility
       is only for configurations that don’t use an HMAC on either side. It is strongly recommended to upgrade
       all fwknop clients and servers to 2.5 and use the new HMAC mode for properly authenticated SPA
       communications. The backwards compatibility support is used to make it easier to upgrade clients and
       servers with a phased approach.

       For emphasis, if the <b>fwknopd</b> server is upgraded to 2.5 (or later), but older clients cannot be upgraded
       at the same time, then for each <u>SOURCE</u> stanza in the <u>/etc/fwknop/access.conf</u> file, add the following
       line:

               ENCRYPTION_MODE         legacy

       In addition, if the <u>KEY</u> variable has an encryption key longer than 16 bytes, it will need to be truncated
       to 16 characters in the <u>access.conf</u> file in order for pre-2.5 clients to work properly. This limitation
       is fixed in 2.5, and provides additional motivation for upgrading all clients and servers to 2.5 or
       later.

       Now, flipping the scenario around, if the <b>fwknop</b> clients are upgraded but the <b>fwknopd</b> server is still at
       a pre-2.5 version, then add the <u>-M</u> <u>legacy</u> argument to the fwknop command line:

               $ fwknop -A tcp/22 -M legacy -R -D 2.2.2.2

</pre><h4><b>DEPENDENCIES</b></h4><pre>
       The <b>fwknop</b> client requires <u>libfko</u> which is normally included with both source and binary distributions,
       and is a dedicated library developed by the fwknop project. Whenever the <b>fwknopd</b> server is used, <u>libpcap</u>
       is a required dependency. However, the upcoming <u>2.6</u> release will offer a UDP listener mode along with
       privilege separation support and will not require libpcap in this mode. In UDP listener mode, even though
       fwknopd binds to a UDP port, SPA packets are never acknowledged so from an attacker’s perspective there
       is no difference between fwknopd sniffing the wire passively vs. listening on a UDP socket in terms of
       what can be scanned for.

       For GPG functionality, GnuPG must also be correctly installed and configured along with the <u>libgpgme</u>
       library.

       To take advantage of all of the authentication and access management features of the <b>fwknopd</b>
       daemon/service a functioning <u>iptables</u>, <u>ipfw</u>, or <u>pf</u> firewall is required on the underlying operating
       system.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       The most comprehensive way to gain diagnostic information on <b>fwknop</b> is to run the test suite
       <u>test-fwknop.pl</u> script located in the <u>test/</u> directory in the fwknop sources. The test suite sends fwknop
       through a large number of run time tests, has <u>valgrind</u> support, validates both SPA encryption and HMAC
       results against OpenSSL, and even has its own built in fuzzer for SPA communications (and fwknop in
       version 2.6.4 supports the <u>American</u> <u>Fuzzy</u> <u>Lop</u> (AFL) from Michal Zalewski as well). For more basic
       diagnostic information, <b>fwknop</b> can be executed with the <b>-T</b> (or <b>--test</b>) command line option. This will
       have <b>fwknop</b> simply create and print the SPA packet information, then run it through a decrypt/decode
       cycle and print it again. In addition, the <b>--verbose</b> command line switch is useful to see various SPA
       packet specifics printed to stdout.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/fwknopd.8.html">fwknopd</a>(8), <a href="../man8/iptables.8.html">iptables</a>(8), <a href="../man4/pf.4.html">pf</a>(4), <a href="../man8/pfctl.8.html">pfctl</a>(8), <a href="../man8/ipfw.8.html">ipfw</a>(8), <a href="../man1/gpg.1.html">gpg</a>(1), libfko documentation.

       More information on Single Packet Authorization can be found in the paper “Single Packet Authorization
       with fwknop” available at <u><a href="http://www.cipherdyne.org/fwknop/docs/SPA.html">http://www.cipherdyne.org/fwknop/docs/SPA.html</a></u>. A comprehensive tutorial on
       <b>fwknop</b> operations and theory can be found at <u><a href="http://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html">http://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html</a></u>.
       This tutorial also includes information about the design of <b>fwknop</b> that may be worth reading for those
       interested in why fwknop is different from other SPA implementations.

       <b>fwknop</b> uses the <u>git</u> versioning system as its source code repository along with <u>Github</u> for tracking of
       issues and milestones:

               $ git clone https://github.com/mrash/fwknop.git fwknop.git

       Additional commentary on Single Packet Authorization can be found via Michael Rash’s Twitter feed:
       <a href="http://twitter.com/michaelrash">http://twitter.com/michaelrash</a>, @michaelrash

</pre><h4><b>AUTHORS</b></h4><pre>
       The primary developers of <b>fwknop</b> are Michael Rash (project creator) &lt;<a href="mailto:mbr@cipherdyne.org">mbr@cipherdyne.org</a>&gt;, Damien Stuart
       &lt;<a href="mailto:dstuart@dstuart.org">dstuart@dstuart.org</a>&gt;, and Jonathan Bennett &lt;<a href="mailto:jbennett@incomsystems.biz">jbennett@incomsystems.biz</a>&gt;.

</pre><h4><b>CONTRIBUTORS</b></h4><pre>
       This “C” version of fwknop was derived from the original Perl-based version on which many people who are
       active in the open source community have contributed. See the CREDITS file in the fwknop sources, or
       visit <u>https://github.com/mrash/fwknop/blob/master/CREDITS</u> to view the online list of contributors. A few
       contributors deserve to be singled out including: Franck Joncourt, Max Kastanas, Vlad Glagolev, Sean
       Greven, Hank Leininger, Fernando Arnaboldi, and Erik Gomez.

       The phrase “Single Packet Authorization” was coined by MadHat and Simple Nomad at the BlackHat Briefings
       of 2005.

</pre><h4><b>BUGS</b></h4><pre>
       Send bug reports to <a href="mailto:dstuart@dstuart.org">dstuart@dstuart.org</a> or <a href="mailto:mbr@cipherdyne.org">mbr@cipherdyne.org</a>, or open a new issue on Github (see
       <u>https://github.com/mrash/fwknop.git</u>). Suggestions and/or comments are always welcome as well. Additional
       information may be found in the <b>fwknop</b> mailing list archives (see:
       <u>https://lists.sourceforge.net/lists/listinfo/fwknop-discuss</u>).

</pre><h4><b>DISTRIBUTION</b></h4><pre>
       <b>fwknop</b> is distributed under the GNU General Public License (GPL v2+), and the latest version may be
       downloaded from <u><a href="http://www.cipherdyne.org">http://www.cipherdyne.org</a></u>.

Fwknop Client                                      08/06/2018                                          <u><a href="../man8/FWKNOP.8.html">FWKNOP</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>