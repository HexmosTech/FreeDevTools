<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fwsnort - Firewall Snort</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/fwsnort">fwsnort_1.6.8-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>fwsnort</b> - Firewall Snort

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>fwsnort</b> <b>[options]</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>fwsnort</b>  translates  SNORT  rules  into  iptables  rules  on  Linux systems and generates a corresponding
       iptables policy in iptables-save  format.   This  ruleset  allows  network  traffic  that  matches  Snort
       signatures  (i.e.  attacks and other suspicious network behavior) to be logged and/or dropped by iptables
       directly without putting an interface into promiscuous mode or queuing packets from kernel to user space.
       Note that fwsnort can also build an iptables policy that combines the string  match  extension  with  the
       NFQUEUE  or  QUEUE  targets  to  allow  the kernel to perform preliminary string matches that are defined
       within Snort rules before queuing matching packets to a userspace  snort_inline  instance.   Because  the
       bulk  of  network  communications  are  not  generally  malicious,  this  should  provide  a  speedup for
       snort_inline since the majority of packets do not then have to be copied from  kernel  memory  into  user
       memory  and  subsequently  inspected  by  snort_inline.   There  is a tradeoff here in terms of signature
       detection however because snort_inline when deployed in this way does not have the opportunity to see all
       packets associated with a session, so stream reassembly and signature comparisons against  a  reassembled
       buffer  do  not  take  place  (the  stream  preprocessor should be disabled in the userspace snort_inline
       instance).

       As   of   <b>fwsnort-1.5</b>   all   iptables   rules   built   by   fwsnort   are   written    out    to    the
       <u>/var/lib/fwsnort/fwsnort.save</u> file in iptables-save format.  This allows a long fwsnort policy (which may
       contain  thousands  of  iptables  rules  translated  from  a  large  Snort  signature  set) to be quickly
       instantiated via the "iptables-restore" command.  A wrapper script  <u>/var/lib/fwsnort/fwsnort.sh</u>  is  also
       written  out  to make this easy.  Hence, the typical work flow for fwsnort is to: 1) run fwsnort, 2) note
       the Snort rules that fwsnort was able to successfully translate (the number of such rules is  printed  to
       stdout),  and then 3) execute the <u>/var/lib/fwsnort/fwsnort.sh</u> wrapper script to instantiate the policy in
       the running kernel.

       <b>fwsnort</b> (optionally) uses the IPTables::Parse CPAN module to parse the iptables ruleset on the machine to
       determine which Snort rules are applicable to the specific iptables policy.  After all,  if  iptables  is
       blocking  all inbound http traffic from external addresses for example, it is probably not of much use to
       try detecting inbound attacks against against tcp/80.  By default fwsnort generates iptables  rules  that
       log  Snort  sid's  within a --log-prefix to syslog where the messages can be analyzed with a log analyzer
       such as <b>psad</b> (see <a href="http://www.cipherdyne.org/psad/">http://www.cipherdyne.org/psad/</a>).  <b>fwsnort</b> relies on the iptables string  match  module
       to  match  Snort  content fields in the application portion of ip traffic.  Since Snort rules can contain
       hex data in content fields (specified between pipe "|" characters), fwsnort implements  a  patch  against
       iptables  (which  has  been accepted by the Netfilter project as of iptables-1.2.7a) which adds a "--hex-
       string"  option.   This  allow  iptables  to  accept  content   fields   from   Snort   rules   such   as
       "|0d0a5b52504c5d3030320d0a|" without any modification.  <b>fwsnort</b> is able to translate approximately 60% of
       all  rules  from  the  Snort-2.3.3  IDS  into  equivalent iptables rules.  For more information about the
       translation strategy as well as  advantages/disadvantages  of  the  method  used  by  fwsnort  to  obtain
       intrusion   detection   data,   see   the  README  included  with  the  fwsnort  sources  or  browse  to:
       <a href="http://www.cipherdyne.org/fwsnort/">http://www.cipherdyne.org/fwsnort/</a>

       <b>fwsnort</b> is able to apply  Snort  rules  to  IPv6  traffic  by  building  an  ip6tables  policy  (see  the
       "--ip6tables" command line argument).

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-c</b>, <b>--config</b> <b>&lt;configuration</b> <b>file&gt;</b>
              By  default  fwsnort  makes use of the configuration file <b>/etc/fwsnort/fwsnort.conf</b> for almost all
              configuration parameters.  fwsnort can be made to override this path  by  specifying  a  different
              file  on  the command line with the --config option.  When fwsnort is not executed as root, then a
              path to a readable fwsnort.conf file is required.

       <b>--update-rules</b>
              Download the latest Emerging Threats rules from <a href="http://www.emergingthreats.net">http://www.emergingthreats.net</a> This will overwrite
              the  emerging-all.rules file in the /etc/fwsnort/snort_rules/ directory.  Note that the  automatic
              downloading  of  Snort rules from <a href="http://www.snort.org/">http://www.snort.org/</a> as of March, 2005 is only offered as a pay
              service.

       <b>--rules-url</b>  <b>&lt;url&gt;</b>
              Specify the URL to use when updating the Emerging Threats rule set (or any other rule  set).   The
              default URL is: <a href="http://rules.emergingthreats.net/open/snort-2.9.0/emerging-all.rules">http://rules.emergingthreats.net/open/snort-2.9.0/emerging-all.rules</a>

       <b>-6</b>, <b>--ip6tables</b>
              Enable  <b>ip6tables</b>  mode  so that the fwsnort rule set is built into an ip6tables policy instead of
              the iptables policy.  This allows fwsnort controls to apply to IPv6 traffic.

       <b>--include-type</b>  <b>&lt;rules</b> <b>type&gt;</b>
              Restrict to processing snort rules of &lt;rules type&gt;.  Example  rule  types  would  include  "ddos",
              "backdoor",  and  "web-attacks".   This option also supports a comma-separated list of types, e.g.
              "ddos,backdoor".

       <b>--exclude-type</b>  <b>&lt;rules</b> <b>type&gt;</b>
              Exclude all Snort rules from of type &lt;rules type&gt; from the translation process.  For  example,  if
              you  don't  want  any rules from the file emerging-all.rules to be translated, then use "emerging-
              all" as the argument to this option.  A comma-separated list of types to exclude can be specified.

       <b>--include-regex</b>  <b>&lt;regex&gt;</b>
              Only translate Snort rules that match the specified regular expression. This is  useful  to  build
              <b>fwsnort</b>  policies for Snort rules that have a common characteristic (such as a string match on the
              word "Storm" for the Storm worm for example).

       <b>--exclude-regex</b>  <b>&lt;regex&gt;</b>
              Translate all Snort rules except those that match  the  specified  regular  expression.   This  is
              useful  to  omit  Snort  rules  from <b>fwsnort</b> policies that have a common characteristic (such as a
              string match on "HTTP_PORTS" for example).

       <b>--include-re-caseless</b>
              Make the rule matching regular expression specified with <u>--include-regex</u> match case insensitively.

       <b>--exclude-re-caseless</b>
              Make the rule matching regular expression specified with <u>--exclude-regex</u> match case insensitively.

       <b>--snort-rdir</b> <b>&lt;snort-rules-directory&gt;</b>
              Manually specify the  directory  where  the  snort  rules  files  are  located.   The  default  is
              <b>/etc/fwsnort/snort_rules.</b>  Multiple directories are supported as a comma-separated list.

       <b>--snort-rfile</b> <b>&lt;snort-rules-file&gt;</b>
              Manually  specify  a  Snort rules file to translated into iptables rules.  Multiple files are also
              supported as a comma-separated list.

       <b>--snort-sid</b> <b>&lt;sid&gt;</b>
              Generate an iptables ruleset for a single snort rule specified by &lt;sid&gt;.  A  comma-separated  list
              of sids can be specified, e.g. "2001842,1834".

       <b>--exclude-sid</b> <b>&lt;sid&gt;</b>
              Provide a list of Snort ID's to be excluded from the translation process.

       <b>--include-perl-triggers</b>
              Include  <u>'perl</u> <u>-e</u> <u>print</u> <u>...</u> <u>'</u> commands as comments in the <u>fwsnort.sh</u> script.  These commands allow
              payloads that are designed to trigger snort rules to easily  be  built,  and  when  combined  with
              netcat  (or  other software that can send bytes over the wire) it becomes possible to test whether
              an fwsnort policy appropriately triggers on matching traffic.

       <b>--ipt-script</b> <b>&lt;script</b> <b>file&gt;</b>
              Specify the  path  to  the  iptables  script  generated  by  fwsnort.   The  default  location  is
              /var/lib/fwsnort/fwsnort.sh.

       <b>--ipt-check-capabilities</b>
              Check iptables capabilities and exit.

       <b>--Last-cmd</b>
              Run  <b>fwsnort</b> with the same command line arguments as the previous execution.  This is a convenient
              way of rebuilding the <u>/var/lib/fwsnort/fwsnort.sh</u> script without having to remember what the  last
              command line args were.

       <b>--NFQUEUE</b>
              Build  an  <b>fwsnort</b>  policy  that  sends  packets  that match Snort <b>content</b> or <b>uricontent</b> fields to
              userspace via the iptables NFQUEUE target for further analysis.  This is a mechanism for  reducing
              the  signature  inspection  load  placed  on snort_inline.  A parallel set of Snort rules that are
              successfully translated are placed in the /etc/fwsnort/snort_rules_queue directory.  This requires
              CONFIG_NETFILTER_XT_TARGET_NFQUEUE support in the Linux kernel.

       <b>--QUEUE</b>
              Same as the <b>--NFQUEUE</b> command line argument except that the older QUEUE target is used instead  of
              the NFQUEUE target.  This requires CONFIG_IP_NF_QUEUE support in the Linux kernel.

       <b>--queue-num</b> <b>&lt;num&gt;</b>
              Specify a queue number in --NFQUEUE mode.

       <b>--queue-pre-match-max</b> <b>&lt;num&gt;</b>
              In  --QUEUE  or  --NFQUEUE mode, limit the number of content matches that are performed within the
              kernel before sending a matching packet to a userspace Snort instance.  This  allows  a  level  of
              tuning  with  respect  to  how  much work the kernel does to qualify a packet based on a signature
              match before having Snort do the same thing.  The default is  to  perform  all  specified  content
              matches  in  the  signature  before queuing the packet to userspace because the multiple in-kernel
              content matches is probably less expensive than sending a packet to userspace by default.

       <b>--string-match-alg</b> <b>&lt;alg&gt;</b>
              Specify the string matching algorithm to use with the kernel.  By default, this is  'bm'  for  the
              'Boyer-Moore'  string  matching  algorithm,  but  'kmp'  may  also  be  specified  (short  for the
              'Knuth–Morris–Pratt' algorithm).

       <b>--ipt-apply</b>
              Execute the iptables script generated by fwsnort.

       <b>--ipt-exec</b>
              Synonym for --ipt-apply.

       <b>--ipt-revert</b>
              Revert to a version of the iptables policy without any <b>fwsnort</b> rules.  Note that this  reverts  to
              the  iptables policy as it was when <b>fwsnort</b> was originally executed.  So, it is not recommended to
              use this option if there is a large amount of time between when fwsnort is run to translate  Snort
              rules  vs.  running  it  with  this option.  For most purposes it is better to use the --ipt-flush
              option below.

       <b>--ipt-flush</b>
              Flush all <b>fwsnort</b> currently active iptables rules (flushes the fwsnort chains).

       <b>--ipt-list</b>
              List all <b>fwsnort</b> currently active iptables rules (lists the fwsnort chains).

       <b>--ipt-drop</b>
              For each logging rule generated by <b>fwsnort</b> add a corresponding  DROP  rule.   Note  that  for  TCP
              sessions  using  this  option  will  cause retransmissions as packets that are part of established
              sessions selectively dropped.  Remember that false positives are common occurrences for  intrusion
              detection  systems, and so using this or the --ipt-reject option may break things on your network!
              You have been warned.

       <b>--ipt-reject</b>
              For each logging rule generated by <b>fwsnort</b> add a corresponding REJECT rule.  Reset packets will be
              generated for TCP sessions through the use of the "--reject-with tcp-reset" option, and ICMP  port
              unreachable messages will be generated for UDP packets through the use of the "--reject-with icmp-
              port-unreachable" option.

       <b>-C</b>, <b>--Conntrack-state</b> <b>&lt;state&gt;</b>
              Specify  a conntrack state in place of the "established" state that commonly accompanies the Snort
              "flow" keyword.  By default, fwsnort uses the conntrack  state  of  "ESTABLISHED"  for  this.   In
              certain corner cases, it might be useful to use "ESTABLISHED,RELATED" instead to apply application
              layer  inspection  to  things  like  ICMP  port  unreachable  messages  that are responses to real
              attempted communications.

       <b>--no-ipt-log</b>
              By default fwsnort  generates  an  iptables  script  that  implements  a  logging  rule  for  each
              successfully translated snort rule.  This can be disabled with the --no-ipt-log option, but --ipt-
              drop must also be specified.

       <b>--no-ipt-sync</b>
              This  is  a  deprecated option since the default behavior is to translate as many Snort rules into
              iptables rules as possible.  With <b>fwsnort</b> able to produce iptables rules in iptables-save  format,
              it is extremely fast to instantiate a large set of translated Snort rules into an iptables policy.
              A new --ipt-sync option has been added to reverse this behavior (not recommended).

       <b>--ipt-sync</b>
              Consult the iptables policy currently running on the machine for applicable snort rules.

       <b>--no-ipt-test</b>
              Do  not test the iptables build for existence of support for the LOG and REJECT targets, and ascii
              and hex string matching.

       <b>--no-ipt-jumps</b>
              Do not jump packets from the built-in iptables INPUT, OUTPUT, and FORWARD  chains  to  the  custom
              <b>fwsnort</b>  chains.  This options is mostly useful to make it easy to manually alter the placement of
              the jump rules in the iptables ruleset.

       <b>--no-ipt-rule-nums</b>
              By default <b>fwsnort</b> includes the rule number within the logging prefix for each  of  the  rules  it
              adds  to  the fwsnort chains.  E.g. the logging prefix for rule 34 would look something like "[34]
              SID1242 ESTAB".  Use this option to not include the rule number.

       <b>--no-ipt-comments</b>
              If the  iptables  "comment"  match  exists,  then  <b>fwsnort</b>  puts  the  Snort  "msg",  "classtype",
              "reference",  "priority",  and  "rev"  fields  within  a comment for each iptables rule.  Use this
              option to disable this.

       <b>--no-ipt-INPUT</b>
              Do not jump packets from the iptables INPUT chain to the <b>fwsnort</b> chains.

       <b>--no-ipt-OUTPUT</b>
              Do not jump packets from the iptables OUTPUT chain to the <b>fwsnort</b> chains.

       <b>--no-ipt-FORWARD</b>
              Do not jump packets from the iptables FORWARD chain to the <b>fwsnort</b> chains.

       <b>--no-fast-pattern-ordering</b>
              Cause <b>fwsnort</b> to not try to reorder pattern matches to process the  longest  pattern  first.   The
              Snort <u>fast_pattern</u> keyword is also ignored if this option is specified.

       <b>-H</b>, <b>--Home-net</b> <b>&lt;network/mask&gt;</b>
              Specify  the internal network instead of having <b>fwsnort</b> derive it from the HOME_NET keyword in the
              fwsnort.conf configuration file.

       <b>-E</b>, <b>--External-net</b> <b>&lt;network/mask&gt;</b>
              Specify the external network instead of having <b>fwsnort</b> derive it from the EXTERNAL_NET keyword  in
              the fwsnort.conf configuration file.

       <b>--no-addresses</b>
              Disable  all  checks  against  the  output of ifconfig for proper IP addresses.  This is useful if
              <b>fwsnort</b> is running on a bridging firewall.

       <b>--Dump-conf</b>
              Print the fwsnort configuration on STDOUT and exit.

       <b>--debug</b>
              Run in debug mode.  This will cause all parse errors which are normally  written  to  the  fwsnort
              logfile <b>/var/log/fwsnort.log</b> to be written to STDOUT instead.

       <b>--strict</b>
              Run fwsnort in "strict" mode.  This will prevent fwsnort from translating snort rules that contain
              the keywords "offset", "uricontent", and "depth".

       <b>-U</b>, <b>--Ulog</b>
              Force the usage of the ULOG target for all log messages instead of the default LOG target.

       <b>--ulog-nlgroup</b>
              Specify  the netlink group for ULOG rules.  Such rules are only added for Snort rules that have an
              action of "log", or when <b>fwsnort</b> is run in <b>--Ulog</b> mode.

       <b>-l</b>, <b>--logfile</b> <b>&lt;logfile&gt;</b>
              By default fwsnort logs all parse errors to the logfile <b>/var/log/fwsnort.log.</b>  This  path  can  be
              manually changed with the --logfile option.

       <b>-v</b>, <b>--verbose</b>
              Run  fwsnort in verbose mode.  This will cause fwsnort to add the original snort rule as a comment
              to the fwsnort.sh script for each successfully translated rule.

       <b>-V</b>, <b>--Version</b>
              Print the fwsnort version and exit.

       <b>-h</b>, <b>--help</b>
              Print usage information on STDOUT and exit.

</pre><h4><b>FILES</b></h4><pre>
       <b>/etc/fwnort/fwsnort.conf</b>
              The fwsnort configuration file.  The path to this file can be changed on  the  command  line  with
              --config.

       <b>/var/lib/fwnort/fwsnort.sh</b>
              The  iptables script generated by fwsnort.  The path can be manually specified on the command line
              with the --ipt-script option.

</pre><h4><b>FWSNORT</b> <b>CONFIGURATION</b> <b>VARIABLES</b></h4><pre>
       This section describes what each of the more important fwsnort configuration variables do  and  how  they
       can  be  tuned  to  meet  your  needs.   These  variables  are  located in the fwsnort configuration file
       <b>/etc/fwsnort/fwsnort.conf</b>

       <b>HOME_NET</b>
              <b>fwsnort</b> uses the same HOME_NET and EXTERNAL_NET variables as defined in Snort rules, and the  same
              semantics  are  supported.   I.e.,  individual IP addresses or networks in standard dotted-quad or
              CIDR notation can be specified, and comma separated lists are also supported.

       <b>EXTERNAL_NET</b>
              Defines the external network.  See the HOME_NET variable for more information.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following examples illustrate the command line arguments that could be supplied to fwsnort in  a  few
       situations:

       Script  generation  in  logging  mode,  parse  errors written to the fwsnort logfile, and iptables policy
       checking are enabled by default without having to specify any command line arguments:

       <b>#</b> <b>fwsnort</b>

       Generate ip6tables rules for attacks delivered over IPv6:

       <b>#</b> <b>fwsnort</b> <b>-6</b>

       Generate iptables rules for ddos and backdoor Snort rules only:

       <b>#</b> <b>fwsnort</b> <b>--include-type</b> <b>ddos,backdoor</b>

       Generate iptables rules for Snort ID's 2008475 and 2003268 (from emerging-all.rules):

       <b>fwsnort</b> <b>--snort-sid</b> <b>2008475,2003268</b>

       Generate iptables rules for Snort ID's 1834 and 2001842 but queue  them  to  userspace  via  the  NFQUEUE
       target and restrict exclude the INPUT and OUTPUT chains:

       <b>fwsnort</b> <b>--snort-sid</b> <b>1834,2001842</b> <b>--NFQUEUE</b> <b>--no-ipt-INPUT</b> <b>--no-ipt-OUTPUT</b>

       Instruct <b>fwsnort</b> to only inspect traffic that traverses the eth0 and eth1 interfaces:

       <b>#</b> <b>fwsnort</b> <b>--restrict-intf</b> <b>eth0,eth1</b>

       Generate iptables rules for Snort rules that appear to be allowed by the local iptables policy, and write
       original snort rules to the iptables script as a comment:

       <b>#</b> <b>fwsnort</b> <b>--ipt-sync</b> <b>--verbose</b>

</pre><h4><b>DEPENDENCIES</b></h4><pre>
       <b>fwsnort</b>  requires  that  the  iptables  string match module be compiled into the kernel (or as a loadable
       kernel module) in order to be able to match snort signatures that make  use  of  the  "content"  keyword.
       Note  that  the --no-opt-test option can be specified to have fwsnort generate an iptables script even if
       the string match module is not compiled in.

       <b>fwsnort</b> also requires the IPTables::Parse CPAN module in order to parse iptables policies.   This  module
       is bundled with the fwsnort sources in the deps/ directory for convenience.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       The  --debug option can be used to display on STDOUT any errors that are generated as fwsnort parses each
       snort rule.  Normally these errors are written to the fwsnort logfile /var/log/fwsnort.log

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/psad.8.html">psad</a></b>(8), <b><a href="../man8/iptables.8.html">iptables</a></b>(8), <b><a href="../man8/snort.8.html">snort</a></b>(8), <b><a href="../man1/nmap.1.html">nmap</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
       Michael Rash &lt;<a href="mailto:mbr@cipherdyne.org">mbr@cipherdyne.org</a>&gt;

</pre><h4><b>CONTRIBUTORS</b></h4><pre>
       Many people who are active in the open source community have contributed to fwsnort; see the <b>CREDITS</b> file
       in the fwsnort sources, or visit  <b><a href="http://www.cipherdyne.org/fwsnort/docs/contributors.html">http://www.cipherdyne.org/fwsnort/docs/contributors.html</a></b>  to  view  the
       online list of contributors.

       <b>fwsnort</b> is based on the original <b>snort2iptables</b> script written by William Stearns.

</pre><h4><b>BUGS</b></h4><pre>
       Send bug reports to <a href="mailto:mbr@cipherdyne.org">mbr@cipherdyne.org</a>. Suggestions and/or comments are always welcome as well.

</pre><h4><b>DISTRIBUTION</b></h4><pre>
       <b>fwsnort</b>  is  distributed  under  the  GNU  General  Public License (GPLv2), and the latest version may be
       downloaded from <b><a href="http://www.cipherdyne.org/">http://www.cipherdyne.org/</a></b> Snort is a registered trademark of Sourcefire, Inc.

Linux                                               Jan, 2011                                         <u><a href="../man8/FWSNORT.8.html">FWSNORT</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>