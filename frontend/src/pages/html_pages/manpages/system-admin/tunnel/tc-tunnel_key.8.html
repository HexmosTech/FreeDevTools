<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tunnel_key - Tunnel metadata manipulation</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/iproute2">iproute2_6.14.0-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tunnel_key - Tunnel metadata manipulation

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>tc</b> ... <b>action</b> <b>tunnel_key</b> { <b>unset</b> | <u>SET</u> }

       <u>SET</u> := <b>set</b> <b>src_ip</b> <u>ADDRESS</u> <b>dst_ip</b> <u>ADDRESS</u> <b>id</b> <u>KEY_ID</u> <b>dst_port</b> <u>UDP_PORT</u> <b>tos</b> <u>TOS</u> <b>ttl</b> <u>TTL</u> [ <b>csum</b> | <b>nocsum</b> ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>tunnel_key</b>  action  combined  with a shared IP tunnel device, allows one to perform IP tunnel en- or
       decapsulation on a packet, reflected by the operation modes <u>UNSET</u> and <u>SET</u>.  The <u>UNSET</u> mode is optional  -
       even  without  using  it,  the metadata information will be released automatically when packet processing
       will be finished.  <u>UNSET</u> function could be used in cases when traffic is forwarded between  two  tunnels,
       where  the  metadata from the first tunnel will be used for encapsulation done by the second tunnel.  <u>SET</u>
       mode requires the source and destination ip <u>ADDRESS</u> and the tunnel key id <u>KEY_ID</u> which will  be  used  by
       the  ip  tunnel  shared  device  to  create  the  tunnel  header. The <b>tunnel_key</b> action is useful only in
       combination with a <b>mirred</b> <b>redirect</b> action to a shared IP tunnel device which will use the  metadata  (for
       <u>SET</u> ) and unset the metadata created by it (for <u>UNSET</u> ).

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>unset</b>  Unset  the  tunnel  metadata  created by the IP tunnel device.  This function is not mandatory and
              might be used only in some specific use cases (as explained above).

       <b>set</b>    Set tunnel metadata to be used by the IP tunnel device. Requires <b>src_ip</b> and <b>dst_ip</b> options.  <b>id</b>  ,
              <b>dst_port</b> , <b>geneve_opts</b> , <b>vxlan_opts</b> and <b>erspan_opts</b> are optional.

              <b>id</b>     Tunnel ID (for example VNI in VXLAN tunnel)

              <b>src_ip</b> Outer header source IP address (IPv4 or IPv6)

              <b>dst_ip</b> Outer header destination IP address (IPv4 or IPv6)

              <b>dst_port</b>
                     Outer header destination UDP port

              <b>geneve_opts</b>
                     Geneve  variable  length  options.   <b>geneve_opts</b>  is specified in the form CLASS:TYPE:DATA,
                     where CLASS is represented as a 16bit hexadecimal value, TYPE as an 8bit hexadecimal  value
                     and  DATA  as  a  variable  length  hexadecimal value. Additionally multiple options may be
                     listed using a comma delimiter.

              <b>vxlan_opts</b>
                     Vxlan metadata options.  <b>vxlan_opts</b> is specified in  the  form  GBP,  as  a  32bit  number.
                     Multiple options is not supported.

              <b>erspan_opts</b>
                     Erspan  metadata  options.   <b>erspan_opts</b>  is  specified in the form VERSION:INDEX:DIR:HWID,
                     where VERSION is represented as a 8bit number, INDEX as an 32bit number, DIR and HWID as  a
                     8bit  number.  Multiple options is not supported. Note INDEX is used when VERSION is 1, and
                     DIR and HWID are used when VERSION is 2.

              <b>tos</b>    Outer header TOS

              <b>ttl</b>    Outer header TTL

              [<b>no</b>]<b>csum</b>
                     Controls outer UDP checksum. When set to <b>csum</b> (which is default), the outer UDP checksum is
                     calculated and included in the packets. When set to <b>nocsum</b>, outer  UDP  checksum  is  zero.
                     Note  that  when  using  zero  UDP  checksums  with IPv6, the other tunnel endpoint must be
                     configured to accept such packets.  In Linux, this would be the <b>udp6zerocsumrx</b>  option  for
                     the VXLAN tunnel interface.

                     If  using <b>nocsum</b> with IPv6, be sure you know what you are doing. Zero UDP checksums provide
                     weaker protection against corrupted packets. See RFC6935 for details.

              <b>nofrag</b> disallow IP fragmentation.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following example encapsulates incoming ICMP packets on eth0 into a vxlan tunnel, by setting metadata
       to VNI 11, source IP 11.11.0.1 and destination IP 11.11.0.2, and  by  redirecting  the  packet  with  the
       metadata to device vxlan0, which will do the actual encapsulation using the metadata:

              #tc qdisc add dev eth0 handle ffff: ingress
              #tc filter add dev eth0 protocol ip parent ffff: \
                flower \
                  ip_proto icmp \
                action tunnel_key set \
                  src_ip 11.11.0.1 \
                  dst_ip 11.11.0.2 \
                  id 11 \
                action mirred egress redirect dev vxlan0

       Here  is  an  example  of  the  <b>unset</b>  function:  Incoming  VXLAN  traffic  with outer IP's and VNI 11 is
       decapsulated by vxlan0 and metadata is unset before redirecting to tunl1 device:

              #tc qdisc add dev eth0 handle ffff: ingress
              #tc filter add dev vxlan0 protocol ip parent ffff:   flower \
                     enc_src_ip 11.11.0.2 enc_dst_ip 11.11.0.1 enc_key_id 11   action tunnel_key unset  action mirred egress redirect dev tunl1

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/tc.8.html">tc</a></b>(8)

iproute2                                           10 Nov 2016      <u>Tunnel</u> <u>metadata</u> <u>manipulation</u> <u>action</u> <u>in</u> <u><a href="../man8/tc.8.html">tc</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>