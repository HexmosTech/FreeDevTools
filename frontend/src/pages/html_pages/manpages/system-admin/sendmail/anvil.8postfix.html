<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>anvil - Postfix session count and request rate control</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/postfix">postfix_3.6.4-1ubuntu1.3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       anvil - Postfix session count and request rate control

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>anvil</b> [generic Postfix daemon options]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  Postfix <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server maintains statistics about client connection counts or client request rates.
       This information can be used to defend against  clients  that  hammer  a  server  with  either  too  many
       simultaneous  sessions,  or  with too many successive requests within a configurable time interval.  This
       server is designed to run under control by the Postfix <b><a href="../man8/master.8.html">master</a></b>(8) server.

       In the following text, <b>ident</b> specifies  a  (service,  client)  combination.  The  exact  syntax  of  that
       information is application-dependent; the <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server does not care.

</pre><h4><b>CONNECTION</b> <b>COUNT/RATE</b> <b>CONTROL</b></h4><pre>
       To register a new connection send the following request to the <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server:

           <b>request=connect</b>
           <b>ident=</b><u>string</u>

       The <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server answers with the number of simultaneous connections and the number of connections per
       unit time for the (service, client) combination specified with <b>ident</b>:

           <b>status=0</b>
           <b>count=</b><u>number</u>
           <b>rate=</b><u>number</u>

       To register a disconnect event send the following request to the <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server:

           <b>request=disconnect</b>
           <b>ident=</b><u>string</u>

       The <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server replies with:

           <b>status=0</b>

</pre><h4><b>MESSAGE</b> <b>RATE</b> <b>CONTROL</b></h4><pre>
       To register a message delivery request send the following request to the <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server:

           <b>request=message</b>
           <b>ident=</b><u>string</u>

       The  <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server answers with the number of message delivery requests per unit time for the (service,
       client) combination specified with <b>ident</b>:

           <b>status=0</b>
           <b>rate=</b><u>number</u>

</pre><h4><b>RECIPIENT</b> <b>RATE</b> <b>CONTROL</b></h4><pre>
       To register a recipient request send the following request to the <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server:

           <b>request=recipient</b>
           <b>ident=</b><u>string</u>

       The <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server answers with the number of recipient  addresses  per  unit  time  for  the  (service,
       client) combination specified with <b>ident</b>:

           <b>status=0</b>
           <b>rate=</b><u>number</u>

</pre><h4><b>TLS</b> <b>SESSION</b> <b>NEGOTIATION</b> <b>RATE</b> <b>CONTROL</b></h4><pre>
       The features described in this section are available with Postfix 2.3 and later.

       To  register a request for a new (i.e. not cached) TLS session send the following request to the <b><a href="../man8/anvil.8.html">anvil</a></b>(8)
       server:

           <b>request=newtls</b>
           <b>ident=</b><u>string</u>

       The <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server answers with the number of new TLS session requests per unit time for  the  (service,
       client) combination specified with <b>ident</b>:

           <b>status=0</b>
           <b>rate=</b><u>number</u>

       To retrieve new TLS session request rate information without updating the counter information, send:

           <b>request=newtls_report</b>
           <b>ident=</b><u>string</u>

       The  <b><a href="../man8/anvil.8.html">anvil</a></b>(8)  server answers with the number of new TLS session requests per unit time for the (service,
       client) combination specified with <b>ident</b>:

           <b>status=0</b>
           <b>rate=</b><u>number</u>

</pre><h4><b>AUTH</b> <b>RATE</b> <b>CONTROL</b></h4><pre>
       To register an AUTH request send the following request to the <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server:

           <b>request=auth</b>
           <b>ident=</b><u>string</u>

       The <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server answers with the number of auth requests per unit  time  for  the  (service,  client)
       combination specified with <b>ident</b>:

           <b>status=0</b>
           <b>rate=</b><u>number</u>

</pre><h4><b>SECURITY</b></h4><pre>
       The  <b><a href="../man8/anvil.8.html">anvil</a></b>(8)  server  does  not talk to the network or to local users, and can run chrooted at fixed low
       privilege.

       The <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server maintains an in-memory table with information  about  recent  clients  requests.   No
       persistent  state  is  kept  because  standard  system  library  routines are not sufficiently robust for
       update-intensive applications.

       Although the in-memory state is kept only temporarily, this may require a lot of memory on  systems  that
       handle  connections  from  many  remote clients.  To reduce memory usage, reduce the time unit over which
       state is kept.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       Problems and transactions are logged to <b><a href="../man8/syslogd.8.html">syslogd</a></b>(8) or <b><a href="../man8/postlogd.8.html">postlogd</a></b>(8).

       Upon exit, and every <b>anvil_status_update_time</b> seconds, the server logs the maximal count and rate  values
       measured,  together  with (service, client) information and the time of day associated with those events.
       In order to avoid unnecessary overhead, no measurements are done  for  activity  that  isn't  concurrency
       limited or rate limited.

</pre><h4><b>BUGS</b></h4><pre>
       Systems  behind network address translating routers or proxies appear to have the same client address and
       can run into connection count and/or rate limits falsely.

       In this preliminary implementation, a count (or rate) limited server process can  have  only  one  remote
       client  at  a time. If a server process reports multiple simultaneous clients, state is kept only for the
       last reported client.

       The <b><a href="../man8/anvil.8.html">anvil</a></b>(8) server automatically discards client request information after it expires.  To  prevent  the
       <b><a href="../man8/anvil.8.html">anvil</a></b>(8)  server  from  discarding  client request rate information too early or too late, a rate limited
       service should always register connect/disconnect events even when it does not explicitly limit them.

</pre><h4><b>CONFIGURATION</b> <b>PARAMETERS</b></h4><pre>
       On low-traffic mail systems, changes to <b>main.cf</b> are picked up automatically as <b><a href="../man8/anvil.8.html">anvil</a></b>(8) processes run for
       only a limited amount of time. On other mail systems, use the command "<b>postfix</b>  <b>reload</b>"  to  speed  up  a
       change.

       The text below provides only a parameter summary. See <b><a href="../man5/postconf.5.html">postconf</a></b>(5) for more details including examples.

       <b>anvil_rate_time_unit</b> <b>(60s)</b>
              The time unit over which client connection rates and other rates are calculated.

       <b>anvil_status_update_time</b> <b>(600s)</b>
              How frequently the <b><a href="../man8/anvil.8.html">anvil</a></b>(8) connection and rate limiting server logs peak usage information.

       <b>config_directory</b> <b>(see</b> <b>'postconf</b> <b>-d'</b> <b>output)</b>
              The default location of the Postfix main.cf and master.cf configuration files.

       <b>daemon_timeout</b> <b>(18000s)</b>
              How  much  time a Postfix daemon process may take to handle a request before it is terminated by a
              built-in watchdog timer.

       <b>ipc_timeout</b> <b>(3600s)</b>
              The time limit for sending or receiving information over an internal communication channel.

       <b>max_idle</b> <b>(100s)</b>
              The maximum amount of time that an idle Postfix daemon process waits for  an  incoming  connection
              before terminating voluntarily.

       <b>max_use</b> <b>(100)</b>
              The  maximal  number  of  incoming  connections  that a Postfix daemon process will service before
              terminating voluntarily.

       <b>process_id</b> <b>(read-only)</b>
              The process ID of a Postfix command or daemon process.

       <b>process_name</b> <b>(read-only)</b>
              The process name of a Postfix command or daemon process.

       <b>syslog_facility</b> <b>(mail)</b>
              The syslog facility of Postfix logging.

       <b>syslog_name</b> <b>(see</b> <b>'postconf</b> <b>-d'</b> <b>output)</b>
              A prefix that is prepended to the process name in syslog records, so that,  for  example,  "smtpd"
              becomes "prefix/smtpd".

       Available in Postfix 3.3 and later:

       <b>service_name</b> <b>(read-only)</b>
              The master.cf service name of a Postfix daemon process.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/smtpd.8.html">smtpd</a>(8), Postfix SMTP server
       <a href="../man5/postconf.5.html">postconf</a>(5), configuration parameters
       <a href="../man5/master.5.html">master</a>(5), generic daemon options

</pre><h4><b>README</b> <b>FILES</b></h4><pre>
       Use "<b>postconf</b> <b>readme_directory</b>" or "<b>postconf</b> <b>html_directory</b>" to locate this information.
       TUNING_README, performance tuning

</pre><h4><b>LICENSE</b></h4><pre>
       The Secure Mailer license must be distributed with this software.

</pre><h4><b>HISTORY</b></h4><pre>
       The anvil service is available in Postfix 2.2 and later.

</pre><h4><b>AUTHOR(S)</b></h4><pre>
       Wietse Venema
       IBM T.J. Watson Research
       P.O. Box 704
       Yorktown Heights, NY 10598, USA

       Wietse Venema
       Google, Inc.
       111 8th Avenue
       New York, NY 10011, USA

                                                                                                 <u><a href="../man8postfix/ANVIL.8postfix.html">ANVIL</a></u>(8postfix)
</pre>
 </div>
</div></section>
</div>
</body>
</html>