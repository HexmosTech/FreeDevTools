<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>snapper - Command-line program for filesystem snapshot management</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/snapper">snapper_0.10.6-1.2build1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       snapper - Command-line program for filesystem snapshot management

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>snapper</b> [<u>--global-opts</u>] <u>command</u> [<u>--command-opts</u>] [<u>command-arguments</u>]

       <b>snapper</b> {--help}

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Snapper is a command-line program for filesystem snapshot management. It can create, delete and compare
       snapshots and undo changes done between snapshots.

       Snapper never modifies the content of snapshots. Thus snapper creates read-only snapshots if supported by
       the kernel. Supported filesystems are btrfs and ext4 (discontinued) as well as snapshots of LVM logical
       volumes with thin-provisioning. Some filesystems might not be supported depending on your installation.

</pre><h4><b>CONCEPTS</b></h4><pre>
   <b>Configurations</b>
       For each filesystem or subvolume that should be snapshotted by snapper, a configuration file is required,
       see <b><a href="../man5/snapper-configs.5.html">snapper-configs</a></b>(5). The setup can be done with the create-config command.

   <b>Snapshots</b>
       Snapper distinguishes three types of snapshots.

       pre
           Pre snapshots should always have a corresponding post snapshot. The intention of pre/post snapshot
           pairs is to snapshot the filesystem before and after a modification.

       post
           See pre type.

       single
           These snapshots have no special relationship to other snapshots.

       Note that filesystem-wise all three types are the same.

   <b>Snapshot</b> <b>Description</b> <b>and</b> <b>Userdata</b>
       With each snapshot a description and some userdata can be associated. The description is a string. The
       userdata is a list of key-value pairs where the keys and values are strings.

       Do not use non-ASCII characters for the snapshot description, userdata or any other strings, unless you
       always use the UTF-8 character encoding.

   <b>Automatic</b> <b>Snapshot</b> <b>Creation</b>
       Next to manual snapshot creation, snapshots are also created automatically.

       •   A cronjob or systemd timer creates hourly snapshots, if TIMELINE_CREATE is enabled for a config.

       •   Certain programs like YaST and zypper create pre/post snapshot pairs when modifying the system.

   <b>Cleanup</b> <b>Algorithms</b>
       Snapper provides several algorithms to clean up old snapshots. The algorithms are executed in a daily
       cronjob or systemd timer. This can be configured in the corresponding configurations files along with
       parameters for every algorithm.

       number
           Deletes old snapshots when a certain number of snapshots is reached.

       timeline
           Deletes old snapshots but keeps a number of hourly, daily, weekly, monthly and yearly snapshots.

       empty-pre-post
           Deletes pre/post snapshot pairs with empty diffs.

       The number and timeline cleanup algorithms can also try to keep the space used by snapshots below a limit
       and the free space of the filesystem above a limit. For the first condition quota must be setup, see
       command setup-quota. Additional the NUMBER_LIMIT and TIMELINE_LIMIT variables in the config file must
       have ranges (min- and max-value). The algorithms will then make two passes:

        1. Delete snapshots above the max-value independent of the snapshot and filesystem space.

        2. Delete snapshots above the min-value until the limits for the snapshot and filesystem are reached.

       The limit for the used space can be configured via the SPACE_LIMIT variable. Note: Only snapshots that
       have a cleanup algorithm set are taken into account when calculating the space used by snapshots. The
       limit for the free space can be configured via the FREE_LIMIT variable.

   <b>Filters</b>
       Some files keep state information of the system, e.g.  /etc/mtab. Such files should never be reverted. To
       help users, snapper allows one to ignore these files.

       Filters are read from the files /etc/snapper/filters/*.txt and /usr/share/snapper/filters/*.txt, where
       for files with the same name the former location has precedence. Each line in those files specifies a
       pattern. When snapper computes the difference between two snapshots it ignores all files and directories
       matching any of those patterns by using <b><a href="../man3/fnmatch.3.html">fnmatch</a></b>(3) with the flag FNM_LEADING_DIR.

       Note that filters do not exclude files or directories from being snapshotted. For that, use subvolumes or
       mount points.

</pre><h4><b>GLOBAL</b> <b>OPTIONS</b></h4><pre>
       <b>-q,</b> <b>--quiet</b>
           Suppress normal output. Error messages will still be printed, though.

       <b>-v,</b> <b>--verbose</b>
           Increase verbosity.

       <b>--debug</b>
           Turn on debugging.

       <b>--utc</b>
           Display dates and times in UTC. By default, local time is used.

       <b>--iso</b>
           Display dates and times in ISO format. ISO format is always used for machine-readable outputs.

       <b>-t,</b> <b>--table-style</b> <u>style</u>
           Specifies table style. Table style is identified by an integer number.

       <b>--abbreviate</b>
           Try to abbreviate texts in some columns so that tables fit the width of the screen.

       <b>--machine-readable</b> <u>format</u>
           Specifies a machine-readable output format. Possible options are csv and json.

       <b>--csvout</b>
           Sets CSV output format. See <b>RFC</b> <b>4180</b>[1] for the details, except lines end with a LF, not CR+LF.

       <b>--jsonout</b>
           Sets JSON output format.

       <b>--separator</b> <u>character</u>
           Specifies the character separator for CSV output format.

       <b>--no-headers</b>
           Suppress headers for CSV output format.

       <b>-c,</b> <b>--config</b> <u>name</u>
           Use specified configuration instead of the default configuration. The default configuration is named
           "root".

       <b>--no-dbus</b>
           Operate without a DBus connection.

           Use with caution since a running snapperd will not know about modifications made to the system.

       <b>-r,</b> <b>--root</b> <u>path</u>
           Operate on target root. Only works together with no-dbus and only for some commands.

       <b>-a,</b> <b>--ambit</b> <u>ambit</u>
           Operate in the specified ambit. Can be used to override the ambit detection. Allowed ambits are auto,
           classic and transactional.

       <b>--version</b>
           Print version and exit.

</pre><h4><b>COMMANDS</b></h4><pre>
       Snapper provides a number of <u>commands</u>. Each command accepts the options listed in the GLOBAL OPTIONS
       section. These options must be specified <u>before</u> the command name. In addition, many commands have
       specific options, which are listed in this section. These command-specific options must be specified
       <u>after</u> the name of the command and <u>before</u> any of the command arguments.

       <b>help</b>
           Show short help text.

       <b>list-configs</b> <b>[options]</b>
           List available configurations.

           <b>--columns</b> <u>columns</u>
               Select columns to show separated by comma.

               Possible columns are: config, subvolume.

       <b>create-config</b> <b>[options]</b> <u>subvolume</u>
           Create a new configuration for a filesystem or subvolume. For this command you will likely need the
           global option <b>--config</b>, see GLOBAL OPTIONS and CONCEPTS.

           <b>-f,</b> <b>--fstype</b> <u>fstype</u>
               Manually set filesystem type. Supported values are btrfs, ext4 (discontinued) and lvm. For lvm,
               snapper uses LVM thin-provisioned snapshots. The filesystem type on top of LVM must be provided
               in parentheses, e.g. lvm(xfs).

               Without this option snapper tries to detect the filesystem.

           <b>-t,</b> <b>--template</b> <u>name</u>
               Name of template for the new configuration file.

       <b>delete-config</b>
           Delete a configuration for a filesystem or subvolume. For this command you will likely need to global
           option <b>--config</b>, see GLOBAL OPTIONS and CONCEPTS.

       <b>get-config</b> <b>[options]</b>
           Displays the settings of the configuration.

           <b>--columns</b> <u>columns</u>
               Select columns to show separated by comma.

               Possible columns are: key, value.

               Columns are not selected when JSON format is used.

       <b>set-config</b> <u>configdata</u>
           Changes the settings of the configuration. The settings <u>configdata</u> are a list of key-value-pairs
           separated by spaces and the key and value must be separated by an equal sign, e.g.
           "NUMBER_CLEANUP=yes NUMBER_LIMIT=10". The value of SUBVOLUME and FSTYPE cannot be changed.

       <b>list</b> <b>(ls)</b> <b>[options]</b>
           List snapshots.

           <b>-t,</b> <b>--type</b> <u>type</u>
               Selects type of snapshots to list. Possible values are all, single and pre-post.

           <b>--disable-used-space</b>
               Disable display of used space.

               Calculating the used space needs some time. Thus this option can speedup the listing.

           <b>-a,</b> <b>--all-configs</b>
               List snapshots from all configs accessible by the user.

           <b>--columns</b> <u>columns</u>
               Select columns to show separated by comma.

               Possible columns are: config, subvolume, number, default, active, date, user, used-space,
               cleanup, description, userdata, pre-number, post-number, post-date, read-only.

           For each snapshot the output consists of several columns. Some need explanation:

           #, Pre # and Post #
               The number of the snapshot.

               For btrfs the number can be followed by a sign. A "-" indicates that the snapshot is the
               currently mounted snapshot and a "+" indicates that the snapshot will be mounted next time (It is
               the btrfs default subvolume). If both conditions apply a "*" is displayed.

           Used Space
               For btrfs the exclusive space of the btrfs quota group corresponding to the snapshot.

               Display of used space is automatically disabled if not available, e.g. quota not enabled on
               btrfs.

       <b>create</b> <b>[options]</b>
           Create a new snapshot.

           <b>-t,</b> <b>--type</b> <u>type</u>
               Specifies the type of the new snapshot. Possible values are single, pre and post.

           <b>--pre-number</b> <u>number</u>
               For post snapshots the number of the pre snapshot must be provided.

           <b>-p,</b> <b>--print-number</b>
               Print number of the created snapshot.

           <b>-d,</b> <b>--description</b> <u>description</u>
               Description for the snapshot.

           <b>-c,</b> <b>--cleanup-algorithm</b> <u>cleanup-algorithm</u>
               Set the cleanup algorithm for the snapshot.

           <b>-u,</b> <b>--userdata</b> <u>userdata</u>
               Set userdata for the snapshot. The key-value pairs must be separated by comma and the key and
               value must be separated by an equal sign, e.g. requestid=42,user=arthur.

           <b>--command</b> <u>command</u>
               Create a pre and post snapshot and run command in between.

           <b>--read-only</b>
               Create a read-only snapshot. This is the default.

           <b>--read-write</b>
               Create a read-write snapshot.

           <b>--from</b> <u>number</u>
               Create a snapshot from the snapshot with the provided number instead of snapshot 0.

       <b>modify</b> <b>[options]</b> <u>number</u>
           Modify a snapshot.

           <b>-d,</b> <b>--description</b> <u>description</u>
               New description for snapshot.

           <b>-c,</b> <b>--cleanup-algorithm</b> <u>cleanup-algorithm</u>
               Set the cleanup algorithm for the snapshot.

           <b>-u,</b> <b>--userdata</b> <u>userdata</u>
               Set userdata for the snapshot. The key-value pairs must be separated by comma and the key and
               value must be separated by an equal sign, e.g. requestid=42,user=arthur.

           <b>--read-only</b>
               Set the snapshot read-only.

           <b>--read-write</b>
               Set the snapshot read-write.

           <b>--default</b>
               Set the snapshot as default snapshot. Only for btrfs.

       <b>delete</b> <b>(remove|rm)</b> <u>number</u> <b>|</b> <u>number1-number2</u>
           Delete a snapshot or a range of snapshots.

           <b>-s,</b> <b>--sync</b>
               Sync the filesystem after deleting the snapshots. The details depend on the filesystem type.

               Btrfs normally asynchronously frees space after deleting snapshots. With this option snapper will
               wait until the space once used by the deleted snapshots is actually available again.

           Snapshot 0 cannot be deleted. For btrfs the currently mounted snapshot and the snapshot that will be
           mounted next time (the btrfs default subvolume) can also not be deleted.

       <b>mount</b> <u>number</u>
           Mount a snapshot. Not required for all filesystem types.

       <b>umount</b> <u>number</u>
           Unmount a snapshot. Not required for all filesystem types.

       <b>status</b> <b>[options]</b> <u>number1</u><b>..</b><u>number2</u>
           Compare the snapshots <u>number1</u> and <u>number2</u>. This will show a list of files and directories that have
           been created, modified or deleted in the time between the two snapshots have been made.

           <b>-o,</b> <b>--output</b> <u>file</u>
               Write output to file <u>file</u>.

           The output consists of a string encoding the status followed by the filename. The characters of the
           status string are:

            1. A "+" means the file was created, a "-" means the file was deleted. A "c" means the content of
               the file has changed and a "t" means the type of the file has changed (e.g. from regular file to
               directory).

            2. A "p" means the permissions are have changed.

            3. An "u" means the user ownership has changed.

            4. A "g" means the group ownership has changed.

            5. A "x" means the extended attribute information has changed.

            6. An "a" means the ACL information has changed.

           If there is no change a "." is outputted.

       <b>diff</b> <b>[options]</b> <u>number1</u><b>..</b><u>number2</u> <b>[files]</b>
           Compare the snapshots <u>number1</u> and <u>number2</u>. This will show a diff of the content of files and
           directories that have been created, modified or deleted in the time between the two snapshots have
           been made.

           <b>-i,</b> <b>--input</b> <u>file</u>
               Read files to diff from file <u>file</u>.

           <b>--diff-cmd</b> <u>command</u>
               Command used for comparing files. The default is <a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?diff">/usr/bin/diff</a> --new-file --unified. The two
               files to compare are passed as parameters to the command.

           <b>-x,</b> <b>--extensions</b> <u>options</u>
               Extra options passed to the diff command.

       <b>undochange</b> <b>[options]</b> <u>number1</u><b>..</b><u>number2</u> <b>[files]</b>
           Undo changes done between snapshot <u>number1</u> and <u>number2</u>.

           <b>-i,</b> <b>--input</b> <u>file</u>
               Read files for which to undo changes from file <u>file</u>.

       <b>rollback</b> <b>[options]</b> <b>[</b><u>number</u><b>]</b>
           Creates two new snapshots and sets the default subvolume. Per default the system boots from the
           default subvolume of the root filesystem. The exact actions depend on whether a number is provided or
           not:

           •   Without a number, a first read-only snapshot of the default subvolume is created. A second
               read-write snapshot of the current system is created. The system is set to boot from the second
               snapshot.

           •   With a number, a first read-only snapshot of the current system is created. A second read-write
               snapshot is created of <u>number</u>. The system is set to boot from the second snapshot.

           Rollback is only supported with btrfs and requires a properly configured system.

           <b>-p,</b> <b>--print-number</b>
               Print number of the second created snapshot.

           <b>-d,</b> <b>--description</b> <u>description</u>
               Description for the snapshot.

           <b>-c,</b> <b>--cleanup-algorithm</b> <u>cleanup-algorithm</u>
               Set the cleanup algorithm for the snapshot.

           <b>-u,</b> <b>--userdata</b> <u>userdata</u>
               Set userdata for the snapshot. The key-value pairs must be separated by comma and the key and
               value must be separated by an equal sign, e.g. requestid=42,user=arthur.

           The rollback command also sets the description, the cleanup algorithm and some userdata unless the
           values are specified on the command line. This will automate cleanup of snapshots created by
           rollbacks.

           In other ambits than classic the rollback command does what is required to do a rollback. Anyway it
           is recommended to use specific programs in that case.

       <b>setup-quota</b>
           Sets up quota. Currently only supported with btrfs.

       <b>cleanup</b> <b>[options]</b> <u>cleanup-algorithm</u>
           Run the cleanup algorithm <u>cleanup-algorithm</u>. Currently implemented cleanup algorithms are number,
           timeline and empty-pre-post. To run all cleanup algorithms, all can be provided as cleanup-algorithm.

           <b>--path</b> <u>path</u>
               Cleanup all configs affecting path. Only useful for btrfs.

           <b>--free-space</b> <u>free-space</u>
               Try to make free-space available. Only useful for btrfs.

       <b>xadiff</b> <u>number1</u><b>..</b><u>number2</u> <b>[files]</b>
           Compare the extended attributes between snapshot <u>number1</u> and <u>number2</u>. See examples below:

           •   +:user.foo for created attributes

           •   -:user.bar for removed attributes

           •   -+:security.selinux for modified attributes

</pre><h4><b>PERMISSIONS</b></h4><pre>
       Non-root users can be allowed to use a configuration by setting ALLOW_USERS or ALLOW_GROUPS in the config
       file. For all operations to work, the user must also be able to read and access the .snapshots directory
       inside the subvolume. The .snapshots directory must be owned by root and must not be writable by anybody
       else.

       Here are some methods how to achieve that:

       •   Make the directory accessible for everyone:

           <b>chmod</b> <b>a+rx</b> <b>.snapshots</b>

       •   Make the directory accessible for a group the user belongs to, e.g.:

           <b>chown</b> <b>:users</b> <b>.snapshots</b>

       •   Make the directory accessible for the user using ACLs, e.g.:

           <b>setfacl</b> <b>-m</b> <b>u:tux:rx</b> <b>.snapshots</b>

       The last method can be performed by snapper, see the SYNC_ACL setting in <b><a href="../man5/snapper-configs.5.html">snapper-configs</a></b>(5).

</pre><h4><b>PLUGINS</b></h4><pre>
       snapper can execute external scripts after certain actions. Scripts have to be placed in
       /usr/lib/snapper/plugins. The name has to start with a digit, execution order is alphabetical.

       The first argument of a script is the action snapper executed. The following actions are defined:

       <b>create-config-pre</b> <u>subvolume</u> <u>fstype</u>
           Executed before a new config is created

       <b>create-config-post</b> <u>subvolume</u> <u>fstype</u>
           Executed after a new config was created

       <b>delete-config-pre</b> <u>subvolume</u> <u>fstype</u>
           Executed before a config is deleted

       <b>delete-config-post</b> <u>subvolume</u> <u>fstype</u>
           Executed after a config was deleted

       <b>create-snapshot-pre</b> <u>subvolume</u> <u>fstype</u> <u>snapshot-number</u>
           Executed before a new snapshot is created

       <b>create-snapshot-post</b> <u>subvolume</u> <u>fstype</u> <u>snapshot-number</u>
           Executed after a new snapshot was created

       <b>modify-snapshot-pre</b> <u>subvolume</u> <u>fstype</u> <u>snapshot-number</u>
           Executed before a snapshot is modified

       <b>modify-snapshot-post</b> <u>subvolume</u> <u>fstype</u> <u>snapshot-number</u>
           Executed after a snapshot was modified

       <b>delete-snapshot-pre</b> <u>subvolume</u> <u>fstype</u> <u>snapshot-number</u>
           Executed before a snapshot is removed

       <b>delete-snapshot-post</b> <u>subvolume</u> <u>fstype</u> <u>snapshot-number</u>
           Executed after a snapshot was removed

       <b>set-default-snapshot-pre</b> <u>subvolume</u> <u>fstype</u> <u>snapshot-number</u>
           Executed before the default snapshot is changed

       <b>set-default-snapshot-post</b> <u>subvolume</u> <u>fstype</u> <u>snapshot-number</u>
           Executed after the default snapshot was changed

       <b>rollback-post</b> <u>subvolume</u> <u>fstype</u> <u>old-snapshot-number</u> <u>new-snapshot-number</u>
           Executed after a rollback was done

       More actions and arguments can be added any time. Using snapper in the plugins is not allowed.

       It is undefined whether the plugins are called from the client (snapper) or server (snapperd).

</pre><h4><b>FILES</b></h4><pre>
       /etc/default/snapper
           Global configuration file.

       /etc/snapper/configs
           Directory containing configuration files.

       /etc/snapper/config-templates
           Directory containing configuration templates.

       /usr/share/snapper/config-templates
           Fallback directory containing configuration templates.

       /etc/snapper/filters/*.txt
           Filter files.

       /usr/share/snapper/filters/*.txt
           Fallback filter files.

       /var/log/snapper.log
           Logfile. Please include this file in bug reports.

</pre><h4><b>NOTES</b></h4><pre>
       There is no mechanism to ensure consistency of the files while a snapshot it made. E.g. the files of a
       database can be inconsistent while the database is running.

       Consistency after undochange is not guaranteed. E.g. when the creation of a user is undone, there might
       still exist files from that user.

       Support for individual filesystems, rollback and extended attributes are compile-time options and may not
       be available.

</pre><h4><b>HOMEPAGE</b></h4><pre>
       <b><a href="http://snapper.io/">http://snapper.io/</a></b>

</pre><h4><b>AUTHORS</b></h4><pre>
       Arvin Schnell &lt;<a href="mailto:aschnell@suse.com">aschnell@suse.com</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/snapper-configs.5.html">snapper-configs</a></b>(5), <b><a href="../man8/snapper-zypp-plugin.8.html">snapper-zypp-plugin</a></b>(8), <b><a href="../man8/pam_snapper.8.html">pam_snapper</a></b>(8), <b><a href="../man8/btrfs.8.html">btrfs</a></b>(8), <b><a href="../man8/lvm.8.html">lvm</a></b>(8), <b><a href="../man5/attr.5.html">attr</a></b>(5), <b><a href="../man5/acl.5.html">acl</a></b>(5)

</pre><h4><b>NOTES</b></h4><pre>
        1. RFC 4180
           https://tools.ietf.org/html/rfc4180

0.10.6                                             2023-04-19                                         <u><a href="../man8/SNAPPER.8.html">SNAPPER</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>