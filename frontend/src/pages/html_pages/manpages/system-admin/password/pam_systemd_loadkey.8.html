<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pam_systemd_loadkey - Read password from kernel keyring and set it as PAM authtok</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/systemd">systemd_257.7-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pam_systemd_loadkey - Read password from kernel keyring and set it as PAM authtok

</pre><h4><b>SYNOPSIS</b></h4><pre>
       pam_systemd_loadkey.so

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pam_systemd_loadkey</b> reads a NUL-separated password list from the kernel keyring, and sets the last
       password in the list as the PAM authtok, which can be used by e.g.  <b><a href="../man3/pam_get_authtok.3.html">pam_get_authtok</a></b>(3).

       The password list is supposed to be stored in the "user" keyring of the root user, by an earlier call to
       <b><a href="../man1/systemd-ask-password.1.html">systemd-ask-password</a></b>(1) with <b>--keyname=</b>. You can pass the keyname to <b>pam_systemd_loadkey</b> via the <b>keyname=</b>
       option.

</pre><h4><b>OPTIONS</b></h4><pre>
       The following options are understood:

       <u>keyname=</u>
           Takes a string argument which sets the keyname to read. The default is "cryptsetup". During boot,
           <b>systemd-cryptsetup@.<a href="../man8/service.8.html">service</a></b>(8) stores a passphrase or PIN in the keyring. The LUKS2 volume key can
           also be used, via the <b>link-volume-key</b> option in <b><a href="../man5/crypttab.5.html">crypttab</a></b>(5).

           <b>Table</b> <b>1.</b>  <b>Possible</b> <b>values</b> <b>for</b> <u>keyname</u>.
           ┌────────────┬────────────────────────────┐
           │ <b>Value</b>      │ <b>Description</b>                │
           ├────────────┼────────────────────────────┤
           │ cryptsetup │ Passphrase or recovery key │
           ├────────────┼────────────────────────────┤
           │ fido2-pin  │ Security token PIN         │
           ├────────────┼────────────────────────────┤
           │ luks2-pin  │ LUKS2 token PIN            │
           ├────────────┼────────────────────────────┤
           │ tpm2-pin   │ TPM2 PIN                   │
           └────────────┴────────────────────────────┘

           Added in version 255.

       <u>debug</u>
           The module will log debugging information as it operates.

           Added in version 255.

</pre><h4><b>EXAMPLE</b></h4><pre>
       This module is intended to be used when you use LUKS with a passphrase, enable autologin in the display
       manager, and want to unlock Gnome Keyring / KDE KWallet automatically. So in total, you only enter one
       password during boot.

       You need to set the password of your Gnome Keyring/KWallet to the same as your LUKS passphrase. Then add
       the following lines to your display manager's PAM config under <a href="file:/etc/pam.d/">/etc/pam.d/</a> (e.g.  sddm-autologin):

           -auth       optional    pam_systemd_loadkey.so
           -auth       optional    pam_gnome_keyring.so
           -session    optional    pam_gnome_keyring.so auto_start
           -session    optional    pam_kwallet5.so auto_start

       And add the following lines to your display manager's systemd service file, so it can access root's
       keyring:

           [Service]
           KeyringMode=inherit

       In this setup, early during the boot process, <b>systemd-cryptsetup@.<a href="../man8/service.8.html">service</a></b>(8) will ask for the passphrase
       and store it in the kernel keyring with the keyname "cryptsetup". Then when the display manager does the
       autologin, <b>pam_systemd_loadkey</b> will read the passphrase from the kernel keyring, set it as the PAM
       authtok, and then <b>pam_gnome_keyring</b> and <b>pam_kwallet5</b> will unlock with the same passphrase.

systemd 257.7                                                                             <u><a href="../man8/PAM_SYSTEMD_LOADKEY.8.html">PAM_SYSTEMD_LOADKEY</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>