<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>systemd-cryptsetup, systemd-cryptsetup@.service - Full disk decryption logic</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/systemd-cryptsetup">systemd-cryptsetup_257.7-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       systemd-cryptsetup, systemd-cryptsetup@.service - Full disk decryption logic

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>systemd-cryptsetup</b> [OPTIONS...] attach VOLUME SOURCE-DEVICE [KEY-FILE] [CRYPTTAB-OPTIONS]

       <b>systemd-cryptsetup</b> [OPTIONS...] detach VOLUME

       systemd-cryptsetup@.service

       system-systemd\x2dcryptsetup.slice

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>systemd-cryptsetup</b> is used to set up (with <b>attach</b>) and tear down (with <b>detach</b>) access to an encrypted
       block device. It is primarily used via systemd-cryptsetup@.service during early boot, but may also be
       called manually. The positional arguments <u>VOLUME</u>, <u>SOURCE-DEVICE</u>, <u>KEY-FILE</u>, and <u>CRYPTTAB-OPTIONS</u> have the
       same meaning as the fields in <b><a href="../man5/crypttab.5.html">crypttab</a></b>(5).

       systemd-cryptsetup@.service is a service responsible for providing access to encrypted block devices. It
       is instantiated for each device that requires decryption.

       systemd-cryptsetup@.service instances are part of the system-systemd\x2dcryptsetup.slice slice, which is
       destroyed only very late in the shutdown procedure. This allows the encrypted devices to remain up until
       filesystems have been unmounted.

       systemd-cryptsetup@.service will ask for hard disk passwords via the <b>password</b> <b>agent</b> <b>logic</b>[1], in order to
       query the user for the password using the right mechanism at boot and during runtime.

       At early boot and when the system manager configuration is reloaded, <a href="file:/etc/crypttab">/etc/crypttab</a> is translated into
       systemd-cryptsetup@.service units by <b><a href="../man8/systemd-cryptsetup-generator.8.html">systemd-cryptsetup-generator</a></b>(8).

       In order to unlock a volume a password or binary key is required.  systemd-cryptsetup@.service tries to
       acquire a suitable password or binary key via the following mechanisms, tried in order:

        1. If a key file is explicitly configured (via the third column in <a href="file:/etc/crypttab">/etc/crypttab</a>), a key read from it is
           used. If a PKCS#11 token, FIDO2 token or TPM2 device is configured (using the <u>pkcs11-uri=</u>,
           <u>fido2-device=</u>, <u>tpm2-device=</u> options) the key is decrypted before use.

        2. If no key file is configured explicitly this way, a key file is automatically loaded from
           /etc/cryptsetup-keys.d/<u>volume</u>.key and /run/cryptsetup-keys.d/<u>volume</u>.key, if present. Here too, if a
           PKCS#11/FIDO2/TPM2 token/device is configured, any key found this way is decrypted before use.

        3. If the <u>try-empty-password</u> option is specified then unlocking the volume with an empty password is
           attempted.

        4. If the <u>password-cache=</u> option is set to "yes" or "read-only", the kernel keyring is then checked for
           a suitable cached password from previous attempts.

        5. Finally, the user is queried for a password, possibly multiple times, unless the <u>headless</u> option is
           set.

       If no suitable key may be acquired via any of the mechanisms describes above, volume activation fails.

</pre><h4><b>CREDENTIALS</b></h4><pre>
       <b>systemd-cryptsetup</b> supports the service credentials logic as implemented by
       <u>ImportCredential=</u>/<u>LoadCredential=</u>/<u>SetCredential=</u> (see <b><a href="../man5/systemd.exec.5.html">systemd.exec</a></b>(5) for details). The following
       credentials are used by "<a href="mailto:systemd-crypsetup@root.service">systemd-crypsetup@root.service</a>" (generated by <b>systemd-gpt-auto-generator</b>) when
       passed in:

       <u>cryptsetup.passphrase</u>
           This credential specifies the passphrase of the LUKS volume.

           Added in version 256.

       <u>cryptsetup.tpm2-pin</u>
           This credential specifies the TPM pin.

           Added in version 256.

       <u>cryptsetup.fido2-pin</u>
           This credential specifies the FIDO2 token pin.

           Added in version 256.

       <u>cryptsetup.pkcs11-pin</u>
           This credential specifies the PKCS11 token pin.

           Added in version 256.

       <u>cryptsetup.luks2-pin</u>
           This credential specifies the pin requested by generic LUKS2 token modules.

           Added in version 256.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/systemd.1.html">systemd</a></b>(1), <b><a href="../man8/systemd-cryptsetup-generator.8.html">systemd-cryptsetup-generator</a></b>(8), <b><a href="../man5/crypttab.5.html">crypttab</a></b>(5), <b><a href="../man1/systemd-cryptenroll.1.html">systemd-cryptenroll</a></b>(1), <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8), <b>TPM2</b> <b>PCR</b>
       <b>Measurements</b> <b>Made</b> <b>by</b> <b>systemd</b>[2]

</pre><h4><b>NOTES</b></h4><pre>
        1. password agent logic
           https://systemd.io/PASSWORD_AGENTS/

        2. TPM2 PCR Measurements Made by systemd
           https://systemd.io/TPM2_PCR_MEASUREMENTS

systemd 257.7                                                                              <u><a href="../man8/SYSTEMD-CRYPTSETUP.8.html">SYSTEMD-CRYPTSETUP</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>