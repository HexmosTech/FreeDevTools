<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>compsize - calculate compression ratio of a set of files on btrfs</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/btrfs-compsize">btrfs-compsize_1.5-1.1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       compsize - calculate compression ratio of a set of files on btrfs

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>compsize</b> <u>file-or-dir</u> [ <u>file-or-dir</u> ... ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>compsize</b>  takes  a  list  of  files  on  a  btrfs  filesystem  (recursing  directories) and measures used
       compression types and the effective compression ratio.  Besides compression, <b>compsize</b> shows the effect of
       reflinks (<u>cp</u> <u>--reflink</u>, snapshots, deduplication), and certain types of btrfs waste.

       The program gives a report similar to:
       Processed 90319 files.
       Type       Perc     Disk Usage   Uncompressed Referenced
       TOTAL       79%      1.4G         1.8G         1.9G
       none       100%      1.0G         1.0G         1.0G
       lzo         53%      446M         833M         843M

       The fields above are:

       <b>Type</b>   compression algorithm

       <b>Perc</b>   disk usage/uncompressed (compression ratio)

       <b>Disk</b> <b>Usage</b>
              blocks on the disk;  this  is  what  storing  these  files  actually  costs  you  (save  for  RAID
              considerations)

       <b>Uncompressed</b>
              uncompressed extents; what you would need without compression - includes deduplication savings and
              pinned extent waste

       <b>Referenced</b>
              apparent  file  sizes  (sans holes); this is what a traditional filesystem that supports holes and
              efficient tail packing, or <u>tar</u> <u>-S</u>, would need to store these files

       Let's see this on an example: a file 128K big is stored as a single extent A which compressed to a single
       4K page.  It then receives a write of 32K at offset 32K, which also  compressed  to  a  single  4K  page,
       stored as extent B.

       The file now appears as:
                +-------+-------+---------------+
       extent A | used  | waste | used          |
                +-------+-------+---------------+
       extent B         | used  |
                        +-------+

       The  "waste"  inside  extent  A  can't  be gotten rid until the whole extent is rewritten (for example by
       <u>defrag</u>).  If compressed, the whole extent needs to be read every time that part  of  the  file  is  being
       read, thus the "waste" is still required.

       In this case, we have: <b>Disk</b> <b>Usage</b>: 8KB, <b>Uncompressed</b>: 160K, <b>Referenced</b>: 128K.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-b</b>/<b>--bytes</b>
              Show raw byte counts rather than human-friendly sizes.

       <b>-x</b>/<b>--one-file-system</b>
              Skip files and directories on different file systems.

</pre><h4><b>SIGNALS</b></h4><pre>
       <b>USR1</b>   Displays partial data for files processed so far.

</pre><h4><b>CAVEATS</b></h4><pre>
       Recently  written files may show as not taking any space until they're actually allocated and compressed;
       this happens once they're synced or on natural writeout, typically on the order of 30 seconds.

       The ioctls used by this program require root.

       Inline extents are considered to be always unique, even if they share the same bytes on the disk.

       This program doesn't currently support filesystems above 8TB on 32-bit machines â€” but  neither  do  other
       btrfs tools.

btrfs                                              2017-09-04                                        <u><a href="../man8/compsize.8.html">compsize</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>