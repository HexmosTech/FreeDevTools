<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bgpq4 — bgp filtering automation tool</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/bgpq4">bgpq4_1.12-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       bgpq4 — bgp filtering automation tool

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>bgpq4</b>  [<b>-h</b>  <u>host[:port]</u>]  [<b>-S</b>  <u>sources</u>]  [<b>-EPz</b>]  [<b>-f</b>  <u>asn</u> | <b>-F</b> <u>fmt</u> | <b>-G</b> <u>asn</u> <b>-H</b> <u>asn</u> <b>-t</b>] [<b>-46ABbDdJjNnpsXU</b>]
             [<b>-a</b> <u>asn</u>] [<b>-r</b> <u>len</u>] [<b>-R</b> <u>len</u>] [<b>-m</b> <u>max</u>] [<b>-W</b> <u>len</u>] <u>OBJECTS</u> [...] [EXCEPT OBJECTS]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>bgpq4</b> utility used to generate configurations (prefix-lists, extended access-lists,  policy-statement
       terms and as-path lists) based on IRR data.

       The options are as follows:

       <b>-4</b>      generate IPv4 prefix/access-lists (default).

       <b>-6</b>      generate IPv6 prefix/access-lists (IPv4 by default).

       <b>-A</b>      try to aggregate prefix-lists as much as possible (not all output formats supported).

       <b>-a</b> <u>asn</u>  specify what asn shall be denied in case of empty prefix-list (OpenBGPD)

       <b>-B</b>      generate output in OpenBGPD format (default: Cisco)

       <b>-b</b>      generate output in BIRD format (default: Cisco).

       <b>-d</b>      enable some debugging output.

       <b>-e</b>      generate output in Arista EOS format (default: Cisco).

       <b>-E</b>      generate  extended  access-list  (Cisco),  policy-statement  term  using route-filters (Juniper),
               [ip|ipv6]-prefix-list (Nokia) or prefix-sets (OpenBGPd).

       <b>-f</b> <u>number</u>
               generate input as-path access-list.

       <b>-F</b> <u>fmt</u>  generate output in user-defined format.

       <b>-G</b> <u>number</u>
               generate output as-path access-list.

       <b>-H</b> <u>number</u>
               generate output as-list for <u>as-path-origin</u> filter (JunOS 21.3R1+)

       <b>-h</b> <u>host[:port]</u>
               host running IRRD database (default: rr.ntt.net).

       <b>-J</b>      generate config for Juniper (default: Cisco).

       <b>-j</b>      generate output in JSON format (default: Cisco).

       <b>-K</b>      generate config for Mikrotik ROSv6 (default: Cisco).

       <b>-K7</b>     generate config for Mikrotik ROSv7 (default: Cisco).

       <b>-l</b> <u>name</u>
               name of generated entry.

       <b>-L</b> <u>limit</u>
               limit recursion depth when expanding as-sets.

       <b>-m</b> <u>len</u>  maximum prefix-length of accepted prefixes (default: 32 for IPv4 and 128 for IPv6).

       <b>-M</b> <u>match</u>
               extra match conditions for Juniper route-filters.

       <b>-n</b>      generate config for Nokia SR OS MD-CLI (Cisco IOS by default)

       <b>-n2</b>     generate config for Nokia SR Linux (Cisco IOS by default)

       <b>-N</b>      generate config for Nokia SR OS classic CLI (Cisco IOS by default).

       <b>-p</b>      emit prefixes where the origin ASN is 23456 or in the private ASN range (disabled by default).

       <b>-r</b> <u>len</u>  allow more specific routes starting with specified masklen too.

       <b>-R</b> <u>len</u>  allow more specific routes up to specified masklen too.

       <b>-s</b>      generate sequence numbers in IOS-style prefix-lists.

       <b>-S</b> <u>sources</u>
               use specified sources only (recommended: RPKI,AFRINIC,APNIC,ARIN,LACNIC,RIPE).

       <b>-t</b>      generate as-sets for OpenBGPd, BIRD and JSON formats.

       <b>-T</b>      disable pipelining (not recommended).

       <b>-U</b>      generate config for Huawei devices (Cisco IOS by default)

       <b>-u</b>      generate config for Huawei devices in XPL format (Cisco IOS by default)

       <b>-W</b> <u>len</u>  generate as-path strings of no more than len items (use 0 for infinity).

       <b>-X</b>      generate config for Cisco IOS XR devices (plain IOS by default).

       <b>-z</b>      generate route-filter-lists (JunOS 16.2+).

       <u>OBJECTS</u>
               means networks (in prefix format), autonomous systems, as-sets and route-sets.

       <u>EXCEPT</u> <u>OBJECTS</u>
               those objects will be excluded from expansion.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Generating named juniper prefix-filter for AS20597:

       $ bgpq4 -Jl eltel AS20597
       policy-options {
       replace:
        prefix-list eltel {
           81.9.0.0/20;
           81.9.32.0/20;
           81.9.96.0/20;
           81.222.128.0/20;
           81.222.192.0/18;
           85.249.8.0/21;
           85.249.224.0/19;
           89.112.0.0/19;
           89.112.4.0/22;
           89.112.32.0/19;
           89.112.64.0/19;
           217.170.64.0/20;
           217.170.80.0/20;
        }
       }

       For Cisco we can use aggregation (-A) flag to make this prefix-filter more compact:

       $ bgpq4 -Al eltel AS20597
       no ip prefix-list eltel
       ip prefix-list eltel permit 81.9.0.0/20
       ip prefix-list eltel permit 81.9.32.0/20
       ip prefix-list eltel permit 81.9.96.0/20
       ip prefix-list eltel permit 81.222.128.0/20
       ip prefix-list eltel permit 81.222.192.0/18
       ip prefix-list eltel permit 85.249.8.0/21
       ip prefix-list eltel permit 85.249.224.0/19
       ip prefix-list eltel permit 89.112.0.0/18 ge 19 le 19
       ip prefix-list eltel permit 89.112.4.0/22
       ip prefix-list eltel permit 89.112.64.0/19
       ip prefix-list eltel permit 217.170.64.0/19 ge 20 le 20

       Prefixes 89.112.0.0/19 and 89.112.32.0/19 now aggregated into single entry 89.112.0.0/18 ge 19 le 19.

       Well, for  Juniper  we  can  generate  even  more  interesting  policy-options,  using  -M  &lt;extra  match
       conditions&gt;, -R &lt;len&gt; and hierarchical names:

       $ bgpq4 -AJEl eltel/specifics -r 29 -R 32 -M "community blackhole" AS20597
       policy-options {
        policy-statement eltel {
         term specifics {
       replace:
          from {
           community blackhole;
           route-filter 81.9.0.0/20 prefix-length-range /29-/32;
           route-filter 81.9.32.0/20 prefix-length-range /29-/32;
           route-filter 81.9.96.0/20 prefix-length-range /29-/32;
           route-filter 81.222.128.0/20 prefix-length-range /29-/32;
           route-filter 81.222.192.0/18 prefix-length-range /29-/32;
           route-filter 85.249.8.0/21 prefix-length-range /29-/32;
           route-filter 85.249.224.0/19 prefix-length-range /29-/32;
           route-filter 89.112.0.0/17 prefix-length-range /29-/32;
           route-filter 217.170.64.0/19 prefix-length-range /29-/32;
          }
         }
        }
       }
       generated  policy-option  term  now allows all specifics with prefix-length between /29 and /32 for eltel
       networks if they match with special community blackhole (defined elsewhere in configuration).

       Of course, this version supports IPv6 (-6):

       $ bgpq4 -6l as-retn-6 AS-RETN6
       no ipv6 prefix-list as-retn-6
       ipv6 prefix-list as-retn-6 permit 2001:7fb:fe00::/48
       ipv6 prefix-list as-retn-6 permit 2001:7fb:fe01::/48
       [....]
       and assumes your device supports 32-bit ASNs

       $ bgpq4 -Jf 112 AS-SPACENET
       policy-options {
       replace:
        as-path-group NN {
         as-path a0 "^<a href="../man112/112.112.html">112</a>(112)*$";
         as-path a1 "^112(.)*(1898|5539|8495|8763|8878|12136|12931|15909)$";
         as-path a2 "^112(.)*(21358|23456|23600|24151|25152|31529|34127|34906)$";
         as-path a3 "^112(.)*(35052|41720|43628|44450|196611)$";
        }
       }
       see `AS196611` in the end of the list ? That's a 32-bit ASN.

</pre><h4><b>USER-DEFINED</b> <b>FORMAT</b></h4><pre>
       If you want to generate configuration not for routers, but for some other programs/systems, you  may  use
       user-defined formatting, like in example below:

       $ bgpq4 -F "ipfw add pass all from %n/%l to any\n" as3254
       ipfw add pass all from 62.244.0.0/18 to any
       ipfw add pass all from 91.219.29.0/24 to any
       ipfw add pass all from 91.219.30.0/24 to any
       ipfw add pass all from 193.193.192.0/19 to any

       Recognized format sequences are:

             <b>%n</b>      network
             <b>%l</b>      mask length
             <b>%a</b>      aggregate low mask length
             <b>%A</b>      aggregate high mask length
             <b>%N</b>      object name
             <b>%m</b>      object mask
             <b>%i</b>      inversed mask
             <b>\n</b>      new line
             <b>\t</b>      tabulation

       Please  note that no new lines are inserted automatically after each sentence.  You have to add them into
       format string manually, otherwise the output will be in one single line (sometimes it makes sense):

       $ bgpq4 -6F "%n/%l; " as-eltel
       2001:1b00::/32; 2620:4f:8000::/48; 2a04:bac0::/29; 2a05:3a80::/48;

</pre><h4><b>NOTES</b> <b>ON</b> <b>SOURCES</b></h4><pre>
       By default <u>bgpq4</u> trusts data from all the databases mirrored into NTT's IRR service.  Unfortunately,  not
       all  these  databases  are equal in how much we can trust their data.  RIR maintained databases (AFRINIC,
       ARIN, APNIC, LACNIC and RIPE) shall be trusted more than the others because they have the knowledge about
       who the rightful holders of resources are, while other  databases  lack  this  knowledge  and  can  (and,
       actually  do)  contain stale data: no one but the RIRs care to remove outdated route-objects when address
       space is de-allocated or transferred.  In order to keep their filters  both  compact  and  actual,  <u>bgpq4</u>
       <u>users</u> are encouraged to use '-S' flag to limit database sources to only the ones they trust.

       General recommendations:

       Use  a  minimal  set  of RIR databases (only those in which you and your customers have registered route-
       objects).

       Avoid using ARIN-NONAUTH and RIPE-NONAUTH as trusted sources: these records were created in the database,
       but for address space allocated to different RIRs, so the NONAUTH databases have  no  chance  to  confirm
       validity of the route objects they contain.

       $ bgpq4 -S RIPE,RADB as-space
       no ip prefix-list NN
       ip prefix-list NN permit 195.190.32.0/19

       $ bgpq4 -S RADB,RIPE as-space
       no ip prefix-list NN
       ip prefix-list NN permit 45.4.4.0/22
       ip prefix-list NN permit 45.4.132.0/22
       ip prefix-list NN permit 45.6.128.0/22
       ip prefix-list NN permit 45.65.184.0/22
       [...]

</pre><h4><b>PERFORMANCE</b></h4><pre>
       To  improve  `bgpq4` performance when expanding extra-large AS-SETs you shall tune OS settings to enlarge
       TCP send buffer.

       FreeBSD can be tuned in the following way:

             <b>sysctl</b> <b>-w</b> <b>net.inet.tcp.sendbuf_max=2097152</b>

       Linux can be tuned in the following way:

             <b>sysctl</b> <b>-w</b> <b>net.ipv4.tcp_window_scaling=1</b>
             <b>sysctl</b> <b>-w</b> <b>net.core.rmem_max=2097152</b>
             <b>sysctl</b> <b>-w</b> <b>net.core.wmem_max=2097152</b>
             <b>sysctl</b> <b>-w</b> <b>net.ipv4.tcp_rmem="4096</b> <b>87380</b> <b>2097152"</b>
             <b>sysctl</b> <b>-w</b> <b>net.ipv4.tcp_wmem="4096</b> <b>65536</b> <b>2097152"</b>

</pre><h4><b>BUILDING</b></h4><pre>
       This project uses autotools. If you are building from  the  repository,  run  the  following  command  to
       prepare the build system:

             <b>./bootstrap</b>

       In order to compile the software, run:

             <b>./configure</b>
             <b>make</b>
             <b>make</b> <b>install</b>

       If you wish to remove the generated build system files from your working tree, run:

             <b>make</b> <b>maintainer-clean</b>

       In order to create a distribution archive, run:

             <b>make</b> <b>dist</b>

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       When  everything  is  OK,  <b>bgpq4</b> generates access-list to standard output and exits with status == 0.  In
       case of errors they are printed to stderr and program exits with non-zero status.

</pre><h4><b>AUTHORS</b></h4><pre>
       Alexandre Snarskii, Christian David, Claudio Jeker, Job Snijders, Massimiliano Stucchi,  Michail  Litvak,
       Peter Schoenmaker, Roelf Wichertjes, and contributions from many others.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>https://github.com/bgp/bgpq4</b> BGPQ4 on Github.

       <b><a href="http://bgpfilterguide.nlnog.net/">http://bgpfilterguide.nlnog.net/</a></b> NLNOG's BGP Filter Guide.

       <b>https://tcp0.com/cgi-bin/mailman/listinfo/bgpq4</b>  Users  and interested parties can subscribe to the BGPQ4
       mailing list <a href="mailto:bgpq4@tcp0.com">bgpq4@tcp0.com</a>

</pre><h4><b>PROJECT</b> <b>MAINTAINER</b></h4><pre>
       Job Snijders &lt;<a href="mailto:job@sobornost.net">job@sobornost.net</a>&gt;

Debian                                          December 23, 2020                                       <u><a href="../man8/BGPQ4.8.html">BGPQ4</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>