<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>apc_modbus - Driver for APC Smart-UPS Modbus protocol</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/nut-modbus">nut-modbus_2.8.3-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       apc_modbus - Driver for APC Smart-UPS Modbus protocol

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>apc_modbus</b> -h

       <b>apc_modbus</b> -a <u>UPS_NAME</u> [<u>OPTIONS</u>]

</pre><h4><b>SUPPORTED</b> <b>HARDWARE</b></h4><pre>
       Generally this driver should work for all the APC Modbus UPS devices. Some devices might expose more than
       is currently supported, like multiple phases. A general rule of thumb is that APC devices (or firmware
       versions) released after 2010 are more likely to support Modbus than the USB HID standard.

       Tested with the following hardware:

       •   SMT1500 (Smart-UPS 1500, Firmware 9.6)

       •   SMX750 (Smart-UPS X 750, Firmware 10.1)

       •   SMX1500 (Smart-UPS X 1500, Firmware 15.0)

       Note that you will have to enable Modbus communication. In the front panel of the UPS, go to Advanced
       Menu mode, under Configuration and enable Modbus.

           <b>Note</b>

           This driver was tested with Serial, TCP and USB interfaces for Modbus. Notably, the Serial ports are
           not available on all devices nowadays; the TCP support may require a purchase of an additional
           network management card; and the USB support <b>currently</b> requires a non-standard build of libmodbus
           (pull request against the upstream library is pending, as of at the time of this publication) as a
           pre-requisite to building NUT with this part of the support. For more details (including how to build
           the custom library and NUT with it) please see NUT PR #2063

           <b>Note</b>

           As currently published, this driver supports reading information from the UPS. Implementation of
           support to write (set modifiable variables or send commands) is expected with a later release. This
           can impact the host shutdown routines in particular (no ability to actively tell the UPS to power off
           or cycle in the end). As a workaround, you can try integrating apctest (from the "apcupsd" project)
           with a "Test to kill power" into your late-shutdown procedure, if needed.

</pre><h4><b>EXTRA</b> <b>ARGUMENTS</b></h4><pre>
       This driver also supports the following optional settings:

       <b>port</b> <b>=</b> <u>string</u>
           Some <u>value</u> must be set, typically <b>auto</b>.

               <b>Note</b>
               This could be a device filesystem path like /dev/usb/hiddev0 but current use of libusb API
               precludes knowing and matching by such identifiers. They may also be inherently unreliable
               (dependent on re-plugging and enumeration order). At this time the actual <u>value</u> is ignored, but
               syntactically some <u>port</u> configuration must still be there.

       It is possible to control multiple UPS units simultaneously by running several instances of this driver,
       provided they can be uniquely distinguished by setting some combination of the <b>vendor</b>, <b>product</b>, <b>vendorid</b>,
       <b>productid</b>, <b>serial</b>, <b>bus</b> and/or <b>device</b> options detailed below. For devices or operating systems that do not
       provide sufficient information, the <b>allow_duplicates</b> option can be of use (limited and risky!)

       <b>vendorid</b> <b>=</b> <u>regex</u>, <b>productid</b> <b>=</b> <u>regex</u>, <b>vendor</b> <b>=</b> <u>regex</u>, <b>product</b> <b>=</b> <u>regex</u>, <b>serial</b> <b>=</b> <u>regex</u>
           Select a specific UPS, in case there is more than one connected via USB. Each option specifies an
           extended regular expression (see <b><a href="../man7/regex.7.html">regex</a></b>(7) for more information on regular expressions), which must
           match the UPS’s entire respective vendor/product/serial string values (minus any surrounding
           whitespace), or the whole 4-digit hexadecimal code for vendorid and productid.

           Try <b><a href="../man8/lsusb.8.html">lsusb</a></b>(8) or running this NUT driver with -DD command-line argument for finding out the strings to
           match.

           Examples:

           •   -x vendor="Foo.Corporation.*"

           •   -x vendorid="051d*" (APC)

           •   -x product=".*(Smart|Back)-?UPS.*"

       <b>bus</b> <b>=</b> <u>regex</u>
           Select a UPS on a specific USB bus or group of buses. The argument is a regular expression that must
           match the bus name where the UPS is connected (e.g.  bus="002" or bus="00[2-3]") as seen on Linux in
           <a href="file:/sys/bus/usb/devices">/sys/bus/usb/devices</a> or <b><a href="../man8/lsusb.8.html">lsusb</a></b>(8); including leading zeroes.

       <b>device</b> <b>=</b> <u>regex</u>
           Select a UPS on a specific USB device or group of devices. The argument is a regular expression that
           must match the device name where the UPS is connected (e.g.  device="001" or device="00[1-2]") as
           seen on Linux in <a href="file:/sys/bus/usb/devices">/sys/bus/usb/devices</a> or <b><a href="../man8/lsusb.8.html">lsusb</a></b>(8); including leading zeroes.

               <b>Note</b>
               device numbers are not guaranteed by the OS to be stable across re-boots or device re-plugging.

       <b>busport</b> <b>=</b> <u>regex</u>
           If supported by the hardware, OS and libusb on the particular deployment, this option should allow to
           specify physical port numbers on an USB hub, rather than logical device enumeration values, and in
           turn — this should be less volatile across reboots or re-plugging. The value may be seen in the USB
           topology output of lsusb -tv on systems with that tool, for example.

               <b>Note</b>
               this option is not practically supported by some NUT builds (it should be ignored with a warning
               then), and not by all systems that NUT can run on.

       <b>allow_duplicates</b>
           If you have several UPS devices which may not be uniquely identified by the options above (e.g. only
           <u>VID:PID</u> can be discovered there), this flag allows each driver instance where it is set to take the
           first match if available, or proceed to try another.

           Normally the driver initialization would abort at this point claiming "Resource busy" or similar
           error, assuming that the otherwise properly matched device is unique — and some other process already
           handles it.

               <b>Warning</b>
               This feature is inherently non-deterministic! The association of driver instance name to actual
               device may vary between runs!

               If you only care to know that <b>at</b> <b>least</b> one of your no-name UPSes is online, this option can help.

               If you must really know <b>which</b> one, it will not!

       <b>usb_set_altinterface</b> <b>=</b> <u>bAlternateSetting</u>
           Force redundant call to usb_set_altinterface(), especially if needed for devices serving multiple USB
           roles where the UPS is not represented by the interface number 0 (default).

       <b>usb_config_index</b>, <b>usb_hid_rep_index</b>, <b>usb_hid_desc_index</b>, <b>usb_hid_ep_in</b>, <b>usb_hid_ep_out</b>
           Force use of specific interface, endpoint, descriptor index etc. numbers, rather than defaulting to <u>0</u>
           (rarely other values in certain drivers for some devices known to use non-zero numbers). Specified as
           a hexadecimal number.

           As a rule of thumb for usb_hid_desc_index discovery, you can see larger wDescriptorLength values
           (roughly 600+ bytes) in reports of lsusb or similar tools.

       <b>LIBUSB_DEBUG</b> <b>=</b> <u>INTEGER</u>
           Run-time troubleshooting of USB-capable NUT drivers can involve not only raising the common NUT debug
           verbosity (e.g. using the DEBUG_MIN setting in <b><a href="../man5/ups.conf.5.html">ups.conf</a></b>(5) or protocol commands to change the
           driver.debug value), but may also benefit from LibUSB specific debugging.

           For the latter, you can set the LIBUSB_DEBUG driver option; alternatively you can classically export
           the environment variable LIBUSB_DEBUG before starting a NUT driver program (may be set and "exported"
           in driver init script or service method, perhaps via <b><a href="../man5/nut.conf.5.html">nut.conf</a></b>(5)), to a numeric value such as 4 ("All
           messages are emitted").

           For more details, including the currently supported values for your version of the library, see e.g.:

           •   https://libusb.sourceforge.io/api-1.0/

           •   https://libusb.sourceforge.io/api-1.0/group__libusb__lib.html

       <b>porttype</b>=<u>value</u>
           Set the type of the port used. Available values are serial for RS232/485 based connections, tcp for
           TCP/IP connections and usb for USB connections.

       <b>port</b>=<u>value</u>
           Depending on the port type you can select a port here. For usb only auto is supported, for serial you
           can pass a device path like /dev/ttyS0 and for tcp you can pass a hostname with optional port like
           example.com:502.

       <b>baudrate</b>=<u>num</u>
           Set the speed of the serial connection. The default baudrate is 9600.

       <b>parity</b>=<u>value</u>
           Set the parity of the serial connection. Available values are N for none, E for even and O for odd.
           The default parity is N (none).

       <b>databits</b>=<u>num</u>
           Set the data bits of the serial connection. The default databits is 8.

       <b>stopbits</b>=<u>num</u>
           Set the stop bits of the serial connection. The default stopbits is 1.

       <b>slaveid</b>=<u>num</u>
           Set the Modbus slave id. The default slave id is 1.

       <b>response_timeout_ms</b>=<u>num</u>
           Set the Modbus response timeout. The default timeout is set by libmodbus. It can be good to set a
           higher timeout on TCP connections with high latency.

</pre><h4><b>BUGS</b></h4><pre>
       This driver relies on advanced features of libmodbus to talk Modbus protocol over USB specifically
       (Serial and TCP are part of common library codebase). At the time of this writing, the common library
       project is just expecting a merge of the pull request with this ability.

       For the time being, if your OS distribution does not ship the required feature set, you may have to build
       your own libmodbus and subsequently (re-)build NUT against this library, as detailed in the NUT GitHub
       Wiki at https://github.com/networkupstools/nut/wiki/APC-UPS-with-Modbus-protocol

       The short sequence may be like follows:

           cd ~/
           git clone -b rtu_usb https://github.com/networkupstools/libmodbus
           cd libmodbus
           ./autogen.sh
           ./configure --with-libusb --prefix=/path/to/prefix
           make install

           <b>Note</b>

           •   you may need to ‘make &amp;&amp; sudo make install` if you want to place this library files’ variant into
               a system path (like --prefix=/usr/local/ups to match NUT defaults — this activity would need
               privilege elevation via sudo), and not into your home directory or some <a href="file:/tmp">/tmp</a> location.

           •   conversely, you may want to ./configure --with-libusb --enable-static --disable-shared
               --prefix=/path/to/prefix and only build and install a static libmodbus.a (can well be installed
               into <a href="file:/tmp">/tmp</a> or similarly short-lived location), so that the customized Modbus+USB logic gets built
               directly into apc_modbus binary program and there would be no potential run-time conflict with a
               dynamic library file available elsewhere in the system.

           cd ~/
           git clone https://github.com/networkupstools/nut
           cd nut
           ./autogen.sh
           ./configure --with-drivers=apc_modbus --with-usb --with-modbus \
              --with-modbus-includes=-I/path/to/prefix/include/modbus \
              --with-modbus-libs="-L/path/to/prefix/lib -lmodbus"
           make

           <b>Note</b>

           •   Other NUT configure options may be needed for proper behavior, such as --prefix,
               --with-sysconfdir, --with-user and --with-group to match your packaged or otherwise preceding NUT
               installation.

       The ./configure --enable-inplace-runtime may be a good start to inherit build configuration from an
       existing NUT deployment, as further detailed at
       https://github.com/networkupstools/nut/wiki/Building-NUT-for-in%E2%80%90place-upgrades-or-non%E2%80%90disruptive-tests

</pre><h4><b>AUTHORS</b></h4><pre>
       •   Axel Gembe &lt;<a href="mailto:axel@gembe.net">axel@gembe.net</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
   <b>The</b> <b>core</b> <b>driver</b>
       <b><a href="../man8/nutupsdrv.8.html">nutupsdrv</a></b>(8), <b><a href="../man5/ups.conf.5.html">ups.conf</a></b>(5)

   <b>Internet</b> <b>resources</b>
       The NUT (Network UPS Tools) home page: https://www.networkupstools.org/historic/v2.8.3/

Network UPS Tools 2.8.3                            07/08/2025                                      <u><a href="../man8/APC_MODBUS.8.html">APC_MODBUS</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>