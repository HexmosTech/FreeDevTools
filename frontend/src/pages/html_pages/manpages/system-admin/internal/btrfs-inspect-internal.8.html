<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>btrfs-inspect-internal - query various internal information</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/btrfs-progs">btrfs-progs_6.14-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       btrfs-inspect-internal - query various internal information

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>btrfs</b> <b>inspect-internal</b> &lt;subcommand&gt; &lt;args&gt;

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  command  group provides an interface to query internal information. The functionality ranges from a
       simple UI to an ioctl or a more complex query that assembles the result from several internal structures.
       The latter usually requires calls to privileged ioctls.

</pre><h4><b>SUBCOMMAND</b></h4><pre>
       <b>dump-super</b> <b>[options]</b> <b>&lt;device&gt;</b> <b>[device...]</b>
              Show btrfs superblock information stored on given devices in textual form.  By default  the  first
              superblock is printed, more details about all copies or additional backup data can be printed.

              Besides verification of the filesystem signature, there are no other sanity checks. The superblock
              checksum status is reported, the device item and filesystem UUIDs are checked and reported.

              <b>NOTE:</b>
                 The  meaning  of  option  <u>-s</u>  has  changed  in version 4.8 to be consistent with other tools to
                 specify superblock copy rather the offset. The old way  still  works,  but  prints  a  warning.
                 Please update your scripts to use <u>--bytenr</u> instead. The option <u>-i</u> has been deprecated.

              <b>Options</b>

              <b>-f|--full</b>
                     print full superblock information, including the system chunk array and backup roots

              <b>-a|--all</b>
                     print  information  about  all  present  superblock copies (cannot be used together with <u>-s</u>
                     option)

              <b>-i</b> <u>&lt;super&gt;</u>
                     (deprecated since 4.8, same behaviour as <u>--super</u>)

              <b>--bytenr</b> <u>&lt;bytenr&gt;</u>
                     specify offset to a superblock in a non-standard location at <u>bytenr</u>, useful  for  debugging
                     (disables the <u>-f</u> option)

                     If there are multiple options specified, only the last one applies.

              <b>-F|--force</b>
                     attempt  to  print  the superblock even if a valid BTRFS signature is not found; the result
                     may be completely wrong if the data does not resemble a superblock

              <b>-s|--super</b> <b>&lt;bytenr&gt;</b>
                     (see compatibility note above)

                     specify which mirror to print, valid values are 0, 1 and  2  and  the  superblock  must  be
                     present on the device with a valid signature, can be used together with <u>--force</u>

       <b>dump-tree</b> <b>[options]</b> <b>&lt;device&gt;</b> <b>[device...]</b>
              Dump  tree  structures  from  a  given  device  in  textual  form,  expand  keys to human readable
              equivalents where possible.  This is useful for analyzing filesystem state or inconsistencies  and
              has a positive educational effect on understanding the internal filesystem structure.

              <b>NOTE:</b>
                 By default contains file names, consider that if you're asked to send the dump for analysis and
                 use <u>--hide-names</u> eventually.  Does not contain file data.

              Special  characters  in file names, xattr names and values are escaped, in the C style like <b>\n</b> and
              octal encoding <b>\NNN</b>.

              <b>Options</b>

              <b>-e|--extents</b>
                     print only extent-related information: extent and device trees

              <b>-d|--device</b>
                     print only device-related information: tree root, chunk and device trees

              <b>-r|--roots</b>
                     print only short root node information, i.e. the root tree keys

              <b>-R|--backups</b>
                     same as <u>--roots</u> plus print backup root info, i.e. the backup root keys and  the  respective
                     tree root block offset

              <b>-u|--uuid</b>
                     print only the uuid tree information, empty output if the tree does not exist

              <b>-b</b> <u>&lt;block_num&gt;</u>
                     print info of the specified block only, can be specified multiple times

              <b>--follow</b>
                     use with <u>-b</u>, print all children tree blocks of <u>&lt;block_num&gt;</u>

              <b>--dfs</b>  (default up to 5.2)

                     use depth-first search to print trees, the nodes and leaves are intermixed in the output

              <b>--bfs</b>  (default since 5.3)

                     use breadth-first search to print trees, the nodes are printed before all leaves

              <b>--hide-names</b>
                     print  a  placeholder <u>HIDDEN</u> instead of various names, useful for developers to inspect the
                     dump while keeping potentially sensitive information hidden

                     This is:

                     • directory entries (files, directories, subvolumes)

                     • default subvolume

                     • extended attributes (name, value)

                     • hardlink names (if stored inside another item or as  extended  references  in  standalone
                       items)

                     <b>NOTE:</b>
                        Lengths are not hidden because they can be calculated from the item size anyway.

              <b>--csum-headers</b>
                     print b-tree node checksums stored in headers (metadata)

              <b>--csum-items</b>
                     print checksums stored in checksum items (data)

              <b>--noscan</b>
                     do  not  automatically scan the system for other devices from the same filesystem, only use
                     the devices provided as the arguments

              <b>-t</b> <u>&lt;tree_id&gt;</u>
                     print only the tree with the specified ID, where the ID can be numerical or common name  in
                     a flexible human readable form

                     The tree id name recognition rules:

                     • case does not matter

                     • the C source definition, e.g. BTRFS_ROOT_TREE_OBJECTID

                     • short  forms  without  BTRFS_ prefix, without _TREE and _OBJECTID suffix, e.g. ROOT_TREE,
                       ROOT

                     • convenience aliases, e.g. DEVICE for the DEV tree, CHECKSUM for CSUM

                     • unrecognized ID is an error

       <b>inode-resolve</b> <b>[-v]</b> <b>&lt;ino&gt;</b> <b>&lt;path&gt;</b>
              (needs root privileges)

              resolve paths to all files with given inode number <u>ino</u> in a given  subvolume  at  <u>path</u>,  i.e.  all
              hardlinks

              <b>Options</b>

              <b>-v</b>     (deprecated) alias for global <u>-v</u> option

       <b>logical-resolve</b> <b>[-Pvo]</b> <b>[-s</b> <b>&lt;bufsize&gt;]</b> <b>&lt;logical&gt;</b> <b>&lt;path&gt;</b>
              (needs root privileges)

              resolve paths to all files at given <u>logical</u> address in the linear filesystem space

              <b>Options</b>

              <b>-P</b>     skip the path resolving and print the inodes instead

              <b>-o</b>     ignore  offsets,  find  all  references  to  an extent instead of a single block.  Requires
                     kernel support for the V2 ioctl (added in 4.15). The results might need further  processing
                     to  filter  out  unwanted  extents  by  the offset that is supposed to be obtained by other
                     means.

              <b>-s</b> <u>&lt;bufsize&gt;</u>
                     set internal buffer for storing the file names to <u>bufsize</u>, default is 64KiB, maximum 16MiB.
                     Buffer sizes over 64KiB require kernel support for the V2 ioctl (added in 4.15).

              <b>-v</b>     (deprecated) alias for global <u>-v</u> option

       <b>list-chunks</b> <b>[options]</b> <b>&lt;path&gt;</b>
              (needs root privileges)

              Enumerate chunks on all devices. The chunks represent the physical range on  devices  (not  to  be
              confused  with  block  groups  that  represent  the  logical  ranges, but the terms are often used
              interchangeably).

              Example output:

                 Devid PNumber      Type/profile    PStart    Length      PEnd LNumber    LStart Usage%
                 ----- ------- ----------------- --------- --------- --------- ------- --------- ------
                     1       1       Data/single   1.00MiB  84.00MiB  85.00MiB      68 191.60GiB  62.77
                     1       2     System/DUP     85.00MiB  32.00MiB 117.00MiB      39 140.17GiB   0.05
                     1       3     System/DUP    117.00MiB  32.00MiB 149.00MiB      40 140.17GiB   0.05
                     1       4   Metadata/DUP    149.00MiB 192.00MiB 341.00MiB      59 188.41GiB  45.00
                     1       5   Metadata/DUP    341.00MiB 192.00MiB 533.00MiB      60 188.41GiB  45.00
                     1       6       Data/single 533.00MiB   1.00GiB   1.52GiB      49 169.91GiB  72.23
                     1       7       Data/single   1.52GiB  16.00MiB   1.54GiB      69 191.68GiB  79.83
                     1       8       Data/single   1.54GiB   1.00GiB   2.54GiB      17 100.90GiB  46.39
                     1       9       Data/single   2.54GiB   1.00GiB   3.54GiB      16  99.90GiB  40.68
                     1      10       Data/single   3.54GiB   1.00GiB   4.54GiB       1  71.40GiB  62.97
                     1      11       Data/single   4.54GiB   1.00GiB   5.54GiB      33 125.04GiB  26.00
                     1      12       Data/single   5.54GiB   1.00GiB   6.54GiB      50 170.91GiB  60.44
                     1      13       Data/single   6.54GiB 512.00MiB   7.04GiB      63 189.16GiB  67.34
                     1      14       Data/single   7.04GiB   1.00GiB   8.04GiB      51 171.91GiB  70.94

              • <u>Devid</u> -- the device id

              • <u>PNumber</u> -- the number of the chunk on the device (in order)

              • <u>Type/profile</u> -- the chunk type and profile

              • <u>PStart</u> -- the chunk start on the device

              • <u>Length</u> -- the chunk length (same for physical and logical address space)

              • <u>PEnd</u> -- the chunk end, effectively <u>PStart</u> <u>+</u> <u>Length</u>

              • <u>LNumber</u> -- the number of the chunk, in the logical address space of the whole filesystem

              • <u>LStart</u> -- the chunk start in the logical address space of the whole filesystem, as it's a single
                space it's also called <u>offset</u>

              • <u>Usage</u> -- chunk usage, percentage of used data/metadata of the chunk length

              The chunks in the output can be sorted by one or more sorting criteria, evaluated as specified, in
              the ascending order.  By default the  chunks  are  sorted  by  <u>devid</u>  and  <u>pstart</u>,  this  is  most
              convenient for single device filesystems.

              On  multi-device filesystems it's up to the user what is preferred as the layout of chunks on e.g.
              striped profiles (RAID0 etc) cannot be easily represented.   A  logical  view  with  corresponding
              underlying  structure  would be better, but sorting by <u>lstart,devid</u> at least groups devices of the
              given logical range. Can be also combined with <u>usage</u>.

              This output can provide information for balance filters.

              <b>Options</b>

              <b>--sort</b> <u>MODE</u>
                     sort by a column (ascending):

                     MODE is a comma separated list of:
                        <u>devid</u> - by device id (default, with pstart)

                        <u>pstart</u> - physical start (relative to the beginning of the device)

                        <u>lstart</u> - logical offset (in the logical address space)

                        <u>usage</u> - by chunk usage (percentage)

                        <u>length</u> - by chunk length

              <b>--raw</b>  raw numbers in bytes, without the <u>B</u> suffix

              <b>--human-readable</b>
                     print human friendly numbers, base 1024, this is the default

              <b>--iec</b>  select the 1024 base for the following options, according to the IEC standard

              <b>--si</b>   select the 1000 base for the following options, according to the SI standard

              <b>--kbytes</b>
                     show sizes in KiB, or kB with --si

              <b>--mbytes</b>
                     show sizes in MiB, or MB with --si

              <b>--gbytes</b>
                     show sizes in GiB, or GB with --si

              <b>--tbytes</b>
                     show sizes in TiB, or TB with --si

       <b>map-swapfile</b> <b>[options]</b> <b>&lt;file&gt;</b>
              (needs root privileges)

              Find device-specific physical offset of <u>file</u> that can be used for hibernation.  Also  verify  that
              the <u>file</u> is suitable as a swapfile.  See also command <b>btrfs</b> <b>filesystem</b> <b>mkswapfile</b> and the <u>Swapfile</u>
              <u>feature</u> description.

              <b>NOTE:</b>
                 Do  not  use  <b>filefrag</b>  or  <u>FIEMAP</u>  ioctl values reported as physical, this is different due to
                 internal filesystem mappings.  The hibernation expects offset relative to  the  physical  block
                 device.

              <b>Options</b>

              <b>-r|--resume-offset</b>
                     print only the value suitable as resume offset for file <b><a href="file:/sys/power/resume_offset">/sys/power/resume_offset</a></b>

       <b>min-dev-size</b> <b>[options]</b> <b>&lt;path&gt;</b>
              (needs root privileges)

              return the minimum size the device can be shrunk to, without performing any resize operation, this
              may be useful before executing the actual resize operation

              <b>Options</b>

              <b>--id</b> <u>&lt;id&gt;</u>
                     specify the device <u>id</u> to query, default is 1 if this option is not used

       <b>rootid</b> <b>&lt;path&gt;</b>
              for  a  given  file  or  directory, return the containing tree root id, but for a subvolume itself
              return its own tree id (i.e. subvol id)

              <b>NOTE:</b>
                 The result is undefined for the so-called empty subvolumes (identified by inode number 2),  but
                 such a subvolume does not contain any files anyway

       <b>subvolid-resolve</b> <b>&lt;subvolid&gt;</b> <b>&lt;path&gt;</b>
              (needs root privileges)

              resolve the absolute path of the subvolume id <u>subvolid</u>

       <b>tree-stats</b> <b>[options]</b> <b>&lt;device&gt;</b>
              (needs root privileges)

              Print  sizes  and  statistics  of  trees. This takes a device as an argument and not a mount point
              unlike other commands.

              <b>NOTE:</b>
                 In case the the filesystem is still mounted it's possible to run the command  but  the  results
                 may  be  inaccurate  or  various  errors may be printed in case there are ongoing writes to the
                 filesystem. A warning is printed in such case.

              <b>Options</b>

              <b>-b|--raw</b>
                     raw numbers in bytes, without the <u>B</u> suffix

              <b>-t</b> <u>&lt;treeid&gt;</u>
                     Print stats only for the given treeid.

              <b>--human-readable</b>
                     print human friendly numbers, base 1024, this is the default

              <b>--iec</b>  select the 1024 base for the following options, according to the IEC standard

              <b>--si</b>   select the 1000 base for the following options, according to the SI standard

              <b>--kbytes</b>
                     show sizes in KiB, or kB with --si

              <b>--mbytes</b>
                     show sizes in MiB, or MB with --si

              <b>--gbytes</b>
                     show sizes in GiB, or GB with --si

              <b>--tbytes</b>
                     show sizes in TiB, or TB with --si

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       <b>btrfs</b> <b>inspect-internal</b> returns a zero exit status if it  succeeds.  Non  zero  is  returned  in  case  of
       failure.

</pre><h4><b>AVAILABILITY</b></h4><pre>
       <b>btrfs</b> is part of btrfs-progs.  Please refer to the documentation at <u>https://btrfs.readthedocs.io</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man8/mkfs.btrfs.8.html">mkfs.btrfs</a>(8)</u>

6.14                                              Apr 17, 2025                         <u><a href="../man8/BTRFS-INSPECT-INTERNAL.8.html">BTRFS-INSPECT-INTERNAL</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>