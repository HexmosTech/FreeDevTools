<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>backup_volsetrestore - Restores all volumes in a volume set</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/openafs-client">openafs-client_1.8.13.2-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       backup_volsetrestore - Restores all volumes in a volume set

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>backup</b> <b>volsetrestore</b> [<b>-name</b> &lt;<u>volume</u> <u>set</u> <u>name</u>&gt;]
           [<b>-file</b> &lt;<u>file</u> <u>name</u>&gt;]
           [<b>-portoffset</b> &lt;<u>TC</u> <u>port</u> <u>offset</u>&gt;+]
           [<b>-extension</b> &lt;<u>new</u> <u>volume</u> <u>name</u> <u>extension</u>&gt;] [<b>-dryrun</b> | <b>-n</b>]
           [<b>-localauth</b>] [<b>-cell</b> &lt;<u>cell</u> <u>name</u>&gt;] [<b>-help</b>]

       <b>backup</b> <b>vols</b> [<b>-na</b> &lt;<u>volume</u> <u>set</u> <u>name</u>&gt;]
           [<b>-f</b> &lt;<u>file</u> <u>name</u>&gt;]
           [<b>-p</b> &lt;<u>TC</u> <u>port</u> <u>offset</u>&gt;+]
           [<b>-e</b> &lt;<u>new</u> <u>volume</u> <u>name</u> <u>extension</u>&gt;]
           [<b>-dryrun</b> | <b>-n</b>] [<b>-l</b>] [<b>-c</b> &lt;<u>cell</u> <u>name</u>&gt;] [<b>-h</b>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>backup</b> <b>volsetrestore</b> command restores the complete contents of a group of read/write volumes to the
       file system, by restoring data from the last full dump and all subsequent incremental dumps of each
       volume.  It is most useful for recovering from loss of data on multiple partitions, since it can restore
       each of a defined set of volumes to a different site.

       (If the "FILE YES" instruction appears in the <u>/var/lib/openafs/backup/CFG_device_name</u> file associated
       with the specified port offset, then the <b>backup</b> <b>volsetrestore</b> command restores data from the backup data
       file listed for that port offset in the Tape Coordinator's <u>/var/lib/openafs/backup/tapeconfig</u> file,
       instead of from tape. For the sake of clarity, the following text refers to tapes only, but the Backup
       System handles backup data files in much the same way.)

       If restoring one or more volumes to a single site only, it is usually more efficient to use the <b>backup</b>
       <b>volrestore</b> command. If restoring all volumes that resided on a single partition, it is usually more
       efficient to use the <b>backup</b> <b>diskrestore</b> command.

       Indicate the volumes to restore by providing either the <b>-name</b> argument or the <b>-file</b> argument:

       •   The  <b>-name</b>  argument  names a volume set. The Backup System restores all volumes listed in the Volume
           Location Database (VLDB) that match the server, partition, and volume name criteria  defined  in  the
           volume  set's  volume  entries,  and  for which dumps are available. It restores the volumes to their
           current site (machine and partition), and by default overwrites the existing volume contents.

           It is not required that the volume set was previously used to  back  up  volumes  (was  used  as  the
           <b>-volumeset</b> option to the <b>backup</b> <b>dump</b> command). It can be defined especially to match the volumes that
           need  to  be  restored  with this command, and that is usually the better choice. Indeed, a <u>temporary</u>
           volume set, created by including the  <b>-temporary</b>  flag  to  the  <b>backup</b>  <b>addvolset</b>  command,  can  be
           especially  useful  in  this  context. A temporary volume set is not added to the Backup Database and
           exists only during the current interactive backup session, which is suitable if  the  volume  set  is
           needed only to complete the single restore operation initialized by this command.

           The  reason  that  a  specially  defined volume set is probably better is that volume sets previously
           defined for use in dump operations usually match the backup version of volumes, whereas for a restore
           operation it is best to define volume entries that match the base (read/write) name.  In  that  case,
           the  Backup  System  searches  the  Backup  Database for the newest dump set that includes either the
           read/write or the backup version of the volume. If, in contrast, a volume  entry  explicitly  matches
           the  volume's  backup  or  read-only version, the Backup System restores dumps of that volume version
           only.

       •   The <b>-file</b> argument names a file that lists specific volumes and the site to which  to  restore  each.
           The  volume name must match the name used in Backup Database dump records rather than in the VLDB, if
           they differ, because the Backup System does not look up volumes in the VLDB. The specified  site  can
           be  different  than  the  volume's  current  one; in that case, the Backup System removes the current
           version of the volume and updates the volume's location information in the VLDB.

       If all of the full and incremental dumps of all relevant volumes were not written to a type of tape  that
       a  single Tape Coordinator can read, use the <b>-portoffset</b> argument to list multiple port offset numbers in
       the order in which the tapes are needed (first list the port offset for the full dump,  second  the  port
       offset  for  the  level  1 incremental dump, and so on). This implies that the full dumps of all relevant
       volumes must have been written to a type of tape that the first Tape Coordinator can read,  the  level  1
       incremental  dumps  to  a  type  of tape the second Tape Coordinator can read, and so on. If dumps are on
       multiple incompatible tape types, use the <b>backup</b> <b>volrestore</b> command to restore individual volumes, or use
       this command after defining new volume sets that group together volumes that were  dumped  to  compatible
       tape types. For further discussion, see the <u>OpenAFS</u> <u>Administration</u> <u>Guide</u>.

       By  default,  the  Backup System overwrites the contents of an existing volume with the restored data. To
       create a new volume to house the restored version instead, use the <b>-extension</b> argument. The Backup System
       derives the new volume's name by adding the specified extension to the read/write base name, and  creates
       a  new  VLDB entry. The command does not affect the existing volume in any way. However, if a volume with
       the specified extension also already exists, the command overwrites it.

       The <b>-dryrun</b> flag produces a list of the volumes to be restored if the <b>-dryrun</b>  flag  were  not  included,
       without  actually  restoring  any  volumes.   See  "OUTPUT" for a detailed description of the output, and
       suggestions on how to combine it most effectively with the <b>-file</b> and <b>-name</b> arguments.

       The execution time for a <b>backup</b> <b>volsetrestore</b> command depends on the number of volumes to be restored and
       the amount of data in them, but it can take hours to restore a large number of volumes. One way to reduce
       the time is to run multiple instances of the command simultaneously, either using the <b>-name</b>  argument  to
       specify  disjoint  volume  sets for each command, or the <b>-file</b> argument to name files that list different
       volumes. This is possible if there are multiple available Tape Coordinators that can  read  the  required
       tapes.  Depending  on how the volumes to be restored were dumped to tape, specifying disjoint volume sets
       can also reduce the number of tape changes required.

       The Tape Coordinator's default response to this command is to access the first tape it needs by  invoking
       the  "MOUNT"  instruction  in the local <u>/var/lib/openafs/backup/CFG_device_name</u> file, or by prompting the
       backup operator to insert the tape if there is no "MOUNT" instruction. However,  if  the  "AUTOQUERY  NO"
       instruction  appears  in  the  <u>CFG_device_name</u>  file,  or  if the issuer of the <b>butc</b> command included the
       <b>-noautoquery</b> flag, the Tape Coordinator instead expects the tape to be in the device already.  If  it  is
       not,  or is the wrong tape, the Tape Coordinator invokes the "MOUNT" instruction or prompts the operator.
       It also invokes the "MOUNT" instruction or prompts for  any  additional  tapes  needed  to  complete  the
       restore operation; the backup operator must arrange to provide them.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-name</b> &lt;<u>volume</u> <u>set</u> <u>name</u>&gt;
           Names  a volume set to restore. The Backup System restores all of the volumes listed in the VLDB that
           match the volume set's volume entries. Provide this argument or the <b>-file</b> argument, but not both.

       <b>-file</b> &lt;<u>file</u> <u>name</u>&gt;
           Specifies the full pathname of a file that lists one or  more  volumes  and  the  site  (file  server
           machine and partition) to which to restore each.  Use either this argument or the <b>-name</b> argument, but
           not both.

           Each  volume's  entry  must  appear  on  its  own (unbroken) line in the file, and have the following
           format:

               &lt;machine&gt; &lt;partition&gt; &lt;volume&gt; [&lt;comments&gt; ...]

           where

           &lt;machine&gt;
               Names the file server machine to which to restore the volume.

           &lt;partition&gt;
               Names the partition to which to restore the volume.

           &lt;volume&gt;
               Names the volume to restore. It is generally best to specify the base (read/write) name  of  each
               volume. In this case, the Backup System searches the Backup Database for the newest dump set that
               includes  a  dump  of  either the read/write or the backup version of the volume. It restores the
               dumps of that version of the volume, starting with the most recent full dump.  If,  in  contrast,
               the  name  explicitly includes the ".backup" or ".readonly" extension, the Backup System restores
               dumps of that volume version only.

           &lt;comments&gt; ...
               Is any other text. The Backup System ignores any text on each line that appears after the  volume
               name, so this field can be used for notes helpful to the backup operator or other administrator.

           Do  not  use  wildcards  (for example, ".*") in the &lt;machine&gt;, &lt;partition&gt;, or &lt;volume&gt; fields. It is
           acceptable for multiple lines in the file to name the same volume, but the  Backup  System  processes
           only the first of them.

       <b>-extension</b> &lt;<u>new</u> <u>volume</u> <u>name</u> <u>extension</u>&gt;
           Creates  a new volume for each volume specified by the <b>-name</b> or <b>-file</b> argument, to house the restored
           data from that volume.  The Backup System derives the new volume's name by  appending  the  specified
           string to the read/write base name, and creates a new VLDB volume entry. It preserves the contents of
           each  existing  volume.  Any  string  other  than  ".readonly"  or  ".backup"  is acceptable, but the
           combination of the base name and extension cannot exceed 22 characters in length. To use a period  to
           separate  the extension from the name, specify it as the first character of the string (as in ".rst",
           for example).

       <b>-portoffset</b> &lt;<u>TC</u> <u>port</u> <u>offset</u>&gt;+
           Specifies one or more port offset numbers (up to a maximum of 128),  each  corresponding  to  a  Tape
           Coordinator  to  use  in  the  operation. If there is more than one value, the Backup System uses the
           first one when restoring the full dump of each volume, the second one  when  restoring  the  level  1
           incremental  dump of each volume, and so on. It uses the final value in the list when restoring dumps
           at the corresponding depth in the dump hierarchy and all dumps at lower levels.

           Provide this argument unless the default value of 0 (zero) is appropriate for all dumps. If 0 is just
           one of the values in the list, provide it explicitly in the appropriate order.

       <b>-dryrun</b> | <b>-n</b>
           Displays a list of the volumes to be restored  if  the  flag  were  not  included,  without  actually
           restoring them. "OUTPUT" details the format of the output. When combined with the <b>-name</b> argument, its
           output  is  easily edited for use as input to the <b>-file</b> argument on a subsequent <b>backup</b> <b>volsetrestore</b>
           command.

       <b>-localauth</b>
           Constructs a server ticket using a key from the local <u>/etc/openafs/server/KeyFile</u>  file.  The  <b>backup</b>
           command  interpreter  presents  it  to  the  Backup Server, Volume Server and VL Server during mutual
           authentication. Do not combine this flag with the <b>-cell</b> argument. For more details, see <b><a href="../man8/backup.8.html">backup</a></b>(8).

       <b>-cell</b> &lt;<u>cell</u> <u>name</u>&gt;
           Names the cell in which to run the command. Do not combine this argument with  the  <b>-localauth</b>  flag.
           For more details, see <b><a href="../man8/backup.8.html">backup</a></b>(8).

       <b>-help</b>
           Prints the online help for this command. All other valid options are ignored.

</pre><h4><b>OUTPUT</b></h4><pre>
       If  the  <b>-dryrun</b> flag is not provided, the command displays a unique task ID number for the operation, in
       two places:

       •   In the shell window, directly following the command line.

       •   In the Tape Coordinator window, if the butc process was started at debug level 1.

       The task ID number is not the same as the job ID number displayed by the <b>backup</b>  <b>jobs</b>  command  when  the
       <b>backup</b> <b>volsetrestore</b> command is issued in interactive mode. The Backup System does not assign either type
       of ID number until the restoration process actually begins.

       When  the  <b>-dryrun</b> flag is included, no task ID or job ID numbers are reported because none are assigned.
       Instead, the output begins with a count of the number of volumes to be restored, followed by a  line  for
       each  dump  of  a volume. For each volume, the line representing the most recent full dump appears first,
       and lines for any subsequent incremental dumps follow, ordered by dump  level.  The  lines  for  a  given
       volume do not necessarily appear all together, however.

       The  format  of  each  line  is  as  follows  (the  output is shown here on two lines only for legibility
       reasons):

          &lt;machine&gt; &lt;partition&gt; &lt;volume_dumped&gt; # as &lt;volume_restored&gt;; \
              &lt;tape_name&gt; (&lt;tape_ID&gt;); pos &lt;position_number&gt;; &lt;date&gt;

       where

       &lt;machine&gt;
           Names the file server machine that currently houses the volume, as listed in the VLDB.

       &lt;partition&gt;
           Names the partition that currently houses the volume, as listed in the VLDB.

       &lt;volume_dumped&gt;
           Specifies the version (read/write or backup) of the volume that was dumped, as listed in  the  Backup
           Database.

       &lt;volume_restored&gt;
           Specifies  the  name  under  which  to  restore  the  volume. The Backup System only restores data to
           read/write volumes. If the <b>-extension</b> argument is included, then the specified extension  appears  on
           the name in this field (for example, "user.pat.rst").

       &lt;tape_name&gt;
           Names  the  tape  containing  the  dump  of  the  volume, from the Backup Database. If the tape has a
           permanent name, it appears here; otherwise, it is the AFS tape name.

       &lt;tape_ID&gt;
           The tape ID of the tape containing the dump of the volume, from the Backup Database.

       &lt;position_number&gt;
           Specifies the dump's position on the tape (for example, 31 indicates that 30 volume dumps precede the
           current one on the tape). If the dump was written to a backup data file, this number is  the  ordinal
           of the 16 KB-offset at which the volume's data begins.

       &lt;date&gt;
           The date and time when the volume was dumped.

       One  way  to  generate  a file for use as input to the <b>-file</b> argument is to combine the <b>-name</b> and <b>-dryrun</b>
       options, directing the output to a file. The <u>OpenAFS</u> <u>Administration</u> <u>Guide</u> section  on  using  the  Backup
       System  to  restore data explains how to edit the file as necessary before using it as input to the <b>-file</b>
       argument.

       The output of this command includes only volumes for which the Backup Database includes at least one dump
       record. The command interpreter generates a message on the standard error stream about  volumes  that  do
       not  have  dump  records  but either are listed in the file named by the <b>-file</b> argument, or appear in the
       VLDB as a match to a volume entry in the volume set named by the <b>-name</b> argument.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following command restores all volumes included in entries in the volume  set  named  "data.restore",
       which  was  created  expressly  to  restore  data to a pair of file server machines on which all data was
       corrupted due to a software error. All volumes are restored to the sites recorded in their entries in the
       VLDB.

          % backup volsetrestore -name data.restore
          Starting restore
          backup: task ID of restore operation: 112
          backup: Finished doing restore

       The following command restores all volumes that have entries in the file named <u>/tmp/restore</u>:

          % backup volsetrestore -file /tmp/restore
          Starting restore
          backup: task ID of restore operation: 113
          backup: Finished doing restore

       The <u>/tmp/restore</u> file has the following contents:

          fs1.example.com b user.pat
          fs1.example.com b user.terry
          fs1.example.com b user.smith
          fs2.example.com c user.jones
                 .         .     .
                 .         .     .

</pre><h4><b>PRIVILEGE</b> <b>REQUIRED</b></h4><pre>
       The issuer must be listed in the <u>/etc/openafs/server/UserList</u> file on  every  machine  where  the  Backup
       Server  or  Volume  Location  (VL)  Server  is  running,  and on every file server machine that houses an
       affected volume. If the <b>-localauth</b> flag is included, the issuer must instead be logged  on  to  a  server
       machine as the local superuser "root".

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/butc.5.html">butc</a></b>(5),  <b><a href="../man8/backup.8.html">backup</a></b>(8),  <b><a href="../man8/backup_addvolentry.8.html">backup_addvolentry</a></b>(8),  <b><a href="../man8/backup_addvolset.8.html">backup_addvolset</a></b>(8), <b><a href="../man8/backup_diskrestore.8.html">backup_diskrestore</a></b>(8), <b><a href="../man8/backup_dump.8.html">backup_dump</a></b>(8),
       <b><a href="../man8/backup_volrestore.8.html">backup_volrestore</a></b>(8), <b><a href="../man8/butc.8.html">butc</a></b>(8)

</pre><h4><b>COPYRIGHT</b></h4><pre>
       IBM Corporation 2000. &lt;<a href="http://www.ibm.com/">http://www.ibm.com/</a>&gt; All Rights Reserved.

       This documentation is covered by the IBM Public License Version 1.0.  It was converted from HTML  to  POD
       by  software  written  by  Chas  Williams  and Russ Allbery, based on work by Alf Wachsmann and Elizabeth
       Cassell.

OpenAFS                                            2025-03-21                            <u><a href="../man8/BACKUP_VOLSETRESTORE.8.html">BACKUP_VOLSETRESTORE</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>