<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>salvager - Initializes the Salvager component of the fs process</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/openafs-fileserver">openafs-fileserver_1.8.13.2-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       salvager - Initializes the Salvager component of the fs process

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>salvager</b>
           [<u>initcmd</u>] [<b>-partition</b> &lt;<u>name</u> <u>of</u> <u>partition</u> <u>to</u> <u>salvage</u>&gt;]
           [<b>-volumeid</b> &lt;<u>volume</u> <u>id</u> <u>to</u> <u>salvage</u>&gt;] [<b>-debug</b>] [<b>-nowrite</b>]
           [<b>-inodes</b>] [<b>-force</b>] [<b>-oktozap</b>] [<b>-rootinodes</b>]
           [<b>-salvagedirs</b>] [<b>-blockreads</b>]
           [<b>-parallel</b> &lt;<u>#</u> <u>of</u> <u>max</u> <u>parallel</u> <u>partition</u> <u>salvaging</u>&gt;]
           [<b>-tmpdir</b> &lt;<u>name</u> <u>of</u> <u>dir</u> <u>to</u> <u>place</u> <u>tmp</u> <u>files</u>&gt;]
           [<b>-showlog</b>] [<b>-showsuid</b>] [<b>-showmounts</b>]
           [<b>-orphans</b> (ignore | remove | attach)] [<b>-help</b>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>salvager</b> command initializes the Salvager component of the "fs" process. In the conventional
       configuration, its binary file is located in the <u>/usr/lib/openafs</u> directory on a file server machine.

       The Salvager restores internal consistency to corrupted read/write volumes on the local file server
       machine where possible. For read-only or backup volumes, it inspects only the volume header:

       •   If the volume header is corrupted, the Salvager removes the volume completely and records the removal
           in  its  log file, <u>/var/log/openafs/SalvageLog</u>. Issue the <b>vos</b> <b>release</b> or <b>vos</b> <b>backup</b> command to create
           the read-only or backup volume again.

       •   If the volume header is intact, the Salvager skips the volume (does not check for corruption  in  the
           contents).  However, if the File Server notices corruption as it initializes, it sometimes refuses to
           attach the volume or bring it online. In this case, it is simplest to remove the  volume  by  issuing
           the  <b>vos</b>  <b>remove</b>  or  <b>vos</b>  <b>zap</b> command. Then issue the <b>vos</b> <b>release</b> or <b>vos</b> <b>backup</b> command to create it
           again.

       Unlike other server process initialization commands, the Salvager command is designed to be issued at the
       command shell prompt, as well as being placed into a file server  machine's  <u>/etc/openafs/BosConfig</u>  file
       with  the  <b>bos</b>  <b>create</b>  command.  It  is also possible to invoke the Salvager remotely by issuing the <b>bos</b>
       <b>salvage</b> command.

       Combine the command's options as indicated to salvage different numbers of read/write volumes:

       •   To salvage all volumes on the file server machine, provide no arguments.  No volumes on  the  machine
           are accessible to Cache Managers during the salvage, because the BOS Server stops the File Server and
           Volume Server processes while the Salvager runs.

       •   To  salvage all of the volumes on one partition, provide the <b>-partition</b> argument. As for a salvage of
           all volumes on the machine, no volumes on the machine are accessible to  Cache  Managers  during  the
           salvage operation.

       •   To  salvage  only  one  volume,  combine  the <b>-partition</b> and <b>-volumeid</b> arguments. Only that volume is
           inaccessible to Cache Managers, because the BOS Server does not shutdown the File Server  and  Volume
           Server processes.

       The Salvager normally salvages only those read/write volumes that are marked as having been active when a
       crash occurred. To have it salvage all relevant read/write volumes, add the <b>-force</b> flag.

       The  Salvager normally creates new inodes as it repairs damage. If the partition is so full that there is
       no room for new inodes, use the <b>-nowrite</b> argument to bringing undamaged volumes online without attempting
       to salvage damaged volumes. Then use the <b>vos</b> <b>move</b> command to move one or more of the undamaged volumes to
       other partitions, freeing up the space that the Salvager needs to create new inodes.

       By default, multiple Salvager subprocesses run in parallel: one for each partition up to four,  and  four
       subprocesses  for  four or more partitions. To increase or decrease the number of subprocesses running in
       parallel, provide a positive integer value for the <b>-parallel</b> argument.

       If there is more than one server partition on a physical disk, the  Salvager  by  default  salvages  them
       serially  to  avoid  the  inefficiency  of constantly moving the disk head from one partition to another.
       However, this strategy is often not ideal if the partitions are configured as logical volumes  that  span
       multiple  disks. To force the Salvager to salvage logical volumes in parallel as if they were on separate
       disks, provide the string "all" as the value for the <b>-parallel</b> argument.

       To set both parameters at the same time, append the number of Salvager processes to the string "all". For
       example, "-parallel all5" treats each partition as a separate disk and runs five Salvager processes, thus
       salvaging five partitions at a time.

       The Salvager creates temporary files as it  runs,  by  default  writing  them  to  the  partition  it  is
       salvaging.  The number of files can be quite large, and if the partition is too full to accommodate them,
       the Salvager terminates without completing the salvage operation (it always removes the  temporary  files
       before  exiting).  Other  Salvager  subprocesses  running  at  the  same  time continue until they finish
       salvaging all other partitions where there is enough disk space for  temporary  files.  To  complete  the
       interrupted  salvage, reissue the command against the appropriate partitions, adding the <b>-tmpdir</b> argument
       to redirect the temporary files to a local disk directory that has enough space.

       The <b>-orphans</b> argument controls how the Salvager handles orphaned files and directories that it  finds  on
       server  partitions  it  is  salvaging.  An  <u>orphaned</u> element is completely inaccessible because it is not
       referenced by the vnode of any directory that can act  as  its  parent  (is  higher  in  the  filespace).
       Orphaned objects occupy space on the server partition, but do not count against the volume's quota.

       To generate a list of all mount points that reside in one or more volumes, rather than actually salvaging
       them, include the <b>-showmounts</b> flag.

       This  command does not use the syntax conventions of the AFS command suites. Provide the command name and
       all option names in full.

</pre><h4><b>OPTIONS</b></h4><pre>
       [<u>initcmd</u>]
           Accommodates the command's use of the AFS command parser, and is optional.

       <b>-partition</b> &lt;<u>name</u> <u>of</u> <u>partition</u> <u>to</u> <u>salvage</u>&gt;
           Specifies the name of the partition to salvage. Specify  the  full  partition  name  using  the  form
           <u>/vicepx</u> or <u>/vicepxx</u>. Omit this argument to salvage every partition on the file server machine.

       <b>-volumeid</b> &lt;<u>volume</u> <u>id</u> <u>to</u> <u>salvage</u>&gt;
           Specifies  the volume ID of a specific read/write volume to salvage.  The <b>-partition</b> argument must be
           provided along with this one and specify the volume's actual site.

       <b>-debug</b>
           Allows only one Salvager subprocess to run at a time, regardless of  the  setting  of  the  <b>-parallel</b>
           option. Include it when running the Salvager in a debugger to make the trace easier to interpret.

       <b>-nowrite</b>
           Brings all undamaged volumes online without attempting to salvage any damaged volumes.

       <b>-inodes</b>
           Records in the <u>/var/log/openafs/SalvageLog</u> file a list of all AFS inodes that the Salvager modified.

       <b>-force</b>
           Inspects  all  volumes  for  corruption,  not just those that are marked as having been active when a
           crash occurred.

       <b>-oktozap</b>
           Removes a volume that is so damaged that even issuing the <b>vos</b> <b>zap</b> command with  the  <b>-force</b>  flag  is
           ineffective. Combine it with the <b>-partition</b> and <b>-volumeid</b> arguments to identify the volume to remove.
           Using  this  flag  will  destroy  data  that cannot be read, so use only with caution and when you're
           certain that nothing in that volume is still needed.

       <b>-rootinodes</b>
           Records in the <u>/var/log/openafs/SalvageLog</u> file a list of all AFS inodes owned by the local superuser
           "root".

       <b>-salvagedirs</b>
           Salvages entire directory structures, even if they do not appear  to  be  damaged.  By  default,  the
           Salvager salvages a directory only if it is flagged as corrupted.

       <b>-blockreads</b>
           Forces  the  Salvager to read a partition one disk block (512 bytes) at a time and to skip any blocks
           that are too badly damaged to be salvaged.  This allows it to salvage as many volumes as possible. By
           default, the Salvager reads large disk  blocks,  which  can  cause  it  to  exit  prematurely  if  it
           encounters disk errors. Use this flag if the partition to be salvaged has disk errors.

       <b>-parallel</b> &lt;<u>#</u> <u>of</u> <u>max</u> <u>parallel</u> <u>partition</u> <u>salvaging</u>&gt;
           Specifies  the  maximum  number  of  Salvager  subprocesses to run in parallel.  Provide one of three
           values:

           •   An integer from the range 1 to 32. A value of 1 means that a single Salvager process salvages the
               partitions sequentially.

           •   The string "all" to run up to four Salvager subprocesses in parallel on partitions  formatted  as
               logical volumes that span multiple physical disks. Use this value only with such logical volumes.

           •   The  string "all" followed immediately (with no intervening space) by an integer from the range 1
               to 32, to run the specified number of Salvager subprocesses in parallel on  partitions  formatted
               as logical volumes. Use this value only with such logical volumes.

           The  BOS  Server never starts more Salvager subprocesses than there are partitions, and always starts
           only one process to salvage a single volume. If  this  argument  is  omitted,  up  to  four  Salvager
           subprocesses run in parallel but partitions on the same device are salvaged serially.

       <b>-tmpdir</b> &lt;<u>name</u> <u>of</u> <u>dir</u> <u>to</u> <u>place</u> <u>tmp</u> <u>files</u>&gt;
           Names  a  local  disk  directory in which the Salvager places the temporary files it creates during a
           salvage operation, instead of writing them to the partition being  salvaged  (the  default).  If  the
           Salvager  cannot  write  to  the  specified  directory,  it  attempts to write to the partition being
           salvaged.

       <b>-showlog</b>
           Displays  on  the  standard  output  stream  all  log   data   that   is   being   written   to   the
           <u>/var/log/openafs/SalvageLog</u> file.

       <b>-showsuid</b>
           Displays a list of the pathnames for all files that have the setuid or setgid mode bit set.

       <b>-showmounts</b>
           Records  in  the <u>/var/log/openafs/SalvageLog</u> file all mount points found in each volume. The Salvager
           does not repair corruption in the volumes, if any exists.

       <b>-orphans</b> (ignore | remove | attach)
           Controls how the Salvager handles orphaned files and directories.  Choose one of the following  three
           values:

           ignore
               Leaves  the orphaned objects on the disk, but prints a message to the <u>/var/log/openafs/SalvageLog</u>
               file reporting how many orphans were found and the  approximate  number  of  kilobytes  they  are
               consuming. This is the default if the <b>-orphans</b> argument is omitted.

           remove
               Removes  the  orphaned  objects,  and  prints  a  message to the <u>/var/log/openafs/SalvageLog</u> file
               reporting how many orphans were removed  and  the  approximate  number  of  kilobytes  they  were
               consuming.

           attach
               Attaches  the  orphaned objects by creating a reference to them in the vnode of the volume's root
               directory. Since each object's actual name is now lost, the Salvager assigns each one a  name  of
               the following form:

               "__ORPHANFILE__.<u>index</u>" for files.
               "__ORPHANDIR__.<u>index</u>" for directories.

               where  <u>index</u>  is a two-digit number that uniquely identifies each object. The orphans are charged
               against the volume's quota and appear in the output of the <b>ls</b> command issued against the volume's
               root directory.

       <b>-help</b>
           Prints the online help for this command. All other valid options are ignored.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following command instructs the Salvager to attempt to salvage the volume with volume ID 258347486 on
       <u>/vicepg</u> on the local machine.

          % /usr/lib/openafs/salvager -partition /vicepg -volumeid 258347486

</pre><h4><b>PRIVILEGE</b> <b>REQUIRED</b></h4><pre>
       To issue the command at the shell prompt, the issuer must be logged in as the local superuser "root".

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/BosConfig.5.html">BosConfig</a></b>(5), <b><a href="../man5/SalvageLog.5.html">SalvageLog</a></b>(5), <b><a href="../man8/bos_create.8.html">bos_create</a></b>(8), <b><a href="../man8/bos_getlog.8.html">bos_getlog</a></b>(8), <b><a href="../man8/bos_salvage.8.html">bos_salvage</a></b>(8), <b><a href="../man1/vos_move.1.html">vos_move</a></b>(1)

</pre><h4><b>COPYRIGHT</b></h4><pre>
       IBM Corporation 2000. &lt;<a href="http://www.ibm.com/">http://www.ibm.com/</a>&gt; All Rights Reserved.

       This documentation is covered by the IBM Public License Version 1.0.  It was converted from HTML  to  POD
       by  software  written  by  Chas  Williams  and Russ Allbery, based on work by Alf Wachsmann and Elizabeth
       Cassell.

OpenAFS                                            2025-03-21                                        <u><a href="../man8/SALVAGER.8.html">SALVAGER</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>