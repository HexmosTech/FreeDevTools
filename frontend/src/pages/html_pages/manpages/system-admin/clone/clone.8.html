<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clone - Clone an UPS, treating its outlet as if it were an UPS (with shutdown INSTCMD support)</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/nut-server">nut-server_2.8.3-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       clone - Clone an UPS, treating its outlet as if it were an UPS (with shutdown INSTCMD support)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>clone</b> -h

       <b>clone</b> -a <u>UPS_NAME</u> [<u>OPTIONS</u>]

           <b>Note</b>

           This man page only documents the specific features of the clone driver. For information about the
           core driver, see <b><a href="../man8/nutupsdrv.8.html">nutupsdrv</a></b>(8).

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This driver, which sits on top of another driver’s local UNIX socket file (or Windows named pipe), allows
       users to group clients to a particular outlet of a device and deal with this output as if it were a
       normal UPS.

       Unlike the <b><a href="../man8/clone-outlet.8.html">clone-outlet</a></b>(8) driver, this driver represents a manageable device that can be used both for
       monitoring and for client computer and UPS/ePDU outlet shutdowns (it supports sending relevant instant
       commands during run time).

       Unlike <b><a href="../man8/dummy-ups.8.html">dummy-ups</a></b>(8), this driver does not require a running upsd data server nor use the networked NUT
       protocol to talk to the "real" driver (which may be remote in case of dummy-ups repeater mode).

       This driver does not create a completely new virtual device, but replaces or extends some of the original
       readings reported by the "real" driver using information from the specified outlet, and relays all other
       readings as they were.

       Remote clients like upsmon can MONITOR the device entry presented by the data server with this driver
       (and the "real" driver) running and published.

       A larger deployment with one or more lower-priority devices collected on a manageable outlet of an UPS or
       ePDU would likely see several drivers set up on the system actually capable of interactions with the UPS
       and running the NUT data server <b><a href="../man8/upsd.8.html">upsd</a></b>(8) (and likely powered by another outlet):

       •   a "real" driver talking to the UPS;

       •   a clone driver talking to the "real" driver and issuing outlet power-off (or power-cycle) based on
           relatively high thresholds for remaining battery charge and/or runtime of the actual UPS (or explicit
           instant commands), with such operations first setting the respective timers for the outlet on the
           "real" driver, and the "FSD" flag among states of the virtual UPS status;

       •   possibly a clone-outlet driver which is read-only and interprets the outlet timer values as triggers
           for "FSD" or "OFF" flags reported among states of the virtual UPS status.

       With this approach, the lower-priority systems collected on such outlet would run the NUT <b><a href="../man8/upsmon.8.html">upsmon</a></b>(8)
       client to MONITOR the virtual UPS presented by the read-only clone-outlet driver and shut down as soon as
       the "FSD" flag is raised (fairly early, based on charge and/or runtime thresholds configured for that
       driver) allowing the higher-priority devices (likely including the NUT server) to enjoy a longer
       on-battery life.

       The clone driver responsible for outlet power state changes would not normally be monitored directly
       (e.g. to avoid unfortunate direct shutdown requests from those clients), although it can be (instead of
       clone-outlet) in sufficiently trusted networks.

</pre><h4><b>EXTRA</b> <b>ARGUMENTS</b></h4><pre>
       This driver supports the following settings:

       <b>port</b>=<u>drivername-devicename</u>
           Required. The standard NUT driver port setting, here it provides the name of the local Unix socket
           file (or Windows named pipe) for connection to the "real" device driver.

       <b>load.off</b>=<u>command</u>
           Recommended. Set the command on the "real" UPS driver that will be used to switch off the outlet. You
           need both <b>load.off</b> and <b>load.on</b> in order to power cycle the outlet. Otherwise, shutting down the
           clients powered by an outlet is a one way street (see IMPORTANT).

       <b>load.on</b>=<u>command</u>
           Recommended. Set the command on the "real" UPS driver that will be used to switch on the outlet. You
           need both <b>load.off</b> and <b>load.on</b> in order to power cycle the outlet. Otherwise, shutting down the
           clients powered by an outlet is a one way street (see IMPORTANT).

       <b>load.status</b>=<u>value</u>
           Recommended. Set the variable on the "real" UPS driver that will be used to indicate the outlet
           status (i.e. on/off). If not specified, the clone driver will attempt to keep track of the outlet
           status, but this is less reliable.

       <b>offdelay</b>=<u>num</u>
           Set the timer (in seconds) before the outlet is turned off after the shutdown condition (OB LB) for
           this outlet is met or a command to shutdown was issued. Defaults to 120 seconds.

       <b>ondelay</b>=<u>num</u>
           Set the timer (in seconds) for the outlet to switch on in case the power returns after the outlet has
           been switched off. Defaults to 30 seconds.

       <b>mincharge</b>=<u>value</u>
           Set the remaining battery level when the clone UPS switches to LB (percent).

       <b>minruntime</b>=<u>value</u>
           Set the remaining battery runtime when the clone UPS switches to LB (seconds).

</pre><h4><b>IMPLEMENTATION</b></h4><pre>
       The port specification in the <b><a href="../man5/ups.conf.5.html">ups.conf</a></b>(5) should reference the local driver socket (or Windows named
       pipe) that the "real" UPS driver is using. For example:

             [realups]
                driver = usbhid-ups
                port = auto

             [clone-outlet-1]
                driver = clone
                port = usbhid-ups-realups
                load.on = outlet.1.load.on
                load.off = outlet.1.load.off
                load.status = outlet.1.status
                desc = "Outlet 1 of the Real UPS"
                [...]

       This driver supports instant commands to initiate a forced shutdown for upsmon or similar clients which
       MONITOR this virtual UPS device, if the outlet status is currently <u>on</u> and no other shutdown was initiated
       yet (setting the virtual UPS shutdown delay timer to offdelay and issuing an FSD via ups.status):

       •   shutdown.return — power the outlet back on after ondelay;

       •   shutdown.stayoff — keep the outlet <u>off</u>.

       Such commands are propagated to the "real" driver using the NUT socket protocol (using command names
       specified in the load.off and load.on driver configuration options), if the shutdown or start timers are
       set at the moment, or if the "real" device is not "online" and its known battery charge or runtime are
       below the configured "low" thresholds.

       The outlet status is determined using the name specified by the load.status driver option if set, or is
       just assumed by latest completed shutdown/start operation (using unknown outlet number).

       The driver does not support a common NUT device shutdown operation as such (clone -k just prints an error
       and bails out).

       This driver also supports setting certain NUT variables at run-time:

       •   battery.charge.low — see mincharge in driver options;

       •   battery.runtime.low — see minruntime in driver options.

       Compared to the "real" driver’s readings, this driver also adds (or overrides) the following data points:
       ups.delay.shutdown, ups.delay.start, ups.timer.shutdown and ups.timer.start. It keeps track of "real"
       driver’s values of battery.charge and battery.runtime (actual current readings) to decide on automated
       outlet shutdown later on.

</pre><h4><b>IMPORTANT</b></h4><pre>
       Unlike a real UPS, you should <b>not</b> configure a upsmon primary mode for this driver. When a <b><a href="../man8/upsmon.8.html">upsmon</a></b>(8)
       primary sees the OB LB flags and tells the <b><a href="../man8/upsd.8.html">upsd</a></b>(8) data server that it is OK to initiate the shutdown
       sequence, the server will latch the FSD status, and it will not be possible to restart the systems
       connected without restarting the upsd server.

       This will be a problem if the power returns after the clone UPS initiated the shutdown sequence on its
       outlet, but returns before the real UPS begins shutting down. The solution is in the clone driver itself,
       that will insert the FSD flag if needed without the help of an upsmon primary.

</pre><h4><b>CAVEATS</b></h4><pre>
       The clone UPS will follow the status on the real UPS driver. You can only make the clone UPS shutdown
       earlier than the real UPS driver, not later. If the real UPS driver initiates a shutdown, the clone UPS
       driver will immediately follow.

       Be aware that the commands to shutdown/restart an outlet on the real UPS drivers are not affected, so if
       you tell the real UPS driver to shutdown the outlet of the clone UPS driver, your clients will lose power
       without warning.

       If you use service management frameworks like systemd or SMF to manage the dependencies between driver
       instances and other units, then you may have to set up special dependencies (e.g. with systemd "drop-in"
       snippet files) to queue your clone drivers to start after the "real" device drivers.

</pre><h4><b>AUTHOR</b></h4><pre>
       Arjen de Korte &lt;<a href="mailto:adkorte-guest@alioth.debian.org">adkorte-guest@alioth.debian.org</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/upscmd.1.html">upscmd</a></b>(1), <b><a href="../man1/upsrw.1.html">upsrw</a></b>(1), <b><a href="../man5/ups.conf.5.html">ups.conf</a></b>(5), <b><a href="../man8/clone-outlet.8.html">clone-outlet</a></b>(8), <b><a href="../man8/nutupsdrv.8.html">nutupsdrv</a></b>(8)

   <b>Dummy</b> <b>driver:</b>
       The "repeater" mode of <u>dummy-ups</u> driver is in some ways similar to the <u>clone</u> and <u>clone-outlet</u> drivers, by
       relaying information from a locally or remotely running "real" device driver (and NUT data server).

       <b><a href="../man8/dummy-ups.8.html">dummy-ups</a></b>(8)

   <b>Internet</b> <b>Resources:</b>
       The NUT (Network UPS Tools) home page: https://www.networkupstools.org/historic/v2.8.3/

Network UPS Tools 2.8.3                            07/08/2025                                           <u><a href="../man8/CLONE.8.html">CLONE</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>