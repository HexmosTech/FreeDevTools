<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>qemu-nbd - QEMU Disk Network Block Device Server</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/qemu-utils">qemu-utils_10.0.2+ds-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       qemu-nbd - QEMU Disk Network Block Device Server

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>qemu-nbd</b> [<u>OPTION</u>]... <u>filename</u>

       <b>qemu-nbd</b> -L [<u>OPTION</u>]...

       <b>qemu-nbd</b> -d <u>dev</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Export a QEMU disk image using the NBD protocol.

       Other uses:

       • Bind a /dev/nbdX block device to a QEMU server (on Linux).

       • As a client to query exports of a remote NBD server.

</pre><h4><b>OPTIONS</b></h4><pre>
       <u>filename</u> is a disk image filename, or a set of block driver options if <u>--image-opts</u> is specified.

       <u>dev</u> is an NBD device.

       <b>--object</b> <b>type,id=ID,...</b>
              Define  a new instance of the <u>type</u> object class identified by <u>ID</u>.  See the <b><a href="../man1/qemu.1.html">qemu</a>(1)</b> manual page for
              full details of the properties supported. The common object types that it makes  sense  to  define
              are the <b>secret</b> object, which is used to supply passwords and/or encryption keys, and the <b>tls-creds</b>
              object, which is used to supply TLS credentials for the <b>qemu-nbd</b> server or client.

       <b>-p,</b> <b>--port=PORT</b>
              TCP port to listen on as a server, or connect to as a client (default <b>10809</b>).

       <b>-o,</b> <b>--offset=OFFSET</b>
              The offset into the image.

       <b>-b,</b> <b>--bind=IFACE</b>
              The interface to bind to as a server, or connect to as a client (default <b>0.0.0.0</b>).

       <b>-k,</b> <b>--socket=PATH</b>
              Use a unix socket with path <u>PATH</u>.

       <b>--image-opts</b>
              Treat  <u>filename</u> as a set of image options, instead of a plain filename. If this flag is specified,
              the <b>-f</b> flag should not be used, instead the <b>format=</b> option should be set.

       <b>-f,</b> <b>--format=FMT</b>
              Force the use of the block driver for format <u>FMT</u> instead of auto-detecting.

       <b>-r,</b> <b>--read-only</b>
              Export the disk as read-only.

       <b>-A,</b> <b>--allocation-depth</b>
              Expose allocation depth information via  the  <b>qemu:allocation-depth</b>  metadata  context  accessible
              through NBD_OPT_SET_META_CONTEXT.

       <b>-B,</b> <b>--bitmap=NAME</b>
              If  <u>filename</u> has a qcow2 persistent bitmap <u>NAME</u>, expose that bitmap via the <b>qemu:dirty-bitmap:NAME</b>
              metadata context accessible through NBD_OPT_SET_META_CONTEXT.

       <b>-s,</b> <b>--snapshot</b>
              Use <u>filename</u> as an external snapshot, create a temporary file with <b>backing_file=</b><u>filename</u>, redirect
              the write to the temporary one.

       <b>-l,</b> <b>--load-snapshot=SNAPSHOT_PARAM</b>
              Load an internal snapshot inside <u>filename</u> and export it as  an  read-only  device,  SNAPSHOT_PARAM
              format is <b>snapshot.id=[ID],snapshot.name=[NAME]</b> or <b>[ID_OR_NAME]</b>

       <b>--cache=CACHE</b>
              The  cache  mode  to  be  used  with  the  file.  Valid values are: <b>none</b>, <b>writeback</b> (the default),
              <b>writethrough</b>, <b>directsync</b> and <b>unsafe</b>. See the documentation  of  the  emulator's  <b>-drive</b>  <b>cache=...</b>
              option for more info.

       <b>-n,</b> <b>--nocache</b>
              Equivalent to <u>--cache=none</u>.

       <b>--aio=AIO</b>
              Set  the  asynchronous  I/O  mode between <b>threads</b> (the default), <b>native</b> (Linux only), and <b>io_uring</b>
              (Linux 5.1+).

       <b>--discard=DISCARD</b>
              Control whether <b>discard</b> (also known as <b>trim</b> or <b>unmap</b>)  requests  are  ignored  or  passed  to  the
              filesystem. <u>DISCARD</u> is one of <b>ignore</b> (or <b>off</b>), <b>unmap</b> (or <b>on</b>).  The default is <b>ignore</b>.

       <b>--detect-zeroes=DETECT_ZEROES</b>
              Control  the automatic conversion of plain zero writes by the OS to driver-specific optimized zero
              write commands.  <u>DETECT_ZEROES</u> is one of <b>off</b>, <b>on</b>, or <b>unmap</b>.  <b>unmap</b> converts a  zero  write  to  an
              unmap operation and can only be used if <u>DISCARD</u> is set to <b>unmap</b>.  The default is <b>off</b>.

       <b>-c,</b> <b>--connect=DEV</b>
              Connect <u>filename</u> to NBD device <u>DEV</u> (Linux only).

       <b>-d,</b> <b>--disconnect</b>
              Disconnect the device <u>DEV</u> (Linux only).

       <b>-e,</b> <b>--shared=NUM</b>
              Allow up to <u>NUM</u> clients to share the device (default <b>1</b>), 0 for unlimited.

       <b>-t,</b> <b>--persistent</b>
              Don't exit on the last connection.

       <b>-x,</b> <b>--export-name=NAME</b>
              Set the NBD volume export name (default of a zero-length string).

       <b>-D,</b> <b>--description=DESCRIPTION</b>
              Set the NBD volume export description, as a human-readable string.

       <b>--handshake-limit=N</b>
              Set  the timeout for a client to successfully complete its handshake to N seconds (default 10), or
              0 for no limit.

       <b>-L,</b> <b>--list</b>
              Connect as a client and list all details about the exports exposed by a remote NBD  server.   This
              enables  list  mode,  and  is incompatible with options that change behavior related to a specific
              export (such as <u>--export-name</u>, <u>--offset</u>, ...).

       <b>--tls-creds=ID</b>
              Enable mandatory TLS encryption for the server by setting the ID of  the  TLS  credentials  object
              previously created with the <u>--object</u> option; or provide the credentials needed for connecting as a
              client in list mode.

       <b>--tls-hostname=hostname</b>
              When  validating  an  x509  certificate  received over a TLS connection, the hostname that the NBD
              client used to connect will be checked against information in  the  server  provided  certificate.
              Sometimes  it  might be required to override the hostname used to perform this check. For example,
              if the NBD client is using  a  tunnel  from  localhost  to  connect  to  the  remote  server,  the
              <u>--tls-hostname</u>  option  should  be  used to set the officially expected hostname of the remote NBD
              server. This can also be used if accessing NBD over a UNIX  socket  where  there  is  no  inherent
              hostname available. This is only permitted when acting as a NBD client with the <u>--list</u> option.

       <b>--fork</b> Fork off the server process and exit the parent once the server is running.

       <b>--pid-file=PATH</b>
              Store the server's process ID in the given file.

       <b>--tls-authz=ID</b>
              Specify  the  ID of a qauthz object previously created with the <u>--object</u> option. This will be used
              to authorize connecting users against their x509 distinguished name.

       <b>-v,</b> <b>--verbose</b>
              Display extra debugging information. This option also keeps the original <u>STDERR</u> stream open if the
              <b>qemu-nbd</b> process is daemonized due to other options like <u>--fork</u> or <u>-c</u>.

       <b>-h,</b> <b>--help</b>
              Display this help and exit.

       <b>-V,</b> <b>--version</b>
              Display version information and exit.

       <b>-T,</b> <b>--trace</b> <b>[[enable=]PATTERN][,events=FILE][,file=FILE]</b>
              Specify tracing options.

              <b>[enable=]PATTERN</b>
                 Immediately enable events matching <u>PATTERN</u> (either event name or  a  globbing  pattern).   This
                 option  is  only  available  if  QEMU  has been compiled with the <b>simple</b>, <b>log</b> or <b>ftrace</b> tracing
                 backend.  To specify multiple events or patterns, specify the <b>-trace</b> option multiple times.

                 Use <b>-trace</b> <b>help</b> to print a list of names of trace points.

              <b>events=FILE</b>
                 Immediately enable events listed in <u>FILE</u>.  The file must contain one event name (as  listed  in
                 the  <b>trace-events-all</b>  file) per line; globbing patterns are accepted too.  This option is only
                 available if QEMU has been compiled with the <b>simple</b>, <b>log</b> or <b>ftrace</b> tracing backend.

              <b>file=FILE</b>
                 Log output traces to <u>FILE</u>.  This option is only available if QEMU has been  compiled  with  the
                 <b>simple</b> tracing backend.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Start a server listening on port 10809 that exposes only the guest-visible contents of a qcow2 file, with
       no  TLS encryption, and with the default export name (an empty string). The command is one-shot, and will
       block until the first successful client disconnects:

          qemu-nbd -f qcow2 file.qcow2

       Start a long-running server listening with encryption on port 10810, and allow clients  with  a  specific
       X.509 certificate to connect to a 1 megabyte subset of a raw file, using the export name 'subset':

          qemu-nbd \
            --object tls-creds-x509,id=tls0,endpoint=server,dir=/path/to/qemutls \
            --object 'authz-simple,id=auth0,identity=CN=laptop.example.com,,\
                      O=Example Org,,L=London,,ST=London,,C=GB' \
            --tls-creds tls0 --tls-authz auth0 \
            -t -x subset -p 10810 \
            --image-opts driver=raw,offset=1M,size=1M,file.driver=file,file.filename=file.raw

       Serve a read-only copy of a guest image over a Unix socket with as many as 5 simultaneous readers, with a
       persistent process forked as a daemon:

          qemu-nbd --fork --persistent --shared=5 --socket=/path/to/sock \
            --read-only --format=qcow2 file.qcow2

       Expose  the  guest-visible  contents  of a qcow2 file via a block device /dev/nbd0 (and possibly creating
       /dev/nbd0p1 and friends for partitions found within), then disconnect the device when  done.   Access  to
       bind <b>qemu-nbd</b> to a /dev/nbd device generally requires root privileges, and may also require the execution
       of  <b>modprobe</b>  <b>nbd</b>  to  enable  the  kernel  NBD  client module.  <u>CAUTION</u>: Do not use this method to mount
       filesystems from an untrusted guest image - a malicious guest may have prepared the image to  attempt  to
       trigger kernel bugs in partition probing or file system mounting.

          qemu-nbd -c /dev/nbd0 -f qcow2 file.qcow2
          qemu-nbd -d /dev/nbd0

       Query a remote server to see details about what export(s) it is serving on port 10809, and authenticating
       via PSK:

          qemu-nbd \
            --object tls-creds-psk,id=tls0,dir=/tmp/keys,username=eblake,endpoint=client \
            --tls-creds tls0 -L -b remote.example.com

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/qemu.1.html">qemu</a>(1)</b>, <b><a href="../man1/qemu-img.1.html">qemu-img</a>(1)</b>

</pre><h4><b>AUTHOR</b></h4><pre>
       Anthony Liguori &lt;<a href="mailto:anthony@codemonkey.ws">anthony@codemonkey.ws</a>&gt;

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2025, The QEMU Project Developers

10.0.2                                            Jul 02, 2025                                       <u><a href="../man8/QEMU-NBD.8.html">QEMU-NBD</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>