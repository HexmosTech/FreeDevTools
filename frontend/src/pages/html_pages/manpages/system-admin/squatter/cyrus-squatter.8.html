<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>squatter - Cyrus IMAP documentation</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/cyrus-imapd">cyrus-imapd_3.10.2-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       squatter - Cyrus IMAP documentation

       Create SQUAT and Xapian indexes for mailboxes

</pre><h4><b>SYNOPSIS</b></h4><pre>
          general:
          <b>squatter</b> [ <b>-C</b> <u>config-file</u> ] [<b>mode</b>] [<b>options</b>] [<b>source</b>]

          i.e.:
          <b>squatter</b> [ <b>-C</b> <u>config-file</u> ] [ <b>-v</b> ] [ <b>-a</b> ] [ <b>-S</b> <u>seconds</u> ] [ <b>-Z</b> ]
          <b>squatter</b> [ <b>-C</b> <u>config-file</u> ] [ <b>-v</b> ] [ <b>-a</b> ] [ <b>-i</b> ] [ <b>-N</b> <u>name</u> ] [ <b>-S</b> <u>seconds</u> ] [ <b>-r</b> ] [ <b>-Z</b> ] <u>mailbox</u>...
          <b>squatter</b> [ <b>-C</b> <u>config-file</u> ] [ <b>-v</b> ] [ <b>-a</b> ] [ <b>-i</b> ] [ <b>-N</b> <u>name</u> ] [ <b>-S</b> <u>seconds</u> ] [ <b>-r</b> ] [ <b>-Z</b> ] <b>-u</b> <u>user</u>...
          <b>squatter</b> [ <b>-C</b> <u>config-file</u> ] [ <b>-v</b> ] [ <b>-a</b> ] <b>-R</b> [ <b>-n</b> <u>channel</u> ] [ <b>-d</b> ] [ <b>-S</b> <u>seconds</u> ] [ <b>-Z</b> ]
          <b>squatter</b> [ <b>-C</b> <u>config-file</u> ] [ <b>-v</b> ] [ <b>-a</b> ] <b>-f</b> <u>synclogfile</u> [ <b>-S</b> <u>seconds</u> ] [ <b>-Z</b> ]
          <b>squatter</b> [ <b>-C</b> <u>config-file</u> ] [ <b>-v</b> ] <b>-t</b> <u>srctier(s)</u>... <b>-z</b> <u>desttier</u> [ <b>-B</b> ] [ <b>-F</b> ] [ <b>-U</b> ] [ <b>-T</b> <u>reindextiers</u> ] [ <b>-X</b> ] [ <b>-o</b> ] [ <b>-S</b> <u>seconds</u> ] [ <b>-u</b> <u>user</u>... ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>NOTE:</b>
          The  name "<b>squatter</b>" once referred both to the SQUAT indexing engine and to the command used to create
          indexes.  Now that Cyrus supports more than one index type -- SQUAT and Xapian, as of this writing  --
          the name "<b>squatter</b>" refers to the command used to control index creation.  The terms "SQUAT" or "SQUAT
          index(es)"  refers  to the indexes used by the older SQUAT indexing engine.  Post v3 the <u>search_engine</u>
          setting in <u>imapd.conf</u> determines which search engine is used.

       <b>squatter</b> creates a new text index for one or more IMAP mailboxes.  The index is a unified index of all of
       the header and body text of each message in a given mailbox.  This index is used to significantly  reduce
       IMAP SEARCH times on a mailbox.

       <b>mode</b> is one of indexer, search, rolling, synclog, compact or audit.

       By  default, <b>squatter</b> creates an index of ALL messages in the mailbox, not just those since the last time
       that it was run.  The <b>-i</b> option is used to select incremental updates.   Any  messages  appended  to  the
       mailbox  after <b>squatter</b> is run, will NOT be included in the index.  To include new messages in the index,
       <b>squatter</b> must be run again, or on a regular basis  via  crontab,  an  entry  in  the  EVENTS  section  of
       <u><a href="../man5/cyrus.conf.5.html">cyrus.conf</a>(5)</u> or use <u>rolling</u> mode (<b>-R</b>).

       In the first synopsis, <b>squatter</b> indexes all mailboxes.

       In the second synopsis, <b>squatter</b> indexes the specified mailbox(es).  The mailboxes are space-separated.

       In the third synopsis, <b>squatter</b> indexes the specified user(s) mailbox(es).

       For  the  latter  two  index  modes  (mailbox,  user)  one  may optionally specify <b>-r</b> to recurse from the
       specified   start,   or   <b>-a</b>   to   limit   action   only   to   mailboxes   which   have   the    shared
       <u>/vendor/cmu/cyrus-imapd/squat</u> annotation set to "true".

       In the fourth synopsis, <b>squatter</b> runs in rolling mode.  In this mode <b>squatter</b> backgrounds itself and runs
       as  a  daemon  (unless <b>-d</b> is set), listening to a sync log channel chosen using the <b>-n</b> option, and set up
       using the <u>sync_log_channels</u> setting in <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u>.  Very soon after messages are delivered or uploaded
       to mailboxes <b>squatter</b> will incrementally index the affected mailbox (see notes, below).

       In the fifth synopsis, <b>squatter</b> reads a single sync log file and performs  incremental  indexing  on  the
       mailbox(es) listed therein.  This is sometimes useful for cleaning up after problems with rolling mode.

       In  the  sixth synopsis, <b>squatter</b> will compact indices from <u>srctier(s)</u> to <u>desttier</u>, optionally reindexing
       (<b>-X</b>) or filtering expunged records (<b>-F</b>) in the process.  The optional <b>-T</b> flag  may  be  used  to  specify
       members  of  srctiers  which must be reindexed.  These files are eventually copied with <u>rsync</u> <u>-a</u> and then
       removed by <u>rm</u>.  <u>rsync</u> can increase the  load  average  of  the  system,  especially  when  the  temporary
       directory  is  on <u>tmpfs</u>.  To throttle <u>rsync</u> it is possible to modify the call in <u>imap/search_xapian.c</u> and
       pass <u>-\-bwlimit=&lt;number&gt;</u> as further parameter.  The <b>-o</b> flag may be used to direct that a single index  be
       copied,  rather  than compacted, from <u>srctier</u> to <u>desttier</u>.  The <b>-u</b> flag may be used to restrict operation
       to the specified user(s).

       For all modes, the <b>-S</b> option may be specified, causing <b>squatter</b>  to  pause  <u>seconds</u>  seconds  after  each
       mailbox, to smooth loads.

       When using the Xapian engine the <b>-Z</b> option may be specified, for the indexing modes.  This tells <b>squatter</b>
       to consult the Xapian internally indexed GUIDs, rather than relying on what's stored in <u>cyrus.indexed.db</u>,
       allowing for recovery from broken <u>cyrus.indexed.db</u> at the sacrifice of efficiency.

       <b>NOTE:</b>
          Incremental  updates  are very inefficient with the SQUAT search engine.  If using SQUAT for large and
          active mailboxes, you should run <b>squatter</b> periodically as an EVENT in <b><a href="../man5/cyrus.conf.5.html">cyrus.conf</a>(5)</b>.

       <b>NOTE:</b>
          Messages and mailboxes that have not been indexed CAN still be SEARCHed, just not as quickly as  those
          with an index.

       <b>squatter</b> reads its configuration options out of the <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u> file unless specified otherwise by <b>-C</b>.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-C</b> <b>config-file</b>
              Use the specified configuration file <u>config-file</u> rather than the default <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u>.

       <b>-a,</b> <b>--squat-annot</b>
              Only  create  indexes for mailboxes which have the shared <u>/vendor/cmu/cyrus-imapd/squat</u> annotation
              set to "true".

              The value of the <u>/vendor/cmu/cyrus-imapd/squat</u> annotation is inherited  by  all  children  of  the
              given  mailbox,  so  an  entire  mailbox  tree can be indexed (or not indexed) by setting a single
              annotation on the root of that tree with a value of "true" (or "false").  If a  mailbox  does  not
              have  a  <u>/vendor/cmu/cyrus-imapd/squat</u>  annotation  set  on it (or does not inherit one), then the
              mailbox is not indexed. In other words, the implicit  value  of  <u>/vendor/cmu/cyrus-imapd/squat</u>  is
              "false".

       <b>-A,</b> <b>--audit</b>
              Audits  the  specified  mailboxes  (or all), reports any unindexed messages.  This feature is only
              available on the master branch.

       <b>-d,</b> <b>--nodaemon</b>
              In rolling mode, don't background and  do  emit  log  messages  on  standard  error.   Useful  for
              debugging.  This feature was introduced in version 3.0.

       <b>-B,</b> <b>--skip-locked</b>
              In  compact  mode,  use  non-blocking lock to start and skip any users who have their xapianactive
              file locked at the time (i.e another reindex task) This feature is only available  on  the  master
              branch.

       <b>-F,</b> <b>--filter</b>
              In  compact mode, filter the resulting database to only include messages which are not expunged in
              mailboxes with existing name/uidvalidity.  This feature was introduced in version 3.0.

       <b>-f</b> <b>synclogfile,</b> <b>--synclog=synclogfile</b>
              Read the <u>synclogfile</u> and incrementally index all the mailboxes listed therein,  then  exit.   This
              feature was introduced in version 3.0.

       <b>-h,</b> <b>--help</b>
              Display this usage information.

       <b>-i,</b> <b>--incremental</b>
              Incremental updates where indexes already exist.

       <b>-N</b> <b>name,</b> <b>--name=name</b>
              Only  index  mailboxes  beginning  with <u>name</u> while iterating through the mailbox list derived from
              other options.

       <b>-n</b> <b>channel,</b> <b>--channel=channel</b>
              In rolling mode, specify the name of the sync log <u>channel</u>  that  <b>squatter</b>  will  listen  to.   The
              default  is  "squatter".   This  channel <b>must</b> be defined in <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u> before being used.  This
              feature was introduced in version 3.0.

       <b>-o,</b> <b>--copydb</b>
              In compact mode, if only one source database is selected, just copy it to the  destination  rather
              than compacting.  This feature was introduced in version 3.0.

       <b>-p,</b> <b>--allow-partials</b>
                 When indexing, allow messages to be partially indexed. This may occur if attachment indexing is
                 enabled  but  indexing  failed  for one or more attachment body parts. If this flag is set, the
                 message is partially indexed and squatter continues. Otherwise squatter aborts with  an  error.
                 Also see <b>-P</b>.  Xapian only.  This feature is only available on the master branch.

              <b>-P,</b> <b>--reindex-partials</b>
                     When  reindexing,  then attempt to reindex any partially indexed messages (see <b>-p</b>). Setting
                     this flag implies <b>-Z</b>.  Xapian only.  This feature is only available on the master branch.

              <b>-L,</b> <b>--reindex-minlevel=level</b>
                     When reindexing, index all messages that have an index level less  than  level.  Currently,
                     Cyrus  only  supports  two  index levels: A message for which attachment indexing was never
                     attempted has index level 1. A message that has indexed attachments, or  does  not  contain
                     attachments,  has index level 3. Consequently, running squatter with minlevel set to 3 will
                     cause it to attempt reindexing all  messages,  for  which  attachment  indexing  never  was
                     attempted.   Future  Cyrus  versions  may  introduce  additional  levels. Setting this flag
                     implies <b>-Z</b>.  Xapian only.  This feature is only available on the master branch.

       <b>-R,</b> <b>--rolling</b>
              Run in rolling mode; <b>squatter</b> runs as a daemon listening to a sync log  channel  and  continuously
              incrementally  indexing  mailboxes.   See  also <b>-d</b> and <b>-n</b>.  This feature was introduced in version
              3.0.

       <b>-r,</b> <b>--recursive</b>
              Recursively create indexes for all sub-mailboxes of the user, mailboxes or mailbox prefixes  given
              as arguments.

       <b>-s</b> <b>delta,</b> <b>--squat-skip=delta</b>
              Skip  mailboxes  that  have  not been modified since last index. This is achieved by comparing the
              last modification time of a mailbox to the last time the squat index of this mailbox got  updated.
              If  the  mailbox modification time plus delta is less than the squat index modification time, then
              the mailbox is skipped. The argument value delta is defined in seconds and must be greater than or
              equal to zero. The historical default delta was 60, and this remains a good  general  choice,  but
              for technical reasons it must now be specified explicitly.  Squat only.

       <b>-S</b> <b>seconds,</b> <b>--sleep=seconds</b>
              After  processing each mailbox, sleep for "seconds" before continuing. Can be used to provide some
              load balancing.  Accepts fractional amounts. This feature was introduced in version 3.0.

       <b>-T</b> <b>reindextiers,</b> <b>--reindex-tier=reindextiers</b>
              In compact mode, a comma-separated subset of the source tiers (see <b>-t</b>) to be  reindexed.   Similar
              to  <b>-X</b>  but  allows  limiting  the  tiers  that will be reindexed.  This feature was introduced in
              version 3.0.

       <b>-t</b> <b>srctiers,</b> <b>--srctier=srctiers</b>
              In compact mode, the comma-separated source tier(s) for  the  compacted  indices.   At  least  one
              source  tier  must  be  specified  in  compact mode.  Xapian only.  This feature was introduced in
              version 3.0.

       <b>-u</b> <b>name,</b> <b>--user=name</b>
              Extra options refer to usernames (e.g. <u><a href="mailto:foo@bar.com">foo@bar.com</a></u>) rather  than  mailbox  names.   Usernames  are
              space-separated.  This feature was introduced in version 3.0.

       <b>-U,</b> <b>--only-upgrade</b>
              In compact mode, only compact if re-indexing.  Xapian only.  This feature is only available on the
              master branch.

       <b>-v,</b> <b>--verbose</b>
              Increase  the verbosity of progress/status messages.  Sometimes additional messages are emitted on
              the terminal with this option and the messages are  unconditionally  sent  to  syslog.   Sometimes
              messages are sent to syslog, only if -v is provided.  In rolling and synclog modes, -vv sends even
              more messages to syslog.

       <b>-X,</b> <b>--reindex</b>
              Reindex  all the messages before compacting.  This mode reads all the lists of messages indexed by
              the listed tiers, and re-indexes them into a temporary database before compacting that into place.
              Xapian only.  This feature was introduced in version 3.0.

       <b>-z</b> <b>desttier,</b> <b>--compact=desttier</b>
              In compact mode, the destination tier for the  compacted  indices.   This  must  be  specified  in
              compact mode.  Xapian only.  This feature was introduced in version 3.0.

       <b>-Z,</b> <b>--internalindex</b>
              When  indexing  messages,  use  the  Xapian internal cyrusid rather than referencing the ranges of
              already indexed messages to know if a particular message is indexed.  Useful if the ranges get out
              of sync with the actual messages (e.g. if files on a tier are lost) Xapian only.  This feature  is
              only available on the master branch.

</pre><h4><b>EXAMPLES</b></h4><pre>
       <b>squatter</b> is typically deployed via entries in <u><a href="../man5/cyrus.conf.5.html">cyrus.conf</a>(5)</u>, in either the DAEMON or EVENTS sections.

       For  the  older  SQUAT  search  engine,  which  offers poor performance in rolling mode (-R) we recommend
       triggering periodic runs via entries in the EVENTS section, as follows:

       Sample entries from the EVENTS section of <u><a href="../man5/cyrus.conf.5.html">cyrus.conf</a>(5)</u> for periodic <b>squatter</b> runs:

              EVENTS {
                  # reindex changed mailboxes (fulltext) approximately every three hours
                  squatter1   cmd="<a href="file:///usr/lib/w3m/cgi-bin/w3mman2html.cgi?ionice">/usr/bin/ionice</a> -c idle /usr/lib/cyrus/bin/squatter -i" period=180

                  # reindex all mailboxes (fulltext) daily
                  squattera   cmd="/usr/lib/cyrus/bin/squatter" at=0117
              }

       For the newer Xapian search engine, and with sufficiently fast storage,  the  rolling  mode  (-R)  offers
       advantages.  Use of rolling mode requires that <b>squatter</b> be invoked in the DAEMON section.

       Sample entries for the DAEMON section of <u><a href="../man5/cyrus.conf.5.html">cyrus.conf</a>(5)</u> for rolling <b>squatter</b> operation:

              DAEMON {
                # run a rolling squatter using the default sync_log channel "squatter"
                squatter cmd="squatter -R"

                # run a rolling squatter using a specific sync_log channel
                squatter cmd="squatter -R -n indexer"
              }

       <b>NOTE:</b>
          When  using the <u>-R</u> rolling mode, you MUST enable sync_log operation in <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u> via the <u>sync_log:</u>
          <u>on</u> setting, and MUST define a sync_log channel via the  <u>sync_log_channels:</u>  setting.   If  also  using
          replication,   you   must  either  explicitly  specify  your  replication  sync_log  channel  via  the
          <u>sync_log_channels</u> directive with a name, or specify the default empty name with "" (the  two-character
          string U+22 U+22).  [Please see <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u> for details].

       <b>NOTE:</b>
          When  configuring  rolling  search  indexing on a <b>replica</b>, one must consider whether sync_logs will be
          written at all.  In this case, please consider the setting <u>sync_log_unsuppressable_channels</u> to  ensure
          that the sync_log channel upon which one's squatter instance depends will continue to be written.  See
          <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u> for details.

       <b>NOTE:</b>
          When  using  the Xapian search engine, you must define various settings in <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u>.  Please read
          all relevant Xapian documentation in this release before using Xapian.

       [NB: More examples needed]

</pre><h4><b>HISTORY</b></h4><pre>
       Support for additional search engines was added in version 3.0.

       The following command-line switches were added in version 3.0:

              <b>-F</b> <b>-R</b> <b>-X</b> <b>-d</b> <b>-f</b> <b>-o</b> <b>-u</b>

       <b>The</b> <b>following</b> <b>command-line</b> <b>settings</b> <b>were</b> <b>added</b> <b>in</b> <b>version</b> <b>3.0:</b>

              <b>-S</b> <u>&lt;seconds&gt;</u><b>,</b> <b>-T</b> <u>&lt;directory&gt;</u><b>,</b> <b>-f</b> <u>&lt;synclogfile&gt;</u><b>,</b> <b>-n</b> <u>&lt;channel&gt;</u><b>,</b> <b>-t</b> <u>srctier</u><b>...,</b> <b>-z</b> <u>desttier</u>

</pre><h4><b>FILES</b></h4><pre>
       /etc/imapd.conf, /etc/cyrus.conf

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u>, <u><a href="../man5/cyrus.conf.5.html">cyrus.conf</a>(5)</u>

</pre><h4><b>AUTHOR</b></h4><pre>
       The Cyrus Team, Nic Bernstein (Onlight)

</pre><h4><b>COPYRIGHT</b></h4><pre>
       1993–2025, The Cyrus Team

3.10.2                                            Jun 27, 2025                                       <u><a href="../man8/SQUATTER.8.html">SQUATTER</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>