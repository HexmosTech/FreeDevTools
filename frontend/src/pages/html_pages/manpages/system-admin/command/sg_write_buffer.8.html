<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sg_write_buffer - send SCSI WRITE BUFFER commands</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/sg3-utils">sg3-utils_1.48-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sg_write_buffer - send SCSI WRITE BUFFER commands

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>sg_write_buffer</b>   [<u>--bpw=CS</u>]   [<u>--dry-run</u>]  [<u>--help</u>]  [<u>--id=ID</u>]  [<u>--in=FILE</u>]  [<u>--length=LEN</u>]  [<u>--mode=MO</u>]
       [<u>--offset=OFF</u>] [<u>--read-stdin</u>] [<u>--skip=SKIP</u>] [<u>--specific=MS</u>] [<u>--timeout=TO</u>] [<u>--verbose</u>] [<u>--version</u>] <u>DEVICE</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Sends one or more SCSI WRITE BUFFER commands to <u>DEVICE</u>, along with data provided by  the  user.  In  some
       cases  no  data  is required, or data can be read from the file given in the <u>--in=FILE</u> option, or data is
       read from stdin when either <u>--read-stdin</u> or <u>--in=-</u> is given.

       Some WRITE BUFFER command variants do not have associated  data  to  send  to  the  device.  For  example
       "activate_mc"  activates  deferred  microcode  that  was sent via prior WRITE BUFFER commands. There is a
       different method used to download microcode to SES devices, see the sg_ses_microcode utility.

</pre><h4><b>OPTIONS</b></h4><pre>
       Arguments to long options are mandatory  for  short  options  as  well.   The  options  are  arranged  in
       alphabetical order based on the long option name.

       <b>-b</b>, <b>--bpw</b>=<u>CS</u>
              where  <u>CS</u>  is  the  chunk  size  in bytes. This will be the maximum number of bytes sent per WRITE
              BUFFER command. So if <u>CS</u> is less than the effective length then multiple WRITE BUFFER commands are
              sent, each taking the next chunk from the read data and increasing the buffer offset field in  the
              WRITE  BUFFER  command  by  the  appropriate  amount.  The  default  is a chunk size of 0 which is
              interpreted as a very large number hence only one WRITE BUFFER command will be sent.  This  option
              should  only  be  used  with modes that "download microcode, with offsets ..."; namely either mode
              0x6, 0x7, 0xd or 0xe.
              The number in <u>CS</u> can optionally be followed by ",act" or ",activate".  In this  case  after  WRITE
              BUFFER  commands  have  been  sent  until  the  effective length is exhausted another WRITE BUFFER
              command with its mode set to "Activate deferred microcode mode" [mode 0xf] is sent.

       <b>-d</b>, <b>--dry-run</b>
              Do all the command line processing and sanity checks including reading the input file. However  at
              the  point  where  a WRITE BUFFER SCSI command(s) would be sent, step over that call and assume it
              completed without errors and continue. <u>DEVICE</u> is still opened but can be /dev/null (in Unix).   It
              is recommended to use <u>--verbose</u> with this option to get an overview of what would have happened.

       <b>-h</b>, <b>--help</b>
              output  the  usage  message then exit. If used multiple times also prints the mode names and their
              acronyms.

       <b>-i</b>, <b>--id</b>=<u>ID</u>
              this option sets the buffer id field in the cdb. <u>ID</u>  is  a  value  between  0  (default)  and  255
              inclusive.

       <b>-I</b>, <b>--in</b>=<u>FILE</u>
              read  data  from  file  <u>FILE</u> that will be sent with the WRITE BUFFER command.  If <u>FILE</u> is '-' then
              stdin is read until an EOF is detected (this is the same action as  <u>--read-stdin</u>).  Data  is  read
              from the beginning of <u>FILE</u> except in the case when it is a regular file and the <u>--skip=SKIP</u> option
              is given.

       <b>-l</b>, <b>--length</b>=<u>LEN</u>
              where  <u>LEN</u>  is  the  length, in bytes, of data to be written to the device.  If not given (and the
              length cannot be deduced from <u>--in=FILE</u> or <u>--read-stdin</u>) then defaults to zero. If the  option  is
              given and the length deduced from <u>--in=FILE</u> or <u>--read-stdin</u> is less (or no data is provided), then
              bytes of 0xff are used as fill bytes.

       <b>-m</b>, <b>--mode</b>=<u>MO</u>
              this  option  sets  the MODE field in the cdb. <u>MO</u> is a value between 0 (default) and 31 inclusive.
              Alternatively an abbreviation can be given.  See the MODES section below. To  list  the  available
              mode abbreviations at run time give an invalid one (e.g. '--mode=xxx') or use the '-hh' option.

       <b>-o</b>, <b>--offset</b>=<u>OFF</u>
              this  option  sets  the  BUFFER  OFFSET  field  in the cdb. <u>OFF</u> is a value between 0 (default) and
              2**24-1 . It is a byte offset.

       <b>-r</b>, <b>--read-stdin</b>
              read data from stdin until an EOF is detected. This data is sent with the WRITE BUFFER command  to
              <u>DEVICE</u>.  The  action  of  this option is the same as using '--in=-'. Previously this option's long
              name was <u>--raw</u> and it may still be used for backward compatibility.

       <b>-s</b>, <b>--skip</b>=<u>SKIP</u>
              this option is only active when <u>--in=FILE</u> is given and <u>FILE</u> is a regular file, rather than  stdin.
              Data  is  read  starting  at  byte  offset  <u>SKIP</u>  to  the  end  of  file  (or  the amount given by
              <u>--length=LEN</u>).  If not given the byte offset defaults to 0 (i.e. the start of the file).

       <b>-S</b>, <b>--specific</b>=<u>MS</u>
              <u>MS</u> is the MODE SPECIFIC field in the cdb. This is a 3-bit field so the values 0 to 7 are accepted.
              This field was introduced in SPC-4 revision 32 and can be used to specify additional  events  that
              activate deferred microcode (when <u>MO</u> is 0xD).

       <b>-t</b>, <b>--timeout</b>=<u>TO</u>
              <u>TO</u>  is  the command timeout (in seconds) for each WRITE BUFFER command issued by this utility. Its
              default value is 300 seconds (5 minutes) and should only be altered if this is not sufficient.

       <b>-v</b>, <b>--verbose</b>
              increase the level of verbosity, (i.e. debug output).

       <b>-V</b>, <b>--version</b>
              print the version string and then exit.

</pre><h4><b>MODES</b></h4><pre>
       Following is a list of WRITE BUFFER command settings for the MODE field.  First is an acronym accepted by
       the <u>MO</u> argument of this utility.  Following the acronym in square brackets are the corresponding  decimal
       and hex values that may also be given for <u>MO</u>. The following are listed in numerical order.

       hd  [0, 0x0]
              Combined header and data (obsolete in SPC-4).

       vendor  [1, 0x1]
              Vendor specific.

       data  [2, 0x2]
              Data (was called "Write Data" in SPC-3).

       dmc  [4, 0x4]
              Download microcode and activate (was called "Download microcode" in SPC-3).

       dmc_save  [5, 0x5]
              Download microcode, save, and activate (was called "Download microcode and save" in SPC-3).

       dmc_offs  [6, 0x6]
              Download  microcode  with  offsets  and  activate (was called "Download microcode with offsets" in
              SPC-3).

       dmc_offs_save  [7, 0x7]
              Download microcode with offsets, save, and activate (was called "Download microcode  with  offsets
              and save" in SPC-3).

       echo  [10, 0xa]
              Write data to echo buffer (was called "Echo buffer" in SPC-3).

       dmc_offs_ev_defer  [13, 0xd]
              Download microcode with offsets, select activation events, save, and defer activate (introduced in
              SPC-4).

       dmc_offs_defer  [14, 0xe]
              Download microcode with offsets, save, and defer activate (introduced in SPC-4).

       activate_mc  [15, 0xf]
              Activate deferred microcode (introduced in SPC-4).

       en_ex  [26, 0x1A]
              Enable expander communications protocol and Echo buffer (obsolete in SPC-4).

       dis_ex  [27, 0x1B]
              Disable expander communications protocol (obsolete in SPC-4).

       deh  [28, 0x1C]
              Download application client error history (was called "Download application log" in SPC-3).

</pre><h4><b>NOTES</b></h4><pre>
       If  no  <u>--length=LEN</u> is given this utility reads up to 8 MiB of data from the given file <u>FILE</u> (or stdin).
       If a larger amount of data is required then the <u>--length=LEN</u> option should be given.

       The user should be aware that most operating systems have limits on the amount of data that can  be  sent
       with  one SCSI command. In Linux this depends on the pass through mechanism used (e.g. block SG_IO or the
       sg   driver)   and   various   setting   in   sysfs   in   the    Linux    lk    2.6/3    series    (e.g.
       /sys/block/sda/queue/max_sectors_kb).  Devices  (i.e.  logical  units)  also typically have limits on the
       maximum amount of data they can  handle  in  one  command.  These  two  limitations  suggest  that  modes
       containing  the word "offset" together with the <u>--bpw=CS</u> option are required as firmware files get larger
       and larger. And <u>CS</u> can be quite small, for example 4096 bytes, resulting in many  WRITE  BUFFER  commands
       being sent.

       Attempting  to  download  a  microcode/firmware file that is too large may cause an error to occur in the
       pass-through layer (i.e. before the SCSI command is issued). In Linux such error reports can  be  obscure
       as in "pass through os error invalid argument". FreeBSD reports such errors well to the machine's console
       but returns a cryptic error message to this utility.

       Downloading incorrect microcode into a device has the ability to render that device inoperable. One would
       hope  that  the device vendor verifies the data before activating it. If the SCSI WRITE BUFFER command is
       given values in its cdb (e.g. <u>LEN</u>) that are inappropriate (e.g. too large) then the device should respond
       with a sense key of ILLEGAL REQUEST and an additional sense code of INVALID FIELD  in  CDB.  If  a  WRITE
       BUFFER  command  (or  a  sequence  of them) fails due to device vendor verification checks then it should
       respond with a sense key of ILLEGAL REQUEST and an additional sense code of COMMAND SEQUENCE ERROR.

       All numbers given with options are assumed to be decimal.  Alternatively numerical values can be given in
       hexadecimal preceded by either "0x" or "0X" (or has a trailing "h" or "H").

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following sends new firmware to an enclosure. Sending a 1.5 MB  file  in  one  WRITE  BUFFER  command
       caused  the  enclosure to lock up temporarily and did not update the firmware. Breaking the firmware file
       into 4 KB chunks (an educated guess) was more successful:

         sg_write_buffer -b 4k -m dmc_offs_save -I firmware.bin /dev/sg4

       The firmware update occurred in the following enclosure power cycle. With a modern enclosure the Extended
       Inquiry VPD page gives indications in which situations a firmware upgrade will take place.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       The exit status of sg_write_buffer is 0 when it is successful. Otherwise see the <a href="../man8/sg3_utils.8.html">sg3_utils</a>(8) man page.

</pre><h4><b>AUTHORS</b></h4><pre>
       Written by Luben Tuikov and Douglas Gilbert.

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;dgilbert at interlog dot com&gt;.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright © 2006-2018 Luben Tuikov and Douglas Gilbert
       This software is  distributed  under  a  BSD-2-Clause  license.  There  is  NO  warranty;  not  even  for
       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>sg_read_buffer,</b> <b>sg_ses_microcode(sg3_utils)</b>

sg3_utils-1.45                                    November 2018                               <u><a href="../man8/SG_WRITE_BUFFER.8.html">SG_WRITE_BUFFER</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>