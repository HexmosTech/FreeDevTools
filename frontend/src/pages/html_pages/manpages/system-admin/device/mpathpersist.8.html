<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mpathpersist - Manages SCSI persistent reservations on dm multipath devices.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/multipath-tools">multipath-tools_0.11.1-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mpathpersist - Manages SCSI persistent reservations on dm multipath devices.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>mpathpersist</b> [<b>OPTIONS</b>] <u>device</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  utility  is  used  to manage SCSI persistent reservations on Device Mapper Multipath devices. To be
       able to use this functionality, the <u>reservation_key</u> attribute must be defined in the  <u><a href="file:/etc/multipath.conf">/etc/multipath.conf</a></u>
       file.  Otherwise  the  <b>multipathd</b>  daemon  will not check for persistent reservation for newly discovered
       paths or reinstated paths.

       <b>mpathpersist</b> supports the same command-line options as the <b>sg_persist</b> utility.   Consult  the  <b>sg_persist</b>
       <b>(8)</b> manual page for an in-depth discussion of the various options.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-verbose|-v</b> <u>level</u>
              Verbosity:

              <u>0</u>    Critical messages.

              <u>1</u>    Error messages.

              <u>2</u>    Warning messages.

              <u>3</u>    Informational messages.

              <u>4</u>    Informational messages with trace enabled.

       <b>--device=</b><u>DEVICE</u><b>|-d</b> <u>DEVICE</u>
              Query or change DEVICE.

       <b>--batch-file=</b><u>DEVICE</u><b>|-f</b> <u>FILE</u>
              Read commands from <u>FILE</u>. See section "BATCH FILES" below. This option can be given at most once.

       <b>--help|-h</b>
              Output this usage message.

       <b>--hex|-H</b>
              Output response in hex.

       <b>--in|-i</b>
              Request PR In command.

       <b>--out|-o</b>
              Request PR Out command.

       <b>--param-alltgpt|-Y</b>
              PR Out parameter 'ALL_TG_PT'.

       <b>--param-aptpl|-Z</b>
              PR Out parameter 'APTPL'.

       <b>--read-keys|-k</b>
              PR In: Read Keys.

       <b>--param-rk=</b><u>RK</u><b>|-K</b> <u>RK</u>
              PR Out parameter reservation key (RK is in hex, up to 8 bytes).

       <b>--param-sark=</b><u>SARK</u><b>|-S</b> <u>SARK</u>
              PR Out parameter service action reservation key (SARK is in hex).

       <b>--preempt|-P</b>
              PR Out: Preempt.

       <b>--clear|-C</b>
              PR Out: Clear registrations.

       <b>--preempt-abort|-A</b>
              PR Out: Preempt and Abort.

       <b>--prout-type=</b><u>TYPE</u><b>|-T</b> <u>TYPE</u>
              PR Out command type.

       <b>--read-full-status|-s</b>
              PR In: Read Full Status.

       <b>--read-keys|-k</b>
              PR In: Read Keys.

       <b>--read-reservation|-r</b>
              PR In: Read Reservation.

       <b>--register|-G</b>
              PR Out: Register.

       <b>--register-ignore|-I</b>
              PR Out: Register and Ignore.

       <b>--release|-L</b>
              PR Out: Release.

       <b>--report-capabilities|-c</b>
              PR In: Report Capabilities.

       <b>--reserve|-R</b>
              PR Out: Reserve.

       <b>--transport-id=</b><u>TIDS</u><b>|-X</b> <u>TIDS</u>
              TransportIDs can be mentioned in several forms.

       <b>--alloc-length=</b><u>LEN</u><b>|-l</b> <u>LEN</u>
              PR In: maximum allocation length. LEN is a decimal number between 0 and 8192.

</pre><h4><b>EXAMPLE</b></h4><pre>
       Register the key "123abc" for the /dev/mapper/mpath9 device:
              <b>mpathpersist</b> <b>--out</b> <b>--register</b> <b>--param-sark=</b><u>123abc</u> <u>/dev/mapper/mpath9</u>

       Read registered reservation keys for the /dev/mapper/mpath9 device:
              <b>mpathpersist</b> <b>-i</b> <b>-k</b> <u>/dev/mapper/mpath9</u>

       Create a reservation for the /dev/mapper/mpath9 device with the given reservation key:
              <b>mpathpersist</b> <b>--out</b> <b>--reserve</b> <b>--param-rk=</b><u>123abc</u> <b>--prout-type=</b><u>8</u> <b>-d</b> <u>/dev/mapper/mpath9</u>

       Read the reservation status of the /dev/mapper/mpath9 device:
              <b>mpathpersist</b> <b>-i</b> <b>-s</b> <b>-d</b> <u>/dev/mapper/mpath9</u>

       Release the previously created reservation (note that the prout-type needs to be the same as above):
              <b>mpathpersist</b> <b>--out</b> <b>--release</b> <b>--param-rk=</b><u>123abc</u> <b>--prout-type=</b><u>8</u> <b>-d</b> <u>/dev/mapper/mpath9</u>

       Remove the current key registered for this host (i.e. reset it to 0):
              <b>mpathpersist</b> <b>--out</b> <b>--register-ignore</b> <b>-K</b> <u>123abc</u> <b>-S</b> <u>0</u> <u>/dev/mapper/mpath9</u>

       Remove current reservation, and unregister all registered keys from all I_T nexuses:
              <b>mpathpersist</b> <b>-oCK</b> <u>123abc</u> <u>/dev/mapper/mpath9</u>

</pre><h4><b>BATCH</b> <b>FILES</b></h4><pre>
       The  option  <u>--batch-file</u>  (<u>-f</u>)  sets an input file to be processed by <b>mpathpersist</b>. Grouping commands in
       batch files can provide a speed improvement in particular on  large  installments,  because  <b>mpathpersist</b>
       needs to scan existing paths and maps only once during startup.

       The  input  file  is  a text file that is parsed line by line. Every line of the file is interpreted as a
       command line (i.e. list of options and parameters) for <b>mpathpersist</b>. Options and parameters are separated
       by one or more whitespace characters (space or TAB).  Lines can, but do not have to, begin with the  word
       "mpathpersist".   The  "#"  character,  either at the beginning of the line or following some whitespace,
       denotes the start of a comment  that  lasts  until  the  end  of  the  line.  Empty  lines  are  allowed.
       Continuation of mpathpersist commands over multiple lines is not supported.

       All  options  listed  in this man page, except <u>-f</u> and <u>-v</u>, are allowed in batch files. Both short and long
       option formats may be used.  Using the <u>-f</u> option inside the batch file is an  error.  The  <u>-v</u>  option  is
       ignored in batch files.

       The  multipath  map  on  which  to  act  must be specified on every input line, e.g. using the <u>-d</u> option.
       Commands acting on different multipath maps may be combined in a batch file, and  multiple  commands  may
       act  on  the  same  multipath map. Commands are executed one by one, so that commands further down in the
       file see status changes  caused  by  previous  commands.   If  <b>mpathpersist</b>  encounters  an  error  while
       processing  a  line  in  the  batch  file,  batch file processing is <b>not</b> aborted; subsequent commands are
       executed nonetheless. The exit status of <b>mpathpersist</b> is the status of the first failed command, or 0  if
       all commands succeeded.

       If other options and parameters are used along with <u>-f</u> on the <b>mpathpersist</b> command line, the command line
       will be executed first, followed by the commands from the batch file.

       Below is an example of a valid batch input file.

              # This is an mpathpersist input file.
              # Short and long forms of the same command
              -i -k /dev/dm-1 # short form, this comment is ignored
              mpathpersist --in --read-keys --device=/dev/dm-1

              # Mixing of long and short options, variable white space
                --out  --register    -S  abcde     /dev/dm-1

              # Mixing of commands for different maps
              -ir /dev/dm-0
              -ir /dev/dm-1

              mpathpersist --out --param-rk abcde --reserve --prout-type 5 /dev/dm-1
              # This should now show a reservation
              -ir /dev/dm-1
              -oCK abcde /dev/dm-1
              --in --read-reservation /dev/dm-1

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/multipath.8.html">multipath</a></b>(8), <b><a href="../man8/multipathd.8.html">multipathd</a></b>(8), <b><a href="../man8/sg_persist.8.html">sg_persist</a></b>(8).

</pre><h4><b>AUTHORS</b></h4><pre>
       <u>multipath-tools</u> was developed by Christophe Varoqui &lt;<a href="mailto:christophe.varoqui@opensvc.com">christophe.varoqui@opensvc.com</a>&gt; and others.

Linux                                              2021-11-12                                    <u><a href="../man8/MPATHPERSIST.8.html">MPATHPERSIST</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>