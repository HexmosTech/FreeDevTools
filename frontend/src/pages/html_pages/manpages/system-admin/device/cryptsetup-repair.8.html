<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cryptsetup-repair - repair the device metadata</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/cryptsetup-bin">cryptsetup-bin_2.8.0-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       cryptsetup-repair - repair the device metadata

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>cryptsetup</b> <u>repair</u> <b>[&lt;options&gt;]</b> <b>&lt;device&gt;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Tries to repair the device metadata if possible. Currently supported only for LUKS device type.

       This command is useful to fix some known benign LUKS metadata header corruptions. Only basic corruptions
       of unused keyslot are fixable. This command will only change the LUKS header, not any key-slot data. You
       may enforce LUKS version by adding --type option.

       It also repairs (upgrades) LUKS2 reencryption metadata by adding a metadata digest that protects it
       against malicious changes.

       If LUKS2 reencryption was interrupted in the middle of writing reencryption segment the repair command
       can be used to perform reencryption recovery so that reencryption can continue later. Repairing
       reencryption requires verification of reencryption keyslot so passphrase or keyfile is needed.

   <b>LUKS</b> <b>keyslots</b> <b>corruption</b> <b>detection</b>
       The repair command also checks for detectable corruption of keyslot content. Corruption of a keyslot
       results in a situation when a known password is no longer accepted. It can happen due to storage media
       failure or overwriting the keyslot area by some other data. Only certain corruptions, usually only a
       low-entropy area (like zeroed blocks), can be detected.

       The detection prints only warnings. It does not modify keyslots. It can also print more specific offsets
       on the device for detailed manual inspection.

       Please note that the warning can be a false positive (no real corruption happened). Conversely, if the
       keyslot is corrupted, no recovery is possible. You have to use LUKS header backup.

       <b>&lt;options&gt;</b> can be [--timeout, --verify-passphrase, --disable-locks, --type, --header, --key-file,
       --keyfile-size, --keyfile-offset, --key-slot].

       <b>WARNING:</b> Always create a binary backup of the original header before calling this command.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--batch-mode,</b> <b>-q</b>
           Suppresses all confirmation questions. Use with care!

           If the --verify-passphrase option is not specified, this option also switches off the passphrase
           verification.

       <b>--debug</b> <b>or</b> <b>--debug-json</b>
           Run in debug mode with full diagnostic logs. Debug output lines are always prefixed by <b>#</b>.

           If --debug-json is used, additional LUKS2 JSON data structures are printed.

       <b>--disable-locks</b>
           Disable lock protection for metadata on disk. This option is valid only for LUKS2 and ignored for
           other formats.

           <b>WARNING:</b> Do not use this option unless you run cryptsetup in a restricted environment where locking
           is impossible to perform (where <a href="file:/run">/run</a> directory cannot be used).

       <b>--header</b> <b>&lt;device</b> <b>or</b> <b>file</b> <b>storing</b> <b>the</b> <b>LUKS</b> <b>header&gt;</b>
           Use a detached (separated) metadata device or file where the LUKS header is stored. This option
           allows one to store ciphertext and LUKS header on different devices.

           For commands that change the LUKS header (e.g. <u>luksAddKey</u>), specify the device or file with the LUKS
           header directly as the LUKS device.

       <b>--help,</b> <b>-?</b>
           Show help text and default parameters.

       <b>--key-file,</b> <b>-d</b> <u>name</u>
           Read the passphrase from file.

           If the name given is "-", then the passphrase will be read from stdin. In this case, reading will not
           stop at newline characters.

           See section <u>NOTES</u> <u>ON</u> <u>PASSPHRASE</u> <u>PROCESSING</u> in <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8) for more information.

       <b>--keyfile-offset</b> <u>value</u>
           Skip <u>value</u> bytes at the beginning of the key file.

       <b>--keyfile-size,</b> <b>-l</b> <u>value</u>
           Read a maximum of <u>value</u> bytes from the key file. The default is to read the whole file up to the
           compiled-in maximum that can be queried with --help. Supplying more data than the compiled-in maximum
           aborts the operation.

           This option is useful to cut trailing newlines, for example. If --keyfile-offset is also given, the
           size count starts after the offset.

       <b>--key-slot,</b> <b>-S</b> <b>&lt;0-N&gt;</b>
           For LUKS operations that add key material, this option allows you to specify which key slot is
           selected for the new key.

           The maximum number of key slots depends on the LUKS version. LUKS1 can have up to 8 key slots. LUKS2
           can have up to 32 key slots based on key slot area size and key size, but a valid key slot ID can
           always be between 0 and 31 for LUKS2.

       <b>--timeout,</b> <b>-t</b> <b>&lt;number</b> <b>of</b> <b>seconds&gt;</b>
           The number of seconds to wait before timeout on passphrase input via terminal. It is relevant every
           time a passphrase is asked. It has no effect if used in conjunction with --key-file.

           This option is useful when the system should not stall if the user does not input a passphrase, e.g.
           during boot. The default is a value of 0 seconds, which means to wait forever.

       <b>--type</b> <b>&lt;device-type&gt;</b>
           Specifies required device type, for more info read <u>BASIC</u> <u>ACTIONS</u> section in <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8).

       <b>--usage</b>
           Show short option help.

       <b>--verify-passphrase,</b> <b>-y</b>
           When interactively asking for a passphrase, ask for it twice and complain if both inputs do not
           match. Ignored on input from file or stdin.

       <b>--version,</b> <b>-V</b>
           Show the program version.

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs at <b>cryptsetup</b> <b>mailing</b> <b>list</b> &lt;<a href="mailto:cryptsetup@lists.linux.dev">cryptsetup@lists.linux.dev</a>&gt; or in <b>Issues</b> <b>project</b> <b>section</b>
       &lt;https://gitlab.com/cryptsetup/cryptsetup/-/issues/new&gt;.

       Please attach output of the failed command with --debug option added.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>Cryptsetup</b> <b>FAQ</b> &lt;https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions&gt;

       <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8), <b><a href="../man8/integritysetup.8.html">integritysetup</a></b>(8) and <b><a href="../man8/veritysetup.8.html">veritysetup</a></b>(8)

</pre><h4><b>CRYPTSETUP</b></h4><pre>
       Part of <b>cryptsetup</b> <b>project</b> &lt;https://gitlab.com/cryptsetup/cryptsetup/&gt;.

cryptsetup 2.8.0                                   2025-07-25                               <u><a href="../man8/CRYPTSETUP-REPAIR.8.html">CRYPTSETUP-REPAIR</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>