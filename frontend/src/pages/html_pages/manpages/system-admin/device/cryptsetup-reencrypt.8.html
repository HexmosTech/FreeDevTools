<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cryptsetup-reencrypt - reencrypt LUKS encrypted volumes in-place</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/cryptsetup-bin">cryptsetup-bin_2.8.0-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       cryptsetup-reencrypt - reencrypt LUKS encrypted volumes in-place

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>cryptsetup</b> <u>reencrypt</u> <b>[&lt;options&gt;]</b> <b>&lt;device&gt;</b> <b>or</b> <b>--active-name</b> <b>&lt;name&gt;</b> <b>[&lt;new_name&gt;]</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Run LUKS device reencryption.

       There are 3 basic modes of operation:

       •   device reencryption (<u>reencrypt</u>)

       •   device encryption (<u>reencrypt</u> --encrypt/--new/-N)

       •   device decryption (<u>reencrypt</u> --decrypt)

       &lt;device&gt; or --active-name &lt;name&gt; (LUKS2 only) is mandatory parameter.

       Cryptsetup <u>reencrypt</u> action can be used to change reencryption parameters which otherwise require full
       on-disk data change (re-encryption). The <u>reencrypt</u> action reencrypts data on LUKS device in-place.

       You can regenerate <b>volume</b> <b>key</b> (the real key used in on-disk encryption unlocked by passphrase), <b>cipher</b>,
       <b>cipher</b> <b>mode</b> or <b>encryption</b> <b>sector</b> <b>size</b> (LUKS2 only).

       <b>WARNING:</b> If you need to use both luksChangeKey and reencrypt (e.g. to recover from a leak) you need to
       use them in that order to not leak the new volume key.

       Reencryption process may be safely interrupted by a user via SIGINT signal (ctrl+c). Same applies to
       SIGTERM signal (i.e. issued by systemd during system shutdown).

       For in-place encryption mode, the <u>reencrypt</u> action additionally takes all options available for
       <u>luksFormat</u> action for respective LUKS version (see cryptsetup-luksFormat man page for more details). See
       <b><a href="../man8/cryptsetup-luksFormat.8.html">cryptsetup-luksFormat</a></b>(8).

       <b>NOTE</b> that for encrypt and decrypt mode, the whole device must be treated as unencrypted — there are no
       guarantees of confidentiality as part of the device contains plaintext.

       <b>ALWAYS</b> <b>BE</b> <b>SURE</b> <b>YOU</b> <b>HAVE</b> <b>RELIABLE</b> <b>BACKUP</b> <b>BEFORE</b> <b>USING</b> <b>THIS</b> <b>ACTION</b> <b>ON</b> <b>LUKS</b> <b>DEVICE.</b>

       <b>&lt;options&gt;</b> can be [--batch-mode, --block-size, --cipher, --debug, --debug-json, --decrypt, --device-size,
       --disable-locks, --encrypt, --force-offline-reencrypt, --hash, --header, --hotzone-size, --iter-time,
       --init-only, --keep-key, --key-file, --key-size, --key-slot, --keyfile-offset, --keyfile-size, --tries,
       --timeout, --pbkdf, --pbkdf-force-iterations, --pbkdf-memory, --pbkdf-parallel, --progress-frequency,
       --progress-json, --reduce-device-size, --resilience, --resilience-hash, --resume-only, --sector-size,
       --use-directio, --use-random, --use-urandom, --use-fsync, --uuid, --verbose, --volume-key-file,
       --write-log].

</pre><h4><b>LUKS2</b> <b>REENCRYPTION</b></h4><pre>
       With &lt;device&gt; parameter cryptsetup looks up active &lt;device&gt; dm mapping. If no active mapping is detected,
       it starts offline LUKS2 reencryption otherwise online reencryption takes place.

       To resume already initialized or interrupted reencryption, just run the cryptsetup <u>reencrypt</u> command
       again to continue the reencryption operation. Reencryption may be resumed with different --resilience or
       --hotzone-size unless implicit datashift resilience mode is used: either encrypt mode with
       --reduce-device-size option or decrypt mode with original LUKS2 header exported in --header file.

       If the reencryption process was interrupted abruptly (reencryption process crash, system crash, poweroff)
       it may require recovery. The recovery is currently run automatically on next activation (action <u>open</u>)
       when needed or explicitly by user (action <u>repair</u>).

       Optional parameter &lt;new_name&gt; takes effect only with encrypt option and it activates device &lt;new_name&gt;
       immediately after encryption initialization gets finished. That’s useful when device needs to be ready as
       soon as possible and mounted (used) before full data area encryption is completed.

</pre><h4><b>LUKS1</b> <b>REENCRYPTION</b></h4><pre>
       Current working directory must be writable and temporary files created during reencryption must be
       present. During reencryption process the LUKS1 device is marked unavailable and must be offline (no
       dm-crypt mapping or mounted filesystem).

       <b>WARNING</b>: The LUKS1 reencryption code is not resistant to hardware or kernel failures during reencryption
       (you can lose your data in this case).

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--align-payload</b> <b>&lt;number</b> <b>of</b> <b>512</b> <b>byte</b> <b>sectors&gt;</b>
           Align payload at a boundary of <u>value</u> 512-byte sectors.

           If not specified, cryptsetup tries to use the topology info provided by the kernel for the underlying
           device to get the optimal alignment. If not available (or the calculated value is a multiple of the
           default) data is by default aligned to a 1MiB boundary (i.e. 2048 512-byte sectors).

           For a detached LUKS header, this option specifies the offset on the data device. See also the
           --header option.

           <b>WARNING:</b> This option is DEPRECATED and has often unexpected impact to the data offset and keyslot
           area size (for LUKS2) due to the complex rounding. For fixed data device offset use <u>--offset</u> option
           instead.

       <b>--batch-mode,</b> <b>-q</b>
           Suppresses all confirmation questions. Use with care!

           If the --verify-passphrase option is not specified, this option also switches off the passphrase
           verification.

       <b>--block-size</b> <u>value</u> <b>(LUKS1</b> <b>only)</b>
           Use re-encryption block size of <u>value</u> in MiB.

           Values can be between 1 and 64 MiB.

       <b>--cipher,</b> <b>-c</b> <u>&lt;cipher-spec&gt;</u>
           <b>LUKS2</b>: Set the cipher specification string for data segment only.

           <b>LUKS1</b>: Set the cipher specification string for data segment and keyslots.

           <b>NOTE</b>: In encrypt mode, if cipher specification is omitted the default cipher is applied. In reencrypt
           mode, if no new cipher specification is requested, the existing cipher will remain in use. Unless the
           existing cipher was "cipher_null". In that case default cipher would be applied as in encrypt mode.

           <u>cryptsetup</u> <u>--help</u> shows the compiled-in defaults.

           If a hash is part of the cipher specification, then it is used as part of the IV generation. For
           example, ESSIV needs a hash function, while "plain64" does not and hence none is specified.

           For XTS mode you can optionally set a key size of 512 bits with the -s option. Key size for XTS mode
           is twice that for other modes for the same security level.

       <b>--debug</b> <b>or</b> <b>--debug-json</b>
           Run in debug mode with full diagnostic logs. Debug output lines are always prefixed by <b>#</b>.

           If --debug-json is used, additional LUKS2 JSON data structures are printed.

       <b>--decrypt</b>
           Initialize (and run) device decryption mode.

       <b>--device-size</b> <u>size[units]</u>
           Instead of real device size, use specified value. It means that only specified area (from the start
           of the device to the specified size) will be reencrypted.

           <b>LUKS2</b>: When used together with --reduce-device-size, only the initial <u>size</u> value (--device-size
           parameter) of data is shifted backwards while being encrypted.

           <b>NOTE</b>: The sum of --device-size and --reduce-device-size values must not exceed real device size.

           <b>WARNING:</b> This is destructive operation. Data beyond --device-size limit may be lost after operation
           gets finished.

           If no unit suffix is specified, the size is in bytes.

           Unit suffix can be S for 512 byte sectors, K/M/G/T (or KiB,MiB,GiB,TiB) for units with 1024 base or
           KB/MB/GB/TB for 1000 base (SI scale).

       <b>--disable-blkid</b>
           Disable use of blkid library for checking and wiping on-disk signatures.

       <b>--disable-keyring</b>
           Do not load volume key in kernel keyring and store it directly in the dm-crypt target instead. This
           option is supported only for the LUKS2 type.

       <b>--disable-locks</b>
           Disable lock protection for metadata on disk. This option is valid only for LUKS2 and ignored for
           other formats.

           <b>NOTE:</b> With locking disabled LUKS2 images in files can be fully (re)encrypted offline without need for
           super user privileges provided used block ciphers are available in crypto backend.

           <b>WARNING:</b> Do not use this option unless you run cryptsetup in a restricted environment where locking
           is impossible to perform (where <a href="file:/run">/run</a> directory cannot be used).

       <b>--encrypt,</b> <b>--new,</b> <b>-N</b>
           Initialize (and run) device in-place encryption mode.

       <b>--force-no-keyslots</b> <b>(LUKS2</b> <b>only)</b>
           Enforce initialization of reencryption operation with additional --volume-key-file,
           --new-volume-key-file, --volume-key-keyring or --new-volume-key-keyring parameters that would result
           in deletion of all remaining LUKS2 keyslots containing volume key.

           <b>NOTE:</b> LUKS2 keyslot with new volume key may be added after the reencryption operation is finished.
           See <b><a href="../man8/cryptsetup-luksAddKey.8.html">cryptsetup-luksAddKey</a></b>(8) command.

           <b>WARNING:</b> Use with extreme caution! If you loose volume key stored in a file or in a kernel keyring
           before adding LUKS2 keyslot containing new volume key the device will become unusable and all data
           will be lost.

       <b>--force-offline-reencrypt</b> <b>(LUKS2</b> <b>only)</b>
           Bypass active device auto-detection and enforce offline reencryption.

           This option is useful especially for reencryption of LUKS2 images put in files (auto-detection is not
           reliable in this scenario).

           It may also help in case active device auto-detection on particular data device does not work or
           report errors.

           <b>WARNING:</b> Use with extreme caution! This may destroy data if the device is activated and/or actively
           used.

       <b>--force-password</b>
           Do not use password quality checking for new LUKS passwords.

           This option is ignored if cryptsetup is built without password quality checking support.

           For more info about password quality check, see the manual page for <b><a href="../man5/pwquality.conf.5.html">pwquality.conf</a>(5)</b> and
           <b><a href="../man5/passwdqc.conf.5.html">passwdqc.conf</a>(5)</b>.

       <b>--hash,</b> <b>-h</b> <u>&lt;hash-spec&gt;</u>
           <b>LUKS1:</b> Specifies the hash used in the LUKS1 key setup scheme and volume key digest.

           <b>NOTE</b>: if this parameter is not specified, default hash algorithm is always used for new LUKS1 device
           header.

           <b>LUKS2:</b> Ignored unless new keyslot pbkdf algorithm is set to PBKDF2 (see --pbkdf).

       <b>--header</b> <b>&lt;device</b> <b>or</b> <b>file</b> <b>storing</b> <b>the</b> <b>LUKS</b> <b>header&gt;</b>
           Use a detached (separated) metadata device or file where the LUKS header is stored. This option
           allows one to store ciphertext and LUKS header on different devices.

           If used with --encrypt/--new option, the header file will be created (or overwritten). Use with care.

           <b>LUKS2</b>: For decryption mode the option may be used to export original LUKS2 header to a detached file.
           The passed future file must not exist at the time of initializing the decryption operation. This
           frees space in head of data device so that data can be moved at original LUKS2 header location. Later
           on decryption operation continues as if the ordinary detached header was passed.

           <b>WARNING:</b> Never put exported header file in a filesystem on top of device you are about to decrypt! It
           would cause a deadlock.

       <b>--help,</b> <b>-?</b>
           Show help text and default parameters.

       <b>--hotzone-size</b> <u>size</u> <b>(LUKS2</b> <b>only)</b>
           This option can be used to set an upper limit on the size of reencryption area (hotzone). The <u>size</u>
           can be specified with unit suffix (for example 50M). Note that actual hotzone size may be less than
           specified &lt;size&gt; due to other limitations (free space in keyslots area or available memory).

           With decryption mode for devices with LUKS2 header placed in head of data device, the option
           specifies how large is the first data segment moved from original data offset pointer.

       <b>--init-only</b> <b>(LUKS2</b> <b>only)</b>
           Initialize reencryption (any mode) operation in LUKS2 metadata only and exit. If any reencrypt
           operation is already initialized in metadata, the command with --init-only parameter fails.

       <b>--iter-time,</b> <b>-i</b> <b>&lt;number</b> <b>of</b> <b>milliseconds&gt;</b>
           The number of milliseconds to spend with PBKDF passphrase processing for the new LUKS header.

       <b>--keep-key</b>
           <b>LUKS2</b>: Do not change effective volume key and change other parameters provided it is requested.

           <b>LUKS1</b>: Reencrypt only the LUKS1 header and keyslots. Skips data in-place reencryption.

       <b>--key-file,</b> <b>-d</b> <u>name</u>
           Read the passphrase from file.

           If the name given is "-", then the passphrase will be read from stdin. In this case, reading will not
           stop at newline characters.

           <b>WARNING:</b> --key-file option can be used only if there is only one active keyslot, or alternatively,
           also if --key-slot option is specified (then all other keyslots will be disabled in new LUKS device).

           If this option is not used, cryptsetup will ask for all active keyslot passphrases.

       <b>--keyfile-offset</b> <u>value</u>
           Skip <u>value</u> bytes at the beginning of the key file.

       <b>--keyfile-size,</b> <b>-l</b> <u>value</u>
           Read a maximum of <u>value</u> bytes from the key file. The default is to read the whole file up to the
           compiled-in maximum that can be queried with --help. Supplying more data than the compiled-in maximum
           aborts the operation.

           This option is useful to cut trailing newlines, for example. If --keyfile-offset is also given, the
           size count starts after the offset.

       <b>--key-size,</b> <b>-s</b> <u>bits</u>
           <b>LUKS2</b>: Provide current key size in <u>bits</u>. The argument has to be a multiple of 8. Useful when
           specifying the size of current volume key when no keyslot is active.

           <b>LUKS1</b>: See --new-key-size.

       <b>--key-slot,</b> <b>-S</b> <b>&lt;0-N&gt;</b>
           For LUKS operations that add key material, this option allows you to specify which key slot is
           selected for the new key.

           For reencryption mode it selects specific keyslot (and passphrase) that can be used to unlock new
           volume key. If used all other keyslots get removed after reencryption operation is finished.

           The maximum number of key slots depends on the LUKS version. LUKS1 can have up to 8 key slots. LUKS2
           can have up to 32 key slots based on key slot area size and key size, but a valid key slot ID can
           always be between 0 and 31 for LUKS2.

       <b>--keyslot-cipher</b> <b>&lt;cipher-spec&gt;</b>
           This option can be used to set specific cipher encryption for the LUKS2 keyslot area.

       <b>--keyslot-key-size</b> <b>&lt;bits&gt;</b>
           This option can be used to set specific key size for the LUKS2 keyslot area.

       <b>--label</b> <b>&lt;LABEL&gt;</b> <b>--subsystem</b> <b>&lt;SUBSYSTEM&gt;</b>
           Set label and subsystem description for LUKS2 device. The label and subsystem are optional fields and
           can be later used in udev scripts for triggering user actions once the device marked by these labels
           is detected.

       <b>--luks2-keyslots-size</b> <b>&lt;size&gt;</b>
           This option can be used to set specific size of the LUKS2 binary keyslot area (key material is
           encrypted there). The value must be aligned to multiple of 4096 bytes with maximum size 128MB. The
           &lt;size&gt; can be specified with unit suffix (for example 128k).

       <b>--luks2-metadata-size</b> <b>&lt;size&gt;</b>
           This option can be used to enlarge the LUKS2 metadata (JSON) area. The size includes 4096 bytes for
           binary metadata (usable JSON area is smaller of the binary area). According to LUKS2 specification,
           only these values are valid: 16, 32, 64, 128, 256, 512, 1024, 2048 and 4096 kB The &lt;size&gt; can be
           specified with unit suffix (for example 128k).

       <b>--new-key-size</b> <u>bits</u>
           Sets new key size in <u>bits</u>. The argument has to be a multiple of 8. The possible key-sizes are limited
           by the new cipher and mode used in reencryption.

           See <a href="file:/proc/crypto">/proc/crypto</a> for more information. Note that key-size in <a href="file:/proc/crypto">/proc/crypto</a> is stated in bytes.

           <b>LUKS1</b>: If you are increasing key size, there must be enough space in the LUKS header for enlarged
           keyslots (data offset must be large enough) or reencryption cannot be performed.

           If there is not enough space for keyslots with new key size, you can destructively shrink device with
           --reduce-device-size option.

       <b>--new-volume-key-file</b>
           Use (set) new volume key stored in a file. The option must be paired with --new-key-size parameter
           when initializing reencryption operation.

           <b>WARNING:</b> If you create your own volume key, you need to make sure to do it right. Otherwise, you can
           end up with a low-entropy or otherwise partially predictable volume key which will compromise
           security.

       <b>--new-volume-key-keyring</b> <u>&lt;key</u> <u>description&gt;</u>
           Use (set) new volume key stored in a keyring.

           The size of key stored in a keyring must be compatible with new cipher used in reencryption
           operation. See <a href="file:/proc/crypto">/proc/crypto</a> for more information. Note that key-size in <a href="file:/proc/crypto">/proc/crypto</a> is stated in
           bytes.

           The <u>&lt;key</u> <u>description&gt;</u> uses keyctl-compatible syntax. This can either be a numeric key ID or a string
           name in the format <u>%&lt;key</u> <u>type&gt;:&lt;key</u> <u>name&gt;</u>. See also <b>KEY</b> <b>IDENTIFIERS</b> section of <b><a href="../man1/keyctl.1.html">keyctl</a></b>(1). When no
           <u>%&lt;key</u> <u>type&gt;:</u> prefix is specified we assume the key type is <u>user</u> (default type).

           <b>WARNING:</b> If you create your own volume key, you need to make sure to do it right. Otherwise, you can
           end up with a low-entropy or otherwise partially predictable volume key which will compromise
           security.

       <b>--offset,</b> <b>-o</b> <b>&lt;number</b> <b>of</b> <b>512</b> <b>byte</b> <b>sectors&gt;</b>
           Start offset in the backend device in 512-byte sectors. This option is only relevant for the encrypt
           mode.

           The --offset option sets the data offset (payload) of data device and must be aligned to 4096-byte
           sectors (must be multiple of 8). This option cannot be combined with --align-payload option.

       <b>--pbkdf</b> <b>&lt;PBKDF</b> <b>spec&gt;</b>
           Set Password-Based Key Derivation Function (PBKDF) algorithm for LUKS keyslot. The PBKDF can be:
           <u>pbkdf2</u> (for PBKDF2 according to RFC2898), <u>argon2i</u> for Argon2i or <u>argon2id</u> for Argon2id (see Argon2
           &lt;https://www.cryptolux.org/index.php/Argon2&gt; for more info).

           For LUKS1, only PBKDF2 is accepted (no need to use this option). The default PBKDF for LUKS2 is set
           during compilation time and is available in <u>cryptsetup</u> <u>--help</u> output.

           A PBKDF is used for increasing dictionary and brute-force attack cost for keyslot passwords. The
           parameters can be time, memory and parallel cost.

           For PBKDF2, only time cost (number of iterations) applies. For Argon2i/id, there is also memory cost
           (memory required during the process of key derivation) and parallel cost (number of threads that run
           in parallel during the key derivation.

           Note that increasing memory cost also increases time, so the final parameter values are measured by a
           benchmark. The benchmark tries to find iteration time (<u>--iter-time</u>) with required memory cost
           <u>--pbkdf-memory</u>. If it is not possible, the memory cost is decreased as well. The parallel cost
           <u>--pbkdf-parallel</u> is constant and is checked against available CPU cores.

           You can see all PBKDF parameters for particular LUKS2 keyslot with <b><a href="../man8/cryptsetup-luksDump.8.html">cryptsetup-luksDump</a></b>(8) command.

           <b>NOTE:</b> If you do not want to use benchmark and want to specify all parameters directly, use
           <u>--pbkdf-force-iterations</u> with <u>--pbkdf-memory</u> and <u>--pbkdf-parallel</u>. This will override the values
           without benchmarking. Note it can cause extremely long unlocking time or cause out-of-memory
           conditions with unconditional process termination. Use only in specific cases, for example, if you
           know that the formatted device will be used on some small embedded system.

           <b>MINIMAL</b> <b>AND</b> <b>MAXIMAL</b> <b>PBKDF</b> <b>COSTS:</b> For <b>PBKDF2</b>, the minimum iteration count is 1000 and maximum is
           4294967295 (maximum for 32bit unsigned integer). Memory and parallel costs are unused for PBKDF2. For
           <b>Argon2i</b> and <b>Argon2id</b>, minimum iteration count (CPU cost) is 4 and maximum is 4294967295 (maximum for
           32bit unsigned integer). Minimum memory cost is 32 KiB and maximum is 4 GiB. (Limited by addressable
           memory on some CPU platforms.) If the memory cost parameter is benchmarked (not specified by a
           parameter) it is always in range from 64 MiB to 1 GiB. The parallel cost minimum is 1 and maximum 4
           (if enough CPUs cores are available, otherwise it is decreased).

       <b>--pbkdf-force-iterations</b> <b>&lt;num&gt;</b>
           Avoid PBKDF benchmark and set time cost (iterations) directly. It can be used for LUKS/LUKS2 device
           only. See <u>--pbkdf</u> option for more info.

       <b>--pbkdf-memory</b> <b>&lt;number&gt;</b>
           Set the memory cost for PBKDF (for Argon2i/id the number represents kilobytes). Note that it is
           maximal value, PBKDF benchmark or available physical memory can decrease it. This option is not
           available for PBKDF2.

       <b>--pbkdf-parallel</b> <b>&lt;number&gt;</b>
           Set the parallel cost for PBKDF (number of threads, up to 4). Note that it is maximal value, it is
           decreased automatically if CPU online count is lower. This option is not available for PBKDF2.

       <b>--progress-frequency</b> <u>seconds</u>
           Print separate line every <u>seconds</u> with reencryption progress.

       <b>--progress-json</b>
           Prints progress data in JSON format suitable mostly for machine processing. It prints separate line
           every half second (or based on <u>--progress-frequency</u> value). The JSON output looks as follows during
           progress (except it’s compact single line):

               {
                 "device":"/dev/sda",      // backing device or file
                 "device_bytes":"8192",    // bytes of I/O so far
                 "device_size":"44040192", // total bytes of I/O to go
                 "speed":"126877696",      // calculated speed in bytes per second (based on progress so far)
                 "eta_ms":"2520012",       // estimated time to finish an operation in milliseconds
                 "time_ms":"5561235"       // total time spent in IO operation in milliseconds
               }

           Note on numbers in JSON output: Due to JSON parsers limitations all numbers are represented in a
           string format due to need of full 64bit unsigned integers.

       <b>--reduce-device-size</b> <u>size</u>
           This means that last <u>size</u> sectors on the original device will be lost, data will be effectively
           shifted by specified number of sectors.

           It could be useful if you added some space to underlying partition or logical volume (so last <u>size</u>
           sectors contains no data).

           For units suffix see --device-size parameter description.

           <b>WARNING:</b> This is a destructive operation and cannot be reverted. Use with extreme care - accidentally
           overwritten filesystems are usually unrecoverable.

           <b>LUKS2</b>: Initialize LUKS2 reencryption with data device size reduction (currently only encryption mode
           is supported). The last <u>size</u> sectors on the original plaintext device is used for temporarily storing
           original first data segment. The former first data segment is replaced with LUKS2 header (half the
           <u>size</u> value) and plaintext data are shifted backwards ( again half the <u>size</u> value) while being
           encrypted.

           Recommended minimal size is twice the default LUKS2 header size (--reduce-device-size 32M) for
           encryption mode.

           <b>NOTE</b>: The sum of --device-size and --reduce-device-size values must not exceed real device size.

           <b>LUKS1</b>: Enlarge data offset to specified value by shrinking device size.

           You cannot shrink device more than by 64 MiB (131072 sectors).

       <b>--resilience</b> <u>mode</u> <b>(LUKS2</b> <b>only)</b>
           Reencryption resilience <u>mode</u> can be one of <u>checksum</u>, <u>journal</u> or <u>none</u>.

           <u>checksum</u>: default mode, where individual checksums of ciphertext hotzone sectors are stored, so the
           recovery process can detect which sectors were already reencrypted. It requires that the device
           sector write is atomic.

           <u>journal</u>: the hotzone is journaled in the binary area (so the data are written twice).

           <u>none</u>: performance mode. There is no protection and the only way it’s safe to interrupt the
           reencryption is similar to old offline reencryption utility.

           Resilience modes can be changed unless <u>datashift</u> mode is used for operation initialization
           (encryption with --reduce-device-size option)

       <b>--resilience-hash</b> <u>hash</u> <b>(LUKS2</b> <b>only)</b>
           The <u>hash</u> algorithm used with "--resilience checksum" only. The default hash is sha256. With other
           resilience modes, the hash parameter is ignored.

       <b>--resume-only</b> <b>(LUKS2</b> <b>only)</b>
           Resume reencryption (any mode) operation already described in LUKS2 metadata. If no reencrypt
           operation is initialized, the command with --resume-only parameter fails. Useful for resuming
           reencrypt operation without accidentally triggering new reencryption operation.

       <b>--sector-size</b> <u>bytes</u> <b>(LUKS2</b> <b>only)</b>
           Reencrypt device with new encryption sector size enforced.

           <b>WARNING:</b> Increasing encryption sector size may break hosted filesystem. Do not run reencryption with
           --force-offline-reencrypt if unsure what block size was filesystem formatted with.

       <b>--timeout,</b> <b>-t</b> <b>&lt;number</b> <b>of</b> <b>seconds&gt;</b>
           The number of seconds to wait before timeout on passphrase input via terminal. It is relevant every
           time a passphrase is asked. It has no effect if used in conjunction with --key-file.

           This option is useful when the system should not stall if the user does not input a passphrase, e.g.
           during boot. The default is a value of 0 seconds, which means to wait forever.

       <b>--token-id</b>
           <b>LUKS2</b> <b>reencryption</b> <b>initialization:</b> Specify what keyslots (associated with selected token) to use for
           LUKS2 reencryption. If reencryption operation changes effective volume key only keyslots associated
           the token and unlocked successfully will be available after the reencryption operation is finished.

           <b>LUKS2</b> <b>reencryption</b> <b>resume:</b> Specify what token to use and allow token PIN prompt to take precedence
           over interactive keyslot passphrase prompt. If omitted, all available tokens (not protected by PIN)
           will be checked before proceeding further with passphrase prompt.

       <b>--token-only</b>
           <b>LUKS2</b> <b>reencryption</b> <b>initialization:</b> Specify all keyslots associated with any token will be used for
           LUKS2 reencryption. If reencryption operation changes effective volume key only keyslots associated
           with any token will be available after the reencryption operation is finished.

           <b>LUKS2</b> <b>reencryption</b> <b>resume:</b> Do not proceed further with action if token based keyslot unlock failed.
           Without the option, action asks for passphrase to proceed further.

           It allows LUKS2 tokens protected by PIN to take precedence over interactive keyslot passphrase
           prompt.

       <b>--token-type</b> <u>type</u>
           <b>LUKS2</b> <b>reencryption</b> <b>initialization:</b> Specify what keyslots (associated with selected token type) to use
           for LUKS2 reencryption. If reencryption operation changes effective volume key only keyslots
           associated the token type and unlocked successfully will be available after the reencryption
           operation is finished.

           <b>LUKS2</b> <b>reencryption</b> <b>resume:</b> Restrict tokens eligible for operation to specific token <u>type</u>. Mostly
           useful when no --token-id is specified.

           It allows LUKS2 <u>type</u> tokens protected by PIN to take precedence over interactive keyslot passphrase
           prompt.

       <b>--tries,</b> <b>-T</b>
           How often the input of the passphrase shall be retried. The default is 3 tries.

       <b>--type</b> <b>&lt;device-type&gt;</b>
           Specifies required (encryption mode) or expected (other modes) LUKS format. Accepts only <u>luks1</u> or
           <u>luks2</u>.

       <b>--usage</b>
           Show short option help.

       <b>--use-directio</b> <b>(LUKS1</b> <b>only)</b>
           Use direct-io (O_DIRECT) for all read/write data operations related to block device undergoing
           reencryption.

           Useful if direct-io operations perform better than normal buffered operations (e.g. in virtual
           environments).

       <b>--use-fsync</b> <b>(LUKS1</b> <b>only)</b>
           Use fsync call after every written block. This applies for reencryption log files as well.

       <b>--use-random</b>, <b>--use-urandom</b>
           Define which kernel random number generator will be used to create the volume key.

       <b>--uuid</b> <b>&lt;UUID&gt;</b>
           When used in encryption mode use the provided <u>UUID</u> for the new LUKS header instead of generating a
           new one.

           <b>LUKS1</b> <b>(only</b> <b>in</b> <b>decryption</b> <b>mode)</b>: To find out what <u>UUID</u> to pass look for temporary files
           LUKS-<u>UUID</u>.[|log|org|new] of the interrupted decryption process.

           The <u>UUID</u> must be provided in the standard UUID format, e.g. 12345678-1234-1234-1234-123456789abc.

       <b>--verify-passphrase,</b> <b>-y</b>
           When interactively asking for a passphrase, ask for it twice and complain if both inputs do not
           match. Ignored on input from file or stdin.

       <b>--version,</b> <b>-V</b>
           Show the program version.

       <b>--volume-key-file,</b> <b>--master-key-file</b> <b>(OBSOLETE</b> <b>alias)</b>
           <b>LUKS2</b>: Provides current volume key stored in a file. It can be used to reencrypt the device with no
           active keyslot together with --new-volume-key-file or --new-volume-key-keyring options.

           <b>LUKS1</b>: See --new-volume-key-file.

       <b>--write-log</b> <b>(LUKS1</b> <b>only)</b>
           Update log file after every block write. This can slow down reencryption but will minimize data loss
           in the case of system crash.

</pre><h4><b>EXAMPLES</b></h4><pre>
       <b>NOTE</b>: You may drop <b>--type</b> <b>luks2</b> option as long as LUKS2 format is default.

   <b>LUKS2</b> <b>ENCRYPTION</b> <b>EXAMPLES</b>
       Encrypt LUKS2 device (in-place). Make sure last 32 MiB on <u>/dev/plaintext</u> is unused (e.g.: does not
       contain filesystem data):

       <b>cryptsetup</b> <b>reencrypt</b> <b>--encrypt</b> <b>--type</b> <b>luks2</b> <b>--reduce-device-size</b> <b>32m</b> <b>/dev/plaintext_device</b>

       Encrypt LUKS2 device (in-place). Only the initial 1 GiB of original <u>/dev/plaintext</u> data is encrypted
       while being shifted backwards. Make sure last 32 MiB (tail) on the data device is unused (e.g.: does not
       contain any data):

       <b>cryptsetup</b> <b>reencrypt</b> <b>--encrypt</b> <b>--type</b> <b>luks2</b> <b>--device-size</b> <b>1g</b> <b>--reduce-device-size</b> <b>32m</b>
       <b>/dev/plaintext_device</b>

       Encrypt LUKS2 device (in-place) with detached header put in a file:

       <b>cryptsetup</b> <b>reencrypt</b> <b>--encrypt</b> <b>--type</b> <b>luks2</b> <b>--header</b> <b>my_luks2_header</b> <b>/dev/plaintext_device</b>

       Initialize LUKS2 in-place encryption operation only and activate the device (not yet encrypted):

       <b>cryptsetup</b> <b>reencrypt</b> <b>--encrypt</b> <b>--type</b> <b>luks2</b> <b>--init-only</b> <b>--reduce-device-size</b> <b>32m</b> <b>/dev/plaintext_device</b>
       <b>my_future_luks_device</b>

       Resume online encryption on device initialized in example above:

       <b>cryptsetup</b> <b>reencrypt</b> <b>--resume-only</b> <b>/dev/plaintext_device</b> or <b>cryptsetup</b> <b>reencrypt</b> <b>--active-name</b>
       <b>my_future_luks_device</b>

   <b>LUKS2</b> <b>REENCRYPTION</b> <b>EXAMPLES</b>
       Reencrypt LUKS2 device (refresh volume key only):

       <b>cryptsetup</b> <b>reencrypt</b> <b>/dev/encrypted_device</b>

       Reencrypt LUKS2 device using keyslot(s) associated to the token 3. All other keyslots will be removed
       after the reencryption finishes.

       <b>cryptsetup</b> <b>reencrypt</b> <b>--token-id</b> <b>3</b> <b>/dev/encrypted_device</b>

       Reencrypt LUKS2 device using keyslots associated to all 'systemd-tpm2' tokens. All other keyslots will be
       removed after the reencryption finishes.

       <b>cryptsetup</b> <b>reencrypt</b> <b>--token-type</b> <b>systemd-tpm2</b> <b>/dev/encrypted_device</b>

   <b>LUKS2</b> <b>DECRYPTION</b> <b>EXAMPLES</b>
       Decrypt LUKS2 device with header put in head of data device (header file does not exist):

       <b>cryptsetup</b> <b>reencrypt</b> <b>--decrypt</b> <b>--header</b> <b>/export/header/to/file</b> <b>/dev/encrypted_device</b>

       Decrypt LUKS2 device with detached header (header file exists):

       <b>cryptsetup</b> <b>reencrypt</b> <b>--decrypt</b> <b>--header</b> <b>detached-luks2-header</b> <b>/dev/encrypted_device</b>

       Resume interrupted LUKS2 decryption:

       <b>cryptsetup</b> <b>reencrypt</b> <b>--resume-only</b> <b>--header</b> <b>luks2-hdr-file</b> <b>/dev/encrypted_device</b>

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs at <b>cryptsetup</b> <b>mailing</b> <b>list</b> &lt;<a href="mailto:cryptsetup@lists.linux.dev">cryptsetup@lists.linux.dev</a>&gt; or in <b>Issues</b> <b>project</b> <b>section</b>
       &lt;https://gitlab.com/cryptsetup/cryptsetup/-/issues/new&gt;.

       Please attach output of the failed command with --debug option added.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>Cryptsetup</b> <b>FAQ</b> &lt;https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions&gt;

       <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8), <b><a href="../man8/integritysetup.8.html">integritysetup</a></b>(8) and <b><a href="../man8/veritysetup.8.html">veritysetup</a></b>(8)

</pre><h4><b>CRYPTSETUP</b></h4><pre>
       Part of <b>cryptsetup</b> <b>project</b> &lt;https://gitlab.com/cryptsetup/cryptsetup/&gt;.

cryptsetup 2.8.0                                   2025-07-25                            <u><a href="../man8/CRYPTSETUP-REENCRYPT.8.html">CRYPTSETUP-REENCRYPT</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>