<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>srp_daemon - Discovers SRP targets in an InfiniBand Fabric</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/srptools">srptools_56.1-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       srp_daemon - Discovers SRP targets in an InfiniBand Fabric

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>srp_daemon</b>  [<b>-vVcaeon</b>]  [<b>-d</b>  <u>umad-device</u>  |  <b>-i</b>  <u>infiniband-device</u>  [<b>-p</b>  <u>port-num</u>]  |  <b>-j</b>  <u>dev:port</u>]  [<b>-t</b>
       <u><a href="../manms/timeout.ms.html">timeout</a>(ms)</u>] [<b>-r</b> <u>retries</u>] [<b>-R</b> <u>rescan-time</u>] [<b>-f</b> <u>rules-file</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Discovers and connects to InfiniBand SCSI RDMA Protocol (SRP) targets in an IB fabric.

       Each srp_daemon instance operates on one local port. Upon boot it performs a full rescan  of  the  fabric
       and then waits for an srp_daemon event. An srp_daemon event can be a join of a new machine to the fabric,
       a change in the capabilities of a machine, an SA change, or an expiration of a predefined timeout.

       When  a new machine joins the fabric, srp_daemon checks if it is an SRP target. When there is a change of
       capabilities, srp_daemon checks if the machine has turned into an SRP target. When there is an SA  change
       or a timeout expiration, srp_daemon performs a full rescan of the fabric.

       For  each  target  srp_daemon finds, it checks if it should connect to this target according to its rules
       (the default rules file is /etc/srp_daemon.conf) and if it is already connected to the local port. If  it
       should  connect  to  this  target  and if it is not connected yet, srp_daemon can either print the target
       details or connect to it.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-v</b>     Print more verbose output

       <b>-V</b>     Print even more verbose output (debug mode)

       <b>-i</b> <u>infiniband-device</u>
              Work on <u>infiniband-device</u>. This option should not be used with -d nor with -j.

       <b>-p</b> <u>port-num</u>
              Work on port <u>port-num</u> (default 1). This option must be used with -i and should not be used with -d
              nor with -j.

       <b>-j</b> <u>dev:port</u>
              Work on port number <u>port</u> of InfiniBand device <u>dev</u>. This option should not be used with -d, -i  nor
              with -p.

       <b>-d</b> <u>umad-device</u>
              Use  device  file  <u>umad-device</u> (default /dev/infiniband/umad0) This option should not be used with
              -i, -p nor with -j.

       <b>-c</b>     Generate        output        suitable        for        piping        directly        to        a
              /sys/class/infiniband_srp/srp-&lt;device&gt;-&lt;port&gt;/add_target file.

       <b>-a</b>     Prints  all  the  targets in the fabric, not only targets that are not connected through the local
              port. This is the same behavior as that of ibsrpdm.

       <b>-e</b>     Execute the connection command, i.e., make the connection to the target.

       <b>-o</b>     Perform only one rescan and exit just like ibsrpdm.

       <b>-R</b> <u>rescan-time</u>
              Force a complete rescan every <u>rescan-time</u> seconds. If -R is not specified, no timeout rescans will
              be performed.

       <b>-T</b> <u>retry-timeout</u>
              Retries to connect to existing target after <u>retry-timeout</u> seconds. If -R is not specified, uses  5
              Seconds  timeout.  if retry-timeout is 0, will not try to reconnect. The reason srp_daemon retries
              to connect to the target is because there may be a rare scnerio in which srp_daemon  will  try  to
              connect to add a target when the target is about to be removed, but is not removed yet.

       <b>-f</b> <u>rules-file</u>
              Decide  to which targets to connect according to the rules in <u>rules-file</u>.  If <b>-f</b> is not specified,
              uses the default rules file /etc/srp_daemon.conf.  Each line in the <u>rules-file</u> is a rule which can
              be either an allow connection or a disallow connection according to the  first  character  in  the
              line  (a or d accordingly). The rest of the line is values for id_ext, ioc_guid, dgid, service_id.
              Please take a look at the example section for an example of the file. srp_daemon decide whether to
              allow or disallow each target according  to first rule that match the target. If no  rule  matches
              the  target,  the  target is allowed and will be connected. In an allow rule it is possible to set
              attributes for the  connection  to  the  target.  Supported  attributes  are  max_cmd_per_lun  and
              max_sect.

       <b>-t</b> <u>timeout</u>
              Use timeout of <u>timeout</u> msec for MAD responses (default: 5 sec).

       <b>-r</b> <u>retries</u>
              Perform <u>retries</u> retries on each send to MAD (default: 3 retries).

       <b>-n</b>     New format - use also initiator_ext in the connection command.

       <b>--systemd</b>
              Enable systemd integration.

</pre><h4><b>FILES</b></h4><pre>
       /etc/srp_daemon.conf  -  Default rules configuration file that indicates to which targets to connect. Can
       be overridden using the <b>-f</b> <u>rules-file</u> option.  Each line in this file is a rule which can  be  either  an
       allow  connection  or  a  disallow  connection  according  to  the  first  character  in the line (a or d
       accordingly). The rest of the line is values for id_ext, ioc_guid, dgid, service_id. Please take  a  look
       at  the  example  section for an example of the file. srp_daemon decide whether to allow or disallow each
       target according  to first rule that match the target. If no rule  matches  the  target,  the  target  is
       allowed  and  will  be connected. In an allow rule it is possible to set attributes for the connection to
       the target. Supported attributes are max_cmd_per_lun and max_sect.

</pre><h4><b>EXAMPLES</b></h4><pre>
       srp_daemon -e -i mthca0 -p 1 -R 60 (Connects to the targets accessible through port 1 of mthca0. Performs
       a complete rescan every minute)

       srp_daemon -o -c -a          (Prints the connection commands for the targets in the fabric  and  exits  -
       similar to ibsrpdm)

       srp_daemon -e -f rules.txt        (Connects to the targets allowed in the rules file rules.txt)

       An example for a rules configuration file (such as /etc/srp_daemon.conf)
       ------------------------------------------------------------------------
       # Rules file example
       # This is a comment
       # disallow the following dgid
       d       dgid=fe800000000000000002c90200402bd5
       # allow target with the following ioc_guid
       a       ioc_guid=00a0b80200402bd7
       # allow target with the following id_ext and ioc_guid. And setting max_cmd_per_lun to 31.
       a       id_ext=200500A0B81146A1,ioc_guid=00a0b80200402bef,max_cmd_per_lun=31
       # disallow all the rest
       d

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/ibsrpdm.8.html">ibsrpdm</a></b>(8)

</pre><h4><b>AUTHORS</b></h4><pre>
       Roland Dreier
              &lt;<u><a href="mailto:rolandd@cisco.com">rolandd@cisco.com</a></u>&gt;

       Ishai Rabinovitz
              &lt;<u><a href="mailto:ishai@mellanox.co.il">ishai@mellanox.co.il</a></u>&gt;

OpenFabrics                                     September 5, 2006                                  <u><a href="../man8/SRP_DAEMON.8.html">SRP_DAEMON</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>