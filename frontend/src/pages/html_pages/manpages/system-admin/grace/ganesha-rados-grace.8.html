<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ganesha-rados-grace - manipulate the shared grace management database</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/nfs-ganesha-rados-grace">nfs-ganesha-rados-grace_6.5-5_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ganesha-rados-grace - manipulate the shared grace management database

</pre><h4><b>SYNOPSIS</b></h4><pre>
       ganesha-rados-grace [ --cephconf /path/to/ceph.conf ] [--ns namespace] [ --oid obj_id ] [ --pool pool_id ] [ --userid cephuser ] dump|add|start|join|lift|remove|enforce|noenforce|member [ nodeid ... ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This tool allows the administrator to directly manipulate the database used by the rados_cluster recovery
       backend.  Cluster  nodes  use  that  database  to  indicate  their current state in order to coordinate a
       cluster-wide grace period.

       The first argument should be a  command  to  execute  against  the  database.   Any  remaining  arguments
       represent the nodeids of nodes in the cluster that should be acted upon.

       Most  commands will just fail if the grace database is not present. The exception to this rule is the <b>add</b>
       command which will create the pool, database and namespace if they do not already exist.

       Note that this program does not consult ganesha.conf.  If  you  use  non-default  values  for  <b>ceph_conf</b>,
       <b>userid</b>,  <b>grace_oid</b>, <b>namespace</b> or <b>pool</b> in your RADOS_KV config block, then they will need to passed in via
       command-line options.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--cephconf</b>

       Specify the ceph.conf configuration that should be used (default is to use the normal search path to find
       one)

       <b>--ns</b>

       Set the RADOS namespace to use within the pool (default is NULL)

       <b>--oid</b>

       Set the object id of the grace database RADOS object (default is "grace")

       <b>--pool</b>

       Set the RADOS poolid in which the grace database object resides (default is "nfs-ganesha")

       <b>--userid</b>

       Set the cephx user ID to use when contacting the cluster (default is NULL)

</pre><h4><b>COMMANDS</b></h4><pre>
       <b>dump</b>

       Dump the current status of the grace period database to stdout. This will show the current  and  recovery
       epoch serial numbers, as well as a list of hosts currently in the cluster and what flags they have set in
       their individual records.

       <b>add</b>

       Add  the  specified  hosts  to the cluster. This must be done before the given hosts can take part in the
       cluster. Attempts to modify the database by cluster hosts that have not yet  been  added  will  generally
       fail.  New  hosts  are  added with the enforcing flag set, as they are unable to hand out new state until
       their own grace period has been lifted.

       <b>start</b>

       Start a new grace period. This will begin a new grace period in the cluster if one is not already  active
       and  set  the  record for the listed cluster hosts as both needing a grace period and enforcing the grace
       period. If a grace period is already active, then this is equivalent to <b>join</b>.

       <b>join</b>

       Attempt to join an existing grace period. This works like <b>start</b>, but only if there is already an existing
       grace period in force.

       <b>lift</b>

       Attempt to lift the current grace period. This will clear the need grace flags for the listed  hosts.  If
       there  are no more hosts in the cluster that require a grace period, then it will be fully lifted and the
       cluster will transition to normal operations.

       <b>remove</b>

       Remove one or more existing hosts from the cluster. This will remove the  listed  hosts  from  the  grace
       database, possibly lifting the current grace period if there are no more hosts that need one.

       <b>enforce</b>

       Set  the  flag for the given hosts that indicates that they are currently enforcing the grace period; not
       allowing the acquisition of new state by clients.

       <b>noenforce</b>

       Clear the enforcing flag for the given hosts, meaning that  those  hosts  are  now  allowing  clients  to
       acquire new state.

       <b>member</b>

       Test  whether  the  given  hosts are members of the cluster. Returns an error if any of the hosts are not
       present in the grace db omap.

</pre><h4><b>FLAGS</b></h4><pre>
       When the <b>dump</b> command is issued, ganesha-rados-grace will display a list of all of the nodes in the grace
       database, and any flags they have set.  The flags are as follows:

       <b>E</b> <b>(Enforcing)</b>

       The node is currently enforcing the grace period by rejecting requests from clients to acquire new state.

       <b>N</b> <b>(Need</b> <b>Grace)</b>

       The node currently requires a grace period. Generally, this means that the node has clients that need  to
       perform recovery.

</pre><h4><b>NODEID</b> <b>ASSIGNMENT</b></h4><pre>
       Each  running  ganesha daemon requires a <b>nodeid</b> string that is unique within the cluster. This can be any
       value as ganesha treats it as an opaque string. By default, the ganesha daemon will use the  hostname  of
       the node where it is running.

       This  may  not  be  suitable  when  running under certain HA clustering infrastructure, so it's generally
       recommended to manually assign nodeid values to the hosts in the <b>RADOS_KV</b> config block of <b>ganesha.conf</b>.

</pre><h4><b>GANESHA</b> <b>CONFIGURATION</b></h4><pre>
       The ganesha daemon will need to be configured with the RecoveryBackend set to <b>rados_cluster</b>. If you use a
       non-default pool, namespace or oid, nodeid then those values will need  to  be  set  accordingly  in  the
       <b>RADOS_KV</b> config block as well.

</pre><h4><b>STARTING</b> <b>A</b> <b>NEW</b> <b>CLUSTER</b></h4><pre>
       First,  add  the  given  cluster nodes to the grace database. Assuming that the nodes in our cluster will
       have nodeids ganesha-1 through ganesha-3:

       <b>ganesha-rados-grace</b> <b>add</b> <b>ganesha-1</b> <b>ganesha-2</b> <b>ganesha-3</b>

       Once this is done, you can start the daemons on each host and they will coordinate to start and lift  the
       grace periods as-needed.

</pre><h4><b>ADDING</b> <b>NODES</b> <b>TO</b> <b>A</b> <b>RUNNING</b> <b>CLUSTER</b></h4><pre>
       After this point, new nodes can then be added to the cluster as needed using the <b>add</b> command:

       <b>ganesha-rados-grace</b> <b>add</b> <b>ganesha-4</b>

       After  the node has been added, ganesha.nfsd can then be started. It will then request a new grace period
       as-needed.

</pre><h4><b>REMOVING</b> <b>A</b> <b>NODE</b> <b>FROM</b> <b>THE</b> <b>CLUSTER</b></h4><pre>
       To remove a node from the cluster, first unmount any clients that have that node mounted (possibly moving
       them to other servers). Then execute the remove command with the nodeids to be removed from the  cluster.
       For example:

       <b>ganesha-rados-grace</b> <b>remove</b> <b>ganesha-4</b>

       This  will remove the ganesha-4's record from the database, and possibly lift the current grace period if
       one is active and it was the last one to need it.

                                                  Apr 18, 2025                            <u><a href="../man8/GANESHA-RADOS-GRACE.8.html">GANESHA-RADOS-GRACE</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>