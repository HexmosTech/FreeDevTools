<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tcpstates - Trace TCP session state changes with durations. Uses Linux eBPF/bcc.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/bpfcc-tools">bpfcc-tools_0.31.0+ds-7ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tcpstates - Trace TCP session state changes with durations. Uses Linux eBPF/bcc.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>tcpstates</b> <b>[-h]</b> <b>[-T]</b> <b>[-t]</b> <b>[-w]</b> <b>[-s]</b> <b>[-D</b> <b>PORTS]</b> <b>[-L</b> <b>PORTS]</b> <b>[-Y]</b> <b>[-4</b> <b>|</b> <b>-6]</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  tool  traces  TCP session state changes while tracing, and prints details including the duration in
       each state. This can help explain the latency of TCP connections:  whether  the  time  is  spent  in  the
       ESTABLISHED state (data transfer), or initialization state (SYN_SENT), etc.

       This  tool works using the sock:inet_sock_set_state tracepoint, which was added to Linux 4.16. Linux 4.16
       also included extra state transitions so that all TCP transitions could be observed by this tracepoint.

       Only TCP state changes are traced, so it is expected that the overhead of this tool is  much  lower  than
       typical send/receive tracing.

       Since this uses BPF, only the root user can use this tool.

</pre><h4><b>REQUIREMENTS</b></h4><pre>
       CONFIG_BPF and bcc, and the sock:inet_sock_set_state tracepoint.

</pre><h4><b>OPTIONS</b></h4><pre>
       -h     Print usage message.

       -s     Comma separated values output (parseable).

       -t     Include a timestamp column (seconds).

       -T     Include a time column (HH:MM:SS).

       -w     Wide column output (fits IPv6 addresses).

       -L PORTS
              Comma-separated list of local ports to trace (filtered in-kernel).

       -D PORTS
              Comma-separated list of destination ports to trace (filtered in-kernel).

       -Y     Log session state changes to the systemd journal.

       -4     Trace IPv4 family only.

       -6     Trace IPv6 family only.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Trace all TCP sessions, and show all state changes:
              # <b>tcpstates</b>

       Include a timestamp column, and wide column output:
              # <b>tcpstates</b> <b>-tw</b>

       Trace connections to local ports 80 and 81 only:
              # <b>tcpstates</b> <b>-L</b> <b>80,81</b>

       Trace connections to remote port 80 only:
              # <b>tcpstates</b> <b>-D</b> <b>80</b>

       Trace IPv4 family only:
              # <b>tcpstates</b> <b>-4</b>

       Trace IPv6 family only:
              # <b>tcpstates</b> <b>-6</b>

</pre><h4><b>FIELDS</b></h4><pre>
       TIME   Time of the change, in HH:MM:SS format.

       TIME(s)
              Time of the change, in seconds.

       C-PID  The  current  on-CPU  process ID. This may show the process that owns the TCP session if the state
              change executes in synchronous process context, else it is likely to show the kernel (asynchronous
              state change).

       C-COMM The current on-CPU process name. This may show the process that owns the TCP session if the  state
              change executes in synchronous process context, else it is likely to show the kernel (asynchronous
              state change).

       IP     IP address family (4 or 6)

       LADDR  Local IP address.

       RADDR  Remote IP address.

       LPORT  Local port.

       RPORT  Remote port.

       OLDSTATE
              Previous TCP state.

       NEWSTATE
              New TCP state.

       MS     Duration of this state.

</pre><h4><b>OVERHEAD</b></h4><pre>
       This  traces  the kernel TCP set state function, which should be called much less often than send/receive
       tracing, and therefore have lower overhead. The overhead of the tool is relative to the rate of  new  TCP
       sessions:  if  this  is high, over 10,000 per second, then there may be noticeable overhead just to print
       out 10k lines of formatted output per second.

       You can find out the rate of new TCP sessions using "sar -n TCP 1", and adding the active/s and passive/s
       columns.

       As always, test and understand this tools overhead for your types of workloads before production use.

</pre><h4><b>SOURCE</b></h4><pre>
       This is from bcc.

              https://github.com/iovisor/bcc

       Also look in the bcc distribution for a companion _examples.txt file containing  example  usage,  output,
       and commentary for this tool.

</pre><h4><b>OS</b></h4><pre>
       Linux

</pre><h4><b>STABILITY</b></h4><pre>
       Unstable - in development.

</pre><h4><b>AUTHOR</b></h4><pre>
       Brendan Gregg

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/tcpaccept.8.html">tcpaccept</a>(8), <a href="../man8/tcpconnect.8.html">tcpconnect</a>(8), <a href="../man8/tcptop.8.html">tcptop</a>(8), <a href="../man8/tcplife.8.html">tcplife</a>(8)

USER COMMANDS                                      2018-03-20                                       <u><a href="../man8/tcpstates.8.html">tcpstates</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>