<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gitkeeper - Mirror files between git and an installed location.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/mrb">mrb_0.3+nmu3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       gitkeeper - Mirror files between git and an installed location.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>gk</b> <u>[options]</u> <b>pull</b> <u>[host]</u>

       <b>gk</b> <u>[options]</u> <b>push</b> <u>[host]</u>

       <b>gk</b> <u>[options]</u> <b>export</b> <u>git-ref</u> <u>[host]</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>gitkeeper</b> is a remote administration aid.  It enables configuration files to be maintained locally, with
       a full history of changes, and synchronised on demand with a remote target system.  This allows files to
       still be altered directly on the running system, if and/or when that is needed, with a simple method to
       get that all back in sync with the archived copy again later.

       It uses <b><a href="../man1/rsync.1.html">rsync</a></b>(1) and <b><a href="../man1/ssh.1.html">ssh</a></b>(1) for all operations on the remote hosts.  No special configuration beyond
       permission to use them is required.  The use of an <b>ssh-agent</b> for managing remote logins may be an
       advantage though.

       At its core, <b>gitkeeper</b> is really just a tool for managing bidirectional mirrors, of potentially sparse
       segments of the remote filesystem, so it's not strictly limited to being used for configuration files,
       nor is it strictly dependent upon <b><a href="../man1/git.1.html">git</a></b>(1) aside from the <b>export</b> option, but those are the primary uses
       that it was initially designed for.

</pre><h4><b>COMMANDS</b></h4><pre>
       <b>pull</b>    Pull  files  from  the remote system into the local mirror.  This will update the local directory
               content to match the live system, but it will not commit any files to git  or  change  the  local
               index state in any way.  If you wish to commit changes imported in this way, you can just do that
               with normal git operations.

               If the <u>host</u> parameter is not explicitly specified, then all defined hosts will be pulled.

       <b>push</b>    Push  files  from the local mirror to the remote system.  This will push the state of the current
               working directory, regardless of whether the repository tree is currently clean or dirty.

               If the <u>host</u> parameter is not explicitly specified, then all defined hosts will be pushed.

       <b>export</b>  Push files from a historical snapshot of the local mirror to the remote system.  This will  do  a
               <b>git</b>  <b><a href="../man1/archive.1.html">archive</a></b>(1)  export  of  the  given <u>git-ref</u> to a temporary directory, and then perform a <b>push</b>
               operation on that tree.  It is equivalent to doing a <b>git</b> <b>checkout</b> of the desired  ref,  and  then
               doing  a  <b>push</b> on that tree state, except it will respect any <b>gitattributes</b> you have set for what
               will be exported, and it will not change the current working directory state.

               If the <u>host</u> parameter is not explicitly  specified,  then  all  hosts  defined  in  the  exported
               configuration will be pushed.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-c,</b> <b>--config</b> <u>file</u>
               The  file  describing  what  should  be  mirrored and how.  If not specified then <u>gk.conf</u> will be
               looked for in the directory that <b>gitkeeper</b> is invoked in.  Usually this should be a relative path
               under that location, but an absolute path is permitted and may be useful in some circumstances.

               If the <b>export</b> command is used, then this file is not read until after the export  from  git,  and
               relative  paths  are  resolved to files in the exported directory.  This is usually what you want
               since the configuration from the exported snapshot will then be used.  If you  need  to  override
               that for some reason then you can use an absolute path to an alternate configuration file.

       <b>-l,</b> <b>--list</b>
               Show the list of host aliases defined in the configuration file.  If this is used with the <b>export</b>
               command, then the configuration of the exported snapshot will be shown.

       <b>--init</b>  Create a skeleton configuration file.  This is a convenience to get an initial configuration when
               bootstrapping a new mirror.

       <b>-C,</b> <b>--chdir</b> <u>directory</u>
               Change  to the given directory before running <b>gitkeeper</b>.  Normally you would just run it from the
               top level directory of the mirror, but this permits use from elsewhere in a similar way  to  what
               "make -C directory" allows.

       <b>--destdir</b> <u>directory</u>
               Prefix  the  remote  paths to an alternate file system root.  This always changes only the remote
               path, regardless of whether a <b>push</b> or <b>pull</b> operation  is  being  performed.   It  acts  like  the
               "DESTDIR"  option  for  "make  install"  and  allows  mirroring  files to and from an alternative
               filesystem location but with the same subdirectory structure as what they would normally have.

               You can use this to export files to a chroot, or to a temporary directory somewhere, so that they
               can be examined without replacing the real files on the remote system.

       <b>-u,</b> <b>--user</b>
               Override the <b>remote_user</b> option from the configuration file for access to the remote host.  There
               probably aren't many good reasons to ever use this option, it's a pretty blunt hammer which  will
               override  it  everywhere, but it may be useful for exporting a mirror to some machine or location
               where it isn't usually expected to go.

       <b>-n,</b> <b>--dry-run</b>
               Don't actually copy any files, just show what would be done if this was a live run.  If  this  is
               used with the <b>export</b> command, then the dry run will be performed on the requested snapshot.

       <b>-v,</b> <b>--verbose</b>
               Show  more detail about what is being done.  This option may be passed multiple times to increase
               the level of verbosity even further.

               If passed along with <b>--help</b> then more verbose documentation will be shown.

       <b>-?,</b> <b>--help</b>
               Show this help, again.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       The <b>gitkeeper</b> configuration file is expected to contain a single JSON Object, which  will  be  parsed  by
       perl's  JSON::XS in its relaxed mode (which allows trailing commas after the final element of an array or
       object, and '#'-comments anywhere that whitespace would be permitted).

   <b>Global</b> <b>options</b>
       There is only one required member of the top level object, though other options  may  also  be  specified
       there to be inherited as defaults if not overridden for a host or one of its sync sets.

       <b>hosts</b>   The  <b>hosts</b>  member  defines  a  JSON object in which each member is a host name alias that may be
               passed as the <u>host</u> parameter to <b>gitkeeper</b>.  The alias names are not used for  any  other  purpose
               than  as the <u>host</u> identifier, and may be any JSON string value.  No other options may be included
               directly in the <b>hosts</b> section.

        {
           "hosts": {
               "host1": { ... },
               "host2": { ... }
           }
        }

   <b>Per-host</b> <b>options</b>
       There are two required members which must be specified  directly  for  each  host  alias  object.   Other
       options  may  also be specified there which will override a global default for that host and be inherited
       as defaults for its sync sets, if not also overridden there.

       <b>address</b> The <b>address</b> member is a JSON string value, that defines the hostname  or  IP  address  used  when
               connecting  to  the remote system.  It must be a valid string that can be passed as the host part
               of a remote <b><a href="../man1/rsync.1.html">rsync</a></b>(1) path.  It should not contain a <u>user</u> part (that should instead  be  set  with
               the <b>remote_user</b> option), but may contain a port specification.

       <b>sync</b>    The <b>sync</b> member is a JSON array of objects.  It must contain at least one object, but there is no
               upper  bound to the number which may be included.  Each of the objects in the <b>sync</b> array define a
               mapping from a <b>remote_root</b> to a <b>local_root</b>, the paths which will be mirrored under  those  roots,
               and the <b>rsync</b> options which will be applied when transferring them.

        "host1": {
           "address": "myhost.mydomain.org",
           "sync":    [ { ... }, { ... } ]
        }

   <b>Sync</b> <b>set</b> <b>options</b>
       Each  object  in  the  <b>sync</b>  array  has one required member that must be specified directly in it.  Other
       options may also be specified there which will override the global and host defaults, and some  of  those
       options must also be defined in at least one of those places for each sync set.

       <b>paths</b>   The  <b>paths</b>  member  is  an array of JSON string values which specify the files and/or directories
               under the <b>remote_root</b> which will be mirrored with  their  full  directory  structure.   They  may
               contain  shell  wildcards, but cannot contain brace expansions if the <b>rsync</b> <b>--protect-args</b> option
               is used.

               They must all be relative paths (ie. they must not begin with a '/').

        "sync": [
           {
               "paths": [ "file1", "dir1", "dir2/subdir", "dir3/*.conf" ]
           }
        ]

   <b>Required</b> <b>options</b>
       The following options must be defined for every sync set, though they may be configured in either the top
       level object as global defaults, in the host alias object for per-host defaults, or in  the  sync  object
       itself.

       <b>local_root</b>
               A  JSON  string value that defines the local directory which remote <b>paths</b> will be mirrored under.
               This must be a relative path, which itself is rooted to the directory under  which  <b>gitkeeper</b>  is
               invoked.

               As a sanity check against accidents, this directory must already exist.

       <b>remote_root</b>
               A  JSON string value which defines the location on the remote system that the specified <b>paths</b> are
               relative to.  This may be an absolute or relative path.  A relative path will be  rooted  to  the
               home  directory  of  the <b>remote_user</b>.  A value of "" may be used to specify the home directory of
               the <b>remote_user</b>.

   <b>Additional</b> <b>options</b>
       The following options may be defined as global or per-host defaults, or set explicitly in each sync  set.
       It  is  not  an  error for them not to be set, and a higher level default may be 'unset' by overriding it
       with an empty value.

       <b>remote_user</b>
               A JSON string which defines the username to use for access to the remote host.  If not set,  then
               the ssh default for the remote system will be used (as configured by .ssh/config or similar).

       <b>rsync_opts</b>
               A  JSON  array  of string values containing options to be passed to all invocations of <b>rsync</b>, for
               both <b>push</b> and <b>pull</b> operations.  No word splitting or shell quote stripping is done on the  values
               used here, so each option must be its own array element.

               Note that the <b>--relative</b> option is passed to <b><a href="../man1/rsync.1.html">rsync</a></b>(1) by default for all invocations and does not
               need  to  be  included  in  this  set.  If you really don't want that option for some reason, and
               understand  the  consequences  of  not  passing  it  for  this  use,  you  can  disable  it  with
               <b>--no-relative</b>, but there's probably no good reason to ever do that here.

                "rsync_opts": [ "--prune-empty-dirs",
                                "--delete-excluded",
                                "--filter=protect .s[a-w][a-z]"
                ]

       <b>rsync_pull_opts</b>
               Similar  to  <b>rsync_opts</b> above, but options specified in this array are appended to those only for
               <b>pull</b> operations.

       <b>rsync_push_opts</b>
               Similar to <b>rsync_opts</b> above, but options specified in this array are appended to those  only  for
               <b>push</b> operations.

       <b>rsync_include</b>
               A  JSON  array of string values which will be passed to <b><a href="../man1/rsync.1.html">rsync</a></b>(1) as <b>--include</b> options.  This is a
               convenience which is eqivalent to adding those to <b>rsync_opts</b>  ie.  the  following  configurations
               would  be  identical  in  their  operation  if no other ordering constraints for the filter rules
               applied.

                "rsync_opts":    [ "--include=.s[a-w][a-z]/" ]
                "rsync_include": [ ".s[a-w][a-z]/" ]

       <b>rsync_exclude</b>
               A JSON array of string values which will be passed to <b><a href="../man1/rsync.1.html">rsync</a></b>(1) as <b>--exclude</b> options.  This is the
               same as <b>rsync_include</b> above, except for excludes.

       <b>rsync_filter</b>
               A JSON array of string values which will be passed to <b><a href="../man1/rsync.1.html">rsync</a></b>(1)  as  <b>--filter</b>  options.   This  is
               similar to the include and exclude options above, except it allows the full range of <b>rsync</b> filter
               rules to be used.

       <b>rsync_pull_filter</b>
               A  JSON  array of string values which will be passed to <b><a href="../man1/rsync.1.html">rsync</a></b>(1) as <b>--filter</b> options (in addition
               to the include, exclude, and filter options above) only for <b>pull</b> operations.

       <b>rsync_push_filter</b>
               A JSON array of string values which will be passed to <b><a href="../man1/rsync.1.html">rsync</a></b>(1) as <b>--filter</b> options  (in  addition
               to the include, exclude, and filter options above) only for <b>push</b> operations.

       <b>chown</b>   A  JSON  string  value which will be passed to <b>rsync</b> as the <b>--chown</b> option for <b>push</b> operations to
               set file and directory ownership on the remote host.  If this option is  used,  the  <b>--owner</b>  and
               <b>--group</b>  options  will automatically added too, otherwise it would have no effect.  You must have
               superuser privilege on the remote host for this to work.

                "chown": "root:bind"

       <b>chmod</b>   A JSON string value which will be passed to <b>rsync</b> as the <b>--chmod</b> option for  <b>push</b>  operations  to
               set  file  and  directory  permissions  on  the remote host.  If this option is used, the <b>--perms</b>
               option will automatically added too, otherwise it would have no effect.  Valid  values  here  are
               anything that the <b>rsync</b> option would accept.

                "chmod": "D2755,F664"

   <b>Pre-</b> <b>and</b> <b>Post-</b> <b>command</b> <b>hooks</b>
       The  following  options  may  be  used  to  execute arbitrary commands before and/or after a <b>pull</b> or <b>push</b>
       operation.  The commands are executed on the local host, in the directory that <b>gitkeeper</b> was invoked  in,
       as the user which <b>gitkeeper</b> was invoked as.  They can be used to perform operations on the remote host by
       simply invoking <b><a href="../man1/ssh.1.html">ssh</a></b>(1) or similar themselves.

       <b>pull_pre_command</b>
       <b>push_pre_command</b>
       <b>pull_post_command</b>
       <b>push_post_command</b>
               A  JSON  array  of string values containing the command to execute and the options to pass to it.
               This will be passed as an array to the perl <b>system()</b> command, so if the array  contains  multiple
               elements,  then  no  word  splitting or other shell interpretation will be performed.  If it is a
               single string, then it will instead be passed to the local  shell,  with  all  the  caveats  that
               accompany doing that.

               If  the  pre-command  fails,  then  no  transfer will take place.  If the transfer fails for some
               reason then the post-command will not be executed.

               That might change later if we let this get more  complex  and  begin  passing  status  and  other
               variables  to  the commands that are invoked, but at this stage, that isn't really needed for any
               current use we have, so I'm not going to complicate things now in anticipation of what later uses
               might require.

</pre><h4><b>FILES</b></h4><pre>
       <b>./gk.conf</b>
               The default configuration file.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/git.1.html">git</a></b>(1), <b><a href="../man1/rsync.1.html">rsync</a></b>(1), <b><a href="../man1/ssh.1.html">ssh</a></b>(1), <b><a href="../man1/ssh-agent.1.html">ssh-agent</a></b>(1).

</pre><h4><b>AUTHOR</b></h4><pre>
       <b>gitkeeper</b> was written by Ron &lt;<a href="mailto:ron@debian.org">ron@debian.org</a>&gt;.

perl v5.36.0                                       2023-09-29                                       <u><a href="../man8/GITKEEPER.8.html">GITKEEPER</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>