<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>phc2sys - synchronize two or more clocks</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/linuxptp">linuxptp_4.2-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       phc2sys - synchronize two or more clocks

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>phc2sys</b> <b>-a</b> [ <b>-r</b> ] [ <b>-r</b> ] [ <b>-f</b> <u>config-file</u> ] [ options ] [ <u>long-options</u> ]
       <b>phc2sys</b> [ <b>-f</b> <u>config-file</u> ] [ <b>-d</b> <u>pps-device</u> ] [ <b>-s</b> <u>device</u> ] [ <b>-c</b> <u>device</u> ] [ <b>-O</b> <u>offset</u> ] [ <b>-w</b> ] [ options ]
       [ <u>long-options</u> ] <u>...</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>phc2sys</b>  is  a  program  which  synchronizes  two  or more clocks in the system. Typically, it is used to
       synchronize the system clock to a PTP hardware clock (PHC), which itself is synchronized by the  <b><a href="../man8/ptp4l.8.html">ptp4l</a></b>(8)
       program.

       With the <b>-a</b> option, the clocks to synchronize are fetched from the running <b>ptp4l</b> daemon and the direction
       of synchronization automatically follows changes of the PTP port states.

       Manual  configuration  is  also  possible. When using manual configuration, two synchronization modes are
       supported, one uses a pulse per second (PPS) signal provided by the source clock and the other mode reads
       time from the source clock directly. Some clocks  can  be  used  in  both  modes,  the  mode  which  will
       synchronize the time sink with better accuracy depends on hardware and driver implementation.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-a</b>     Read the clocks to synchronize from running <b>ptp4l</b> and follow changes in the port states, adjusting
              the   synchronization   direction   automatically.   The  system  clock  (CLOCK_REALTIME)  is  not
              synchronized, unless the <b>-r</b> option is also specified.

       <b>-r</b>     Only valid together with the <b>-a</b> option. Instructs <b>phc2sys</b> to also  synchronize  the  system  clock
              (CLOCK_REALTIME). By default, the system clock is not considered as a possible time source. If you
              want the system clock to be eligible to become a time source, specify the <b>-r</b> option twice.

       <b>-f</b> <u>config</u>
              Read configuration from the specified file. No configuration file is read by default.

       <b>-d</b> <u>pps-device</u>
              Specify  the  PPS  device  of  the  source  clock  (e.g.  /dev/pps0).  With  this  option  the PPS
              synchronization mode is used instead of the direct mode.  The matching PHC must be specified using
              the <b>-s</b> command line option.  This option can be used only with the system clock as the time  sink.
              Not compatible with the <b>-a</b> option.

       <b>-s</b> <u>device</u>
              Specify  the  source  clock  by  device (e.g. /dev/ptp0) or interface (e.g. eth0) or by name (e.g.
              CLOCK_REALTIME for the system clock). When this option is used together with the  <b>-d</b>  option,  the
              source  clock is used only to correct the offset by whole number of seconds, which cannot be fixed
              with PPS alone. Not compatible with the <b>-a</b> option. This option does not support  bonded  interface
              (e.g. bond0, team0). If <b>ptp4l</b> has a port on an active-backup bond or team interface, the <b>-a</b> option
              can be used to track the active interface.

       <b>-i</b> <u>interface</u>
              Performs  the  exact  same function as <b>-s</b> for compatibility reasons. Previously enabled specifying
              source clock by network interface. However, this can now be done using <b>-s</b> and this  option  is  no
              longer necessary. As such it has been deprecated, and should no longer be used.

       <b>-c</b> <u>device</u>
              Specify the time sink by device (e.g. /dev/ptp1) or interface (e.g. eth1) or by  name. The default
              is  CLOCK_REALTIME (the system clock). Not compatible with the <b>-a</b> option. This option may be given
              up to 128 times.

       <b>-E</b> <u>servo</u>
              Specify which clock servo should be used. Valid values are pi for a PI controller, linreg  for  an
              adaptive  controller  using  linear  regression,  and ntpshm and refclock_sock for the NTP SHM and
              chrony SOCK reference clocks respectively to allow another process to synchronize the local clock.
              The default is pi.

       <b>-P</b> <u>kp</u>  Specify the proportional constant of the PI controller. The default is 0.7.

       <b>-I</b> <u>ki</u>  Specify the integral constant of the PI controller. The default is 0.3.

       <b>-S</b> <u>step</u>
              Specify the step threshold of the servo. It is the maximum  offset  that  the  servo  corrects  by
              changing  the  clock  frequency  instead  of  stepping  the  clock.  The clock is stepped on start
              regardless of the option if the offset is larger than 20 microseconds (unless  the  <b>-F</b>  option  is
              used).  It's specified in seconds. The value of 0.0 disables stepping after the start. The default
              is 0.0.

       <b>-F</b> <u>step</u>
              Specify the step threshold applied only on the first update. It is  the  maximum  offset  that  is
              corrected  by  changing  the clock frequency. It's specified in seconds. The value of 0.0 disables
              stepping on start. The default is 0.00002 (20 microseconds).

       <b>-R</b> <u>update-rate</u>
              Specify the time sink update rate when running in the direct synchronization mode. The default  is
              1 per second.

       <b>-N</b> <u>phc-num</u>
              Specify  the  number  of  source  clock readings used for each time sink update.  Only the fastest
              reading is used to update the clock.  This is useful to minimize the error caused by random delays
              in scheduling and bus utilization.  The default is 5.

       <b>-O</b> <u>offset</u>
              Specify the offset between the sink and source times  in  seconds.  Not  compatible  with  the  <b>-a</b>
              option.  See <b>TIME</b> <b>SCALE</b> <b>USAGE</b> below.

       <b>-L</b> <u>freq-limit</u>
              The  maximum  allowed frequency offset between uncorrected clock and the system monotonic clock in
              parts per billion (ppb). This is used as a sanity check of the synchronized clock. When  a  larger
              offset  is measured, a warning message will be printed and the servo will be reset. When set to 0,
              the sanity check is disabled. The default is 200000000 (20%).

       <b>-M</b> <u>segment</u>
              The number of the SHM segment used by ntpshm servo.  The default is 0.

       <b>-u</b> <u>summary-updates</u>
              Specify the number of clock updates included in summary statistics. The statistics include  offset
              root mean square (RMS), maximum absolute offset, frequency offset mean and standard deviation, and
              mean  of  the  delay in clock readings and standard deviation. The units are nanoseconds and parts
              per billion (ppb). If zero, the individual samples are printed  instead  of  the  statistics.  The
              messages are printed at the LOG_INFO level.  The default is 0 (disabled).

       <b>-w</b>     Wait  until  ptp4l  is in a synchronized state. If the <b>-O</b> option is not used, also keep the offset
              between the sink and source times updated according to the currentUtcOffset  value  obtained  from
              ptp4l and the direction of the clock synchronization. Not compatible with the <b>-a</b> option.

       <b>-n</b> <u>domain-number</u>
              Specify  the  domain  number  used  by  ptp4l.  This  option can be used up to 16 times to specify
              different domain numbers for different sockets specified by the <b>-z</b> option. The domain numbers  are
              assigned according to the order of the options on the command line.  The default is 0.

       <b>-x</b>     When  a  leap second is announced, don't apply it in the kernel by stepping the clock, but let the
              servo correct the one-second offset slowly by changing the clock frequency (unless the  <b>-S</b>  option
              is used).

       <b>-z</b> <u>uds-address</u>
              Specifies  the  address of the server's UNIX domain socket. This option can be used up to 16 times
              in the automatic mode to synchronize clocks between multiple  <b>ptp4l</b>  instances.   The  default  is
              /var/run/ptp4l.

       <b>-l</b> <u>print-level</u>
              Set the maximum syslog level of messages which should be printed or sent to the system logger. The
              default is 6 (LOG_INFO).

       <b>-t</b> <u>message-tag</u>
              Specify  the  tag which is added to all messages printed to the standard output or system log. The
              default is an empty string.

       <b>-m</b>     Print messages to the standard output.

       <b>-q</b>     Don't send messages to the system logger.

       <b>-h</b>     Display a help message.

       <b>-v</b>     Prints the software version and exits.

</pre><h4><b>LONG</b> <b>OPTIONS</b></h4><pre>
       Each and every configuration file option (see below in section <b>FILE</b> <b>OPTIONS)</b> may also appear as a  "long"
       style  command line argument.  For example, the transportSpecific option may be set using either of these
       two forms:

              --transportSpecific 1   --transportSpecific=1

       Option values given on the command line override values in the global section of the  configuration  file
       (which, in turn overrides default values).

</pre><h4><b>CONFIGURATION</b> <b>FILE</b></h4><pre>
       The  configuration  file  is  divided  into sections. Each section starts with a line containing its name
       enclosed in brackets and it follows with settings.  Each  setting  is  placed  on  a  separate  line,  it
       contains  the  name of the option and the value separated by whitespace characters. Empty lines and lines
       starting with # are ignored.

       The global section (indicated as <b>[global]</b>) sets the program options. This is the only used option.

</pre><h4><b>FILE</b> <b>OPTIONS</b></h4><pre>
       <b>clock_servo</b>
              The servo which is used to synchronize the local clock. Valid values are "pi" for a PI controller,
              "linreg" for an adaptive controller using linear regression, "ntpshm" for the  NTP  SHM  reference
              clock  to  allow  another process to synchronize the local clock (the SHM segment number is set to
              the domain number), and "nullf" for a servo that always dials frequency offset zero  (for  use  in
              SyncE nodes). The default is "pi."  Same as option <b>-E</b> (see above).

       <b>domainNumber</b>
              Specify the domain number used by phc2sys. The default is 0. Same as option <b>-n</b> (see above).

       <b>first_step_threshold</b>
              Specify  the  step  threshold  applied  only on the first update. It is the maximum offset that is
              corrected by adjusting clock. It's specified in seconds. The value of  0.0  disables  stepping  on
              start. The default is 0.00002 (20 microseconds).  Same as option <b>-F</b> (see above).

       <b>free-running</b>
              Don't adjust the sink clock if enabled. The default is 0 (disabled).

       <b>kernel_leap</b>
              When  a  leap  second  is  announced,  let  the  kernel  apply it by stepping the clock instead of
              correcting the one-second offset with servo, which would correct the one-second offset  slowly  by
              changing  the  clock  frequency (unless the step_threshold option is set to correct such offset by
              stepping). Relevant only with software time stamping. The default is 1 (enabled). Same  as  option
              <b>-x</b> (see above).

       <b>logging_level</b>
              The  maximum logging level of messages which should be printed.  The default is 6 (LOG_INFO). Same
              as option <b>-l</b> (see above).

       <b>message_tag</b>
              The tag which is added to all messages printed to the standard output or system log.  If  the  tag
              contains  the string "{level}", it will be replaced with the log level of the message as a number.
              The default is an empty string (which cannot be set  in  the  configuration  file  as  the  option
              requires an argument).  Same as option <b>-t</b> (see above).

       <b>ntpshm_segment</b>
              The  number  of  the  SHM segment used by ntpshm servo.  The default is 0.  Same as option <b>-M</b> (see
              above).

       <b>pi_integral_const</b>
              Specifies the integral constant of the PI controller.  Same as option <b>-I</b> (see above).

       <b>pi_proportional_const</b>
              Specifies the proportional constant of the PI controller.  Same as option <b>-P</b> (see above).

       <b>refclock_sock_address</b>
              The address of the UNIX domain socket to be used by  the  refclock_sock  servo.   The  default  is
              /var/run/refclock.ptp.sock.

       <b>sanity_freq_limit</b>
              The  maximum  allowed frequency offset between uncorrected clock and the system monotonic clock in
              parts per billion (ppb). This is used as a sanity check of the synchronized clock. When  a  larger
              offset  is measured, a warning message will be printed and the servo will be reset. When set to 0,
              the sanity check is disabled. The default is 200000000 (20%).  Same as option <b>-L</b> (see above).

       <b>step_threshold</b>
              Specifies the step threshold of the servo. It is the maximum offset that  the  servo  corrects  by
              changing  the  clock  frequency  (phase when using nullf servo) instead of stepping the clock. The
              clock is stepped on start regardless of the option if the offset is larger  than  20  microseconds
              (unless  the  -F  option  is  used). It's specified in seconds. The value of 0.0 disables stepping
              after the start. The default is 0.0.  Same as option <b>-S</b> (see above).

       <b>transportSpecific</b>
              The transport specific field. Must be in the range 0 to 255.  The default is 0.

       <b>uds_address</b>
              Specifies the address of the server's UNIX domain socket. The default  is  /var/run/ptp4  Same  as
              option <b>-z</b> (see above).

       <b>use_syslog</b>
              Print  messages  to  the system log if enabled.  The default is 1 (enabled).  Related to option <b>-q</b>
              (see above).

       <b>verbose</b>
              Print messages to the standard output if enabled.  The default is 0 (disabled).  Related to option
              <b>-m</b> (see above).

</pre><h4><b>TIME</b> <b>SCALE</b> <b>USAGE</b></h4><pre>
       <b>Ptp4l</b> uses either PTP time scale or UTC (Coordinated Universal Time)  time  scale.   PTP  time  scale  is
       continuous  and  shifted  against  UTC  by  a  few  tens of seconds as PTP time scale does not apply leap
       seconds.

       In hardware time stamping mode, <b>ptp4l</b> announces use of PTP time scale and PHC is  used  for  the  stamps.
       That  means PHC must follow PTP time scale while system clock follows UTC.  Time offset between these two
       is maintained by <b>phc2sys</b>.

       <b>Phc2sys</b> acquires the offset value either by reading it from ptp4l when <b>-a</b> or <b>-w</b>  is  in  effect  or  from
       command  line when <b>-O</b> is supplied.  Failure to maintain the correct offset can result in the local system
       clock being offset some whole number of seconds from the domain server's clock when in  client  mode,  or
       incorect PTP time announced to the network in case the host is the domain server.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Synchronize  time  automatically  according to the current <b>ptp4l</b> state, synchronizing the system clock to
       the remote server.

              phc2sys -a -r

       Same as above, but when the host becomes the domain server, synchronize time in the domain to its  system
       clock.

              phc2sys -a -rr

       Same as above, in an IEEE 802.1AS domain.

              phc2sys -a -rr --transportSpecific=1

       The  host  is  a domain server, PTP clock is synchronized to system clock and the time offset is obtained
       from <b>ptp4l</b>.  <b>Phc2sys</b> waits for <b>ptp4l</b> to get at least one port in server or client  mode  before  starting
       the synchronization.

              phc2sys -c /dev/ptp0 -s CLOCK_REALTIME -w

       Same as above, time offset is provided on command line and <b>phc2sys</b> does not wait for <b>ptp4l</b>.

              phc2sys -c /dev/ptp0 -s CLOCK_REALTIME -O 37

       The  host is in client mode, system clock is synchronized from PTP clock, <b>phc2sys</b> waits for <b>ptp4l</b> and the
       offset is set automatically.

              phc2sys -s /dev/ptp0 -w

       Same as above, PTP clock id is read from the network interface, the offset is provided  on  command  line
       <b>phc2sys</b> does not wait.

              phc2sys -s eth0 -O -37

</pre><h4><b>WARNING</b></h4><pre>
       Be  cautious  when  the  same  configuration file is used for both ptp4l and phc2sys.  Keep in mind, that
       values specified in the configuration file take precedence  over  their  default  values.  If  a  certain
       option,  which  is  common to ptp4l and phc2sys, is specified to a non-default value in the configuration
       file (p.e., for ptp4l), then this non-default value applies also for phc2sys. This might be not  what  is
       expected.

       It  is  recommended  to  use  seperate  configuration  files  for ptp4l and phc2sys in order to avoid any
       unexpected behavior.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/ptp4l.8.html">ptp4l</a></b>(8)

linuxptp                                          February 2023                                       <u><a href="../man8/PHC2SYS.8.html">PHC2SYS</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>