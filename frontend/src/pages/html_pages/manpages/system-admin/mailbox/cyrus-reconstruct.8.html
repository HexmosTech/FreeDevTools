<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>reconstruct - Cyrus IMAP documentation</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/cyrus-common">cyrus-common_3.10.1-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       reconstruct - Cyrus IMAP documentation

       Reconstruct mailboxes

</pre><h4><b>SYNOPSIS</b></h4><pre>
          <b>reconstruct</b> [ <b>-C</b> <u>config-file</u> ] [ <b>-p</b> <u>partition</u> ] [ <b>-x</b> ] [ <b>-r</b> ]
              [ <b>-f</b> ] [ <b>-U</b> ] [ <b>-s</b> ] [ <b>-q</b> ] [ <b>-G</b> ] [ <b>-R</b> ] [ <b>-o</b> ]
              [ <b>-O</b> ] [ <b>-M</b> ] <u>mailbox</u>...

          <b>reconstruct</b> [ <b>-C</b> <u>config-file</u> ] [ <b>-p</b> <u>partition</u> ] [ <b>-x</b> ] [ <b>-r</b> ]
              [ <b>-f</b> ] [ <b>-U</b> ] [ <b>-s</b> ] [ <b>-q</b> ] [ <b>-G</b> ] [ <b>-R</b> ] [ <b>-o</b> ]
              [ <b>-O</b> ] [ <b>-M</b> ] <b>-u</b> <u>user</u>...

          <b>reconstruct</b> [ <b>-C</b> <u>config-file</u> ] [ <b>-p</b> <u>partition</u> ] [ <b>-r</b> ]
              [ <b>-q</b> ] <b>-V</b> <u>version</u> <u>mailbox</u>...

          <b>reconstruct</b> [ <b>-C</b> <u>config-file</u> ] [ <b>-p</b> <u>partition</u> ] [ <b>-r</b> ]
              [ <b>-q</b> ] <b>-V</b> <u>version</u> <b>-u</b> <u>user</u>...

          <b>reconstruct</b> [ <b>-C</b> <u>config-file</u> ] <b>-P</b> <u>cyrus-header-paths</u>...

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>reconstruct</b>  rebuilds one or more IMAP mailboxes.  It can be used to recover from almost any sort of data
       corruption.

       If <b>reconstruct</b> can find existing header and index files, it attempts to preserve any data in them that is
       not derivable from the message files themselves. The state <b>reconstruct</b> attempts to preserve includes  the
       flag names, flag state, and internaldate.

       <b>reconstruct</b> derives all other information from the message files.

       <b>reconstruct</b>  reads  its configuration options out of the <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u> file unless specified otherwise by
       <b>-C</b>.  Any mailbox directory underneath the path specified in the <b>partition-news</b>  configuration  option  is
       assumed to be in news format.

       <b>reconstruct</b> does not adjust the quota usage recorded in any quota root files.  After running <b>reconstruct</b>,
       it is advisable to run <b><a href="../man8/quota.8.html">quota</a>(8)</b> with the <b>-f</b> switch in order to fix the quota root files.

       When  upgrading versions of Cyrus software, it may be necessary to run <b>reconstruct</b> with the <b>-V</b> option, to
       rebuild indexes to a given version (or <u>max</u> for the most recent).  Note  that  the  <b>-V</b>  option  cannot  be
       combined  with  most  other  reconstruct  options.   If a mailbox needs reconstructing you should do that
       first, and then upgrade it with <b>-V</b> once it's good.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-C</b> <b>config-file</b>
              Use the specified configuration file <u>config-file</u> rather than the default <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u>.

       <b>-p</b> <b>partition,</b> <b>--partition=partition</b>
              Search for the listed (non-existant) mailboxes on the indicated <u>partition</u>. Create the mailboxes in
              the database in addition to reconstructing them. (not compatible with the use of wildcards)

       <b>-x,</b> <b>--ignore-disk-metadata</b>
              When processing a mailbox which is not in the mailbox list (e.g.  via the <b>-p</b> or  <b>-f</b>  options),  do
              not  import  the  metadata  from the mailbox, instead create it anew (this specifically affects at
              least the mailbox's seen state unique identifier, user flags, and ACL).

       <b>-r,</b> <b>--recursive</b>
              Recursively reconstruct all sub-mailboxes of the mailboxes or mailbox prefixes given as arguments.

       <b>-f,</b> <b>--scan-filesystem</b>
              Examine the filesystem underneath mailbox, adding all directories with a <b>cyrus.header</b> found  there
              as new mailboxes.  Useful for restoring mailboxes from backups.

       <b>-s,</b> <b>--no-stat</b>
              Don't  stat  underlying  files.  This makes reconstruct run faster, at the expense of not noticing
              some issues (like zero byte files or size mismatches).  "<b>reconstruct</b> <b>-s</b>" should be quite fast.

       <b>-q,</b> <b>--quiet</b>
              Emit less verbose information to syslog.

       <b>-n,</b> <b>--dry-run</b>
              Don't make any changes.  Problems are reported, but not fixed.

       <b>-G,</b> <b>--force-reparse</b>
              Force re-parsing of the underlying message (checks GUID correctness). Reconstruct with  -G  should
              fix all possible individual message issues, including corrupted data files.

       <b>-I,</b> <b>--update-uniqueids</b>
              If  two  mailboxes exist with the same UNIQUEID and reconstruct visits both of them, -I will cause
              the second mailbox to have a new UNIQUEID created for it.  If you don't specify -I, you will  just
              get a syslog entry telling you of the clash.

       <b>-R,</b> <b>--guid-mismatch-keep</b>
              Perform  a  UID upgrade operation on GUID mismatch files.  Use this option if you think your index
              is corrupted rather than your message files, or if all backup  attempts  have  failed  and  you're
              happy to be served the missing files.

       <b>-U,</b> <b>--guid-mismatch-discard</b>
              Use  this  option  if you have corrupt message files in your spool and have been unable to restore
              them from backup.  This will make the mailbox IOERROR free and fix replication.

              WARNING: this deletes corrupt message files for ever - so make sure you've exhausted other options
              first!

       <b>-o,</b> <b>--ignore-odd-files</b>
              Ignore odd files in your mailbox disk directories, instead of complaining  about  them.   Probably
              useful if you are using some tool which adds additional tracking files.

       <b>-O,</b> <b>--delete-odd-files</b>
              Delete odd files.  This is the opposite of <b>-o</b>.

       <b>-M,</b> <b>--prefer-mboxlist</b>
              Prefer  mailboxes.db  over  cyrus.header - will rewrite ACL or uniqueid from the mailboxes.db into
              the header file rather than the other way around.  This feature was introduced in version 3.0.

       <b>-V</b> <b>version,</b> <b>--set-version=version</b>
              Change the <b>cyrus.index</b> minor version to a specific <u>version</u>.  This can be useful  for  upgrades  or
              downgrades.  Use  a  magical  version  of  <u>max</u>  to upgrade to the latest available database format
              version.

       <b>-u,</b> <b>--userids</b>
              Instead of mailbox prefixes, give userids on the command line

       <b>-P,</b> <b>--header-paths</b>
              Instead of mailbox prefixes, give paths to cyrus.header files on the command line.  The paths  can
              be  mailbox  directories,  or  explicit  cyrus.header  filenames.   This  will  ONLY create/repair
              mailboxes.db records using data in cyrus.header and cyrus.index.

</pre><h4><b>EXAMPLES</b></h4><pre>
          <b>reconstruct</b> <b>-r</b> <b>-f</b> <u>tech.support</u>
          <u>Recursively</u> <u>reconstruct</u> <u>all</u> <u>mailboxes</u> <u>within</u> <u>the</u> <u>tech.support</u>  <u>hierarchy,</u>  <u>restoring</u>  <u>any</u>  <u>directories</u>
          <u>containing</u> <b>cyrus.header</b> <u>files.</u>

          <b>reconstruct</b> <b>-r</b> <b>-f</b> <u>tech.support.Archive.2%</u>
          <u>Recursively</u>  <u>reconstruct</u>  <u>all</u> <u>mailboxes</u> <u>within</u> <u>the</u> <u>tech.support.Archive</u> <u>hierarchy</u> <u>with</u> <u>names</u> <u>beginning</u>
          <u>with</u> <u>'2',</u> <u>restoring</u> <u>any</u> <u>directories</u> <u>containing</u> <b>cyrus.header</b> <u>files.</u>

          <b>reconstruct</b> <b>-r</b> <b>-f</b> <b>-u</b> <u>jsmith</u>
          <u>Recursively</u> <u>reconstruct</u> <u>all</u> <u>mailboxes</u>  <u>belonging</u>  <u>to</u>  <u>jsmith,</u>  <u>restoring</u>  <u>any</u>  <u>directories</u>  <u>containing</u>
          <b>cyrus.header</b> <u>files.</u>

</pre><h4><b>HISTORY</b></h4><pre>
       The options <b>-k</b> (keep flags) and <b>-g</b> (clear GUID) have been deprecated in Cyrus version 2.4.

       The <b>-u</b> and <b>-V</b> options were added in Cyrus version 2.5.

       The <b>-M</b> option was added in Cyrus version 3.0.

</pre><h4><b>FILES</b></h4><pre>
       /etc/imapd.conf

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u>

</pre><h4><b>AUTHOR</b></h4><pre>
       The Cyrus Team, Nic Bernstein (Onlight)

</pre><h4><b>COPYRIGHT</b></h4><pre>
       1993â€“2025, The Cyrus Team

3.10.1                                            Jan 22, 2025                                    <u><a href="../man8/RECONSTRUCT.8.html">RECONSTRUCT</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>