<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>buffchan - Buffered file-writing backend for INN</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/inn2">inn2_2.7.3-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       buffchan - Buffered file-writing backend for INN

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>buffchan</b> [<b>-bru</b>] [<b>-c</b> <u>lines</u>] [<b>-C</b> <u>seconds</u>] [<b>-d</b> <u>directory</u>] [<b>-f</b> <u>num-fields</u>] [<b>-l</b> <u>lines</u>] [<b>-L</b> <u>seconds</u>] [<b>-m</b> <u>map</u>]
       [<b>-p</b> <u>pid-file</u>] [<b>-s</b> <u>format</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>buffchan</b> reads lines from standard input and copies the initial fields in each line to the files named by
       the remaining fields on the line.  <b>buffchan</b> is intended to be called by <b>innd</b> as an exploder feed.

       The input is interpreted as a sequence of lines.  Each line contains a fixed number of initial fields,
       followed by a variable number of filename fields.  All fields in a line are separated by whitespace and
       do not contain any whitespace.  The default number of initial fields is one.

       For each line of input, <b>buffchan</b> writes the initial fields, separated by a space and followed by a
       newline, to each of the files named in the filename fields.  The output files are kept open and are only
       flushed or closed based on the schedule given by the <b>-c</b>, <b>-C</b>, <b>-l</b>, and <b>-L</b> options.

       As an exploder feed (see <a href="../man5/newsfeeds.5.html">newsfeeds</a>(5) for an explanation), <b>buffchan</b> interprets lines beginning with an
       exclamation point as commands.  Besides "!begin" (which only marks the start of the feed), there are
       three supported commands:

       !flush [<u>site</u>]
           The  flush  command  closes  and reopens all open files.  An optional site can be specified, in which
           case <b>buffchan</b> flushes only that file.  This command is analogous  to  the  "ctlinnd  flush"  command.
           This command can be sent via <b>innd</b> using "ctlinnd send <u>buffchan-site</u> 'flush <u>site</u>'".

           Applications can tell that flush has completed by renaming the file before issuing the command.  When
           the  original  file  name has reappeared, the flush is complete.  If <a href="../man3/fchmod.3.html">fchmod</a>(3) is available, <b>buffchan</b>
           also changes the file to read-only while  it's  actively  writing  to  it  and  changes  it  back  to
           read/write once it has been closed.  It will change the mode back to read-only only if it reopens the
           same file.

       !drop [<u>site</u>]
           The  drop  command  is  similar to the flush command, except that no files are reopened.  If given an
           argument, only the specified site is dropped; otherwise, all sites are dropped.  (Note  that  a  site
           will be restarted if the input stream mentions the site again.)

           When  a  "ctlinnd drop site" command is sent, <b>innd</b> will automatically forward the command to <b>buffchan</b>
           if the site is listed as a funnel feeding into  the  <b>buffchan</b>  exploder.   To  drop  all  sites,  use
           "ctlinnd send <u>buffchan-site</u> drop".

       !readmap
           The map file specified with the <b>-m</b> option, if given, will be reloaded.

       Once  <b>buffchan</b>  opens  a  file,  it  keeps  it  open  (in the absence of a drop command).  The input must
       therefore never specify more files than the maximum number of files a process may open.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-b</b>  Force the output to be buffered.  (This is generally the default, but it may depend on the  operating
           system.)   If <b>-b</b> is given, a buffer size of BUFSIZ (a constant of the system standard I/O library) is
           used.

       <b>-c</b> <u>lines</u>
           If the <b>-c</b> flag is given, <b>buffchan</b> will close and reopen a file after every <u>lines</u> lines are written to
           the file.

       <b>-C</b> <u>seconds</u>
           If the <b>-C</b> flag is given, <b>buffchan</b> will close and reopen a file if it has  been  open  for  more  than
           <u>seconds</u> seconds.

       <b>-d</b> <u>directory</u>
           By  default,  <b>buffchan</b>  writes  its output into the <u>pathoutgoing</u> directory.  This flag may be used to
           specify a directory the program should change to before starting.  If this flag is used, the  default
           for  the  <b>-s</b>  flag  (see  below)  is  changed  to  be a simple "%s" (in other words, output files are
           considered to be relative to <u>directory</u>).

       <b>-f</b> <u>num-fields</u>
           By default, each line is expected to contain one fixed field followed  by  some  number  of  filename
           fields.  If this flag is given, <u>num-fields</u> will be used as the number of initial fixed fields.

       <b>-l</b> <u>lines</u>
           If  the  <b>-l</b>  flag  is  given, <b>buffchan</b> will flush the output after every <u>lines</u> lines are written to a
           file.

       <b>-L</b> <u>seconds</u>
           If the <b>-L</b> flag is given, <b>buffchan</b> will flush each output file every <u>seconds</u> seconds.

       <b>-m</b> <u>map</u>
           Map files translate the names in the filename fields on each line into filenames that should be  used
           instead.  It's used primarily when short names are used in <u>newsfeeds</u>, but the output files should use
           the full domain names of remote peers.

           In  the  map  file,  blank  lines and lines starting with a number sign ("#") are ignored.  All other
           lines should have two host names separated by a colon.  The first field is the name that  may  appear
           in  the  input  stream;  the  second field names the file to be used when the name in the first field
           appears.

           For example, the following map file may be used to map the short names used in the example  below  to
           the full domain names:

               # This is a comment
               uunet:news.uu.net
               foo:foo.com
               munnari:munnari.oz.au

       <b>-p</b> <u>pid-file</u>
           If  the  <b>-p</b>  option  is  given, <b>buffchan</b> will write a line containing its process ID (in text) to the
           specified file when it starts.

       <b>-r</b>  By default, <b>buffchan</b> sends its error messages to <u>pathlog</u>/errlog.  To suppress  this  redirection  and
           send error messages to standard error, use the <b>-r</b> flag.

       <b>-s</b>  The  <b>-s</b> flag may be used to specify a format that maps a filename from the filename fields at the end
           of each line to an actual filename.  This is a <a href="../man3/sprintf.3.html">sprintf</a>(3) format string that should contain a  single
           instance of "%s", which will be replaced with the value of the filename field (possibly after mapping
           with the map file from <b>-m</b>).  The default value is <u>pathoutgoing</u>/"%s".

       <b>-u</b>  If the <b>-u</b> flag is used, the output will be unbuffered.

</pre><h4><b>EXAMPLES</b></h4><pre>
       If <b>buffchan</b> is invoked with "-f 2" and given the following input:

           news.software.nntp &lt;<a href="mailto:1643@munnari.oz.au">1643@munnari.oz.au</a>&gt; foo uunet
           news.software.nntp &lt;<a href="mailto:102060@litchi.foo.com">102060@litchi.foo.com</a>&gt; uunet munnari
           comp.sources.unix &lt;<a href="mailto:999@news.foo.com">999@news.foo.com</a>&gt; foo uunet munnari

       then the file <u>foo</u> in <u>pathoutgoing</u> will have these lines:

           news.software.nntp &lt;<a href="mailto:1643@munnari.oz.au">1643@munnari.oz.au</a>&gt;
           comp.sources.unix &lt;<a href="mailto:999@news.foo.com">999@news.foo.com</a>&gt;

       the file <u>munnari</u> in <u>pathoutgoing</u> will have these lines:

           news.software.nntp &lt;<a href="mailto:102060@litchi.foo.com">102060@litchi.foo.com</a>&gt;
           comp.sources.unix &lt;<a href="mailto:999@news.foo.com">999@news.foo.com</a>&gt;

       and the file <u>uunet</u> in <u>pathoutgoing</u> will have these lines:

           news.software.nntp &lt;<a href="mailto:1643@munnari.oz.au">1643@munnari.oz.au</a>&gt;
           news.software.nntp &lt;<a href="mailto:102060@litchi.foo.com">102060@litchi.foo.com</a>&gt;
           comp.sources.unix &lt;<a href="mailto:999@news.foo.com">999@news.foo.com</a>&gt;

       Using <b>buffchan</b> this way can be done in <u>newsfeeds</u> with for instance:

           foo:*,@misc.*:Ap,Tm:buffchan!
           munnari:*,@rec.*:Ap,Tm:buffchan!
           uunet:*:Ap,Tm:buffchan!
           buffchan!:*:Tx,WGm*:&lt;pathbin&gt;/buffchan -f 2

       It  will  generate  the  examples  above.   See  the "W" flag in <a href="../man5/newsfeeds.5.html">newsfeeds</a>(5) for how to parameterize the
       output.

</pre><h4><b>HISTORY</b></h4><pre>
       Written  by  Rich  $alz  &lt;<a href="mailto:rsalz@uunet.uu.net">rsalz@uunet.uu.net</a>&gt;  for  InterNetNews.   Converted  to  POD  by  Russ  Allbery
       &lt;<a href="mailto:eagle@eyrie.org">eagle@eyrie.org</a>&gt;.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/ctlinnd.8.html">ctlinnd</a>(8), <a href="../man5/inn.conf.5.html">inn.conf</a>(5), <a href="../man8/innd.8.html">innd</a>(8), <a href="../man5/newsfeeds.5.html">newsfeeds</a>(5).

INN 2.7.3                                          2025-05-19                                        <u><a href="../man8/BUFFCHAN.8.html">BUFFCHAN</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>