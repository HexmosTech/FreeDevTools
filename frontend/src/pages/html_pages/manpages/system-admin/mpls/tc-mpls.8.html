<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mpls - mpls manipulation module</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/iproute2">iproute2_6.14.0-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mpls - mpls manipulation module

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>tc</b> ... <b>action</b> <b>mpls</b> { <u>POP</u> | <u>PUSH</u> | <u>MODIFY</u> | <b>dec_ttl</b> } [ <u>CONTROL</u> ]

       <u>POP</u> := <b>pop</b> <b>protocol</b> <u>MPLS_PROTO</u>

       <u>PUSH</u>  :=  { <b>push</b> | <b>mac_push</b> } [ <b>protocol</b> <u>MPLS_PROTO</u> ]  [ <b>tc</b> <u>MPLS_TC</u> ]  [ <b>ttl</b> <u>MPLS_TTL</u> ]  [ <b>bos</b> <u>MPLS_BOS</u> ]
               <b>label</b> <u>MPLS_LABEL</u>

       <u>MODIFY</u> := <b>modify</b> [ <b>label</b> <u>MPLS_LABEL</u> ]  [ <b>tc</b> <u>MPLS_TC</u> ]  [ <b>ttl</b> <u>MPLS_TTL</u> ]

       <u>CONTROL</u> := { <b>reclassify</b> | <b>pipe</b> | <b>drop</b> | <b>continue</b> | <b>pass</b> | <b>goto</b> <b>chain</b> <b>CHAIN_INDEX</b> }

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>mpls</b> action performs mpls encapsulation or decapsulation on a  packet,  reflected  by  the  operation
       modes  <u>POP</u>, <u>PUSH</u>, <u>MODIFY</u> and <u>DEC_TTL</u>.  The <u>POP</u> mode requires the ethertype of the header that follows the
       MPLS header (e.g.  IPv4 or another MPLS). It will remove the outer MPLS header and replace the  ethertype
       in  the MAC header with that passed. The <u>PUSH</u> and <u>MODIFY</u> modes update the current MPLS header information
       or add a new header.  <u>PUSH</u> requires at least an <u>MPLS_LABEL</u>.  <u>DEC_TTL</u> requires  no  arguments  and  simply
       subtracts 1 from the MPLS header TTL field.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>pop</b>    Decapsulation mode. Requires the protocol of the next header.

       <b>push</b>   Encapsulation  mode.  Adds  the  MPLS  header between the MAC and the network headers. Requires at
              least the <b>label</b> option.

       <b>mac_push</b>
              Encapsulation mode. Adds the MPLS header before the  MAC  header.  Requires  at  least  the  <b>label</b>
              option.

       <b>modify</b> Replace mode. Existing MPLS tag is replaced.  <b>label</b>, <b>tc</b>, and <b>ttl</b> are all optional.

       <b>dec_ttl</b>
              Decrement the TTL field on the outer most MPLS header.

       <b>label</b> <u>MPLS_LABEL</u>
              Specify  the  MPLS  LABEL for the outer MPLS header.  <u>MPLS_LABEL</u> is an unsigned 20bit integer, the
              format is detected automatically (e.g. prefix with '<b>0x</b>' for hexadecimal interpretation, etc.).

       <b>protocol</b> <u>MPLS_PROTO</u>
              Choose the protocol to use. For push actions this must be  <b>mpls_uc</b>  or  <b>mpls_mc</b>  (<b>mpls_uc</b>  is  the
              default).  For  pop  actions  it should be the protocol of the next header.  This option cannot be
              used with modify.

       <b>tc</b> <u>MPLS_TC</u>
              Choose the TC value for the outer MPLS header. Decimal number in range of 0-7.  Defaults to 0.

       <b>ttl</b> <u>MPLS_TTL</u>
              Choose the TTL value for the outer MPLS header. Number in range of 0-255. A non-zero default value
              will be selected if this is not explicitly set.

       <b>bos</b> <u>MPLS_BOS</u>
              Manually configure the bottom of stack bit for an MPLS header push.  The  default  is  for  TC  to
              automatically set (or unset) the bit based on the next header of the packet.

       <u>CONTROL</u>
              How to continue after executing this action.

              <b>reclassify</b>
                     Restarts  classification  by  jumping  back  to  the first filter attached to this action's
                     parent.

              <b>pipe</b>   Continue with the next action, this is the default.

              <b>drop</b>   Packet will be dropped without running further actions.

              <b>continue</b>
                     Continue classification with next filter in line.

              <b>pass</b>   Return to calling qdisc for packet processing. This ends the classification process.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following example encapsulates incoming IP packets on eth0 into MPLS with a label 123 and sends  them
       out eth1:

              #tc qdisc add dev eth0 handle ffff: ingress
              #tc filter add dev eth0 protocol ip parent ffff: flower \
                   action mpls push protocol mpls_uc label 123  \
                   action mirred egress redirect dev eth1

       In this example, incoming MPLS unicast packets on eth0 are decapsulated and redirected to eth1:

              #tc qdisc add dev eth0 handle ffff: ingress
              #tc filter add dev eth0 protocol mpls_uc parent ffff: flower \
                   action mpls pop protocol ipv4  \
                   action mirred egress redirect dev eth1

       Here is another example, where incoming Ethernet frames are encapsulated into MPLS with label 123 and TTL
       64. Then, an outer Ethernet header is added and the resulting frame is finally sent on eth1:

              #tc qdisc add dev eth0 ingress
              #tc filter add dev eth0 ingress matchall \
                   action mpls mac_push label 123 ttl 64 \
                   action vlan push_eth \
                        dst_mac 02:00:00:00:00:02 \
                        src_mac 02:00:00:00:00:01 \
                   action mirred egress redirect dev eth1

       The  following  example  assumes that incoming MPLS packets with label 123 transport Ethernet frames. The
       outer Ethernet and the MPLS headers are stripped, then the inner Ethernet frame is sent on eth1:

              #tc qdisc add dev eth0 ingress
              #tc filter add dev eth0 ingress protocol mpls_uc \
                   flower mpls_label 123 mpls_bos 1 \
                   action vlan pop_eth \
                   action mpls pop protocol teb \
                   action mirred egress redirect dev eth1

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/tc.8.html">tc</a></b>(8), <b><a href="../man8/tc-mirred.8.html">tc-mirred</a></b>(8), <b><a href="../man8/tc-vlan.8.html">tc-vlan</a></b>(8)

iproute2                                           22 May 2019                 <u>MPLS</u> <u>manipulation</u> <u>action</u> <u>in</u> <u><a href="../man8/tc.8.html">tc</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>