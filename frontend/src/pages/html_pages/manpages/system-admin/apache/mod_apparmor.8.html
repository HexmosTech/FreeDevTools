<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mod_apparmor - fine-grained AppArmor confinement for Apache</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libapache2-mod-apparmor">libapache2-mod-apparmor_4.1.1-0ubuntu6_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mod_apparmor - fine-grained AppArmor confinement for Apache

</pre><h4><b>DESCRIPTION</b></h4><pre>
       An AppArmor profile applies to an executable program; if a portion of the program needs different access
       permissions than other portions, the program can "change hats" via <b><a href="../man2/aa_change_hat.2.html">aa_change_hat</a></b>(2) to a different role,
       also known as a subprofile.  The mod_apparmor Apache module uses the <b><a href="../man2/aa_change_hat.2.html">aa_change_hat</a></b>(2) mechanism to offer
       more fine-grained confinement of dynamic elements within Apache such as individual php and perl scripts,
       while still allowing the performance benefits of using mod_php and mod_perl.

       To use mod_apparmor with Apache, ensure that mod_apparmor is configured to be loaded into Apache, either
       via a2enmod, yast or manual editing of the <b><a href="../man8/apache2.8.html">apache2</a></b>(8)/<b><a href="../man8/httpd.8.html">httpd</a></b>(8) configuration files, and restart Apache.
       Make sure that apparmor is also functioning.

       Once mod_apparmor is loaded within Apache, all requests to Apache will cause mod_apparmor to attempt to
       change into a hat that matches the ServerName for the server/vhost.  If no such hat is found, it will
       first fall back by attempting to change into a hat composed of the ServerName-URI (e.g.
       "www.example.com-/app/some.cgi").  If that hat is not found, it will fall back to attempting to use the
       hat named by the URI (e.g. "/app/some.cgi"). If that hat is not found, it will fall back to attempting to
       use the hat DEFAULT_URI; if that also does not exist, it will fall back to using the global Apache
       profile. Most static web pages can simply make use of the DEFAULT_URI hat.

       Additionally, before any requests come in to Apache, mod_apparmor will attempt to change hat into the
       HANDLING_UNTRUSTED_INPUT hat.  mod_apparmor will attempt to use this hat while Apache is doing the
       initial parsing of a given http request, before its given to a specific handler (like mod_php) for
       processing.

       Because defining hats for every URI/URL often becomes tedious, mod_apparmor provides the AAHatName and
       AADefaultHatName Apache configuration options.

       <b>AAHatName</b>
           AAHatName  allows  you  to specify a hat to be used for a given Apache &lt;Directory&gt;, &lt;DirectoryMatch&gt;,
           &lt;Location&gt; or &lt;LocationMatch&gt; directive (see the Apache documentation for more  details).  Note  that
           mod_apparmor behavior can become confused if &lt;Directory*&gt; and &lt;Location*&gt; directives are intermingled
           and  it is recommended to use one type of directive. If the hat specified by AAHatName does not exist
           in the Apache profile, then it falls back to the behavior described above.

       <b>AADefaultHatName</b>
           AADefaultHatName allows you to specify a default hat to be used for virtual hosts  and  other  Apache
           server  directives,  so that you can have different defaults for different virtual hosts. This can be
           overridden by the AAHatName directive and is checked for only if there isn't  a  matching  AAHatName.
           The  default  value of AADefaultHatName is the ServerName for the server/vhost configuration.  If the
           AADefaultHatName hat does not exist, then it falls back to the behavior described above.

</pre><h4><b>URI</b> <b>REQUEST</b> <b>SUMMARY</b></h4><pre>
       When profiling with mod_apparmor, it is helpful to keep the following order of operations in mind:

       On each URI request, mod_apparmor will  first  <b><a href="../man2/aa_change_hat.2.html">aa_change_hat</a></b>(2)  into  ^HANDLING_UNTRUSTED_INPUT,  if  it
       exists.

       Then, after performing the initial parsing of the request, mod_apparmor will:

       1.  try to <b><a href="../man2/aa_change_hat.2.html">aa_change_hat</a></b>(2) into a matching AAHatName hat if it exists and applies, otherwise it will

       2.  try  to  <b><a href="../man2/aa_change_hat.2.html">aa_change_hat</a></b>(2)  into  an  AADefaultHatName hat, either the ServerName (the default) or the
           configuration value specified by the AADefaultHatName directive, for the server/vhost,  otherwise  it
           will

       3.  try to <b><a href="../man2/aa_change_hat.2.html">aa_change_hat</a></b>(2) into the ServerName-URI, otherwise it will

       4.  try to <b><a href="../man2/aa_change_hat.2.html">aa_change_hat</a></b>(2) into the URI itself, otherwise it will

       5.  try to <b><a href="../man2/aa_change_hat.2.html">aa_change_hat</a></b>(2) into the DEFAULT_URI hat, if it exists, otherwise it will

       6.  fall back to the global Apache policy

</pre><h4><b>BUGS</b></h4><pre>
       <b>mod_apparmor()</b>  currently  only  supports  apache2,  and  has  only  been  tested  with  the  prefork MPM
       configuration -- threaded configurations of Apache may not work correctly.  For  Apache  2.4  users,  you
       should enable the mpm_prefork module.

       There   are   likely   other   bugs   lurking   about;   if   you   find   any,  please  report  them  at
       &lt;https://gitlab.com/apparmor/apparmor/-/issues&gt;.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/apparmor.7.html">apparmor</a></b>(7), <b><a href="../man8/apparmor_parser.8.html">apparmor_parser</a></b>(8), <b><a href="../man2/aa_change_hat.2.html">aa_change_hat</a></b>(2) and &lt;https://wiki.apparmor.net&gt;.

AppArmor 4.1.1                                     2025-07-23                                    <u><a href="../man8/MOD_APPARMOR.8.html">MOD_APPARMOR</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>