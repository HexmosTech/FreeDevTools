<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lcmaps_voms_poolaccount.mod  -  LCMAPS  plugin  to switch user identity based on VOMS credentials by pool</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/lcmaps-plugins-voms">lcmaps-plugins-voms_1.7.1-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       lcmaps_voms_poolaccount.mod  -  LCMAPS  plugin  to switch user identity based on VOMS credentials by pool
       accounts

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>lcmaps_voms_poolaccount.mod</b> [<b>-gridmapfile</b> <u>grid-mapfile</u>] [<b>-gridmapdir</b> <u>gridmapdir</u>] [<b>--do-not-add-primary-</b>
       <b>gid-from-mapped-account</b>] [<b>--add-primary-gid-from-mapped-account</b>] [<b>--add-primary-gid-as-secondary-gid-</b>
       <b>from-mapped-account</b>] [<b>--do-not-add-secondary-gids-from-mapped-account</b>] [<b>--add-secondary-gids-from-mapped-</b>
       <b>account</b>] [<b>--use-voms-gid</b>|<b>--use_voms_gid</b>|<b>-use_voms_gid</b>] [<b>--use-account-gid</b>] [<b>--do-not-require-primary-gid</b>]
       [<b>--require-primary-gid</b>] [<b>--do-not-use-secondary-gids</b>|<b>-do_not_use_secondary_gids</b>]
       [<b>-override_inconsistency</b>] [<b>-max_mappings_per_credential</b> <u>max</u>nr<u>of</u>mappings<u>]</u> [<b>-strict_poolprefix_match</b>
       <u>{yes|no}</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The VOMS poolaccount acquisition plugin is a 'VOMS-aware' modification  of  the  <b>lcmaps_poolaccount.mod.8</b>
       plugin.  The plugin tries to find a local account (more specifically a UserID) based on the VOMS informa‐
       tion  that  is available from LCMAPS, in particular the Fully Qualified Attribute Names (FQANs).  The ac‐
       count is acquired from an account pool. The accounts in the account pool must exist on the system, either
       locally or through a centralised account database, e.g. LDAP.

       It will first try to find an FQAN to pool-name (starting with a dot '.'  instead of an alphanumeric char‐
       acter) mapping in the grid-mapfile which will provide it with a list of local accounts.

       The <b>gridmapdir</b> directory is going to be used as a persistent and open mapping database. A pool is defined
       as being a set of accounts following a particular pattern in their naming, e.g. pool001 or atlas001.   In
       the  directory the plug-in will make a new filename consisting of the lowercase URL-encoded Subject-DN of
       the user, followed by the name of the Unix groups that are already mapped by other plug-ins.

       For example, if the FQAN is mapped to <b>.atlas</b> in the grid-mapfile, it will be mapped to the pool  accounts
       <b>atlas001</b>, <b>atlas002</b>, etc., the names of which can be found in the gridmapdir.

       If  there  is  no  pool account assigned to the user yet, the plugin will try to find a free pool account
       (i.e. one for which the link count is 1) and make a new hardlink to it with the  URL-encoded  subject  DN
       plus group names as name.

       When a user returns to this site the plugin will look for the DN of the user (URL encoded) in this direc‐
       tory. If found, the corresponding pool account will be reassigned to the user.

       Example showing the output of ls -li:
       1836080 -rw-r--r-- 2 root root %2fo%3ddutchgrid%2fo%3dusers%2fo%3dnikhef%2fcn%3djohn%20doe:pool:group004
       1836080 -rw-r--r-- 2 root root pool003
       The filename is hardlinked to the mapped account name. Creating this hardlink is designed to be an atomic
       operation and verified to work on large installations serving multiple services from one NFS-share.

       The plugin will resolve the UID of the mapped local (system) account username.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-gridmapfile</b> <u>grid-mapfile</u>
              This  file must contain FQAN to pool name mappings.  It is strongly advised to set this option and
              to set it to an absolute path to avoid usage of the wrong file(path).  When unset, the plugin will
              try to obtain the value from one of the environment variables (see <b>ENVIRONMENT</b>).  When  those  are
              also  unset, the default depends on whether the plugin runs inside a (setuid-)root application. In
              the (setuid-)root case, the default is <u>/etc/grid-security/grid-mapfile</u>.  In the  non-(setuid-)root
              case, the default is <u>&lt;homedir&gt;/.gridmap</u>.  In a (setuid-)root application, relative paths are taken
              with respect to <u>/etc/grid-security/</u>.

       <b>-gridmapdir</b> <u>gridmapdir</u>
              A directory used for the mapping database.  If this option is unset, the plugin will try to obtain
              the value from the environment variable <b>GRIDMAPDIR</b> (see <b>ENVIRONMENT</b>).  In a (setuid-)root applica‐
              tion, relative paths are taken with respect to <u>/etc/grid-security/</u>.

       <b>--do-not-add-primary-gid-from-mapped-account</b>
              After  the  account  is  mapped,  do <u>NOT</u> add the primary Group ID from the passwd-file/LDAP of the
              mapped account as a part of the mapping result.  Default is <u>NOT</u> to add the primary Group  ID,  un‐
              less  <b>--use-account-gid</b> is specified. See also <b>--add-primary-gid-from-mapped-account</b>, <b>--add-prima‐</b>
              <b>ry-gid-as-secondary-gid-from-mapped-account</b> and <b>--use-account-gid</b>.

       <b>--add-primary-gid-from-mapped-account</b>
              After the account is mapped, add the primary Group ID from the passwd-file/LDAP of the mapped  ac‐
              count  as a part of the mapping result.  Default is <u>NOT</u> to add the primary Group ID, unless <b>--use-</b>
              <b>account-gid</b> is specified. See  also  <b>--do-not-add-primary-gid-from-mapped-account</b>,  <b>--add-primary-</b>
              <b>gid-as-secondary-gid-from-mapped-account</b> and <b>--use-account-gid</b>.

       <b>--add-primary-gid-as-secondary-gid-from-mapped-account</b>
              After  the account is mapped, add the primary Group ID from the passwd-file/LDAP of the mapped ac‐
              count as a secondary Group ID as a part of the mapping result (possibly in addition to  adding  it
              as  a primary Group ID).  Default is <u>NOT</u> to add it at all. See also <b>--do-not-add-primary-gid-from-</b>
              <b>mapped-account</b>, <b>--add-primary-gid-from-mapped-account</b> and <b>--use-account-gid</b>.

       <b>--do-not-add-secondary-gids-from-mapped-account</b>
              After the account is mapped, do <u>NOT</u> add the secondary Group ID(s) from the groups-file/LDAP of the
              mapped account as secondary Group ID(s) as a part of the mapping result.  Default is  <u>NOT</u>  to  add
              the  sGIDs,  unless  <b>--use-account-gid</b> is specified. See also <b>--add-secondary-gids-from-mapped-ac‐</b>
              <b>count</b> <b>--use-account-gid</b>.

       <b>--add-secondary-gids-from-mapped-account</b>
              After the account is mapped, add the secondary Group ID(s) from the groups-file/LDAP of the mapped
              account as secondary Group ID(s) as a part of the mapping result.  Default is <u>NOT</u> to add the  sec‐
              ondary  Group ID(s), unless <b>--use-account-gid</b> is specified.  See also <b>--do-not-add-secondary-gids-</b>
              <b>from-mapped-account</b> <b>--use-account-gid</b>.

       <b>--use-voms-gid</b>|<b>--use_voms_gid</b>|<b>-use_voms_gid</b>
              This option has the opposite effect of the option <b>--use-account-gid</b>, instructing the plugin <u>NOT</u> to
              add the mapped account group information to the mapping result. This is currently already the  de‐
              fault and hence this option has no effect.  See also <b>--use-account-gid</b>.

       <b>--use-account-gid</b>
              By  default  this  plugin  will  <u>NOT</u>  add  the  primary and secondary Group ID(s) from the passwd-
              file/groups-file/LDAP of the mapped account as part of the mapping result. Specifying this  option
              will  override that default. Part or all of the group information can still be added or removed by
              using the <b>--add-*</b> and <b>--do-not-add-*</b> flags.  See also <b>--use-voms-gid</b>.

       <b>--require-primary-gid</b>
              The group names already present in the LCMAPS mapping store prior to the running  of  this  plugin
              will  be used to create the (URL encoded) lease name in the gridmapdir. This option can be used to
              enforce the existence of a primary Group ID prior to running this plug-in, which can  be  done  by
              running other plugins earlier on in the policy. Default is not to require a primary GID.

       <b>--do-not-require-primary-gid</b>
              This  option  has  the opposite effect of the option <b>--require-primary-gid</b>, instructing the plugin
              <u>NOT</u> to enforce the presence of a primary GID prior to its running. This is currently  already  the
              default and hence this option has no effect.  See also <b>--require-primary-gid</b>.

       <b>--do-not-use-secondary-gids</b>
              This  option  will prevent adding mapped secondary group names to the lease name.  Default is: add
              secondary group names to the lease name.

       <b>-override_inconsistency</b>
              Moving a user from one pool to another (because of a VO change) should normally only  be  done  by
              changing  the  grid-mapfile  indicating  the new pool for this user.  If the resulting URL-encoded
              lease (hardlink) already exists but points to a different pool account then would result from  the
              running  of this plugin, the plugin would normally fail. This option instructs the plugin to remap
              to the new pool account.

       <b>-max_mappings_per_credential</b> <u>maximum</u> <u>number</u> <u>of</u> <u>mappings</u>
              This feature is deprecated. It was intended to work together with the Globus Dynamic Account  Ser‐
              vice/Workspace  Service.   This  value  indicates  the  maximum number of accounts a user, or more
              specifically a set of credentials (=DN + FQANS), can be mapped to. Normally this number is 1.  But
              if each job should run under its own account the number should be increased.  Whether LCMAPS  will
              actually use the mapcounter depends on the LCMAPS interface being used. The lease name (or poolin‐
              dex) in the case of mapcounters looks like:

                  url_encoded(&lt;DN&gt;):gid1[:gid2[:gid3[...]]]:mapcount=&lt;mapnumber&gt;)

       <b>-strict_poolprefix_match</b> <u>{yes|no}</u>
              If  this is set to 'yes', a line in the grid-mapfile like <b>&lt;FQAN&gt;</b> <b>.pool</b> will result in mapping pool
              accounts matching only the regexp <b>pool[0-9]+</b>.  Otherwise it will be allowed  to  match  the  wider
              range of <b>pool.*</b> (legacy behaviour).

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>LCMAPS_MOD_SUCCESS</b>
              Success.

       <b>LCMAPS_MOD_FAIL</b>
              Failure.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       GRIDMAP | GLOBUSMAP | globusmap | GlobusMap
              When no grid-mapfile is specified as option to the plugin, it will try to obtain the file location
              from one of these environment variables.

       GRIDMAPDIR
              When  no  gridmapdir is specified as option to the plugin, it will try to obtain the file location
              from this environment variable.

</pre><h4><b>NOTES</b></h4><pre>
       Since version 1.6.0 the voms_poolaccount plugin also takes the  <b>requested</b> <b>username</b>  (such as forwarded by
       gsissh) into consideration. When present, the resulting pool account has to match it  in  order  for  the
       plugin to succeed. This requires LCMAPS version 1.6.0 or newer.

</pre><h4><b>BUGS</b></h4><pre>
       Please   report   any   errors  to  the  Nikhef  Grid  Middleware  Security  Team  &lt;grid-mw-security-sup‐
       <a href="mailto:port@nikhef.nl">port@nikhef.nl</a>&gt;.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/lcmaps.db.5.html">lcmaps.db</a></b>(5), <b><a href="../man3/lcmaps.3.html">lcmaps</a></b>(3).

</pre><h4><b>AUTHORS</b></h4><pre>
       LCMAPS and the LCMAPS plug-ins were  written  by  the  Grid  Middleware  Security  Team  &lt;grid-mw-securi‐
       <a href="mailto:ty@nikhef.nl">ty@nikhef.nl</a>&gt;.

Stichting FOM/Nikhef                            February 6, 2015                  <u><a href="../man8/LCMAPS_VOMS_POOLACCOUNT.MOD.8.html">LCMAPS_VOMS_POOLACCOUNT.MOD</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>