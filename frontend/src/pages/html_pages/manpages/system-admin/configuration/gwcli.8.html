<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gwcli - manage iscsi gateway configuration from the command line</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/ceph-iscsi">ceph-iscsi_3.9-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>gwcli</b> - manage iscsi gateway configuration from the command line

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>gwcli</b>  is  a  configuration  shell  interface used for viewing, editing and saving the configuration of a
       ceph/iSCSI gateway environment. It enables the administrator to  define  rbd  devices,  map  them  across
       gateway  nodes  and  export them to various clients over iSCSI. In addition to managing the iSCSI related
       elements of the configuration, the shell provides  an  overview  of  the  ceph  cluster,  describing  the
       available  pools  and  the  capacity  they  provide.  Since rbd images are thin provisioned, the capacity
       information also indicates the capacity over-commit of  the  pools,  enabling  the  admin  to  make  more
       informed choices when allocating new rbd images.

       iSCSI  services  are implemented by the kernel's LIO target subsystem layer, with iSCSI settings enforced
       by the rbd-target-gw daemon. The targetcli command may still be used to view lower level  detail  of  the
       LIO environment, but all changes <b>must</b> be made using the gwcli.

       The  gwcli shell is similar to the targetcli interface, and is also based on 'configshell'. The layout of
       the UI is a tree format, and is navigated in much the same way as a filesystem.

</pre><h4><b>USAGE</b></h4><pre>
       <b>gwcli</b> [-d | --debug]

       The -d option provides additional verbosity within the shell

       <b>gwcli</b> <b>[cmd]</b>

       Invoke gwcli as root to enter the interactive shell, or supply a command to execute without entering  the
       shell.  Within  the  shell,  us <b>ls</b> to list nodes beneath the current path. Moving around the tree is done
       using the <b>cd</b> command, or by simply entering the 'path' of the new location/node directly. Use <b>help</b>  <b>&lt;cmd&gt;</b>
       for specific help information. The shell provides tab completion for commands and command arguments.

       Configuration  state  is  persisted  within  a  rados object stored in the 'rbd' pool. gwcli orchestrates
       changes across all iscsi gateways via the rbd-target-api service running on each gateway. Once the change
       to the local LIO subsystem is complete, the change  is  committed  to  the  rados  configuration  object.
       Although 'targetcli' is available, it can only really provide a view of the local LIO configuration.

</pre><h4><b>QUICKSTART</b></h4><pre>
       gwcli  interacts  with  an  API  service  provided by each iSCSI gateway's rbd-target-api daemon. The API
       service is installed with the cli, and can be configured  by  updating  the  api_*  related  settings  in
       '/etc/ceph/iscsi-gateway.cfg'.

       Typically, the following options are regarded as site specific;

          <b>api_user</b> <b>=</b> <b>&lt;user_name&gt;</b>
          <b>api_password</b> <b>=</b> <b>&lt;password&gt;</b>
          <b>api_port</b> <b>=</b> <b>&lt;port_number&gt;</b>
          <b>api_secure</b> <b>=</b> <b>&lt;true</b> <b>or</b> <b>false&gt;</b>

       <b>NB.</b> An example iscsi-gateway.cfg file is provided under /usr/share/doc/ceph-iscsi-config*

       Access  to the API is normally restricted to the IP's of the gateway nodes, but you may also define other
       IP addresses that should be granted access to the API by adding the following entry to the  configuration
       file;

          <b>trusted_ip_list</b> <b>=</b> <b>&lt;ip_address,ip_address...&gt;</b>

       By  default  the  API  service  is  not  running with TLS, so for a more secure environment ensure iscsi-
       gateway.cfg has "api_secure = true" defined.  When  using  secure  mode  you  will  need  to  create  the
       appropriate  certificate  and  private  key files, and place them in /etc/ceph as 'iscsi-gateway.crt' and
       'iscsi-gateway.key' on <b>each</b> gateway node.

       Once these files are inplace across the nodes, the rbd-target-api service can be started. Check that  the
       API  service is enabled and in the correct mode by looking at the output of 'systemctl status rbd-target-
       api'. You should see a message similar to

          <b>*</b> <b>Running</b> <b>on</b> <b>https://0.0.0.0:5000/</b>.

       The example gwcli output below shows a small two-gateway configuration, supporting 2 iSCSI clients

       $ sudo gwcli

       /&gt; ls
       /&gt; ls
       o- / ................................................................... [...]
         o- clusters .................................................. [Clusters: 1]
         | o- ceph ...................................................... [HEALTH_OK]
         |   o- pools .................................................... [Pools: 3]
         |   | o- ec ......................... [(2+1), Commit: 0b/40G (0%), Used: 0b]
         |   | o- iscsi ...................... [(x3), Commit: 0b/20G (0%), Used: 18b]
         |   | o- rbd ........................ [(x3), Commit: 8G/20G (40%), Used: 5K]
         |   o- topology .......................................... [OSDs: 3,MONs: 3]
         o- disks .................................................... [8G, Disks: 5]
         | o- rbd ........................................................ [rbd (8G)]
         |   o- disk_1 ............................................ [rbd/disk_1 (1G)]
         |   o- disk_2 ............................................ [rbd/disk_2 (2G)]
         |   o- disk_3 ............................................ [rbd/disk_3 (2G)]
         |   o- disk_4 ............................................ [rbd/disk_4 (1G)]
         |   o- disk_5 ............................................ [rbd/disk_5 (2G)]
         o- iscsi-targets .............................................. [Targets: 1]
           o- iqn.2003-01.com.redhat.iscsi-gw:ceph-gw ................. [Gateways: 2]
             o- disks .................................................... [Disks: 5]
             | o- rbd/disk_1 ....................................... [Owner: rh7-gw1]
             | o- rbd/disk_5 ....................................... [Owner: rh7-gw2]
             o- gateways ...................................... [Up: 2/2, Portals: 2]
             | o- rh7-gw1 ..................................... [192.168.122.69 (UP)]
             | o- rh7-gw2 .................................... [192.168.122.104 (UP)]
             o- host-groups ............................................ [Groups : 1]
             | o- group1 ....................................... [Hosts: 1, Disks: 1]
             |   o- iqn.1994-05.com.redhat:rh7-client ........................ [host]
             |   o- rbd/disk_5 ............................................... [disk]
             o- hosts .................................................... [Hosts: 2]
               o- iqn.1994-05.com.redhat:myhost1 ......... [Auth: None, Disks: <a href="../man1G/1.1G.html">1</a>(1G)]
               | o- lun 0 .......................... [rbd/<a href="../man1G/disk_1.1G.html">disk_1</a>(1G), <b>Owner:</b> <b>rh7-gw2]</b>]
               o- iqn.1994-05.com.redhat:rh7-client  [LOGGED-IN, Auth: CHAP, Disks: <a href="../man2G/1.2G.html">1</a>(2G)]
                 o- lun 0 .......................... [rbd/<a href="../man2G/disk_5.2G.html">disk_5</a>(2G), <b>Owner:</b> <b>rh7-gw2]</b>]

       Disks exported through the gateways use ALUA attributes to provide ActiveOptimised and ActiveNonOptimised
       access to the rbd images. Each disk is assigned a primary owner at creation/import  time  -  shown  above
       with the <b>owner</b> attribute.

</pre><h4><b>DISKS</b></h4><pre>
       In  order  to manage rbd images (disks) within the environment there are several commands that enable you
       to create, resize and delete rbd's from the ceph cluster. When an rbd image is created, it is  registered
       with all gateways. Part of this registration process defines the gateway that will provide the active I/O
       path  to  the LUN (disk) for any/all clients. This means that the iscsi-target definition <u>and</u> the gateway
       hosts must be defined prior to any disks being created (added to the gateways). It's  also  important  to
       note  that  for  an  rbd  image  to be compatible with the iSCSI environment, it must have specific image
       features enabled (exclusive_lock, layering). The easiest way to create new  disks  is  using  the  <b>/disks</b>
       <b>create</b> command.

       <b>/disks/</b> <b>create</b> <b>pool=&lt;pool&gt;</b> <b>image=&lt;image_name&gt;</b> <b>size=&lt;N&gt;G</b>
              Using  the  create command ensure the image features are applied correctly. You can also choose to
              create your rbd images by some other means, in which case the 'create'  command  will  effectively
              'import' the rbd into the configuration leaving any data already on the device, intact.

       <b>/disks/&lt;disk_name&gt;/</b> <b>resize</b> <b>&lt;N&gt;g</b>
       <b>/disks</b> <b>resize</b> <b>&lt;disk_name&gt;</b> <b>&lt;new_size&gt;</b>
              Use the resize command to increase the capacity of a specific rbd image.

       <b>/disks/</b> <b>delete</b> <b>&lt;disk_name&gt;</b>
              The delete command allows you to remove the rbd from the LIO and ceph cluster. Prior to the delete
              being  actioned the current configuration is checked to ensure that the requested rbd image is not
              masked to any iSCSI client. Once this check is successful, the rbd image will be purged  from  the
              LIO environment on each gateway and deleted from the ceph cluster.

</pre><h4><b>ISCSI-TARGETS</b></h4><pre>
       The  iscsi-target  provides  the end-point name that clients will know the iSCSI 'cluster' as. The target
       IQN will be created across all gateways within the configuration. Once the target is defined, the  iscsi-
       target sub-tree is populated with entries for <b>gateways</b> and <b>hosts</b>.

       <b>/iscsi-targets/</b> <b>create</b> <b>&lt;valid_IQN&gt;</b>
              The  IQN  provided will be validated and defined to the configuration object. Adding gateway nodes
              will then pick up the configuration's IQN and apply it to their local LIO instance.

       <b>/iscsi-targets/</b> <b>clearconfig</b> <b>confirm=true</b>
              The clearconfig command provides the ability to return each of the  gateways  to  their  undefined
              state.  However,  since  this is a disruptive command you must remove the clients and disks first,
              before issuing a clearconfig.

</pre><h4><b>GATEWAYS</b></h4><pre>
       Gateways provide the access points for rbd images over iSCSI, so there should be a minimum of  2  defined
       to provide fault tolerance.

       <b>/iscsi-targets/&lt;iqn&gt;/</b> <b>create</b> <b>&lt;node_name&gt;</b> <b>&lt;portal_ip_address&gt;</b>
              Gateways  are  defined  by  a  node  name  (preferably  a  shortname, but it must resolve), and an
              IPv4/IPv6 address that the iSCSI 'service' will be bound to (i.e. the iSCSI  portal  IP  address).
              When  adding  a  gateway,  the  candidate machine will be checked to ensure the relevant files and
              daemons are in place.

</pre><h4><b>HOST-GROUPS</b></h4><pre>
       Host groups provide a more convenient way of managing multiple servers that  must  share  the  same  disk
       masking  configuration.  For  example in a RHV/oVirt or Vmware environment, each host needs access to the
       same LUNs. Host groups allow you to create a logical group which contains the hosts and  the  disks  that
       each  host  in  the  group  should  have access to. Please note that sharing devices across hosts needs a
       cluster aware filesystem or equivalent locking to avoid data corruption.

       <b>/iscsi-targets/&lt;iqn&gt;/host-groups/</b> <b>create</b> <b>|</b> <b>delete</b> <b>&lt;group-name&gt;</b>
              Create or delete a given group name. Deleting a group definition does <b>not</b> remove the hosts or  LUN
              masking, it simply removes the logical grouping used for management purposes.

       <b>/iscsi-targets/&lt;iqn&gt;/host-groups/&lt;group_name&gt;/</b> <b>host</b> <b>add</b> <b>|</b> <b>remove</b> <b>&lt;client-iqn&gt;</b>
              The  host  subcommand within a group definition allows you to add and remove hosts from the group.
              When adding a host, it must not have existing LUN masking in place - this restriction  ensure  lun
              id  consistency  across  all  hosts  within  the host group. Removing a host from a group does <b>not</b>
              automatically remove it's LUN masking.

       <b>/iscsi-targets/&lt;iqn&gt;/host-groups/&lt;group_name&gt;/</b> <b>disk</b> <b>add</b> <b>|</b> <b>remove</b> <b>&lt;pool&gt;.&lt;image_name&gt;</b>
              The disk subcommand enables you to add and remove disks to/from all members of the host group.

              <b>NB.</b>Once a client is a member of a host group, it's disks <b>can</b> <b>only</b> be managed at the group level.

</pre><h4><b>HOSTS</b></h4><pre>
       The 'hosts' section defines the iSCSI client definitions  (NodeACLs)  that  provide  access  to  the  rbd
       images.  The CLI provides the ability to create and delete clients, define/update chap authentication and
       add and remove rbd images for the client.

       <b>/iscsi-targets/&lt;iqn&gt;/hosts/</b> <b>create</b> <b>&lt;client_iqn&gt;</b>
              The create command will define the client  IQN  to  all  gateways  within  the  configuration.  At
              creation  time,  the  client IQN is added to a ACL that allows normal iSCSI session logins for all
              clients with the IQN. To enable CHAP authentication use the <b>auth</b> command described below.

       <b>/iscsi-targets/&lt;iqn&gt;/hosts/</b> <b>delete</b> <b>&lt;client_iqn&gt;</b>
              The delete command will attempt to remove client IQN from all gateways within  the  configuration.
              The client must be logged out, for the delete command to be successful.

       <b>/iscsi-targets/&lt;iqn&gt;/hosts/</b> <b>auth</b> <b>nochap</b>
              CHAP  authentication can be reset to initiator based ACLs target wide for all setup ACLs using the
              <b>nochap</b> keyword. If there are multiple clients, CHAP must be enabled for all  clients  or  disabled
              for all clients. gwcli does not support mixing CHAP clients with IQN ACL clients.

       <b>/iscsi-targets/&lt;iqn&gt;/hosts/&lt;client_iqn&gt;/</b> <b>auth</b> <b>chap=&lt;user&gt;/&lt;pswd&gt;</b>
              CHAP  authentication  can  be  defined  for  the client with the <b>chap=</b> parameter. The username and
              password defined here must then be used within  the  clients  login  credentials  for  this  iscsi
              target.  If  there  are multiple clients, CHAP must be enabled for all clients or disabled for all
              clients. gwcli does not support mixing CHAP clients with IQN ACL clients.

       <b>/iscsi-targets/&lt;iqn&gt;/hosts/&lt;client_iqn&gt;/</b> <b>disk</b> <b>add</b> <b>|</b> <b>remove</b> <b>&lt;disk_name&gt;</b>
              rbd images defined to the iscsi gateway, become LUNs within the LIO environment. These LUNs can be
              masked to, or masked from specific clients using the <b>disk</b> command. When a  disk  is  masked  to  a
              client, the disk is automatically assigned a LUN id. The disk-&gt;LUN id relationship is persisted in
              the  rados  configuration  object  to  ensure  that  the  disk  always appears on the clients SCSI
              interface at the same point.

              It is the Administrators responsibility to ensure that any disk  shared  between  clients  uses  a
              cluster-aware filesystem to prevent data corruption.

</pre><h4><b>EXAMPLES</b></h4><pre>
   <b>CREATING</b> <b>ISCSI</b> <b>GATEWAYS</b>
       <b>&gt;/iscsi-targets</b> <b>create</b> <b>iqn.2003-01.com.redhat.iscsi-gw:ceph-igw</b>
              Create  a  iscsi  target  name of 'iqn.2003-01.com.redhat.iscsi-gw:ceph-igw', that will be used by
              each gateway node added to the configuration

       <b>&gt;cd</b> <b>/iscsi-targets/iqn.2003-01.com.redhat.iscsi-gw:ceph-igw/gateways</b>
       <b>&gt;create</b> <b>ceph-gw-1</b> <b>10.172.19.21</b>
       <b>&gt;create</b> <b>ceph-gw-2</b> <b>10.172.19.22</b>
              Create 2 gateways, using servers ceph-gw-1 and ceph-gw-2. The iSCSI portals will be bound  to  the
              IP  addresses  provided.  During  the registration of a gateway a check is performed to ensure the
              candidate machine has the required IP address available.

   <b>ADDING</b> <b>AN</b> <b>RBD</b>
       <b>&gt;/disks/</b> <b>create</b> <b>pool=rbd</b> <b>image=disk_1</b> <b>size=50g</b>
              Create/import a 50g rbd image and register it with each gateway node

   <b>CREATING</b> <b>A</b> <b>CLIENT</b>
       <b>&gt;cd</b> <b>/iscsi-targets/iqn.2003-01.com.redhat.iscsi-gw:ceph-igw/hosts/fR</b>
       <b>&gt;create</b> <b>iqn.1994-05.com.redhat:rh7-client</b>
              Create an iscsi client called 'iqn.1994-05.com.redhat:rh7-client'. The initial  client  definition
              will  not  have  CHAP  authentication  enabled, resulting in red highlighting against this clients
              summary information in the output of the <b>ls</b> command.

   <b>ADDING</b> <b>DISKS</b> <b>TO</b> <b>A</b> <b>CLIENT</b>
       <b>&gt;/iscsi-target..eph-igw/hosts&gt;</b> <b>cd</b> <b>iqn.1994-05.com.redhat:rh7-client</b>
       <b>&gt;disk</b> <b>add</b> <b>rbd/disk_1</b>
              The first command navigates to the client's entry in the UI at which point the <b>disk</b> or  <b>auth</b>  sub-
              commands  may  be used. In this example the disk subcommand is used to mask <u>disk_1</u> in the <u>rbd</u> pool
              to the iSCSI client. The LUN  id  associated  with  this  device  is  automatically  assigned  and
              maintained by the system.

</pre><h4><b>OTHER</b> <b>COMMANDS</b></h4><pre>
       <b>export</b> <b>mode=[</b> <b>copy</b> <b>]</b>
              with  the  export  command  a  copy  of  the  current  configuration  can  be exported as a backup
              (mode=copy). The resulting output is written to stdout.

       <b>/ceph</b> <b>refresh</b>
              refreshes the ceph information present in the UI

       <b>info</b>   when run at the root of the shell (/), info will show you  configuration  settings  such  as  http
              mode, API port, local ceph cluster name and 2ndary API trusted IP addresses.

       <b>goto</b> <b>[</b> <b>gateways</b> <b>|</b> <b>hosts</b> <b>|</b> <b>host-groups</b> <b>|</b> <b>'bookmark']</b>
              to  ease  navigation  within the UI, gwcli automatically creates bookmarks for hosts and gateways.
              This allows you to switch to those sub-trees in the UI by simply using '<b>goto</b>  <b>hosts</b>'.  The  'goto'
              command will also work for any other bookmarks you create.

</pre><h4><b>FILES</b></h4><pre>
       <b><a href="file:~/gwcli.log">~/gwcli.log</a></b>
              log  file maintained by gwcli, recording all changes made via the shell interface in a timestamped
              format.

       <b><a href="file:~/.gwcli/history.txt">~/.gwcli/history.txt</a></b>
              log containing a record of all commands executed within the gwcli shell on this system.

</pre><h4><b>AUTHOR</b></h4><pre>
       Written by Paul Cuzner (<a href="mailto:pcuzner@redhat.com">pcuzner@redhat.com</a>)

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs via &lt;https://github.com/ceph/ceph-iscsi-cli/issues&gt;

23 Jul 2017                                 Ceph iSCSI Gateway Tools                                    <u><a href="../man8/gwcli.8.html">gwcli</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>