<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>integritysetup - manage dm-integrity (block level integrity) volumes</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/cryptsetup-bin">cryptsetup-bin_2.8.0-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       integritysetup - manage dm-integrity (block level integrity) volumes

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>integritysetup</b> <b>&lt;action&gt;</b> <b>[&lt;options&gt;]</b> <b>&lt;action</b> <b>args&gt;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Integritysetup is used to configure dm-integrity managed device-mapper mappings.

       Device-mapper integrity target provides read-write transparent integrity checking of block devices. The
       dm-integrity target emulates an additional data integrity field per-sector. You can use this additional
       field directly with integritysetup utility, or indirectly (for authenticated encryption) through
       cryptsetup.

</pre><h4><b>BASIC</b> <b>ACTIONS</b></h4><pre>
       Integritysetup supports these operations:

   <b>FORMAT</b>
       <b>format</b> <b>&lt;device&gt;</b>

       Formats &lt;device&gt; (calculates space and dm-integrity superblock and wipes the device).

       <b>&lt;options&gt;</b> can be [--data-device, --batch-mode, --no-wipe, --journal-size, --interleave-sectors,
       --tag-size, --integrity, --integrity-key-size, --integrity-key-file, --sector-size, --progress-frequency,
       --progress-json].

   <b>OPEN</b>
       <b>open</b> <b>&lt;device&gt;</b> <b>&lt;name&gt;</b>
       create &lt;name&gt; &lt;device&gt; (<b>OBSOLETE</b> <b>syntax</b>)

       Open a mapping with &lt;name&gt; backed by device &lt;device&gt;.

       If the integrity algorithm of the device is non-default, then the algorithm should be specified with the
       <b>--integrity</b> option. This will not be detected from the device.

       <b>&lt;options&gt;</b> can be [--data-device, --batch-mode, --journal-watermark, --journal-commit-time,
       --buffer-sectors, --integrity, --integrity-key-size, --integrity-key-file, --integrity-no-journal,
       --integrity-recalculate, --integrity-recalculate-reset,--integrity-recovery-mode, --allow-discards].

   <b>CLOSE</b>
       <b>close</b> <b>&lt;name&gt;</b>
       remove &lt;name&gt; (<b>OBSOLETE</b> <b>syntax</b>)

       Removes existing mapping &lt;name&gt;.

       <b>&lt;options&gt;</b> can be [--deferred] or [--cancel-deferred]

   <b>STATUS</b>
       <b>status</b> <b>&lt;name&gt;</b>

       Reports status for the active integrity mapping &lt;name&gt;.

   <b>DUMP</b>
       <b>dump</b> <b>&lt;device&gt;</b>

       Reports parameters from on-disk stored superblock.

   <b>RESIZE</b>
       <b>resize</b> <b>&lt;name&gt;</b>

       Resizes an active mapping &lt;name&gt;.

       If --size (in 512-bytes sectors) or --device-size are not specified, the size is computed from the
       underlying device. After resize, the <b>recalculating</b> flag is set. If --wipe flag is set and the size of the
       device is increased, the newly added section will be wiped.

       Increasing the size of integrity volumes is available since the Linux kernel version 5.7, shrinking
       should work on older kernels too.

       <b>&lt;options&gt;</b> can be [--size, --device-size, --wipe].

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--allow-discards</b>
           Allow the use of discard (TRIM) requests for the device. This option is available since the Linux
           kernel version 5.7.

       <b>--batch-mode,</b> <b>-q</b>
           Do not ask for confirmation.

       <b>--bitmap-flush-time</b> <b>MS</b>
           Bitmap flush time in milliseconds.

           <b>WARNING:</b> In case of a crash, it is possible that the data and integrity tag doesn’t match if the
           journal is disabled.

       <b>--bitmap-sectors-per-bit</b> <b>SECTORS</b>
           Number of 512-byte sectors per bitmap bit, the value must be power of two.

       <b>--buffer-sectors</b> <b>SECTORS</b>
           The number of sectors in one buffer.

           The tag area is accessed using buffers, the large buffer size means that the I/O size will be larger,
           but there could be less I/Os issued.

       <b>--cancel-deferred</b>
           Removes a previously configured deferred device removal in <b>close</b> command.

       <b>--data-device</b> <b>&lt;data_device&gt;</b>
           Specify a separate data device that contains existing data. The &lt;device&gt; then will contain calculated
           integrity tags and journal for data on &lt;data_device&gt;.

           <b>NOTE:</b> To not wipe the data device after initial format, also specify --no-wipe option and activate
           with --integrity-recalculate to automatically recalculate integrity tags.

       <b>--debug</b>
           Run in debug mode with full diagnostic logs. Debug output lines are always prefixed by <b>#</b>.

       <b>--deferred</b>
           Defers device removal in <b>close</b> command until the last user closes it.

       <b>--help,</b> <b>-?</b>
           Show help text and default parameters.

       <b>--integrity,</b> <b>-I</b> <b>ALGORITHM</b>
           Use internal integrity calculation (standalone mode). The integrity algorithm can be CRC
           (crc32c/crc32), non-cryptographic hash function (xxhash64) or hash function (sha1, sha256).

           For HMAC (hmac-sha256) you have also to specify an integrity key and its size.

       <b>--integrity-bitmap-mode.</b> <b>-B</b>
           Use alternate bitmap mode (available since Linux kernel 5.2) where dm-integrity uses bitmap instead
           of a journal. If a bit in the bitmap is 1, the corresponding region’s data and integrity tags are not
           synchronized - if the machine crashes, the unsynchronized regions will be recalculated. The bitmap
           mode is faster than the journal mode, because we don’t have to write the data twice, but it is also
           less reliable, because if data corruption happens when the machine crashes, it may not be detected.

       <b>--integrity-inline</b>
           Store integrity tags to hardware sector integrity fields. The device must support sectors with
           additional protection information (PI, also known as DIF - data integrity field) of the requested
           size. Another storage subsystem must not use the additional field (the device must present a "nop"
           profile in the kernel). Note that some devices must be reformatted at a low level to support this
           option; for NVMe devices, see <a href="../man1/nvme.1.html">nvme</a>(1) id-ns LBA profiles.

           No journal or bitmap is used in this mode. The device should operate with native speed (without any
           overhead). This option is available since the Linux kernel version 6.11.

       <b>--integrity-key-file</b> <b>FILE</b>
           The file with the integrity key.

       <b>--integrity-key-size</b> <b>BYTES</b>
           The size of the data integrity key. Maximum is 4096 bytes.

       <b>--integrity-no-journal,</b> <b>-D</b>
           Disable journal for integrity device.

       <b>--integrity-recalculate</b>
           Automatically recalculate integrity tags in kernel on activation. The device can be used during
           automatic integrity recalculation but becomes fully integrity protected only after the background
           operation is finished. This option is available since the Linux kernel version 4.19.

       <b>--integrity-recalculate-reset</b>
           Restart recalculation from the beginning of the device. It can be used to change the integrity
           checksum function. Note it does not change the tag length. This option is available since the Linux
           kernel version 5.13.

       <b>--integrity-recovery-mode.</b> <b>-R</b>
           Recovery mode (no journal, no tag checking).

       <b>--interleave-sectors</b> <b>SECTORS</b>
           The number of interleaved sectors.

       <b>--journal-commit-time</b> <b>MS</b>
           Commit time in milliseconds. When this time passes (and no explicit flush operation was issued), the
           journal is written.

       <b>--journal-crypt</b> <b>ALGORITHM</b>
           Encryption algorithm for journal data area. You can use a block cipher here such as cbc-aes or a
           stream cipher, for example, chacha20 or ctr-aes.

           <b>NOTE:</b> The journal encryption options are only intended for testing. Using journal encryption does not
           make sense without encryption of the data.

       <b>--journal-crypt-key-file</b> <b>FILE</b>
           The file with the journal encryption key.

       <b>--journal-crypt-key-size</b> <b>BYTES</b>
           The size of the journal encryption key. Maximum is 4096 bytes.

       <b>--journal-integrity</b> <b>ALGORITHM</b>
           Integrity algorithm for journal area. See --integrity option for detailed specification.

       <b>--journal-integrity-key-file</b> <b>FILE</b>
           The file with the integrity key.

       <b>--journal-integrity-key-size</b> <b>BYTES</b>
           The size of the journal integrity key. Maximum is 4096 bytes.

       <b>--journal-size,</b> <b>-j</b> <b>BYTES</b>
           Size of the journal.

       <b>--journal-watermark</b> <b>PERCENT</b>
           Journal watermark in percents. When the size of the journal exceeds this watermark, the journal flush
           will be started.

       <b>--no-wipe</b>
           Do not wipe the device after format. A device that is not initially wiped will contain invalid
           checksums.

       <b>--progress-frequency</b> <b>&lt;seconds&gt;</b>
           Print separate line every &lt;seconds&gt; with wipe progress.

       <b>--progress-json</b>
           Prints wipe progress data in json format suitable mostly for machine processing. It prints separate
           line every half second (or based on --progress-frequency value). The JSON output looks as follows
           during wipe progress (except it’s compact single line):

               {
                 "device":"/dev/sda",      // backing device or file
                 "device_bytes":"8192",    // bytes wiped so far
                 "device_size":"44040192", // total bytes to wipe
                 "speed":"126877696",      // calculated speed in bytes per second (based on progress so far)
                 "eta_ms":"2520012",       // estimated time to finish wipe in milliseconds
                 "time_ms":"5561235"       // total time spent wiping device in milliseconds
               }

           Note on numbers in JSON output: Due to JSON parsers limitations all numbers are represented in a
           string format due to need of full 64bit unsigned integers.

       <b>--sector-size,</b> <b>-s</b> <b>BYTES</b>
           Sector size (power of two: 512, 1024, 2048, 4096).

       <b>--tag-size,</b> <b>-t</b> <b>BYTES</b>
           Size of the integrity tag per-sector (here the integrity function will store authentication tag).

           <b>NOTE:</b> The size can be smaller that output size of the hash function, in that case only part of the
           hash will be stored.

       <b>--usage</b>
           Show short option help.

       <b>--verbose,</b> <b>-v</b>
           Print more information on command execution.

       <b>--version,</b> <b>-V</b>
           Show the program version.

       <b>--wipe</b>
           Wipe the newly allocated area after resize to bigger size. If this flag is not set, checksums will be
           calculated for the data previously stored in the newly allocated area.

</pre><h4><b>LEGACY</b> <b>COMPATIBILITY</b> <b>OPTIONS</b></h4><pre>
       <b>WARNING:</b>
           Do not use these options until you need compatibility with specific old kernel.

       <b>--integrity-legacy-padding</b>
           Use inefficient legacy padding.

       <b>--integrity-legacy-hmac</b>
           Use old flawed HMAC calculation (also does not protect superblock).

       <b>--integrity-legacy-recalculate</b>
           Allow insecure recalculating of volumes with HMAC keys (recalculation offset in superblock is not
           protected).

</pre><h4><b>RETURN</b> <b>CODES</b></h4><pre>
       Integritysetup returns <b>0</b> on success and a non-zero value on error.

       Error codes are: <b>1</b> wrong parameters, <b>2</b> no permission, <b>3</b> out of memory, <b>4</b> wrong device specified, <b>5</b> device
       already exists or device is busy.

</pre><h4><b>NOTES</b></h4><pre>
       The dm-integrity target is available since Linux kernel version 4.12.

       Format and activation of an integrity device always require superuser privilege because the superblock is
       calculated and handled in dm-integrity kernel target.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Format the device with default standalone mode (CRC32C):

       <b>integritysetup</b> <b>format</b> <b>&lt;device&gt;</b>

       Open the device with default parameters:

       <b>integritysetup</b> <b>open</b> <b>&lt;device&gt;</b> <b>test</b>

       Format the device in standalone mode for use with HMAC(SHA256):

       <b>integritysetup</b> <b>format</b> <b>&lt;device&gt;</b> <b>--tag-size</b> <b>32</b> <b>--integrity</b> <b>hmac-sha256</b> <b>--integrity-key-file</b> <b>&lt;keyfile&gt;</b>
       <b>--integrity-key-size</b> <b>&lt;key_bytes&gt;</b>

       Open (activate) the device with HMAC(SHA256) and HMAC key in file:

       <b>integritysetup</b> <b>open</b> <b>&lt;device&gt;</b> <b>test</b> <b>--integrity</b> <b>hmac-sha256</b> <b>--integrity-key-file</b> <b>&lt;keyfile&gt;</b>
       <b>--integrity-key-size</b> <b>&lt;key_bytes&gt;</b>

       Dump dm-integrity superblock information:

       <b>integritysetup</b> <b>dump</b> <b>&lt;device&gt;</b>

</pre><h4><b>DM-INTEGRITY</b> <b>ON-DISK</b> <b>FORMAT</b></h4><pre>
       The on-disk format specification available at <b>DMIntegrity</b>
       &lt;https://gitlab.com/cryptsetup/cryptsetup/wikis/DMIntegrity&gt; page.

</pre><h4><b>AUTHORS</b></h4><pre>
       The integritysetup tool is written by Milan Broz &lt;<a href="mailto:gmazyland@gmail.com">gmazyland@gmail.com</a>&gt;.

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs at <b>cryptsetup</b> <b>mailing</b> <b>list</b> &lt;<a href="mailto:cryptsetup@lists.linux.dev">cryptsetup@lists.linux.dev</a>&gt; or in <b>Issues</b> <b>project</b> <b>section</b>
       &lt;https://gitlab.com/cryptsetup/cryptsetup/-/issues/new&gt;.

       Please attach output of the failed command with --debug option added.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>Cryptsetup</b> <b>FAQ</b> &lt;https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions&gt;

       <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8), <b><a href="../man8/integritysetup.8.html">integritysetup</a></b>(8) and <b><a href="../man8/veritysetup.8.html">veritysetup</a></b>(8)

</pre><h4><b>CRYPTSETUP</b></h4><pre>
       Part of <b>cryptsetup</b> <b>project</b> &lt;https://gitlab.com/cryptsetup/cryptsetup/&gt;.

integritysetup 2.8.0                               2025-07-25                                  <u><a href="../man8/INTEGRITYSETUP.8.html">INTEGRITYSETUP</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>