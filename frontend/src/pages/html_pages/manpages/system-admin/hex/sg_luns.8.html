<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sg_luns - send SCSI REPORT LUNS command or decode given LUN</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/sg3-utils">sg3-utils_1.48-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sg_luns - send SCSI REPORT LUNS command or decode given LUN

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>sg_luns</b>  [<u>--decode</u>]  [<u>--help</u>]  [<u>--hex</u>] [<u>--inhex=FN</u>] [<u>--inner-hex</u>] [<u>--json[=JO]</u>] [<u>--js-file=JFN</u>] [<u>--linux</u>]
       [<u>--lu_cong</u>] [<u>--maxlen=LEN</u>] [<u>--quiet</u>] [<u>--raw</u>] [<u>--readonly</u>]  [<u>--select=SR</u>]  [<u>--sinq_inraw=RFN</u>]  [<u>--verbose</u>]
       [<u>--version</u>] <u>DEVICE</u>

       <b>sg_luns</b> <u>--test=ALUN</u> [<u>--decode</u>] [<u>--hex</u>] [<u>--inner-hex</u>] [<u>--lu_cong</u>] [<u>--verbose</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       In the first form shown in the SYNOPSIS this utility sends the SCSI REPORT LUNS command to the <u>DEVICE</u> and
       outputs  the  response.  The  response  should  be  a  list of LUNs ("a LUN inventory") for the I_T nexus
       associated with the <u>DEVICE</u>. Roughly speaking that is all LUNs that  share  the  target  device  that  the
       REPORT  LUNS  command  is sent through. This command is defined in the SPC-3 and SPC-4 SCSI standards and
       its support is mandatory. The most recent draft if SPC-6 revision 1.

       When the <u>--test=ALUN</u> option is given (the second form in the SYNOPSIS), then the <u>ALUN</u> value is decoded as
       outlined in various SCSI Architecture Model (SAM) standards and recent drafts  (e.g.  SAM-6  revision  2,
       section 4.7) .

       Where  required below the first form shown in the SYNOPSIS is called "device mode" and the second form is
       called "test mode".

</pre><h4><b>OPTIONS</b></h4><pre>
       Arguments to long options are mandatory for short options as well.

       <b>-d</b>, <b>--decode</b>
              decode LUNs into their component parts, as described in the LUN section of SAM-3, SAM-4 and SAM-5.
              [test mode] <u>ALUN</u> is decoded irrespective of whether this option is given or not. If this option is
              given once then the given <u>ALUN</u> is output in T10 preferred format (which is 8 pairs of hex  digits,
              each  separated  by  a  space).  If  given twice then the given <u>ALUN</u> is output in an alternate T10
              format  made  up  of  four  quads  of  hex  digits  with  each  quad  separated  by  a  "-"  (e.g.
              C101-0000-0000-0000).

       <b>-h</b>, <b>--help</b>
              output the usage message then exit.

       <b>-H</b>, <b>--hex</b>
              [device  mode]  when  given  once  this  utility will output the SCSI response (i.e.  the data-out
              buffer) to the REPORT LUNS command in ASCII hex then exit. When given twice it causes <u>--decode</u>  to
              output component fields in hex rather than decimal. Notice that this (i.e. how '-HH' is processed)
              differs from the description in <a href="../man8/sg3_utils.8.html">sg3_utils</a>(8). The <u>--inner-hex</u> option has the same action as '-HH'.
              When  this  option  is used three (or more) times the hex output is suitable for placing in a file
              and using it with a later sg_luns invocation with the <u>--inhex=FN</u> option.
              [test mode] when this option is given, then decoded component fields of <u>ALUN</u> are output in hex.
              When this option is given three or more times, ASCII hex bytes are output (up to 16 per line) with
              no leading address or index. This output is suitable for placing in a file and later invocation of
              this utility decoding it with the <u>--inhex=FN</u> option. When  this  option  is  used  four  times,  a
              comment line (starting with '#' is added before the hex) describing what the hex was generated by.
              A file containing such comments is still parsable by the <u>--inhex=FN</u> option.

       <b>-i</b>, <b>--inhex</b>=<u>FN</u>
              <u>FN</u>  is  expected  to  be a file name (or '-' for stdin) which contains ASCII hexadecimal or binary
              representing a REPORT LUNS response. This utility will then decode that response.  See  the  "HEX,
              BINARY  AND  JSON  FORMATS"  section  in  the sg3_utils manpage for more information. If the <u>--raw</u>
              option is also given then <u>FN</u> is treated as binary.

       <b>-I</b>, <b>--inner-hex</b>
              used together with the <u>--decode</u> option so that the decoded values are shown  in  hexadecimal.  The
              default action is to show decoded values in decimal.  This option has the same action as '-HH' but
              the intent is a little clearer with this option.

       <b>-j</b>[=<u>JO</u>], <b>--json</b>[=<u>JO</u>]
              output  is  in  JSON  format instead of plain text form. Note that arguments to the short and long
              form are themselves optional and if present start with "=" and no whitespace is  permitted  around
              that "=".
              See sg3_utils_json manpage or use '?' for <u>JO</u> to get a summary.

       <b>-J</b>, <b>--js-file</b>=<u>JFN</u>
              output  is  in  JSON  format  and  it  is sent to a file named <u>JFN</u>. If that file exists then it is
              truncated. By default, the JSON output is sent to stdout.
              When this option is given,  the  <u>--json[=JO]</u>  option  is  implied  and  need  not  be  given.  The
              <u>--json[=JO]</u> option may still be needed to set the <u>JO</u> parameter to non-default values.

       <b>-l</b>, <b>--linux</b>
              this  option  is  only  available in Linux. After the T10 representation of each 64 bit LUN (in 16
              hexadecimal digits), if this option is given then to the right, in square brackets, is  the  Linux
              LUN  integer in decimal.  If the <u>--hex</u> option is given twice (e.g. -HH) as well then the Linux LUN
              integer is output in hexadecimal.

       <b>-L</b>, <b>--lu_cong</b>
              this option is only considered with <u>--decode</u>. When given once then the list of LUNs is decoded  as
              if  the LU_CONG bit was set in each LU's corresponding INQUIRY response. When given twice the list
              of LUNs is decoded as if the LU_CONG bit was clear in each LU's  corresponding  INQUIRY  response.
              When  this option is not given and <u>--decode</u> is given then an INQUIRY is sent to the <u>DEVICE</u> and the
              setting of its LU_CONG bit is used to decode the list of LUNs.
              [test mode] decode <u>ALUN</u> as if the LU_CONG  bit  is  set  in  its  corresponding  standard  INQUIRY
              response.  In other words treat <u>ALUN</u> as if it is a conglomerate LUN. If not given (or given twice)
              then decode <u>ALUN</u> as if the LU_CONG bit is clear.

       <b>-m</b>, <b>--maxlen</b>=<u>LEN</u>
              where <u>LEN</u> is the (maximum) response length in bytes. It is placed in the cdb's "allocation length"
              field. If not given (or <u>LEN</u> is zero) then 8192 is used.  The  maximum  allowed  value  of  <u>LEN</u>  is
              1048576.

       <b>-q</b>, <b>--quiet</b>
              output only the ASCII hex rendering of each report LUN, one per line.  Without the <u>--quiet</u> option,
              there is header information printed before the LUN listing.

       <b>-r</b>, <b>--raw</b>
              output the SCSI response (i.e. the data-out buffer) in binary (to stdout).

       <b>-R</b>, <b>--readonly</b>
              open  the  <u>DEVICE</u>  read-only  (e.g.  in  Unix  with the O_RDONLY flag).  The default is to open it
              read-write.

       <b>-s</b>, <b>--select</b>=<u>SR</u>
              <u>SR</u> is placed in the SELECT REPORT field of the SCSI REPORT LUNS command. The default value  is  0.
              Hexadecimal  values  may  be given with a leading "0x" or a trailing "h". For detailed information
              see the REPORT LUNS command in SPC (most  recent  is  SPC-4  revision  37  in  section  6.33).  To
              simplify,  for  the I_T nexus associated with the <u>DEVICE</u>, the meanings of the <u>SR</u> values defined to
              date for SPC-4 are:
                  <b>0</b> : most luns excluding well known logical unit numbers
                  <b>1</b> : well known logical unit numbers
                  <b>2</b> : all luns accessible to this I_T nexus
                  <b>0x10</b> : only accessible administrative luns
                  <b>0x11</b> : administrative luns plus non-conglomerate luns (see SPC-4)
                  <b>0x12</b> : if <u>DEVICE</u> is an administrative LU, then report its
                         lun plus its subsidiary luns
              For <u>SR</u> values 0x10 and 0x11, the <u>DEVICE</u> must be either LUN 0 or the REPORT LUNS well known logical
              unit. Values between 0xf8 and 0xff (inclusive) are vendor specific,  other  values  are  reserved.
              This utility will accept any value between 0 and 255 (0xff) for <u>SR</u> .

       <b>-Q</b>, <b>--sinq_inraw</b>=<u>RFN</u>
              where  <u>RFN</u>  is  a  filename  containing  binary standard INQUIRY response data that matches either
              <u>DEVICE</u> or <u>FN</u>. Linux places this standard INQUIRY  response  in  its  sysfs  pseudo  filesystem.  A
              typical  location  is  at <a href="file:/sys/class/scsi_device/">/sys/class/scsi_device/</a>&lt;hctl&gt;/device/inquiry where &lt;hctl&gt; is a four part
              numeric tuple separated by colons. This tuple distinguishes the device  from  any  others  on  the
              system.
              Currently  the LU_CONG field is read from the standard INQUIRY response when this option is given.
              The <u>--raw</u> option has no effect on this option. The <u>DEVICE</u> argument may be given with this option.

       <b>-t</b>, <b>--test</b>=<u>ALUN</u>
              <u>ALUN</u> is assumed to be a hexadecimal number in ASCII hex or the letter 'L' followed  by  a  decimal
              number  (see  below).  The  hexadecimal  number  can be up to 64 bits in size (i.e. 16 hexadecimal
              digits) and is  padded  to  the  right  if  less  than  16  hexadecimal  digits  are  given  (e.g.
              <u>--test=0122003a</u>  represents  T10  LUN:  01 22 00 3a 00 00 00 00).  <u>ALUN</u> may be prefixed by '0x' or
              '0X' (e.g. the previous example could have been <u>--test=0x0122003a</u>). <u>ALUN</u> may also  be  given  with
              spaces,  tabs, or a '-' between each byte (or other grouping (e.g.  c101-0000-0000-0000)). However
              in the case of space or tab separators the <u>ALUN</u> would need to be surrounded by  single  or  double
              quotes.
              In the leading 'L' case the, following decimal number (hex if preceded by '0x') is assumed to be a
              Linux  "word  flipped"  LUN  which is converted into a T10 LUN representation and printed. In both
              cases the number is interpreted as a LUN and decoded as if the <u>--decode</u>  option  had  been  given.
              Also  when <u>ALUN</u> is a hexadecimal number it can have a trailing 'L' in which case the corresponding
              Linux "word flipped" LUN value is output. The LUN is decoded in all cases.
              The action when used with <u>--decode</u> is explained under that option.

       <b>-v</b>, <b>--verbose</b>
              increase the level of verbosity, (i.e. debug output).

       <b>-V</b>, <b>--version</b>
              print the version string and then exit.

</pre><h4><b>NOTES</b></h4><pre>
       The SCSI REPORT LUNS command is important for Logical Unit (LU) discovery.   After  a  target  device  is
       discovered  (usually  via  some  transport  specific  mechanism) and after sending an INQUIRY command (to
       determine the LU_CONG setting), a REPORT LUNS command should either be sent to LUN 0 (which is Peripheral
       device addressing method with bus_id=0 and target/lun=0) or to the  REPORT  LUNS  well  known  LUN  (i.e.
       0xc101000000000000).  SAM-5  requires  that  one  of  these  responds  with an inventory of LUNS that are
       contained in this target device.

       In test mode, if the <u>--hex</u> option is given once then in the decoded output, some of the component  fields
       are  printed  in  hex  with  leading  zeros.  The leading zeros are to indicate the size of the component
       field. For example: in the Peripheral device addressing method (16 bits overall), the bus ID  is  6  bits
       wide  and  the  target/LUN field is 8 bits wide; so both are shown with two hex digits (e.g. bus_id=0x02,
       target=0x3a).

</pre><h4><b>EXAMPLES</b></h4><pre>
       Typically by the time user space programs get to run, SCSI LUs have been discovered. In Linux the  lsscsi
       utility  lists  the LUs that are currently present. The LUN of a device (LU) is the fourth element in the
       tuple at the beginning of each line. Below we see a target (or "I_T Nexus": "6:0:0") has two LUNS: 1  and
       49409.  If  49409 is converted into T10 LUN format it is 0xc101000000000000 which is the REPORT LUNS well
       known LUN.

         # lsscsi -g
         [6:0:0:1]    disk    Linux    scsi_debug       0004  /dev/sdb   /dev/sg1
         [6:0:0:2]    disk    Linux    scsi_debug       0004  /dev/sdc   /dev/sg2
         [6:0:0:49409]wlun    Linux    scsi_debug       0004  -          /dev/sg3

       We could send a REPORT LUNS command (with <u>SR</u> 0x0, 0x1 or 0x2) to any of those file device nodes  and  get
       the same result. Below we use /dev/sg1 :

         # sg_luns /dev/sg1
         Lun list length = 16 which implies 2 lun entries
         Report luns [select_report=0x0]:
             0001000000000000
             0002000000000000

       That is a bit noisy so cut down the clutter with <u>--quiet</u>:

         # sg_luns -q /dev/sg1
         0001000000000000
         0002000000000000

       Now decode that LUN into its component parts:

         # sg_luns -d -q /dev/sg1
         0001000000000000
               Peripheral device addressing: lun=1
         0002000000000000
               Peripheral device addressing: lun=2

       Now use <u>--select=1</u> to find out if there are any well known LUNs:

         # sg_luns -q -s 1 /dev/sg1
         c101000000000000

       So how many LUNs do we have all together (associated with the current I_T Nexus):

         # sg_luns -q -s 2 /dev/sg1
         0001000000000000
         0002000000000000
         c101000000000000

         # sg_luns -q -s 2 -d /dev/sg1
         0001000000000000
               Peripheral device addressing: lun=1
         0002000000000000
               Peripheral device addressing: lun=1
         c101000000000000
               REPORT LUNS well known logical unit

       The  following example uses the <u>--linux</u> option and is not available in other operating systems. The extra
       number in square brackets is the Linux version of T10 LUN shown at the start of the line.

         # sg_luns -q -s 2 -l /dev/sg1
         0001000000000000    [1]
         0002000000000000    [2]
         c101000000000000    [49409]

       Now we use the <u>--test=</u> option to decode LUNS input on the command line (rather than send  a  REPORT  LUNS
       command and act on the response):

         # sg_luns --test=0002000000000000
         Decoded LUN:
           Peripheral device addressing: lun=2

         # sg_luns --test="c1 01"
         Decoded LUN:
           REPORT LUNS well known logical unit

         # sg_luns -t 0x023a004b -H
         Decoded LUN:
           Peripheral device addressing: bus_id=0x02, target=0x3a
           &gt;&gt;Second level addressing:
             Peripheral device addressing: lun=0x4b

       The  next  example  is Linux specific as we try to find out what the Linux LUN 49409 translates to in the
       T10 world:

         # sg_luns --test=L49409
         64 bit LUN in T10 preferred (hex) format:  c1 01 00 00 00 00 00 00
         Decoded LUN:
           REPORT LUNS well known logical unit

       And the mapping between T10 and Linux LUN representations can be done the other way:

         # sg_luns -t c101L
         Linux 'word flipped' integer LUN representation: 49409
         Decoded LUN:
           REPORT LUNS well known logical unit

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       The exit status of sg_luns is 0 when it is successful. Otherwise see the <a href="../man8/sg3_utils.8.html">sg3_utils</a>(8) man page.

</pre><h4><b>AUTHORS</b></h4><pre>
       Written by Douglas Gilbert.

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;dgilbert at interlog dot com&gt;.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright © 2004-2023 Douglas Gilbert
       This software is  distributed  under  a  BSD-2-Clause  license.  There  is  NO  warranty;  not  even  for
       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/sg_inq.8.html">sg_inq</a>(8),<a href="../man8/sg3_utils.8.html">sg3_utils</a>(8)</b>

sg3_utils-1.48                                      June 2023                                         <u><a href="../man8/SG_LUNS.8.html">SG_LUNS</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>