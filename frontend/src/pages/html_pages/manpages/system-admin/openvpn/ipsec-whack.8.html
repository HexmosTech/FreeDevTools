<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ipsec-whack - ipsec whack : IPsec IKE keying daemon low-level control interface</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libreswan">libreswan_5.2-2.2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ipsec-whack - ipsec whack : IPsec IKE keying daemon low-level control interface

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>ipsec</b> <b>whack</b> [--help] [--version]

       <b>ipsec</b> <b>whack</b> --name <u>connection-name</u> [[--ipv4] | [--ipv6]] [[--tunnelipv4] | [--tunnelipv6]]
                   [--id <u>identity</u>] [--host <u>ip-address</u>] [--cert <u>friendly_name</u>] [--ckaid <u>CKAID</u>]
                   [--ca <u>distinguished</u> <u>name</u>] [--groups <u>access</u> <u>control</u> <u>groups</u>]
                   [--sendcert yes | forced | always | ifasked | no | never] [--sendca none | issuer | all]
                   [--certtype <u>number</u>] [--ikeport <u>portnumber</u>] [--nexthop <u>ip-address</u>] [[--client <u>subnet</u>] |
                   [--subnet <u>subnet</u>]] [--clientprotoport <u>protocol</u>/<u>port</u>] [--fragmentation yes | no | force]
                   [--narrowing yes | no] [--sourceip <u>ip-address</u>] [--interface-ip <u>ip-address/mask</u>]
                   [--xauthserver] [--xauthclient] [--modecfgserver] [--modecfgclient]
                   [--modecfgdns <u>ip-address,</u> <u>ip-address,</u> <u>...</u>] [--modecfgdomains <u>DNS-domain,</u> <u>DNS-domain,</u> <u>...</u>]
                   [--modecfgbanner <u>login-banner</u>] [--dnskeyondemand] [--updown <u>updown</u>]
                   --to
                   [--id <u>identity</u>] [--host <u>ip-address</u>] [--cert <u>friendly_name</u>] [--ckaid <u>CKAID</u>]
                   [--ca <u>distinguished</u> <u>name</u>] [--groups <u>access</u> <u>control</u> <u>groups</u>]
                   [--sendcert yes | always | ifasked | no | never] [--certtype <u>number</u>] [--ikeport <u>port-number</u>]
                   [--nexthop <u>ip-address</u>] [--subnet <u>subnet</u>] [--client <u>subnet</u>] [--clientprotoport <u>protocol</u>/<u>port</u>]
                   [--sourceip <u>ip-address</u>] [--interface-ip <u>ip-address/mask</u>] [--xauthserver] [--xauthclient]
                   [--modecfgserver] [--modecfgclient] [--modecfgdns <u>ip-address,</u> <u>ip-address,</u> <u>...</u>]
                   [--modecfgdomains <u>DNS-domain,</u> <u>DNS-domain,</u> <u>...</u>] [--dnskeyondemand] [--updown <u>updown</u>]

                   [--tunnel] [--psk] [--rsasig] [--encapsulation [yes] | [no] | [auto]] [--encrypt]
                   [--authenticate] [--compress] [--pfs]
                   [--pfsgroup [modp1024] | [modp1536] | [modp2048] | [modp3072] | [modp4096] | [modp6144] | [modp8192] | [dh22] | [dh23] | [dh24]]
                   [--ikelifetime <u>seconds</u>] [--ipseclifetime <u>seconds</u>] [--rekeymargin <u>seconds</u>]
                   [--rekeyfuzz <u>percentage</u>] [--esp <u>esp-algos</u>] [--dontrekey] [--aggrmode] [--modecfgpull]
                   [--metric <u>metric</u>] [--nflog-group <u>nflognum</u>] [--conn-mark <u>mark/mask</u>] [[--dpddelay <u>seconds</u>] |
                   [--dpdtimeout <u>seconds</u>]] [--no-keep-alive]
                   [[--initiateontraffic] | [--pass] | [--drop] | [--reject]]
                   [[--failnone] | [--failpass] | [--faildrop] | [--failreject]] [--rundir <u>path</u>]
                   [--ctlsocket <u>path/file</u>] [--label <u>string</u>]

       <b>ipsec</b> <b>whack</b> --keyid <u>id</u> [--addkey] [--pubkeyrsa <u>key</u>] [--rundir <u>path</u>] [--ctlsocket <u>path/file</u>]
                   [--label <u>string</u>]

       <b>ipsec</b> <b>whack</b> --listen | --unlisten  [--rundir <u>path</u>] [--ctlsocket <u>path/file</u>] [--label <u>string</u>]

       <b>ipsec</b> <b>whack</b> --ddos-auto | --ddos-busy | --ddos-unlimited  [--rundir <u>path</u>] [--ctlsocket <u>path/file</u>]

       <b>ipsec</b> <b>whack</b> --route | --unroute  --name <u>connection-name</u> [--rundir <u>path</u>] [--ctlsocket <u>path/file</u>]

       <b>ipsec</b> <b>whack</b> --initiate --name <u>connection</u> [--remote-host <u>ip-address</u>] [--xauthuser <u>user</u>] [--xauthpass <u>pass</u>]
                   [--asynchronous]

       <b>ipsec</b> <b>whack</b> --down --name <u>connection</u> [--asynchronous]

       <b>ipsec</b> <b>whack</b> {--rekey-ike | --rekey-child | --delete-ike | --delete-child | --down-ike | --down-child}
                   --name <u>connection</u> [--asynchronous]

       <b>ipsec</b> <b>whack</b> --global-redirect <u>yes|no|auto</u>

       <b>ipsec</b> <b>whack</b> --global-redirect-to <u>ip-address(es)</u>

       <b>ipsec</b> <b>whack</b> [--name <u>connection-name</u>] --redirect-to <u>ip-address(es)</u>

       <b>ipsec</b> <b>whack</b> [[--tunnelipv4] | [--tunnelipv6]] --oppohere <u>ip-address</u> --oppothere <u>ip-address</u>
                   --opposport <u>port</u> --oppodport <u>port</u> --oppoproto <u>protocol</u>

       <b>ipsec</b> <b>whack</b> --crash [ipaddress]

       <b>ipsec</b> <b>whack</b> --name <u>connection-name</u> --delete [--label <u>string</u>]

       <b>ipsec</b> <b>whack</b> --deletestate <u>state-number</u> [--rundir <u>path</u>] [--ctlsocket <u>path/file</u>] [--label <u>string</u>]

       <b>ipsec</b> <b>whack</b> --deleteuser --name <u>username</u> [--rundir <u>path</u>] [--ctlsocket <u>path/file</u>] [--label <u>string</u>]

       <b>ipsec</b> <b>whack</b> [--name <u>connection-name</u>] {--debug help | none | base | cpu-usage | <u>class</u>} |
                   {--no-debug <u>class</u>} | {--impair help | none | <u>behaviour</u>} | {--no-impair <u>behaviour</u>}

       <b>ipsec</b> <b>whack</b> [--utc] [--listall] [--listpubkeys] [--listcerts] [--listcacerts] [--listcrls]

       <b>ipsec</b> <b>whack</b> [--utc] [--rereadsecrets] [--fetchcrls] [--rereadall]

       <b>ipsec</b> <b>whack</b> --ddns

       <b>ipsec</b> <b>whack</b> --listevents

       <b>ipsec</b> <b>whack</b> --purgeocsp

       <b>ipsec</b> <b>whack</b> --status --addresspoolstatus --briefstatus --connectionstatus --fipsstatus --processstatus
                   --shuntstatus --trafficstatus [--rundir <u>path</u>] [--ctlsocket <u>path/file</u>] [--label <u>string</u>]

       <b>ipsec</b> <b>whack</b> --globalstatus --clearstats [--rundir <u>path</u>] [--ctlsocket <u>path/file</u>] [--label <u>string</u>]

       <b>ipsec</b> <b>whack</b> [--ike-socket-bufsize <u>bufsize</u>] [--ike-socket-errqueue-toggle] [--rundir <u>path</u>]
                   [--ctlsocket <u>path/file</u>] [--label <u>string</u>]

       <b>ipsec</b> <b>whack</b> --shutdown [--rundir <u>path</u>] [--ctlsocket <u>path/file</u>] [--label <u>string</u>] [--leave-state]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>ipsec</b> <b>whack</b> is an auxiliary program to allow requests to be made to a running <u>pluto</u>.  <b>whack</b> uses a UNIX
       domain socket to speak to <u>pluto</u> (by default, /run/pluto/pluto.ctl).

       <b>whack</b> has an intricate argument syntax. This syntax allows many different functions to be specified. The
       help form shows the usage or version information. The connection form gives <u>pluto</u> a description of a
       potential connection. The public key form informs <u>pluto</u> of the RSA public key for a potential peer. The
       delete form deletes a connection description and all SAs corresponding to it. The listen form tells <u>pluto</u>
       to start or stop listening on the public interfaces for IKE requests from peers. The route form tells
       <b>pluto</b> to set up routing for a connection; the unroute form undoes this. The initiate form tells <b>pluto</b> to
       negotiate an SA corresponding to a connection. The terminate form tells <b>pluto</b> to remove all SAs
       corresponding to a connection, including those being negotiated. The status form displays the <u>pluto</u>'s
       internal state. The debug form tells <b>pluto</b> to change the selection of debugging output "on the fly". The
       shutdown form tells <b>pluto</b> to shut down, deleting all SAs.

       The crash option asks pluto to consider a particularly target IP to have crashed, and to attempt to
       restart all connections with that IP address as a gateway. In general, you should use Dead Peer Detection
       to detect this kind of situation automatically, but this is not always possible.

       Most options are specific to one of the forms, and will be described with that form. There are three
       options that apply to all forms.

       <b>--ctlsocket</b> <u>/run/pluto/pluto.ctl</u>
           <u>file</u> is used as the UNIX domain socket for talking to <u>pluto</u>. Use either this option or <b>--rundir</b>, but
           not both.

       <b>--rundir</b> <u>path</u>
           <u>path</u> where the UNIX domain socket for talking to the <u>pluto</u>, the <u>pluto.pid</u> file and the <u>pluto.ctl</u>
           files are found. Use either this option or <u>--ctlsocket</u>, but not both.

       <b>--label</b> <u>string</u>
           Adds the string to all error messages generated by <b>whack</b>.

       The help form of <b>whack</b> is self-explanatory.

       <b>--help</b>
           Display the usage message.

       <b>--version</b>
           Display the version of <u>whack</u>.

       The connection form describes a potential connection to <b>pluto</b>.  <u>pluto</u> needs to know what connections can
       and should be negotiated. When <u>pluto</u> is the initiator, it needs to know what to propose. When <b>pluto</b> is
       the responder, it needs to know enough to decide whether is is willing to set up the proposed connection.

       The description of a potential connection can specify a large number of details. Each connection has a
       unique name. This name will appear in a updown shell command, so it should not contain punctuation that
       would make the command ill-formed.

       <b>--name</b> <u>connection-name</u>
           Sets the name of the connection.

       The topology of a connection is symmetric, so to save space here is half a picture:

          client_subnet&lt;--&gt;host:ikeport&lt;--&gt;nexthop&lt;---

       A similar trick is used in the flags. The same flag names are used for both ends. Those before the <b>--to</b>
       flag describe the left side and those afterwards describe the right side. When <b>pluto</b> attempts to use the
       connection, it decides whether it is the left side or the right side of the connection, based on the IP
       numbers of its interfaces.

       <b>--id</b> <u>id</u>
           The identity of the end. Currently, this can be an IP address (specified as dotted quad or as a Fully
           Qualified Domain Name, which will be resolved immediately) or as a Fully Qualified Domain Name itself
           (prefixed by "@" to signify that it should not be resolved), or as user@FQDN, or an X.509 DN.  <b>pluto</b>
           only authenticates the identity, and does not use it for addressing, so, for example, an IP address
           need not be the one to which packets are to be sent. If the option is absent, the identity defaults
           to the IP address specified by <b>--host</b>.

       <b>--host</b> <u>ip-address</u>, <b>--host</b> <u>%any</u>, <b>--host</b> <u>%opportunistic</u>
           The IP address of the end (generally the public interface). If <b>pluto</b> is to act as a responder for IKE
           negotiations initiated from unknown IP addresses (the "Road Warrior" case), the IP address should be
           specified as <u>%any</u> (currently, the obsolete notation 0.0.0.0 is also accepted for this). If <b>pluto</b> is
           to opportunistically initiate the connection, use <u>%opportunistic</u>

       <b>--cert</b> <u>friendly_name</u>
           The friendly_name (or nickname) of the X.509 certificate that was used when imported the certificate
           into the NSS database. See <b><a href="../man5/ipsec.conf.5.html">ipsec.conf</a></b>(5) on how to extract this from the PKCS#12 file.

       <b>--ckaid</b> <u>CKAID</u>
           The CKAID of the X.509 certificate or host key.

           For X.509 certificates, the CKAID is either the certificate's SubjectKeyIdentifier or the public
           key's SHA1 fingerprint (when the SubjectKeyIdentifier isn't specified). For host keys the CKAID is
           the SHA1 fingerprint of the public key.

       <b>--ca</b> <u>distinguished</u> <u>name</u>
           The X.509 Certificate Authority's Distinguished Name (DN) used as trust anchor for this connection.
           This is the CA certificate that signed the host certificate, as well as the certificate of the
           incoming client.

       <b>--groups</b> <u>access</u> <u>control</u> <u>groups</u>
           The access control groups used.

       <b>--sendcert</b> <u>yes|forced|always|ifasked|no|never</u>
           Whether or not to send our X.509 certificate credentials. This could potentially give an attacker too
           much information about which identities are allowed to connect to this host. The default is to use
           <u>ifasked</u> when we are a Responder, and to use <u>yes</u> (which is the same as <u>forced</u> and <u>always</u> if we are an
           Initiator. The values <u>no</u> and <u>never</u> are equivalent. NOTE: "forced" does not seem to be actually
           implemented - do not use it.

       <b>--sendca</b> <u>none|issuer|all</u>
           How much of our available X.509 trust chain to send with the end certificate, excluding any root CAs.
           Specifying <u>issuer</u> sends just the issuing intermediate CA, while
            <u>all</u> will send the entire chain of intermediate CAs.<u>none</u> will not send any CA certs. The default is
           <u>none</u> which maintains the current libreswan behavior.

       <b>--certtype</b> <u>number</u>
           The X.509 certificate type number.

       <b>--ikeport</b> <u>port-number</u>
           The UDP port that IKE listens to on that host. The default is 500. (<b>pluto</b> on this machine uses the
           port specified by its own command line argument, so this only affects where <u>pluto</u> sends messages.)

       <b>--nexthop</b> <u>ip-address</u>
           Where to route packets for the peer's client (presumably for the peer too, but it will not be used
           for this). When <b>pluto</b> installs an IPsec SA, it issues a route command. It uses the nexthop as the
           gateway. The default is the peer's IP address (this can be explicitly written as <u>%direct</u>; the
           obsolete notation 0.0.0.0 is accepted). This option is necessary if <b>pluto</b>'s host's interface used for
           sending packets to the peer is neither point-to-point nor directly connected to the peer.

       <b>--subnet</b> <u>subnet</u>, <b>--client</b> <u>subnet</u>
           The subnet for which the IPsec traffic will be destined. If not specified, the host will be the
           client. The subnet can be specified using the general form <u>address</u>/<u>mask</u>. The most convenient form of
           the <u>mask</u> is a decimal integer, specifying the number of leading one bits in the mask. So, for
           example, 10.0.0.0/8 would specify the class A network "Net 10".

       <b>--clientprotoport</b> <u>protocol</u><b>/</b><u>port</u>
           Specify the Port Selectors (filters) to be used on this connection. The general form is
           <u>protocol</u>/<u>port</u>. This is most commonly used to limit the connection to L2TP traffic only by specifying
           a value of <u>17/1701</u> for UDP (protocol 17) and port 1701. The notation <u>17/%any</u> can be used to allow all
           UDP traffic and is needed for L2TP connections with Windows XP machines before Service Pack 2.

       <b>--narrowing</b> <u>yes|no|auto</u>
           IKEv2 (RFC5996) Section 2.9 Traffic Selector narrowing options. See <b>narrowing</b> in <b><a href="../man5/ipsec.conf.5.html">ipsec.conf</a></b>(5).

       <b>--sourceip</b> <u>ip-address</u>
           The IP address for this host to use when transmitting a packet to the remote IPsec gateway itself.
           This option is used to make the gateway itself use its internal IP, which is part of the <b>--client</b>
           <u>subnet</u>. Otherwise it will use its nearest IP address, which is its public IP address, which is not
           part of the subnet-subnet IPsec tunnel, and would therefore not get encrypted.

       <b>--xauthserver</b>
           This end is an xauthserver. It will lookup the xauth user name and password and verify this before
           allowing the connection to get established.

       <b>--xauthclient</b>
           This end is an xauthclient. To bring this connection up with the <b>--initiate</b> also requires the client
           to specify <b>--xauthuser</b> <u>username</u> and <b>--xauthpass</b> <u>password</u>

       <b>--xauthuser</b>
           The username for the xauth authentication.This option is normally passed along by <b><a href="../man8/ipsec-up.8.html">ipsec-up</a></b>(8) when an
           xauth connection is started using <b>ipsec</b> <b>up</b> <u>connection</u>.

       <b>--xauthpass</b>
           The password for the xauth authentication. This option is normally passed along by <b><a href="../man8/ipsec-up.8.html">ipsec-up</a></b>(8) when
           an xauth connection is started using <b>ipsec</b> <b>up</b> <u>connection</u>.

       <b>--modecfgserver</b>
           This end is an Mode Config server.

       <b>--modecfgclient</b>
           This end is an Mode Config client.

       <b>--modecfgdns</b>
           A comma separated list of DNS server IP's to pass along to connecting clients.

       <b>--modecfgdomains</b>
           A comma separated list of internal DNS domains to pass along to connecting clients.

       <b>--dnskeyondemand</b>
           Specifies that when an RSA public key is needed to authenticate this host, and it isn't already
           known, fetch it from DNS.

       <b>--updown</b> <u>updown</u>
           Specifies an external shell command to be run whenever <b>pluto</b> brings up or down a connection. The
           script is used to build a shell command, so it may contain positional parameters, but ought not to
           have punctuation that would cause the resulting command to be ill-formed. The default is <u>ipsec</u>
           <b>_</b><u>updown</u>. Pluto passes a dozen environment variables to the script about the connection involved.

       <b>--to</b>
           Separates the specification of the left and right ends of the connection. Pluto tries to decide
           whether it is <u>left</u> or <u>right</u> based on the information provided on both sides of this option.

       The potential connection description also specifies characteristics of rekeying and security.

       <b>--psk</b>
           Propose and allow preshared secret authentication for IKE peers. This authentication requires that
           each side use the same secret. May be combined with <b>--rsasig</b>; at least one must be specified.

       <b>--rsasig</b>
           Propose and allow RSA signatures for authentication of IKE peers. This authentication requires that
           each side have have a private key of its own and know the public key of its peer. May be combined
           with <b>--psk</b>; at least one must be specified.

       <b>--encrypt</b>
           All proposed or accepted IPsec SAs will include non-null ESP. The actual choices of transforms are
           wired into <b>pluto</b>.

       <b>--authenticate</b>
           All proposed IPsec SAs will include AH. All accepted IPsec SAs will include AH or ESP with
           authentication. The actual choices of transforms are wired into <u>pluto</u>. Note that this has nothing to
           do with IKE authentication.

       <b>--compress</b>
           All proposed IPsec SAs will include IPCOMP (compression).

       <b>--tunnel</b>
           The IPsec SA should use tunneling. Implicit if the SA is for clients. Must only be used with
           <b>--authenticate</b> or <b>--encrypt</b>.

       <b>--ipv4</b>
           The host addresses will be interpreted as IPv4 addresses. This is the default. Note that for a
           connection, all host addresses must be of the same Address Family (IPv4 and IPv6 use different
           Address Families).

       <b>--ipv6</b>
           The host addresses (including nexthop) will be interpreted as IPv6 addresses. Note that for a
           connection, all host addresses must be of the same Address Family (IPv4 and IPv6 use different
           Address Families).

       <b>--tunnelipv4</b>
           The client addresses will be interpreted as IPv4 addresses. The default is to match what the host
           will be. This does not imply <b>--tunnel</b> so the flag can be safely used when no tunnel is actually
           specified. Note that for a connection, all tunnel addresses must be of the same Address Family.

       <b>--tunnelipv6</b>
           The client addresses will be interpreted as IPv6 addresses. The default is to match what the host
           will be. This does not imply <b>--tunnel</b> so the flag can be safely used when no tunnel is actually
           specified. Note that for a connection, all tunnel addresses must be of the same Address Family.

       <b>--pfs</b>
           There should be Perfect Forward Secrecy - new keying material will be generated for each IPsec SA
           when running Quick Mode in IKEv1 or Create Child in IKEv2. Without this option, the SAKMP SA keying
           material is used instead.  <b>pluto</b> will propose the same group that was used with the original IKE SA.

       <b>--pfsgroup</b> <u>modp-group</u>
           Sets the Diffie-Hellman group used. Currently the following values are supported: <u>modp1536</u> (DHgroup
           5), <u>modp2048</u> (DHgroup 14), <u>modp3072</u> (DHgroup 15), <u>modp4096</u> (DHgroup 16), <u>modp6144</u> (DHgroup 17), and
           <u>modp8192</u> (DHgroup 18). It is possible to support the weak and broken <u>modp1024</u> (DHgroup 2), but this
           requires a manual recompile and is strongly discouraged.

       <b>--esp</b> <u>esp-algos</u>
           ESP encryption/authentication algorithm to be used for the connection (phase2 aka IPsec SA). The
           options must be suitable as a value of <b><a href="../man8/ipsec-spi.8.html">ipsec-spi</a></b>(8). See <b><a href="../man5/ipsec.conf.5.html">ipsec.conf</a></b>(5) for a detailed description of
           the algorithm format.

       <b>--aggrmode</b>
           This tunnel is using aggressive mode ISAKMP negotiation. The default is main mode. Aggressive mode is
           less secure than main mode as it reveals your identity to an eavesdropper, but is needed to support
           road warriors using PSK keys or to interoperate with other buggy implementations insisting on using
           aggressive mode.

       <b>--modecfgpull</b>
           Pull the Mode Config network information from the peer.

       <b>--dpddelay</b> <u>seconds</u>
           Set the delay (in seconds) between Dead Peer Detection (RFC 3706) keepalives (R_U_THERE,
           R_U_THERE_ACK) that are sent for this connection (default 30 seconds).

       <b>--timeout</b> <u>seconds</u>
           Set the length of time (in seconds) we will idle without hearing either an R_U_THERE poll from our
           peer, or an R_U_THERE_ACK reply. After this period has elapsed with no response and no traffic, we
           will declare the peer dead, and remove the SA (default 120 seconds).

       <b>--encapsulation</b> <u>yes|no|auto</u>
           In some cases, for example when ESP packets are filtered or when a broken IPsec peer does not
           properly recognise NAT, it can be useful to force RFC-3948 encapsulation using this option. It causes
           pluto lie and tell the remote peer that RFC-3948 encapsulation (ESP in UDP port 4500 packets) is
           required.

       If none of the <b>--encrypt</b>, <b>--authenticate</b>, <b>--compress</b>, or <b>--pfs</b> flags is given, the initiating the
       connection will only build an ISAKMP SA. For such a connection, client subnets have no meaning and must
       not be specified.

       Apart from initiating directly using the <b>--initiate</b> option, a tunnel can be loaded with a different
       policy.

       <b>--initiateontraffic</b>
           Only initiate the connection when we have traffic to send over the connection.

       <b>--pass</b>
           Allow <u>unencrypted</u> traffic to flow until the tunnel is initiated.

       <b>--drop</b>
           Drop unencrypted traffic silently.

       <b>--reject</b>
           Drop unencrypted traffic silently, but send an ICMP message notifying the other end.

       These options need to be documented:

       <b>--failnone</b>
           To be documented.

       <b>--failpass</b>
           To be documented.

       <b>--faildrop</b>
           To be documented.

       <b>--failreject</b>
           To be documented.

       <b>pluto</b> supports various X.509 Certificate related options.

       <b>--utc</b>
           Display all times in UTC.

       <b>--listall</b>
           Lists all of the X.509 information known to pluto.

       <b>--listpubkeys</b>
           List all the public keys that have been successfully loaded.

       <b>--listcerts</b>
           List all the X.509 certificates that are currently loaded.

       <b>--checkpubkeys</b>
           List all the loaded X.509 certificates that are about to expire or have expired.

       <b>--listcacerts</b>
           List all the Certificate Authority X.509 certificates that are currently loaded.

       <b>--listcrls</b>
           List all the loaded <u>Certificate</u> <u>Revocation</u> <u>Lists</u> (CRLs).

       The corresponding options <b>--rereadsecrets</b>, <b>--rereadall</b>, and <b>--rereadcrls</b> options reread this information
       from their respective sources, and purge all the online obtained information. The option <b>--listevents</b>
       lists all pending events, and the <b>--ddns</b> triggers the Dynamic DNS update event that is normally scheduled
       to run once every minute.

       <b>--ikelifetime</b> <u>seconds</u>
           How long <b>pluto</b> will propose that an ISAKMP SA be allowed to live. The default is 28800 (eight hours)
           and the maximum is 86400 (1 day). This option will not affect what is accepted.  <u>pluto</u> will reject
           proposals that exceed the maximum.

       <b>--ipseclifetime</b> <u>seconds</u>
           How long <b>pluto</b> will propose that an IPsec SA be allowed to live. The default is 28800 (eight hours)
           and the maximum is 86400 (one day). This option will not affect what is accepted.  <u>pluto</u> will reject
           proposals that exceed the maximum.

       <b>--rekeymargin</b> <u>seconds</u>
           How long before an SA's expiration should <u>pluto</u> try to negotiate a replacement SA. This will only
           happen if <u>pluto</u> was the initiator. The default is 540 (nine minutes).

       <b>--rekeyfuzz</b> <u>percentage</u>
           Maximum size of random component to add to rekeymargin, expressed as a percentage of rekeymargin.
           <u>pluto</u> will select a delay uniformly distributed within this range. By default, the percentage will be
           100. If greater determinism is desired, specify 0. It may be appropriate for the percentage to be
           much larger than 100.

       <b>--dontrekey</b>
           A misnomer. Only rekey a connection if we were the Initiator and there was recent traffic on the
           existing connection. This applies to Phase 1 and Phase 2. This is currently the only automatic way
           for a connection to terminate. It may be useful with Road Warrior or Opportunistic connections. Since
           SA lifetime negotiation is take-it-or-leave it, a Responder normally uses the shorter of the
           negotiated or the configured lifetime. This only works because if the lifetime is shorter than
           negotiated, the Responder will rekey in time so that everything works. This interacts badly with
           <b>--dontrekey</b>. In this case, the Responder will end up rekeying to rectify a shortfall in an IPsec SA
           lifetime; for an ISAKMP SA, the Responder will accept the negotiated lifetime.

       <b>--deletestate</b> <u>state-number</u>
           The deletestate form deletes the state object with the specified serial number. This is useful for
           selectively deleting instances of connections.

       The route form of the <b>whack</b> command tells <b>pluto</b> to set up routing for a connection. Although like a
       traditional route, it uses an ipsec device as a virtual interface. Once routing is set up, no packets
       will be sent "in the clear" to the peer's client specified in the connection. A TRAP shunt eroute will be
       installed; if outbound traffic is caught, Pluto will initiate the connection. An explicit <b>whack</b> route is
       not always needed: if it hasn't been done when an IPsec SA is being installed, one will be automatically
       attempted.

       <b>--route</b>, <b>--name</b> <u>connection-name</u>
           When a routing is attempted for a connection, there must not already be a routing for a different
           connection with the same subnet but different interface or destination, or if there is, it must not
           be being used by an IPsec SA. Otherwise the attempt will fail.

       <b>--unroute</b>, <b>--name</b> <u>connection-name</u>
           The unroute form of the <u>whack</u> command tells <u>pluto</u> to undo a routing.  <u>pluto</u> will refuse if an IPsec
           SA is using the connection. If another connection is sharing the same routing, it will be left in
           place. Without a routing, packets will be sent without encryption or authentication.

       The initiate form tells <b>pluto</b> to initiate a negotiation with another <u>pluto</u> (or other IKE daemon)
       according to the named connection. Initiation requires a route that <b>--route</b> would provide; if none is in
       place at the time an IPsec SA is being installed, <u>pluto</u> attempts to set one up.

       <b>--initiate</b>, <b>--name</b> <u>connection-name</u>, <b>--asynchronous</b>
           The initiate form of the <u>whack</u> command will relay back from <b>pluto</b> status information via the UNIX
           domain socket (unless --asynchronous is specified). Currently <u>whack</u> simply copies this to stderr.
           When the request is finished (eg. the SAs are established or <b>pluto</b> gives up), <b>pluto</b> closes the
           channel, causing <b>whack</b> to terminate.

       The opportunistic initiate form is mainly used for debugging.

       <b>--tunnelipv4</b>, <b>--tunnelipv6</b>, <b>--oppohere</b> <u>ip-address</u>, <b>--oppothere</b> <u>ip-address</u>, <b>--opposport</b> <u>port</u>, <b>--oppodport</b>
       <u>port</u>, <b>--oppoproto</b> <u>protocol</u>
           This will cause <b>pluto</b> to attempt to opportunistically initiate a connection from here to the there,
           even if a previous attempt had been made. The whack log will show the progress of this attempt.

       Rekeying a connection

       <b>--rekey-ike</b> <b>--name</b> <u>connection</u> <b>--asynchronous</b>, <b>--rekey-child</b> <b>--name</b> <u>connection</u> <b>--asynchronous</b>
           Initiate a rekey of the connection's established IKE or Child SA.

       <b>--delete-ike</b> <b>--name</b> <u>connection</u> <b>--asynchronous</b>, <b>--delete-child</b> <b>--name</b> <u>connection</u> <b>--asynchronous</b>,
       <b>--down-ike</b> <b>--name</b> <u>connection</u> <b>--asynchronous</b>, <b>--down-child</b> <b>--name</b> <u>connection</u> <b>--asynchronous</b>
           Initiate a delete of the connection's established IKE or Child SA. For <b>--down-ike</b> and <b>--down-child</b>
           first clear connection's UP policy.

           •   deleting an IKE SA implicitly deletes all the IKE SA's children (IKEv2)

           •   any affected connection with policy UP will try to revive (for <b>--down-ike</b> and <b>--down-child</b>, since
               the connection's UP policy was cleared, will not revive)

       Ending a connection

       <b>--delete</b> <b>--name</b> <u>connection</u>
           Delete the specified <u>connection</u>. Any negotiating or established SAs are terminated. Any routing is
           removed.

       <b>--down</b> <b>--name</b> <u>connection</u> <b>--asynchronous</b>
           Delete any Child SAs associated with the connection, and remove UP from the connection's policy (so
           the connection is no longer required to stay up). If the connection has an IKE SA that is not not
           shared with other connections then that is also is deleted.

           Since the connection is still in place <b>--down</b> does not prevent new negotiations. For instance, the
           peer may initiate, or a routed (on-demand) connection will initiate when there is traffic.  <b>--unroute</b>
           will also prevent traffic initiating the connection, and <b>--delete</b> will prevent all negotiation.

       <b>--crash</b> <u>ip-address</u>
           If the remote peer has crashed, and therefore did not notify us, we keep sending encrypted traffic,
           and rejecting all plaintext (non-IKE) traffic from that remote peer. The <b>--crash</b> brings our end down
           as well for all the known connections to the specified <u>ip-address</u>.

       <u>ip-address</u>
           If the remote peer has crashed, and therefore did not notify us, we keep sending encrypted traffic,
           and rejecting all plaintext (non-IKE) traffic from that remote peer. The <b>--crash</b> brings our end down
           as well for all the known connections to the specified <u>ip-address</u>.

       Redirecting clients can be done using IKEv2 redirect mechanism.

       <b>--global-redirect</b> <u>yes|no|auto</u>
           The --global-redirect option controls whether <u>pluto</u> will instruct remote peers to redirect IKE/Child
           SA's during IKE_SA_INIT. Valid options are <u>no</u>, <u>yes</u> and <u>auto</u>, where auto means remote peers will be
           redirected if DDoS mode is active.

       <b>--global-redirect-to</b> <u>ip-address(es)</u>
           The destination, or a list of destinations, where the peers will be redirected.

       <b>--name</b> <u>connection_name</u>, <b>--redirect-to</b> <u>ip-address(es)</u>
           The destination, or a list of destinations, where the peers will be redirected. Specifying the
           connection name is optional. If not specified the mechanism will redirect all currently active peers.
           If specified, only the peers from connection <u>connection_name</u> will be redirected.

       The public key for informs <u>pluto</u> of the RSA public key for a potential peer. Private keys must be kept
       secret, so they are kept in <b><a href="../man5/ipsec.secrets.5.html">ipsec.secrets</a></b>(5).

       <b>--keyid</b> <u>id</u>
           Specifies the identity of the peer for which a public key should be used. Its form is identical to
           the identity in the connection. If no public key is specified, <b>pluto</b> attempts to find KEY records
           from DNS for the id (if a FQDN) or through reverse lookup (if an IP address). Note that there several
           interesting ways in which this is not secure.

       <b>--addkey</b>
           Specifies that the new key is added to the collection; otherwise the new key replaces any old ones.

       <b>--pubkeyrsa</b> <u>key</u>
           Specifies the value of the RSA public key. It is a sequence of bytes as described in RFC 2537
           "RSA/MD5 KEYs and SIGs in the Domain Name System (DNS)". It is base-64 encoded with the prefix 0s
           prepended.

       The listen form tells <b>pluto</b> to start listening for IKE requests on its public interfaces. To avoid race
       conditions, it is normal to load the appropriate connections into <b>pluto</b> before allowing it to listen. If
       <b>pluto</b> isn't listening, it is pointless to initiate negotiations, so it will refuse requests to do so.
       Whenever the listen form is used, <b>pluto</b> looks for public interfaces and will notice when new ones have
       been added and when old ones have been removed. This is also the trigger for <b>pluto</b> to read the
       <u>ipsec.secrets</u> file. So listen may useful more than once.

       <b>--listen</b>
           Start listening for IKE traffic on public interfaces.

       <b>--unlisten</b>
           Stop listening for IKE traffic on public interfaces.

       The --ddos-auto, --ddos-busy and --ddos-unlimited options tells <b>pluto</b> to update the DDoS protection
       state. Normally, these measures are automatically activated or deactivated based on the number of states
       inside pluto. The busy and unlimited option tells pluto to activate or deactivate the DDoS protection
       mode manually. One of these DDoS protection methods is to activate IKEv2 DCOOKIEs to defend against
       spoofed IKE packets.

       <b>--ddos-busy</b>
           Place pluto into busy mode and activate anti-DDoS measures.

       <b>--ddos-unlimited</b>
           Pull pluto out of busy mode and deactivate anti-DDoS measures.

       <b>--ddos-auto</b>
           Activate the built-in detection mechanism for the anti-DDoS measures.

       The status form will display information about the internal state of <b>pluto</b>: information about each
       potential connection, about each state object, and about each shunt that <b>pluto</b> is managing without an
       associated connection.

       Statistics can be seen using <b>ipsec</b> <b>whack</b> <b>--globalstats</b> and reset using <b>ipsec</b> <b>whack</b> <b>--clearstats</b>. This can
       be used with the munin software to monitor VPN services.

       <b>--status</b>
           To be documented.

       The trafficstatus form will display the xauth username, add_time and the total in and out bytes of the
       IPsec SA's.

       <b>--trafficstatus</b>
           To be documented

       The shutdown form is the proper way to shut down <u>pluto</u>. It will tear down the SAs on this machine that
       <b>pluto</b> has negotiated. If the <u>--leave-state</u> option is given, it does not delete any connections, and
       leaves the kernel state in the kernel. Note that the init system used might clean up the kernel state
       regardless.

       <b>--shutdown</b>
           To be documented.

   <b>Examples</b>
       It would be normal to start <b>pluto</b> in one of the system initialization scripts. It needs to be run by the
       superuser. Generally, no arguments are needed. To run in manually, the superuser can simply type

       ipsec pluto

       The command will immediately return, but a <u>pluto</u> process will be left running, waiting for requests from
       <b>whack</b> or a peer.

       Using <b>whack</b>, several potential connections would be described:

       ipsec whack --name silly --host127.0.0.1 --to --host 127.0.0.2 --ikelifetime 900 --ipseclifetime 800
       --keyingtries 3

       Since this silly connection description specifies neither encryption, authentication, nor tunneling, it
       could only be used to establish an ISAKMP SA.

       ipsec whack --name conn_name --host 10.0.0.1 --client 10.0.1.0/24 --to --host 10.0.0.2 --client
       10.0.2.0/24 --encrypt

       This is something that must be done on both sides. If the other side is <b>pluto</b>, the same <u>whack</u> command
       could be used on it (the command syntax is designed to not distinguish which end is ours).

       Now that the connections are specified, <u>pluto</u> is ready to handle requests and replies via the public
       interfaces. We must tell it to discover those interfaces and start accepting messages from peers:

       ipsec whack --listen

       If we don't immediately wish to bring up a secure connection between the two clients, we might wish to
       prevent insecure traffic. The routing form asks <b>pluto</b> to cause the packets sent from our client to the
       peer's client to be routed through the ipsec0 device; if there is no SA, they will be discarded:

       ipsec whack --route conn_name

       Finally, we are ready to get <b>pluto</b> to initiate negotiation for an IPsec SA (and implicitly, an ISAKMP
       SA):

       ipsec whack --initiate --name conn_name

       A small log of interesting events will appear on standard output (other logging is sent to syslog).

       <b>whack</b> can also be used to terminate <b>pluto</b> cleanly, tearing down all SAs that it has negotiated.

       ipsec whack --shutdown

       Notification of any IPSEC SA deletion, but not ISAKMP SA deletion is sent to the peer. Unfortunately,
       such Notification is not reliable. Furthermore, <b>pluto</b> itself ignores Notifications.

   <b>XAUTH</b>
       If <b>pluto</b> needs additional authentication, such as defined by the XAUTH specifications, then it may ask
       <b>whack</b> to prompt the operator for username or passwords. Typically, these will be entered interactively. A
       GUI that wraps around <b>whack</b> may look for the 041 (username) or 040 (password) prompts, and display them
       to the user.

       For testing purposes, the options <b>--xauthuser</b> <u>user</u> <b>--xauthpass</b> <u>pass</u> may be be given prior to the
       <b>--initiate</b> to provide responses to the username and password prompts.

   <b>The</b> <b>updown</b> <b>command</b>
       Whenever <b>pluto</b> brings a connection up or down, it invokes the updown command. This command is specified
       using the <b>--updown</b> option. This allows for customized control over routing and firewall manipulation.

       The updown is invoked for five different operations. Each of these operations can be for our client
       subnet or for our host itself.

       <u>prepare-host</u> or <u>prepare-client</u>
           is run before bringing up a new connection if no other connection with the same clients is up.
           Generally, this is useful for deleting a route that might have been set up before <u>pluto</u> was run or
           perhaps by some agent not known to <b>pluto</b>.

       <u>route-host</u> or <u>route-client</u>
           is run when bringing up a connection for a new peer client subnet (even if <u>prepare-host</u> or
           <u>prepare-client</u> was run). The command should install a suitable route. Routing decisions are based
           only on the destination (peer's client) subnet address, unlike eroutes which discriminate based on
           source too.

       <u>unroute-host</u> or <u>unroute-client</u>
           is run when bringing down the last connection for a particular peer client subnet. It should undo
           what the <u>route-host</u> or <u>route-client</u> did.

       <u>up-host</u> or <u>up-client</u>
           is run when bringing up a tunnel eroute with a pair of client subnets that does not already have a
           tunnel eroute. This command should install firewall rules as appropriate. It is generally a good idea
           to allow IKE messages (UDP port 500) travel between the hosts.

       <u>down-host</u> or <u>down-client</u>
           is run when bringing down the eroute for a pair of client subnets. This command should delete
           firewall rules as appropriate. Note that there may remain some inbound IPsec SAs with these client
           subnets.

       The script is passed a large number of environment variables to specify what needs to be done.

       <u>PLUTO_VERB</u>
           specifies the name of the operation to be performed (<u>prepare-host</u>, <u>prepare-client</u>, <u>up-host</u>,
           <u>up-client</u>, <u>down-host</u>, or <u>down-client</u>). If the address family for security gateway to security gateway
           communications is IPv6, then a suffix of -v6 is added to the verb.

       <u>PLUTO_CONNECTION</u>
           is the name of the connection for which we are routing.

       <u>PLUTO_NEXT_HOP</u>
           is the next hop to which packets bound for the peer must be sent.

       <u>PLUTO_INTERFACE</u>
           is the name of the ipsec interface to be used.

       <u>PLUTO_ME</u>
           is the IP address of our host.

       <u>PLUTO_MY_CLIENT</u>
           is the IP address / count of our client subnet. If the client is just the host, this will be the
           host's own IP address / max (where max is 32 for IPv4 and 128 for IPv6).

       <u>PLUTO_MY_CLIENT_NET</u>
           is the IP address of our client net. If the client is just the host, this will be the host's own IP
           address.

       <u>PLUTO_MY_CLIENT_MASK</u>
           is the mask for our client net. If the client is just the host, this will be 255.255.255.255.

       <u>PLUTO_PEER</u>
           is the IP address of our peer.

       <u>PLUTO_PEER_CLIENT</u>
           is the IP address / count of the peer's client subnet. If the client is just the peer, this will be
           the peer's own IP address / max (where max is 32 for IPv4 and 128 for IPv6).

       <u>PLUTO_PEER_CLIENT_NET</u>
           is the IP address of the peer's client net. If the client is just the peer, this will be the peer's
           own IP address.

       <u>PLUTO_PEER_CLIENT_MASK</u>
           is the mask for the peer's client net. If the client is just the peer, this will be 255.255.255.255.

       <u>PLUTO_MY_PROTOCOL</u>
           lists the protocols allowed over this IPsec SA.

       <u>PLUTO_PEER_PROTOCOL</u>
           lists the protocols the peer allows over this IPsec SA.

       <u>PLUTO_MY_PORT</u>
           lists the ports allowed over this IPsec SA.

       <u>PLUTO_PEER_PORT</u>
           lists the ports the peer allows over this IPsec SA.

       <u>PLUTO_MY_ID</u>
           lists our id.

       <u>PLUTO_PEER_ID</u>
           lists our peer's id.

       <u>PLUTO_PEER_CA</u>
           lists the peer's CA.

       All output sent by the script to stderr or stdout is logged. The script should return an exit status of 0
       if and only if it succeeds.

       <b>pluto</b> waits for the script to finish and will not do any other processing while it is waiting. The script
       may assume that <b>pluto</b> will not change anything while the script runs. The script should avoid doing
       anything that takes much time and it should not issue any command that requires processing by <b>pluto</b>.
       Either of these activities could be performed by a background subprocess of the script.

   <b>Rekeying</b>
       When an SA that was initiated by <u>pluto</u> has only a bit of lifetime left, <u>pluto</u> will initiate the creation
       of a new SA. This applies to ISAKMP and IPsec SAs. The rekeying will be initiated when the SA's remaining
       lifetime is less than the rekeymargin plus a random percentage, between 0 and rekeyfuzz, of the
       rekeymargin.

       Similarly, when an SA that was initiated by the peer has only a bit of lifetime left, <b>pluto</b> will try to
       initiate the creation of a replacement. To give preference to the initiator, this rekeying will only be
       initiated when the SA's remaining lifetime is half of rekeymargin. If rekeying is done by the responder,
       the roles will be reversed: the responder for the old SA will be the initiator for the replacement. The
       former initiator might also initiate rekeying, so there may be redundant SAs created. To avoid these
       complications, make sure that rekeymargin is generous.

       One risk of having the former responder initiate is that perhaps none of its proposals is acceptable to
       the former initiator (they have not been used in a successful negotiation). To reduce the chances of this
       happening, and to prevent loss of security, the policy settings are taken from the old SA (this is the
       case even if the former initiator is initiating). These may be stricter than those of the connection.

       <b>pluto</b> will not rekey an SA if that SA is not the most recent of its type (IPsec or ISAKMP) for its
       potential connection. This avoids creating redundant SAs.

       The random component in the rekeying time (rekeyfuzz) is intended to make certain pathological patterns
       of rekeying unstable. If both sides decide to rekey at the same time, twice as many SAs as necessary are
       created. This could become a stable pattern without the randomness.

       Another more important case occurs when a security gateway has SAs with many other security gateways.
       Each of these connections might need to be rekeyed at the same time. This would cause a high peek
       requirement for resources (network bandwidth, CPU time, entropy for random numbers). The rekeyfuzz can be
       used to stagger the rekeying times.

       Once a new set of SAs has been negotiated, <u>pluto</u> will never send traffic on a superseded one. Traffic
       will be accepted on an old SA until it expires.

   <b>Selecting</b> <b>a</b> <b>Connection</b> <b>When</b> <b>Responding:</b> <b>Road</b> <b>Warrior</b> <b>Support</b>
       When <b>pluto</b> receives an initial Main Mode message, it needs to decide which connection this message is
       for. It picks based solely on the source and destination IP addresses of the message. There might be
       several connections with suitable IP addresses, in which case one of them is arbitrarily chosen. (The
       ISAKMP SA proposal contained in the message could be taken into account, but it is not.)

       The ISAKMP SA is negotiated before the parties pass further identifying information, so all ISAKMP SA
       characteristics specified in the connection description should be the same for every connection with the
       same two host IP addresses. At the moment, the only characteristic that might differ is authentication
       method.

       Up to this point, all configuring has presumed that the IP addresses are known to all parties ahead of
       time. This will not work when either end is mobile (or assigned a dynamic IP address for other reasons).
       We call this situation "Road Warrior". It is fairly tricky and has some important limitations, most of
       which are features of the IKE protocol.

       Only the initiator may be mobile: the initiator may have an IP number unknown to the responder. When the
       responder doesn't recognize the IP address on the first Main Mode packet, it looks for a connection with
       itself as one end and <u>%any</u> as the other. If it cannot find one, it refuses to negotiate. If it does find
       one, it creates a temporary connection that is a duplicate except with the <u>%any</u> replaced by the source IP
       address from the packet; if there was no identity specified for the peer, the new IP address will be
       used.

       When <b>pluto</b> is using one of these temporary connections and needs to find the preshared secret or RSA
       private key in <u>ipsec.secrets</u>, and the connection specified no identity for the peer, <u>%any</u> is used as its
       identity. After all, the real IP address was apparently unknown to the configuration, so it is
       unreasonable to require that it be used in this table.

       Part way into the Phase 1 (Main Mode) negotiation using one of these temporary connection descriptions,
       <u>pluto</u> will receive an Identity Payload. At this point, <b>pluto</b> checks for a more appropriate connection,
       one with an identity for the peer that matches the payload and would use the same keys as so far used for
       authentication. If it finds one, it will switch to using this better connection (or a temporary one
       derived from this, if it has <u>%any</u> for the peer's IP address). It may even turn out that no connection
       matches the newly discovered identity, including the current connection; if so, <b>pluto</b> terminates
       negotiation.

       Unfortunately, if preshared secret authentication is being used, the Identity Payload is encrypted using
       this secret, so the secret must be selected by the responder without knowing this payload. This limits
       there to being at most one preshared secret for all Road Warrior systems connecting to a host. RSA
       Signature authentication does not require that the responder knows how to select the initiator's public
       key until after the initiator's Identity Payload is decoded (using the responder's private key, so that
       must be preselected).

       When <b>pluto</b> is responding to a Quick Mode negotiation via one of these temporary connection descriptions,
       it may well find that the subnets specified by the initiator don't match those in the temporary
       connection description. If so, it will look for a connection with matching subnets, its own host address,
       a peer address of <u>%any</u> and matching identities. If it finds one, a new temporary connection is derived
       from this one and used for the Quick Mode negotiation of IPsec SAs. If it does not find one, <b>pluto</b>
       terminates negotiation.

       Be sure to specify an appropriate nexthop for the responder to send a message to the initiator: <b>pluto</b> has
       no way of guessing it (if forwarding isn't required, use an explicit <u>%direct</u> as the nexthop and the IP
       address of the initiator will be filled in; the obsolete notation 0.0.0.0 is still accepted).

       <b>pluto</b> has no special provision for the initiator side. The current (possibly dynamic) IP address and
       nexthop must be used in defining connections. These must be properly configured each time the initiator's
       IP address changes.  <u>pluto</u> has no mechanism to do this automatically.

       Although we call this Road Warrior Support, it could also be used to support encrypted connections with
       anonymous initiators. The responder's organization could announce the preshared secret that would be used
       with unrecognized initiators and let anyone connect. Of course the initiator's identity would not be
       authenticated.

       If any Road Warrior connections are supported, <u>pluto</u> cannot reject an exchange initiated by an unknown
       host until it has determined that the secret is not shared or the signature is invalid. This must await
       the third Main Mode message from the initiator. If no Road Warrior connection is supported, the first
       message from an unknown source would be rejected. This has implications for ease of debugging
       configurations and for denial of service attacks.

       Although a Road Warrior connection must be initiated by the mobile side, the other side can and will
       rekey using the temporary connection it has created. If the Road Warrior wishes to be able to disconnect,
       it is probably wise to set <b>--keyingtries</b> to 1 in the connection on the non-mobile side to prevent it
       trying to rekey the connection. Unfortunately, there is no mechanism to unroute the connection
       automatically.

   <b>Debugging</b>
       <b>pluto</b> accepts several optional arguments, useful mostly for debugging. Except for <b>--interface</b>, each
       should appear at most once.

       <b>--interface</b> <u>interfacename</u>
           Specifies that the named real public network interface should be considered. The interface name
           specified should not be <b>ipsec</b><u>N</u>. If the option doesn't appear, all interfaces are considered. To
           specify several interfaces, use the option once for each. One use of this option is to specify which
           interface should be used when two or more share the same IP address.

       <b>--ikeport</b> <u>port-number</u>
           Changes the UDP port that <u>pluto</u> will use (default, specified by IANA: 500).

       <b>--secretsfile</b> <u>file</u>
           Specifies the file for authentication secrets (default: /etc/ipsec.secrets). This name is subject to
           "globbing" as in <b><a href="../man1/sh.1.html">sh</a></b>(1), so every file with a matching name is processed. Quoting is generally needed
           to prevent the shell from doing the globbing.

       <b>--nofork</b>
           Disable "daemon fork" (default is to fork). In addition, after the lock file and control socket are
           created, print the line "Pluto initialized" to standard out.

       <b>--uniqueids</b>
           If this option has been selected, whenever a new ISAKMP SA is established, any connection with the
           same Peer ID but a different Peer IP address is unoriented (causing all its SAs to be deleted). This
           helps clean up dangling SAs when a connection is lost and then regained at another IP address.

       <b>--force-busy</b>
           If this option has been selected, pluto will be forced to be "busy". In this state, which happens
           when there is a Denial of Service attack, will force pluto to use cookies before accepting new
           incoming IKE packets. Cookies are send and required in ikev1 Aggressive Mode and in ikev2. This
           option is mostly used for testing purposes, but can be selected by paranoid administrators as well.

       <b>--stderrlog</b>
           Log goes to standard out (default is to use <b><a href="../man8/syslogd.8.html">syslogd</a></b>(8)).

       <b>pluto</b> is willing to produce a prodigious amount of debugging information. There are several classes of
       debugging output, and <u>pluto</u> may be directed to produce a selection of them. All lines of debugging output
       are prefixed with "|" to distinguish them from normal diagnostic messages.

       When <b>pluto</b> is invoked, it may be given arguments to specify which debug classes to output. The current
       options are:

       <b>--debug</b> <b>help</b> (whack only)
           List the debugging classes recognised by <u>pluto</u>.

       <b>--debug</b> <b>none</b>
           Disable logging for all debugging classes.

       <b>--debug</b> <b>base</b>
           Enable debug-logging.

       <b>--debug</b> <b>cpu-usage</b>
           Enable cpu-usage logging.

       <b>--debug</b> <u>class</u>, <b>--no-debug</b> <u>class</u>, <b>--debug</b> <b>no-</b><u>class</u>
           Enable (disable) logging of the specified debugging <u>class</u> (<b>--debug</b> <b>help</b> lists debugging classes
           supported by this version of <b>pluto</b>).

       The debug form of the <b>whack</b> command will change the selection in a running <u>pluto</u>. If a connection name is
       specified, the flags are added whenever <u>pluto</u> has identified that it is dealing with that connection.
       Unfortunately, this is often part way into the operation being observed.

       For example, to start <b>pluto</b> with both <u>base</u> and <u>cpu-usage</u> debug-logging enabled:

           ipsec pluto --debug base --debug cpu-usage

       To later change this <b>pluto</b> to disable <u>base</u> debug-logging use either:

           ipsec whack --no-debug base

       or:

           ipsec whack --debug none --debug cpu-usage

   <b>Impairing</b>
       <b>pluto</b> and <u>whack</u> accept several optional arguments that alter (impair) correct behaviour.

       These options are solely intended for use by developers when testing <b>pluto</b>.

       <b>--impair</b> <b>help</b> (whack only)
           List all the behaviours that can be altered (impaired).

       <b>--impair</b> <b>list</b> (whack only)
           List all the behaviours that are currently altered (impaired).

       <b>--impair</b> <b>none</b>
           Disable all altered (impaired) behaviours.

       <b>--impair</b> <u>behaviour</u>, <b>--impair</b> <u>behaviour</u><b>:</b><u>how</u>, <b>--no-impair</b> <u>behaviour</u>
           Alter (impair) <b>pluto</b> inducing the (possibly erroneous) <u>behaviour</u>.

   <b>Pluto's</b> <b>Behaviour</b> <b>When</b> <b>Things</b> <b>Go</b> <b>Wrong</b>
       When <b>pluto</b> doesn't understand or accept a message, it just ignores the message. It is not yet capable of
       communicating the problem to the other IKE daemon (in the future it might use Notifications to accomplish
       this in many cases). It does log a diagnostic.

       When <b>pluto</b> gets no response from a message, it resends the same message (a message will be sent at most
       three times). This is appropriate: UDP is unreliable.

       When pluto gets a message that it has already seen, there are many cases when it notices and discards it.
       This too is appropriate for UDP.

       Combine these three rules, and you can explain many apparently mysterious behaviours. In a <b>pluto</b> log,
       retrying isn't usually the interesting event. The critical thing is either earlier (<b>pluto</b> got a message
       that it didn't like and so ignored, so it was still awaiting an acceptable message and got impatient) or
       on the other system (<u>pluto</u> didn't send a reply because it wasn't happy with the previous message).

   <b>Notes</b>
       Each IPsec SA is assigned an SPI, a 32-bit number used to refer to the SA. The IKE protocol lets the
       destination of the SA choose the SPI. The range 0 to 0xFF is reserved for IANA.  <u>Pluto</u> also avoids
       choosing an SPI in the range 0x100 to 0xFFF, leaving these SPIs free for manual keying. Remember that the
       peer, if not <b>pluto</b>, may well chose SPIs in this range.

   <b>Policies</b>
       This catalogue of policies may be of use when trying to configure <b>pluto</b> and another IKE implementation to
       interoperate.

       In Phase 1, only Main Mode is supported. We are not sure that Aggressive Mode is secure. For one thing,
       it does not support identity protection. It may allow more severe Denial Of Service attacks.

       No Informational Exchanges are supported. These are optional and since their delivery is not assured,
       they must not matter. It is the case that some IKE implementations won't interoperate without
       Informational Exchanges, but we feel they are broken.

       No Informational Payloads are supported. These are optional, but useful. It is of concern that these
       payloads are not authenticated in Phase 1, nor in those Phase 2 messages authenticated with <a href="../man3/HASH.3.html">HASH</a>(3).

       •
           Diffie Hellman Group MODP 1536 (5) is supported. Groups MODP768 and MODP 1024 (1 and 2) are not
           supported because those are too weak.

       •
           Host authentication can be done by RSA Signatures or Pre-Shared Secrets.

       •
           TODO! This information is outdated. 3DES CBC (Cypher Block Chaining mode) is the only encryption
           supported, both for ISAKMP SAs and IPSEC SAs.

       •
           MD5 and SHA1 hashing are supported for packet authentication in both kinds of SAs.

       •
           The ESP, AH, or AH plus ESP are supported. If, and only if, AH and ESP are combined, the ESP need not
           have its own authentication component. The selection is controlled by the --encrypt and
           --authenticate flags.

       •
           Each of these may be combined with IPCOMP Deflate compression, but only if the potential connection
           specifies compression.

       •
           The IPSEC SAs may be tunnel or transport mode, where appropriate. The --tunnel flag controls this
           when <u>pluto</u> is initiating.

       •
           When responding to an ISAKMP SA proposal, the maximum acceptable lifetime is eight hours. The default
           is one hour. There is no minimum. The --ikelifetime flag controls this when <u>pluto</u> is initiating.

       •
           When responding to an IPSEC SA proposal, the maximum acceptable lifetime is one day. The default is
           eight hours. There is no minimum. The --ipseclifetime flag controls this when <b>pluto</b> is initiating.

       •
           PFS is acceptable, and will be proposed if the --pfs flag was specified. The DH group proposed will
           be the same as negotiated for Phase 1.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       If <b>ipsec</b> <b>whack</b> detects a problem, it will return an exit status of 1. If it received progress messages
       from <b>pluto</b>, it returns as status the value of the numeric prefix from the last such message that was not
       a message sent to syslog or a comment (but the prefix for success is treated as 0). Otherwise, the exit
       status is 0.

</pre><h4><b>FILES</b></h4><pre>
       /run/pluto/pluto.pid /run/pluto/pluto.ctl /etc/ipsec.secrets /dev/urandom

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       pluto does not use any environment variables

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       The rest of the Libreswan distribution, in particular <b><a href="../man8/ipsec.8.html">ipsec</a></b>(8).

       <b><a href="../man8/ipsec.8.html">ipsec</a></b>(8) is designed to make using <b>pluto</b> more pleasant. Use it!

       <b><a href="../man5/ipsec.secrets.5.html">ipsec.secrets</a></b>(5) describes the format of the secrets file.

       For more information on IPsec, the mailing list, and the relevant documents, see:

       <b>https://datatracker.ietf.org/wg/ipsecme/charter/</b>

       At the time of writing, the latest IETF IKE RFC is:

       RFC 7296 Internet Key Exchange Protocol Version 2 (IKEv2)

       The Libreswan web site &lt;https://libreswan.org&gt; and the mailing lists described there.

       The Libreswan wiki &lt;https://libreswan.org/wiki&gt; and the mailing lists described there.

       The Libreswan list of implemented RFCs &lt;https://libreswan.org/wiki/Implemented_Standards&gt;

</pre><h4><b>HISTORY</b></h4><pre>
       This code is released under the GPL terms. See the accompanying files CHANGES COPYING and CREDITS.* for
       more details.

       Detailed history (including FreeS/WAN and Openswan) can be found in the docs/ directory.

</pre><h4><b>BUGS</b></h4><pre>
       Please see &lt;<b>https://github.com/libreswan/libreswan/issues</b>&gt; for a list of currently known bugs and missing
       features.

       Bugs should be reported to the &lt;<a href="mailto:swan-dev@lists.libreswan.org">swan-dev@lists.libreswan.org</a>&gt; mailing list.

</pre><h4><b>AUTHOR</b></h4><pre>
       Paul Wouters

Libreswan 5.2                                      07/30/2025                                     <u><a href="../man8/IPSEC-WHACK.8.html">IPSEC-WHACK</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>