<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dmstats — device-mapper statistics management</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/dmsetup">dmsetup_1.02.205-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       dmstats — device-mapper statistics management

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>dmsetup</b> <b>stats</b> <u>command</u> [OPTIONS]

       <b>dmstats</b> <u>command</u> <u>device_name</u> | <b>--major</b> <u>major</u> <b>--minor</b> <u>minor</u> | <b>-u</b>|<b>--uuid</b> <u>uuid</u> [<b>-v</b>|<b>--verbose</b>]
       <b>dmstats</b> <b>clear</b> <u>device_name</u> [<b>--allprograms</b>|<b>--programid</b> <u>id</u>] [<b>--allregions</b>|<b>--regionid</b> <u>id</u>]
       <b>dmstats</b> <b>create</b> <u>device_name</u>...|<u>file_path</u>...|<b>--alldevices</b> [<b>--areas</b> <u>nr_areas</u>|<b>--areasize</b> <u>area_size</u>] [<b>--bounds</b>
              <u>histogram_boundaries</u>] [<b>--filemap</b>] [<b>--follow</b> <u>follow_mode</u>] [<b>--foreground</b>] [<b>--nomonitor</b>] [<b>--nogroup</b>]
              [<b>--precise</b>] [<b>--start</b> <u>start_sector</u> <b>--length</b> <u>length</u>|<b>--segments</b>] [<b>--userdata</b> <u>user_data</u>] [<b>--programid</b>
              <u>id</u>]
       <b>dmstats</b> <b>delete</b> <u>device_name</u>|<b>--alldevices</b> [<b>--allprograms</b>|<b>--programid</b> <u>id</u>] [<b>--allregions</b>|<b>--regionid</b> <u>id</u>]
       <b>dmstats</b> <b>group</b> [<u>device_name</u>|<b>--alldevices</b>] [<b>--alias</b> <u>name</u>] [<b>--regions</b> <u>regions</u>]
       <b>dmstats</b> <b>help</b> [<b>-c</b>|<b>-C</b>|<b>--columns</b>]
       <b>dmstats</b> <b>list</b> [<u>device_name</u>] [<b>--histogram</b>] [<b>--allprograms</b>|<b>--programid</b> <u>id</u>] [<b>--units</b> <u>units</u>] [<b>--area</b>]
              [<b>--region</b>] [<b>--group</b>] [<b>--nosuffix</b>] [<b>--notimesuffix</b>] [<b>-v</b>|<b>--verbose</b>]
       <b>dmstats</b> <b>print</b> [<u>device_name</u>] [<b>--clear</b>] [<b>--allprograms</b>|<b>--programid</b> <u>id</u>] [<b>--allregions</b>|<b>--regionid</b> <u>id</u>]
       <b>dmstats</b> <b>report</b> [<u>device_name</u>] [<b>--interval</b> <u>seconds</u>] [<b>--count</b> <u>count</u>] [<b>--units</b> <u>units</u>] [<b>--histogram</b>]
              [<b>--allprograms</b>|<b>--programid</b> <u>id</u>] [<b>--allregions</b>|<b>--regionid</b> <u>id</u>] [<b>--area</b>] [<b>--region</b>] [<b>--group</b>]
              [<b>-O</b>|<b>--sort</b> <u>sort_fields</u>] [<b>-S</b>|<b>--select</b> <u>selection</u>] [<b>--units</b> <u>units</u>] [<b>--nosuffix</b>] [<b>--notimesuffix</b>]
       <b>dmstats</b> <b>ungroup</b> [<u>device_name</u>|<b>--alldevices</b>] [<b>--groupid</b> <u>id</u>]
       <b>dmstats</b> <b>update_filemap</b> <u>file_path</u> [<b>--groupid</b> <u>id</u>] [<b>--follow</b> <u>follow_mode</u>] [<b>--foreground</b>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  dmstats program manages IO statistics regions for devices that use the device-mapper driver. Statis‐
       tics regions may be created, deleted, listed and reported on using the tool.

       The first argument to dmstats is a <u>command</u>.

       The second argument is the <u>device</u> <u>name</u>, <u>uuid</u> or <u>major</u> and <u>minor</u> numbers.

       Further options permit the selection of regions, output format control, and reporting behaviour.

       When no device argument is given dmstats will by default operate on all  device-mapper  devices  present.
       The <b>create</b> and <b>delete</b> commands require the use of <b>--alldevices</b> when used in this way.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--alias</b> <u>name</u>
              Specify an alias name for a group.

       <b>--alldevices</b>
              If no device arguments are given allow operation on all devices when creating or deleting regions.

       <b>--allprograms</b>
              Include regions from all program IDs for list and report operations.

       <b>--allregions</b>
              Include all present regions for commands that normally accept a single region identifier.

       <b>--area</b> When performing a list or report, include objects of type area in the results.

       <b>--areas</b> <u>nr_areas</u>
              Specify the number of statistics areas to create within a new region.

       <b>--areasize</b> <u>area_size</u>[<b>b</b>|<b>B</b>|<b>s</b>|<b>S</b>|<b>k</b>|<b>K</b>|<b>m</b>|<b>M</b>|<b>g</b>|<b>G</b>|<b>t</b>|<b>T</b>|<b>p</b>|<b>P</b>|<b>e</b>|<b>E</b>]
              Specify  the  size  of areas into which a new region should be divided. An optional suffix selects
              units of: (<b>b</b>)ytes, (<b>s</b>)ectors, (<b>k</b>)ilobytes,  (<b>m</b>)egabytes,  (<b>g</b>)igabytes,  (<b>t</b>)erabytes,  (<b>p</b>)etabytes,
              (<b>e</b>)xabytes.  Capitalise to use multiples of 1000 (S.I.) instead of 1024.

       <b>--clear</b>
              When printing statistics counters, also atomically reset them to zero.

       <b>--count</b> <u>count</u>
              Specify the iteration count for repeating reports. If the count argument is zero reports will con‐
              tinue to repeat until interrupted.

       <b>--group</b>
              When performing a list or report, include objects of type group in the results.

       <b>--filemap</b>
              Instead  of creating regions on a device as specified by command line options, open the file found
              at each <b>file_path</b> argument, and create regions corresponding to the locations of the  on-disk  ex‐
              tents allocated to the file(s).

       <b>--nomonitor</b>
              Disable  the  <b>dmfilemapd</b>  daemon  when creating new file mapped groups. Normally the device-mapper
              filemap monitoring daemon, <b>dmfilemapd</b>, is started for each file mapped group to update the set  of
              regions as the file changes on-disk: use of this option disables this behaviour.

              Regions in the group may still be updated with the <b>update_filemap</b> command, or by starting the dae‐
              mon manually.

       <b>--follow</b> <u>follow_mode</u>
              Specify  the  <b>dmfilemapd</b>  file following mode. The file map monitoring daemon can monitor files in
              two distinct ways: the mode affects the behaviour of the daemon when a file  under  monitoring  is
              renamed or unlinked, and the conditions which cause the daemon to terminate.

              The <b>follow_mode</b> argument is either "inode", for follow-inode mode, or "path", for follow-path.

              If  follow-inode  mode is used, the daemon will hold the file open, and continue to update regions
              from the same file descriptor. This means that the mapping will follow rename,  move  (within  the
              same file system), and unlink operations. This mode is useful if the file is expected to be moved,
              renamed, or unlinked while it is being monitored.

              In  follow-inode mode, the daemon will exit once it detects that the file has been unlinked and it
              is the last holder of a reference to it.

              If follow-path is used, the daemon will re-open the provided path on  each  monitoring  iteration.
              This  means  that  the group will be updated to reflect a new file being moved to the same path as
              the original file. This mode is useful for files that are expected to be updated  via  unlink  and
              rename.

              In  follow-path  mode, the daemon will exit if the file is removed and not replaced within a brief
              tolerance interval.

              In either mode, the daemon exits automatically if the monitored group is removed.

       <b>--foreground</b>
              Specify that the <b>dmfilemapd</b> daemon should run in the foreground.  The daemon will  not  fork  into
              the background, and will replace the <b>dmstats</b> command that started it.

       <b>--groupid</b> <u>id</u>
              Specify the group to operate on.

       <b>--bounds</b> <u>histogram_boundaries</u>[<b>ns</b>|<b>us</b>|<b>ms</b>|<b>s</b>]
              Specify  the  boundaries  of a latency histogram to be tracked for the region as a comma separated
              list of latency values. Latency values are given  in  nanoseconds.  An  optional  unit  suffix  of
              <b>ns</b>,<b>us</b>,<b>ms</b>,  or  <b>s</b> may be given after each value to specify units of nanoseconds, microseconds, mil‐
              liseconds or seconds respectively.

       <b>--histogram</b>
              When used with the <b>report</b> and <b>list</b> commands select default fields that emphasize latency histogram
              data.

       <b>--interval</b> <u>seconds</u>
              Specify the interval in seconds between successive iterations for repeating reports. If <b>--interval</b>
              is specified but <b>--count</b> is not, reports will continue to repeat until interrupted.

       <b>--length</b> <u>length</u>[<b>b</b>|<b>B</b>|<b>s</b>|<b>S</b>|<b>k</b>|<b>K</b>|<b>m</b>|<b>M</b>|<b>g</b>|<b>G</b>|<b>t</b>|<b>T</b>|<b>p</b>|<b>P</b>|<b>e</b>|<b>E</b>]
              Specify the length of a new statistics region in sectors. An optional  suffix  selects  units  of:
              (<b>b</b>)ytes,  (<b>s</b>)ectors,  (<b>k</b>)ilobytes, (<b>m</b>)egabytes, (<b>g</b>)igabytes, (<b>t</b>)erabytes, (<b>p</b>)etabytes, (<b>e</b>)xabytes.
              Capitalise to use multiples of 1000 (S.I.) instead of 1024.

       <b>-j</b>|<b>--major</b> <u>major</u>
              Specify the major number.

       <b>-m</b>|<b>--minor</b> <u>minor</u>
              Specify the minor number.

       <b>--nogroup</b>
              When creating regions mapping the extents of a file in the file system, do not create a  group  or
              set an alias.

       <b>--nosuffix</b>
              Suppress the suffix on output sizes.  Use with <b>--units</b> (except h and H) if processing the output.

       <b>--notimesuffix</b>
              Suppress  the suffix on output time values. Histogram boundary values will be reported in units of
              nanoseconds.

       <b>-o</b>|<b>--options</b>
              Specify which report fields to display.

       <b>-O</b>|<b>--sort</b> <u>sort_fields</u>
              Sort output according to the list of fields given. Precede any sort field with '<b>-</b>' for  a  reverse
              sort on that column.

       <b>--precise</b>
              Attempt to use nanosecond precision counters when creating new statistics regions.

       <b>--programid</b> <u>id</u>
              Specify  a  program ID string. When creating new statistics regions this string is stored with the
              region. Subsequent operations may supply a program ID in order  to  select  only  regions  with  a
              matching value. The default program ID for dmstats-managed regions is "dmstats".

       <b>--region</b>
              When performing a list or report, include objects of type region in the results.

       <b>--regionid</b> <u>id</u>
              Specify the region to operate on.

       <b>--regions</b> <u>region_list</u>
              Specify  a  list  of  regions to group. The group list is a comma-separated list of region identi‐
              fiers. Continuous sequences of identifiers may be expressed as a hyphen separated range, for exam‐
              ple: '1–10'.

       <b>--relative</b>
              If displaying the histogram report show relative (percentage) values instead of absolute counts.

       <b>-S</b>|<b>--select</b> <u>selection</u>
              Display only rows that match <u>selection</u> criteria. All rows with the  additional  "selected"  column
              (<b>-o</b>  <b>selected</b>)  showing 1 if the row matches the <u>selection</u> and 0 otherwise. The selection criteria
              are defined by specifying column names and their valid values while making use of  supported  com‐
              parison operators.

       <b>--start</b> <u>start</u>[<b>b</b>|<b>B</b>|<b>s</b>|<b>S</b>|<b>k</b>|<b>K</b>|<b>m</b>|<b>M</b>|<b>g</b>|<b>G</b>|<b>t</b>|<b>T</b>|<b>p</b>|<b>P</b>|<b>e</b>|<b>E</b>]
              Specify  the  start offset of a new statistics region in sectors. An optional suffix selects units
              of:  (<b>b</b>)ytes,  (<b>s</b>)ectors,  (<b>k</b>)ilobytes,  (<b>m</b>)egabytes,   (<b>g</b>)igabytes,   (<b>t</b>)erabytes,   (<b>p</b>)etabytes,
              (<b>e</b>)xabytes.  Capitalise to use multiples of 1000 (S.I.) instead of 1024.

       <b>--segments</b>
              When  used  with <b>create</b>, create a new statistics region for each target contained in the given de‐
              vice(s). This causes a separate region to be allocated for each segment of the device.

              The newly created regions are automatically placed into a group unless  the  <b>--nogroup</b>  option  is
              given. When grouping is enabled a group alias may be specified using the <b>--alias</b> option.

       <b>--units</b> [<u>units</u>][<b>h</b>|<b>H</b>|[<b>b</b>|<b>B</b>|<b>s</b>|<b>S</b>|<b>k</b>|<b>K</b>|<b>m</b>|<b>M</b>|<b>g</b>|<b>G</b>|<b>t</b>|<b>T</b>|<b>p</b>|<b>P</b>|<b>e</b>|<b>E</b>]
              Set  the  display units for report output.  All sizes are output in these units: (<b>h</b>)uman-readable,
              (<b>b</b>)ytes, (<b>s</b>)ectors, (<b>k</b>)ilobytes, (<b>m</b>)egabytes, (<b>g</b>)igabytes, (<b>t</b>)erabytes,  (<b>p</b>)etabytes,  (<b>e</b>)xabytes.
              Capitalise  to  use  multiples of 1000 (S.I.) instead of 1024.  Can also specify custom units e.g.
              <b>--units</b> <b>3M</b>.

       <b>--userdata</b> <u>user_data</u>
              Specify user data (a word) to be stored with a new region. The value is added to any internal aux‐
              iliary data (for example, group information), and stored with the region  in  the  aux_data  field
              provided by the kernel. Whitespace is not permitted.

       <b>-u</b>|<b>--uuid</b>
              Specify the uuid.

       <b>-v</b>|<b>--verbose</b> [<b>-v</b>|<b>--verbose</b>]
              Produce additional output.

</pre><h4><b>COMMANDS</b></h4><pre>

       <b>clear</b> <u>device_name</u> [<b>--allprograms</b>|<b>--programid</b> <u>id</u>] [<b>--allregions</b>|<b>--regionid</b> <u>id</u>]
              Instructs the kernel to clear statistics counters for the specified regions (with the exception of
              in-flight IO counters).

       <b>create</b> <u>device_name</u>...|<u>file_path</u>...|<b>--alldevices</b> [<b>--areas</b> <u>nr_areas</u>|<b>--areasize</b> <u>area_size</u>] [<b>--bounds</b>
              <u>histogram_boundaries</u>] [<b>--filemap</b>] [<b>--follow</b> <u>follow_mode</u>] [<b>--foreground</b>] [<b>--nomonitor</b>] [<b>--nogroup</b>]
              [<b>--precise</b>] [<b>--start</b> <u>start_sector</u> <b>--length</b> <u>length</u>|<b>--segments</b>] [<b>--userdata</b> <u>user_data</u>] [<b>--programid</b>
              <u>id</u>]
              Creates one or more new statistics regions on the specified device(s).

              The  region  will  span the entire device unless <b>--start</b> and <b>--length</b> or <b>--segments</b> are given. The
              <b>--start</b> an <b>--length</b> options allow a region of arbitrary length to be placed at an arbitrary offset
              into the device. The <b>--segments</b> option causes a new region to be created for each  target  in  the
              corresponding device-mapper device's table.

              If  the <b>--precise</b> option is used the command will attempt to create a region using nanosecond pre‐
              cision counters.

              If <b>--bounds</b> is given a latency histogram will be tracked for the new region. The boundaries of the
              histogram bins are given as a comma separated list of latency values. There is an  implicit  lower
              bound of zero on the first bin and an implicit upper bound of infinity (or the configured interval
              duration) on the final bin.

              Latencies are given in nanoseconds. An optional unit suffix of ns, us, ms, or s may be given after
              each value to specify units of nanoseconds, microseconds, milliseconds or seconds respectively, so
              for  example, 10 ms is equivalent to 10,000,000.  Latency values with a precision of less than one
              millisecond can only be used when precise timestamps are enabled: if <b>--precise</b> is  not  given  and
              values less than one millisecond are used it will be enabled automatically.

              An  optional  <b>program_id</b>  or  <b>user_data</b> string may be associated with the region. A <b>program_id</b> may
              then be used to select regions for subsequent list, print, and report  operations.  The  <b>user_data</b>
              stores  an arbitrary string and is not used by dmstats or the device-mapper kernel statistics sub‐
              system.

              By default dmstats creates regions with a <b>program_id</b> of "dmstats".

              On success the <b>region_id</b> of the newly created region is printed to stdout.

              If the <b>--filemap</b> option is given with a regular file, or list of files, as the <b>file_path</b> argument,
              instead of creating regions with parameters specified on the command line, <b>dmstats</b> will  open  the
              files  located  at <b>file_path</b> and create regions corresponding to the physical extents allocated to
              the file. This can be used to monitor statistics for individual files in the file system, for  ex‐
              ample, virtual machine images, swap areas, or large database files.

              To  work  with the <b>--filemap</b> option, files must be located on a local file system, backed by a de‐
              vice-mapper device, that supports physical extent data using the FIEMAP ioctl (e.g. Ext4 and XFS).

              By default regions that map a file are placed into a group and the group alias is set to the base‐
              name of the file. This behaviour can be overridden with the <b>--alias</b> and <b>--nogroup</b> options.

              Creating a group that maps a file automatically starts a daemon, <b>dmfilemapd</b> to  monitor  the  file
              and update the mapping as the extents allocated to the file change. This behaviour can be disabled
              using the <b>--nomonitor</b> option.

              Use the <b>--group</b> option to only display information for groups when listing and reporting.

       <b>delete</b> <u>device_name</u>|<b>--alldevices</b> [<b>--allprograms</b>|<b>--programid</b> <u>id</u>] [<b>--allregions</b>|<b>--regionid</b> <u>id</u>]
              Delete the specified statistics region. All counters and resources used by the region are released
              and the region will not appear in the output of subsequent list, print, or report operations.

              All regions registered on a device may be removed using <b>--allregions</b>.

              To remove all regions on all devices both <b>--allregions</b> and <b>--alldevices</b> must be used.

              If  a  <b>--groupid</b> is given instead of a <b>--regionid</b> the command will attempt to delete the group and
              all regions that it contains.

              If a deleted region is the first member of a group of regions the group will also be removed.

       <b>group</b> [<u>device_name</u>|<b>--alldevices</b>] [<b>--alias</b> <u>name</u>] [<b>--regions</b> <u>regions</u>]
              Combine one or more statistics regions on the specified device into a group.

              The list of regions to be grouped is specified with <b>--regions</b> and an optional  alias  may  be  as‐
              signed  with <b>--alias</b>. The set of regions is given as a comma-separated list of region identifiers.
              A continuous range of identifiers spanning from <b>R1</b> to <b>R2</b> may be expressed as '<b>R1</b>-<b>R2</b>'.

              Regions that have a histogram configured can be grouped: in this case the number of histogram bins
              and their bounds must match exactly.

              On success the group list and newly created <b>group_id</b> are printed to stdout.

              The group metadata is stored with the first (lowest numbered) <b>region_id</b>  in  the  group:  deleting
              this  region  will  also  delete the group and other group members will be returned to their prior
              state.

       <b>help</b> [<b>-c</b>|<b>-C</b>|<b>--columns</b>]
              Outputs a summary of the commands available, optionally including the list of report fields.

       <b>list</b> [<u>device_name</u>] [<b>--histogram</b>] [<b>--allprograms</b>|<b>--programid</b> <u>id</u>] [<b>--units</b> <u>units</u>] [<b>--area</b>] [<b>--region</b>]
              [<b>--group</b>] [<b>--nosuffix</b>] [<b>--notimesuffix</b>] [<b>-v</b>|<b>--verbose</b>]
              List the statistics regions, areas, or groups registered on  the  device.   If  the  <b>--allprograms</b>
              switch is given all regions will be listed regardless of region program ID values.

              By  default  only  regions and groups are included in list output. If <b>-v</b> or <b>--verbose</b> is given the
              report will also include a row of information for each configured group and  for  each  area  con‐
              tained in each region displayed.

              Regions  that contain a single area are by default omitted from the verbose list since their prop‐
              erties are identical to the area that they contain - to view all regions regardless of the  number
              of areas present use <b>--region</b>). To also view the areas contained within regions use <b>--area</b>.

              If  <b>--histogram</b> is given the report will include the bin count and latency boundary values for any
              configured histograms.

       <b>print</b> [<u>device_name</u>] [<b>--clear</b>] [<b>--allprograms</b>|<b>--programid</b> <u>id</u>] [<b>--allregions</b>|<b>--regionid</b> <u>id</u>]
              Print raw statistics counters for the specified region or for all present regions.

       <b>report</b> [<u>device_name</u>] [<b>--interval</b> <u>seconds</u>] [<b>--count</b> <u>count</u>] [<b>--units</b> <u>units</u>] [<b>--histogram</b>]
              [<b>--allprograms</b>|<b>--programid</b> <u>id</u>] [<b>--allregions</b>|<b>--regionid</b> <u>id</u>] [<b>--area</b>] [<b>--region</b>] [<b>--group</b>]
              [<b>-O</b>|<b>--sort</b> <u>sort_fields</u>] [<b>-S</b>|<b>--select</b> <u>selection</u>] [<b>--units</b> <u>units</u>] [<b>--nosuffix</b>] [<b>--notimesuffix</b>]
              Start a report for the specified object or for all present objects. If the count argument is spec‐
              ified, the report will repeat at a fixed interval set by the <b>--interval</b> option. The default inter‐
              val is one second.

              If the <b>--allprograms</b> switch is given, all regions will be listed, regardless of region program  ID
              values.

              If the <b>--histogram</b> is given the report will include the histogram values and latency boundaries.

              If  the  <b>--relative</b> is used the default histogram field displays bin values as a percentage of the
              total number of I/Os.

              Object types (areas, regions and groups) to include in the report are selected using  the  <b>--area</b>,
              <b>--region</b>, and <b>--group</b> options.

       <b>ungroup</b> [<u>device_name</u>|<b>--alldevices</b>] [<b>--groupid</b> <u>id</u>]
              Remove an existing group and return all the group's regions to their original state.

              The group to be removed is specified using <b>--groupid</b>.

       <b>update_filemap</b> <u>file_path</u> [<b>--groupid</b> <u>id</u>] [<b>--follow</b> <u>follow_mode</u>] [<b>--foreground</b>]
              Update  a  group  of  <b>dmstats</b>  regions  specified  by  <b>group_id</b>, that were previously created with
              <b>--filemap</b>, either directly, or by starting the monitoring daemon, <b>dmfilemapd</b>.

              This will add and remove regions to reflect changes in the allocated extents of the file  on-disk,
              since the time that it was created or last updated.

              Use  of this command is not normally needed since the <b>dmfilemapd</b> daemon will automatically monitor
              filemap groups and perform these updates when required.

              If a filemapped group was created with <b>--nomonitor</b>,  or  the  daemon  has  been  killed,  the  <b>up‐</b>
              <b>date_filemap</b> can be used to manually force an update or start a new daemon.

              Use <b>--nomonitor</b> to force a direct update and disable starting the monitoring daemon.

</pre><h4><b>REGIONS,</b> <b>AREAS,</b> <b>AND</b> <b>GROUPS</b></h4><pre>
       The device-mapper statistics facility allows separate performance counters to be maintained for arbitrary
       regions  of  devices. A region may span any range: from a single sector to the whole device. A region may
       be further sub-divided into a number of distinct areas (one or more), each with its own counter  set.  In
       this case a summary value for the entire region is also available for use in reports.

       In addition, one or more regions on one device can be combined into a statistics group. Groups allow sev‐
       eral  regions  to  be  aggregated and reported as a single entity; counters for all regions and areas are
       summed and used to report totals for all group members. Groups also permit the assignment of an  optional
       alias, allowing meaningful names to be associated with sets of regions.

       The  group  metadata is stored with the first (lowest numbered) <b>region_id</b> in the group: deleting this re‐
       gion will also delete the group and other group members will be returned to their prior state.

       By default new regions span the entire device. The <b>--start</b> and <b>--length</b> options allows a  region  of  any
       size to be placed at any location on the device.

       Using offsets it is possible to create regions that map individual objects within a block device (for ex‐
       ample: partitions, files in a file system, or stripes or other structures in a RAID volume). Groups allow
       several non-contiguous regions to be assembled together for reporting and data aggregation.

       A region may be either divided into the specified number of equal-sized areas, or into areas of the given
       size by specifying one of <b>--areas</b> or <b>--areasize</b> when creating a region with the <b>create</b> command. Depending
       on  the  size of the areas and the device region the final area within the region may be smaller than re‐
       quested.

   <b>Region</b> <b>identifiers</b>
       Each region is assigned an identifier when it is created that is used to reference the region  in  subse‐
       quent  operations.  Region  identifiers are unique within a given device (including across different <b>pro‐</b>
       <b>gram_id</b> values).

       Depending on the sequence of create and delete operations, gaps may exist in the  sequence  of  <b>region_id</b>
       values for a particular device.

       The <b>region_id</b> should be treated as an opaque identifier used to reference the region.

   <b>Group</b> <b>identifiers</b>
       Groups  are  also assigned an integer identifier at creation time; like region identifiers, group identi‐
       fiers are unique within the containing device.

       The <b>group_id</b> should be treated as an opaque identifier used to reference the group.

</pre><h4><b>FILE</b> <b>MAPPING</b></h4><pre>
       Using <b>--filemap</b>, it is possible to create regions that correspond to the extents of a file  in  the  file
       system. This allows IO statistics to be monitored on a per-file basis, for example to observe large data‐
       base files, virtual machine images, or other files of interest.

       To  be  able to use file mapping, the file must be backed by a device-mapper device, and in a file system
       that supports the FIEMAP ioctl (and which returns data describing the physical location of extents). This
       currently includes <b><a href="../man5/xfs.5.html">xfs</a></b>(5) and <b><a href="../man5/ext4.5.html">ext4</a></b>(5).

       By default the regions making up a file are placed together in a group, and the group alias is set to the
       <b><a href="../man3/basename.3.html">basename</a>(3)</b> of the file. This allows statistics to be reported for the file as a whole, aggregating  val‐
       ues  for  the regions making up the group. To see only the whole file (group) when using the <b>list</b> and <b>re‐</b>
       <b>port</b> commands, use <b>--group</b>.

       Since it is possible for the file to change after the initial  group  of  regions  is  created,  the  <b>up‐</b>
       <b>date_filemap</b>  command, and <b>dmfilemapd</b> daemon are provided to update file mapped groups either manually or
       automatically.

   <b>File</b> <b>follow</b> <b>modes</b>
       The file map monitoring daemon can monitor files in two distinct ways: follow-inode mode, and follow-path
       mode.

       The mode affects the behaviour of the daemon when a file under monitoring is renamed or unlinked, and the
       conditions which cause the daemon to terminate.

       If follow-inode mode is used, the daemon will hold the file open, and continue to update regions from the
       same file descriptor. This means that the mapping will follow rename, move (within the same file system),
       and unlink operations. This mode is useful if the file is expected to  be  moved,  renamed,  or  unlinked
       while it is being monitored.

       In  follow-inode mode, the daemon will exit once it detects that the file has been unlinked and it is the
       last holder of a reference to it.

       If follow-path is used, the daemon will re-open the provided path  on  each  monitoring  iteration.  This
       means  that  the group will be updated to reflect a new file being moved to the same path as the original
       file. This mode is useful for files that are expected to be updated via unlink and rename.

       In follow-path mode, the daemon will exit if the file is removed and not replaced within a  brief  toler‐
       ance interval (one second).

       To  stop  the  daemon, delete the group containing the mapped regions: the daemon will automatically shut
       down.

       The daemon can also be safely killed at any time and the group kept: if the file is still being allocated
       the mapping will become progressively out-of-date as extents are added and removed (in this case the dae‐
       mon can be re-started or the group updated manually with the <b>update_filemap</b> command).

       See the <b>create</b> command and <b>--filemap</b>, <b>--follow</b>, and <b>--nomonitor</b> options for further information.

   <b>Limitations</b>
       The daemon attempts to maintain good synchronization between the file extents and the  regions  contained
       in  the group, however, since it can only react to new allocations once they have been written, there are
       inevitably some IO events that cannot be counted when a file is growing, particularly if the file is  be‐
       ing extended by a single thread writing beyond end-of-file (for example, the <b>dd</b> program).

       There is a further loss of events in that there is currently no way to atomically resize a <b>dmstats</b> region
       and preserve its current counter values. This affects files when they grow by extending the final extent,
       rather  than allocating a new extent: any events that had accumulated in the region between any prior op‐
       eration and the resize are lost.

       File mapping is currently most effective in cases where the majority of IO does not trigger extent  allo‐
       cation. Future updates may address these limitations when kernel support is available.

</pre><h4><b>REPORT</b> <b>FIELDS</b></h4><pre>
       The dmstats report provides several types of field that may be added to the default field set, or used to
       create custom reports.

       All performance counters and metrics are calculated per-area.

   <b>Derived</b> <b>metrics</b>
       A  number  of metrics fields are included that provide high level performance indicators. These are based
       on the fields provided by the conventional Linux iostat program and are derived from  the  basic  counter
       values provided by the kernel for each area.

       <b>reads_merged_per_sec</b>
              Reads merged per second.

       <b>writes_merged_per_sec</b>
              Writes merged per second.

       <b>reads_per_sec</b>
              Reads completed per second.

       <b>writes_per_sec</b>
              Writes completed per second.

       <b>read_size_per_sec</b>
              Size of data read per second.

       <b>write_size_per_sec</b>
              Size of data written per second.

       <b>avg_request_size</b>
              Average request size.

       <b>queue_size</b>
              Average queue size.

       <b>await</b>  The average wait time for read and write operations.

       <b>r_await</b>
              The average wait time for read operations.

       <b>w_await</b>
              The average wait time for write operations.

       <b>throughput</b>
              The device throughput in operations per second.

       <b>service_time</b>
              The average service time (in milliseconds) for operations issued to the device.

       <b>util</b>   Percentage  of CPU time during which I/O requests were issued to the device (bandwidth utilization
              for the device). Device saturation occurs when this value is close to 100%.

   <b>Group,</b> <b>region</b> <b>and</b> <b>area</b> <b>meta</b> <b>fields</b>
       Meta fields provide information about the groups, regions, or areas that the statistics values relate to.
       This includes the region and area identifier, start, length, and counts, as well as the  program  ID  and
       user data values.

       <b>region_id</b>
              Region  identifier. This is a non-negative integer returned by the kernel when a statistics region
              is created.

       <b>region_start</b>
              The region start location. Display units are selected by the <b>--units</b> option.

       <b>region_len</b>
              The length of the region. Display units are selected by the <b>--units</b> option.

       <b>area_id</b>
              Area identifier. Area identifiers are assigned by the device-mapper statistics library and unique‐
              ly identify each area within a region. Each ID corresponds to a distinct set of performance  coun‐
              ters  for that area of the statistics region. Area identifiers are always monotonically increasing
              within a region so that higher ID values correspond to greater sector addresses  within  the  area
              and no gaps in the sequence of identifiers exist.

       <b>area_start</b>
              The area start location. Display units are selected by the <b>--units</b> option.

       <b>area_len</b>
              The length of the area. Display units are selected by the <b>--units</b> option.

       <b>area_count</b>
              The number of areas in this region.

       <b>program_id</b>
              The program ID value associated with this region.

       <b>user_data</b>
              The user data value associated with this region.

       <b>group_id</b>
              Group identifier. This is a non-negative integer returned by the dmstats <b>group</b> command when a sta‐
              tistics group is created.

       <b>interval_ns</b>
              The  estimated  interval  over which the current counter values have accumulated. The value is re‐
              ported as an integer expressed in units of nanoseconds.

       <b>interval</b>
              The estimated interval over which the current counter values have accumulated. The  value  is  re‐
              ported as a real number in units of seconds.

   <b>Basic</b> <b>counters</b>
       Basic  counters provide access to the raw counter data from the kernel, allowing further processing to be
       carried out by another program.

       The kernel provides thirteen separate counters for each statistics area. The first eleven of these  match
       the counters provided in <a href="file:/proc/diskstats">/proc/diskstats</a> or <a href="file:/sys/block/">/sys/block/</a>*/*/stat. The final pair provide separate counters
       for read and write time.

       <b>read_count</b>
              Count of reads completed this interval.

       <b>reads_merged_count</b>
              Count of reads merged this interval.

       <b>read_sector_count</b>
              Count of 512 byte sectors read this interval.

       <b>read_time</b>
              Accumulated duration of all read requests (ns).

       <b>write_count</b>
              Count of writes completed this interval.

       <b>writes_merged_count</b>
              Count of writes merged this interval.

       <b>write_sector_count</b>
              Count of 512 byte sectors written this interval.

       <b>write_time</b>
              Accumulated duration of all write requests (ns).

       <b>in_progress_count</b>
              Count of requests currently in progress.

       <b>io_ticks</b>
              Nanoseconds spent servicing requests.

       <b>queue_ticks</b>
              This  field is incremented at each I/O start, I/O completion, I/O merge, or read of these stats by
              the number of I/Os in progress multiplied by the number of milliseconds spent doing I/O since  the
              last  update  of this field.  This can provide an easy measure of both I/O completion time and the
              backlog that may be accumulating.

       <b>read_ticks</b>
              Nanoseconds spent servicing reads.

       <b>write_ticks</b>
              Nanoseconds spent servicing writes.

   <b>Histogram</b> <b>fields</b>
       Histograms measure the frequency distribution of user specified  I/O  latency  intervals.  Histogram  bin
       boundaries are specified when a region is created.

       A  brief representation of the histogram values and latency intervals can be included in the report using
       these fields.

       <b>hist_count</b>
              A list of the histogram counts for the current statistics area in order of ascending latency  val‐
              ue. Each value represents the number of I/Os with latency times falling into that bin's time range
              during the sample period.

       <b>hist_count_bounds</b>
              A list of the histogram counts for the current statistics area in order of ascending latency value
              including bin boundaries: each count is prefixed by the lower bound of the corresponding histogram
              bin.

       <b>hist_count_ranges</b>
              A list of the histogram counts for the current statistics area in order of ascending latency value
              including  bin boundaries: each count is prefixed by both the lower and upper bounds of the corre‐
              sponding histogram bin.

       <b>hist_percent</b>
              A list of the relative histogram values for the current statistics area in order of ascending  la‐
              tency  value, expressed as a percentage. Each value represents the proportion of I/Os with latency
              times falling into that bin's time range during the sample period.

       <b>hist_percent_bounds</b>
              A list of the relative histogram values for the current statistics area in order of ascending  la‐
              tency  value,  expressed  as  a percentage and including bin boundaries. Each value represents the
              proportion of I/Os with latency times falling into that bin's time range during the sample  period
              and is prefixed with the corresponding bin's lower bound.

       <b>hist_percent_ranges</b>
              A  list of the relative histogram values for the current statistics area in order of ascending la‐
              tency value, expressed as a percentage and including bin boundaries.  Each  value  represents  the
              proportion  of I/Os with latency times falling into that bin's time range during the sample period
              and is prefixed with the corresponding bin's lower and upper bounds.

       <b>hist_bounds</b>
              A list of the histogram boundary values for the current statistics area in order of ascending  la‐
              tency  value.   The  values are expressed in whole units of seconds, milliseconds, microseconds or
              nanoseconds with a suffix indicating the unit.

       <b>hist_ranges</b>
              A list of the histogram bin ranges for the current statistics area in order of  ascending  latency
              value.   The  values  are  expressed as "LOWER-UPPER" in whole units of seconds, milliseconds, mi‐
              croseconds or nanoseconds with a suffix indicating the unit.

       <b>hist_bins</b>
              The number of latency histogram bins configured for the area.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Create a whole-device region with one area on vg00/lvol1
       # <b>dmstats</b> <b>create</b> <b>vg00/lvol1</b>
       vg00/lvol1: Created new region with 1 area(s) as region ID 0

       Create a 32 MiB region 1 GiB into device d0
       # <b>dmstats</b> <b>create</b> <b>--start</b> <b>1G</b> <b>--length</b> <b>32M</b> <b>d0</b>
       d0: Created new region with 1 area(s) as region ID 0

       Create a whole-device region with 8 areas on every device
       # <b>dmstats</b> <b>create</b> <b>--areas</b> <b>8</b>
       vg00-lvol1: Created new region with 8 area(s) as region ID 0
       vg00-lvol2: Created new region with 8 area(s) as region ID 0
       vg00-lvol3: Created new region with 8 area(s) as region ID 0
       vg01-lvol0: Created new region with 8 area(s) as region ID 2
       vg01-lvol1: Created new region with 8 area(s) as region ID 0
       vg00-lvol2: Created new region with 8 area(s) as region ID 1

       Delete all regions on all devices
       # <b>dmstats</b> <b>delete</b> <b>--alldevices</b> <b>--allregions</b>

       Create a whole-device region with areas 10 GiB in size on vg00/lvol1 using dmsetup
       # <b>dmsetup</b> <b>stats</b> <b>create</b> <b>--areasize</b> <b>10G</b> <b>vg00/lvol1</b>
       vg00-lvol1: Created new region with 5 area(s) as region ID 1

       Create a 1 GiB region with 16 areas at the start of vg00/lvol1
       # <b>dmstats</b> <b>create</b> <b>--start</b> <b>0</b> <b>--len</b> <b>1G</b> <b>--areas=16</b> <b>vg00/lvol1</b>
       vg00-lvol1: Created new region with 16 area(s) as region ID 0

       List the statistics regions registered on vg00/lvol1
       # <b>dmstats</b> <b>list</b> <b>vg00/lvol1</b>
       Name         RgID   RStart   RSize    #Areas   ASize    ProgID
       vg00-lvol1    0      0       61.00g     1      61.00g   dmstats
       vg00-lvol1    1     61.00g   19.20g     1      19.20g   dmstats
       vg00-lvol1    2     80.20g    2.14g     1       2.14g   dmstats

       Display five statistics reports for vg00/lvol1 at an interval of one second
       # <b>dmstats</b> <b>report</b> <b>--interval</b> <b>1</b> <b>--count</b> <b>5</b> <b>vg00/lvol1</b>
       # <b>dmstats</b> <b>report</b>
       Name           RgID ArID AStart ASize  RRqM/s WRqM/s R/s  W/s    RSz/s WSz/s   AvRqSz  QSize Util% AWait RdAWa WrAWa
       vg_hex-lv_home  0    0    0     61.00g  0.00   0.00  0.00 218.00   0     1.04m   4.50k 2.97  81.70 13.62 0.00  13.62
       vg_hex-lv_home  1    0   61.00g 19.20g  0.00   0.00  0.00   5.00   0   548.00k 109.50k 0.14  11.00 27.40 0.00  27.40
       vg_hex-lv_home  2    0   80.20g  2.14g  0.00   0.00  0.00  14.00   0     1.15m  84.00k 0.39  18.70 27.71 0.00  27.71

       Create one region for reach target contained in device vg00/lvol1
       # <b>dmstats</b> <b>create</b> <b>--segments</b> <b>vg00/lvol1</b>
       vg00-lvol1: Created new region with 1 area(s) as region ID 0
       vg00-lvol1: Created new region with 1 area(s) as region ID 1
       vg00-lvol1: Created new region with 1 area(s) as region ID 2

       Create regions mapping each file in the directory images/ and place them into separate groups, each named
       after the corresponding file.
       # <b>dmstats</b> <b>create</b> <b>--filemap</b> <b>images/*</b>
       images/vm1.qcow2: Created new group with 87 region(s) as group ID 0.
       images/vm1-1.qcow2: Created new group with 8 region(s) as group ID 87.
       images/vm2.qcow2: Created new group with 11 region(s) as group ID 95.
       images/vm2-1.qcow2: Created new group with 1454 region(s) as group ID 106.
       images/vm3.img: Created new group with 2 region(s) as group ID 1560.

       Print raw counters for region 4 on device d0
       # <b>dmstats</b> <b>print</b> <b>--regionid</b> <b>4</b> <b>d0</b>
       2097152+65536 0 0 0 0 29 0 264 701 0 41 701 0 41

</pre><h4><b>AUTHORS</b></h4><pre>
       Bryn M. Reeves &lt;<a href="mailto:bmr@redhat.com">bmr@redhat.com</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/dmsetup.8.html">dmsetup</a></b>(8)

       LVM2 resource page: https://www.sourceware.org/lvm2
       Device-mapper resource page: <a href="http://www.sourceware.org/dm">http://www.sourceware.org/dm</a>

       Device-mapper statistics kernel documentation
       <u>Documentation/device-mapper/statistics.txt</u>

Linux                                              Jun 23 2016                                        <u><a href="../man8/DMSTATS.8.html">DMSTATS</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>