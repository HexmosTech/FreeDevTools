<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rbdmap - map RBD devices at boot time</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/ceph-common">ceph-common_19.2.1-0ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       rbdmap - map RBD devices at boot time

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>rbdmap</b> <b>map</b>
       <b>rbdmap</b> <b>unmap</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>rbdmap</b>  is a shell script that automates <b>rbd</b> <b>map</b> and <b>rbd</b> <b>unmap</b> operations on one or more RBD (RADOS Block
       Device) images. While the script can be run manually  by  the  system  administrator  at  any  time,  the
       principal  use case is automatic mapping/mounting of RBD images at boot time (and unmounting/unmapping at
       shutdown), as triggered by the init system (a systemd unit file,  <b>rbdmap.service</b>  is  included  with  the
       ceph-common package for this purpose).

       The  script  takes  a  single argument, which can be either "map" or "unmap".  In either case, the script
       parses a configuration file (defaults to <b>/etc/ceph/rbdmap</b>, but  can  be  overridden  via  an  environment
       variable  <b>RBDMAPFILE</b>).  Each  line  of  the configuration file corresponds to an RBD image which is to be
       mapped, or unmapped.

       The configuration file format is:

          IMAGESPEC RBDOPTS

       where <b>IMAGESPEC</b> should be specified as <b>POOLNAME/IMAGENAME</b> (the pool name, a forward slash, and the  image
       name),  or merely <b>IMAGENAME</b>, in which case the <b>POOLNAME</b> defaults to "rbd". <b>RBDOPTS</b> is an optional list of
       parameters to be passed to the underlying <b>rbd</b> <b>map</b> command. These parameters and their  values  should  be
       specified as a comma-separated string:

          PARAM1=VAL1,PARAM2=VAL2,...,PARAMN=VALN

       This will cause the script to issue an <b>rbd</b> <b>map</b> command like the following:

          rbd map POOLNAME/IMAGENAME --PARAM1 VAL1 --PARAM2 VAL2

       (See  the  <b>rbd</b>  manpage  for  a  full list of possible options.)  For parameters and values which contain
       commas or equality signs, a simple apostrophe can be used to prevent replacing them.

       When run as <b>rbdmap</b> <b>map</b>, the script parses the configuration  file,  and  for  each  RBD  image  specified
       attempts to first map the image (using the <b>rbd</b> <b>map</b> command) and, second, to mount the image.

       When run as <b>rbdmap</b> <b>unmap</b>, images listed in the configuration file will be unmounted and unmapped.

       <b>rbdmap</b>  <b>unmap-all</b>  attempts to unmount and subsequently unmap all currently mapped RBD images, regardless
       of whether or not they are listed in the configuration file.

       If successful, the <b>rbd</b> <b>map</b> operation maps the image to a <b>/dev/rbdX</b> device, at which point a udev rule  is
       triggered  to  create  a  friendly device name symlink, <b>/dev/rbd/POOLNAME/IMAGENAME</b>, pointing to the real
       mapped device.

       In order for mounting/unmounting to succeed, the friendly device name must have a corresponding entry  in
       <b><a href="file:/etc/fstab">/etc/fstab</a></b>.

       When  writing  <b><a href="file:/etc/fstab">/etc/fstab</a></b>  entries for RBD images, it's a good idea to specify the "noauto" (or "nofail")
       mount option. This prevents the init system from trying to mount the device too early - before the device
       in question even exists. (Since <b>rbdmap.service</b> executes a shell script, it is typically  triggered  quite
       late in the boot sequence.)

</pre><h4><b>EXAMPLES</b></h4><pre>
       Example  <b>/etc/ceph/rbdmap</b>  for  three  RBD  images  called  "bar1",  "bar2" and "bar3", which are in pool
       "foopool":

          foopool/bar1    id=admin,keyring=/etc/ceph/ceph.client.admin.keyring
          foopool/bar2    id=admin,keyring=/etc/ceph/ceph.client.admin.keyring
          foopool/bar3    id=admin,keyring=/etc/ceph/ceph.client.admin.keyring,options='lock_on_read,queue_depth=1024'

       Each line in the file contains two strings: the image spec and the options to be passed to <b>rbd</b> <b>map</b>. These
       two lines get transformed into the following commands:

          rbd map foopool/bar1 --id admin --keyring /etc/ceph/ceph.client.admin.keyring
          rbd map foopool/bar2 --id admin --keyring /etc/ceph/ceph.client.admin.keyring
          rbd map foopool/bar2 --id admin --keyring /etc/ceph/ceph.client.admin.keyring --options lock_on_read,queue_depth=1024

       If the images had XFS file systems on them, the corresponding <b><a href="file:/etc/fstab">/etc/fstab</a></b> entries might look like this:

          /dev/rbd/foopool/bar1 /mnt/bar1 xfs noauto 0 0
          /dev/rbd/foopool/bar2 /mnt/bar2 xfs noauto 0 0
          /dev/rbd/foopool/bar3 /mnt/bar3 xfs noauto 0 0

       After creating the images and populating the <b>/etc/ceph/rbdmap</b> file, making the images  get  automatically
       mapped and mounted at boot is just a matter of enabling that unit:

          systemctl enable rbdmap.service

</pre><h4><b>OPTIONS</b></h4><pre>
       None

</pre><h4><b>AVAILABILITY</b></h4><pre>
       <b>rbdmap</b>  is  part  of Ceph, a massively scalable, open-source, distributed storage system. Please refer to
       the Ceph documentation at <u>https://docs.ceph.com</u> for more information.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man8/rbd.8.html">rbd</a></u>(8),

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2010-2014, Inktank Storage, Inc. and contributors. Licensed  under  Creative  Commons  Attribution  Share
       Alike 3.0 (CC-BY-SA-3.0)

dev                                               May 22, 2025                                         <u><a href="../man8/RBDMAP.8.html">RBDMAP</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>