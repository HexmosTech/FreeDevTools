<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ext_time_quota_acl - Squid time quota external acl helper.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/squid">squid_6.13-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ext_time_quota_acl - Squid time quota external acl helper.

       Version 1.0

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>ext_time_quota_acl</b> <b>[-b</b> <b>database]</b> <b>[-d]</b> <b>[-p</b> <b>pauselen]</b> <b>[-h]</b> <b>configfile</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>ext_time_quota_acl</b>  allows  an  administrator  to define time budgets for the users of squid to limit the
       time using squid.

       This is useful for corporate lunch time allocations, wifi  portal  pay-per-minute  installations  or  for
       parental  control  of children. The administrator can define a time budget (e.g. 1 hour per day) which is
       enforced through this helper.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-b</b> <b>database</b>
              <b>Filename</b> of persistent database. This defaults to ext_time_quota.db in Squids state directory.

       <b>-p</b> <b>pauselen</b>
              <b>Pauselen</b> is given in seconds and defines the period between two requests to be treated as part  of
              the  same  session.  Pauses shorter than this value will be counted against the quota, longer ones
              ignored.  Default is 300 seconds (5 minutes).

       <b>-d</b>     Enables debug logging to stderr.

       <b>-h</b>     show a short command line help.

       <b>configfile</b>
              This file contains the definition of the time budgets for the users.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       The time quotas of the users are defined in a text file typically residing in /etc/squid/time_quota.  Any
       line starting with "#" contains a comment and is ignored. Every line must start with a user followed by a
       time budget and a corresponding time period separated by "/". Here is an example file:

              # user budget / period
              <b>john</b> <b>8h</b> <b>/</b> <b>1d</b>
              <b>littlejoe</b> <b>1h</b> <b>/</b> <b>1d</b>
              <b>babymary</b> <b>30m</b> <b>/</b> <b>1w</b>

       John  has a time budget of 8 hours every day, littlejoe is only allowed 1 hour and the poor babymary only
       30 minutes a week.

       You can use "s" for seconds, "m" for minutes, "h" for hours, "d" for days and "w"  for  weeks.  Numerical
       values can be given as integer values or with a fraction. E.g. "0.5h" means 30 minutes.

       This  helper is configured in <b>squid.conf</b> using the <b>external_acl_type</b> directive then access controls which
       use it to allow or deny.

       Here is an example.

              # Ensure that users have a valid login. We need their username.
              <b>acl</b> <b>users</b> <b>proxy_auth</b> <b>REQUIRED</b>
              <b>http_access</b> <b>deny</b> <b>!users</b>
              # Define program and quota file
              <b>external_acl_type</b>  <b>time_quota</b>   <b>ttl=60</b>   <b>children-max=1</b>   <b>%LOGIN</b>   <b>/usr/libexec/ext_time_quota_acl</b>
              <b>/etc/squid/time_quota</b>
              <b>acl</b> <b>noquota</b> <b>src</b> <b>all</b>
              <b>acl</b> <b>time_quota</b> <b>external</b> <b>time_quota</b>
              <b>deny_info</b> <b>ERR_ACL_TIME_QUOTA_EXCEEDED</b> <b>noquota</b>
              <b>http_access</b> <b>deny</b> <b>!time_quota</b> <b>noquota</b>

       In  this  example, after restarting Squid it should allow access only for users as long as they have time
       budget left.  If the budget is exceeded the user will be presented with an error page informing them.

       In this example we use separate <b>users</b> access control and <b>noquota</b> ACL in order to keep  the  username  and
       password prompt and the quota-exceeded messages separated.

       User  is  just  a  unique  key  value.  The  above  example  uses  %LOGIN and the username but any of the
       <b>external_acl_type</b> format tags can be substituted in its place.  <b>%EXT_TAG</b> , <b>%LOGIN</b> , <b>%IDENT</b> , <b>%EXT_USER</b>  ,
       <b>%SRC</b> , <b>%SRCEUI48</b> , and <b>%SRCEUI64</b> are all likely candidates for client identification.  The Squid wiki has
       more examples at https://wiki.squid-cache.org/ConfigExamples.

</pre><h4><b>LIMITATIONS</b></h4><pre>
       This  helper only controls access to the Internet through HTTP. It does not control other protocols, like
       VOIP, ICQ, IRC, FTP, IMAP, SMTP or SSH.

       Desktop browsers are typically able to deal with authentication to HTTP proxies like <b>squid</b>  <b>.</b>   But  more
       and  more  different  programs  and  devices  (smartphones,  games  on mobile devices, ...) are using the
       Internet over HTTP. These devices are often not able to work  through  an  authenticating  proxy.   Means
       other than %LOGIN authentication are required to authorize these devices and software.

       A  more  general  control  to  Internet  access  could  be  a captive portal approach (such as pfSense or
       ChilliSpot) using %SRC, %SRCEUI48 and %SRCEUI64 as keys or maybe a 802.11X solution. But  the  latter  is
       often not supported by mobile devices.

</pre><h4><b>IMPLEMENTATION</b></h4><pre>
       When  the  helper  is  called it will be asked if the current user is allowed to access squid. The helper
       will reduce the remaining time budget of this user and return <b>OK</b> if there is budget  left.  Otherwise  it
       will return <b>ERR</b> <b>.</b>

       The <b>ttl=N</b> parameter in <b>squid.conf</b> determines how often the helper will be called, the example config uses
       a  1  minute  TTL.   The interaction is that Squid will only call the helper on new requests <b>if</b> there has
       been more than TTL seconds passed since last check.  This handling creates an amount of slippage  outside
       the  quota  by  whatever amount is configured.  TTL can be set as short as desired, down to and including
       zero.  Though values of 1 or more are recommended due to a quota resolution of one second.

       If the configured time period (e.g. "1w" for babymary) is over, the time budget will be restored  to  the
       configured value thus allowing the user to access squid with a fresh budget.

       If  the  time  between  the  current request and the previous request is greater than <b>pauselen</b> (default 5
       minutes and adjustable with command line parameter <b>-p</b> ), the current request will be considered as a  new
       request and the time budget will not be decreased. If the time is less than <b>pauselen</b> , then both requests
       will  be  considered  as part of the same active time period and the time budget will be decreased by the
       time difference. This allows the user to take arbitrary breaks  during  Internet  access  without  losing
       their time budget.

</pre><h4><b>FURTHER</b> <b>IDEAS</b></h4><pre>
       The  following  ideas  could  further  improve  this  helper. Maybe someone wants to help? Any support or
       feedback is welcome!

       There should be a way for a user to see their configured and remaining
              time budget. This could be realized by implementing a web  page  accessing  the  database  of  the
              helper showing the corresponding data. One of the problems to be solved is user authentication.

       We could always return "OK" and use the module simply as an Internet
              usage tracker showing who has stayed how long in the WWW.

</pre><h4><b>AUTHOR</b></h4><pre>
       This program and documentation was written by <u>Dr.</u> <u>Tilmann</u> <u>Bubeck</u> <u>&lt;<a href="mailto:t.bubeck@reinform.de">t.bubeck@reinform.de</a>&gt;</u>

</pre><h4><b>COPYRIGHT</b></h4><pre>
        * Copyright (C) 1996-2024 The Squid Software Foundation and contributors
        *
        * Squid software is distributed under GPLv2+ license and includes
        * contributions from numerous individuals and organizations.
        * Please see the COPYING and CONTRIBUTORS files for details.

       This program and documentation is copyright to the authors named above.

       Distributed under the GNU General Public License (GNU GPL) version 2 or later (GPLv2+).

</pre><h4><b>QUESTIONS</b></h4><pre>
       Questions  on  the  usage  of  this  program  can  be  sent  to  the  <u>Squid</u>  <u>Users</u>  <u>mailing</u>  <u>list</u> &lt;squid-
       <a href="mailto:users@lists.squid-cache.org">users@lists.squid-cache.org</a>&gt;

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Bug reports need to be  made  in  English.   See  https://wiki.squid-cache.org/SquidFaq/BugReporting  for
       details of what you need to include with your bug report.

       Report bugs or bug fixes using https://bugs.squid-cache.org/

       Report serious security bugs to <u>Squid</u> <u>Bugs</u> <u>&lt;<a href="mailto:squid-bugs@lists.squid-cache.org">squid-bugs@lists.squid-cache.org</a>&gt;</u>

       Report ideas for new improvements to the <u>Squid</u> <u>Developers</u> <u>mailing</u> <u>list</u> &lt;<a href="mailto:squid-dev@lists.squid-cache.org">squid-dev@lists.squid-cache.org</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/squid.8.html">squid</a></b>(8), <b><a href="../man7/GPL.7.html">GPL</a></b>(7),
       The Squid FAQ wiki https://wiki.squid-cache.org/SquidFaq
       The Squid Configuration Manual <a href="http://www.squid-cache.org/Doc/config/">http://www.squid-cache.org/Doc/config/</a>

                                                  22 March 2011                            <u><a href="../man8/ext_time_quota_acl.8.html">ext_time_quota_acl</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>