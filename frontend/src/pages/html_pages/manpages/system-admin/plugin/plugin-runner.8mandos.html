<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>plugin-runner - Run Mandos plugins, pass data from first to succeed.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/mandos-client">mandos-client_1.8.19-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       plugin-runner - Run Mandos plugins, pass data from first to succeed.

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>plugin-runner</b> [<b>--global-env=</b><u>ENV</u><b>=</b><u>value</u> | <b>-G</b> <u>ENV</u><b>=</b><u>value</u> ...]
                     [<b>--env-for=</b><u>PLUGIN</u><b>:</b><u>ENV</u><b>=</b><u>value</u> | <b>-E</b> <u>PLUGIN</u><b>:</b><u>ENV</u><b>=</b><u>value</u> ...]
                     [<b>--global-options=</b><u>OPTIONS</u> | <b>-g</b> <u>OPTIONS</u> ...]
                     [<b>--options-for=</b><u>PLUGIN</u><b>:</b><u>OPTIONS</u> | <b>-o</b> <u>PLUGIN</u><b>:</b><u>OPTIONS</u> ...]
                     [<b>--disable=</b><u>PLUGIN</u> | <b>-d</b> <u>PLUGIN</u> ...]
                     [<b>--enable=</b><u>PLUGIN</u> | <b>-e</b> <u>PLUGIN</u> ...]
                     [<b>--groupid=</b><u>ID</u>]
                     [<b>--userid=</b><u>ID</u>]
                     [<b>--plugin-dir=</b><u>DIRECTORY</u>]
                     [<b>--plugin-helper-dir=</b><u>DIRECTORY</u>]
                     [<b>--config-file=</b><u>FILE</u>]
                     [<b>--debug</b>]

       <b>plugin-runner</b> {<b>--help</b> | <b>-?</b>}

       <b>plugin-runner</b> <b>--usage</b>

       <b>plugin-runner</b> {<b>--version</b> | <b>-V</b>}

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>plugin-runner</b> is a program which is meant to be specified as a “keyscript” for the root disk in
       <b><a href="../man5/crypttab.5.html">crypttab</a></b>(5). The aim of this program is therefore to output a password, which then <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8) will use
       to unlock the root disk.

       This program is not meant to be invoked directly, but can be in order to test it. Note that any password
       obtained will simply be output on standard output.

</pre><h4><b>PURPOSE</b></h4><pre>
       The purpose of this is to enable <u>remote</u> <u>and</u> <u>unattended</u> <u>rebooting</u> of client host computer with an
       <u>encrypted</u> <u>root</u> <u>file</u> <u>system</u>. See the section called “OVERVIEW” for details.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--global-env</b> <u>ENV</u><b>=</b><u>value</u>, <b>-G</b> <u>ENV</u><b>=</b><u>value</u>
           This option will add an environment variable setting to all plugins. This will override any inherited
           environment variable.

       <b>--env-for</b> <u>PLUGIN</u><b>:</b><u>ENV</u><b>=</b><u>value</u>, <b>-E</b> <u>PLUGIN</u><b>:</b><u>ENV</u><b>=</b><u>value</u>
           This option will add an environment variable setting to the <u>PLUGIN</u> plugin. This will override any
           inherited environment variables or environment variables specified using <b>--global-env</b>.

       <b>--global-options</b> <u>OPTIONS</u>, <b>-g</b> <u>OPTIONS</u>
           Pass some options to <u>all</u> plugins.  <u>OPTIONS</u> is a comma separated list of options. This is not a very
           useful option, except for specifying the “<b>--debug</b>” option to all plugins.

       <b>--options-for</b> <u>PLUGIN</u><b>:</b><u>OPTION</u>, <b>-o</b> <u>PLUGIN</u><b>:</b><u>OPTION</u>
           Pass some options to a specific plugin.  <u>PLUGIN</u> is the name (file basename) of a plugin, and <u>OPTIONS</u>
           is a comma separated list of options.

           Note that since options are not split on whitespace, the way to pass, to the plugin “foo”, the option
           <b>--bar</b> with the option argument “baz” is either <b>--options-for=foo:--bar=baz</b> or
           <b>--options-for=foo:--bar,baz</b>. Using <b>--options-for="foo:--bar</b> <b>baz"</b>. will <u>not</u> work.

       <b>--disable</b> <u>PLUGIN</u>, <b>-d</b> <u>PLUGIN</u>
           Disable the plugin named <u>PLUGIN</u>. The plugin will not be started.

       <b>--enable</b> <u>PLUGIN</u>, <b>-e</b> <u>PLUGIN</u>
           Re-enable the plugin named <u>PLUGIN</u>. This is only useful to undo a previous <b>--disable</b> option, maybe
           from the configuration file.

       <b>--groupid</b> <u>ID</u>
           Change to group ID <u>ID</u> on startup. The default is 65534. All plugins will be started using this group
           ID.  <u>Note:</u> This must be a number, not a name.

       <b>--userid</b> <u>ID</u>
           Change to user ID <u>ID</u> on startup. The default is 65534. All plugins will be started using this user
           ID.  <u>Note:</u> This must be a number, not a name.

       <b>--plugin-dir</b> <u>DIRECTORY</u>
           Specify a different plugin directory. The default is /lib/mandos/plugins.d, which will exist in the
           initial RAM disk environment.

       <b>--plugin-helper-dir</b> <u>DIRECTORY</u>
           Specify a different plugin helper directory. The default is /lib/mandos/plugin-helpers, which will
           exist in the initial RAM disk environment. (This will simply be passed to all plugins via the
           <b>MANDOSPLUGINHELPERDIR</b> environment variable. See the section called “WRITING PLUGINS”)

       <b>--config-file</b> <u>FILE</u>
           Specify a different file to read additional options from. See the section called “FILES”. Other
           command line options will override options specified in the file.

       <b>--debug</b>
           Enable debug mode. This will enable a lot of output to standard error about what the program is
           doing. The program will still perform all other functions normally. The default is to <u>not</u> run in
           debug mode.

           The plugins will <u>not</u> be affected by this option. Use <b>--global-options=--debug</b> if complete debugging
           eruption is desired.

       <b>--help</b>, <b>-?</b>
           Gives a help message about options and their meanings.

       <b>--usage</b>
           Gives a short usage message.

       <b>--version</b>, <b>-V</b>
           Prints the program version.

</pre><h4><b>OVERVIEW</b></h4><pre>
       This is part of the Mandos system for allowing computers to have encrypted root file systems and at the
       same time be capable of remote and/or unattended reboots. The computers run a small client program in the
       initial RAM disk environment which will communicate with a server over a network. All network
       communication is encrypted using TLS. The clients are identified by the server using a TLS key; each
       client has one unique to it. The server sends the clients an encrypted password. The encrypted password
       is decrypted by the clients using a separate OpenPGP key, and the password is then used to unlock the
       root file system, whereupon the computers can continue booting normally.

       This program will run on the client side in the initial RAM disk environment, and is responsible for
       getting a password. It does this by running plugins, one of which will normally be the actual client
       program communicating with the server.

</pre><h4><b>PLUGINS</b></h4><pre>
       This program will get a password by running a number of plugins, which are executable programs in a
       directory in the initial RAM disk environment. The default directory is /lib/mandos/plugins.d, but this
       can be changed with the <b>--plugin-dir</b> option. The plugins are started in parallel, and the first plugin to
       output a password <u>and</u> exit with a successful exit code will make this plugin-runner output the password
       from that plugin, stop any other plugins, and exit.

   <b>WRITING</b> <b>PLUGINS</b>
       A plugin is an executable program which prints a password to its standard output and then exits with a
       successful (zero) exit status. If the exit status is not zero, any output on standard output will be
       ignored by the plugin runner. Any output on its standard error channel will simply be passed to the
       standard error of the plugin runner, usually the system console.

       If the password is a single-line, manually entered passprase, a final trailing newline character should
       <u>not</u> be printed.

       The plugin will run in the initial RAM disk environment, so care must be taken not to depend on any files
       or running services not available there. Any helper executables required by the plugin (which are not in
       the <b>PATH</b>) can be placed in the plugin helper directory, the name of which will be made available to the
       plugin via the <b>MANDOSPLUGINHELPERDIR</b> environment variable.

       The plugin must exit cleanly and free all allocated resources upon getting the TERM signal, since this is
       what the plugin runner uses to stop all other plugins when one plugin has output a password and exited
       cleanly.

       The plugin must not use resources, like for instance reading from the standard input, without knowing
       that no other plugin is also using it.

       It is useful, but not required, for the plugin to take the <b>--debug</b> option.

</pre><h4><b>FALLBACK</b></h4><pre>
       If no plugins succeed, this program will, as a fallback, ask for a password on the console using
       <b><a href="../man3/getpass.3.html">getpass</a></b>(3), and output it. This is not meant to be the normal mode of operation, as there is a separate
       plugin for getting a password from the console.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       Exit status of this program is zero if no errors were encountered, and otherwise not. The fallback (see
       the section called “FALLBACK”) may or may not have succeeded in either case.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       This program does not use any environment variables itself, it only passes on its environment to all the
       plugins. The environment passed to plugins can be modified using the <b>--global-env</b> and <b>--env-for</b> options.
       Also, the <b>--plugin-helper-dir</b> option will affect the environment variable <b>MANDOSPLUGINHELPERDIR</b> for the
       plugins.

</pre><h4><b>FILES</b></h4><pre>
       /conf/conf.d/mandos/plugin-runner.conf
           Since this program will be run as a keyscript, there is little to no opportunity to pass command line
           arguments to it. Therefore, it will <u>also</u> read this file and use its contents as whitespace-separated
           command line options. Also, everything from a “#” character to the end of a line is ignored.

           This program is meant to run in the initial RAM disk environment, so that is where this file is
           assumed to exist. The file does not need to exist in the normal file system.

           This file will be processed <u>before</u> the normal command line options, so the latter can override the
           former, if need be.

           This file name is the default; the file to read for arguments can be changed using the <b>--config-file</b>
           option.

       /lib/mandos/plugins.d
           The default plugin directory; can be changed by the <b>--plugin-dir</b> option.

       /lib/mandos/plugin-helpers
           The default plugin helper directory; can be changed by the <b>--plugin-helper-dir</b> option.

</pre><h4><b>BUGS</b></h4><pre>
       The <b>--config-file</b> option is ignored when specified from within a configuration file.

       Please report bugs to the Mandos development mailing list: &lt;<a href="mailto:mandos-dev@recompile.se">mandos-dev@recompile.se</a>&gt; (subscription
       required). Note that this list is public. The developers can be reached privately at
       &lt;<a href="mailto:mandos@recompile.se">mandos@recompile.se</a>&gt; (OpenPGP key fingerprint 153A 37F1 0BBA 0435 987F 2C4A 7223 2973 CA34 C2C4 for
       encrypted mail).

</pre><h4><b>EXAMPLE</b></h4><pre>
       Normal invocation needs no options:

       <b>plugin-runner</b>

       Run the program, but not the plugins, in debug mode:

       <b>plugin-runner</b> <b>--debug</b>

       Run all plugins, but run the “foo” plugin in debug mode:

       <b>plugin-runner</b> <b>--options-for=foo:--debug</b>

       Run all plugins, but not the program, in debug mode:

       <b>plugin-runner</b> <b>--global-options=--debug</b>

       Read a different configuration file, run plugins from a different directory, specify an alternate plugin
       helper directory and add four options to the <b><a href="../man8mandos/mandos-client.8mandos.html">mandos-client</a></b>(8mandos) plugin:

       <b>cd</b> <b>/etc/keys/mandos;</b> <b>plugin-runner</b> <b>--config-file=/etc/mandos/plugin-runner.conf</b> <b>--plugin-dir</b>
       <b>/usr/lib/x86_64-linux-gnu/mandos/plugins.d</b> <b>--plugin-helper-dir</b>
       <b>/usr/lib/x86_64-linux-gnu/mandos/plugin-helpers</b> <b>--options-for=mandos-client:--pubkey=pubkey.txt,</b>
       <b>--seckey=seckey.txt,--tls-pubkey=tls-pubkey.pem,--tls-privkey=tls-privkey.pem</b>

</pre><h4><b>SECURITY</b></h4><pre>
       This program will, when starting, try to switch to another user. If it is started as root, it will
       succeed, and will by default switch to user and group 65534, which are assumed to be non-privileged. This
       user and group is then what all plugins will be started as. Therefore, the only way to run a plugin as a
       privileged user is to have the set-user-ID or set-group-ID bit set on the plugin executable file (see
       <b><a href="../man2/execve.2.html">execve</a></b>(2)).

       If this program is used as a keyscript in <b><a href="../man5/crypttab.5.html">crypttab</a></b>(5), there is a slight risk that if this program fails
       to work, there might be no way to boot the system except for booting from another media and editing the
       initial RAM disk image to not run this program. This is, however, unlikely, since the <b><a href="../man8mandos/passwordprompt.8mandos.html">password-</a></b>
       <b><a href="../man8mandos/passwordprompt.8mandos.html">prompt</a></b>(8mandos) plugin will read a password from the console in case of failure of the other plugins, and
       this plugin runner will also, in case of catastrophic failure, itself fall back to asking and outputting
       a password on the console (see the section called “FALLBACK”).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8mandos/intro.8mandos.html">intro</a></b>(8mandos), <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8), <b><a href="../man5/crypttab.5.html">crypttab</a></b>(5), <b><a href="../man2/execve.2.html">execve</a></b>(2), <b><a href="../man8/mandos.8.html">mandos</a></b>(8), <b><a href="../man8mandos/password-prompt.8mandos.html">password-prompt</a></b>(8mandos), <b><a href="../man8mandos/mandosclient.8mandos.html">mandos-</a></b>
       <b><a href="../man8mandos/mandosclient.8mandos.html">client</a></b>(8mandos)

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright © 2008-2024 Teddy Hogeborn, Björn Påhlsson

       This manual page is part of Mandos.

       Mandos is free software: you can redistribute it and/or modify it under the terms of the GNU General
       Public License as published by the Free Software Foundation, either version 3 of the License, or (at your
       option) any later version.

       Mandos is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the
       implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
       License for more details.

       You should have received a copy of the GNU General Public License along with Mandos. If not, see
       <b><a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a></b>.

Mandos 1.8.19                                      2025-06-27                             <u><a href="../man8mandos/PLUGIN-RUNNER.8mandos.html">PLUGIN-RUNNER</a></u>(8mandos)
</pre>
 </div>
</div></section>
</div>
</body>
</html>