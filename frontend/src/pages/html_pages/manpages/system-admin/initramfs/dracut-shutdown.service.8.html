<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dracut-shutdown.service - unpack the initramfs to /run/initramfs</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/dracut-core">dracut-core_107-1ubuntu5_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       dracut-shutdown.service - unpack the initramfs to <a href="file:/run/initramfs">/run/initramfs</a>

</pre><h4><b>SYNOPSIS</b></h4><pre>
       dracut-shutdown.service

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This service unpacks the initramfs image to /run/initramfs. systemd pivots into <a href="file:/run/initramfs">/run/initramfs</a> at
       shutdown, so the root filesystem can be safely unmounted.

       The following steps are executed during a shutdown:

       •   The system starts to shut down

       •   ``$prefix/lib/systemd/system/sysinit.target.wants/dracut-shutdown.service`` gets its ``ExecStop``
           target triggered.

       •   ``dracut-shutdown.service`` executes ``/usr/lib/dracut/dracut-initramfs-restore`` which unpacks the
           initramfs to ``<a href="file:/run/initramfs">/run/initramfs</a>``

       •   systemd kills all processes

       •   systemd tries to unmount everything and mounts the remaining read-only

       •   systemd checks if there is a ``/run/initramfs/shutdown`` executable

       •   if yes, it does a pivot_root to ``<a href="file:/run/initramfs">/run/initramfs</a>`` and executes ``./shutdown``. The old root is then
           mounted on ``/oldroot``. ``/usr/lib/dracut/modules.d/99shutdown/shutdown.sh`` is the shutdown
           executable.

       •   shutdown will try to unmount every ``/oldroot`` mount and calls the various shutdown hooks from the
           dracut modules

       This ensures, that all devices are disassembled and unmounted cleanly.

       To debug the shutdown process, you can get a shell in the shutdown procedure by injecting
       "rd.break=pre-shutdown rd.shell" or "rd.break=shutdown rd.shell".

           # mkdir -p /run/initramfs/etc/cmdline.d
           # echo "rd.break=pre-shutdown rd.shell" &gt; /run/initramfs/etc/cmdline.d/debug.conf
           # touch /run/initramfs/.need_shutdown

       In case the unpack of the initramfs fails, dracut-shutdown-onfailure.service executes to make sure switch
       root doesn’t happen, since it would result in switching to an incomplete initramfs.

</pre><h4><b>AUTHORS</b></h4><pre>
       Harald Hoyer

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/dracut.8.html">dracut</a></b>(8)

dracut                                             07/08/2025                               <u><a href="../man8/DRACUT-SHUTDOWN.S.8.html">DRACUT-SHUTDOWN.S</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>