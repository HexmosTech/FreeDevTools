<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mktirfs - tool for creating a tiny-initramfs image</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/tiny-initramfs-core">tiny-initramfs-core_0.1-6.1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mktirfs - tool for creating a tiny-initramfs image

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>mktirfs</b> -o outputfile [options] [kernel-version]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>mktirfs</b>  script  generates an initramfs image that contains the tiny-initramfs <u>init</u> binary. Invoking
       <b>mktirfs</b> is meant for expert users that want to have greater control over their initramfs image. Typically
       it would be called from <b>update-tirfs</b>.

       Images created with this utility are designed to be very small and fast, and thus  ideal  for  use  cases
       where  the  amount  of  space  available  in  the boot loader is very low. If no modules and no microcode
       updates are included in the image, it will be less than 16 kiB in size. This comes at the cost of runtime
       flexibility and supported features of the generated images.  It  is  not  meant  to  replace  traditional
       initramfs  implementations  (such  as  <u>dracut</u> or <u>initramfs-tools</u>) in the generic case, but provide a lean
       alternative for common use cases.

       Please read <u>/usr/share/doc/tiny-initramfs-core/README.md</u> for an overview of the use cases it was designed
       for and the features it supports.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-o</b>, <b>--output=</b><u>imagefile</u>
              Where to store the resulting initramfs image. This option must be specified.

       <b>-m</b>, <b>--auto-modules=</b><u>yes/no</u>
              Whether to try to automatically detect which modules are required to mount the  /  and  <a href="file:/usr">/usr</a>  file
              systems and include them in the resulting initramfs image.

              Defaults to <u>yes</u>.

       <b>--include-modules=</b><u>mod1,mod2,...</u>
              Which  modules  to  directly  add  to  the  initramfs  image,  regardless  of  the setting for <b>-m</b>.
              Dependencies of the modules will be resolved by <b>mktirfs</b>. This option is  useful  if  the  required
              modules are not properly detected or one wants to create an image for a different computer.

              By default this list is empty.

       <b>-M</b>, <b>--microcode=</b><u>generic/yes/no</u>
              Whether  to prepend CPU microcode updates (if installed) to the initramfs image. Microcode updates
              may be prepended to the initramfs, and the kernel will automatically load them at boot time. (This
              requires   the   <b>CONFIG_MICROCODE_EARLY</b>    kernel    option    in    conjunction    with    either
              <b>CONFIG_MICROCODE_INTEL</b>  or  <b>CONFIG_MICROCODE_AMD</b>  compiled into the kernel.) The microcode updates
              can be found in the (non-free) packages <u>intel-microcode</u> and <u>amd64-microcode</u> packages.

              If the <u>generic</u> setting is specified,  all  installed  microcode  updates  will  be  added  to  the
              initramfs image; if <u>yes</u> is specified only the update for the processor on which <b>mktirfs</b> was run on
              will be included.

              Microcode  updates  not  being installed (or no microcode updates for the specific processor being
              available) is not considered to be an error and <b>mktirfs</b> will proceed regardless.

              Defaults to <u>yes</u>. Is only supported on x86 processors and will be ignored otherwise.

       <b>-d</b>, <b>--debug=</b><u>yes/no</u>
              If set to <u>yes</u>, this option will install a (larger) version of the <u>init</u> binary into  the  initramfs
              image  that prints additional debug messages while booting, and waits 5 seconds after mounting the
              root file system before handing control over  to  the  system's  <u>init</u>  process.  This  allows  the
              administrator to debug boot problems with initramfs images.

              Defaults to <u>no</u>.

       <u>kernel-version</u>
              The kernel version for which to generate the initramfs image. This is only relevant if modules are
              to  be added (either automatically or manually) to the initramfs image. If no modules are included
              in the initramfs image, the resulting image may be used with  any  kernel  that  has  the  drivers
              required to mount the root filesystem built in.

              By default the version returned by <u>uname</u> <u>-r</u> is used.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       Except  for  <b>-o</b>  and the kernel version, defaults for all the options may be specified in a configuration
       file <u>/etc/tiny-initramfs/tiny-initramfs.conf</u>.  This file does  not  exist  by  default,  but  an  example
       version may be found in <u>/usr/share/doc/tiny-initramfs-core/tiny-initramfs.conf.example</u>.

       Any settings that <b>update-tirfs</b> is to use when calling <b>mktirfs</b> should be set in that configuration file.

</pre><h4><b>HOOKS</b></h4><pre>
       There  are  no  hooks  within  the  initramfs itself, the <u>init</u> binary is a very small statically linked C
       program.

       However <b>mktirfs</b> supports hooks when it comes to creating  the  initramfs  image.  The  overall  logic  of
       <b>mktirfs</b> is as follows:

       1.  Determine the list of kernel module names (without dependencies) to be added to the initramfs.

       2.  Run <u>start</u> hooks.

       3.  Copy <u>init</u> executable, add directories, copy microcode.

       4.  Run <u>middle</u> hooks.

       5.  Determine dependencies of modules, add all module files.

       6.  Create initramfs image.

       7.  Run <u>end</u> hooks.

       8.  Copy image to its final location.

       <b>mktirfs</b>  looks  for  hooks in the <u>/usr/share/tiny-initramfs/hooks.type</u> and <u>/etc/tiny-initramfs/hooks.type</u>
       directories, e.g.  <u>/etc/tiny-initramfs/hooks.start</u>.  The directory in <u><a href="file:/usr/share">/usr/share</a></u> is the domain  of  other
       Debian  packages,  while  the  directory in <u><a href="file:/etc">/etc</a></u> is designated for the administrator of the system. Hooks
       will be called in alphabetical order, and hooks in <u><a href="file:/etc">/etc</a></u> will override hooks in <u><a href="file:/usr/share">/usr/share</a></u>.   <b><a href="../man8/run-parts.8.html">run-parts</a></b>(8)
       is used to determine what hooks should be considered.

       Hooks are <u>sourced</u>, not executed, so calling <b>exit</b> in a hook aborts the creation of the initramfs image. It
       also allows the hooks to modify variables that will be interpreted later.

       Note  that <b>mktirfs</b> uses <u><a href="file:/bin/sh">/bin/sh</a></u> as the interpreter, which is <b><a href="../man1/dash.1.html">dash</a></b>(1) by default on Debian systems, so not
       all <b><a href="../man1/bash.1.html">bash</a></b>(1) functionality is available within hooks.

       The following shell variables are available from within hooksL

       VERSION
           The kernel version for which the initramfs is built.

       DEBUG
           The value of the <b>-d</b> command line option.

       AUTO_MODULES
           The value of the <b>-m</b> command line option.

       INCLUDE_MODULES
           The value of the <b>--include-modules</b> command line option.

       MICROCODE
           The value of the <b>-M</b> command line option.

       OUTPUT
           The value of the <b>-o</b> command line option. This should not be used, as <b>mktirfs</b> should only  replace  it
           if image creation was successful.

       image_name
           The  temporary  file name of the initramfs image that is to be created.  Will be empty except for <u>end</u>
           hooks.

       initramfs_dir
           The temporary directory that contains the contents of the initramfs image. Any directories and  files
           placed here will be part of the final initramfs image.

       early_dir
           The  temporary directory that contains the contents of the early part of the initramfs image. This is
           used for storing microcode updates for the CPU, but the kernel also supports other updates here, e.g.
           updates to ACPI tables. If this directory is non-empty after the <u>middle</u> hooks  an  uncompressed  CPIO
           image of this directory will be prepended to the final initramfs image by <b>mktirfs</b>. If it is empty (no
           microcode, no other early updates), the initramfs image will just contain the compressed CPIO archive
           of the <u>initramfs_dir</u> directory.

       modules_list
           The  name  of  the  temporary  file  that contains the list of module names that will be added to the
           initramfs image (one line per module name).  After the <u>middle</u> hooks all modules, together with  their
           dependencies, will be added to the initramfs image, any module options defined in <u><a href="file:/etc/modprobe.d">/etc/modprobe.d</a></u> for
           those modules will also be included.

</pre><h4><b>EXAMPLE</b></h4><pre>
       Create a new initramfs image for the current kernel:

               mktirfs -o /boot/initrd.img.tiny-$(uname -r)

       Create a new initramfs image for a specific kernel:

               mktirfs -o /boot/initrd.img.tiny-4.2.0 4.2.0

</pre><h4><b>FILES</b></h4><pre>
       /etc/tiny-initramfs/tiny-initramfs.conf
              If present, values in there will be used as defaults for the command line arguments of <b>mktirfs</b>.

       /usr/share/doc/tiny-initramfs-core/tiny-initramfs.conf.example
              An example configuration file that may be copied to the above location.

       /usr/share/tiny-initramfs/hooks.start

       /usr/share/tiny-initramfs/hooks.middle

       /usr/share/tiny-initramfs/hooks.end
              If present, hooks created by other Debian packages will be sourced from these directories.

       /etc/tiny-initramfs/hooks.start

       /etc/tiny-initramfs/hooks.middle

       /etc/tiny-initramfs/hooks.end
              If  present,  hooks  created  by  the system administrator will be sourced from thsee directories.
              Hooks will replace those with the same name as hooks in <u><a href="file:/usr/share">/usr/share</a></u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/update-tirfs.8.html">update-tirfs</a></b>(8)

</pre><h4><b>AUTHORS</b></h4><pre>
       Christian Seiler &lt;<a href="mailto:christian@iwakd.de">christian@iwakd.de</a>&gt;

                                                    Jan 2016                                          <u><a href="../man8/MKTIRFS.8.html">MKTIRFS</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>