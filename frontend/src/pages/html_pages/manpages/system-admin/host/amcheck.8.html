<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>amcheck - run Amanda self-checks</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/amanda-common">amanda-common_3.5.4-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       amcheck - run Amanda self-checks

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>amcheck</b> [-am] [-w] [-sclt] [-M <u>address</u>] [--client-verbose] [--exact-match] [<b>-o</b> <u>configoption</u>...] <u>config</u>
               [<u>host</u> [<u>disk</u>...]...]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>Amcheck</b> runs a number of self-checks on both the Amanda tape server host and the Amanda client hosts.

       On the tape server host, <b>amcheck</b> can go through the same tape checking used at the start of the nightly
       <b>amdump</b> run to verify the correct tape for the next run is mounted.

       <b>Amcheck</b> can also do a self-check on all client hosts to make sure each host is running and that
       permissions on filesystems to be backed up are correct.

       You can specify many host/disk expressions, only disks that match an expression will be checked. All
       disks are checked if no expressions are given.

       See the <b><a href="../man8/amanda.8.html">amanda</a></b>(8) man page for more details about Amanda.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-s</b>
           Run the tape server local and tape checks (same as <b>-lt</b>).

       <b>-c</b>
           Run the client host checks. Multiple specific clients can be checked by specifying the client name.

       <b>-l</b>
           Run the local tests (e.g. permissions) on the server host.

       <b>-t</b>
           Run the tape tests on the server host.

       <b>-w</b>
           Enables a DESTRUCTIVE check for write-protection on the tape (which would otherwise cause the
           subsequent <b>amdump</b> to fail). If the tape is writable, this check causes all data after the tape label
           to be erased. If the <b>autolabel</b> option is enabled, this check may ERASE any non-Amanda tape in the
           drive or changer. The check enable the tape tests on the server host and is only made if the tape is
           otherwise correct.

       <b>-m</b>
           Nothing is printed, but mail is sent if any errors are detected. The mail goes to the <b>mailto</b> address
           specified in the <u>amanda.conf</u> file or the <u>address</u> value if <b>-M</b> is set.

       <b>-a</b>
           Like <b>-m</b> but the mail is always sent.

       <b>-M</b> <u>address</u>
           Mail the report to <u>address</u> instead of the <b>mailto</b> value from <u>amanda.conf</u>. Implies <b>-m</b>.

       <b>--client-verbose</b>
           Print all client messages.

       <b>--exact-match</b>
           The host and disk are parsed as exact values

       <u>host</u> [<u>disk</u>]*
           Specify the host and disk on which the command will work.

       <b>-o</b> <u>configoption</u>
           See the "CONFIGURATION OVERRIDE" section in <b><a href="../man8/amanda.8.html">amanda</a></b>(8).

       The default is <b>-cs</b>.

</pre><h4><b>EXAMPLES</b></h4><pre>
       In this example, both the tape server and client tests are run. The results are displayed on standard
       output.
       % amcheck daily
       Amanda Tape Server Host Check
       -----------------------------
       /amanda2/amanda/work: 911475 KB disk space available, that's plenty.
       NOTE: skipping tape-writable test.
       Tape VOL10 label ok.
       Server check took 34.966 seconds.

       Amanda Backup Client Hosts Check
       --------------------------------
       WARNING: northstar: selfcheck request timed out.  Host down?
       WARNING: drinkme: selfcheck request timed out.  Host down?
       WARNING: scruffy: selfcheck request timed out.  Host down?
       Client check: 136 hosts checked in 51.945 seconds, 3 problems found.

       (brought to you by Amanda 2.5.0)

       In this example, if the line <b>mailto</b> <b>csd-amanda</b> is in <u>amanda.conf</u>, mail will be sent to <b>csd-amanda</b> if the
       server check returns an error.
       % amcheck -s -m daily

</pre><h4><b>MESSAGES</b></h4><pre>
       fatal slot <u>slot</u>: <u>error</u> <u>message</u>
           (error) The tape changer detected some kind of fatal error while trying to load slot <u>slot</u>.

       slot <u>slot</u>: <u>error</u> <u>message</u>
           (warning) The tape changer detected some kind of non-fatal error (e.g. an empty slot was detected)
           while trying to load slot <u>slot</u>, or an error was detected trying to read the tape label.

       slot <u>slot</u>: date <u>YYYYMMDD</u> label <u>label</u> (<u>result</u>)
           (info) Tape <u>label</u> in slot <u>slot</u> was loaded and found to have been last written on <u>YYYYMMDD</u>. If the
           tape is new, the date field will be an <u>X</u>. The <u>result</u> may be one of:

           exact label match
               This is the expected tape.

           no match
               This label does not match the <b>labelstr</b> pattern in <u>amanda.conf</u>. Tape scanning will continue.

           active tape
               This tape is still active and cannot be overwritten. Tape scanning will continue.

           first labelstr match
               This tape is the first one that matches the <b>labelstr</b> pattern in <u>amanda.conf</u>. Tape scanning will
               continue if necessary.

           labelstr match
               This tape is the next one that matches the <b>labelstr</b> pattern in <u>amanda.conf</u>. Tape scanning will
               continue.

       ERROR: cannot look up dump user <u>user</u>
           (error) Dump user <u>user</u> from <u>amanda.conf</u> could not be found in the system password information.

       ERROR: cannot look up my own uid (<u>uid</u>)
           (error) User id <u>uid</u> running <b>amcheck</b> could not be found in the system password information.

       ERROR: running as user <u>runuser</u> instead of <u>dumpuser</u>
           (error) <b>Amcheck</b> should be run as the dump user <u>dumpuser</u> from <u>amanda.conf</u> instead of <u>runuser</u>.

       ERROR: program dir <u>directory</u>: not accessible
           (error) The directory Amanda expects to find its auxiliary programs in, <u>directory</u>, is not accessible.

       ERROR: program <u>program</u>: does not exist
           (error) Program <u>program</u> needed on the tape server could not be found.

       ERROR: program <u>program</u>: not a file
           (error) Program <u>program</u> needed on the tape server exists but is not a file.

       ERROR: program <u>program</u>: not executable
           (error) Program <u>program</u> needed on the tape server exists but is not executable.

       WARNING: program <u>program</u>: not setuid-root
           (warning) Program <u>program</u> needed on the tape server exists but should be owned by user "root" and
           setuid.

       ERROR: <u>XXX</u> dir <u>directory</u>: not writable
           (error) Directory <u>directory</u> is either not writable, i.e. the dump user will not be able to create or
           remove files, or cannot be accessed, perhaps because a parent directory does not allow search
           permission. The <u>XXX</u> may be:

           log
               for the Amanda log directory (see <b>logdir</b> in <b>amanda.conf</b>)

           oldlog
               for the directory that holds the old log files (see <b>logdir</b> in <b>amanda.conf</b>)

           info
               for an Amanda database information directory (see <b>curinfo</b> in <b>amanda.conf</b>) or

           index
               for an Amanda index directory (see <b>indexdir</b> in <b>amanda.conf</b>)

           tapelist
               for the <b><a href="../man5/tapelist.5.html">tapelist</a></b>(5)

       NOTE: <u>XXX</u> dir <u>directory</u>: does not exist
           (info) A database (info) or index directory does not exist or cannot be accessed. This might just
           mean this is a new client or disk, but if that is not the case, this should be treated as an error.

       NOTE: it will be created on the next run
           (info) This indicates the info directory listed in the previous message will be created on the next
           run.

       ERROR: <u>XXX</u> dir <u>name</u>: not a directory
           (error) <b>Amcheck</b> expected <u>name</u> to be a directory, but it is something else (e.g. file).

       WARNING: info file file: does not exist
           (warning) File <u>file</u> does not exist in the text format database. Since the parent directories do
           exist, the file should already have been created.

       ERROR: info file name: not a file
           (error) <b>Amcheck</b> expected <u>name</u> to be a file, but it is something else (e.g. file).

       ERROR: info file file: not readable
           (error) The text format database file <u>file</u> is not readable.

       ERROR: log file file: not writable
           (error) Log file <u>file</u> (file <b>log</b> in <b>logdir</b> from <b>amanda.conf</b>) is either not writable, or cannot be
           accessed, perhaps because a parent directory does not allow search permission.

       ERROR: tape list <u>tapelist</u>: not writable
           (error) <b><a href="../man5/tapelist.5.html">tapelist</a></b>(5) is not writable or was not found.

       ERROR: tape list <u>tapelist</u>: parse error
           (error) <b><a href="../man5/tapelist.5.html">tapelist</a></b>(5) could not be read or parsed.

       WARNING: tapedev is /dev/null, dumps will be thrown away
           (warning) The <b>tapedev</b> parameter in <b>amanda.conf</b> is set to /dev/null and Amanda uses that when
           debugging to throw all the dump images away.

       WARNING: hold file file exists
           (info) Hold file <u>file</u> exists and will cause <b>amdump</b> to pause at the beginning until it is removed.

       ERROR: holding disk <u>disk</u>: statfs: <u>error</u> <u>message</u>
           (error) An error was returned from the <u>statfs</u> system call on holding disk <u>disk</u> (maybe because it does
           not exist).

       ERROR: holding disk <u>disk</u>: not writable
           (error) Holding disk <u>disk</u>, is not writable, probably because the caller does not have write
           permission or a parent directory does not allow search permission.

       WARNING: holding disk <u>disk</u>: available space unknown <u>N</u> KB requested.
           (warning) <b>Amcheck</b> could not determine the amount of available space on holding disk <u>disk</u> to see if
           there were at least <u>N</u> KBytes available.

       WARNING: holding disk <u>disk</u>: only <u>F</u> KB free (<u>R</u> KB requested).
           (warning) <u>amanda.conf</u> requested <u>R</u> KBytes of free space on holding disk <u>disk</u>, but only <u>F</u> KBytes were
           available. 10 MBytes is subtracted for each backup process (see the <b>inparallel</b> <u>amanda.conf</u> option) to
           allow for unexpected overruns.

               <b>Note</b>
               Even though this message is listed as a warning, it causes <b>amcheck</b> to exit with a non-zero
               status.

       Holding disk <u>disk</u>: <u>N</u> KB disk space available, that's plenty.
           (info) There was sufficient free space on holding disk <u>disk</u>.

       WARNING: holding disk <u>disk</u>: only <u>F</u> KB free, using nothing
           (warning) Holding disk <u>disk</u> has <u>F</u> KBytes of free space, but that is not enough for what is requested
           in <u>amanda.conf</u>.

       Holding disk <u>disk</u>: <u>F</u> KB disk space available, using <u>U</u> KB
           (info) Holding disk <u>disk</u> has <u>F</u> KBytes of free space and Amanda will be using up to <u>U</u> Kbytes.

       WARNING: if a tape changer is not available, runtapes must be set to 1.
           (warning) The <b>runtapes</b> <u>amanda.conf</u> option must be set to 1 if the <b>tpchanger</b> <u>amanda.conf</u> option is not
           set.

       ERROR: <u>error</u> <u>message</u>.
           (error) An error was detected while initializing the tape changer.

       ERROR: <u>tape</u> <u>device</u>: <u>error</u> <u>message</u>.
           (error) An error was detected while processing the tape label.

       ERROR: cannot overwrite active tape <u>label</u>.
           (error) Tape <u>label</u> is still active and cannot be used.

       ERROR: label <u>label</u> doesn't match labelstr <u>pattern</u> .
           (error) The label on tape <u>label</u> does not match the <b>labelstr</b> <u>amanda.conf</u> option.

       (expecting a new tape)
           (info) The tape is not OK and a new tape was expected.

       (expecting tape <u>label</u> or a new tape)
           (info) The tape is not OK and either tape <u>label</u> or a new tape was expected.

       ERROR: tape <u>label</u> label ok, but is not writable.
           (error) Tape <u>label</u> is OK, but the write enable test failed.

       Tape <u>label</u> is writable.
           (info) Tape <u>label</u> is OK and the write enable test succeeded.

       NOTE: skipping tape-writable test.
           (info) The tape write test (see the <b>-w</b> option) was not enabled.

       WARNING: skipping tape test because amdump or amflush seem to be running, WARNING: if they are not, you
       must run amcleanup
           (warning) It looked to <b>amcheck</b> like either <b>amdump</b> or <b>amflush</b> were running because a log file or
           amdump file exists. If they are not running, you probably need to run <b>amcleanup</b> to clear up a
           previous failure. Otherwise, you need to wait until they complete before running <b>amcheck</b>.

       NOTE: skipping tape checks
           (info) The tape tests are being skipped because you used the <b>-t</b> command line option.

       WARNING: <u>compress</u> is not executable, server-compression and indexing will not work
           (warning) Compression program <u>compress</u> is not executable, so compression on the tape server host and
           creating index files will not work.

       Tape <u>label</u> label ok.
           (info) Tape <u>label</u> is OK for the next run.

       Server check took <u>S</u> seconds.
           (info) Reports how long the tape server host checks took.

       ERROR: <u>host</u>: could not resolve hostname
           (error) Could not look up client hostname <u>host</u>.

       Client check: <u>H</u> hosts checked in <u>S</u> seconds, <u>N</u> problems found.
           (info) Reports the number of client hosts checked, how long it took and the number of errors
           detected.

       WARNING: <u>host</u>: selfcheck request timed out. Host down?
           (warning) There was no response from <u>host</u> when trying to do the client checks. The host might really
           be down or it might not be configured properly.

       ERROR: <u>host</u> NAK: <u>message</u>
           (error) <u>Host</u> reported a negative acknowledgment error of <u>message</u> to the status check request.

       ERROR: <u>host</u> NAK: [NAK parse failed]
           (error) <b>Amcheck</b> could not parse the negative acknowledgment error from <u>host</u>. There might be an Amanda
           version mismatch between the host running <b>amcheck</b> and <u>host</u>.

       ERROR: <u>host</u> [mutual-authentication failed]
           (error) Kerberos authentication failed while contacting <u>host</u>.

       ERROR: <u>host</u>: <u>message</u>
           (error) Error <u>message</u> was reported by the status check on <u>host</u>.

</pre><h4><b>EXIT</b> <b>CODE</b></h4><pre>
       The exit code of <b>amcheck</b> is one of:
        0  = success
        1  = error

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/amanda.8.html">amanda</a></b>(8), <b><a href="../man5/amanda.conf.5.html">amanda.conf</a></b>(5), <b><a href="../man8/amdump.8.html">amdump</a></b>(8)

       The Amanda Wiki: : <a href="http://wiki.zmanda.com/">http://wiki.zmanda.com/</a>

</pre><h4><b>AUTHORS</b></h4><pre>
       <b>James</b> <b>da</b> <b>Silva</b> &lt;<a href="mailto:jds@amanda.org">jds@amanda.org</a>&gt;

       <b>Stefan</b> <b>G.</b> <b>Weichinger</b> &lt;<a href="mailto:sgw@amanda.org">sgw@amanda.org</a>&gt;

Amanda 3.5.4                                       01/25/2025                                         <u><a href="../man8/AMCHECK.8.html">AMCHECK</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>