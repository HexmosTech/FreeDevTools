<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>traffic_ctl - Traffic Server command line tool</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/trafficserver">trafficserver_9.2.5+ds-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       traffic_ctl - Traffic Server command line tool

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>traffic_ctl</b> [OPTIONS] SUBCOMMAND [OPTIONS]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>traffic_ctl</b>  is used to display and manipulate configure a running Traffic Server. <b>traffic_ctl</b> includes a
       number of subcommands that control different aspects of Traffic Server:

       <b>traffic_ctl</b> <b>alarm</b>
              Display and manipulate Traffic Server alarms

       <b>traffic_ctl</b> <b>config</b>
              Manipulate and display configuration records

       <b>traffic_ctl</b> <b>metric</b>
              Manipulate performance and status metrics

       <b>traffic_ctl</b> <b>server</b>
              Stop, restart and examine the server

       <b>traffic_ctl</b> <b>storage</b>
              Manipulate cache storage

       <b>traffic_ctl</b> <b>plugin</b>
              Interact with plugins.

       <b>traffic_ctl</b> <b>host</b>
              Manipulate host status.  parents for now but will be expanded to origins.

       To use <b>traffic_ctl</b>, <u>traffic_manager</u> needs to be running.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--debug</b>
              Enable debugging output.

       <b>-V,</b> <b>--version</b>
              Print version information and exit.

</pre><h4><b>SUBCOMMANDS</b></h4><pre>
   <b>traffic_ctl</b> <b>alarm</b>
       <b>list</b>   List all alarm events that have not been acknowledged (cleared).

       <b>clear</b>  Clear (acknowledge) all current alarms.

       <b>resolve</b> <b>ALARM</b> <b>[ALARM...]</b>
              Clear (acknowledge) an alarm event. The arguments are a specific alarm number (e.g. ''1''), or  an
              alarm string identifier (e.g.  ''MGMT_ALARM_PROXY_CONFIG_ERROR'').

   <b>traffic_ctl</b> <b>config</b>
       <b>defaults</b> <b>[--records]</b>
              Display  the  default  values  for  all  configuration  records.  The --records* flag has the same
              behavior as <u>traffic_ctl</u> <u>config</u> <u>get</u> <u>--records</u>.

       <b>describe</b> <b>RECORD</b> <b>[RECORD...]</b>
              Display all the known information about a configuration record.  This  includes  the  current  and
              default values, the data type, the record class and syntax checking expression.

       <b>diff</b> <b>[--records]</b>
              Display  configuration  records  that  have  non-default  values. The --records* flag has the same
              behavior as <u>traffic_ctl</u> <u>config</u> <u>get</u> <u>--records</u>.

       <b>get</b> <b>[--records]</b> <b>RECORD</b> <b>[RECORD...]</b>
              Display the current value of a configuration record.

       <b>--records</b>
              If this flag is provided, <u>traffic_ctl</u> <u>config</u> <u>get</u> will emit results in <u>records.config</u> format.

       <b>match</b> <b>[--records]</b> <b>REGEX</b> <b>[REGEX...]</b>
              Display the current values of all configuration variables whose  names  match  the  given  regular
              expression. The <u>--records</u> flag has the same behavior as <u>traffic_ctl</u> <u>config</u> <u>get</u> <u>--records</u>.

       <b>reload</b> Initiate  a  Traffic  Server  configuration  reload.  Use  this  command  to  update  the  running
              configuration after any configuration file modification.  If  no  configuration  files  have  been
              modified since the previous configuration load, this command is a no-op.

              The  timestamp  of  the  last  reconfiguration  event (in seconds since epoch) is published in the
              <u>proxy.node.config.reconfigure_time</u> metric.

       <b>set</b> <b>RECORD</b> <b>VALUE</b>
              Set  the  named  configuration  record  to  the  specified  value.  Refer  to  the  <u>records.config</u>
              documentation  for  a list of the configuration variables you can specify. Note that this is not a
              synchronous operation.

       <b>status</b> Display detailed status about the Traffic  Server  configuration  system.  This  includes  version
              information,  whether the internal configuration store is current and whether any daemon processes
              should be restarted.

   <b>traffic_ctl</b> <b>metric</b>
       <b>get</b> <b>METRIC</b> <b>[METRIC...]</b>
              Display the current value of the specifies statistics.

       <b>match</b> <b>REGEX</b> <b>[REGEX...]</b>
              Display the current values of all statistics whose names match the given regular expression.

       <b>zero</b> <b>METRIC</b> <b>[METRIC...]</b>
              Reset the named statistics to zero.

   <b>traffic_ctl</b> <b>server</b>
       <b>restart</b>
              Shut down and immediately restart Traffic Server

       <b>--drain</b>
              This option modifies the behavior of <u>traffic_ctl</u> <u>server</u> <u>restart</u> such that  <b>traffic_server</b>  is  not
              shut  down  until  the  number  of  active  client  connections  drops  to the number given by the
              <u>proxy.config.restart.active_client_threshold</u> configuration variable.

       <b>--manager</b>
              The default behavior of <u>traffic_ctl</u> <u>server</u> <u>restart</u> is to restart <b>traffic_server</b>. If this option is
              specified, <b>traffic_manager</b> is also restarted.

       <b>start</b>  Start <b>traffic_server</b> if it is already running.

       <b>--clear-cache</b>
              Clear the disk cache upon startup.

       <b>--clear-hostdb</b>
              Clear the DNS resolver cache upon startup.

       <b>status</b> Show the current proxy server status, indicating if we're running or not.

       <b>stop</b>   Stop the running <b>traffic_server</b> process.

       <b>backtrace</b>
              Show a full stack trace of all the <b>traffic_server</b> threads.

   <b>traffic_ctl</b> <b>storage</b>
       <b>offline</b> <b>PATH</b> <b>[PATH</b> <b>...]</b>
              Mark a cache storage device as offline. The storage is identified by <u>PATH</u> which must match exactly
              a path specified in <u>storage.config</u>. This removes the storage from the cache and redirects requests
              that would have used this storage to other storage. This has exactly the same  effect  as  a  disk
              failure for that storage. This does not persist across restarts of the <b>traffic_server</b> process.

   <b>traffic_ctl</b> <b>plugin</b>
       <b>msg</b> <b>TAG</b> <b>DATA</b>
              Send     a     message     to     plugins.     All     plugins     that     have     hooked    the
              <u>TSLifecycleHookID::TS_LIFECYCLE_MSG_HOOK</u> will receive a callback for that hook.  The <u>TAG</u> and  <u>DATA</u>
              will  be  available  to  the  plugin  hook processing. It is expected that plugins will use <u>TAG</u> to
              select relevant messages and determine the format of the <u>DATA</u>. The <u>DATA</u> is optional and may not be
              available to consume, if not available then size will be 0 and the data will be  NULL.  Any  extra
              passed  value  beside  the  tag and the optional data will be ignored.  Check <u>TSPluginMsg</u> for more
              info.

   <b>traffic_ctl</b> <b>host</b>
       A stat to track status is  created  for  each  host.  The  name  is  the  host  fqdn  with  a  prefix  of
       "proxy.process.host_status".  The value of the stat is a string which is the serialized representation of
       the status. This contains the overall status and the status for each reason.  The  stats  may  be  viewed
       using the <b>traffic_ctl</b> <b>metric</b> command or through the <u>stats_over_http</u> endpoint.

       <b>--time</b> <b>count</b>
              Set  the  duration of an operation to <b>count</b> seconds. A value of <b>0</b> means no duration, the condition
              persists until explicitly changed. The default is <b>0</b> if an operation requires a time  and  none  is
              provided by this option.

       <b>--reason</b> <b>active</b> <b>|</b> <b>local</b> <b>|</b> <b>manual</b>
              Sets the reason for the operation.

              <b>active</b> Set the active health check reason.

              <b>local</b>  Set the local health check reason.

              <b>manual</b> Set  the  administrative  reason.  This is the default reason if a reason is needed and not
                     provided by this option.

              Internally the reason can be <b>self_detect</b> if <u>proxy.config.http.parent_proxy.self_detect</u> is  set  to
              the  value  2  (the  default).  This  is  used to prevent parent selection from creating a loop by
              selecting itself as the upstream by marking this reason as "down" in that case.

              <b>NOTE:</b>
                 The up / down status values are independent, and a host is consider available if  and  only  if
                 all of the statuses are "up".

       <b>status</b> <b>HOSTNAME</b> <b>[HOSTNAME</b> <b>...]</b>
              Get  the  current  status  of  the specified hosts with respect to their use as targets for parent
              selection. This returns the same information as the per host stat.

       <b>down</b> <b>HOSTNAME</b> <b>[HOSTNAME</b> <b>...]</b>
              Marks the listed hosts as down so that they will not be chosen as a next hop parent. If <u>--time</u>  is
              included  the  host  is  marked down for the specified number of seconds after which the host will
              automatically be marked up. A host is not marked up until all reason codes are cleared by  marking
              up the host for the specified reason code.

              Supports <u>--time</u>, <u>--reason</u>.

       <b>up</b> <b>HOSTNAME</b> <b>[HOSTNAME</b> <b>...]</b>
              Marks  the  listed  hosts  as  up so that they will be available for use as a next hop parent. Use
              <u>--reason</u> to mark the host reason code. The 'self_detect' is an internal reason code used by parent
              selection to mark down a parent when it is identified as itself and

              Supports <u>--reason</u>.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Mark down a host with <u>traffic_ctl</u> and view the associated host stats:

          $ traffic_ctl host down cdn-cache-02.foo.com --reason manual

          $ /opt/trafficserver/bin/traffic_ctl metric match host_status
          proxy.process.host_status.cdn-cache-01.foo.com HOST_STATUS_DOWN,ACTIVE:UP:0:0,LOCAL:UP:0:0,MANUAL:DOWN:1556896844:0,SELF_DETECT:UP:0
          proxy.process.host_status.cdn-cache-02.foo.com HOST_STATUS_UP,ACTIVE:UP:0:0,LOCAL:UP:0:0,MANUAL:UP:0:0,SELF_DETECT:UP:0
          proxy.process.host_status.cdn-cache-origin-01.foo.com HOST_STATUS_UP,ACTIVE:UP:0:0,LOCAL:UP:0:0,MANUAL:UP:0:0,SELF_DETECT:UP:0

       In the example above, 'cdn-cache-01.foo.com' is unavailable, <u>HOST_STATUS_DOWN</u> and was marked down for the
       <u>manual</u> reason, <u>MANUAL:DOWN:1556896844:0</u>, at the time indicated by the UNIX  time  stamp  <u>1556896844</u>.   To
       make the host available, one would have to clear the <u>manual</u> reason using

          $ traffic_ctl host up cdn-cache-01.foo.com --reason manual

       Configure Traffic Server to insert <b>Via</b> header in the response to the client:

          $ traffic_ctl config set proxy.config.http.insert_response_via_str 1
          $ traffic_ctl config reload

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/records.config.5.html">records.config</a>(5)</b>, <b><a href="../man5/storage.config.5.html">storage.config</a>(5)</b>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2025, <a href="mailto:dev@trafficserver.apache.org">dev@trafficserver.apache.org</a>

9.2                                               May 22, 2025                                    <u><a href="../man8/TRAFFIC_CTL.8.html">TRAFFIC_CTL</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>