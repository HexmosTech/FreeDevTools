<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nsd-control, nsd-control-setup - NSD remote server control utility.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/nsd">nsd_4.12.0-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>nsd-control,</b> <b>nsd-control-setup</b> - NSD remote server control utility.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>nsd-control</b> [<b>-c</b> <u>cfgfile</u>] [<b>-s</b> <u>server</u>] <u>command</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>nsd-control</b>  performs  remote  administration on the <u><a href="../man8/nsd.8.html">nsd</a></u>(8) DNS server.  It reads the configuration file,
       contacts the nsd server over SSL, sends the command and displays the result.   Commands  that  require  a
       reload are queued and the result indicates the command was accepted.

       The available options are:

       <b>-h</b>     Show the version and commandline option help.

       <b>-c</b> <u>cfgfile</u>
              The  config file to read with settings.  If not given the default config file /etc/nsd/nsd.conf is
              used.

       <b>-s</b> <u>server[@port]</u>
              IPv4 or IPv6 address of the server to contact.  If not given, the address is read from the  config
              file.

</pre><h4><b>COMMANDS</b></h4><pre>
       There are several commands that the server understands.

       <b>start</b>  Start  the server. Simply execs <u><a href="../man8/nsd.8.html">nsd</a></u>(8).  The nsd executable is not searched for in the <b>PATH</b> set in
              the environment.  Instead the default location relative to the installation  prefix  specified  at
              compile-time.   The  executable location can be overridden by setting <u>NSD_PATH</u> in the environment.
              It is started with the config file specified using <u>-c</u> or the default config file.

       <b>stop</b>   Stop the server. The server daemon exits.

       <b>reload</b> <b>[&lt;zone&gt;]</b>
              Reload zonefiles and reopen logfile.  Without argument reads  changed  zonefiles.   With  argument
              reads the zonefile for the given zone and loads it.

       <b>reconfig</b>
              Reload  nsd.conf  and apply changes to TSIG keys and configuration patterns, and apply the changes
              to add and remove zones that are mentioned in the config.  Other changes are not applied, such  as
              listening  ip  address and port and chroot, also per-zone statistics are not applied.  The pattern
              updates means that the configuration options for zones (request-xfr, zonefile,  notify,  ...)  are
              updated.  Also new patterns are available for use with the addzone command.

       <b>repattern</b>
              Same as the reconfig option.

       <b>log_reopen</b>
              Reopen  the  logfile, for log rotate that wants to move the logfile away and create a new logfile.
              The log can also be reopened with kill -HUP (which also reloads all zonefiles).

       <b>status</b> Display server status. Exit code 3 if not running (the connection to the port is  refused),  1  on
              error, 0 if running.

       <b>stats</b>  Output  a  sequence  of  name=value lines with statistics information, requires NSD to be compiled
              with this option enabled.

       <b>stats_noreset</b>
              Same as stats, but does not zero the counters.

       <b>addzone</b> <b>&lt;zone</b> <b>name&gt;</b> <b>&lt;pattern</b> <b>name&gt;</b>
              Add a new zone to the running server.  The zone is added to the zonelist file on disk, so it stays
              after a restart.  The pattern name determines the options for the new zone.  For secondary zones a
              zone transfer is immediately attempted.  For zones with a zonefile, the zone file is attempted  to
              be read in.

       <b>delzone</b> <b>&lt;zone</b> <b>name&gt;</b>
              Remove the zone from the running server.  The zone is removed from the zonelist file on disk, from
              the  nsd.db  file  and from the memory.  If it had a zonefile, this remains (but may be outdated).
              Zones configured inside nsd.conf itself cannot be removed this way because  the  daemon  does  not
              write  to  the nsd.conf file, you need to add such zones to the zonelist file to be able to delete
              them with the delzone command.

       <b>changezone</b> <b>&lt;zone</b> <b>name&gt;</b> <b>&lt;pattern</b> <b>name&gt;</b>
              Change a zone to use the pattern for options.  The zone is deleted and  added  in  one  operation,
              changing  it  to use the new pattern for the zone options.  Zones configured in nsd.conf cannot be
              changed like this, instead edit the nsd.conf (or the included file in nsd.conf) and reconfig.

       <b>addzones</b>
              Add zones read from stdin of nsd-control.  Input is read per line, with name space patternname  on
              a line.  For bulk additions.

       <b>delzones</b>
              Remove zones read from stdin of nsd-control.  Input is one name per line.  For bulk removals.

       <b>write</b> <b>[&lt;zone&gt;]</b>
              Write  zonefiles  to  disk,  or  the given zonefile to disk.  Zones that have changed (via AXFR or
              IXFR) are written, or if the zonefile has not been created yet  then  it  is  created.   Directory
              components of the zonefile path are created if necessary. With argument that zone is written if it
              was modified, without argument, all modified zones are written.

       <b>notify</b> <b>[&lt;zone&gt;]</b>
              Send  NOTIFY messages to secondary servers.  Sends to the IP addresses configured in the 'notify:'
              lists for the primary zones hosted on this server.  Usually NSD sends NOTIFY messages  right  away
              when  a  primary  zone  serial  is  updated.  If a zone is given, notifies are sent for that zone.
              These secondary servers are supposed to initiate a zone transfer request later (to this server  or
              another primary), this can be allowed via the 'provide-xfr:' acl list configuration. With argument
              that zone is processed, without argument, all zones are processed.

       <b>transfer</b> <b>[&lt;zone&gt;]</b>
              Attempt to update secondary zones that are hosted on this server by contacting the primaries.  The
              primaries  are  configured  via  'request-xfr:'  lists.  If a zone is given, that zone is updated.
              Usually NSD receives a NOTIFY from the primaries (configured via 'allow-notify:' acl list) that  a
              new  zone  serial  has to be transferred.  For zones with no content, NSD may have backed off from
              asking often because the primaries did not respond, but this command will reset the backoff to its
              initial timeout, for frequent retries. With argument that zone is transferred,  without  argument,
              all zones are transferred.

       <b>force_transfer</b> <b>[&lt;zone&gt;]</b>
              Force  update  secondary zones that are hosted on this server.  Even if the primary hosts the same
              serial number of the zone, a full AXFR is performed to fetch it.  If you  want  to  use  IXFR  and
              check  that  the  serial  number increases, use the 'transfer' command. With argument that zone is
              transferred, without argument, all zones are transferred.

       <b>zonestatus</b> <b>[&lt;zone&gt;]</b>
              Print state of the zone, the serial numbers and since when they have been acquired.   Also  prints
              the  notify  action  (to  which  server),  and  zone transfer (and from which primary) if there is
              activity right now.  The state of  the  zone  is  printed  as:  'primary'  (primary  zones),  'ok'
              (secondary  zone  is  up-to-date), 'expired' (secondary zone has expired), 'refreshing' (secondary
              zone has transfers active).   The  serial  numbers  printed  are  the  'served-serial'  (currently
              active),  the 'commit-serial' (is in reload), the 'notified-serial' (got notify, busy fetching the
              data).  The serial numbers are only printed if such a serial number is  available.  With  argument
              that zone is printed, without argument, all zones are printed.

       <b>serverpid</b>
              Prints  the  PID  of  the server process.  This is used for statistics (and only works when NSD is
              compiled with statistics enabled).  This pid is not for sending unix signals,  use  the  pid  from
              nsd.pid for that, that pid is also stable.

       <b>verbosity</b> <b>&lt;number&gt;</b>
              Change logging verbosity.

       <b>print_tsig</b> <b>[&lt;key_name&gt;]</b>
              print  the  secret  and algorithm for the TSIG key with that name.  Or list all the tsig keys with
              their name, secret and algorithm.

       <b>update_tsig</b> <b>&lt;name&gt;</b> <b>&lt;secret&gt;</b>
              Change existing TSIG key with name to the new secret.  The secret is a base64 encoded string.  The
              changes are only in-memory and are gone next restart, for lasting changes edit the  nsd.conf  file
              or a file included from it.

       <b>add_tsig</b> <b>&lt;name&gt;</b> <b>&lt;secret&gt;</b> <b>[algo]</b>
              Add  a new TSIG key with the given name, secret and algorithm.  Without algorithm a default (hmac-
              sha256) algorithm is used.  The secret is a base64 encoded string.  The changes are only in-memory
              and are gone next restart, for lasting changes edit the nsd.conf file or a file included from it.

       <b>assoc_tsig</b> <b>&lt;zone&gt;</b> <b>&lt;key_name&gt;</b>
              Associate the zone with the given tsig.   The  access  control  lists  for  notify,  allow-notify,
              provide-xfr and request-xfr are adjusted to use the given key.

       <b>del_tsig</b> <b>&lt;key_name&gt;</b>
              Delete  the  TSIG  key with the given name.  Prints error if the key is still in use by some zone.
              The changes are only in-memory and are gone next restart, for lasting changes  edit  the  nsd.conf
              file or a file included from it.

       <b>add_cookie_secret</b> <b>&lt;secret&gt;</b>
              Add or replace a cookie secret persistently. &lt;secret&gt; needs to be an 128 bit hex string.

              Cookie  secrets  can  be  either  <u>active</u>  or <u>staging</u>. <u>Active</u> cookie secrets are used to create DNS
              Cookies, but verification of a DNS Cookie succeeds with  any  of  the  <u>active</u>  or  <u>staging</u>  cookie
              secrets.  The  state  of  the  current cookie secrets can be printed with the <b>print_cookie_secrets</b>
              command.

              When there are no cookie secrets configured yet, the &lt;secret&gt; is added  as  <u>active</u>.  If  there  is
              already an <u>active</u> cookie secret, the &lt;secret&gt; is added as <u>staging</u> or replacing an existing <u>staging</u>
              secret.

              To "roll" a cookie secret used in an anycast set. The new secret has to be added as staging secret
              to  <b>all</b>  nodes  in the anycast set. When <b>all</b> nodes can verify DNS Cookies with the new secret, the
              new secret can be activated with the <b>activate_cookie_secret</b> command. After <b>all</b> nodes have the  new
              secret   <u>active</u>   for   at   least  one  hour,  the  previous  secret  can  be  dropped  with  the
              <b>drop_cookie_secret</b> command.

              Persistence is accomplished by writing to a file which if configured with  the  <b>cookie-secret-file</b>
              option   in   the   server   section  of  the  config  file.   The  default  value  for  that  is:
              /var/lib/nsd/cookiesecrets.txt .

       <b>drop_cookie_secret</b>
              Drop the <u>staging</u> cookie secret.

       <b>activate_cookie_secret</b>
              Make the current <u>staging</u> cookie secret <u>active</u>, and the current <u>active</u> cookie secret <u>staging</u>.

       <b>print_cookie_secrets</b>
              Show the current configured cookie secrets with their status.

</pre><h4><b>EXIT</b> <b>CODE</b></h4><pre>
       The nsd-control program exits with status code 1 on error, 0 on success.

</pre><h4><b>SET</b> <b>UP</b></h4><pre>
       The setup requires a self-signed certificate and private keys for both the server and client.  The script
       <u>nsd-control-setup</u> generates these in the default run directory, or with -d in another directory.  If  you
       change the access control permissions on the key files you can decide who can use nsd-control, by default
       owner and group but not all users.  The script preserves private keys present in the directory.

</pre><h4><b>STATISTIC</b> <b>COUNTERS</b></h4><pre>
       The <u>stats</u> command shows a number of statistic counters.

       <u>num.queries</u>
              number of queries received (the tls, tcp and udp queries added up).

       <u>serverX.queries</u>
              number  of  queries handled by the server process.  The number of server processes is set with the
              config statement <b>server-count</b>.

       <u>time.boot</u>
              uptime in seconds since the server was started.  With fractional seconds.

       <u>time.elapsed</u>
              time since the last stats report, in seconds.  With fractional seconds.  Can  be  zero  if  polled
              quickly  and  the  previous stats command resets the counters, so that the next gets a fully zero,
              and zero elapsed time, report.

       <u>size.db.disk</u>
              size of nsd.db on disk, in bytes.

       <u>size.db.mem</u>
              size of the DNS database in memory, in bytes.

       <u>size.xfrd.mem</u>
              size of memory for zone transfers and notifies in xfrd process, excludes TSIG data, in bytes.

       <u>size.config.disk</u>
              size of zonelist file on disk, excludes the nsd.conf size, in bytes.

       <u>size.config.mem</u>
              size of config data in memory, kept twice in server and xfrd process, in bytes.

       <u>num.type.X</u>
              number of queries with this query type.

       <u>num.opcode.X</u>
              number of queries with this opcode.

       <u>num.class.X</u>
              number of queries with this query class.

       <u>num.rcode.X</u>
              number of answers that carried this return code.

       <u>num.edns</u>
              number of queries with EDNS OPT.

       <u>num.ednserr</u>
              number of queries which failed EDNS parse.

       <u>num.udp</u>
              number of queries over UDP ip4.

       <u>num.udp6</u>
              number of queries over UDP ip6.

       <u>num.tcp</u>
              number of connections over TCP ip4.

       <u>num.tcp6</u>
              number of connections over TCP ip6.

       <u>num.tls</u>
              number of connections over TLS ip4.  TLS queries are not part of num.tcp.

       <u>num.tls6</u>
              number of connections over TLS ip6.  TLS queries are not part of num.tcp6.

       <u>num.answer_wo_aa</u>
              number of answers with NOERROR rcode and without AA flag, this includes the referrals.

       <u>num.rxerr</u>
              number of queries for which the receive failed.

       <u>num.txerr</u>
              number of answers for which the transmit failed.

       <u>num.raxfr</u>
              number of AXFR requests from clients (that got served with reply).

       <u>num.rixfr</u>
              number of IXFR requests from clients (that got served with reply).

       <u>num.truncated</u>
              number of answers with TC flag set.

       <u>num.dropped</u>
              number of queries that were dropped because they failed sanity check.

       <u>zone.primary</u>
              number of primary zones served.  These are zones with no 'request-xfr:' entries.  Also  output  as
              'zone.master' for backwards compatibility.

       <u>zone.secondary</u>
              number  of  secondary  zones  served.   These are zones with 'request-xfr' entries. Also output as
              'zone.slave' for backwards compatibility.

</pre><h4><b>FILES</b></h4><pre>
       <u>/etc/nsd/nsd.conf</u>
              nsd configuration file.

       <u>/etc/nsd</u>
              directory with private keys (nsd_server.key  and  nsd_control.key)  and  self-signed  certificates
              (nsd_server.pem and nsd_control.pem).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man5/nsd.conf.5.html">nsd.conf</a></u>(5), <u><a href="../man8/nsd.8.html">nsd</a></u>(8), <u><a href="../man8/nsd-checkconf.8.html">nsd-checkconf</a></u>(8)

NLnet Labs                                        Apr 24, 2025                                    <u><a href="../man8/nsd-control.8.html">nsd-control</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>