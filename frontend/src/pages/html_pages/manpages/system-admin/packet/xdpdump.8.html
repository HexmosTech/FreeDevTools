<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xdpdump - a simple tcpdump like tool for capturing packets at the XDP layer</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/xdp-tools">xdp-tools_1.5.1-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       xdpdump - a simple tcpdump like tool for capturing packets at the XDP layer

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <u>xdpdump</u>  is  a simple XDP packet capture tool that tries to behave similar to <u>tcpdump</u>, however, it has no
       packet filter or decode capabilities.

       This can be used for debugging XDP programs that are already loaded on  an  interface.   Packets  can  be
       dumped/inspected  before  on <b>entry</b> to XDP program, or after at <b>exit</b> from an XDP program.  Furthermore, at
       <b>exit</b> the XDP action is also captured.  This means that even packets that are dropped at the XDP layer can
       be captured via this tool.

       <u>xdpdump</u> works by attaching a bpf trace program to the XDP entry and/or exit function which stores the raw
       packet in a perf trace buffer. If no XDP program is loaded this approach can not be  used  and  the  tool
       will use a libpcap live-capture to be backward compatible.

   <b>Running</b> <b>xdpdump</b>
       The syntax for running <u>xdpdump</u> is:

              Usage: xdpdump [options]

               XDPDump tool to dump network traffic

              Options:
                   --rx-capture &lt;mode&gt;    Capture point for the rx direction (valid values: entry,exit)
               -D, --list-interfaces      Print the list of available interfaces
               -i, --interface &lt;ifname&gt;   Name of interface to capture on
                   --perf-wakeup &lt;events&gt;  Wake up xdpdump every &lt;events&gt; packets
               -p, --program-names &lt;prog&gt;  Specific program to attach to
               -s, --snapshot-length &lt;snaplen&gt;  Minimum bytes of packet to capture
                   --use-pcap             Use legacy pcap format for XDP traces
               -w, --write &lt;file&gt;         Write raw packets to pcap file
               -x, --hex                  Print the full packet in hex
               -v, --verbose              Enable verbose logging (-vv: more verbose)
                   --version              Display version information
               -h, --help                 Show this help

</pre><h4><b>The</b> <b>options</b> <b>explained</b></h4><pre>
       The  <u>xdpdump</u>  tool tries to mimic the basic <u>tcpdump</u> options, but just in case below each of the available
       options is explained:

   <b>--rx-capture</b> <b>&lt;mode&gt;</b>
       Specify where the ingress packet gets captured. Either at the entry of the XDP program and/or exit of the
       XDP program. Valid options are <b>entry</b>, <b>exit</b>, or both <b>entry,exit</b>. The packet at <b>exit</b> can be modified by the
       XDP program. If you are interested to see both the original  and  modified  packet,  use  the  <b>entry,exit</b>
       option. With this, each packet is captured twice. The default value for this is <b>entry</b>.

   <b>-D,</b> <b>--list-interfaces</b>
       Display a list of available interfaces and any XDP program loaded

   <b>--load-xdp-mode</b>
       Specifies  which  loader  mode  to use with the <u>--load-xdp-program</u> option. The valid values are ‘native’,
       which is the default in-driver XDP mode, ‘skb’, which causes  the  so-called  skb  mode  (also  known  as
       generic  XDP) to be used, ‘hw’ which causes the program to be offloaded to the hardware, or ‘unspecified’
       which leaves it up to the kernel to pick a mode (which it will do by picking native mode  if  the  driver
       supports  it,  or generic mode otherwise). Note that using ‘unspecified’ can make it difficult to predict
       what mode a program will end up being loaded in. For this reason, the default is ‘native’.

   <b>--load-xdp-program</b>
       If no XDP program is loaded on the interface, by default, xdpdump will fallback to libpcap's live capture
       mode to capture the packets. Alternatively, with this option, you can ask xdpdump to load an XDP  program
       to capture the packets directly.

   <b>-i,</b> <b>--interface</b> <b>&lt;ifname&gt;</b>
       Listen  on interface <u>ifname</u>. Note that if no XDP program is loaded on the interface it will use libpcap's
       live capture mode to capture the packets.

   <b>--perf-wakeup</b> <b>&lt;events&gt;</b>
       Let the Kernel wake up <u>xdpdump</u> once for every <u>&lt;events&gt;</u> being posted in the perf ring buffer.  The  higher
       the  number the less the impact is on the actual XDP program. The default value is 0, which automatically
       calculates the value based on the available CPUs/buffers. Use -v to see the actual used value.

   <b>-p,</b> <b>--program-names</b> <b>[&lt;prog&gt;|all]</b>
       This option allows you to capture packets for a specific, set of, or  all  XDP  programs  loaded  on  the
       interface.  You  can  either  specify the actual program names or program IDs separated by commas. In the
       case where multiple programs are attached with the same name, you should use the program ID. Use  the  -D
       option to see the loaded programs and their IDs.

       In  addition,  the  Linux  API does not provide the full name of the attached eBPF entry function if it's
       longer than 15 characters. xdpdump will try to guess the correct function name  from  the  available  BTF
       debug  information.  However, if multiple functions exist with the same leading name, it can not pick the
       correct one. It will dump the available functions, and you can choose the correct one, and supply it with
       this option. If you have programs with duplicate long names, you also need to specify the program ID with
       the full name. This can be done by adding the id to the name with the <u>@&lt;id&gt;</u> suffix.

   <b>-P,</b> <b>--promiscuous-mode</b>
       This option puts the interface into promiscuous mode.

   <b>-s,</b> <b>--snapshot-length</b> <b>&lt;snaplen&gt;</b>
       Capture <b>snaplen</b> bytes of a packet rather than the default 262144 bytes.

   <b>--use-pcap</b>
       Use legacy pcap format for XDP traces. By default, it will use the PcapNG format so  that  it  can  store
       various metadata.

   <b>-w,</b> <b>--write</b> <b>&lt;file&gt;</b>
       Write  the  raw packets to a pcap file rather than printing them out hexadecimal. Standard output is used
       if <b>file</b> is <u>-</u>.

   <b>-x,</b> <b>--hex</b>
       When dumping packets on the console also print the full packet content in hex.

   <b>-v,</b> <b>--verbose</b>
       Enable debug logging. Specify twice for even more verbosity.

   <b>--version</b>
       Display <u>xpdump</u> version information and exit.

   <b>-h,</b> <b>--help</b>
       Display a summary of the available options

</pre><h4><b>Examples</b></h4><pre>
       The below will load the <u>xdp-filter</u> program on eth0, but it does not do any actual filtering:

              # xdp-filter load --mode skb eth0
              #
              # xdpdump -D
              Interface        Prio  Program name      Mode     ID   Tag               Chain actions
              --------------------------------------------------------------------------------------
              lo                     &lt;No XDP program loaded!&gt;
              eth0                   xdp_dispatcher    skb      10651 d51e469e988d81da
               =&gt;              10     xdpfilt_alw_all           10669 0b394f43ab24501c  XDP_PASS

       Now we can try <u>xdpdump</u>:

              # xdpdump -i eth0 -x
              listening on eth0, ingress XDP program ID 10651 func xdp_dispatcher, capture mode entry, capture size 262144 bytes
              1584373839.460733895: xdp_dispatcher()@entry: packet size 102 bytes, captured 102 bytes on if_index 2, rx queue 0, id 1
                0x0000:  52 54 00 db 44 b6 52 54 00 34 38 da 08 00 45 48  RT..D.RT.48...EH
                0x0010:  00 58 d7 dd 40 00 40 06 ec c3 c0 a8 7a 01 c0 a8  .X..@.@.....z...
                0x0020:  7a 64 9c de 00 16 0d d5 c6 bc 46 c9 bb 11 80 18  zd........F.....
                0x0030:  01 f5 7b b4 00 00 01 01 08 0a 77 0a 8c b8 40 12  ..{.......w...@.
                0x0040:  cc a6 00 00 00 10 54 ce 6e 20 c3 e7 da 6c 08 42  ......T.n ...l.B
                0x0050:  d6 d9 ee 42 42 f0 82 c9 4f 12 ed 7b 19 ab 22 0d  ...BB...O..{..".
                0x0060:  09 29 a9 ee df 89                                .)....

              1584373839.462340808: xdp_dispatcher()@entry: packet size 66 bytes, captured 66 bytes on if_index 2, rx queue 0, id 2
                0x0000:  52 54 00 db 44 b6 52 54 00 34 38 da 08 00 45 48  RT..D.RT.48...EH
                0x0010:  00 34 d7 de 40 00 40 06 ec e6 c0 a8 7a 01 c0 a8  .4..@.@.....z...
                0x0020:  7a 64 9c de 00 16 0d d5 c6 e0 46 c9 bc 85 80 10  zd........F.....
                0x0030:  01 f5 74 0c 00 00 01 01 08 0a 77 0a 8c ba 40 12  ..t.......w...@.
                0x0040:  d2 34                                            .4
              ^C
              2 packets captured
              0 packets dropped by perf ring

       Below are two more examples redirecting the capture file to <u>tcpdump</u> or <u>tshark</u>:

              # xdpdump -i eth0 -w - | tcpdump -r - -n
              listening on eth0, ingress XDP program ID 10651 func xdp_dispatcher, capture mode entry, capture size 262144 bytes
              reading from file -, link-type EN10MB (Ethernet)
              15:55:09.075887 IP 192.168.122.1.40928 &gt; 192.168.122.100.ssh: Flags [P.], seq 3857553815:3857553851, ack 3306438882, win 501, options [nop,nop,TS val 1997449167 ecr 1075234328], length 36
              15:55:09.077756 IP 192.168.122.1.40928 &gt; 192.168.122.100.ssh: Flags [.], ack 37, win 501, options [nop,nop,TS val 1997449169 ecr 1075244363], length 0
              15:55:09.750230 IP 192.168.122.1.40928 &gt; 192.168.122.100.ssh: Flags [P.], seq 36:72, ack 37, win 501, options [nop,nop,TS val 1997449842 ecr 1075244363], length 36

              # xdpdump -i eth0 -w - | tshark -r - -n
              listening on eth0, ingress XDP program ID 10651 func xdp_dispatcher, capture mode entry, capture size 262144 bytes
                  1   0.000000 192.168.122.1 → 192.168.122.100 SSH 102 Client: Encrypted packet (len=36)
                  2   0.000646 192.168.122.1 → 192.168.122.100 TCP 66 40158 → 22 [ACK] Seq=37 Ack=37 Win=1467 Len=0 TSval=1997621571 TSecr=1075416765
                  3  12.218164 192.168.122.1 → 192.168.122.100 SSH 102 Client: Encrypted packet (len=36)

       One final example capturing specific XDP programs loaded on the interface:

              # xdpdump -D
              Interface        Prio  Program name      Mode     ID   Tag               Chain actions
              --------------------------------------------------------------------------------------
              lo                     &lt;No XDP program loaded!&gt;
              eth0                   xdp_dispatcher    skb      10558 d51e469e988d81da
               =&gt;              5      xdp_test_prog_w           10576 b5a46c6e9935298c  XDP_PASS
               =&gt;              10     xdp_pass                  10582 3b185187f1855c4c  XDP_PASS
               =&gt;              10     xdp_pass                  10587 3b185187f1855c4c  XDP_PASS

       We would like to see the packets on the <u>xdp_dispatcher()</u> and the 2nd <u>xdp_pass()</u> program:

              # xdpdump -i eth0 --rx-capture=entry,exit -p xdp_dispatcher,xdp_pass@10587
                or
              # xdpdump -i eth0 --rx-capture=entry,exit -p 10558,10587
              listening on eth0, ingress XDP program ID 10558 func xdp_dispatcher, ID 10587 func xdp_pass, capture mode entry/exit, capture size 262144 bytes
              1607694215.501287259: xdp_dispatcher()@entry: packet size 102 bytes on if_index 2, rx queue 0, id 1
              1607694215.501371504: xdp_pass()@entry: packet size 102 bytes on if_index 2, rx queue 0, id 1
              1607694215.501383099: xdp_pass()@exit[PASS]: packet size 102 bytes on if_index 2, rx queue 0, id 1
              1607694215.501394709: xdp_dispatcher()@exit[PASS]: packet size 102 bytes on if_index 2, rx queue 0, id 1
              ^C
              4 packets captured
              0 packets dropped by perf ring

</pre><h4><b>BUGS</b></h4><pre>
       Please report any bugs on Github: <u>https://github.com/xdp-project/xdp-tools/issues</u>

</pre><h4><b>AUTHOR</b></h4><pre>
       <u>xdpdump</u> was written by Eelco Chaudron

V1.5.1                                          JANUARY 13, 2021                                      <u><a href="../man8/xdpdump.8.html">xdpdump</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>