<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dhcpoptinj — DHCP option injector, a tool to manipulate DHCP packet options</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/dhcpoptinj">dhcpoptinj_0.5.3-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       dhcpoptinj — DHCP option injector, a tool to manipulate DHCP packet options

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>dhcpoptinj</b> [<b>-c</b> [<u>conf_file</u>]] [<b>-df</b>] [<b>--forward-on-fail</b>] [<b>-i</b>|<b>-r</b>] [<b>-p</b> [<u>pid_file</u>]] <b>-q</b> <u>queue_num</u> <b>-o</b> <u>dhcp_option</u>
                  [(<b>-o</b> <u>dhcp_option</u>) ...]
       <b>dhcpoptinj</b> <b>-h</b>|<b>-v</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>dhcpoptinj</b>  is  a  fairly simple tool for manipulating DHCP options in a BOOTP/DHCP packet.  It relies on
       netfilter queue and nftables/iptables rules, in which you specify what packets  to  send  to  <b>dhcpoptinj</b>.
       <b>dhcpoptinj</b>  waits  for packets to arrive in a netfilter queue.  It will ensure that a packet is in fact a
       BOOTP/DHCP packet, and if so proceed to inject or replace options.  It will recalculate the  IPv4  header
       checksum,  disable  the  UDP  checksum  (for  a  simpler implementation) and then give the packet back to
       netfilter.

       Based on the options <b>--ignore-existing-opt</b> and <b>--remove-existing-opt</b>  <b>dhcpoptinj</b>  may  be  configured  to
       replace  matching  options  or  leave  them in place.  <b>--forward-on-fail</b> can be used to accept the packet
       (leaving it unaltered) if the package mangling should fail for any reason.

   <b>Invocation</b>
       <b>dhcpoptinj</b> (incorrectly) requires flags to run.  The netfilter queue number (<b>--queue</b>) is  necessary,  and
       also at least one DHCP option (<b>--option</b>).  See “EXAMPLES”.

       <u>Note</u> that <b>dhcpoptinj</b> must be run by a user with the CAP_NET_ADMIN capability.  The recommended way is not
       to  run  <b>dhcpoptinj</b>  as  root.   Instead,  you can for instance grant the CAP_NET_ADMIN capability to the
       binary (using <u>setcap</u>) and limit execution rights to only a specific user or group.

   <b>Argument</b> <b>list</b> <b>processing</b>
       <b>dhcpoptinj</b> is invoked only with options and no arguments:

             <b>-c</b>, <b>--conf-file</b> [<u>conf_file</u>]         Specify     a     different     configuration     file     than
                                                 <u>/etc/dhcpoptinj.conf</u>.  If empty no file will be loaded.

             <b>-d</b>, <b>--debug</b>                         Make <b>dhcpoptinj</b> tell you as much as possible about what it does
                                                 and tries to do.

             <b>-f</b>, <b>--foreground</b>                    Prevent <b>dhcpoptinj</b> from running in the background.

                 <b>--forward-on-fail</b>               If  the  process  of  injecting  options  should  fail, let the
                                                 unaltered DHCP packet pass through.  The default  behaviour  is
                                                 to drop the packet if options could not be injected.

             <b>-h</b>, <b>--help</b>                          Print a help text.

             <b>-i</b>, <b>--ignore-existing-opt</b>           Proceed  if  an  injected option already exists in the original
                                                 packet.  Unless <b>--remove-existing-opt</b> is provided, the  default
                                                 behaviour is to drop the packet.

             <b>-o</b>, <b>--option</b> <u>dhcp_option</u>            DHCP  option  to  inject  as a hex string, where the first byte
                                                 indicates  the  option  code.   The  option  length  field   is
                                                 automatically  calculated and must be omitted.  Several options
                                                 may be injected.

                                                 The hex string may be delimited by  non-hexadecimal  characters
                                                 for  readability.   The  following  hex strings all produce the
                                                 same result: '01 02 03', '01:02:03', '010203', '01 &lt;-&gt;  02  &lt;-&gt;
                                                 03'.  Remember to quote these arguments if they contains spaces
                                                 or other characters that have special meaning to your shell.

             <b>-p</b>, <b>--pid-file</b> [<u>pid_file</u>]           Write  PID  to file (<u>/var/run/dhcpoptinj.pid</u>) or to a specified
                                                 location.

             <b>-q</b>, <b>--queue</b> <u>queue_num</u>               The netfilter queue number to use

             <b>-r</b>, <b>--remove-existing-opt</b>           Remove existing DHCP options of the same kind as  those  to  be
                                                 injected.

             <b>-v</b>, <b>--version</b>                       Display version.

   <b>DHCP</b> <b>options</b>
       All  the  DHCP  options passed with the <b>-o</b>/<b>--option</b> flag will be added before the terminating option (end
       option, 255).  The packet is padded if necessary and sent back to netfilter.  None of the  added  options
       are  checked  for  whether  they  are  valid,  or  whether  the  option codes are valid.  Options are not
       (automatically) padded individually, but they can be manually padded by adding options with code  0  (one
       pad  byte  per  option).   This special option is the only option that does not have any payload (the end
       option, 255, is inserted automatically and cannot be manually added).  Padding individual options  should
       not be necessary.

       The option hex string is written as a series of two-digit pairs, optionally delimited by one or more non-
       hexadecimal  characters:  '466A6173','46  6A  61 73', '46:6A:61:73' etc.  There is a limit of maximum 256
       bytes per option, excluding the option code (the first byte) and the automatically inserted length  byte.
       At least one option must be provided.

       If  the  packet  already  contains  a DHCP option that is to be injected (matched by code), the behaviour
       depends on the command line options <b>--ignore-existing-opt</b> and <b>--remove-existing-opt</b>:

             (none)  The packet will be dropped.

             <b>-i</b>      The existing options are ignored and the injected options are added.

             <b>-r</b>      Any existing options are removed and the injected options are added.

       <u>Note</u> that injected options will not be injected in the same place as those that may have been removed  if
       using <b>-r</b>.  However, this should not matter.

</pre><h4><b>FILES</b></h4><pre>
       At  startup <b>dhcpoptinj</b> reads <u>/etc/dhcpoptinj.conf</u>.  If the file does not exist no error will be produced.
       Another file may be specified with <b>-c</b>/<b>--conf-file</b>.  The syntax of the file is a list of  key–value  pairs
       separated  by  newlines.  Keys  must  match long option names and if the option takes an argument it must
       follow the symbol '='. Whitespace is accepted anywhere on the line. Values may optionally be enclosed  in
       single or double quotes.

       DHCP  options  must  be  listed  one-by-one,  as  on  the  command  line, and not as a list. The keywords
       <u>conf-file</u>, <u>help</u> and <u>version</u> are not accepted. Anything after and including the character <u>#</u> is  considered
       a comment and is ignored.

       The following shows an example configuration file:

             # Run in foreground:
             foreground
             # Enable debug output:
             debug
             # Override hostname to "fjasehost":
             option = '0C 66 6A 61 73 65 68 6F 73 74'
             # Send agent ID "Fjas":
             option = "52:01:04:46:6A:61:73"
             # Override address request to ask for 10.20.30.40:
             option=320A141E28
             # Use queue 12:
             queue = 12

             remove-existing-opt # Remove options before inserting

       Any  option  on  the  command  line will override a setting in the configuration file. However, note that
       options with arguments,  like  <b>--foreground</b>  cannot  be  removed/negated  if  it  has  been  set  in  the
       configuration  file.   If  any  DHCP  option is passed on the command line all DHCP options listed in the
       configuration file is ignored.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       The <b>dhcpoptinj</b> utility exits 0 on success, and &gt;0 if an error occurs.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Let us say you have two interfaces bridged together, eth0 and eth1.  Let us say you want to intercept all
       BOOTP requests coming from eth0 and inject the relay agent information option (82/0x52).  Let us make  up
       a  payload  consisting of just a string that we can match in a DHCP server like dnsmasq to send different
       routes to the client: An agent circuit ID sub-option with the value "Fjas".

       Add a rule to the iptables mangle table:

             <b>sudo</b> <b>iptables</b> <b>-t</b> <b>mangle</b> <b>-A</b> <b>PREROUTING</b> <b>-m</b> <b>physdev</b> <b>--physdev-in</b> <b>eth0</b> <b>-p</b> <b>udp</b>  <b>--dport</b>  <b>67</b>  <b>-j</b>  <b>NFQUEUE</b>
             <b>--queue-num</b> <b>42</b>

       Then run <b>dhcpoptinj</b> (let us run it in the foreground with extra debug output):

             <b>sudo</b> <b>dhcpoptinj</b> <b>-d</b> <b>-f</b> <b>-q</b> <b>42</b> <b>-o'52</b> <b>01</b> <b>04</b> <b>46</b> <b>6A</b> <b>61</b> <b>73'</b>

       Now  send  a  DHCP  packet  to  the  eth0  interface  and watch it (using a tool like Wireshark (https://
       www.wireshark.org/) having been modified when it reaches the  bridged  interface.   It  should  have  the
       injected  option  at the end of the option list.  If you capture the incoming DHCP packet with Wireshark,
       it will appear unmodified although it will in fact be mangled.

       Note the format of the argument to the <b>-o</b> option: It should be a hexadecimal  string  starting  with  the
       DHCP  option  code followed by the option payload.  The option length (the byte that normally follows the
       option code) is automatically calculated and must not be specified.  The hex string can be  delimited  by
       non-hexadecimal  characters for readability.  All options must have a payload, except for the special pad
       option (https://tools.ietf.org/html/rfc2132#section-2) (code 0).

       The layout of the nonsensical option used in this example, 52 01 04 46 6A 61 73, (first the  DHCP  option
       layout  (https://tools.ietf.org/html/rfc2132#section-2), then the specific relay agent information option
       sub-option layout (https://tools.ietf.org/html/rfc3046#section-2.0)) is as follows:

       ┌──────┬────────┬────────────────────────────┐
       │ Code │ Length │            Data            │
       ├──────┼────────┼────────────────────────────┤
       │  52  │ (auto) │ 01 04 46 6A 61 73 ("Fjas") │
       └──────┴────────┴────────────────────────────┘

       ┌──────────┬───────┬──────────────────────┐
       │ Sub-opt. │ Lenth │         Data         │
       ├──────────┼───────┼──────────────────────┤
       │    01    │   4   │ 46 6A 61 73 ("Fjas") │
       └──────────┴───────┴──────────────────────┘

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/iptables.8.html">iptables</a>(8), <a href="../man8/nftables.8.html">nftables</a>(8), <a href="../man5/dhcp-options.5.html">dhcp-options</a>(5)

</pre><h4><b>AUTHORS</b></h4><pre>
       Andreas Misje &lt;<a href="mailto:amisje@gmail.com">amisje@gmail.com</a>&gt;

Debian                                             May 9, 2019                                     <u><a href="../man8/DHCPOPTINJ.8.html">DHCPOPTINJ</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>