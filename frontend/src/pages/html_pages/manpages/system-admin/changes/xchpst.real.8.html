<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xchpst — eXtended CHange Process STate</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/xchpst">xchpst_0.4.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       xchpst — eXtended CHange Process STate

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>xchpst</b> <b>--help</b>
       <b>xchpst</b> <b>--version</b>
       <b>xchpst</b> <b>--exit</b>[=<u>retcode</u>]
       <b>xchpst</b> [<u>OPTIONS</u>] [<b>--</b>] <u>command</u> <u>...</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>xchpst</b>  utility  changes  process state according to the supplied options and then calls <b>exec</b>() on a
       named executable with the positional arguments.

       <b>xchpst</b> is a backwards-compatible extension to the <u><a href="../man8/chpst.8.html">chpst</a></u>(8) tool which is  supplied  with  runit.   <b>xchpst</b>
       enables  runit  service  scripts  to take advantage of hardening capabilities available with recent Linux
       kernels such as namespaces and capabilities.  <b>xchpst</b> can set up shadow  subtrees  within  the  filesystem
       hierarchy  to  isolate  long-running  services  from  parts  of the system to which they ought to need no
       access, e.g. with private <u><a href="file:/tmp">/tmp</a></u> areas and read-only <u>/usr.</u>

   <b>Extended</b> <b>xchpst</b> <b>options</b>
       The extra options provided by <b>xchpst</b> are as follows:

       <b>--help</b>      Show help text and usage.

       <b>--exit</b>[=<u>retcode</u>]
                   Exit immediately with exit  status  0  if  the  given  options  are  supported.   <u>retcode</u>  if
                   specified.

       <b>--mount-ns</b>  Create new mount namespace.  Various other options also implicitly enable mount namespaces as
                   this  is  important  to  their  operation;  this  option  is rarely likely to be needed to be
                   specified explicitly.

       <b>--net-ns</b>    Create new network namespace.  This will more or less isolate the process from the networking
                   subsystem.

       <b>--uts-ns</b>    Create new UTS namespace.

       <b>--pid-ns</b>    Create a PID namespace.  This implies <b>--fork-join</b> because a new process is needed to  act  as
                   PID 1 and in order to be able to mount a new procfs for the namespace.

       <b>--fork-join</b>
                   Fork  a  new  process  and wait for it to finish, passing on to the child process any signals
                   received by the  <b>xchpst</b>  process.   This  option  is  necessary  to  take  advantage  of  PID
                   namespaces.  The exit status is that of the child process.

       <b>--user-ns</b>   Create a user namespace.

       <b>--adopt-net</b> <u>path</u>
                   Adopt  the  network namespace bound to <u>path</u>.  The binding will be deleted from the filesystem
                   meaning that the namespace will disappear when the  process  exits,  if  there  is  no  other
                   reference  to  it. This allows the calling script to set up a suitable networking environment
                   for the process and hand it over.

       <b>--new-root</b>  Create a new root filesystem (will implicitly enable the creation of a new mount  namespace).
                   The  new  root  filesystem  is  created  as  a tmpfs and all the top-level directories in the
                   original root filesystem are bind mounted and any symlinks are replicated.

       <b>--private-run</b>
                   Mount an isolated <u><a href="file:/run">/run</a></u> directory for the process.  Unless /X.Fl -new-root is also  specified,
                   the old shared <a href="file:/run">/run</a> directory will still be accessible if the stacked mount is removed.

       <b>--private-tmp</b>
                   Mount  an  isolated <u><a href="file:/tmp">/tmp</a></u> directory for the process.  Unless <b>--new-root</b> is also specified, the
                   old shared <a href="file:/run">/run</a> directory will still be accessible if the stacked mount is removed.

       <b>--protect-home</b>
                   Mount isolated <u><a href="file:/home">/home</a></u>, <u><a href="file:/root">/root</a></u> <u>and</u> <u><a href="file:/run/user">/run/user</a></u> directories for the process.  Unless <b>--new-root</b>  is
                   also  specified,  the  old  shared  host  directories will still be accessible if the stacked
                   mounts are removed.

       <b>--ro-sys</b>    Create a read-only filesystem hierarchy.  Converts <u><a href="file:/usr">/usr</a></u>  and  <u><a href="file:/boot">/boot</a></u>  into  read-only  mounts.
                   Note  that  if  the hardened process has the rights to unmount filesystems, it can reveal the
                   original writable filesystems.  The <b>--new-root</b> option is designed to prevent this.

       <b>--caps-bs-keep</b> <u>capability</u>[,capability...]
                   Keeps only the listed capabilities in the bounding set.

       <b>--caps-bs-drop</b> <u>capability</u>[,capability...]
                   Drops the listed capabilities from the bounding  set.   Use  only  one  of  the  two  options
                   governing the bounding set.

       <b>--caps-keep</b> <u>capability</u>[,capability...]
                   Retain the listed capabilities when dropping to a non-root user.

       <b>--caps-drop</b> <u>capability</u>[,capability...]
                   Drop the listed capabilities when dropping to a non-root user, but retain all others.

       <b>--no-new-privs</b>
                   Prevent    the    target    application    from    obtaining   any   new   privileges.    See
                   <u><a href="../man2const/PR_SET_NO_NEW_PRIVS.2const.html">PR_SET_NO_NEW_PRIVS</a></u>(2const).

       <b>--scheduler</b> <u>other</u> | <u>batch</u> | <u>idle</u>
                   Set the scheduler policy, as per <u><a href="../man2/sched_setscheduler.2.html">sched_setscheduler</a></u>(2).

       <b>--io-nice</b> <b>rt</b>|<b>best-effort</b>|<b>idle</b>[:<u>priority</u>]
                   Set the I/O scheduler policy and priority, as per <u><a href="../man1/ionice.1.html">ionice</a></u>(1).

       <b>--cpus</b> <u>start</u>[-<u>end</u>[:<u>stride</u>]][,...]
                   Set CPU affinity in the same format as <u><a href="../man1/taskset.1.html">taskset</a></u>(1).

       <b>--umask</b> <u>mode</u>
                   Set umask to the octal value <u>mode</u>.

       <b>--app</b> <u>name</u>  Override program name used for pre-creating system directories.

       <b>--run-dir</b>   Create a directory for the program under <u><a href="file:/run">/run</a></u>, owned by the appropriate user.

       <b>--state-dir</b>
                   Create a directory for the program under <u><a href="file:/var/lib">/var/lib</a></u>, owned by the appropriate user.

       <b>--log-dir</b>   Create a directory for the program under <u><a href="file:/var/log">/var/log</a></u>, owned by the appropriate user.

       <b>--cache-dir</b>
                   Create a directory for the program under <u><a href="file:/var/cache">/var/cache</a></u>, owned by the appropriate user.

       <b>--login</b>     Create a login environment, using the user specified by -u, -U or the current user, in  order
                   of  preference.  If this option is specified and no command is specified to be executed, then
                   the shell defined for the given user is launched, instead of an error being returned.

       <b>-s</b> <u>bytes</u>    Set soft limit for stack segment size.

       <b>-a</b> <u>bytes</u>    Set soft limit for address space size.

       <b>--memlock</b> <u>bytes</u>
                   Set soft limit for amount of locked memory.

       <b>-@</b>          Switches to chpst-compatible option handling only for  the  remaining  options.  This  is  to
                   support scripts that can convert an <b>xchpst</b> invocation into a command line for <b>chpst</b> if <b>xchpst</b>
                   is not present on the system.

   <b>chpst-compatible</b> <b>options</b>
       The options compatible with classic <b>chpst</b> are as follows:

       <b>-u</b> <u>user</u>[<u>:group</u>]...
                 Set  uid,  gid and supplementary groups. Prepend the argument with a colon for numerical inputs
                 rather than names to be looked up. If no group is specified then the specified user's group  is
                 used. There is no space within the argument.

       <b>-U</b> <u>user</u>[<u>:group</u>]
                 Like  <b>-u</b>  but  the  environment  variables  UID  and  GID are set instead of changing the user.
                 Supplementary groups are ignored.

       <b>-b</b> <u>argv0</u>  Set <u>argv[0]</u> to <u>argv0</u> instead of the target executable path when launching the program.

       <b>-e</b> <u>dir</u>    Populate environment.  For every file  within  <u>dir</u>,  the  filename  represents  an  environment
                 variable  that  will be set or unset.  The first line of the corresponding files is the content
                 to be set, with NUL characters replaced by LF and trailing whitespace removed.  If the file  is
                 0  bytes  long  then  the  variable  is  unset.   (So a file with just a newline results in the
                 variable being set with an empty value.)

       <b>-/</b> <u>dir</u>    Run in a chroot.  Change to the <u>dir</u> directory and make it the new root.

       <b>-C</b> <u>dir</u>    Change directory.  Change to the <u>dir</u> directory (after any chroot setting is applied).

       <b>-n</b> <u>inc</u>    Increase niceness by <u>inc</u>, which can be negative, resulting  in  the  process  taking  a  higher
                 priority.

       <b>-l</b> <u>file</u>   Wait for lock. Take a lock out on <u>file</u> and wait to obtain it before proceeding to <b>exec</b>().

       <b>-L</b> <u>file</u>   Try to obtain lock; bail out if it can't be obtained.

       <b>-m</b> <u>bytes</u>  Set soft limit for data and stack segments and virtual memory size and locked memory.

       <b>-d</b> <u>bytes</u>  Set soft limit for data segment size.

       <b>-o</b> <u>files</u>  Set soft limit for the number of open files.

       <b>-p</b> <u>procs</u>  Set soft limit for the number of processes for this user.

       <b>-f</b> <u>bytes</u>  Set soft limit for the size of file that this process may create.

       <b>-c</b> <u>bytes</u>  Set soft limit for the size of core this process may dump.

       <b>-t</b> <u>seconds</u>
                 Set soft limit for the amount of CPU time this process may consume.

       <b>-v</b>        Be verbose. This option may be repeated for increased verbosity to support debugging.

       <b>-V</b>        Show <b>xchpst</b> version number.

       <b>-P</b>        Make this process the process group leader, allocating a new session idea.

       <b>-0</b>        Close stdin.

       <b>-1</b>        Close stout.

       <b>-2</b>        Close stderr.

   <b>Emulating</b> <b>ancestor</b> <b>tools</b>
       When  invoked  as  <b>chpst</b>,  <b>envdir</b>,  <b>envuidgid</b>,  <b>pgrphack</b>,  <b>setlock</b>,  <b>setuidgid</b>,  or <b>softlimit</b>, the <b>xchpst</b>
       executable emulates the corresponding tools from the “runit” or “daemontools” packages respectively.   As
       an additional feature, all these tools when so invoked, accept the <b>-v</b> option to increase verbosity.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       0       The  default  exit  status  when <b>--exit</b> is specified is 0. This can be used for a quick test that
               <b>xchpst</b> is available on the system in shell scripts and that the given options are supported.

       100     The return code when an invalid option or option argument is specified, including if  a  username
               cannot be resolved, for example.

       111     When the requested process state cannot be changed.

       other   The <b>--exit</b> option takes an optional argument with a return code to use.

       If  there  is  no  error  and  the  intended application is <b>exec</b>()'d, the exit status will be that of the
       application, not <b>xchpst</b>.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Testing the emulation of ‘envdir’:
             <b>xchpst</b> <b>-b</b> <b>envdir</b> <b>--</b> <b>xchpst</b>

       Launch with read-only filesystem if <b>xchpst</b> is available, else use <b>chpst</b>:
             <b>xchpst</b>  <b>--exit</b>  <b>&amp;&amp;</b>  <b>exec</b>  <b>xchpst</b>  <b>--ro-sys</b>  <b>-l</b>  <b>/var/lock/ntpsec-ntpdate</b>  <b>ntpd;</b>   <b>exec</b>   <b>chpst</b>   <b>-l</b>
             <b>/var/log/ntpsec-ntpdate</b> <b>ntpd</b>

       Drop a capability from the bounding set:
             <b>xchpst</b> <b>--cap-bs-drop</b> <b>CAP_SYS_ADMIN</b> <b>--</b> <b>acmed</b>

       Drop user while retaining some capabilities:
             <b>xchpst</b>  <b>-u</b>  <b>:500:500</b>  <b>--caps-keep</b>  <b>CAP_DAC_OVERRIDE</b> <b>fakeroot</b> <b>/usr/sbin/gpm</b> <b>-D</b> <b>-m</b> <b>/dev/input/mice</b> <b>-t</b>
             <b>exps2</b>

   <b>Diagnostics</b>
       To see what is going on, including options enabled implicitly due to other options, add  the  ‘--verbose’
       option.

       Use ‘--login’ without a command name to explore the hardened environment from a shell.

       You can enter the created namespaces (but not other aspects of hardening), including any synthesised root
       filesystem, by identifying the process id of the hardened application and running:
             <b>nsenter</b> <b>-a</b> <b>-t</b> <b>PID</b>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man8/chpst.8.html">chpst</a></u>(8), <u><a href="../man8/runit.8.html">runit</a></u>(8), <u><a href="../man1/unshare.1.html">unshare</a></u>(1), <u><a href="../man1/capsh.1.html">capsh</a></u>(1), <u>taskset</u>(1,) <u><a href="../man1/chrt.1.html">chrt</a></u>(1)

</pre><h4><b>HISTORY</b></h4><pre>
       <b>xchpst</b> version 0.x has an unstable interface for initial feature development.

       <b>xchpst</b>  was  written  from  scratch  to  be  backwards  compatible with <b>chpst</b>.  The extent of the planned
       extensions dwarfing the complexity of the original options led to the decision to write a new tool rather
       than extending the existing one.  The new <b>xchpst</b> tool is targeted at new versions of Linux  distributions
       so is written with a recent tooling and kernel baseline.

       <b>xchpst</b>  has  different  design  principles  from <b>chpst</b>.  Use <b>xchpst</b> if you need the additional options to
       harden runit-supervised tasks; use <b>chpst</b> if you do not need them, for a minimal footprint.

</pre><h4><b>AUTHORS</b></h4><pre>
       Andrew Bower &lt;<u><a href="mailto:andrew@bower.uk">andrew@bower.uk</a></u>&gt;

</pre><h4><b>BUGS</b></h4><pre>
       Please raise bug reports at: https://gitlab.com/abower/xchpst/-/issues

Debian                                          December 25, 2024                                      <u><a href="../man8/xchpst.8.html">xchpst</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>