<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pam_faillock - Module counting authentication failures during a specified interval</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libpam-runtime">libpam-runtime_1.7.0-5ubuntu1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pam_faillock - Module counting authentication failures during a specified interval

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>auth</b> <b>...</b> <b>pam_faillock.so</b> {preauth|authfail|authsucc} [conf=<u>/path/to/config-file</u>]
                                [dir=<u>/path/to/tally-directory</u>] [even_deny_root] [deny=<u>n</u>] [fail_interval=<u>n</u>]
                                [unlock_time=<u>n</u>] [root_unlock_time=<u>n</u>] [admin_group=<u>name</u>] [audit] [silent]
                                [no_log_info]

       <b>account</b> <b>...</b> <b>pam_faillock.so</b> [dir=<u>/path/to/tally-directory</u>] [no_log_info]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This module maintains a list of failed authentication attempts per user during a specified interval and
       locks the account in case there were more than <u>deny</u> consecutive failed authentications.

       Normally, failed attempts to authenticate <u>root</u> will <b>not</b> cause the root account to become blocked, to
       prevent denial-of-service: if your users aren't given shell accounts and root may only login via <b>su</b> or at
       the machine console (not telnet/rsh, etc), this is safe.

</pre><h4><b>OPTIONS</b></h4><pre>
       {preauth|authfail|authsucc}
           This argument must be set accordingly to the position of this module instance in the PAM stack.

           The <u>preauth</u> argument must be used when the module is called before the modules which ask for the user
           credentials such as the password. The module just examines whether the user should be blocked from
           accessing the service in case there were anomalous number of failed consecutive authentication
           attempts recently. This call is optional if <u>authsucc</u> is used.

           The <u>authfail</u> argument must be used when the module is called after the modules which determine the
           authentication outcome, failed. Unless the user is already blocked due to previous authentication
           failures, the module will record the failure into the appropriate user tally file.

           The <u>authsucc</u> argument must be used when the module is called after the modules which determine the
           authentication outcome, succeeded. Unless the user is already blocked due to previous authentication
           failures, the module will then clear the record of the failures in the respective user tally file.
           Otherwise it will return authentication error. If this call is not done, the pam_faillock will not
           distinguish between consecutive and non-consecutive failed authentication attempts. The <u>preauth</u> call
           must be used in such case. Due to complications in the way the PAM stack can be configured it is also
           possible to call <u>pam_faillock</u> as an account module. In such configuration the module must be also
           called in the <u>preauth</u> stage.

       conf=/path/to/config-file
           Use another configuration file instead of the default /etc/security/faillock.conf.

       The options for configuring the module behavior are described in the <b><a href="../man5/faillock.conf.5.html">faillock.conf</a></b>(5) manual page. The
       options specified on the module command line override the values from the configuration file.

</pre><h4><b>MODULE</b> <b>TYPES</b> <b>PROVIDED</b></h4><pre>
       The <b>auth</b> and <b>account</b> module types are provided.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       PAM_AUTH_ERR
           An invalid option was given, the module was not able to retrieve the user name, no valid counter file
           was found, or too many failed logins.

       PAM_BUF_ERR
           Memory buffer error.

       PAM_CONV_ERR
           The conversation method supplied by the application failed to obtain the username.

       PAM_INCOMPLETE
           The conversation method supplied by the application returned PAM_CONV_AGAIN.

       PAM_SUCCESS
           Everything was successful.

       PAM_IGNORE
           User not present in passwd database.

</pre><h4><b>NOTES</b></h4><pre>
       Configuring options on the module command line is not recommend. The <a href="file:/etc/security/faillock.conf">/etc/security/faillock.conf</a> should
       be used instead.

       The setup of <u>pam_faillock</u> in the PAM stack is different from the <u>pam_tally2</u> module setup.

       Individual files with the failure records are created as owned by the user. This allows <b>pam_faillock.so</b>
       module to work correctly when it is called from a screensaver.

       Note that using the module in <b>preauth</b> without the <b>silent</b> option specified in <a href="file:/etc/security/faillock.conf">/etc/security/faillock.conf</a>
       or with <u>requisite</u> control field leaks an information about existence or non-existence of a user account
       in the system because the failures are not recorded for the unknown users. The message about the user
       account being locked is never displayed for non-existing user accounts allowing the adversary to infer
       that a particular account is not existing on a system.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Here are two possible configuration examples for /etc/pam.d/login. They make <u>pam_faillock</u> to lock the
       account after 4 consecutive failed logins during the default interval of 15 minutes. Root account will be
       locked as well. The accounts will be automatically unlocked after 20 minutes.

       In the first example the module is called only in the <u>auth</u> phase and the module does not print any
       information about the account being blocked by <u>pam_faillock</u>. The <u>preauth</u> call can be added to tell users
       that their logins are blocked by the module and also to abort the authentication without even asking for
       password in such case.

       <a href="file:/etc/security/faillock.conf">/etc/security/faillock.conf</a> file example:

           deny=4
           unlock_time=1200
           silent

       /etc/pam.d/config file example:

           auth     required       pam_securetty.so
           auth     required       pam_env.so
           auth     required       pam_nologin.so
           # optionally call: auth requisite pam_faillock.so preauth
           # to display the message about account being locked
           auth     [success=1 default=bad] pam_unix.so
           auth     [default=die]  pam_faillock.so authfail
           auth     sufficient     pam_faillock.so authsucc
           auth     required       pam_deny.so
           account  required       pam_unix.so
           password required       pam_unix.so shadow
           session  required       pam_selinux.so close
           session  required       pam_loginuid.so
           session  required       pam_unix.so
           session  required       pam_selinux.so open

       In the second example the module is called both in the <u>auth</u> and <u>account</u> phases and the module informs the
       authenticating user when the account is locked if <b>silent</b> option is not specified in the faillock.conf.

           auth     required       pam_securetty.so
           auth     required       pam_env.so
           auth     required       pam_nologin.so
           auth     required       pam_faillock.so preauth
           # optionally use requisite above if you do not want to prompt for the password
           # on locked accounts
           auth     sufficient     pam_unix.so
           auth     [default=die]  pam_faillock.so authfail
           auth     required       pam_deny.so
           account  required       pam_faillock.so
           # if you drop the above call to pam_faillock.so the lock will be done also
           # on non-consecutive authentication failures
           account  required       pam_unix.so
           password required       pam_unix.so shadow
           session  required       pam_selinux.so close
           session  required       pam_loginuid.so
           session  required       pam_unix.so
           session  required       pam_selinux.so open

</pre><h4><b>FILES</b></h4><pre>
       /var/run/faillock/*
           the files logging the authentication failures for users

           Note: These files will disappear after reboot on systems configured with directory /var/run/faillock
           mounted on virtual memory. For persistent storage use the option <u>dir=</u> in file
           /etc/security/faillock.conf.

       <a href="file:/etc/security/faillock.conf">/etc/security/faillock.conf</a>
           the config file for pam_faillock options

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/faillock.8.html">faillock</a></b>(8), <b><a href="../man5/faillock.conf.5.html">faillock.conf</a></b>(5), <b><a href="../man5/pam.conf.5.html">pam.conf</a></b>(5), <b><a href="../man5/pam.d.5.html">pam.d</a></b>(5), <b><a href="../man8/pam.8.html">pam</a></b>(8)

</pre><h4><b>AUTHOR</b></h4><pre>
       pam_faillock was written by Tomas Mraz.

[FIXME: source]                                    07/03/2025                                    <u><a href="../man8/PAM_FAILLOCK.8.html">PAM_FAILLOCK</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>