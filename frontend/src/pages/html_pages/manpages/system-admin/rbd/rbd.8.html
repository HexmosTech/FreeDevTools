<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rbd - manage rados block device (RBD) images</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/ceph-common">ceph-common_19.2.1-0ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       rbd - manage rados block device (RBD) images

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>rbd</b> [ -c <u>ceph.conf</u> ] [ -m <u>monaddr</u> ] [--cluster <u>cluster-name</u>]
       [ -p | --pool <u>pool</u> ] [ <u>command</u> ... ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>rbd</b>  is  a utility for manipulating rados block device (RBD) images, used by the Linux rbd driver and the
       rbd storage driver for QEMU/KVM.  RBD images are simple block devices that are striped over  objects  and
       stored in a RADOS object store. The size of the objects the image is striped over must be a power of two.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-c</b> <b>ceph.conf,</b> <b>--conf</b> <b>ceph.conf</b>
              Use  ceph.conf  configuration file instead of the default /etc/ceph/ceph.conf to determine monitor
              addresses during startup.

       <b>-m</b> <b>monaddress[:port]</b>
              Connect to specified monitor (instead of looking through ceph.conf).

       <b>--cluster</b> <b>cluster-name</b>
              Use different cluster name as compared to default cluster name <u>ceph</u>.

       <b>-p</b> <b>pool-name,</b> <b>--pool</b> <b>pool-name</b>
              Interact with the given pool. Required by most commands.

       <b>--namespace</b> <b>namespace-name</b>
              Use a pre-defined image namespace within a pool

       <b>--no-progress</b>
              Do not output progress information (goes to standard error by default for some commands).

</pre><h4><b>PARAMETERS</b></h4><pre>
       <b>--image-format</b> <b>format-id</b>
              Specifies which object layout to use. The default is 2.

              • format 1 - (deprecated) Use the original format for a new rbd image. This format  is  understood
                by  all  versions  of librbd and the kernel rbd module, but does not support newer features like
                cloning.

              • format 2 - Use the second rbd format, which is supported by librbd since the Bobtail release and
                the kernel rbd module since kernel 3.10 (except for "fancy" striping, which is  supported  since
                kernel 4.17). This adds support for cloning and is more easily extensible to allow more features
                in the future.

       <b>-s</b> <b>size-in-M/G/T,</b> <b>--size</b> <b>size-in-M/G/T</b>
              Specifies the size of the new rbd image or the new size of the existing rbd image in M/G/T.  If no
              suffix is given, unit M is assumed.

       <b>--object-size</b> <b>size-in-B/K/M</b>
              Specifies  the  object size in B/K/M.  Object size will be rounded up the nearest power of two; if
              no suffix is given, unit B is assumed.  The default object size is 4M, smallest is 4K and  maximum
              is 32M.

              The  default  value  can be changed with the configuration option <b>rbd_default_order</b>, which takes a
              power of two (default object size is <b>2</b> <b>^</b> <b>rbd_default_order</b>).

       <b>--stripe-unit</b> <b>size-in-B/K/M</b>
              Specifies the stripe unit size in B/K/M.  If no suffix is given, unit B is assumed.  See  striping
              section (below) for more details.

       <b>--stripe-count</b> <b>num</b>
              Specifies  the  number  of  objects  to  stripe over before looping back to the first object.  See
              striping section (below) for more details.

       <b>--snap</b> <b>snap</b>
              Specifies the snapshot name for the specific operation.

       <b>--id</b> <b>username</b>
              Specifies the username (without the <b>client.</b> prefix) to use with the map command.

       <b>--keyring</b> <b>filename</b>
              Specifies a keyring file containing a secret for the specified user to use with the  map  command.
              If not specified, the default keyring locations will be searched.

       <b>--keyfile</b> <b>filename</b>
              Specifies  a file containing the secret key of <b>--id</b> <b>user</b> to use with the map command.  This option
              is overridden by <b>--keyring</b> if the latter is also specified.

       <b>--shared</b> <b>lock-tag</b>
              Option for <u>lock</u> <u>add</u> that allows multiple clients to lock the same image if they use the same  tag.
              The  tag  is  an  arbitrary string. This is useful for situations where an image must be open from
              more than one client at once, like during  live  migration  of  a  virtual  machine,  or  for  use
              underneath a clustered file system.

       <b>--format</b> <b>format</b>
              Specifies output formatting (default: plain, json, xml)

       <b>--pretty-format</b>
              Make json or xml formatted output more human-readable.

       <b>-o</b> <b>krbd-options,</b> <b>--options</b> <b>krbd-options</b>
              Specifies  which  options  to  use  when  mapping or unmapping an image via the rbd kernel driver.
              krbd-options is a comma-separated list of options (similar to <a href="../man8/mount.8.html">mount</a>(8) mount options).  See kernel
              rbd (krbd) options section below for more details.

       <b>--read-only</b>
              Map the image read-only.  Equivalent to -o ro.

       <b>--image-feature</b> <b>feature-name</b>
              Specifies which RBD format 2 feature should be enabled when creating an image.  Multiple  features
              can be enabled by repeating this option multiple times. The following features are supported:

              • layering: layering support

              • striping: striping v2 support

              • exclusive-lock: exclusive locking support

              • object-map: object map support (requires exclusive-lock)

              • fast-diff: fast diff calculations (requires object-map)

              • deep-flatten: snapshot flatten support

              • journaling: journaled IO support (requires exclusive-lock)

              • data-pool: erasure coded pool support

       <b>--image-shared</b>
              Specifies  that  the  image  will  be  used  concurrently  by multiple clients.  This will disable
              features that are dependent upon exclusive ownership of the image.

       <b>--whole-object</b>
              Specifies that the diff should be limited to the extents of  a  full  object  instead  of  showing
              intra-object  deltas. When the object map feature is enabled on an image, limiting the diff to the
              object extents will dramatically improve performance since the  differences  can  be  computed  by
              examining the in-memory object map instead of querying RADOS for each object within the image.

       <b>--limit</b>
              Specifies the limit for the number of snapshots permitted.

</pre><h4><b>COMMANDS</b></h4><pre>
       <b>bench</b> --io-type &lt;read | write | readwrite | rw&gt; [--io-size <u>size-in-B/K/M/G/T</u>] [--io-threads
       <u>num-ios-in-flight</u>] [--io-total <u>size-in-B/K/M/G/T</u>] [--io-pattern seq | rand] [--rw-mix-read <u>read</u>
       <u>proportion</u> <u>in</u> <u>readwrite</u>] <u>image-spec</u>
              Generate  a series of IOs to the image and measure the IO throughput and latency.  If no suffix is
              given, unit B is assumed for  both  --io-size  and  --io-total.   Defaults  are:  --io-size  4096,
              --io-threads 16, --io-total 1G, --io-pattern seq, --rw-mix-read 50.

       <b>children</b> <u>snap-spec</u>
              List  the  clones  of  the  image  at  the given snapshot. This checks every pool, and outputs the
              resulting poolname/imagename.

              This requires image format 2.

       <b>clone</b> [--object-size <u>size-in-B/K/M</u>] [--stripe-unit <u>size-in-B/K/M</u> --stripe-count <u>num</u>] [--image-feature
       <u>feature-name</u>] [--image-shared] <u>parent-snap-spec</u> <u>child-image-spec</u>
              Will create a clone (copy-on-write child) of the parent snapshot.  Object size will  be  identical
              to  that  of  the parent image unless specified. Size will be the same as the parent snapshot. The
              --stripe-unit and --stripe-count arguments are optional, but must be used together.

              The parent snapshot must be protected (see <u>rbd</u> <u>snap</u> <u>protect</u>).  This requires image format 2.

       <b>config</b> <b>global</b> <b>get</b> <u>config-entity</u> <u>key</u>
              Get a global-level configuration override.

       <b>config</b> <b>global</b> <b>list</b> [--format plain | json | xml] [--pretty-format] <u>config-entity</u>
              List global-level configuration overrides.

       <b>config</b> <b>global</b> <b>set</b> <u>config-entity</u> <u>key</u> <u>value</u>
              Set a global-level configuration override.

       <b>config</b> <b>global</b> <b>remove</b> <u>config-entity</u> <u>key</u>
              Remove a global-level configuration override.

       <b>config</b> <b>image</b> <b>get</b> <u>image-spec</u> <u>key</u>
              Get an image-level configuration override.

       <b>config</b> <b>image</b> <b>list</b> [--format plain | json | xml] [--pretty-format] <u>image-spec</u>
              List image-level configuration overrides.

       <b>config</b> <b>image</b> <b>set</b> <u>image-spec</u> <u>key</u> <u>value</u>
              Set an image-level configuration override.

       <b>config</b> <b>image</b> <b>remove</b> <u>image-spec</u> <u>key</u>
              Remove an image-level configuration override.

       <b>config</b> <b>pool</b> <b>get</b> <u>pool-name</u> <u>key</u>
              Get a pool-level configuration override.

       <b>config</b> <b>pool</b> <b>list</b> [--format plain | json | xml] [--pretty-format] <u>pool-name</u>
              List pool-level configuration overrides.

       <b>config</b> <b>pool</b> <b>set</b> <u>pool-name</u> <u>key</u> <u>value</u>
              Set a pool-level configuration override.

       <b>config</b> <b>pool</b> <b>remove</b> <u>pool-name</u> <u>key</u>
              Remove a pool-level configuration override.

       <b>cp</b> (<u>src-image-spec</u> | <u>src-snap-spec</u>) <u>dest-image-spec</u>
              Copy the content of a src-image into the newly created dest-image.  dest-image will have the  same
              size,  object  size,  and  image format as src-image.  Note: snapshots are not copied, use <u>deep</u> <u>cp</u>
              command to include snapshots.

       <b>create</b> (-s | --size <u>size-in-M/G/T</u>) [--image-format <u>format-id</u>] [--object-size <u>size-in-B/K/M</u>]
       [--stripe-unit <u>size-in-B/K/M</u> --stripe-count <u>num</u>] [--thick-provision] [--no-progress] [--image-feature
       <u>feature-name</u>]... [--image-shared] <u>image-spec</u>
              Will create a new rbd image. You must also specify the size via  --size.   The  --stripe-unit  and
              --stripe-count  arguments  are  optional,  but must be used together.  If the --thick-provision is
              enabled, it will fully allocate storage for the image at creation time. It will take a  long  time
              to do.  Note: thick provisioning requires zeroing the contents of the entire image.

       <b>deep</b> <b>cp</b> (<u>src-image-spec</u> | <u>src-snap-spec</u>) <u>dest-image-spec</u>
              Deep  copy the content of a src-image into the newly created dest-image.  Dest-image will have the
              same size, object size, image format, and snapshots as src-image.

       <b>device</b> <b>list</b> [-t | --device-type <u>device-type</u>] [--format plain | json | xml] --pretty-format
              Show the rbd images that are mapped via the rbd kernel module (default) or other supported device.

       <b>device</b> <b>map</b> [-t | --device-type <u>device-type</u>] [--cookie <u>device-cookie</u>] [--show-cookie] [--snap-id <u>snap-id</u>]
       [--read-only] [--exclusive] [-o | --options <u>device-options</u>] <u>image-spec</u> | <u>snap-spec</u>
              Map the specified image to a block device via the rbd kernel module (default) or  other  supported
              device (<u>nbd</u> or <u>ubbd</u> on Linux or <u>ggate</u> on FreeBSD).

              The   --options   argument   is   a   comma   separated  list  of  device  type  specific  options
              (opt1,opt2=val,...).

       <b>device</b> <b>unmap</b> [-t | --device-type <u>device-type</u>] [-o | --options <u>device-options</u>] [--snap-id <u>snap-id</u>]
       <u>image-spec</u> | <u>snap-spec</u> | <u>device-path</u>
              Unmap the block device that was mapped via the rbd kernel  module  (default)  or  other  supported
              device.

              The   --options   argument   is   a   comma   separated  list  of  device  type  specific  options
              (opt1,opt2=val,...).

       <b>device</b> <b>attach</b> [-t | --device-type <u>device-type</u>] --device <u>device-path</u> [--cookie <u>device-cookie</u>]
       [--show-cookie] [--snap-id <u>snap-id</u>] [--read-only] [--exclusive] [--force] [-o | --options <u>device-options</u>]
       <u>image-spec</u> | <u>snap-spec</u>
              Attach the specified image to the specified block device  (currently  only  <u>nbd</u>  on  Linux).  This
              operation is unsafe and should not be normally used.  In particular, specifying the wrong image or
              the  wrong  block  device  may lead to data corruption as no validation is performed by <u>nbd</u> kernel
              driver.

              The  --options  argument  is  a  comma  separated   list   of   device   type   specific   options
              (opt1,opt2=val,...).

       <b>device</b> <b>detach</b> [-t | --device-type <u>device-type</u>] [-o | --options <u>device-options</u>] [--snap-id <u>snap-id</u>]
       <u>image-spec</u> | <u>snap-spec</u> | <u>device-path</u>
              Detach  the block device that was mapped or attached (currently only <u>nbd</u> on Linux). This operation
              is unsafe and should not be normally used.

              The  --options  argument  is  a  comma  separated   list   of   device   type   specific   options
              (opt1,opt2=val,...).

       <b>diff</b> [--from-snap <u>snap-name</u>] [--whole-object] <u>image-spec</u> | <u>snap-spec</u>
              Dump  a list of byte extents in the image that have changed since the specified start snapshot, or
              since the image was created.  Each output line includes the starting offset (in bytes), the length
              of the region (in bytes), and either 'zero' or 'data' to indicate whether the region is  known  to
              be zeros or may contain other data.

       <b>du</b> [-p | --pool <u>pool-name</u>] [<u>image-spec</u> | <u>snap-spec</u>] [--merge-snapshots]
              Will calculate the provisioned and actual disk usage of all images and associated snapshots within
              the specified pool.  It can also be used against individual images and snapshots.

              If  the  RBD  fast-diff feature is not enabled on images, this operation will require querying the
              OSDs for every potential object within the image.

              The --merge-snapshots will merge snapshots used space into their parent images.

       <b>encryption</b> <b>format</b> <u>image-spec</u> <u>format</u> <u>passphrase-file</u> [--cipher-alg <u>alg</u>]
              Formats image to an encrypted format.  All data  previously  written  to  the  image  will  become
              unreadable.   Supported  formats:  <u>luks1</u>,  <u>luks2</u>.   Supported  cipher algorithms: <u>aes-128</u>, <u>aes-256</u>
              (default).

       <b>export</b> [--export-format <u>format</u> <u>(1</u> <u>or</u> <u>2)</u>] (<u>image-spec</u> | <u>snap-spec</u>) [<u>dest-path</u>]
              Export image to dest path (use - for stdout).  The --export-format accepts '1' or  '2'  currently.
              Format  2  allow  us  to  export  not  only the content of image, but also the snapshots and other
              properties, such as image_order, features.

       <b>export-diff</b> [--from-snap <u>snap-name</u>] [--whole-object] (<u>image-spec</u> | <u>snap-spec</u>) <u>dest-path</u>
              Export an incremental diff for an image to dest path (use - for stdout).  If an  initial  snapshot
              is  specified,  only changes since that snapshot are included; otherwise, any regions of the image
              that contain data are included.  The end snapshot is specified using the standard --snap option or
              @snap syntax (see below).  The image diff format includes metadata about image size  changes,  and
              the start and end snapshots.  It efficiently represents discarded or 'zero' regions of the image.

       <b>feature</b> <b>disable</b> <u>image-spec</u> <u>feature-name</u>...
              Disable the specified feature on the specified image. Multiple features can be specified.

       <b>feature</b> <b>enable</b> <u>image-spec</u> <u>feature-name</u>...
              Enable the specified feature on the specified image. Multiple features can be specified.

       <b>flatten</b> [--encryption-format <u>encryption-format</u> --encryption-passphrase-file <u>passphrase-file</u>]...
       <u>image-spec</u>
              If  the  image  is  a  clone,  copy  all shared blocks from the parent snapshot and make the child
              independent of the parent, severing the link between parent snap and child.  The  parent  snapshot
              can be unprotected and deleted if it has no further dependent clones.

              This requires image format 2.

       <b>group</b> <b>create</b> <u>group-spec</u>
              Create a group.

       <b>group</b> <b>image</b> <b>add</b> <u>group-spec</u> <u>image-spec</u>
              Add an image to a group.

       <b>group</b> <b>image</b> <b>list</b> <u>group-spec</u>
              List images in a group.

       <b>group</b> <b>image</b> <b>remove</b> <u>group-spec</u> <u>image-spec</u>
              Remove an image from a group.

       <b>group</b> <b>ls</b> [-p | --pool <u>pool-name</u>]
              List rbd groups.

       <b>group</b> <b>rename</b> <u>src-group-spec</u> <u>dest-group-spec</u>
              Rename a group.  Note: rename across pools is not supported.

       <b>group</b> <b>rm</b> <u>group-spec</u>
              Delete a group.

       <b>group</b> <b>snap</b> <b>create</b> <u>group-snap-spec</u>
              Make a snapshot of a group.

       <b>group</b> <b>snap</b> <b>list</b> <u>group-spec</u>
              List snapshots of a group.

       <b>group</b> <b>snap</b> <b>rm</b> <u>group-snap-spec</u>
              Remove a snapshot from a group.

       <b>group</b> <b>snap</b> <b>rename</b> <u>group-snap-spec</u> <u>snap-name</u>
              Rename group's snapshot.

       <b>group</b> <b>snap</b> <b>rollback</b> <u>group-snap-spec</u>
              Rollback group to snapshot.

       <b>image-meta</b> <b>get</b> <u>image-spec</u> <u>key</u>
              Get metadata value with the key.

       <b>image-meta</b> <b>list</b> <u>image-spec</u>
              Show metadata held on the image. The first column is the key and the second column is the value.

       <b>image-meta</b> <b>remove</b> <u>image-spec</u> <u>key</u>
              Remove metadata key with the value.

       <b>image-meta</b> <b>set</b> <u>image-spec</u> <u>key</u> <u>value</u>
              Set metadata key with the value. They will displayed in <u>image-meta</u> <u>list</u>.

       <b>import</b> [--export-format <u>format</u> <u>(1</u> <u>or</u> <u>2)</u>] [--image-format <u>format-id</u>] [--object-size <u>size-in-B/K/M</u>]
       [--stripe-unit <u>size-in-B/K/M</u> --stripe-count <u>num</u>] [--image-feature <u>feature-name</u>]... [--image-shared]
       <u>src-path</u> [<u>image-spec</u>]
              Create a new image and import its data from path (use - for stdin).  The import operation will try
              to  create  sparse  rbd images if possible.  For import from stdin, the sparsification unit is the
              data block size of the destination image (object size).

              The --stripe-unit and --stripe-count arguments are optional, but must be used together.

              The --export-format accepts '1' or '2' currently. Format 2 allow us to import not only the content
              of image, but also the snapshots and other properties, such as image_order, features.

       <b>import-diff</b> <u>src-path</u> <u>image-spec</u>
              Import an incremental diff of an image and apply it  to  the  current  image.   If  the  diff  was
              generated  relative to a start snapshot, we verify that snapshot already exists before continuing.
              If there was an end snapshot we verify it does not already exist before applying the changes,  and
              create the snapshot when we are done.

       <b>info</b> <u>image-spec</u> | <u>snap-spec</u>
              Will  dump information (such as size and object size) about a specific rbd image.  If the image is
              a clone, information about its parent is also displayed.  If a snapshot is specified,  whether  it
              is protected is shown as well.

       <b>journal</b> <b>client</b> <b>disconnect</b> <u>journal-spec</u>
              Flag image journal client as disconnected.

       <b>journal</b> <b>export</b> [--verbose] [--no-error] <u>src-journal-spec</u> <u>path-name</u>
              Export  image  journal  to  path  (use - for stdout). It can be make a backup of the image journal
              especially before attempting dangerous operations.

              Note that this command may not always work if the journal is badly corrupted.

       <b>journal</b> <b>import</b> [--verbose] [--no-error] <u>path-name</u> <u>dest-journal-spec</u>
              Import image journal from path (use - for stdin).

       <b>journal</b> <b>info</b> <u>journal-spec</u>
              Show information about image journal.

       <b>journal</b> <b>inspect</b> [--verbose] <u>journal-spec</u>
              Inspect and report image journal for structural errors.

       <b>journal</b> <b>reset</b> <u>journal-spec</u>
              Reset image journal.

       <b>journal</b> <b>status</b> <u>journal-spec</u>
              Show status of image journal.

       <b>lock</b> <b>add</b> [--shared <u>lock-tag</u>] <u>image-spec</u> <u>lock-id</u>
              Lock an image. The lock-id is an arbitrary name for the user's convenience. By default, this is an
              exclusive lock, meaning it will fail if the image is already locked. The --shared  option  changes
              this  behavior.  Note that locking does not affect any operation other than adding a lock. It does
              not protect an image from being deleted.

       <b>lock</b> <b>ls</b> <u>image-spec</u>
              Show locks held on the image. The first column is the locker to use with the <u>lock</u> <u>remove</u> command.

       <b>lock</b> <b>rm</b> <u>image-spec</u> <u>lock-id</u> <u>locker</u>
              Release a lock on an image. The lock id and locker are as output by lock ls.

       <b>ls</b> [-l | --long] [<u>pool-name</u>]
              Will list all rbd images listed in the rbd_directory object.  With -l, also  show  snapshots,  and
              use longer-format output including size, parent (if clone), format, etc.

       <b>merge-diff</b> <u>first-diff-path</u> <u>second-diff-path</u> <u>merged-diff-path</u>
              Merge  two  continuous  incremental  diffs  of an image into one single diff. The first diff's end
              snapshot must be equal with the second diff's start snapshot.  The  first  diff  could  be  -  for
              stdin, and merged diff could be - for stdout, which enables multiple diff files to be merged using
              something  like 'rbd merge-diff first second - | rbd merge-diff - third result'. Note this command
              currently only support the source incremental diff with stripe-count == 1

       <b>migration</b> <b>abort</b> <u>image-spec</u>
              Cancel image migration. This step may be run after  successful  or  failed  migration  prepare  or
              migration  execute  steps  and  returns  the  image  to  its initial (before migration) state. All
              modifications to the destination image are lost.

       <b>migration</b> <b>commit</b> <u>image-spec</u>
              Commit image migration. This step is run after successful migration prepare and migration  execute
              steps and removes the source image data.

       <b>migration</b> <b>execute</b> <u>image-spec</u>
              Execute  image  migration.  This  step is run after a successful migration prepare step and copies
              image data to the destination.

       <b>migration</b> <b>prepare</b> [--order <u>order</u>] [--object-size <u>object-size</u>] [--image-feature <u>image-feature</u>]
       [--image-shared] [--stripe-unit <u>stripe-unit</u>] [--stripe-count <u>stripe-count</u>] [--data-pool <u>data-pool</u>]
       [--import-only] [--source-spec <u>json</u>] [--source-spec-path <u>path</u>] <u>src-image-spec</u> [<u>dest-image-spec</u>]
              Prepare image migration. This is the first step when migrating an image, i.e. changing  the  image
              location,  format or other parameters that can't be changed dynamically. The destination can match
              the source, and in this case <u>dest-image-spec</u> can be omitted.  After this step the source image  is
              set as a parent of the destination image, and the image is accessible in copy-on-write mode by its
              destination spec.

              An  image can also be migrated from a read-only import source by adding the <u>--import-only</u> optional
              and providing a JSON-encoded <u>--source-spec</u> or a path to a JSON-encoded source-spec file using  the
              <u>--source-spec-path</u> optionals.

       <b>mirror</b> <b>image</b> <b>demote</b> <u>image-spec</u>
              Demote a primary image to non-primary for RBD mirroring.

       <b>mirror</b> <b>image</b> <b>disable</b> [--force] <u>image-spec</u>
              Disable  RBD  mirroring for an image. If the mirroring is configured in <b>image</b> mode for the image's
              pool, then it must be disabled for each image individually.

       <b>mirror</b> <b>image</b> <b>enable</b> <u>image-spec</u> <u>mode</u>
              Enable RBD mirroring for an image. If the mirroring is configured in <b>image</b> mode  for  the  image's
              pool, then it must be enabled for each image individually.

              The  mirror  image mode can either be <b>journal</b> (default) or <b>snapshot</b>. The <b>journal</b> mode requires the
              RBD journaling feature.

       <b>mirror</b> <b>image</b> <b>promote</b> [--force] <u>image-spec</u>
              Promote a non-primary image to primary for RBD mirroring.

       <b>mirror</b> <b>image</b> <b>resync</b> <u>image-spec</u>
              Force resync to primary image for RBD mirroring.

       <b>mirror</b> <b>image</b> <b>status</b> <u>image-spec</u>
              Show RBD mirroring status for an image.

       <b>mirror</b> <b>pool</b> <b>demote</b> [<u>pool-name</u>]
              Demote all primary images within a pool or namespace to non-primary.  Every  mirror-enabled  image
              in the pool or namespace will be demoted.

       <b>mirror</b> <b>pool</b> <b>disable</b> [<u>pool-name</u>]
              Disable  RBD  mirroring  within  a  pool  or  namespace.  When  mirroring is disabled on a pool or
              namespace in this way, mirroring will  also  be  disabled  on  all  images  (within  the  pool  or
              namespace) for which mirroring was enabled, whether by default or explicitly.

       <b>mirror</b> <b>pool</b> <b>enable</b> [<u>pool-name</u>] <u>mode</u>
              Enable  RBD mirroring within a pool or namespace.  The mirroring mode can either be <b>pool</b> or <b>image</b>.
              If configured in <b>pool</b> mode, all images in the  pool  or  namespace  with  the  journaling  feature
              enabled  are  mirrored.  If configured in <b>image</b> mode, mirroring needs to be explicitly enabled (by
              <b>mirror</b> <b>image</b> <b>enable</b> command) on each image.

       <b>mirror</b> <b>pool</b> <b>info</b> [<u>pool-name</u>]
              Show information about the pool or namespace mirroring configuration.  For  a  pool,  it  includes
              mirroring  mode,  peer  UUID,  remote  cluster  name,  and remote client name. For a namespace, it
              includes only mirroring mode.

       <b>mirror</b> <b>pool</b> <b>peer</b> <b>add</b> [<u>pool-name</u>] <u>remote-cluster-spec</u>
              Add a mirroring peer to a pool.  <u>remote-cluster-spec</u> is [<u>remote</u> <u>client</u> <u>name</u>@]<u>remote</u> <u>cluster</u> <u>name</u>.

              The default for <u>remote</u> <u>client</u> <u>name</u> is "client.admin".

              This requires mirroring to be enabled on the pool.

       <b>mirror</b> <b>pool</b> <b>peer</b> <b>remove</b> [<u>pool-name</u>] <u>uuid</u>
              Remove a mirroring peer from a pool. The peer uuid is available from <b>mirror</b> <b>pool</b> <b>info</b> command.

       <b>mirror</b> <b>pool</b> <b>peer</b> <b>set</b> [<u>pool-name</u>] <u>uuid</u> <u>key</u> <u>value</u>
              Update mirroring peer settings.  The key can be  either  <b>client</b>  or  <b>cluster</b>,  and  the  value  is
              corresponding to remote client name or remote cluster name.

       <b>mirror</b> <b>pool</b> <b>promote</b> [--force] [<u>pool-name</u>]
              Promote  all non-primary images within a pool or namespace to primary.  Every mirror-enabled image
              in the pool or namespace will be promoted.

       <b>mirror</b> <b>pool</b> <b>status</b> [--verbose] [<u>pool-name</u>]
              Show status for all mirrored images in the pool or namespace.   With  <b>--verbose</b>,  show  additional
              output status details for every mirror-enabled image in the pool or namespace.

       <b>mirror</b> <b>snapshot</b> <b>schedule</b> <b>add</b> [-p | --pool <u>pool</u>] [--namespace <u>namespace</u>] [--image <u>image</u>] <u>interval</u>
       [<u>start-time</u>]
              Add mirror snapshot schedule.

       <b>mirror</b> <b>snapshot</b> <b>schedule</b> <b>list</b> [-R | --recursive] [--format <u>format</u>] [--pretty-format] [-p | --pool <u>pool</u>]
       [--namespace <u>namespace</u>] [--image <u>image</u>]
              List mirror snapshot schedule.

       <b>mirror</b> <b>snapshot</b> <b>schedule</b> <b>remove</b> [-p | --pool <u>pool</u>] [--namespace <u>namespace</u>] [--image <u>image</u>] <u>interval</u>
       [<u>start-time</u>]
              Remove mirror snapshot schedule.

       <b>mirror</b> <b>snapshot</b> <b>schedule</b> <b>status</b> [-p | --pool <u>pool</u>] [--format <u>format</u>] [--pretty-format] [--namespace
       <u>namespace</u>] [--image <u>image</u>]
              Show mirror snapshot schedule status.

       <b>mv</b> <u>src-image-spec</u> <u>dest-image-spec</u>
              Rename an image.  Note: rename across pools is not supported.

       <b>namespace</b> <b>create</b> <u>pool-name</u>/<u>namespace-name</u>
              Create a new image namespace within the pool.

       <b>namespace</b> <b>list</b> <u>pool-name</u>
              List image namespaces defined within the pool.

       <b>namespace</b> <b>remove</b> <u>pool-name</u>/<u>namespace-name</u>
              Remove an empty image namespace from the pool.

       <b>object-map</b> <b>check</b> <u>image-spec</u> | <u>snap-spec</u>
              Verify the object map is correct.

       <b>object-map</b> <b>rebuild</b> <u>image-spec</u> | <u>snap-spec</u>
              Rebuild  an  invalid  object  map  for  the specified image. An image snapshot can be specified to
              rebuild an invalid object map for a snapshot.

       <b>pool</b> <b>init</b> [<u>pool-name</u>] [--force]
              Initialize pool for use by RBD. Newly created pools must be initialized prior to use.

       <b>resize</b> (-s | --size <u>size-in-M/G/T</u>) [--allow-shrink] [--encryption-format <u>encryption-format</u>
       --encryption-passphrase-file <u>passphrase-file</u>]... <u>image-spec</u>
              Resize rbd image. The size parameter also needs to be specified.  The --allow-shrink  option  lets
              the size be reduced.

       <b>rm</b> <u>image-spec</u>
              Delete  an  rbd  image  (including  all  data  blocks). If the image has snapshots, this fails and
              nothing is deleted.

       <b>snap</b> <b>create</b> <u>snap-spec</u>
              Create a new snapshot. Requires the snapshot name parameter to be specified.

       <b>snap</b> <b>limit</b> <b>clear</b> <u>image-spec</u>
              Remove any previously set limit on the number of snapshots allowed on an image.

       <b>snap</b> <b>limit</b> <b>set</b> [--limit] <u>limit</u> <u>image-spec</u>
              Set a limit for the number of snapshots allowed on an image.

       <b>snap</b> <b>ls</b> <u>image-spec</u>
              Dump the list of snapshots of a specific image.

       <b>snap</b> <b>protect</b> <u>snap-spec</u>
              Protect a snapshot from deletion, so that clones can be made of it  (see  <u>rbd</u>  <u>clone</u>).   Snapshots
              must  be  protected  before  clones are made; protection implies that there exist dependent cloned
              children that refer to this snapshot.  <u>rbd</u> <u>clone</u> will fail on a nonprotected snapshot.

              This requires image format 2.

       <b>snap</b> <b>purge</b> <u>image-spec</u>
              Remove all unprotected snapshots from an image.

       <b>snap</b> <b>rename</b> <u>src-snap-spec</u> <u>dest-snap-spec</u>
              Rename a snapshot. Note: rename across pools and images is not supported.

       <b>snap</b> <b>rm</b> [--force] <u>snap-spec</u>
              Remove the specified snapshot.

       <b>snap</b> <b>rollback</b> <u>snap-spec</u>
              Rollback image content to snapshot. This will iterate through the entire blocks array  and  update
              the data head content to the snapshotted version.

       <b>snap</b> <b>unprotect</b> <u>snap-spec</u>
              Unprotect a snapshot from deletion (undo <u>snap</u> <u>protect</u>).  If cloned children remain, <u>snap</u> <u>unprotect</u>
              fails.  (Note that clones may exist in different pools than the parent snapshot.)

              This requires image format 2.

       <b>sparsify</b> [--sparse-size <u>sparse-size</u>] <u>image-spec</u>
              Reclaim  space  for zeroed image extents. The default sparse size is 4096 bytes and can be changed
              via --sparse-size option with the following restrictions: it should be power of two, not less than
              4096, and not larger than image object size.

       <b>status</b> <u>image-spec</u>
              Show the status of the image, including which clients have it open.

       <b>trash</b> <b>ls</b> [<u>pool-name</u>]
              List all entries from trash.

       <b>trash</b> <b>mv</b> [--expires-at &lt;expires-at&gt;] <u>image-spec</u>
              Move an image to the trash. Images, even ones actively in-use by clones, can be moved to the trash
              and deleted at a later time. Use <b>--expires-at</b> to set the expiration time of an image  after  which
              it's allowed to be removed.

       <b>trash</b> <b>purge</b> [<u>pool-name</u>]
              Remove all expired images from trash.

       <b>trash</b> <b>restore</b> <u>image-id</u>
              Restore an image from trash.

       <b>trash</b> <b>rm</b> [--force] <u>image-id</u>
              Delete  an  image  from trash. If the image deferment time has not expired it can be removed using
              <b>--force</b>. An image that is actively in-use by clones or has snapshots cannot be removed.

       <b>trash</b> <b>purge</b> <b>schedule</b> <b>add</b> [-p | --pool <u>pool</u>] [--namespace <u>namespace</u>] <u>interval</u> [<u>start-time</u>]
              Add trash purge schedule.

       <b>trash</b> <b>purge</b> <b>schedule</b> <b>list</b> [-R | --recursive] [--format <u>format</u>] [--pretty-format] [-p | --pool <u>pool</u>]
       [--namespace <u>namespace</u>]
              List trash purge schedule.

       <b>trash</b> <b>purge</b> <b>schedule</b> <b>remove</b> [-p | --pool <u>pool</u>] [--namespace <u>namespace</u>] <u>interval</u> [<u>start-time</u>]
              Remove trash purge schedule.

       <b>trash</b> <b>purge</b> <b>schedule</b> <b>status</b> [-p | --pool <u>pool</u>] [--format <u>format</u>] [--pretty-format] [--namespace
       <u>namespace</u>]
              Show trash purge schedule status.

       <b>watch</b> <u>image-spec</u>
              Watch events on image.

</pre><h4><b>IMAGE,</b> <b>SNAP,</b> <b>GROUP</b> <b>AND</b> <b>JOURNAL</b> <b>SPECS</b></h4><pre>
       <u>image-spec</u>      is [<u>pool-name</u>/[<u>namespace-name</u>/]]<u>image-name</u>
       <u>snap-spec</u>       is [<u>pool-name</u>/[<u>namespace-name</u>/]]<u>image-name</u>@<u>snap-name</u>
       <u>group-spec</u>      is [<u>pool-name</u>/[<u>namespace-name</u>/]]<u>group-name</u>
       <u>group-snap-spec</u> is [<u>pool-name</u>/[<u>namespace-name</u>/]]<u>group-name</u>@<u>snap-name</u>
       <u>journal-spec</u>    is [<u>pool-name</u>/[<u>namespace-name</u>/]]<u>journal-name</u>

       The default for <u>pool-name</u> is "rbd" and <u>namespace-name</u> is "". If an image name contains a slash  character
       ('/'), <u>pool-name</u> is required.

       The <u>journal-name</u> is <u>image-id</u>.

       You  may specify each name individually, using --pool, --namespace, --image, and --snap options, but this
       is discouraged in favor of the above spec syntax.

</pre><h4><b>STRIPING</b></h4><pre>
       RBD images are striped over many objects, which are then stored by  the  Ceph  distributed  object  store
       (RADOS).   As  a  result,  read and write requests for the image are distributed across many nodes in the
       cluster, generally preventing any single node from becoming a bottleneck when individual images get large
       or busy.

       The striping is controlled by three parameters:

       <b>object-size</b>
              The size of objects we stripe over is a power of two. It will be rounded up the nearest  power  of
              two.  The default object size is 4 MB, smallest is 4K and maximum is 32M.

       <b>stripe-unit</b>
              Each [<u>stripe-unit</u>] contiguous bytes are stored adjacently in the same object, before we move on to
              the next object.

       <b>stripe-count</b>
              After  we  write [<u>stripe-unit</u>] bytes to [<u>stripe-count</u>] objects, we loop back to the initial object
              and write another stripe, until the object reaches its maximum size.  At that point, we move on to
              the next [<u>stripe-count</u>] objects.

       By default, [<u>stripe-unit</u>] is the same as the object size and [<u>stripe-count</u>] is 1.  Specifying a different
       [<u>stripe-unit</u>] and/or [<u>stripe-count</u>] is often referred to as using "fancy" striping and requires format 2.

</pre><h4><b>KERNEL</b> <b>RBD</b> <b>(KRBD)</b> <b>OPTIONS</b></h4><pre>
       Most of these options are useful mainly for debugging and benchmarking.  The default values  are  set  in
       the kernel and may therefore depend on the version of the running kernel.

       Per client instance <u>rbd</u> <u>device</u> <u>map</u> options:

       • fsid=aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee - FSID that should be assumed by the client.

       • ip=a.b.c.d[:p] - IP and, optionally, port the client should use.

       • share - Enable sharing of client instances with other mappings (default).

       • noshare - Disable sharing of client instances with other mappings.

       • crc  -  Enable CRC32C checksumming for msgr1 on-the-wire protocol (default).  For msgr2.1 protocol this
         option is ignored: full checksumming is always on in 'crc' mode and always off in 'secure' mode.

       • nocrc  -  Disable  CRC32C  checksumming  for  msgr1  on-the-wire  protocol.   Note  that  only  payload
         checksumming  is  disabled,  header  checksumming  is  always  on.  For msgr2.1 protocol this option is
         ignored.

       • cephx_require_signatures - Require msgr1 message signing feature (since 3.19, default).  This option is
         deprecated and will be removed in the future as the  feature  has  been  supported  since  the  Bobtail
         release.

       • nocephx_require_signatures  - Don't require msgr1 message signing feature (since 3.19).  This option is
         deprecated and will be removed in the future.

       • tcp_nodelay - Disable Nagle's algorithm on client sockets (since 4.0, default).

       • notcp_nodelay - Enable Nagle's algorithm on client sockets (since 4.0).

       • cephx_sign_messages - Enable message signing for msgr1 on-the-wire protocol (since 4.4, default).   For
         msgr2.1 protocol this option is ignored: message signing is built into 'secure' mode and not offered in
         'crc' mode.

       • nocephx_sign_messages  -  Disable  message  signing  for  msgr1  on-the-wire protocol (since 4.4).  For
         msgr2.1 protocol this option is ignored.

       • mount_timeout=x - A timeout on various steps in <u>rbd</u> <u>device</u> <u>map</u> and <u>rbd</u> <u>device</u> <u>unmap</u> sequences  (default
         is  60  seconds).  In particular, since 4.2 this can be used to ensure that <u>rbd</u> <u>device</u> <u>unmap</u> eventually
         times out when there is no network connection to a cluster.

       • osdkeepalive=x - OSD keepalive timeout (default is 5 seconds).

       • osd_idle_ttl=x - OSD idle TTL (default is 60 seconds).

       Per mapping (block device) <u>rbd</u> <u>device</u> <u>map</u> options:

       • rw - Map the image read-write (default).  Overridden by --read-only.

       • ro - Map the image read-only.  Equivalent to --read-only.

       • queue_depth=x - queue depth (since 4.2, default is 128 requests).

       • lock_on_read - Acquire exclusive lock on reads, in addition to writes and discards (since 4.9).

       • exclusive - Disable automatic exclusive lock transitions (since 4.12).  Equivalent to --exclusive.

       • lock_timeout=x - A timeout on waiting for the acquisition of exclusive lock (since 4.17, default  is  0
         seconds, meaning no timeout).

       • notrim  - Turn off discard and write zeroes offload support to avoid deprovisioning a fully provisioned
         image (since 4.17). When enabled, discard requests will fail with -EOPNOTSUPP,  write  zeroes  requests
         will fall back to manually zeroing.

       • abort_on_full  - Fail write requests with -ENOSPC when the cluster is full or the data pool reaches its
         quota (since 5.0).  The default behaviour is to block until the full condition is cleared.

       • alloc_size - Minimum allocation unit of the underlying OSD object store backend (since 5.1, default  is
         64K  bytes).   This  is  used  to  round  off and drop discards that are too small.  For bluestore, the
         recommended setting is  bluestore_min_alloc_size  (currently  set  to  4K  for  all  types  of  drives,
         previously  used  to be set to 64K for hard disk drives and 16K for solid-state drives).  For filestore
         with filestore_punch_hole = false, the recommended setting is image object size (typically 4M).

       • crush_location=x - Specify the location of the client in terms of CRUSH hierarchy (since 5.8).  This is
         a set of key-value pairs separated from each other by '|', with keys  separated  from  values  by  ':'.
         Note  that  '|'  may need to be quoted or escaped to avoid it being interpreted as a pipe by the shell.
         The key is the bucket type name (e.g. rack, datacenter or region with default  bucket  types)  and  the
         value  is  the  bucket  name.  For example, to indicate that the client is local to rack "myrack", data
         center "mydc" and region "myregion":

            crush_location=rack:myrack|datacenter:mydc|region:myregion

         Each key-value pair stands on its own: "myrack" doesn't need to reside in "mydc", which in turn doesn't
         need to reside in "myregion".  The location is not a path to the root of the hierarchy but rather a set
         of nodes that are matched independently, owning to the fact that bucket names are unique within a CRUSH
         map.  "Multipath" locations are supported, so it is possible to indicate locality for multiple parallel
         hierarchies:

            crush_location=rack:myrack1|rack:myrack2|datacenter:mydc

       • read_from_replica=no - Disable replica reads, always pick the primary OSD (since 5.8, default).

       • read_from_replica=balance - When issued a read on a replicated pool, pick a random OSD for  serving  it
         (since 5.8).

         This  mode  is  safe  for  general  use  only  since  Octopus (i.e. after "ceph osd require-osd-release
         octopus").  Otherwise it should be limited to read-only  workloads  such  as  images  mapped  read-only
         everywhere or snapshots.

       • read_from_replica=localize  -  When  issued  a  read  on a replicated pool, pick the most local OSD for
         serving it (since 5.8).  The locality metric is calculated against the location  of  the  client  given
         with crush_location; a match with the lowest-valued bucket type wins.  For example, with default bucket
         types,  an  OSD  in  a  matching rack is closer than an OSD in a matching data center, which in turn is
         closer than an OSD in a matching region.

         This mode is safe for general  use  only  since  Octopus  (i.e.  after  "ceph  osd  require-osd-release
         octopus").   Otherwise  it  should  be  limited  to read-only workloads such as images mapped read-only
         everywhere or snapshots.

       • compression_hint=none - Don't set compression hints (since 5.8, default).

       • compression_hint=compressible - Hint to the underlying OSD  object  store  backend  that  the  data  is
         compressible, enabling compression in passive mode (since 5.8).

       • compression_hint=incompressible  -  Hint  to  the  underlying OSD object store backend that the data is
         incompressible, disabling compression in aggressive mode (since 5.8).

       • ms_mode=legacy - Use msgr1 on-the-wire protocol (since 5.11, default).

       • ms_mode=crc - Use msgr2.1 on-the-wire protocol, select 'crc' mode,  also  referred  to  as  plain  mode
         (since 5.11).  If the daemon denies 'crc' mode, fail the connection.

       • ms_mode=secure  -  Use  msgr2.1 on-the-wire protocol, select 'secure' mode (since 5.11).  'secure' mode
         provides full in-transit encryption ensuring both confidentiality  and  authenticity.   If  the  daemon
         denies 'secure' mode, fail the connection.

       • ms_mode=prefer-crc  -  Use msgr2.1 on-the-wire protocol, select 'crc' mode (since 5.11).  If the daemon
         denies 'crc' mode in favor of 'secure' mode, agree to 'secure' mode.

       • ms_mode=prefer-secure - Use msgr2.1 on-the-wire protocol, select 'secure' mode (since  5.11).   If  the
         daemon denies 'secure' mode in favor of 'crc' mode, agree to 'crc' mode.

       • rxbounce  -  Use  a  bounce  buffer when receiving data (since 5.17).  The default behaviour is to read
         directly into the destination buffer.  A bounce buffer  is  needed  if  the  destination  buffer  isn't
         guaranteed  to  be stable (i.e. remain unchanged while it is being read to).  In particular this is the
         case for Windows where a system-wide "dummy" (throwaway) page may be mapped into the destination buffer
         in order to generate a single large I/O.  Otherwise, "libceph: ... bad crc/signature" or "libceph:  ...
         integrity error, bad crc" errors and associated performance degradation are expected.

       • udev - Wait for udev device manager to finish executing all matching "add" rules and release the device
         before exiting (default).  This option is not passed to the kernel.

       • noudev  -  Don't  wait  for  udev  device  manager.   When  enabled, the device may not be fully usable
         immediately on exit.

       <u>rbd</u> <u>device</u> <u>unmap</u> options:

       • force - Force the unmapping of a block device that is open (since  4.9).   The  driver  will  wait  for
         running  requests  to  complete  and then unmap; requests sent to the driver after initiating the unmap
         will be failed.

       • udev - Wait for udev device manager to finish executing all matching "remove" rules and clean up  after
         the device before exiting (default).  This option is not passed to the kernel.

       • noudev - Don't wait for udev device manager.

</pre><h4><b>EXAMPLES</b></h4><pre>
       To create a new rbd image that is 100 GB:

          rbd create mypool/myimage --size 102400

       To use a non-default object size (8 MB):

          rbd create mypool/myimage --size 102400 --object-size 8M

       To delete an rbd image (be careful!):

          rbd rm mypool/myimage

       To create a new snapshot:

          rbd snap create mypool/myimage@mysnap

       To create a copy-on-write clone of a protected snapshot:

          rbd clone mypool/myimage@mysnap otherpool/cloneimage

       To see which clones of a snapshot exist:

          rbd children mypool/myimage@mysnap

       To delete a snapshot:

          rbd snap rm mypool/myimage@mysnap

       To map an image via the kernel with cephx enabled:

          rbd device map mypool/myimage --id admin --keyfile secretfile

       To map an image via the kernel with different cluster name other than default <u>ceph</u>:

          rbd device map mypool/myimage --cluster cluster-name

       To unmap an image:

          rbd device unmap /dev/rbd0

       To create an image and a clone from it:

          rbd import --image-format 2 image mypool/parent
          rbd snap create mypool/parent@snap
          rbd snap protect mypool/parent@snap
          rbd clone mypool/parent@snap otherpool/child

       To create an image with a smaller stripe-unit (to better distribute small writes in some workloads):

          rbd create mypool/myimage --size 102400 --stripe-unit 65536B --stripe-count 16

       To  change  an  image from one image format to another, export it and then import it as the desired image
       format:

          rbd export mypool/myimage@snap /tmp/img
          rbd import --image-format 2 /tmp/img mypool/myimage2

       To lock an image for exclusive use:

          rbd lock add mypool/myimage mylockid

       To release a lock:

          rbd lock remove mypool/myimage mylockid client.2485

       To list images from trash:

          rbd trash ls mypool

       To defer delete an image (use <u>--expires-at</u> to set expiration time, default is now):

          rbd trash mv mypool/myimage --expires-at "tomorrow"

       To delete an image from trash (be careful!):

          rbd trash rm mypool/myimage-id

       To force delete an image from trash (be careful!):

          rbd trash rm mypool/myimage-id  --force

       To restore an image from trash:

          rbd trash restore mypool/myimage-id

       To restore an image from trash and rename it:

          rbd trash restore mypool/myimage-id --image mynewimage

</pre><h4><b>AVAILABILITY</b></h4><pre>
       <b>rbd</b> is part of Ceph, a massively scalable, open-source, distributed storage system. Please refer  to  the
       Ceph documentation at <u>https://docs.ceph.com</u> for more information.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man8/ceph.8.html">ceph</a></u>(8), <u><a href="../man8/rados.8.html">rados</a></u>(8)

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2010-2014,  Inktank  Storage,  Inc.  and  contributors. Licensed under Creative Commons Attribution Share
       Alike 3.0 (CC-BY-SA-3.0)

dev                                               May 22, 2025                                            <u><a href="../man8/RBD.8.html">RBD</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>