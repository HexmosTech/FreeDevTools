<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zfs-load-key — load, unload, or change encryption key of ZFS dataset</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/zfsutils-linux">zfsutils-linux_2.3.2-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       zfs-load-key — load, unload, or change encryption key of ZFS dataset

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>zfs</b> <b>load-key</b> [<b>-nr</b>] [<b>-L</b> <u>keylocation</u>] <b>-a</b>|<u>filesystem</u>
       <b>zfs</b> <b>unload-key</b> [<b>-r</b>] <b>-a</b>|<u>filesystem</u>
       <b>zfs</b> <b>change-key</b> [<b>-l</b>] [<b>-o</b> <u>keylocation</u>=<u>value</u>] [<b>-o</b> <u>keyformat</u>=<u>value</u>] [<b>-o</b> <u>pbkdf2iters</u>=<u>value</u>] <u>filesystem</u>
       <b>zfs</b> <b>change-key</b> <b>-i</b> [<b>-l</b>] <u>filesystem</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>zfs</b> <b>load-key</b> [<b>-nr</b>] [<b>-L</b> <u>keylocation</u>] <b>-a</b>|<u>filesystem</u>
         Load  the  key for <u>filesystem</u>, allowing it and all children that inherit the <b>keylocation</b> property to be
         accessed.  The key will be expected in the format specified by the <b>keyformat</b> and location specified  by
         the  <b>keylocation</b>  property.   Note  that  if  the  <b>keylocation</b>  is  set  to  <b>prompt</b>  the  terminal will
         interactively wait for the key to be entered.  Loading a key will not automatically mount the  dataset.
         If  that  functionality  is  desired,  <b>zfs</b>  <b>mount</b>  <b>-l</b>  will  ask for the key and mount the dataset (see
         <u><a href="../man8/zfs-mount.8.html">zfs-mount</a></u>(8)).  Once the key is loaded the <b>keystatus</b> property will become <b>available</b>.

         <b>-r</b>  Recursively loads the keys for the specified filesystem and all descendent encryption roots.

         <b>-a</b>  Loads the keys for all encryption roots in all imported pools.

         <b>-n</b>  Do a dry-run ("No-op") <b>load-key</b>.  This will cause <b>zfs</b> to simply check  that  the  provided  key  is
             correct.  This command may be run even if the key is already loaded.

         <b>-L</b> <u>keylocation</u>
             Use  <u>keylocation</u>  instead  of  the  <b>keylocation</b>  property.   This  will not change the value of the
             property on the dataset.  Note that if used with either <b>-r</b> or <b>-a</b>, <u>keylocation</u> may only be given  as
             <b>prompt</b>.

       <b>zfs</b> <b>unload-key</b> [<b>-r</b>] <b>-a</b>|<u>filesystem</u>
         Unloads a key from ZFS, removing the ability to access the dataset and all of its children that inherit
         the  <b>keylocation</b>  property.  This requires that the dataset is not currently open or mounted.  Once the
         key is unloaded the <b>keystatus</b> property will become <b>unavailable</b>.

         <b>-r</b>  Recursively unloads the keys for the specified filesystem and all descendent encryption roots.

         <b>-a</b>  Unloads the keys for all encryption roots in all imported pools.

       <b>zfs</b> <b>change-key</b> [<b>-l</b>] [<b>-o</b> <u>keylocation</u>=<u>value</u>] [<b>-o</b> <u>keyformat</u>=<u>value</u>] [<b>-o</b> <u>pbkdf2iters</u>=<u>value</u>] <u>filesystem</u>

       <b>zfs</b> <b>change-key</b> <b>-i</b> [<b>-l</b>] <u>filesystem</u>
         Changes the user's key (e.g. a passphrase) used to access a dataset.  This command  requires  that  the
         existing  key  for  the  dataset  is  already  loaded.   This  command  may  also be used to change the
         <b>keylocation</b>, <b>keyformat</b>, and <b>pbkdf2iters</b> properties as needed.  If the dataset  was  not  previously  an
         encryption  root it will become one.  Alternatively, the <b>-i</b> flag may be provided to cause an encryption
         root to inherit the parent's key instead.

         If the user's key is compromised, <b>zfs</b> <b>change-key</b> does not necessarily protect existing or newly-written
         data from attack.  Newly-written data will continue to be encrypted with the same  master  key  as  the
         existing  data.   The master key is compromised if an attacker obtains a user key and the corresponding
         wrapped master key.  Currently, <b>zfs</b> <b>change-key</b> does not overwrite the previous wrapped  master  key  on
         disk, so it is accessible via forensic analysis for an indeterminate length of time.

         In the event of a master key compromise, ideally the drives should be securely erased to remove all the
         old  data (which is readable using the compromised master key), a new pool created, and the data copied
         back.  This can be approximated in place by creating new datasets, copying the  data  (e.g.  using  <b>zfs</b>
         <b>send</b>  |  <b>zfs</b>  <b>recv</b>),  and  then  clearing  the free space with <b>zpool</b> <b>trim</b> <b>--secure</b> if supported by your
         hardware, otherwise <b>zpool</b> <b>initialize</b>.

         <b>-l</b>  Ensures the key is loaded before attempting to change the key.  This is effectively  equivalent  to
             running <b>zfs</b> <b>load-key</b> <u>filesystem</u>; <b>zfs</b> <b>change-key</b> <u>filesystem</u>

         <b>-o</b> <u>property</u>=<u>value</u>
             Allows  the  user  to set encryption key properties (<b>keyformat</b>, <b>keylocation</b>, and <b>pbkdf2iters</b>) while
             changing the key.  This is the only way to alter <b>keyformat</b> and <b>pbkdf2iters</b> after  the  dataset  has
             been created.

         <b>-i</b>  Indicates  that  zfs  should make <u>filesystem</u> inherit the key of its parent.  Note that this command
             can only be run on an encryption root that has an encrypted parent.

   <b>Encryption</b>
       Enabling the <b>encryption</b> feature allows for the creation of encrypted filesystems and volumes.   ZFS  will
       encrypt  file and volume data, file attributes, ACLs, permission bits, directory listings, FUID mappings,
       and <b>userused</b>/<b>groupused</b> data.  ZFS will not encrypt metadata related  to  the  pool  structure,  including
       dataset  and  snapshot  names,  dataset  hierarchy,  properties, file size, file holes, and deduplication
       tables (though the deduplicated data itself is encrypted).

       Key rotation is managed by ZFS.  Changing the user's  key  (e.g.  a  passphrase)  does  not  require  re-
       encrypting  the  entire  dataset.  Datasets can be scrubbed, resilvered, renamed, and deleted without the
       encryption keys being loaded (see the <b>load-key</b> subcommand for more info on key loading).

       Creating an encrypted dataset requires specifying the <b>encryption</b> and  <b>keyformat</b>  properties  at  creation
       time,  along with an optional <b>keylocation</b> and <b>pbkdf2iters</b>.  After entering an encryption key, the created
       dataset will become an encryption root.  Any descendant datasets will inherit their encryption  key  from
       the  encryption  root by default, meaning that loading, unloading, or changing the key for the encryption
       root will implicitly do the same for all inheriting datasets.  If this inheritance is not desired, simply
       supply a <b>keyformat</b> when  creating  the  child  dataset  or  use  <b>zfs</b>  <b>change-key</b>  to  break  an  existing
       relationship,  creating  a  new  encryption root on the child.  Note that the child's <b>keyformat</b> may match
       that of the parent while still creating a new encryption root, and that changing the <b>encryption</b>  property
       alone does not create a new encryption root; this would simply use a different cipher suite with the same
       key  as  its encryption root.  The one exception is that clones will always use their origin's encryption
       key.  As a result of this exception, some encryption-related  properties  (namely  <b>keystatus</b>,  <b>keyformat</b>,
       <b>keylocation</b>,  and  <b>pbkdf2iters</b>)  do  not  inherit  like  other  ZFS  properties and instead use the value
       determined by their encryption root.  Encryption root  inheritance  can  be  tracked  via  the  read-only
       <b>encryptionroot</b> property.

       Encryption  changes  the  behavior  of  a few ZFS operations.  Encryption is applied after compression so
       compression ratios are preserved.  Normally checksums in ZFS are 256 bits long, but  for  encrypted  data
       the checksum is 128 bits of the user-chosen checksum and 128 bits of MAC from the encryption suite, which
       provides  additional  protection  against maliciously altered data.  Deduplication is still possible with
       encryption enabled but for security, datasets will only deduplicate against themselves, their  snapshots,
       and their clones.

       There  are  a  few  limitations  on  encrypted  datasets.   Encrypted  data  cannot  be  embedded via the
       <b>embedded_data</b> feature.  Encrypted datasets may not have <b>copies</b>=<u>3</u> since  the  implementation  stores  some
       encryption  metadata  where  the  third  copy  would  normally  be.   Since compression is applied before
       encryption, datasets may be vulnerable to a CRIME-like attack if applications accessing  the  data  allow
       for  it.   Deduplication  with  encryption  will  leak information about which blocks are equivalent in a
       dataset and will incur an extra CPU cost for each block written.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man7/zfsprops.7.html">zfsprops</a></u>(7), <u><a href="../man8/zfs-create.8.html">zfs-create</a></u>(8), <u><a href="../man8/zfs-set.8.html">zfs-set</a></u>(8)

OpenZFS                                         January 13, 2020                                 <u><a href="../man8/ZFS-LOAD-KEY.8.html">ZFS-LOAD-KEY</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>