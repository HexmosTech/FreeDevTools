<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>keymgr - Knot DNS key management utility</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/knot">knot_3.4.6-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       keymgr - Knot DNS key management utility

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>keymgr</b> [<u>config_option</u>] [<u>options</u>] <u>zone_name</u> <u>command</u>

       <b>keymgr</b> [<u>config_option</u>] [<u>options</u>] <u>keystore_id</u> <u>command</u>

       <b>keymgr</b> [<u>config_option</u>] [-j] <b>-l</b>

       <b>keymgr</b> <b>-t</b> <u>parameter</u>...

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>keymgr</b> utility serves for manual key management in Knot DNS server.

       Functions for DNSSEC keys and KASP (Key And Signature Policy) management are provided.

       The  DNSSEC  and  KASP  configuration  is stored in a so called KASP database.  The database is backed by
       LMDB.

   <b>Parameters</b>
       <u>zone_name</u>
              Name of the zone the command is executed for.

   <b>Config</b> <b>options</b>
       <b>-c</b>, <b>--config</b> <u>file</u>
              Use a textual configuration file (default is <b>/usr/local/etc/knot/knot.conf</b>).

       <b>-C</b>, <b>--confdb</b> <u>directory</u>
              Use a binary configuration database directory (default  is  <b>/usr/local/var/lib/knot/confdb</b>).   The
              default configuration database, if exists, has a preference to the default configuration file.

       <b>-D</b>, <b>--dir</b> <u>path</u>
              Use specified KASP database path and default configuration.

   <b>Options</b>
       <b>-t</b>, <b>--tsig</b> <u>tsig_name</u> [<u>tsig_algorithm</u> [<u>tsig_bits</u>]]
              Generates a TSIG key for the given name. Optionally the key algorithm can be specified by its <u>name</u>
              (default:  hmac-sha256)  and a bit length of the key (default: optimal length given by algorithm).
              The generated TSIG key is only displayed on <u>stdout</u>: the  command  does  not  create  a  file,  nor
              include the key in a keystore.

       <b>-e</b>, <b>--extended</b>
              Extended output (listing of keys with full description).

       <b>-j</b>, <b>--json</b>
              Print the zones or keys in JSON format.

       <b>-l</b>, <b>--list</b>
              Print the list of zones that have at least one key stored in the configured KASP database.

       <b>-x</b>, <b>--mono</b>
              Don't generate colorized output.

       <b>-X</b>, <b>--color</b>
              Force colorized output in the normal mode.

       <b>-h</b>, <b>--help</b>
              Print the program help.

       <b>-V</b>, <b>--version</b>
              Print  the  program version. The option <b>-VV</b> makes the program print the compile time configuration
              summary.

       <b>NOTE:</b>
          Keymgr runs with the same user privileges as configured for <u>knotd</u>.  For example, if keymgr is  run  as
          <b>root</b>,  but the configured <u>user</u> is <b>knot</b>, it won't be able to read files (PEM files, KASP database, ...)
          readable only by <b>root</b>.

   <b>Commands</b>
       <b>list</b> [<u>timestamp_format</u>]
              Prints the list of key IDs and parameters of keys belonging to the zone.

       <b>generate</b> [<u>arguments</u>...]
              Generates new DNSSEC key and stores it in KASP database. Prints the key  ID.   This  action  takes
              some   number  of  arguments  (see  below).  Values  for  unspecified  arguments  are  taken  from
              corresponding policy (if <u>-c</u> or <u>-C</u> options used) or from Knot policy defaults.

       <b>import-bind</b> <u>BIND_key_file</u>
              Imports a BIND-style key into KASP database (converting it to PEM format).   Takes  one  argument:
              path to BIND key file (private or public, but both MUST exist).

       <b>import-pub</b> <u>BIND_pubkey_file</u>
              Imports  a  public  key  into  KASP  database. This key won't be rolled over nor used for signing.
              Takes one argument: path to BIND public key file.

       <b>import-pem</b> <u>PEM_file</u> [<u>arguments</u>...]
              Imports a DNSSEC key from PEM file. The key parameters (same as for the generate action)  need  to
              be specified (mainly algorithm, timers...) because they are not contained in the PEM format.

       <b>import-pkcs11</b> <u>key_id</u> [<u>arguments</u>...]
              Imports  a  DNSSEC key from PKCS #11 storage. The key parameters (same as for the generate action)
              need to be specified (mainly algorithm, timers...) because they are not available. In fact, no key
              data is imported, only KASP database metadata is created.

       <b>nsec3-salt</b> [<u>new_salt</u>]
              Prints the current NSEC3 salt used for signing. If <u>new_salt</u> is specified, the salt is overwritten.
              The salt is printed and expected in hexadecimal, or dash if empty.

       <b>local-serial</b> [<u>new_serial</u>]
              Print SOA serial stored in KASP database when using on-secondary DNSSEC signing.  If <u>new_serial</u> is
              specified, the serial is overwritten. After updating  the  serial,  expire  the  zone  (<b>zone-purge</b>
              <b>+expire</b>  <b>+zonefile</b>  <b>+journal</b>)  if  the  server  is  running, or remove corresponding zone file and
              journal contents if the server is stopped.

       <b>master-serial</b> [<u>new_serial</u>]
              Print SOA serial of the remote master stored in  KASP  database  when  using  on-secondary  DNSSEC
              signing.  If <u>new_serial</u> is specified, the serial is overwritten (not recommended).

       <b>set</b> <u>key_spec</u> [<u>arguments</u>...]
              Changes  a  timing argument (or ksk/zsk) of an existing key to a new value. <u>Key_spec</u> is either the
              key tag or a prefix of the key ID, with an optional <u>[id=|keytag=]</u> prefix; <u>arguments</u> are  like  for
              <b>generate</b>, but just the related ones.

       <b>ds</b> [<u>key_spec</u>]
              Generate  DS  record (all digest algorithms together) for specified key. <u>Key_spec</u> is like for <b>set</b>,
              if unspecified, all KSKs are used.

       <b>dnskey</b> [<u>key_spec</u>]
              Generate DNSKEY record for specified key. <u>Key_spec</u> is like for <b>ds</b>, if unspecified,  all  KSKs  are
              used.

       <b>delete</b> <u>key_spec</u>
              Remove the specified key from zone. If the key was not shared, it is also deleted from keystore.

       <b>share</b> <u>key_ID</u> <u>zone_from</u>
              Import  a key (specified by full key ID) from another zone as shared. After this, the key is owned
              by both zones equally.

   <b>Keystore</b> <b>commands</b>
       <b>keystore-test</b>
              Conduct some tests on the specified keystore. For each algorithm, key generation, import, removal,
              and use (signing and verification) are tested.  Use a configured <u>keystore_id</u> or <b>-</b> for the default.

       <b>keystore-bench</b> [<u>num_threads</u>]
              Conduct a signing benchmark on the specified keystore.  Random blocks of data are  signed  by  the
              selected  number of threads (default is 1) in a loop, and the average number of signing operations
              per second for each algorithm is returned.  Use a configured <u>keystore_id</u> or <b>-</b> for the default.

   <b>Commands</b> <b>related</b> <b>to</b> <b>Offline</b> <b>KSK</b> <b>feature</b>
       <b>pregenerate</b> [<u>timestamp-from</u>] <u>timestamp-to</u>
              Pre-generate ZSKs for use with offline  KSK,  for  the  specified  period  starting  from  now  or
              specified time.  This function also applies to non-offline KSK keys.

       <b>show-offline</b> [<u>timestamp-from</u>] [<u>timestamp-to</u>]
              Print  pre-generated  offline  key-related records for specified time interval. If <u>timestamp_to</u> is
              omitted, it will be to infinity. If <u>timestamp-from</u> is omitted, it will start from the beginning.

       <b>del-offline</b> <u>timestamp-from</u> <u>timestamp-to</u>
              Delete pre-generated offline key-related records in specified time interval.

       <b>del-all-old</b>
              Delete old keys that are in state 'removed'. This function also applies to non-offline KSK keys.

       <b>generate-ksr</b> [<u>timestamp-from</u>] <u>timestamp-to</u>
              Print to stdout KeySigningRequest based on pre-generated  ZSKs  for  specified  time  period.   If
              <u>timestamp-from</u>  is omitted, timestamp of the last offline records set is used or now if no records
              available.

       <b>sign-ksr</b> <u>ksr_file</u>
              Read KeySigningRequest from a text file, sign it using local keyset and print SignedKeyResponse to
              stdout.

       <b>validate-skr</b> <u>skr_file</u>
              Read SignedKeyResponse from a text file and validate the RRSIGs in it if not corrupt.

       <b>import-skr</b> <u>skr_file</u>
              Read SignedKeyResponse from a text file and import the signatures for later use in zone.  If  some
              signatures  have  already been imported, they will be deleted for the period from beginning of the
              SKR to infinity.

   <b>Generate</b> <b>arguments</b>
       Arguments are separated by space, each of them is in format 'name=value'.

       <b>algorithm</b>
              Either an algorithm number (e.g. 14) or <u>algorithm</u> <u>name</u> (e.g. ecdsap256sha256).

       <b>size</b>   Key length in bits.

       <b>ksk</b>    If set to <b>yes</b>, the key will be used for signing DNSKEY rrset. The generated key will also have the
              Secure Entry Point flag set to 1.

       <b>zsk</b>    If set to <b>yes</b>, the key will be used for signing zone (except DNSKEY rrset). This flag can  be  set
              concurrently with the <b>ksk</b> flag (for a CSK key).

       <b>sep</b>    Overrides the standard setting of the Secure Entry Point flag.

       The following arguments are timestamps of key lifetime (see <u>DNSSEC</u> <u>key</u> <u>states</u>):

       <b>pre_active</b>
              Key started to be used for signing, not published (only for algorithm rollover).

       <b>publish</b>
              Key published.

       <b>ready</b>  Key is waiting for submission (only for KSK).

       <b>active</b> Key used for signing.

       <b>retire_active</b>
              Key still used for signing, but another key is active (only for KSK or algorithm rollover).

       <b>retire</b> Key still published (only if ZSK), but no longer used for signing.

       <b>post_active</b>
              Key no longer published, but still used for signing (only for algorithm rollover).

       <b>revoke</b> Key revoked according to <u>RFC</u> <u>5011</u> trust anchor roll-over.

       <b>remove</b> Key deleted.

   <b>Timestamps</b>
       <b>0</b>      Zero timestamp means infinite future.

       <u>UNIX_time</u>
              Positive number of seconds since 1970 UTC.

       <u>YYYYMMDDHHMMSS</u>
              Date and time in this format without any punctuation.

       <u>relative_timestamp</u>
              A  sign  character  (<b>+</b>,  <b>-</b>), a number, and an optional time unit (<b>y</b>, <b>mo</b>, <b>d</b>, <b>h</b>, <b>mi</b>, <b>s</b>). The default
              unit is one second.  E.g. +1mi, -2mo.

   <b>Output</b> <b>timestamp</b> <b>formats</b>
       <b>(none)</b> The timestamps are printed as UNIX timestamp.

       <b>human</b>  The timestamps are printed relatively to now using time units (e.g. -2y5mo, +1h13s).

       <b>iso</b>    The timestamps are printed in the ISO8601 format (e.g. 2016-12-31T23:59:00).

</pre><h4><b>EXIT</b> <b>VALUES</b></h4><pre>
       Exit status of 0 means successful operation. Any other exit status indicates an error.

</pre><h4><b>EXAMPLES</b></h4><pre>
       1. Generate new TSIG key:

             $ keymgr -t my_name hmac-sha384

       2. Generate new DNSSEC key:

             $ keymgr example.com. generate algorithm=ECDSAP256SHA256 size=256 \
               ksk=true created=1488034625 publish=20170223205611 retire=+10mo remove=+1y

       3. Import a DNSSEC key from BIND:

             $ keymgr example.com. import-bind <a href="file:~/bind/Kharbinge4d5.">~/bind/Kharbinge4d5.</a>+007+63089.key

       4. Import a CSK DNSSEC key from a PEM file:

             $ keymgr example.com. import-pem 085d3890e8c22d854586678d9263933f2d02d795.pem ksk=yes zsk=yes

       5. Configure key timing:

             $ keymgr example.com. set 4208 active=+2mi retire=+4mi remove=+5mi

       6. Share a KSK from another zone:

             $ keymgr example.com. share e687cf927029e9db7184d2ece6d663f5d1e5b0e9 another-zone.com.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>RFC</u> <u>6781</u> - DNSSEC Operational Practices.  <u>RFC</u> <u>7583</u> - DNSSEC Key Rollover Timing Considerations.

       <b><a href="../man5/knot.conf.5.html">knot.conf</a>(5)</b>, <b><a href="../man8/knotc.8.html">knotc</a>(8)</b>, <b><a href="../man8/knotd.8.html">knotd</a>(8)</b>.

</pre><h4><b>AUTHOR</b></h4><pre>
       CZ.NIC Labs &lt;https://www.knot-dns.cz&gt;

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2010–2025, CZ.NIC, z.s.p.o.

3.4.6                                              2025-04-10                                          <u><a href="../man8/KEYMGR.8.html">KEYMGR</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>