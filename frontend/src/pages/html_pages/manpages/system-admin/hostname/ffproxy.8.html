<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ffproxy — filtering HTTP/HTTPS proxy server</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/ffproxy">ffproxy_1.6-13_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ffproxy — filtering HTTP/HTTPS proxy server

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>ffproxy</b>  [<b>-p</b>  <u>port</u>]  [<b>-c</b>  <u>ip|hostname</u>] [<b>-C</b> <u>ip|hostname</u>] [<b>-l</b> <u>children</u>] [<b>-u</b> <u>uid|user</u> <b>-g</b> <u>gid|group</u>] [<b>-r</b> <u>dir</u>]
               [<b>-D</b> <u>datadir</u>]  [<b>-x</b>  <u>proxyip|proxyhost</u>  <b>-X</b>  <u>proxyport</u>]  [<b>-a</b>  <u>ip|hostname</u>]  [<b>-A</b>  <u>port</u>]  [<b>-n</b>  <u>piddir</u>]
               [<b>-f</b> <u>configfile</u>] [<b>-ds4bBhv</b>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>ffproxy</b>  is  a filtering HTTP/HTTPS proxy server.  It is able to filter by host, URL, and header.  Custom
       header entries can be filtered and added.  It can even drop its privileges and  optionally  <u><a href="../man2/chroot.2.html">chroot</a></u>(2)  to
       some  directory.  Logging to <u><a href="../man3/syslog.3.html">syslog</a></u>(3) is supported, as is using another auxiliary proxy server.  An HTTP
       accelerator feature (acting as a front-end to an HTTP server) is included.  Contacting  IPv6  servers  as
       well as binding to IPv6 is supported and allows transparent IPv6 over IPv4 browsing (and vice versa).

       Remind  that  there  is  an  alternative  to  command  line  options  by  using configuration files.  See
       <u><a href="../man5/ffproxy.conf.5.html">ffproxy.conf</a></u>(5) and <u>sample.config</u> for details.  It allows options that are not available on command line.

       The following command line options are recognized.  They specify general settings like IP to bind  to  or
       place of the db/ and html/ directories.  Note that arguments to options must be separated from the option
       by spaces, as are such options from each other.

       <b>-p</b> <u>port</u>  Bind to port.  Default is 8080.

       <b>-c</b> <u>ip|hostname</u>
                Bind to IPv4.  Default is any IPv4.

       <b>-C</b> <u>ip|hostname</u>
                Bind to IPv6.  Default is any IPv6.

       <b>-l</b> <u>children</u>
                Maximum  number  of  child  processes  to  be forked.  That is, the maximum number of concurrent
                requests allowed.  Default is 10.

       <b>-u</b> <u>uid|user</u> <b>-g</b> <u>gid|group</u>
                Change UID and GID.  Both options must be used.  Default is not changing UID and GID.

       <b>-r</b> <u>dir</u>   Change root <u><a href="../man7/chroot.7.html">chroot</a></u>(7) to dir.  Used in conjunction with -u and -g.  Because  ffproxy  drops  its
                privileges and chroots after reading the configuration files, -D should be set to . (the current
                dir).   It  might  need  <u><a href="file:/etc/resolv.conf">/etc/resolv.conf</a></u>  copied  as  etc/resolv.conf in its working directory.
                Example: ``# cd /var/ffproxy ; /usr/local/bin/ffproxy -r /var/ffproxy -D . -d -u proxy -g  proxy
                -f ""''

       <b>-x</b> <u>ip|hostname</u>
                Specify IP (or hostname) of an auxiliary proxy server that the program will forward requests to.
                Used together with -X.

       <b>-X</b> <u>port</u>  Port number of auxiliary proxy.

       <b>-D</b> <u>dir</u>   Location  of  the  db/ and html/ directories.  For example, specifying -D /var/ffproxy tells the
                proxy to search for db/ files in <u>/var/ffproxy/db/</u> and html/ files in <u>/var/ffproxy/html/</u>.

       <b>-a</b> <u>ip|hostname</u>
                Auxiliary forward HTTP server to use (see section HTTP ACCELERATOR).

       <b>-A</b> <u>port</u>  Port to use for above.  Defaults to 80.

       <b>-n</b> <u>piddir</u>
                directory to store file ffproxy.pid with ffproxy pid inside. Default is <u><a href="file:/var/run">/var/run</a></u>

       <b>-f</b> <u>configfile</u>
                User configuration file to load.  Please note that command line options get overwritten  by  set
                configuration    file   options.    Default   location   is   <u>/etc/ffproxy/ffproxy.conf</u>.    Read
                <u><a href="../man5/ffproxy.conf.5.html">ffproxy.conf</a></u>(5) for details.  Use -f "" to disable configuration files.

       <b>-d</b>       Run as daemon.

       <b>-s</b>       Be silent.  Don't log to syslog.

       <b>-4</b>       Use IPv4 only.  Do not try contacting servers via IPv6.

       <b>-b</b>       Don't bind to IPv4.  Might be needed under Linux 2.4, due to a ``Feature'' IPv6 binds  to  IPv4,
                too.  Try using this option or bind to specific IPv6 address via -C.

       <b>-B</b>       Don't bind to IPv6.

       <b>-h</b>       Show usage information.

       <b>-v</b>       Display version number.

</pre><h4><b>THE</b> <b>DB/</b> <b>DIRECTORY</b></h4><pre>
       The  db/  directory  contains  files  that control the behaviour of ffproxy.  The files for filtering are
       prefixed by `filter'.  Access to the proxy server is controlled by files with prefix `host'.

   <b>Filtering</b>
       Requests or header entries to be filtered are matched by extended regular expressions or case insensitive
       by strings.

       ffproxy is able to filter requests by host, header, remote header, and URL.  The specific files are

             <u>filter.host.match</u>
             <u>filter.header.drop</u>
             <u>filter.header.entry</u>
             <u>filter.header.match</u>
             <u>filter.rheader.drop</u>
             <u>filter.rheader.entry</u>
             <u>filter.rheader.match</u>
             <u>filter.url.match</u>

       Files ending in `drop' specify requests to be completely filtered (dropped).   Files  ending  in  `entry'
       specify header entries to be removed from the header.  They are matched case insensitive without extended
       regular  expressions.  Files ending in `match' specify extended regular expressions to be matched against
       header entries, host, or URL.

       Adding custom header entries is also supported.  The entries of file <u>filter.header.add</u> will be  added  to
       every outgoing request.

   <b>Access</b> <b>Control</b>
       Access to the proxy is controlled through the files prefixed `host'.

       <u>host.dyndns</u>  contains  host  names  with  dynamic  IPv4  addresses.   The host names are resolved to IPv4
       addresses and compared to the client's IP.  If it matches, access is granted.

       <u>host.ip</u> contains static IPv4 and IPv6 address.

       <u>host.name</u> contains official hostnames (reverse lookup).

       Except for <u>host.dyndns</u>, the files contain extended regular expressions.  If any of the  entries  matches,
       access is granted.

   <b>Layout</b> <b>of</b> <b>db/</b> <b>Files</b>
       Every mentioned file above must exist, although it may be empty.  Every entry is exactly one line.  Empty
       lines are ignored, as are lines beginning with a # (comments).

       The location of the db/ directory may be specified by an argument to the command line option -D.  If this
       option and configuration file option db_files_path are not used, ffproxy will search for db/ and html/ in
       <u>/usr/share/ffproxy</u>.

       ffproxy comes with sample db/ files.  They also contain needed and suggested entries, as described next.

   <b>Suggested</b> <b>db/</b> <b>file</b> <b>entries</b>
       The file <u>filter.header.entry</u> should contain following entries for the program's proper operation

             Accept-Encoding:
             Accept:
             Connection:
             Proxy-Connection:
             Host:

       First  two lines are needed for browsers that send out Accept*: Headers but don't understand encoded data
       coming back from the proxy.  Host:  has to be removed, since proxies  require  absolute  URIs  (Host:  is
       redundant).

       <u>filter.header.add</u> should contain

             Connection: close
             Proxy-Connection: close

       We  removed  the  two  entries through <u>filter.header.entry</u> and now implant our own to force disconnection
       after each request.

       <u>filter.rheader.entry</u> should contain

             Connection:
             Proxy-Connection:

       Whatever the server answered, we remove it.

</pre><h4><b>THE</b> <b>HTML/</b> <b>DIRECTORY</b></h4><pre>
       This directory contains files with HTTP header and HTML that are sent to the user's browser if either  an
       error  occurred or a request was filtered.  In the files, the variable <u>$u</u> will be replaced by the URL, <u>$h</u>
       by the host to connect to, and <u>$c</u> by the hostname of the client.

       Since the files are loaded into memory for faster execution, the size of each file is limited to about  8
       kB (what is more than enough, the default files are under 1 kB).

       The specific files are (every file must exist)

             <u>connect</u>      Connection failed (503)
             <u>filtered</u>     Request filtered (200)
             <u>invalid</u>      Invalid request (400)
             <u>post</u>         Unable to post data (400)
             <u>resolve</u>      Resolve error (503)

</pre><h4><b>HTTP</b> <b>ACCELERATOR</b></h4><pre>
       ffproxy  may  also be used as a HTTP accelerator, that is, connecting to just one HTTP server and being a
       front-end to that.  Use accel_host and accel_port in configuration file or command line options -a and -A
       to use this feature.

       Default behaviour is *not* sending Host: header to allow insertion of a custom one via  <u>filter.header.add</u>
       (see section THE DB/ DIRECTORY) or keeping the original one used by connecting client (`Host:' hast to be
       removed  from  default  <u>filter.header.entry</u>, of course).  To change this, use `accel_user_host no' in the
       configuration file.  ``Host: accel_host:accel_port'' will be used then.

</pre><h4><b>TRANSPARENT</b> <b>OPERATION</b></h4><pre>
       It is possible to redirect all HTTP traffic, that is, traffic to port 80, to the proxy's listening  port.
       It will then transparently act as a HTTP proxy, the client not even knowing it is connecting to a proxy.

       On OpenBSD one could enable this by adding a line like

             rdr on rl0 proto tcp from any to any port 80 -&gt; 127.0.0.1 port 8080

       to  <u>/etc/pf.conf</u>.   In this example, rl0 is the local interface.  All traffic coming from rl0 directed to
       port 80 (HTTP standard port) is sent to 127.0.0.1:8080 where ffproxy is supposed to be listening.

</pre><h4><b>KEEP</b> <b>ALIVE</b></h4><pre>
       The program supports keep alive on client to proxy connections.  This is used  automatically  by  default
       and may be disabled by setting `use_keep_alive no' in the configuration file.

</pre><h4><b>HTTPS</b> <b>OPERATION</b></h4><pre>
       The  proxy allows HTTPS proxying via implementation of the CONNECT request method.  By default, only port
       443 is allowed for CONNECT.  This may be changed by using `unrestricted_connect yes' in the configuration
       file.  Timeout may also be tuned by `timeout_connect seconds'.

</pre><h4><b>RELOADING</b> <b>CONFIGURATION</b></h4><pre>
       Send a SIGHUP to the pid of the ffproxy master process to let it reload db/  files,  html/  files,  *and*
       configuration  file.   If  no  configuration  file was specified, <u>/etc/ffproxy/ffproxy.conf</u> is tried.  Of
       course, only some changes to the program can be done at runtime.   See  <u><a href="../man5/ffproxy.conf.5.html">ffproxy.conf</a></u>(5)  for  details  on
       options that may be changed at runtime.

       ffproxy write its pid file <u>ffproxy.pid</u> in the directory specified by the command line parameter -n or the
       <u>pid_dir</u> setting in config file. Default is <u><a href="file:/var/run">/var/run</a></u>.

</pre><h4><b>LOGGING</b></h4><pre>
       By  default,  the proxy logs incorrect and filtered requests.  To log all requests, use the configuration
       file keyword `log_all_requests yes'.  Please make sure that you separate the  programs  log  output  from
       that of other programs by modifying <u><a href="../man5/syslog.conf.5.html">syslog.conf</a></u>(5), since the output is very noisy.

</pre><h4><b>FILES</b></h4><pre>
       Behaviour of ffproxy is determined by

       <b>•</b>   startup   options   given   either   on  the  command  line  or  read  from  configuration  files  --
           <u>/etc/ffproxy/ffproxy.conf</u> is loaded by default.

       <b>•</b>   the files in db/ which specify filtering options and who is allowed to connect and use ffproxy

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u>sample.config</u> for a sample configuration file

       <u>/etc/ffproxy/ffproxy.conf</u> for default configuration file

       <u><a href="../man5/ffproxy.conf.5.html">ffproxy.conf</a></u>(5) for details on config file

       <u><a href="../man7/ffproxy.quick.7.html">ffproxy.quick</a></u>(7) for a short description of how to set up the proxy

       <u><a href="http://faith.eu.org/programs.html">http://faith.eu.org/programs.html</a></u> for latest version and patches

       <u><a href="../man7/regex.7.html">regex</a></u>(7), <u><a href="../man7/re_format.7.html">re_format</a></u>(7), <u><a href="../man8/syslogd.8.html">syslogd</a></u>(8), <u><a href="../man2/chroot.2.html">chroot</a></u>(2), <u><a href="../man1/kill.1.html">kill</a></u>(1)

</pre><h4><b>CONTRIBUTORS</b></h4><pre>
       Dobrica Pavlinusic &lt;<a href="mailto:dpavlin@rot13.org">dpavlin@rot13.org</a>&gt; provided patches for http accelerator feature

</pre><h4><b>VERSION</b></h4><pre>
       This manual documents ffproxy 1.6 (2005-01-05).

       Send bug reports, comments, suggestions to &lt;<a href="mailto:niklas@noxa.de">niklas@noxa.de</a>&gt;

</pre><h4><b>AUTHOR</b></h4><pre>
       Niklas Olmes &lt;<a href="mailto:niklas@noxa.de">niklas@noxa.de</a>&gt;

                                                   Jan 5, 2005                                        <u><a href="../man8/ffproxy.8.html">ffproxy</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>