<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>psad - The Port Scan Attack Detector</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/psad">psad_2.4.6-3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       <b>psad</b> - The Port Scan Attack Detector

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>psad</b> <b>[options]</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>psad</b>  makes  use  of  iptables log messages to detect, alert, and (optionally) block port scans and other
       suspect traffic.  For TCP scans psad analyzes TCP flags to determine the scan type (syn, fin, xmas, etc.)
       and corresponding command line options that could be supplied to  nmap  to  generate  such  a  scan.   In
       addition,  psad  makes  use  of  many  TCP, UDP, and ICMP signatures contained within the Snort intrusion
       detection system (see <a href="http://www.snort.org/">http://www.snort.org/</a>) to detect suspicious network  traffic  such  as  probes  for
       common backdoors, DDoS tools, OS fingerprinting attempts, and more.  By default psad also provides alerts
       for  snort rules that are detected directly by iptables through the use of a ruleset generated by <b>fwsnort</b>
       (<a href="http://www.cipherdyne.org/fwsnort/">http://www.cipherdyne.org/fwsnort/</a>).  This enables psad to send alerts for  application  layer  attacks.
       <b>psad</b> features a set of highly configurable danger thresholds (with sensible defaults provided) that allow
       the  administrator to define what constitutes a port scan or other suspect traffic.  Email alerts sent by
       psad contain the scanning ip, number of packets sent to each port, any TCP, UDP, or ICMP signatures  that
       have  been  matched  (e.g. "NMAP XMAS scan"), the scanned port range, the current danger level (from 1 to
       5), reverse dns info, and whois information.  <b>psad</b>  also  makes  use  of  various  packet  header  fields
       associated with TCP SYN packets to passively fingerprint remote operating systems (in a manner similar to
       the  <b>p0f</b>  fingerprinter)  from  which  scans  originate.   This requires the use of the <b>--log-tcp-options</b>
       argument for iptables logging rules; if this option is not used, <b>psad</b> will fall back to a  fingerprinting
       method that makes use of packet length, TTL and TOS values, IP ID, and TCP window sizes.

       <b>psad</b>  reads  all  iptables  log data by default from the <u>/var/log/messages</u> file.  By parsing firewall log
       messages, psad is provided with data that represents packets that have been logged (and possibly dropped)
       by the running iptables policy.  In this sense, psad is supplied with a pure data stream that exclusively
       contains packets that the firewall has deemed unfit  to  enter  the  network.   <b>psad</b>  consists  of  three
       daemons:  psad,  kmsgsd,  and  psadwatchd.  <b>psad</b> is responsible for processing all packets that have been
       logged by the firewall and applying the signature logic in order to determine what type of scan has  been
       leveraged  against  the  machine  and/or  network.  <b>kmsgsd</b> <b>(deprecated)</b> reads all messages that have been
       written to the <u>/var/lib/psad/psadfifo</u> named pipe and writes any message that matches a particular regular
       expression (or string) to <u>/var/log/psad/fwdata.</u>  kmsgsd is only used if the  <b>ENABLE_SYSLOG_FILE</b>  variable
       is  disabled  in  psad.conf.   <b>psadwatchd</b>  is  a software watchdog that will restart any of the other two
       daemons should a daemon die for any reason.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-A</b>, <b>--Analyze-msgs</b>
              Analyze an iptables logfile for scans and exit.  This will generate email alerts just as a  normal
              running  psad  process  would  have  for  all  logged  scans.   By  default  the  psad  data  file
              <u>/var/log/psad/fwdata</u> is parsed for old scans, but any file can be specified through the use of the
              --messages-file command line option.  For example it  might  be  useful  to  point  psad  at  your
              <u>/var/log/messages</u> file.

       <b>--analysis-fields</b> <b>&lt;search</b> <b>fields&gt;</b>
              In  --Analyze  mode  restrict  analysis  to  iptables  log  messages that have specific values for
              particular fields.  Examples include "SRC:1.2.3.4", "DST:10.0.0.0/24, and "TTL:64",  and  multiple
              fields are supported as a comma-separated list like "SRC:1.2.3.4, LEN:44, DST:10.0.0.0/24".

       <b>-i</b>, <b>--interface</b> <b>&lt;interface&gt;</b>
              Specify  the  interface  that <b>psad</b> will examine for iptables log messages.  This interface will be
              the <b>IN=</b> interface for packets that are logged in the  <b>INPUT</b>  and  <b>FORWARD</b>  chains,  and  the  <b>OUT=</b>
              interface for packets logged in the <b>OUTPUT</b> chain.

       <b>--sig-update</b>
              Instruct    <b>psad</b>    to   download   the   latest   set   of   modified   Snort   signatures   from
              <a href="http://www.cipherdyne.org/psad/signatures">http://www.cipherdyne.org/psad/signatures</a> so that psad can take  advantage  of  signature  updates
              before a new release is made.

       <b>-O</b>, <b>--Override-config</b> <b>&lt;file&gt;</b>
              Override  config  variable  values  that  are normally read from the /etc/psad/psad.conf file with
              values from the specified file.  Multiple override config files can be given as a comma  separated
              list.

       <b>-D</b>, <b>--Dump-conf</b>
              Dump  the  current psad config to STDOUT and exit.  Various pieces of information such as the home
              network, alert email addresses, and DShield user id are removed from the resulting output so it is
              safe to send to others.

       <b>-F</b>, <b>--Flush</b>
              Remove any auto-generated firewall block rules if psad was configured to automatically respond  to
              scans (see the ENABLE_AUTO_IDS variable in psad.conf).

       <b>-S</b>, <b>--Status</b>
              Display the status of any psad processes that may or not be running.  The status output contains a
              listing of the number of packets that have been processed by psad, along with all IP addresses and
              corresponding danger levels that have scanned the network.

       <b>--status-ip</b> <b>&lt;ip&gt;</b>
              Display  status information associated with <u>ip</u> such as the protocol packet counters as well as the
              last 10 packets logged by iptables.

       <b>--status-dl</b> <b>&lt;dl&gt;</b>
              Display status information only for scans that have reached a danger level of at least <u>dl</u>

       <b>--status-summary</b>
              Instruct <b>psad</b> to omit detailed IP information from <u>--Status</u> and <u>--Analyze</u> modes.

       <b>-m</b>, <b>--messages-file</b> <b>&lt;file&gt;</b>
              This option is used to specify the file that will be parsed in analysis mode (see  the  --Analyze-
              msgs option).  The default path is the psad data file <u>/var/log/psad/fwdata.</u>

       <b>--CSV</b>  Instruct  <b>psad</b>  to parse iptables log messages out of <u>/var/log/messages</u> (by default, but this path
              can be changed with the <u>-m</u> option), and print the packet fields on STDOUT in comma-separate  value
              format.     This    is   useful   for   graphing   iptables   log   data   with   AfterGlow   (see
              <a href="http://afterglow.sourceforge.net/index.html">http://afterglow.sourceforge.net/index.html</a>).

       <b>--stdin</b>
              Acquire iptables log data from STDIN instead of the default <u>/var/log/messages</u> file.

       <b>--CSV-fields</b> <b>&lt;tokens&gt;</b>
              Instruct <b>psad</b> to only include a specific set of iptables log message fields within the CSV output.
              AfterGlow accepts up to three fields for its graph data, so the most common usage of  this  option
              is "src dst dp" to print the source and destination IP addresses, and the destination port number.

       <b>-K</b>, <b>--Kill</b>
              Kill  the  current  psad process along with psadwatchd and kmsgsd.  This provides a quick and easy
              way to kill all psad processes without having to look in the process table or appeal to the  psad-
              init script.

       <b>-R</b>, <b>--Restart</b>
              Restart  the currently running psad processes.  This option will preserve the command line options
              that were supplied to the original psad process.

       <b>-U</b>, <b>--USR1</b>
              Send a running psad process a USR1 signal.  This will cause psad to dump the contents of the %Scan
              hash to the file "/var/log/psad/scan_hash.$$" where "$$" represents the pid of the  psad  process.
              This  is  mostly  useful for debugging purposes, but it also allows the administrator to peer into
              the %Scan hash, which is the primary data structure used to store scan data within system memory.

       <b>-H</b>, <b>--HUP</b>
              Send all running psad daemons a HUP signal.  This will  instruct  the  daemons  to  re-read  their
              respective configuration files without causing scan data to be lost in the process.

       <b>-B</b>, <b>--Benchmark</b>
              Run psad in benchmark mode.  By default benchmark mode will simulate a scan of 10,000 packets (see
              the  --packets  option) and then report the elapsed time.  This is useful to see how fast psad can
              process packets on a specific machine.

       <b>-p</b>, <b>--packets</b> <b>&lt;packets&gt;</b>
              Specify the number of packets to analyze in --Analyze  mode  or  use  in  --Benchmark  mode.   The
              default is 10,000 packets in --Benchmark mode, and unlimited in --Analyze mode.

       <b>-d</b>, <b>--debug</b>
              Run  psad  in  debugging mode.  This will automatically prevent psad from running as a daemon, and
              will print the contents of the %Scan hash and a few other things on STDOUT at  crucial  points  as
              psad executes.

       <b>-c</b>, <b>--config</b> <b>&lt;configuration-file&gt;</b>
              By  default all of the psad makes use of the configuration file <u>/etc/psad/psad.conf</u> for almost all
              configuration parameters.  <b>psad</b> can be made to override this path by specifying a  different  file
              on the command line with the --config option.

       <b>--signatures</b> <b>&lt;signatures-file&gt;</b>
              The  iptables  firewalling  code  included within the linux 2.4.x kernel series has the ability to
              distinguish and log any of the TCP flags present within TCP packets  that  traverse  the  firewall
              interfaces.   <b>psad</b>  makes  use  of  this  logging  capability  to detect several types of TCP scan
              signatures included within <u>/etc/psad/signatures.</u>  The signatures were originally  included  within
              the  snort  intrusion  detection  system.   New  signatures  can  be included and modifications to
              existing signatures can be made to the signature file  and  psad  will  import  the  changes  upon
              receiving  a  HUP  signal  (see  the --HUP command line option) without having to restart the psad
              process.  <b>psad</b> also detects many UDP and ICMP signatures  that  were  originally  included  within
              snort.

       <b>-e</b>, <b>--email-analysis</b>
              Send alert emails when run in --Analyze-msgs mode.  Depending on the size of the iptables logfile,
              using  the  --email-analysis option could extend the runtime of psad by quite a bit since normally
              both DNS and whois lookups will be issued against  each  scanning  IP  address.   As  usual  these
              lookups can be disabled with the --no-rdns and --no-whois options respectively.

       <b>-w</b>, <b>--whois-analysis</b>
              By  default  <b>psad</b>  does not issue whois lookups when running in --Analyze-msgs mode.  The --whois-
              analysis option will override this behavior (when run in analysis mode) and instruct psad to issue
              whois lookups against IP addresses from which scans or other suspect traffic has originated.

       <b>--analysis-auto-block</b>
              Enable auto-blocking responses when running in --Analyze-msgs mode.  This is  mostly  useful  only
              for the <b>psad</b> test suite when auto-blocking responses are tested and verified.

       <b>--snort-type</b> <b>&lt;type&gt;</b>
              Restrict  the type of snort sids to <u>type.</u>  Allowed types match the file names given to snort rules
              files such as "ddos", "backdoor", and "web-attacks".

       <b>--snort-rdir</b> <b>&lt;snort-rules-directory&gt;</b>
              Manually specify the  directory  where  the  snort  rules  files  are  located.   The  default  is
              <u>/etc/psad/snort_rules.</u>

       <b>--passive-os-sigs</b> <b>&lt;passive-os-sigs-file&gt;</b>
              Manually  specify  the  path  to the passive operating system fingerprinting signatures file.  The
              default is <u>/etc/psad/posf.</u>

       <b>--auto-dl</b> <b>&lt;auto-dl-file&gt;</b>
              Occasionally certain IP addresses are repeat offenders and should automatically be given a  higher
              danger  level  than  would  normally  be  assigned.  Additionally, some IP addresses can always be
              ignored depending on your network configuration (the loopback interface 127.0.0.1 might be a  good
              candidate  for  example).   <u>/etc/psad/auto_dl</u>  provides  an  interface  for  psad to automatically
              increase/decrease/ignore scanning  IP  danger  levels.   Modifications  can  be  made  to  auto_dl
              (installed  by default in /etc/psad) and psad will import them with 'psad -H' or by restarting the
              psad process.

       <b>--fw-search</b> <b>&lt;fw_search-file&gt;</b>
              By  default  all  of  the  psad  makes   use   of   the   firewall   search   configuration   file
              <u>/etc/psad/fw_search.conf</u>  for  firewall  search  mode  and  search  strings.   <b>psad</b> can be made to
              override this path by specifying a different file on the command line with the --fw-search option.

       <b>--fw-list-auto</b>
              List all rules in iptables chains that are used by <b>psad</b> in auto-blocking mode.

       <b>--fw-analyze</b>
              Analyze the local iptables ruleset, send any alerts if errors are discovered, and then exit.

       <b>--fw-del-chains</b>
              By default, if ENABLE_AUTO_IDS is set to "Y" <b>psad</b> will  not  delete  the  auto-generated  iptables
              chains  (see  the IPT_AUTO_CHAIN keywords in psad.conf) if the --Flush option is given.  The --fw-
              del-chains option overrides this behavior and deletes the  auto-blocking  chains  from  a  running
              iptables firewall.

       <b>--fw-dump</b>
              Instruct  <b>psad</b>  to  dump  the contents of the iptables policy that is running on the local system.
              All IP addresses are removed from the resulting output, so it is safe to post to the psad list, or
              communicate to others.  This option is most often used with --Dump-conf.

       <b>--fw-block-ip</b> <b>&lt;ip&gt;</b>
              Specify an IP address or network to add to the iptables controls that are auto-generated by  psad.
              This allows psad to manage the rule timeouts.

       <b>--fw-rm-block-ip</b> <b>&lt;ip&gt;</b>
              Specify  an  IP address or network to remove from the iptables controls that are auto-generated by
              psad.

       <b>--fw-file</b> <b>&lt;policy-file&gt;</b>
              Analyze the iptables ruleset contained within <b>policy-file</b> instead of the ruleset currently  loaded
              on the local system.

       <b>--CSV-regex</b> <b>&lt;regex&gt;</b>
              Instruct <b>psad</b> to only print CSV data that matches the supplied regex.  This regex is used to match
              against each of the entire iptables log messages.

       <b>--CSV-neg-regex</b> <b>&lt;regex&gt;</b>
              Instruct  <b>psad</b>  to only print CSV data that does not match the supplied regex.  This regex is used
              to negatively match against each of the entire iptables log messages.

       <b>--CSV-uniq-lines</b>
              Instruct <b>psad</b> to only print unique CSV data.  That is, each line printed in  <u>--CSV</u>  mode  will  be
              unique.

       <b>--CSV-max-lines</b> <b>&lt;num&gt;</b>
              Limit  the  number  of CSV-formatted lines that <b>psad</b> generates on STDOUT.  This is useful to allow
              AfterGlow graphs to be created that are not too cluttered.

       <b>--CSV-start-line</b> <b>&lt;num&gt;</b>
              Specify the beginning line number to start parsing out of the iptables log file  in  <u>--CSV</u>  output
              mode.   This  is  useful for when the log file is extremely large, and you want to begin parsing a
              specific place within the file.  The default is begin parsing at the beginning of the file.

       <b>--CSV-end-line</b> <b>&lt;num&gt;</b>
              Specify the ending line number to stop parsing the iptables log file in <u>--CSV</u> output  mode.   This
              is useful for when the log file is extremely large, and you do not want <b>psad</b> to process the entire
              thing.

       <b>--gnuplot</b>
              Enter  into  Gnuplot  mode whereby <b>psad</b> parses an iptables logfile and creates .gnu and .dat files
              that are suitable for graphing with Gnuplot.  The various <u>--CSV</u> command line  arguments  apply  to
              plotting iptables log with Gnuplot.

       <b>--gnuplot-template</b> <b>&lt;file&gt;</b>
              Use  a  template  file  for  all  Gnuplot  graphing  directives  (this  is  usually a .gnu file by
              convention).  Normally <b>psad</b> <b>builds</b> <b>all</b> <b>of</b> <b>the</b>  <b>graphing</b>  <b>directives</b>  <b>based</b>  <b>on</b>  <b>various</b>  <b>--gnuplot</b>
              command line arguments, but the --gnuplot-template switch allows you to override this behavior.

       <b>--gnuplot-file-prefix</b> <b>&lt;file&gt;</b>
              Specify  a  prefix  for  the .gnu, .dat, and .png files that are generated in <u>--gnuplot</u> mode.  So,
              when visualizing attacks captured in an iptables logfile (let's say you  are  interested  in  port
              scans),  you  could  use this option to have <b>psad</b> create the two files portscan.dat, portscan.gnu,
              and Gnuplot will create an additional file portscan.png when the portscan.gnu file is loaded.

       <b>--gnuplot-x-label</b> <b>&lt;label&gt;</b>
              Set the label associated with the x-axis.

       <b>--gnuplot-x-range</b> <b>&lt;range&gt;</b>
              Set the x-axis range.

       <b>--gnuplot-y-label</b> <b>&lt;label&gt;</b>
              Set the label associated with the y-axis.

       <b>--gnuplot-y-range</b> <b>&lt;range&gt;</b>
              Set the y-axis range.

       <b>--gnuplot-z-label</b> <b>&lt;label&gt;</b>
              Set the label associated with the z-axis (only if <u>--gnuplot-3D</u> is used).

       <b>--gnuplot-z-range</b> <b>&lt;range&gt;</b>
              Set the z-axis range. (only if <u>--gnuplot-3D</u> is used).

       <b>--gnuplot-3D</b>
              Generate a Gnuplot <b>splot</b> graph.  This produces a three-dimensional graph.

       <b>--gnuplot-view</b>
              Set the viewing angle when graphing data in <u>--gnuplot-3D</u> mode.

       <b>--gnuplot-title</b> <b>&lt;title&gt;</b>
              Set the graph title for the Gnuplot graph.

       <b>-I</b>, <b>--Interval</b> <b>&lt;seconds&gt;</b>
              Specify the interval (in seconds) that psad should use to check whether or not packets  have  been
              logged  by  the  firewall.   <b>psad</b>  will  use the default of 15 seconds unless a different value is
              specified.

       <b>-l</b>, <b>--log-server</b>
              This option should be used if psad is being executed on a syslog logging server.  Running psad  on
              a  logging  server  requires  that check_firewall_rules() and auto_psad_response() not be executed
              since the firewall is probably not being run locally.

       <b>-V</b>, <b>--Version</b>
              Print the psad version and exit.

       <b>--no-daemon</b>
              Do not run psad as a daemon.  This option will display scan alerts on STDOUT instead  of  emailing
              them out.

       <b>--no-ipt-errors</b>
              Occasionally  iptables  messages written by syslog to <u>/var/log/messages</u> seem to not conform to the
              normal firewall logging format if the kernel ring buffer used by klogd becomes  full.   <b>psad</b>  will
              write  these  message  to  <u>/var/log/psad/errs/fwerrorlog</u>  by default.  Passing the --no-ipt-errors
              option will make psad ignore all such erroneous firewall messages.

       <b>--no-whois</b>
              By default psad will issue a whois query against any IP from which a scan has originated, but this
              can be disabled with the --no-whois command line argument.

       <b>--no-fwcheck</b>
              psad performs a rudimentary check of the firewall ruleset that exists on the machine on which psad
              is deployed to determine whether  or  not  the  firewall  has  a  compatible  configuration  (i.e.
              iptables  has  been  configured to log packets).  Passing the --no-fwcheck or --log-server options
              will disable this check.

       <b>--no-auto-dl</b>
              Disable auto danger level assignments.  This will instruct to  not  import  any  IP  addresses  or
              networks from the file <u>/etc/psad/auto_dl.</u>

       <b>--no-snort-sids</b>
              Disable  snort  sid processing mode.  This will instruct psad to not import snort rules (for snort
              SID matching in a policy generated by <b>fwsnort</b> ).

       <b>--no-signatures</b>
              Disable psad signature processing.  Note that  this  is  independent  of  snort  SID  matching  in
              iptables messages generated by <b>fwsnort</b> and also from the ICMP type/code validation routines.

       <b>--no-icmp-types</b>
              Disable ICMP type and code field validation.

       <b>--no-passive-os</b>
              By  default  psad  will  attempt  to  passively (i.e. without sending any packets) fingerprint the
              remote operating system from which a scan originates.  Passing  the  --no-passive-os  option  will
              disable this feature.

       <b>--no-rdns</b>
              <b>psad</b>  normally  attempts  to find the name associated with a scanning IP address, but this feature
              can be disabled with the --no-rdns command line argument.

       <b>--no-kmsgsd</b>
              Disable startup of kmsgsd.  This option is most useful  for  debugging  with  individual  iptables
              messages so that new messages are not appended to the <u>/var/log/psad/fwdata</u> file.

       <b>--no-netstat</b>
              By  default for iptables firewalls psad will determine whether or not your machine is listening on
              a port for which a TCP signature has been matched.  Specifying --no-netstat disables this feature.

       <b>-h</b>, <b>--help</b>
              Print a page of usage information for psad and exit.

</pre><h4><b>FILES</b></h4><pre>
       <u>/etc/psad/psad.conf</u>
              The main psad configuration file which contains configuration variables mentioned in  the  section
              below.

       <u>/etc/psad/fw_search.conf</u>
              Used  to  configure  the  strategy  both <b>psad</b> and <b>kmsgsd</b> employ to parse iptables messages.  Using
              configuration directive within this file, psad can be configured to parse all iptables messages or
              only those that match specific log prefix strings (see the --log-prefix option to iptables).

       <u>/etc/psad/signatures</u>
              Contains the signatures <b>psad</b> uses to recognize nasty traffic.  The signatures  are  written  in  a
              manner similar to the *lib signature files used in the snort IDS.

       <u>/etc/psad/icmp_types</u>
              Contains  all  valid  ICMP  types and corresponding codes as defined by RFC 792.  By default, ICMP
              packets are validated against these values and an alert will be generated if a  non-matching  ICMP
              packet is logged by iptables.

       <u>/etc/psad/snort_rules/*.rules</u>
              Snort  rules  files that are consulted by default unless the --no-snort-sids command line argument
              is given.

       <u>/etc/psad/auto_dl</u>
              Contains a listing of any IP addresses that should be assigned a danger level based on any traffic
              that is logged by the firewall.  The syntax is "&lt;IP address&gt; &lt;danger level&gt;" where &lt;danger  level&gt;
              is  an  integer  from  0 to 5, with 0 meaning to ignore all traffic from &lt;IP address&gt;, and 5 is to
              assign the highest danger level to &lt;IP address&gt;.

       <u>/etc/psad/posf</u>
              Contains a listing of all passive operating system fingerprinting  signatures.   These  signatures
              include  packet  lengths, ttl, tos, IP ID, and TCP window size values that are specific to various
              operating systems.

</pre><h4><b>PSAD</b> <b>CONFIGURATION</b> <b>VARIABLES</b></h4><pre>
       This section describes what each of the more important <b>psad</b> configuration variables do and how  they  can
       be  tuned  to  meet  your  needs.   Most  of  the  variables  are  located in the <b>psad</b> configuration file
       <u>/etc/psad/psad.conf</u>  but  the  FW_SEARCH_ALL  and  FW_MSG_SEARCH  variables  are  located  in  the   file
       <u>/etc/psad/fw_search.conf.</u>   Each  variable  is  assigned sensible defaults for most network architectures
       during  the  install  process.   More  information  on  psad   config   keywords   may   be   found   at:
       <b><a href="http://www.cipherdyne.org/psad/config.html">http://www.cipherdyne.org/psad/config.html</a></b>

       <b>EMAIL_ADDRESSES</b>
              Contains  a  comma-separated  list  of  email  addresses  to which email alerts will be sent.  The
              default is "root@localhost".

       <b>HOSTNAME</b>
              Defines the hostname of the machine on which <b>psad</b> <b>is</b> <b>running.</b> <b>This</b>  <b>will</b>  <b>be</b>  used  in  the  email
              alerts generated by psad.

       <b>HOME_NET</b>
              Define  the  internal network(s) that are connected to the local system.  This will be used in the
              signature matching code to determine whether traffic matches snort rules, which invariably contain
              a source and destination network.  Multiple networks are supported as a comma separated list,  and
              each  network  should  be  specified  in  CIDR notation.  Normally the network(s) contained in the
              HOME_NET variable should be directly connected to the machine that is running psad.

       <b>IMPORT_OLD_SCANS</b>
              Preserve scan data across restarts of <b>psad</b> or  even  across  reboots  of  the  machine.   This  is
              accomplished  by importing the data contained in the filesystem cache psad writes to during normal
              operation back into memory as psad is started.  The filesystem cache data in contained within  the
              directory <u>/var/log/psad.</u>

       <b>FW_SEARCH_ALL</b>
              Defines  the search mode <b>psad</b> uses to parse iptables messages.  By default FW_SEARCH_ALL is set to
              "Y" since normally most people want all iptables log messages to  be  parsed  for  scan  activity.
              However,  if  FW_SEARCH_ALL  is  set to "N", psad will only parse those iptables log messages that
              match certain search strings that appear in iptables logs with the --log-prefix option.   This  is
              useful  for  restricting  psad  to only operate on specific iptables chains or rules.  The strings
              that will be  searched  for  are  defined  with  the  FW_MSG_SEARCH  variable  (see  below).   The
              FW_SEARCH_ALL  variable  is defined in the file <u>/etc/psad/fw_search.conf</u> since it is referenced by
              both psad and kmsgsd.

       <b>FW_MSG_SEARCH</b>
              Defines a set of search strings that <b>psad</b> uses to identify iptables messages that should be parsed
              for scan activity.  These search strings should match the log  prefix  strings  specified  in  the
              iptables  ruleset with the --log-prefix option, and the default value for FW_MSG_SEARCH is "DROP".
              Note that <b>psad</b> normally parses all iptables messages, and so the FW_MSG_SEARCH  variable  is  only
              needed  if  FW_SEARCH_ALL  (see above) is set to "N".  The FW_MSG_SEARCH variable is referenced by
              both <b>psad</b> and <b>kmsgsd</b> so it lives in the file <u>/etc/psad/fw_search.conf.</u>

       <b>SYSLOG_DAEMON</b>
              Define the specific syslog daemon that <b>psad</b> should interface with.   Psad  supports  three  syslog
              daemons: <b>syslogd,</b> <b>syslog-ng,</b> and <b>metalog.</b>  The default value of SYSLOG_DAEMON is <b>syslogd.</b>

       <b>IGNORE_PORTS</b>
              Specify a list of port ranges and/or individual ports and corresponding protocols that <b>psad</b> should
              complete  ignore.   This is particularly useful for ignore ports that are used as a part of a port
              knocking scheme (such as  <b>fwknop</b>  <a href="http://www.cipherdyne.org/fwknop/">http://www.cipherdyne.org/fwknop/</a>)  for  network  authentication
              since  such  log  messages generated by the knock sequence may otherwise be interpreted as a scan.
              Multiple ports and/or port ranges may be specified  as  a  comma-separated  list,  e.g.   "tcp/22,
              tcp/61000-61356, udp/53".

       <b>ENABLE_PERSISTENCE</b>
              If  "Y",  psad  will  keep  all  scans in memory and not let them timeout.  This can help discover
              stealthy scans where an attacker tries to slip beneath IDS thresholds by only scanning a few ports
              over a long period of time.  ENABLE_PERSISTENCE is set to "Y" by default.

       <b>SCAN_TIMEOUT</b>
              If ENABLE_PERSISTENCE is "N" then psad will use the value set by SCAN_TIMEOUT  to  remove  packets
              from the scan threshold calculation.  The default is 3600 seconds (1 hour).

       <b>DANGER_LEVEL{1,2,3,4,5}</b>
              psad uses a scoring system to keep track of the severity a scans reaches (represented as a "danger
              level")  over  time.   The  DANGER_LEVEL{n}  variables  define  the number of packets that must be
              dropped by the firewall before psad will assign the respective danger level to the scan.   A  scan
              may  also  be  assigned a danger level if the scan matches a particular signature contained in the
              <b>signatures</b> file.  There are five possible danger levels with one being the  lowest  and  five  the
              highest.   Note  there  are  several  factors that can influence how danger levels are calculated:
              whether or  not  a  scan  matches  a  signature  listed  in  <u>/etc/psad/signatures,</u>  the  value  of
              PORT_RANGE_SCAN_THRESHOLD  (see  below),  whether or not a scan comes from an IP that is listed in
              the <u>/etc/psad/auto_dl</u> file, and finally whether or not scans are allowed to timeout as  determined
              by   SCAN_TIMEOUT   above.    If  a  signature  is  matched  or  the  scanning  IP  is  listed  in
              <u>/etc/psad/auto_dl,</u> then the corresponding danger level is automatically assigned to the scan.

       <b>PORT_RANGE_SCAN_THRESHOLD</b>
              Defines the minimum difference between the lowest port and the  highest  port  scanned  before  an
              alert is sent (the default is 1 which means that at least two ports must be scanned to generate an
              alert).   For  example, suppose an ip repeatedly scans a single port for which there is no special
              signature in <b>signatures.</b>  Then if PORT_RANGE_SCAN_THRESHOLD=1, psad will never send an  alert  for
              this  "scan"  no  matter  how many packets are sent to the port (i.e.  no matter what the value of
              DANGER_LEVEL1 is).  The reason for the default of 1 is that a "scan" usually means that  at  least
              two   ports   are   probed,   but   if   you   want   psad  to  be  extra  paranoid  you  can  set
              PORT_RANGE_SCAN_THRESHOLD=0 to alert on scans to single ports (as long as the  number  of  packets
              also exceeds DANGER_LEVEL1).

       <b>SHOW_ALL_SIGNATURES</b>
              If "Y", psad will display all signatures detected from a single scanning IP since a scan was first
              detected  instead of just displaying newly-detected signatures.  SHOW_ALL_SIGNATURES is set to "N"
              by default.  All signatures are listed in the file <u>/etc/psad/signatures.</u>

       <b>SNORT_SID_STR</b>
              Defines the string kmsgsd will search for in iptables log messages that are generated by  iptables
              rules    designed    to    detect   snort   rules.    The   default   is   "SID".    See   <b>fwsnort</b>
              (<a href="http://www.cipherdyne.org/fwsnort/">http://www.cipherdyne.org/fwsnort/</a>).

       <b>ENABLE_DSHIELD_ALERTS</b>
              Enable dshield alerting mode.  This will send  a  parsed  version  of  iptables  log  messages  to
              dshield.org  which is a (free) distributed intrusion detection service.  For more information, see
              <a href="http://www.dshield.org/">http://www.dshield.org/</a>

       <b>IGNORE_CONNTRACK_BUG_PKTS</b>
              If "Y", all TCP packets that have the ACK or RST flag bits set  will  be  ignored  by  psad  since
              usually  we  see  such  packets being blocked as a result of the iptables connection tracking bug.
              Note there are no signatures that make use of the RST flag and very few that use ACK flag.

       <b>ALERT_ALL</b>
              If "Y", send email for all new bad  packets  instead  of  just  when  a  danger  level  increases.
              ALERT_ALL is set to "Y" by default.

       <b>PSAD_EMAIL_LIMIT</b>
              Defines  the  maximum number of emails that will be sent for a single scanning IP (default is 50).
              This variable gives you some protection from psad sending countless alerts if  an  IP  scans  your
              machine  constantly.   <b>psad</b>  will  send a special alert if an IP has exceeded the email limit.  If
              PSAD_EMAIL_LIMIT is set  to  zero,  then  psad  will  ignore  the  limit  and  send  alert  emails
              indefinitely for any scanning ip.

       <b>EMAIL_ALERT_DANGER_LEVEL</b>
              Defines the danger level a scan must reach before any alert is sent.  This variable is set to 1 by
              default.

       <b>ENABLE_AUTO_IDS</b>
              <b>psad</b>  has  the  capability  of  dynamically  blocking  all  traffic  from an IP that has reached a
              (configurable) danger level through modification of iptables or tcpwrapper  rulesets.   <b>IMPORTANT:</b>
              This  feature  is disabled by default since it is possible for an attacker to spoof packets from a
              well known (web)site in an effort to make it look as though the site is scanning your machine, and
              then psad will consequently block all access to it.  Also, psad works by parsing firewall messages
              for packets the firewall has already dropped, so the "scans" are  unsuccessful  anyway.   However,
              some  administrators  prefer  to take this risk anyway reasoning that they can always review which
              sites are being blocked and manually remove the block if necessary (see the <b>--Flush</b> option).  Your
              mileage will vary.

       <b>AUTO_IDS_DANGER_LEVEL</b>
              Defines the danger  level  a  scan  must  reach  before  psad  will  automatically  block  the  IP
              (ENABLE_AUTO_IDS must be set to "Y").

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  following  examples  illustrate  the  command line arguments that could be supplied to psad in a few
       situations:

       Signature checking, passive OS fingerprinting, and automatic IP danger level assignments are  enabled  by
       default without having to specify any command line arguments (best for most situations):

       <b>#</b> <b>psad</b>

       Same as above, but this time we use the init script to start psad:

       <b>#</b> <b>/etc/init.d/psad</b> <b>start</b>

       Use  psad  as  a  forensics  tool  to  analyze  an  old  iptables logfile (psad defaults to analyzing the
       <u>/var/log/messages</u> file if the -m option is not specified):

       <b>#</b> <b>psad</b> <b>-A</b> <b>-m</b> <b>&lt;iptables</b> <b>logfile&gt;</b>

       Run psad in forensics mode, but limit its operations to a specific IP address "10.1.1.1":

       <b>#</b> <b>psad</b> <b>-A</b> <b>-m</b> <b>&lt;iptables</b> <b>logfile&gt;</b> <b>--analysis-fields</b> <b>src:10.1.1.1</b>

       Generate graphs of scan data using AfterGlow:

       <b>#</b> <b>psad</b> <b>--CSV</b> <b>--CSV-fields</b> <b>src</b> <b>dst</b> <b>dp</b>  <b>--CSV-max</b>  <b>1000</b>  <b>-m</b>  <b>&lt;iptables</b>  <b>logfile&gt;</b>  <b>|</b>  <b>perl</b>  <b>afterglow.pl</b>  <b>-c</b>
       <b>color.properties</b> <b>|</b> <b>neato</b> <b>-Tgif</b> <b>-o</b> <b>iptables_graph.gif</b>

       The  <b>psad.conf,</b>  <b>signatures,</b>  and <b>auto_dl</b> files are normally located within the /etc/psad/ directory, but
       the paths to each of these files can be changed:

       <b>#</b> <b>psad</b> <b>-c</b> <b>&lt;config</b> <b>file&gt;</b> <b>-s</b> <b>&lt;signatures</b> <b>file&gt;</b> <b>-a</b> <b>&lt;auto</b> <b>ips</b> <b>file&gt;</b>

       Disable the firewall check and the local port lookup subroutines; most useful if psad is  deployed  on  a
       syslog logging server:

       <b>#</b> <b>psad</b> <b>--log-server</b> <b>--no-netstat</b>

       Disable  reverse dns and whois lookups of scanning IP addresses; most useful if speed of psad is the main
       concern:

       <b>#</b> <b>psad</b> <b>--no-rdns</b> <b>--no-whois</b>

</pre><h4><b>DEPENDENCIES</b></h4><pre>
       <b>psad</b> requires that iptables is configured with a "drop and log"  policy  for  any  traffic  that  is  not
       explicitly  allowed  through.   This  is consistent with a secure network configuration since all traffic
       that has not been explicitly allowed should be  blocked  by  the  firewall  ruleset.   By  default,  psad
       attempts  to  determine whether or not the firewall has been configured in this way.  This feature can be
       disabled with the --no-fwcheck or --log-server options.  The --log-server option is  useful  if  psad  is
       running  on  a  syslog  logging  server  that  is  separate  from  the firewall.  For more information on
       compatible iptables rulesets, see the  <b>FW_EXAMPLE_RULES</b>  file  that  is  bundled  with  the  psad  source
       distribution.

       <b>psad</b> by default parses the <u>/var/log/messages</u> file for all iptables log data.

</pre><h4><b>DIAGNOSTICS</b></h4><pre>
       The --debug option can be used to display crucial information about the psad data structures on STDOUT as
       a scan generates firewall log messages.  --debug disables daemon mode execution.

       Another  more effective way to peer into the runtime execution of psad is to send (as root) a USR1 signal
       to  the  psad  process  which  will  cause  psad  to  dump  the   contents   of   the   %Scan   hash   to
       <u>/var/log/psad/scan_hash.$$</u> where <b>$$</b> represents the pid of the psad process.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/iptables.8.html">iptables</a></b>(8), <b><a href="../man8/kmsgsd.8.html">kmsgsd</a></b>(8), <b><a href="../man8/psadwatchd.8.html">psadwatchd</a></b>(8), <b><a href="../man8/fwsnort.8.html">fwsnort</a></b>(8), <b><a href="../man8/snort.8.html">snort</a></b>(8), <b><a href="../man1/nmap.1.html">nmap</a></b>(1), <b><a href="../man1/p0f.1.html">p0f</a></b>(1), <b><a href="../man1/gnuplot.1.html">gnuplot</a></b>(1)

</pre><h4><b>AUTHOR</b></h4><pre>
       Michael Rash &lt;<a href="mailto:mbr@cipherdyne.org">mbr@cipherdyne.org</a>&gt;

</pre><h4><b>CONTRIBUTORS</b></h4><pre>
       Many  people  who are active in the open source community have contributed to psad.  See the <b>CREDITS</b> file
       in the psad sources, or visit <b><a href="http://www.cipherdyne.org/psad/docs/contributors.html">http://www.cipherdyne.org/psad/docs/contributors.html</a></b> to  view  the  online
       list of contributors.

</pre><h4><b>BUGS</b></h4><pre>
       Send bug reports to <a href="mailto:mbr@cipherdyne.org">mbr@cipherdyne.org</a>.  Suggestions and/or comments are always welcome as well.

       For  iptables  firewalls  as  of  Linux  kernel  version 2.4.26, if the ip_conntrack module is loaded (or
       compiled into the kernel) and the firewall has been configured to keep state of connections, occasionally
       packets that are supposed to be part of normal TCP traffic will not be correctly identified due to a  bug
       in  the  firewall  state  timeouts and hence dropped.  Such packets will then be interpreted as a scan by
       psad even though they are not part of any malicious activity.   Fortunately,  an  interim  fix  for  this
       problem     is     to     simply     extend     the    TCP_CONNTRACK_CLOSE_WAIT    timeout    value    in
       linux/net/ipv4/netfilter/ip_conntrack_proto_tcp.c from 60 seconds to 2  minutes,  and  a  set  of  kernel
       patches is included within the patches/ directory in the psad sources to change this.  (Requires a kernel
       recompile  of  course; see the Kernel-HOWTO.)  Also, by default the IGNORE_CONNTRACK_BUG_PKTS variable is
       set to "Y" in psad.conf which causes psad to ignore all TCP packets that have the ACK bit set unless  the
       packets match a specific signature.

</pre><h4><b>DISTRIBUTION</b></h4><pre>
       <b>psad</b>  is distributed under the GNU General Public License (GPL), and the latest version may be downloaded
       from: <b><a href="http://www.cipherdyne.org/">http://www.cipherdyne.org/</a></b> Snort is a registered trademark of Sourcefire, Inc.

Linux                                              March 2009                                            <u><a href="../man8/PSAD.8.html">PSAD</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>