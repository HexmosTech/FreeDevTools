<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ploop - ploop device management utility</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/ploop">ploop_1.15-9_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ploop - ploop device management utility

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>ploop</b> <b>init</b> <b>-s</b> <u>size</u> [<b>-f</b> <u>format</u>] [<b>-v</b> <u>version</u>] [<b>-t</b> <u>fstype</u>] [<b>-b</b> <u>blocksize</u>] [<b>-B</b> <u>fsblocksize</u>] [<b>--nolazy</b>]
                  <u>delta_file</u>

       <b>ploop</b> <b>mount</b> [<b>-r</b>] [<b>-F</b>] [<b>-f</b> <u>format</u>] [<b>-b</b> <u>blocksize</u>] [<b>-d</b> <u>device</u>] [<b>-m</b> <u>mount_point</u>] [<b>-o</b> <u>mount_options</u>]
                   [<b>-t</b> <u>fstype</u>] <u>base_delta</u> [<u>...</u>  <u>top_delta</u>]

       <b>ploop</b> <b>mount</b> [<b>-r</b>] [<b>-F</b>] [<b>-d</b> <u>device</u>] [<b>-m</b> <u>mount_point</u>] [<b>-o</b> <u>mount_options</u>] [<b>-t</b> <u>fstype</u>] [<b>-u</b> <u>uuid</u>]
                   <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>umount</b> { <b>-d</b> <u>device</u> | <b>-m</b> <u>mount_point</u> | <u>DiskDescriptor.xml</u> | <u>image_file</u> }

       <b>ploop</b> <b>replace</b> { <b>-u</b> <u>uuid</u> | <b>-l</b> <u>level</u> | <b>-o</b> <u>cur_image_file</u> } [<b>--keep-name</b>] <b>-i</b> <u>image_file</u> <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>resize</b> <b>-s</b> <u>size</u> <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>convert</b> { <b>-f</b> <u>format</u> | <b>-v</b> <u>version</u> } <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>check</b> [<b>-u</b> <u>uuid</u>] <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>check</b> [<b>--force</b>] [<b>--hard-force</b>] [<b>--check</b>] [<b>--ro</b>] [<b>--silent</b>] [<b>--drop-inuse</b>] [<b>--raw</b>]
                   [<b>--blocksize</b> <u>size</u>] [<b>--repair-sparse</b>] <u>image_file</u>

       <b>ploop</b> <b>info</b> [<b>-s</b>] [<b>-d</b>] <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>list</b> [<b>-a</b>]

       <b>ploop</b> <b>snapshot</b> [<b>-u</b> <u>uuid</u>] <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>snapshot-merge</b> [<b>-u</b> <u>uuid</u> [<b>-U</b> <u>uuid2</u>] | <b>-A</b>] [<b>-n</b> <u>new_delta</u>] <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>snapshot-switch</b> <b>-u</b> <u>uuid</u> <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>snapshot-delete</b> <b>-u</b> <u>uuid</u> <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>snapshot-list</b> [<b>-H</b>] [<b>-u</b> <u>uuid</u>] [<b>-s</b>] [<b>-o</b> <u>field</u>[,<u>field</u>...]]  <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>copy</b> <b>-s</b> <u>device</u> [<b>-F</b> <u>stop_command</u>] { [<b>-d</b> <u>file</u>] | [<b>-o</b> <u>output_fd</u>] [<b>-f</b> <u>feedback_fd</u>] }

       <b>ploop</b> <b>copy</b> <b>-d</b> <u>file</u> [<b>-i</b> <u>input_fd</u>] [<b>-f</b> <u>feedback_fd</u>]

       <b>ploop</b> <b>balloon</b> <b>discard</b> [<b>--automount</b>] [<b>--to-free</b> <u>size</u>] [<b>--min-block</b> <u>min_size</u>] [<b>--defrag</b>] <u>DiskDescriptor.xml</u>

       <b>ploop</b> <b>restore-descriptor</b> <b>-f</b> <u>format</u> [<b>-b</b> <u>blocksize</u>] <u>disk_dir</u> <u>delta_file</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       ploop  is  a  kernel  block  device,  similar  to  the  traditional  loop  device (which is controlled by
       <b><a href="../man8/losetup.8.html">losetup</a></b>(8)) but with more features added, such as dynamic disk space allocation, stackable images, online
       resize, snapshotting, and live migration helper (write tracker). This manual  page  describes  the  ploop
       user space tool which is used to perform various operations related to ploop devices and images.

       Note that this ploop tool is not aware of container entities. Commands that have <b>DiskDescriptor.xml</b> as an
       argument  work  with  an  XML  file  that  contains  meta-information  about  a  particular  ploop device
       configuration: device characteristics (block size etc.), storage information (names and formats of images
       used for the device), snapshot information, etc. If a particular  command  can  be  used  both  with  and
       without the DiskDescriptor.xml argument, it is strongly advised to use the form with DiskDescriptor.xml.

</pre><h4><b>OPTIONS</b></h4><pre>
       Run <b>ploop</b> without any options to show a short synopsss, including a list of commands.

       Run <b>ploop</b> <u>command</u> to show synopsis and a short description for a particular <u>command</u>.

   <b>Basic</b> <b>commands</b>
   <b>init</b>

       Create and initialize a ploop image file and a corresponding <b>DiskDescriptor.xml</b> file.

       <b>ploop</b> <b>init</b> <b>-s</b> <u>size</u> [<b>-f</b> <u>format</u>] [<b>-v</b> <u>version</u>] [<b>-t</b> <u>fstype</u>] [<b>-b</b> <u>blocksize</u>] [<b>-B</b> <u>fsblocksize</u>] [<b>--nolazy</b>]
                  <u>delta_file</u>

       <b>-s</b> <u>size</u>    Image  size. If no suffix is specified, the <u>size</u> is in sector units (one sector is 512 bytes).
                  One can specify optional <b>K</b>, <b>M</b>, <b>G</b> or <b>T</b> suffix to  set  the  size  in  kilo-,  mega-,  giga-  or
                  terabytes.

       <b>-f</b> <u>format</u>  Image format. See <b>Image</b> <b>formats</b> below.

       <b>-v</b> <u>version</u> Image version, can be <b>1</b> or <b>2</b>. Default is <b>2</b>, if supported by the kernel.

       <b>-t</b> <b>none</b>|<b>ext3</b>|<b>ext4</b>
                  File  system  type  to  create,  default  is  <b>ext4</b>.  Unless  <b>none</b> is specified, a partition, a
                  filesystem, and a  balloon  file  will  be  created  inside  the  image.  Using  <b>ext3</b>  is  not
                  recommended.

       <b>-b</b> <u>blocksize</u>
                  Device block size, in 512 byte sectors. Default block size is 2048 sectors, or 1 megabyte.

       <b>-B</b> <u>fsblocksize</u>
                  Filesystem block size, in bytes. Default is 4096 bytes.

       <b>-n</b>, <b>--nolazy</b>
                  Disable  lazy mkfs initialization (which is enabled by default).  Currently that means if this
                  flag is set, <b><a href="../man8/mkfs.ext4.8.html">mkfs.ext4</a></b>(8) is called with <b>-Elazy_itable_init=0,lazy_journal_init=0</b> options.

       <u>delta_file</u> Path to a non-existent image file to be created.

   <b>mount</b>

       Assemble a ploop device from one or more delta images, start it, and optionally  mount  the  file  system
       residing on the device.

       Two  forms  of  this  command  are  provided. The first one accepts a list of delta images to be used for
       assembling the ploop device, while the second one is using information from  a  DiskDescriptor.xml  file.
       Please note that not all mount options are applicable to both forms.

       <b>ploop</b> <b>mount</b> [<b>-r</b>] [<b>-F</b>] [<b>-f</b> <u>format</u>] [<b>-b</b> <u>blocksize</u>] [<b>-d</b> <u>device</u>] [<b>-m</b> <u>mount_point</u>] [<b>-o</b> <u>mount_options</u>]
                   [<b>-t</b> <u>fstype</u>] <u>base_delta</u> [<u>...</u>  <u>top_delta</u>]

       <b>ploop</b> <b>mount</b> [<b>-r</b>] [<b>-F</b>] [<b>-d</b> <u>device</u>] [<b>-m</b> <u>mount_point</u>] [<b>-o</b> <u>mount_options</u>] [<b>-t</b> <u>fstype</u>] [<b>-u</b> <u>uuid</u>]
                   <u>DiskDescriptor.xml</u>

       <b>-r</b>          Mount as read-only.

       <b>-F</b>          Run <b><a href="../man8/fsck.8.html">fsck</a></b>(8) on inner filesystem before mounting it. This option is ignored if <b>-m</b> is not used.

       <b>-f</b> <u>format</u>   Image format.  Ignored if DiskDescriptor.xml is specified. Otherwise, one need to specify <b>raw</b>
                   as an argument, if raw image format is used.

       <b>-b</b> <u>blocksize</u>
                   Device  block  size,  in  512  byte  sectors.   Ignored  if  DiskDescriptor.xml is specified.
                   Otherwise, required for raw images.

       <b>-d</b> <u>device</u>   Ploop device to use, e.g. <b>/dev/ploop0</b>. If not specified, a  randomly  numbered  ploop  device
                   will be used.

       <b>-m</b> <u>mount_point</u>
                   If  this  option is specified, ploop goes on to mount the file system to directory denoted by
                   <u>mount_point</u>.

       <b>-o</b> <u>mount_options</u>
                   Any additional mount options, comma-separated. Used if <b>-m</b> is set.

       <b>-t</b> <u>fstype</u>   File system type used for mounting. Used if <b>-m</b> is set.  The default is <b>ext4</b>.

       <b>-u</b> <u>uuid</u> | <b>base</b>
                   GUID of the image from the DiskDescriptor.xml to be mounted. By default, top  GUID  is  used.
                   The special '<b>base</b>' value can be used to mount the base (lower-level) image.

       <u>base_delta</u> [... <u>top_delta</u>]
                   List  of image files to mount, with the first one being the base delta and the last one being
                   the top delta (i.e. the one that will be writable unless <b>-r</b> is specified).

       <u>DiskDescriptor.xml</u>
                   Path to the DiskDescriptor.xml file with information about images.

   <b>umount</b>

       Unmount a ploop device. Since a mounted ploop device consists of an image (or multiple images), a device,
       and (optionally) a file system mounted to a directory, one can refer to any  of  the  above  entities  to
       specify what to unmount. The recommended way is to use DiskDescriptor.xml.

       <b>ploop</b> <b>umount</b> { <b>-d</b> <u>device</u> | <b>-m</b> <u>mount_point</u> | <u>DiskDescriptor.xml</u> | <u>image_file</u> }

       <b>-d</b> <u>device</u>    Ploop device, e.g., <b>/dev/ploop0</b>.

       <b>-m</b> <u>mount_point</u>
                    Mount point of a ploop device to unmount.

       <u>DiskDescriptor.xml</u>
                    Path to the DiskDescriptor.xml file with information about images.

       <u>image_file</u>   Path to a mounted image file.

   <b>replace</b>

       Replaces  a  ploop  image by a different (but identical) one, on a running ploop device. Only a read-only
       image (e.g. a non-top one in a stacked configuration) can  be  replaced.  An  image  to  be  replaced  is
       specified by either one of level, UUID, or the current image file.

       If  a  new  image is not identical to the old one (i.e. its content differs) or not suitable for ploop in
       any other way (e.g. it is sparse, or resides on a file system not supported  by  ploop),  the  result  is
       undefined.

       <b>ploop</b> <b>replace</b> { <b>-u</b> <u>uuid</u> | <b>-l</b> <u>level</u> | <b>-o</b> <u>cur_image_file</u> } [<b>--keep-name</b>] <b>-i</b> <u>image_file</u> <u>DiskDescriptor.xml</u>

       <b>-u</b> <u>uuid</u>       A <u>uuid</u> of an image to be replaced.

       <b>-l</b> <u>level</u>      A level of image to be replaced. A level is a distance of an image from the base delta.

       <b>-o</b> <u>cur_image_file</u>
                     A current image file (the one to replace).

       <b>-k</b>, <b>--keep-name</b>
                     A  flag to keep the same image file name. If this flag is set, after the image is replaced,
                     a new <u>image_file</u> is renamed to the old one (removing the old, now  unused,  image),  so  no
                     modification to DiskDescriptor.xml is required.

       <b>-i</b> <u>image_file</u> A new replacement image.

       <u>DiskDescriptor.xml</u>
                     Path to the DiskDescriptor.xml file with information about images.

   <b>resize</b>

       Resize  a ploop image. Both online (i.e. when ploop is mounted and used) and offline resize is supported,
       and the tool can either grow or shrink both the ploop image and the underlying file system.

       <b>ploop</b> <b>resize</b> <b>-s</b> <u>size</u> <u>DiskDescriptor.xml</u>

       <b>-s</b> <u>size</u>      Image size. If no suffix is specified, <u>size</u> is in sector units (one sector  is  512  bytes).
                    One  can  specify  optional  <b>K</b>,  <b>M</b>,  <b>G</b> or <b>T</b> suffix to set the size in kilo-, mega-, giga- or
                    terabytes.

       <u>DiskDescriptor.xml</u>
                    Path to the DiskDescriptor.xml file with information about images.

   <b>convert</b>

       Convert either ploop image format or version (but not both at the same time).   Conversion  can  only  be
       performed offline (i.e. image should not be in use).

       <b>ploop</b> <b>convert</b> { <b>-f</b> <u>format</u> | <b>-v</b> <u>version</u> } <u>DiskDescriptor.xml</u>

       <b>-f</b> <u>format</u>     Image format. See <b>Image</b> <b>formats</b> below.

       <b>-v</b> <u>version</u>    Image version, can be <b>1</b> or <b>2</b>.

   <b>check</b>

       Check  the internal consistency of (and possibly repair) a ploop image (or images). Note that image(s) to
       be tested should not be in use.

       <b>ploop</b> <b>check</b> [<b>-u</b> <u>uuid</u>] <u>DiskDescriptor.xml</u>

       Check all the images in <u>DiskDescriptor.xml</u> up to the one denoted by the <u>uuid</u> (or default  top  delta,  if
       UUID  is  not  specified). Default built-in check options are used, and the ones specified on the command
       line, if any, are ignored.

       <b>ploop</b> <b>check</b> [<b>--force</b>] [<b>--hard-force</b>] [<b>--check</b>] [<b>--ro</b>] [<b>--silent</b>] [<b>--drop-inuse</b>] [<b>--raw</b>]
                   [<b>--blocksize</b> <u>size</u>] [<b>--repair-sparse</b>] <u>DiskDescriptor.xml</u> | <u>image_file</u>

       <b>-f</b>, <b>--force</b> Force check even if image's dirty flag is not set.

       <b>-F</b>, <b>--hard-force</b>
                   Same as <b>-f</b>, plus try to fix even fatal errors (can be dangerous).

       <b>-c</b>, <b>--check</b> Check for duplicated blocks and holes.

       <b>-r</b>, <b>--ro</b>    Read-only access, do not modify image(s).

       <b>-s</b>, <b>--silent</b>
                   Be more silent, only report errors.

       <b>-d</b>, <b>--drop-inuse</b>
                   Drop image "in use" flag.

       <b>-R</b>, <b>--raw</b>   Specifies that <u>image_file</u> is a raw ploop image.

       <b>-b</b>, <b>--blocksize</b> <u>size</u>
                   Image cluster block size, in sectors (for raw images).

       <b>-S</b>, <b>--repair-sparse</b>
                   Repair sparse image(s).

   <b>Miscellaneous</b> <b>commands</b>
   <b>info</b>

       <b>ploop</b> <b>info</b> <u>DiskDescriptor.xml</u>
       When run without any options, show information about disk space and inodes usage and limits on the  inner
       ploop filesystem, somewhat similar to <b><a href="../man8/vzquota.8.html">vzquota</a></b>(8) <b>stat</b> or <b>show</b> commands.

       <b>ploop</b> <b>info</b> [<b>-s</b>] [<b>-d</b>] <u>DiskDescriptor.xml</u>
       Either one or both options can be used together. Option <b>-s</b> is used to show information about ploop device
       size,  block  size, and format version.  Option <b>-d</b> is used to show a corresponding ploop block device, it
       available.  file.

   <b>list</b>

       <b>ploop</b> <b>list</b> [<b>-a</b>]

       Shows a list of running ploop devices (first column) and their corresponding base images. With option  <b>-a</b>
       it also shows a mount point (third column).

   <b>restore-descriptor</b>

       Create DiskDescriptor.xml file suitable for <u>delta_file</u> and put it into <u>disk_dir</u>.

       <b>ploop</b> <b>restore-descriptor</b> <b>-f</b> <u>format</u> [<b>-b</b> <u>blocksize</u>] <u>disk_dir</u> <u>delta_file</u>

       Read image header in case of ploop1 format or check raw image size and generate proper DiskDescriptor.xml
       file.  You  can specify blocksize for raw images. If it's not specified it will be chosen automatically -
       largest possible value between 32K and 1M. Raw image size must be aligned to blocksize.

       This command works only for base images. Snapshots are not supported.

   <b>Working</b> <b>with</b> <b>snapshots</b>
       Ploop snapshots is a mechanism for creating and  managing  instant  states  of  a  running  file  system.
       Creating a snapshot leads to creating a new empty ploop image which is layered on top of an old one, then
       all  writes  are ending up in the top image, and reads are falling through to a lower level. There can be
       up to 126) stacked ploop images (or snapshots). Online snapshot merging is also supported.

       Snapshots are identified by a unique UUID. A snapshot can be mounted using <b>ploop</b> <b>mount</b> <b>-u</b>  <u>uuid</u>  command,
       see above.

   <b>snapshot</b>

       Create a ploop snapshot.

       <b>ploop</b> <b>snapshot</b> [<b>-u</b> <u>uuid</u>] <u>DiskDescriptor.xml</u>

       <b>-u</b> <u>uuid</u>        Specify  a  <u>uuid</u>  for  a  new  snapshot.  If  option  is  not  given,  uuid  is  generated
                      automatically. To generate uuid manually, one can use the <b><a href="../man1/uuidgen.1.html">uuidgen</a></b>(1)  utility.  Note  that
                      UUID must be enclosed in curly brackets.

   <b>snapshot-merge</b>

       Merge  a  snapshot  with its parent. That is, contents of the delta file corresponding to the snapshot is
       merged to a parent delta, then the file is removed. Parent snapshot UUID is lost (as it is replaced  with
       the  <u>uuid</u>  specified).  All snapshots having the lost one as a parent are updated to have the <u>uuid</u> as its
       parent.

       <b>ploop</b> <b>snapshot-merge</b> [<b>-u</b> <u>uuid</u> [<b>-U</b> <u>uuid2</u>] | <b>-A</b>] [<b>-n</b> <u>new_delta</u>] <u>DiskDescriptor.xml</u>

       <b>-u</b> <u>uuid</u>              Specify a single snapshot <u>uuid</u> to merge.  If this option is not specified,  the  top
                            delta will be used.

       <b>-U</b> <u>uuid2</u>             Together  with  <b>-u</b> <u>uuid</u>, specify that all snapshots in the range <u>uuid</u>...<u>uuid2</u> are to
                            be merged.

       <b>-A</b>                   Merge all snapshots down to base delta. If some snapshots have more  than  a  single
                            child, they will be impossible to merge.

       <b>-n</b> <u>new_delta</u>         If  this option is set, instead of merging the child delta into its parent, both the
                            parent and the child deltas are merged into a newly created  file  <u>new_delta</u>,  which
                            replaces the parent delta. Both deltas are then removed.

   <b>snapshot-switch</b>

       Switch  to  the specified snapshot. This operation can only be performed while ploop is not running (i.e.
       is unmounted). The current top delta image will be removed.

       <b>ploop</b> <b>snapshot-switch</b> <b>-u</b> <u>uuid</u> <u>DiskDescriptor.xml</u>

       <b>-u</b> <u>uuid</u>               Specify a snapshot <u>uuid</u> to switch to.

   <b>snapshot-delete</b>

       Delete the specified snapshot. This operation can only be performed if  the  specified  snapshot  is  not
       active.  In  case  snapshot  doesn't have any children, it will simply be removed. In case snapshot has a
       single child, it will be merged to that  child.  Deleting  a  snapshot  that  has  multiple  children  is
       currently not supported (but can be performed manually in an iterative fashion).

       <b>ploop</b> <b>snapshot-delete</b> <b>-u</b> <u>uuid</u> <u>DiskDescriptor.xml</u>

       <b>-u</b> <u>uuid</u>               Specify a snapshot <u>uuid</u> to be deleted.

   <b>snapshot-list</b>

       List available snapshots.

       <b>ploop</b> <b>snapshot-list</b> [<b>-H</b>] [<b>-u</b> <u>uuid</u>] [<b>-s</b>] [<b>-o</b> <u>field</u>[,<u>field</u>...]]  <u>DiskDescriptor.xml</u>

       <b>-H</b>, <b>--no-header</b>     Suppress displaying the header row. Usable for scripts.

       <b>-u</b>, <b>--uuid</b>, <b>--id</b> <u>uuid</u>
                           Filter the output to a specified <u>uuid</u>.

       <b>-s</b>, <b>--snapshot</b>      List  in  terms of snapshots. By default (i.e. without this option) the command lists
                           all deltas, and top delta is marked as current.  When this option is used, top  delta
                           is  not  listed,  and  the  snapshot  which  is  the parent of top delta is marked as
                           current.

       <b>-o</b>, <b>--output</b> <u>field</u>[,<u>field</u>...]
                           Display only the specified <u>field</u>s. Possible fields are:
                           • <b>uuid</b>         - snapshot's UUID;
                           • <b>parent_uuid</b>  - snapshot's parent UUID;
                           • <b>current</b> - if this snapshot is the current one;
                           • <b>fname</b>   - snapshot image file name.

   <b>Image</b> <b>copying</b>
       <b>ploop</b> <b>copy</b> is a mechanism of effective copying of a top ploop image  with  the  help  of  build-in  ploop
       kernel  driver  feature  called  write  tracker.   Write  tracker  is  a  feature that lets <b>ploop</b> <b>copy</b> to
       iteratively obtain a list of modified image blocks from the kernel. Two <b>ploop</b> <b>copy</b> processes are required
       for iterative top delta transfer. These are used by <b><a href="../man8/vzmigrate.8.html">vzmigrate</a>(8).</b>

   <b>copy</b> <b>(sending)</b>

       <b>ploop</b> <b>copy</b> <b>-s</b> <u>device</u> [<b>-F</b> <u>stop_command</u>] { [<b>-d</b> <u>file</u>] | [<b>-o</b> <u>output_fd</u>] [<b>-f</b> <u>feedback_fd</u>] }

       This command enables the in-kernel write tracker for the specified ploop <u>device,</u> then sends all the  data
       blocks  from  the  top  delta  image  to  a  pipe specified by the <u>output_fd</u> argument (<b>stdout</b>, i.e.  <b>1</b> by
       default), supposedly read by destination <b>ploop</b> <b>copy</b>, or a <u>file</u>.  After that, it iteratively gets the list
       of the modified data blocks from the kernel and sends those blocks again. After a  number  of  iterations
       (or  when the list is empty), it executes the <u>stop_command</u> (this could be <b>vzctl</b> <b>stop</b> or <b>vzctl</b> <b>chkpnt</b>) and
       does the last iteration of sending the modified data blocks. Finally, it checks that the  data  were  not
       modified, error is returned otherwise.

       If  <u>feedback_fd</u>  is  specified,  it is used to read back from the ploop copy receiving side. The feedback
       channel is currently used to wait for <b><a href="../man2/fdatasync.2.html">fdatasync</a></b>(2) completion.

   <b>copy</b> <b>(receiving)</b>

       <b>ploop</b> <b>copy</b> <b>-d</b> <u>file</u> [<b>-i</b> <u>input_fd</u>] [<b>-f</b> <u>feedback_fd</u>]

       Reads the data blocks (provided by the source <b>ploop</b> <b>copy</b>) from the file descriptor <u>input_fd</u> (<b>stdin</b>,  i.e.
       <b>0</b> by default) and writes them to the <u>file</u>.

       If <u>feedback_fd</u> is specified, it is used to send status back to the ploop copy sending side.

   <b>Ballooning</b>
       Since  there  is  no  online shrink support in <b>ext4</b> file system, ploop internally uses a technique called
       "ballooning" as a work around to shrink its images.

       Ballooning operation consists of inflating a special balloon file (invisible for ordinary users), loading
       fiemap info of the inflated balloon to the kernel, relocating blocks of the image file from the  tail  to
       the  space  specified by fiemap info, and truncating the tail of the image file. Result is the image file
       of a smaller size.

       However, it is quite possible that inflated balloon file will only span blocks that  were  never  touched
       before.  Those  will  look  like  "not allocated" space from the kernel ploop point of view. In this case
       nothing will be relocated and nothing truncated.

       So, if balloon operation succeeded, it's only guaranteed that a user of ploop device  won't  be  able  to
       consume  more  space  than  the initial block device size minus the size of the inflated balloon.  On the
       other hand, if a user of block device used a lot of space on it, then freed the significant part of  used
       space, balloon operation will result in significant truncate of image file.

       All the ploop ballooning logic is hidden from the end user, so while a number of low-level commands exist
       for working with ploop ballooning, those are not needed and therefore are not documented here, except for
       a single command.

   <b>balloon</b> <b>discard</b>

       In  a  situation when a lot of disk space were freed on an in-ploop filesystem, use <b>ploop</b> <b>balloon</b> <b>discard</b>
       to optimize the ploop image size.

       <b>ploop</b> <b>balloon</b> <b>discard</b> [<b>--automount</b>] [<b>--to-free</b> <u>size</u>] [<b>--min-block</b> <u>min_size</u>] [<b>--defrag</b>] <u>DiskDescriptor.xml</u>

       Iteratively try to relocate and discard unused blocks from a ploop image, reducing its size.

       Note that ploop device and its inner file system should be mounted.  If  not,  one  can  use  <b>--automount</b>
       option to automatically mount ploop for the duration of the operation.

       Option  <b>--defrag</b>  can  be  used  to run a filesystem defragmentation utility (currently e4defrag2 on ext4
       only) before the main operation.

       Option <b>--to-free</b> can be used to specify a maximum disk space to  be  freed.  In  other  words,  stop  the
       process  once  freed space exceeded requested <u>size</u>. Default is 0, meaning to try to free as much space as
       possible.

       Option <b>--min-block</b> can be used to specify a minimum size of an extent  to  free.  The  smallest  possible
       extent  is  1  cluster  (currently  1  MB), one can specify higher value to speed up the whole discarding
       operation.

       Note that the same functionality is available by means of <b>vzctl</b> <b>compact</b> command.

   <b>Image</b> <b>formats</b>
       The following image formats are currently supported.

       <b>raw</b>    Raw format, with 1:1 mapping between the image file and the ploop device.

       <b>ploop1</b>, <b>expanded</b>
              Expanded format. The image will grow according to the needs of the underlying  file  system.  This
              format is the default.  Names '<b>ploop1</b>' and '<b>expanded</b>' are aliases.

       <b>preallocated</b>
              This  is  the  same  as  '<b>ploop1</b>'  or  '<b>expanded</b>',  the only difference is all the file blocks are
              allocated during creation.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       <b>ploop</b> exits with status 0 in case of successful execution. Any status greater than 0 signifies an error.

       <b>1</b>, <b>SYSEXIT_CREAT</b>
              Error creating a file.

       <b>2</b>, <b>SYSEXIT_DEVICE</b>
              Error getting or opening a ploop device.

       <b>3</b>, <b>SYSEXIT_DEVIOC</b>
              Error doing <b><a href="../man2/ioctl.2.html">ioctl</a></b>(2) on ploop device.

       <b>4</b>, <b>SYSEXIT_OPEN</b>
              Error opening a file.

       <b>5</b>, <b>SYSEXIT_MALLOC</b>
              Not enough memory (error from <b><a href="../man3/malloc.3.html">malloc</a></b>(3), <b><a href="../man3/realloc.3.html">realloc</a></b>(3), <b><a href="../man3/calloc.3.html">calloc</a></b>(3), or <b><a href="../man3/posix_memalign.3.html">posix_memalign</a></b>(3)).

       <b>6</b>, <b>SYSEXIT_READ</b>
              Error during read.

       <b>7</b>, <b>SYSEXIT_WRITE</b>
              Error during write.

       <b>9</b>, <b>SYSEXIT_SYSFS</b>
              Error reading from a sysfs file (usually under <b>/sys/block/ploop...</b>).

       <b>11</b>, <b>SYSEXIT_PLOOPFMT</b>
              Corrupted ploop image detected.

       <b>12</b>, <b>SYSEXIT_SYS</b>
              Other system error.

       <b>13</b>, <b>SYSEXIT_PROTOCOL</b>
              Broken protocol (unexpected value received).

       <b>14</b>, <b>SYSEXIT_LOOP</b>
              <b>pcopy</b> command can't finalize copying (frozen filesystem is changing).

       <b>15</b>, <b>SYSEXIT_FSTAT</b>
              Error from <b><a href="../man2/stat.2.html">stat</a></b>(2), <b><a href="../man2/fstat.2.html">fstat</a></b>(2), or <b><a href="../man2/statfs.2.html">statfs</a></b>(2).

       <b>16</b>, <b>SYSEXIT_FSYNC</b>
              Error from <b><a href="../man2/fsync.2.html">fsync</a></b>(2) or <b><a href="../man2/syncfs.2.html">syncfs</a></b>(2).

       <b>17</b>, <b>SYSEXIT_EBUSY</b>
              Can't continue, another operation is in progress.

       <b>18</b>, <b>SYSEXIT_FLOCK</b>
              Error from <b><a href="../man2/flock.2.html">flock</a></b>(2).

       <b>19</b>, <b>SYSEXIT_FTRUNCATE</b>
              Error from <b><a href="../man2/ftruncate.2.html">ftruncate</a></b>(2) or <b><a href="../man2/truncate.2.html">truncate</a></b>(2).

       <b>20</b>, <b>SYSEXIT_FALLOCATE</b>
              Error from <b><a href="../man2/fallocate.2.html">fallocate</a></b>(2).

       <b>21</b>, <b>SYSEXIT_MOUNT</b>
              Can't mount ploop image or file system.

       <b>22</b>, <b>SYSEXIT_UMOUNT</b>
              Can't unmount ploop image or file system.

       <b>23</b>, <b>SYSEXIT_LOCK</b>
              Locking failed (another operation in progress?).

       <b>24</b>, <b>SYSEXIT_MKFS</b>
              Can't create file system.

       <b>26</b>, <b>SYSEXIT_RESIZE_FS</b>
              Utility <b>resizefs</b> failed.

       <b>27</b>, <b>SYSEXIT_MKDIR</b>
              Error from <b><a href="../man2/mkdir.2.html">mkdir</a></b>(2).

       <b>28</b>, <b>SYSEXIT_RENAME</b>
              Error from <b><a href="../man2/rename.2.html">rename</a></b>(2).

       <b>29</b>, <b>SYSEXIT_ABORT</b>
              Operation aborted.

       <b>30</b>, <b>SYSEXIT_RELOC</b>
              Block relocation failed.

       <b>33</b>, <b>SYSEXIT_CHANGE_GPT</b>
              Error resizing GPT partition table.

       <b>35</b>, <b>SYSEXIT_UNLINK</b>
              Error from <b><a href="../man2/unlink.2.html">unlink</a></b>(2).

       <b>36</b>, <b>SYSEXIT_MKNOD</b>
              Error from <b><a href="../man2/mknod.2.html">mknod</a></b>(2).

       <b>37</b>, <b>SYSEXIT_PLOOPINUSE</b>
              Image is already in use.

       <b>38</b>, <b>SYSEXIT_PARAM</b>
              Invalid parameter.

       <b>39</b>, <b>SYSEXIT_DISKDESCR</b>
              Problem with DiskDescriptor.xml file.

       <b>40</b>, <b>SYSEXIT_DEV_NOT_MOUNTED</b>
              Ploop image is not mounted.

       <b>41</b>, <b>SYSEXIT_FSCK</b>
              Error from <b><a href="../man8/fsck.8.html">fsck</a></b>(8).

       <b>43</b>, <b>SYSEXIT_NOSNAP</b>
              Can't find specified snapshot UUID.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/vzctl.8.html">vzctl</a></b>(8), <b><a href="../man8/vzmigrate.8.html">vzmigrate</a></b>(8), <b><a href="http://openvz.org/Ploop">http://openvz.org/Ploop</a></b>.

OpenVZ                                             26 May 2014                                          <u><a href="../man8/ploop.8.html">ploop</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>