<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ct - tc connection tracking action</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/iproute2">iproute2_6.14.0-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ct - tc connection tracking action

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>tc</b>  <b>...</b>  <b>action</b>  <b>ct</b>  <b>commit</b>  <b>[</b>  <b>force</b>  <b>]</b>  <b>[</b> <b>zone</b> <u>ZONE</u> <b>]</b> <b>[</b> <b>mark</b> <u>MASKED_MARK</u> <b>]</b> <b>[</b> <b>label</b> <u>MASKED_LABEL</u> <b>]</b> <b>[</b> <b>nat</b>
               <u>NAT_SPEC</u> <b>]</b>

       <b>tc</b> <b>...</b> <b>action</b> <b>ct</b> <b>[</b> <b>nat</b> <b>]</b> <b>[</b> <b>zone</b> <u>ZONE</u> <b>]</b>

       <b>tc</b> <b>...</b> <b>action</b> <b>ct</b> <b>clear</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The ct action is a tc action for sending packets and interacting with the netfilter conntrack module.

       It can (as shown in the synopsis, in order):

       Send the packet to conntrack, and commit the connection, while configuring a 32bit  mark,  128bit  label,
       and src/dst nat.

       Send  the  packet  to  conntrack,  which  will mark the packet with the connection's state and configured
       metadata (mark/label), and execute previous configured nat.

       Clear the packet's of previous connection tracking state.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>zone</b> <u>ZONE</u>
              Specify a conntrack zone number on which to send the packet to conntrack.

       <b>mark</b> <u>MASKED_MARK</u>
              Specify a masked 32bit mark to set for the connection (only valid with commit).

       <b>label</b> <u>MASKED_LABEL</u>
              Specify a masked 128bit label to set for the connection (only valid with commit).

       <b>nat</b> <u>NAT_SPEC</u>
              <b>Where</b> <u>NAT_SPEC</u> <b>:=</b> <b>{src|dst}</b> <b>addr</b> <u>addr1</u><b>[-</b><u>addr2</u><b>]</b> <b>[port</b> <u>port1</u><b>[-</b><u>port2</u><b>]]</b>

              Specify src/dst and range of nat to configure for the connection (only valid with commit).

              src/dst - configure src or dst nat

              <u>addr1</u><b>/</b><u>addr2</u> <b>-</b> <b>IPv4/IPv6</b> <b>addresses</b>

              <u>port1</u><b>/</b><u>port2</u> <b>-</b> <b>Port</b> <b>numbers</b>

       <b>nat</b>    Restore any previous configured nat.

       <b>clear</b>  Remove any conntrack state and metadata (mark/label) from the packet (must only option specified).

       <b>force</b>  Forces conntrack direction for a previously committed connections, so that current direction  will
              become the original direction (only valid with commit).

</pre><h4><b>EXAMPLES</b></h4><pre>
       Example showing natted firewall in conntrack zone 2, and conntrack mark usage:

       #Add ingress qdisc on eth0 and eth1 interfaces
       $ tc qdisc add dev eth0 ingress
       $ tc qdisc add dev eth1 ingress

       #Setup filters on eth0, allowing opening new connections in zone 2, and doing src nat + mark for each new connection
       $ tc filter add dev eth0 ingress prio 1 chain 0 proto ip flower ip_proto tcp ct_state -trk \
       action ct zone 2 pipe action goto chain 2
       $ tc filter add dev eth0 ingress prio 1 chain 2 proto ip flower ct_state +trk+new \
       action ct zone 2 commit mark 0xbb nat src addr 5.5.5.7 pipe action mirred egress redirect dev eth1
       $ tc filter add dev eth0 ingress prio 1 chain 2 proto ip flower ct_zone 2 ct_mark 0xbb ct_state +trk+est \
       action ct nat pipe action mirred egress redirect dev eth1

       #Setup filters on eth1, allowing only established connections of zone 2 through, and reverse nat (dst nat in this case)
       $ tc filter add dev eth1 ingress prio 1 chain 0 proto ip flower ip_proto tcp ct_state -trk \
       action ct zone 2 pipe action goto chain 1
       $ tc filter add dev eth1 ingress prio 1 chain 1 proto ip flower ct_zone 2 ct_mark 0xbb ct_state +trk+est \
       action ct nat pipe action mirred egress redirect dev eth0

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/tc.8.html">tc</a></b>(8), <b><a href="../man8/tc-flower.8.html">tc-flower</a></b>(8) <b><a href="../man8/tc-mirred.8.html">tc-mirred</a></b>(8)

</pre><h4><b>AUTHORS</b></h4><pre>
       Paul Blakey &lt;<a href="mailto:paulb@mellanox.com">paulb@mellanox.com</a>&gt;

       Marcelo Ricardo Leitner &lt;<a href="mailto:marcelo.leitner@gmail.com">marcelo.leitner@gmail.com</a>&gt;

       Yossi Kuperman &lt;<a href="mailto:yossiku@mellanox.com">yossiku@mellanox.com</a>&gt;

iproute2                                           14 May 2020                                <u>ct</u> <u>action</u> <u>in</u> <u><a href="../man8/tc.8.html">tc</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>