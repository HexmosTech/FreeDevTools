<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tcpconnect - Trace TCP active connections (connect()). Uses Linux eBPF/bcc.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/bpfcc-tools">bpfcc-tools_0.31.0+ds-7ubuntu2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       tcpconnect - Trace TCP active connections (connect()). Uses Linux eBPF/bcc.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>tcpconnect</b>  <b>[-h]</b>  <b>[-c]</b>  <b>[-t]</b>  <b>[-p</b>  <b>PID]</b>  <b>[-P</b>  <b>PORT]</b>  <b>[-4</b>  <b>|</b>  <b>-6]</b> <b>[-L]</b> <b>[-u</b> <b>UID]</b> <b>[-U]</b> <b>[--cgroupmap</b> <b>MAPPATH]</b>
       <b>[--mntnsmap</b> <b>MAPPATH]</b> <b>[-d]</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This tool traces active TCP connections (eg, via a connect() syscall; accept() are passive  connections).
       This can be useful for general troubleshooting to see what connections are initiated by the local server.

       All connection attempts are traced, even if they ultimately fail.

       This  works  by tracing the kernel tcp_v4_connect() and tcp_v6_connect() functions using dynamic tracing,
       and will need updating to match any changes to these functions.

       When provided with the -d or --dns option, this tool will also correlate  connect  calls  with  the  most
       recent  DNS  query that matches the IP connected.  This feature works by tracing the kernel udp_recvmsg()
       function to collect DNS responses.

       Since this uses BPF, only the root user can use this tool.

</pre><h4><b>REQUIREMENTS</b></h4><pre>
       CONFIG_BPF and bcc.

       If using the -d or --dns option, you must have the dnslib and cachetools python packages installed.   You
       can  install  them with pip3 or with apt on Ubuntu 18.04+ using the python3-dnslib and python3-cachetools
       packages.

</pre><h4><b>OPTIONS</b></h4><pre>
       -h     Print usage message.

       -t     Include a timestamp column.

       -c     Count connects per src ip and dest ip/port.

       -p PID Trace this process ID only (filtered in-kernel).

       -P PORT
              Comma-separated list of destination ports to trace (filtered in-kernel).

       -4     Trace IPv4 family only.

       -6     Trace IPv6 family only.

       -L     Include a LPORT column.

       -U     Include a UID column.

       -u UID Trace this UID only (filtered in-kernel).

       --cgroupmap MAPPATH
              Trace cgroups in this BPF map only (filtered in-kernel).

       --mntnsmap  MAPPATH
              Trace mount namespaces in this BPF map only (filtered in-kernel).

       -d     Shows the most recent DNS query for the IP address in the connect call.  This is likely related to
              the TCP connection details in the other columns, but is not guaranteed.   This  feature  works  by
              tracing  the  udp_recvmsg  kernel  function and tracking DNS responses received by the server.  It
              only supports UDP DNS packets up to 512 bytes in length.  The python code keeps a cache of 10k DNS
              responses in memory for up 24 hours.

              If the time difference in milliseconds between when the system received a DNS response and when  a
              connect  syscall was traced using an IP in that DNS response is greater than 100ms, this tool will
              report this delta after the query.  These deltas should be relatively short for most applications.
              A long delay between the response and connect could be either anomalous  activity  or  indicate  a
              misattribution between the DNS name requested and the IP that the connect syscall is using.

              The -d option may not be used with the count feature (option -c)

</pre><h4><b>EXAMPLES</b></h4><pre>
       Trace all active TCP connections:
              # <b>tcpconnect</b>

       Trace all TCP connects, and include timestamps:
              # <b>tcpconnect</b> <b>-t</b>

       Trace all TCP connects, and include most recent matching DNS query for each connected IP
              # <b>tcpconnect</b> <b>-d</b>

       Trace PID 181 only:
              # <b>tcpconnect</b> <b>-p</b> <b>181</b>

       Trace ports 80 and 81 only:
              # <b>tcpconnect</b> <b>-P</b> <b>80,81</b>

       Trace IPv4 family only:
              # <b>tcpconnect</b> <b>-4</b>

       Trace IPv6 family only:
              # <b>tcpconnect</b> <b>-6</b>

       Trace all TCP connects, and include LPORT:
              # <b>tcpconnect</b> <b>-L</b>

       Trace all TCP connects, and include UID:
              # <b>tcpconnect</b> <b>-U</b>

       Trace UID 1000 only:
              # <b>tcpconnect</b> <b>-u</b> <b>1000</b>

       Count connects per src ip and dest ip/port:
              # <b>tcpconnect</b> <b>-c</b>

       Trace a set of cgroups only (see special_filtering.md from bcc sources for more details):
              # <b>tcpconnect</b> <b>--cgroupmap</b> <b>/sys/fs/bpf/test01</b>

       Trace a set of mount namespaces only (see special_filtering.md from bcc sources for more details):
              # <b>tcpconnect</b> <b>--mntnsmap</b> <b>/sys/fs/bpf/mnt_ns_set</b>

</pre><h4><b>FIELDS</b></h4><pre>
       TIME(s)
              Time of the call, in seconds.

       UID    User ID

       PID    Process ID

       COMM   Process name

       IP     IP address family (4 or 6)

       SADDR  Source IP address.

       LPORT  Source port

       DADDR  Destination IP address.

       DPORT  Destination port

       CONNECTS
              Accumulated active connections since start.

       QUERY  Shows the most recent DNS query for the IP address in the connect call.  This is likely related to
              the TCP connection details in the other columns, but is not guaranteed.

</pre><h4><b>OVERHEAD</b></h4><pre>
       This  traces the kernel tcp_v[46]_connect functions and prints output for each event. As the rate of this
       is generally expected to be low (&lt; 1000/s), the overhead is also expected to be negligible. If  you  have
       an  application  that  is  calling  a  high  rate  of  connect()s,  such as a proxy server, then test and
       understand this overhead before use.

       If you are using the -d option to track DNS requests, this tool will trace the udp_recvmsg  function  and
       generate  an  event  for  any  packets  from UDP port 53.  This event contains up to 512 bytes of the UDP
       packet payload.  Typical applications do not extensively use UDP, so the performance overhead of  tracing
       udp_recvmsg  is  expected  to be negligible,   However, if you have an application that receives many UDP
       packets, then you should test and  understand  the  overhead  of  tracing  every  received  UDP  message.
       Furthermore,  performance  overhead  of  running  this tool on a DNS server is expected to be higher than
       average because all DNS response packets will be copied to userspace.

</pre><h4><b>SOURCE</b></h4><pre>
       This is from bcc.

              https://github.com/iovisor/bcc

       Also look in the bcc distribution for a companion _examples.txt file containing  example  usage,  output,
       and commentary for this tool.

</pre><h4><b>OS</b></h4><pre>
       Linux

</pre><h4><b>STABILITY</b></h4><pre>
       Unstable - in development.

</pre><h4><b>AUTHOR</b></h4><pre>
       Brendan Gregg

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/tcptracer.8.html">tcptracer</a>(8), <a href="../man8/tcpaccept.8.html">tcpaccept</a>(8), <a href="../man8/funccount.8.html">funccount</a>(8), <a href="../man8/tcpdump.8.html">tcpdump</a>(8)

USER COMMANDS                                      2020-02-20                                      <u><a href="../man8/tcpconnect.8.html">tcpconnect</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>