<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flower - flow based traffic control filter</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/iproute2">iproute2_6.14.0-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       flower - flow based traffic control filter

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>tc</b> <b>filter</b> ... <b>flower</b> [ <u>MATCH_LIST</u> ] [ <b>action</b> <u>ACTION_SPEC</u> ] [ <b>classid</b> <u>CLASSID</u> ] [ <b>hw_tc</b> <u>TCID</u> ]

       <u>MATCH_LIST</u> := [ <u>MATCH_LIST</u> ] <u>MATCH</u>

       <u>MATCH</u>  :=  { <b>indev</b> <u>ifname</u> | <b>verbose</b>  | <b>skip_sw</b> | <b>skip_hw</b>  | { <b>dst_mac</b> | <b>src_mac</b> } <u>MASKED_LLADDR</u> | <b>vlan_id</b>
               <u>VID</u> | <b>vlan_prio</b> <u>PRIORITY</u> | <b>vlan_ethtype</b> { <b>ipv4</b> | <b>ipv6</b> | <u>ETH_TYPE</u> } | <b>cvlan_id</b>  <u>VID</u>  |  <b>cvlan_prio</b>
               <u>PRIORITY</u>  |  <b>cvlan_ethtype</b>  { <b>ipv4</b> | <b>ipv6</b> | <u>ETH_TYPE</u> } | <b>pppoe_sid</b> <u>PSID</u> | <b>ppp_proto</b> { <b>ip</b> | <b>ipv6</b> |
               <b>mpls_uc</b> | <b>mpls_mc</b> | <u>PPP_PROTO</u> } | <b>mpls</b> <u>LSE_LIST</u> | <b>mpls_label</b> <u>LABEL</u> | <b>mpls_tc</b> <u>TC</u> | <b>mpls_bos</b> <u>BOS</u>  |
               <b>mpls_ttl</b>  <u>TTL</u> | <b>l2tpv3_sid</b> <u>LSID</u> | <b>ip_proto</b> { <b>tcp</b> | <b>udp</b> | <b>sctp</b> | <b>icmp</b> | <b>icmpv6</b> | <b>l2tp</b> | <u>IP_PROTO</u> }
               | <b>ip_tos</b> <u>MASKED_IP_TOS</u> | <b>ip_ttl</b> <u>MASKED_IP_TTL</u> | { <b>dst_ip</b>  |  <b>src_ip</b>  }  <u>PREFIX</u>  |  {  <b>dst_port</b>  |
               <b>src_port</b>  }  {  <u>MASKED_NUMBER</u>  | <u>min_port_number-max_port_number</u> } | <b>tcp_flags</b> <u>MASKED_TCP_FLAGS</u> |
               <b>type</b> <u>MASKED_TYPE</u> | <b>code</b> <u>MASKED_CODE</u> | { <b>arp_tip</b> | <b>arp_sip</b> } <u>IPV4_PREFIX</u>  |  <b>arp_op</b>  {  <b>request</b>  |
               <b>reply</b>  |  <u>OP</u>  }  |  {  <b>arp_tha</b>  |  <b>arp_sha</b>  }  <u>MASKED_LLADDR</u> | <b>enc_key_id</b> <u>KEY-ID</u> | { <b>enc_dst_ip</b> |
               <b>enc_src_ip</b> } { <u>ipv4_address</u> | <u>ipv6_address</u> } | <b>enc_dst_port</b> <u>port_number</u> | <b>enc_tos</b> <u>TOS</u>  |  <b>enc_ttl</b>
               <u>TTL</u>  |  {  <b>geneve_opts</b>  |  <b>vxlan_opts</b>  |  <b>erspan_opts</b> | <b>gtp_opts</b> | <b>pfcp_opts</b> } <u>OPTIONS</u> | <b>ip_flags</b>
               <u>IP_FLAGS</u> | <b>l2_miss</b> <u>L2_MISS</u> | <b>cfm</b> <u>CFM_OPTIONS</u> | <b>enc_flags</b> <u>ENCFLAG-LIST</u> }

       <u>LSE_LIST</u> := [ <u>LSE_LIST</u> ] <u>LSE</u>

       <u>LSE</u> := <b>lse</b> <b>depth</b> <u>DEPTH</u> { <b>label</b> <u>LABEL</u> | <b>tc</b> <u>TC</u> | <b>bos</b> <u>BOS</u> | <b>ttl</b> <u>TTL</u> }

       <u>CFM</u> := <b>cfm</b> <b>mdl</b> <u>LEVEL</u> | <b>op</b> <u>OPCODE</u>

       <u>ENCFLAG-LIST</u> := [ <u>ENCFLAG-LIST</u>/ ] <u>ENCFLAG</u>

       <u>ENCFLAG</u> := { <b>[no]tuncsum</b> | <b>[no]tundf</b> | <b>[no]tunoam</b> | <b>[no]tuncrit</b> }

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>flower</b> filter matches flows to the set of keys specified and assigns an arbitrarily chosen  class  ID
       to packets belonging to them. Additionally (or alternatively) an action from the generic action framework
       may be called.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>action</b> <u>ACTION_SPEC</u>
              Apply an action from the generic actions framework on matching packets.

       <b>classid</b> <u>CLASSID</u>
              Specify  a  class  to  pass matching packets on to.  <u>CLASSID</u> is in the form <b>X</b>:<b>Y</b>, while <b>X</b> and <b>Y</b> are
              interpreted as numbers in hexadecimal format.

       <b>hw_tc</b> <u>TCID</u>
              Specify a hardware traffic class to pass matching packets on to. TCID is in the  range  0  through
              15.

       <b>indev</b> <u>ifname</u>
              Match  on incoming interface name. Obviously this makes sense only for forwarded flows.  <u>ifname</u> is
              the name of an interface which must exist at the time of <b>tc</b> invocation.

       <b>verbose</b>
              Enable verbose logging, including offloading errors when not using <b>skip_sw</b> flag.

       <b>skip_sw</b>
              Do not process filter by software. If hardware has no offload  support  for  this  filter,  or  TC
              offload is not enabled for the interface, operation will fail.

       <b>skip_hw</b>
              Do not process filter by hardware.

       <b>dst_mac</b> <u>MASKED_LLADDR</u>
       <b>src_mac</b> <u>MASKED_LLADDR</u>
              Match  on  source or destination MAC address.  A mask may be optionally provided to limit the bits
              of the address which are matched. A mask is provided by following the address  with  a  slash  and
              then  the  mask.  It may be provided in LLADDR format, in which case it is a bitwise mask, or as a
              number of high bits to match. If the mask is missing then a match on all bits is assumed.

       <b>num_of_vlans</b> <u>NUM</u>
              Match on the number of vlan tags in the packet.  <u>NUM</u> can be 0 or small positive integer. Typically
              in 0-4 range.

       <b>vlan_id</b> <u>VID</u>
              Match on vlan tag id.  <u>VID</u> is an unsigned 12bit value in decimal format.

       <b>vlan_prio</b> <u>PRIORITY</u>
              Match on vlan tag priority.  <u>PRIORITY</u> is an unsigned 3bit value in decimal format.

       <b>vlan_ethtype</b> <u>VLAN_ETH_TYPE</u>
              Match on layer three protocol.  <u>VLAN_ETH_TYPE</u> may be either <b>ipv4</b>, <b>ipv6</b> or an unsigned 16bit  value
              in hexadecimal format. To match on QinQ packet, it must be 802.1Q or 802.1AD.

       <b>cvlan_id</b> <u>VID</u>
              Match on QinQ inner vlan tag id.  <u>VID</u> is an unsigned 12bit value in decimal format.

       <b>cvlan_prio</b> <u>PRIORITY</u>
              Match on QinQ inner vlan tag priority.  <u>PRIORITY</u> is an unsigned 3bit value in decimal format.

       <b>cvlan_ethtype</b> <u>VLAN_ETH_TYPE</u>
              Match  on  QinQ layer three protocol.  <u>VLAN_ETH_TYPE</u> may be either <b>ipv4</b>, <b>ipv6</b> or an unsigned 16bit
              value in hexadecimal format.

       <b>pppoe_sid</b> <u>PSID</u>
              Match on PPPoE session id.  <u>PSID</u> is an unsigned 16bit value in decimal format.

       <b>ppp_proto</b> <u>PPP_PROTO</u>
              Match on PPP layer three protocol.  <u>PPP_PROTO</u> may be either  <b>ip</b>,  <b>ipv6</b>,  <b>mpls_uc</b>,  <b>mpls_mc</b>  or  an
              unsigned 16bit value in hexadecimal format.

       <b>mpls</b> <u>LSE_LIST</u>
              Match  on the MPLS label stack.  <u>LSE_LIST</u> is a list of Label Stack Entries, each introduced by the
              <b>lse</b> keyword.  This option can't be used together with the standalone <b>mpls_label</b>, <b>mpls_tc</b>, <b>mpls_bos</b>
              and <b>mpls_ttl</b> options.

              <b>lse</b> <u>LSE_OPTIONS</u>
                     Match on an MPLS Label Stack Entry.  <u>LSE_OPTIONS</u> is a list of  options  that  describe  the
                     properties of the LSE to match.

                     <b>depth</b> <u>DEPTH</u>
                            The  depth  of  the  Label Stack Entry to consider. Depth starts at 1 (the outermost
                            Label Stack Entry). The maximum usable depth may be  limited  by  the  kernel.  This
                            option is mandatory.  <u>DEPTH</u> is an unsigned 8 bit value in decimal format.

                     <b>label</b> <u>LABEL</u>
                            Match  on  the MPLS Label field at the specified <b>depth</b>.  <u>LABEL</u> is an unsigned 20 bit
                            value in decimal format.

                     <b>tc</b> <u>TC</u>  Match on the MPLS Traffic Class field at the specified <b>depth</b>.  <u>TC</u> is an  unsigned  3
                            bit value in decimal format.

                     <b>bos</b> <u>BOS</u>
                            Match  on  the  MPLS  Bottom  Of Stack field at the specified <b>depth</b>.  <u>BOS</u> is a 1 bit
                            value in decimal format.

                     <b>ttl</b> <u>TTL</u>
                            Match on the MPLS Time To Live field at the specified <b>depth</b>.  <u>TTL</u> is an  unsigned  8
                            bit value in decimal format.

       <b>mpls_label</b> <u>LABEL</u>
              Match  the label id in the outermost MPLS label stack entry.  <u>LABEL</u> is an unsigned 20 bit value in
              decimal format.

       <b>mpls_tc</b> <u>TC</u>
              Match on the MPLS TC field, which is typically used for packet priority,  in  the  outermost  MPLS
              label stack entry.  <u>TC</u> is an unsigned 3 bit value in decimal format.

       <b>mpls_bos</b> <u>BOS</u>
              Match  on  the MPLS Bottom Of Stack field in the outermost MPLS label stack entry.  <u>BOS</u> is a 1 bit
              value in decimal format.

       <b>mpls_ttl</b> <u>TTL</u>
              Match on the MPLS Time To Live field in the outermost MPLS label stack entry.  <u>TTL</u> is an  unsigned
              8 bit value in decimal format.

       <b>l2tpv3_sid</b> <u>LSID</u>
              Match  on L2TPv3 session id field transported over IPv4 or IPv6.  <u>LSID</u> is an unsigned 32 bit value
              in decimal format.

       <b>ip_proto</b> <u>IP_PROTO</u>
              Match on layer four protocol.  <u>IP_PROTO</u> may be <b>tcp</b>, <b>udp</b>, <b>sctp</b>, <b>icmp</b>, <b>icmpv6</b>, <b>l2tp</b> or  an  unsigned
              8bit value in hexadecimal format.

       <b>ip_tos</b> <u>MASKED_IP_TOS</u>
              Match  on  ipv4  TOS  or  ipv6  traffic-class  -  eight bits in hexadecimal format.  A mask may be
              optionally provided to limit the bits which are matched. A mask is provided by following the value
              with a slash and then the mask. If the mask is missing then a match on all bits is assumed.

       <b>ip_ttl</b> <u>MASKED_IP_TTL</u>
              Match on ipv4 TTL or ipv6 hop-limit  - eight bits value in decimal or hexadecimal format.  A  mask
              may be optionally provided to limit the bits which are matched. Same logic is used for the mask as
              with matching on ip_tos.

       <b>dst_ip</b> <u>PREFIX</u>
       <b>src_ip</b> <u>PREFIX</u>
              Match on source or destination IP address.  <u>PREFIX</u> must be a valid IPv4 or IPv6 address, depending
              on the <b>protocol</b> option to tc filter, optionally followed by a slash and the prefix length.  If the
              prefix is missing, <b>tc</b> assumes a full-length host match.

       <b>dst_port</b> { <u>MASKED_NUMBER</u> |  <u>MIN_VALUE-MAX_VALUE</u> }
       <b>src_port</b> { <u>MASKED_NUMBER</u> |  <u>MIN_VALUE-MAX_VALUE</u> }
              Match on layer 4 protocol source or destination port number, with an optional mask. Alternatively,
              the  minimum and maximum values can be specified to match on a range of layer 4 protocol source or
              destination port numbers. Only available for <b>ip_proto</b> values <b>udp</b>, <b>tcp</b> and <b>sctp</b> which  have  to  be
              specified in beforehand.

       <b>tcp_flags</b> <u>MASKED_TCP_FLAGS</u>
              Match  on  TCP  flags  represented  as  12bit  bitfield  in  in hexadecimal format.  A mask may be
              optionally provided to limit the bits which are matched. A mask is provided by following the value
              with a slash and then the mask. If the mask is missing then a match on all bits is assumed.

       <b>type</b> <u>MASKED_TYPE</u>
       <b>code</b> <u>MASKED_CODE</u>
              Match on ICMP type or code. A mask may be optionally provided to limit the  bits  of  the  address
              which are matched. A mask is provided by following the address with a slash and then the mask. The
              mask  must  be  as a number which represents a bitwise mask If the mask is missing then a match on
              all bits is assumed.  Only available for  <b>ip_proto</b>  values  <b>icmp</b>  and  <b>icmpv6</b>  which  have  to  be
              specified in beforehand.

       <b>arp_tip</b> <u>IPV4_PREFIX</u>
       <b>arp_sip</b> <u>IPV4_PREFIX</u>
              Match  on  ARP  or  RARP  sender  or  target IP address.  <u>IPV4_PREFIX</u> must be a valid IPv4 address
              optionally followed by a slash and the prefix length. If the prefix is missing, <b>tc</b> assumes a full-
              length host match.

       <b>arp_op</b> <u>ARP_OP</u>
              Match on ARP or RARP operation.  <u>ARP_OP</u> may be <b>request</b>, <b>reply</b> or an integer value 0, 1  or  2.   A
              mask  may  be  optionally provided to limit the bits of the operation which are matched. A mask is
              provided by following the address with a slash and then  the  mask.  It  may  be  provided  as  an
              unsigned  8 bit value representing a bitwise mask. If the mask is missing then a match on all bits
              is assumed.

       <b>arp_sha</b> <u>MASKED_LLADDR</u>
       <b>arp_tha</b> <u>MASKED_LLADDR</u>
              Match on ARP or RARP sender or target MAC address.  A mask may be optionally provided to limit the
              bits of the address which are matched. A mask is provided by following the address  with  a  slash
              and  then the mask. It may be provided in LLADDR format, in which case it is a bitwise mask, or as
              a number of high bits to match. If the mask is missing then a match on all bits is assumed.

       <b>enc_key_id</b> <u>NUMBER</u>
       <b>enc_dst_ip</b> <u>PREFIX</u>
       <b>enc_src_ip</b> <u>PREFIX</u>
       <b>enc_dst_port</b> <u>NUMBER</u>
       <b>enc_tos</b> <u>NUMBER</u>
       <b>enc_ttl</b> <u>NUMBER</u>
       <b>ct_state</b> <u>CT_STATE</u>
       <b>ct_zone</b> <u>CT_MASKED_ZONE</u>
       <b>ct_mark</b> <u>CT_MASKED_MARK</u>
       <b>ct_label</b> <u>CT_MASKED_LABEL</u>
              Matches on connection tracking info

              <u>CT_STATE</u>
                     Match the connection state, and can be combination of [{+|-}flag] flags, where flag can  be
                     one of

                     trk - Tracked connection.

                     new - New connection.

                     est - Established connection.

                     rpl - The packet is in the reply direction, meaning that it is in the opposite direction
                     from the packet that initiated the connection.

                     inv - The state is invalid. The packet couldn't be associated to a connection.

                     rel - The packet is related to an existing connection.

                     Example: +trk+est

              <u>CT_MASKED_ZONE</u>
                     Match the connection zone, and can be masked.

              <u>CT_MASKED_MARK</u>
                     32bit match on the connection mark, and can be masked.

              <u>CT_MASKED_LABEL</u>
                     128bit match on the connection label, and can be masked.

       <b>geneve_opts</b> <u>OPTIONS</u>
       <b>vxlan_opts</b> <u>OPTIONS</u>
       <b>erspan_opts</b> <u>OPTIONS</u>
       <b>gtp_opts</b> <u>OPTIONS</u>
       <b>pfcp_opts</b> <u>OPTIONS</u>
              Match  on IP tunnel metadata. Key id <u>NUMBER</u> is a 32 bit tunnel key id (e.g. VNI for VXLAN tunnel).
              <u>PREFIX</u> must be a valid IPv4 or IPv6 address optionally followed by a slash and the prefix  length.
              If  the  prefix  is missing, <b>tc</b> assumes a full-length host match.  Dst port <u>NUMBER</u> is a 16 bit UDP
              dst port. Tos <u>NUMBER</u> is an 8 bit tos (dscp+ecn) value, ttl <u>NUMBER</u> is an 8 bit time-to-live  value.
              geneve_opts  <u>OPTIONS</u>  must  be  a  valid  list of comma-separated geneve options where each option
              consists of a key optionally followed by a slash and corresponding mask. If the masks is  missing,
              <b>tc</b>    assumes    a   full-length   match.   The   options   can   be   described   in   the   form
              CLASS:TYPE:DATA/CLASS_MASK:TYPE_MASK:DATA_MASK, where CLASS is represented as a 16bit  hexadecimal
              value,  TYPE  as  an  8bit  hexadecimal  value  and  DATA  as a variable length hexadecimal value.
              vxlan_opts <u>OPTIONS</u> doesn't support multiple options, and it consists of a key followed by a  slash
              and  corresponding mask. If the mask is missing, <b>tc</b> assumes a full-length match. The option can be
              described in the form GBP/GBP_MASK, where GBP is  represented  as  a  32bit  number.   erspan_opts
              <u>OPTIONS</u>  doesn't  support  multiple  options,  and  it  consists  of a key followed by a slash and
              corresponding mask. If the mask is missing, <b>tc</b> assumes a full-length  match.  The  option  can  be
              described  in the form VERSION:INDEX:DIR:HWID/VERSION:INDEX_MASK:DIR_MASK:HWID_MASK, where VERSION
              is represented as a 8bit number, INDEX as an 32bit number, DIR and HWID as a 8bit number. Multiple
              options is not supported. Note INDEX/INDEX_MASK is used when VERSION is 1,  and  DIR/DIR_MASK  and
              HWID/HWID_MASK are used when VERSION is 2.  gtp_opts <u>OPTIONS</u> doesn't support multiple options, and
              it  consists  of  a  key  followed  by  a slash and corresponding mask. If the mask is missing, <b>tc</b>
              assumes   a   full-length   match.    The    option    can    be    described    in    the    form
              PDU_TYPE:QFI/PDU_TYPE_MASK:QFI_MASK  where  both  PDU_TYPE  and  QFI  are  represented  as  a 8bit
              hexadecimal values.  pfcp_opts <u>OPTIONS</u> does not support multiple options. It  consists  of  a  key
              followed  by  a  slash  and  corresponding  mask. If the mask is missing, <b>tc</b> assumes a full-length
              match. The option can be  described  in  the  form  TYPE:SEID/TYPE_MASK:SEID_MASK  where  TYPE  is
              represented  as  a  8bit  number, SEID is represented by 64bit. Both TYPE and SEID are provided in
              hex.

       <b>ip_flags</b> <u>IP_FLAGS</u>
              <u>IP_FLAGS</u> may be either <b>frag</b>, <b>nofrag</b>, <b>firstfrag</b> or <b>nofirstfrag</b> where frag and nofrag could be  used
              to  match  on  fragmented  packets  or not, respectively. firstfrag and nofirstfrag can be used to
              further distinguish fragmented packet. firstfrag can be used  to  indicate  the  first  fragmented
              packet.  nofirstfrag  can  be  used  to  indicates subsequent fragmented packets or non-fragmented
              packets.

       <b>l2_miss</b> <u>L2_MISS</u>
              Match on layer 2 miss in the bridge driver's FDB / MDB. <u>L2_MISS</u> may be 0 or 1. When  1,  match  on
              packets that encountered a layer 2 miss. When 0, match on packets that were forwarded using an FDB
              /  MDB  entry. Note that broadcast packets do not encounter a miss since a lookup is not performed
              for them.

       <b>cfm</b> <u>CFM_OPTIONS</u>
              Match on Connectivity Fault Management (CFM) fields.   <u>CFM_OPTIONS</u>  is  a  list  of  options  that
              describe the properties of the CFM information fields to match.

              <b>mdl</b> <u>LEVEL</u>
                     Match  on  the  Maintenance  Domain  (MD) level field.  <u>LEVEL</u> is an unsigned 3 bit value in
                     decimal format.

              <b>op</b> <u>OPCODE</u>
                     Match on the CFM opcode field. <u>OPCODE</u> is an unsigned 8 bit value in decimal format.

       <b>enc_flags</b> <u>ENCFLAG-LIST</u>
              Match on tunnel control flags.  <u>ENCFLAG-LIST</u> is a list of  the  following  tunnel  control  flags:
              <b>[no]tuncsum</b>, <b>[no]tundf</b>, <b>[no]tunoam</b>, <b>[no]tuncrit</b>, each separated by '/'.

       <b>NOTES</b>  As  stated  above where applicable, matches of a certain layer implicitly depend on the matches of
              the next lower layer.  Precisely,  layer  one  and  two  matches  (<b>indev</b>,   <b>dst_mac</b>,  <b>src_mac</b>  and
              <b>enc_flags</b>)  have no dependency, MPLS and layer three matches (<b>mpls</b>, <b>mpls_label</b>, <b>mpls_tc</b>, <b>mpls_bos</b>,
              <b>mpls_ttl</b>, <b>ip_proto</b>, <b>dst_ip</b>, <b>src_ip</b>, <b>arp_tip</b>,  <b>arp_sip</b>,  <b>arp_op</b>,  <b>arp_tha</b>,  <b>arp_sha</b>  and  <b>ip_flags</b>)
              depend on the <b>protocol</b> option of tc filter, layer four port matches (<b>dst_port</b> and <b>src_port</b>) depend
              on  <b>ip_proto</b>  being  set  to  <b>tcp</b>, <b>udp</b> or <b>sctp,</b> and finally ICMP matches (<b>code</b> and <b>type</b>) depend on
              <b>ip_proto</b> being set to <b>icmp</b> or <b>icmpv6.</b>

       There can be only used one mask per one prio. If user needs to specify different  mask,  he  has  to  use
       different prio.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/tc.8.html">tc</a></b>(8), <b><a href="../man8/tc-flow.8.html">tc-flow</a></b>(8)

iproute2                                           22 Oct 2015                            <u>Flower</u> <u>filter</u> <u>in</u> <u><a href="../man8/tc.8.html">tc</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>