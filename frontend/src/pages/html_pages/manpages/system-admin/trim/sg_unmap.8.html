<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sg_unmap - send SCSI UNMAP command (known as 'trim' in ATA specs)</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/sg3-utils">sg3-utils_1.48-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sg_unmap - send SCSI UNMAP command (known as 'trim' in ATA specs)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>sg_unmap</b>   [<u>--all=ST,RN[,LA]</u>]   [<u>--anchor</u>]   [<u>--dry-run</u>]  [<u>--force</u>]  [<u>--grpnum=GN</u>]  [<u>--help</u>]  [<u>--in=FILE</u>]
       [<u>--lba=LBA,LBA...</u>] [<u>--num=NUM,NUM...</u>] [<u>--timeout=TO</u>] [<u>--verbose</u>] [<u>--version</u>] <u>DEVICE</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Send a SCSI UNMAP command to <u>DEVICE</u> to unmap one or more logical blocks. This command was  introduced  in
       SBC-3  revision  18  under  the broad heading of "logical block provisioning". Logical blocks may also be
       unmapped by the SCSI WRITE SAME command; see the sg_write_same utility. The unmap capability  is  closely
       related to the ATA DATA SET MANAGEMENT command with the "Trim" bit set.

       Logical  blocks  to  be  unmapped  can  be  specified in one of three ways to this utility. One way is by
       supplying the start LBAs to the '--lba=' option and the corresponding number(s) to unmap to the  '--num='
       option.  Another  way  is by putting start LBA and number to unmap pairs in a file whose name is given to
       the '--in=' option. Alternatively a large segment or all of  a  disk  (SSD)  can  be  unmapped  with  the
       <u>--all=ST_RN[,LA]</u> option. All values are assumed to be decimal unless prefixed by "0x" (or "0X") or have a
       trailing  "h"  (or  "H")  in  which  case  they  are  interpreted as hexadecimal.  Suffix multipliers are
       permitted on decimal values (e.g. '--num=1m').

       When the '--lba=' option is given then the '--num=' option must  also  be  given.  If  one  has  a  comma
       separated  list  as  its  argument  then the other must have the same number of elements in its list. The
       arguments can use a single space as a  separator  but  need  to  be  in  quotes  or  escaped  to  not  be
       misinterpreted by the shell.

       With  the  '--in=FILE'  option  an  even number of values must be found and are interpreted as pairs: the
       first value in each pair is a starting LBA and the second value is the number to  unmap  from  that  LBA.
       Everything  from  and including a "#" on a line is ignored as are blank lines. Values may be comma, space
       and tab separated or appear on separate lines. Each line should not exceed 1023 bytes in length.

       Since a lot of data can be lost with this utility, a 15 second "cooling off" period is given  before  any
       UNMAP  commands  are sent. During this period the user is reminded what will happen, and to which device,
       so they can use control-C (or some other technique) to terminate this utility before any unmapping  takes
       place. This period can be bypassed with the <u>--force</u> option.

</pre><h4><b>OPTIONS</b></h4><pre>
       Arguments to long options are mandatory for short options as well.

       <b>-A</b>, <b>--all</b>=<u>ST,RN[,LA]</u>
              where  <u>ST</u>  is  the  starting LBA, <u>RN</u> is the repeat number which is the maximum number of blocks in
              each SCSI UNMAP command, and <u>LA</u>, if given, is the last LBA to unmap. If <u>LA</u> is not given, then  the
              last LBA on the <u>DEVICE</u> is used. That is obtained by the SCSI READ CAPACITY command.

       <b>-a</b>, <b>--anchor</b>
              sets the 'Anchor' bit in the command (introduced in sbc3r22).

       <b>-d</b>, <b>--dry-run</b>
              perform  all  the  preparation,  including  opening  <u>DEVICE</u> plus sending a 'standard' SCSI INQUIRY
              command (and optionally a READ CAPACITY), but exit before performing any SCSI UNMAP commands.

       <b>-f</b>, <b>--force</b>
              bypass the 15 second warning period that occurs before any UNMAP commands are sent.

       <b>-g</b>, <b>--grpnum</b>=<u>GN</u>
              sets the 'Group number' field to <u>GN</u>. Defaults to a value of zero.  <u>GN</u> should be a value between  0
              and 63.

       <b>-h</b>, <b>--help</b>
              output the usage message then exit.

       <b>-I</b>, <b>--in</b>=<u>FILE</u>
              where  <u>FILE</u> is a file name containing pairs of values. The first member of each pair is a starting
              LBA and the second member of the pair is the number of logical blocks to unmap from and  including
              that  starting  LBA.  Values  are  interpreted  as decimal unless indicated otherwise. This option
              cannot be present with the '--lba=' option.

       <b>-l</b>, <b>--lba</b>=<u>LBA,LBA...</u>
              where <u>LBA,LBA...</u> is a string of comma (or space) separated values that are interpreted as starting
              logical block addresses. Each number is interpreted as decimal unless prefixed by '0x' or '0X' (or
              it has a trailing 'h' or 'H'). An argument that contains any space separators needs to  be  quoted
              (or  otherwise escaped). When this option is given then the '--num=' option must also be given and
              they must contain the same number of elements in their arguments.

       <b>-n</b>, <b>--num</b>=<u>NUM,NUM...</u>
              where <u>NUM,NUM...</u> is a string of comma (or space) separated values that are interpreted as a number
              of logical blocks to unmap. Each number is interpreted as decimal unless prefixed by '0x' or  '0X'
              (or it has a trailing 'h' or 'H'). Note that 0 blocks is acceptable. An argument that contains any
              space  separators  needs  to be quoted (or otherwise escaped).  When this option is given then the
              '--lba=' option must also be given and they must contain the same  number  of  elements  in  their
              arguments.

       <b>-t</b>, <b>--timeout</b>=<u>TO</u>
              where <u>TO</u> is a timeout value (in seconds) for the UNMAP command.  The default value is 60 seconds.

       <b>-v</b>, <b>--verbose</b>
              increase the level of verbosity, (i.e. debug output).

       <b>-V</b>, <b>--version</b>
              print the version string and then exit.

</pre><h4><b>NOTES</b></h4><pre>
       Some limits: an LBA can be up to 64 bits, a NUM up to 32 bits (imposed by structure of UNMAP SCSI command
       parameter  data). The NUM is further constrained by the MAXIMUM UNMAP LBA COUNT field in the BLOCK LIMITS
       VPD page (0xb0). The maximum number of LBA,NUM pairs is limited to 128 by this utility and may be further
       constrained by the MAXIMUM UNMAP BLOCK DESCRIPTOR COUNT field in the BLOCK LIMITS VPD page.

       Since it is unclear how long the UNMAP command will take  to  execute  a  '--timeout="  option  has  been
       provided.  The default timeout period is 60 seconds. If all the logical blocks on a logical unit (e.g.  a
       disk drive) are to be unmapped then the FORMAT UNIT SCSI command  (see  the  sg_format  utility)  may  be
       considered as an alternative.

       Support  for  logical  block  provisioning is indicated by the LBPME bit in the response to the SCSI READ
       CAPACITY (16) command (see the sg_readcap utility).

       In SBC-3 revision 25 the LBPU and ANC_SUP bits where added to the Logical Block  Provisioning  VPD  page.
       When  LBPU is set it indicates that the device supports the UNMAP command. When the ANC_SUP bit is set it
       indicates the device supports anchored LBAs.

       The SCSI UNMAP command does the  "right  thing"  with  respect  to  command  queueing.  However  its  ATA
       counterpart:  the  DATA  SET  MANAGEMENT command with the "Trim" bit set does not interact well with SATA
       queueing known as NCQ.  To address this problem T13 have introduced a new command  called  SFQ  DATA  SET
       MANAGEMENT which also has a Trim bit.

</pre><h4><b>EXAMPLES</b></h4><pre>
       In  the  examples  directory of the sg3_utils package there is a sg_unmap_example.txt file that shows the
       format that the '--in=' option accepts.

       To unmap all blocks from and including LBA 0x2000 to the end of the device (e.g. disk or SSD)  with  each
       SCSI UNMAP command given 1024 blocks to unmap:

         sg_unmap --all=0x2000,1k /dev/sg2

       Add '--force' to bypass the 15 seconds of warnings. So '--force' is appropriate for batch files.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       The exit status of sg_unmap is 0 when it is successful. Otherwise see the <a href="../man8/sg3_utils.8.html">sg3_utils</a>(8) man page.

</pre><h4><b>AUTHORS</b></h4><pre>
       Written by Douglas Gilbert.

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to &lt;dgilbert at interlog dot com&gt;.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright Â© 2009-2018 Douglas Gilbert
       This  software  is  distributed  under  a  BSD-2-Clause  license.  There  is  NO  warranty;  not even for
       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>sg_format,sg_get_lba_status,sg_readcap,sg_vpd,sg_write_same(sg3_utils)</b>

sg3_utils-1.43                                     March 2018                                        <u><a href="../man8/SG_UNMAP.8.html">SG_UNMAP</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>