<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pam_oar_adopt - OAR's pam_exec script to manage ssh connections to OAR nodes</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/oar-node">oar-node_2.6.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pam_oar_adopt - OAR's pam_exec script to manage ssh connections to OAR nodes

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>pam_oar_adopt</b> <b>-a</b> for PAM account

       <b>pam_oar_adopt</b> <b>-s</b> for PAM session

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This script is part of the OAR resources and jobs manager software.

       PAM can be configured to let users <b>ssh</b> (basic ssh, not via <b>oarsh</b>) to OAR nodes and place the created
       processes in the job's cgroup. It will also prevent any ssh connection to nodes that are not properly
       reserved.

       This uses the <b>pam_exec</b> module with the <b>pam_oar_adopt</b> script and the <b>pam_env</b> module.

       Once enabled, if a user has reserved a node and then connects to it using ssh, PAM will find out the
       job's <b>cgroup</b> and place the ssh remote process in it. It will also load the job's environment variables.

       If a user tries to ssh to a node that is either not reserved, or not reserved in full (all compute
       resources of the node must be reserved) or reserved multiple times (e.g. 2 different jobs reserving each
       a subset of the node's compute resources, or using the timesharing job type), the connection will fail.

       Please note that while using ssh is very convenient, <b>oarsh</b> provides extra features to connect to jobs.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       To <b>enable</b> this feature, one must configure <b>pam_oar_adopt</b> in PAM and activate it in its configuration file
       (<b>/etc/oar/pam_oar_adopt.conf</b>).

   <b>PAM</b> <b>CONFIGURATION</b>
       Make sure the <b>ssh</b> service (on port 22, not OAR's dedicated ssh service on port 6667) enables PAM.
       <b><a href="file:/etc/ssh/sshd_config">/etc/ssh/sshd_config</a></b> must contain:

        UsePAM yes

       Follows an example of configuration of PAM with <b>pam_oar_adopt</b> on Debian-like systems:

       <b><a href="file:/etc/pam.d/common-account">/etc/pam.d/common-account</a></b>
           The following can be set as the first PAM directive in common-account:

            account required      pam_exec.so quiet stdout /usr/sbin/pam_oar_adopt -a

       <b><a href="file:/etc/pam.d/common-session">/etc/pam.d/common-session</a></b> and <b><a href="file:/etc/pam.d/common-session-noninteractive">/etc/pam.d/common-session-noninteractive</a></b>
           The  following  can  be  set  as  the  last  PAM  directives  in  common-session  and common-session-
           noninteractive:

            session required   pam_exec.so quiet stdout /usr/sbin/pam_oar_adopt -s
            session optional   pam_env.so readenv=1 envfile=/var/lib/oar/pam.env

       On Debian-like systems, one can also use the <b>pam-auth-update</b> command to configure PAM  and,  by  default,
       this PAM profile is installed with the oar-node package.

   <b>PAM_OAR_ADOPT</b> <b>CONFIGURATION</b>
       The <b>/etc/oar/pam_oar_adopt.conf</b> file contains the following configuration options:

       <b>MODE</b> weather <b>pam_oar_adopt</b> is enabled or not. Possible values are:
           <b>enforced</b>: <b>pam_oar_adopt</b> is enabled and will prevent any ssh connection to nodes that are not properly
           reserved.
           <b>disabled</b>: <b>pam_oar_adopt</b> is disabled.

           By default, <b>pam_oar_adopt</b> is disabled.

           [DEPRECATED] For compatibility reasons, if the <b>/etc/oar/pam_oar_adopt_enabled</b> file exists, regardless
           of <b>/etc/oar/pam_oar_adopt.conf</b>, then <b>pam_oar_adopt</b> is enabled.

       <b>WARN</b>
           In  <b>disabled</b>  mode,  <b>pam_oar_adopt</b> will warn users about what would have been done if it was enabled.
           Possible values are:

           <b>yes</b>: warn users (default).
           <b>no</b>: do not warn users about <b>pam_oar_adopt</b> doing nothing.
       <b>USER_UID_MIN</b>
           In <b>enforced</b> mode, <b>pam_oar_adopt</b> will ignore (not prevent) ssh connections from users with a UID lower
           than <b>USER_UID_MIN</b>. This is useful to allow system users to connect to nodes without being part  of  a
           job. The default value is 1000.

</pre><h4><b>NOTES</b></h4><pre>
       It  is  a good practice to prevent users to connect to OAR nodes outside of jobs (except system users: at
       least root and the <b>oar</b> user).

       Configuring <b>pam_oar_adopt</b> does it, but it can also be  enforced  using  <b>pam_access</b>  or  the  AllowedUsers
       directive in <b><a href="file:/etc/ssh/sshd_config">/etc/ssh/sshd_config</a></b>.

       Conversely, in an installation where either of OAR's deploy or cosystem job types is used, which requires
       the oar-node package to also be installed on the deploy or cosystem frontend, it is usually normal to let
       any  user  ssh  to that frontend regardless of jobs. As a result on such a frontend, <b>pam_oar_adopt</b> should
       not be installed (on Debian-like systems, one may use <b>pam-auth-update</b>  to  deactivate  the  oar-node  PAM
       profile).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/pam.7.html">pam</a></b>(7),  <b><a href="../man5/pam.conf.5.html">pam.conf</a></b>(5),  <b><a href="../man5/pam.d.5.html">pam.d</a></b>(5),  <b><a href="../man8/pam_exec.8.html">pam_exec</a></b>(8),  <b><a href="../man7/pam_env.7.html">pam_env</a></b>(7),  <b><a href="../man8/pam_access.8.html">pam_access</a></b>(8),  <b><a href="../man8/pam-auth-update.8.html">pam-auth-update</a></b>(8),  <b><a href="../man1/ssh.1.html">ssh</a></b>(1),
       <b><a href="../man5/sshd_config.5.html">sshd_config</a></b>(5), <b><a href="../man1/oarsh.1.html">oarsh</a></b>(1)

</pre><h4><b>COPYRIGHTS</b></h4><pre>
        Copyright 2003-2025 Laboratoire d'Informatique de Grenoble (<a href="http://www.liglab.fr">http://www.liglab.fr</a>). This software is licensed under the GNU General Public License Version 2 or above. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

pam_oar_adopt                                      2025-03-24                                   <u><a href="../man8/pam_oar_adopt.8.html">pam_oar_adopt</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>