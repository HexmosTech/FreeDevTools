<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sg_compare_and_write - send the SCSI COMPARE AND WRITE command</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/sg3-utils">sg3-utils_1.48-2ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sg_compare_and_write - send the SCSI COMPARE AND WRITE command

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>sg_compare_and_write</b>  [<u>--dpo</u>]  [<u>--fua</u>]  [<u>--fua_nv</u>]  [<u>--grpnum=GN</u>]  [<u>--help</u>]  <u>--in=IF</u> [<u>--inw=WF</u>] <u>--lba=LBA</u>
       [<u>--num=NUM</u>] [<u>--quiet</u>] [<u>--timeout=TO</u>] [<u>--verbose</u>] [<u>--version</u>] [<u>--wrprotect=WP</u>] [<u>--xferlen=LEN</u>] <u>DEVICE</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Send the SCSI COMPARE AND WRITE command to <u>DEVICE</u>. This utility fetches a  compare  buffer  and  a  write
       buffer  from  either one or two files. If the <u>--inw=WF</u> option is given then the compare buffer is fetched
       from the file indicated by the <u>--in=IF</u> while the write buffer is fetched from the file indicated  by  the
       <u>--inw=WF</u>. If the <u>--inw=WF</u> option is not given then the concatenated compare and write buffers are fetched
       from the file indicated by the <u>--in=IF</u> option.

       Those  buffers  are  expected  to  each  contain  <u>NUM</u> blocks of data. The compare starts at logical block
       address <u>LBA</u> on the <u>DEVICE</u> and if the comparison fails (i.e. the provided compare buffer  does  not  equal
       the  data  at  <u>LBA</u>  on  the  <u>DEVICE</u>)  then  the  COMPARE  AND  WRITE command finishes with a sense key of
       MISCOMPARE. In this case this utility will complete and set an exit status of 14 (which happens to be the
       sense key value of MISCOMPARE).

       If the comparison succeeds then the provided write buffer is stored starting at <u>LBA</u> for <u>NUM</u> blocks on the
       <u>DEVICE</u>.

       The actual number of bytes transferred in the data-out buffer of the COMPARE AND WRITE command  may  need
       to  be given by the user with the <u>--xferlen=LEN</u> option. <u>LEN</u> defaults to (2 * <u>NUM</u> * 512) which is 1024 for
       the default <u>NUM</u> of 1. If the block size is other than 512 then the user will need  to  use  <u>--xferlen=LEN</u>
       option.   If protection information is given (indicated by a value of <u>WP</u> other than 0 (the default)) then
       for a <u>NUM</u> of 1 <u>LEN</u> should be 1040 . Note that the SCSI READ CAPACITY command is  not  performed  by  this
       utility (e.g.  to find the block size).

       The  T10  definition of the SCSI COMPARE AND WRITE command requires that the <u>DEVICE</u> implement the compare
       and optional write as an uninterrupted series of actions. Depending  on  some  other  <u>DEVICE</u>  settings  a
       verify operation may occur prior to the compare.

       When a mismatch occurs between the compare buffer and the blocks starting at <u>LBA</u> read from the <u>DEVICE</u> the
       sense  buffer containing the MISCOMPARE sense key causes several messages to be sent to stderr (including
       the offset of the first byte mismatch). To suppress these  messages  use  the  <u>--quiet</u>  option.  With  or
       without the <u>--quiet</u> option the exit status will be set to 14.

       This  command is defined in SBC-3 whose most recent revision is 36. SBC-3 and other SCSI documents can be
       found at https://www.t10.org .

</pre><h4><b>OPTIONS</b></h4><pre>
       Arguments to long options are mandatory  for  short  options  as  well.   The  options  are  arranged  in
       alphabetical order based on the long option name.

       <b>-d</b>, <b>--dpo</b>
              Set the DPO bit in the COMPARE AND WRITE CDB

       <b>-f</b>, <b>--fua</b>
              Set the FUA bit in the COMPARE AND WRITE CDB

       <b>-F</b>, <b>--fua_nv</b>
              Set  the  FUA_NV  bit in the COMPARE AND WRITE CDB. This bit was removed in SBC-3 revision 35d and
              its position marked as "reserved".

       <b>-g</b>, <b>--grpnum</b>=<u>GN</u>
              where <u>GN</u> is the value to be placed in the group number field in the COMPARE AND WRITE CDB.

       <b>-h</b>, <b>--help</b>
              output the usage message then exit.

       <b>-i</b>, <b>--in</b>=<u>IF</u>
              read data (binary) from file named <u>IF</u>. This will either be the combined compare and write  buffers
              (when  the  <u>--inw=WF</u>  option is not given) or just the compare buffer (when the <u>--inw=WF</u> option is
              given). If <u>IF</u> is '-' then stdin (e.g. a pipe) is read.

       <b>-C</b>, <b>--inc</b>=<u>IF</u>
              The same as the <b>--in</b> option.

       <b>-D</b>, <b>--inw</b>=<u>WF</u>
              read data (binary) from file named <u>WF</u>. This will the write buffer that will become the second half
              of the data-out buffer sent to the <u>DEVICE</u> associated with the COMPARE AND WRITE command. Note that
              when this option is given then the <u>--in=IF</u> is expected to hold the associated compare buffer.

       <b>-l</b>, <b>--lba</b>=<u>LBA</u>
              where <u>LBA</u> is the logical block address to start the COMPARE AND WRITE command. Assumed  to  be  in
              decimal unless prefixed with '0x' or has a trailing 'h'.

       <b>-n</b>, <b>--num</b>=<u>NUM</u>
              where  <u>NUM</u> is the number of blocks, starting at <u>LBA</u>, to read and compare with the verify instance.
              And given a match, the <u>NUM</u> of blocks to write starting <u>LBA</u>. The default value for <u>NUM</u> is 1.

       <b>-q</b>, <b>--quiet</b>
              suppress the sense buffer messages associated with a MISCOMPARE sense key that would otherwise  be
              sent  to  stderr.  Still  set  the  exit  status  to  14 which is the sense key value indicating a
              MISCOMPARE.

       <b>-t</b>, <b>--timeout</b>=<u>TO</u>
              where <u>TO</u> is the command timeout value in seconds. The default value is 60 seconds. If <u>NUM</u> is large
              (or zero) a WRITE SAME command may require considerably more time than 60 seconds to complete.

       <b>-v</b>, <b>--verbose</b>
              increase the degree of verbosity (debug messages).

       <b>-V</b>, <b>--version</b>
              output version string then exit.

       <b>-w</b>, <b>--wrprotect</b>=<u>WP</u>
              set the WRPROTECT field in the cdb to <u>WP</u>. The default value  is  0  which  implies  no  protection
              information is sent (along with the user data) by this utility.

       <b>-x</b>, <b>--xferlen</b>=<u>LEN</u>
              where  <u>LEN</u>  is  the  data  out buffer length in byte. It defaults to (2 * <u>NUM</u> * 512) bytes. If the
              <u>DEVICE</u> block size is other than 512 bytes  or  <u>WP</u>  is  non-zero  (implying  additional  protection
              information) then this default will be incorrect; the use must supply the correct value for <u>LEN</u>

</pre><h4><b>NOTES</b></h4><pre>
       Various  numeric arguments (e.g. <u>LBA</u>) may include multiplicative suffixes or be given in hexadecimal. See
       the "NUMERIC ARGUMENTS" section in the <a href="../man8/sg3_utils.8.html">sg3_utils</a>(8) man page.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Before overwriting the first two blocks of whatever (SCSI) storage device that is chosen,  take  a  small
       backup. The logical block size is assumed to be 512 bytes. Take a copy (in backup01.bin) of the first two
       blocks::

         # sg_dd if=/dev/sg1 bs=512 of=backup01.bin count=2
         2+0 records in
         2+0 records out

       <b>WARNING:</b>  if  /dev/sg1 corresponds to a disk on your system that contains currently mounted file systems,
       do _not_ continue. If you can, unmount all file systems on that  disk.  If  that  is  not  possible,  use
       another  disk  with no mounted file systems on it. In Linux the scsi_debug driver is a good candidate for
       experimentation.

       Now fill the first block with 0xff bytes:

         # sg_dd iflag=ff bs=512 of=/dev/sg1 count=1
         1+0 records in
         1+0 records out

       and the second block with 0x0 bytes:

         # sg_dd iflag=00 bs=512 seek=1 of=/dev/sg1 count=1
         1+0 records in
         1+0 records out

       Now copy those two blocks into a file:

         # sg_dd if=/dev/sg1 bs=512 of=ff00.bin count=2
         2+0 records in
         2+0 records out

       Now we can do a compare and write command. It is told to compare the first block (i.e. LBA  0)  with  the
       first  block  in  the  given  file  (i.e. ff00.bin).  If they are equal (they should be both full of 0xff
       bytes). Since the compare succeeds, it will write the second block in ff00.bin over LBA 0:

         # sg_compare_and_write --in=ff00.bin --lba=0 --num=1 /dev/sg1

       No news is good news. Now if we do that command again:

         # sg_compare_and_write --in=ff00.bin --lba=0 --num=1 /dev/sg1
         Miscompare at byte offset: 0 [0x0]
         sg_compare_and_write failed: Miscompare

       This is expected. The first sg_compare_and_write ended up writing 0x0 bytes  over  LBA  0x0.  The  second
       sg_compare_and_write command compares LBA 0x0 with 0xff bytes and fails immediately (i.e. at byte offset:
       0). Now we will overwrite the first 3 bytes of ff00.bin with 0x0:

         # sg_dd bs=1 iflag=00 of=ff00.bin count=3
         3+0 records in
         3+0 records out

       Notice the 'bs=1' operand. The dd utility (and thus sg_dd) is very useful for doing small binary edits on
       a file. Now if we do that sg_compare_and_write again, it still fails but with a small difference:

         # sg_compare_and_write --in=ff00.bin --lba=0 --num=1 /dev/sg1
         Miscompare at byte offset: 3 [0x3]
         sg_compare_and_write failed: Miscompare

       So  the  bytes  at  offset  0, 1, and 2 compared equal but not the byte at offset 3. The SCSI COMPARE AND
       WRITE will stop on the first micompared byte.

</pre><h4><b>EXIT</b> <b>STATUS</b></h4><pre>
       The exit status of sg_compare_and_write is 0 when it is successful. If the compare step  fails  then  the
       exit status is 14. For other exit status values see the EXIT STATUS section in the <a href="../man8/sg3_utils.8.html">sg3_utils</a>(8) man page.

       Earlier versions of this utility set an exit status of 98 when there was a MISCOMPARE.

</pre><h4><b>AUTHORS</b></h4><pre>
       Written by Shahar Salzman. Maintained by Douglas Gilbert. Additions by Eric Seppanen.

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs to <a href="mailto:shahar.salzman@kaminario.com">shahar.salzman@kaminario.com</a> or <a href="mailto:dgilbert@interlog.com">dgilbert@interlog.com</a>

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright © 2012-2020 Kaminario Technologies LTD
       Redistribution  and  use in source and binary forms, with or without modification, are permitted provided
       that the following conditions are met:
       * Redistributions of source code must retain the above copyright notice, this list of conditions and  the
       following disclaimer.
       *  Redistributions  in binary form must reproduce the above copyright notice, this list of conditions and
       the following disclaimer in the documentation and/or other materials provided with the distribution.
       * Neither the name of the &lt;organization&gt; nor the names of its contributors may  be  used  to  endorse  or
       promote products derived from this software without specific prior written permission.

       THIS  SOFTWARE  IS  PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED
       WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND  FITNESS  FOR  A
       PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL Kaminario Technologies LTD BE LIABLE FOR ANY DIRECT,
       INDIRECT,  INCIDENTAL,  SPECIAL,  EXEMPLARY,  OR  CONSEQUENTIAL  DAMAGES  (INCLUDING, BUT NOT LIMITED TO,
       PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR  PROFITS;  OR  BUSINESS  INTERRUPTION)
       HOWEVER  CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
       NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  SOFTWARE,  EVEN  IF  ADVISED  OF  THE
       POSSIBILITY OF SUCH DAMAGE.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>sg_xcopy,</b> <b>sg_receive_copy_results(sg3_utils)</b>

sg3_utils-1.47                                     April 2021                               <u>COMPARE</u> <u>AND</u> <u><a href="../man8/WRITE.8.html">WRITE</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>