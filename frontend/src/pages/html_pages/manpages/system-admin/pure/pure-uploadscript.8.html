<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pure-uploadscript - Automatically run an external program after a successful upload</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/pure-ftpd-common">pure-ftpd-common_1.0.50-2.2build3_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pure-uploadscript - Automatically run an external program after a successful upload

</pre><h4><b>SYNTAX</b></h4><pre>
       pure-uploadscript [<u>-p</u> &lt;<u>/path/to/pidfile</u>&gt;] [<u>-B</u>] [<u>-g</u> &lt;<u>gid</u>&gt;] [<u>-h</u>] <u>-r</u> &lt;<u>program</u> <u>to</u> <u>run</u>&gt; [<u>-u</u> &lt;<u>uid</u>&gt;]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       If  Pure-FTPd  is  compiled with <b>--with-uploadscript</b> (default in binary distributions), and if the <b>-o</b> (or
       <b>--uploadscript</b>) is passed to the server, a named pipe called <b>/var/run/pure-ftpd.upload.pipe</b>  is  created.
       You will also notice an important file called <b>/var/run/pure-ftpd.upload.lock</b>, used for locking.
       After a successful upload, the file name is written to the pipe.
       <b>pure-uploadscript</b>  reads  this  pipe  to  automatically  run  any  program or script to process the newly
       uploaded file.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-B</b>     Daemonize the process and fork it in background.

       <b>-g</b> &lt;<u>gid</u>&gt;
              Switch the group ID to &lt;<u>gid</u>&gt;.

       <b>-h</b> or <b>--help</b>
              Display available options.

       <b>-r</b> &lt;<u>program</u> <u>to</u> <u>run</u>&gt;
              Tell what program/script to run. It has to be <u>an</u> <u>absolute</u> <u>filename</u>, the <b>PATH</b> environment  variable
              is  ignored.   The  first argument of that program will be the <u>unquoted</u> name of the newly uploaded
              file.  Environment variables aren't cleared. So don't put sensitive data in  them  before  calling
              pure-uploadscript if you switch uid.

       <b>-u</b> &lt;<u>uid</u>&gt;
              Switch the user ID to &lt;<u>uid</u>&gt;.

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       When  the  upload  script is run, the name of the newly uploaded file is the first argument passed to the
       script (referenced as $1 by most shells) . Some environment variables are  also  filled  by  useful  info
       about  the  file.  <b>UPLOAD_SIZE</b> The size of the file, in bytes.  <b>UPLOAD_PERMS</b> The permissions, as an octal
       integer.  <b>UPLOAD_UID</b> The numerical UID of  the  owner.   <b>UPLOAD_GID</b>  The  numerical  GID  of  the  owner.
       <b>UPLOAD_USER</b>  The login of the owner.  <b>UPLOAD_GROUP</b> The group name the files belongs to.  <b>UPLOAD_VUSER</b> The
       full user name, or the virtual user name (127 chars max) .

</pre><h4><b>FILES</b></h4><pre>
       <u>/var/run/pure-ftpd.upload.pipe</u> <u>/var/run/pure-ftpd.upload.lock</u> <u>/var/run/pure-uploadscript.pid</u>

</pre><h4><b>SECURITY</b></h4><pre>
       <b>pure-ftpd</b> and <b>pure-uploadscript</b> are trying to limit security implications of such a feature.

       - The pipe can only be created and opened by root. It must have perms 600, with uid 0, or it will be
       ignored.

       - The argument passed to an external program/script is always an exact absolute path name. It doesn't get
       fooled by <b>chroot()</b>ed environments, and by absolute or relative paths added to the STOR command.

       - UID and GID are set just after parsing command-line options, and <b>pure-uploadscript</b> never gets back
       supervisor privileges.

       - Descriptors to the pipe are never passed to external programs/scripts. So when UID switched, the target
       user can't mess the pipe.

       - Only regular files are processed, control characters are rejected, and a header+footer avoid partial
       file names.

       - Two external programs/scripts can't run at the same time. Uploads are always processed sequentially, in
       chronological order. This is to avoid denial-of-services by issuing a lot of simultaneous STOR commands
       in order to launch a fork bomb on the server. For this reason, your programs shouldn't take a long time
       to complete (but they can run themselves in background) .

</pre><h4><b>EXAMPLES</b></h4><pre>
       A sample script could be:

       #! <a href="file:/bin/sh">/bin/sh</a>
       echo "$1 uploaded" | /usr/bin/mutt -s "New upload: $1" \ <a href="mailto:ftpadmin@dom.ai.n">ftpadmin@dom.ai.n</a>

       Never forget to quote (<b>"variable"</b>) all variables in all your shell scripts to avoid security flaws.

</pre><h4><b>AUTHORS</b></h4><pre>
       Frank DENIS &lt;j at pureftpd dot org&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/ftp.1.html">ftp</a>(1)</b>, <b><a href="../man8/pure-ftpd.8.html">pure-ftpd</a>(8)</b> <b><a href="../man8/pure-ftpwho.8.html">pure-ftpwho</a>(8)</b> <b><a href="../man8/pure-mrtginfo.8.html">pure-mrtginfo</a>(8)</b> <b><a href="../man8/pure-uploadscript.8.html">pure-uploadscript</a>(8)</b> <b><a href="../man8/pure-statsdecode.8.html">pure-statsdecode</a>(8)</b>  <b><a href="../man8/pure-pw.8.html">pure-pw</a>(8)</b>
       <b><a href="../man8/pure-quotacheck.8.html">pure-quotacheck</a>(8)</b> <b><a href="../man8/pure-authd.8.html">pure-authd</a>(8)</b> <b><a href="../man8/pure-certd.8.html">pure-certd</a>(8)</b>

       <b>RFC</b> <b>959</b>, <b>RFC</b> <b>2228</b>, <b>RFC</b> <b>2389</b> and <b>RFC</b> <b>2428</b>.

Frank Denis                                          1.0.50                                 <u><a href="../man8/pure-uploadscript.8.html">pure-uploadscript</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>