<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ip-rule - routing policy database management</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/iproute2">iproute2_6.14.0-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ip-rule - routing policy database management

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>ip</b> [ <u>OPTIONS</u> ] <b>rule</b> { <u>COMMAND</u> | <b>help</b> }

       <b>ip</b> <b>rule</b> [ <b>show</b> [ <u>SELECTOR</u> ]]

       <b>ip</b> <b>rule</b> { <b>add</b> | <b>del</b> } <u>SELECTOR</u> <u>ACTION</u>

       <b>ip</b> <b>rule</b> { <b>flush</b> | <b>save</b> | <b>restore</b> }

       <u>SELECTOR</u> := [ <b>not</b> ] [ <b>from</b> <u>PREFIX</u> ] [ <b>to</b> <u>PREFIX</u> ] [ <b>tos</b> <u>TOS</u> ] [ <b>dscp</b> <u>DSCP</u> ] [ <b>fwmark</b> <u>FWMARK</u>[<b>/</b><u>MASK</u>] ] [
               <b>iif</b> <u>STRING</u> ] [ <b>oif</b> <u>STRING</u> ] [ <b>priority</b> <u>PREFERENCE</u> ] [ <u>l3mdev</u> ] [ <b>uidrange</b> <u>NUMBER</u>-<u>NUMBER</u> ] [
               <b>ipproto</b> <u>PROTOCOL</u> ] [ <b>sport</b> [ <u>NUMBER</u> | <u>NUMBER</u>-<u>NUMBER</u> ] ] [ <b>dport</b> [ <u>NUMBER</u> | <u>NUMBER</u>-<u>NUMBER</u> ] ] [
               <b>tun_id</b> <u>TUN_ID</u> ] [ <b>flowlabel</b> <u>FLOWLABEL</u>[<b>/</b><u>MASK</u>] ]

       <u>ACTION</u> := [ <b>table</b> <u>TABLE_ID</u> ] [ <b>protocol</b> <u>PROTO</u> ] [ <b>nat</b> <u>ADDRESS</u> ] [ <b>realms</b> [<u>SRCREALM</u><b>/</b>]<u>DSTREALM</u> ] [ <b>goto</b>
               <u>NUMBER</u> ] <u>SUPPRESSOR</u>

       <u>SUPPRESSOR</u> := [ <b>suppress_prefixlength</b> <u>NUMBER</u> ] [ <b>suppress_ifgroup</b> <u>GROUP</u> ]

       <u>TABLE_ID</u> := [ <b>local</b> | <b>main</b> | <b>default</b> | <u>NUMBER</u> ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>ip</u> <u>rule</u> manipulates rules in the routing policy database that controls the route selection algorithm.

       Classic routing algorithms used in the Internet make routing decisions based only on the destination
       address of packets (and in theory, but not in practice, on the TOS field).

       In some circumstances, we want to route packets differently depending not only on destination addresses
       but also on other packet fields: source address, IP protocol, transport protocol ports or even packet
       payload.  This task is called 'policy routing'.

       To solve this task, the conventional destination based routing table, ordered according to the longest
       match rule, is replaced with a 'routing policy database' (or RPDB), which selects routes by executing
       some set of rules.

       Each policy routing rule consists of a <b>selector</b> and an <b>action</b> <b>predicate.</b>  The RPDB is scanned in order of
       decreasing priority (note that a lower number means higher priority, see the description of <u>PREFERENCE</u>
       below). The selector of each rule is applied to {source address, destination address, incoming interface,
       tos, fwmark} and, if the selector matches the packet, the action is performed. The action predicate may
       return with success.  In this case, it will either give a route or failure indication and the RPDB lookup
       is terminated. Otherwise, the RPDB program continues with the next rule.

       Semantically, the natural action is to select the nexthop and the output device.

       At startup time the kernel configures the default RPDB consisting of three rules:

       1.     Priority:  0,  Selector:  match  anything, Action: lookup routing table <b>local</b> (ID 255).  The <b>local</b>
              table is a special routing table containing high priority control routes for local  and  broadcast
              addresses.

       2.     Priority:  32766,  Selector: match anything, Action: lookup routing table <b>main</b> (ID 254).  The <b>main</b>
              table is the normal routing table containing all non-policy  routes.  This  rule  may  be  deleted
              and/or overridden with other ones by the administrator.

       3.     Priority:  32767,  Selector:  match  anything, Action: lookup routing table <b>default</b> (ID 253).  The
              <b>default</b> table is empty. It is reserved for some  post-processing  if  no  previous  default  rules
              selected the packet.  This rule may also be deleted.

       Each  RPDB  entry  has additional attributes. F.e. each rule has a pointer to some routing table. NAT and
       masquerading rules have an attribute to select new IP  address  to  translate/masquerade.  Besides  that,
       rules  have  some  optional  attributes,  which routes have, namely <b>realms</b>.  These values do not override
       those contained in the routing tables. They are only used if the route did not select any attributes.

       The RPDB may contain rules of the following types:

              <b>unicast</b> - the rule returns the route found in the routing table referenced by the rule.

              <b>blackhole</b> - the rule causes a silent drop the packet.

              <b>unreachable</b> - the rule generates a 'Network is unreachable' error.

              <b>prohibit</b> - the rule generates 'Communication is administratively prohibited' error.

              <b>nat</b> - the rule translates the source address of the IP packet into some other value.

       <b>ip</b> <b>rule</b> <b>add</b> <b>-</b> <b>insert</b> <b>a</b> <b>new</b> <b>rule</b>

       <b>ip</b> <b>rule</b> <b>delete</b> <b>-</b> <b>delete</b> <b>a</b> <b>rule</b>

              <b>type</b> <u>TYPE</u> <b>(default)</b>
                     the type of this rule. The list of valid types was given in the previous subsection.

              <b>from</b> <u>PREFIX</u>
                     select the source prefix to match.

              <b>to</b> <u>PREFIX</u>
                     select the destination prefix to match.

              <b>iif</b> <u>NAME</u>
                     select the incoming device to match. If the interface is loopback, the  rule  only  matches
                     packets  originating from this host. This means that you may create separate routing tables
                     for forwarded and local packets and, hence, completely separate them.

              <b>oif</b> <u>NAME</u>
                     select the outgoing device to match. The outgoing interface is only available  for  packets
                     originating from local sockets that are bound to a device.

              <b>tos</b> <u>TOS</u>

              <b>dsfield</b> <u>TOS</u>
                     select the TOS value to match.

              <b>dscp</b> <u>DSCP</u>
                     select  the  DSCP  value  to  match.  DSCP values can be written either directly as numeric
                     values   (valid   values   are   0-63),   or   using   symbolic    names    specified    in
                     <b>/usr/share/iproute2/rt_dsfield</b>  or  <b><a href="file:/etc/iproute2/rt_dsfield">/etc/iproute2/rt_dsfield</a></b>  (has  precedence  if exists).
                     However, note that the file specifies full 8-bit dsfield values, whereas <b>ip</b> <b>rule</b> will  only
                     use  the higher six bits.  <b>ip</b> <b>rule</b> <b>show</b> will similarly format DSCP values as symbolic names
                     if possible. The command line option <b>-N</b> turns the show translation off.

              <b>fwmark</b> <u>MARK</u>
                     select the <b>fwmark</b> value to match.

              <b>uidrange</b> <u>NUMBER-NUMBER</u>
                     select the <b>uid</b> value to match.

              <b>ipproto</b> <u>PROTOCOL</u>
                     select the ip protocol value to match.

              <b>sport</b> <u>NUMBER</u> <u>|</u> <u>NUMBER-NUMBER</u>
                     select the source port value to match. supports port range.

              <b>dport</b> <u>NUMBER</u> <u>|</u> <u>NUMBER-NUMBER</u>
                     select the destination port value to match. supports port range.

              <b>priority</b> <u>PREFERENCE</u>
                     the priority of this rule.  <u>PREFERENCE</u> is an unsigned integer value,  higher  number  means
                     lower  priority,  and  rules  get processed in order of increasing number. Each rule should
                     have an explicitly set <u>unique</u>  priority  value.   The  options  preference  and  order  are
                     synonyms with priority.

              <b>table</b> <u>TABLEID</u>
                     the  routing  table identifier to lookup if the rule selector matches.  It is also possible
                     to use lookup instead of table.

              <b>protocol</b> <u>PROTO</u>
                     the routing protocol who installed the rule in question.  As an example when zebra installs
                     a rule it would get RTPROT_ZEBRA as the installing protocol.

              <b>suppress_prefixlength</b> <u>NUMBER</u>
                     reject routing decisions that have a prefix length of NUMBER or less.

              <b>suppress_ifgroup</b> <u>GROUP</u>
                     reject routing decisions that use a device belonging to the interface group GROUP.

              <b>realms</b> <u>FROM/TO</u>
                     Realms to select if the rule matched and the routing table lookup succeeded.  Realm  <u>TO</u>  is
                     only used if the route did not select any realm.

              <b>nat</b> <u>ADDRESS</u>
                     The  base  of the IP address block to translate (for source addresses).  The <u>ADDRESS</u> may be
                     either the start of the block of NAT addresses (selected by NAT routes)  or  a  local  host
                     address  (or  even  zero).  In the last case the router does not translate the packets, but
                     masquerades them to this address.  Using map-to instead of nat means the same thing.

              <b>flowlabel</b> <u>FLOWLABEL</u>[<b>/</b><u>MASK</u>]
                     select the IPv6 flow label to match with an optional mask.

                     <b>Warning:</b> Changes to the RPDB made with these commands do not become active immediately.  It
                     is  assumed  that  after a script finishes a batch of updates, it flushes the routing cache
                     with <b>ip</b> <b>route</b> <b>flush</b> <b>cache</b>.

       <b>ip</b> <b>rule</b> <b>flush</b> <b>-</b> <b>also</b> <b>dumps</b> <b>all</b> <b>the</b> <b>deleted</b> <b>rules.</b>

              <b>protocol</b> <u>PROTO</u>
                     Select the originating protocol.

       <b>ip</b> <b>rule</b> <b>show</b> <b>-</b> <b>list</b> <b>rules</b>
              This command has no arguments.  The options list or lst are synonyms with show.

       <b>ip</b> <b>rule</b> <b>save</b>

              <b>protocol</b> <u>PROTO</u>
                     Select the originating protocol.

       save rules table information to stdout
              This command behaves like <b>ip</b> <b>rule</b> <b>show</b> except that the output is raw data suitable for passing  to
              <b>ip</b> <b>rule</b> <b>restore</b>.

       <b>ip</b> <b>rule</b> <b>restore</b>
              restore rules table information from stdin
              This  command  expects  to  read  a data stream as returned from <b>ip</b> <b>rule</b> <b>save</b>.  It will attempt to
              restore the rules table information exactly as it was at the time of the save. Any  rules  already
              in the table are left unchanged, and duplicates are not ignored.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/ip.8.html">ip</a></b>(8)

</pre><h4><b>AUTHOR</b></h4><pre>
       Original Manpage by Michail Litvak &lt;<a href="mailto:mci@owl.openwall.com">mci@owl.openwall.com</a>&gt;

iproute2                                           20 Dec 2011                                        <u><a href="../man8/IP-RULE.8.html">IP-RULE</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>