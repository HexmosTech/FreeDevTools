<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cryptsetup-luksAddKey - add a new passphrase</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/cryptsetup-bin">cryptsetup-bin_2.8.0-1ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       cryptsetup-luksAddKey - add a new passphrase

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>cryptsetup</b> <u>luksAddKey</u> <b>[&lt;options&gt;]</b> <b>&lt;device&gt;</b> <b>[&lt;key</b> <b>file</b> <b>with</b> <b>new</b> <b>key&gt;]</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Adds a keyslot protected by a new passphrase. An existing passphrase must be supplied interactively, via
       --key-file or LUKS2 token (plugin). Alternatively to existing passphrase user may pass directly volume
       key (via --volume-key-file or --volume-key-keyring). The new passphrase to be added can be specified
       interactively, read from the file given as the positional argument (also via --new-keyfile parameter) or
       via LUKS2 token.

       <b>NOTE:</b> with --unbound option the action creates new unbound LUKS2 keyslot. The keyslot cannot be used for
       device activation. If you donâ€™t pass new key via --volume-key-file option, new random key is generated.
       Existing passphrase for any active keyslot is not required.

       <b>NOTE:</b> some parameters are effective only if used with LUKS2 format that supports per-keyslot parameters.
       For LUKS1, PBKDF type and hash algorithm is always the same for all keyslots.

       <b>&lt;options&gt;</b> can be [--key-file, --keyfile-offset, --keyfile-size, --new-keyfile, --new-keyfile-offset,
       --new-keyfile-size, --key-slot, --new-key-slot, --volume-key-file, --volume-key-keyring,
       --force-password, --hash, --header, --disable-locks, --iter-time, --pbkdf, --pbkdf-force-iterations,
       --pbkdf-memory, --pbkdf-parallel, --unbound, --type, --keyslot-cipher, --keyslot-key-size, --key-size,
       --timeout, --token-id, --token-type, --token-only, --new-token-id, --verify-passphrase,
       --external-tokens-path].

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>--batch-mode,</b> <b>-q</b>
           Suppresses all confirmation questions. Use with care!

           If the --verify-passphrase option is not specified, this option also switches off the passphrase
           verification.

       <b>--debug</b> <b>or</b> <b>--debug-json</b>
           Run in debug mode with full diagnostic logs. Debug output lines are always prefixed by <b>#</b>.

           If --debug-json is used, additional LUKS2 JSON data structures are printed.

       <b>--disable-locks</b>
           Disable lock protection for metadata on disk. This option is valid only for LUKS2 and ignored for
           other formats.

           <b>WARNING:</b> Do not use this option unless you run cryptsetup in a restricted environment where locking
           is impossible to perform (where <a href="file:/run">/run</a> directory cannot be used).

       <b>--external-tokens-path</b> <u>absolute_path</u>
           Override system directory path where cryptsetup searches for external token handlers (or token
           plugins). It must be absolute path (starting with '/' character).

       <b>--force-password</b>
           Do not use password quality checking for new LUKS passwords.

           This option is ignored if cryptsetup is built without password quality checking support.

           For more info about password quality check, see the manual page for <b><a href="../man5/pwquality.conf.5.html">pwquality.conf</a>(5)</b> and
           <b><a href="../man5/passwdqc.conf.5.html">passwdqc.conf</a>(5)</b>.

       <b>--hash,</b> <b>-h</b> <u>&lt;hash-spec&gt;</u>
           The specified hash is used for PBKDF2 and AF splitter.

       <b>--header</b> <b>&lt;device</b> <b>or</b> <b>file</b> <b>storing</b> <b>the</b> <b>LUKS</b> <b>header&gt;</b>
           Use a detached (separated) metadata device or file where the LUKS header is stored. This option
           allows one to store ciphertext and LUKS header on different devices.

           For commands that change the LUKS header (e.g. <u>luksAddKey</u>), specify the device or file with the LUKS
           header directly as the LUKS device.

       <b>--help,</b> <b>-?</b>
           Show help text and default parameters.

       <b>--iter-time,</b> <b>-i</b> <b>&lt;number</b> <b>of</b> <b>milliseconds&gt;</b>
           The number of milliseconds to spend with PBKDF passphrase processing. Specifying 0 as parameter
           selects the compiled-in default.

       <b>--key-description</b> <b>&lt;text&gt;</b>
           Set key description in keyring that will be used for passphrase retrieval.

       <b>--key-file,</b> <b>-d</b> <u>name</u>
           Read the passphrase from file.

           If the name given is "-", then the passphrase will be read from stdin. In this case, reading will not
           stop at newline characters.

           The passphrase supplied via --key-file is always the passphrase for existing keyslot requested by the
           command.

           If you want to set a new passphrase via key file, you have to use a positional argument or parameter
           --new-keyfile.

           See section <u>NOTES</u> <u>ON</u> <u>PASSPHRASE</u> <u>PROCESSING</u> in <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8) for more information.

       <b>--keyfile-offset</b> <u>value</u>
           Skip <u>value</u> bytes at the beginning of the key file.

       <b>--keyfile-size,</b> <b>-l</b> <u>value</u>
           Read a maximum of <u>value</u> bytes from the key file. The default is to read the whole file up to the
           compiled-in maximum that can be queried with --help. Supplying more data than the compiled-in maximum
           aborts the operation.

           This option is useful to cut trailing newlines, for example. If --keyfile-offset is also given, the
           size count starts after the offset.

       <b>--key-size,</b> <b>-s</b> <u>bits</u>
           Provide volume key size in <u>bits</u>. The argument has to be a multiple of 8.

           This option is required when parameter --volume-key-file is used to provide current volume key. Also,
           it is used when new unbound keyslot is created by specifying --unbound parameter.

       <b>--key-slot,</b> <b>-S</b> <b>&lt;0-N&gt;</b>
           When used together with parameter --new-key-slot this option allows you to specify which key slot is
           selected for unlocking volume key.

           <b>NOTE:</b> This option is ignored if existing volume key gets unlocked via LUKS2 token (--token-id,
           --token-type or --token-only parameters) or when volume key is provided directly via
           --volume-key-file parameter.

           <b>NOTE:</b> To maintain backward compatibility, without --new-key-slot parameter, this option allows you to
           specify which key slot is selected for the new key.

           The maximum number of key slots depends on the LUKS version. LUKS1 can have up to 8 key slots. LUKS2
           can have up to 32 key slots based on key slot area size and key size, but a valid key slot ID can
           always be between 0 and 31 for LUKS2.

       <b>--keyslot-cipher</b> <b>&lt;cipher-spec&gt;</b>
           This option can be used to set specific cipher encryption for the LUKS2 keyslot area.

       <b>--keyslot-key-size</b> <b>&lt;bits&gt;</b>
           This option can be used to set specific key size for the LUKS2 keyslot area.

       <b>--new-keyfile</b> <u>name</u>
           Read the passphrase for a new keyslot from file.

           If the name given is "-", then the passphrase will be read from stdin. In this case, reading will not
           stop at newline characters.

           This is alternative method to positional argument when adding new passphrase via kefile.

       <b>--new-keyfile-offset</b> <u>value</u>
           Skip <u>value</u> bytes at the start when adding a new passphrase from key file.

       <b>--new-keyfile-size</b> <u>value</u>
           Read a maximum of <u>value</u> bytes when adding a new passphrase from key file. The default is to read the
           whole file up to the compiled-in maximum length that can be queried with --help. Supplying more than
           the compiled in maximum aborts the operation. When --new-keyfile-offset is also given, reading starts
           after the offset.

       <b>--new-key-description</b> <b>&lt;text&gt;</b>
           Set key description in keyring that will be used for new passphrase retrieval.

       <b>--new-key-slot</b> <b>&lt;0-N&gt;</b>
           This option allows you to specify which key slot is selected for the new key.

           <b>NOTE:</b> When used this option affects --key-slot option.

           The maximum number of key slots depends on the LUKS version. LUKS1 can have up to 8 key slots. LUKS2
           can have up to 32 key slots based on key slot area size and key size, but a valid key slot ID can
           always be between 0 and 31 for LUKS2.

       <b>--new-token-id</b>
           Specify what token to use to get the passphrase for a new keyslot.

       <b>--pbkdf</b> <b>&lt;PBKDF</b> <b>spec&gt;</b>
           Set Password-Based Key Derivation Function (PBKDF) algorithm for LUKS keyslot. The PBKDF can be:
           <u>pbkdf2</u> (for PBKDF2 according to RFC2898), <u>argon2i</u> for Argon2i or <u>argon2id</u> for Argon2id (see Argon2
           &lt;https://www.cryptolux.org/index.php/Argon2&gt; for more info).

           For LUKS1, only PBKDF2 is accepted (no need to use this option). The default PBKDF for LUKS2 is set
           during compilation time and is available in <u>cryptsetup</u> <u>--help</u> output.

           A PBKDF is used for increasing dictionary and brute-force attack cost for keyslot passwords. The
           parameters can be time, memory and parallel cost.

           For PBKDF2, only time cost (number of iterations) applies. For Argon2i/id, there is also memory cost
           (memory required during the process of key derivation) and parallel cost (number of threads that run
           in parallel during the key derivation.

           Note that increasing memory cost also increases time, so the final parameter values are measured by a
           benchmark. The benchmark tries to find iteration time (<u>--iter-time</u>) with required memory cost
           <u>--pbkdf-memory</u>. If it is not possible, the memory cost is decreased as well. The parallel cost
           <u>--pbkdf-parallel</u> is constant and is checked against available CPU cores.

           You can see all PBKDF parameters for particular LUKS2 keyslot with <b><a href="../man8/cryptsetup-luksDump.8.html">cryptsetup-luksDump</a></b>(8) command.

           <b>NOTE:</b> If you do not want to use benchmark and want to specify all parameters directly, use
           <u>--pbkdf-force-iterations</u> with <u>--pbkdf-memory</u> and <u>--pbkdf-parallel</u>. This will override the values
           without benchmarking. Note it can cause extremely long unlocking time or cause out-of-memory
           conditions with unconditional process termination. Use only in specific cases, for example, if you
           know that the formatted device will be used on some small embedded system.

           <b>MINIMAL</b> <b>AND</b> <b>MAXIMAL</b> <b>PBKDF</b> <b>COSTS:</b> For <b>PBKDF2</b>, the minimum iteration count is 1000 and maximum is
           4294967295 (maximum for 32bit unsigned integer). Memory and parallel costs are unused for PBKDF2. For
           <b>Argon2i</b> and <b>Argon2id</b>, minimum iteration count (CPU cost) is 4 and maximum is 4294967295 (maximum for
           32bit unsigned integer). Minimum memory cost is 32 KiB and maximum is 4 GiB. (Limited by addressable
           memory on some CPU platforms.) If the memory cost parameter is benchmarked (not specified by a
           parameter) it is always in range from 64 MiB to 1 GiB. The parallel cost minimum is 1 and maximum 4
           (if enough CPUs cores are available, otherwise it is decreased).

       <b>--pbkdf-force-iterations</b> <b>&lt;num&gt;</b>
           Avoid PBKDF benchmark and set time cost (iterations) directly. It can be used for LUKS/LUKS2 device
           only. See <u>--pbkdf</u> option for more info.

       <b>--pbkdf-memory</b> <b>&lt;number&gt;</b>
           Set the memory cost for PBKDF (for Argon2i/id the number represents kilobytes). Note that it is
           maximal value, PBKDF benchmark or available physical memory can decrease it. This option is not
           available for PBKDF2.

       <b>--pbkdf-parallel</b> <b>&lt;number&gt;</b>
           Set the parallel cost for PBKDF (number of threads, up to 4). Note that it is maximal value, it is
           decreased automatically if CPU online count is lower. This option is not available for PBKDF2.

       <b>--timeout,</b> <b>-t</b> <b>&lt;number</b> <b>of</b> <b>seconds&gt;</b>
           The number of seconds to wait before timeout on passphrase input via terminal. It is relevant every
           time a passphrase is asked. It has no effect if used in conjunction with --key-file.

           This option is useful when the system should not stall if the user does not input a passphrase, e.g.
           during boot. The default is a value of 0 seconds, which means to wait forever.

       <b>--token-id</b>
           Specify what token to use when unlocking existing keyslot to get volume key.

       <b>--token-only</b>
           Use only LUKS2 tokens to unlock existing volume key.

           <b>NOTE</b>: To create a new keyslot using passphrase provided by a token use --new-token-id parameter.

       <b>--token-type</b> <u>type</u>
           Specify what token type (all <u>type</u> tokens) to use when unlocking existing keyslot to get volume key.

       <b>--type</b> <b>&lt;device-type&gt;</b>
           Specifies required device type, for more info read <u>BASIC</u> <u>ACTIONS</u> section in <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8).

       <b>--unbound</b>
           Creates new LUKS2 unbound keyslot.

       <b>--usage</b>
           Show short option help.

       <b>--verify-passphrase,</b> <b>-y</b>
           When interactively asking for a passphrase, ask for it twice and complain if both inputs do not
           match. Ignored on input from file or stdin.

       <b>--version,</b> <b>-V</b>
           Show the program version.

       <b>--volume-key-file,</b> <b>--master-key-file</b> <b>(OBSOLETE</b> <b>alias)</b>
           Use a volume key stored in a file. This allows adding a new keyslot without having to know passphrase
           to existing one. It may be also used when no keyslot is active.

           <b>WARNING:</b> If you create your own volume key, you need to make sure to do it right. Otherwise, you can
           end up with a low-entropy or otherwise partially predictable volume key which will compromise
           security.

       <b>--volume-key-keyring</b> <u>&lt;key</u> <u>description&gt;</u>
           Use a volume key stored in a keyring. This allows one to open <u>luks</u> and <u>plain</u> device types without
           giving a passphrase.

           For LUKS, the key and associated type has to be readable from userspace so that volume key digest may
           be verified in before activation. For devices in reencryption the option may be used twice to specify
           both old and new volume keys.

           For PLAIN type, the user must ensure that the key in the keyring is unchanged since activation.
           Otherwise, reloading the key can cause data corruption after an unexpected key change.

           The <u>&lt;key</u> <u>description&gt;</u> uses keyctl-compatible syntax. This can either be a numeric key ID or a string
           name in the format <u>%&lt;key</u> <u>type&gt;:&lt;key</u> <u>name&gt;</u>. See also <b>KEY</b> <b>IDENTIFIERS</b> section of <b><a href="../man1/keyctl.1.html">keyctl</a></b>(1). When no
           <u>%&lt;key</u> <u>type&gt;:</u> prefix is specified we assume the key type is <u>user</u> (default type).

</pre><h4><b>EXAMPLES</b></h4><pre>
       <b>NOTE</b>: When not specified otherwise interactive passphrase prompt is always default method.

       Add new keyslot using interactive passphrase prompt for both existing and new passphrase:

       <b>cryptsetup</b> <b>luksAddKey</b> <b>/dev/device</b>

       Add new keyslot using LUKS2 tokens to unlock existing keyslot with interactive passphrase prompt for new
       passphrase:

       <b>cryptsetup</b> <b>luksAddKey</b> <b>--token-only</b> <b>/dev/device</b>

       Add new keyslot using LUKS2 systemd-tpm2 tokens to unlock existing keyslot with interactive passphrase
       prompt for new passphrase (systemd-tpm2 token plugin must be available):

       <b>cryptsetup</b> <b>luksAddKey</b> <b>--token-type</b> <b>systemd-tpm2</b> <b>/dev/device</b>

       Add new keyslot using interactive passphrase prompt for existing keyslot, reading new passphrase from
       key_file:

       <b>cryptsetup</b> <b>luksAddKey</b> <b>--new-keyfile</b> <b>key_file</b> <b>/dev/device</b> or <b>cryptsetup</b> <b>luksAddKey</b> <b>/dev/device</b> <b>key_file</b>

       Add new keyslot using volume stored in volume_key_file and LUKS2 token in slot 5 to get new keyslot
       passphrase (token in slot 5 must exist and respective token plugin must be available):

       <b>cryptsetup</b> <b>luksAddKey</b> <b>--volume-key-file</b> <b>volume_key_file</b> <b>--new-token-id</b> <b>5</b> <b>/dev/device</b>

</pre><h4><b>REPORTING</b> <b>BUGS</b></h4><pre>
       Report bugs at <b>cryptsetup</b> <b>mailing</b> <b>list</b> &lt;<a href="mailto:cryptsetup@lists.linux.dev">cryptsetup@lists.linux.dev</a>&gt; or in <b>Issues</b> <b>project</b> <b>section</b>
       &lt;https://gitlab.com/cryptsetup/cryptsetup/-/issues/new&gt;.

       Please attach output of the failed command with --debug option added.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>Cryptsetup</b> <b>FAQ</b> &lt;https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions&gt;

       <b><a href="../man8/cryptsetup.8.html">cryptsetup</a></b>(8), <b><a href="../man8/integritysetup.8.html">integritysetup</a></b>(8) and <b><a href="../man8/veritysetup.8.html">veritysetup</a></b>(8)

</pre><h4><b>CRYPTSETUP</b></h4><pre>
       Part of <b>cryptsetup</b> <b>project</b> &lt;https://gitlab.com/cryptsetup/cryptsetup/&gt;.

cryptsetup 2.8.0                                   2025-07-25                           <u><a href="../man8/CRYPTSETUP-LUKSADDKEY.8.html">CRYPTSETUP-LUKSADDKEY</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>