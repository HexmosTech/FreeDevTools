<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stap-server - systemtap compile server management</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/systemtap-server">systemtap-server_5.1-5_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       stap-server - systemtap compile server management

</pre><h4><b>SYNOPSIS</b></h4><pre>
       [  <b>service</b> ] <b>stap-server</b> { <b>start</b> | <b>stop</b> | <b>restart</b> | <b>condrestart</b> | <b>try-restart</b> | <b>force-reload</b> | <b>status</b> } [
       <u>options</u> ]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       A systemtap compile server listens for connections from stap clients on a secure  SSL  network  port  and
       accepts  requests to run the <u>stap</u> front end. Each server advertises its presence and configuration on the
       local network using mDNS (<u>avahi</u>) allowing for automatic detection by clients.

       The stap-server script aims to provide:

       •   management of systemtap compile servers as a service.

       •   convenient control over configured servers and individual (ad-hoc) servers.

</pre><h4><b>ARGUMENTS</b></h4><pre>
       One of the actions below must be specified:

       <b>start</b>  Start servers. The specified servers are started.  If  no  server  is  specified,  the  configured
              servers  are  started.  If  no  servers  are  configured,  a  server  for  the  kernel release and
              architecture of the host is started.  If a specified server is already started, this  action  will
              be ignored for that server. If a server fails to start, this action fails.

       <b>stop</b>   Stop  server(s).  The  specified  servers  are  stopped.  If no server is specified, all currently
              running servers are stopped.  If a specified server is not running, this action will be successful
              for that server. If a server fails to stop, this action fails.

       <b>restart</b>
              Stop and restart servers. The specified servers are  stopped  and  restarted.   If  no  server  is
              specified,  all  currently  running  servers are stopped and restarted. If no servers are running,
              this action behaves like <u>start</u>.

       <b>condrestart</b>
              Stop and restart servers. The specified servers are stopped and restarted.  If a specified  server
              is  not  running,  it is not started. If no server is specified, all currently running servers are
              stopped and restarted.  If no servers are running, none will be started.

       <b>try-restart</b>
              This action is identical to <u>condrestart</u>.

       <b>force-reload</b>
              Stop all running servers, reload config files and restart the service as if <u>start</u> was specified.

       <b>status</b> Print information about running  servers.  Information  about  the  specified  server(s)  will  be
              printed. If no server is specified, information about all running servers will be printed.

</pre><h4><b>OPTIONS</b></h4><pre>
       The following options are used to provide additional configuration and to specify servers to be managed:

       <b>-c</b> <u>configfile</u>
              This  option specifies a global configuration file in addition to the default global configuration
              file described below. This file will be processed after the default global configuration file.  If
              the <b>-c</b> option is specified more than once, the last configuration file specified will be used.

       <b>-a</b> <u>architecture</u>
              This  option  specifies the target architecture of the server and is analogous to the <b>-a</b> option of
              <u>stap</u>. See the <u><a href="../man1/stap.1.html">stap</a></u>(1) manual page for more details.  The default architecture is the  architecture
              of the host.

       <b>-r</b> <u>kernel-release</u>
              This  option  specifies a target kernel release of the server and is analogous to the <b>-r</b> option of
              <u>stap</u>.  See the <u><a href="../man1/stap.1.html">stap</a></u>(1) manual page for more details.  The default release is that of the currently
              running kernel.  A server can handle multiple releases by specifying multiple <b>-r</b> flags.

       <b>-I</b> <u>path</u>
              This option specifies an additional path to be searched  by  the  server(s)  for  tapsets  and  is
              analogous to the <b>-I</b> option of <u>stap</u>.  See the <u><a href="../man1/stap.1.html">stap</a></u>(1) manual page for more details.

       <b>-R</b> <u>path</u>
              This  option  specifies  the  location of the systemtap runtime to be used by the server(s) and is
              analogous to the <b>-R</b> option of <u>stap</u>.  See the <u><a href="../man1/stap.1.html">stap</a></u>(1) manual page for more details.

       <b>-B</b> <u>options</u>
              This option specifies options to be  passed  to  <u>make</u>  when  building  systemtap  modules  and  is
              analogous to the <b>-B</b> option of <u>stap</u>.  See the <u><a href="../man1/stap.1.html">stap</a></u>(1) manual page for more details.

       <b>-i</b>     This  option  is  a  shortcut  which  specifies  a  server that handles every release installed in
              <u><a href="file:/lib/modules/">/lib/modules/</a></u>.

       <b>-n</b> <u>nickname</u>
              This option allows the specification of a server configuration by nickname.  When <b>-n</b> is specified,
              a currently running server with the given nickname will be searched for. If no  currently  running
              server  with  the  given nickname is found, a server configuration with the given nickname will be
              searched for in the configuration files for default servers, or the path configured in the  global
              configuration file or the configuration file specified by the <b>-c</b> option. If a server configuration
              for  the  given  nickname  is found, the <b>-a</b>, <b>-r</b>, <b>-I</b>, <b>-R</b>, <b>-B</b> and <b>-u</b> options for that server will be
              used as if they were specified on the command line. If no configuration with the given nickname is
              found, and the action is <u>start</u> (or an action behaving like <u>start</u> (see <b>ARGUMENTS</b>), the server  will
              be started with the given nickname.  If no configuration with the given nickname is found, and the
              action  is  not  <u>start</u>  (or  an  action behaving like <u>start</u>), it is an error. If a nickname is not
              specified for a server which is being started, its nickname will be its process id.

       <b>-p</b> <u>pid</u> This option allows the specification of  a  server  configuration  by  process  id.   When  <b>-p</b>  is
              specified,  a  currently running server with the given process id will be searched for. If no such
              server is found, it is an error. If a server with the given process id is found, the <b>-a</b>,  <b>-r</b>,  <b>-I</b>,
              <b>-R</b>, <b>-B</b> and <b>-u</b> options for that server will be used as if they were specified on the command line.

       <b>-u</b> <u>user-name</u>
              Each systemtap compile server is normally run by the user name <u>stap-server</u> (for the initscript) or
              as  the  user invoking <u>stap-server</u>, unless otherwise configured (see <b>FILES</b>). This option specifies
              the user name used to run the server(s). The user name specified must be a  member  of  the  group
              <u>stap-server</u>.

       <b>--log</b> <u>logfile</u>
              This option allows the specification of a separate log file for each server.  Each --log option is
              added  to  a  list  which  will be applied, in turn, to each server specified. If more servers are
              specified than --log options, the default log  file  (see  <b>FILES</b>)  will  be  used  for  subsequent
              servers.

       <b>--port</b> <u>port-number</u>
              This  option  allows  the  specification  of  a specific network port for each server. Each --port
              option is added to a list which will be applied, in  turn,  to  each  server  specified.  If  more
              servers  are  specified  than  --port  options,  a  randomly  selected port is used for subsequent
              servers.

       <b>--ssl</b> <u>certificate-db-path</u>
              This option allows the specification of a separate NSS certificate database for each server.  Each
              --ssl  option is added to a list which will be applied, in turn, to each server specified. If more
              servers are specified than --ssl  options,  the  default  certificate  database  (see  <b>FILES</b>)  for
              subsequent servers.

       <b>--max-threads</b> <u>threads</u>
              This  option allows the specification of the maximum number of worker threads to handle concurrent
              requests. If <u>threads</u> == 0, each request will be handled on the main thread, serially.  The default
              is the number of available processor cores.

       <b>--max-request-size</b> <u>size</u>
              This options allows the specification of the maximum size of an uncompressed client  request.  The
              arguement <u>size</u> is specified in bytes. The default is the 50000 bytes.

       <b>--max-compressed-request</b> <u>size</u>
              This  options  allows  the  specification  of the maximum size of a compressed client request. The
              arguement <u>size</u> is specified in bytes. The default is the 5000 bytes.

</pre><h4><b>CONFIGURATION</b></h4><pre>
       Configuration files allow us to:

       •   specify global configuration of logging, server configuration files, status files  and  other  global
           parameters.

       •   specify which servers are to be started by default.

</pre><h4><b>Global</b> <b>Configuration</b></h4><pre>
       The  Global  Configuration  file contains variable assignments used to configure the overall operation of
       the service.  Each line beginning with a '#' character is ignored. All other lines must be  of  the  form
       <u>VARIABLE=VALUE</u>.  This is not a shell script. The entire contents of the line after the = will be assigned
       as-is to the variable.

       The following variables may be assigned:

       <b>CONFIG_PATH</b>
              Specifies the absolute path of the directory containing the default server configurations.

       <b>STAT_PATH</b>
              Specifies the absolute path of the running server status directory.

       <b>LOG_FILE</b>
              Specifies the absolute path of the log file.

       <b>STAP_USER</b>
              Specifies the userid which will be  used  to  run  the  server(s)  (default:  for  the  initscript
              <u>stap-server</u>, otherwise the user running <u>stap-server</u>).

       Here is an example of a Global Configuration file:

              CONFIG_PATH=~&lt;user&gt;/my-stap-server-configs
              LOG_FILE=/tmp/stap-server/log

</pre><h4><b>Individual</b> <b>Server</b> <b>Configuration</b></h4><pre>
       Each  server  configuration  file  configures  a server to be started when no server is specified for the
       <u>start</u> action, or an action behaving like the <u>start</u> action (see <u>ARGUMENTS</u>). Each configuration  file  con‐
       tains variable assignments used to configure an individual server.

       Each  line beginning with a '#' character is ignored. All other lines must be of the form <u>VARIABLE=VALUE</u>.
       This is not a shell script. The entire contents of the line after the = will be  assigned  as-is  to  the
       variable.

       Each  configuration  file must have a filename suffix of <u>.conf</u>. See <u><a href="../man7/stappaths.7.html">stappaths</a></u>(7) for the default location
       of these files.  This default location can be overridden in the global configuration file  using  the  <b>-c</b>
       option (see <u>OPTIONS</u>).

       The following variables may be assigned:

       <b>ARCH</b>   Specifies  the target architecture for this server and corresponds to the <b>-a</b> option (see <u>OPTIONS</u>).
              If <b>ARCH</b> is not set, the architecture of the host will be used.

       <b>RELEASE</b>
              Specifies a kernel release for this server and corresponds to the <b>-r</b> option (see <u>OPTIONS</u>). If  <b>RE‐</b>
              <b>LEASE</b> is not set, the release of the kernel running on the host will be used.

       <b>BUILD</b>  Specifies  options  to  be  passed  to the <u>make</u> process used by <u>systemtap</u> to build kernel modules.
              This an array variable with each element corresponding to a <b>-B</b> option  (see  <u>OPTIONS</u>).  Using  the
              form  <b>BUILD=STRING</b>  clears  the  array  and  sets  the  first  element  to  <b>STRING</b>. Using the form
              <b>BUILD+=STRING</b> adds <b>STRING</b> as an additional element to the array.

       <b>INCLUDE</b>
              Specifies a list of directories to be searched by the server for tapsets.  This is an array  vari‐
              able  with  each  element  corresponding to a <b>-I</b> option (see <u>OPTIONS</u>). Using the form <b>INCLUDE=PATH</b>
              clears the array and sets the first element to <b>PATH</b>. Using the form <b>INCLUDE+=PATH</b> adds <b>PATH</b> as  an
              additional element to the array.

       <b>RUNTIME</b>
              Specifies  the  directory  which contains the systemtap runtime code to be used by this server and
              corresponds to the <b>-R</b> option (see <u>OPTIONS</u>).

       <b>USER</b>   Specifies the user name to be used to run this server and corresponds to the <b>-u</b>  option  (see  <u>OP‐</u>
              <u>TIONS</u>).

       <b>NICKNAME</b>
              Specifies  the  nickname  to be used to refer to this server and corresponds to the <b>-n</b> option (see
              <u>OPTIONS</u>).

       <b>LOG</b>    Specifies the location of the log file to be used by this server and corresponds to the <b>--log</b>  op‐
              tion (see <u>OPTIONS</u>).

       <b>PORT</b>   Specifies the network port to be used by this server and corresponds to the <b>--port</b> option (see <u>OP‐</u>
              <u>TIONS</u>).

       <b>SSL</b>    Specifies  the  location of the NSS certificate database to be used by this server and corresponds
              to the <b>--ssl</b> option (see <u>OPTIONS</u>).

       <b>MAXTHREADS</b>
              Specifies the maximum number of worker threads to handle concurrent requests to be  used  by  this
              server and corresponds to the <b>--max-threads</b> option (see <u>OPTIONS</u>).

       <b>MAXREQSIZE</b>
              Specifies the maximum size of an uncompressed client request, to be used by this server and corre‐
              spnds to the  <b>--max-request-size</b> option (see <u>OPTIONS</u>).

       <b>MAXCOMPRESSEDREQ</b>
              Specifies the maximum size of an compressed client request, to be used by this server and corresp‐
              nds to the  <b>--max-compressed-request</b> option (see <u>OPTIONS</u>).

       Here is an example of a server configuration file:

              ARCH=
              USER=
              RELEASE=
              NICKNAME=native

       By  keeping  the  ARCH, USER, and RELEASE fields blank, they will default to the current arch and release
       and use the default user.

       A more specific example:

              ARCH=i386
              RELEASE=2.6.18-128.el5
              PORT=5001
              LOG=/path/to/log/file

       And here is a more complicated example:

              USER=serveruser
              RELEASE=/kernels/2.6.18-92.1.18.el5/build
              INCLUDE=/mytapsets
              INCLUDE+=/yourtapsets
              BUILD='VARIABLE1=VALUE1 VARIABLE2=VALUE2'
              DEFINE=STP_MAXMEMORY=1024
              DEFINE+=DEBUG_TRANS
              RUNTIME=/myruntime
              NICKNAME=my-server
              SSL=/path/to/NSS/certificate/database

</pre><h4><b>SERVER</b> <b>AUTHENTICATION</b></h4><pre>
       The security of the SSL network connection between the client and server depends on the proper management
       of server certificates.

       The trustworthiness of a given systemtap compile server can not be  determined  automatically  without  a
       trusted  certificate  authority  issuing  systemtap compile server certificates. This is not practical in
       everyday use and so, clients must authenticate servers against their own database of trusted server  cer‐
       tificates.  In  this  context, establishing a given server as trusted by a given client means adding that
       server's certificate to the client's database of trusted servers.

       For the <u>stap-server</u> initscript, on the local host, this  is  handled  automatically.   When  the  <u>system‐</u>
       <u>tap-server</u> package is installed, the server's certificate for the default user (<u>stap-server</u>) is automati‐
       cally  generated  and  installed. This means that servers started by the <u>stap-server</u> initscript, with the
       default user, are automatically trusted by clients on the local host, both as an SSL peer and as  a  sys‐
       temtap module signer.

       Furthermore,  when  stap is invoked by an unprivileged user (not root, not a member of the group stapdev,
       but a member of the group stapusr and possibly the group stapsys), the options <u>--use-server</u> and  <u>--privi‐</u>
       <u>lege</u>  are  automatically added to the specified options.  This means that unprivileged users on the local
       host can use a server on the local host in unprivileged mode with no further setup or  options  required.
       Normal users (those in none of the SystemTap groups) can also use compile-servers through the <u>--use-serv‐</u>
       <u>er</u>  and  <u>--privilege</u> options. But they will of course be unable to load the module (the <u>-p4</u> option can be
       used to stop short of loading).

       In order to use a server running on another host, that server's certificate  must  be  installed  on  the
       client's host.  See the <u>--trust-servers</u> option in the <u><a href="../man1/stap.1.html">stap</a></u>(1) manual page for more details and README.un‐
       privileged in the systemtap sources for more details.

</pre><h4><b>EXAMPLES</b></h4><pre>
       See the <u><a href="../man3stap/stapex.3stap.html">stapex</a></u>(3stap) manual page for a collection of sample <u>systemtap</u> scripts.

       To start the configured servers, or the default server, if none are configured:

        <b>$</b> <b>[</b> <b>service</b> <b>]</b> <b>stap-server</b> <b>start</b>

       To start a server that handles all kernel versions installed in <a href="file:/lib/modules">/lib/modules</a>:

        <b>$</b> <b>[</b> <b>service</b> <b>]</b> <b>stap-server</b> <b>start</b> <b>-i</b>

       To obtain information about the running server(s):

        <b>$</b> <b>[</b> <b>service</b> <b>]</b> <b>stap-server</b> <b>status</b>

       To  start  a server like another one, except targeting a different architecture, by referencing the first
       server's nickname:

        <b>$</b> <b>[</b> <b>service</b> <b>]</b> <b>stap-server</b> <b>start</b> <b>-n</b> <u>NICKNAME</u> <b>-a</b> <u>ARCH</u>

       To start a server for a kernel release not installed (cross-compiling)

        <b>$</b> <b>[</b> <b>service</b> <b>]</b> <b>stap-server</b> <b>start</b> <b>-a</b> <u>ARCH</u> <b>-r</b> <u>/BUILDDIR</u>

       To stop one of the servers by referencing its process id (obtained by running <b>stap-server</b> <b>status</b>):

        <b>$</b> <b>[</b> <b>service</b> <b>]</b> <b>stap-server</b> <b>stop</b> <b>-p</b> <u>PID</u>

       To run a script using a compile server:

        <b>$</b> <b>stap</b> <b>SCRIPT</b> <b>--use-server</b>

       To run a script as an unprivileged user using a compile server:

        <b>$</b> <b>stap</b> <b>SCRIPT</b>

       To stop all running servers:

        <b>$</b> <b>[</b> <b>service</b> <b>]</b> <b>stap-server</b> <b>stop</b>

       To restart servers after a global configuration change and/or  when  default  servers  have  been  added,
       changed, or removed:

        <b>$</b> <b>[</b> <b>service</b> <b>]</b> <b>stap-server</b> <b>force-reload</b>

</pre><h4><b>SAFETY</b> <b>AND</b> <b>SECURITY</b></h4><pre>
       Systemtap  is an administrative tool.  It exposes kernel internal data structures and potentially private
       user information.  See the <u><a href="../man1/stap.1.html">stap</a></u>(1) manual page for additional information on safety and security.

       As a network server, stap-server should be activated with care in order to limit the potential effects of
       bugs or mischevious users.  Consider the following prophylactic measures.

       1      Run stap-server as an unprivileged user, never as root.

              When invoked as a service (i.e. <b>service</b> <b>stap-server</b> ...), each server is run, by default,  as  the
              user  <u>stap-server</u>.   When invoked directly (i.e. <b>stap-server</b> ...), each server is run, by default,
              as the invoking user. In each case, another user may be selected by using the <u>-u</u> option on invoca‐
              tion, by  specifying  <u>STAP_USER=</u>username  in  the  global  configuration  file  or  by  specifying
              <u>USER=</u>username in an individual server configuration file. The invoking user must have authority to
              run processes as another user.  See <u>CONFIGURATION</u>.

              The  selected  user must have write access to the server log file.  The location of the server log
              file may be changed by setting <u>LOG_FILE=</u>path in the global configuration file.  See <u>CONFIGURATION</u>.

              The selected user must have read/write access to the directory containing the server status files.
              The location of the server status files may be changed by setting  <u>STAT_PATH=</u>path  in  the  global
              configuration file.  See <u>CONFIGURATION</u>.

              The selected user must have read/write access to the uprobes.ko build directory and its files.

              Neither form of stap-server will run if the selected user is root.

       2      Run stap-server requests with resource limits that impose maximum cpu time, file size, memory con‐
              sumption, in order to bound the effects of processing excessively large or bogus inputs.

              When  the user running the server is <u>stap-server</u>, each server request is run with limits specified
              in <u>~stap-server/.systemtap/rc</u> otherwise, no limits are imposed.

       3      Run stap-server with a TMPDIR environment variable that points to a separate and/or quota-enforced
              directory, in order to prevent filling up of important filesystems.

              The default TMPDIR is <u><a href="file:/tmp/">/tmp/</a></u>.

       4      Activate network firewalls to limit stap client connections to relatively trustworthy networks.

              For automatic selection of servers by clients, <u>avahi</u> must be installed  on  both  the  server  and
              client hosts and <u>mDNS</u> messages must be allowed through the firewall.

       The  systemtap  compile server and its related utilities use the Secure Socket Layer (SSL) as implemented
       by Network Security Services (NSS) for network security. NSS is also used for the generation and  manage‐
       ment  of certificates. The related certificate databases must be protected in order to maintain the secu‐
       rity of the system.  Use of the utilities provided will help to ensure  that  the  proper  protection  is
       maintained.  The  systemtap client will check for proper access permissions before making use of any cer‐
       tificate database.

</pre><h4><b>FILES</b></h4><pre>
       Important files and their corresponding paths can be located in the
              stappaths (7) manual page.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/stap.1.html">stap</a></u>(1),
       <u><a href="../man8/staprun.8.html">staprun</a></u>(8),
       <u><a href="../man3stap/stapprobes.3stap.html">stapprobes</a></u>(3stap),
       <u><a href="../man7/stappaths.7.html">stappaths</a></u>(7),
       <u><a href="../man3stap/stapex.3stap.html">stapex</a></u>(3stap),
       <u>avahi</u>,
       <u><a href="../man1/ulimit.1.html">ulimit</a></u>(1),
       <u>NSS</u>

</pre><h4><b>BUGS</b></h4><pre>
       Use the Bugzilla link of the project web page or  our  mailing  list.   <b><a href="http://sourceware.org/systemtap/">http://sourceware.org/systemtap/</a></b>,
       <b>&lt;<a href="mailto:systemtap@sourceware.org">systemtap@sourceware.org</a>&gt;</b>.

                                                                                                  <u><a href="../man8/STAP-SERVER.8.html">STAP-SERVER</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>