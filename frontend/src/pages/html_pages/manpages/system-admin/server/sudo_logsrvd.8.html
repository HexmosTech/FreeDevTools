<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sudo_logsrvd — sudo event and I/O log server</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/sudo">sudo_1.9.16p2-1ubuntu4_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       sudo_logsrvd — sudo event and I/O log server

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>sudo_logsrvd</b> [<b>-hnV</b>] [<b>-f</b> <u>file</u>] [<b>-R</b> <u>percentage</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>sudo_logsrvd</b>  is a high-performance log server that accepts event and I/O logs from <b>sudo</b>.  It can be used
       to implement centralized logging of <b>sudo</b> logs.  The server has two modes of operation: local  and  relay.
       By  default,  <b>sudo_logsrvd</b> stores the logs locally but it can also be configured to relay them to another
       server that supports the <u><a href="../man5/sudo_logsrv.proto.5.html">sudo_logsrv.proto</a></u>(5) protocol.

       When not relaying, event log entries may be logged either via <u><a href="../man3/syslog.3.html">syslog</a></u>(3) or to a  local  file.   I/O  Logs
       stored  locally  by  <b>sudo_logsrvd</b>  can  be replayed via the <u><a href="../man8/sudoreplay.8.html">sudoreplay</a></u>(8) utility in the same way as logs
       generated directly by the <b>sudoers</b> plugin.

       The server also supports restarting interrupted log transfers.  To distinguish completed  I/O  logs  from
       incomplete ones, the I/O log timing file is set to be read-only when the log is complete.

       Configuration  parameters  for <b>sudo_logsrvd</b> may be specified in the <u><a href="../man5/sudo_logsrvd.conf.5.html">sudo_logsrvd.conf</a></u>(5) file or the file
       specified via the <b>-f</b> option.

       <b>sudo_logsrvd</b> rereads its configuration file when it receives SIGHUP and writes server state to the  debug
       file (if one is configured) when it receives SIGUSR1.

       The options are as follows:

       <b>-f</b> <u>file</u>, <b>--file</b>=<u>file</u>
               Read configuration from <u>file</u> instead of the default, <u><a href="file:/etc/sudo_logsrvd.conf">/etc/sudo_logsrvd.conf</a></u>.

       <b>-h</b>, <b>--help</b>
               Display a short help message to the standard output and exit.

       <b>-n</b>, <b>--no-fork</b>
               Run <b>sudo_logsrvd</b> in the foreground instead of detaching from the terminal and becoming a daemon.

       <b>-R</b> <u>percentage</u>, <b>--random-drop</b>=<u>percentage</u>
               For each message, there is a <u>percentage</u> chance that the server will drop the connection.  This is
               only intended for debugging the ability of a client to restart a connection.

       <b>-V</b>, <b>--version</b>
               Print the <b>sudo_logsrvd</b> version and exit.

   <b>Securing</b> <b>server</b> <b>connections</b>
       The  I/O  log data sent to <b>sudo_logsrvd</b> may contain sensitive information such as passwords and should be
       secured using Transport Layer Security (TLS).  Doing so requires  having  a  signed  certificate  on  the
       server  and,  if  <u>tls_checkpeer</u> is enabled in <u><a href="../man5/sudo_logsrvd.conf.5.html">sudo_logsrvd.conf</a></u>(5), a signed certificate on the client as
       well.

       The certificates can either be signed by a well-known Certificate Authority (CA), or a private CA can  be
       used.  Instructions for creating a private CA are included below in the “EXAMPLES” section.

   <b>Debugging</b> <b>sudo_logsrvd</b>
       <b>sudo_logsrvd</b>  supports  a  flexible  debugging  framework  that  is  configured  via  <u>Debug</u>  lines in the
       <u><a href="../man5/sudo.conf.5.html">sudo.conf</a></u>(5) file.

       For more information on configuring <u><a href="../man5/sudo.conf.5.html">sudo.conf</a></u>(5), refer to its manual.

</pre><h4><b>FILES</b></h4><pre>
       <u><a href="file:/etc/sudo.conf">/etc/sudo.conf</a></u>            Sudo front-end configuration

       <u><a href="file:/etc/sudo_logsrvd.conf">/etc/sudo_logsrvd.conf</a></u>    Sudo log server configuration file

       <u>/var/log/sudo_logsrvd/incoming</u>
                                 Directory where new journals are stored when the <u>store_first</u> <u>relay</u>  setting  is
                                 enabled.

       <u>/var/log/sudo_logsrvd/outgoing</u>
                                 Directory  where  completed  journals  are  stored  when  the <u>store_first</u> <u>relay</u>
                                 setting is enabled.

       <u>/var/log/sudo-io</u>          Default I/O log file location

       <u>/run/sudo/sudo_logsrvd.pid</u>
                                 Process ID file for <b>sudo_logsrvd</b>

</pre><h4><b>EXAMPLES</b></h4><pre>
   <b>Creating</b> <b>self-signed</b> <b>certificates</b>
       Unless you are using certificates signed by a well-known Certificate Authority  (or  a  local  enterprise
       CA),  you  will  need  to  create  your  own  CA  that  can  sign  the certificates used by <b>sudo_logsrvd</b>,
       <b>sudo_sendlog</b>, and the <b>sudoers</b> plugin.  The following steps use the <u><a href="../man1/openssl.1.html">openssl</a></u>(1) command to create keys  and
       certificates.

   <b>Initial</b> <b>setup</b>
       First,  we  need  to  create  a  directory  structure  to store the files for the CA.  We'll create a new
       directory hierarchy in <u>/etc/ssl/sudo</u> for this purpose.

           # mkdir /etc/ssl/sudo
           # cd /etc/ssl/sudo
           # mkdir certs csr newcerts private
           # chmod 700 private
           # touch index.txt
           # echo 1000 &gt; serial

       The serial and index.txt files are used to keep track of signed certificates.

       Next, we need to make a copy of the openssl.conf file and customize it for  our  new  CA.   The  path  to
       openssl.cnf  is  system-dependent but <u><a href="file:/etc/ssl/openssl.cnf">/etc/ssl/openssl.cnf</a></u> is the most common location.  You will need to
       adjust the example below if it has a different location on your system.

           # cp <a href="file:/etc/ssl/openssl.cnf">/etc/ssl/openssl.cnf</a> .

       Now edit the <u>openssl.cnf</u> file in the current directory and make  sure  it  contains  “ca”,  “CA_default”,
       “v3_ca”, and “usr_cert” sections.  Those sections should include at least the following settings:

           [ ca ]
           default_ca              = CA_default

           [ CA_default ]
           dir                     = /etc/ssl/sudo
           certs                   = $dir/certs
           database                = $dir/index.txt
           certificate             = $dir/cacert.pem
           serial                  = $dir/serial

           [ v3_ca ]
           subjectKeyIdentifier    = hash
           authorityKeyIdentifier  = keyid:always,issuer
           basicConstraints        = critical,CA:true
           keyUsage                = cRLSign, keyCertSign

           [ usr_cert ]
           basicConstraints        = CA:FALSE
           keyUsage                = nonRepudiation, digitalSignature, \
                                     keyEncipherment
           subjectKeyIdentifier    = hash
           authorityKeyIdentifier  = keyid,issuer

       If  your  <u>openssl.conf</u>  file  already  has  a “CA_default” section, you may only need to modify the “dir”
       setting and enable the “keyUsage” settings if they are commented out.

   <b>Creating</b> <b>the</b> <b>CA</b> <b>key</b> <b>and</b> <b>certificate</b>
       In order to create and sign our own certificates, we need to create a private key and a  certificate  for
       the root of the CA.  First, create the private key and protect it with a pass phrase:

           # openssl genrsa -aes256 -out private/cakey.pem 4096
           # chmod 400 private/cakey.pem

       Next, generate the root certificate, using appropriate values for the site-specific fields:

           # openssl req -config openssl.cnf -key private/cakey.pem \
               -new -x509 -days 7300 -sha256 -extensions v3_ca \
               -out cacert.pem

           Enter pass phrase for private/cakey.pem:
           You are about to be asked to enter information that will be
           incorporated into your certificate request.
           What you are about to enter is what is called a Distinguished Name
           or a DN.
           There are quite a few fields but you can leave some blank.
           For some fields there will be a default value,
           If you enter '.', the field will be left blank.
           -----
           Country Name (2 letter code) [AU]:US
           State or Province Name (full name) [Some-State]:Colorado
           Locality Name (eg, city) []:
           Organization Name (eg, company) [Internet Widgets Pty Ltd]:sudo
           Organizational Unit Name (eg, section) []:sudo Certificate Authority
           Common Name (e.g., server FQDN or YOUR name) []:sudo Root CA
           Email Address []:

           # chmod 444 cacert.pem

       Finally, verify the root certificate:

           # openssl x509 -noout -text -in cacert.pem

   <b>Creating</b> <b>and</b> <b>signing</b> <b>certificates</b>
       The  server  and client certificates will be signed by the previously created root CA.  Usually, the root
       CA is not used to sign server/client  certificates  directly.   Instead,  intermediate  certificates  are
       created and signed with the root CA and the intermediate certs are used to sign CSRs (Certificate Signing
       Request).  In this example we'll skip this part for simplicity's sake and sign the CSRs with the root CA.

       First, generate the private key without a pass phrase.

           # openssl genrsa -out private/logsrvd_key.pem 2048
           # chmod 400 private/logsrvd_key.pem

       Next,  create  a  certificate  signing request (CSR) for the server's certificate.  The organization name
       must match the name given in the root certificate.  The common name should  be  either  the  server's  IP
       address or a fully qualified domain name.

           # openssl req -config openssl.cnf -key private/logsrvd_key.pem -new \
               -sha256 -out csr/logsrvd_csr.pem

           Enter pass phrase for private/logsrvd_key.pem:
           You are about to be asked to enter information that will be
           incorporated into your certificate request.
           What you are about to enter is what is called a Distinguished Name
           or a DN.
           There are quite a few fields but you can leave some blank.
           For some fields there will be a default value,
           If you enter '.', the field will be left blank.
           -----
           Country Name (2 letter code) [AU]:US
           State or Province Name (full name) [Some-State]:Colorado
           Locality Name (eg, city) []:
           Organization Name (eg, company) [Internet Widgets Pty Ltd]:sudo
           Organizational Unit Name (eg, section) []:sudo log server
           Common Name (e.g., server FQDN or YOUR name) []:logserver.example.com
           Email Address []:

           Please enter the following 'extra' attributes
           to be sent with your certificate request
           A challenge password []:
           An optional company name []:

       Now sign the CSR that was just created:

           # openssl ca -config openssl.cnf -days 375 -notext -md sha256 \
               -in csr/logsrvd_csr.pem -out certs/logsrvd_cert.pem

           Using configuration from openssl.cnf
           Enter pass phrase for ./private/cakey.pem:
           Check that the request matches the signature
           Signature ok
           Certificate Details:
                   Serial Number: 4096 (0x1000)
                   Validity
                       Not Before: Nov 11 14:05:05 2019 GMT
                       Not After : Nov 20 14:05:05 2020 GMT
                   Subject:
                       countryName               = US
                       stateOrProvinceName       = Colorado
                       organizationName          = sudo
                       organizationalUnitName    = sudo log server
                       commonName                = logserve.example.com
                   X509v3 extensions:
                       X509v3 Basic Constraints:
                           CA:FALSE
                       X509v3 Key Usage:
                           Digital Signature, Non Repudiation, Key Encipherment
                       X509v3 Subject Key Identifier:
                           4C:50:F9:D0:BE:1A:4C:B2:AC:90:76:56:C7:9E:16:AE:E6:9E:E5:B5
                       X509v3 Authority Key Identifier:
                           keyid:D7:91:24:16:B1:03:06:65:1A:7A:6E:CF:51:E9:5C:CB:7A:95:3E:0C

           Certificate is to be certified until Nov 20 14:05:05 2020 GMT (375 days)
           Sign the certificate? [y/n]:y

           1 out of 1 certificate requests certified, commit? [y/n]y
           Write out database with 1 new entries
           Data Base Updated

       Finally, verify the new certificate:

           # openssl verify -CAfile cacert.pem certs/logsrvd_cert.pem
           certs/logsrvd_cert.pem: OK

       The  <u>/etc/ssl/sudo/certs</u>  directory  now  contains  a  signed  and  verified  certificate  for  use  with
       <b>sudo_logsrvd</b>.

       To generate a client certificate, repeat the process above using a different file name.

   <b>Configuring</b> <b>sudo_logsrvd</b> <b>to</b> <b>use</b> <b>TLS</b>
       To use TLS for client/server  communication,  both  <b>sudo_logsrvd</b>  and  the  <b>sudoers</b>  plugin  need  to  be
       configured  to  use  TLS.  Configuring <b>sudo_logsrvd</b> for TLS requires the following settings, assuming the
       same path names used earlier:

           # Listen on port 30344 for TLS connections to any address.
           listen_address = *:30344(tls)

           # Path to the certificate authority bundle file in PEM format.
           tls_cacert = /etc/ssl/sudo/cacert.pem

           # Path to the server's certificate file in PEM format.
           tls_cert = /etc/ssl/sudo/certs/logsrvd_cert.pem

           # Path to the server's private key file in PEM format.
           tls_key = /etc/ssl/sudo/private/logsrvd_key.pem

       The root  CA  cert  (<u>cacert.pem</u>)  must  be  installed  on  the  system  running  <b>sudo_logsrvd</b>.   If  peer
       authentication is enabled on the client, a copy of <u>cacert.pem</u> must be present on the client system too.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man5/sudo.conf.5.html">sudo.conf</a></u>(5),   <u><a href="../man5/sudo_logsrv.proto.5.html">sudo_logsrv.proto</a></u>(5),   <u><a href="../man5/sudo_logsrvd.conf.5.html">sudo_logsrvd.conf</a></u>(5),   <u><a href="../man5/sudoers.5.html">sudoers</a></u>(5),   <u><a href="../man8/sudo.8.html">sudo</a></u>(8),   <u><a href="../man8/sudo_sendlog.8.html">sudo_sendlog</a></u>(8),
       <u><a href="../man8/sudoreplay.8.html">sudoreplay</a></u>(8)

</pre><h4><b>AUTHORS</b></h4><pre>
       Many people have worked on <b>sudo</b> over the years; this version consists of code written primarily by:

             Todd C. Miller

       See the CONTRIBUTORS.md file in the <b>sudo</b> distribution  (https://www.sudo.ws/about/contributors/)  for  an
       exhaustive list of people who have contributed to <b>sudo</b>.

</pre><h4><b>BUGS</b></h4><pre>
       If  you  believe  you  have found a bug in <b>sudo_logsrvd</b>, you can either file a bug report in the sudo bug
       database, https://bugzilla.sudo.ws/, or open an issue at https://github.com/sudo-project/sudo/issues.  If
       you  would  prefer  to  use  email,  messages  may  be   sent   to   the   sudo-workers   mailing   list,
       https://www.sudo.ws/mailman/listinfo/sudo-workers (public) or &lt;<a href="mailto:sudo@sudo.ws">sudo@sudo.ws</a>&gt; (private).

       Please  not  report  security  vulnerabilities  through  public GitHub issues, Bugzilla or mailing lists.
       Instead, report them via email to &lt;<a href="mailto:Todd.Miller@sudo.ws">Todd.Miller@sudo.ws</a>&gt;.  You may encrypt your message with  PGP  if  you
       would like, using the key found at https://www.sudo.ws/dist/PGPKEYS.

</pre><h4><b>SUPPORT</b></h4><pre>
       Limited     free     support     is     available     via    the    sudo-users    mailing    list,    see
       https://www.sudo.ws/mailman/listinfo/sudo-users to subscribe or search the archives.

</pre><h4><b>DISCLAIMER</b></h4><pre>
       <b>sudo_logsrvd</b> is provided “AS IS” and any express or implied warranties, including, but  not  limited  to,
       the  implied  warranties of merchantability and fitness for a particular purpose are disclaimed.  See the
       LICENSE.md file distributed with <b>sudo</b> or https://www.sudo.ws/about/license/ for complete details.

Sudo 1.9.16p2                                     July 14, 2024                                  <u><a href="../man8/SUDO_LOGSRVD.8.html">SUDO_LOGSRVD</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>