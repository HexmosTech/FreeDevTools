<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>amzfs-snapshot - Amanda script to create zfs snapshot</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/amanda-common">amanda-common_3.5.4-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       amzfs-snapshot - Amanda script to create zfs snapshot

</pre><h4><b>DESCRIPTION</b></h4><pre>
       amzfs-snapshot is an Amanda script implementing the Script API. It should not be run by users directly.
       It create a zfs snapshot of the filesystem where the path specified is mounted.

       PRE-DLE-* create a snapshot and the POST-DLE-* destroy the snapshot, *-DLE-AMCHECK, *-DLE-ESTIMATE and
       *-DLE-BACKUP must be set to be executed on the client:

           execute-on  pre-dle-amcheck, post-dle-amcheck, pre-dle-estimate, post-dle-estimate, pre-dle-backup, post-dle-backup
           execute-where client

       The PRE_DLE_* script output a DIRECTORY property telling where the directory is located in the snapshot.
       The application must be able to use the DIRECTORY property, amgtar can do it.

       The script is run as the amanda user, it must have the privilege to create and destroy snapshot:

           zfs allow -ldu AMANDA_USER mount,snapshot,destroy FILESYSTEM

       Some system doesn't have "zfs allow", but you can give the Amanda backup user the rights to manipulate
       ZFS filesystems by using the following command:

       usermod -P "ZFS File System Management,ZFS Storage Management" AMANDA_USER
       This will require that your run zfs under pfexec, set the PFEXEC property to YES.

       The format of the DLE must be one of:

       Desciption              Example
       ----------              -------
       Mountpoint              /data
       Arbitrary mounted dir   /data/interesting_dir
       ZFS pool name           datapool
       ZFS filesystem          datapool/database
       ZFS logical volume      datapool/dbvol

       The filesystem must be mounted.

</pre><h4><b>PROPERTIES</b></h4><pre>
       This section lists the properties that control amzfs-snapshot's functionality. See <b><a href="../man7/amanda-scripts.7.html">amanda-scripts</a></b>(7) for
       information on the Script API, script configuration.

       DF-PATH

           Path to the 'df' binary, search in $PATH by default.

       ZFS-PATH

           Path to the 'zfs' binary, search in $PATH by default.

       PFEXEC-PATH

           Path to the 'pfexec' binary, search in $PATH by default.

       PFEXEC

           If "NO" (the default), pfexec is not used, if set to "YES" then pfexec is used.

</pre><h4><b>EXAMPLE</b></h4><pre>
       In this example, a dumptype is defined to use amzfs-snapshot script to create a snapshot and use amgtar
       to backup the snapshot.
        define script-tool amzfs_snapshot {
          comment "backup of zfs snapshot"
          plugin  "amzfs-snapshot"
          execute-on  pre-dle-amcheck, post-dle-amcheck, pre-dle-estimate, post-dle-estimate, pre-dle-backup, post-dle-backup
          execute-where client
          #property "DF-PATH" "/usr/sbin/df"
          #property "ZFS-PATH" "/usr/sbin/zfs"
          #property "PFEXEC-PATH" "/usr/sbin/pfexec"
          #property "PFEXEC" "NO"
        }

        define dumptype user-zfs-amgtar {
          dt_amgtar
          script "amzfs_snapshot"
        }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/amanda.8.html">amanda</a></b>(8), <b><a href="../man5/amanda.conf.5.html">amanda.conf</a></b>(5), <b><a href="../man5/amanda-client.conf.5.html">amanda-client.conf</a></b>(5), <b><a href="../man7/amanda-scripts.7.html">amanda-scripts</a></b>(7)

       The Amanda Wiki: : <a href="http://wiki.zmanda.com/">http://wiki.zmanda.com/</a>

</pre><h4><b>AUTHORS</b></h4><pre>
       <b>Jean-Louis</b> <b>Martineau</b> &lt;<a href="mailto:martineau@zmanda.com">martineau@zmanda.com</a>&gt;
           Zmanda, Inc. (<a href="http://www.zmanda.com">http://www.zmanda.com</a>)

       <b>Dustin</b> <b>J.</b> <b>Mitchell</b> &lt;<a href="mailto:dustin@zmanda.com">dustin@zmanda.com</a>&gt;
           Zmanda, Inc. (<a href="http://www.zmanda.com">http://www.zmanda.com</a>)

Amanda 3.5.4                                       01/25/2025                                  <u><a href="../man8/AMZFS-SNAPSHOT.8.html">AMZFS-SNAPSHOT</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>