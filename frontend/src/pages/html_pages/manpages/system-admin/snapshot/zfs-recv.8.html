<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zfs-receive — create snapshot from backup stream</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/zfsutils-linux">zfsutils-linux_2.3.2-1ubuntu3_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       zfs-receive — create snapshot from backup stream

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>zfs</b> <b>receive</b> [<b>-FhMnsuv</b>] [<b>-o</b> <b>origin</b>=<u>snapshot</u>] [<b>-o</b> <u>property</u>=<u>value</u>] [<b>-x</b> <u>property</u>] <u>filesystem</u>|<u>volume</u>|<u>snapshot</u>
       <b>zfs</b> <b>receive</b> [<b>-FhMnsuv</b>] [<b>-d</b>|<b>-e</b>] [<b>-o</b> <b>origin</b>=<u>snapshot</u>] [<b>-o</b> <u>property</u>=<u>value</u>] [<b>-x</b> <u>property</u>] <u>filesystem</u>
       <b>zfs</b> <b>receive</b> <b>-A</b> <u>filesystem</u>|<u>volume</u>
       <b>zfs</b> <b>receive</b> <b>-c</b> [<b>-vn</b>] <u>filesystem</u>|<u>snapshot</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>zfs</b> <b>receive</b> [<b>-FhMnsuv</b>] [<b>-o</b> <b>origin</b>=<u>snapshot</u>] [<b>-o</b> <u>property</u>=<u>value</u>] [<b>-x</b> <u>property</u>] <u>filesystem</u>|<u>volume</u>|<u>snapshot</u>

       <b>zfs</b> <b>receive</b> [<b>-FhMnsuv</b>] [<b>-d</b>|<b>-e</b>] [<b>-o</b> <b>origin</b>=<u>snapshot</u>] [<b>-o</b> <u>property</u>=<u>value</u>] [<b>-x</b> <u>property</u>] <u>filesystem</u>
         Creates a snapshot whose contents are as specified in the stream provided on standard input.  If a full
         stream  is received, then a new file system is created as well.  Streams are created using the <b>zfs</b> <b>send</b>
         subcommand, which by default creates a full stream.  <b>zfs</b> <b>recv</b> can be used as an alias for <b>zfs</b> <b>receive</b>.

         If an incremental stream is received, then the destination file system must already exist, and its most
         recent snapshot must match the incremental stream's source.  For <b>zvols</b>, the destination device link  is
         destroyed and recreated, which means the <b>zvol</b> cannot be accessed during the <b>receive</b> operation.

         When  a  snapshot  replication  package  stream  that  is generated by using the <b>zfs</b> <b>send</b> <b>-R</b> command is
         received, any snapshots that do not exist on the sending  location  are  destroyed  by  using  the  <b>zfs</b>
         <b>destroy</b> <b>-d</b> command.

         The  ability  to  send and receive deduplicated send streams has been removed.  However, a deduplicated
         send stream created with older software can be converted to  a  regular  (non-deduplicated)  stream  by
         using the <b>zstream</b> <b>redup</b> command.

         If  <b>-o</b>  <u>property</u>=<u>value</u>  or  <b>-x</b> <u>property</u> is specified, it applies to the effective value of the property
         throughout the entire subtree of replicated datasets.  Effective property values will be  set  (<b>-o</b>)  or
         inherited  (<b>-x</b>)  on  the topmost in the replicated subtree.  In descendant datasets, if the property is
         set by the send stream, it will be overridden by forcing the property to be inherited from the top‐most
         file system.  Received properties are retained in spite of being overridden and may  be  restored  with
         <b>zfs</b> <b>inherit</b> <b>-S</b>.  Specifying <b>-o</b> <b>origin</b>=<u>snapshot</u> is a special case because, even if <b>origin</b> is a read-only
         property and cannot be set, it's allowed to receive the send stream as a clone of the given snapshot.

         Raw  encrypted  send  streams  (created with <b>zfs</b> <b>send</b> <b>-w</b>) may only be received as is, and cannot be re-
         encrypted, decrypted, or recompressed by the receive process.  Unencrypted streams can be  received  as
         encrypted  datasets,  either  through  inheritance  or  by specifying encryption parameters with the <b>-o</b>
         options.  Note that the <b>keylocation</b> property cannot be overridden to <b>prompt</b> during a receive.  This  is
         because  the  receive process itself is already using the standard input for the send stream.  Instead,
         the property can be overridden after the receive completes.

         The added security provided by raw sends adds some restrictions to the send and receive  process.   ZFS
         will  not allow a mix of raw receives and non-raw receives.  Specifically, any raw incremental receives
         that are attempted after a non-raw receive will fail.  Non-raw receives do not  have  this  restriction
         and,  therefore,  are  always  possible.  Because of this, it is best practice to always use either raw
         sends for their security benefits or non-raw sends for their flexibility when  working  with  encrypted
         datasets, but not a combination.

         The  reason for this restriction stems from the inherent restrictions of the AEAD ciphers that ZFS uses
         to encrypt data.  When using ZFS native encryption, each block of data is encrypted against a  randomly
         generated number known as the "initialization vector" (IV), which is stored in the filesystem metadata.
         This  number  is required by the encryption algorithms whenever the data is to be decrypted.  Together,
         all of the IVs provided for all of the blocks in a given snapshot are collectively called an "IV  set".
         When  ZFS performs a raw send, the IV set is transferred from the source to the destination in the send
         stream.  When ZFS performs a non-raw send, the data is decrypted by the source system and  re-encrypted
         by  the destination system, creating a snapshot with effectively the same data, but a different IV set.
         In order for decryption to work after a raw send, ZFS must ensure that the IV  set  used  on  both  the
         source  and destination side match.  When an incremental raw receive is performed on top of an existing
         snapshot, ZFS will check to confirm that the "from" snapshot on both the source  and  destination  were
         using the same IV set, ensuring the new IV set is consistent.

         The  name  of the snapshot (and file system, if a full stream is received) that this subcommand creates
         depends on the argument type and the use of the <b>-d</b> or <b>-e</b> options.

         If the argument is a snapshot name, the specified <u>snapshot</u> is created.   If  the  argument  is  a  file
         system  or  volume  name,  a  snapshot  with  the  same name as the sent snapshot is created within the
         specified <u>filesystem</u> or <u>volume</u>.  If neither of the <b>-d</b> or <b>-e</b> options are specified, the provided  target
         snapshot name is used exactly as provided.

         The <b>-d</b> and <b>-e</b> options cause the file system name of the target snapshot to be determined by appending a
         portion of the sent snapshot's name to the specified target <u>filesystem</u>.  If the <b>-d</b> option is specified,
         all  but  the first element of the sent snapshot's file system path (usually the pool name) is used and
         any required intermediate file systems within the specified one are  created.   If  the  <b>-e</b>  option  is
         specified,  then  only  the  last element of the sent snapshot's file system name (i.e. the name of the
         source file system itself) is used as the target file system name.

         <b>-F</b>  Force a rollback of the file system to the most  recent  snapshot  before  performing  the  receive
             operation.   If receiving an incremental replication stream (for example, one generated by <b>zfs</b> <b>send</b>
             <b>-R</b> [<b>-i</b>|<b>-I</b>]), destroy snapshots and file systems that do not exist on the sending side.

         <b>-d</b>  Discard the first element of the sent snapshot's file system name, using the remaining elements  to
             determine  the  name  of  the target file system for the new snapshot as described in the paragraph
             above.

         <b>-e</b>  Discard all but the last element of the sent snapshot's file system name,  using  that  element  to
             determine  the  name  of  the target file system for the new snapshot as described in the paragraph
             above.

         <b>-h</b>  Skip the receive of holds.  There is no effect if holds are not sent.

         <b>-M</b>  Force an unmount of the file system while receiving a snapshot.  This option is  not  supported  on
             Linux.

         <b>-n</b>  Do not actually receive the stream.  This can be useful in conjunction with the <b>-v</b> option to verify
             the name the receive operation would use.

         <b>-o</b> <b>origin</b>=<u>snapshot</u>
             Forces  the  stream  to be received as a clone of the given snapshot.  If the stream is a full send
             stream, this will create the filesystem described by  the  stream  as  a  clone  of  the  specified
             snapshot.   Which  snapshot was specified will not affect the success or failure of the receive, as
             long as the snapshot does exist.  If the stream is an  incremental  send  stream,  all  the  normal
             verification will be performed.

         <b>-o</b> <u>property</u>=<u>value</u>
             Sets the specified property as if the command <b>zfs</b> <b>set</b> <u>property</u>=<u>value</u> was invoked immediately before
             the  receive.  When receiving a stream from <b>zfs</b> <b>send</b> <b>-R</b>, causes the property to be inherited by all
             descendant datasets, as through <b>zfs</b> <b>inherit</b> <u>property</u> was run on any descendant datasets  that  have
             this property set on the sending system.

             If the send stream was sent with <b>-c</b> then overriding the <b>compression</b> property will have no effect on
             received  data  but the <b>compression</b> property will be set.  To have the data recompressed on receive
             remove the <b>-c</b> flag from the send stream.

             Any editable property can be set at receive time.  Set-once properties bound to the received  data,
             such as <b>normalization</b> and <b>casesensitivity</b>, cannot be set at receive time even when the datasets are
             newly  created by <b>zfs</b> <b>receive</b>.  Additionally both settable properties <b>version</b> and <b>volsize</b> cannot be
             set at receive time.

             The <b>-o</b> option may be specified multiple times, for different properties.  An error results  if  the
             same property is specified in multiple <b>-o</b> or <b>-x</b> options.

             The <b>-o</b> option may also be used to override encryption properties upon initial receive.  This allows
             unencrypted  streams  to be received as encrypted datasets.  To cause the received dataset (or root
             dataset of a recursive stream) to be received as an encryption root, specify encryption  properties
             in the same manner as is required for <b>zfs</b> <b>create</b>.  For instance:
                   <b>#</b>   <b>zfs</b>  <b>send</b>  <u>tank/test@snap1</u>  |  <b>zfs</b>  <b>recv</b>  <b>-o</b>  <b>encryption</b>=<b>on</b>  <b>-o</b>  <b>keyformat</b>=<b>passphrase</b>  <b>-o</b>
                   <b>keylocation</b>=<u>file:///path/to/keyfile</u>

             Note that <b>-o</b> <b>keylocation</b>=<b>prompt</b> may not be specified here, since  the  standard  input  is  already
             being  utilized for the send stream.  Once the receive has completed, you can use <b>zfs</b> <b>set</b> to change
             this setting after the fact.  Similarly, you can  receive  a  dataset  as  an  encrypted  child  by
             specifying  <b>-x</b>  <b>encryption</b> to force the property to be inherited.  Overriding encryption properties
             (except for <b>keylocation</b>) is not possible with raw send streams.

         <b>-s</b>  If the receive is interrupted,  save  the  partially  received  state,  rather  than  deleting  it.
             Interruption  may  be  due  to  premature termination of the stream (e.g. due to network failure or
             failure of the remote system if the stream is being read over a  network  connection),  a  checksum
             error in the stream, termination of the <b>zfs</b> <b>receive</b> process, or unclean shutdown of the system.

             The  receive  can  be  resumed with a stream generated by <b>zfs</b> <b>send</b> <b>-t</b> <u>token</u>, where the <u>token</u> is the
             value of the <b>receive_resume_token</b> property of the filesystem or volume which is received into.

             To use this flag,  the  storage  pool  must  have  the  <b>extensible_dataset</b>  feature  enabled.   See
             <u><a href="../man7/zpool-features.7.html">zpool-features</a></u>(7) for details on ZFS feature flags.

         <b>-u</b>  File system that is associated with the received stream is not mounted.

         <b>-v</b>  Print verbose information about the stream and the time required to perform the receive operation.

         <b>-x</b> <u>property</u>
             Ensures  that  the effective value of the specified property after the receive is unaffected by the
             value of that property in the send stream (if any), as if the property had been excluded  from  the
             send stream.

             If the specified property is not present in the send stream, this option does nothing.

             If  a  received  property  needs  to  be  overridden, the effective value will be set or inherited,
             depending on whether the property is inheritable or not.

             In the case of an incremental update, <b>-x</b> leaves any existing local setting or explicit  inheritance
             unchanged.

             All <b>-o</b> restrictions (e.g. set-once) apply equally to <b>-x</b>.

       <b>zfs</b> <b>receive</b> <b>-A</b> <u>filesystem</u>|<u>volume</u>
         Abort an interrupted <b>zfs</b> <b>receive</b> <b>-s</b>, deleting its saved partially received state.

       <b>zfs</b> <b>receive</b> <b>-c</b> [<b>-vn</b>] <u>filesystem</u>|<u>snapshot</u>
         Attempt  to repair data corruption in the specified dataset, by using the provided stream as the source
         of healthy data.  This method of healing can only heal data blocks present in the stream.  Metadata can
         not be healed by corrective receive.  Running a scrub is recommended post-healing to  ensure  all  data
         corruption was repaired.

         It's  important to consider why corruption has happened in the first place.  If you have slowly failing
         hardware - periodically repairing the data is not going to save you from data loss later  on  when  the
         hardware fails completely.

</pre><h4><b>EXAMPLES</b></h4><pre>
   <b>Example</b> <b>1</b>: Remotely Replicating ZFS Data
       The  following  commands send a full stream and then an incremental stream to a remote machine, restoring
       them into <u>poolB/received/fs@a</u> and <u>poolB/received/fs@b</u>, respectively.  <u>poolB</u> must contain the file  system
       <u>poolB/received</u>, and must not initially contain <u>poolB/received/fs</u>.
             # <b>zfs</b> <b>send</b> <u>pool/fs@a</u> |
                 <b>ssh</b> <u>host</u> <b>zfs</b> <b>receive</b> <u>poolB/received/fs</u>@<u>a</u>
             # <b>zfs</b> <b>send</b> <b>-i</b> <u>a</u> <u>pool/fs@b</u> |
                 <b>ssh</b> <u>host</u> <b>zfs</b> <b>receive</b> <u>poolB/received/fs</u>

   <b>Example</b> <b>2</b>: Using the <b>zfs</b> <b>receive</b> <b>-d</b> Option
       The  following  command  sends a full stream of <u>poolA/fsA/fsB@snap</u> to a remote machine, receiving it into
       <u>poolB/received/fsA/fsB@snap</u>.  The <u>fsA/fsB@snap</u> portion of the received snapshot's name is determined from
       the name of the sent snapshot.  <u>poolB</u> must contain the file system <u>poolB/received</u>.  If <u>poolB/received/fsA</u>
       does not exist, it is created as an empty file system.
             # <b>zfs</b> <b>send</b> <u>poolA/fsA/fsB@snap</u> |
                 <b>ssh</b> <u>host</u> <b>zfs</b> <b>receive</b> <b>-d</b> <u>poolB/received</u>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man8/zfs-send.8.html">zfs-send</a></u>(8), <u><a href="../man8/zstream.8.html">zstream</a></u>(8)

OpenZFS                                          March 12, 2023                                   <u><a href="../man8/ZFS-RECEIVE.8.html">ZFS-RECEIVE</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>