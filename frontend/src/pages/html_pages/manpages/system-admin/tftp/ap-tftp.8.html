<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ap-tftp - TFTP client for upgrading ATMEL AT76C510 WiSOC-based APs</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/jammy/+package/ap-utils">ap-utils_1.5-5_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ap-tftp - TFTP client for upgrading ATMEL AT76C510 WiSOC-based APs

       <b>Please</b> <b>read</b> <b>the</b> <b>entire</b> <b>manpage</b> <b>prior</b> <b>using</b> <b>this</b> <b>utility.</b> <b>It</b> <b>may</b> <b>prevent</b> <b>you</b> <b>from</b> <b>problems</b> <b>arising</b> <b>later.</b>

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>ap-tftp</b> <b>-i</b> <u>IP</u> <b>-f</b> <u>firmware.rom</u> <b>[-c</b> <u>community</u> <b>]</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>ap-tftp</b>  utility  is  used to upgrade or downgrade firmware in Access Points based on ATMEL AT76C510
       VNET-B WiSOC (Wireless System On Chip). It should work for most (if not all) models with  INTERSIL  radio
       chipset,  as  well as those based on RFMD radio. However, so far it has only been tested on the following
       hardware: WLink WEN-2021, i-Tec AP GOLD, smartBridges airPOINT PRO (all with INTERSIL radio), and  Tellus
       A14  (RFMD  radio).  If  you  have  an  AP with ATMEL AT76C510 and either INTERSIL or RFMD radio chipset,
       there's near 100% chance it will work for you, too.

</pre><h4><b>PREFACE:</b> <b>FIRMWARE</b> <b>TYPES</b></h4><pre>
       Functionally, there basically exist 2 types of firmware for ATMEL-based APs: an " <b>Access</b>  <b>Point</b>  firmware
       (often  referred  to  as <b>AP</b> <b>firmware</b> ), and <b>Wireless</b> <b>Adapter</b> firmware (referred to as <b>WA</b> <b>firmware</b> ). Many
       hardware vendors produce their own more or less modified firmware derivatives, but usually they  keep  up
       with the naming scheme introduced by ATMEL:

   <b>APs</b> <b>with</b> <b>INTERSIL</b> <b>radios</b>
       For APs with INTERSIL radios, the AP firmware file typically uses naming scheme such as "1.4x.y.rom" (for
       example  "1.4j.1.rom",  "1.4k.2.rom", etc.), while the WA firmware files typically exist under names such
       as "0.01.ab.rom" (for example "0.01.09.rom", "0.01.11.rom", etc.). The values "x", "y", and "ab" indicate
       the firmware revision.

   <b>APs</b> <b>with</b> <b>RFMD</b> <b>radios</b>
       For APs with RFMD radios, the AP firmware files are  known  under  names  like  "0.2.x.yz.rom"  (such  as
       "0.2.2.11.rom",  "0.2.2.18.rom",  etc.),  while  the WA firmware uses names as "0.3.b.c.rom" (for example
       "0.3.2.5.rom", "0.3.2.6.rom"), or "0.4.b.c.rom" for WA+ firmware (which is a variant of WA firmware  that
       offers limited multiple MACs transparency in client mode) - for example "0.4.2.7.rom". Again, the numbers
       change according to the firmware revision.

       To  descend  in  even  greater  complexity, there usually exist 2 files for each firmware revision in the
       ATMEL+RFMD world: one so-called <b>primary</b> <b>firmware</b> (the bigger file of the two; it contains  base  firmware
       as well as the embedded webserver), and a second file with so-called <b>backup</b> <b>firmware</b> (the smaller file of
       the  two,  it  contains  just  the base firmware).  The name of secondary firmware always uses '0' in the
       third number field (such as "0.2.0.18.rom").  <b>You'll</b> <b>always</b> <b>need</b> <b>to</b> <b>upgrade</b> <b>with</b> <b>backup</b>  <b>firmware</b>  <b>FIRST,</b>
       <b>unless</b> <b>its</b> <b>manufacturer</b> <b>states</b> <b>otherwise.</b>

              <b>WARNING!!!</b> <b>WARNING!!!</b> <b>WARNING!!!</b> <b>WARNING!!!</b> <b>WARNING!!!</b>

           o  <b>WA</b> <b>firmwares</b> and their derivatives <b>ARE</b> <b>_NOT_</b> <b>SUPPORTED</b> by ap-utils!!! They may appear to partially
              work  with ap-utils, but you can cause harm to your AP if you use ap-config with such firmware. Do
              not complain if you use ap-config with such firmware and it damages your AP!

           o  Since some hardware vendors keep up the bad habit of  producing  their  own  firmwares  using  the
              original  ATMEL  firmware  naming  scheme,  it  is  easy to find firmwares from different hardware
              vendors for ATMEL-based APs with <b>exactly</b> <b>the</b> <b>same</b> <b>name</b> <b>and</b> <b>sometimes</b> <b>even</b> <b>the</b> <b>length</b> (for example,
              firmware "1.4j.1.rom" exists in many incarnations,  but  their  content  differs).  They  may  use
              different  structures  and  offsets  for  reading  configuration  data in the flash memory without
              content validity checks, so <b>NEVER</b> <b>EVER</b> <b>USE</b> <b>FIRMWARE</b> <b>FROM</b> <b>ANOTHER</b> <b>HARDWARE</b> <b>VENDOR</b> <b>THAN</b> <b>THE</b> <b>ONE</b> <b>THAT</b>
              <b>IS</b> <b>MANUFACTURING</b> <b>YOUR</b> <b>AP,</b> <b>UNLESS</b> <b>EXPLICITLY</b> <b>STATED</b> <b>OTHERWISE!</b> <b>IF</b> <b>YOU</b> <b>DO</b> <b>SO,</b> <b>YOU</b>  <b>MAY</b>  <b>IRREVERSIBLY</b>
              <b>DAMAGE</b> <b>YOUR</b> <b>AP!</b>

           o  BEWARE! AP boards from several vendors may contain hardware design bugs, that will totally prevent
              it  from  successfull upgrade.  <b>Any</b> <b>attempt</b> <b>to</b> <b>upgrade</b> <b>such</b> <b>device,</b> <b>either</b> <b>via</b> <b>TFTP</b> <b>or</b> <b>DFU</b> <b>utility</b>
              <b>will</b> <b>fail</b> <b>and</b> <b>irreversibly</b> <b>damage</b> <b>content</b> <b>of</b> <b>its</b> <b>flash</b> <b>memory!</b> <b>If</b> <b>your</b> <b>vendor</b> <b>does</b> <b>NOT</b> <b>provide</b> <b>ANY</b>
              <b>firmware</b> <b>nor</b> <b>tools</b> <b>to</b> <b>perform</b> <b>upgrade</b> <b>for</b> <b>your</b> <b>device,</b> <b>it</b> <b>means</b> <b>(unless</b> <b>stated</b> <b>otherwise),</b> <b>that</b> <b>IT</b>
              <b>IS</b> <b>UNSAFE</b> <b>TO</b> <b>TRY</b> <b>UPGRADING</b> <b>and</b> <b>YOU</b> <b>SHOULD</b> <b>NOT</b> <b>ATTEMPT</b> <b>TO</b> <b>UPGRADE</b> <b>YOUR</b> <b>DEVICE</b> <b>AT</b> <b>ALL!</b>   Example  of
              such board with bug in hardware design is Tellus A13 (also sold as i-Tec AP GOLD with blue front).

           o  ATMEL  AT76C510-based  APs  are notoriously known for their firmware upgrade design flaw: firmware
              validation checks and subsequent permission for upgrade are not performed by the AP itself, but in
              the TFTP upgrade client. This means that anyone with proper TFTP client, having access to your  AP
              via  its ethernet port, may _try_ to upload incorrect firmware (or even no-firmware file!) to your
              AP, causing irreversible damage to your AP. Hence:

              -  <b>SECURE</b> <b>YOUR</b> <b>AP</b> <b>ON</b> <b>IP</b> <b>(LAYER</b> <b>3)</b> <b>BASIS!</b> <b>SET</b> <b>UP</b> <b>YOUR</b> <b>AP</b> <b>(AND</b> <b>ITS</b> <b>WIRELESS</b> <b>CLIENTS)</b> <b>WITH</b> <b>IP</b> <b>FROM</b>  <b>A</b>
                 <b>DIFFERENT</b>  <b>IP</b> <b>SEGMENT</b> <b>THAN</b> <b>THE</b> <b>ONE</b> <b>IT</b> <b>IS</b> <b>PHYSICALLY</b> <b>ON.</b> <b>TO</b> <b>ACCESS</b> <b>AP</b> <b>ON</b> <b>SUCH</b> <b>DIFFERENT</b> <b>SEGMENT,</b>
                 <b>YOU</b> <b>MAY</b> <b>USE</b> <b>IP-ALIAS</b> <b>INTERFACE</b> <b>(on</b> <b>Linux).</b>

              -  <b>FOR</b> <b>APs</b> <b>IN</b> <b>Access</b> <b>Point</b> <b>client</b> <b>MODE,</b> <b>USE</b> <b>ap-config</b> <b>AND</b> <b>IN</b> <b>'Config</b> <b>-&gt;</b> <b>Bridge'</b> <b>MENU,</b>  <b>CHANGE</b>  <b>THE</b>
                 <b>VALUE</b>  <b>OF</b>  <b>'Configuration-enabled</b>  <b>port(s):'</b>  <b>TO</b> <b>'Wireless'.</b> <b>THIS</b> <b>WAY,</b> <b>USER</b> <b>BEHIND</b> <b>Access</b> <b>Point</b>
                 <b>client</b> <b>DEVICE</b> <b>WONT</b> <b>BE</b> <b>ABLE</b> <b>TO</b> <b>REACH</b> <b>ITS</b> <b>MANAGEMENT</b> <b>IP,</b> <b>AND</b> <b>SUBSEQUENTLY</b> <b>(S)HE</b> <b>WONT</b> <b>BE</b>  <b>ABLE</b>  <b>TO</b>
                 <b>CAUSE</b> <b>ANY</b> <b>DAMAGE</b> <b>WITH</b> <b>TFTP.</b>  Note that setting Conf.-enabled port to 'Wireless' may be risky if
                 you intend to reconfigure the device through Wireless media (bad values could be written to the
                 AP due to wireless media unreliability). You should choose what is of greater risk for you.

           o  <b>Users</b>  <b>of</b>  <b>ATMEL+INTERSIL</b>  <b>devices:</b>  If  your  AP  firmware vendor extensions are auto-detected as
              <b>SBRIDGES</b> by ap-config, it means that your AP uses firmware made by smartBridges PTE: you will need
              to pass extra '-c community' to ap-tftp in order to perform actual upgrade.  <b>BY</b> <b>ALL</b>  <b>MEANS,</b>  <b>AVOID</b>
              <b>UPGRADE</b>  <b>OF</b>  <b>DEVICE</b>  <b>THAT</b> <b>CONTAINS</b> <b>smartBridges</b> <b>FIRMWARE,</b> <b>with</b> <b>non-smartBridges</b> <b>FIRMWARE,</b> <b>AND</b> <b>VICE</b>
              <b>VERSA,</b> <b>even</b> <b>if</b> <b>the</b> <b>firmware</b> <b>names</b> <b>may</b> <b>look</b> <b>similar</b> <b>(see</b> <b>the</b> <b>warning</b> <b>above).</b>   Although  there  are
              checks  in  ap-tftp,  that  should  avoid  something  such,  be careful, and DO NOT TRY, UNDER ANY
              CIRCUMSTANCES, to circumvent this protection - if you do, you'd most likely end  up  with  damaged
              flash content in your device. You got the warning.

           Remember: All firmware files with revision "1.4j.4" onwards are from smartBridges: unless you possess
           a device that is autodetected with 'SBRIDGES' vendor extension, DO NOT TRY TO UPGRADE TO smartBridges
           FIRMWARE!

           o  <b>Users</b> <b>of</b> <b>ATMEL+RFMD</b> <b>devices:</b> If you are running <b>primary</b> firmware &lt; 0.2.2.20, you <b>should</b> <b>upgrade</b> <b>as</b>
              <b>soon</b>  <b>as</b>  <b>possible!</b>  <b>AP</b>  firmware  of  version  0.2.2.19  and  lower  contains  serious  'death by
              reconfiguration' bug, which, if triggered, may irreversibly damage content in flash memory of your
              AP. The event to trigger is usually changing &amp; writing some settings in the 'Bridge' menu.  So  if
              you  run  such  firmware,  please  upgrade. You may also look into README to see whether 'Firmware
              available free of charge for ATMEL12350 MIB devices' (section) applies to your AP.

              <b>GENERAL</b> <b>HINTS</b> <b>AND</b> <b>RECOMMENDATIONS</b> <b>PRIOR</b> <b>UPGRADING</b>

           -  IF POSSIBLE, PLACE YOUR AP BEHIND A FIREWALL SO THAT YOU PREVENT ACCESS TO ITS MANAGEMENT  IP  FOR
              UNWANTED THIRD PARTIES

           -  Avoid  upgrading  your  AP  via  its  wireless  port, if possible. Due to the unreliable nature of
              wireless media and UDP protocol used for upgrade, anything could happen - although there  is  CRC-
              like  check  in  the  firmware,  that  prevents flashing of (firmware) file that has possibly been
              altered during transmission, upgrade process interruption might cause damage (but even this is not
              very likely). You may upgrade AP via its wireless port only  if  you're  101%  sure  the  wireless
              connection to the target device is reliable.

           -  If  you  experience  upgrade  timeout in the 'middle' of the upgrade progress, it is usually ok to
              wait until the utility completely times out, and repeat  the  command  afterwards.  You  may  also
              experience 'catch up' (very short network break, so utility will resume uploading firmware to your
              AP).

           -  In  case  when firmware upgrade fails, <b>ap-tftp</b> will show an error code returned by the TFTP server
              in AP. Note that although RFC 1350 defines 8 TFTP error messages, the TFTP server in the AP is not
              compliant to this RFC and the error codes returned may NOT correspond to those messages  (but  ap-
              tftp  will  always  display  corresponding RFC-defined error message, if possible, although it may
              really have nothing to do with the returned error code meaning). In the case the message for error
              code returned is not defined in RFC 1350, just the error code alone will be displayed.

           -  If you want to upgrade firmware in an AP on a network where no DHCP server  is  available,  it  is
              advisable  to  assign  static  IP  address  and disable DHCP option on the device, so that you can
              verify, whether it  is  alive,  using  'ping'  command  immediately  after  the  upgrade  succeeds
              (generally  immediately  after the device boots up), and you dont have to wait until AP's attempts
              to contact DHCP server time out. This is also especially useful if you need to do  2-step  upgrade
              (using 'backup' and 'primary' firmware) - see above.

           -  Firmware  of  APs  based  on  ATMEL AT76C510 provides an interresting 'arp ping' feature. After AP
              boot-up, it is possible to remotely and  TEMPORARILY  (to  next  AP  reboot)  reconfigure  its  IP
              address,  provided that within certain time period (several tens of seconds after boot-up), the AP
              receives ICMP ECHO request with target MAC address equal to its own. To set up IP in the AP  using
              this method, do the following:

              1.  From  the  IP  range  your  AP is connected to, pick up an unused IP you want to set on the AP
                  using 'arp ping'.

              2.  Set up static ARP entry associating the MAC address of your AP with the  IP  you  selected  in
                  paragraph  1.  Typically,  you  need to issue (as root) something like: 'arp -s required_AP_IP
                  AP_MAC'. Consult manpage for 'arp' utility, if your 'arp' utility uses different syntax.

              3.  Right after the AP boots, run 'ping required_AP_IP'. You need to wait few seconds prior seeing
                  first AP response.

           -  <b>Users</b> <b>of</b> <b>ATMEL+RFMD</b> <b>devices:</b> To <b>DOWNGRADE</b> to <b>AP</b> firmware with lower revision number than  the  one
              thats  currently  in the device, you'll need to temporarily 'upgrade' to any <b>WA</b> firmware available
              for your device (as step-in-the-middle).  This  will  'unlock'  your  device  for  downgrading  to
              previous <b>AP</b> firmware version.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-i</b> <b>IP</b>  IP address of the AP you want upgrade firmware in.

       <b>-f</b> <b>firmware.rom</b>
              Full path to and name of the firmware file for your AP.

       <b>-c</b> <b>community</b>
              To be used ONLY with APs manufactured by smartBridges PTE. The given community must match with any
              of  three  three  communities currently defined in the AP configuration - firmware upgrade will be
              allowed only upon the match.  matches

</pre><h4><b>EXAMPLES</b> <b>OF</b> <b>USE</b></h4><pre>
   <b>Upgrading</b> <b>AP</b> <b>firmware</b> <b>in</b> <b>a</b> <b>device</b> <b>with</b> <b>INTERSIL</b> <b>radio</b> <b>and</b> <b>non-smartBridges</b> <b>firmware</b>
       ap-tftp -i 192.168.0.1 -f 1.4j.3.rom

   <b>Upgrading</b> <b>AP</b> <b>firmware</b> <b>in</b> <b>a</b> <b>device</b> <b>with</b> <b>INTERSIL</b> <b>radio</b> <b>and</b> <b>smartBridges</b> <b>firmware</b>
       ap-tftp -i 192.168.0.24 -f 1.4k.5.rom -c private

   <b>Upgrading</b> <b>AP</b> <b>firmware</b> <b>in</b> <b>a</b> <b>device</b> <b>with</b> <b>RFMD</b> <b>radio:</b>
       ap-tftp -i 192.168.1.100 -f 0.2.0.20.rom
       ap-tftp -i 192.168.1.100 -f 0.2.2.20.rom

   <b>Downgrading</b> <b>AP</b> <b>firmware</b> <b>in</b> <b>a</b> <b>device</b> <b>with</b> <b>RFMD</b> <b>radio:</b>
       ap-tftp -i 192.168.1.100 -f 0.3.0.6.rom
       ap-tftp -i 192.168.1.100 -f 0.3.2.6.rom
       ap-tftp -i 192.168.1.100 -f 0.2.0.19.rom
       ap-tftp -i 192.168.1.100 -f 0.2.2.19.rom

</pre><h4><b>KNOWN</b> <b>BUGS</b></h4><pre>
       This utility has not been verified on and will probably not work on big-endian architectures. Its use  is
       discouraged in such environment.

</pre><h4><b>AUTHOR</b></h4><pre>
       Jan Rafaj &lt;jr-aputils at cedric dot unob dot cz&gt;
       <a href="http://ap-utils.polesye.net">http://ap-utils.polesye.net</a>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/ap-config.8.html">ap-config</a>(8), <a href="../man8/ap-trapd.8.html">ap-trapd</a>(8), <a href="../man8/ap-auth.8.html">ap-auth</a>(8), <a href="../man8/ap-mrtg.8.html">ap-mrtg</a>(8)

                                     Wireless Access Point Utilites for Unix                          <u><a href="../man8/ap-tftp.8.html">ap-tftp</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>