<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mon - monitor services for availability, sending alarms upon failures.</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/mon">mon_1.4.1-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mon - monitor services for availability, sending alarms upon failures.

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>mon</b>  [<b>-dfhlMSv</b>]  [<b>-a</b>  <u>dir</u>]  [<b>-A</b>  <u>authfile</u>]  [<b>-b</b> <u>dir</u>] [<b>-B</b> <u>dir</u>] [<b>-c</b> <u>config</u>] [<b>-D</b> <u>dir</u>] [<b>-i</b> <u>secs</u>] [<b>-k</b> <u>num</u>] [<b>-l</b>
       <u>[</u>statetype<u>]</u>] [<b>-L</b> <u>dir</u>] [<b>-m</b> <u>num</u>] [<b>-p</b> <u>num</u>] [<b>-P</b> <u>pidfile</u>] [<b>-r</b> <u>delay</u>] [<b>-s</b> <u>dir</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>mon</b> is a general-purpose scheduler  for  monitoring  service  availability  and  triggering  alerts  upon
       detecting  failures.   <b>mon</b>  was  designed  to  be open in the sense that it supports arbitrary monitoring
       facilities and alert methods via a common interface, which are easily implemented through programs (in C,
       Perl, shell, etc.), SNMP traps, and special Mon (UDP packet) traps.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-a</b> <u>dir</u> Path to alert scripts. Default is <u>/usr/local/lib/mon/alert.d:alert.d</u>.  Multiple alert paths may be
              specified by separating them with a colon.  Non-absolute paths are taken to  be  relative  to  the
              base directory (<u>/usr/lib/mon</u> by default).

       <b>-b</b> <u>dir</u> Base  directory  for  mon.  scriptdir,  alertdir,  and statedir are all relative to this directory
              unless specified from <a href="file:/.">/.</a>  Default is <u>/usr/lib/mon</u>.

       <b>-B</b> <u>dir</u> Configuration  file  base  directory.  All  config  files  are  located  here,  including  mon.cf,
              monusers.cf, and auth.cf.

       <b>-A</b> <u>authfile</u>
              Authentication  configuration  file. By default this is <u>/etc/mon/auth.cf</u> if the <u>/etc/mon</u> directory
              exists, or <u>/usr/lib/mon/auth.cf</u> otherwise.

       <b>-c</b> <u>file</u>
              Read configuration from <u>file</u>.  This defaults to IR /etc/mon/mon.cf " if the "  /etc/mon  directory
              exists, otherwise to <u>/etc/mon.cf</u>.

       <b>-d</b>     Enable debugging mode.

       <b>-D</b> <b>dir</b> Path   to   state   directory.    Default  is  the  first  of  <u>/var/state/mon</u>,  <u>/var/lib/mon</u>,  and
              <u>/usr/lib/mon/state.d</u> which exists.

       <b>-f</b>     Fork and run as a daemon process. This is the preferred way to run <b>mon</b>.

       <b>-i</b> <u>secs</u>
              Sleep interval, in seconds. Defaults to 1. This shouldn't need to be adjusted for any reason.

       <b>-k</b> <u>num</u> Set log history to a maximum of <u>num</u> entries. Defaults to 100.

       <b>-l</b> <b>statetype</b>
              Load state from the last saved state file. The  supported  saved  state  types  are  <b>disabled</b>  for
              disabled  watches, services, and hosts, <b>opstatus</b> for failure/alert/ack status of all services, and
              <b>all</b> for both.  If no statetype is provided, <b>disabled</b> is assumed.

       <b>-L</b> <b>dir</b> Sets the log dir. See also <b>logdir</b> in the configuration file.  The default is <b>/var/log/mon</b> if  that
              directory exists, otherwise <b>log.d</b> in the base directory.

       <b>-M</b>     Pre-process the configuration file with the macro expansion package <u>m4</u>.

       <b>-m</b> <u>num</u> Set the throttle for the maximum number of processes to <u>num</u>.

       <b>-p</b> <u>num</u> Make server listen on port <u>num</u>.  This defaults to 2583.

       <b>-S</b>     Start with the scheduler stopped.

       <b>-P</b> <u>pidfile</u>
              Store the server's pid in <u>pidfile</u>, the default is the first of <u>/run/mon/mon.pid</u>, <u>/run/mon.pid</u>, and
              <u>/etc/mon.pid</u> whose directory exists.  An empty value tells <b>mon</b> not to use a pid file.

       <b>-r</b> <u>delay</u>
              Sets  the  number of seconds used to randomize the startup delay before each service is scheduled.
              Refer to the global <u>randstart</u> variable in the configuration file.

       <b>-s</b> <u>dir</u> Path to monitor scripts. Default is <u>/usr/local/lib/mon/mon.d:mon.d</u>.  Multiple alert paths  may  be
              specified  by  separating  them  with a colon.  Non-absolute paths are taken to be relative to the
              base directory (<u>/usr/lib/mon</u> by default).

       <b>-v</b>     Print version information.

       <b>-h</b>     Print help information.

</pre><h4><b>DEFINITIONS</b></h4><pre>
       <b>monitor</b>
              A program which tests for a certain condition,  returns  either  true  or  false,  and  optionally
              produces  output to be passed back to the scheduler.  Common monitors detect host reachability via
              ICMP echo messages, or connection to TCP services.

       <b>period</b> A period in time as interpreted by the Time::Period module.

       <b>alert</b>  A program which sends a message when invoked by the scheduler.  The scheduler calls upon an  alert
              when  it  detects  a  failure  from  a  monitor.   An  alert program accepts a set of command-line
              arguments from the scheduler, in addition to data via standard input.

       <b>hostgroup</b>
              A single host or list of hosts, specified as names or IP addresses.

       <b>service</b>
              A collection of parameters used to deal with monitoring a particular resource which is provided by
              a group. Services are usually modeled after things such as an SMTP server, ICMP  echo  capability,
              server disk space availability, or SNMP events.

       <b>view</b>   A  collection  of  hostgroups,  used  to  filter  mon output for client display.  i.e. a 'network-
              services' view might be defined so your network staff can see just the hostgroups which matter  to
              them, without having to see all hostgroups defined in Mon.

       <b>watch</b>  A collection of services which apply to a particular group.

</pre><h4><b>OPERATION</b></h4><pre>
       When  the  <b>mon</b>  scheduler  starts,  it  reads  a configuration file to determine the services it needs to
       monitor. The configuration file defaults to <u>/etc/mon.cf</u>, and can be specified using the <b>-c</b> parameter.  If
       the  <b>-M</b>  option is specified, then the configuration file is pre-processed with <u>m4</u>.  If the configuration
       file ends with .m4, the file is also processed by m4 automatically.

       The scheduler enters a loop which handles client connections, monitor invocations,  and  failure  alerts.
       Each  service  has a timer, specified in the configuration file as the <b>interval</b> variable, which tells the
       scheduler how frequently to invoke a monitor process.  The scheduler may be temporarily stopped. While it
       is stopped, client access still functions, but it  just  doesn't  schedule  things.  This  is  useful  in
       conjunction  while  resetting  the server, because you can do this: save the hosts and services which are
       disabled, reset the server with the scheduler stopped, re-disabled those hosts and services,  then  start
       the  scheduler.  It  also allows making atomic changes across several client connections.  See the <b>moncmd</b>
       man page for more information.

</pre><h4><b>MONITOR</b> <b>PROGRAMS</b></h4><pre>
       Monitor processes are invoked with the arguments specified in the configuration  file,  appended  by  the
       hosts  from  the  applicable  host group. For example, if the watch group is "servers", which contain the
       hostnames "smtp", "nntp", and "ns", and the monitor line reads as follows,
       monitor fping.monitor -t 4000 -r 2
       then the exectuable "fping.monitor" will be executed with these parameters:
       MONITOR_DIR/fping.monitor -t 4000 -r 2 smtp nntp ns

       MONITOR_DIR is actually a search path, by default <u>/usr/local/lib/mon/mon.d</u> then  <u>/usr/lib/mon/mon.d</u>,  but
       it  can  be overridden by the <b>-s</b> option or in the configuration file.  If all hosts in the hostgroup have
       been disabled, then a warning is sent to syslog and  the  monitor  is  not  run.  This  behavior  may  be
       overridden  with  the "allow_empty_group" option in the service definition.  If the final argument to the
       "monitor" line is ";;" (it must be preceded by whitespace), then the host list will not  be  appended  to
       the parameter list.

       In  addition  to  environment variables defined by the user in the service definition, <b>mon</b> passes certain
       variables to monitor process.

       <b>MON_LAST_SUMMARY</b>
              The first line of the output from the last time the monitor exited.  This is not  the  summary  of
              the  current  monitor  run,  but the previous one.  This may be used by an alert script to provide
              historical context in an alert.

       <b>MON_LAST_OUTPUT</b>
              The entire output of the monitor from the last time it exited.  This is  not  the  output  of  the
              current  monitor  run,  but  the  previous  one.   This  may be used by an alert script to provide
              historical context in an alert.

       <b>MON_LAST_FAILURE</b>
              The <a href="../man2/time.2.html">time</a>(2) of the last failure for this service.

       <b>MON_FIRST_FAILURE</b>
              The <a href="../man2/time.2.html">time</a>(2) of the first time this service failed.

       <b>MON_LAST_SUCCESS</b>
              The <a href="../man2/time.2.html">time</a>(2) of the last time this service passed.

       <b>MON_DESCRIPTION</b>
              The description of this service, as defined in the configuration file using the <u>description</u> tag.

       <b>MON_DEPEND_STATUS</b>
              The depend status, "o" if dependency failure, "1" otherwise.

       <b>MON_LOGDIR</b>
              The directory log files should  be  placed,  as  indicated  by  the  <u>logdir</u>  global  configuration
              variable.

       <b>MON_STATEDIR</b>
              The  directory where state files should be kept, as indicated by the <u>statedir</u> global configuration
              variable.

       <b>MON_CFBASEDIR</b>
              The directory where configuration files should be kept,  as  indicated  by  the  <u>cfbasedir</u>  global
              configuration variable.

       "fping.monitor"  should  return  an exit status of 0 if it completed successfully (found no problems), or
       nonzero if a problem was detected. The first line of  output  from  the  monitor  script  has  a  special
       meaning:  it  is  used  as  a brief summary of the exact failure which was detected, and is passed to the
       alert program. All remaining output is also  passed  to  the  alert  program,  but  it  has  no  required
       interpretation.

       If a monitor for a particular service is still running, and the time comes for <b>mon</b> to run another monitor
       for that service, it will not start another monitor. For example, if the <u>interval</u> is 10s, and the monitor
       does  not  finish  running  within  10  seconds,  then <b>mon</b> will wait until the first monitor exits before
       running another one.

</pre><h4><b>ALERT</b> <b>DECISION</b> <b>LOGIC</b></h4><pre>
       Upon a non-zero or zero exit status, the associated alert or upalert program (respectively)  is  started,
       pending  the  following conditions: If an alert for a specific service is disabled, do not send an alert.
       If <b>dep_behavior</b> is set to <u>'a'</u>, or <b>alertdepend</b> is set, and a parent dependency is failing,  then  suppress
       the  alert.   If  the  alert  has  previously  been  acknowledged, do not send the alert, unless it is an
       upalert.  If an alert is not within the specified period, record the failure via  <a href="../man3/syslog.3.html">syslog</a>(3)  and  do  not
       send  an alert.  If the failure does not fall within a defined period, do not send an alert.  No upalerts
       are sent without corresponding down alerts, unless <b>no_comp_alerts</b> is defined in the  period  section.  An
       upalert  will  only  be sent if the previous state is a failure.  If an alert was already sent within the
       last <b>alertevery</b> interval, do not send another alert, <u>unless</u> the summary output from the  current  monitor
       program  differs from the last monitor process.  Otherwise, send an alert using each alert program listed
       for that period. The <b>observe_detail</b> argument to <b>alertevery</b> affects this behavior by observing the changes
       in the detail part of the output in addition to the summary line.  If a monitor has  successive  failures
       and the summary output changes in each of them, <b>alertevery</b> will not suppress multiple consecutive alerts.
       The  reasoning  is  that  if  the  summary output changes, then a significant event occurred and the user
       should be alerted.  The "strict" argument to alertevery will suppress both comparing the output from  the
       previous  monitor  run to the current and prevent a successful return value of the monitor from resetting
       the alertevery timer. For example, "alertevery 24h strict" will only send out  an  alert  once  every  24
       hours, regardless of whether the monitor output changes, or if the service stops and then starts failing.

</pre><h4><b>ALERT</b> <b>PROGRAMS</b></h4><pre>
       Alert programs are found in the path supplied with the <b>-a</b> parameter, or in the <u>/usr/local/lib/mon/alert.d</u>
       and directories if not specified.  They are invoked with the following command-line parameters:

       <b>-g</b> <u>group</u>
              Host group name from the configuration file.

       <b>-h</b> <u>hosts</u>
              The expanded version of the host group, space delimited, but contained in one shell "word".

       <b>-l</b> <u>alertevery</u>
              The number of seconds until the next alarm will be sent.

       <b>-O</b>     This  option   is   supplied   to  an alert only if the alert is being generated as a result of an
              expected traap timing out

       <b>-s</b> <u>service</u>
              Service tag from the configuration file.

       <b>-t</b> <u>time</u>
              The time (in <b><a href="../man2/time.2.html">time</a></b>(2) format) of when this failure condition was detected.

       <b>-T</b>     This option is supplied to an alert only if the alert was triggered by a trap

       <b>-u</b>     This option is supplied to an alert only if it is being called as an upalert.

       The remaining arguments are supplied from the trailing parameters in the configuration  file,  after  the
       "alert" service parameter.

       As  with  monitor  programs, alert programs are invoked with environment variables defined by the user in
       the service definition, in addition to the following which are explicitly set by the server:

       <b>MON_ALERTTYPE</b>
              Has one of the following  values:  "failure",  "up",  "startup",  "trap",  or  "traptimeout",  and
              signifies the type of alert which was triggered.

       <b>MON_DESCRIPTION</b>
              The description of this service, as defined in the configuration file using the <u>description</u> tag.

       <b>MON_FIRST_FAILURE</b>
              The <a href="../man2/time.2.html">time</a>(2) of the first time this service failed.

       <b>MON_GROUP</b>
              The watch group which triggered this alarm

       <b>MON_LAST_FAILURE</b>
              The <a href="../man2/time.2.html">time</a>(2) of the last failure for this service.

       <b>MON_LAST_OUTPUT</b>
              The entire output of the monitor from the last time it exited.

       <b>MON_LAST_SUCCESS</b>
              The <a href="../man2/time.2.html">time</a>(2) of the last time this service passed.

       <b>MON_LAST_SUMMARY</b>
              The first line of the output from the last time the monitor exited.

       <b>MON_LOGDIR</b>
              The  directory  log  files  should  be  placed,  as  indicated  by the <u>logdir</u> global configuration
              variable.

       <b>MON_OPSTATUS</b>
              The operational status of the service.

       <b>MON_RETVAL</b>
              The exit value of the failed monitor program, or return value as accepted from a trap.

       <b>MON_STATEDIR</b>
              The directory where state files should be kept, as indicated by the <u>statedir</u> global  configuration
              variable.

       <b>MON_SERVICE</b>
              The service heading which generated this alert

       <b>MON_TRAP_INTENDED</b>
              This  is  only  set  when  an  unknown  mon  trap  is  received  and  caught by the default/defaut
              watch/service. This contains colon separated entries  of  the  trap's  intended  watch  group  and
              service name.

       <b>MON_CFBASEDIR</b>
              The  directory  where  configuration  files  should  be kept, as indicated by the <u>cfbasedir</u> global
              configuration variable.

       The first line from standard input must be used as a brief summary of the problem, normally  supplied  as
       the  subject  line  of  an email, or text sent to an alphanumeric pager. Interpretation of all subsequent
       lines read from stdin is left up to the alerting program. The usual parameters are a list  of  recipients
       to  deliver the notification to.  The interpretation of the recipients is not specified, and is up to the
       alert program.

</pre><h4><b>CONFIGURATION</b> <b>FILE</b></h4><pre>
       The configuration file consists of zero or more global  variable  definitions,  zero  or  more  hostgroup
       definitions,  and  one  or  more  watch  definitions.  Each watch definition may have one or more service
       definitions. A watch definition is terminated by a blank line, another definition,  or  the  end  of  the
       file.  A  line beginning with optional leading whitespace and a pound ("#") is regarded as a comment, and
       is ignored.

       Lines are parsed as they are read. Long lines may be continued by ending them with a backslash ("\").  If
       a line is continued, then the backslash, the trailing whitespace after the  backslash,  and  the  leading
       whitespace of the following line are removed. The end result is assembled into a single line.

       Typically the configuration file has the following layout:

       1. Global variable definitions

       2. Hostgroup definitions

       3. Watch definitions

       See the "etc/example.cf" file which comes for the distribution for an example.

   <b>Global</b> <b>Variables</b>
       The  following  variables  may  be set to override compiled-in defaults. Command-line options will have a
       higher precedence than these definitions.

       <b>alertdir</b> <b>=</b> <u>dir</u>
              <u>dir</u> is the full path to the alert scripts. This is the value set by the <b>-a</b> command-line parameter.

              Multiple alert paths may be specified by separating them with a  colon.   Non-absolute  paths  are
              taken to be relative to the base directory (<u>/usr/lib/mon</u> by default).

              When  the  configuration file is read, all alerts referenced from the configuration will be looked
              up in each of these paths, and the full path to the first instance of the alert found is stored in
              a hash. This hash is only generated upon startup or after a "reset" command, so newly added  alert
              scripts will not be recognized until a "reset" is performed.

       <b>authfile</b> <b>=</b> <u>file</u>
              <u>file</u>  is  the  path  to the authentication file. If the path does not begin with a "/", it will be
              relative to <u>cfbasedir</u>.

       <b>basedir</b> <b>=</b> <u>dir</u>
              <u>dir</u> is the full path for the state, log, monitor, and alert directories.

       <b>authtype</b> <b>=</b> <u>type</u> <u>[type...]</u>
              <u>type</u> is the type of authentication to use. A space-separated list of types may be  specified,  and
              they  will  be  checked  the  order  they  are  listed.  As soon as a successful authentication is
              performed, the user is considered authenticated by mon for the duration of the session and no more
              authentication checks are performed.

              If <u>type</u> is <b>getpwnam</b>, then the standard Unix passwd file authentication method will be used  (calls
              <a href="../man3/getpwnam.3.html">getpwnam</a>(3) on the user and compares the <a href="../man3/crypt.3.html">crypt</a>(3)ed version of the password with what it gets from
              getpwnam). This will not work if shadow passwords are enabled on the system.

              If  <u>type</u> is <b>userfile</b>, then usernames and hashed passwords are read from <u>userfile</u>, which is defined
              via the <b>userfile</b> configuration variable.

              If <u>type</u> is <b>pam</b>, then PAM (pluggable authentication modules) will be used for authentication.   The
              service  specified  by  the  <b>pamservice</b> global will be used. If no global is given, the PAM <b>passwd</b>
              service will be used.

              If <u>type</u> is <b>trustlocal</b>, then if the client connection comes from locahost, the username passed from
              the client will be trusted, and the password will be ignored.  This can be used when you want  the
              client  to  handle  the  authentication  for  you.  I.e. a CGI script using one of the many apache
              authentication methods.

       <b>cfbasedir</b> <b>=</b> <u>dir</u>
              <u>dir</u> is the full path where all the config files can be found (monusers.cf, auth.cf, etc.).

       <b>cltimeout</b> <b>=</b> <u>secs</u>
              Sets the client inactivity timeout to <u>secs.</u>  This is  meant  to  help  thwart  denial  of  service
              attacks or recover from crashed clients.  <u>secs</u> is interpreted as a "1h/1m/1s" string, where "1m" =
              60 seconds.

       <b>dep_behavior</b> <b>=</b> <u>{a|m|hm}</u>
              <b>dep_behavior</b>  controls whether the dependency expression suppresses one of: the running of alerts,
              the running of monitors, or the passing of individual hosts to the monitors.  Read more about  the
              behavior in the "Service Definitions" section below.

              This is a global setting which controls the default settings for the service-specified variable.

       <b>dep_memory</b> <b>=</b> <u>timeval</u>
              If  set,  dep_memory will cause dependencies to continue to prevent alerts/monitoring for a period
              of time after the service returns to a normal state.  This  can  be  used  to  prevent  over-eager
              alerting  when  a  machine  is  rebooting,  for  example.   See the explanation of <u>interval</u> in the
              "Service Definitions" section for a description of <u>timeval</u>.

              This is a global setting which controls the default settings for the service-specified variable.

       <b>dep_recur_limit</b> <b>=</b> <u>depth</u>
              Limit dependency recursion level to <u>depth</u>.  If dependency recursion (dependencies which depend  on
              other  dependencies)  tries  to  go  beyond <u>depth</u>, then the recursion is aborted and a messages is
              logged to syslog.  The default limit is 10.

       <b>dtlogfile</b> <b>=</b> <u>file</u>
              <u>file</u> is a file which will be used to record the downtime log. Whenever a service  fails  for  some
              amount  of  time and then stop failing, this event is written to the log. If this parameter is not
              set, no logging is done. The format of the file is as follows (# is a comment and may be ignored):

              <b>timenoticed</b> <b>group</b> <b>service</b> <b>firstfail</b> <b>downtime</b> <b>interval</b> <b>summary</b>.

              <b>timenoticed</b> is the <a href="../man2/time.2.html">time</a>(2) the service came back up.

              <b>group</b> <b>service</b> is the group and service which failed.

              <b>firstfail</b> is the <a href="../man2/time.2.html">time</a>(2) when the service began to fail.

              <b>downtime</b> is the number of seconds the service failed.

              <b>interval</b> is the frequency (in seconds) that the service is polled.

              <b>summary</b> is the summary line from when the service was failing.

       <b>dtlogging</b> <b>=</b> <u>yes/no</u>

              Turns downtime logging on or off. The default is off.

       <b>historicfile</b> <b>=</b> <u>file</u>
              If this variable is set, then alerts are logged to <u>file</u>, and upon startup, some (or  all)  of  the
              past history is read into memory.

       <b>histlength</b> <b>=</b> <u>num</u>
              <u>num</u>  is the the maximum number of events to be retained in history list. The default is 100.  This
              value may also be set by the <b>-k</b> command-line parameter.

       <b>logdir</b> <b>=</b> <u>dir</u>
              <u>dir</u> is the full path to the log  directory.   <b>mon</b>  uses  this  directory  to  save  various  logs,
              including  the  downtime  log.  If  this  path  does  not begin with a "/", it will be relative to
              <u>basedir</u>.

       <b>maxprocs</b> <b>=</b> <u>num</u>
              Throttles the number of concurrently forked processes to <u>num.</u>  The intent is to provide  a  safety
              net for the unlikely situation when the server tries to take on too many tasks at once.  Note that
              this  situation  has only been reported to happen when trying to use a garbled configuration file!
              You don't want to use a garbled configuration file now, do you?

       <b>mondir</b> <b>=</b> <u>dir</u>
              <u>dir</u> is the full path to the monitor scripts. This value may also be set  by  the  <b>-s</b>  command-line
              parameter. If this path does not begin with a "/", it will be relative to <u>basedir</u>.

              Multiple alert paths may be specified by separating them with a colon. All paths must be absolute.

              When the configuration file is read, all monitors referenced from the configuration will be looked
              up  in each of these paths, and the full path to the first instance of the monitor found is stored
              in a hash. This hash is only generated upon startup or after a "reset"  command,  so  newly  added
              monitor scripts will not be recognized until a "reset" is performed.

       <b>monremote</b> <b>=</b> <u>program</u>

              If  set,  this  external program will be called by Mon when various client requests are processed.
              This can be used to propagate those changes from one Mon server to another, if you  have  multiple
              monitoring machines.  An example script, <b>monremote.pl</b> is available in the clients directory.

       <b>monerrfile</b> <b>=</b> <u>filename</u>
              By  default, when mon daemonizes itself, it connects stdout and stderr to /dev/null. If <b>monerrfile</b>
              is set to a file, then stdout and stderr will be appended to that file.  In  all  cases  stdin  is
              connected to /dev/null. If mon is told to run in the foreground and to not daemonize, then none of
              this  applies,  since  stdin/stdout/stderr  stay  connected  to  whatever they were at the time of
              invocation.

       <b>pamservice</b> <b>=</b> <u>service</u>
              The PAM service used for authentication. This is applicable  only  if  "pam"  is  specified  as  a
              parameter to the <b>authtype</b> setting. If this global is not defined, it defaults to <b>passwd</b>.

       <b>pidfile</b> <b>=</b> <u>path</u>
              <u>path</u>  is  the file the sever will store its pid in.  This value may also be set by the <b>-P</b> command-
              line parameter.

       <b>randstart</b> <b>=</b> <u>interval</u>
              When the server starts, normally all services will not be scheduled until the interval defined  in
              the  respective  service section.  This can cause long delays before the first check of a service,
              and possibly a high load on the server if multiple things are scheduled  at  the  same  intervals.
              This  option  is  used  to  randomize the scheduling of the first test for all services during the
              startup period, and immediately after the <u>reset</u> command.  If <u>randstart</u> is defined,  the  scheduled
              run  time  of  all services of all watch groups will be a random number between zero and <u>randstart</u>
              seconds.

       <b>serverbind</b> <b>=</b> <u>addr</u>

       <b>serverport</b> <b>=</b> <u>port</u>
              <u>port</u> is the TCP port number that the server should bind to. This value may also be set by  the  <b>-p</b>
              command-line  parameter.  Normally this port is looked up via <a href="../man3/getservbyname.3.html">getservbyname</a>(3), and it defaults to
              2583.

       <b>startupalerts_on_reset</b> <b>=</b> <u>{yes|no}</u>

              If set to "yes", startupalerts will be invoked when the <b>reset</b>  client  command  is  executed.  The
              default is "no".

       <b>statedir</b> <b>=</b> <u>dir</u>
              <u>dir</u>  is  the  full  path  to  the  state directory.  <b>mon</b> uses this directory to save various state
              information.

       <b>syslog_facility</b> <b>=</b> <u>facility</u>
              Specifies the syslog facility used for logging.  <b>daemon</b> is the default.

   <b>Hostgroup</b> <b>Entries</b>
       Hostgroup entries begin with the keyword <b>hostgroup</b>, and are followed by a hostgroup tag and one  or  more
       hostnames  or  IP  addresses, separated by whitespace. The hostgroup tag must be composed of alphanumeric
       characters, a dash ("-"), a period ("."), or an underscore ("_"). Non-blank  lines  following  the  first
       hostgroup  line  are interpreted as more hostnames.  The hostgroup definition ends with a blank line. For
       example:

              hostgroup servers nameserver smtpserver nntpserver
                      nfsserver httpserver smbserver

              hostgroup router_group cisco7000 agsplus

   <b>View</b> <b>Entries</b>
       View entries begin with the keyword <b>view</b>, and are followed by a view tag and the names  of  one  or  more
       hostgroups.   The  view tag must be composed of alphanumeric characters, a dash ("-"), a period ("."), or
       an underscore ("_"). Non-blank lines following the first view line  are  interpreted  as  more  hostgroup
       names.  The view definition ends with a blank line. For example:

              view servers dns-servers web-servers file-servers
                   mail-servers

              view network-services routers switches vpn-servers

   <b>Watch</b> <b>Group</b> <b>Entries</b>
       Watch  entries  begin with a line that starts with the keyword <b>watch</b>, followed by whitespace and a single
       word which normally refers to a pre-defined hostgroup.  If  the  second  word  is  not  recognized  as  a
       hostgroup tag, a new hostgroup is created whose tag is that word, and that word is its only member.

       Watch entries consist of one or more service definitions.

       A watch group is terminated by a blank line, the end of the file, or by a subsequent definition, "watch",
       "hostgroup", or otherwise.

       There  may  be  a  special watch group entry called "default". If a default watch group is defined with a
       service entry named "default", then this definition will be  used  in  handling  traps  received  for  an
       unrecognized watch and service.

   <b>Service</b> <b>Definitions</b>
       <b>service</b> <u>servicename</u>
              A service definition begins with they keyword <b>service</b> followed by a word which is the tag for this
              service.  This word must be unique among all services defined for the same watch group.

              The  components of a service are an interval, monitor, and one or more time period definitions, as
              defined below.

              If a service name of "default" is defined within a watch group called "dafault" (see above),  then
              the default/default definition will be used for handling unknown mon traps.

              The following configuration parameters are valid only following a service definition:

        <b>alertdepend,</b> <b>monitordepend,</b> <b>hostdepend</b> "dependexpression"
              These  keywords allow you to specify multiple dependency expressions of different types.  Each one
              corresponds to  the  different  <b>dep_behavior</b>  settings  listed  above.   They  will  be  evaluated
              independently  in  the  different  contexts  as  listed  above.   If  <b>depend</b>  is present, it takes
              precedence over the matching keyword, depending on the <b>dep_behavior</b> setting.

       <b>allow_empty_group</b>
              The <b>allow_empty_group</b> option will allow a monitor to be invoked even when the hostgroup  for  that
              watch  is  empty because of disabled hosts. The default behavior is not to invoke the monitor when
              all hosts in a hostgroup have been disabled.

       <b>depend</b> <u>dependexpression</u>
              The <b>depend</b> keyword is used to specify a dependency expression, which evaluates to either  true  of
              false,  in  the  boolean  sense.   Dependencies  are  actual  Perl  expressions, and must obey all
              syntactical rules. The expressions are  evaluated  in  their  own  package  space  so  as  to  not
              accidentally  have  some  unwanted  side-effect.   If  a syntax error is found when evaluating the
              expression, it is logged via syslog.

              Before evaluation, the following substitutions on the expression occur: phrases  which  look  like
              "group:service" are substituted with the value of the current operational status of that specified
              service.  These  opstatus  substitutions  are  computed  recursively, so if service A depends upon
              service B, and service B depends upon service C, then service A depends upon service C. Successful
              operational statuses (which evaluate to "1") are  "STAT_OK",  "STAT_COLDSTART",  "STAT_WARMSTART",
              and   "STAT_UNKNOWN".    The  word  "SELF"  (in  all  caps)  can  be  used  for  the  group  (e.g.
              "SELF:service"), and is an abbreviation for the current watch group.

              This feature can be used to control alerts for services which are  dependent  on  other  services,
              e.g. an SMTP test which is dependent upon the machine being ping-reachable.

       <b>dep_behavior</b> <u>{a|m|hm}</u>
              The  evaluation  of  the  dependency  graphs  specified  via  the  <b>depend</b>  keyword can control the
              suppression of alert or monitor invocations, or the suppression of individual hosts passed to  the
              monitor.

              <b>Alert</b> <b>suppression</b>.  If this option is set to "a", then the dependency expression will be evaluated
              after  the  monitor for the service exits or after a trap is received.  An alert will only be sent
              if the evaluation succeeds, meaning that none of  the  nodes  in  the  dependency  graph  indicate
              failure.

              <b>Monitor</b> <b>suppression</b>.  If it is set to "m", then the dependency expression will be evaulated before
              the monitor for the service is about to run.  If the evaulation succeeds, then the monitor will be
              run. Otherwise, the monitor will not be run and the status of the service will remain the same.

              <b>Host</b>  <b>suppression</b>.   If it is set to "hm" then Mon will extract the list of "parent" services from
              the dependency expression.  (In fact the expression can be just a list of services.) Then when the
              monitor for the service is about to be run, for each host in the current hostgroup Mon will search
              all the parent services which are currently failing and look  for  the  hostname  in  the  current
              summary  output.   If  the  hostname  is  found,  this  host will be excluded from this run of the
              monitor.  This can be used to e.g. allow an SMTP test on a group of hosts to  still  be  run  even
              when  a  single  host  is  not ping-reachable.  If all the rest of the hosts are working fine, the
              service will be in an OK state, but if another host fails the SMTP test Mon can still alert  about
              that  host  even  though the parent dependency was failing.  The dependency expression will <b>not</b> be
              used recursively in this case.

       <b>dep_memory</b> <u>timeval</u>
              If set, dep_memory will cause dependencies to continue to prevent alerts/monitoring for  a  period
              of  time  after  the  service  returns  to a normal state.  This can be used to prevent over-eager
              alerting when a machine is rebooting, for  example.   See  the  explanation  of  <u>interval</u>  in  the
              "Service Definitions" section for a description of <u>timeval</u>.

       <b>description</b> <u>descriptiontext</u>
              The text following <b>description</b> is queried by client programs, passed to alerts and monitors via an
              environment variable. It should contain a brief description of the service, suitable for inclusion
              in an email or on a web page.

       <b>exclude_hosts</b> <u>host</u> <u>[host...]</u>
              Any hosts listed after <b>exclude_hosts</b> will be excluded from the service check.

       <b>exclude_period</b> <u>periodspec</u>
              Do not run a scheduled monitor during the time identified by <u>periodspec</u>.

       <b>failure_interval</b> <u>timeval</u>
              Adjusts  the polling interval to <u>timeval</u> when the service check is failing. Resets the interval to
              the original when the service succeeds.

       <b>interval</b> <u>timeval</u>
              The keyword <b>interval</b> followed by a time value specifies the frequency that a monitor  script  will
              be  triggered.   Time  values  are  defined  as  "30s", "5m", "1h", or "1d", meaning 30 seconds, 5
              minutes, 1 hour, or 1 day. The numeric portion may be a fraction, such as "1.5h" or an hour and  a
              half. This format of a time specification will be referred to as <u>timeval</u>.

       <b>monitor</b> <u>monitor-name</u> <u>[arg...]</u>
              The  keyword <b>monitor</b> followed by a script name and arguments specifies the monitor to run when the
              timer expires. Shell-like quoting conventions are followed when specifying the arguments  to  send
              to  the  monitor script.  The script is invoked from the directory given with the <b>-s</b> argument, and
              all following words are supplied as arguments to the monitor program,  followed  by  the  list  of
              hosts  in the group referred to by the current watch group.  If the monitor line ends with ";;" as
              a separate word, the host groups are not appended  to  the  argument  list  when  the  program  is
              invoked.

       <b>randskew</b> <u>timeval</u>
              Rather  than schedule the monitor script to run at the start of each interval, randomly adjust the
              interval specified by the <b>interval</b> parameter by  plus-or-minus  <b>randskew</b>  <b>.</b>   The  skew  value  is
              specified  as  the  <b>interval</b>  parameter:  "30s",  "5m", etc...  For example if <b>interval</b> is 1m, and
              <b>randskew</b> is "5s", then <u>mon</u> will schedule the monitor script some time between every 55 seconds and
              65 seconds.  The intent is to help distribute the load  on  the  server  when  many  services  are
              scheduled at the same intervals.

       <b>redistribute</b> <u>alert</u> <u>[arg...]</u>
              A  service  may  have  one redistribute option, which is a special form of an an alert definition.
              This alert will be called on every service status update, even sequential success status  updates.
              This can be used to integrate Mon with another monitoring system, or to link together multiple Mon
              servers  via an alert script that generates Mon traps.  See the "ALERT PROGRAMS" section above for
              a list of the parameters mon will pass automatically to alert programs.

       <b>unack_summary</b>
              Remove the "acknowledged" state from a service if the summary component  of  the  failure  message
              changes.   In  most  common usage the summary is the list of hosts that are failing, so additional
              hosts failing would remove an ack.

       <b>traptimeout</b> <u>timeval</u>
              This keyword takes the same time specification argument as <b>interval</b><u>,</u> and makes the service  expect
              a  trap  from  an  external source at least that often, else a failure will be registered. This is
              used for a heartbeat-style service.

       <b>trapduration</b> <u>timeval</u>
              If a trap is received, the status of the service the trap was delivered to  will  normally  remain
              constant.  If  <b>trapduration</b> is specified, the status of the service will remain in a failure state
              for the duration specified by <u>timeval</u>, and then it will be reset to "success".

       <b>VARIABLE=</b><u>value</u>
              Environment variables may be defined for each service, which will be included in  the  environment
              of  monitors  and  alerts.  Variables must be specified in all capital letters, must begin with an
              alphabetical character or an underscore, and there must be no spaces to  the  left  of  the  equal
              sign.

   <b>Period</b> <b>Definitions</b>
       Periods are used to define the conditions which should allow alerts to be delivered.

       <b>period</b> <u>[label:]</u> <u>periodspec</u>
              A  period  groups  one  or more alarms and variables which control how often an alert happens when
              there is a failure.  The <b>period</b> definition has two forms. The first takes an argument which  is  a
              period   specification  from  Patrick  Ryan's  Time::Period  Perl  5  module.  Refer  to  "perldoc
              Time::Period" for more information.

              The second form requires a label followed by a period specification, as defined above.  The  label
              is  a  tag  consisting  of  an  alphabetic  character  or  underscore  followed  by  zero  or more
              alphanumerics or underscores and ending with a colon. This form allows multiple periods  with  the
              same  period  definition.  One  use  is  to  have  a  period definition which has no <b>alertafter</b> or
              <b>alertevery</b> parameters for a particular time period, and another for the same time  period  with  a
              different set of alerts that does contain those parameters.

              Period  definitions,  in  either  the  first  or  second  form, must be unique within each service
              definition. For example, if you need to define two periods both for "wd {Sun-Sat}",  then  one  or
              both  of the period definitions must specify a label such as "period t1: wd {Sun-Sat}" and "period
              t2: wd {Sun-Sat}".

       <b>alert</b> <u>alert</u> <u>[arg...]</u>
              A period may contain multiple alerts, which are triggered upon failure of the service. An alert is
              specified with the <b>alert</b> keyword, followed by an optional <b>exit</b> parameter, and arguments which  are
              interpreted the same as the <b>monitor</b> definition, but without the ";;" exception. The <b>exit</b> parameter
              takes  the form of <b>exit=x</b> or <b>exit=x-y</b> and has the effect that the alert is only called if the exit
              status of the monitor script falls within the range of the <b>exit</b> parameter. If,  for  example,  the
              alert line is <u>alert</u> <u>exit=10-20</u> <u>mail.alert</u> <u>mis</u> then <u>mail-alert</u> will only be invoked with <u>mis</u> as its
              arguments  if  the  monitor  program's exit value is between 10 and 20. This feature allows you to
              trigger different alerts at different severity levels (like when free disk space goes from  8%  to
              3%).

              See  the  <b>ALERT</b> <b>PROGRAMS</b> section above for a list of the pramaeters mon will pass automatically to
              alert programs.

       <b>alertafter</b> <u>num</u>

       <b>alertafter</b> <u>num</u> <u>timeval</u>

       <b>alertafter</b> <u>timeval</u>
              The <b>alertafter</b> keyword (within a <b>period</b> section) has three forms: only with the "num" argument, or
              with the "num timeval" arguments, or only with the "timeval" argument.   In  the  first  form,  an
              alert will only be invoked after "num" consecutive failures.

              In  the second form, the arguments are a positive integer followed by an interval, as described by
              the <b>interval</b> variable above.  If these parameters are specified, then the alerts for  that  period
              will  only  be  called  after  that  many  failures  happen  within that interval. For example, if
              <b>alertafter</b> is given the arguments "3 30m", then the alert will be  called  if  3  failures  happen
              within 30 minutes.

              In  the  third  form,  the  argument  is an interval, as described by the <b>interval</b> variable above.
              Alerts for that period will only be called if the service has been in a  failure  state  for  more
              than  the  length  of  time desribed by the interval, regardless of the number of failures noticed
              within that interval.

       <b>alertevery</b> <u>timeval</u> <u>[observe_detail</u> <u>|</u> <u>strict]</u>
              The <b>alertevery</b> keyword (within a <b>period</b> definition)  takes  the  same  type  of  argument  as  the
              <b>interval</b>  variable,  and limits the number of times an alert is sent when the service continues to
              fail.  For example, if the interval is "1h", then only the alerts in the period section will  only
              be  triggered  once  every  hour. If the <b>alertevery</b> keyword is omitted in a period entry, an alert
              will be sent out every time a failure is detected. By  default,  if  the  summary  output  of  two
              successive  failures  changes,  then  the  alertevery interval is overridden, and an alert will be
              sent.  If the string "observe_detail" is the last argument,  then  both  the  summary  and  detail
              output  lines  will be considered when comparing the output of successive failures.  If the string
              "strict" is the last argument, then the output of the monitor or the state change of  the  service
              will  have  no effect on when alerts are sent. That is, "alertevery 24h strict" will send only one
              alert every 24 hours, no matter what.  Please refer to the <b>ALERT</b>  <b>DECISION</b>  <b>LOGIC</b>  section  for  a
              detailed explanation of how alerts are suppressed.

       <b>no_comp_alerts</b>

              If  this option is specified, then upalerts will be called whenever the service state changes from
              failure to success, rather than only after a corresponding "down" alert.

       <b>numalerts</b> <u>num</u>

              This variable tells the server to call no more than <u>num</u> alerts during a failure. The alert counter
              is kept on a per-period basis, and is reset upon each success.

       <b>startupalert</b> <u>alert</u> <u>[arg...]</u>
              A <b>startupalert</b> is only called when the <b>mon</b> server starts execution, or when a "reset" command  was
              issued to the server, depending on the setting of the <b>startupalerts_on_reset</b> global.  Unlike other
              alerts,  <b>startupalerts</b>  are  not  called  following the exit of a monitor, i.e. they are called in
              their own right, therefore the "exit=" argument is not applicable to <b>startupalert.</b>

       <b>upalert</b> <u>alert</u> <u>[arg...]</u>
              An <b>upalert</b> is the compliment of an <b>alert</b>.  An upalert is called when a services  makes  the  state
              transition  from  failure  to  success,  if  a corresponding "down" alert was previously sent. The
              <b>upalert</b> script is called supplying the same parameters as the <b>alert</b> script, with the  addition  of
              the  <b>-u</b>  parameter  which is simply used to let an alert script know that it is being called as an
              upalert. Multiple upalerts may be specified  for  each  period  definition.   Set  the  per-period
              <b>no_comp_alerts</b> option to send an upalert regardless if whether or not a "down" alert was  sent.

       <b>upalertafter</b> <u>timeval</u>
              The  <b>upalertafter</b>  parameter  is  specified  as  a  string that follows the syntax of the <b>interval</b>
              parameter ("30s", "1m", etc.), and controls the triggering of an <b>upalert</b>.  If a service comes back
              up after being down for a time greater than or equal to the value of this option, an <b>upalert</b>  will
              be called. Use this option to prevent upalerts to be called because of "blips" (brief outages).

</pre><h4><b>AUTHENTICATION</b> <b>CONFIGURATION</b> <b>FILE</b></h4><pre>
       The  file  specified  by the <b>authfile</b> variable in the configuration file (or passed via the <b>-A</b> parameter)
       will be loaded upon startup.  This file defines restrictions upon which client commands may  be  executed
       by  which  users.  It  is  a  text  file  which  consists  of  comments,  command  definitions,  and trap
       authentication parameters.  A comment line begins with optional whitespace followed by pound sign.  Blank
       lines are ignored.

       The  file is separated into a command section and a trap section. Sections are specified by a single line
       containing one of the following statements:

                      command section

       or

                      trap section

       Lines following one of the above statements apply to that section until either the end  of  the  file  or
       another section begins.

       A  command  definition  consists of a command, followed by a colon, followed by a comma-separated list of
       users who may execute the command.  The default is that no users may execute any commands unless they are
       explicitly allowed in this configuration file. For clarity, a user can be denied by  prefixing  the  user
       name with "!". If the word "AUTH_ANY" is used for a username, then any authenticated user will be allowed
       to  execute  the  command. If the word "all" is used for a username, then that command may be executed by
       any user, authenticated or not.

       The trap section allows configuration of which users may send traps from which hosts.  The  syntax  is  a
       source  host  (name or ip address), whitespace, a username, whitespace, and a plaintext password for that
       user. If the source host is "*", then allow traps from any host. If the  username  is  "*",  then  accept
       traps without regard for the username or password. If no hosts or users are specified, then no traps will
       be accepted.

       An example configuration file:

              command section
              list:           all
              reset:          root,admin
              loadstate:              root
              savestate:              root

              trap section
              127.0.0.1       root    r@@tp4sswrd

       This  means  that  all  clients  are able to perform the <b>list</b> command, "root" is able to perform "reset",
       "loadstate", "savestate", and "admin" is able to execute the "reset" command.

</pre><h4><b>CLIENT-SERVER</b> <b>INTERFACE</b></h4><pre>
       The server listens on TCP port 2583, which may be overridden using the <b>-p</b> <u>port</u>  option.  Commands  are  a
       single  line  each,  terminated  by  a  newline.  The server can handle any number of simultaneous client
       connections.

</pre><h4><b>CLIENT</b> <b>INTERFACE</b> <b>COMMANDS</b></h4><pre>
       See manual page for <b>moncmd</b>.

</pre><h4><b>MON</b> <b>TRAPPING</b></h4><pre>
       Mon has the facility to receive special "mon traps" from any local or remote machine. Currently, the only
       available method for sending mon traps are through the Mon::Client perl interface, though the UDP  packet
       format is defined well enough to permit the writing of traps in other languages.

       Traps  are  handled  similarly  to  monitors:  a  trap  sends  an  operational  status, summary line, and
       description text, and mon generates an alert or upalert as necessary.

       Traps can be caught by any watch/service group set up in  the  mon  configuration  file,  however  it  is
       suggested  that you configure watch/service groups specifically for the traps you expect to receive. When
       defining a special watch/service group for traps, do not include a "monitor"  directive  (as  no  monitor
       need  be  invoked). Since a monitor is not being invoked, it is not necessary for the watch definition to
       have a hostgroup which contains real host names.  Just make up a useful name, and mon will  automatically
       create the watch group for you.

       Here is a simple config file example:

              watch trap-service
                   service host1-disks
                        description TRAP: for host1 disk status
                        period wd {Sun-Sat}
                             alert mail.alert <a href="mailto:someone@your.org">someone@your.org</a>
                             upalert mail.alert -u <a href="mailto:someone@your.org">someone@your.org</a>

       Since  mon  listens  on  a  UDP  port for any trap, a default facility is available for handling traps to
       unknown groups or services.  To enable this facility, you must include a "default"  watch  group  with  a
       "default" service entry containing the specifics of alarms.  If a default/default watch group and service
       are  not  configured,  then  unknown  traps  get  logged  via  syslog,  and  no alarm is sent.  <b>NOTE:</b> The
       default/default facility is a single entity as far as accounting and alarming go.  Alarm  programs  which
       are  not  aware  of  this fact may send confusing information when a failure trap comes from one machine,
       followed by  a  success  (ok)  trap  from  a  different  machine.  See  the  alarm  environment  variable
       <b>MON_TRAP_INTENDED</b>  above for a possible way around this. It is intended that default/default be used as a
       facility to catch unknown traps, and should not be relied  upon  to  catch  all  traps  in  a  production
       environment.  If  you  are  lazy and only want to use default/default for catching all traps, it would be
       best to disable upalerts, and use the MON_TRAP_INTENDED environment variable in alert scripts to make the
       alerts more meaningful to you.

       Here is an example default facility:

              watch default
                   service default
                        description Default trap service
                        period wd {Sun-Sat}
                             alert mail.alert <a href="mailto:someone@your.org">someone@your.org</a>
                             upalert mail.alert -u <a href="mailto:someone@your.org">someone@your.org</a>

</pre><h4><b>EXAMPLES</b></h4><pre>
       The <b>mon</b> distribution comes with an example configuration called <u>example.cf</u>.  Refer to that file for  more
       information.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/moncmd.1.html">moncmd</a></b>(1), <b>Time::<a href="../man3pm/Period.3pm.html">Period</a></b>(3pm), <b>Mon::<a href="../man3pm/Client.3pm.html">Client</a></b>(3pm)

</pre><h4><b>HISTORY</b></h4><pre>
       <b>mon</b>  was  written because I couldn't find anything out there that did just what I needed, and nothing was
       worth modifying to add the features I wanted. It doesn't have a cool name, and that bothers me because  I
       couldn't think of one.

</pre><h4><b>BUGS</b></h4><pre>
       Report bugs to the email address below.

</pre><h4><b>AUTHOR</b></h4><pre>
       Jim Trocki &lt;<a href="mailto:trockij@arctic.org">trockij@arctic.org</a>&gt;

Linux                                     $Date: 2007/06/25 13:10:07 $                                    <u><a href="../man8/mon.8.html">mon</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>