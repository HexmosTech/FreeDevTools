<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mimedefang - Sendmail MIME mail filter</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/mimedefang">mimedefang_3.6-2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       mimedefang - Sendmail MIME mail filter

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>mimedefang</b> <b>prcap</b>

       <b>mimedefang</b> -p <u>connection</u> -m <u>mx_socket_name</u> -U <u>user</u> [<u>options</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>mimedefang</b>  is  a  filter  built  around  Sendmail  8.11's <u>milter</u> API for mail filters.  It collects each
       incoming message and runs a filter on the message.  This is useful for deleting attachments which may  be
       a security risk on poorly-designed systems like Microsoft Windows.

       <b>mimedefang</b>   does   not  actually  run  the  Perl  filter;  instead,  it  communicates  with  <b><a href="../man8/mimedefangmultiplexor.8.html">mimedefang-</a></b>
       <b><a href="../man8/mimedefangmultiplexor.8.html">multiplexor</a></b>(8), which manages a pool of persistent Perl processes.  See  the  <b>mimedefang-multiplexor</b>  man
       page for additional information.

</pre><h4><b>OPTIONS</b></h4><pre>
       If  you  invoke  <b>mimedefang</b>  with  the  single argument <b>prcap</b>, it prints information about the version of
       Milter it is linked against and exits.  Otherwise, you should invoke <b>mimedefang</b> as shown  in  the  second
       line of the SYNOPSIS.

       <b>-U</b> <u>user</u>
              Runs  <b>mimedefang</b>  as  <u>user</u>  rather  than  <u>root</u>.   The  <u>user</u>  argument  must  match the argument to
              <b>mimedefang-multiplexor</b>'s <b>-U</b> option as well.

       <b>-y</b>     If the <b>-y</b> command-line option is given, MIMEDefang will call smfi_setsymlist to set  the  list  of
              macros  it  wants.   <u>This</u>  <u>function</u>  <u>leaked</u>  <u>memory</u>  <u>in</u> <u>versions</u> <u>of</u> <u>Sendmail</u> <u>prior</u> <u>to</u> <u>8.14.4</u> so by
              default we do not call it.  If you are running an older version of sendmail, you should explicitly
              set the list of macros you want in the Sendmail configuration file.

       <b>-z</b> <u>spooldir</u>
              Set the spool directory to <u>spooldir</u>.  If this option is omitted, the spool directory  defaults  to
              /var/spool/MIMEDefang.

       <b>-p</b> <u>connection</u>
              The  <b>-p</b>  switch  is  required and specifies the <u>milter</u> connection type.  Typically, you should run
              <b>mimedefang</b> on the same computer as <b>sendmail</b>.  Therefore, you should use a UNIX-domain  socket  for
              the  connection  type.   The  suggested value for the <b>-p</b> switch is <b>mimedefang.sock</b> under the spool
              directory.

       <b>-m</b> <u>mx_socket_name</u>
              Specifies  the  socket  for  communicating  with  <b><a href="../man8/mimedefang-multiplexor.8.html">mimedefang-multiplexor</a></b>(8).   The  <u>mx_socket_name</u>
              specifies the path of the UNIX-domain socket.  See <b><a href="../man8/mimedefang-multiplexor.8.html">mimedefang-multiplexor</a></b>(8) for details.

       <b>-b</b> <u>backlog</u>
              Sets  the  "backlog" argument to the <b><a href="../man2/listen.2.html">listen</a></b>(2) system call to <u>backlog</u>.  If this option is omitted,
              then the operating-system default backlog is used.

       <b>-G</b>     Normally, <b>mimedefang</b> uses a umask of 077 when creating the milter socket and files.  If you  would
              like  the  socket to be readable and writeable by the group and files to be group-readable, supply
              the <b>-G</b> option.  This causes the umask to be 007 whenever UNIX-domain sockets are created  and  027
              whenever files are created.  <u>Note</u>: if your milter library is too old to have the smfi_opensocket()
              function, the <b>-G</b> option causes <b>mimedefang</b> to use a umask of 007 throughout its execution.

              Note  that by default, /var/spool/MIMEDefang is created with mode 0700.  If you use the <b>-G</b> option,
              you probably should change the mode to 0750.

       <b>-d</b>     The <b>-d</b> switch causes <b>mimedefang</b> <u>not</u> to delete the temporary spool files it  creates  for  incoming
              messages.   This  is  for  debugging  purposes  only and should <u>never</u> be used on a production mail
              server.

       <b>-r</b>     Causes <b>mimedefang</b> to perform a relay check before processing any messages.  It calls into a  user-
              supplied Perl function called <b>filter_relay</b> with the IP address and host name of the sending relay.
              (See <b><a href="../man5/mimedefang-filter.5.html">mimedefang-filter</a></b>(5) for details.)

       <b>-H</b>     Causes  <b>mimedefang</b>  to perform a HELO check before processing any messages.  It calls into a user-
              supplied Perl function called <b>filter_helo</b> with the IP address and host name of the sending  relay,
              and the HELO argument.  (See <b><a href="../man5/mimedefang-filter.5.html">mimedefang-filter</a></b>(5) for details.)

       <b>-s</b>     Causes  <b>mimedefang</b>  to perform a sender check before processing the message body.  It calls into a
              user-supplied Perl function called <b>filter_sender</b> with the envelope address of  the  sender.   (See
              <b><a href="../man5/mimedefang-filter.5.html">mimedefang-filter</a></b>(5) for details.)

       <b>-t</b>     Causes <b>mimedefang</b> to perform recipient checks before processing the message body.  It calls into a
              user-supplied  Perl  function called <b>filter_recipient</b> with the envelope address of each recipient.
              (See <b><a href="../man5/mimedefang-filter.5.html">mimedefang-filter</a></b>(5) for details.)

       <b>-q</b>     Permits the multiplexor to queue new connections.   See  the  section  QUEUEING  REQUESTS  in  the
              mimedefang-multiplexor  man page.  Note that this option and the <b>-R</b> option are mutually-exclusive.
              If you supply <b>-q</b>, then <b>-R</b> is ignored.

       <b>-k</b>     Causes <b>mimedefang</b> <u>not</u> to delete working directories if a filter fails.  This lets you  obtain  the
              message  which  caused  the  filter  to  fail  and determine what went wrong.  <b>mimedefang</b> logs the
              directory containing the failed message using syslog.

       <b>-P</b> <u>fileName</u>
              Causes <b>mimedefang</b> to write its process-ID (after becoming a daemon) to the  specified  file.   The
              file will be owned by root.

       <b>-o</b> <u>fileName</u>
              Causes mimedefang to use <u>fileName</u> as a lock file to avoid multiple instances from running.  If you
              supply <b>-P</b> but not <b>-o</b>, then mimedefang constructs a lock file by appending ".lock" to the pid file.
              However,  this  is  less  secure than having a root-owned pid file in a root-owned directory and a
              lock file writable by the user named by the <b>-U</b> option.  (The lock file must be writable by the  <b>-U</b>
              user.)

       <b>-R</b> <u>num</u> Normally,  <b>mimedefang</b> tempfails a new SMTP connection if there are no free workers.  Supplying the
              <b>-R</b> <u>num</u> option makes <b>mimedefang</b> tempfail new connections if there are fewer than <u>num</u> free  workers,
              <u>unless</u>  the  connection  is  from  the  local  host.   This  allows you to favour connections from
              localhost so your clientmqueue doesn't build up.  Note that supplying <b>-R</b>  <b>0</b>  is  subtly  different
              from  omitting  the  option;  in  this  case, <b>mimedefang</b> permits new connections from localhost to
              queue, but not connections from other hosts (unless you also supply the <b>-q</b> option.)

              The purpose of the <b>-R</b> option is to reserve resources for clientmqueue runs.  Otherwise, on a  very
              busy  mail  server,  clientmqueue  runs can starve for a long time, leading to delays for locally-
              generated or streamed mail.  We recommend using a small number for <u>num</u>; probably no more than 3 or
              10% of the total number of workers (whichever is smaller.)

              Note that this option and the <b>-q</b> option are mutually-exclusive.  If you  supply  <b>-q</b>,  then  <b>-R</b>  is
              ignored.

       <b>-C</b>     Conserve  file  descriptors  by  opening and closing disk files more often.  (Disk files are never
              held open across Milter callbacks.)  While this shortens the length of time a file  descriptor  is
              open, it also leaves more opportunities for the open to fail.  We do not recommend the use of this
              flag except on very busy systems that exhibit failures due to a shortage of file descriptors.

       <b>-T</b>     Causes <b>mimedefang</b> to log the run-time of the Perl filter using syslog.

       <b>-x</b> <u>string</u>
              Add  <u>string</u>  as  the  content  of the X-Scanned-By: header.  If you set <u>string</u> to the empty string
              (i.e. -x ""), then no X-Scanned-By: header will be added.

       <b>-X</b>     Do not add an X-Scanned-By: header.  Specifying -X is equivalent to specifying -x "".

       <b>-D</b>     Do not fork into the background and become a daemon.  Instead, stay  in  the  foreground.   Useful
              mainly for debugging or if you have a supervisory process managing <b>mimedefang</b>.

       <b>-M</b>     This option is obsolete; it is accepted for backward-compatibility, but is ignored.

       <b>-N</b>     Normally,  <b>mimedefang</b>  sees  all envelope recipients, even ones that Sendmail knows to be invalid.
              If you don't want Sendmail to perform a milter callback for recipients it  knows  to  be  invalid,
              invoke  <b>mimedefang</b>  with  the  -N  flag.   <u>Please</u> <u>note</u> <u>that</u> <u>this</u> <u>flag</u> <u>only</u> <u>works</u> <u>with</u> <u>Sendmail</u> <u>and</u>
              <u>Milter</u> <u>8.14.0</u> <u>and</u> <u>newer.</u>  <u>It</u> <u>has</u> <u>no</u> <u>effect</u> <u>if</u> <u>you're</u> <u>running</u>  <u>an</u>  <u>older</u>  <u>version</u>  <u>of</u>  <u>Sendmail</u>  <u>or</u>
              <u>Milter.</u>

       -S <u>facility</u>
              Specifies  the  syslog facility for log messages.  The default is <u>mail</u>.  See <b><a href="../man3/openlog.3.html">openlog</a></b>(3) for a list
              of valid facilities.  You can use either the short name ("mail") or long name ("LOG_MAIL") for the
              facility name.

       -a <u>macro</u>
              Pass the value of the specified Sendmail macro through to the Perl filter.  You can repeat the  -a
              option  to  write  more  macros  than  the  built-in  defaults.   Note  that in addition to asking
              <b>mimedefang</b> to pass the macro value to the filter, you must configure Sendmail to  pass  the  macro
              through   to   <b>mimedefang</b>   using   the  confMILTER_MACROS_ENVFROM  definition  in  Sendmail's  m4
              configuration file.

       <b>-c</b>     Strip "bare" carriage-returns (CR) characters from the message  body.   A  bare  CR  should  never
              appear  in  an e-mail message.  Older versions of <b>mimedefang</b> used to strip them out automatically,
              but now they are left in by default.  The <b>-c</b> option enables the older behavior.

       <b>-h</b>     Print usage information and exit.

</pre><h4><b>OPERATION</b></h4><pre>
       When <b>mimedefang</b> starts,  it  connects  to  <b>sendmail</b>  using  the  <u>milter</u>  API.   (See  the  Sendmail  8.11
       documentation.)   For  each  incoming  message,  <b>mimedefang</b>  creates  a  temporary  directory  and  saves
       information in the directory.  At various phases during the SMTP  conversation,  <b>mimedefang</b>  communicates
       with  <b>mimedefang-multiplexor</b>  to  perform  various  operations.  <b>mimedefang-multiplexor</b> manages a pool of
       persistent Perl processes that actually perform the mail scanning operations.

       When a Perl process scans an e-mail, the temporary spool directory contains certain files; details of the
       communication protocol between <b>mimedefang</b> and the Perl script are in <b><a href="../man7/mimedefang-protocol.7.html">mimedefang-protocol</a></b>(7).

</pre><h4><b>WARNINGS</b></h4><pre>
       <b>mimedefang</b> does violence to the flow of e-mail.  The Perl filter is quite picky and assumes that MIME  e-
       mail  messages are well-formed.  While I have tried to make the script safe, I take <u>no</u> <u>responsibility</u> for
       lost or mangled e-mail messages or any security holes this script may introduce.

</pre><h4><b>AUTHOR</b></h4><pre>
       <b>mimedefang</b>  was  written  by  Dianne  Skoll  &lt;<a href="mailto:dfs@roaringpenguin.com">dfs@roaringpenguin.com</a>&gt;.   The  <b>mimedefang</b>  home  page   is
       <u><a href="http://www.mimedefang.org/">http://www.mimedefang.org/</a></u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man8/mimedefang.pl.8.html">mimedefang.pl</a>(8),  <a href="../man5/mimedefang-filter.5.html">mimedefang-filter</a>(5),  <a href="../man8/mimedefang-multiplexor.8.html">mimedefang-multiplexor</a>(8),  <a href="../man7/mimedefang-protocol.7.html">mimedefang-protocol</a>(7), <a href="../man8/mimedefangrelease.8.html">mimedefang-</a>
       <a href="../man8/mimedefangrelease.8.html">release</a>(8)

4th Berkeley Distribution                        8 February 2005                                   <u><a href="../man8/MIMEDEFANG.8.html">MIMEDEFANG</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>