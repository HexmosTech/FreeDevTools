<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>timemaster - run NTP with PTP as reference clocks</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/linuxptp">linuxptp_4.2-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       timemaster - run NTP with PTP as reference clocks

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>timemaster</b> [ <b>-nmqv</b> ] [ <b>-l</b> <u>print-level</u> ] <b>-f</b> <u>file</u>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>timemaster</b>  is  a  program that uses <b>ptp4l</b> and <b>phc2sys</b> in combination with <b>chronyd</b> or <b>ntpd</b> to synchronize
       the system clock to NTP and PTP time sources. The PTP time is provided by  <b>phc2sys</b>  and  <b>ptp4l</b>  via  SOCK
       reference clock to <b>chronyd</b> or SHM reference clock to <b>ntpd</b>, which can compare all time sources and use the
       best sources to synchronize the system clock.

       On start, <b>timemaster</b> reads a configuration file that specifies the NTP and PTP time sources, checks which
       network interfaces have and share a PTP hardware clock (PHC), generates configuration files for <b>ptp4l</b> and
       <b>chronyd</b>/<b>ntpd</b>, and start the <b>ptp4l</b>, <b>phc2sys</b>, <b>chronyd</b>/<b>ntpd</b> processes as needed. Then, it waits for a signal
       to kill the processes, remove the generated configuration files and exit.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-f</b> <u>file</u>
              Specify the path to the <b>timemaster</b> configuration file.

       <b>-n</b>     Don't  start  the  programs,  only  print their configuration files and the commands that would be
              executed if this option wasn't specified.

       <b>-l</b> <u>level</u>
              Set the maximum syslog level of messages which should be printed or sent to the system logger. The
              default value is 6 (LOG_INFO).

       <b>-m</b>     Print messages to the standard output.

       <b>-q</b>     Don't send messages to the system logger.

       <b>-v</b>     Print the software version and exit.

       <b>-h</b>     Display a help message and exit.

</pre><h4><b>CONFIGURATION</b> <b>FILE</b></h4><pre>
       The configuration file is divided into sections. Each section starts with  a  line  containing  its  name
       enclosed  in  brackets  and  it  follows  with  settings.   Each setting is placed on a separate line, it
       contains the name of the option and the value separated by whitespace characters. Empty lines  and  lines
       starting with # are ignored.

       Sections that can used in the configuration file and options that can be set in them are described below.

   <b>[timemaster]</b>
       <b>ntp_program</b>
              Select  which NTP implementation should be used. Possible values are <b>chronyd</b> and <b>ntpd</b>. The default
              value is <b>chronyd</b>. Limitations of the implementations relevant to the timemaster configuration  are
              listed in <b>NOTES</b>.

       <b>rundir</b> Specify  the  directory  where should be generated <b>chronyd</b>, <b>ntpd</b> and <b>ptp4l</b> configuration files and
              sockets.  The  directory  will  be  created  if  it  doesn't   exist.   The   default   value   is
              <b>/var/run/timemaster</b>.

       <b>first_shm_segment</b>
              Specify the first number in a sequence of SHM segments that will be used by <b>ptp4l</b> and <b>phc2sys</b>. The
              default  value is 0. Increasing the number can be useful to avoid conflicts with time sources that
              are not started by <b>timemaster</b>, e.g. <b>gpsd</b> using segments number 0 and 1.

       <b>restart_processes</b>
              Enable or disable restarting of processes started by <b>timemaster</b>. If the option is set  to  a  non-
              zero  value, all processes except <b>chronyd</b> and <b>ntpd</b> will be automatically restarted when terminated
              and <b>timemaster</b> is running for at least one second (i.e. the process did not  terminate  due  to  a
              configuration  error).  If a process was terminated and is not started again, <b>timemaster</b> will kill
              the other processes and exit with a non-zero status.  The default value is 1 (enabled).

       <b>use_vclocks</b>
              Enable or disable synchronization with virtual clocks. If enabled, <b>timemaster</b> will create  virtual
              clocks  running  on top of physical clocks needed by configured PTP domains. This enables hardware
              time stamping for multiple <b>ptp4l</b> instances using the same network interface. The default value  is
              -1, which enables the virtual clocks if running on Linux 5.18 or later.

   <b>[ntp_server</b> <b>address]</b>
       The  <b>ntp_server</b>  section specifies an NTP server that should be used as a time source. The address of the
       server is included in the name of the section.

       <b>minpoll</b>
       <b>maxpoll</b>
              Specify the minimum and maximum NTP polling interval as powers of  two  in  seconds.  The  default
              values  are  6  (64 seconds) and 10 (1024 seconds) respectively. Shorter polling intervals usually
              improve the accuracy significantly, but they should be used only when allowed by the operators  of
              the NTP service (public NTP servers generally don't allow too frequent queries). If the NTP server
              is located on the same LAN, polling intervals around 4 (16 seconds) might give best accuracy.

       <b>iburst</b> Enable or disable sending a burst of NTP packets on start to speed up the initial synchronization.
              Possible values are 1 and 0. The default value is 0 (disabled).

       <b>ntp_options</b>
              Specify  extra  options  that  should  be  added  for  this  source to the <b>server</b> directive in the
              configuration file of the selected NTP implementation. No extra options are added by default.

   <b>[ptp_domain</b> <b>number]</b>
       The <b>ptp_domain</b> section specifies a PTP domain that should be used as a time source. The PTP domain number
       is included in the name of the section. The <b>ptp4l</b> instances are configured to run in the <b>clientOnly</b> mode.
       In this section at least the <b>interfaces</b> option needs to be set, other options are optional.

       <b>interfaces</b>
              Specify which network interfaces should be used for this PTP domain.  A  separate  <b>ptp4l</b>  instance
              will  be  started  for  each  group of interfaces sharing the same PHC and for each interface that
              supports only SW time stamping. HW time stamping is enabled automatically. If an interface with HW
              time stamping is specified also in other PTP domains and virtual clocks  are  disabled,  only  the
              <b>ptp4l</b> instance from the first PTP domain will be using HW time stamping.

       <b>ntp_poll</b>
              Specify  the  polling  interval  of  the  SOCK/SHM  reference  clock reading samples from <b>ptp4l</b> or
              <b>phc2sys</b>. It's specified as a power of two in seconds.  The default value is 2 (4 seconds).

       <b>phc2sys_poll</b>
              Specify the polling interval used by <b>phc2sys</b> to read a PTP clock synchronized by <b>ptp4l</b> and  update
              the  SOCK/SHM  sample  for  <b>chronyd</b>/<b>ntpd</b>. It's specified as a power of two in seconds. The default
              value is 0 (1 second).

       <b>delay</b>  Specify the maximum assumed roundtrip delay to the primary source of the time in this PTP  domain.
              This value is included in the distance used by <b>chronyd</b> in the source selection algorithm to detect
              falsetickers   and   assign  weights  for  source  combining.  The  default  value  is  1e-4  (100
              microseconds). With <b>ntpd</b>, the <b>tos</b> <b>mindist</b> command can be used to set a limit with similar  purpose
              globally for all time sources.

       <b>ntp_options</b>
              Specify extra options that should be added for this source to the <b>refclock</b> or <b>server</b> directives in
              the configuration file of the selected NTP implementation. No extra options are added by default.

       <b>ptp4l_option</b>
              Specify  an  extra  <b>ptp4l</b>  option  specific  to  this  PTP  domain  that  should  be  added to the
              configuration files generated for <b>ptp4l</b>. This option may be used multiple times in one  <b>ptp_domain</b>
              section.

   <b>[chronyd]</b>
       <b>path</b>   Specify  the  path to the <b>chronyd</b> binary. The default value is <b>chronyd</b> to search for the binary in
              <b>PATH</b>.

       <b>options</b>
              Specify extra options that should be added to the <b>chronyd</b> command  line.   No  extra  options  are
              added by default.

   <b>[chrony.conf]</b>
       Settings  specified  in this section are copied directly to the configuration file generated for <b>chronyd</b>.
       If this section is not present in the <b>timemaster</b> configuration file, the following setting will be added:

       makestep 1 3

       This configures <b>chronyd</b> to step the system clock in the first three updates if the offset is larger  than
       1 second.

   <b>[ntpd]</b>
       <b>path</b>   Specify the path to the <b>ntpd</b> binary. The default value is <b>ntpd</b> to search for the binary in <b>PATH</b>.

       <b>options</b>
              Specify extra options that should be added to the <b>ntpd</b> command line. No extra options are added by
              default.

   <b>[ntp.conf]</b>
       Settings  specified  in this section are copied directly to the configuration file generated for <b>ntpd</b>. If
       this section is not present in the <b>timemaster</b> configuration file, the following settings will be added:

       restrict default nomodify notrap nopeer noquery
       restrict 127.0.0.1
       restrict ::1

       This configures <b>ntpd</b> to use safe default restrictions.

   <b>[phc2sys]</b>
       <b>path</b>   Specify the path to the <b>phc2sys</b> binary. The default value is <b>phc2sys</b> to search for the  binary  in
              <b>PATH</b>.

       <b>options</b>
              Specify  extra  options  that  should  be added to all <b>phc2sys</b> command lines.  By default, <b>-l</b> <b>5</b> is
              added to the command lines.

   <b>[ptp4l]</b>
       <b>path</b>   Specify the path to the <b>ptp4l</b> binary. The default value is <b>ptp4l</b> to search for the binary in <b>PATH</b>.

       <b>options</b>
              Specify extra options that should be added to all <b>ptp4l</b> command lines. By default, <b>-l</b> <b>5</b>  is  added
              to the command lines.

   <b>[ptp4l.conf]</b>
       Settings  specified  in this section are copied directly to the global section of the configuration files
       generated for all <b>ptp4l</b> instances. There is no default content of this section.

       Other sections (e.g. <b>[unicast_master_table]</b>) may be specified here, but lines beginning with the  bracket
       need  to be prefixed with the <b>&gt;</b> character to prevent <b>timemaster</b> from parsing it as a beginning of another
       section.

</pre><h4><b>NOTES</b></h4><pre>
       For best accuracy, <b>chronyd</b> is usually preferred over <b>ntpd</b>, it also synchronizes the system clock  faster.
       Both  NTP  implementations, however, have some limitations that need to be considered before choosing the
       one to be used in a given <b>timemaster</b> configuration.

       The <b>chronyd</b> limitations are:

              In version 1.31 and older, the maximum number of reference clocks used at the same time is 8. This
              limits the number of PHCs and interfaces using SW time stamping that can be used for PTP.

              Using polling intervals (<b>minpoll</b>, <b>maxpoll</b>, <b>ntp_poll</b> options) shorter than 2  (4  seconds)  is  not
              recommended  with  versions  before 1.30. With 1.30 and later values of 0 or 1 can be used for NTP
              sources and negative values for PTP sources (<b>ntp_poll</b>) to specify a subsecond interval.

       The <b>ntpd</b> limitations are:

              In versions before 4.2.8p1, only the first two shared-memory segments  created  by  the  <b>ntpd</b>  SHM
              refclock driver have owner-only access. Other segments are created with world access, which allows
              any  user  on  the  system  to  write  to  the  segments  and  disrupt  or  take  control over the
              synchronization of the clock.  In 4.2.8p1 the access was made configurable with the  mode  option,
              which is set by <b>timemaster</b> for owner-ownly access.

              The shortest polling interval for all sources is 3 (8 seconds).

              Nanosecond  resolution  in  the  SHM  refclock driver is supported in version 4.2.7p303 and later,
              older versions have only microsecond resolution.

</pre><h4><b>EXAMPLES</b></h4><pre>
       A minimal configuration file using one NTP source and two PTP sources would be:

       [ntp_server 10.1.1.1]

       [ptp_domain 0]
       interfaces eth0

       [ptp_domain 1]
       interfaces eth1

       A more complex example using all <b>timemaster</b> options would be:

       [ntp_server 10.1.1.1]
       minpoll 3
       maxpoll 4
       iburst 1
       ntp_options key 12

       [ptp_domain 0]
       interfaces eth0 eth1
       ntp_poll 0
       phc2sys_poll -2
       delay 10e-6
       ntp_options prefer
       ptp4l_option clock_servo linreg
       ptp4l_option delay_mechanism P2P

       [timemaster]
       ntp_program chronyd
       rundir /var/run/timemaster
       first_shm_segment 1
       restart_processes 0
       use_vclocks 0

       [chronyd]
       path /usr/sbin/chronyd
       options

       [chrony.conf]
       makestep 1 3
       logchange 0.5
       rtcsync
       driftfile /var/lib/chrony/drift

       [ntpd]
       path /usr/sbin/ntpd
       options -u ntp:ntp

       [ntp.conf]
       restrict default nomodify notrap nopeer noquery
       restrict 127.0.0.1
       restrict ::1
       driftfile /var/lib/ntp/drift

       [phc2sys]
       path /usr/sbin/phc2sys
       options -l 5

       [ptp4l]
       path /usr/sbin/ptp4l
       options

       [ptp4l.conf]
       logging_level 5

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man8/chronyd.8.html">chronyd</a></b>(8), <b><a href="../man8/ntpd.8.html">ntpd</a></b>(8), <b><a href="../man8/phc2sys.8.html">phc2sys</a></b>(8), <b><a href="../man8/ptp4l.8.html">ptp4l</a></b>(8)

linuxptp                                          January 2021                                     <u><a href="../man8/TIMEMASTER.8.html">TIMEMASTER</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>