<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kdb5_util - Kerberos database maintenance utility</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/krb5-kdc">krb5-kdc_1.21.3-5ubuntu1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       kdb5_util - Kerberos database maintenance utility

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>kdb5_util</b>  [<b>-r</b>  <u>realm</u>] [<b>-d</b> <u>dbname</u>] [<b>-k</b> <u>mkeytype</u>] [<b>-kv</b> <u>mkeyVNO</u>] [<b>-M</b> <u>mkeyname</u>] [<b>-m</b>] [<b>-sf</b> <u>stashfilename</u>] [<b>-P</b>
       <u>password</u>] [<b>-x</b> <u>db_args</u>] <u>command</u> [<u>command_options</u>]

</pre><h4><b>DESCRIPTION</b></h4><pre>
       kdb5_util allows an administrator to perform maintenance procedures on the KDC database.   Databases  can
       be  created, destroyed, and dumped to or loaded from ASCII files.  kdb5_util can create a Kerberos master
       key stash file or perform live rollover of the master key.

       When kdb5_util is run, it attempts to acquire the master key and open the database.   However,  execution
       continues  regardless  of  whether or not kdb5_util successfully opens the database, because the database
       may not exist yet or the stash file may be corrupt.

       Note that some KDC database modules may not support all kdb5_util commands.

</pre><h4><b>COMMAND-LINE</b> <b>OPTIONS</b></h4><pre>
       <b>-r</b> <u>realm</u>
              specifies the Kerberos realm of the database.

       <b>-d</b> <u>dbname</u>
              specifies the name under which the principal database is stored; by default the database  is  that
              listed  in  <a href="../man5/kdc.conf.5.html">kdc.conf</a>(5).   The  password policy database and lock files are also derived from this
              value.

       <b>-k</b> <u>mkeytype</u>
              specifies the key type of  the  master  key  in  the  database.   The  default  is  given  by  the
              <b>master_key_type</b> variable in <a href="../man5/kdc.conf.5.html">kdc.conf</a>(5).

       <b>-kv</b> <u>mkeyVNO</u>
              Specifies  the version number of the master key in the database; the default is 1.  Note that 0 is
              not allowed.

       <b>-M</b> <u>mkeyname</u>
              principal name for the master key in the database.  If not specified, the name  is  determined  by
              the <b>master_key_name</b> variable in <a href="../man5/kdc.conf.5.html">kdc.conf</a>(5).

       <b>-m</b>     specifies  that  the master database password should be read from the keyboard rather than fetched
              from a file on disk.

       <b>-sf</b> <u>stash_file</u>
              specifies the stash filename of the master database password.  If not specified, the  filename  is
              determined by the <b>key_stash_file</b> variable in <a href="../man5/kdc.conf.5.html">kdc.conf</a>(5).

       <b>-P</b> <u>password</u>
              specifies  the master database password.  Using this option may expose the password to other users
              on the system via the process list.

       <b>-x</b> <u>db_args</u>
              specifies database-specific options.  See <a href="../man1/kadmin.1.html">kadmin</a>(1) for supported options.

</pre><h4><b>COMMANDS</b></h4><pre>
   <b>create</b>
          <b>create</b> [<b>-s</b>]

       Creates a new database.  If the <b>-s</b> option is specified, the stash file is  also  created.   This  command
       fails if the database already exists.  If the command is successful, the database is opened just as if it
       had already existed when the program was first run.

   <b>destroy</b>
          <b>destroy</b> [<b>-f</b>]

       Destroys  the  database, first overwriting the disk sectors and then unlinking the files, after prompting
       the user for confirmation.  With the <b>-f</b> argument, does not prompt the user.

   <b>stash</b>
          <b>stash</b> [<b>-f</b> <u>keyfile</u>]

       Stores the master principal's keys in a stash file.  The <b>-f</b> argument can be used to override the  <u>keyfile</u>
       specified in <a href="../man5/kdc.conf.5.html">kdc.conf</a>(5).

   <b>dump</b>
          <b>dump</b> [<b>-b7</b>|<b>-r13</b>|<b>-r18</b>] [<b>-verbose</b>] [<b>-mkey_convert</b>] [<b>-new_mkey_file</b> <u>mkey_file</u>] [<b>-rev</b>] [<b>-recurse</b>] [<u>filename</u>
          [<u>principals</u>...]]

       Dumps  the current Kerberos and KADM5 database into an ASCII file.  By default, the database is dumped in
       current format, "kdb5_util load_dump version 7".  If filename is not specified, or is the string "-", the
       dump is sent to standard output.  Options:

       <b>-b7</b>    causes the dump to be in the Kerberos 5 Beta 7 format ("kdb5_util load_dump version 4").  This was
              the dump format produced on releases prior to 1.2.2.

       <b>-r13</b>   causes the dump to be in the Kerberos 5 1.3 format ("kdb5_util load_dump version  5").   This  was
              the dump format produced on releases prior to 1.8.

       <b>-r18</b>   causes  the  dump  to be in the Kerberos 5 1.8 format ("kdb5_util load_dump version 6").  This was
              the dump format produced on releases prior to 1.11.

       <b>-verbose</b>
              causes the name of each principal and policy to be printed as it is dumped.

       <b>-mkey_convert</b>
              prompts for a new master key.  This new master key will be used to re-encrypt principal  key  data
              in the dumpfile.  The principal keys themselves will not be changed.

       <b>-new_mkey_file</b> <u>mkey_file</u>
              the  filename  of  a stash file.  The master key in this stash file will be used to re-encrypt the
              key data in the dumpfile.  The key data in the database will not be changed.

       <b>-rev</b>   dumps in reverse order.  This may recover principals that do not dump  normally,  in  cases  where
              database corruption has occurred.

       <b>-recurse</b>
              causes  the  dump to walk the database recursively (btree only).  This may recover principals that
              do not dump normally, in  cases  where  database  corruption  has  occurred.   In  cases  of  such
              corruption, this option will probably retrieve more principals than the <b>-rev</b> option will.

              Changed in version 1.15: Release 1.15 restored the functionality of the <b>-recurse</b> option.

              Changed in version 1.5: The <b>-recurse</b> option ceased working until release 1.15, doing a normal dump
              instead of a recursive traversal.

   <b>load</b>
          <b>load</b> [<b>-b7</b>|<b>-r13</b>|<b>-r18</b>] [<b>-hash</b>] [<b>-verbose</b>] [<b>-update</b>] <u>filename</u>

       Loads  a  database  dump from the named file into the named database.  If no option is given to determine
       the format of the dump file, the format is detected automatically and handled as appropriate.  Unless the
       <b>-update</b> option is given, <b>load</b> creates a  new  database  containing  only  the  data  in  the  dump  file,
       overwriting the contents of any previously existing database.  Note that when using the LDAP KDC database
       module, the <b>-update</b> flag is required.

       Options:

       <b>-b7</b>    requires  the  database  to  be in the Kerberos 5 Beta 7 format ("kdb5_util load_dump version 4").
              This was the dump format produced on releases prior to 1.2.2.

       <b>-r13</b>   requires the database to be in Kerberos 5 1.3 format ("kdb5_util load_dump version 5").  This  was
              the dump format produced on releases prior to 1.8.

       <b>-r18</b>   requires  the database to be in Kerberos 5 1.8 format ("kdb5_util load_dump version 6").  This was
              the dump format produced on releases prior to 1.11.

       <b>-hash</b>  stores the database in hash format, if using the  DB2  database  type.   If  this  option  is  not
              specified,  the  database  will  be  stored  in  btree format.  This option is not recommended, as
              databases stored in hash format are known to corrupt data and lose principals.

       <b>-verbose</b>
              causes the name of each principal and policy to be printed as it is dumped.

       <b>-update</b>
              records from the dump file are added to or updated in the existing  database.   Otherwise,  a  new
              database  is  created  containing  only  what  is  in the dump file and the old one destroyed upon
              successful completion.

   <b>ark</b>
          <b>ark</b> [<b>-e</b> <u>enc</u>:<u>salt</u>,...] <u>principal</u>

       Adds new random keys to <u>principal</u> at the next available key version number.  Keys for the current highest
       key version number will be preserved.  The <b>-e</b> option specifies the list of encryption and salt  types  to
       be used for the new keys.

   <b>add_mkey</b>
          <b>add_mkey</b> [<b>-e</b> <u>etype</u>] [<b>-s</b>]

       Adds  a new master key to the master key principal, but does not mark it as active.  Existing master keys
       will remain.  The <b>-e</b> option specifies the encryption type of the new master key; see Encryption_types  in
       <a href="../man5/kdc.conf.5.html">kdc.conf</a>(5)  for  a list of possible values.  The <b>-s</b> option stashes the new master key in the stash file,
       which will be created if it doesn't already exist.

       After a new master key is added, it should be propagated to replica servers  via  a  manual  or  periodic
       invocation  of  <a href="../man8/kprop.8.html">kprop</a>(8).   Then,  the  stash  files  on  the  replica servers should be updated with the
       kdb5_util <b>stash</b> command.  Once those steps are complete, the key is ready to be marked  active  with  the
       kdb5_util <b>use_mkey</b> command.

   <b>use_mkey</b>
          <b>use_mkey</b> <u>mkeyVNO</u> [<u>time</u>]

       Sets  the  activation  time of the master key specified by <u>mkeyVNO</u>.  Once a master key becomes active, it
       will be used to encrypt newly created principal keys.  If no <u>time</u> argument is given, the current time  is
       used,  causing  the  specified  master  key version to become active immediately.  The format for <u>time</u> is
       getdate string.

       After a new master key becomes active, the kdb5_util  <b>update_princ_encryption</b>  command  can  be  used  to
       update all principal keys to be encrypted in the new master key.

   <b>list_mkeys</b>
          <b>list_mkeys</b>

       List  all  master  keys, from most recent to earliest, in the master key principal.  The output will show
       the kvno, enctype, and salt type for each mkey, similar  to  the  output  of  <a href="../man1/kadmin.1.html">kadmin</a>(1)  <b>getprinc</b>.   A  <b>*</b>
       following an mkey denotes the currently active master key.

   <b>purge_mkeys</b>
          <b>purge_mkeys</b> [<b>-f</b>] [<b>-n</b>] [<b>-v</b>]

       Delete  master  keys  from  the  master  key principal that are not used to protect any principals.  This
       command can be used to remove old master keys all principal keys are protected by a newer master key.

       <b>-f</b>     does not prompt for confirmation.

       <b>-n</b>     performs a dry run, showing master keys that would be purged, but not actually purging any keys.

       <b>-v</b>     gives more verbose output.

   <b>update_princ_encryption</b>
          <b>update_princ_encryption</b> [<b>-f</b>] [<b>-n</b>] [<b>-v</b>] [<u>princ-pattern</u>]

       Update all principal records (or only those matching the <u>princ-pattern</u> glob pattern)  to  re-encrypt  the
       key  data using the active database master key, if they are encrypted using a different version, and give
       a count at the end of the number of principals  updated.   If  the  <b>-f</b>  option  is  not  given,  ask  for
       confirmation  before  starting  to  make  changes.   The  <b>-v</b> option causes each principal processed to be
       listed, with an indication as to whether it needed updating or not.  The <b>-n</b> option performs  a  dry  run,
       only showing the actions which would have been taken.

   <b>tabdump</b>
          <b>tabdump</b> [<b>-H</b>] [<b>-c</b>] [<b>-e</b>] [<b>-n</b>] [<b>-o</b> <u>outfile</u>] <u>dumptype</u>

       Dump  selected fields of the database in a tabular format suitable for reporting (e.g., using traditional
       Unix text processing tools) or importing into relational databases.  The  data  format  is  tab-separated
       (default), or optionally comma-separated (CSV), with a fixed number of columns.  The output begins with a
       header line containing field names, unless suppression is requested using the <b>-H</b> option.

       The <u>dumptype</u> parameter specifies the name of an output table (see below).

       Options:

       <b>-H</b>     suppress writing the field names in a header line

       <b>-c</b>     use   comma  separated  values  (CSV)  format,  with  minimal  quoting,  instead  of  the  default
              tab-separated (unquoted, unescaped) format

       <b>-e</b>     write empty hexadecimal string fields as empty fields instead of as "-1".

       <b>-n</b>     produce numeric output for fields that normally have symbolic output, such as  enctypes  and  flag
              names.  Also requests output of time stamps as decimal POSIX time_t values.

       <b>-o</b> <u>outfile</u>
              write the dump to the specified output file instead of to standard output

       Dump types:

       <b>keydata</b>
              principal  encryption  key information, including actual key data (which is still encrypted in the
              master key)

              <b>name</b>   principal name

              <b>keyindex</b>
                     index of this key in the principal's key list

              <b>kvno</b>   key version number

              <b>enctype</b>
                     encryption type

              <b>key</b>    key data as a hexadecimal string

              <b>salttype</b>
                     salt type

              <b>salt</b>   salt data as a hexadecimal string

       <b>keyinfo</b>
              principal encryption key information (as in <b>keydata</b> above), excluding actual key data

       <b>princ_flags</b>
              principal boolean attributes.  Flag names print  as  hexadecimal  numbers  if  the  <b>-n</b>  option  is
              specified, and all flag positions are printed regardless of whether or not they are set.  If <b>-n</b> is
              not  specified,  print  all  known  flag names for each principal, but only print hexadecimal flag
              names if the corresponding flag is set.

              <b>name</b>   principal name

              <b>flag</b>   flag name

              <b>value</b>  boolean value (0 for clear, or 1 for set)

       <b>princ_lockout</b>
              state information used for tracking repeated password failures

              <b>name</b>   principal name

              <b>last_success</b>
                     time stamp of most recent successful authentication

              <b>last_failed</b>
                     time stamp of most recent failed authentication

              <b>fail_count</b>
                     count of failed attempts

       <b>princ_meta</b>
              principal metadata

              <b>name</b>   principal name

              <b>modby</b>  name of last principal to modify this principal

              <b>modtime</b>
                     timestamp of last modification

              <b>lastpwd</b>
                     timestamp of last password change

              <b>policy</b> policy object name

              <b>mkvno</b>  key version number of the master key that encrypts this principal's key data

              <b>hist_kvno</b>
                     key version number of the history key that encrypts the key history data for this principal

       <b>princ_stringattrs</b>
              string attributes (key/value pairs)

              <b>name</b>   principal name

              <b>key</b>    attribute name

              <b>value</b>  attribute value

       <b>princ_tktpolicy</b>
              per-principal ticket policy data, including maximum ticket lifetimes

              <b>name</b>   principal name

              <b>expiration</b>
                     principal expiration date

              <b>pw_expiration</b>
                     password expiration date

              <b>max_life</b>
                     maximum ticket lifetime

              <b>max_renew_life</b>
                     maximum renewable ticket lifetime

       Examples:

          $ kdb5_util tabdump -o keyinfo.txt keyinfo
          $ cat keyinfo.txt
          name        keyindex        kvno    enctype salttype        salt
          K/<a href="mailto:M@EXAMPLE.COM">M@EXAMPLE.COM</a>     0       1       aes256-cts-hmac-sha384-192      normal  -1
          <a href="mailto:foo@EXAMPLE.COM">foo@EXAMPLE.COM</a>     0       1       aes128-cts-hmac-sha1-96 normal  -1
          <a href="mailto:bar@EXAMPLE.COM">bar@EXAMPLE.COM</a>     0       1       aes128-cts-hmac-sha1-96 normal  -1
          $ sqlite3
          sqlite&gt; .mode tabs
          sqlite&gt; .import keyinfo.txt keyinfo
          sqlite&gt; select * from keyinfo where enctype like 'aes256-%';
          K/<a href="mailto:M@EXAMPLE.COM">M@EXAMPLE.COM</a>     1       1       aes256-cts-hmac-sha384-192      normal  -1
          sqlite&gt; .quit
          $ awk -F'\t' '$4 ~ /aes256-/ { print }' keyinfo.txt
          K/<a href="mailto:M@EXAMPLE.COM">M@EXAMPLE.COM</a>     1       1       aes256-cts-hmac-sha384-192      normal  -1

</pre><h4><b>ENVIRONMENT</b></h4><pre>
       See <a href="../man7/kerberos.7.html">kerberos</a>(7) for a description of Kerberos environment variables.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man1/kadmin.1.html">kadmin</a>(1), <a href="../man7/kerberos.7.html">kerberos</a>(7)

</pre><h4><b>AUTHOR</b></h4><pre>
       MIT

</pre><h4><b>COPYRIGHT</b></h4><pre>
       1985-2024, MIT

1.21.3                                                                                              <u><a href="../man8/KDB5_UTIL.8.html">KDB5_UTIL</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>