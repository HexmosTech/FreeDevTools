<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cnid_dbd — CNID database access daemon</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/netatalk">netatalk_4.2.3~ds-1_amd64</a> <br><br><pre>
</pre><h4><b>Name</b></h4><pre>
       cnid_dbd — CNID database access daemon

</pre><h4><b>Synopsis</b></h4><pre>
       <b>cnid_dbd</b>

       <b>cnid_dbd</b> [-v | -V]

</pre><h4><b>Description</b></h4><pre>
       <b>cnid_dbd</b>  provides  an  interface  for  storage  and  retrieval  of  catalog node IDs (CNIDs) and related
       information to the <u>afpd</u> daemon. CNIDs are a component of Macintosh based file systems with semantics that
       map not easily onto Unix file systems. This makes separate storage in a database necessary.  <b>cnid_dbd</b>  is
       part of the <u>CNID</u> <u>backend</u> framework of <u>afpd</u> and implements the <u>dbd</u> backend.

       <b>cnid_dbd</b>  is  never  started  via  the  command line or system startup scripts but only by the <u>cnid_metad</u>
       daemon. There is one instance of <b>cnid_dbd</b> per netatalk volume.

       <b>cnid_dbd</b> uses the <u>Berkeley</u> <u>DB</u> database library  and  uses  transactionally  protected  updates.  The  <u>dbd</u>
       backend  with  transactions  will  avoid  corruption  of  the  CNID  database  even if the system crashes
       unexpectedly.

       <b>cnid_dbd</b> inherits the effective userid and groupid from <u>cnid_metad</u> on startup, which is  normally  caused
       by  <u>afpd</u>  serving  a  netatalk  volume to a client. It changes to the <u>Berkeley</u> <u>DB</u> database home directory
       <u>dbdir</u> that is associated with the volume. If the userid inherited from <u>cnid_metad</u> is 0  (root),  <b>cnid_dbd</b>
       will  change userid and groupid to the owner and group of the database home directory. Otherwise, it will
       continue to use the inherited values. <b>cnid_dbd</b> will then attempt to open the database and  start  serving
       requests  using  filedescriptor  <u>clntfd</u>. Subsequent instances of <u>afpd</u> that want to access the same volume
       are redirected to the running <b>cnid_dbd</b> process by <u>cnid_metad</u> via the filedescriptor <u>ctrlfd</u>.

       <b>cnid_dbd</b> can be configured to run forever or to exit after a period of inactivity. If <b>cnid_dbd</b> receives a
       TERM or an INT signal it will exit cleanly after flushing dirty database  buffers  to  disk  and  closing
       <u>Berkeley</u>  <u>DB</u>  database environments. It is safe to terminate <b>cnid_dbd</b> this way, it will be restarted when
       necessary. Other signals are not handled and will cause an immediate  exit,  possibly  leaving  the  CNID
       database   in  an  inconsistent  state  (no  transactions)  or  losing  recent  updates  during  recovery
       (transactions).

       The <u>Berkeley</u> <u>DB</u> database subsystem will create files named log.xxxxxxxxxx in the database home  directory
       <u>dbdir</u>,  where  xxxxxxxxxx  is  a  monotonically increasing integer. These files contain the transactional
       database changes. They will be removed regularly, unless the <b>logfile_autoremove</b> option  is  specified  in
       the <u>db_param</u> configuration file (see below) with a value of 0 (default 1).

</pre><h4><b>Options</b></h4><pre>
       <b>-v</b> | <b>-V</b>

              Show version and exit.

</pre><h4><b>Configuration</b></h4><pre>
       <b>cnid_dbd</b>  reads  configuration  information  from  the  file  <u>db_param</u> in the database directory <u>dbdir</u> on
       startup. If the file does not exist or a parameter is not listed, suitable default values are  used.  The
       format  for  a  single  parameter  is the parameter name, followed by one or more spaces, followed by the
       parameter value, followed by a newline. The following parameters are currently recognized:

       <b>logfile_autoremove</b>

              If set to 0, unused Berkeley DB  transactional  logfiles  (log.xxxxxxxxxx  in  the  database  home
              directory) are not removed on startup of <b>cnid_dbd</b> and on a regular basis. Default: 1.

       <b>cachesize</b>

              Determines  the  size of the Berkeley DB cache in kilobytes.  Default: 8192. Each <b>cnid_dbd</b> process
              grabs that much memory on top of its normal memory footprint. It can  be  used  to  tune  database
              performance.  The  <u>db_stat</u>  utility  with  the  <b>-m</b> option that comes with Berkeley DB can help you
              determine whether you need to change this value. The default is  pretty  conservative  so  that  a
              large  percentage  of  requests  should  be  satisfied from the cache directly. If memory is not a
              bottleneck on your system you might want to leave it at that value. The <u>Berkeley</u> <u>DB</u>  <u>Tutorial</u>  <u>and</u>
              <u>Reference</u> <u>Guide</u> has a section <u>Selecting</u> <u>a</u> <u>cache</u> <u>size</u> that gives more detailed information.

       <b>flush_frequency</b>; <b>flush_interval</b>

              <b>flush_frequency</b>  (Default:  1000)  and <b>flush_interval</b> (Default: 1800) control how often changes to
              the database are checkpointed. Both of these operations are  performed  if  either  i)  more  than
              <b>flush_frequency</b>  requests  have been received or ii) more than <b>flush_interval</b> seconds have elapsed
              since the last save/checkpoint. Be careful to check your hard disk configuration for on disk cache
              settings. Many IDE disks just cache writes as the default behaviour,  so  even  flushing  database
              files to disk will not have the desired effect.

       <b>fd_table_size</b>

              is  the maximum number of connections (filedescriptors) that can be open for <u>afpd</u> client processes
              in <u>cnid_dbd.</u> Default: 512. If this number is exceeded, one of the existing connections  is  closed
              and  reused.  The  affected  <u>afpd</u>  process will transparently reconnect later, which causes slight
              overhead. On the other hand, setting this parameter too high could affect performance in  <b>cnid_dbd</b>
              since all descriptors have to be checked in a <u>select()</u> system call, or worse, you might exceed the
              per  process  limit  of  open file descriptors on your system. It is safe to set the value to 1 on
              volumes where only one <u>afpd</u> client process is expected to run, e.g. home directories.

       <b>idle_timeout</b>

              is the number of seconds of inactivity before an idle <b>cnid_dbd</b> exits.  Default: 600. Set this to 0
              to disable the timeout.

</pre><h4><b>Updating</b></h4><pre>
       Starting with Netatalk 2.1.1, automatic Berkeley DB updates are supported, as long as Netatalk  2.1.0  or
       later was used to create the database.

       In  order  to update between older Netatalk releases using different Berkeley DB library versions, follow
       these steps:

       • Stop the to be upgraded old version of Netatalk

       • Using the old Berkeley DB utilities run <u>db_recover</u> <u>-h</u> <u>path/to/.AppleDB</u>

       • Using the new Berkeley DB utilities run <u>db_upgrade</u> <u>-v</u> <u>-h</u> <u>path/to/.AppleDB</u> <u>-f</u> <u>cnid2.db</u>

       • Again using the new Berkeley DB utilities run <u>db_checkpoint</u> <u>-1</u> <u>-h</u> <u>path/to/.AppleDB</u>

       • Start the the new version of Netatalk

</pre><h4><b>See</b> <b>Also</b></h4><pre>
       <a href="../man8/cnid_metad.8.html">cnid_metad</a>(8), <a href="../man8/afpd.8.html">afpd</a>(8), <a href="../man1/dbd.1.html">dbd</a>(1)

</pre><h4><b>Author</b></h4><pre>
       Contributors to the Netatalk Project (https://netatalk.io/contributors)

Netatalk 4.2.3                                                                                       <u><a href="../man8/CNID_DBD.8.html">CNID_DBD</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>