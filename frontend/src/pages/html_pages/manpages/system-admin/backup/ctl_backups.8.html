<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ctl_backups - Cyrus IMAP documentation</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/cyrus-common">cyrus-common_3.10.2-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ctl_backups - Cyrus IMAP documentation

       Perform administrative operations directly on Cyrus backups.

</pre><h4><b>SYNOPSIS</b></h4><pre>
          <b>ctl_backups</b> [OPTIONS] compact [MODE] <u>backup</u>...
          <b>ctl_backups</b> [OPTIONS] list [LIST OPTIONS] [[MODE] <u>backup</u>...]
          <b>ctl_backups</b> [OPTIONS] lock [LOCK OPTIONS] [MODE] <u>backup</u>
          <b>ctl_backups</b> [OPTIONS] reindex [MODE] <u>backup</u>...
          <b>ctl_backups</b> [OPTIONS] stat [MODE] <u>backup</u>...
          <b>ctl_backups</b> [OPTIONS] verify [MODE] <u>backup</u>...

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>NOTE:</b>
          Cyrus Backups are experimental, incomplete, and deprecated as of 3.10.

       <b>ctl_backups</b> is a tool for performing administrative operations on Cyrus backups.

       <b>ctl_backups</b>  reads  its configuration options out of the <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u> file unless specified otherwise by
       <b>-C</b>.

       In all invocations, <u>backup</u> is interpreted according to the specified MODE.  See <u>Modes</u> below.

       <b>ctl_backups</b> provides the following sub-commands:

       <b>compact</b>
              Reduce  storage  required  by  the  named  backups.   Compact  behaviour  is  influenced  by   the
              <b>backup_compact_minsize</b>,       <b>backup_compact_maxsize</b>,      <b>backup_compact_work_threshold</b>,      and
              <b>backup_retention_days</b> configuration settings.  See <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u> for details.

              This should generally be invoked regularly, such as by adding an entry to the  EVENTS  section  of
              <u><a href="../man5/cyrus.conf.5.html">cyrus.conf</a>(5)</u>.  See <u>Examples</u> for an example.

              If  the  <b>backup_keep_previous</b> configuration setting is enabled, compact will preserve the original
              data and index files (renaming them with a timestamp).  This is useful for debugging.

       <b>list</b>   List backups.  See <u>List</u> <u>Options</u> for  options  specific  to  the  <b>list</b>  sub-command.   Columns  are
              separated by tabs, and are:

              • end time of latest chunk

              • size of backup data file on disk

              • userid to which the backup belongs

              • path to backup data file

              If no <u>mode</u> or backups are specified, lists all known backups (as if invoked with the <b>-A</b> mode).

       <b>lock</b>   Obtain  and  hold  a  lock  on the named backup.  Useful for operating on Cyrus backup files using
              non-Cyrus tools (such as UNIX tools or custom scripts) in relative safety.  See <u>Lock</u>  <u>Options</u>  for
              details.

       <b>reindex</b>
              Rebuild  the indexes for the named backups, based on the raw backup data.  This is useful if their
              index files have been corrupted, or if the index format has changed.

              If the <b>backup_keep_previous</b> configuration setting is enabled, reindex will preserve  the  original
              index file (renaming it with a timestamp).  This is useful for debugging.

       <b>stat</b>   Display stats for the named backups.  Columns are separated by tabs, and are:

              • userid or filename

              • compressed (i.e. on disk) size

              • uncompressed size

              • compactable size

              • compression ratio

              • utilisation ratio

              • start time of latest chunk

              • end time of latest chunk

              The  compactable size is an approximation of how much uncompressed data would remain after <b>compact</b>
              is performed.  The utilisation ratio is this figure expressed as a percentage of the  uncompressed
              size.   Note  that this approximation is an underestimate.  That is to say, a backup that has just
              been compacted will probably still report less than 100% utilisation.

       <b>verify</b> Verify consistency of the named backups by performing deep checks on both the raw backup data  and
              its index.

</pre><h4><b>OPTIONS</b></h4><pre>
       <b>-C</b> <b>config-file</b>
              Use the specified configuration file <u>config-file</u> rather than the default <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u>.

       <b>-F,</b> <b>--force</b>
              Force  the  operation to occur, even if it is determined to be unnecessary.  This is mostly useful
              with the <b>compact</b> sub-command.

       <b>-S,</b> <b>--stop-on-error</b>
              Stop-on-error.  With this option, if a sub-command fails for any  particular  backup,  <b>ctl_backups</b>
              will immediately exit with an error, without processing further backups.

              The default is to log the error, and continue with the next backup.

       <b>-V,</b> <b>--no-verify</b>
              Don't verify backup checksums for read-only operations.

              The  read-only operations <b>list</b> and <b>stat</b> will normally perform a "quick" verification of the backup
              file being read, which checks the checksums of the most  recent  chunk.   This  can  be  slow  for
              backups whose most recent backup chunk is very large.

              With this option, the verification step will be skipped.

       <b>-j,</b> <b>--json</b>
              Produce output in JSON format.  The default is plain text.

       <b>-v,</b> <b>--verbose</b>
              Increase the verbosity.  Can be specified multiple times.

       <b>-w,</b> <b>--wait-for-locks</b>
              Wait for locks.  With this option, if a backup named on the command line is locked, execution will
              block until the lock becomes available.

              The default is to skip backups that are currently locked.

</pre><h4><b>LIST</b> <b>OPTIONS</b></h4><pre>
       Options that apply only to the <b>list</b> sub-command.

       <b>-t</b> <b>[hours],</b> <b>--stale[=hours]</b>
              List  stale  backups  only,  that is, backups that have received no updates in <u>hours</u>.  If <u>hours</u> is
              unspecified, it defaults to 24.

</pre><h4><b>LOCK</b> <b>OPTIONS</b></h4><pre>
       Options that apply only to the <b>lock</b> sub-command.

       <b>-c,</b> <b>--create</b>
              Exclusively create the named backup while obtaining the lock.  Exits immediately with an error  if
              the named backup already exists.

              When the lock is successfully obtained, continue as per the other options.

       <b>-p,</b> <b>--pause</b>
              Locks  the  named backup, and then waits for EOF on the standard input stream.  Unlocks the backup
              and exits once EOF is received.  This is the default mode of operation.

       <b>-s,</b> <b>--sqlite3</b>
              Locks the named backup, and with the lock held, opens its index file in  the  <b><a href="../man1/sqlite3.1.html">sqlite3</a>(1)</b>  program.
              The lock is automatically released when sqlite3 exits.

       <b>-x</b> <b>command,</b> <b>--execute=command</b>
              Locks the named backup, and with the lock held, executes <u>command</u> using <b><a href="file:/bin/sh">/bin/sh</a></b> (as per <b><a href="../man3/system.3.html">system</a>(3)</b>).
              The lock is automatically released when <u>command</u> completes.

              The  filenames  of  the  backup  data  and  index are made available to <u>command</u> in the environment
              variables <b>$ctl_backups_lock_data_fname</b> and <b>$ctl_backups_lock_index_fname</b>, respectively.

</pre><h4><b>MODES</b></h4><pre>
       <b>-A,</b> <b>--all</b>
              Run sub-command over all known backups.

              Known backups are  recorded  in  the  database  specified  by  the  <b>backup_db</b>  and  <b>backup_db_path</b>
              configuration options.

       <b>-D,</b> <b>--domains</b>
              Backups  specified  on  the  command  line are interpreted as domains.  Run sub-command over known
              backups for users in these domains.

       <b>-P,</b> <b>--prefixes</b>
              Backups specified on the command line are interpreted as userid prefixes.   Run  sub-command  over
              known backups for users matching these prefixes.

       <b>-f,</b> <b>--filenames</b>
              Backups  specified  on  the  command  line are interpreted as filenames.  Run sub-command over the
              matching backup files.  The backup files do not need to be known about in the backups database.

       <b>-m,</b> <b>--mailboxes</b>
              Backups specified on the command line are interpreted as  mailbox  names.   Run  sub-command  over
              known backups containing these mailboxes.

       <b>-u,</b> <b>--userids</b>
              Backups  specified  on  the  command  line are interpreted as userids.  Run sub-command over known
              backups for matching users.

              This is the default if no mode is specified.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Scheduling <b>ctl_backups</b> <b>compact</b> to run each morning using the EVENTS section of <u><a href="../man5/cyrus.conf.5.html">cyrus.conf</a>(5)</u>:

          EVENTS {
              checkpoint    cmd="ctl_cyrusdb -c" period=30

              <b>compact</b>       <b>cmd="ctl_backups</b> <b>compact</b> <b>-A"</b> <b>at=0400</b>
          }

</pre><h4><b>HISTORY</b></h4><pre>
</pre><h4><b>FILES</b></h4><pre>
</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man5/imapd.conf.5.html">imapd.conf</a>(5)</u>, <b><a href="../man1/sqlite3.1.html">sqlite3</a>(1)</b>, <b><a href="../man3/system.3.html">system</a>(3)</b>

</pre><h4><b>AUTHOR</b></h4><pre>
       The Cyrus Team

</pre><h4><b>COPYRIGHT</b></h4><pre>
       1993–2025, The Cyrus Team

3.10.2                                            Jun 27, 2025                                    <u><a href="../man8/CTL_BACKUPS.8.html">CTL_BACKUPS</a></u>(8)
</pre>
 </div>
</div></section>
</div>
</body>
</html>