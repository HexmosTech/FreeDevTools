<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ntp_adjtime, ntp_gettime — Network Time Protocol (NTP) daemon interface system calls</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ntp_adjtime, ntp_gettime — Network Time Protocol (NTP) daemon interface system calls

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C Library (libc, -lc)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/timex.h&gt;</b>

       <u>int</u>
       <b>ntp_adjtime</b>(<u>struct</u> <u>timex</u> <u>*</u>);

       <u>int</u>
       <b>ntp_gettime</b>(<u>struct</u> <u>ntptimeval</u> <u>*</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  two  system  calls  <b>ntp_adjtime</b>()  and  <b>ntp_gettime</b>()  are  the kernel interface to the Network Time
       Protocol (NTP) daemon <u><a href="../man8/ntpd.8.html">ntpd</a></u>(8).

       The <b>ntp_adjtime</b>() function is used by the NTP daemon to adjust the system clock to an externally  derived
       time.   The  time  offset and related variables which are set by <b>ntp_adjtime</b>() are used by <b>hardclock</b>() to
       adjust the phase and frequency of the phase- or frequency-lock loop (PLL resp. FLL)  which  controls  the
       system clock.

       The  <b>ntp_gettime</b>()  function  provides  the  time,  maximum  error  (sync  distance)  and estimated error
       (dispersion) to client user application programs.

       In the following, all variables that refer PPS are only relevant if the <u>PPS_SYNC</u> option is enabled in the
       kernel.

       <b>ntp_adjtime</b>() has as argument a <u>struct</u> <u>timex</u> <u>*</u> of the following form:

       struct timex {
               unsigned int modes;     /* clock mode bits (wo) */
               long offset;            /* time offset (us) (rw) */
               long freq;              /* frequency offset (scaled ppm) (rw) */
               long maxerror;          /* maximum error (us) (rw) */
               long esterror;          /* estimated error (us) (rw) */
               int status;             /* clock status bits (rw) */
               long constant;          /* pll time constant (rw) */
               long precision;         /* clock precision (us) (ro) */
               long tolerance;         /* clock frequency tolerance (scaled
                                        * ppm) (ro) */
               /*
                * The following read-only structure members are implemented
                * only if the PPS signal discipline is configured in the
                * kernel.
                */
               long ppsfreq;           /* pps frequency (scaled ppm) (ro) */
               long jitter;            /* pps jitter (us) (ro) */
               int shift;              /* interval duration (s) (shift) (ro) */
               long stabil;            /* pps stability (scaled ppm) (ro) */
               long jitcnt;            /* jitter limit exceeded (ro) */
               long calcnt;            /* calibration intervals (ro) */
               long errcnt;            /* calibration errors (ro) */
               long stbcnt;            /* stability limit exceeded (ro) */
       };

       The members of this struct have the following meanings when used as argument for <b>ntp_adjtime</b>():
       <u>modes</u>      Defines what settings should be changed with  the  current  <b>ntp_adjtime</b>()  call  (write-only).
                  Bitwise OR of the following:
                        MOD_OFFSET     set time offset
                        MOD_FREQUENCY  set frequency offset
                        MOD_MAXERROR   set maximum time error
                        MOD_ESTERROR   set estimated time error
                        MOD_STATUS     set clock status bits
                        MOD_TIMECONST  set PLL time constant
                        MOD_CLKA       set clock A
                        MOD_CLKB       set clock B
       <u>offset</u>     Time  offset  (in  microseconds),  used  by  the  PLL/FLL  to  adjust the system time in small
                  increments (read-write).
       <u>freq</u>       Frequency offset (scaled ppm) (read-write).
       <u>maxerror</u>   Maximum error (in microseconds).  Initialized by an <b>ntp_adjtime</b>() call, and increased  by  the
                  kernel once each second to reflect the maximum error bound growth (read-write).
       <u>esterror</u>   Estimated  error  (in  microseconds).  Set and read by <b>ntp_adjtime</b>(), but unused by the kernel
                  (read-write).
       <u>status</u>     System clock status bits (read-write).  Bitwise OR of the following:
                        STA_PLL        Enable PLL updates (read-write).
                        STA_PPSFREQ    Enable PPS freq discipline (read-write).
                        STA_PPSTIME    Enable PPS time discipline (read-write).
                        STA_FLL        Select frequency-lock mode (read-write).
                        STA_INS        Insert leap (read-write).
                        STA_DEL        Delete leap (read-write).
                        STA_UNSYNC     Clock unsynchronized (read-write).
                        STA_FREQHOLD   Hold frequency (read-write).
                        STA_PPSSIGNAL  PPS signal present (read-only).
                        STA_PPSJITTER  PPS signal jitter exceeded (read-only).
                        STA_PPSWANDER  PPS signal wander exceeded (read-only).
                        STA_PPSERROR   PPS signal calibration error (read-only).
                        STA_CLOCKERR   Clock hardware fault (read-only).
       <u>constant</u>   PLL time constant, determines the bandwidth, or “stiffness”, of the PLL (read-write).
       <u>precision</u>  Clock precision (in microseconds).  In most cases the same as the kernel  tick  variable  (see
                  <u><a href="../man9/hz.9.html">hz</a></u>(9)).   If  a precision clock counter or external time-keeping signal is available, it could
                  be much lower (and depend on the state of the signal) (read-only).
       <u>tolerance</u>  Maximum frequency error, or tolerance of the CPU clock oscillator (scaled ppm).  Ordinarily  a
                  property  of  the  architecture, but could change under the influence of external time-keeping
                  signals (read-only).
       <u>ppsfreq</u>    PPS frequency offset produced by the frequency median filter (scaled ppm) (read-only).
       <u>jitter</u>     PPS jitter measured by the time median filter in microseconds (read-only).
       <u>shift</u>      Logarithm to base 2 of the interval duration in seconds (PPS, read-only).
       <u>stabil</u>     PPS stability (scaled ppm); dispersion (wander) measured by the frequency median filter (read-
                  only).
       <u>jitcnt</u>     Number of seconds that have been discarded because the jitter  measured  by  the  time  median
                  filter exceeded the limit <u>MAXTIME</u> (PPS, read-only).
       <u>calcnt</u>     Count of calibration intervals (PPS, read-only).
       <u>errcnt</u>     Number of calibration intervals that have been discarded because the wander exceeded the limit
                  <u>MAXFREQ</u> or where the calibration interval jitter exceeded two ticks (PPS, read-only).
       <u>stbcnt</u>     Number of calibration intervals that have been discarded because the frequency wander exceeded
                  the limit <u>MAXFREQ</u>/4 (PPS, read-only).
       After  the  <b>ntp_adjtime</b>()  call,  the  <u>struct</u>  <u>timex</u>  <u>*</u>  structure  contains  the  current  values of the
       corresponding variables.

       <b>ntp_gettime</b>() has as argument a <u>struct</u> <u>ntptimeval</u> <u>*</u> with the following members:

       struct ntptimeval {
               struct timeval time;    /* current time (ro) */
               long maxerror;          /* maximum error (us) (ro) */
               long esterror;          /* estimated error (us) (ro) */
       };

       These have the following meaning:
       <u>time</u>       Current time (read-only).
       <u>maxerror</u>   Maximum error in microseconds (read-only).
       <u>esterror</u>   Estimated error in microseconds (read-only).

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       <b>ntp_adjtime</b>() and <b>ntp_gettime</b>() return the current state of the clock on success, or any of the errors of
       <u><a href="../man9/copyin.9.html">copyin</a></u>(9) and <u><a href="../man9/copyout.9.html">copyout</a></u>(9).  <b>ntp_adjtime</b>() may additionally return EPERM if the user calling  <b>ntp_adjtime</b>()
       does not have sufficient permissions.

       Possible states of the clock are:
             TIME_OK     Everything okay, no leap second warning.
             TIME_INS    “insert  leap  second”  warning.  At the end of the day, a leap second will be inserted
                         after 23:59:59.
             TIME_DEL    “delete leap second” warning.  At the end of the day, second 23:59:59 will be skipped.
             TIME_OOP    Leap second in progress.
             TIME_WAIT   Leap second has occurred within the last few seconds.
             TIME_ERROR  Clock not synchronized.

</pre><h4><b>ERRORS</b></h4><pre>
       The <b>ntp_adjtime</b>() system call may return EPERM if the caller does not have sufficient permissions.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man4/options.4.html">options</a></u>(4), <u><a href="../man8/ntpd.8.html">ntpd</a></u>(8), <u><a href="../man9/hardclock.9.html">hardclock</a></u>(9), <u><a href="../man9/hz.9.html">hz</a></u>(9)

       <u><a href="http://www.bipm.fr/enus/5_Scientific/c_time/time_1.html">http://www.bipm.fr/enus/5_Scientific/c_time/time_1.html</a></u>

       <u><a href="http://www.boulder.nist.gov/timefreq/general/faq.htm">http://www.boulder.nist.gov/timefreq/general/faq.htm</a></u>

       <u><a href="ftp://time.nist.gov/pub/leap-seconds.list">ftp://time.nist.gov/pub/leap-seconds.list</a></u>

</pre><h4><b>BUGS</b></h4><pre>
       Take note that this API is extremely complex and stateful.  Users should not attempt modification without
       first reviewing the <u><a href="../man8/ntpd.8.html">ntpd</a></u>(8) sources in depth.

Debian                                            July 13, 2005                                   <u><a href="../man2/NTP_ADJTIME.2.html">NTP_ADJTIME</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>