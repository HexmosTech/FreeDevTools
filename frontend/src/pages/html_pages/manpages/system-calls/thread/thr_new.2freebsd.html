<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>thr_new — create new thread of execution</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       thr_new — create new thread of execution

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C Library (libc, -lc)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/thr.h&gt;</b>

       <u>int</u>
       <b>thr_new</b>(<u>struct</u> <u>thr_param</u> <u>*param</u>, <u>int</u> <u>param_size</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>This</b>  <b>function</b> <b>is</b> <b>intended</b> <b>for</b> <b>implementing</b> <b>threading.</b>  <b>Normal</b> <b>applications</b> <b>should</b> <b>call</b> <u>pthread_create</u>(<b>3</b>)
       <b>instead.</b>

       The <b>thr_new</b>() system call creates a new kernel-scheduled thread  of  execution  in  the  context  of  the
       current process.  The newly created thread shares all attributes of the process with the existing kernel-
       scheduled threads in the process, but has private processor execution state.  The machine context for the
       new  thread  is  copied  from  the creating thread's context, including coprocessor state.  FPU state and
       specific machine registers are excluded from the copy.  These are set according to ABI  requirements  and
       syscall parameters.  The FPU state for the new thread is reinitialized to clean.

       The  <u>param</u>  structure supplies parameters affecting the thread creation.  The structure is defined in the
       &lt;<u>sys/thr.h</u>&gt; header as follows

       struct thr_param {
           void          (*start_func)(void *);
           void          *arg;
           char          *stack_base;
           size_t        stack_size;
           char          *tls_base;
           size_t        tls_size;
           long          *child_tid;
           long          *parent_tid;
           int           flags;
           struct rtprio *rtp;
       };
       and contains the following fields:

       <u>start_func</u>  Pointer to the thread entry function.  The kernel  arranges  for  the  new  thread  to  start
                   executing the function upon the first return to userspace.

       <u>arg</u>         Opaque argument supplied to the entry function.

       <u>stack_base</u>  Stack  base  address.  The stack must be allocated by the caller.  On some architectures, the
                   ABI might require that the system put information  on  the  stack  to  ensure  the  execution
                   environment for <u>start_func</u>.

       <u>stack_size</u>  Stack size.

       <u>tls_base</u>    TLS  base  address.  The value of TLS base is loaded into the ABI-defined machine register in
                   the new thread context.

       <u>tls_size</u>    TLS size.

       <u>child_tid</u>   Address to store the new thread identifier, for the child's use.

       <u>parent_tid</u>  Address to store the new thread identifier, for the parent's use.

                   Both <u>child_tid</u> and <u>parent_tid</u> are provided, with the intent that <u>child_tid</u> is used by the new
                   thread to get its thread identifier without issuing the <u><a href="../man2/thr_self.2.html">thr_self</a></u>(2) syscall, while <u>parent_tid</u>
                   is used by the thread creator.  The latter is separate from <u>child_tid</u> because the new  thread
                   might  exit  and free its thread data before the parent has a chance to execute far enough to
                   access it.

       <u>flags</u>       Thread creation flags.  The <u>flags</u> member may specify the following flags:

                   THR_SUSPENDED     Create the new thread in the suspended state.  The flag  is  not  currently
                                     implemented.

                   THR_SYSTEM_SCOPE  Create the system scope thread.  The flag is not currently implemented.

       <u>rtp</u>         Real-time  scheduling  priority for the new thread.  May be NULL to inherit the priority from
                   the creating thread.

       The <u>param_size</u> argument should be set to the size of the <u>param</u> structure.

       After the first successful creation of an additional thread, the process  is  marked  by  the  kernel  as
       multi-threaded.  In particular, the P_HADTHREADS flag is set in the process' p_flag (visible in the <u><a href="../man1/ps.1.html">ps</a></u>(1)
       output),  and several operations are executed in multi-threaded mode.  For instance, the <u><a href="../man2/execve.2.html">execve</a></u>(2) system
       call terminates all threads but the calling one on successful execution.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       If successful, <b>thr_new</b>() will return zero, otherwise -1 is returned, and <u>errno</u> is  set  to  indicate  the
       error.

</pre><h4><b>ERRORS</b></h4><pre>
       The <b>thr_new</b>() operation returns the following errors:

       [EFAULT]           The memory pointed to by the <u>param</u> argument is not valid.

       [EFAULT]           The memory pointed to by the <u>param</u> structure <u>child_tid</u>, <u>parent_tid</u> or <u>rtp</u> arguments is
                          not valid.

       [EFAULT]           The  specified stack base is invalid, or the kernel was unable to put required initial
                          data on the stack.

       [EINVAL]           The <u>param_size</u> argument specifies a negative value, or the value is greater  than  the
                          largest <u>struct</u> <u>param</u> size the kernel can interpret.

       [EINVAL]           The <u>rtp</u> member is not NULL and specifies invalid scheduling parameters.

       [EINVAL]           The specified TLS base is invalid.

       [EPERM]            The  caller  does  not  have permission to set the scheduling parameters or scheduling
                          policy.

       [EPROCLIM]         Creation of the new thread would exceed the RACCT_NTHR limit, see <u><a href="../man2/racct.2.html">racct</a></u>(2).

       [EPROCLIM]         Creation  of  the  new  thread  would  exceed  the   kern.threads.max_threads_per_proc
                          <u><a href="../man2/sysctl.2.html">sysctl</a></u>(2) limit.

       [ENOMEM]           There was not enough kernel memory to allocate the new thread structures.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/ps.1.html">ps</a></u>(1),   <u><a href="../man2/execve.2.html">execve</a></u>(2),  <u><a href="../man2/racct.2.html">racct</a></u>(2),  <u><a href="../man2/thr_exit.2.html">thr_exit</a></u>(2),  <u><a href="../man2/thr_kill.2.html">thr_kill</a></u>(2),  <u><a href="../man2/thr_kill2.2.html">thr_kill2</a></u>(2),  <u><a href="../man2/thr_self.2.html">thr_self</a></u>(2),  <u><a href="../man2/thr_set_name.2.html">thr_set_name</a></u>(2),
       <b>_</b><u><a href="../man2/umtx_op.2.html">umtx_op</a></u>(2), <u><a href="../man3/pthread_create.3.html">pthread_create</a></u>(3)

</pre><h4><b>STANDARDS</b></h4><pre>
       The <b>thr_new</b>() system call is non-standard and is used by the 1:1 Threading  Library  (libthr,  -lthr)  to
       implement IEEE Std 1003.1-2001 (“POSIX.1”) <u><a href="../man3/pthread.3.html">pthread</a></u>(3) functionality.

Debian                                            June 2, 2016                                        <u><a href="../man2/THR_NEW.2.html">THR_NEW</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>