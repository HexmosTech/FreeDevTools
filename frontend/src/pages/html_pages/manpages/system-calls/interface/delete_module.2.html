<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>delete_module - unload a kernel module</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       delete_module - unload a kernel module

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/fcntl.h">fcntl.h</a>&gt;</b>            /* Definition of <b>O_*</b> constants */
       <b>#include</b> <b>&lt;sys/syscall.h&gt;</b>      /* Definition of <b>SYS_*</b> constants */
       <b>#include</b> <b>&lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;</b>

       <b>int</b> <b>syscall(SYS_delete_module,</b> <b>const</b> <b>char</b> <b>*</b><u>name</u><b>,</b> <b>unsigned</b> <b>int</b> <u>flags</u><b>);</b>

       <u>Note</u>: glibc provides no wrapper for <b>delete_module</b>(), necessitating the use of <b><a href="../man2/syscall.2.html">syscall</a></b>(2).

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>delete_module</b>()  system call attempts to remove the unused loadable module entry identified by <u>name</u>.
       If the module has an <u>exit</u> function, then that function is executed  before  unloading  the  module.   The
       <u>flags</u>  argument  is used to modify the behavior of the system call, as described below.  This system call
       requires privilege.

       Module removal is attempted according to the following rules:

       (1)  If there are other loaded modules that depend on (i.e., refer to symbols defined  in)  this  module,
            then the call fails.

       (2)  Otherwise,  if the reference count for the module (i.e., the number of processes currently using the
            module) is zero, then the module is immediately unloaded.

       (3)  If a module has a nonzero reference count, then the behavior depends on the bits set in  <u>flags</u>.   In
            normal  usage  (see  NOTES),  the  <b>O_NONBLOCK</b>  flag  is  always  specified, and the <b>O_TRUNC</b> flag may
            additionally be specified.

            The various combinations for <u>flags</u> have the following effect:

            <b>flags</b> <b>==</b> <b>O_NONBLOCK</b>
                   The call returns immediately, with an error.

            <b>flags</b> <b>==</b> <b>(O_NONBLOCK</b> <b>|</b> <b>O_TRUNC)</b>
                   The module is unloaded immediately, regardless of whether it has a nonzero reference count.

            <b>(flags</b> <b>&amp;</b> <b>O_NONBLOCK)</b> <b>==</b> <b>0</b>
                   If <u>flags</u> does not specify <b>O_NONBLOCK</b>, the following steps occur:

                   •  The module is marked so that no new references are permitted.

                   •  If the module's reference count is nonzero, the caller is  placed  in  an  uninterruptible
                      sleep  state  (<b>TASK_UNINTERRUPTIBLE</b>) until the reference count is zero, at which point the
                      call unblocks.

                   •  The module is unloaded in the usual way.

       The <b>O_TRUNC</b> flag has one further effect on the rules described above.  By default, if  a  module  has  an
       <u>init</u>  function but no <u>exit</u> function, then an attempt to remove the module fails.  However, if <b>O_TRUNC</b> was
       specified, this requirement is bypassed.

       Using the <b>O_TRUNC</b> flag is dangerous!  If the kernel was not built with  <b>CONFIG_MODULE_FORCE_UNLOAD</b>,  this
       flag is silently ignored.  (Normally, <b>CONFIG_MODULE_FORCE_UNLOAD</b> is enabled.)  Using this flag taints the
       kernel (TAINT_FORCED_RMMOD).

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, zero is returned.  On error, -1 is returned and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EBUSY</b>  The  module  is not "live" (i.e., it is still being initialized or is already marked for removal);
              or, the module has an <u>init</u> function but has no <u>exit</u> function, and <b>O_TRUNC</b>  was  not  specified  in
              <u>flags</u>.

       <b>EFAULT</b> <u>name</u> refers to a location outside the process's accessible address space.

       <b>ENOENT</b> No module by that name exists.

       <b>EPERM</b>  The caller was not privileged (did not have the <b>CAP_SYS_MODULE</b> capability), or module unloading is
              disabled (see <u><a href="file:/proc/sys/kernel/modules_disabled">/proc/sys/kernel/modules_disabled</a></u> in <b><a href="../man5/proc.5.html">proc</a></b>(5)).

       <b>EWOULDBLOCK</b>
              Other  modules  depend  on  this  module; or, <b>O_NONBLOCK</b> was specified in <u>flags</u>, but the reference
              count of this module is nonzero and <b>O_TRUNC</b> was not specified in <u>flags</u>.

</pre><h4><b>STANDARDS</b></h4><pre>
       Linux.

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>delete_module</b>() system call is not supported by glibc.  No declaration is provided in glibc  headers,
       but, through a quirk of history, glibc versions before glibc 2.23 did export an ABI for this system call.
       Therefore,  in order to employ this system call, it is (before glibc 2.23) sufficient to manually declare
       the interface in your code; alternatively, you can invoke the system call using <b><a href="../man2/syscall.2.html">syscall</a></b>(2).

   <b>Linux</b> <b>2.4</b> <b>and</b> <b>earlier</b>
       In Linux 2.4 and earlier, the system call took only one argument:

          <b>int</b> <b>delete_module(const</b> <b>char</b> <b>*</b><u>name</u><b>);</b>

       If <u>name</u> is NULL, all unused modules marked auto-clean are removed.

       Some further details of differences in the behavior of <b>delete_module</b>() in Linux 2.4 and earlier  are  <u>not</u>
       currently explained in this manual page.

</pre><h4><b>NOTES</b></h4><pre>
       The  uninterruptible  sleep that may occur if <b>O_NONBLOCK</b> is omitted from <u>flags</u> is considered undesirable,
       because the sleeping process is left in an unkillable state.  As at Linux 3.7, specifying  <b>O_NONBLOCK</b>  is
       optional, but in future kernels it is likely to become mandatory.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/create_module.2.html">create_module</a></b>(2), <b><a href="../man2/init_module.2.html">init_module</a></b>(2), <b><a href="../man2/query_module.2.html">query_module</a></b>(2), <b><a href="../man8/lsmod.8.html">lsmod</a></b>(8), <b><a href="../man8/modprobe.8.html">modprobe</a></b>(8), <b><a href="../man8/rmmod.8.html">rmmod</a></b>(8)

Linux man-pages 6.9.1                              2024-05-02                                   <u><a href="../man2/delete_module.2.html">delete_module</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>