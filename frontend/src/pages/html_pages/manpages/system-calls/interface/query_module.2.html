<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>query_module - query the kernel for various bits pertaining to modules</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       query_module - query the kernel for various bits pertaining to modules

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/linux/module.h">linux/module.h</a>&gt;</b>

       <b>[[deprecated]]</b> <b>int</b> <b>query_module(const</b> <b>char</b> <b>*</b><u>name</u><b>,</b> <b>int</b> <u>which</u><b>,</b>
                                       <b>void</b> <u>buf</u><b>[.</b><u>bufsize</u><b>],</b> <b>size_t</b> <u>bufsize</u><b>,</b>
                                       <b>size_t</b> <b>*</b><u>ret</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>Note</u>: This system call is present only before Linux 2.6.

       <b>query_module</b>()  requests information from the kernel about loadable modules.  The returned information is
       placed in the buffer pointed to by <u>buf</u>.  The caller must specify the size of <u>buf</u> in <u>bufsize</u>.  The precise
       nature and format of the  returned  information  depend  on  the  operation  specified  by  <u>which</u>.   Some
       operations require <u>name</u> to identify a currently loaded module, some allow <u>name</u> to be NULL, indicating the
       kernel proper.

       The following values can be specified for <u>which</u>:

       <b>0</b>      Returns  success,  if  the  kernel supports <b>query_module</b>().  Used to probe for availability of the
              system call.

       <b>QM_MODULES</b>
              Returns the names of all loaded modules.  The returned buffer consists  of  a  sequence  of  null-
              terminated strings; <u>ret</u> is set to the number of modules.

       <b>QM_DEPS</b>
              Returns  the names of all modules used by the indicated module.  The returned buffer consists of a
              sequence of null-terminated strings; <u>ret</u> is set to the number of modules.

       <b>QM_REFS</b>
              Returns the names of all modules using the indicated module.  This is the inverse of <b>QM_DEPS</b>.  The
              returned buffer consists of a sequence of null-terminated strings; <u>ret</u> is set  to  the  number  of
              modules.

       <b>QM_SYMBOLS</b>
              Returns  the  symbols  and  values  exported  by the kernel or the indicated module.  The returned
              buffer is an array of structures of the following form

                  struct module_symbol {
                      unsigned long value;
                      unsigned long name;
                  };

              followed by null-terminated strings.  The value of <u>name</u> is the  character  offset  of  the  string
              relative to the start of <u>buf</u>; <u>ret</u> is set to the number of symbols.

       <b>QM_INFO</b>
              Returns miscellaneous information about the indicated module.  The output buffer format is:

                  struct module_info {
                      unsigned long address;
                      unsigned long size;
                      unsigned long flags;
                  };

              where <u>address</u> is the kernel address at which the module resides, <u>size</u> is the size of the module in
              bytes,  and  <u>flags</u>  is a mask of <b>MOD_RUNNING</b>, <b>MOD_AUTOCLEAN</b>, and so on, that indicates the current
              status of the module (see the Linux kernel source file <u>include/linux/module.h</u>).  <u>ret</u> is set to the
              size of the <u>module_info</u> structure.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, zero is returned.  On error, -1 is returned and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EFAULT</b> At least one of <u>name</u>, <u>buf</u>, or <u>ret</u> was outside the program's accessible address space.

       <b>EINVAL</b> Invalid <u>which</u>; or <u>name</u> is NULL (indicating "the kernel"), but  this  is  not  permitted  with  the
              specified value of <u>which</u>.

       <b>ENOENT</b> No module by that <u>name</u> exists.

       <b>ENOSPC</b> The buffer size provided was too small.  <u>ret</u> is set to the minimum size needed.

       <b>ENOSYS</b> <b>query_module</b>() is not supported in this version of the kernel (e.g., Linux 2.6 or later).

</pre><h4><b>STANDARDS</b></h4><pre>
       Linux.

</pre><h4><b>VERSIONS</b></h4><pre>
       Removed in Linux 2.6.

       Some   of  the  information  that  was  formerly  available  via  <b>query_module</b>()  can  be  obtained  from
       <u><a href="file:/proc/modules">/proc/modules</a></u>, <u><a href="file:/proc/kallsyms">/proc/kallsyms</a></u>, and the files under the directory <u><a href="file:/sys/module">/sys/module</a></u>.

       The <b>query_module</b>() system call is not supported by glibc.  No declaration is provided in  glibc  headers,
       but,  through  a quirk of history, glibc does export an ABI for this system call.  Therefore, in order to
       employ this system call, it is sufficient to manually declare the interface in your code;  alternatively,
       you can invoke the system call using <b><a href="../man2/syscall.2.html">syscall</a></b>(2).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/create_module.2.html">create_module</a></b>(2), <b><a href="../man2/delete_module.2.html">delete_module</a></b>(2), <b><a href="../man2/get_kernel_syms.2.html">get_kernel_syms</a></b>(2), <b><a href="../man2/init_module.2.html">init_module</a></b>(2), <b><a href="../man8/lsmod.8.html">lsmod</a></b>(8), <b><a href="../man8/modinfo.8.html">modinfo</a></b>(8)

Linux man-pages 6.9.1                              2024-05-02                                    <u><a href="../man2/query_module.2.html">query_module</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>