<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dup, dup2, dup3 - duplicate a file descriptor</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       dup, dup2, dup3 - duplicate a file descriptor

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;</b>

       <b>int</b> <b>dup(int</b> <u>oldfd</u><b>);</b>
       <b>int</b> <b>dup2(int</b> <u>oldfd</u><b>,</b> <b>int</b> <u>newfd</u><b>);</b>

       <b>#define</b> <b>_GNU_SOURCE</b>             /* See <a href="../man7/feature_test_macros.7.html">feature_test_macros</a>(7) */
       <b>#include</b> <b>&lt;<a href="file:/usr/include/fcntl.h">fcntl.h</a>&gt;</b>              /* Definition of <b>O_*</b> constants */
       <b>#include</b> <b>&lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;</b>

       <b>int</b> <b>dup3(int</b> <u>oldfd</u><b>,</b> <b>int</b> <u>newfd</u><b>,</b> <b>int</b> <u>flags</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>dup</b>()  system  call allocates a new file descriptor that refers to the same open file description as
       the descriptor <u>oldfd</u>.  (For an explanation of  open  file  descriptions,  see  <b><a href="../man2/open.2.html">open</a></b>(2).)   The  new  file
       descriptor  number is guaranteed to be the lowest-numbered file descriptor that was unused in the calling
       process.

       After a successful return, the old and new file descriptors may be used interchangeably.  Since  the  two
       file  descriptors  refer to the same open file description, they share file offset and file status flags;
       for example, if the file offset is modified by using <b><a href="../man2/lseek.2.html">lseek</a></b>(2) on one of the file descriptors, the  offset
       is also changed for the other file descriptor.

       The  two file descriptors do not share file descriptor flags (the close-on-exec flag).  The close-on-exec
       flag (<b>FD_CLOEXEC</b>; see <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2)) for the duplicate descriptor is off.

   <b>dup2()</b>
       The <b>dup2</b>() system call performs the same task as <b>dup</b>(), but instead of using the  lowest-numbered  unused
       file  descriptor,  it  uses  the  file  descriptor  number  specified in <u>newfd</u>.  In other words, the file
       descriptor <u>newfd</u> is adjusted so that it now refers to the same open file description as <u>oldfd</u>.

       If the file descriptor <u>newfd</u> was previously open,  it  is  closed  before  being  reused;  the  close  is
       performed silently (i.e., any errors during the close are not reported by <b>dup2</b>()).

       The  steps of closing and reusing the file descriptor <u>newfd</u> are performed <u>atomically</u>.  This is important,
       because trying to implement equivalent functionality using <b><a href="../man2/close.2.html">close</a></b>(2) and <b>dup</b>() would be  subject  to  race
       conditions,  whereby  <u>newfd</u>  might  be reused between the two steps.  Such reuse could happen because the
       main program is interrupted by a signal handler that allocates a file descriptor, or because  a  parallel
       thread allocates a file descriptor.

       Note the following points:

       •  If <u>oldfd</u> is not a valid file descriptor, then the call fails, and <u>newfd</u> is not closed.

       •  If  <u>oldfd</u> is a valid file descriptor, and <u>newfd</u> has the same value as <u>oldfd</u>, then <b>dup2</b>() does nothing,
          and returns <u>newfd</u>.

   <b>dup3()</b>
       <b>dup3</b>() is the same as <b>dup2</b>(), except that:

       •  The caller can force the close-on-exec flag to be set  for  the  new  file  descriptor  by  specifying
          <b>O_CLOEXEC</b>  in  <u>flags</u>.   See  the  description  of the same flag in <b><a href="../man2/open.2.html">open</a></b>(2) for reasons why this may be
          useful.

       •  If <u>oldfd</u> equals <u>newfd</u>, then <b>dup3</b>() fails with the error <b>EINVAL</b>.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, these system calls return the new file descriptor.  On error, -1 is returned,  and  <u>errno</u>  is
       set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EBADF</b>  <u>oldfd</u> isn't an open file descriptor.

       <b>EBADF</b>  <u>newfd</u>  is  out  of  the allowed range for file descriptors (see the discussion of <b>RLIMIT_NOFILE</b> in
              <b><a href="../man2/getrlimit.2.html">getrlimit</a></b>(2)).

       <b>EBUSY</b>  (Linux only) This may be returned by <b>dup2</b>() or <b>dup3</b>() during a race  condition  with  <b><a href="../man2/open.2.html">open</a></b>(2)  and
              <b>dup</b>().

       <b>EINTR</b>  The <b>dup2</b>() or <b>dup3</b>() call was interrupted by a signal; see <b><a href="../man7/signal.7.html">signal</a></b>(7).

       <b>EINVAL</b> (<b>dup3</b>()) <u>flags</u> contain an invalid value.

       <b>EINVAL</b> (<b>dup3</b>()) <u>oldfd</u> was equal to <u>newfd</u>.

       <b>EMFILE</b> The  per-process limit on the number of open file descriptors has been reached (see the discussion
              of <b>RLIMIT_NOFILE</b> in <b><a href="../man2/getrlimit.2.html">getrlimit</a></b>(2)).

</pre><h4><b>STANDARDS</b></h4><pre>
       <b>dup</b>()
       <b>dup2</b>() POSIX.1-2008.

       <b>dup3</b>() Linux.

</pre><h4><b>HISTORY</b></h4><pre>
       <b>dup</b>()
       <b>dup2</b>() POSIX.1-2001, SVr4, 4.3BSD.

       <b>dup3</b>() Linux 2.6.27, glibc 2.9.

</pre><h4><b>NOTES</b></h4><pre>
       The error returned by <b>dup2</b>() is different from that returned by <b>fcntl(</b>..., <b>F_DUPFD</b>, ...<b>)</b>  when  <u>newfd</u>  is
       out of range.  On some systems, <b>dup2</b>() also sometimes returns <b>EINVAL</b> like <b>F_DUPFD</b>.

       If  <u>newfd</u>  was  open,  any errors that would have been reported at <b><a href="../man2/close.2.html">close</a></b>(2) time are lost.  If this is of
       concern, then—unless the program is single-threaded and does not  allocate  file  descriptors  in  signal
       handlers—the  correct approach is <u>not</u> to close <u>newfd</u> before calling <b>dup2</b>(), because of the race condition
       described above.  Instead, code something like the following could be used:

           /* Obtain a duplicate of 'newfd' that can subsequently
              be used to check for close() errors; an EBADF error
              means that 'newfd' was not open. */

           tmpfd = dup(newfd);
           if (tmpfd == -1 &amp;&amp; errno != EBADF) {
               /* Handle unexpected dup() error. */
           }

           /* Atomically duplicate 'oldfd' on 'newfd'. */

           if (dup2(oldfd, newfd) == -1) {
               /* Handle dup2() error. */
           }

           /* Now check for close() errors on the file originally
              referred to by 'newfd'. */

           if (tmpfd != -1) {
               if (close(tmpfd) == -1) {
                   /* Handle errors from close. */
               }
           }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/close.2.html">close</a></b>(2), <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2), <b><a href="../man2/open.2.html">open</a></b>(2), <b><a href="../man2/pidfd_getfd.2.html">pidfd_getfd</a></b>(2)

Linux man-pages 6.9.1                              2024-05-02                                             <u><a href="../man2/dup.2.html">dup</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>