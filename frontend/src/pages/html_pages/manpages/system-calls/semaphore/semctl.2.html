<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>semctl - System V semaphore control operations</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       semctl - System V semaphore control operations

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/sem.h&gt;</b>

       <b>int</b> <b>semctl(int</b> <u>semid</u><b>,</b> <b>int</b> <u>semnum</u><b>,</b> <b>int</b> <u>op</u><b>,</b> <b>...);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>semctl</b>()  performs  the  control  operation  specified  by <u>op</u> on the System V semaphore set identified by
       <u>semid</u>, or on the <u>semnum</u>-th semaphore of that set.  (The semaphores in a set are numbered starting at 0.)

       This function has three or four arguments, depending on <u>op</u>.  When there are four, the fourth has the type
       <u>union</u> <u>semun</u>.  The <u>calling</u> <u>program</u> must define this union as follows:

           union semun {
               int              val;    /* Value for SETVAL */
               struct semid_ds *buf;    /* Buffer for IPC_STAT, IPC_SET */
               unsigned short  *array;  /* Array for GETALL, SETALL */
               struct seminfo  *__buf;  /* Buffer for IPC_INFO
                                           (Linux-specific) */
           };

       The <u>semid_ds</u> data structure is defined in <u>&lt;sys/sem.h&gt;</u> as follows:

           struct semid_ds {
               struct ipc_perm sem_perm;  /* Ownership and permissions */
               time_t          sem_otime; /* Last semop time */
               time_t          sem_ctime; /* Creation time/time of last
                                             modification via semctl() */
               unsigned long   sem_nsems; /* No. of semaphores in set */
           };

       The fields of the <u>semid_ds</u> structure are as follows:

       <u>sem_perm</u>   This is an <u>ipc_perm</u> structure (see  below)  that  specifies  the  access  permissions  on  the
                  semaphore set.

       <u>sem_otime</u>  Time of last <b><a href="../man2/semop.2.html">semop</a></b>(2) system call.

       <u>sem_ctime</u>  Time  of  creation  of  semaphore  set  or  time  of  last  <b>semctl</b>() <b>IPCSET</b>, <b>SETVAL</b>, or <b>SETALL</b>
                  operation.

       <u>sem_nsems</u>  Number of semaphores in the set.  Each semaphore of the set is  referenced  by  a  nonnegative
                  integer ranging from <b>0</b> to <u>sem_nsems-1</u>.

       The <u>ipc_perm</u> structure is defined as follows (the highlighted fields are settable using <b>IPC_SET</b>):

           struct ipc_perm {
               key_t          __key; /* Key supplied to <a href="../man2/semget.2.html">semget</a>(2) */
               uid_t          <b>uid</b>;   /* Effective UID of owner */
               gid_t          <b>gid</b>;   /* Effective GID of owner */
               uid_t          cuid;  /* Effective UID of creator */
               gid_t          cgid;  /* Effective GID of creator */
               unsigned short <b>mode</b>;  /* Permissions */
               unsigned short __seq; /* Sequence number */
           };

       The  least  significant  9 bits of the <u>mode</u> field of the <u>ipc_perm</u> structure define the access permissions
       for the shared memory segment.  The permission bits are as follows:
       0400   Read by user
       0200   Write by user
       0040   Read by group
       0020   Write by group
       0004   Read by others
       0002   Write by others

       In effect, "write" means "alter" for a semaphore set.  Bits 0100, 0010, and 0001 (the execute  bits)  are
       unused by the system.

       Valid values for <u>op</u> are:

       <b>IPC_STAT</b>
              Copy  information from the kernel data structure associated with <u>semid</u> into the <u>semid_ds</u> structure
              pointed to by <u>arg.buf</u>.  The argument <u>semnum</u> is  ignored.   The  calling  process  must  have  read
              permission on the semaphore set.

       <b>IPC_SET</b>
              Write  the  values  of  some members of the <u>semid_ds</u> structure pointed to by <u>arg.buf</u> to the kernel
              data structure associated with this semaphore set, updating also its <u>sem_ctime</u> member.

              The following members of the structure are updated: <u>sem_perm.uid</u>,  <u>sem_perm.gid</u>,  and  (the  least
              significant 9 bits of) <u>sem_perm.mode</u>.

              The  effective  UID  of  the  calling  process  must  match  the  owner  (<u>sem_perm.uid</u>) or creator
              (<u>sem_perm.cuid</u>) of the semaphore set, or the caller must be privileged.  The  argument  <u>semnum</u>  is
              ignored.

       <b>IPC_RMID</b>
              Immediately remove the semaphore set, awakening all processes blocked in <b><a href="../man2/semop.2.html">semop</a></b>(2) calls on the set
              (with  an error return and <u>errno</u> set to <b>EIDRM</b>).  The effective user ID of the calling process must
              match the creator or owner of the semaphore set, or the caller must be privileged.   The  argument
              <u>semnum</u> is ignored.

       <b>IPC_INFO</b> (Linux-specific)
              Return  information  about system-wide semaphore limits and parameters in the structure pointed to
              by <u>arg.</u><b>__</b><u>buf</u>.  This structure is of type  <u>seminfo</u>,  defined  in  <u>&lt;sys/sem.h&gt;</u>  if  the  <b>_GNU_SOURCE</b>
              feature test macro is defined:

                  struct  seminfo {
                      int semmap;  /* Number of entries in semaphore
                                      map; unused within kernel */
                      int semmni;  /* Maximum number of semaphore sets */
                      int semmns;  /* Maximum number of semaphores in all
                                      semaphore sets */
                      int semmnu;  /* System-wide maximum number of undo
                                      structures; unused within kernel */
                      int semmsl;  /* Maximum number of semaphores in a
                                      set */
                      int semopm;  /* Maximum number of operations for
                                      <a href="../man2/semop.2.html">semop</a>(2) */
                      int semume;  /* Maximum number of undo entries per
                                      process; unused within kernel */
                      int semusz;  /* Size of struct sem_undo */
                      int semvmx;  /* Maximum semaphore value */
                      int semaem;  /* Max. value that can be recorded for
                                      semaphore adjustment (SEM_UNDO) */
                  };

              The  <u>semmsl</u>,  <u>semmns</u>,  <u>semopm</u>,  and  <u>semmni</u>  settings can be changed via <u><a href="file:/proc/sys/kernel/sem">/proc/sys/kernel/sem</a></u>; see
              <b><a href="../man5/proc.5.html">proc</a></b>(5) for details.

       <b>SEM_INFO</b> (Linux-specific)
              Return a <u>seminfo</u> structure containing the same  information  as  for  <b>IPC_INFO</b>,  except  that  the
              following  fields are returned with information about system resources consumed by semaphores: the
              <u>semusz</u> field returns the number of semaphore sets that currently exist  on  the  system;  and  the
              <u>semaem</u> field returns the total number of semaphores in all semaphore sets on the system.

       <b>SEM_STAT</b> (Linux-specific)
              Return  a  <u>semid_ds</u>  structure  as  for  <b>IPC_STAT</b>.  However, the <u>semid</u> argument is not a semaphore
              identifier, but instead an index into the kernel's internal array that maintains information about
              all semaphore sets on the system.

       <b>SEM_STAT_ANY</b> (Linux-specific, since Linux 4.17)
              Return a <u>semid_ds</u> structure as for <b>SEM_STAT</b>.  However,  <u>sem_perm.mode</u>  is  not  checked  for  read
              access  for  <u>semid</u>  meaning  that  any  user  can employ this operation (just as any user may read
              <u><a href="file:/proc/sysvipc/sem">/proc/sysvipc/sem</a></u> to obtain the same information).

       <b>GETALL</b> Return <b>semval</b> (i.e., the current value) for  all  semaphores  of  the  set  into  <u>arg.array</u>.   The
              argument <u>semnum</u> is ignored.  The calling process must have read permission on the semaphore set.

       <b>GETNCNT</b>
              Return  the  <b>semncnt</b>  value  for the <u>semnum</u>-th semaphore of the set (i.e., the number of processes
              waiting for the semaphore's value to increase).  The calling process must have read permission  on
              the semaphore set.

       <b>GETPID</b> Return  the  <b>sempid</b>  value for the <u>semnum</u>-th semaphore of the set.  This is the PID of the process
              that last performed an operation on that semaphore (but see NOTES).  The calling process must have
              read permission on the semaphore set.

       <b>GETVAL</b> Return <b>semval</b> (i.e., the semaphore value) for the <u>semnum</u>-th semaphore of  the  set.   The  calling
              process must have read permission on the semaphore set.

       <b>GETZCNT</b>
              Return  the  <b>semzcnt</b>  value  for the <u>semnum</u>-th semaphore of the set (i.e., the number of processes
              waiting for the semaphore value to become 0).  The calling process must have  read  permission  on
              the semaphore set.

       <b>SETALL</b> Set  the  <b>semval</b> values for all semaphores of the set using <u>arg.array</u>, updating also the <u>sem_ctime</u>
              member of the <u>semid_ds</u> structure associated with the set.  Undo entries (see <b><a href="../man2/semop.2.html">semop</a></b>(2)) are cleared
              for altered semaphores in all processes.  If the changes to semaphore values would permit  blocked
              <b><a href="../man2/semop.2.html">semop</a></b>(2)  calls  in  other  processes to proceed, then those processes are woken up.  The argument
              <u>semnum</u> is ignored.  The calling process must have alter (write) permission on the semaphore set.

       <b>SETVAL</b> Set the semaphore value (<b>semval</b>) to <u>arg.val</u> for the <u>semnum</u>-th semaphore of the set, updating  also
              the  <u>sem_ctime</u> member of the <u>semid_ds</u> structure associated with the set.  Undo entries are cleared
              for altered semaphores in all processes.  If the changes to semaphore values would permit  blocked
              <b><a href="../man2/semop.2.html">semop</a></b>(2)  calls  in  other  processes  to proceed, then those processes are woken up.  The calling
              process must have alter permission on the semaphore set.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>semctl</b>() returns a nonnegative value depending on <u>op</u> as follows:

       <b>GETNCNT</b>
              the value of <b>semncnt</b>.

       <b>GETPID</b> the value of <b>sempid</b>.

       <b>GETVAL</b> the value of <b>semval</b>.

       <b>GETZCNT</b>
              the value of <b>semzcnt</b>.

       <b>IPC_INFO</b>
              the index of the highest used entry in the kernel's internal array recording information about all
              semaphore sets.  (This information can be used with repeated <b>SEM_STAT</b> or  <b>SEM_STAT_ANY</b>  operations
              to obtain information about all semaphore sets on the system.)

       <b>SEM_INFO</b>
              as for <b>IPC_INFO</b>.

       <b>SEM_STAT</b>
              the identifier of the semaphore set whose index was given in <u>semid</u>.

       <b>SEM_STAT_ANY</b>
              as for <b>SEM_STAT</b>.

       All other <u>op</u> values return 0 on success.

       On failure, <b>semctl</b>() returns -1 and sets <u>errno</u> to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EACCES</b> The  argument  <u>op</u>  has  one  of  the  values  <b>GETALL</b>,  <b>GETPID</b>, <b>GETVAL</b>, <b>GETNCNT</b>, <b>GETZCNT</b>, <b>IPC_STAT</b>,
              <b>SEM_STAT</b>, <b>SEM_STAT_ANY</b>, <b>SETALL</b>, or <b>SETVAL</b> and the calling  process  does  not  have  the  required
              permissions  on  the  semaphore  set  and  does  not have the <b>CAP_IPC_OWNER</b> capability in the user
              namespace that governs its IPC namespace.

       <b>EFAULT</b> The address pointed to by <u>arg.buf</u> or <u>arg.array</u> isn't accessible.

       <b>EIDRM</b>  The semaphore set was removed.

       <b>EINVAL</b> Invalid value for <u>op</u> or <u>semid</u>.  Or: for a <b>SEM_STAT</b> operation, the index value specified  in  <u>semid</u>
              referred to an array slot that is currently unused.

       <b>EPERM</b>  The argument <u>op</u> has the value <b>IPC_SET</b> or <b>IPC_RMID</b> but the effective user ID of the calling process
              is  not  the  creator  (as  found in <u>sem_perm.cuid</u>) or the owner (as found in <u>sem_perm.uid</u>) of the
              semaphore set, and the process does not have the <b>CAP_SYS_ADMIN</b> capability.

       <b>ERANGE</b> The argument <u>op</u> has the value <b>SETALL</b> or <b>SETVAL</b> and the value to which <b>semval</b> is  to  be  set  (for
              some semaphore of the set) is less than 0 or greater than the implementation limit <b>SEMVMX</b>.

</pre><h4><b>VERSIONS</b></h4><pre>
       POSIX.1  specifies  the  <u>sem_nsems</u> field of the <u>semid_ds</u> structure as having the type <u>unsigned</u> <u>short</u>, and
       the field is so defined on most other systems.  It was also so defined on Linux  2.2  and  earlier,  but,
       since Linux 2.4, the field has the type <u>unsigned</u> <u>long</u>.

   <b>The</b> <b>sempid</b> <b>value</b>
       POSIX.1  defines  <u>sempid</u> as the "process ID of [the] last operation" on a semaphore, and explicitly notes
       that this value is set by a successful <b><a href="../man2/semop.2.html">semop</a></b>(2) call,  with  the  implication  that  no  other  interface
       affects the <u>sempid</u> value.

       While  some implementations conform to the behavior specified in POSIX.1, others do not.  (The fault here
       probably lies with POSIX.1  inasmuch  as  it  likely  failed  to  capture  the  full  range  of  existing
       implementation  behaviors.)   Various  other  implementations also update <u>sempid</u> for the other operations
       that update the value of a semaphore: the  <b>SETVAL</b>  and  <b>SETALL</b>  operations,  as  well  as  the  semaphore
       adjustments  performed  on  process  termination  as  a  consequence of the use of the <b>SEM_UNDO</b> flag (see
       <b><a href="../man2/semop.2.html">semop</a></b>(2)).

       Linux  also  updates  <u>sempid</u>  for  <b>SETVAL</b>  operations  and  semaphore  adjustments.   However,   somewhat
       inconsistently,  up  to  and including Linux 4.5, the kernel did not update <u>sempid</u> for <b>SETALL</b> operations.
       This was rectified in Linux 4.6.

</pre><h4><b>STANDARDS</b></h4><pre>
       POSIX.1-2008.

</pre><h4><b>HISTORY</b></h4><pre>
       POSIX.1-2001, SVr4.

       Various fields in a <u>struct</u> <u>semid_ds</u> were typed as <u>short</u> under Linux 2.2 and have become <u>long</u> under  Linux
       2.4.  To take advantage of this, a recompilation under glibc-2.1.91 or later should suffice.  (The kernel
       distinguishes old and new calls by an <b>IPC_64</b> flag in <u>op</u>.)

       In  some earlier versions of glibc, the <u>semun</u> union was defined in <u>&lt;sys/sem.h&gt;</u>, but POSIX.1 requires that
       the caller define this union.  On  versions  of  glibc  where  this  union  is  <u>not</u>  defined,  the  macro
       <b>_SEM_SEMUN_UNDEFINED</b> is defined in <u>&lt;sys/sem.h&gt;</u>.

</pre><h4><b>NOTES</b></h4><pre>
       The <b>IPC_INFO</b>, <b>SEM_STAT</b>, and <b>SEM_INFO</b> operations are used by the <b><a href="../man1/ipcs.1.html">ipcs</a></b>(1) program to provide information on
       allocated resources.  In the future these may modified or moved to a <u><a href="file:/proc">/proc</a></u> filesystem interface.

       The following system limit on semaphore sets affects a <b>semctl</b>() call:

       <b>SEMVMX</b> Maximum value for <b>semval</b>: implementation dependent (32767).

       For greater portability, it is best to always call <b>semctl</b>() with four arguments.

</pre><h4><b>EXAMPLES</b></h4><pre>
       See <b><a href="../man2/shmop.2.html">shmop</a></b>(2).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/ipc.2.html">ipc</a></b>(2), <b><a href="../man2/semget.2.html">semget</a></b>(2), <b><a href="../man2/semop.2.html">semop</a></b>(2), <b><a href="../man7/capabilities.7.html">capabilities</a></b>(7), <b><a href="../man7/sem_overview.7.html">sem_overview</a></b>(7), <b><a href="../man7/sysvipc.7.html">sysvipc</a></b>(7)

Linux man-pages 6.9.1                              2024-05-02                                          <u><a href="../man2/semctl.2.html">semctl</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>