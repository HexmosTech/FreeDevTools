<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>semget - get a System V semaphore set identifier</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       semget - get a System V semaphore set identifier

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/sem.h&gt;</b>

       <b>int</b> <b>semget(key_t</b> <u>key</u><b>,</b> <b>int</b> <u>nsems</u><b>,</b> <b>int</b> <u>semflg</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>semget</b>() system call returns the System V semaphore set identifier associated with the argument <u>key</u>.
       It may be used either to obtain the identifier of a previously created semaphore set (when <u>semflg</u> is zero
       and <u>key</u> does not have the value <b>IPC_PRIVATE</b>), or to create a new set.

       A new set of <u>nsems</u> semaphores is created if <u>key</u> has the value <b>IPC_PRIVATE</b> or if no existing semaphore set
       is associated with <u>key</u> and <b>IPC_CREAT</b> is specified in <u>semflg</u>.

       If <u>semflg</u> specifies both <b>IPC_CREAT</b> and <b>IPC_EXCL</b> and a semaphore set already exists for <u>key</u>, then <b>semget</b>()
       fails with <u>errno</u> set to <b>EEXIST</b>.  (This is analogous to the effect of the combination <b>O_CREAT</b> <b>|</b> <b>O_EXCL</b> for
       <b><a href="../man2/open.2.html">open</a></b>(2).)

       Upon creation, the least significant 9 bits of the argument <u>semflg</u> define  the  permissions  (for  owner,
       group,  and others) for the semaphore set.  These bits have the same format, and the same meaning, as the
       <u>mode</u> argument of <b><a href="../man2/open.2.html">open</a></b>(2) (though the execute permissions are not meaningful  for  semaphores,  and  write
       permissions mean permission to alter semaphore values).

       When  creating  a  new  semaphore set, <b>semget</b>() initializes the set's associated data structure, <u>semid_ds</u>
       (see <b><a href="../man2/semctl.2.html">semctl</a></b>(2)), as follows:

       •  <u>sem_perm.cuid</u> and <u>sem_perm.uid</u> are set to the effective user ID of the calling process.

       •  <u>sem_perm.cgid</u> and <u>sem_perm.gid</u> are set to the effective group ID of the calling process.

       •  The least significant 9 bits of <u>sem_perm.mode</u> are set to the least significant 9 bits of <u>semflg</u>.

       •  <u>sem_nsems</u> is set to the value of <u>nsems</u>.

       •  <u>sem_otime</u> is set to 0.

       •  <u>sem_ctime</u> is set to the current time.

       The argument <u>nsems</u> can be 0 (a don't care) when a semaphore set is not being created.   Otherwise,  <u>nsems</u>
       must  be  greater  than  0  and  less than or equal to the maximum number of semaphores per semaphore set
       (<b>SEMMSL</b>).

       If the semaphore set already exists, the permissions are verified.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>semget</b>() returns the semaphore set identifier (a nonnegative integer).   On  failure,  -1  is
       returned, and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EACCES</b> A  semaphore  set  exists  for <u>key</u>, but the calling process does not have permission to access the
              set, and does not have the <b>CAP_IPC_OWNER</b> capability in the user namespace  that  governs  its  IPC
              namespace.

       <b>EEXIST</b> <b>IPC_CREAT</b> and <b>IPC_EXCL</b> were specified in <u>semflg</u>, but a semaphore set already exists for <u>key</u>.

       <b>EINVAL</b> <u>nsems</u>  is  less  than  0  or  greater than the limit on the number of semaphores per semaphore set
              (<b>SEMMSL</b>).

       <b>EINVAL</b> A semaphore set corresponding to <u>key</u> already exists, but  <u>nsems</u>  is  larger  than  the  number  of
              semaphores in that set.

       <b>ENOENT</b> No semaphore set exists for <u>key</u> and <u>semflg</u> did not specify <b>IPC_CREAT</b>.

       <b>ENOMEM</b> A  semaphore  set  has  to  be created but the system does not have enough memory for the new data
              structure.

       <b>ENOSPC</b> A semaphore set has to be created but the system limit for the maximum number  of  semaphore  sets
              (<b>SEMMNI</b>), or the system wide maximum number of semaphores (<b>SEMMNS</b>), would be exceeded.

</pre><h4><b>STANDARDS</b></h4><pre>
       POSIX.1-2008.

</pre><h4><b>HISTORY</b></h4><pre>
       SVr4, POSIX.1-2001.

</pre><h4><b>NOTES</b></h4><pre>
       <b>IPC_PRIVATE</b>  isn't a flag field but a <u>key_t</u> type.  If this special value is used for <u>key</u>, the system call
       ignores all but the least significant 9 bits of <u>semflg</u> and creates a new semaphore set (on success).

   <b>Semaphore</b> <b>initialization</b>
       The values of the semaphores in a newly created set are indeterminate.   (POSIX.1-2001  and  POSIX.1-2008
       are explicit on this point, although POSIX.1-2008 notes that a future version of the standard may require
       an  implementation  to initialize the semaphores to 0.)  Although Linux, like many other implementations,
       initializes the semaphore values to 0, a portable application cannot rely on this: it  should  explicitly
       initialize the semaphores to the desired values.

       Initialization  can be done using <b><a href="../man2/semctl.2.html">semctl</a></b>(2) <b>SETVAL</b> or <b>SETALL</b> operation.  Where multiple peers do not know
       who will be the first to initialize the set, checking for a nonzero  <u>sem_otime</u>  in  the  associated  data
       structure retrieved by a <b><a href="../man2/semctl.2.html">semctl</a></b>(2) <b>IPC_STAT</b> operation can be used to avoid races.

   <b>Semaphore</b> <b>limits</b>
       The following limits on semaphore set resources affect the <b>semget</b>() call:

       <b>SEMMNI</b> System-wide  limit on the number of semaphore sets.  Before Linux 3.19, the default value for this
              limit was 128.  Since Linux 3.19, the default value is 32,000.  On Linux, this limit can  be  read
              and modified via the fourth field of <u><a href="file:/proc/sys/kernel/sem">/proc/sys/kernel/sem</a></u>.

       <b>SEMMSL</b> Maximum  number  of  semaphores  per  semaphore ID.  Before Linux 3.19, the default value for this
              limit was 250.  Since Linux 3.19, the default value is 32,000.  On Linux, this limit can  be  read
              and modified via the first field of <u><a href="file:/proc/sys/kernel/sem">/proc/sys/kernel/sem</a></u>.

       <b>SEMMNS</b> System-wide  limit on the number of semaphores: policy dependent (on Linux, this limit can be read
              and modified via the second field of <u><a href="file:/proc/sys/kernel/sem">/proc/sys/kernel/sem</a></u>).  Note that the  number  of  semaphores
              system-wide is also limited by the product of <b>SEMMSL</b> and <b>SEMMNI</b>.

</pre><h4><b>BUGS</b></h4><pre>
       The name choice <b>IPC_PRIVATE</b> was perhaps unfortunate, <b>IPC_NEW</b> would more clearly show its function.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  program  shown  below  uses <b>semget</b>() to create a new semaphore set or retrieve the ID of an existing
       set.  It generates the <u>key</u> for <b>semget</b>() using <b><a href="../man3/ftok.3.html">ftok</a></b>(3).  The first two command-line arguments are used  as
       the  <u>pathname</u>  and  <u>proj_id</u>  arguments  for  <b><a href="../man3/ftok.3.html">ftok</a></b>(3).  The third command-line argument is an integer that
       specifies the <u>nsems</u> argument for <b>semget</b>().  Command-line options can be used  to  specify  the  <b>IPC_CREAT</b>
       (<u>-c</u>) and <b>IPC_EXCL</b> (<u>-x</u>) flags for the call to <b>semget</b>().  The usage of this program is demonstrated below.

       We  first  create  two  files that will be used to generate keys using <b><a href="../man3/ftok.3.html">ftok</a></b>(3), create two semaphore sets
       using those files, and then list the sets using <b><a href="../man1/ipcs.1.html">ipcs</a></b>(1):

           $ <b>touch</b> <b>mykey</b> <b>mykey2</b>
           $ <b>./t_semget</b> <b>-c</b> <b>mykey</b> <b>p</b> <b>1</b>
           ID = 9
           $ <b>./t_semget</b> <b>-c</b> <b>mykey2</b> <b>p</b> <b>2</b>
           ID = 10
           $ <b>ipcs</b> <b>-s</b>

           ------ Semaphore Arrays --------
           key        semid      owner      perms      nsems
           0x7004136d 9          mtk        600        1
           0x70041368 10         mtk        600        2

       Next, we demonstrate that when <b><a href="../man2/semctl.2.html">semctl</a></b>(2) is given the same <u>key</u> (as generated by  the  same  arguments  to
       <b><a href="../man3/ftok.3.html">ftok</a></b>(3)), it returns the ID of the already existing semaphore set:

           $ <b>./t_semget</b> <b>-c</b> <b>mykey</b> <b>p</b> <b>1</b>
           ID = 9

       Finally,  we  demonstrate  the  kind of collision that can occur when <b><a href="../man3/ftok.3.html">ftok</a></b>(3) is given different <u>pathname</u>
       arguments that have the same inode number:

           $ <b>ln</b> <b>mykey</b> <b>link</b>
           $ <b>ls</b> <b>-i1</b> <b>link</b> <b>mykey</b>
           2233197 link
           2233197 mykey
           $ <b>./t_semget</b> <b>link</b> <b>p</b> <b>1</b>       # Generates same key as 'mykey'
           ID = 9

   <b>Program</b> <b>source</b>

       /* t_semget.c

          Licensed under GNU General Public License v2 or later.
       */
       #include &lt;<a href="file:/usr/include/stdio.h">stdio.h</a>&gt;
       #include &lt;<a href="file:/usr/include/stdlib.h">stdlib.h</a>&gt;
       #include &lt;sys/ipc.h&gt;
       #include &lt;sys/sem.h&gt;
       #include &lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;

       static void
       usage(const char *pname)
       {
           fprintf(stderr, "Usage: %s [-cx] pathname proj-id num-sems\n",
                   pname);
           fprintf(stderr, "    -c           Use IPC_CREAT flag\n");
           fprintf(stderr, "    -x           Use IPC_EXCL flag\n");
           exit(EXIT_FAILURE);
       }

       int
       main(int argc, char *argv[])
       {
           int    semid, nsems, flags, opt;
           key_t  key;

           flags = 0;
           while ((opt = getopt(argc, argv, "cx")) != -1) {
               switch (opt) {
               case 'c': flags |= IPC_CREAT;   break;
               case 'x': flags |= IPC_EXCL;    break;
               default:  usage(argv[0]);
               }
           }

           if (argc != optind + 3)
               usage(argv[0]);

           key = ftok(argv[optind], argv[optind + 1][0]);
           if (key == -1) {
               perror("ftok");
               exit(EXIT_FAILURE);
           }

           nsems = atoi(argv[optind + 2]);

           semid = semget(key, nsems, flags | 0600);
           if (semid == -1) {
               perror("semget");
               exit(EXIT_FAILURE);
           }

           printf("ID = %d\n", semid);

           exit(EXIT_SUCCESS);
       }

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/semctl.2.html">semctl</a></b>(2), <b><a href="../man2/semop.2.html">semop</a></b>(2), <b><a href="../man3/ftok.3.html">ftok</a></b>(3), <b><a href="../man7/capabilities.7.html">capabilities</a></b>(7), <b><a href="../man7/sem_overview.7.html">sem_overview</a></b>(7), <b><a href="../man7/sysvipc.7.html">sysvipc</a></b>(7)

Linux man-pages 6.9.1                              2024-06-15                                          <u><a href="../man2/semget.2.html">semget</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>