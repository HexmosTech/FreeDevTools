<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAGEMAP_SCAN - get and/or clear page flags</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       PAGEMAP_SCAN - get and/or clear page flags

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/linux/fs.h">linux/fs.h</a>&gt;</b>  /* Definition of <b>PAGE*</b> and <b>PM_*</b> constants */
       <b>#include</b> <b>&lt;sys/ioctl.h&gt;</b>

       <b>int</b> <b>ioctl(int</b> <u>pagemap_fd</u><b>,</b> <b>PAGEMAP_SCAN,</b> <b>struct</b> <b>pm_scan_arg</b> <b>*</b><u>arg</u><b>);</b>

       <b>#include</b> <b>&lt;<a href="file:/usr/include/linux/fs.h">linux/fs.h</a>&gt;</b>

       <b>struct</b> <b>pm_scan_arg</b> <b>{</b>
           <b>__u64</b>  <b>size;</b>
           <b>__u64</b>  <b>flags;</b>
           <b>__u64</b>  <b>start;</b>
           <b>__u64</b>  <b>end;</b>
           <b>__u64</b>  <b>walk_end;</b>
           <b>__u64</b>  <b>vec;</b>
           <b>__u64</b>  <b>vec_len;</b>
           <b>__u64</b>  <b>max_pages;</b>
           <b>__u64</b>  <b>category_inverted;</b>
           <b>__u64</b>  <b>category_mask;</b>
           <b>__u64</b>  <b>category_anyof_mask;</b>
           <b>__u64</b>  <b>return_mask;</b>
       <b>};</b>

       <b>struct</b> <b>page_region</b> <b>{</b>
           <b>__u64</b>  <b>start;</b>
           <b>__u64</b>  <b>end;</b>
           <b>__u64</b>  <b>categories;</b>
       <b>};</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  <b><a href="../man2/ioctl.2.html">ioctl</a></b>(2)  is  used  to  get  and optionally clear some specific flags from page table entries.  The
       information is returned with <b>PAGE_SIZE</b> granularity.

       To start tracking the written state (flag) of a page or range of memory, the  <b>UFFD_FEATURE_WP_ASYNC</b>  must
       be enabled by <b>UFFDIO_API</b> <b><a href="../man2/ioctl.2.html">ioctl</a></b>(2) on <b>userfaultfd</b> and memory range must be registered with <b>UFFDIO_REGISTER</b>
       <b><a href="../man2/ioctl.2.html">ioctl</a></b>(2) in <b>UFFDIO_REGISTER_MODE_WP</b> mode.

   <b>Supported</b> <b>page</b> <b>flags</b>
       The following page table entry flags are supported:

       <b>PAGE_IS_WPALLOWED</b>
              The page has asynchronous write-protection enabled.

       <b>PAGE_IS_WRITTEN</b>
              The page has been written to from the time it was write protected.

       <b>PAGE_IS_FILE</b>
              The page is file backed.

       <b>PAGE_IS_PRESENT</b>
              The page is present in the memory.

       <b>PAGE_IS_SWAPPED</b>
              The page is swapped.

       <b>PAGE_IS_PFNZERO</b>
              The page has zero PFN.

       <b>PAGE_IS_HUGE</b>
              The page is THP or Hugetlb backed.

   <b>Supported</b> <b>operations</b>
       The  get  operation  is  always performed if the output buffer is specified.  The other operations are as
       following:

       <b>PM_SCAN_WP_MATCHING</b>
              Write protect the matched pages.

       <b>PM_SCAN_CHECK_WPASYNC</b>
              Abort the scan when a page  is  found  which  doesn't  have  the  Userfaultfd  Asynchronous  Write
              protection enabled.

   <b>The</b> <u><b>struct</b></u> <u><b>pm_scan_arg</b></u> <b>argument</b>
       <b>size</b>   This field should be set to the size of the structure in bytes, as in <u>sizeof(struct</u> <u>pm_scan_arg)</u>.

       <b>flags</b>  The operations to be performed are specified in it.

       <b>start</b>  The starting address of the scan is specified in it.

       <b>end</b>    The ending address of the scan is specified in it.

       <b>walk_end</b>
              The kernel returns the scan's ending address in it.  The <u>walk_end</u> equal to <u>end</u> means that scan has
              completed on the entire range.

       <b>vec</b>    The address of <u>page_region</u> array for output.

       <b>vec_len</b>
              The length of the <u>page_region</u> struct array.

       <b>max_pages</b>
              It is the optional limit for the number of output pages required.

       <b>category_inverted</b>
              <b>PAGE_IS_</b><u>*</u> categories which values match if 0 instead of 1.

       <b>category_mask</b>
              Skip pages for which any <b>PAGE_IS_</b><u>*</u> category doesn't match.

       <b>category_anyof_mask</b>
              Skip pages for which no <b>PAGE_IS_</b><u>*</u> category matches.

       <b>return_mask</b>
              <b>PAGE_IS_</b><u>*</u> categories that are to be reported in <u>page_region</u>.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On error, -1 is returned, and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       Error codes can be one of, but are not limited to, the following:

       <b>EINVAL</b> Invalid arguments i.e., invalid <u>size</u> of the argument, invalid <u>flags</u>, invalid <u>categories</u>, the <u>start</u>
              address isn't aligned with <b>PAGE_SIZE</b>, or <u>vec_len</u> is specified when <u>vec</u> is NULL.

       <b>EFAULT</b> Invalid <u>arg</u> pointer, invalid <u>vec</u> pointer, or invalid address range specified by <u>start</u> and <u>end</u>.

       <b>ENOMEM</b> No memory is available.

       <b>EINTR</b>  Fetal signal is pending.

</pre><h4><b>STANDARDS</b></h4><pre>
       Linux.

</pre><h4><b>HISTORY</b></h4><pre>
       Linux 6.7.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/ioctl.2.html">ioctl</a></b>(2)

Linux man-pages 6.9.1                              2024-06-17                               <u><a href="../man2const/PAGEMAP_SCAN.2const.html">PAGEMAP_SCAN</a></u>(2const)
</pre>
 </div>
</div></section>
</div>
</body>
</html>