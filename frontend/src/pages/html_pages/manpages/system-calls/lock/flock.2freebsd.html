<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flock — apply or remove an advisory lock on an open file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       flock — apply or remove an advisory lock on an open file

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C Library (libc, -lc)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/file.h&gt;</b>
       <b>#define</b>   <b>LOCK_SH</b>        <b>0x01</b>      <b>/*</b> <b>shared</b> <b>file</b> <b>lock</b> <b>*/</b>
       <b>#define</b>   <b>LOCK_EX</b>        <b>0x02</b>      <b>/*</b> <b>exclusive</b> <b>file</b> <b>lock</b> <b>*/</b>
       <b>#define</b>   <b>LOCK_NB</b>        <b>0x04</b>      <b>/*</b> <b>do</b> <b>not</b> <b>block</b> <b>when</b> <b>locking</b> <b>*/</b>
       <b>#define</b>   <b>LOCK_UN</b>        <b>0x08</b>      <b>/*</b> <b>unlock</b> <b>file</b> <b>*/</b>

       <u>int</u>
       <b>flock</b>(<u>int</u> <u>fd</u>, <u>int</u> <u>operation</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>flock</b>()  system  call  applies  or  removes  an  <u>advisory</u>  lock on the file associated with the file
       descriptor <u>fd</u>.  A lock is applied by specifying an <u>operation</u> argument that is one of LOCK_SH  or  LOCK_EX
       with the optional addition of LOCK_NB.  To unlock an existing lock operation should be LOCK_UN.

       Advisory  locks  allow  cooperating  processes  to  perform  consistent  operations  on files, but do not
       guarantee consistency (i.e., processes may still access  files  without  using  advisory  locks  possibly
       resulting in inconsistencies).

       The  locking mechanism allows two types of locks: <u>shared</u> locks and <u>exclusive</u> locks.  At any time multiple
       shared locks may be applied to a file, but at  no  time  are  multiple  exclusive,  or  both  shared  and
       exclusive, locks allowed simultaneously on a file.

       A  shared lock may be <u>upgraded</u> to an exclusive lock, and vice versa, simply by specifying the appropriate
       lock type; this results in the previous lock being released and the  new  lock  applied  (possibly  after
       other processes have gained and released the lock).

       Requesting  a lock on an object that is already locked normally causes the caller to be blocked until the
       lock may be acquired.  If LOCK_NB is included in <u>operation</u>, then this will not happen; instead  the  call
       will fail and the error EWOULDBLOCK will be returned.

</pre><h4><b>NOTES</b></h4><pre>
       Locks are on files, not file descriptors.  That is, file descriptors duplicated through <u><a href="../man2/dup.2.html">dup</a></u>(2) or <u><a href="../man2/fork.2.html">fork</a></u>(2)
       do  not  result  in  multiple instances of a lock, but rather multiple references to a single lock.  If a
       process holding a lock on a file forks and the child explicitly unlocks the file, the  parent  will  lose
       its lock.

       The  <b>flock</b>(),  <u><a href="../man2/fcntl.2.html">fcntl</a></u>(2), and <u><a href="../man3/lockf.3.html">lockf</a></u>(3) locks are compatible.  Processes using different locking interfaces
       can cooperate over the same file safely.  However, only one of such interfaces should be used within  the
       same  process.  If a file is locked by a process through <b>flock</b>(), any record within the file will be seen
       as locked from the viewpoint of another process using <u><a href="../man2/fcntl.2.html">fcntl</a></u>(2) or <u><a href="../man3/lockf.3.html">lockf</a></u>(3), and vice versa.

       Processes blocked awaiting a lock may be awakened by signals.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       The <b>flock</b>() function returns the value 0 if successful; otherwise the value -1 is returned and the global
       variable <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       The <b>flock</b>() system call fails if:

       [EWOULDBLOCK]      The file is locked and the LOCK_NB option was specified.

       [EBADF]            The argument <u>fd</u> is an invalid descriptor.

       [EINVAL]           The argument <u>fd</u> refers to an object other than a file.

       [EOPNOTSUPP]       The argument <u>fd</u> refers to an object that does not support file locking.

       [ENOLCK]           A lock was requested, but no locks are available.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man2/close.2.html">close</a></u>(2), <u><a href="../man2/dup.2.html">dup</a></u>(2), <u><a href="../man2/execve.2.html">execve</a></u>(2), <u><a href="../man2/fcntl.2.html">fcntl</a></u>(2), <u><a href="../man2/fork.2.html">fork</a></u>(2), <u><a href="../man2/open.2.html">open</a></u>(2), <u><a href="../man3/flopen.3.html">flopen</a></u>(3), <u><a href="../man3/lockf.3.html">lockf</a></u>(3)

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>flock</b>() system call appeared in 4.2BSD.

Debian                                          November 9, 2011                                        <u><a href="../man2/FLOCK.2.html">FLOCK</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>