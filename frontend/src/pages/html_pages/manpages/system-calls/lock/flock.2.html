<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flock - apply or remove an advisory lock on an open file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       flock - apply or remove an advisory lock on an open file

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/file.h&gt;</b>

       <b>int</b> <b>flock(int</b> <u>fd</u><b>,</b> <b>int</b> <u>op</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Apply  or  remove  an  advisory  lock  on  the  open file specified by <u>fd</u>.  The argument <u>op</u> is one of the
       following:

           <b>LOCK_SH</b>  Place a shared lock.  More than one process may hold a shared lock for a  given  file  at  a
                    given time.

           <b>LOCK_EX</b>  Place  an exclusive lock.  Only one process may hold an exclusive lock for a given file at a
                    given time.

           <b>LOCK_UN</b>  Remove an existing lock held by this process.

       A call to <b>flock</b>() may block if an incompatible lock is held by another process.  To  make  a  nonblocking
       request, include <b>LOCK_NB</b> (by ORing) with any of the above operations.

       A single file may not simultaneously have both shared and exclusive locks.

       Locks  created  by  <b>flock</b>()  are associated with an open file description (see <b><a href="../man2/open.2.html">open</a></b>(2)).  This means that
       duplicate file descriptors (created by, for example, <b><a href="../man2/fork.2.html">fork</a></b>(2) or <b><a href="../man2/dup.2.html">dup</a></b>(2)) refer to the same lock, and  this
       lock  may be modified or released using any of these file descriptors.  Furthermore, the lock is released
       either by an explicit <b>LOCK_UN</b> operation on any of these duplicate file descriptors, or when all such file
       descriptors have been closed.

       If a process uses <b><a href="../man2/open.2.html">open</a></b>(2) (or similar) to obtain more than one file descriptor for the same  file,  these
       file  descriptors  are  treated independently by <b>flock</b>().  An attempt to lock the file using one of these
       file descriptors may be denied by a lock that the calling process has already  placed  via  another  file
       descriptor.

       A process may hold only one type of lock (shared or exclusive) on a file.  Subsequent <b>flock</b>() calls on an
       already locked file will convert an existing lock to the new lock mode.

       Locks created by <b>flock</b>() are preserved across an <b><a href="../man2/execve.2.html">execve</a></b>(2).

       A shared or exclusive lock can be placed on a file regardless of the mode in which the file was opened.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, zero is returned.  On error, -1 is returned, and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EBADF</b>  <u>fd</u> is not an open file descriptor.

       <b>EINTR</b>  While  waiting  to  acquire  a  lock, the call was interrupted by delivery of a signal caught by a
              handler; see <b><a href="../man7/signal.7.html">signal</a></b>(7).

       <b>EINVAL</b> <u>op</u> is invalid.

       <b>ENOLCK</b> The kernel ran out of memory for allocating lock records.

       <b>EWOULDBLOCK</b>
              The file is locked and the <b>LOCK_NB</b> flag was selected.

</pre><h4><b>VERSIONS</b></h4><pre>
       Since Linux 2.0, <b>flock</b>() is implemented as a system call in its own right rather than being  emulated  in
       the  GNU  C library as a call to <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2).  With this implementation, there is no interaction between the
       types of lock placed by <b>flock</b>() and <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2), and <b>flock</b>() does not detect deadlock.  (Note, however, that
       on some systems, such as the modern BSDs, <b>flock</b>() and <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2) locks <u>do</u> interact with one another.)

   <b>CIFS</b> <b>details</b>
       Up to Linux 5.4, <b>flock</b>() is not propagated over SMB.  A file with such locks will not appear  locked  for
       remote clients.

       Since  Linux  5.5, <b>flock</b>() locks are emulated with SMB byte-range locks on the entire file.  Similarly to
       NFS, this means that <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2) and <b>flock</b>() locks interact with one another.  Another important side-effect
       is that the locks are not advisory anymore: any IO on a locked file will always  fail  with  <b>EACCES</b>  when
       done  from  a  separate  file descriptor.  This difference originates from the design of locks in the SMB
       protocol, which provides mandatory locking semantics.

       Remote and mandatory locking semantics may vary with SMB protocol, mount options and  server  type.   See
       <b><a href="../man8/mount.cifs.8.html">mount.cifs</a></b>(8) for additional information.

</pre><h4><b>STANDARDS</b></h4><pre>
       BSD.

</pre><h4><b>HISTORY</b></h4><pre>
       4.4BSD  (the <b>flock</b>() call first appeared in 4.2BSD).  A version of <b>flock</b>(), possibly implemented in terms
       of <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2), appears on most UNIX systems.

   <b>NFS</b> <b>details</b>
       Up to Linux 2.6.11, <b>flock</b>() does not lock files over NFS (i.e., the scope of locks  was  limited  to  the
       local  system).   Instead,  one  could use <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2) byte-range locking, which does work over NFS, given a
       sufficiently recent version of Linux and a server which supports locking.

       Since Linux 2.6.12, NFS clients support <b>flock</b>() locks by emulating them as <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2) byte-range  locks  on
       the  entire  file.  This means that <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2) and <b>flock</b>() locks <u>do</u> interact with one another over NFS.  It
       also means that in order to place an exclusive lock, the file must be opened for writing.

       Since Linux 2.6.37, the kernel supports a compatibility mode that allows <b>flock</b>() locks (and also <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2)
       byte region locks) to be treated as local; see the discussion of the <u>local_lock</u> option in <b><a href="../man5/nfs.5.html">nfs</a></b>(5).

</pre><h4><b>NOTES</b></h4><pre>
       <b>flock</b>() places advisory locks only; given suitable permissions on a file, a process is free to ignore the
       use of <b>flock</b>() and perform I/O on the file.

       <b>flock</b>() and <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2) locks have different semantics with respect to  forked  processes  and  <b><a href="../man2/dup.2.html">dup</a></b>(2).   On
       systems  that  implement  <b>flock</b>()  using  <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2), the semantics of <b>flock</b>() will be different from those
       described in this manual page.

       Converting a lock (shared to exclusive, or vice versa) is not guaranteed to be atomic: the existing  lock
       is first removed, and then a new lock is established.  Between these two steps, a pending lock request by
       another  process  may  be granted, with the result that the conversion either blocks, or fails if <b>LOCK_NB</b>
       was specified.  (This is the original BSD behavior, and occurs on many other implementations.)

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/flock.1.html">flock</a></b>(1), <b><a href="../man2/close.2.html">close</a></b>(2), <b><a href="../man2/dup.2.html">dup</a></b>(2), <b><a href="../man2/execve.2.html">execve</a></b>(2), <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2), <b><a href="../man2/fork.2.html">fork</a></b>(2), <b><a href="../man2/open.2.html">open</a></b>(2), <b><a href="../man3/lockf.3.html">lockf</a></b>(3), <b><a href="../man8/lslocks.8.html">lslocks</a></b>(8)

       <u>Documentation/filesystems/locks.txt</u> in the Linux kernel source  tree  (<u>Documentation/locks.txt</u>  in  older
       kernels)

Linux man-pages 6.9.1                              2024-05-02                                           <u><a href="../man2/flock.2.html">flock</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>