<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>modify_ldt - get or set a per-process LDT entry</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       modify_ldt - get or set a per-process LDT entry

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;asm/ldt.h&gt;</b>         /* Definition of <b>struct</b> <b>user_desc</b> */
       <b>#include</b> <b>&lt;sys/syscall.h&gt;</b>     /* Definition of <b>SYS_*</b> constants */
       <b>#include</b> <b>&lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;</b>

       <b>int</b> <b>syscall(SYS_modify_ldt,</b> <b>int</b> <u>func</u><b>,</b> <b>void</b> <u>ptr</u><b>[.</b><u>bytecount</u><b>],</b>
                   <b>unsigned</b> <b>long</b> <u>bytecount</u><b>);</b>

       <u>Note</u>: glibc provides no wrapper for <b>modify_ldt</b>(), necessitating the use of <b><a href="../man2/syscall.2.html">syscall</a></b>(2).

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>modify_ldt</b>()  reads  or  writes  the  local descriptor table (LDT) for a process.  The LDT is an array of
       segment descriptors that can be referenced by user code.  Linux allows  processes  to  configure  a  per-
       process  (actually  per-mm)  LDT.  For more information about the LDT, see the Intel Software Developer's
       Manual or the AMD Architecture Programming Manual.

       When <u>func</u> is 0, <b>modify_ldt</b>() reads the LDT into the memory pointed to by <u>ptr</u>.  The number of  bytes  read
       is the smaller of <u>bytecount</u> and the actual size of the LDT, although the kernel may act as though the LDT
       is  padded with additional trailing zero bytes.  On success, <b>modify_ldt</b>() will return the number of bytes
       read.

       When <u>func</u> is 1 or 0x11, <b>modify_ldt</b>() modifies the LDT entry indicated by <u>ptr-&gt;entry_number</u>.   <u>ptr</u>  points
       to a <u>user_desc</u> structure and <u>bytecount</u> must equal the size of this structure.

       The <u>user_desc</u> structure is defined in <u>&lt;asm/ldt.h&gt;</u> as:

           struct user_desc {
               unsigned int  entry_number;
               unsigned int  base_addr;
               unsigned int  limit;
               unsigned int  seg_32bit:1;
               unsigned int  contents:2;
               unsigned int  read_exec_only:1;
               unsigned int  limit_in_pages:1;
               unsigned int  seg_not_present:1;
               unsigned int  useable:1;
           };

       In Linux 2.4 and earlier, this structure was named <u>modify_ldt_ldt_s</u>.

       The <u>contents</u> field is the segment type (data, expand-down data, non-conforming code, or conforming code).
       The  other  fields  match  their  descriptions  in  the  CPU manual, although <b>modify_ldt</b>() cannot set the
       hardware-defined "accessed" bit described in the CPU manual.

       A <u>user_desc</u> is considered "empty" if <u>read_exec_only</u> and <u>seg_not_present</u> are set to 1 and all of the other
       fields are 0.  An LDT entry can be cleared by setting it to an "empty" <u>user_desc</u> or, if  <u>func</u>  is  1,  by
       setting both <u>base</u> and <u>limit</u> to 0.

       A  conforming  code  segment  (i.e.,  one  with  <u>contents==3</u>)  will  be  rejected  if  <u>func</u>  is  1  or if
       <u>seg_not_present</u> is 0.

       When <u>func</u> is 2, <b>modify_ldt</b>() will read zeros.  This appears to be a leftover from Linux 2.4.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>modify_ldt</b>() returns either the actual number of bytes read (for reading) or 0 (for writing).
       On failure, <b>modify_ldt</b>() returns -1 and sets <u>errno</u> to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EFAULT</b> <u>ptr</u> points outside the address space.

       <b>EINVAL</b> <u>ptr</u> is 0, or <u>func</u> is 1 and <u>bytecount</u> is not equal to the size of the structure <u>user_desc</u>, or  <u>func</u>
              is 1 or 0x11 and the new LDT entry has invalid values.

       <b>ENOSYS</b> <u>func</u> is neither 0, 1, 2, nor 0x11.

</pre><h4><b>STANDARDS</b></h4><pre>
       Linux.

</pre><h4><b>NOTES</b></h4><pre>
       <b>modify_ldt</b>()  should  not  be  used  for thread-local storage, as it slows down context switches and only
       supports a limited number of threads.  Threading libraries should use <b><a href="../man2/set_thread_area.2.html">set_thread_area</a></b>(2) or <b><a href="../man2/arch_prctl.2.html">arch_prctl</a></b>(2)
       instead, except on extremely old kernels that do not support those system calls.

       The normal use for <b>modify_ldt</b>() is to run legacy 16-bit or segmented 32-bit code.  Not all kernels  allow
       16-bit segments to be installed, however.

       Even  on  64-bit  kernels, <b>modify_ldt</b>() cannot be used to create a long mode (i.e., 64-bit) code segment.
       The undocumented field "lm" in <u>user_desc</u> is not useful, and, despite its name, does not result in a  long
       mode segment.

</pre><h4><b>BUGS</b></h4><pre>
       On 64-bit kernels before Linux 3.19, setting the "lm" bit in <u>user_desc</u> prevents the descriptor from being
       considered  empty.   Keep in mind that the "lm" bit does not exist in the 32-bit headers, but these buggy
       kernels will still notice the bit even when set in a 32-bit process.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/arch_prctl.2.html">arch_prctl</a></b>(2), <b><a href="../man2/set_thread_area.2.html">set_thread_area</a></b>(2), <b><a href="../man2/vm86.2.html">vm86</a></b>(2)

Linux man-pages 6.9.1                              2024-05-02                                      <u><a href="../man2/modify_ldt.2.html">modify_ldt</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>