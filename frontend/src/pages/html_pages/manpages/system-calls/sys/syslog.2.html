<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>syslog, klogctl - read and/or clear kernel message ring buffer; set console_loglevel</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       syslog, klogctl - read and/or clear kernel message ring buffer; set console_loglevel

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/klog.h&gt;</b>        /* Definition of <b>SYSLOG_*</b> constants */
       <b>#include</b> <b>&lt;sys/syscall.h&gt;</b>     /* Definition of <b>SYS_*</b> constants */
       <b>#include</b> <b>&lt;<a href="file:/usr/include/unistd.h">unistd.h</a>&gt;</b>

       <b>int</b> <b>syscall(SYS_syslog,</b> <b>int</b> <u>type</u><b>,</b> <b>char</b> <b>*</b><u>bufp</u><b>,</b> <b>int</b> <u>len</u><b>);</b>

       /* The glibc interface */
       <b>#include</b> <b>&lt;sys/klog.h&gt;</b>

       <b>int</b> <b>klogctl(int</b> <u>type</u><b>,</b> <b>char</b> <b>*</b><u>bufp</u><b>,</b> <b>int</b> <u>len</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <u>Note</u>:  Probably,  you  are  looking  for  the C library function <b>syslog</b>(), which talks to <b><a href="../man8/syslogd.8.html">syslogd</a></b>(8); see
       <b><a href="../man3/syslog.3.html">syslog</a></b>(3) for details.

       This page describes the kernel <b>syslog</b>() system call, which is used to control the kernel <u>printk</u>() buffer;
       the glibc wrapper function for the system call is called <b>klogctl</b>().

   <b>The</b> <b>kernel</b> <b>log</b> <b>buffer</b>
       The kernel has a cyclic buffer of length <b>LOG_BUF_LEN</b> in which messages given as arguments to  the  kernel
       function  <b>printk</b>()  are  stored  (regardless  of their log level).  In early kernels, <b>LOG_BUF_LEN</b> had the
       value 4096; from Linux 1.3.54, it was 8192; from Linux 2.1.113, it was 16384; since Linux 2.4.23/2.6, the
       value  is  a  kernel  configuration  option  (<b>CONFIG_LOG_BUF_SHIFT</b>,  default  value  dependent   on   the
       architecture).  Since Linux 2.6.6, the size can be queried with command type 10 (see below).

   <b>Commands</b>
       The  <u>type</u> argument determines the action taken by this function.  The list below specifies the values for
       <u>type</u>.  The symbolic names are defined in the kernel source, but are not exported to user space; you  will
       either need to use the numbers, or define the names yourself.

       <b>SYSLOG_ACTION_CLOSE</b> (0)
              Close the log.  Currently a NOP.

       <b>SYSLOG_ACTION_OPEN</b> (1)
              Open the log.  Currently a NOP.

       <b>SYSLOG_ACTION_READ</b> (2)
              Read from the log.  The call waits until the kernel log buffer is nonempty, and then reads at most
              <u>len</u>  bytes  into the buffer pointed to by <u>bufp</u>.  The call returns the number of bytes read.  Bytes
              read from the log disappear from the log buffer: the information can be read only once.   This  is
              the function executed by the kernel when a user program reads <u><a href="file:/proc/kmsg">/proc/kmsg</a></u>.

       <b>SYSLOG_ACTION_READ_ALL</b> (3)
              Read  all  messages  remaining  in the ring buffer, placing them in the buffer pointed to by <u>bufp</u>.
              The call reads the last <u>len</u> bytes from the log buffer (nondestructively), but will not  read  more
              than  was  written  into  the  buffer  since  the  last "clear ring buffer" command (see command 5
              below)).  The call returns the number of bytes read.

       <b>SYSLOG_ACTION_READ_CLEAR</b> (4)
              Read and clear all messages remaining in the ring buffer.  The call does precisely the same as for
              a <u>type</u> of 3, but also executes the "clear ring buffer" command.

       <b>SYSLOG_ACTION_CLEAR</b> (5)
              The call executes just the "clear ring buffer" command.  The <u>bufp</u> and <u>len</u> arguments are ignored.

              This command does not really clear the ring buffer.  Rather, it sets a kernel bookkeeping variable
              that  determines  the  results   returned   by   commands   3   (<b>SYSLOG_ACTION_READ_ALL</b>)   and   4
              (<b>SYSLOG_ACTION_READ_CLEAR</b>).   This  command has no effect on commands 2 (<b>SYSLOG_ACTION_READ</b>) and 9
              (<b>SYSLOG_ACTION_SIZE_UNREAD</b>).

       <b>SYSLOG_ACTION_CONSOLE_OFF</b> (6)
              The command saves the  current  value  of  <u>console_loglevel</u>  and  then  sets  <u>console_loglevel</u>  to
              <u>minimum_console_loglevel</u>,  so  that  no messages are printed to the console.  Before Linux 2.6.32,
              the command simply sets <u>console_loglevel</u>  to  <u>minimum_console_loglevel</u>.   See  the  discussion  of
              <u><a href="file:/proc/sys/kernel/printk">/proc/sys/kernel/printk</a></u>, below.

              The <u>bufp</u> and <u>len</u> arguments are ignored.

       <b>SYSLOG_ACTION_CONSOLE_ON</b> (7)
              If  a  previous  <b>SYSLOG_ACTION_CONSOLE_OFF</b>  command  has  been  performed,  this  command restores
              <u>console_loglevel</u> to the value that was saved by that command.  Before Linux 2.6.32,  this  command
              simply    sets    <u>console_loglevel</u>   to   <u>default_console_loglevel</u>.    See   the   discussion   of
              <u><a href="file:/proc/sys/kernel/printk">/proc/sys/kernel/printk</a></u>, below.

              The <u>bufp</u> and <u>len</u> arguments are ignored.

       <b>SYSLOG_ACTION_CONSOLE_LEVEL</b> (8)
              The call sets <u>console_loglevel</u> to the value given in <u>len</u>, which must be an integer between 1 and 8
              (inclusive).  The kernel silently enforces a minimum value of  <u>minimum_console_loglevel</u>  for  <u>len</u>.
              See the <u>log</u> <u>level</u> section for details.  The <u>bufp</u> argument is ignored.

       <b>SYSLOG_ACTION_SIZE_UNREAD</b> (9) (since Linux 2.4.10)
              The call returns the number of bytes currently available to be read from the kernel log buffer via
              command 2 (<b>SYSLOG_ACTION_READ</b>).  The <u>bufp</u> and <u>len</u> arguments are ignored.

       <b>SYSLOG_ACTION_SIZE_BUFFER</b> (10) (since Linux 2.6.6)
              This  command  returns  the  total  size of the kernel log buffer.  The <u>bufp</u> and <u>len</u> arguments are
              ignored.

       All commands except 3 and 10 require privilege.  In Linux kernels before Linux 2.6.37,  command  types  3
       and  10  are  allowed  to  unprivileged  processes;  since  Linux  2.6.37,  these commands are allowed to
       unprivileged processes only if <u><a href="file:/proc/sys/kernel/dmesg_restrict">/proc/sys/kernel/dmesg_restrict</a></u> has the value  0.   Before  Linux  2.6.37,
       "privileged"  means  that  the caller has the <b>CAP_SYS_ADMIN</b> capability.  Since Linux 2.6.37, "privileged"
       means that the caller has either the <b>CAP_SYS_ADMIN</b> capability (now deprecated for this  purpose)  or  the
       (new) <b>CAP_SYSLOG</b> capability.

   <b><a href="file:/proc/sys/kernel/printk">/proc/sys/kernel/printk</a></b>
       <u><a href="file:/proc/sys/kernel/printk">/proc/sys/kernel/printk</a></u>  is a writable file containing four integer values that influence kernel <u>printk()</u>
       behavior when printing or logging error messages.  The four values are:

       <u>console_loglevel</u>
              Only messages with a log level lower than this value will be printed to the console.  The  default
              value  for  this  field  is <b>DEFAULT_CONSOLE_LOGLEVEL</b> (7), but it is set to 4 if the kernel command
              line contains the word "quiet", 10 if the kernel command line contains the word "debug", and to 15
              in case of a kernel fault (the 10 and 15 are just silly, and  equivalent  to  8).   The  value  of
              <u>console_loglevel</u> can be set (to a value in the range 1â€“8) by a <b>syslog</b>() call with a <u>type</u> of 8.

       <u>default_message_loglevel</u>
              This value will be used as the log level for <u>printk()</u> messages that do not have an explicit level.
              Up   to  and  including  Linux  2.6.38,  the  hard-coded  default  value  for  this  field  was  4
              (<b>KERN_WARNING</b>); since Linux 2.6.39, the default value  is  defined  by  the  kernel  configuration
              option <b>CONFIG_DEFAULT_MESSAGE_LOGLEVEL</b>, which defaults to 4.

       <u>minimum_console_loglevel</u>
              The value in this field is the minimum value to which <u>console_loglevel</u> can be set.

       <u>default_console_loglevel</u>
              This is the default value for <u>console_loglevel</u>.

   <b>The</b> <b>log</b> <b>level</b>
       Every  <u>printk</u>()  message  has its own log level.  If the log level is not explicitly specified as part of
       the message, it defaults to <u>default_message_loglevel</u>.  The conventional meaning of the log  level  is  as
       follows:
       <b>Kernel</b> <b>constant</b>   <b>Level</b> <b>value</b>   <b>Meaning</b>
       <b>KERN_EMERG</b>             0        System is unusable
       <b>KERN_ALERT</b>             1        Action    must    be   taken
                                       immediately
       <b>KERN_CRIT</b>              2        Critical conditions
       <b>KERN_ERR</b>               3        Error conditions
       <b>KERN_WARNING</b>           4        Warning conditions
       <b>KERN_NOTICE</b>            5        Normal    but    significant
                                       condition
       <b>KERN_INFO</b>              6        Informational
       <b>KERN_DEBUG</b>             7        Debug-level messages

       The  kernel <u>printk()</u> routine will print a message on the console only if it has a log level less than the
       value of <u>console_loglevel</u>.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       For <u>type</u> equal to 2, 3, or 4, a successful call to <b>syslog</b>() returns the number of bytes read.   For  <u>type</u>
       9,  <b>syslog</b>()  returns  the  number of bytes currently available to be read on the kernel log buffer.  For
       <u>type</u> 10, <b>syslog</b>() returns the total size of the kernel log buffer.   For  other  values  of  <u>type</u>,  0  is
       returned on success.

       In case of error, -1 is returned, and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EINVAL</b> Bad  arguments  (e.g., bad <u>type</u>; or for <u>type</u> 2, 3, or 4, <u>buf</u> is NULL, or <u>len</u> is less than zero; or
              for <u>type</u> 8, the <u>level</u> is outside the range 1 to 8).

       <b>ENOSYS</b> This <b>syslog</b>() system call is not available, because the kernel was compiled with the <b>CONFIG_PRINTK</b>
              kernel-configuration option disabled.

       <b>EPERM</b>  An attempt was made to change <u>console_loglevel</u> or clear  the  kernel  message  ring  buffer  by  a
              process  without  sufficient  privilege  (more  precisely: without the <b>CAP_SYS_ADMIN</b> or <b>CAP_SYSLOG</b>
              capability).

       <b>ERESTARTSYS</b>
              System call was interrupted by a signal; nothing was read.   (This  can  be  seen  only  during  a
              trace.)

</pre><h4><b>STANDARDS</b></h4><pre>
       Linux.

</pre><h4><b>HISTORY</b></h4><pre>
       From  the very start, people noted that it is unfortunate that a system call and a library routine of the
       same name are entirely different animals.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/dmesg.1.html">dmesg</a></b>(1), <b><a href="../man3/syslog.3.html">syslog</a></b>(3), <b><a href="../man7/capabilities.7.html">capabilities</a></b>(7)

Linux man-pages 6.9.1                              2024-05-02                                          <u><a href="../man2/syslog.2.html">syslog</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>