<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ktrace — process tracing</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ktrace — process tracing

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C Library (libc, -lc)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/param.h&gt;</b>
       <b>#include</b> <b>&lt;sys/time.h&gt;</b>
       <b>#include</b> <b>&lt;sys/uio.h&gt;</b>
       <b>#include</b> <b>&lt;sys/ktrace.h&gt;</b>

       <u>int</u>
       <b>ktrace</b>(<u>const</u> <u>char</u> <u>*tracefile</u>, <u>int</u> <u>ops</u>, <u>int</u> <u>trpoints</u>, <u>int</u> <u>pid</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>ktrace</b>()  system  call  enables  or disables tracing of one or more processes.  Users may only trace
       their own processes.  Only the super-user can trace setuid or setgid programs.

       The <u>tracefile</u> argument gives the pathname of the file to be used for tracing.  The file must exist and be
       a regular file writable by the calling process.  All trace records are always appended to  the  file,  so
       the  file  must  be truncated to zero length to discard previous trace data.  If tracing points are being
       disabled (see KTROP_CLEAR below), <u>tracefile</u> may be NULL.

       The <u>ops</u> argument specifies the requested ktrace operation.  The defined operations are:

             KTROP_SET             Enable trace points specified in <u>trpoints</u>.
             KTROP_CLEAR           Disable trace points specified in <u>trpoints</u>.
             KTROP_CLEARFILE       Stop all tracing.
             KTRFLAG_DESCEND       The tracing change should apply to the specified process and all its  current
                                   children.

       The <u>trpoints</u> argument specifies the trace points of interest.  The defined trace points are:

             KTRFAC_SYSCALL        Trace system calls.
             KTRFAC_SYSRET         Trace return values from system calls.
             KTRFAC_NAMEI          Trace name lookup operations.
             KTRFAC_GENIO          Trace all I/O (note that this option can generate much output).
             KTRFAC_PSIG           Trace posted signals.
             KTRFAC_CSW            Trace context switch points.
             KTRFAC_USER           Trace application-specific events.
             KTRFAC_STRUCT         Trace certain data structures.
             KTRFAC_SYSCTL         Trace sysctls.
             KTRFAC_PROCCTOR       Trace process construction.
             KTRFAC_PROCDTOR       Trace process destruction.
             KTRFAC_CAPFAIL        Trace capability failures.
             KTRFAC_FAULT          Trace page faults.
             KTRFAC_FAULTEND       Trace the end of page faults.
             KTRFAC_INHERIT        Inherit tracing to future children.

       Each  tracing  event  outputs  a  record  composed of a generic header followed by a trace point specific
       structure.  The generic header is:

       struct ktr_header {
               int             ktr_len;                /* length of buf */
               short           ktr_type;               /* trace record type */
               pid_t           ktr_pid;                /* process id */
               char            ktr_comm[MAXCOMLEN+1];  /* command name */
               struct timeval  ktr_time;               /* timestamp */
               intptr_t        ktr_tid;                /* was ktr_buffer */
       };

       The <u>ktr_len</u> field specifies the length of the <u>ktr_type</u> data that follows this header.   The  <u>ktr_pid</u>  and
       <u>ktr_comm</u> fields specify the process and command generating the record.  The <u>ktr_time</u> field gives the time
       (with microsecond resolution) that the record was generated.  The <u>ktr_tid</u> field holds a thread id.

       The  generic  header  is  followed  by <u>ktr_len</u> bytes of a <u>ktr_type</u> record.  The type specific records are
       defined in the &lt;<u>sys/ktrace.h</u>&gt; include file.

</pre><h4><b>SYSCTL</b> <b>TUNABLES</b></h4><pre>
       The following <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8) tunables influence the behaviour of <b>ktrace</b>():

       <u>kern.ktrace.geniosize</u>
               bounds the amount of data a traced I/O request will log to the trace file.

       <u>kern.ktrace.request_pool</u>
               bounds the number of trace events being logged at a time.

       Sysctl tunables that control process debuggability (as  determined  by  <u><a href="../man9/p_candebug.9.html">p_candebug</a></u>(9))  also  affect  the
       operation of <b>ktrace</b>().

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       The  <b>ktrace</b>()  function  returns  the  value  0 if successful; otherwise the value -1 is returned and the
       global variable <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       The <b>ktrace</b>() system call will fail if:

       [ENOTDIR]          A component of the path prefix is not a directory.

       [ENAMETOOLONG]     A component of a pathname exceeded 255 characters, or an  entire  path  name  exceeded
                          1023 characters.

       [ENOENT]           The named tracefile does not exist.

       [EACCES]           Search permission is denied for a component of the path prefix.

       [ELOOP]            Too many symbolic links were encountered in translating the pathname.

       [EIO]              An I/O error occurred while reading from or writing to the file system.

       [EINTEGRITY]       Corrupted data was detected while reading from the file system.

       [ENOSYS]           The kernel was not compiled with <b>ktrace</b> support.

       A  thread may be unable to log one or more tracing events due to a temporary shortage of resources.  This
       condition is remembered by the kernel, and the next tracing request that  succeeds  will  have  the  flag
       <b>KTR_DROP</b> set in its <u>ktr_type</u> field.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/kdump.1.html">kdump</a></u>(1), <u><a href="../man1/ktrace.1.html">ktrace</a></u>(1), <u><a href="../man2/utrace.2.html">utrace</a></u>(2), <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8), <u><a href="../man9/p_candebug.9.html">p_candebug</a></u>(9)

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>ktrace</b>() system call first appeared in 4.4BSD.

Debian                                           March 30, 2020                                        <u><a href="../man2/KTRACE.2.html">KTRACE</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>