<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FICLONE, FICLONERANGE - share some the data of one file with another file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       FICLONE, FICLONERANGE - share some the data of one file with another file

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/linux/fs.h">linux/fs.h</a>&gt;</b>  /* Definition of <b>FICLONE*</b> constants */
       <b>#include</b> <b>&lt;sys/ioctl.h&gt;</b>

       <b>int</b> <b>ioctl(int</b> <u>dest_fd</u><b>,</b> <b>FICLONERANGE,</b> <b>struct</b> <b>file_clone_range</b> <b>*</b><u>arg</u><b>);</b>
       <b>int</b> <b>ioctl(int</b> <u>dest_fd</u><b>,</b> <b>FICLONE,</b> <b>int</b> <u>src_fd</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       If a filesystem supports files sharing physical storage between multiple files ("reflink"), this <b><a href="../man2/ioctl.2.html">ioctl</a></b>(2)
       operation  can  be used to make some of the data in the <u>src_fd</u> file appear in the <u>dest_fd</u> file by sharing
       the underlying storage, which is faster than making a separate physical copy of  the  data.   Both  files
       must  reside within the same filesystem.  If a file write should occur to a shared region, the filesystem
       must ensure that the changes remain private to  the  file  being  written.   This  behavior  is  commonly
       referred to as "copy on write".

       This ioctl reflinks up to <u>src_length</u> bytes from file descriptor <u>src_fd</u> at offset <u>src_offset</u> into the file
       <u>dest_fd</u>  at  offset <u>dest_offset</u>, provided that both are files.  If <u>src_length</u> is zero, the ioctl reflinks
       to the end of the source file.  This information is conveyed in a structure of the following form:

           struct file_clone_range {
               __s64 src_fd;
               __u64 src_offset;
               __u64 src_length;
               __u64 dest_offset;
           };

       Clones are atomic with regards to concurrent writes, so no locks need to be taken to obtain a  consistent
       cloned copy.

       The <b>FICLONE</b> ioctl clones entire files.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On error, -1 is returned, and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       Error codes can be one of, but are not limited to, the following:

       <b>EBADF</b>  <u>src_fd</u> is not open for reading; <u>dest_fd</u> is not open for writing or is open for append-only writes;
              or the filesystem which <u>src_fd</u> resides on does not support reflink.

       <b>EINVAL</b> The  filesystem  does  not  support reflinking the ranges of the given files.  This error can also
              appear if either file descriptor represents a device, FIFO, or socket.  Disk filesystems generally
              require the offset and length arguments to be aligned to the  fundamental  block  size.   XFS  and
              Btrfs do not support overlapping reflink ranges in the same file.

       <b>EISDIR</b> One of the files is a directory and the filesystem does not support shared regions in directories.

       <b>EOPNOTSUPP</b>
              This can appear if the filesystem does not support reflinking either file descriptor, or if either
              file descriptor refers to special inodes.

       <b>EPERM</b>  <u>dest_fd</u> is immutable.

       <b>ETXTBSY</b>
              One of the files is a swap file.  Swap files cannot share storage.

       <b>EXDEV</b>  <u>dest_fd</u> and <u>src_fd</u> are not on the same mounted filesystem.

</pre><h4><b>STANDARDS</b></h4><pre>
       Linux.

</pre><h4><b>HISTORY</b></h4><pre>
       Linux 4.5.

       They were previously known as <b>BTRFS_IOC_CLONE</b> and <b>BTRFS_IOC_CLONE_RANGE</b>, and were private to Btrfs.

</pre><h4><b>CAVEATS</b></h4><pre>
       Because  a copy-on-write operation requires the allocation of new storage, the <b><a href="../man2/fallocate.2.html">fallocate</a></b>(2) operation may
       unshare shared blocks to guarantee that subsequent writes will not fail because of lack of disk space.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/ioctl.2.html">ioctl</a></b>(2)

Linux man-pages 6.9.1                              2024-06-13                                    <u><a href="../man2const/FICLONE.2const.html">FICLONE</a></u>(2const)
</pre>
 </div>
</div></section>
</div>
</body>
</html>