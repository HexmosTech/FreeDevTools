<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>msgctl - System V message control operations</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       msgctl - System V message control operations

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/msg.h&gt;</b>

       <b>int</b> <b>msgctl(int</b> <u>msqid</u><b>,</b> <b>int</b> <u>op</u><b>,</b> <b>struct</b> <b>msqid_ds</b> <b>*</b><u>buf</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>msgctl</b>()  performs  the  control  operation specified by <u>op</u> on the System V message queue with identifier
       <u>msqid</u>.

       The <u>msqid_ds</u> data structure is defined in <u>&lt;sys/msg.h&gt;</u> as follows:

           struct msqid_ds {
               struct ipc_perm msg_perm;   /* Ownership and permissions */
               time_t          msg_stime;  /* Time of last <a href="../man2/msgsnd.2.html">msgsnd</a>(2) */
               time_t          msg_rtime;  /* Time of last <a href="../man2/msgrcv.2.html">msgrcv</a>(2) */
               time_t          msg_ctime;  /* Time of creation or last
                                              modification by msgctl() */
               unsigned long   msg_cbytes; /* # of bytes in queue */
               msgqnum_t       msg_qnum;   /* # number of messages in queue */
               msglen_t        msg_qbytes; /* Maximum # of bytes in queue */
               pid_t           msg_lspid;  /* PID of last <a href="../man2/msgsnd.2.html">msgsnd</a>(2) */
               pid_t           msg_lrpid;  /* PID of last <a href="../man2/msgrcv.2.html">msgrcv</a>(2) */
           };

       The fields of the <u>msqid_ds</u> structure are as follows:

       <u>msg_perm</u>   This is an <u>ipc_perm</u> structure (see below) that specifies the access permissions on the message
                  queue.

       <u>msg_stime</u>  Time of the last <b><a href="../man2/msgsnd.2.html">msgsnd</a></b>(2) system call.

       <u>msg_rtime</u>  Time of the last <b><a href="../man2/msgrcv.2.html">msgrcv</a></b>(2) system call.

       <u>msg_ctime</u>  Time of creation of queue or time of last <b>msgctl</b>() <b>IPC_SET</b> operation.

       <u>msg_cbytes</u> Number of bytes in all messages currently on the message queue.  This is a  nonstandard  Linux
                  extension that is not specified in POSIX.

       <u>msg_qnum</u>   Number of messages currently on the message queue.

       <u>msg_qbytes</u> Maximum number of bytes of message text allowed on the message queue.

       <u>msg_lspid</u>  ID of the process that performed the last <b><a href="../man2/msgsnd.2.html">msgsnd</a></b>(2) system call.

       <u>msg_lrpid</u>  ID of the process that performed the last <b><a href="../man2/msgrcv.2.html">msgrcv</a></b>(2) system call.

       The <u>ipc_perm</u> structure is defined as follows (the highlighted fields are settable using <b>IPC_SET</b>):

           struct ipc_perm {
               key_t          __key;       /* Key supplied to <a href="../man2/msgget.2.html">msgget</a>(2) */
               uid_t          <b>uid</b>;         /* Effective UID of owner */
               gid_t          <b>gid</b>;         /* Effective GID of owner */
               uid_t          cuid;        /* Effective UID of creator */
               gid_t          cgid;        /* Effective GID of creator */
               unsigned short <b>mode</b>;        /* Permissions */
               unsigned short __seq;       /* Sequence number */
           };

       The  least  significant  9 bits of the <u>mode</u> field of the <u>ipc_perm</u> structure define the access permissions
       for the message queue.  The permission bits are as follows:
       0400   Read by user
       0200   Write by user
       0040   Read by group
       0020   Write by group
       0004   Read by others
       0002   Write by others

       Bits 0100, 0010, and 0001 (the execute bits) are unused by the system.

       Valid values for <u>op</u> are:

       <b>IPC_STAT</b>
              Copy information from the kernel data structure associated with <u>msqid</u> into the <u>msqid_ds</u>  structure
              pointed to by <u>buf</u>.  The caller must have read permission on the message queue.

       <b>IPC_SET</b>
              Write  the  values  of some members of the <u>msqid_ds</u> structure pointed to by <u>buf</u> to the kernel data
              structure associated with this message queue, updating also its <u>msg_ctime</u> member.

              The following members of the structure are updated: <u>msg_qbytes</u>,  <u>msg_perm.uid</u>,  <u>msg_perm.gid</u>,  and
              (the least significant 9 bits of) <u>msg_perm.mode</u>.

              The  effective  UID  of  the  calling  process  must  match  the  owner  (<u>msg_perm.uid</u>) or creator
              (<u>msg_perm.cuid</u>) of the message queue, or the caller must  be  privileged.   Appropriate  privilege
              (Linux:  the  <b>CAP_SYS_RESOURCE</b>  capability)  is  required to raise the <u>msg_qbytes</u> value beyond the
              system parameter <b>MSGMNB</b>.

       <b>IPC_RMID</b>
              Immediately remove the message queue, awakening all waiting reader and writer processes  (with  an
              error return and <u>errno</u> set to <b>EIDRM</b>).  The calling process must have appropriate privileges or its
              effective  user  ID  must  be either that of the creator or owner of the message queue.  The third
              argument to <b>msgctl</b>() is ignored in this case.

       <b>IPC_INFO</b> (Linux-specific)
              Return information about system-wide message queue limits and parameters in the structure  pointed
              to  by  <u>buf</u>.  This structure is of type <u>msginfo</u> (thus, a cast is required), defined in <u>&lt;sys/msg.h&gt;</u>
              if the <b>_GNU_SOURCE</b> feature test macro is defined:

                  struct msginfo {
                      int msgpool; /* Size in kibibytes of buffer pool
                                      used to hold message data;
                                      unused within kernel */
                      int msgmap;  /* Maximum number of entries in message
                                      map; unused within kernel */
                      int msgmax;  /* Maximum number of bytes that can be
                                      written in a single message */
                      int msgmnb;  /* Maximum number of bytes that can be
                                      written to queue; used to initialize
                                      msg_qbytes during queue creation
                                      (<a href="../man2/msgget.2.html">msgget</a>(2)) */
                      int msgmni;  /* Maximum number of message queues */
                      int msgssz;  /* Message segment size;
                                      unused within kernel */
                      int msgtql;  /* Maximum number of messages on all queues
                                      in system; unused within kernel */
                      unsigned short msgseg;
                                   /* Maximum number of segments;
                                      unused within kernel */
                  };

              The <u>msgmni</u>, <u>msgmax</u>, and <u>msgmnb</u> settings can be changed via <u><a href="file:/proc">/proc</a></u>  files  of  the  same  name;  see
              <b><a href="../man5/proc.5.html">proc</a></b>(5) for details.

       <b>MSG_INFO</b> (Linux-specific)
              Return  a  <u>msginfo</u>  structure  containing  the  same  information as for <b>IPC_INFO</b>, except that the
              following fields are returned with information about system resources consumed by message  queues:
              the  <u>msgpool</u>  field  returns  the number of message queues that currently exist on the system; the
              <u>msgmap</u> field returns the total number of messages in all queues on  the  system;  and  the  <u>msgtql</u>
              field returns the total number of bytes in all messages in all queues on the system.

       <b>MSG_STAT</b> (Linux-specific)
              Return  a  <u>msqid_ds</u>  structure  as  for  <b>IPC_STAT</b>.   However,  the  <u>msqid</u>  argument is not a queue
              identifier, but instead an index into the kernel's internal array that maintains information about
              all message queues on the system.

       <b>MSG_STAT_ANY</b> (Linux-specific, since Linux 4.17)
              Return a <u>msqid_ds</u> structure as for <b>MSG_STAT</b>.  However,  <u>msg_perm.mode</u>  is  not  checked  for  read
              access  for  <u>msqid</u>  meaning  that  any  user  can employ this operation (just as any user may read
              <u><a href="file:/proc/sysvipc/msg">/proc/sysvipc/msg</a></u> to obtain the same information).

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>IPC_STAT</b>, <b>IPC_SET</b>, and <b>IPC_RMID</b> return  0.   A  successful  <b>IPC_INFO</b>  or  <b>MSG_INFO</b>  operation
       returns  the  index  of the highest used entry in the kernel's internal array recording information about
       all message queues.  (This information can be used with repeated <b>MSG_STAT</b> or <b>MSG_STAT_ANY</b>  operations  to
       obtain  information  about  all  queues  on the system.)  A successful <b>MSG_STAT</b> or <b>MSG_STAT_ANY</b> operation
       returns the identifier of the queue whose index was given in <u>msqid</u>.

       On failure, -1 is returned and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EACCES</b> The argument <u>op</u> is equal to <b>IPC_STAT</b> or <b>MSG_STAT</b>, but the  calling  process  does  not  have  read
              permission  on the message queue <u>msqid</u>, and does not have the <b>CAP_IPC_OWNER</b> capability in the user
              namespace that governs its IPC namespace.

       <b>EFAULT</b> The argument <u>op</u> has the value <b>IPC_SET</b> or <b>IPC_STAT</b>,  but  the  address  pointed  to  by  <u>buf</u>  isn't
              accessible.

       <b>EIDRM</b>  The message queue was removed.

       <b>EINVAL</b> Invalid  value  for <u>op</u> or <u>msqid</u>.  Or: for a <b>MSG_STAT</b> operation, the index value specified in <u>msqid</u>
              referred to an array slot that is currently unused.

       <b>EPERM</b>  The argument <u>op</u> has the value <b>IPC_SET</b> or <b>IPC_RMID</b>, but  the  effective  user  ID  of  the  calling
              process  is not the creator (as found in <u>msg_perm.cuid</u>) or the owner (as found in <u>msg_perm.uid</u>) of
              the message queue, and the caller is not  privileged  (Linux:  does  not  have  the  <b>CAP_SYS_ADMIN</b>
              capability).

       <b>EPERM</b>  An  attempt  (<b>IPC_SET</b>) was made to increase <u>msg_qbytes</u> beyond the system parameter <b>MSGMNB</b>, but the
              caller is not privileged (Linux: does not have the <b>CAP_SYS_RESOURCE</b> capability).

</pre><h4><b>STANDARDS</b></h4><pre>
       POSIX.1-2008.

</pre><h4><b>HISTORY</b></h4><pre>
       POSIX.1-2001, SVr4.

       Various fields in the <u>struct</u> <u>msqid_ds</u> were typed as <u>short</u> under Linux 2.2  and  have  become  <u>long</u>  under
       Linux  2.4.  To take advantage of this, a recompilation under glibc-2.1.91 or later should suffice.  (The
       kernel distinguishes old and new calls by an <b>IPC_64</b> flag in <u>op</u>.)

</pre><h4><b>NOTES</b></h4><pre>
       The <b>IPC_INFO</b>, <b>MSG_STAT</b>, and <b>MSG_INFO</b> operations are used by the <b><a href="../man1/ipcs.1.html">ipcs</a></b>(1) program to provide information on
       allocated resources.  In the future these may modified or moved to a <u><a href="file:/proc">/proc</a></u> filesystem interface.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/msgget.2.html">msgget</a></b>(2), <b><a href="../man2/msgrcv.2.html">msgrcv</a></b>(2), <b><a href="../man2/msgsnd.2.html">msgsnd</a></b>(2), <b><a href="../man7/capabilities.7.html">capabilities</a></b>(7), <b><a href="../man7/mq_overview.7.html">mq_overview</a></b>(7), <b><a href="../man7/sysvipc.7.html">sysvipc</a></b>(7)

Linux man-pages 6.9.1                              2024-05-02                                          <u><a href="../man2/msgctl.2.html">msgctl</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>