<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>semop — atomic array of operations on a semaphore set</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       semop — atomic array of operations on a semaphore set

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C Library (libc, -lc)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/types.h&gt;</b>
       <b>#include</b> <b>&lt;sys/ipc.h&gt;</b>
       <b>#include</b> <b>&lt;sys/sem.h&gt;</b>

       <u>int</u>
       <b>semop</b>(<u>int</u> <u>semid</u>, <u>struct</u> <u>sembuf</u> <u>*array</u>, <u>size_t</u> <u>nops</u>);

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>semop</b>()  system call atomically performs the array of operations indicated by <u>array</u> on the semaphore
       set indicated by <u>semid</u>.  The length of <u>array</u> is indicated by <u>nops</u>.  Each operation is encoded in a <u>struct</u>
       <u>sembuf</u>, which is defined as follows:

       struct sembuf {
               u_short sem_num;        /* semaphore # */
               short   sem_op;         /* semaphore operation */
               short   sem_flg;        /* operation flags */
       };

       For each element in <u>array</u>, <u>sem_op</u> and <u>sem_flg</u> determine an operation to be performed on semaphore  number
       <u>sem_num</u>  in the set.  The values SEM_UNDO and IPC_NOWAIT may be <u>OR</u>'ed into the <u>sem_flg</u> member in order to
       modify the behavior of the given operation.

       The operation performed depends as follows on the value of <u>sem_op</u>:

       <b>•</b>   When <u>sem_op</u> is positive and the process has alter permission, the semaphore's value is incremented by
           <u>sem_op</u>'s value.  If SEM_UNDO is specified, the semaphore's adjust on exit  value  is  decremented  by
           <u>sem_op</u>'s  value.  A positive value for <u>sem_op</u> generally corresponds to a process releasing a resource
           associated with the semaphore.

       <b>•</b>   The behavior when <u>sem_op</u> is negative and the process has alter permission,  depends  on  the  current
           value of the semaphore:

           <b>•</b>   If  the  current value of the semaphore is greater than or equal to the absolute value of <u>sem_op</u>,
               then the value is decremented by the absolute value of <u>sem_op</u>.  If  SEM_UNDO  is  specified,  the
               semaphore's adjust on exit value is incremented by the absolute value of <u>sem_op</u>.

           <b>•</b>   If  the  current  value  of  the  semaphore is less than the absolute value of <u>sem_op</u>, one of the
               following happens:

               <b>•</b>   If IPC_NOWAIT was specified, then <b>semop</b>() returns immediately with a return value of EAGAIN.

               <b>•</b>   Otherwise, the calling process is put to sleep until  one  of  the  following  conditions  is
                   satisfied:

                   <b>•</b>   Some  other process removes the semaphore with the IPC_RMID option of <u><a href="../man2/semctl.2.html">semctl</a></u>(2).  In this
                       case, <b>semop</b>() returns immediately with a return value of EIDRM.

                   <b>•</b>   The process receives a signal that is to be caught.   In  this  case,  the  process  will
                       resume execution as defined by <u><a href="../man2/sigaction.2.html">sigaction</a></u>(2).

                   <b>•</b>   The  semaphore's  value  is  greater than or equal to the absolute value of <u>sem_op</u>.  When
                       this condition becomes true, the semaphore's value is decremented by the  absolute  value
                       of  <u>sem_op</u>,  the semaphore's adjust on exit value is incremented by the absolute value of
                       <u>sem_op</u>.

           A negative value for <u>sem_op</u> generally means that a process  is  waiting  for  a  resource  to  become
           available.

       <b>•</b>   When <u>sem_op</u> is zero and the process has read permission, one of the following will occur:

           <b>•</b>   If the current value of the semaphore is equal to zero then <b>semop</b>() can return immediately.

           <b>•</b>   If IPC_NOWAIT was specified, then <b>semop</b>() returns immediately with a return value of EAGAIN.

           <b>•</b>   Otherwise,  the  calling  process  is  put  to  sleep  until  one  of the following conditions is
               satisfied:

               <b>•</b>   Some other process removes the semaphore with the IPC_RMID  option  of  <u><a href="../man2/semctl.2.html">semctl</a></u>(2).   In  this
                   case, <b>semop</b>() returns immediately with a return value of EIDRM.

               <b>•</b>   The  process  receives  a signal that is to be caught.  In this case, the process will resume
                   execution as defined by <u><a href="../man2/sigaction.2.html">sigaction</a></u>(2).

               <b>•</b>   The semaphore's value becomes zero.

       For each semaphore a process has in use, the kernel maintains an “adjust on exit” value,  as  alluded  to
       earlier.   When  a  process exits, either voluntarily or involuntarily, the adjust on exit value for each
       semaphore is added to the semaphore's value.  This can be used to ensure that a resource is released if a
       process terminates unexpectedly.

</pre><h4><b>RETURN</b> <b>VALUES</b></h4><pre>
       The <b>semop</b>() function returns the value 0 if successful; otherwise the value -1 is returned and the global
       variable <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       The <b>semop</b>() system call will fail if:

       [EINVAL]           No semaphore set corresponds to <u>semid</u>, or the process would exceed the  system-defined
                          limit for the number of per-process SEM_UNDO structures.

       [EACCES]           Permission denied due to mismatch between operation and mode of semaphore set.

       [EAGAIN]           The  semaphore's  value  would  have  resulted  in  the process being put to sleep and
                          IPC_NOWAIT was specified.

       [E2BIG]            Too many operations were specified.  [SEMOPM]

       [EFBIG]            <u>sem_num</u> was not in the range of valid semaphores for the set.

       [EIDRM]            The semaphore set was removed from the system.

       [EINTR]            The <b>semop</b>() system call was interrupted by a signal.

       [ENOSPC]           The system SEM_UNDO pool [SEMMNU] is full.

       [ERANGE]           The requested operation would cause either the semaphore's current value  [SEMVMX]  or
                          its adjust on exit value [SEMAEM] to exceed the system-imposed limits.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man2/semctl.2.html">semctl</a></u>(2), <u><a href="../man2/semget.2.html">semget</a></u>(2), <u><a href="../man2/sigaction.2.html">sigaction</a></u>(2)

</pre><h4><b>BUGS</b></h4><pre>
       The <b>semop</b>() system call may block waiting for memory even if IPC_NOWAIT was specified.

Debian                                         September 22, 1995                                       <u><a href="../man2/SEMOP.2.html">SEMOP</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>