<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>utimensat, futimens - change file timestamps with nanosecond precision</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       utimensat, futimens - change file timestamps with nanosecond precision

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;<a href="file:/usr/include/fcntl.h">fcntl.h</a>&gt;</b>            /* Definition of <b>AT_*</b> constants */
       <b>#include</b> <b>&lt;sys/stat.h&gt;</b>

       <b>int</b> <b>utimensat(int</b> <u>dirfd</u><b>,</b> <b>const</b> <b>char</b> <b>*</b><u>pathname</u><b>,</b>
                     <b>const</b> <b>struct</b> <b>timespec</b> <u>times</u><b>[_Nullable</b> <b>2],</b> <b>int</b> <u>flags</u><b>);</b>
       <b>int</b> <b>futimens(int</b> <u>fd</u><b>,</b> <b>const</b> <b>struct</b> <b>timespec</b> <u>times</u><b>[_Nullable</b> <b>2]);</b>

   Feature Test Macro Requirements for glibc (see <b><a href="../man7/feature_test_macros.7.html">feature_test_macros</a></b>(7)):

       <b>utimensat</b>():
           Since glibc 2.10:
               _POSIX_C_SOURCE &gt;= 200809L
           Before glibc 2.10:
               _ATFILE_SOURCE

       <b>futimens</b>():
           Since glibc 2.10:
               _POSIX_C_SOURCE &gt;= 200809L
           Before glibc 2.10:
               _GNU_SOURCE

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>utimensat</b>()  and  <b>futimens</b>()  update  the timestamps of a file with nanosecond precision.  This contrasts
       with the historical  <b><a href="../man2/utime.2.html">utime</a></b>(2)  and  <b><a href="../man2/utimes.2.html">utimes</a></b>(2),  which  permit  only  second  and  microsecond  precision,
       respectively, when setting file timestamps.

       With  <b>utimensat</b>()  the  file  is  specified via the pathname given in <u>pathname</u>.  With <b>futimens</b>() the file
       whose timestamps are to be updated is specified via an open file descriptor, <u>fd</u>.

       For both calls, the new file timestamps are specified in the array  <u>times</u>:  <u>times[0]</u>  specifies  the  new
       "last  access  time"  (<u>atime</u>);  <u>times[1]</u> specifies the new "last modification time" (<u>mtime</u>).  Each of the
       elements of <u>times</u> specifies a time as the number of seconds and nanoseconds since the  Epoch,  1970-01-01
       00:00:00 +0000 (UTC).  This information is conveyed in a <b><a href="../man3/timespec.3.html">timespec</a></b>(3) structure.

       Updated  file  timestamps  are  set to the greatest value supported by the filesystem that is not greater
       than the specified time.

       If the <u>tv_nsec</u> field of one of the  <u>timespec</u>  structures  has  the  special  value  <b>UTIME_NOW</b>,  then  the
       corresponding  file  timestamp  is  set to the current time.  If the <u>tv_nsec</u> field of one of the <u>timespec</u>
       structures has the special value <b>UTIME_OMIT</b>, then the corresponding file timestamp is left unchanged.  In
       both of these cases, the value of the corresponding <u>tv_sec</u> field is ignored.

       If <u>times</u> is NULL, then both timestamps are set to the current time.

       The status change time (ctime) will be set to the current time, even  if  the  other  time  stamps  don't
       actually change.

   <b>Permissions</b> <b>requirements</b>
       To  set  both  file  timestamps  to the current time (i.e., <u>times</u> is NULL, or both <u>tv_nsec</u> fields specify
       <b>UTIME_NOW</b>), either:

       •  the caller must have write access to the file;

       •  the caller's effective user ID must match the owner of the file; or

       •  the caller must have appropriate privileges.

       To make any change other than setting both timestamps to the current time (i.e., <u>times</u> is not  NULL,  and
       neither  <u>tv_nsec</u>  field  is  <b>UTIME_NOW</b>  and neither <u>tv_nsec</u> field is <b>UTIME_OMIT</b>), either condition 2 or 3
       above must apply.

       If both <u>tv_nsec</u> fields are specified as <b>UTIME_OMIT</b>, then no  file  ownership  or  permission  checks  are
       performed, and the file timestamps are not modified, but other error conditions may still be detected.

   <b>utimensat()</b> <b>specifics</b>
       If  <u>pathname</u>  is relative, then by default it is interpreted relative to the directory referred to by the
       open file descriptor, <u>dirfd</u> (rather than relative  to  the  current  working  directory  of  the  calling
       process,  as is done by <b><a href="../man2/utimes.2.html">utimes</a></b>(2) for a relative pathname).  See <b><a href="../man2/openat.2.html">openat</a></b>(2) for an explanation of why this
       can be useful.

       If <u>pathname</u> is relative and <u>dirfd</u> is the special value <b>AT_FDCWD</b>, then <u>pathname</u> is interpreted relative to
       the current working directory of the calling process (like <b><a href="../man2/utimes.2.html">utimes</a></b>(2)).

       If <u>pathname</u> is absolute, then <u>dirfd</u> is ignored.

       The <u>flags</u> argument is a bit mask created by ORing together zero or more of the following  values  defined
       in <u>&lt;fcntl.h&gt;</u>:

       <b>AT_EMPTY_PATH</b> (since Linux 5.8)
              If  <u>pathname</u>  is  an  empty  string, operate on the file referred to by <u>dirfd</u> (which may have been
              obtained using the <b><a href="../man2/open.2.html">open</a></b>(2) <b>O_PATH</b> flag).  In this case, <u>dirfd</u> can refer to any type of  file,  not
              just a directory.  If <u>dirfd</u> is <b>AT_FDCWD</b>, the call operates on the current working directory.  This
              flag is Linux-specific; define <b>_GNU_SOURCE</b> to obtain its definition.

       <b>AT_SYMLINK_NOFOLLOW</b>
              If  <u>pathname</u>  specifies  a  symbolic link, then update the timestamps of the link, rather than the
              file to which it refers.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>utimensat</b>() and <b>futimens</b>() return 0.  On error, -1 is returned and <u>errno</u> is set  to  indicate
       the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EACCES</b> <u>times</u>  is NULL, or both <u>tv_nsec</u> values are <b>UTIME_NOW</b>, and the effective user ID of the caller does
              not match the owner of the file, the caller does not have write access to the file, and the caller
              is not privileged (Linux: does not have either the <b>CAP_FOWNER</b> or the <b>CAP_DAC_OVERRIDE</b> capability).

       <b>EBADF</b>  (<b>futimens</b>()) <u>fd</u> is not a valid file descriptor.

       <b>EBADF</b>  (<b>utimensat</b>()) <u>pathname</u> is relative but <u>dirfd</u> is neither <b>AT_FDCWD</b> nor a valid file descriptor.

       <b>EFAULT</b> <u>times</u> pointed to an invalid address; or, <u>dirfd</u> was <b>AT_FDCWD</b>, and <u>pathname</u> is NULL  or  an  invalid
              address.

       <b>EINVAL</b> Invalid value in <u>flags</u>.

       <b>EINVAL</b> Invalid  value  in  one  of  the  <u>tv_nsec</u>  fields  (value  outside range [0, 999,999,999], and not
              <b>UTIME_NOW</b> or <b>UTIME_OMIT</b>); or an invalid value in one of the <u>tv_sec</u> fields.

       <b>EINVAL</b> <u>pathname</u> is NULL, <u>dirfd</u> is not <b>AT_FDCWD</b>, and <u>flags</u> contains <b>AT_SYMLINK_NOFOLLOW</b>.

       <b>ELOOP</b>  (<b>utimensat</b>()) Too many symbolic links were encountered in resolving <u>pathname</u>.

       <b>ENAMETOOLONG</b>
              (<b>utimensat</b>()) <u>pathname</u> is too long.

       <b>ENOENT</b> (<b>utimensat</b>()) A component of <u>pathname</u> does not refer to an existing directory or file, or <u>pathname</u>
              is an empty string.

       <b>ENOTDIR</b>
              (<b>utimensat</b>()) <u>pathname</u> is a relative pathname, but <u>dirfd</u> is neither <b>AT_FDCWD</b> nor a file descriptor
              referring to a directory; or, one of the prefix components of <u>pathname</u> is not a directory.

       <b>EPERM</b>  The caller attempted to change one or both timestamps to a value other than the current  time,  or
              to  change  one of the timestamps to the current time while leaving the other timestamp unchanged,
              (i.e., <u>times</u> is not NULL, neither <u>tv_nsec</u>  field  is  <b>UTIME_NOW</b>,  and  neither  <u>tv_nsec</u>  field  is
              <b>UTIME_OMIT</b>) and either:

              •  the  caller's  effective  user  ID  does  not  match  the  owner of file, and the caller is not
                 privileged (Linux: does not have the <b>CAP_FOWNER</b> capability); or,

              •  the file is marked append-only or immutable (see <b><a href="../man1/chattr.1.html">chattr</a></b>(1)).

       <b>EROFS</b>  The file is on a read-only filesystem.

       <b>ESRCH</b>  (<b>utimensat</b>()) Search permission is denied for one of the prefix components of <u>pathname</u>.

</pre><h4><b>ATTRIBUTES</b></h4><pre>
       For an explanation of the terms used in this section, see <b><a href="../man7/attributes.7.html">attributes</a></b>(7).
       ┌─────────────────────────────────────────────────────────────────────────────┬───────────────┬─────────┐
       │ <b>Interface</b>                                                                   │ <b>Attribute</b>     │ <b>Value</b>   │
       ├─────────────────────────────────────────────────────────────────────────────┼───────────────┼─────────┤
       │ <b>utimensat</b>(), <b>futimens</b>()                                                     │ Thread safety │ MT-Safe │
       └─────────────────────────────────────────────────────────────────────────────┴───────────────┴─────────┘

</pre><h4><b>VERSIONS</b></h4><pre>
   <b>C</b> <b>library/kernel</b> <b>ABI</b> <b>differences</b>
       On Linux, <b>futimens</b>() is a library function implemented on top of the <b>utimensat</b>() system call.  To support
       this, the Linux <b>utimensat</b>() system call implements a nonstandard feature: if <u>pathname</u> is NULL,  then  the
       call modifies the timestamps of the file referred to by the file descriptor <u>dirfd</u> (which may refer to any
       type of file).  Using this feature, the call <u>futimens(fd,</u> <u>times)</u> is implemented as:

           utimensat(fd, NULL, times, 0);

       Note,  however,  that the glibc wrapper for <b>utimensat</b>() disallows passing NULL as the value for <u>pathname</u>:
       the wrapper function returns the error <b>EINVAL</b> in this case.

</pre><h4><b>STANDARDS</b></h4><pre>
       POSIX.1-2008.

</pre><h4><b>VERSIONS</b></h4><pre>
       <b>utimensat</b>()
              Linux 2.6.22, glibc 2.6.  POSIX.1-2008.

       <b>futimens</b>()
              glibc 2.6.  POSIX.1-2008.

</pre><h4><b>NOTES</b></h4><pre>
       <b>utimensat</b>() obsoletes <b><a href="../man2/futimesat.2.html">futimesat</a></b>(2).

       On Linux, timestamps cannot be changed for a file marked immutable, and the  only  change  permitted  for
       files  marked  append-only  is  to  set the timestamps to the current time.  (This is consistent with the
       historical behavior of <b><a href="../man2/utime.2.html">utime</a></b>(2) and <b><a href="../man2/utimes.2.html">utimes</a></b>(2) on Linux.)

       If both <u>tv_nsec</u> fields are specified as <b>UTIME_OMIT</b>, then the Linux implementation of <b>utimensat</b>() succeeds
       even if the file referred to by <u>dirfd</u> and <u>pathname</u> does not exist.

</pre><h4><b>BUGS</b></h4><pre>
       Several  bugs  afflict  <b>utimensat</b>()  and  <b>futimens</b>()  before  Linux  2.6.26.   These  bugs   are   either
       nonconformances with the POSIX.1 draft specification or inconsistencies with historical Linux behavior.

       •  POSIX.1  specifies  that  if one of the <u>tv_nsec</u> fields has the value <b>UTIME_NOW</b> or <b>UTIME_OMIT</b>, then the
          value of the corresponding <u>tv_sec</u> field should be ignored.  Instead, the value of the <u>tv_sec</u> field  is
          required to be 0 (or the error <b>EINVAL</b> results).

       •  Various bugs mean that for the purposes of permission checking, the case where both <u>tv_nsec</u> fields are
          set  to  <b>UTIME_NOW</b>  isn't  always treated the same as specifying <u>times</u> as NULL, and the case where one
          <u>tv_nsec</u> value is <b>UTIME_NOW</b> and the other is <b>UTIME_OMIT</b> isn't treated the same as specifying <u>times</u> as a
          pointer to an array of structures containing arbitrary time values.  As a result, in  some  cases:  a)
          file timestamps can be updated by a process that shouldn't have permission to perform updates; b) file
          timestamps  can't  be  updated by a process that should have permission to perform updates; and c) the
          wrong <u>errno</u> value is returned in case of an error.

       •  POSIX.1 says that a process that has <u>write</u> <u>access</u> <u>to</u> <u>the</u> <u>file</u> can make a call with <u>times</u> as  NULL,  or
          with  <u>times</u> pointing to an array of structures in which both <u>tv_nsec</u> fields are <b>UTIME_NOW</b>, in order to
          update both timestamps to the current time.  However, <b>futimens</b>() instead  checks  whether  the  <u>access</u>
          <u>mode</u> <u>of</u> <u>the</u> <u>file</u> <u>descriptor</u> <u>allows</u> <u>writing</u>.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/chattr.1.html">chattr</a></b>(1),  <b><a href="../man1/touch.1.html">touch</a></b>(1),  <b><a href="../man2/futimesat.2.html">futimesat</a></b>(2),  <b><a href="../man2/openat.2.html">openat</a></b>(2),  <b><a href="../man2/stat.2.html">stat</a></b>(2),  <b><a href="../man2/utimes.2.html">utimes</a></b>(2), <b><a href="../man3/futimes.3.html">futimes</a></b>(3), <b><a href="../man3/timespec.3.html">timespec</a></b>(3), <b><a href="../man7/inode.7.html">inode</a></b>(7),
       <b><a href="../man7/path_resolution.7.html">path_resolution</a></b>(7), <b><a href="../man7/symlink.7.html">symlink</a></b>(7)

Linux man-pages 6.9.1                              2024-05-02                                       <u><a href="../man2/utimensat.2.html">utimensat</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>