<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>aa_query_label - query access permission associated with a label</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/libapparmor-dev">libapparmor-dev_4.1.1-0ubuntu6_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       aa_query_label - query access permission associated with a label

       aa_query_file_path, aa_query_file_path_len - query access permissions of a file path

       aa_query_link_path, aa_query_link_path_len - query access permissions of a link path

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/apparmor.h&gt;</b>

       <b>int</b> <b>aa_query_label(uint32_t</b> <b>mask,</b> <b>char</b> <b>*query,</b> <b>size_t</b> <b>size,</b> <b>int</b> <b>*allowed,</b> <b>int</b> <b>*audited);</b>

       <b>int</b> <b>aa_query_file_path(uint32_t</b> <b>mask,</b> <b>const</b> <b>char</b> <b>*label,</b> <b>size_t</b> <b>label_len,</b> <b>const</b> <b>char</b> <b>*path,</b> <b>int</b>
       <b>*allowed,</b> <b>int</b> <b>*audited);</b>

       <b>int</b> <b>aa_query_file_path_len(uint32_t</b> <b>mask,</b> <b>const</b> <b>char</b> <b>*label,</b> <b>size_t</b> <b>label_len,</b> <b>const</b> <b>char</b> <b>*path,</b> <b>size_t</b>
       <b>path_len,</b> <b>int</b> <b>*allowed,</b> <b>int</b> <b>*audited);</b>

       <b>int</b> <b>aa_query_link_path(const</b> <b>char</b> <b>*label,</b> <b>const</b> <b>char</b> <b>*target,</b> <b>const</b> <b>char</b> <b>*link,</b> <b>int</b> <b>*allowed,</b> <b>int</b>
       <b>*audited);</b>

       <b>int</b> <b>aa_query_link_path_len(const</b> <b>char</b> <b>*label,</b> <b>size_t</b> <b>label_len,</b> <b>const</b> <b>char</b> <b>*target,</b> <b>size_t</b> <b>target_len,</b>
       <b>const</b> <b>char</b> <b>*link,</b> <b>size_t</b> <b>link_len,</b> <b>int</b> <b>*allowed,</b> <b>int</b> <b>*audited);</b>

       Link with <b>-lapparmor</b> when compiling.

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>aa_query_label</b> function fetches the current permissions granted by the specified <u>label</u> in the <u>query</u>
       string.

       The query is a raw binary formatted query, containing the label and permission query to make. The
       returned <u>allowed</u> and <u>audited</u> values are interpreted boolean values, simply stating whether the query is
       allowed and if it is audited.

       The mask of the query string is a bit mask of permissions to query and is class type dependent (see
       <b>AA_CLASS_xxx</b> entries in <u>sys/apparmor.h</u>).

       The format of the query string is also dependent on the <b>AA_CLASS</b> and as such the <b>aa_query_xxx</b> helper
       functions should usually be used instead of directly using <b>aa_query_label</b>. If directly using the
       interface the <u>query</u> string is required to have a header of <b>AA_QUERY_CMD_LABEL_SIZE</b> that will be used by
       <b>aa_query_label</b>.

       The <b>aa_query_file_path</b> and <b>aa_query_file_path_len</b> functions are helper function that assemble a properly
       formatted file path query for the <b>aa_query_label</b> function. The <u>label</u> is a valid apparmor label as
       returned by <u>aa_splitcon</u> with <u>label_len</u> being the length of the <u>label</u>.  The <u>path</u> is any valid filesystem
       path to query permissions for. For the <b>aa_query_file_path_len</b> variant the <u>path_len</u> parameter specifies
       the number of bytes in the <u>path</u> to use as part of the query.

       The <b>aa_query_link_path</b> and <b>aa_query_link_path_len</b> functions are helper functions that assemble a properly
       formatted link path query for the <b>aa_query_label</b> function. The <u>link_len</u> and <u>target_len</u> parameters specify
       the number of bytes in the <u>link</u> and <u>target</u> to use as part of the query.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success 0 is returned, and the <u>allowed</u> and <u>audited</u> parameters contain a boolean value of 0 not
       allowed/audited or 1 allowed/audited. On error, -1 is returned, and <b><a href="../man3/errno.3.html">errno</a></b>(3) is set appropriately.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EINVAL</b>
           The requested <u>mask</u> is empty.

           The <u>size</u> of the query is less than the query <b>AA_QUERY_CMD_LABEL_SIZE</b>

           The apparmor kernel module is not loaded or the kernel interface access interface is not available

       <b>ENOMEM</b>
           Insufficient memory was available.

       <b>EACCES</b>
           Access to the specified <u>label</u> or query interface was denied.

       <b>ENOENT</b>
           The specified <u>label</u> does not exist or is not visible.

       <b>ERANGE</b>
           The confinement data is too large to fit in the supplied buffer.

</pre><h4><b>NOTES</b></h4><pre>
       The  label  permissions  returned are only valid for the time of the query and can change at any point in
       the future.

</pre><h4><b>BUGS</b></h4><pre>
       None known. If you find any, please report them at &lt;https://gitlab.com/apparmor/apparmor/-/issues&gt;.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man7/apparmor.7.html">apparmor</a></b>(7),      <b><a href="../man5/apparmor.d.5.html">apparmor.d</a></b>(5),      <b><a href="../man8/apparmor_parser.8.html">apparmor_parser</a></b>(8),      <b><a href="../man2/aa_getcon.2.html">aa_getcon</a></b>(2),      <b><a href="../man3/aa_splitcon.3.html">aa_splitcon</a></b>(3)      and
       &lt;https://wiki.apparmor.net&gt;.

AppArmor 4.1.1                                     2025-07-23                                  <u><a href="../man2/AA_QUERY_LABEL.2.html">AA_QUERY_LABEL</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>