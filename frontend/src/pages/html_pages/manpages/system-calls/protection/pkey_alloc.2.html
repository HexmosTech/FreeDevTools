<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pkey_alloc, pkey_free - allocate or free a protection key</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       pkey_alloc, pkey_free - allocate or free a protection key

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#define</b> <b>_GNU_SOURCE</b>             /* See <a href="../man7/feature_test_macros.7.html">feature_test_macros</a>(7) */
       <b>#include</b> <b>&lt;sys/mman.h&gt;</b>

       <b>int</b> <b>pkey_alloc(unsigned</b> <b>int</b> <u>flags</u><b>,</b> <b>unsigned</b> <b>int</b> <u>access_rights</u><b>);</b>
       <b>int</b> <b>pkey_free(int</b> <u>pkey</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>pkey_alloc</b>() allocates a protection key (pkey) and allows it to be passed to <b><a href="../man2/pkey_mprotect.2.html">pkey_mprotect</a></b>(2).

       The <b>pkey_alloc</b>() <u>flags</u> is reserved for future use and currently must always be specified as 0.

       The <b>pkey_alloc</b>() <u>access_rights</u> argument may contain zero or more disable operations:

       <b>PKEY_DISABLE_ACCESS</b>
              Disable all data access to memory covered by the returned protection key.

       <b>PKEY_DISABLE_WRITE</b>
              Disable write access to memory covered by the returned protection key.

       <b>pkey_free</b>()  frees a protection key and makes it available for later allocations.  After a protection key
       has been freed, it may no longer be used in any protection-key-related operations.

       An application should not call <b>pkey_free</b>() on any protection key which has been assigned  to  an  address
       range  by  <b><a href="../man2/pkey_mprotect.2.html">pkey_mprotect</a></b>(2)  and  which  is still in use.  The behavior in this case is undefined and may
       result in an error.

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>pkey_alloc</b>() returns a positive protection key value.  On success, <b>pkey_free</b>() returns  zero.
       On error, -1 is returned, and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EINVAL</b> <u>pkey</u>, <u>flags</u>, or <u>access_rights</u> is invalid.

       <b>ENOSPC</b> (<b>pkey_alloc</b>())  All  protection  keys  available for the current process have been allocated.  The
              number of keys available is architecture-specific and implementation-specific and may  be  reduced
              by kernel-internal use of certain keys.  There are currently 15 keys available to user programs on
              x86.

              This  error will also be returned if the processor or operating system does not support protection
              keys.  Applications should always be prepared to handle this error, since factors outside  of  the
              application's control can reduce the number of available pkeys.

</pre><h4><b>STANDARDS</b></h4><pre>
       Linux.

</pre><h4><b>HISTORY</b></h4><pre>
       Linux 4.9, glibc 2.27.

</pre><h4><b>NOTES</b></h4><pre>
       <b>pkey_alloc</b>() is always safe to call regardless of whether or not the operating system supports protection
       keys.  It can be used in lieu of any other mechanism for detecting pkey support and will simply fail with
       the error <b>ENOSPC</b> if the operating system has no pkey support.

       The kernel guarantees that the contents of the hardware rights register (PKRU) will be preserved only for
       allocated  protection  keys.   Any time a key is unallocated (either before the first call returning that
       key from <b>pkey_alloc</b>() or after it is freed via <b>pkey_free</b>()), the kernel may make arbitrary changes to the
       parts of the rights register affecting access to that key.

</pre><h4><b>EXAMPLES</b></h4><pre>
       See <b><a href="../man7/pkeys.7.html">pkeys</a></b>(7).

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man2/pkey_mprotect.2.html">pkey_mprotect</a></b>(2), <b><a href="../man7/pkeys.7.html">pkeys</a></b>(7)

Linux man-pages 6.9.1                              2024-05-02                                      <u><a href="../man2/pkey_alloc.2.html">pkey_alloc</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>