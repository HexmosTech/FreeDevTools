<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fallocate - manipulate file space</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/manpages-dev">manpages-dev_6.9.1-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       fallocate - manipulate file space

</pre><h4><b>LIBRARY</b></h4><pre>
       Standard C library (<u>libc</u>, <u>-lc</u>)

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#define</b> <b>_GNU_SOURCE</b>             /* See <a href="../man7/feature_test_macros.7.html">feature_test_macros</a>(7) */
       <b>#include</b> <b>&lt;<a href="file:/usr/include/fcntl.h">fcntl.h</a>&gt;</b>

       <b>int</b> <b>fallocate(int</b> <u>fd</u><b>,</b> <b>int</b> <u>mode</u><b>,</b> <b>off_t</b> <u>offset</u><b>,</b> <b>off_t</b> <u>len</u><b>);</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This  is  a  nonportable,  Linux-specific  system  call.   For  the portable, POSIX.1-specified method of
       ensuring that space is allocated for a file, see <b><a href="../man3/posix_fallocate.3.html">posix_fallocate</a></b>(3).

       <b>fallocate</b>() allows the caller to directly manipulate the allocated disk space for the file referred to by
       <u>fd</u> for the byte range starting at <u>offset</u> and continuing for <u>len</u> bytes.

       The <u>mode</u> argument determines the operation to be performed on the given range.  Details of the  supported
       operations are given in the subsections below.

   <b>Allocating</b> <b>disk</b> <b>space</b>
       The  default  operation  (i.e.,  <u>mode</u>  is  zero) of <b>fallocate</b>() allocates the disk space within the range
       specified by <u>offset</u> and <u>len</u>.  The file size (as reported by <b><a href="../man2/stat.2.html">stat</a></b>(2)) will be  changed  if  <u>offset</u>+<u>len</u>  is
       greater  than  the  file  size.   Any subregion within the range specified by <u>offset</u> and <u>len</u> that did not
       contain data before the call will be initialized to zero.  This default behavior  closely  resembles  the
       behavior  of  the  <b><a href="../man3/posix_fallocate.3.html">posix_fallocate</a></b>(3)  library  function,  and  is  intended  as  a  method  of optimally
       implementing that function.

       After a successful call, subsequent writes into the range specified by <u>offset</u> and <u>len</u> are guaranteed  not
       to fail because of lack of disk space.

       If  the  <b>FALLOC_FL_KEEP_SIZE</b> flag is specified in <u>mode</u>, the behavior of the call is similar, but the file
       size will not be changed even if <u>offset</u>+<u>len</u> is greater than the file size.  Preallocating  zeroed  blocks
       beyond the end of the file in this manner is useful for optimizing append workloads.

       If  the  <b>FALLOC_FL_UNSHARE_RANGE</b> flag is specified in <u>mode</u>, shared file data extents will be made private
       to the file to guarantee that a subsequent write will not fail due to lack  of  space.   Typically,  this
       will  be  done by performing a copy-on-write operation on all shared data in the file.  This flag may not
       be supported by all filesystems.

       Because allocation is done in block size chunks, <b>fallocate</b>() may allocate a larger range  of  disk  space
       than was specified.

   <b>Deallocating</b> <b>file</b> <b>space</b>
       Specifying  the <b>FALLOC_FL_PUNCH_HOLE</b> flag (available since Linux 2.6.38) in <u>mode</u> deallocates space (i.e.,
       creates a hole) in the byte range starting at <u>offset</u> and continuing for <u>len</u> bytes.  Within the  specified
       range,  partial  filesystem  blocks  are  zeroed,  and whole filesystem blocks are removed from the file.
       After a successful call, subsequent reads from this range will return zeros.

       The <b>FALLOC_FL_PUNCH_HOLE</b> flag must be ORed with <b>FALLOC_FL_KEEP_SIZE</b> in <u>mode</u>; in other  words,  even  when
       punching off the end of the file, the file size (as reported by <b><a href="../man2/stat.2.html">stat</a></b>(2)) does not change.

       Not all filesystems support <b>FALLOC_FL_PUNCH_HOLE</b>; if a filesystem doesn't support the operation, an error
       is returned.  The operation is supported on at least the following filesystems:

       •  XFS (since Linux 2.6.38)

       •  ext4 (since Linux 3.0)

       •  Btrfs (since Linux 3.7)

       •  <b><a href="../man5/tmpfs.5.html">tmpfs</a></b>(5) (since Linux 3.5)

       •  <b><a href="../man5/gfs2.5.html">gfs2</a></b>(5) (since Linux 4.16)

   <b>Collapsing</b> <b>file</b> <b>space</b>
       Specifying  the  <b>FALLOC_FL_COLLAPSE_RANGE</b>  flag (available since Linux 3.15) in <u>mode</u> removes a byte range
       from a file, without leaving a hole.  The byte range to be collapsed starts at <u>offset</u> and  continues  for
       <u>len</u>  bytes.   At  the  completion  of  the  operation,  the contents of the file starting at the location
       <u>offset+len</u> will be appended at the location <u>offset</u>, and the file will be <u>len</u> bytes smaller.

       A filesystem may place limitations on the granularity of the operation,  in  order  to  ensure  efficient
       implementation.  Typically, <u>offset</u> and <u>len</u> must be a multiple of the filesystem logical block size, which
       varies  according  to  the  filesystem  type  and configuration.  If a filesystem has such a requirement,
       <b>fallocate</b>() fails with the error <b>EINVAL</b> if this requirement is violated.

       If the region specified by <u>offset</u> plus <u>len</u> reaches or passes the end  of  file,  an  error  is  returned;
       instead, use <b><a href="../man2/ftruncate.2.html">ftruncate</a></b>(2) to truncate a file.

       No other flags may be specified in <u>mode</u> in conjunction with <b>FALLOC_FL_COLLAPSE_RANGE</b>.

       As at Linux 3.15, <b>FALLOC_FL_COLLAPSE_RANGE</b> is supported by ext4 (only for extent-based files) and XFS.

   <b>Zeroing</b> <b>file</b> <b>space</b>
       Specifying  the  <b>FALLOC_FL_ZERO_RANGE</b>  flag  (available since Linux 3.15) in <u>mode</u> zeros space in the byte
       range starting at <u>offset</u>  and  continuing  for  <u>len</u>  bytes.   Within  the  specified  range,  blocks  are
       preallocated  for the regions that span the holes in the file.  After a successful call, subsequent reads
       from this range will return zeros.

       Zeroing is done within the filesystem preferably by converting the range into  unwritten  extents.   This
       approach  means  that  the  specified  range  will not be physically zeroed out on the device (except for
       partial blocks at the either end of the range), and I/O is (otherwise) required only to update metadata.

       If the <b>FALLOC_FL_KEEP_SIZE</b> flag is additionally specified in <u>mode</u>, the behavior of the call  is  similar,
       but the file size will not be changed even if <u>offset</u>+<u>len</u> is greater than the file size.  This behavior is
       the same as when preallocating space with <b>FALLOC_FL_KEEP_SIZE</b> specified.

       Not all filesystems support <b>FALLOC_FL_ZERO_RANGE</b>; if a filesystem doesn't support the operation, an error
       is returned.  The operation is supported on at least the following filesystems:

       •  XFS (since Linux 3.15)

       •  ext4, for extent-based files (since Linux 3.15)

       •  SMB3 (since Linux 3.17)

       •  Btrfs (since Linux 4.16)

   <b>Increasing</b> <b>file</b> <b>space</b>
       Specifying  the  <b>FALLOC_FL_INSERT_RANGE</b> flag (available since Linux 4.1) in <u>mode</u> increases the file space
       by inserting a hole within the file size without overwriting any existing data.  The hole will  start  at
       <u>offset</u>  and  continue  for  <u>len</u>  bytes.   When  inserting  the hole inside file, the contents of the file
       starting at <u>offset</u> will be shifted upward (i.e., to a higher file offset) by <u>len</u> bytes.  Inserting a hole
       inside a file increases the file size by <u>len</u> bytes.

       This mode has  the  same  limitations  as  <b>FALLOC_FL_COLLAPSE_RANGE</b>  regarding  the  granularity  of  the
       operation.  If the granularity requirements are not met, <b>fallocate</b>() fails with the error <b>EINVAL</b>.  If the
       <u>offset</u>  is  equal  to  or greater than the end of file, an error is returned.  For such operations (i.e.,
       inserting a hole at the end of file), <b><a href="../man2/ftruncate.2.html">ftruncate</a></b>(2) should be used.

       No other flags may be specified in <u>mode</u> in conjunction with <b>FALLOC_FL_INSERT_RANGE</b>.

       <b>FALLOC_FL_INSERT_RANGE</b> requires filesystem support.  Filesystems that support this operation include  XFS
       (since Linux 4.1) and ext4 (since Linux 4.2).

</pre><h4><b>RETURN</b> <b>VALUE</b></h4><pre>
       On success, <b>fallocate</b>() returns zero.  On error, -1 is returned and <u>errno</u> is set to indicate the error.

</pre><h4><b>ERRORS</b></h4><pre>
       <b>EBADF</b>  <u>fd</u> is not a valid file descriptor, or is not opened for writing.

       <b>EFBIG</b>  <u>offset</u>+<u>len</u> exceeds the maximum file size.

       <b>EFBIG</b>  <u>mode</u> is <b>FALLOC_FL_INSERT_RANGE</b>, and the current file size+<u>len</u> exceeds the maximum file size.

       <b>EINTR</b>  A signal was caught during execution; see <b><a href="../man7/signal.7.html">signal</a></b>(7).

       <b>EINVAL</b> <u>offset</u> was less than 0, or <u>len</u> was less than or equal to 0.

       <b>EINVAL</b> <u>mode</u>  is <b>FALLOC_FL_COLLAPSE_RANGE</b> and the range specified by <u>offset</u> plus <u>len</u> reaches or passes the
              end of the file.

       <b>EINVAL</b> <u>mode</u> is <b>FALLOC_FL_INSERT_RANGE</b> and the range specified by <u>offset</u> reaches or passes the end of  the
              file.

       <b>EINVAL</b> <u>mode</u>  is  <b>FALLOC_FL_COLLAPSE_RANGE</b>  or  <b>FALLOC_FL_INSERT_RANGE</b>,  but either <u>offset</u> or <u>len</u> is not a
              multiple of the filesystem block size.

       <b>EINVAL</b> <u>mode</u> contains one of <b>FALLOC_FL_COLLAPSE_RANGE</b> or <b>FALLOC_FL_INSERT_RANGE</b> and also other  flags;  no
              other flags are permitted with <b>FALLOC_FL_COLLAPSE_RANGE</b> or <b>FALLOC_FL_INSERT_RANGE</b>.

       <b>EINVAL</b> <u>mode</u>  is  <b>FALLOC_FL_COLLAPSE_RANGE</b>,  <b>FALLOC_FL_ZERO_RANGE</b>, or <b>FALLOC_FL_INSERT_RANGE</b>, but the file
              referred to by <u>fd</u> is not a regular file.

       <b>EIO</b>    An I/O error occurred while reading from or writing to a filesystem.

       <b>ENODEV</b> <u>fd</u> does not refer to a regular file or a directory.  (If <u>fd</u> is a pipe or FIFO, a  different  error
              results.)

       <b>ENOSPC</b> There is not enough space left on the device containing the file referred to by <u>fd</u>.

       <b>ENOSYS</b> This kernel does not implement <b>fallocate</b>().

       <b>EOPNOTSUPP</b>
              The  filesystem containing the file referred to by <u>fd</u> does not support this operation; or the <u>mode</u>
              is not supported by the filesystem containing the file referred to by <u>fd</u>.

       <b>EPERM</b>  The file referred to by <u>fd</u> is marked immutable (see <b><a href="../man1/chattr.1.html">chattr</a></b>(1)).

       <b>EPERM</b>  <u>mode</u> specifies <b>FALLOC_FL_PUNCH_HOLE</b>, <b>FALLOC_FL_COLLAPSE_RANGE</b>, or <b>FALLOC_FL_INSERT_RANGE</b>  and  the
              file referred to by <u>fd</u> is marked append-only (see <b><a href="../man1/chattr.1.html">chattr</a></b>(1)).

       <b>EPERM</b>  The operation was prevented by a file seal; see <b><a href="../man2/fcntl.2.html">fcntl</a></b>(2).

       <b>ESPIPE</b> <u>fd</u> refers to a pipe or FIFO.

       <b>ETXTBSY</b>
              <u>mode</u>  specifies <b>FALLOC_FL_COLLAPSE_RANGE</b> or <b>FALLOC_FL_INSERT_RANGE</b>, but the file referred to by <u>fd</u>
              is currently being executed.

</pre><h4><b>STANDARDS</b></h4><pre>
       Linux.

</pre><h4><b>HISTORY</b></h4><pre>
       <b>fallocate</b>()
              Linux 2.6.23, glibc 2.10.

       <b>FALLOC_FL_*</b>
              glibc 2.18.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man1/fallocate.1.html">fallocate</a></b>(1), <b><a href="../man2/ftruncate.2.html">ftruncate</a></b>(2), <b><a href="../man3/posix_fadvise.3.html">posix_fadvise</a></b>(3), <b><a href="../man3/posix_fallocate.3.html">posix_fallocate</a></b>(3)

Linux man-pages 6.9.1                              2024-05-02                                       <u><a href="../man2/fallocate.2.html">fallocate</a></u>(2)
</pre>
 </div>
</div></section>
</div>
</body>
</html>