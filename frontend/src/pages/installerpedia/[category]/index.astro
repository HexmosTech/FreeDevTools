---
import RequireAuth from '@/components/auth/RequireAuth.astro';
import AdBanner from '@/components/banner/AdBanner.astro';
import CreditsButton from '@/components/buttons/CreditsButton';
import Pagination from '@/components/PaginationComponent.astro';
import ToolContainer from '@/components/tool/ToolContainer';
import ToolHead from '@/components/tool/ToolHead';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getReposByTypePaginated, getReposCountByType, getTotalReposCount, generateRepoTypeStaticPaths } from 'db/installerpedia/installerpedia-utils';

export async function getStaticPaths() {
  return generateRepoTypeStaticPaths();
}

const { category } = Astro.params;

if (!category) {
  throw new Error('Category parameter is required');
}

// Pagination settings
const itemsPerPage = 12;
const currentPage = 1;
const offset = (currentPage - 1) * itemsPerPage;

// Get repos for this category (paginated)
const currentPageRepos = getReposByTypePaginated(category, itemsPerPage, offset);
const totalReposCount = getReposCountByType(category);
const totalPages = Math.ceil(totalReposCount / itemsPerPage);
const totalInstallationGuides = getTotalReposCount();

// Breadcrumb
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'Installerpedia', href: '/freedevtools/installerpedia/' },
  { label: category.replace('-', ' ').charAt(0).toUpperCase() + category.replace('-', ' ').slice(1) },
];

const categoryTitle = category.replace('-', ' ').charAt(0).toUpperCase() + category.replace('-', ' ').slice(1);
---
<RequireAuth/>
<BaseLayout
  name={`${categoryTitle} Installation Guides`}
  title={`${categoryTitle} Installation Guides | Free DevTools by Hexmos`}
  path={`/freedevtools/installerpedia/${category}/`}
  description={`Browse ${categoryTitle} installation guides. Step-by-step instructions for setting up software and packages.`}
  canonical={`https://hexmos.com/freedevtools/installerpedia/${category}/`}
  keywords={[category, 'installer guides', 'installation', 'setup']}
  ogImage="https://hexmos.com/freedevtools/tool-banners/installerpedia-banner.png"
  twitterImage="https://hexmos.com/freedevtools/tool-banners/installerpedia-banner.png"
  datePublished="2025-01-30"
  softwareVersion="1.0.0"
>
  <ToolContainer>
    <div class="mb-16 mt-[74px]">
      <AdBanner />
    </div>

    <ToolHead
      name={`${categoryTitle} Installation Guides`}
      description={`Step-by-step installation guides for ${categoryTitle} repositories.`}
      breadcrumbItems={breadcrumbItems}
    />

    <!-- Overview Stats -->
    <div class="text-center">
      <div class="grid grid-cols-2 gap-6 mt-8">
        <div class="text-center">
          <div class="text-3xl font-bold text-blue-600">{totalReposCount >= 1000 ? Math.round(totalReposCount / 1000) + 'k' : totalReposCount}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Repositories</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-green-600">{totalInstallationGuides >= 1000 ? Math.round(totalInstallationGuides / 1000) + 'k' : totalInstallationGuides}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Installation Guides</div>
        </div>
      </div>
    </div>

    <!-- Pagination Info -->
    <div
      id="pagination-info-content"
      class="bg-slate-50 dark:bg-slate-800 rounded-lg p-4 mb-6 mt-8"
    >
      <div class="text-sm text-slate-600 dark:text-slate-400 text-center">
        Showing {currentPageRepos.length} of {totalReposCount} repositories (Page {currentPage} of {totalPages})
      </div>
    </div>

    <!-- Repos Grid -->
    <div class="mt-8">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {currentPageRepos.map((repo) => (
          <a
            href={`/freedevtools/installerpedia/${category}/${repo.repo.replace('/', '-')}/`}
            class="block bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg p-6 hover:shadow-lg transition-shadow"
          >
            <div class="flex items-start justify-between mb-3">
              <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 capitalize">
                {repo.repo.replace('/', ' ')}
              </h3>
              <span class="text-xs font-mono bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-400 px-2 py-1 rounded">
                {repo.stars} ⭐
              </span>
            </div>
            {repo.description && (
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                {repo.description}
              </p>
            )}
          </a>
        ))}
      </div>
    </div>

    <!-- Pagination -->
    <Pagination
      currentPage={currentPage}
      totalPages={totalPages}
      baseUrl={`/freedevtools/installerpedia/${category}/`}
    />

    <!-- Credits Section -->
    <div class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700">
      <div class="flex flex-wrap gap-4">
        <a
          href="/freedevtools/installerpedia/"
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"
        >
          ← Back to Installerpedia
        </a>
        <CreditsButton href="/freedevtools/installerpedia/credits/" />
      </div>
    </div>
  </ToolContainer>
</BaseLayout>
