---
import BaseLayout from '../../layouts/BaseLayout.astro';
import {
  generateCheatsheetStaticPaths,
  getAllCheatsheetCategories,
} from '../../lib/cheatsheets-utils';
import CheatsheetPage from './_CheatsheetPage.astro';

export async function getStaticPaths() {
  return await generateCheatsheetStaticPaths();
}

// Get page from params
const { page } = Astro.params;
const currentPage = parseInt(page || '1');

// Get all cheatsheet categories
const allCategories = await getAllCheatsheetCategories();

// Pagination logic
const itemsPerPage = 30;
const totalPages = Math.ceil(allCategories.length / itemsPerPage);
const startIndex = (currentPage - 1) * itemsPerPage;
const endIndex = startIndex + itemsPerPage;
const categories = allCategories.slice(startIndex, endIndex);
const totalCategories = allCategories.length;

// Calculate total cheatsheets
const totalCheatsheets = allCategories.reduce(
  (total, category) => total + category.cheatsheetCount,
  0
);

// Breadcrumb data
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'Cheatsheets', href: '/freedevtools/c/' },
];

// SEO data
const seoTitle =
  currentPage === 1
    ? 'Cheatsheets - Quick Reference Commands & Syntax | Online Free DevTools by Hexmos'
    : `Cheatsheets - Page ${currentPage} | Online Free DevTools by Hexmos`;

const seoDescription =
  currentPage === 1
    ? 'Concise, easy-to-scan reference pages that summarize commands, syntax, and key concepts for faster learning and recall.'
    : `Browse page ${currentPage} of our cheatsheets collection. Quick reference for commands, syntax, and programming concepts.`;

const canonical =
  currentPage === 1
    ? 'https://hexmos.com/freedevtools/c/'
    : `https://hexmos.com/freedevtools/c/${currentPage}/`;

// Enhanced keywords for main page
const mainKeywords = [
  'cheatsheets',
  'reference',
  'commands',
  'syntax',
  'programming',
  'documentation',
  'quick reference',
  'command line',
  'cli',
  'terminal',
];
---

<BaseLayout
  name="Cheatsheets"
  path={currentPage === 1
    ? '/freedevtools/c/'
    : `/freedevtools/c/${currentPage}/`}
  title={seoTitle}
  description={seoDescription}
  canonical={canonical}
  showHeader={true}
  totalItems={totalCategories}
  itemsPerPage={itemsPerPage}
  currentPage={currentPage}
  category="Cheatsheets"
  partOf="Free DevTools"
  partOfUrl="https://hexmos.com/freedevtools/"
  keywords={mainKeywords}
  features={[
    'Quick reference',
    'Command syntax',
    'Easy to scan',
    'Fast learning',
    'Free access',
  ]}
  commandCategory="Reference"
>
  <CheatsheetPage
    categories={categories}
    currentPage={currentPage}
    totalPages={totalPages}
    totalCategories={totalCategories}
    totalCheatsheets={totalCheatsheets}
    breadcrumbItems={breadcrumbItems}
  />
</BaseLayout>
