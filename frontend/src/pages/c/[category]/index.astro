---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import {
  getAllCheatsheetCategories,
  getCheatsheetsByCategory,
} from '../../../lib/cheatsheets-utils';
import CategoryCheatsheetsPage from './_CategoryCheatsheetsPage.astro';

export async function getStaticPaths() {
  const categories = await getAllCheatsheetCategories();

  return categories.map((category) => ({
    params: { category: category.id },
    props: { category: category.name },
  }));
}

// Get category from params
const { category: categorySlug } = Astro.params;
const categoryName =
  (Astro.props?.category as string) ||
  categorySlug!
    .replace(/-/g, ' ')
    .replace(/_/g, ' ')
    .replace(/\b\w/g, (l: string) => l.toUpperCase());

// Get cheatsheets for this category
const cheatsheets = await getCheatsheetsByCategory(categoryName);
const totalCheatsheets = cheatsheets.length;

// Pagination logic for page 1
const itemsPerPage = 30;
const currentPage = 1;
const totalPages = Math.ceil(totalCheatsheets / itemsPerPage);
const startIndex = (currentPage - 1) * itemsPerPage;
const endIndex = startIndex + itemsPerPage;
const paginatedCheatsheets = cheatsheets.slice(startIndex, endIndex);

// Breadcrumb items
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'Cheatsheets', href: '/freedevtools/c/' },
  { label: categoryName, href: `/freedevtools/c/${categorySlug}/` },
];

// SEO data
const seoTitle = `${categoryName} Cheatsheets | Online Free DevTools by Hexmos`;
const seoDescription = `Comprehensive ${categoryName.toLowerCase()} cheatsheets covering commands, syntax, and key concepts for faster learning and recall.`;
const keywords = [
  categoryName.toLowerCase(),
  'cheatsheets',
  'reference',
  'commands',
  'syntax',
  'programming',
  'documentation',
];
---

<BaseLayout
  name={`${categoryName} Cheatsheets`}
  path={`/c/${categorySlug}/`}
  title={seoTitle}
  description={seoDescription}
  canonical={`https://hexmos.com/freedevtools/c/${categorySlug}/`}
  keywords={keywords}
  showHeader={true}
  totalItems={totalCheatsheets}
  features={[
    'Quick reference',
    'Command syntax',
    'Easy to scan',
    'Fast learning',
    'Free access',
  ]}
  commandCategory="Reference"
>
  <CategoryCheatsheetsPage
    categoryName={categoryName}
    categorySlug={categorySlug}
    paginatedCheatsheets={paginatedCheatsheets}
    totalCheatsheets={totalCheatsheets}
    currentPage={currentPage}
    totalPages={totalPages}
    seoDescription={seoDescription}
    breadcrumbItems={breadcrumbItems}
  />
</BaseLayout>
