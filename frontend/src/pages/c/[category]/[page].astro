---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import {
  getAllCheatsheetCategories,
  getCheatsheetsByCategory,
} from '../../../lib/cheatsheets-utils';
import CategoryCheatsheetsPage from './_CategoryCheatsheetsPage.astro';

export async function getStaticPaths() {
  const categories = await getAllCheatsheetCategories();
  const paths = [];

  for (const category of categories) {
    const itemsPerPage = 30;
    const totalPages = Math.ceil(category.cheatsheetCount / itemsPerPage);

    for (let page = 1; page <= totalPages; page++) {
      paths.push({
        params: {
          category: category.id,
          page: page.toString(),
        },
        props: { category: category.name },
      });
    }
  }

  return paths;
}

// Get category and page from params
const { category: categorySlug, page } = Astro.params;
const categoryName =
  (Astro.props?.category as string) ||
  categorySlug!
    .replace(/-/g, ' ')
    .replace(/_/g, ' ')
    .replace(/\b\w/g, (l: string) => l.toUpperCase());
const currentPage = parseInt(page || '1');

// Get cheatsheets for this category
const cheatsheets = await getCheatsheetsByCategory(categoryName);
const totalCheatsheets = cheatsheets.length;

// Pagination logic
const itemsPerPage = 30;
const totalPages = Math.ceil(totalCheatsheets / itemsPerPage);
const startIndex = (currentPage - 1) * itemsPerPage;
const endIndex = startIndex + itemsPerPage;
const paginatedCheatsheets = cheatsheets.slice(startIndex, endIndex);

// Breadcrumb items
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'Cheatsheets', href: '/freedevtools/c/' },
  { label: categoryName, href: `/freedevtools/c/${categorySlug}/` },
];

// SEO data
const seoTitle = `${categoryName} Cheatsheets - Page ${currentPage} | Online Free DevTools by Hexmos`;
const seoDescription = `Browse page ${currentPage} of ${categoryName.toLowerCase()} cheatsheets. Comprehensive reference covering commands, syntax, and key concepts.`;
const keywords = [
  categoryName.toLowerCase(),
  'cheatsheets',
  'reference',
  'commands',
  'syntax',
  'programming',
  'documentation',
  'page ' + currentPage,
];
---

<BaseLayout
  name={`${categoryName} Cheatsheets`}
  path={`/c/${categorySlug}/`}
  title={seoTitle}
  description={seoDescription}
  canonical={`https://hexmos.com/freedevtools/c/${categorySlug}/${currentPage}/`}
  keywords={keywords}
  showHeader={true}
  totalItems={totalCheatsheets}
  features={[
    'Quick reference',
    'Command syntax',
    'Easy to scan',
    'Fast learning',
    'Free access',
  ]}
  commandCategory="Reference"
>
  <CategoryCheatsheetsPage
    categoryName={categoryName}
    categorySlug={categorySlug}
    paginatedCheatsheets={paginatedCheatsheets}
    totalCheatsheets={totalCheatsheets}
    currentPage={currentPage}
    totalPages={totalPages}
    seoDescription={seoDescription}
    breadcrumbItems={breadcrumbItems}
  />
</BaseLayout>
