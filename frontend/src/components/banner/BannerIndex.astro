---
import type { Banner as BannerType } from '../../../db/banner/banner-schema';
import {
  getRandomBanner,
  getRandomBannerByType,
} from '../../../db/banner/banner-utils';
import BannerAstro from './Banner.astro';
import BannerReact from './Banner.tsx';

interface Props {
  type?: 'banner' | 'text' | 'evergreen';
}

const { type } = Astro.props;

// Get a random banner from the database
let banner: BannerType | null = null;

try {
  banner = type ? getRandomBannerByType(type) : getRandomBanner();
} catch (error) {
  console.error('[Banner] Error loading banner:', error);
  // Continue without banner - don't block page rendering
}

// Use Astro component for banner type (for AdSense), React for others
const useAstroComponent = banner?.link_type === 'banner';

// Prepare banner data for React component (if needed)
const bannerData =
  banner && !useAstroComponent
    ? {
        id: banner.id,
        name: banner.name,
        link_type: banner.link_type,
        html_link: banner.html_link,
        js_links: banner.js_links,
      }
    : null;
---

{
  useAstroComponent ? (
    <BannerAstro type={type} />
  ) : (
    <BannerReact client:load banner={bannerData} />
  )
}
