---
import type { Banner } from '../../../db/banner/banner-schema';
import {
  getRandomBanner,
  getRandomBannerByType,
  getTotalBanners,
} from '../../../db/banner/banner-utils';

interface Props {
  type?: 'banner' | 'text' | 'evergreen';
}

const { type } = Astro.props;

// AdSense HTML for banner type - Laptop/Desktop
const adsenseHtmlLaptop = `<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1540226945870088" crossorigin="anonymous"></script>
<!-- GAS-3 -->
<ins class="adsbygoogle" style="display:block;width:1000px;height:150px;min-width:1000px;max-width:1000px;" data-ad-client="ca-pub-1540226945870088" data-ad-slot="7522021549"></ins>
<script>
     (function() {
       function initAd() {
         var ins = document.querySelector('.adsbygoogle[data-ad-slot="7522021549"]');
         if (ins && ins.offsetWidth > 0) {
           (adsbygoogle = window.adsbygoogle || []).push({});
         } else {
           requestAnimationFrame(initAd);
         }
       }
       if (document.readyState === 'loading') {
         document.addEventListener('DOMContentLoaded', initAd);
       } else {
         initAd();
       }
     })();
</script>`;

// AdSense HTML for banner type - Mobile/Phone
const adsenseHtmlMobile = `<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1540226945870088"
     crossorigin="anonymous"></script>
<!-- GAS-4-phone -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1540226945870088"
     data-ad-slot="7877546087"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>`;

// Get a random banner from the database
const totalBanners = getTotalBanners();

const banner: Banner | null = type
  ? getRandomBannerByType(type)
  : getRandomBanner();

---

{type === 'banner' ? (
    <aside
      role="complementary"
      aria-label="Advertisement"
      data-banner-name={banner?.name || 'adsense-banner'}
      data-banner-type="banner"
    >
      <div
        id={banner?.name || 'adsense-banner'}
        class="w-full mb-2 mt-0 md:mb-2 md:mt-2 flex flex-col justify-center items-center text-center"
      >
        <div class="px-2 py-2 flex flex-col justify-center items-center">

          <!-- Mobile Ad - visible on small screens, hidden on md and up -->
          <div id="GAS-4-phone" class="flex justify-center items-center md:hidden">
            <div style="width: 350px; display: block; visibility: visible;" set:html={adsenseHtmlMobile}></div>
          </div>

          <!-- Laptop Ad - hidden on small screens, visible on md and up -->
          <div id="GAS-3" class="w-full hidden md:flex justify-center items-center" style="width: 100%; min-width: 1000px;">
            <div style="width: 1000px; min-width: 1000px; max-width: 1000px; display: block; visibility: visible;" set:html={adsenseHtmlLaptop}></div>
          </div>

          <p class="text-slate-600 dark:text-slate-300 text-center mt-4 text-xs w-full">
            We earn commissions when you shop through the advertisement links
            or banners in the page
          </p>

        </div>
        {banner?.js_links && (
          <div
            class="w-full flex justify-center items-center"
            set:html={banner.js_links}
          />
        )}
      </div>
    </aside>
  ) : banner ? (
    <aside
      role="complementary"
      aria-label="Advertisement"
      data-banner-name={banner.name}
      data-banner-type={banner.link_type}
    >
      {banner.link_type === 'banner' ? (
        <div
          id={banner.name}
          class="w-full mb-2 mt-0 md:mb-2 md:mt-2 flex flex-col justify-center items-center text-center"
        >
          <div class="w-full px-2 py-2 flex flex-col justify-center items-center">
            <div class="w-full flex justify-center items-center relative">
              <div class="w-full flex justify-center items-center">
                <script
                  is:inline
                  async
                  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1540226945870088"
                  crossorigin="anonymous"
                ></script>
                <!-- GAS-3 -->
                <ins
                  class="adsbygoogle-ins"
                  style="display:inline-block;width:1000px;height:150px"
                  data-ad-client="ca-pub-1540226945870088"
                  data-ad-slot="7522021549"
                ></ins>
                <script is:inline>
                  (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
              </div>
            </div>
            <p class="text-slate-600 dark:text-slate-300 text-center mt-4 text-xs w-full">
              We earn commissions when you shop through the advertisement links
              or banners in the page
            </p>
          </div>
          {banner.js_links && (
            <div
              class="w-full flex justify-center items-center"
              set:html={banner.js_links}
            />
          )}
        </div>
      ) : (
        <>
          <p class="ad-label ad-disclosure text-xs text-slate-600 dark:text-slate-300">
            Ad
          </p>

          <div
            id={banner.name}
            class="w-full bg-yellow-100 border border-gray-200 shadow-sm rounded-md  relative transition-colors duration-300 block
            mb-8 mt-0
            md:mb-10 md:mt-2"
          >
            <div
              class="h-full flex flex-col justify-center 
             "
            >
              <div
                class=" px-4 py-2 
              md:px-6 md:py-6
               text-black [&_a]:text-blue-600 [&_a]:dark:text-blue-400 [&_a]:underline [&_a]:hover:no-underline [&_a]:font-normal"
                set:html={banner.html_link}
              />
            </div>
            {banner.js_links && <div set:html={banner.js_links} />}
          </div>
        </>
      )}
    </aside>
  ) : (
    <div class="w-full my-8 flex justify-center items-center">
      <p class="text-sm text-gray-500">No banners available</p>
    </div>
  )
}

<!-- 
{
  (
    <aside role="complementary" aria-label="Advertisement">
      <div class="px-4 md:px-6 pt-2 text-center">
        <a
          rel="noopener noreferrer"
          target="_blank"
          href="https://docs.google.com/forms/d/e/1FAIpQLSeW3ak1Uu3yv8WDBsFP5CSg0HUQh7cdYd8_gtlLCaJIoqHUSQ/viewform?usp=dialog"
          class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium md:font-bold  py-2 px-6 rounded shadow transition-all duration-200"
        >
          Advertise Here
        </a>
      </div>
    </aside>
  )
} -->
