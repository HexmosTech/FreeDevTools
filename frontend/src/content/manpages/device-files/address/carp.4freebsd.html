<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>carp — Common Address Redundancy Protocol</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       carp — Common Address Redundancy Protocol

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>device</b> <b>carp</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  CARP  allows  multiple hosts on the same local network to share a set of IPv4 and/or IPv6 addresses.
       Its primary purpose is to ensure that these addresses are always available.

       To use <b>carp</b>, the administrator needs to configure at a minimum a  common  virtual  host  ID  (vhid),  and
       attach  at  least one IP address to this vhid on each machine which is to take part in the virtual group.
       Additional parameters can also be set on a per-vhid basis: <b>advbase</b> and <b>advskew</b>, which are used to control
       how frequently the host sends advertisements when it is the master for a virtual host, and <b>pass</b> which  is
       used  to authenticate <b>carp</b> advertisements.  The <b>advbase</b> parameter stands for “advertisement base”.  It is
       measured in seconds and specifies the base of the advertisement interval.  The <b>advskew</b>  parameter  stands
       for  “advertisement  skew”.   It  is measured in 1/256 of seconds.  It is added to the base advertisement
       interval to make one host advertise a bit slower that the other does.  Both <b>advbase</b> and <b>advskew</b>  are  put
       inside  CARP  advertisements.   These  values can be configured using <u><a href="../man8/ifconfig.8.html">ifconfig</a></u>(8), or through the SIOCSVH
       <u><a href="../man2/ioctl.2.html">ioctl</a></u>(2).

       CARP virtual hosts can be configured on multicast-capable interfaces: Ethernet, layer 2  VLAN,  FDDI  and
       Token  Ring.   An  arbitrary  number of virtual host IDs can be configured on an interface.  An arbitrary
       number of IPv4 or IPv6 addresses can be attached to a particular vhid.  It is important  that  all  hosts
       participating in a vhid have the same list of prefixes configured on the vhid, since all the prefixes are
       included  in  the  cryptographic  checksum supplied in each advertisement.  Multiple vhids running on one
       interface participate in master/backup elections independently.

       Additionally, there are a number of global parameters which can be set using <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8):

       <u>net.inet.carp.allow</u>                   Allow <b>carp</b> operation.   When  disabled,  virtual  hosts  remain  in
                                             initial  state,  neither  sending  nor  receiving  announcements or
                                             traffic.  Enabled by default.

       <u>net.inet.carp.preempt</u>                 Allow virtual hosts to preempt each other.  When enabled, a vhid in
                                             a backup state would preempt a master  that  is  announcing  itself
                                             with a lower advskew.  Disabled by default.

       <u>net.inet.carp.dscp</u>                    DSCP value in carp packet.  Valid Values are 0 to 63.  A value of 4
                                             is  equivalent  to  the  old standard of TOS LOW_DELAY.  TOS values
                                             were deprecated and replaced by DSCP in 1998.  The default value is
                                             56 (CS7/Network Control).

       <u>net.inet.carp.log</u>                     Determines what events relating to <b>carp</b> vhids are logged.  A  value
                                             of  0  disables  any  logging.   A value of 1 enables logging state
                                             changes of <b>carp</b> vhids.  Values above 1 enable logging of  bad  <b>carp</b>
                                             packets.  The default value is 1.

       <u>net.inet.carp.demotion</u>                This  value shows the current level of CARP demotion.  The value is
                                             added to the actual advskew sent in announcements  for  all  vhids.
                                             During  normal  system  operation  the  demotion  factor  is  zero.
                                             However,  problematic  conditions  raise  its  level:   when   <b>carp</b>
                                             experiences  problem  with sending announcements, when an interface
                                             running a vhid goes down, or while the <u><a href="../man4/pfsync.4.html">pfsync</a></u>(4) interface  is  not
                                             synchronized.   The  demotion factor can be adjusted writing to the
                                             sysctl oid.  The signed value supplied to the <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8) command  is
                                             added  to  current  demotion  factor.   This allows to control <b>carp</b>
                                             behaviour depending on some external conditions, for example on the
                                             status of some daemon utility.

       <u>net.inet.carp.ifdown_demotion_factor</u>  This value is added to  <u>net.inet.carp.demotion</u>  when  an  interface
                                             running  a  vhid  goes down.  The default value is 240 (the maximum
                                             advskew value).

       <u>net.inet.carp.senderr_demotion_factor</u>
                                             This value is added to <u>net.inet.carp.demotion</u> when <b>carp</b> experiences
                                             errors sending its announcements.  The default value  is  240  (the
                                             maximum advskew value).

</pre><h4><b>STATE</b> <b>CHANGE</b> <b>NOTIFICATIONS</b></h4><pre>
       Sometimes  it  is  useful  to  get notified about <b>carp</b> status change events.  This can be accomplished by
       using <u><a href="../man8/devd.8.html">devd</a></u>(8) hooks.  Master/slave events are signalled under system CARP.  The subsystem  specifies  the
       vhid  and  name of the interface where the master/slave event occurred.  The type of the message displays
       the new state of the vhid.  Please see <u><a href="../man5/devd.conf.5.html">devd.conf</a></u>(5) and the “EXAMPLES” section for more information.

</pre><h4><b>EXAMPLES</b></h4><pre>
       For firewalls and routers with multiple interfaces, it is desirable to  failover  all  of  the  addresses
       running <b>carp</b> together, when one of the physical interfaces goes down.  This is achieved by the use of the
       preempt option.  Enable it on both hosts A and B:

             <b>sysctl</b> <b>net.inet.carp.preempt=1</b>

       Assume  that  host  A  is  the  preferred  master and we are running the 192.168.1.0/24 prefix on em0 and
       192.168.2.0/24 on em1.  This is the setup for host A (advskew is above 0 so it could  be  overwritten  in
       the emergency situation from the other host):

             ifconfig em0 vhid 1 advskew 100 pass mekmitasdigoat 192.168.1.1/24
             ifconfig em1 vhid 2 advskew 100 pass mekmitasdigoat 192.168.2.1/24

       The setup for host B is identical, but it has a higher <b>advskew</b>:

             ifconfig em0 vhid 1 advskew 200 pass mekmitasdigoat 192.168.1.1/24
             ifconfig em1 vhid 2 advskew 200 pass mekmitasdigoat 192.168.2.1/24

       When  one of the physical interfaces of host A fails, <b>advskew</b> is demoted to a configured value on all its
       <b>carp</b> vhids.  Due to the preempt option, host B would start announcing itself, and thus preempt host A  on
       both interfaces instead of just the failed one.

       Processing of <b>carp</b> status change events can be set up by using the following devd.conf rule:

             notify 0 {
                     match "system"          "CARP";
                     match "subsystem"       "[0-9]+@[0-9a-z]+";
                     match "type"            "(MASTER|BACKUP)";
                     action "/root/carpcontrol.sh $subsystem $type";
             };

       To  see  <b>carp</b>  packets  decoded  in <u><a href="../man1/tcpdump.1.html">tcpdump</a></u>(1) output, one needs to specify the <b>-T</b> <u>carp</u> option, otherwise
       <u><a href="../man1/tcpdump.1.html">tcpdump</a></u>(1) will interpret them as VRRP packets:

             tcpdump -npi vlan0 -T carp

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/tcpdump.1.html">tcpdump</a></u>(1), <u><a href="../man4/inet.4.html">inet</a></u>(4), <u><a href="../man4/pfsync.4.html">pfsync</a></u>(4), <u><a href="../man5/devd.conf.5.html">devd.conf</a></u>(5), <u><a href="../man5/rc.conf.5.html">rc.conf</a></u>(5), <u><a href="../man8/ifconfig.8.html">ifconfig</a></u>(8), <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8)

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>carp</b> device first appeared in OpenBSD 3.5.  The <b>carp</b>  device  was  imported  into  FreeBSD  5.4.   In
       FreeBSD 10.0, <b>carp</b> was significantly rewritten, and is no longer a pseudo-interface.

Debian                                            July 1, 2018                                           <u><a href="../man4/CARP.4.html">CARP</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>