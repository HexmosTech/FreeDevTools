<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ng_car — Committed Access Rate netgraph node type</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ng_car — Committed Access Rate netgraph node type

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;netgraph/ng_car.h&gt;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>car</b> node type limits traffic flowing through it using:

       <b>•</b>   Single rate three color marker as described in RFC 2697,
       <b>•</b>   Two rate three color marker as described in RFC 2698,
       <b>•</b>   RED-like rate limit algorithm used by Cisco,
       <b>•</b>   Traffic shaping with RED.

</pre><h4><b>HOOKS</b></h4><pre>
       This node type supports the following hooks:

       <u>upper</u>  Hook leading to upper layer protocols.

       <u>lower</u>  Hook leading to lower layer protocols.

       Traffic  flowing  from  <u>upper</u>  to  <u>lower</u> is considered <b>downstream</b> traffic.  Traffic flowing from <u>lower</u> to
       <u>upper</u> is considered <b>upstream</b> traffic.

</pre><h4><b>MODES</b> <b>OF</b> <b>OPERATION</b></h4><pre>
       Each hook can operate in one of the following modes:

       NG_CAR_SINGLE_RATE
            Single rate three color marker as described in RFC 2697.  Committed burst  packets  are  counted  as
            green,  extended  burst  packets  are  counted  as  yellow and exceeding packets are counted as red.
            Committed burst getting refilled with CIR (Committed Information Rate)  speed.   When  it  is  full,
            exceeded burst getting refilled.

       NG_CAR_DOUBLE_RATE
            Two rate three color marker as described in RFC 2698.  Committed burst packets are counted as green,
            peak  burst packets are counted as yellow and exceeding packets are counted as red.  Committed burst
            getting refilled with CIR speed.  Peak burst getting refilled with PIR (Peak Information Rate) speed
            at the same time.

       NG_CAR_RED
            Similar to NG_CAR_SINGLE_RATE, but with different understanding  of  extended  burst.   When  normal
            burst exceeded and extended burst is used, packets are counted red with probability equal to part of
            extended  burst  consumed.  Extended burst getting refilled first.  When it is full, committed burst
            getting refilled.  This behavior is similar to RED active queue management algorithm.

            This algorithm is more polite to the TCP traffic than NG_CAR_SINGLE_RATE.

       NG_CAR_SHAPE
            Committed burst packets are counted as green, exceeding  packets  are  delayed  by  queue  with  RED
            management  and  counted  as yellow.  Packets dropped by queue counted as red.  Queue parameters are
            hardcoded: length 99 packets, min_th 8 packets, max_p 100%.

            Traffic shaping is much more polite to the TCP traffic than rate limit on  links  with  bandwidth  *
            delay  product  less  than  6-8  TCP segments, but it consumes additional system resources for queue
            processing.
       By default, all information rates are measured in bits per second and bursts are measured in bytes.   But
       when  NG_CAR_COUNT_PACKETS  option is enabled, rates are measured in packets per second and bursts are in
       packets.

</pre><h4><b>CONTROL</b> <b>MESSAGES</b></h4><pre>
       This node type supports the generic control messages and the following specific messages.

       NGM_CAR_SET_CONF (<b>setconf</b>)
            Set node configuration to the specified at <u>struct</u> <u>ng_car_bulkconf</u>

       NGM_CAR_GET_CONF (<b>getconf</b>)
            Return current node configuration as <u>struct</u> <u>ng_car_bulkconf</u>

            struct ng_car_hookconf {
                    uint64_t cbs;           /* Committed burst size (bytes) */
                    uint64_t ebs;           /* Exceeded/Peak burst size (bytes) */
                    uint64_t cir;           /* Committed information rate (bits/s) */
                    uint64_t pir;           /* Peak information rate (bits/s) */
                    uint8_t  green_action;  /* Action for green packets */
                    uint8_t  yellow_action; /* Action for yellow packets */
                    uint8_t  red_action;    /* Action for red packets */
                    uint8_t  mode;          /* single/double rate, ... */
                    uint8_t  opt;           /* color-aware or color-blind */
            };

            /* possible actions (..._action) */
            enum {
                NG_CAR_ACTION_FORWARD = 1,
                NG_CAR_ACTION_DROP
            };

            /* operation modes (mode) */
            enum {
                NG_CAR_SINGLE_RATE = 0,
                NG_CAR_DOUBLE_RATE,
                NG_CAR_RED,
                NG_CAR_SHAPE
            };

            /* mode options (opt) */
            #define NG_CAR_COUNT_PACKETS    2

            struct ng_car_bulkconf {
                    struct ng_car_hookconf upstream;
                    struct ng_car_hookconf downstream;
            };

       NGM_CAR_GET_STATS (<b>getstats</b>)
            Return node statistics as <u>struct</u> <u>ng_car_bulkstats</u>

            struct ng_car_hookstats {
                    uint64_t passed_pkts;   /* Counter for passed packets */
                    uint64_t droped_pkts;   /* Counter for dropped packets */
                    uint64_t green_pkts;    /* Counter for green packets */
                    uint64_t yellow_pkts;   /* Counter for yellow packets */
                    uint64_t red_pkts;      /* Counter for red packets */
                    uint64_t errors;        /* Counter for operation errors */
            };

            struct ng_car_bulkstats {
                    struct ng_car_hookstats upstream;
                    struct ng_car_hookstats downstream;
            };

       NGM_CAR_CLR_STATS (<b>clrstats</b>)
            Clear node statistics.

       NGM_CAR_GETCLR_STATS (<b>getclrstats</b>)
            Atomically return and clear node statistics.

</pre><h4><b>SHUTDOWN</b></h4><pre>
       This node shuts down upon receipt of a  NGM_SHUTDOWN  control  message,  or  when  all  hooks  have  been
       disconnected.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Limit outgoing data rate over fxp0 Ethernet interface to 20Mbit/s and incoming packet rate to 5000pps.

             /usr/sbin/ngctl -f- &lt;&lt;-SEQ
                     mkpeer fxp0: car lower lower
                     name fxp0:lower fxp0_car
                     connect fxp0: fxp0_car: upper upper
                     msg fxp0_car: setconf { downstream={ cir=20000000 cbs=2500000 ebs=2500000 greenAction=1 yellowAction=1 redAction=2 mode=2 } upstream={ cir=5000 cbs=100 ebs=100 greenAction=1 yellowAction=1 redAction=2 mode=2 opt=2 } }
             SEQ

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man4/netgraph.4.html">netgraph</a></u>(4), <u><a href="../man8/ngctl.8.html">ngctl</a></u>(8)

       J. Heinanen, <u>A</u> <u>Single</u> <u>Rate</u> <u>Three</u> <u>Color</u> <u>Marker</u>, RFC 2697.

       J. Heinanen, <u>A</u> <u>Two</u> <u>Rate</u> <u>Three</u> <u>Color</u> <u>Marker</u>, RFC 2698.

</pre><h4><b>AUTHORS</b></h4><pre>
       Nuno Antunes &lt;<u><a href="mailto:nuno.antunes@gmail.com">nuno.antunes@gmail.com</a></u>&gt;
       Alexander Motin &lt;<u><a href="mailto:mav@FreeBSD.org">mav@FreeBSD.org</a></u>&gt;

</pre><h4><b>BUGS</b></h4><pre>
       At this moment only DROP and FORWARD actions are implemented.

Debian                                          November 13, 2012                                      <u><a href="../man4/NG_CAR.4.html">NG_CAR</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>