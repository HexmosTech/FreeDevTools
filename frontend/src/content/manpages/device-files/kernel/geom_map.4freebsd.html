<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>geom_map — GEOM module that maps defined items as separate partitions</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       geom_map — GEOM module that maps defined items as separate partitions

</pre><h4><b>SYNOPSIS</b></h4><pre>
       To compile this driver into the kernel, place the following line in your kernel configuration file:

             <b>options</b> <b>geom_map</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>geom_map</b> framework provides support for mapping defined parts of the media.  Basically it is helpful
       for embedded devices where in the one continuous flash are loader, kernel  and  rootfs  parts.   <b>geom_map</b>
       allows making them available as separate parts and protects the loader from being overwritten.

       At boot time <b>geom_map</b> partitions are listed (only with bootverbose) as:

             MAP: 0x30000, data=0x30000 "/dev/map/bootloader"
             MAP: 30000x10000, data=0x10000 "/dev/map/factory"
             MAP: 40000x7a0000, data=0x7a0000 "/dev/map/upgrade"
             MAP: search key ".!<a href="file:/bin/sh">/bin/sh</a>" from 0x100000, step 0x10000
             MAP: 40000x110000, data=0x110000 "/dev/map/kernel"
             MAP: search key ".!<a href="file:/bin/sh">/bin/sh</a>" from 0x100000, step 0x10000
             MAP: 150000x690000, data=0x690000 "/dev/map/rootfs"
             MAP: 7e0000x20000, data=0x20000 "/dev/map/config"

       The current <b>geom_map</b> configuration can be accessed with the following <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8) nodes: <u>kern.geom.conftxt</u>,
       <u>kern.geom.confxml</u>, and <u>kern.geom.confdot</u> or by using “<b>geom</b> <b>map</b> <b>list</b>”.

             # sysctl -n kern.geom.conftxt
             0 MD md0 10485760 512 u 0 s 512 f 0 fs 0 l 10485760 t malloc
             0 DISK cfid0 8388608 4 hd 0 sc 0
             1 MAP map/config 131072 4 i 5 o 8257536 entry 0 dsize 131072
             1 MAP map/rootfs 6881280 4 i 4 o 1376256 entry 0 dsize 6881280
             2 UZIP map/rootfs.uzip 18677760 512
             1 MAP map/kernel 1114112 4 i 3 o 262144 entry 0 dsize 1114112
             1 MAP map/upgrade 7995392 4 i 2 o 262144 entry 0 dsize 7995392
             1 MAP map/factory 65536 4 i 1 o 196608 entry 0 dsize 65536
             1 MAP map/bootloader 196608 4 i 0 o 0 entry 0 dsize 196608

       Driver configuration can be done in <u><a href="../man5/device.hints.5.html">device.hints</a></u>(5).  List of used parameters:

       <u>at</u>      select media to attach

       <u>name</u>    name of partition (will create device <u>/dev/map/that_name</u>)

       <u>start</u>   offset  from  the beginning of the parent media to start of the mapped partition.  This field can
               also have a special value "<b>search:</b><u>searchstart</u>:<u>searchstep</u>:<u>searchkey</u>", where:

               <u>searchstart</u>
                       offset from the beginning of the parent media where search will be started

               <u>searchstep</u>
                       value of the increment used while searching for the partition boundary markers

               <u>searchkey</u>
                       key which will be used to find partition boundary markers.  The wildcard ‘.’ can be  used
                       to match any character on that position

       <u>end</u>     offset from the beginning of the parent media to the end of the mapped partition.  This field can
               also have the special value "<b>search:</b><u>searchstart</u>:<u>searchstep</u>:<u>searchkey</u>", as described above.

       <u>offset</u>  offset where the data of the mapped partition begins

       Each record contains the start address (in bytes) from the media begin, size (in bytes), offset where the
       data of mapped partition begins, and the name of new device.

             MAP: 150000x690000, data=0x690000 "/dev/map/rootfs"

       00150000 - start address
       00690000 - size
       00000000 - data begin from zero offset
       00690000 - data size
       "map/rootfs" - new media will be accessible via /dev/map/rootfs dev.

</pre><h4><b>EXAMPLES</b></h4><pre>
       If we need to implement layout shown above, we need to define the following hints:

             hint.map.0.at="cfid0"
             hint.map.0.start=0x00000000
             hint.map.0.end=0x00030000
             hint.map.0.name="bootloader"
             hint.map.0.readonly=1

       This  defines  <u>/dev/map/bootloader</u>  at  disk <u>cfid0</u> starting at <b>0x00000000</b> and ending at <b>0x00030000</b>, it is
       also marked as readonly.

             hint.map.1.at="cfid0"
             hint.map.1.start=0x00030000
             hint.map.1.end=0x00040000
             hint.map.1.name="factory"

             hint.map.2.at="cfid0"
             hint.map.2.start=0x00040000
             hint.map.2.end=0x007e0000
             hint.map.2.name="upgrade"

             hint.map.3.at="cfid0"
             hint.map.3.name="kernel"
             hint.map.3.start=0x00040000
             hint.map.3.end="search:0x00100000:0x10000:.!<a href="file:/bin/sh">/bin/sh</a>"

       This defines <u>/dev/map/kernel</u> at disk <u>cfid0</u> starting at <b>0x00040000</b>, but the end position must be  searched
       by  finding  the key “<b>.!<a href="file:/bin/sh">/bin/sh</a></b>”, from offset <b>0x00100000</b> to the end of media with step <b>0x10000</b>.  The real
       marker in this case is “<b>#!<a href="file:/bin/sh">/bin/sh</a></b>”, but ‘#’ terminates the line when the hints file is parsed, so we need
       to use wildcard ‘.’ instead of ‘#’.

             hint.map.4.at="cfid0"
             hint.map.4.name="rootfs"
             hint.map.4.start="search:0x00100000:0x10000:.!<a href="file:/bin/sh">/bin/sh</a>"
             hint.map.4.end=0x007e0000

             hint.map.5.at="cfid0"
             hint.map.5.start=0x007e0000
             hint.map.5.end=0x00800000
             hint.map.5.name="config"

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man4/geom.4.html">geom</a></u>(4), <u><a href="../man8/geom.8.html">geom</a></u>(8), <u><a href="../man8/sysctl.8.html">sysctl</a></u>(8)

</pre><h4><b>AUTHORS</b></h4><pre>
       The <b>geom_map</b> driver was written by Aleksandr Rybalko &lt;<u><a href="mailto:ray@ddteam.net">ray@ddteam.net</a></u>&gt;.

Debian                                            June 8, 2015                                       <u><a href="../man4/GEOM_MAP.4.html">GEOM_MAP</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>