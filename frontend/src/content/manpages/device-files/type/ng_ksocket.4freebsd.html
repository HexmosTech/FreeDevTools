<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ng_ksocket — kernel socket netgraph node type</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ng_ksocket — kernel socket netgraph node type

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/types.h&gt;</b>
       <b>#include</b> <b>&lt;netgraph/ng_ksocket.h&gt;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       A  <b>ksocket</b>  node is both a netgraph node and a BSD socket.  The <b>ng_ksocket</b> node type allows one to open a
       socket inside the kernel and have it appear as a Netgraph node.  The <b>ng_ksocket</b> node type is the  reverse
       of  the  socket  node  type  (see  <u><a href="../man4/ng_socket.4.html">ng_socket</a></u>(4)):  whereas  the  socket  node type enables the user-level
       manipulation (via a socket) of what is normally a kernel-level entity (the associated Netgraph node), the
       <b>ng_ksocket</b> node type enables the kernel-level manipulation (via a Netgraph node) of what  is  normally  a
       user-level entity (the associated socket).

       A  <b>ng_ksocket</b>  node  allows at most one hook connection.  Connecting to the node is equivalent to opening
       the associated socket.  The name given to the hook determines what kind of socket the node will open (see
       below).  When the hook is disconnected and/or the node is shutdown, the associated socket is closed.

</pre><h4><b>HOOKS</b></h4><pre>
       This node type supports a single hook connection at a time.  The name of the hook must  be  of  the  form
       <u>&lt;family&gt;/&lt;type&gt;/&lt;proto&gt;</u>,  where  the  <u>family</u>,  <u>type</u>,  and  <u>proto</u>  are  the decimal equivalent of the same
       arguments to <u><a href="../man2/socket.2.html">socket</a></u>(2).  Alternately, aliases for the commonly used values are  accepted  as  well.   For
       example inet/dgram/udp is a more readable but equivalent version of 2/2/17.

       Data  received  into  socket is sent out via hook.  Data received on hook is sent out from socket, if the
       latter is connected (an NGM_KSOCKET_CONNECT was sent to  node  before).   If  socket  is  not  connected,
       destination  <u>struct</u>  <u>sockaddr</u>  must  be  supplied  in an mbuf tag with cookie NGM_KSOCKET_COOKIE and type
       NG_KSOCKET_TAG_SOCKADDR attached to data.  Otherwise <b>ng_ksocket</b> will return ENOTCONN to sender.

</pre><h4><b>CONTROL</b> <b>MESSAGES</b></h4><pre>
       This node type supports the generic control messages, plus the following:

       NGM_KSOCKET_BIND (<b>bind</b>)
            This functions exactly like the <u><a href="../man2/bind.2.html">bind</a></u>(2) system call.  The <u>struct</u> <u>sockaddr</u> socket  address  parameter
            should be supplied as an argument.

       NGM_KSOCKET_LISTEN (<b>listen</b>)
            This  functions exactly like the <u><a href="../man2/listen.2.html">listen</a></u>(2) system call.  The backlog parameter (a single 32 bit int)
            should be supplied as an argument.

       NGM_KSOCKET_CONNECT (<b>connect</b>)
            This functions exactly like the <u><a href="../man2/connect.2.html">connect</a></u>(2) system call.  The  <u>struct</u>  <u>sockaddr</u>  destination  address
            parameter should be supplied as an argument.

       NGM_KSOCKET_ACCEPT (<b>accept</b>)
            Equivalent  to the <u><a href="../man2/accept.2.html">accept</a></u>(2) system call on a non-blocking socket.  If there is a pending connection
            on the queue, a new socket and a corresponding cloned node are created.   Returned  are  the  cloned
            node's  ID  and a peer name (as <u>struct</u> <u>sockaddr</u>).  If there are no pending connections, this control
            message returns nothing, and a connected node will receive the above message asynchronously, when  a
            connection is established.

            A  cloned  node  supports a single hook with an arbitrary name.  If not connected, a node disappears
            when its parent node is destroyed.  Once connected, it becomes an independent node.

       NGM_KSOCKET_GETNAME (<b>getname</b>)
            Equivalent to the <u><a href="../man2/getsockname.2.html">getsockname</a></u>(2) system call.  The name is returned as  a  <u>struct</u>  <u>sockaddr</u>  in  the
            arguments field of the reply.

       NGM_KSOCKET_GETPEERNAME (<b>getpeername</b>)
            Equivalent  to  the  <u><a href="../man2/getpeername.2.html">getpeername</a></u>(2)  system  call.  The name is returned as a <u>struct</u> <u>sockaddr</u> in the
            arguments field of the reply.

       NGM_KSOCKET_SETOPT (<b>setopt</b>)
            Equivalent to the <u><a href="../man2/setsockopt.2.html">setsockopt</a></u>(2) system call, except that the  option  name,  level,  and  value  are
            passed in a <u>struct</u> <u>ng_ksocket_sockopt</u>.

       NGM_KSOCKET_GETOPT (<b>getopt</b>)
            Equivalent  to  the  <u><a href="../man2/getsockopt.2.html">getsockopt</a></u>(2)  system  call,  except  that  the  option  is  passed in a <u>struct</u>
            <u>ng_ksocket_sockopt</u>.  When sending this command, the value field should be  empty;  upon  return,  it
            will contain the retrieved value.

</pre><h4><b>ASCII</b> <b>FORM</b> <b>CONTROL</b> <b>MESSAGES</b></h4><pre>
       For  control  messages  that pass a <u>struct</u> <u>sockaddr</u> in the argument field, the normal ASCII equivalent of
       the C structure is an acceptable form.  For the PF_INET and PF_LOCAL address families, a more  convenient
       form  is  also  used,  which  is  the  protocol  family name, followed by a slash, followed by the actual
       address.  For PF_INET, the address is an IP address followed by an optional colon and port  number.   For
       PF_LOCAL, the address is the pathname as a doubly quoted string.

       Examples:

       PF_LOCAL  local/"/tmp/foo.socket"

       PF_INET   inet/192.168.1.1:1234

       Other     { family=16 len=16 data=[0x70 0x00 0x01 0x23] }

       For  control  messages that pass a <u>struct</u> <u>ng_ksocket_sockopt</u>, the normal ASCII form for that structure is
       used.  In the future, more convenient encoding of the more common socket options may be supported.

       Setting socket options example:

       Set FIB 2 for a socket (SOL_SOCKET, SO_SETFIB):
                 setopt { level=0xffff name=0x1014 data=[ 2 ] }

</pre><h4><b>SHUTDOWN</b></h4><pre>
       This node shuts down upon receipt of a NGM_SHUTDOWN control message, or when the  hook  is  disconnected.
       Shutdown of the node closes the associated socket.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man2/socket.2.html">socket</a></u>(2), <u><a href="../man4/netgraph.4.html">netgraph</a></u>(4), <u><a href="../man4/ng_socket.4.html">ng_socket</a></u>(4), <u><a href="../man8/ngctl.8.html">ngctl</a></u>(8), <u><a href="../man9/mbuf_tags.9.html">mbuf_tags</a></u>(9), <u><a href="../man9/socket.9.html">socket</a></u>(9)

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>ng_ksocket</b> node type was implemented in FreeBSD 4.0.

</pre><h4><b>AUTHORS</b></h4><pre>
       Archie Cobbs &lt;<u><a href="mailto:archie@FreeBSD.org">archie@FreeBSD.org</a></u>&gt;

Debian                                           January 9, 2012                                   <u><a href="../man4/NG_KSOCKET.4.html">NG_KSOCKET</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>