<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ng_source — netgraph node for traffic generation</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ng_source — netgraph node for traffic generation

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;sys/types.h&gt;</b>
       <b>#include</b> <b>&lt;netgraph/ng_source.h&gt;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The <b>source</b> node acts as a source of packets according to the parameters set up using control messages and
       input packets.  The <b>ng_source</b> node type is used primarily for testing and benchmarking.

</pre><h4><b>HOOKS</b></h4><pre>
       The  <b>source</b>  node  has  two  hooks:  <u>input</u>  and  <u>output</u>.   The  <u>output</u>  hook  must  remain connected, its
       disconnection will shutdown the node.

</pre><h4><b>OPERATION</b></h4><pre>
       The operation of the node is as follows.  Packets received on the <u>input</u> hook are queued internally.  When
       <u>output</u> hook is connected, <b>ng_source</b> node assumes that its neighbour node is  of  <u><a href="../man4/ng_ether.4.html">ng_ether</a></u>(4)  node  type.
       The neighbour is queried for its interface name.  The <b>ng_source</b> node then uses queue of the interface for
       its  evil  purposes.   The <b>ng_source</b> node also disables <u>autosrc</u> option on neighbour <u><a href="../man4/ng_ether.4.html">ng_ether</a></u>(4) node.  If
       interface  name  cannot  be  obtained  automatically,  it  should  be  configured  explicitly  with   the
       NGM_SOURCE_SETIFACE control message, and <u>autosrc</u> should be turned off on <u><a href="../man4/ng_ether.4.html">ng_ether</a></u>(4) node manually.

       Once  interface is configured, upon receipt of a NGM_SOURCE_START control message the node starts sending
       the previously queued packets out the <u>output</u> hook on every clock tick as fast as the connected  interface
       will  take  them.  While active, on every clock tick the node checks the available space in the interface
       queue and sends that many packets out its <u>output</u> hook.  Once the number of packets indicated in the start
       message has been sent, or upon receipt of a NGM_SOURCE_STOP message, the node stops sending data.

</pre><h4><b>CONTROL</b> <b>MESSAGES</b></h4><pre>
       This node type supports the generic control messages as well as the following, which must  be  sent  with
       the NGM_SOURCE_COOKIE attached.

       NGM_SOURCE_GET_STATS (<b>getstats</b>)
            Returns a structure containing the following fields:

            <u>outOctets</u>    The number of octets/bytes sent out the <u>output</u> hook.

            <u>outFrames</u>    The number of frames/packets sent out the <u>output</u> hook.

            <u>queueOctets</u>  The number of octets queued from the <u>input</u> hook.

            <u>queueFrames</u>  The number of frames queued from the <u>input</u> hook.

            <u>startTime</u>    The time the last start message was received.

            <u>endTime</u>      The time the last end message was received or the output packet count was reached.

            <u>elapsedTime</u>  Either <u>endTime</u> <b>-</b> <u>startTime</u> or current time - <u>startTime</u>.

       NGM_SOURCE_CLR_STATS (<b>clrstats</b>)
            Clears and resets the statistics returned by <b>getstats</b> (except <u>queueOctets</u> and <u>queueFrames</u>).

       NGM_SOURCE_GETCLR_STATS (<b>getclrstats</b>)
            As <b>getstats</b> but clears the statistics at the same time.

       NGM_SOURCE_START (<b>start</b>)
            This  message  requires  a  single  <u>uint64_t</u> parameter which is the number of packets to send before
            stopping.  Node starts sending the queued packets out the <u>output</u> hook.   The  <u>output</u>  hook  must  be
            connected and node must have interface configured.

       NGM_SOURCE_STOP (<b>stop</b>)
            Stops the node if it is active.

       NGM_SOURCE_CLR_DATA (<b>clrdata</b>)
            Clears the packets queued from the <u>input</u> hook.

       NGM_SOURCE_SETIFACE (<b>setiface</b>)
            This message requires the name of the interface to be configured as an argument.

       NGM_SOURCE_SETPPS (<b>setpps</b>)
            This  message  requires  a single <u>uint32_t</u> parameter which puts upper limit on the amount of packets
            sent per second.

       NGM_SOURCE_SET_TIMESTAMP (<b>settimestamp</b>)
            This message specifies that a timestamp (in the format of a <u>struct</u> <u>timeval</u>) should  be  inserted  in
            the transmitted packets.  This message requires a structure containing the following fields:

            <u>offset</u>  The offset from the beginning of the packet at which the timestamp is to be inserted.

            <u>flags</u>   Set to 1 to enable the timestamp.

       NGM_SOURCE_GET_TIMESTAMP (<b>gettimestamp</b>)
            Returns the current timestamp settings in the form of the structure described above.

       NGM_SOURCE_SET_COUNTER (<b>setcounter</b>)
            This  message  specifies  that  a  counter  should  be  embedded in transmitted packets.  Up to four
            counters may be  independently  configured.   This  message  requires  a  structure  containing  the
            following fields:

            <u>offset</u>     The offset from the beginning of the packet at which the counter is to be inserted.

            <u>flags</u>      Set to 1 to enable the counter.

            <u>width</u>      The byte width of the counter.  It may be 1, 2, or 4.

            <u>next_val</u>   The value for the next insertion of the counter.

            <u>min_val</u>    The minimum value to be used by the counter.

            <u>max_val</u>    The maximum value to be used by the counter.

            <u>increment</u>  The value to be added to the counter after each insertion.  It may be negative.

            <u>index</u>      The counter to be configured, from 0 to 3.

       NGM_SOURCE_GET_COUNTER (<b>getcounter</b>)
            This  message requires a single <u>uint8_t</u> parameter which specifies the counter to query.  Returns the
            current counter settings in the form of the structure described above.

</pre><h4><b>SHUTDOWN</b></h4><pre>
       This node shuts down  upon  receipt  of  a  NGM_SHUTDOWN  control  message,  when  all  hooks  have  been
       disconnected, or when the <u>output</u> hook has been disconnected.

</pre><h4><b>EXAMPLES</b></h4><pre>
       Attach the node to an <u><a href="../man4/ng_ether.4.html">ng_ether</a></u>(4) node for an interface.  If <b>ng_ether</b> is not already loaded you will need
       to  do  so.   For  example,  these  commands load the <b>ng_ether</b> module and attach the <u>output</u> hook of a new
       <b>source</b> node to <u>orphans</u> hook of the <b>bge0:</b> <b>ng_ether</b> node.

             kldload ng_ether
             ngctl mkpeer bge0: source orphans output

       At this point the new node can be referred to as “<b>bge0:orphans</b>”.  The node can be given its own name like
       this:

             <b>ngctl</b> <b>name</b> <b>bge0:orphans</b> <b>src0</b>

       After which it can be referred to as “<b>src0:</b>”.

       Once created, packets can be sent to the node as raw binary data.  Each packet must  be  delivered  in  a
       separate netgraph message.

       The  following  example  uses  a short Perl script to convert the hex representation of an ICMP packet to
       binary and deliver it to the <b>source</b> node's <u>input</u> hook via <u><a href="../man8/nghook.8.html">nghook</a></u>(8):

             perl -pe 's/(..)[ \t\n]*/chr(hex($1))/ge' &lt;&lt;EOF | nghook src0: input
             ff ff ff ff ff ff 00 00 00 00 00 00 08 00 45 00
             00 54 cb 13 00 00 40 01 b9 87 c0 a8 2b 65 0a 00
             00 01 08 00 f8 d0 c9 76 00 00 45 37 01 73 00 01
             04 0a 08 09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15
             16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25
             26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35
             36 37
             EOF

       To check that the node has queued these packets you can get the node statistics:

             ngctl msg bge0:orphans getstats
             Args:   { queueOctets=64 queueFrames=1 }

       Send as many packets as required out the <u>output</u> hook:

             <b>ngctl</b> <b>msg</b> <b>bge0:orphans</b> <b>start</b> <b>16</b>

       Either wait for them to be sent (periodically fetching stats if desired) or send the stop message:

             <b>ngctl</b> <b>msg</b> <b>bge0:orphans</b> <b>stop</b>

       Check the statistics (here we use <b>getclrstats</b> to also clear the statistics):

             ngctl msg bge0:orphans getclrstats
             Args:   { outOctets=1024 outFrames=16 queueOctets=64 queueFrames=1
             startTime={ tv_sec=1035305880 tv_usec=758036 } endTime={ tv_sec=1035305880
             tv_usec=759041 } elapsedTime={ tv_usec=1005 } }

       The times are from <u>struct</u> <u>timeval</u>s, the <u>tv_sec</u> field is seconds since the Epoch and can be converted into
       a date string via TCL's [clock format] or via the <u><a href="../man1/date.1.html">date</a></u>(1) command:

             date -r 1035305880
             Tue Oct 22 12:58:00 EDT 2002

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man4/netgraph.4.html">netgraph</a></u>(4), <u><a href="../man4/ng_echo.4.html">ng_echo</a></u>(4), <u><a href="../man4/ng_hole.4.html">ng_hole</a></u>(4), <u><a href="../man4/ng_tee.4.html">ng_tee</a></u>(4), <u><a href="../man8/ngctl.8.html">ngctl</a></u>(8), <u><a href="../man8/nghook.8.html">nghook</a></u>(8)

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>ng_source</b> node type was implemented in FreeBSD 4.8.

</pre><h4><b>AUTHORS</b></h4><pre>
       Dave Chapeskie

Debian                                            March 1, 2007                                     <u><a href="../man4/NG_SOURCE.4.html">NG_SOURCE</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>