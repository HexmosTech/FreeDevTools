<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ng_etf — Ethertype filtering netgraph node type</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       ng_etf — Ethertype filtering netgraph node type

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>#include</b> <b>&lt;netgraph.h&gt;</b>
       <b>#include</b> <b>&lt;netgraph/ng_etf.h&gt;</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  <b>etf</b>  node  type multiplexes and filters data between hooks on the basis of the ethertype found in an
       Ethernet header, presumed to be in the first 14 bytes of the data.  Incoming Ethernet frames are accepted
       on the <u>downstream</u> hook and if the ethertype matches a value which the node has been configured to filter,
       the packet is forwarded out the hook which was identified at the time that value was configured.   If  it
       does  not  match  a  configured  value,  it  is  passed  to the <u>nomatch</u> hook.  If the <u>nomatch</u> hook is not
       connected, the packet is dropped.

       Packets travelling in the other direction (towards the <u>downstream</u> hook) are also examined  and  filtered.
       If  a  packet  has  an  ethertype  that  matches one of the values configured into the node, it must have
       arrived in on the hook for which that value was configured, otherwise it will be  discarded.   Ethertypes
       of values other than those configured by the control messages must have arrived via the <u>nomatch</u> hook.

</pre><h4><b>HOOKS</b></h4><pre>
       This node type supports the following hooks:

       <u>downstream</u>        Typically this hook would be connected to a <u><a href="../man4/ng_ether.4.html">ng_ether</a></u>(4) node, using the <u>lower</u> hook.

       <u>nomatch</u>           Typically this hook would also be connected to an <u><a href="../man4/ng_ether.4.html">ng_ether</a></u>(4) type node using the <u>upper</u>
                         hook.

       ⟨<u>any</u> <u>legal</u> <u>name</u>⟩  Any  other  hook  name  will  be  accepted  and  can  be used as the match target of an
                         ethertype.  Typically this hook would be attached to  a  protocol  handling  node  that
                         requires and generates packets with a particular set of ethertypes.

</pre><h4><b>CONTROL</b> <b>MESSAGES</b></h4><pre>
       This node type supports the generic control messages, plus the following:

       NGM_ETF_GET_STATUS (<b>getstatus</b>)
             This command returns a <u>struct</u> <u>ng_etfstat</u> containing node statistics for packet counts.

       NGM_ETF_SET_FILTER (<b>setfilter</b>)
             Sets  the  a new ethertype filter into the node and specifies the hook to and from which packets of
             that type should use.  The hook  and  ethertype  are  specified  in  a  structure  of  type  <u>struct</u>
             <u>ng_etffilter</u>:

                 struct ng_etffilter {
                     char        matchhook[NG_HOOKSIZ];  /* hook name */
                     uint16_t    ethertype;              /* this ethertype to this hook */
                 };

</pre><h4><b>EXAMPLES</b></h4><pre>
       Using <u><a href="../man8/ngctl.8.html">ngctl</a></u>(8) it is possible to set a filter in place from the command line as follows:

           #!<a href="file:/bin/sh">/bin/sh</a>
           ETHER_IF=fxp0
           MATCH1=0x834
           MATCH2=0x835
           cat &lt;&lt;DONE &gt;/tmp/xwert
           # Make a new ethertype filter and attach to the Ethernet lower hook.
           # first remove left over bits from last time.
           shutdown ${ETHER_IF}:lower
           mkpeer ${ETHER_IF}: etf lower downstream
           # Give it a name to easily refer to it.
           name ${ETHER_IF}:lower etf
           # Connect the nomatch hook to the upper part of the same interface.
           # All unmatched packets will act as if the filter is not present.
           connect ${ETHER_IF}: etf: upper nomatch
           DONE
           ngctl -f /tmp/xwert

           # something to set a hook to catch packets and show them.
           echo "Unrecognised packets:"
           nghook -a etf: newproto &amp;
           # Filter two random ethertypes to that hook.
           ngctl 'msg etf: setfilter { matchhook="newproto" ethertype=${MATCH1} }
           ngctl 'msg etf: setfilter { matchhook="newproto" ethertype=${MATCH2} }

</pre><h4><b>SHUTDOWN</b></h4><pre>
       This  node  shuts  down  upon  receipt  of  a  NGM_SHUTDOWN  control message, or when all hooks have been
       disconnected.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man4/netgraph.4.html">netgraph</a></u>(4), <u><a href="../man4/ng_ether.4.html">ng_ether</a></u>(4), <u><a href="../man8/ngctl.8.html">ngctl</a></u>(8), <u><a href="../man8/nghook.8.html">nghook</a></u>(8)

</pre><h4><b>HISTORY</b></h4><pre>
       The <b>ng_etf</b> node type was implemented in FreeBSD 5.0.

</pre><h4><b>AUTHORS</b></h4><pre>
       Julian Elischer &lt;<u><a href="mailto:julian@FreeBSD.org">julian@FreeBSD.org</a></u>&gt;

Debian                                          November 13, 2012                                      <u><a href="../man4/NG_ETF.4.html">NG_ETF</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>