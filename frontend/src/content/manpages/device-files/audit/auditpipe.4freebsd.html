<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>auditpipe — pseudo-device for live audit event tracking</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/plucky/+package/freebsd-manpages">freebsd-manpages_12.2-2_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       auditpipe — pseudo-device for live audit event tracking

</pre><h4><b>SYNOPSIS</b></h4><pre>
       <b>options</b> <b>AUDIT</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       While  audit trail files generated with <u><a href="../man4/audit.4.html">audit</a></u>(4) and maintained by <u><a href="../man8/auditd.8.html">auditd</a></u>(8) provide a reliable long-term
       store for audit log information, current log files are owned by the audit daemon until terminated  making
       them  somewhat  unwieldy  for  live  monitoring applications such as host-based intrusion detection.  For
       example, the log may be cycled and new records written to a new file without notice to applications  that
       may be accessing the file.

       The  audit  facility provides an audit pipe facility for applications requiring direct access to live BSM
       audit data for the purposes of real-time monitoring.  Audit pipes are available via  a  clonable  special
       device,  <u>/dev/auditpipe</u>,  subject to the permissions on the device node, and provide a "tee" of the audit
       event stream.  As the device is clonable, more than one instance of the device may be opened at  a  time;
       each device instance will provide independent access to all records.

       The  audit  pipe device provides discrete BSM audit records; if the read buffer passed by the application
       is too small to hold the next record in the sequence, it will be dropped.  Unlike audit data  written  to
       the audit trail, the reliability of record delivery is not guaranteed.  In particular, when an audit pipe
       queue  fills,  records  will  be  dropped.   Audit pipe devices are blocking by default, but support non-
       blocking I/O, asynchronous I/O using SIGIO, and polled operation via <u><a href="../man2/select.2.html">select</a></u>(2) and <u><a href="../man2/poll.2.html">poll</a></u>(2).

       Applications may choose to track the global audit  trail,  or  configure  local  preselection  parameters
       independent of the global audit trail parameters.

   <b>Audit</b> <b>Pipe</b> <b>Queue</b> <b>Ioctls</b>
       The following ioctls retrieve and set various audit pipe record queue properties:

       AUDITPIPE_GET_QLEN          Query the current number of records available for reading on the pipe.

       AUDITPIPE_GET_QLIMIT        Retrieve the current maximum number of records that may be queued for reading
                                   on the pipe.

       AUDITPIPE_SET_QLIMIT        Set  the  current maximum number of records that may be queued for reading on
                                   the pipe.  The new limit must fall between the queue limit minimum and  queue
                                   limit maximum queryable using the following two ioctls.

       AUDITPIPE_GET_QLIMIT_MIN    Query  the  lowest  possible maximum number of records that may be queued for
                                   reading on the pipe.

       AUDITPIPE_GET_QLIMIT_MAX    Query the highest possible maximum number of records that may be  queued  for
                                   reading on the pipe.

       AUDITPIPE_FLUSH             Flush all outstanding records on the audit pipe; useful after setting initial
                                   preselection  properties  to  delete  records queued during the configuration
                                   process which may not match the interests of the user process.

       AUDITPIPE_GET_MAXAUDITDATA  Query the maximum size of an audit record, which is a useful minimum size for
                                   a user space buffer intended to hold audit records read from the audit pipe.

   <b>Audit</b> <b>Pipe</b> <b>Preselection</b> <b>Mode</b> <b>Ioctls</b>
       By default, the audit pipe facility configures pipes to present records matched by the system-wide  audit
       trail,  configured  by  <u><a href="../man8/auditd.8.html">auditd</a></u>(8).  However, the preselection mechanism for audit pipes can be configured
       using alternative criteria, including pipe-local flags and naflags settings,  as  well  as  auid-specific
       selection  masks.   This  allows  applications to track events not captured in the global audit trail, as
       well as limit records presented to those of specific interest to the application.

       The following ioctls configure the preselection mode on an audit pipe:

       AUDITPIPE_GET_PRESELECT_MODE  Return the current preselect mode on the audit pipe.   The  ioctl  argument
                                     should be of type <u>int</u>.

       AUDITPIPE_SET_PRESELECT_MODE  Set  the  current  preselection mode on the audit pipe.  The ioctl argument
                                     should be of type <u>int</u>.

       Possible preselection mode values are:

       AUDITPIPE_PRESELECT_MODE_TRAIL  Use the global audit trail preselection parameters to select records  for
                                       the audit pipe.

       AUDITPIPE_PRESELECT_MODE_LOCAL  Use  local  audit  pipe preselection; this model is similar to the global
                                       audit trail configuration model, consisting of global flags  and  naflags
                                       parameters,  as  well  as  a set of per-auid masks.  These parameters are
                                       configured using further ioctls.

       After  changing  the  audit  pipe  preselection  mode,  records  selected  under   earlier   preselection
       configuration  may  still be in the audit pipe queue.  The application may flush the current record queue
       after changing the configuration to remove possibly undesired records.

   <b>Audit</b> <b>Pipe</b> <b>Local</b> <b>Preselection</b> <b>Mode</b> <b>Ioctls</b>
       The following ioctls configure the preselection parameters used when an audit pipe is configured for  the
       AUDITPIPE_PRESELECT_MODE_LOCAL preselection mode.

       AUDITPIPE_GET_PRESELECT_FLAGS    Retrieve  the current default preselection flags for attributable events
                                        on  the  pipe.   These  flags  correspond  to   the   <u>flags</u>   field   in
                                        <u><a href="../man5/audit_control.5.html">audit_control</a></u>(5).  The ioctl argument should be of type <u>au_mask_t</u>.

       AUDITPIPE_SET_PRESELECT_FLAGS    Set  the  current  default preselection flags for attributable events on
                                        the  pipe.    These   flags   correspond   to   the   <u>flags</u>   field   in
                                        <u><a href="../man5/audit_control.5.html">audit_control</a></u>(5).  The ioctl argument should be of type <u>au_mask_t</u>.

       AUDITPIPE_GET_PRESELECT_NAFLAGS  Retrieve  the  current  default  preselection flags for non-attributable
                                        events on the pipe.  These flags correspond  to  the  <u>naflags</u>  field  in
                                        <u><a href="../man5/audit_control.5.html">audit_control</a></u>(5).  The ioctl argument should be of type <u>au_mask_t</u>.

       AUDITPIPE_SET_PRESELECT_NAFLAGS  Set  the  current default preselection flags for non-attributable events
                                        on  the  pipe.   These  flags  correspond  to  the  <u>naflags</u>   field   in
                                        <u><a href="../man5/audit_control.5.html">audit_control</a></u>(5).  The ioctl argument should be of type <u>au_mask_t</u>.

       AUDITPIPE_GET_PRESELECT_AUID     Query  the  current  preselection masks for a specific auid on the pipe.
                                        The ioctl argument should be of type  <u>struct</u>  <u>auditpipe_ioctl_preselect</u>.
                                        The  auid  to  query is specified via the <u>ap_auid</u> field of type <u>au_id_t</u>;
                                        the mask will be returned via <u>ap_mask</u> of type <u>au_mask_t</u>.

       AUDITPIPE_SET_PRESELECT_AUID     Set the current preselection masks for a  specific  auid  on  the  pipe.
                                        Arguments are identical to AUDITPIPE_GET_PRESELECT_AUID, except that the
                                        caller  should properly initialize the <u>ap_mask</u> field to hold the desired
                                        preselection mask.

       AUDITPIPE_DELETE_PRESELECT_AUID  Delete the current preselection mask for a specific auid  on  the  pipe.
                                        Once  called,  events  associated  with  the specified auid will use the
                                        default flags mask.  The ioctl argument should be of type <u>au_id_t</u>.

       AUDITPIPE_FLUSH_PRESELECT_AUID   Delete all auid specific preselection specifications.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The <u><a href="../man1/praudit.1.html">praudit</a></u>(1) utility may be directly executed on <u>/dev/auditpipe</u> to review the default audit trail.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man2/poll.2.html">poll</a></u>(2), <u><a href="../man2/select.2.html">select</a></u>(2), <u><a href="../man4/audit.4.html">audit</a></u>(4), <u><a href="../man4/dtaudit.4.html">dtaudit</a></u>(4), <u><a href="../man5/audit_control.5.html">audit_control</a></u>(5), <u><a href="../man8/audit.8.html">audit</a></u>(8), <u><a href="../man8/auditd.8.html">auditd</a></u>(8)

</pre><h4><b>HISTORY</b></h4><pre>
       The OpenBSM implementation was created by McAfee Research, the security division of  McAfee  Inc.,  under
       contract  to  Apple  Computer Inc. in 2004.  It was subsequently adopted by the TrustedBSD Project as the
       foundation for the OpenBSM distribution.

       Support for kernel audit first appeared in FreeBSD 6.2.

</pre><h4><b>AUTHORS</b></h4><pre>
       The audit pipe facility was designed and implemented by Robert Watson &lt;<u><a href="mailto:rwatson@FreeBSD.org">rwatson@FreeBSD.org</a></u>&gt;.

       The Basic Security Module (BSM) interface to audit records and audit event stream format were defined  by
       Sun Microsystems.

</pre><h4><b>BUGS</b></h4><pre>
       See the <u><a href="../man4/audit.4.html">audit</a></u>(4) manual page for information on audit-related bugs and limitations.

       The  configurable  preselection mechanism mirrors the selection model present for the global audit trail.
       It might be desirable to provide a more flexible selection model.

       The per-pipe audit event queue is fifo, with drops occurring  if  either  the  user  thread  provides  in
       sufficient  for  the  record on the queue head, or on enqueue if there is insufficient room.  It might be
       desirable to support partial reads of records, which would  be  more  compatible  with  buffered  I/O  as
       implemented  in system libraries, and to allow applications to select which records are dropped, possibly
       in the style of preselection.

Debian                                           April 28, 2019                                     <u><a href="../man4/AUDITPIPE.4.html">AUDITPIPE</a></u>(4)
</pre>
 </div>
</div></section>
</div>
</body>
</html>