<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>public-inbox-v1-format - git repository and tree description (aka "ssoma")</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/public-inbox">public-inbox_1.9.0-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       public-inbox-v1-format - git repository and tree description (aka "ssoma")

</pre><h4><b>DESCRIPTION</b></h4><pre>
       WARNING: this does NOT describe the scalable v2 format used by public-inbox.  Use of ssoma is not
       recommended for new installations due to scalability problems.

       ssoma uses a git repository to store each email as a git blob.  The tree filename of the blob is based on
       the SHA1 hexdigest of the first Message-ID header.  A commit is made for each message delivered.  The
       commit SHA-1 identifier is used by ssoma clients to track synchronization state.

</pre><h4><b>PATHNAMES</b> <b>IN</b> <b>TREES</b></h4><pre>
       A Message-ID may be extremely long and also contain slashes, so using them as a path name is challenging.
       Instead we use the SHA-1 hexdigest of the Message-ID (excluding the leading "&lt;" and trailing "&gt;") to
       generate a path name.  Leading and trailing white space in the Message-ID header is ignored for hashing.

       A message with Message-ID of: &lt;<a href="mailto:20131106023245.GA20224@dcvr.yhbt.net">20131106023245.GA20224@dcvr.yhbt.net</a>&gt;

       Would be stored as: f2/8c6cfd2b0a65f994c3e1be266105413b3d3f63

       Thus it is easy to look up the contents of a message matching a given a Message-ID.

</pre><h4><b>MESSAGE-ID</b> <b>CONFLICTS</b></h4><pre>
       public-inbox v1 repositories currently do not resolve conflicting Message-IDs or messages with multiple
       Message-IDs.

</pre><h4><b>HEADERS</b></h4><pre>
       The Message-ID header is required.  "Bytes", "Lines" and "Content-Length" headers are stripped and not
       allowed, they can interfere with further processing.  When using ssoma with public-inbox-mda, the
       "Status" mbox header is also stripped as that header makes no sense in a public archive.

</pre><h4><b>LOCKING</b></h4><pre>
       <b><a href="../man2/flock.2.html">flock</a></b>(2) locking exclusively locks the empty $GIT_DIR/ssoma.lock file for all non-atomic operations.

</pre><h4><b>EXAMPLE</b> <b>INPUT</b> <b>FLOW</b> <b>(SERVER-SIDE</b> <b>MDA)</b></h4><pre>
       1. Message is delivered to a mail transport agent (MTA)

       1a. (optional) reject/discard spam, this should run before ssoma-mda

       1b. (optional) reject/strip unwanted attachments

       ssoma-mda handles all steps once invoked.

       2. Mail transport agent invokes ssoma-mda

       3. reads message via stdin, extracting Message-ID

       4. acquires exclusive flock lock on $GIT_DIR/ssoma.lock

       5. creates or updates the blob of associated 2/38 SHA-1 path

       6. updates the index and commits

       7. releases $GIT_DIR/ssoma.lock

       ssoma-mda can also be used as an <b><a href="../man7/inotify.7.html">inotify</a></b>(7) trigger to monitor maildirs, and the ability to monitor IMAP
       mailboxes using IDLE will be available in the future.

</pre><h4><b>GIT</b> <b>REPOSITORIES</b> <b>(SERVERS)</b></h4><pre>
       ssoma uses bare git repositories on both servers and clients.

       Using the <b><a href="../man1/git-init.1.html">git-init</a></b>(1) command with --bare is the recommend method of creating a git repository on a
       server:

               git init --bare /path/to/wherever/you/want.git

       There are no standardized paths for servers, administrators make all the choices regarding git repository
       locations.

       Special files in $GIT_DIR on the server:

       $GIT_DIR/ssoma.lock
           An  empty  file  for <b><a href="../man2/flock.2.html">flock</a></b>(2) locking.  This is necessary to ensure the index and commits are updated
           consistently and multiple processes running MDA do not step on each other.

       $GIT_DIR/public-inbox/msgmap.sqlite3
           SQLite3 database maintaining a stable mapping of  Message-IDs  to  NNTP  article  numbers.   Used  by
           <b><a href="../man1/public-inbox-nntpd.1.html">public-inbox-nntpd</a></b>(1) and created and updated by <b><a href="../man1/public-inbox-index.1.html">public-inbox-index</a></b>(1).

           Users  of  the PublicInbox::WWW interface will find it useful for attempting recovery from copy-paste
           truncations of URLs containing long Message-IDs.

           Automatically updated by <b><a href="../man1/public-inbox-mda.1.html">public-inbox-mda</a></b>(1), <b><a href="../man1/public-inbox-learn.1.html">public-inbox-learn</a></b>(1) and <b><a href="../man1/public-inbox-watch.1.html">public-inbox-watch</a></b>(1).

           Losing or damaging this file will cause synchronization problems for  NNTP  clients.   This  file  is
           expected to be stable and require no updates to its schema.

           Requires DBD::SQLite.

       $GIT_DIR/public-inbox/xapian$N/
           Xapian database for search indices in the PSGI web UI.

           $N  is the value of PublicInbox::Search::SCHEMA_VERSION, and installations may have parallel versions
           on disk during upgrades or to roll-back upgrades.

           This is created and updated by <b><a href="../man1/public-inbox-index.1.html">public-inbox-index</a></b>(1).

           Automatically updated by <b><a href="../man1/public-inbox-mda.1.html">public-inbox-mda</a></b>(1), <b><a href="../man1/public-inbox-learn.1.html">public-inbox-learn</a></b>(1) and <b><a href="../man1/public-inbox-watch.1.html">public-inbox-watch</a></b>(1).

           This directory can always be regenerated with <b><a href="../man1/public-inbox-index.1.html">public-inbox-index</a></b>(1).  If lost or damaged, there is no
           need to back it up unless the CPU/memory cost of regenerating it outweighs the storage/transfer cost.

           Since SCHEMA_VERSION 15 and the development of the v2 format, the "overview" DB also  exists  in  the
           xapian directory for v1 repositories.  See "OVERVIEW DB" in <b><a href="../man5/public-inbox-v2-format.5.html">public-inbox-v2-format</a></b>(5)

           Our   use   of   the   "OVERVIEW   DB"   requires  Xapian  document  IDs  to  remain  stable.   Using
           <b><a href="../man1/public-inbox-compact.1.html">public-inbox-compact</a></b>(1) and <b><a href="../man1/public-inbox-xcpdb.1.html">public-inbox-xcpdb</a></b>(1) wrappers are recommended  over  tools  provided  by
           Xapian.

           This  directory  is  large,  often  two to three times the size of the objects stored in a packed git
           repository.

       $GIT_DIR/ssoma.index
           This file is no longer used or created by public-inbox, but it is updated  if  it  exists  to  remain
           compatible with ssoma installations.

           A  git  index file used for MDA updates.  The normal git index (in $GIT_DIR/index) is not used at all
           as there is typically no working tree.

       Each client $GIT_DIR may have multiple mbox/maildir/command targets.  It is  possible  for  a  client  to
       extract  the  mail  stored  in  the git repository to multiple mboxes for compatibility with a variety of
       different tools.

</pre><h4><b>CAVEATS</b></h4><pre>
       It is NOT recommended to check out the working directory of a git.  there may be many files.

       It is impossible to completely expunge messages, even spam, as git retains full  history.   Projects  may
       (with  adequate notice) cycle to new repositories/branches with history cleaned up via <b><a href="../man1/git-filter-repo.1.html">git-filter-repo</a></b>(1)
       or <b><a href="../man1/git-filter-branch.1.html">git-filter-branch</a></b>(1).  This is up to the administrators.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2013-2021 all contributors &lt;<a href="mailto:meta@public-inbox.org">mailto:meta@public-inbox.org</a>&gt;

       License: AGPL-3.0+ &lt;<a href="http://www.gnu.org/licenses/agpl-3.0.txt">http://www.gnu.org/licenses/agpl-3.0.txt</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/gitrepository-layout.5.html">gitrepository-layout</a></b>(5), <b><a href="../man1/ssoma.1.html">ssoma</a></b>(1)

public-inbox.git                                   1993-10-02                          <u><a href="../man5/PUBLIC-INBOX-V1-FORMAT.5.html">PUBLIC-INBOX-V1-FORMAT</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>