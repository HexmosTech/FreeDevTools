<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>public-inbox-extindex-format - external index format description</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/public-inbox">public-inbox_1.9.0-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       public-inbox-extindex-format - external index format description

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The extindex is an index-only evolution of the per-inbox SQLite and Xapian indices used by
       <b><a href="../man5/public-inbox-v2-format.5.html">public-inbox-v2-format</a></b>(5) and <b><a href="../man5/public-inbox-v1-format.5.html">public-inbox-v1-format</a></b>(5).  It exists to facilitate searches across
       multiple inboxes as well as to reduce index space when messages are cross-posted to several existing
       inboxes.

       It transparently indexes messages across any combination of v1 and v2 inboxes and data about inboxes
       themselves.

</pre><h4><b>DIRECTORY</b> <b>LAYOUT</b></h4><pre>
       While inspired by v2, there is no git blob storage nor "msgmap.sqlite3" DB.

       Instead, there is an "ALL.git" (all caps) git repo which treats every indexed v1 inbox or v2 epoch as a
       git alternate.

       As with v2 inboxes, it uses "over.sqlite3" and Xapian "shards" for WWW and IMAP use.  Several exclusive
       new tables are added to deal with "XREF3 DEDUPLICATION" and metadata.

       Unlike v1 and v2 inboxes, it is NOT designed to map to a NNTP newsgroup.  Thus it lacks "msgmap.sqlite3"
       to enforce the unique Message-ID requirement of NNTP.

   <b>INDEX</b> <b>OVERVIEW</b> <b>AND</b> <b>DEFINITIONS</b>
         $SCHEMA_VERSION - DB schema version (for Xapian)
         $SHARD - Integer starting with 0 based on parallelism

         foo/                              # "foo" is the name of the index
         - ei.lock                         # lock file to protect global state
         - ALL.git                         # empty, alternates for inboxes
         - ei$SCHEMA_VERSION/$SHARD        # per-shard Xapian DB
         - ei$SCHEMA_VERSION/over.sqlite3  # overview DB for WWW, IMAP
         - ei$SCHEMA_VERSION/misc          # misc Xapian DB

       File and directory names are intentionally different from analogous v2 names to ensure extindex and v2
       inboxes can easily be distinguished from each other.

   <b>XREF3</b> <b>DEDUPLICATION</b>
       Due to cross-posted messages being the norm in the large Linux kernel development community and Xapian
       indices being the primary consumer of storage, it makes sense to deduplicate indexing as much as
       possible.

       The internal storage format is based on the NNTP "Xref" tuple, but with the addition of a third element:
       the git blob OID.  Thus the triple is expressed in string form as:

               $NEWSGROUP_NAME:$ARTICLE_NUM:$OID

       If no "newsgroup" is configured for an inbox, the "inboxdir" of the inbox is used.

       This data is stored in the "xref3" table of over.sqlite3.

   <b>misc</b> <b>XAPIAN</b> <b>DB</b>
       In addition to the numeric Xapian shards for indexing messages, there is a new, in-development Xapian
       index for storing data about inboxes themselves and other non-message data.  This index allows us to
       speed up operations involving hundreds or thousands of inboxes.

</pre><h4><b>BENEFITS</b></h4><pre>
       In addition to providing cross-inbox search capabilities, it can also replace per-inbox Xapian shards
       (but not per-inbox over.sqlite3).  This allows reduction in disk space, open file handles, and associated
       memory use.

</pre><h4><b>CAVEATS</b></h4><pre>
       Relocating v1 and v2 inboxes on the filesystem will require extindex to be garbage-collected and/or
       reindexed.

       Configuring and maintaining stable "newsgroup" names before any messages are indexed from every inbox can
       avoid expensive reindexing and rely exclusively on GC.

</pre><h4><b>LOCKING</b></h4><pre>
       <b><a href="../man2/flock.2.html">flock</a></b>(2) locking exclusively locks the empty ei.lock file for all non-atomic operations.

</pre><h4><b>THANKS</b></h4><pre>
       Thanks to the Linux Foundation for sponsoring the development and testing.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2020-2021 all contributors &lt;<a href="mailto:meta@public-inbox.org">mailto:meta@public-inbox.org</a>&gt;

       License: AGPL-3.0+ &lt;<a href="http://www.gnu.org/licenses/agpl-3.0.txt">http://www.gnu.org/licenses/agpl-3.0.txt</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/public-inbox-v2-format.5.html">public-inbox-v2-format</a></b>(5)

public-inbox.git                                   1993-10-02                    <u><a href="../man5/PUBLIC-INBOX-EXTINDEX-FORMAT.5.html">PUBLIC-INBOX-EXTINDEX-FORMAT</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>