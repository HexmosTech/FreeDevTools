<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lei-store-format - lei/store format description</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/lei">lei_1.9.0-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       lei-store-format - lei/store format description

</pre><h4><b>DESCRIPTION</b></h4><pre>
       "lei/store" is a hybrid store based on <b><a href="../man5/public-inbox-extindex-format.5.html">public-inbox-extindex-format</a></b>(5) ("extindex") combined with
       <b><a href="../man5/public-inbox-v2-format.5.html">public-inbox-v2-format</a></b>(5) ("v2") for blob storage.  While v2 is ideal for archiving a single public
       mailing list; it was never intended for personal mail nor storing multiple blobs of the "same" message.

       As with extindex, it can index disparate "List-Id" headers belonging to the "same" message with different
       git blob OIDs.  Unlike v2 and extindex, "Message-ID" headers are NOT required; allowing unsent draft
       messages to be stored and indexed.

</pre><h4><b>DIRECTORY</b> <b>LAYOUT</b></h4><pre>
       Blob storage exists in the form of v2-style epochs.  These epochs are under the "local/" directory
       (instead of "git/") to prevent them from being accidentally treated as a v2 inbox.

   <b>INDEX</b> <b>OVERVIEW</b> <b>AND</b> <b>DEFINITIONS</b>
         $EPOCH - Integer starting with 0 based on time
         $SCHEMA_VERSION - DB schema version (for Xapian)
         $SHARD - Integer starting with 0 based on parallelism

         <a href="file:~/.local/share/lei/store">~/.local/share/lei/store</a>
         - local/$EPOCH.git                # normal bare git repositories
         - mail_sync.sqlite3               # sync state IMAP, Maildir, NNTP

       Additionally, the following share the same roles they do in extindex:

         - ei.lock                         # lock file to protect global state
         - ALL.git                         # empty, alternates for local/*.git
         - ei$SCHEMA_VERSION/$SHARD        # per-shard Xapian DB
         - ei$SCHEMA_VERSION/over.sqlite3  # overview DB for WWW, IMAP
         - ei$SCHEMA_VERSION/misc          # misc Xapian DB

   <b>XREF3</b> <b>DEDUPLICATION</b>
       Index deduplication follows extindex, see "XREF3 DEDUPLICATION" in <b><a href="../man5/public-inbox-extindex-format.5.html">public-inbox-extindex-format</a></b>(5) for
       more information.

   <b>BLOB</b> <b>DEDUPLICATION</b>
       The contents of "local/*.git" repos is deduplicated by git blob object IDs (currently SHA-1).  This
       allows multiple copies of cross-posted and personally Cc-ed messages to be stored with different
       "Received:", "X-Spam-Status:" and similar headers to allow troubleshooting.

   <b>VOLATILE</b> <b>METADATA</b>
       Keywords and label information (as described in RFC 8621 for JMAP) is stored in existing Xapian shards
       ("ei$SCHEMA_VERSION/$SHARD").  It is possible to search for messages matching labels and keywords using
       "L:" and "kw:", respectively.  As with all data stored in Xapian indices, volatile metadata is associated
       with the Xapian document, thus it is shared across different blobs of the "same" message.

   <b>mail_sync.sqlite3</b>
       This SQLite database maintained for bidirectional mapping of git blobs to IMAP UIDs, Maildir file names,
       and NNTP article numbers.

       It is also used for retrieving messages from Maildirs indexed by <b><a href="../man1/lei-index.1.html">lei-index</a></b>(1).

</pre><h4><b>IPC</b></h4><pre>
       <b><a href="../man8/lei-daemon.8.html">lei-daemon</a></b>(8) communicates with the "lei/store" process using <b><a href="../man7/unix.7.html">unix</a></b>(7) "SOCK_SEQPACKET" sockets.

</pre><h4><b>CAVEATS</b></h4><pre>
       Reindexing and synchronization is not yet supported.

</pre><h4><b>THANKS</b></h4><pre>
       Thanks to the Linux Foundation for sponsoring the development and testing.

</pre><h4><b>COPYRIGHT</b></h4><pre>
       Copyright 2021 all contributors &lt;<a href="mailto:meta@public-inbox.org">mailto:meta@public-inbox.org</a>&gt;

       License: AGPL-3.0+ &lt;<a href="http://www.gnu.org/licenses/agpl-3.0.txt">http://www.gnu.org/licenses/agpl-3.0.txt</a>&gt;

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/public-inbox-v2-format.5.html">public-inbox-v2-format</a></b>(5), <b><a href="../man5/public-inbox-extindex.5.html">public-inbox-extindex</a></b>(5)

public-inbox.git                                   1993-10-02                                <u><a href="../man5/LEI-STORE-FORMAT.5.html">LEI-STORE-FORMAT</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>