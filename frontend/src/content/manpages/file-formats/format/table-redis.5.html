<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>table_redis — format description for smtpd redis tables</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/opensmtpd-table-redis">opensmtpd-table-redis_1.0.1-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       table_redis — format description for smtpd redis tables

</pre><h4><b>DESCRIPTION</b></h4><pre>
       This manual page documents the file format of redis tables used by the <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8) mail daemon.

       The format described here applies to tables as defined in <u><a href="../man5/smtpd.conf.5.html">smtpd.conf</a></u>(5).

</pre><h4><b>REDIS</b> <b>TABLE</b></h4><pre>
       A Redis table allows the storing of usernames, passwords, aliases, and domains in a redis server.

       The  table  is  used by <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8) when authenticating a user, when user information such as user-id and/or
       home directory is required for a delivery, when a domain lookup may be required, and/or when looking  for
       an alias.

       A Redis table consists of one Redis Databases with one or more keys.

       If  the  table  is used for authentication, the password should be encrypted using the <u><a href="../man3/crypt.3.html">crypt</a></u>(3) function.
       Such passwords can be generated using the <u><a href="../man1/encrypt.1.html">encrypt</a></u>(1) utility or <u><a href="../man8/smtpctl.8.html">smtpctl</a></u>(8) encrypt command.

</pre><h4><b>REDIS</b> <b>TABLE</b> <b>CONFIG</b> <b>FILE</b></h4><pre>
       <b>master</b>             This is the IP of the master  redis  server.   To  connect  via  an  unix  socket  use
                          unix:/path/to/sock The default is 127.0.0.1

       <b>master_port</b>        This is the port used to connect to the master redis server.  The default is 6379

       <b>slave</b>              This  is  the IP of the slave redis server, if any.  To connect via an unix socket use
                          unix:/path/to/sock

       <b>slave_port</b>         This is the port used to connect to the slave redis server if any.

       <b>database</b>           The database number to use.  The default is 0.

       <b>password</b>           The password to use to authenticate to the redis server if any.

       <b>query_domain</b>       This is used to provide a query for a domain query call.  All the  '%s'  are  replaced
                          with  the  appropriate  data, in this case it would be the right hand side of the SMTP
                          address.  This expects one string to be returned with a matching domain name.

       <b>query_userinfo</b>     This is used to provide a query for looking up user information.   All  the  '%s'  are
                          replaced with the appropriate data, in this case it would be the left hand side of the
                          SMTP  address.   This  expects three fields to be returned an int containing a UID, an
                          int containing a GID and a string containing the home directory for the user.

       <b>query_credentials</b>  This is used to provide a query for looking up credentials.  All the '%s' are replaced
                          with the appropriate data, in this case it would be the left hand  side  of  the  SMTP
                          address.   the  query expects that there are two strings returned one with a user name
                          one with a password in encrypted format.

       <b>query_alias</b>        This is used to provide a query to look up aliases.  All the '%s'  are  replaced  with
                          the appropriate data, in this case it would be the left hand side of the SMTP address.
                          This  expects  one string to be returned with the user name the alias resolves to.  If
                          the query returns an array, all the data will be concatenated into one string with ','
                          as a separator

       <b>query_mailaddr</b>     This is used to provide a query to check if a mail address exists.  All the  '%s'  are
                          replaced  with  the appropriate data, in this case it would be the SMTP address.  This
                          expects an integer as a reply, 0 = false and 1 = true

</pre><h4><b>EXAMPLES</b></h4><pre>
       Due to the nature of redis, multiple schemas can be used.  Those provided here a known to work.

       <b>domain</b>
         Using a set for the domains:
               <b>#</b> <b>redis-cli</b> <b>sadd</b> <b>domains</b> <b>example.net</b>
         in the redis table configuration file:
               <b>query_domain</b> <b>SISMEMBER</b> <b>domains</b> <b>%s</b>

       <b>userinfo</b>
         Hash works well for users
               <b>#</b> <b>redis-cli</b> <b>HSET</b> <b>user:foo</b> <b>uid</b> <b>1001</b>
               <b>#</b> <b>redis-cli</b> <b>HSET</b> <b>user:foo</b> <b>gid</b> <b>1001</b>
               <b>#</b> <b>redis-cli</b> <b>HSET</b> <b>user:foo</b> <b>maildir</b> <b>/mail/foo</b>
         in the redis table configuration file :
               <b>query_userinfo</b> <b>HMGET</b> <b>user:%s</b> <b>uid</b> <b>gid</b> <b>maildir</b>

       <b>credentials</b>
         We can extend the hash for our user to put credential in it
               <b>#</b> <b>redis-cli</b> <b>HSET</b> <b>user:foo</b> <b>login</b> <b>foo</b>
               <b>#</b> <b>redis-cli</b> <b>HSET</b> <b>user:foo</b> <b>passwd</b> <b>encrypted_password</b>
         in the redis table configuration file:
               <b>query_credentials</b> <b>HMGET</b> <b>user:%s</b> <b>login</b> <b>passwd</b>

       <b>alias</b>
         Using redis sorted list:
               <b>#</b> <b>redis-cli</b> <b>LPUSH</b> <b>aliases:<a href="mailto:foo@example.net">foo@example.net</a></b> <b>foo</b>
               <b>#</b> <b>redis-cli</b> <b>LPUSH</b> <b>aliases:<a href="mailto:bar@example.net">bar@example.net</a></b> <b>foo</b>
         in the redis table configuration file:
               <b>query_alias</b> <b>LRANGE</b> <b>aliases:%s</b> <b>0</b> <b>-1</b>

       <b>mailaddr</b>
         Using a set for the addresses:
               <b>#</b> <b>redis-cli</b> <b>sadd</b> <b>mailaddr</b> <b><a href="mailto:foo@example.net">foo@example.net</a></b>
         in the redis table configuration file:
               <b>query_mailaddr</b> <b>SISMEMBER</b> <b>mailaddr</b> <b>%s</b>

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man1/encrypt.1.html">encrypt</a></u>(1), <u><a href="../man5/smtpd.conf.5.html">smtpd.conf</a></u>(5), <u><a href="../man8/smtpctl.8.html">smtpctl</a></u>(8), <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8)

</pre><h4><b>HISTORY</b></h4><pre>
       The first version of <b>table_redis</b> was written in 2015.  It was converted to the stdio protocol in 2024.

</pre><h4><b>AUTHORS</b></h4><pre>
       <b>table_redis</b> was initially written by Emmanuel Vadot &lt;<u><a href="mailto:elbarto@bocal.org">elbarto@bocal.org</a></u>&gt;.  The  conversion  to  the  stdio
       table protocol was done by Omar Polo &lt;<u><a href="mailto:op@openbsd.org">op@openbsd.org</a></u>&gt;.

Debian                                           April 21, 2024                                   <u><a href="../man5/TABLE_REDIS.5.html">TABLE_REDIS</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>