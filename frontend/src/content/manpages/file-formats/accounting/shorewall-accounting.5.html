<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>accounting - Shorewall Accounting file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/shorewall">shorewall_5.2.8-6_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       accounting - Shorewall Accounting file

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <b>/etc/shorewall[6]/accounting</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       Accounting rules exist simply to count packets and bytes in categories that you define in this file. You
       may display these rules and their packet and byte counters using the <b>shorewall</b> <b>show</b> <b>accounting</b> command.

       Beginning with Shorewall 4.4.18, the accounting structure can be created with three root chains:

       •   <b>accountin</b>: Rules that are valid in the <b>INPUT</b> chain (may not specify an output interface).

       •   <b>accountout</b>: Rules that are valid in the OUTPUT chain (may not specify an input interface or a MAC
           address).

       •   <b>accounting</b>: Other rules.

       The new structure is enabled by sectioning the accounting file in a manner similar to the <b>rules</b> <b>file</b>[1].
       The sections are <b>INPUT</b>, <b>OUTPUT</b> and <b>FORWARD</b> and must appear in that order (although any of them may be
       omitted). The first non-commentary record in the accounting file must be a section header when sectioning
       is used.

           <b>Warning</b>

           If sections are not used, the Shorewall rules compiler cannot detect certain violations of netfilter
           restrictions. These violations can result in run-time errors such as the following:

           <b>iptables-restore</b> <b>v1.4.13:</b> <b>Can't</b> <b>use</b> <b>-o</b> <b>with</b> <b>INPUT</b>

       Beginning with Shorewall 4.4.20, the ACCOUNTING_TABLE setting was added to shorewall.conf and
       shorewall6.conf. That setting determines the Netfilter table (filter or mangle) where the accounting
       rules are added. When ACCOUNTING_TABLE=mangle is specified, the available sections are <b>PREROUTING</b>, <b>INPUT</b>,
       <b>OUTPUT</b>, <b>FORWARD</b> and <b>POSTROUTING</b>.

       Section headers have the form:

       <b>?SECTION</b> <u>section-name</u>

       When sections are enabled:

       •   A jump to a user-defined accounting chain must appear before entries that add rules to that chain.
           This eliminates loops and unreferenced chains.

       •   An output interface may not be specified in the <b>PREROUTING</b> and <b>INPUT</b> sections.

       •   In the <b>OUTPUT</b> and <b>POSTROUTING</b> sections:

           •   An input interface may not be specified

           •   Jumps to a chain defined in the <b>INPUT</b> or <b>PREROUTING</b> sections that specifies an input interface
               are prohibited

           •   MAC addresses may not be used

           •   Jump to a chain defined in the <b>INPUT</b> or <b>PREROUTING</b> section that specifies a MAC address are
               prohibited.

       •   The default value of the CHAIN column is:

           •   <b>accountin</b> in the <b>INPUT</b> section

           •   <b>accountout</b> in the <b>OUTPUT</b> section

           •   <b>accountfwd</b> in the <b>FORWARD</b> section

           •   <b>accountpre</b> in the <b>PREROUTING</b> section

           •   <b>accountpost</b> in the <b>POSTROUTING</b> section

       •   Traffic addressed to the firewall goes through the rules defined in the INPUT section.

       •   Traffic originating on the firewall goes through the rules defined in the OUTPUT section.

       •   Traffic being forwarded through the firewall goes through the rules from the FORWARD sections.

       The columns in the file are as follows (where the column name is followed by a different name in
       parentheses, the different name is used in the alternate specification syntax):

       <b>ACTION</b> - {<b>COUNT</b>|<b>DONE</b>|<u>chain</u>[:<b>{COUNT</b>|JUMP}]|ACCOUNT(<u>table</u>,<u>network</u>)|[?]COMMENT <u>comment</u>}
           What to do when a matching packet is found.

           <b>COUNT</b>
               Simply count the match and continue with the next rule

           <b>DONE</b>
               Count the match and don't attempt to match any other accounting rules in the chain specified in
               the <b>CHAIN</b> column.

           <u>chain</u>[<b>:COUNT</b>]
               Where <u>chain</u> is the name of a chain; shorewall will create the chain automatically if it doesn't
               already exist. If a second chain is mentioned in the CHAIN column, then a jump from this second
               chain to <u>chain</u> is created. If no chain is named in the CHAIN column, then a jump from the default
               chain to <u>chain</u> is created. If <b>:COUNT</b> is included, a counting rule matching this entry will be
               added to <u>chain</u>. The <u>chain</u> may not exceed 29 characters in length and may be composed of letters,
               digits, dash ('-') and underscore ('_').

           <u>chain</u>:JUMP
               Like the previous option without the <b>:COUNT</b> part.

           <b>ACCOUNT(</b><u>table</u>,<u>network</u><b>)</b>
               This action implements per-IP accounting and was added in Shorewall 4.4.17. Requires the <u>ACCOUNT</u>
               <u>Target</u> capability in your iptables and kernel (see the output of <b>shorewall</b> <b>show</b> <b>capabilities</b>).

               <u>table</u>
                   is the name of an accounting table (you choose the name). All rules specifying the same name
                   will have their per-IP counters accumulated in the same table.

               <u>network</u>
                   is an IPv4 <b>network</b> in CIDR notation (e.g., 192.168.1.0/24). The network can be as large as a
                   /8 (class A).

               One nice feature of per-IP accounting is that the counters survive <b>shorewall</b> <b>restart</b>. This has a
               downside, however. If you change the network associated with an accounting table, then you must
               <b>shorewall</b> <b>stop;</b> <b>shorewall</b> <b>start</b> to have a successful restart (counters will be cleared).

               The counters in a <u>table</u> are printed using the <b>iptaccount</b> utility. For a command synopsis, type:

               <b>iptaccount</b> <b>--help</b>

               As of February 2011, the ACCOUNT Target capability and the iptaccount utility are only available
               when <b>xtables-addons</b>[2] is installed. See <b>https://shorewall.org/Accounting.html#perIP</b>[3] for
               additional information.

           <b>INLINE</b>
               Added in Shorewall 4.5.16. Allows free form iptables matches to be specified following a ';'. In
               the generated iptables rule(s), the free form matches will follow any matches that are generated
               by the column contents.

           <b>NFACCT</b>({<u>object</u>[!]}[,...])
               Added in Shorewall 4.5.7. Provides a form of accounting that survives <b>shorewall</b> <b>stop/shorewall</b>
               start and <b>shorewall</b> <b>restart</b>. Requires the NFaccnt Match capability in your kernel and iptables.
               <u>object</u> names an nfacct object (see man <a href="../man8/nfaccnt.8.html">nfaccnt</a>(8)). Multiple rules can specify the same <u>object</u>;
               all packets that match any of the rules increment the packet and bytes count of the object.

               Prior to Shorewall 4.5.16, only one <u>object</u> could be specified. Beginning with Shorewall 4.5.16,
               an arbitrary number of objects may be given.

               With Shorewall 4.5.16 or later, an nfacct <u>object</u> in the list may optionally be followed by <b>!</b>  to
               indicate that the nfacct <u>object</u> will be incremented unconditionally for each packet. When <b>!</b>  is
               omitted, the <u>object</u> will be incremented only if all of the matches in the rule succeed.

           <b>NFLOG</b>[(nflog-parameters)] - Added in Shorewall-4.4.20.
               Causes each matching packet to be sent via the currently loaded logging back-end (usually
               nfnetlink_log) where it is available to accounting daemons through a netlink socket.

           <b>?COMMENT</b>
               The remainder of the line is treated as a comment which is attached to subsequent rules until
               another COMMENT line is found or until the end of the file is reached. To stop adding comments to
               rules, use a line with only the word ?COMMENT.

       <b>CHAIN</b> - {<b>-</b>|<u>chain</u>}
           The name of a <u>chain</u>. If specified as <b>-</b> the <b>accounting</b> chain is assumed when the file is un-sectioned.
           When the file is sectioned, the default is one of accountin, accountout, etc. depending on the
           section. This is the chain where the accounting rule is added. The <u>chain</u> will be created if it
           doesn't already exist. The <u>chain</u> may not exceed 29 characters in length.

       <b>SOURCE</b> - {<b>-</b>|<b>any</b>|<b>all</b>|<u>interface</u>|<u>interface</u><b>:</b><u>address</u>|<u>address</u>}
           Packet Source.

           The name of an <u>interface</u>, an <u>address</u> (host or net) or an <u>interface</u> name followed by ":" and a host or
           net <u>address</u>. An ipset name is also accepted as an <u>address</u>.

       <b>DEST</b> - {<b>-</b>|<b>any</b>|<b>all</b>|<u>interface</u>|<u>interface</u><b>:</b><u>address</u>|<u>address</u>}
           This column was formerly named DESTINATION.

           Packet Destination.

           Format same as <b>SOURCE</b> column.

       <b>PROTO</b> - {<b>-</b>|<b>{any</b>|<b>all</b>|<u>protocol-name</u>|<u>protocol-number</u>|<b>ipp2p</b>[<b>:</b>{<b>udp</b>|<b>all</b>}]}[,...]}
           This column was formerly named PROTOCOL

           A <u>protocol-name</u> (from <a href="../man5/protocols.5.html">protocols</a>(5)), a <u>protocol-number</u>, <b>ipp2p</b>, <b>ipp2p:udp</b> or <b>ipp2p:all</b>

           Beginning with Shorewall 4.5.12, this column can accept a comma-separated list of protocols.

       <b>DPORT</b> - {<b>-</b>|<b>any</b>|<b>all</b>|<u>ipp2p-option</u>|<u>port-name-or-number</u>[,<u>port-name-or-number</u>]...}
           Destination Port number. Service name from <a href="../man5/services.5.html">services</a>(5) or <u>port</u> <u>number</u>. May only be specified if the
           protocol is TCP (6), UDP (17), DCCP (33), SCTP (132) or UDPLITE (136).

           You may place a comma-separated list of port names or numbers in this column if your kernel and
           iptables include multi-port match support.

           If the PROTOCOL is <b>ipp2p</b> then this column must contain an <u>ipp2p-option</u> ("iptables -m ipp2p --help")
           without the leading "--". If no option is given in this column, <b>ipp2p</b> is assumed.

           This column was formerly named DEST PORT(S).

       <b>SPORT</b> - {<b>-</b>|<b>any</b>|<b>all</b>|<u>port-name-or-number</u>[,<u>port-name-or-number</u>]...}
           Service name from <a href="../man5/services.5.html">services</a>(5) or <u>port</u> <u>number</u>. May only be specified if the protocol is TCP (6), UDP
           (17), DCCP (33), SCTP (132) or UDPLITE (136).

           You may place a comma-separated list of port numbers in this column if your kernel and iptables
           include multi-port match support.

           Beginning with Shorewall 4.5.15, you may place '=' in this column, provided that the DEST PORT(S)
           column is non-empty. This causes the rule to match when either the source port or the destination
           port in a packet matches one of the ports specified in DPORT. Use of '=' requires multi-port match in
           your iptables and kernel.

           This column was formerly labelled SOURCE PORT(S).

       <b>USER</b> - [<b>!</b>][<u>user-name-or-number</u>][<b>:</b><u>group-name-or-number</u>][<b>+</b><u>program-name</u>]
           This column was formerly named USER/GROUP and may only be non-empty if the <b>CHAIN</b> is <b>OUTPUT</b>.

           When this column is non-empty, the rule applies only if the program generating the output is running
           under the effective <u>user</u> and/or <u>group</u> specified (or is NOT running under that id if "!" is given).

           Examples:

           joe
               program must be run by joe

           :kids
               program must be run by a member of the 'kids' group

           !:kids
               program must not be run by a member of the 'kids' group

           +upnpd
               #program named upnpd

                   <b>Important</b>
                   The ability to specify a program name was removed from Netfilter in kernel version 2.6.14.

       <b>MARK</b> - [<b>!</b>]<u>value</u>[/<u>mask</u>][<b>:C</b>]
           Defines a test on the existing packet or connection mark. The rule will match only if the test
           returns true.

           If you don't want to define a test but need to specify anything in the following columns, place a "-"
           in this field.

           !
               Inverts the test (not equal)

           <u>value</u>
               Value of the packet or connection mark.

           <u>mask</u>
               A mask to be applied to the mark before testing.

           <b>:C</b>
               Designates a connection mark. If omitted, the packet mark's value is tested.

       <b>IPSEC</b> <b>-</b> <u>option-list</u> <b>(Optional</b> <b>-</b> <b>Added</b> <b>in</b> <b>Shorewall</b> <b>4.4.13</b> <b>but</b> <b>broken</b> <b>until</b> <b>4.5.4.1</b> <b>)</b>
           The option-list consists of a comma-separated list of options from the following list. Only packets
           that will be encrypted or have been decrypted via an SA that matches these options will have their
           source address changed.

           <b>reqid=</b><u>number</u>
               where <u>number</u> is specified using <a href="../man8/setkey.8.html">setkey</a>(8) using the 'unique:<u>number</u> option for the SPD level.

           <b>spi=</b>&lt;number&gt;
               where <u>number</u> is the SPI of the SA used to encrypt/decrypt packets.

           <b>proto=ah</b>|<b>esp</b>|<b>ipcomp</b>
               IPSEC Encapsulation Protocol

           <b>mss=</b><u>number</u>
               sets the MSS field in TCP packets

           <b>mode=transport</b>|<b>tunnel</b>
               IPSEC mode

           <b>tunnel-src=</b><u>address</u>[/<u>mask</u>]
               only available with mode=tunnel

           <b>tunnel-dst=</b><u>address</u>[/<u>mask</u>]
               only available with mode=tunnel

           <b>strict</b>
               Means that packets must match all rules.

           <b>next</b>
               Separates rules; can only be used with strict

           <b>yes</b> or <b>ipsec</b>
               When used by itself, causes all traffic that will be encrypted/encapsulated or has been
               decrypted/un-encapsulated to match the rule.

           <b>no</b> or <b>none</b>
               When used by itself, causes all traffic that will not be encrypted/encapsulated or has been
               decrypted/un-encapsulated to match the rule.

           <b>in</b>
               May only be used in the FORWARD section and must be the first or the only item the list.
               Indicates that matching packets have been decrypted in input.

           <b>out</b>
               May only be used in the FORWARD section and must be the first or the only item in the list.
               Indicates that matching packets will be encrypted on output.

           If this column is non-empty and sections are not used, then:

           •   A chain NAME appearing in the ACTION column must be a chain branched either directly or
               indirectly from the <b>accipsecin</b> or <b>accipsecout</b> chain.

           •   The CHAIN column must contain either <b>accipsecin</b> or <b>accipsecout</b> or a chain branched either
               directly or indirectly from those chains.

           •   These rules will NOT appear in the <b>accounting</b> chain.

       In all of the above columns except <b>ACTION</b> and <b>CHAIN</b>, the values <b>-</b>, <b>any</b> and <b>all</b> may be used as
       wildcard'gs. Omitted trailing columns are also treated as wildcard'g.

</pre><h4><b>FILES</b></h4><pre>
       /etc/shorewall/accounting

       /etc/shorewall6/accounting

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b><a href="../man5/shorewall-logging.5.html">shorewall-logging</a>(5)</b>[4]

       <b>https://shorewall.org/configuration_file_basics.htm#Pairs</b>[5]

       <a href="../man8/shorewall.8.html">shorewall</a>(8)

</pre><h4><b>NOTES</b></h4><pre>
        1. rules file
           https://shorewall.org/manpages/shorewall-rules.html

        2. xtables-addons
           <a href="http://xtables-addons.sourceforge.net/">http://xtables-addons.sourceforge.net/</a>

        3. https://shorewall.org/Accounting.html#perIP
           https://shorewall.org/Accounting.html#perIP

        4. <a href="../man5/shorewall-logging.5.html">shorewall-logging</a>(5)
           https://shorewall.org/manpages/shorewall-logging.htm

        5. https://shorewall.org/configuration_file_basics.htm#Pairs
           https://shorewall.org/configuration_file_basics.htm#Pairs

Configuration Files                                09/24/2020                             <u><a href="../man5/SHOREWALL-ACCOUNTIN.5.html">SHOREWALL-ACCOUNTIN</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>