<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>containers-registries.conf - Syntax of System Registry Configuration File</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/golang-github-containers-image">golang-github-containers-image_5.34.2-1_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       containers-registries.conf - Syntax of System Registry Configuration File

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The  CONTAINERS-REGISTRIES  configuration  file  is  a system-wide configuration file for container image
       registries. The file format is TOML.

       Container engines will use the <b>$HOME/.config/containers/registries.conf</b> if it exists, otherwise they will
       use <b>/etc/containers/registries.conf</b>

   <b>GLOBAL</b> <b>SETTINGS</b>
       <b>unqualified-search-registries</b>
              An array of <u>host</u>[<b>:</b><u>port</u>] registries to try when pulling an unqualified image, in order.

       <b>credential-helpers</b>
              An array of default credential helpers used as external credential stores.  Note that "containers-
              auth.json" is a reserved value to use auth files as  specified  in  <a href="../man5/containers-auth.json.5.html">containers-auth.json</a>(5).   The
              credential helpers are set to <b>["containers-auth.json"]</b> if none are specified.

       <b>additional-layer-store-auth-helper</b>
              A  string  containing  the  helper  binary  name.  This enables passing registry credentials to an
              Additional Layer Store every time an image is read using the <b>docker://</b> transport so  that  it  can
              access  private  registries.  See  the  'Enabling  Additional  Layer  Store  to  access to private
              registries' section below for more details.

   <b>NAMESPACED</b> <b>[[registry]]</b> SETTINGS
       The bulk of the configuration is represented as an array of <b>[[registry]]</b> TOML tables;  the  settings  may
       therefore  differ  among different registries as well as among different namespaces/repositories within a
       registry.

   <b>Choosing</b> <b>a</b> <b>[[registry]]</b> TOML table
       Given an image name, a single <b>[[registry]]</b> TOML table is chosen based on its <b>prefix</b> field.

       <b>prefix</b>: A prefix of the user-specified image name, i.e. using one of the following formats:
         - <u>host</u>[<b>:</b><u>port</u>]
         - <u>host</u>[<b>:</b><u>port</u>]<b>/</b><u>namespace</u>[<b>/</b>_namespace_…]
         - <u>host</u>[<b>:</b><u>port</u>]<b>/</b><u>namespace</u>[<b>/</b>_namespace_…]<b>/</b><u>repo</u>
         - <u>host</u>[<b>:</b><u>port</u>]<b>/</b><u>namespace</u>[<b>/</b>_namespace_…]<b>/</b><u>repo</u>(<b>:</b>_tag|<b>@</b><u>digest</u>)
         - [<b>*.</b>]<u>host</u>

       The user-specified image name must start with the specified <b>prefix</b> (and  continue  with  the  appropriate
       separator)  for  a  particular  <b>[[registry]]</b>  TOML table to be considered; (only) the TOML table with the
       longest match is used. It can also include  wildcarded  subdomains  in  the  format  <b>*.example.com</b>.   The
       wildcard  should  only  be  present  at the beginning as shown in the formats above. Other cases will not
       work.   For   example,   <b>*.example.com</b>   is    valid    but    <b>example.*.com</b>,    <b>*.example.com/foo</b>    and
       <b>*.example.com:5000/foo/bar:baz</b>  are  not.   Note  that  <b>*</b>  matches  an  arbitrary  number  of subdomains.
       <b>*.example.com</b> will hence match <b>bar.example.com</b>, <b>foo.bar.example.com</b> and so on.

       As a special case, the <b>prefix</b> field can be missing; if so, it defaults to the value of the <b>location</b> field
       (described below).

   <b>Per-namespace</b> <b>settings</b>
       <b>insecure</b>
              <b>true</b> or <b>false</b>.  By default, container runtimes require TLS when retrieving images from a registry.
              If <b>insecure</b> is  set  to  <b>true</b>,  unencrypted  HTTP  as  well  as  TLS  connections  with  untrusted
              certificates are allowed.

       <b>blocked</b>
              <b>true</b> or <b>false</b>.  If <b>true</b>, pulling images with matching names is forbidden.

   <b>Remapping</b> <b>and</b> <b>mirroring</b> <b>registries</b>
       The  user-specified  image  reference  is,  primarily, a "logical" image name, always used for naming the
       image.  By default, the image reference also directly specifies the registry and repository to  use,  but
       the  following  options  can be used to redirect the underlying accesses to different registry servers or
       locations (e.g. to support configurations with no  access  to  the  internet  without  having  to  change
       <b>Dockerfile</b>s, or to add redundancy).

       <b>location</b>
              Accepts  the  same  format as the <b>prefix</b> field, and specifies the physical location of the <b>prefix</b>-
              rooted namespace.

       By default, this is equal to <b>prefix</b> (in which case <b>prefix</b> can be omitted and the <b>[[registry]]</b> TOML  table
       can only specify <b>location</b>).

       Example: Given

       prefix = "example.com/foo"
       location = "internal-registry-for-example.com/bar"

       requests  for the image <b>example.com/foo/myimage:latest</b> will actually work with the <b>internal-registry-for-</b>
       <b>example.com/bar/myimage:latest</b> image.

       With a <b>prefix</b> containing a wildcard in the format: "*.example.com" for subdomain matching,  the  location
       can  be  empty.  In  such  a  case,  prefix matching will occur, but no reference rewrite will occur. The
       original requested image string will be used as-is. But other settings like <b>insecure</b> / <b>blocked</b> /  <b>mirrors</b>
       will be applied to matching images.

       Example: Given

       prefix = "*.example.com"

       requests  for  the  image <b>blah.example.com/foo/myimage:latest</b> will be used as-is. But other settings like
       insecure/blocked/mirrors will be applied to matching images

       <b>mirror</b> An array of TOML tables specifying (possibly-partial)  mirrors  for  the  <b>prefix</b>-rooted  namespace
              (i.e., the current <b>[[registry]]</b> TOML table).

       The  mirrors  are  attempted in the specified order; the first one that can be contacted and contains the
       image will be used (and if none of the mirrors contains the image, the primary location specified by  the
       <b>registry.location</b> field, or using the unmodified user-specified reference, is tried last).

       Each  TOML  table  in  the  <b>mirror</b> array can contain the following fields: - <b>location</b>： same semantics as
       specified in the <b>[[registry]]</b> TOML table - <b>insecure</b>： same semantics as  specified  in  the  <b>[[registry]]</b>
       TOML  table  -  <b>pull-from-mirror</b>:  <b>all</b>, <b>digest-only</b> or <b>tag-only</b>.  If "digest-only"， mirrors will only be
       used for digest pulls. Pulling images by tag can potentially yield different images, depending  on  which
       endpoint we pull from.  Restricting mirrors to pulls by digest avoids that issue.  If "tag-only", mirrors
       will only be used for tag pulls.  For a more up-to-date and expensive mirror that it is less likely to be
       out  of  sync  if tags move, it should not be unnecessarily used for digest references.  Default is "all"
       (or left empty), mirrors will be used for both digest pulls and tag pulls  unless  the  mirror-by-digest-
       only  is set for the primary registry.  Note that this per-mirror setting is allowed only when <b>mirror-by-</b>
       <b>digest-only</b> is not configured for the primary registry.

       <b>mirror-by-digest-only</b>
              <b>true</b> or <b>false</b>.  If <b>true</b>, mirrors will only be used during pulling if the image reference  includes
              a  digest.   Note that if all mirrors are configured to be digest-only, images referenced by a tag
              will only use the primary registry.   If  all  mirrors  are  configured  to  be  tag-only,  images
              referenced by a digest will only use the primary registry.

       Referencing  an  image  by digest ensures that the same is always used (whereas referencing an image by a
       tag may cause different registries to return different images if the tag mapping is out of sync).

       <u>Note</u>: Redirection and mirrors are currently processed only when reading a single image, not when  pushing
       to  a registry nor when doing any other kind of lookup/search on a on a registry.  This may change in the
       future.

   <b>Short-Name</b> <b>Aliasing</b>
       The use of unqualified-search registries entails an ambiguity as it is  unclear  from  which  registry  a
       given image, referenced by a short name, may be pulled from.

       As mentioned in the note at the end of this man page, using short names is subject to the risk of hitting
       squatted  registry  namespaces.   If  the  unqualified-search  registries  are  set  to <b>["registry1.com",</b>
       <b>"registry2.com"]</b> an attacker may take over a namespace of registry1.com such that an image may be  pulled
       from registry1.com instead of the intended source registry2.com.

       While it is highly recommended to always use fully-qualified image references, existing deployments using
       short  names may not be easily changed.  To circumvent the aforementioned ambiguity, so called short-name
       aliases can be configured that point to a fully-qualified image reference.

       Short-name aliases can be configured in the <b>[aliases]</b> table in the form of <b>"name"="value"</b> with the  left-
       hand  <b>name</b>  being the short name (e.g., "image") and the right-hand <b>value</b> being the fully-qualified image
       reference (e.g., "registry.com/namespace/image").  Note that neither "name" nor "value" can include a tag
       or digest.  Moreover, "name" must be a short name and hence cannot include a registry domain or refer  to
       localhost.

       When  pulling a short name, the configured aliases table will be used for resolving the short name.  If a
       matching alias is found, it will be used without further  consulting  the  unqualified-search  registries
       list.   If  no  matching alias is found, the behavior can be controlled via the <b>short-name-mode</b> option as
       described below.

       Note that tags and digests are stripped off a user-specified short name  for  alias  resolution.   Hence,
       "image", "image:tag" and "image@digest" all resolve to the same alias (i.e., "image").  Stripped off tags
       and digests are later appended to the resolved alias.

       Further  note that drop-in configuration files (see <a href="../man5/containers-registries.conf.d.5.html">containers-registries.conf.d</a>(5)) can override aliases
       in the specific loading order of the files.  If the "value" of an alias is empty (i.e.,  ""),  the  alias
       will be erased.  However, a given "name" may only be specified once in a single config file.

   <b>Short-Name</b> <b>Aliasing:</b> <b>Modes</b>
       The <b>short-name-mode</b> option supports three modes to control the behaviour of short-name resolution.

              • <b>enforcing</b>:  If only one unqualified-search registry is set, use it as there is no ambiguity.  If
                there is more than one registry and the user program is running in a terminal  (i.e.,  stdout  &amp;
                stdin  are  a  TTY),  prompt  the user to select one of the specified search registries.  If the
                program is not running in a terminal, the ambiguity cannot be resolved which  will  lead  to  an
                error.

              • <b>permissive</b>:  Behaves as enforcing but does not lead to an error if the program is not running in
                a terminal.  Instead, fallback to using all unqualified-search registries.

              • <b>disabled</b>: Use all unqualified-search registries without prompting.

       If <b>short-name-mode</b> is not specified at all or left empty, default to the <b>permissive</b> mode.  If  the  user-
       specified  short name was not aliased already, the <b>enforcing</b> and <b>permissive</b> mode if prompted, will record
       a  new  alias  after  a  successful  pull.   Note  that  the  recorded   alias   will   be   written   to
       <b>/var/cache/containers/short-name-aliases.conf</b> for root to have a clear separation between possibly human-
       edited  registries.conf  files and the machine-generated <b>short-name-aliases-conf</b>.  Note that <b>$HOME/.cache</b>
       is used for rootless users.  If an alias is specified in a <b>registries.conf</b> file  and  also  the  machine-
       generated <b>short-name-aliases.conf</b>, the <b>short-name-aliases.conf</b> file has precedence.

   <b>Normalization</b> <b>of</b> <b>docker.io</b> <b>references</b>
       The  Docker  Hub  <b>docker.io</b>  is  handled  in a special way: every push and pull operation gets internally
       normalized  with   <b>/library</b>   if   no   other   specific   namespace   is   defined   (for   example   on
       <b>docker.io/namespace/image</b>).

       (Note that the above-described normalization happens to match the behavior of Docker.)

       This  means  that a pull of <b>docker.io/alpine</b> will be internally translated to <b>docker.io/library/alpine</b>. A
       pull of <b>docker.io/user/alpine</b> will not be rewritten because this is already the correct remote path.

       Therefore, to remap or mirror the <b>docker.io</b> images in the (implied) <b>/library</b>  namespace  (or  that  whole
       namespace),  the  prefix  and  location  fields  in  this configuration file must explicitly include that
       <b>/library</b> namespace. For example <b>prefix</b> <b>=</b> <b>"docker.io/library/alpine"</b> and not <b>prefix</b> <b>=</b>  <b>"docker.io/alpine"</b>.
       The latter would match the <b>docker.io/alpine/*</b> repositories but not the <b>docker.io/[library/]alpine</b> image).

   <b>EXAMPLE</b>
       unqualified-search-registries = ["example.com"]

       [[registry]]
       prefix = "example.com/foo"
       insecure = false
       blocked = false
       location = "internal-registry-for-example.com/bar"

       [[registry.mirror]]
       location = "example-mirror-0.local/mirror-for-foo"

       [[registry.mirror]]
       location = "example-mirror-1.local/mirrors/foo"
       insecure = true

       [[registry]]
       location = "registry.com"

       [[registry.mirror]]
       location = "mirror.registry.com"

       Given the above, a pull of <b>example.com/foo/image:latest</b> will try:

                1. <b>example-mirror-0.local/mirror-for-foo/image:latest</b>

                2. <b>example-mirror-1.local/mirrors/foo/image:latest</b>

                3. <b>internal-registry-for-example.com/bar/image:latest</b>

       in order, and use the first one that exists.

       Note  that  a  mirror  is  associated only with the current <b>[[registry]]</b> TOML table. If using the example
       above, pulling the image <b>registry.com/image:latest</b> will hence only reach out to <b>mirror.registry.com</b>,  and
       the mirrors associated with <b>example.com/foo</b> will not be considered.

   <b>Enabling</b> <b>Additional</b> <b>Layer</b> <b>Store</b> <b>to</b> <b>access</b> <b>to</b> <b>private</b> <b>registries</b>
       The <b>additional-layer-store-auth-helper</b> option enables passing registry credentials to an Additional Layer
       Store so that it can access private registries.

       When  accessing  a  private registry via an Additional Layer Store, a helper binary needs to be provided.
       This helper binary is registered via the <b>additional-layer-store-auth-helper</b> option. Every time  an  image
       is  read  using  the  <b>docker://</b>  transport, the specified helper binary is executed and receives registry
       credentials from stdin in the following format.

       {
         "$image_reference": {
           "username": "$username",
           "password": "$password",
           "identityToken": "$identityToken"
         }
       }

       The format of <b>$image_reference</b> is <b>$repo{:$tag|@$digest}</b>.

       Additional Layer Stores can use this helper binary to access the private registry.

</pre><h4><b>VERSION</b> <b>1</b> <b>FORMAT</b> <b>-</b> <b>DEPRECATED</b></h4><pre>
       VERSION 1 format is still supported but it  does  not  support  using  registry  mirrors,  longest-prefix
       matches, or location rewriting.

       The  TOML  format is used to build a simple list of registries under three categories: <b>registries.search</b>,
       <b>registries.insecure</b>, and <b>registries.block</b>.  You can list multiple  registries  using  a  comma  separated
       list.

       Search  registries  are  used when the caller of a container runtime does not fully specify the container
       image that they want to execute.  These  registries  are  prepended  onto  the  front  of  the  specified
       container image until the named image is found at a registry.

       Note that insecure registries can be used for any registry, not just the registries listed under search.

       The  <b>registries.insecure</b>  and  <b>registries.block</b>  lists  have the same meaning as the <b>insecure</b> and <b>blocked</b>
       fields in the current version.

   <b>EXAMPLE</b>
       The following example configuration defines two searchable registries, one  insecure  registry,  and  two
       blocked registries.

       [registries.search]
       registries = ['registry1.com', 'registry2.com']

       [registries.insecure]
       registries = ['registry3.com']

       [registries.block]
       registries = ['registry.untrusted.com', 'registry.unsafe.com']

</pre><h4><b>NOTE:</b> <b>RISK</b> <b>OF</b> <b>USING</b> <b>UNQUALIFIED</b> <b>IMAGE</b> <b>NAMES</b></h4><pre>
       We  recommend  always  using  fully  qualified image names including the registry server (full dns name),
       namespace, image name, and tag (e.g., registry.redhat.io/ubi8/ubi:latest). When using short names,  there
       is  always  an  inherent  risk that the image being pulled could be spoofed. For example, a user wants to
       pull an image named <b>foobar</b> from a registry and expects it to come from myregistry.com. If  myregistry.com
       is  not  first in the search list, an attacker could place a different <b>foobar</b> image at a registry earlier
       in the search list. The user would accidentally pull and run the attacker's image and  code  rather  than
       the  intended  content. We recommend only adding registries which are completely trusted, i.e. registries
       which don't allow unknown or anonymous users to create accounts with arbitrary names. This  will  prevent
       an image from being spoofed, squatted or otherwise made insecure.  If it is necessary to use one of these
       registries, it should be added at the end of the list.

       It  is  recommended to use fully-qualified images for pulling as the destination registry is unambiguous.
       Pulling by digest (i.e., quay.io/repository/name@digest) further eliminates the ambiguity of tags.

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <a href="../man5/containers-auth.json.5.html">containers-auth.json</a>(5) <a href="../man5/containers-certs.d.5.html">containers-certs.d</a>(5)

</pre><h4><b>HISTORY</b></h4><pre>
       Dec  2019,  Warning  added   for   unqualified   image   names   by   Tom   Sweeney   <a href="mailto:tsweeney@redhat.com">tsweeney@redhat.com</a>
       ⟨<a href="mailto:tsweeney@redhat.com">mailto:tsweeney@redhat.com</a>⟩

       Mar    2019,    Added    additional    configuration   format   by   Sascha   Grunert   <a href="mailto:sgrunert@suse.com">sgrunert@suse.com</a>
       ⟨<a href="mailto:sgrunert@suse.com">mailto:sgrunert@suse.com</a>⟩

       Aug  2018,   Renamed   to   <a href="../man5/containers-registries.conf.5.html">containers-registries.conf</a>(5)   by   Valentin   Rothberg   <a href="mailto:vrothberg@suse.com">vrothberg@suse.com</a>
       ⟨<a href="mailto:vrothberg@suse.com">mailto:vrothberg@suse.com</a>⟩

       Jun 2018, Updated by Tom Sweeney <a href="mailto:tsweeney@redhat.com">tsweeney@redhat.com</a> ⟨<a href="mailto:tsweeney@redhat.com">mailto:tsweeney@redhat.com</a>⟩

       Aug 2017, Originally compiled by Brent Baude <a href="mailto:bbaude@redhat.com">bbaude@redhat.com</a> ⟨<a href="mailto:bbaude@redhat.com">mailto:bbaude@redhat.com</a>⟩

registry                                           System-wide                     <u><a href="../man5/CONTAINERS-REGISTRIES.CONF.5.html">CONTAINERS-REGISTRIES.CONF</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>