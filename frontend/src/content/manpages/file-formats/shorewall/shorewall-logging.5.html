<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>logging - Shorewall logging</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/shorewall">shorewall_5.2.8-6_all</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       logging - Shorewall logging

</pre><h4><b>SYNOPSIS</b></h4><pre>

       <u>action</u><b>:</b><u>level</u>

       <b>NFLOG(</b><u>nflog-parameters</u><b>)</b>

       <b>ULOG(</b><u>ulog-parameters</u><b>)</b>

</pre><h4><b>DESCRIPTION</b></h4><pre>
       The disposition of packets entering a Shorewall firewall is determined by one of a number of Shorewall
       facilities. Only some of these facilities permit logging.

        1. The packet is part of an established connection. While the packet can be logged using LOG rules in
           the ESTABLISHED section of <b>/etc/shorewall/rules</b>[1], that is not recommended because of the large
           amount of information that may be logged.

        2. The packet represents a connection request that is related to an established connection (such as a
           <b>data</b> <b>connection</b> <b>associated</b> <b>with</b> <b>an</b> <b>FTP</b> <b>control</b> <b>connection</b>[2]). These packets may be logged using LOG
           rules in the RELATED section of <b><a href="../man5/shorewall-rules.5.html">shorewall-rules</a>(5)</b>[1].

        3. The packet is rejected because of an option in <b>shorewall.conf</b>[3](5) or <b><a href="../man5/shorewall-interfaces.5.html">shorewall-interfaces</a>(5)</b>[4].
           These packets can be logged by setting the appropriate logging-related option in
           <b>/etc/shorewall/shorewall.conf</b>[3].

        4. The packet matches a rule in <b>shorewall-rules</b>[1](5). By including a syslog level (see below) in the
           ACTION column of a rule (e.g., “ACCEPT<b>:info</b> net $FW tcp 22”), the connection attempt will be logged
           at that level.

        5. The packet doesn't match a rule so it is handled by a policy defined in <b><a href="../man5/shorewall-policy.5.html">shorewall-policy</a>(5)</b>[5]. These
           may be logged by specifying a syslog level in the LOG LEVEL column of the policy's entry (e.g., “loc
           net ACCEPT <b>info</b>”).

</pre><h4><b>DEFAULT</b> <b>LOGGING</b></h4><pre>
       By default, Shorewall directs Netfilter to log using syslog (8). Syslog classifies log messages by a
       <u>facility</u> and a <u>priority</u> (using the notation <u>facility.priority</u>).

       The facilities defined by syslog are <u>auth,</u> <u>authpriv,</u> <u>cron,</u> <u>daemon,</u> <u>kern,</u> <u>lpr,</u> <u>mail,</u> <u>mark,</u> <u>news,</u> <u>syslog,</u>
       <u>user,</u> <u>uucp</u> and <u>local0</u> through <u>local7.</u>

       Throughout the Shorewall documentation, the term <u>level</u> rather than <u>priority</u> <u>is</u> <u>used,</u> since <u>level</u> is the
       term used by Netfilter. The syslog documentation uses the term <u>priority</u>.

</pre><h4><b>SYSLOG</b> <b>LEVELS</b></h4><pre>
       Syslog levels are a method of describing to syslog (8) the importance of a message. A number of Shorewall
       parameters have a syslog level as their value.

       Valid levels are:
           7 - <b>debug</b> (Debug-level
                 messages)
           6 - <b>info</b>
                 (Informational)
           5 - <b>notice</b> (Normal but
                 significant Condition)
           4 - <b>warning</b> (Warning
                 Condition)
           3 - <b>err</b> (Error
                 Condition)
           2 - <b>crit</b> (Critical
                 Conditions)
           1 - <b>alert</b> (must be handled
                 immediately)
           0 - <b>emerg</b> (System is
                 unusable)

       For most Shorewall logging, a level of 6 (info) is appropriate. Shorewall log messages are generated by
       Netfilter and are logged using the <u>kern</u> facility and the level that you specify. If you are unsure of the
       level to choose, 6 (info) is a safe bet. You may specify levels by name or by number.

       Beginning with Shorewall 4.5.5, the <u>level</u> name or number may be optionally followed by a comma-separated
       list of one or more <u>log</u> <u>options</u>. The list is enclosed in parentheses. Log options cause additional
       information to be included in each log message.

       Valid log options are:

       <b>ip_options</b>
           Log messages will include the option settings from the IP header.

       <b>macdecode</b>
           Decode the MAC address and protocol.

       <b>tcp_sequence</b>
           Include TCP sequence numbers.

       <b>tcp_options</b>
           Include options from the TCP header.

       <b>uid</b>
           Include the UID of the sending program; only valid for packets originating on the firewall itself.

       Example: <b>info(tcp_options,tcp_sequence)</b>

       Syslogd writes log messages to files (typically in <a href="file:/var/log/">/var/log/</a>*) based on their facility and level. The
       mapping of these facility/level pairs to log files is done in /etc/syslog.conf (5). If you make changes
       to this file, you must restart syslogd before the changes can take effect.

       Syslog may also write to your system console. See <b>Shorewall</b> <b>FAQ</b> <b>16</b>[6] for ways to avoid having Shorewall
       messages written to the console.

</pre><h4><b>CONFIGURING</b> <b>A</b> <b>SEPARATE</b> <b>LOG</b> <b>FOR</b> <b>SHOREWALL</b> <b>MESSAGES</b> <b>(ULOGD)</b></h4><pre>
       There are a couple of limitations to syslogd-based logging:

        1. If you give, for example, kern.info its own log destination then that destination will also receive
           all kernel messages of levels 5 (notice) through 0 (emerg).

        2. All kernel.info messages will go to that destination and not just those from Netfilter.

        3. Netfilter (Shorewall) messages show up in <b>dmesg</b>.

       If your kernel has NFLOG target support (and most vendor-supplied kernels do), you may also specify a log
       level of NFLOG (must be all caps). When NFLOG is used, Shorewall will direct Netfilter to log the related
       messages via the NFLOG target which will send them to a process called “ulogd”. The ulogd program is
       included in most distributions.

           <b>Note</b>

           The NFLOG logging mechanism is <u>completely</u> <u>separate</u> from syslog. Once you switch to NFLOG, the
           settings in /etc/syslog.conf have absolutely no effect on your Shorewall logging (except for
           Shorewall status messages which still go to syslog).

       You will need to change all instances of log levels (usually “info”) in your Shorewall configuration
       files to “NFLOG” - this includes entries in the policy, rules and shorewall.conf files. If you initially
       installed using Shorewall 5.1.2 or later, you can simply change the setting of LOG_LEVEL in
       shorewall.conf.

</pre><h4><b>UNDERSTANDING</b> <b>THE</b> <b>CONTENTS</b> <b>OF</b> <b>SHOREWALL</b> <b>LOG</b> <b>MESSAGES</b></h4><pre>
       For general information on the contents of Netfilter log messages, see
       <b><a href="http://logi.cc/en/2010/07/netfilter-log-format/">http://logi.cc/en/2010/07/netfilter-log-format/</a></b>.

       For Shorewall-specific information, see <b>FAQ</b> <b>#17</b>[7].

</pre><h4><b>CUSTOMIZING</b> <b>THE</b> <b>CONTENT</b> <b>OF</b> <b>SHOREWALL</b> <b>LOG</b> <b>MESSAGES</b></h4><pre>
       In a Shorewall logging rule, the log level can be followed by a log tag as in "DROP:NFLOG:junk". The
       generated log message will include "<u>chain-name</u> junk DROP".

       By setting the LOGTAGONLY option to Yes in <b><a href="../man5/shorewall.conf.5.html">shorewall.conf</a>(5)</b>[8] or <b><a href="../man5/shorewall6.conf.5.html">shorewall6.conf</a>(5)</b>[8], the disposition
       ('DROP' in the above example) will be omitted. Consider the following rule:

           #ACTION                                    SOURCE          DEST           PROTO
           REJECT(icmp-proto-unreachable):notice:IPv6 loc             net            41      # who's using IPv6 tunneling

       This rule generates the following warning at compile time:
           WARNING: Log Prefix shortened to "Shorewall:IPv6:REJECT(icmp-p "
                 /etc/shorewall/rules (line 212)

       and produces the rather ugly prefix "Shorewall:IPv6:REJECT(icmp-p ".

       Now consider this similar rule:

           #ACTION                                              SOURCE          DEST           PROTO
           REJECT(icmp-proto-unreachable):notice:IPv6,tunneling loc             net            41      # who's using IPv6 tunneling

       With LOGTAGONLY=Yes, no warning is generated and the prefix becomes "Shorewall:IPv6:tunneling:"

       See the <b>shorewall[6].conf</b> <b>man</b> <b>page</b>[8] for further information about how LOGTAGONLY=Yes can be used.

</pre><h4><b>LOG</b> <b>BACKENDS</b></h4><pre>
       Netfilter logging allows configuration of multiple backends. Logging backends provide the The low-level
       forward of log messages. There are currently three backends:

       LOG (ipt_LOG and ip6t_LOG).
           Normal kernel-based logging to a syslog daemon.

       ULOG (ipt_ULOG)
           ULOG logging as described ablve. Only available for IPv4.

       netlink (nfnetlink_log)
           The logging backend behind NFLOG, defined above.

       The currently-available and currently-selected IPv4 and IPv6 backends are shown in
       <a href="file:/proc/sys/net/netfilter/nf_log">/proc/sys/net/netfilter/nf_log</a>:

           cat <a href="file:/proc/net/netfilter/nf_log">/proc/net/netfilter/nf_log</a>
            0 NONE (nfnetlink_log)
            1 NONE (nfnetlink_log)
            2 ipt_ULOG (ipt_ULOG,ipt_LOG,nfnetlink_log)
            3 NONE (nfnetlink_log)
            4 NONE (nfnetlink_log)
            5 NONE (nfnetlink_log)
            6 NONE (nfnetlink_log)
            7 NONE (nfnetlink_log)
            8 NONE (nfnetlink_log)
            9 NONE (nfnetlink_log)
           10 ip6t_LOG (ip6t_LOG,nfnetlink_log)
           11 NONE (nfnetlink_log)
           12 NONE (nfnetlink_log)

       The magic numbers (0-12) are Linux address family numbers (AF_INET is 2 and AF_INET6 is 10).

       The name immediately following the number is the currently-selected backend, and the ones in parentheses
       are the ones that are available. You can change the currently selected backend by echoing it's name into
       /proc/net/netfilter/nf_log.<u>number</u>.

       Example - change the IPv4 backend to LOG:

           sysctl net.netfilter.nf_log.2=ipt_LOG

       Beginning with Shorewall 4.6.4, you can configure the backend using the LOG_BACKEND option in
       <b><a href="../man5/shorewall.conf.5.html">shorewall.conf</a>(5)</b>[3] and <b><a href="../man5/shorewall6.conf.5.html">shorewall6.conf</a>(5)</b>[3].

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <b>https://shorewall.org/shorewall_logging.html</b>[9]

</pre><h4><b>NOTES</b></h4><pre>
        1. /etc/shorewall/rules
           https://shorewall.org/manpages/shorewall-rules.html

        2. data connection associated with an FTP control connection
           https://shorewall.org/manpages/FTP.html

        3. shorewall.conf
           https://shorewall.org/manpages/shorewall.conf.html

        4. <a href="../man5/shorewall-interfaces.5.html">shorewall-interfaces</a>(5)
           https://shorewall.org/manpages/shorewall-interfaces.html

        5. <a href="../man5/shorewall-policy.5.html">shorewall-policy</a>(5)
           https://shorewall.org/manpages/shorewall-policy.html

        6. Shorewall FAQ 16
           https://shorewall.org/manpages/FAQ.htm#faq16

        7. FAQ #17
           https://shorewall.org/FAQ.htm#faq17

        8. <a href="../man5/shorewall.conf.5.html">shorewall.conf</a>(5)
           https://shorewall.org/manpages/shorewall.conf.html

        9. https://shorewall.org/shorewall_logging.html
           https://shorewall.org/shorewall_logging.htm

Configuration Files                                09/24/2020                               <u><a href="../man5/SHOREWALL-LOGGING.5.html">SHOREWALL-LOGGING</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>