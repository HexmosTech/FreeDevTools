<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>parent.config - Traffic Server parent cache configuration file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/trafficserver">trafficserver_9.2.5+ds-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       parent.config - Traffic Server parent cache configuration file

       The <u>parent.config</u> file identifies the parent proxies used in an cache hierarchy. Use this file to perform
       the following configuration:

       • Set up parent cache hierarchies, with multiple parents and parent failover

       • Configure selected URL requests to bypass parent proxies

       Traffic  Server  uses  the  <u>parent.config</u>  file  only when the parent caching option is enabled (refer to
       <u>Configuring</u> <u>Traffic</u> <u>Server</u> <u>to</u> <u>Use</u> <u>a</u> <u>Parent</u> <u>Cache</u>).

       After you modify the <u>parent.config</u> file, run the <u>traffic_ctl</u> <u>config</u> <u>reload</u> command to apply your changes.

</pre><h4><b>FORMAT</b></h4><pre>
       Each line in the <u>parent.config</u> file must contain a parent caching rule. Traffic Server  recognizes  three
       space-delimited tags:

          primary_destination=value secondary_specifier=value  action=value

       The following list shows the possible primary destinations and their allowed values.

       <b>dest_domain</b>
              A requested domain name, and its subdomains.

       <b>dest_host</b>
              A requested hostname.

       <b>dest_ip</b>
              A requested IP address or range of IP addresses separated by a dash (-).

       <b>url_regex</b>
              A regular expression (regex) to be found in a URL

       The  secondary  specifiers  are optional in the <u>parent.config</u> file. The following list shows the possible
       secondary specifiers and their allowed values. Every line in the <u>parent.config</u> file must contain either a
       <b>parent=</b> or <b>go_direct=</b> directive.

       <b>port</b>   A requested URL port.

       <b>scheme</b> A request URL protocol: <b>http</b> or <b>https</b>.

       <b>prefix</b> A prefix in the path part of a URL.

       <b>suffix</b> A file suffix in the URL.

       <b>method</b> A request URL method. It can be one of the following:

              • get

              • post

              • put

              • trace

       <b>time</b>   A time range, such as 08:00-14:00, during which the parent cache is used to serve requests.

       <b>src_ip</b> A client IP address.

       <b>internal</b>
              A boolean value, <b>true</b> or <b>false</b>, specifying if the rule should match (or not match)  a  transaction
              originating  from an internal API. This is useful to differentiate transaction originating from an
              ATS plugin.

       The following list shows the possible actions and their allowed values.

       <b>parent</b> <u>(hostname</u> <u>or</u> <u>IP</u> <u>address):port[|weight][&amp;hash</u> <u>name][,another</u> <u>host]</u>
              An ordered list of parent servers, separated by commas or semicolons. If  the  request  cannot  be
              handled  by  the last parent server in the list, then it will be routed to the origin server.  You
              can specify either a hostname or an IP address, but, you must specify the port  number.  If  there
              are multiple IP addresses associated with the hostname, Traffic Server will treat them as a single
              entity when tracking health. Example:

                 parent="p1.x.com:8080, 192.168.0.3:80, 192.168.0.4:80"

              An  optional  weight  can  be  specified  after  a  pipe (<b>|</b>). This example has one parent take 20%
              (2/(2+3+5)) of the requests, another 30% (3/(2+3+5)), and the last 50% (5/(2+3+5)):

                 parent="p1.x.com:8080|2.0, 192.168.0.3:80|3.0, 192.168.0.4:80|5.0"

              If <b>round_robin</b> is set to <b>consistent_hash</b>, you may add a unique <b>hash</b> <b>string</b>  following  the  <b>weight</b>
              for  each  parent.   The  <b>hash</b>  <b>string</b> must start with <b>&amp;</b> and is used to build both the primary and
              secondary rings using the <b>hash</b> <b>string</b> for each parent  instead  of  the  parents  <b>hostname</b>  or  <b>ip</b>
              <b>address</b>.  This  can  be useful so that two different hosts may be used to cache the same requests.
              Example:

                 parent="p1.x.com:80|1.0&amp;abcdef, p2.x.com:80|1.0&amp;xyzl, p3.x.com:80|1.0&amp;ldffg" round_robin=consistent_hash

       <b>secondary_parent</b>
              An optional ordered list of secondary parent servers in the same format as parent.  This  optional
              list  may  only  be  used  when  <b>round_robin</b>  is set to <b>consistent_hash</b>.  If the request cannot be
              handled by the first parent server chosen from the <b>parent</b> list, then the request will be  re-tried
              from  a  server  found in this list using a consistent hash of the url. The parent servers in this
              list will be exhausted before the selection function will revert to trying alternative parents  in
              the <b>parent</b> list.

       <b>secondary_mode</b>
              One of the following values:

              • <b>1</b>  This  is  the  default.  The  parent selection will first attempt to choose a parent from the
                <b>parent</b> list. If the chosen parent is not available or marked down then another  parent  will  be
                chosen  from  the <b>secondary_parent</b> list.  Choices in the <b>secondary_parent</b> list will be exhausted
                before attempting to choose another parent from the <b>parent</b> list.

              • <b>2</b> The parent selection will first attempt to choose a parent from the <b>parent</b> list. If the chosen
                parent is not available or marked down then another parent will be chosen from the <b>parent</b>  list.
                Choices in the <b>parent</b> list will be exhausted before attempting to choose another parent from the
                <b>secondary_parent</b> list.

              • <b>3</b> The parent selection will first attempt to choose a parent from the <b>parent</b> list.

                • If   the  chosen  parent  is  marked  down  then  another  parent  will  be  chosen  from  the
                  <b>secondary_parent</b> list. The <b>secondary_parent</b> list will be exhausted before attempting to choose
                  another parent in the <b>parent</b> list. This depends on taking a parent down from a particular EDGE
                  using traffic_ctl like <b>traffic_ctl</b> <b>host</b> <b>down</b> <b>sample.server.com</b>. This  will  be  useful  during
                  maintenance  window  or  as  a  debugging aid when a user wants to take down specific parents.
                  Taking parents down using <b>traffic_ctl</b> will cause the EDGE to ignore those  parent  immediately
                  from parent selection logic.

                • If  the  chosen  parent  is unavailable but not marked down then another parent will be chosen
                  from the <b>parent</b> list. The <b>parent</b> list will be exhausted before attempting  to  choose  another
                  parent in the <b>secondary_parent</b> list.

       <b>parent_is_proxy</b>
              One of the following values:

              • <b>true</b> - This is the default.  The list of parents and secondary parents are proxy cache servers.

              • <b>false</b>  -  The  list  of  parents  and secondary parents are the origin servers <b>go_direct</b> flag is
                ignored and origins are selected using the specified <b>round_robin</b> algorithm.  The FQDN is removed
                from the http request line.

       <b>parent_retry</b>

              • <b>simple_retry</b> - If the parent returns a 404 response or if the response matches a  list  of  http
                4xx  and/or  5xx responses defined in <b>simple_server_retry_responses</b> on a request a new parent is
                selected and the request is retried.  The number of retries is controlled by  <b>max_simple_retries</b>
                which is set to 1 by default.

              • <b>unavailable_server_retry</b>  -  If  the  parent returns a 503 response or if the response matches a
                list of http 5xx responses defined in <b>unavailable_server_retry_responses</b>, the currently selected
                parent is marked down and a new parent is selected to retry the request.  The number of  retries
                is controlled by <b>max_unavailable_server_retries</b> which is set to 1 by default.

              • <b>both</b> - This enables both <b>simple_retry</b> and <b>unavailable_server_retry</b> as described above.

              • If  not set, by default all response codes will be considered a success, and parents will not be
                retried based on any HTTP response code.

              <b>NOTE:</b>
                 If a response code exists in both the simple and unavailable lists and both is the  retry  type
                 then  simple_retry  will take precedence and unavailable_server_retry will not be used for that
                 code.

       <b>simple_server_retry_responses</b>
              If <b>parent_retry</b> is set to either <b>simple_retry</b> or <b>both</b>, this parameter is a comma separated list of
              http 4xx and/or 5xx response codes that will invoke the <b>simple_retry</b> described in the <b>parent_retry</b>
              section. By default, <b>simple_server_retry_responses</b> is set to 404.

       <b>unavailable_server_retry_responses</b>
              If <b>parent_retry</b> is set to either <b>unavailable_server_retry</b> or  <b>both</b>,  this  parameter  is  a  comma
              separated  list of http 5xx response codes that will invoke the <b>unavailable_server_retry</b> described
              in the <b>parent_retry</b> section.  By default, <b>unavailable_server_retry_responses</b> is set to 503.

       <b>max_simple_retries</b>
              By default the value for <b>max_simple_retries</b> is 1.  It may be set to any value in the range 1 to 5.
              If <b>parent_retry</b> is set to <b>simple_retry</b> or <b>both</b> a 404 response from a  parent  origin  server  will
              cause  the  request  to  be  retried  using  a  new  parent  at most 1 to 5 times as configured by
              <b>max_simple_retries</b>.

       <b>max_unavailable_server_retries</b>
              By default the value for <b>max_unavailable_server_retries</b> is 1.  It may be set to any value  in  the
              range  1  to  5.   If  <b>parent_retry</b> is set to <b>unavailable_server_retries</b> or <b>both</b> a 503 response by
              default or any http 5xx response listed in  the  list  <b>unavailable_server_retry_responses</b>  from  a
              parent  origin  server will cause the request to be retried using a new parent after first marking
              the current parent down.  The request will be retried at most  1  to  5  times  as  configured  by
              <b>max_unavailable_server_retries</b>.

       <b>round_robin</b>
              One of the following values:

              • <b>true</b> - Traffic Server determines the parent based on client IP address.

              • <b>strict</b>  -  Traffic  Server machines serve requests strictly in turn. For example: machine <b>proxy1</b>
                serves the first request, <b>proxy2</b> serves the second request, and so on.

              • <b>false</b> - The default. Round robin selection does not occur.

              • <b>consistent_hash</b> - consistent hash of the url so that one parent is chosen for a given url. If  a
                parent  is  down, the traffic that would go to the down parent is rehashed amongst the remaining
                parents.  The other traffic is unaffected. Once the downed parent becomes available, the traffic
                distribution returns to the pre-down state.

              • <b>latched</b> - The first parent in the  list  is  marked  as  primary  and  is  always  chosen  until
                connection errors cause it to be marked down.  When this occurs the next parent in the list then
                becomes primary.  The primary will wrap back to the first parent in the list when it is the last
                parent  in  the list and is marked down due to a connection error.  Newly chosen primary parents
                marked as unavailable will then be restored if the  failure  retry  time  has  elapsed  and  the
                transaction using the primary succeeds.

       <b>go_direct</b>
              One of the following values:

              • <b>true</b> - The default. Requests bypass parent hierarchies and go directly to the origin server.

              • <b>false</b> - requests do not bypass parent hierarchies.

       <b>qstring</b>
              One of the following values:

              • <b>consider</b> - The default. Use the query string when finding a parent.

              • <b>ignore</b>  - Do not consider the query string when finding a parent. This is especially useful when
                using the <b>consistent_hash</b> selection  strategy,  and  a  random  query  string  would  prevent  a
                consistent parent selection.

       <b>ignore_self_detect</b>
                 One of the following values:

              •

                <b>true</b> <b>-</b> <b>Ignore</b> <b>the</b> <b>marked</b> <b>down</b> <b>status</b> <b>of</b> <b>a</b> <b>host,</b> <b>typically</b> <b>the</b> <b>local</b> <b>host,</b>
                       when the reason code is Reason::SELF_DETECT and use the host as if it were marked up.

              • <b>false</b> - The default.  Do not ignore the host status.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  following rule configures a parent cache hierarchy consisting of Traffic Server (which is the child)
       and two parents, <b>p1.x.com</b> and <b>p2.x.com</b>. Traffic Server forwards the  requests  it  cannot  serve  to  the
       parent servers <b>p1.x.com</b> and <b>p2.x.com</b> in a round-robin fashion:

          dest_domain=. method=get parent="p1.x.com:8080; p2.y.com:8080" round_robin=true

       The  following  rule  configures  Traffic  Server to route all requests containing the regular expression
       <b>politics</b> and the path <b>/viewpoint</b> directly to the origin server (bypassing any parent hierarchies):

          url_regex=politics prefix=/viewpoint go_direct=true

       The following configures Traffic Server to  route  http  requests  for  example.com  (neither  https  nor
       www.example.com would match) through parent servers. Each url will be hashed to a specific parent. If the
       chosen parent has been marked down, a parent from the secondary ring will be chosen for the retry.:

          dest_host=example.com scheme=http parent="p1.x.com:80,p2.x.com:80" secondary_parent="p3.x.com:80,p4.x.com:80" round_robin=consistent_hash go_direct=false

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2025, <a href="mailto:dev@trafficserver.apache.org">dev@trafficserver.apache.org</a>

9.2                                               May 22, 2025                                  <u><a href="../man5/PARENT.CONFIG.5.html">PARENT.CONFIG</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>