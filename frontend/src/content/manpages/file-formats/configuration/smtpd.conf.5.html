<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>smtpd.conf — SMTP daemon configuration file</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/opensmtpd">opensmtpd_7.7.0p0-1_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       smtpd.conf — SMTP daemon configuration file

</pre><h4><b>DESCRIPTION</b></h4><pre>
       <b>smtpd.conf</b> is the configuration file for the mail daemon <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8).

       When  mail  arrives,  each “RCPT TO:” command generates a mail envelope.  If an envelope matches any of a
       pre-designated set of criteria (using the <b>match</b> directive), the message is accepted for delivery.  A copy
       of the message, as well as its associated envelopes, is saved in the  mail  queue  and  later  dispatched
       according  to  an  associated set of actions (using the <b>action</b> directive).  If an envelope does not match
       any options, it is rejected.  The match rules are evaluated sequentially, with the first match winning.

       The format of the configuration file is fairly flexible.  The current line can be extended over  multiple
       lines  using  a  backslash  (‘\’).  Comments can be put anywhere in the file using a hash mark (‘#’), and
       extend to the end of the current line.  Care should be taken when commenting  out  multi-line  text:  the
       comment  is  effective  until  the  end of the entire block.  Argument names not beginning with a letter,
       digit, or underscore, as well as reserved words (such as  <b>listen</b>,  <b>match</b>,  and  <b>port</b>),  must  be  quoted.
       Arguments containing whitespace should be surrounded by double quotes (").

       Macros  can  be defined that are later expanded in context.  Macro names must start with a letter, digit,
       or underscore, and may contain any of those characters, but may not be reserved words.   Macros  are  not
       expanded inside quotes.  For example:

             lan_addr = "192.168.0.1"
             listen on $lan_addr
             listen on $lan_addr tls auth

       The syntax of <b>smtpd.conf</b> is described below.

       <b>action</b> <u>name</u> <u>method</u> [<u>options</u>]
               When  the queue runner processes an envelope from the mail queue, it carries out the <b>action</b> <u>name</u>,
               selected by the <b>match</b> ... <b>action</b> directive when the message was received.  The  <b>action</b>  directive
               provides configuration data for delivery attempts.  Required lookups are performed at the time of
               each delivery attempt.  Consequently, changing an <b>action</b> directive or the files it references and
               restarting the <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8) daemon causes the changes to take effect for subsequent delivery attempts
               for  the respective dispatcher <u>name</u>, even for messages that were already stuck in the queue prior
               to the configuration changes.

               The delivery <u>method</u> parameter may be one of the following:

               <b>expand-only</b>
                       Only accept the message if a delivery method was specified  in  an  aliases  or  <u>.forward</u>
                       file.

               <b>forward-only</b>
                       Only accept the message if the recipient results in a remote address after the processing
                       of aliases or forward file.

               <b>lmtp</b> <u>destination</u> [<b>rcpt-to</b>]
                       Deliver  the  message to an LMTP server at <u>destination</u>.  The location may be expressed as
                       host:port or as a UNIX socket.

                       Optionally, <b>rcpt-to</b> might  be  specified  to  use  the  recipient  email  address  (after
                       expansion) instead of the local user in the LMTP session as RCPT TO.

               <b>maildir</b> [<u>pathname</u>] [<b>junk</b>]
                       Deliver the message to the maildir in <u>pathname</u> if specified, or by default to <u><a href="file:~/Maildir">~/Maildir</a></u>.

                       The  <u>pathname</u>  may  contain  format  specifiers that are expanded before use (see “FORMAT
                       SPECIFIERS”).

                       If the <b>junk</b> argument is provided, the message will be moved to the ‘Junk’  folder  if  it
                       contains  a  positive  ‘X-Spam’ header.  This folder will be created under <u>pathname</u> if it
                       does not yet exist.

               <b>mbox</b>    Deliver the message to the user's mbox with <u><a href="../man8/mail.local.8.html">mail.local</a></u>(8).

               <b>mda</b> <u>command</u>
                       Delegate the delivery to a <u>command</u> that receives the message on its standard  input  (see
                       “MDA COMMANDS”).

                       The  <u>command</u>  may  contain  format  specifiers  that are expanded before use (see “FORMAT
                       SPECIFIERS”).

               <b>relay</b>   Relay the message to another SMTP server.

               The local delivery methods support additional options:

               <b>alias</b> &lt;<u>table</u>&gt;
                       Use the mapping <u>table</u> for <u><a href="../man5/aliases.5.html">aliases</a></u>(5) expansion.

               <b>ttl</b> <u>n</u>{<b>s</b>|<b>m</b>|<b>h</b>|<b>d</b>}
                       Specify how long a message may remain in the queue.

               <b>user</b> <u>username</u>
                       Specify the <u>username</u> for performing the delivery, to be looked up with <u><a href="../man3/getpwnam.3.html">getpwnam</a></u>(3).

                       This is used for virtual hosting where  a  single  username  is  in  charge  of  handling
                       delivery for all virtual users.

                       This option is not usable with the <b>mbox</b> delivery method.

                       Only the delivery user's <u>.forward</u> file will be processed.

               <b>userbase</b> &lt;<u>table</u>&gt;
                       Use the mapping <u>table</u> for user lookups instead of the <u><a href="../man3/getpwnam.3.html">getpwnam</a></u>(3) function.

                       The <b>userbase</b> does not apply to the <b>user</b> option.

               <b>virtual</b> &lt;<u>table</u>&gt;
                       Use  the  mapping <u>table</u> for virtual expansion.  The aliasing table format is described in
                       <u><a href="../man5/table.5.html">table</a></u>(5).

               <b>wrapper</b> <u>name</u>
                       Use the wrapper specified in <b>mda</b> <b>wrapper</b>.

               The relay delivery methods also support additional options:

               <b>backup</b>  Operate as a backup mail exchanger delivering messages to any mail exchanger with  higher
                       priority.

               <b>backup</b> <b>mx</b> <u>name</u>
                       Operate  as a backup mail exchanger delivering messages to any mail exchanger with higher
                       priority than mail exchanger identified as <u>name</u>.

               <b>ca</b> <u>caname</u>
                       For secure connections, use the certificate authority associated with <u>caname</u> (declared in
                       a <b>ca</b> directive) to validate the server's identity.

               <b>helo</b> <u>heloname</u>
                       Advertise <u>heloname</u> as the hostname to other mail exchangers during the HELO phase.

               <b>helo-src</b> &lt;<u>table</u>&gt;
                       Use the mapping <u>table</u> to look up a hostname matching the  source  address,  to  advertise
                       during the HELO phase.

               <b>domain</b> &lt;<u>domains</u>&gt;
                       Do  not  perform  MX  lookups  but look up destination domain in <u>domains</u> and use matching
                       relay url as relay host.

               <b>host</b> <u>relay-url</u>
                       Do not perform MX lookups but relay messages to the relay host  described  by  <u>relay-url</u>.
                       The  format  for <u>relay-url</u> is [<u>proto</u>://[<u>label</u>@]]<u>host</u>[:<u>port</u>].  The following protocols are
                       available:

                       smtp        Normal SMTP session with opportunistic STARTTLS (the default).
                       smtp+tls    Normal SMTP session with mandatory STARTTLS.
                       smtp+notls  Plain text SMTP session without TLS.
                       lmtp        LMTP session.  <u>port</u> is required.
                       smtps       SMTP session with forced TLS on connection.  The default port is 465.

                       Unless noted, <u>port</u> defaults to 25.

                       The <u>label</u> corresponds to an entry in a credentials table, as documented in <u><a href="../man5/table.5.html">table</a></u>(5).   It
                       is   used   with  the  “smtp+tls”  and  “smtps”  protocols  for  authentication.   Server
                       certificates for those protocols are verified by default.

               <b>pki</b> <u>pkiname</u>
                       For secure connections, use the certificate associated with <u>pkiname</u> (declared  in  a  <b>pki</b>
                       directive) to prove the client's identity to the remote mail server.

               <b>srs</b>     When relaying a mail resulting from a forward, use the Sender Rewriting Scheme to rewrite
                       sender address.

               <b>tls</b> [<b>no-verify</b>]
                       Require  TLS  to  be  used when relaying, using mandatory STARTTLS by default.  When used
                       with a smarthost, the protocol must not be “smtp+notls://”.  If <b>no-verify</b>  is  specified,
                       do not require a valid certificate.

               <b>protocols</b> <u>protostr</u>
                       Define   the   protocol   versions   to   be   used  for  TLS  sessions.   Refer  to  the
                       <u><a href="../man3/tls_config_parse_protocols.3.html">tls_config_parse_protocols</a></u>(3) manpage for the format of <u>protostr</u>.

               <b>ciphers</b> <u>cipherstr</u>
                       Define  the  list  of  ciphers  that  may  be  used  for  TLS  sessions.   Refer  to  the
                       <u><a href="../man3/tls_config_set_ciphers.3.html">tls_config_set_ciphers</a></u>(3) manpage for the format of <u>cipherstr</u>.

               <b>auth</b> &lt;<u>table</u>&gt;
                       Use  the  mapping  <u>table</u>  for  connecting to <u>relay-url</u> using credentials.  This option is
                       usable only with <b>host</b> option.  The credential table format is described in <u><a href="../man5/table.5.html">table</a></u>(5).

               <b>mail-from</b> <u>mailaddr</u>
                       Use <u>mailaddr</u> as the MAIL FROM address within the SMTP transaction.

               <b>src</b> <u>sourceaddr</u> | &lt;<u>sourceaddr</u>&gt;
                       Use the string or list table <u>sourceaddr</u> for the source IP address,  which  is  useful  on
                       machines  with  multiple  interfaces.  If the list contains more than one address, all of
                       them are used in such a way that traffic is routed as efficiently as possible.

       <b>admd</b> <u>authservid</u>
               The Administrative Management Domain this  mail  server  belongs  to.   The  authservid  will  be
               forwarded to filters using it to identify or mark authentication-results headers.  If omitted, it
               defaults to the server name.

       <b>bounce</b> <b>warn-interval</b> <u>delay</u> [, <u>delay</u> <u>...</u>]
               Send  warning messages to the envelope sender when temporary delivery failures cause a message to
               remain in the queue for longer than <u>delay</u>.  Each <u>delay</u> parameter consists of a  positive  decimal
               integer  and  a unit <b>s</b>, <b>m</b>, <b>h</b>, or <b>d</b>.  At most four <u>delay</u> parameters can be specified.  The default
               is "<b>bounce</b> <b>warn-interval</b> 4h", sending a single warning after four hours.

       <b>ca</b> <u>caname</u> <b>cert</b> <u>cafile</u>
               Associate the Certificate Authority (CA) certificate file <u>cafile</u> with ca entry  <u>caname</u>.   The  ca
               entry can be referenced in <b>listen</b> <b>on</b> and <b>action</b> <b>...</b> <b>relay</b> rules.

       <b>filter</b> <u>chain-name</u> <b>chain</b> {<u>filter-name</u> [, <u>...</u>]}
               Register a chain of filters <u>chain-name</u>, consisting of the filters listed in <u>filter-name</u>.  Filters
               in  a  filter  chain are executed in order of declaration for each phase that they are registered
               for.  A filter chain may be used in place of a filter for  any  directive  except  filter  chains
               themselves.

       <b>filter</b> <u>filter-name</u> <b>phase</b> <u>phase-name</u> <b>match</b> <u>conditions</u> <u>decision</u>
               Register  a  filter  <u>filter-name</u>.   A  <u>decision</u>  about what to do with the mail is taken at phase
               <u>phase-name</u> when matching <u>conditions</u>.  Phases, matching conditions, and decisions are described in
               “MAIL FILTERING”, below.

       <b>filter</b> <u>filter-name</u> <b>proc</b> <u>proc-name</u>
               Register "proc" filter <u>filter-name</u> backed by the <u>proc-name</u> process.

       <b>filter</b> <u>filter-name</u> <b>proc-exec</b> <u>command</u>
               Register and execute "proc" filter <u>filter-name</u> from <u>command</u>, conformant with the <u><a href="../man7/smtpd-filters.7.html">smtpd-filters</a></u>(7)
               API.  If <u>command</u> starts with a slash it is executed with an absolute path, otherwise it  will  be
               run from “/usr/libexec/opensmtpd”.

       <b>include</b> "<u>pathname</u>"
               Replace  this  directive  with  the  content of the additional configuration file at the absolute
               <u>pathname</u>.

       <b>listen</b> <b>on</b> <u>interface</u> [<u>family</u>] [<u>options</u>]
               Listen on the <u>interface</u> for incoming connections, using the  same  syntax  as  <u><a href="../man8/ifconfig.8.html">ifconfig</a></u>(8).   The
               <u>interface</u>  parameter  may also be an interface group, an IP address, or a domain name.  Listening
               can optionally be restricted to a specific address <u>family</u>, which can be either <b>inet4</b> or <b>inet6</b>.

               The <u>options</u> are as follows:

               <b>auth</b> [&lt;<u>authtable</u>&gt;]
                       Support  SMTPAUTH:  clients  may  only   start   SMTP   transactions   after   successful
                       authentication.    Users   are  authenticated  against  either  their  own  normal  login
                       credentials or a credentials table  <u>authtable</u>,  the  format  of  which  is  described  in
                       <u><a href="../man5/table.5.html">table</a></u>(5).

               <b>auth-optional</b> [&lt;<u>authtable</u>&gt;]
                       Support SMTPAUTH optionally: clients need not authenticate, but may do so.  This allows a
                       <b>listen</b>  <b>on</b>  directive  to  both  accept  incoming  mail from untrusted senders and permit
                       outgoing mail from authenticated users (using <b>match</b> <b>auth</b>).  It can be used in  situations
                       where  it is not possible to listen on a separate port (usually the submission port, 587)
                       for users to authenticate.

               <b>ca</b> <u>caname</u>
                       For secure connections, use the CA certificate associated with <u>caname</u> (declared in  a  <b>ca</b>
                       directive) as the CA certificate when verifying client certificates.

               <b>filter</b> <u>name</u>
                       Apply filter <u>name</u> on connections handled by this listener.

               <b>hostname</b> <u>hostname</u>
                       Use <u>hostname</u> in the greeting banner instead of the default server name.

               <b>hostnames</b> &lt;<u>names</u>&gt;
                       Override  the  server name for specific addresses.  The <u>names</u> table contains a mapping of
                       IP addresses to hostnames.  If the address on which the connection arrives appears in the
                       mapping, the associated hostname is used.

               <b>mask-src</b>
                       Omit the <b>from</b> part when prepending “Received” headers.

               <b>no-dsn</b>  Disable the DSN (Delivery Status Notification) extension.

               <b>pki</b> <u>pkiname</u>
                       For secure connections, use the certificate associated with <u>pkiname</u> (declared  in  a  <b>pki</b>
                       directive)  to prove a mail server's identity.  This option can be used multiple times to
                       provide alternate certificates for SNI.

               <b>port</b> [<u>port</u>]
                       Listen on the given <u>port</u> instead of the default port 25.

               <b>proxy-v2</b>
                       Support the PROXYv2 protocol, appropriately rewriting the source  address  received  from
                       proxy.

               <b>received-auth</b>
                       In  “Received”  headers,  report whether the session was authenticated and by which local
                       user.

               <b>senders</b> &lt;<u>users</u>&gt; [<b>masquerade</b>]
                       Look up the authenticated user in the <u>users</u> mapping table to  find  the  email  addresses
                       that  user  is  allowed  to  submit  mail  as.   In addition, if the <b>masquerade</b> option is
                       provided, the From header is rewritten to match the sender provided in the SMTP session.

               <b>smtps</b>   Support SMTPS, by default on port 465.  Mutually exclusive with <b>tls</b>.

               <b>tag</b> <u>tag</u>
                       Clients connecting to the listener are tagged with the given <u>tag</u>.

               <b>tls</b>     Support STARTTLS, by default on port 25.  Mutually exclusive with <b>smtps</b>.

               <b>tls-require</b> [<b>verify</b>]
                       Like <b>tls</b>, but force clients to establish a secure  connection  before  being  allowed  to
                       start  an  SMTP  transaction.   With the <b>verify</b> option, clients must also provide a valid
                       certificate to establish an SMTP session.

               <b>protocols</b> <u>protostr</u>
                       Define  the  protocol  versions  to  be  used   for   TLS   sessions.    Refer   to   the
                       <u><a href="../man3/tls_config_parse_protocols.3.html">tls_config_parse_protocols</a></u>(3) manpage for the format of <u>protostr</u>.

               <b>ciphers</b> <u>cipherstr</u>
                       Define  the  list  of  ciphers  that  may  be  used  for  TLS  sessions.   Refer  to  the
                       <u><a href="../man3/tls_config_set_ciphers.3.html">tls_config_set_ciphers</a></u>(3) manpage for the format of <u>cipherstr</u>.

       <b>listen</b> <b>on</b> <b>socket</b> [<u>options</u>]
               Listen for incoming SMTP connections on the Unix domain socket <u>/var/run/smtpd.sock</u>.  This is done
               by default, even if the directive is absent.

               The <u>options</u> are as follows:

               <b>filter</b> <u>name</u>
                       Apply filter <u>name</u> on connections handled by this listener.

               <b>mask-src</b>
                       Omit the <b>from</b> part when prepending “Received” headers.

               <b>no-dsn</b>  Disable the DSN (Delivery Status Notification) extension.

               <b>tag</b> <u>tag</u>
                       Clients connecting to the listener are tagged with the given <u>tag</u>.

       <b>match</b> <u>options</u> <b>action</b> <u>name</u>
               If at least one mail envelope matches the <u>options</u> of one  <b>match</b>  <b>action</b>  directive,  receive  the
               incoming  message,  put  a copy into each matching envelope, and atomically save the envelopes to
               the mail spool for later processing by the respective dispatcher <u>name</u>.

               The following matching options are supported and can all be negated:

               [<b>!</b>] <b>for</b> <b>any</b>
                       Specify that session may address any destination.

               [<b>!</b>] <b>for</b> <b>local</b>
                       Specify that session may address any local domain.  This  is  the  default,  and  may  be
                       omitted.

               [<b>!</b>] <b>for</b> <b>domain</b> <u>domain</u> | &lt;<u>domain</u>&gt;
                       Specify that session may address the string or list table <u>domain</u>.

               [<b>!</b>] <b>for</b> <b>domain</b> <b>regex</b> <u>domain</u> | &lt;<u>domain</u>&gt;
                       Specify that session may address the regex or regex table <u>domain</u>.

               [<b>!</b>] <b>for</b> <b>rcpt-to</b> <u>recipient</u> | &lt;<u>recipient</u>&gt;
                       Specify that session may address the string or list table <u>recipient</u>.

               [<b>!</b>] <b>for</b> <b>rcpt-to</b> <b>regex</b> <u>recipient</u> | &lt;<u>recipient</u>&gt;
                       Specify that session may address the regex or regex table <u>recipient</u>.

               [<b>!</b>] <b>from</b> <b>any</b>
                       Specify that session may originate from any source.

               [<b>!</b>] <b>from</b> <b>auth</b>
                       Specify  that  session may originate from any authenticated user, no matter the source IP
                       address.

               [<b>!</b>] <b>from</b> <b>auth</b> <u>user</u> | &lt;<u>user</u>&gt;
                       Specify that session may originate from authenticated user or user list <u>user</u>,  no  matter
                       the source IP address.

               [<b>!</b>] <b>from</b> <b>auth</b> <b>regex</b> <u>user</u> | &lt;<u>user</u>&gt;
                       Specify that session may originate from authenticated regex or regex list <u>user</u>, no matter
                       the source IP address.

               [<b>!</b>] <b>from</b> <b>local</b>
                       Specify  that  session  may  only  originate  from  a local IP address, or from the local
                       enqueuer.  This is the default, and may be omitted.

               [<b>!</b>] <b>from</b> <b>mail-from</b> <u>sender</u> | &lt;<u>sender</u>&gt;
                       Specify that session may originate from sender or  sender  list  <u>sender</u>,  no  matter  the
                       source IP address.

               [<b>!</b>] <b>from</b> <b>mail-from</b> <b>regex</b> <u>sender</u> | &lt;<u>sender</u>&gt;
                       Specify  that session may originate from regex or regex list <u>sender</u>, no matter the source
                       IP address.

               [<b>!</b>] <b>from</b> <b>rdns</b>
                       Specify that session may only originate from an IP address that  resolves  to  a  reverse
                       DNS.

               [<b>!</b>] <b>from</b> <b>rdns</b> <u>hostname</u> | &lt;<u>hostname</u>&gt;
                       Specify that session may only originate from an IP address that resolves to a reverse DNS
                       matching string or list string <u>hostname</u>.

               [<b>!</b>] <b>from</b> <b>rdns</b> <b>regex</b> <u>hostname</u> | &lt;<u>hostname</u>&gt;
                       Specify that session may only originate from an IP address that resolves to a reverse DNS
                       matching regex or list regex <u>hostname</u>.

               [<b>!</b>] <b>from</b> <b>socket</b>
                       Specify that session may only originate from the local enqueuer.

               [<b>!</b>] <b>from</b> <b>src</b> <u>address</u> | &lt;<u>address</u>&gt;
                       Specify  that session may only originate from string or list table <u>address</u> which can be a
                       specific address or a subnet expressed in CIDR-notation.

               [<b>!</b>] <b>from</b> <b>src</b> <b>regex</b> <u>address</u> | &lt;<u>address</u>&gt;
                       Specify that session may only originate from regex or regex table <u>address</u> which can be  a
                       specific address or a subnet expressed in CIDR-notation.

               In addition, the following transaction options may be matched:

               [<b>!</b>] <b>auth</b>
                       Matches transactions which have been authenticated.

               [<b>!</b>] <b>auth</b> <u>username</u> | &lt;<u>username</u>&gt;
                       Matches transactions which have been authenticated for user or user list <u>username</u>.

               [<b>!</b>] <b>auth</b> <b>regex</b> <u>username</u> | &lt;<u>username</u>&gt;
                       Matches transactions which have been authenticated for regex or regex list <u>username</u>.

               [<b>!</b>] <b>helo</b> <u>helo-name</u> | &lt;<u>helo-name</u>&gt;
                       Specify that session's HELO / EHLO should match the string or list table <u>helo-name</u>.

               [<b>!</b>] <b>helo</b> <b>regex</b> <u>helo-name</u> | &lt;<u>helo-name</u>&gt;
                       Specify that session's HELO / EHLO should match the regex or regex table <u>helo-name</u>.

               [<b>!</b>] <b>mail-from</b> <u>sender</u> | &lt;<u>sender</u>&gt;
                       Specify that transaction's MAIL FROM should match the string or list table <u>sender</u>.

               [<b>!</b>] <b>mail-from</b> <b>regex</b> <u>sender</u> | &lt;<u>sender</u>&gt;
                       Specify that transaction's MAIL FROM should match the regex or regex table <u>sender</u>.

               [<b>!</b>] <b>rcpt-to</b> <u>recipient</u> | &lt;<u>recipient</u>&gt;
                       Specify that transaction's RCPT TO should match the string or list table <u>recipient</u>.

               [<b>!</b>] <b>rcpt-to</b> <b>regex</b> <u>recipient</u> | &lt;<u>recipient</u>&gt;
                       Specify that transaction's RCPT TO should match the regex or regex table <u>recipient</u>.

               [<b>!</b>] <b>tag</b> <u>tag</u>
                       Matches transactions tagged with the given <u>tag</u>.

               [<b>!</b>] <b>tag</b> <b>regex</b> <u>tag</u>
                       Matches transactions tagged with the given <u>tag</u> regex.

               [<b>!</b>] <b>tls</b>
                       Specify that transaction should take place in a TLS channel.

       <b>match</b> <u>options</u> <b>reject</b>
               Reject  the incoming message during the SMTP dialogue.  The same <u>options</u> are supported as for the
               <b>match</b> <b>action</b> directive.

       <b>mda</b> <b>wrapper</b> <u>name</u> <u>command</u>
               Associate <u>command</u> with the mail delivery  agent  wrapper  named  <u>name</u>.   When  a  local  delivery
               specifies  a  wrapper,  the  <u>command</u>  associated  with the wrapper will be executed instead.  The
               command may contain format specifiers (see “FORMAT SPECIFIERS”).

       <b>mta</b> <b>max-deferred</b> <u>number</u>
               When delivery to a given host is suspended due  to  temporary  failures,  cache  at  most  <u>number</u>
               envelopes  for  that host such that they can be delivered as soon as another delivery succeeds to
               that host.  The default is 100.

       <b>pki</b> <u>pkiname</u> <b>cert</b> <u>certfile</u>
               Associate certificate file <u>certfile</u> with pki entry <u>pkiname</u>.  The  pki  entry  defines  a  keypair
               configuration that can be referenced in listener rules and relay actions.

               A certificate chain may be created by appending one or many certificates, including a Certificate
               Authority certificate, to <u>certfile</u>.  The creation of certificates is documented in <u><a href="../man8/starttls.8.html">starttls</a></u>(8).

       <b>pki</b> <u>pkiname</u> <b>key</b> <u>keyfile</u>
               Associate the key located in <u>keyfile</u> with pki entry <u>pkiname</u>.

       <b>pki</b> <u>pkiname</u> <b>dhe</b> <u>params</u>
               Specify  the DHE parameters to use for DHE cipher suites with pki entry <u>pkiname</u>.  Valid parameter
               values are <b>none</b>, <b>legacy</b>, and <b>auto</b>.  For <b>legacy</b>, a fixed key length of 1024 bits is used,  whereas
               for  <b>auto</b>,  the  key length is determined automatically.  The default is <b>none</b>, which disables DHE
               cipher suites.

       <b>proc</b> <u>proc-name</u> <u>command</u>
               Register an external process named <u>proc-name</u> from <u>command</u>, conformant with  the  <u><a href="../man7/smtpd-filters.7.html">smtpd-filters</a></u>(7)
               API.  Such processes may be used to share the same instance between multiple filters.  If <u>command</u>
               starts  with  a  slash  it  is  executed  with  an  absolute  path, otherwise it will be run from
               “/usr/libexec/opensmtpd”.

       <b>queue</b> <b>compression</b>
               Store queue files in a compressed format.  This may be useful to save disk space.

       <b>queue</b> <b>encryption</b> [<u>key</u>]
               Encrypt queue files with <u><a href="../man3/EVP_aes_256_gcm.3.html">EVP_aes_256_gcm</a></u>(3).  If no <u>key</u> is specified, it is read with <u><a href="../man3/getpass.3.html">getpass</a></u>(3).
               If the string <b>stdin</b> or a single dash (‘-’) is given instead of a <u>key</u>, the key is  read  from  the
               standard input.

       <b>queue</b> <b>ttl</b> <u>delay</u>
               Set  the  default  expiration  time  for  temporarily undeliverable messages, given as a positive
               decimal integer followed by a unit <b>s</b>, <b>m</b>, <b>h</b>, or <b>d</b>.  The default is four days (4d).

       <b>smtp</b> <b>ciphers</b> <u>control</u>
               Set the <u>control</u> string for <u><a href="../man3/SSL_CTX_set_cipher_list.3.html">SSL_CTX_set_cipher_list</a></u>(3).  The default is "HIGH:!aNULL:!MD5".

       <b>smtp</b> <b>limit</b> <b>max-mails</b> <u>count</u>
               Limit the number of messages to <u>count</u> for each session.  The default is 100.

       <b>smtp</b> <b>limit</b> <b>max-rcpt</b> <u>count</u>
               Limit the number of recipients to <u>count</u> for each transaction.  The default is 1000.

       <b>smtp</b> <b>max-message-size</b> <u>size</u>
               Reject messages larger than <u>size</u>, given as a positive number of bytes or as a string to be parsed
               with <u><a href="../man3/scan_scaled.3.html">scan_scaled</a></u>(3).  The default is "35M".

       <b>smtp</b> <b>sub-addr-delim</b> <u>character</u>
               When resolving the local part of a local email  address,  ignore  the  ASCII  <u>character</u>  and  all
               characters following it.  The default is ‘+’.

       <b>srs</b> <b>key</b> <u>secret</u>
               Set the secret key to use for SRS, the Sender Rewriting Scheme.

       <b>srs</b> <b>key</b> <b>backup</b> <u>secret</u>
               Set  a  backup  secret  key  to use as a fallback for SRS.  This can be used to implement SRS key
               rotation.

       <b>srs</b> <b>ttl</b> <u>delay</u>
               Set the time-to-live delay for SRS envelopes.  After this  delay,  a  bounce  reply  to  the  SRS
               address will be discarded to limit risks of forged addresses.  The default is four days (4d).

       <b>table</b> <u>name</u> [<u>type</u>:]<u>pathname</u>
               Tables  provide  additional  configuration  information for <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8) in the form of lists or key-
               value mappings.  The format of the entries depends on what the  table  is  used  for.   Refer  to
               <u><a href="../man5/table.5.html">table</a></u>(5) for the exhaustive documentation.

               Each table is identified by an arbitrary, unique <u>name</u>.

               If  the  <u>type</u>  is  <b>db</b>,  information is stored in a file created with <u><a href="../man8/makemap.8.html">makemap</a></u>(8); if it is <b>file</b> or
               omitted, information is stored in a plain text file using the format described in <u><a href="../man5/table.5.html">table</a></u>(5).   The
               <u>pathname</u> to the file must be absolute.

       <b>table</b> <u>name</u> {<u>value</u> [, <u>...</u>]}
               Instead  of  using a separate file, declare a list table containing the given static <u>value</u>s.  The
               table must contain at least one value and  may  declare  multiple  values  as  a  comma-separated
               (whitespace optional) list.

       <b>table</b> <u>name</u> {<u>key</u>=<u>value</u> [, <u>...</u>]}
               Instead  of  using a separate file, declare a mapping table containing the given static <u>key</u>-<u>value</u>
               pairs.  The table must contain at least one key-value pair and may declare multiple  pairs  as  a
               comma-separated (whitespace optional) list.

   <b>MAIL</b> <b>FILTERING</b>
       In  a  regular  workflow, <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8) may accept or reject a message based only on the content of envelopes.
       Its decisions are about the handling of the message, not about the handling of an active session.

       Filtering extends the decision making process by allowing <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8) to stop  at  each  phase  of  an  SMTP
       session, check that conditions are met, then decide if a session is allowed to move forward.

       With  filtering, a session may be interrupted at any phase before an envelope is complete.  A message may
       also be rejected after being submitted, regardless of whether the envelope was accepted or not.

       The following phases are currently supported:

             connect      upon connection, before a banner is displayed
             helo         after HELO command is submitted
             ehlo         after EHLO command is submitted
             mail-from    after MAIL FROM command is submitted
             rcpt-to      after RCPT TO command is submitted
             data         after DATA command is submitted
             commit       after message is fully is submitted

       At each phase, various conditions may be matched.  The fcrdns, rdns, and src data are  available  in  all
       phases, but other data must have been already submitted before they are available.

             fcrdns                   forward-confirmed reverse DNS is valid
             rdns                     session has a reverse DNS
             rdns &lt;<u>table</u>&gt;             session has a reverse DNS in table
             src &lt;<u>table</u>&gt;              source address is in table
             helo &lt;<u>table</u>&gt;             helo name is in table
             auth                     session is authenticated
             auth &lt;<u>table</u>&gt;             session username is in table
             mail-from &lt;<u>table</u>&gt;        sender address is in table
             rcpt-to &lt;<u>table</u>&gt;          recipient address is in table

       These conditions may all be negated by prefixing them with an exclamation mark:

             !fcrdns                  forward-confirmed reverse DNS is invalid

       Any  conditions  using  a table may indicate that the table contains regular expressions by prefixing the
       table name with the keyword regex.

             helo regex &lt;<u>table</u>&gt;       helo name matches a regex in table

       Finally, a number of decisions may be taken:

             bypass                   the session or transaction bypasses filters
             disconnect <u>message</u>       the session is disconnected with message
             junk                     the session or transaction is junked, i.e., an  ‘X-Spam:  yes’  header  is
                                      added to any messages
             reject <u>message</u>           the command is rejected with message
             rewrite <u>value</u>            the command parameter is rewritten with value

       Decisions  that  involve a message require that the message be RFC valid, meaning that they should either
       start with a 4xx or 5xx status code.  Decisions can be taken at any phase, though junking can only happen
       before a message is committed.

   <b>FORMAT</b> <b>SPECIFIERS</b>
       Some configuration directives support expansion of their parameters at  runtime.   Such  directives  (for
       example  <b>action</b>  <b>maildir</b>,  <b>action</b>  <b>mda</b>)  may  use format specifiers which are expanded before delivery or
       relaying.  The following formats are currently supported:

             %{sender}            sender email address, may be empty string
             %{sender.user}       user part of the sender email address, may be empty
             %{sender.domain}     domain part of the sender email address, may be empty
             %{rcpt}              recipient email address
             %{rcpt.user}         user part of the recipient email address
             %{rcpt.domain}       domain part of the recipient email address
             %{dest}              recipient email address after expansion
             %{dest.user}         user part after expansion
             %{dest.domain}       domain part after expansion
             %{user.username}     local user
             %{user.directory}    home directory of the local user
             %{mbox.from}         name used in mbox From separator lines
             %{mda}               mda command, only available for mda wrappers

       Expansion formats also support partial expansion using the  optional  bracket  notations  with  substring
       offset.  For example, with recipient domain “example.org”:

             %{rcpt.domain[0]}       expands to “e”
             %{rcpt.domain[1]}       expands to “x”
             %{rcpt.domain[8:]}      expands to “org”
             %{rcpt.domain[-3:]}     expands to “org”
             %{rcpt.domain[0:6]}     expands to “example”
             %{rcpt.domain[0:-4]}    expands to “example”

       In addition, modifiers may be applied to the token.  For example, with recipient “User+<a href="mailto:Tag@Example.org">Tag@Example.org</a>”:

             %{rcpt:lowercase}          expands to “user+<a href="mailto:tag@example.org">tag@example.org</a>”
             %{rcpt:uppercase}          expands to “USER+<a href="mailto:TAG@EXAMPLE.ORG">TAG@EXAMPLE.ORG</a>”
             %{rcpt:strip}              expands to “<a href="mailto:User@Example.org">User@Example.org</a>”
             %{rcpt:lowercase|strip}    expands to “<a href="mailto:user@example.org">user@example.org</a>”

       For  security  concerns,  expanded values are sanitized and potentially dangerous characters are replaced
       with ‘:’.  In situations where they are desirable, the “raw” modifier may be applied.  For example,  with
       recipient “user+t?<a href="mailto:g@example.org">g@example.org</a>”:

             %{rcpt}        expands to “user+t:<a href="mailto:g@example.org">g@example.org</a>”
             %{rcpt:raw}    expands to “user+t?<a href="mailto:g@example.org">g@example.org</a>”

   <b>MDA</b> <b>COMMANDS</b>
       When  an  action  delivery  method is <b>mda</b>, <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8) runs the associated command for the delivery with the
       mail content provided via standard input.  The command is expected to read all the mail content.

       The exit code of the command reports the outcome of the  delivery:  status  0  (EX_OK)  is  a  successful
       delivery; status 71 (EX_OSERR) and 75 (EX_TEMPFAIL) are temporary failures; and all other exit status are
       considered permanent failures.

       The following environment variables are set:

       DOMAIN              The recipient domain.
       EXTENSION           The sub address of the recipient (may be unset).
       HOME                The delivery user's login directory.
       LOCAL               The local part of the recipient user address.
       LOGNAME             The login name of the user.
       ORIGINAL_RECIPIENT  The address of the original recipient.
       PATH                Set   to   _PATH_DEFPATH.   Traditionally  <u><a href="file:/usr/bin">/usr/bin</a>:<a href="file:/bin">/bin</a></u>,  but  expanded  to  include
                           <u><a href="file:/usr/sbin">/usr/sbin</a></u>, <u><a href="file:/sbin">/sbin</a></u>, <u>/usr/X11R6/bin</u>, <u><a href="file:/usr/local/bin">/usr/local/bin</a></u>, and <u><a href="file:/usr/local/sbin">/usr/local/sbin</a></u> in OpenBSD.
       RECIPIENT           The address of the final recipient.
       SENDER              The address of the sender (might be empty).
       SHELL               Set to <u><a href="file:/bin/sh">/bin/sh</a></u>.
       USER                Synonym of LOGNAME for backwards compatibility.

</pre><h4><b>FILES</b></h4><pre>
       <u>/etc/smtpd.conf</u>     Default <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8) configuration file.
       <u>/etc/mailname</u>       If this file exists, the first line is used  as  the  server  name.   Otherwise,  the
                           server  name  is  derived  from the local hostname returned by <u><a href="../man3/gethostname.3.html">gethostname</a></u>(3), either
                           directly if it is a fully qualified domain name,  or  by  retrieving  the  associated
                           canonical name through <u><a href="../man3/getaddrinfo.3.html">getaddrinfo</a></u>(3).
       <u>/var/run/smtpd.sock</u>
                           Unix domain socket for incoming SMTP connections.
       <u>/var/spool/smtpd/</u>   Spool directories for mail during processing.

</pre><h4><b>EXAMPLES</b></h4><pre>
       The  default <b>smtpd.conf</b> file which ships with OpenBSD listens on the loopback network interface (<u>lo0</u>) and
       allows for mail from users and daemons on the local machine,  as  well  as  permitting  email  to  remote
       servers.  Some more complex configurations are given below.

       This  first  example  is  similar  to  the default configuration, but all outgoing mail is forwarded to a
       remote SMTP server.  A secrets file is needed to specify a username and password:

             # touch /etc/secrets
             # chmod 640 /etc/secrets
             # chown root:_smtpd /etc/secrets
             # echo "bob username:password" &gt; /etc/secrets

       <b>smtpd.conf</b> would look like this:

             table aliases file:/etc/aliases
             table secrets file:/etc/secrets

             listen on lo0

             action "local_mail" mbox alias &lt;aliases&gt;
             action "outbound" relay host smtp+tls://<a href="mailto:bob@smtp.example.com">bob@smtp.example.com</a> \
                     auth &lt;secrets&gt;

             match from local for local action "local_mail"
             match from local for any action "outbound"

       In this second example, the aim is to  permit  mail  delivery  and  relaying  only  for  users  that  can
       authenticate  (using  their  normal login credentials).  An RSA certificate must be provided to prove the
       server's identity.  The mail server listens on all interfaces the default routes point to.  Mail  with  a
       local destination is sent to an external MDA.  First, the RSA certificate is created:

             # openssl genrsa -out /etc/ssl/private/mail.example.com.key 4096
             # openssl req -new -x509 -key /etc/ssl/private/mail.example.com.key \
                     -out /etc/ssl/mail.example.com.crt -days 365
             # chmod 600 /etc/ssl/mail.example.com.crt
             # chmod 600 /etc/ssl/private/mail.example.com.key

       In  the  example  above, a certificate valid for one year was created.  The configuration file would look
       like this:

             pki mail.example.com cert "/etc/ssl/mail.example.com.crt"
             pki mail.example.com key "/etc/ssl/private/mail.example.com.key"

             table aliases file:/etc/aliases

             listen on lo0
             listen on egress tls pki mail.example.com auth

             action mda_with_aliases mda "/path/to/mda -f -" alias &lt;aliases&gt;
             action mda_without_aliases mda "/path/to/mda -f -"
             action "outbound" relay

             match for local action mda_with_aliases
             match from any for domain example.com action mda_without_aliases
             match for any action "outbound"
             match auth from any for any action "outbound"

       For sites that wish to sign messages using DKIM, the following example uses <b>opensmtpd-filter-dkimsign</b> for
       DKIM signing:

             table aliases file:/etc/aliases

             filter "dkimsign" proc-exec "filter-dkimsign -d &lt;domain&gt; -s &lt;selector&gt; \
                     -k /etc/dkim/private.key" user _dkimsign group _dkimsign

             listen on socket filter "dkimsign"
             listen on lo0 filter "dkimsign"

             action "local_mail" mbox alias &lt;aliases&gt;
             action "outbound" relay

             match for local action "local_mail"
             match for any action "outbound"

       Alternatively, the <b>opensmtpd-filter-rspamd</b> package may be used to  provide  integration  with  <b>rspamd</b>,  a
       third-party  daemon  which  provides  multiple  antispam  features  as  well as DKIM signing.  As well as
       configuring <b>rspamd</b> itself, it requires use of the <b>proc-exec</b> keyword:

             filter "rspamd" proc-exec "filter-rspamd"

       Sites that accept non-local messages may be able to cut down on the volume of spam received by  rejecting
       forged  messages  that  claim  to  be  from  the  local  domain.  The following example uses a list table
       <u>other-relays</u> to specify the IP addresses of relays that may legitimately originate mail with the  owner's
       domain as the sender.

             table aliases file:/etc/aliases
             table other-relays file:/etc/other-relays

             listen on lo0
             listen on egress

             action "local_mail" mbox alias &lt;aliases&gt;
             action "outbound" relay

             match for local action "local_mail"
             match for any action "outbound"
             match !from src &lt;other-relays&gt; mail-from "@example.com" for any \
                   reject
             match from any for domain example.com action "local_mail"

</pre><h4><b>SEE</b> <b>ALSO</b></h4><pre>
       <u><a href="../man5/mailer.conf.5.html">mailer.conf</a></u>(5), <u><a href="../man5/table.5.html">table</a></u>(5), <u><a href="../man7/smtpd-filters.7.html">smtpd-filters</a></u>(7), <u><a href="../man8/makemap.8.html">makemap</a></u>(8), <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8)

</pre><h4><b>HISTORY</b></h4><pre>
       <u><a href="../man8/smtpd.8.html">smtpd</a></u>(8) first appeared in OpenBSD 4.6.

Debian                                            July 26, 2024                                    <u><a href="../man5/SMTPD.CONF.5.html">SMTPD.CONF</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>