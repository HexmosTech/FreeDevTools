<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cache.config  -  the  cache.config  file  allows you to overrule the origin's cache policies. You can add</title>
    <style>
        body { font-family: monospace; margin: 20px; line-height: 1.4; }
        a { color: #0066cc; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="main-content">
<section class="p-strip is-bordered">
<div class="row">
<div class="col-3 u-hide--small u-hide" id="toc">
</div>
<div id="tableWrapper">
<p id="distroAndSection"></p>

Provided by: <a href="https://launchpad.net/ubuntu/questing/+package/trafficserver">trafficserver_9.2.5+ds-1ubuntu2_amd64</a> <br><br><pre>
</pre><h4><b>NAME</b></h4><pre>
       cache.config  -  the  cache.config  file  allows you to overrule the origin's cache policies. You can add
       caching rules to specify the following:

       • Not to cache objects from specific IP addresses.

       • How long to pin particular objects in the cache.

       • How long to consider cached objects as fresh.

       • Whether to ignore no-cache directives from the server.

       <b>IMPORTANT:</b>
          Generally, using this file to define cache policies is an antipattern.  It's usually  better  to  have
          the  origin  specify the cache policy via the <u>Cache-Control:</u> header.  That way, all the business logic
          stays with the content generation. The origin is in a much better position to know which  content  can
          be safely cached, and for how long. It can make fine grained decisions, changing Cache-Control: header
          value  per  object.  This file allows for some overrides but, is relatively crude compared to what the
          origin can provide.

          After modifying <u>cache.config</u>, run <u>traffic_ctl</u> <u>config</u> <u>reload</u> to apply changes.

</pre><h4><b>FORMAT</b></h4><pre>
       Each  line  in  the  <u>cache.config</u>  file  contains  a  caching  rule.  Traffic  Server  recognizes   three
       space-delimited tags:

          primary_destination=value secondary_specifier=value action=value

       You  can  use  more  than  one  secondary  specifier  in  a  rule. However, you cannot repeat a secondary
       specifier. The following list shows the possible primary destinations with allowed values.

   <b>Primary</b> <b>Destinations</b>
       The primary destination field on each line is used to restrict the requests to  which  the  caching  rule
       will apply.

       <b>dest_domain</b>
              A  requested  domain name. Traffic Server matches the host name of the destination from the URL in
              the request.

       <b>dest_host</b>
              Alias for <b>dest_domain</b>.

       <b>dest_ip</b>
              A requested IP address. Traffic Server matches the IP address of the destination in the request.

       <b>host_regex</b>
              A regular expression to be tested against the destination host name in the request.

       <b>url_regex</b>
              A regular expression to be tested against the URL in the request.

   <b>Secondary</b> <b>Specifiers</b>
       The secondary specifiers are optional and may be used to further restrict which requests are impacted  by
       the  caching  rule.  Multiple  secondary specifiers may be used within a single rule, though each type of
       specifier can appear at most one time. In other words, you may have both a <b>port</b> and <b>scheme</b>  in  the  same
       rule, but you may not have two <b>port</b>s.

       <b>port</b>   Request URL port.

       <b>scheme</b> Request URL protocol (http or https).

       <b>prefix</b> Prefix in the path part of a URL.

       <b>suffix</b> File suffix in the URL.

       <b>method</b> Request URL method (get, put, post, trace, etc.).

       <b>time</b>   A  time range, such as 08:00-14:00. Specified using a 24-hour clock in the timezone of the Traffic
              Server server.

       <b>src_ip</b> Client IP address.

       <b>internal</b>
              A boolean value, <b>true</b> or <b>false</b>, specifying if the rule should match (or not match)  a  transaction
              originating  from an internal API. This is useful to differentiate transactions originating from a
              Traffic Server plugin.

   <b>Actions</b>
       The final component of a caching rule is the action, which determines what Traffic Server  will  do  with
       all objects matching the primary destinations and secondary specifiers of the rule in question.

       <b>action</b> One of the following values:
                             ┌────────────────────────┬───────────────────────────────────────┐
                             │ Value                  │ Effect                                │
                             ├────────────────────────┼───────────────────────────────────────┤
                             │ <b>never-cache</b>            │ Never  cache  specified  objects,  it │
                             │                        │ will be overwritten by <b>ttl-in-cache</b>.  │
                             ├────────────────────────┼───────────────────────────────────────┤
                             │ <b>ignore-no-cache</b>        │ Ignore  all  <b>Cache-Control:</b>  <b>no-cache</b> │
                             │                        │ headers.                              │
                             ├────────────────────────┼───────────────────────────────────────┤
                             │ <b>ignore-client-no-cache</b> │ Ignore     <b>Cache-Control:</b>    <b>no-cache</b> │
                             │                        │ headers from client requests.         │
                             ├────────────────────────┼───────────────────────────────────────┤
                             │ <b>ignore-server-no-cache</b> │ Ignore    <b>Cache-Control:</b>     <b>no-cache</b> │
                             │                        │ headers from origin server responses. │
                             └────────────────────────┴───────────────────────────────────────┘

       <b>cache-responses-to-cookies</b>
              Change  the  style of caching with regard to cookies. This effectively overrides the configuration
              parameter <u>proxy.config.http.cache.cache_responses_to_cookies</u> and uses the  same  values  with  the
              same semantics. The override happens only for requests that match.

       <b>pin-in-cache</b>
              Preserves  objects in cache, preventing them from being overwritten.  Does not affect objects that
              are determined not to be cacheable. This setting can have performance issues, and severely  affect
              the  cache.  For instance, if the primary destination matches all objects, once the cache is full,
              no new objects could get written as nothing would be evicted. Similarly, for each cache-miss, each
              object would incur extra checks to determine if the object it would replace could be overwritten.

              The value is the amount of time you want to keep the object(s) in the cache.  The  following  time
              formats are allowed:

              • <b>d</b> for days; for example: 2d

              • <b>h</b> for hours; for example: 10h

              • <b>m</b> for minutes; for example: 5m

              • <b>s</b> for seconds; for example: 20s

              • mixed units; for example: 1h15m20s

       <b>revalidate</b>
              For  objects  that  are  in cache, overrides the amount of time the object(s) are to be considered
              fresh. Use the same time formats as <b>pin-in-cache</b>.

       <b>ttl-in-cache</b>
              Forces object(s) to become cached, as if they had a <b>Cache-Control:</b> <b>max-age:&lt;time&gt;</b> header.  Can  be
              overruled  by  requests  with cookies. The value is the amount of time object(s) are to be kept in
              the cache, regardless of <b>Cache-Control</b> response headers from the origin server. Use the same  time
              formats as <b>pin-in-cache</b>.

</pre><h4><b>MATCHING</b> <b>MULTIPLE</b> <b>RULES</b></h4><pre>
       When  multiple  rules  are  specified in <u>cache.config</u>, Traffic Server will check all of them in order for
       each request. Thus, two rules which match the same request but have conflicting actions  will  result  in
       their actions being compounded. In other words, Traffic Server does not stop on the first match.

       In some cases, this may lead to confusing behavior. For example, consider the following two rules:

          dest_domain=example.com prefix=foo suffix=js revalidate=7d
          dest_domain=example.com suffix=js action=never-cache

       Reading  that  under the assumption that Traffic Server stops on the first match might lead one to assume
       that all Javascript files will be excluded from the Traffic Server cache, except for  those  whose  paths
       begin  with  <b>foo</b>. This, however, is not correct.  Instead, the first rule establishes that all Javascript
       files with the path prefix <b>foo</b> will be forced to revalidate every seven days, and then  the  second  rule
       also  sets an action on all Javascript files, regardless of their path prefix, to never be cached at all.
       Because none of the Javascript files will be cached at all, the first rule is effectively voided.

       A similar example, but at least one with a correct solution, might be an attempt to set differing  values
       for the same action, as so:

          # Incorrect!
          dest_domain=example.com prefix=foo suffix=js revalidate=7d
          dest_domain=example.com suffix=js revalidate=1d

          # Correct!
          dest_domain=example.com suffix=js revalidate=1d
          dest_domain=example.com prefix=foo suffix=js revalidate=7d

       The  latter  accomplishes  the  implied  goal  of  having  a  default,  or global, timer for cache object
       revalidations on Javascript files, as well as a more targeted (and  longer)  revalidation  time  on  just
       those  Javascript  files with a particular prefix. The former fails at this goal, because the second rule
       will match all Javascript files and will override any previous <b>revalidate</b> values that may have  been  set
       by prior rules.

   <b>ttl-in-cache</b> <b>and</b> <b>never-cache</b>
       When  multiple  rules  are  matched  in  the  same  request,  <b>never-cache</b>  will  always be overwritten by
       <b>ttl-in-cache</b>. For example:

          # ttl-in-cache=1d never-cache=false
          dest_domain=example.com action=never-cache
          dest_domain=example.com ttl-in-cache=1d

</pre><h4><b>EXAMPLES</b></h4><pre>
       The following example configures Traffic Server  to  revalidate  <b>gif</b>  and  <b>jpeg</b>  objects  in  the  domain
       <b>mydomain.com</b>  every  6  hours, and all other objects in <b>mydomain.com</b> every hour. The rules are applied in
       the order listed.

          dest_domain=mydomain.com revalidate=1h
          dest_domain=mydomain.com suffix=gif revalidate=6h
          dest_domain=mydomain.com suffix=jpeg revalidate=6h

       Force a specific regex to be in cache between 7-11pm of the server's time for 26 hours.

          url_regex=example.com/articles/popular.* time=19:00-23:00 ttl-in-cache=1d2h

       Prevent objects from being evicted from cache:

          url_regex=example.com/game/.* pin-in-cache=1h

</pre><h4><b>COPYRIGHT</b></h4><pre>
       2025, <a href="mailto:dev@trafficserver.apache.org">dev@trafficserver.apache.org</a>

9.2                                               May 22, 2025                                   <u><a href="../man5/CACHE.CONFIG.5.html">CACHE.CONFIG</a></u>(5)
</pre>
 </div>
</div></section>
</div>
</body>
</html>