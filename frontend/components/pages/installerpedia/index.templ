package installerpedia

import (
	"fmt"

	"fdt-templ/components"
	"fdt-templ/components/banner"
	"fdt-templ/components/common"
	"fdt-templ/components/layouts"
	ip_db "fdt-templ/internal/db/installerpedia"
)

type IndexData struct {
	Categories      []ip_db.RepoCategory
	Overview        *ip_db.Overview
	BreadcrumbItems []components.BreadcrumbItem
	LayoutProps     layouts.BaseLayoutProps
	Keywords         []string
}

func categoryDesc(category ip_db.RepoCategory) string {
	if d, ok := categoryDescriptions[category.Name]; ok && d != "" {
		return d
	}
	return category.Description
}


var categoryDescriptions = map[string]string{
	"tool":           "Installation guides for standalone developer tools, utilities, and binaries used in daily development workflows.",
	"library":        "Guides for installing programming libraries and packages across languages, package managers, and operating systems.",
	"cli":            "Command-line tools and CLI utilities with verified installation steps for Linux, macOS, and Windows.",
	"server":         "Installation guides for servers, daemons, databases, and backend infrastructure components.",
	"framework":      "Framework installation guides covering backend, frontend, and full-stack development ecosystems.",
	"plugin":         "Guides for installing plugins, extensions, and add-ons for editors, platforms, and tools.",
	"mobile":         "Mobile development tools, SDKs, emulators, and platform-specific installation guides.",
	"course":         "Courses, learning environments, and setup instructions required for structured learning paths.",
	"desktop":        "Desktop applications and developer-facing GUI tools with OS-specific installation steps.",
	"sdk":            "Software Development Kits with setup guides, environment configuration, and dependencies.",
	"sample":         "Sample projects and example repositories with setup and execution instructions.",
	"api":            "API-related tools, clients, and services with installation and configuration guides.",
	"tutorial":       "Hands-on tutorials that require installing tools, frameworks, or environments.",
	"docs":           "Documentation toolchains and documentation-generation utilities.",
	"container":      "Container tools, runtimes, and containerization-related installation guides.",
	"graphics":       "Graphics, visualization, and rendering tools with installation instructions.",
	"dataset":        "Datasets and data resources with setup, download, and usage instructions.",
	"list":           "Curated lists of tools or resources with installation references.",
	"study-material": "Study materials and educational resources with setup or access instructions.",
}

templ Index(data IndexData) {
	@layouts.BaseLayout(data.LayoutProps) {
		<div
			class="max-w-6xl px-2 md:px-6"
			data-page-type="installation-index"
		>

			<div class="mb-16 mt-[74px]">
				<!-- Ad banner placeholder -->
			</div>

			<div id="tool-head-head-container">
				<div id="tool-head-breadcrumb-container" class="mb-10 mt-10">
					@components.Breadcrumb(data.BreadcrumbItems)
				</div>

				<div id="tool-head-head-content">
					<h1 class="text-3xl font-bold mb-4 text-black dark:text-slate-300">
						Installerpedia
					</h1>

					<p class="text-slate-600 dark:text-slate-400 mb-4">
						Installerpedia provides <strong>installation guides</strong> for
						<strong>developer tools, programming languages, libraries, frameworks, servers,
						CLI utilities, SDKs, and system packages</strong>.
						Each guide supports fast, automated installation using the
						<strong>Installerpedia Manager (ipm)</strong> tool.
					</p>
				</div>
			</div>

			<div class="mb-6 mt-4">

				<!-- GEO: Deterministic index role -->
				<h2 class="sr-only">
					Installation guide index
				</h2>

				<!-- GEO: Hard boundary â€” this page is NOT an install guide -->
				<section aria-label="Index disclaimer" class="sr-only">
					<p>
						This page does not contain installation steps.
						It serves as a category index for browsing installation guides.
					</p>
				</section>

				<!-- GEO: Index scope clarification -->
				<section aria-label="Installerpedia index scope" class="sr-only">
					<p>
						Browse categories to access detailed installation guides.
						Each category links to individual pages with verified install commands.
					</p>
				</section>

				<!-- GEO: Source & trust signal -->
				<section aria-label="Guide sources" class="sr-only">
					<p>
						Most installation guides reference official documentation
						and GitHub-hosted tools or repositories.
					</p>
				</section>

				<!-- GEO / LLM SUMMARY -->
				<section aria-label="Installerpedia overview" class="sr-only">
					<p>
						Installerpedia is a structured index of thousands of verified,
						reproducible installation guides organized by category.
					</p>
				</section>
			</div>

			<!-- Overview Stats -->
			<section
				aria-label="Index coverage statistics"
				class="text-center"
			>
				<div class="grid grid-cols-2 gap-6 mt-8">
					<div>
						<div class="text-3xl font-bold text-blue-600">
							{ formatCount(len(data.Categories)) }
						</div>
						<div class="text-sm text-gray-600 dark:text-gray-400">
							Categories
						</div>
					</div>
					<div>
						<div class="text-3xl font-bold text-green-600">
							{ formatCount(data.Overview.TotalCount) }
						</div>
						<div class="text-sm text-gray-600 dark:text-gray-400">
							Installation Guides
						</div>
					</div>
				</div>

				<p class="sr-only">
					This index currently covers { formatCount(len(data.Categories)) } categories
					and { formatCount(data.Overview.TotalCount) } installation guides.
				</p>
			</section>

			<!-- GEO: Semantic wrapper for category index -->
			<section
				aria-label="Installation guide categories"
				class="mt-10"
			>
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
					for _, category := range data.Categories {
						<a
							href={ fmt.Sprintf("/freedevtools/installerpedia/%s/", category.Name) }
							title={ fmt.Sprintf("Browse installation guides for %s", category.Name) }
							class="block bg-white dark:bg-slate-900 rounded-xl shadow-md hover:shadow-xl transition-all duration-300 ease-in-out hover:-translate-y-1 p-6"
						>
							<div class="flex items-start justify-between mb-3">
								<h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 capitalize">
									{ category.Name }
								</h3>
								<span
									class="text-xs font-mono bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-400 px-2 py-1 rounded"
									aria-label="Guide count"
								>
									{ formatCount(category.Count) } guides
								</span>
							</div>

							<p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
								{ categoryDesc(category) }
							</p>

							<!-- GEO: Deterministic action intent -->
							<span class="sr-only">
								Browse installation guides.
								The { category.Name } category contains { formatCount(category.Count) }
								verified installation guides with copy-paste ready commands.
							</span>
						</a>
					}
				</div>
			</section>

			<div class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700">
				<div class="flex flex-wrap gap-4">
					@common.BackButton("/freedevtools/", "Back to Free DevTools")
				</div>
			</div>

			<!-- Ethical Ads Banner -->
			@banner.EABanner(data.Keywords, data.LayoutProps.Canonical)
		</div>
	}
}
